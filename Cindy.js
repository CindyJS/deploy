/* CindyJS - (C) 2014-2016  The CindyJS Project
 * Mostly licensed under the Apache License 2.0, but subprojects may use different licensing.
 * See https://github.com/CindyJS/CindyJS/tree/e802985871eba7f2ffe418571b081e208665aba1
 * for corresponding sources and their respective licensing conditions.
 */
/*
 npm.im/iphone-inline-video 2.0.2  npm.im/intervalometer */
var enableInlineVideo=function(){function w(e,h,w,p){function H(w){W=h(H,p);e(w-(E||w));E=w}var W,E;return{start:function(){W||H(0)},stop:function(){w(W);W=null;E=0}}}function E(e,h,w,p){function H(h){!!e[w]===!!p&&h.stopImmediatePropagation();delete e[w]}return e.addEventListener(h,H,!1),H}function ba(e,h,w,p){function H(e){w[h]=e}p&&H(e[h]);Object.defineProperty(e,h,{get:function(){return w[h]},set:H})}function Aa(e,h,w){w.addEventListener(h,function(){return e.dispatchEvent(new Event(h))})}function ra(e,
h){Promise.resolve().then(function(){e.dispatchEvent(new Event(h))})}function Ka(e){var h=new Audio;return Aa(e,"play",h),Aa(e,"playing",h),Aa(e,"pause",h),h.crossOrigin=e.crossOrigin,h.src=e.src||e.currentSrc||"data:",h}function ka(h,w,p){(K||0)+200<Date.now()&&(h[la]=!0,K=Date.now());p||(h.currentTime=w);e[++tb%3]=100*w|0}function h(e){this.video.readyState>=this.video.HAVE_FUTURE_DATA?(this.hasAudio||(this.driver.currentTime=this.video.currentTime+e*this.video.playbackRate/1E3,this.video.loop&&
this.driver.currentTime>=this.video.duration&&(this.driver.currentTime=0)),ka(this.video,this.driver.currentTime)):this.video.networkState===this.video.NETWORK_IDLE&&0===this.video.buffered.length&&this.video.load();this.video.ended&&(delete this.video[la],this.video.pause(!0))}function Ta(){var e=this[ia];return this.webkitDisplayingFullscreen?void this[ub]():("data:"!==e.driver.src&&e.driver.src!==this.src&&(ka(this,0,!0),e.driver.src=this.src),void(this.paused&&(e.paused=!1,0===this.buffered.length&&
this.load(),e.driver.play(),e.updater.start(),e.hasAudio||(ra(this,"play"),e.video.readyState>=e.video.HAVE_ENOUGH_DATA&&ra(this,"playing")))))}function p(e){var h=this[ia];h.driver.pause();h.updater.stop();this.webkitDisplayingFullscreen&&this[Ba]();h.paused&&!e||(h.paused=!0,h.hasAudio||ra(this,"pause"),this.ended&&(this[la]=!0,ra(this,"ended")))}function X(p,E){var H=p[ia]={};H.paused=!0;H.hasAudio=E;H.video=p;H.updater=w(h.bind(H),requestAnimationFrame,cancelAnimationFrame);E?H.driver=Ka(p):(p.addEventListener("canplay",
function(){p.paused||ra(p,"playing")}),H.driver={src:p.src||p.currentSrc||"data:",muted:!0,paused:!0,pause:function(){H.driver.paused=!0},play:function(){H.driver.paused=!1;H.driver.currentTime>=H.video.duration&&ka(p,0)},get ended(){return H.driver.currentTime>=H.video.duration}});p.addEventListener("emptied",function(){var e=!H.driver.src||"data:"===H.driver.src;H.driver.src&&H.driver.src!==p.src&&(ka(p,0,!0),H.driver.src=p.src,e?H.driver.play():H.updater.stop())},!1);p.addEventListener("webkitbeginfullscreen",
function(){p.paused?E&&0===H.driver.buffered.length&&H.driver.load():(p.pause(),p[ub]())});E&&(p.addEventListener("webkitendfullscreen",function(){H.driver.currentTime=p.currentTime}),p.addEventListener("seeking",function(){0>e.indexOf(100*p.currentTime|0)&&(H.driver.currentTime=p.currentTime)}))}var K,pa="object"==typeof document&&"object-fit"in document.head.style&&!matchMedia("(-webkit-video-playable-inline)").matches,ia="bfred-it:iphone-inline-video",la="bfred-it:iphone-inline-video:event",ub=
"bfred-it:iphone-inline-video:nativeplay",Ba="bfred-it:iphone-inline-video:nativepause",e=[],tb=0;return function(e,h){if(void 0===h&&(h={}),!e[ia])if(h.everywhere||pa&&(h.iPad||h.ipad?/iPhone|iPod|iPad/:/iPhone|iPod/).test(navigator.userAgent))!e.paused&&e.webkitDisplayingFullscreen&&e.pause(),X(e,!e.muted),h=e[ia],e[ub]=e.play,e[Ba]=e.pause,e.play=Ta,e.pause=p,ba(e,"paused",h.driver),ba(e,"muted",h.driver,!0),ba(e,"playbackRate",h.driver,!0),ba(e,"ended",h.driver),ba(e,"loop",h.driver,!0),E(e,"seeking"),
E(e,"seeked"),E(e,"timeupdate",la,!1),E(e,"ended",la,!1),e.classList.add("IIV"),e.muted&&e.autoplay&&e.play(),/iPhone|iPod|iPad/.test(navigator.platform)||console.warn("iphone-inline-video is not guaranteed to work in emulated environments")}}();
(function(){function w(b,d,f){e.biginteger_used=1;null!=b&&("number"==typeof b&&"undefined"==typeof d?this.fromInt(b):"number"==typeof b?this.fromNumber(b,d,f):null==d&&"string"!=typeof b?this.fromString(b,256):this.fromString(b,d))}function E(){return new w(null,void 0,void 0)}function ba(b,d,f,q,e,h){for(;0<=--h;){var n=d*this[b++]+f[q]+e;e=Math.floor(n/67108864);f[q++]=n&67108863}return e}function Aa(b,d,f,q,e,h){var n=d&32767;for(d>>=15;0<=--h;){var O=this[b]&32767,w=this[b++]>>15,p=d*O+w*n;O=
n*O+((p&32767)<<15)+f[q]+(e&1073741823);e=(O>>>30)+(p>>>15)+d*w+(e>>>30);f[q++]=O&1073741823}return e}function ra(b,d,f,q,e,h){var n=d&16383;for(d>>=14;0<=--h;){var O=this[b]&16383,w=this[b++]>>14,p=d*O+w*n;O=n*O+((p&16383)<<14)+f[q]+e;e=(O>>28)+(p>>14)+d*w;f[q++]=O&268435455}return e}function Ka(b,d){b=gb[b.charCodeAt(d)];return null==b?-1:b}function ka(b){var d=E();d.fromInt(b);return d}function h(b){var d=1,f;0!=(f=b>>>16)&&(b=f,d+=16);0!=(f=b>>8)&&(b=f,d+=8);0!=(f=b>>4)&&(b=f,d+=4);0!=(f=b>>2)&&
(b=f,d+=2);0!=b>>1&&(d+=1);return d}function Ta(b){this.m=b}function p(b){this.m=b;this.mp=b.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<b.DB-15)-1;this.mt2=2*b.t}function X(b,d){return b&d}function K(b,d){return b|d}function pa(b,d){return b^d}function ia(b,d){return b&~d}function la(){}function ub(b){return b}function Ba(b){this.r2=E();this.q3=E();w.ONE.dlShiftTo(2*b.t,this.r2);this.mu=this.r2.divide(b);this.m=b}var e={use_lines:!0,use_xyz:!1},tb=!1;"undefined"!==typeof module&&
module.exports?(module.exports=e,tb=!0):"undefined"!==typeof document?window.ClipperLib=e:self.ClipperLib=e;if(tb){W="chrome";var H="Netscape"}else{var W=navigator.userAgent.toString().toLowerCase();H=navigator.appName}var ic=-1!=W.indexOf("chrome")&&-1==W.indexOf("chromium")?1:0;tb=-1!=W.indexOf("chromium")?1:0;var Sc=-1!=W.indexOf("safari")&&-1==W.indexOf("chrome")&&-1==W.indexOf("chromium")?1:0;var nb=-1!=W.indexOf("firefox")?1:0;W.indexOf("firefox/17");W.indexOf("firefox/15");W.indexOf("firefox/3");
var bb=-1!=W.indexOf("opera")?1:0;W.indexOf("msie 10");W.indexOf("msie 9");var ob=-1!=W.indexOf("msie 8")?1:0;var Tb=-1!=W.indexOf("msie 7")?1:0;W=-1!=W.indexOf("msie ")?1:0;e.biginteger_used=null;"Microsoft Internet Explorer"==H?(w.prototype.am=Aa,H=30):"Netscape"!=H?(w.prototype.am=ba,H=26):(w.prototype.am=ra,H=28);w.prototype.DB=H;w.prototype.DM=(1<<H)-1;w.prototype.DV=1<<H;w.prototype.FV=Math.pow(2,52);w.prototype.F1=52-H;w.prototype.F2=2*H-52;var gb=[],wa;H=48;for(wa=0;9>=wa;++wa)gb[H++]=wa;
H=97;for(wa=10;36>wa;++wa)gb[H++]=wa;H=65;for(wa=10;36>wa;++wa)gb[H++]=wa;Ta.prototype.convert=function(b){return 0>b.s||0<=b.compareTo(this.m)?b.mod(this.m):b};Ta.prototype.revert=function(b){return b};Ta.prototype.reduce=function(b){b.divRemTo(this.m,null,b)};Ta.prototype.mulTo=function(b,d,f){b.multiplyTo(d,f);this.reduce(f)};Ta.prototype.sqrTo=function(b,d){b.squareTo(d);this.reduce(d)};p.prototype.convert=function(b){var d=E();b.abs().dlShiftTo(this.m.t,d);d.divRemTo(this.m,null,d);0>b.s&&0<
d.compareTo(w.ZERO)&&this.m.subTo(d,d);return d};p.prototype.revert=function(b){var d=E();b.copyTo(d);this.reduce(d);return d};p.prototype.reduce=function(b){for(;b.t<=this.mt2;)b[b.t++]=0;for(var d=0;d<this.m.t;++d){var f=b[d]&32767,q=f*this.mpl+((f*this.mph+(b[d]>>15)*this.mpl&this.um)<<15)&b.DM;f=d+this.m.t;for(b[f]+=this.m.am(0,q,b,d,0,this.m.t);b[f]>=b.DV;)b[f]-=b.DV,b[++f]++}b.clamp();b.drShiftTo(this.m.t,b);0<=b.compareTo(this.m)&&b.subTo(this.m,b)};p.prototype.mulTo=function(b,d,f){b.multiplyTo(d,
f);this.reduce(f)};p.prototype.sqrTo=function(b,d){b.squareTo(d);this.reduce(d)};w.prototype.copyTo=function(b){for(var d=this.t-1;0<=d;--d)b[d]=this[d];b.t=this.t;b.s=this.s};w.prototype.fromInt=function(b){this.t=1;this.s=0>b?-1:0;0<b?this[0]=b:-1>b?this[0]=b+this.DV:this.t=0};w.prototype.fromString=function(b,d){if(16==d)d=4;else if(8==d)d=3;else if(256==d)d=8;else if(2==d)d=1;else if(32==d)d=5;else if(4==d)d=2;else{this.fromRadix(b,d);return}this.s=this.t=0;for(var f=b.length,q=!1,e=0;0<=--f;){var h=
8==d?b[f]&255:Ka(b,f);0>h?"-"==b.charAt(f)&&(q=!0):(q=!1,0==e?this[this.t++]=h:e+d>this.DB?(this[this.t-1]|=(h&(1<<this.DB-e)-1)<<e,this[this.t++]=h>>this.DB-e):this[this.t-1]|=h<<e,e+=d,e>=this.DB&&(e-=this.DB))}8==d&&0!=(b[0]&128)&&(this.s=-1,0<e&&(this[this.t-1]|=(1<<this.DB-e)-1<<e));this.clamp();q&&w.ZERO.subTo(this,this)};w.prototype.clamp=function(){for(var b=this.s&this.DM;0<this.t&&this[this.t-1]==b;)--this.t};w.prototype.dlShiftTo=function(b,d){var f;for(f=this.t-1;0<=f;--f)d[f+b]=this[f];
for(f=b-1;0<=f;--f)d[f]=0;d.t=this.t+b;d.s=this.s};w.prototype.drShiftTo=function(b,d){for(var f=b;f<this.t;++f)d[f-b]=this[f];d.t=Math.max(this.t-b,0);d.s=this.s};w.prototype.lShiftTo=function(b,d){var f=b%this.DB,e=this.DB-f,n=(1<<e)-1;b=Math.floor(b/this.DB);var h=this.s<<f&this.DM,v;for(v=this.t-1;0<=v;--v)d[v+b+1]=this[v]>>e|h,h=(this[v]&n)<<f;for(v=b-1;0<=v;--v)d[v]=0;d[b]=h;d.t=this.t+b+1;d.s=this.s;d.clamp()};w.prototype.rShiftTo=function(b,d){d.s=this.s;var f=Math.floor(b/this.DB);if(f>=
this.t)d.t=0;else{b%=this.DB;var e=this.DB-b,n=(1<<b)-1;d[0]=this[f]>>b;for(var h=f+1;h<this.t;++h)d[h-f-1]|=(this[h]&n)<<e,d[h-f]=this[h]>>b;0<b&&(d[this.t-f-1]|=(this.s&n)<<e);d.t=this.t-f;d.clamp()}};w.prototype.subTo=function(b,d){for(var f=0,e=0,n=Math.min(b.t,this.t);f<n;)e+=this[f]-b[f],d[f++]=e&this.DM,e>>=this.DB;if(b.t<this.t){for(e-=b.s;f<this.t;)e+=this[f],d[f++]=e&this.DM,e>>=this.DB;e+=this.s}else{for(e+=this.s;f<b.t;)e-=b[f],d[f++]=e&this.DM,e>>=this.DB;e-=b.s}d.s=0>e?-1:0;-1>e?d[f++]=
this.DV+e:0<e&&(d[f++]=e);d.t=f;d.clamp()};w.prototype.multiplyTo=function(b,d){var f=this.abs(),e=b.abs(),n=f.t;for(d.t=n+e.t;0<=--n;)d[n]=0;for(n=0;n<e.t;++n)d[n+f.t]=f.am(0,e[n],d,n,0,f.t);d.s=0;d.clamp();this.s!=b.s&&w.ZERO.subTo(d,d)};w.prototype.squareTo=function(b){for(var d=this.abs(),f=b.t=2*d.t;0<=--f;)b[f]=0;for(f=0;f<d.t-1;++f){var e=d.am(f,d[f],b,2*f,0,1);(b[f+d.t]+=d.am(f+1,2*d[f],b,2*f+1,e,d.t-f-1))>=d.DV&&(b[f+d.t]-=d.DV,b[f+d.t+1]=1)}0<b.t&&(b[b.t-1]+=d.am(f,d[f],b,2*f,0,1));b.s=
0;b.clamp()};w.prototype.divRemTo=function(b,d,f){var e=b.abs();if(!(0>=e.t)){var n=this.abs();if(n.t<e.t)null!=d&&d.fromInt(0),null!=f&&this.copyTo(f);else{null==f&&(f=E());var O=E(),v=this.s;b=b.s;var p=this.DB-h(e[e.t-1]);0<p?(e.lShiftTo(p,O),n.lShiftTo(p,f)):(e.copyTo(O),n.copyTo(f));e=O.t;n=O[e-1];if(0!=n){var U=n*(1<<this.F1)+(1<e?O[e-2]>>this.F2:0),H=this.FV/U;U=(1<<this.F1)/U;var vb=1<<this.F2,I=f.t,X=I-e,K=null==d?E():d;O.dlShiftTo(X,K);0<=f.compareTo(K)&&(f[f.t++]=1,f.subTo(K,f));w.ONE.dlShiftTo(e,
K);for(K.subTo(O,O);O.t<e;)O[O.t++]=0;for(;0<=--X;){var ia=f[--I]==n?this.DM:Math.floor(f[I]*H+(f[I-1]+vb)*U);if((f[I]+=O.am(0,ia,f,X,0,e))<ia)for(O.dlShiftTo(X,K),f.subTo(K,f);f[I]<--ia;)f.subTo(K,f)}null!=d&&(f.drShiftTo(e,d),v!=b&&w.ZERO.subTo(d,d));f.t=e;f.clamp();0<p&&f.rShiftTo(p,f);0>v&&w.ZERO.subTo(f,f)}}}};w.prototype.invDigit=function(){if(1>this.t)return 0;var b=this[0];if(0==(b&1))return 0;var d=b&3;d=d*(2-(b&15)*d)&15;d=d*(2-(b&255)*d)&255;d=d*(2-((b&65535)*d&65535))&65535;d=d*(2-b*d%
this.DV)%this.DV;return 0<d?this.DV-d:-d};w.prototype.isEven=function(){return 0==(0<this.t?this[0]&1:this.s)};w.prototype.exp=function(b,d){if(4294967295<b||1>b)return w.ONE;var f=E(),e=E(),n=d.convert(this),O=h(b)-1;for(n.copyTo(f);0<=--O;)if(d.sqrTo(f,e),0<(b&1<<O))d.mulTo(e,n,f);else{var v=f;f=e;e=v}return d.revert(f)};w.prototype.toString=function(b){if(0>this.s)return"-"+this.negate().toString(b);if(16==b)b=4;else if(8==b)b=3;else if(2==b)b=1;else if(32==b)b=5;else if(4==b)b=2;else return this.toRadix(b);
var d=(1<<b)-1,f,e=!1,n="",h=this.t,v=this.DB-h*this.DB%b;if(0<h--)for(v<this.DB&&0<(f=this[h]>>v)&&(e=!0,n="0123456789abcdefghijklmnopqrstuvwxyz".charAt(f));0<=h;)v<b?(f=(this[h]&(1<<v)-1)<<b-v,f|=this[--h]>>(v+=this.DB-b)):(f=this[h]>>(v-=b)&d,0>=v&&(v+=this.DB,--h)),0<f&&(e=!0),e&&(n+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(f));return e?n:"0"};w.prototype.negate=function(){var b=E();w.ZERO.subTo(this,b);return b};w.prototype.abs=function(){return 0>this.s?this.negate():this};w.prototype.compareTo=
function(b){var d=this.s-b.s;if(0!=d)return d;var f=this.t;d=f-b.t;if(0!=d)return 0>this.s?-d:d;for(;0<=--f;)if(0!=(d=this[f]-b[f]))return d;return 0};w.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+h(this[this.t-1]^this.s&this.DM)};w.prototype.mod=function(b){var d=E();this.abs().divRemTo(b,null,d);0>this.s&&0<d.compareTo(w.ZERO)&&b.subTo(d,d);return d};w.prototype.modPowInt=function(b,d){d=256>b||d.isEven()?new Ta(d):new p(d);return this.exp(b,d)};w.ZERO=ka(0);w.ONE=ka(1);
la.prototype.convert=ub;la.prototype.revert=ub;la.prototype.mulTo=function(b,d,f){b.multiplyTo(d,f)};la.prototype.sqrTo=function(b,d){b.squareTo(d)};Ba.prototype.convert=function(b){if(0>b.s||b.t>2*this.m.t)return b.mod(this.m);if(0>b.compareTo(this.m))return b;var d=E();b.copyTo(d);this.reduce(d);return d};Ba.prototype.revert=function(b){return b};Ba.prototype.reduce=function(b){b.drShiftTo(this.m.t-1,this.r2);b.t>this.m.t+1&&(b.t=this.m.t+1,b.clamp());this.mu.multiplyUpperTo(this.r2,this.m.t+1,
this.q3);for(this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);0>b.compareTo(this.r2);)b.dAddOffset(1,this.m.t+1);for(b.subTo(this.r2,b);0<=b.compareTo(this.m);)b.subTo(this.m,b)};Ba.prototype.mulTo=function(b,d,f){b.multiplyTo(d,f);this.reduce(f)};Ba.prototype.sqrTo=function(b,d){b.squareTo(d);this.reduce(d)};var I=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,
251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],lc=67108864/I[I.length-1];w.prototype.chunkSize=
function(b){return Math.floor(Math.LN2*this.DB/Math.log(b))};w.prototype.toRadix=function(b){null==b&&(b=10);if(0==this.signum()||2>b||36<b)return"0";var d=this.chunkSize(b);d=Math.pow(b,d);var f=ka(d),e=E(),n=E(),h="";for(this.divRemTo(f,e,n);0<e.signum();)h=(d+n.intValue()).toString(b).substr(1)+h,e.divRemTo(f,e,n);return n.intValue().toString(b)+h};w.prototype.fromRadix=function(b,d){this.fromInt(0);null==d&&(d=10);for(var f=this.chunkSize(d),e=Math.pow(d,f),n=!1,h=0,v=0,p=0;p<b.length;++p){var U=
Ka(b,p);0>U?"-"==b.charAt(p)&&0==this.signum()&&(n=!0):(v=d*v+U,++h>=f&&(this.dMultiply(e),this.dAddOffset(v,0),v=h=0))}0<h&&(this.dMultiply(Math.pow(d,h)),this.dAddOffset(v,0));n&&w.ZERO.subTo(this,this)};w.prototype.fromNumber=function(b,d,f){if("number"==typeof d)if(2>b)this.fromInt(1);else for(this.fromNumber(b,f),this.testBit(b-1)||this.bitwiseTo(w.ONE.shiftLeft(b-1),K,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(d);)this.dAddOffset(2,0),this.bitLength()>b&&this.subTo(w.ONE.shiftLeft(b-
1),this);else{f=[];var e=b&7;f.length=(b>>3)+1;d.nextBytes(f);f[0]=0<e?f[0]&(1<<e)-1:0;this.fromString(f,256)}};w.prototype.bitwiseTo=function(b,d,f){var e,n=Math.min(b.t,this.t);for(e=0;e<n;++e)f[e]=d(this[e],b[e]);if(b.t<this.t){var h=b.s&this.DM;for(e=n;e<this.t;++e)f[e]=d(this[e],h);f.t=this.t}else{h=this.s&this.DM;for(e=n;e<b.t;++e)f[e]=d(h,b[e]);f.t=b.t}f.s=d(this.s,b.s);f.clamp()};w.prototype.changeBit=function(b,d){b=w.ONE.shiftLeft(b);this.bitwiseTo(b,d,b);return b};w.prototype.addTo=function(b,
d){for(var f=0,e=0,n=Math.min(b.t,this.t);f<n;)e+=this[f]+b[f],d[f++]=e&this.DM,e>>=this.DB;if(b.t<this.t){for(e+=b.s;f<this.t;)e+=this[f],d[f++]=e&this.DM,e>>=this.DB;e+=this.s}else{for(e+=this.s;f<b.t;)e+=b[f],d[f++]=e&this.DM,e>>=this.DB;e+=b.s}d.s=0>e?-1:0;0<e?d[f++]=e:-1>e&&(d[f++]=this.DV+e);d.t=f;d.clamp()};w.prototype.dMultiply=function(b){this[this.t]=this.am(0,b-1,this,0,0,this.t);++this.t;this.clamp()};w.prototype.dAddOffset=function(b,d){if(0!=b){for(;this.t<=d;)this[this.t++]=0;for(this[d]+=
b;this[d]>=this.DV;)this[d]-=this.DV,++d>=this.t&&(this[this.t++]=0),++this[d]}};w.prototype.multiplyLowerTo=function(b,d,f){var e=Math.min(this.t+b.t,d);f.s=0;for(f.t=e;0<e;)f[--e]=0;var n;for(n=f.t-this.t;e<n;++e)f[e+this.t]=this.am(0,b[e],f,e,0,this.t);for(n=Math.min(b.t,d);e<n;++e)this.am(0,b[e],f,e,0,d-e);f.clamp()};w.prototype.multiplyUpperTo=function(b,d,f){--d;var e=f.t=this.t+b.t-d;for(f.s=0;0<=--e;)f[e]=0;for(e=Math.max(d-this.t,0);e<b.t;++e)f[this.t+e-d]=this.am(d-e,b[e],f,0,0,this.t+e-
d);f.clamp();f.drShiftTo(1,f)};w.prototype.modInt=function(b){if(0>=b)return 0;var d=this.DV%b,f=0>this.s?b-1:0;if(0<this.t)if(0==d)f=this[0]%b;else for(var e=this.t-1;0<=e;--e)f=(d*f+this[e])%b;return f};w.prototype.millerRabin=function(b){var d=this.subtract(w.ONE),f=d.getLowestSetBit();if(0>=f)return!1;var e=d.shiftRight(f);b=b+1>>1;b>I.length&&(b=I.length);for(var n=E(),h=0;h<b;++h){n.fromInt(I[Math.floor(Math.random()*I.length)]);var v=n.modPow(e,this);if(0!=v.compareTo(w.ONE)&&0!=v.compareTo(d)){for(var p=
1;p++<f&&0!=v.compareTo(d);)if(v=v.modPowInt(2,this),0==v.compareTo(w.ONE))return!1;if(0!=v.compareTo(d))return!1}}return!0};w.prototype.clone=function(){var b=E();this.copyTo(b);return b};w.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]};w.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24};w.prototype.shortValue=function(){return 0==
this.t?this.s:this[0]<<16>>16};w.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this[0]?0:1};w.prototype.toByteArray=function(){var b=this.t,d=[];d[0]=this.s;var f=this.DB-b*this.DB%8,e,n=0;if(0<b--)for(f<this.DB&&(e=this[b]>>f)!=(this.s&this.DM)>>f&&(d[n++]=e|this.s<<this.DB-f);0<=b;)if(8>f?(e=(this[b]&(1<<f)-1)<<8-f,e|=this[--b]>>(f+=this.DB-8)):(e=this[b]>>(f-=8)&255,0>=f&&(f+=this.DB,--b)),0!=(e&128)&&(e|=-256),0==n&&(this.s&128)!=(e&128)&&++n,0<n||e!=this.s)d[n++]=e;
return d};w.prototype.equals=function(b){return 0==this.compareTo(b)};w.prototype.min=function(b){return 0>this.compareTo(b)?this:b};w.prototype.max=function(b){return 0<this.compareTo(b)?this:b};w.prototype.and=function(b){var d=E();this.bitwiseTo(b,X,d);return d};w.prototype.or=function(b){var d=E();this.bitwiseTo(b,K,d);return d};w.prototype.xor=function(b){var d=E();this.bitwiseTo(b,pa,d);return d};w.prototype.andNot=function(b){var d=E();this.bitwiseTo(b,ia,d);return d};w.prototype.not=function(){for(var b=
E(),d=0;d<this.t;++d)b[d]=this.DM&~this[d];b.t=this.t;b.s=~this.s;return b};w.prototype.shiftLeft=function(b){var d=E();0>b?this.rShiftTo(-b,d):this.lShiftTo(b,d);return d};w.prototype.shiftRight=function(b){var d=E();0>b?this.lShiftTo(-b,d):this.rShiftTo(b,d);return d};w.prototype.getLowestSetBit=function(){for(var b=0;b<this.t;++b)if(0!=this[b]){var d=b*this.DB;b=this[b];if(0==b)b=-1;else{var f=0;0==(b&65535)&&(b>>=16,f+=16);0==(b&255)&&(b>>=8,f+=8);0==(b&15)&&(b>>=4,f+=4);0==(b&3)&&(b>>=2,f+=2);
0==(b&1)&&++f;b=f}return d+b}return 0>this.s?this.t*this.DB:-1};w.prototype.bitCount=function(){for(var b=0,d=this.s&this.DM,f=0;f<this.t;++f){for(var e=this[f]^d,n=0;0!=e;)e&=e-1,++n;b+=n}return b};w.prototype.testBit=function(b){var d=Math.floor(b/this.DB);return d>=this.t?0!=this.s:0!=(this[d]&1<<b%this.DB)};w.prototype.setBit=function(b){return this.changeBit(b,K)};w.prototype.clearBit=function(b){return this.changeBit(b,ia)};w.prototype.flipBit=function(b){return this.changeBit(b,pa)};w.prototype.add=
function(b){var d=E();this.addTo(b,d);return d};w.prototype.subtract=function(b){var d=E();this.subTo(b,d);return d};w.prototype.multiply=function(b){var d=E();this.multiplyTo(b,d);return d};w.prototype.divide=function(b){var d=E();this.divRemTo(b,d,null);return d};w.prototype.remainder=function(b){var d=E();this.divRemTo(b,null,d);return d};w.prototype.divideAndRemainder=function(b){var d=E(),f=E();this.divRemTo(b,d,f);return[d,f]};w.prototype.modPow=function(b,d){var f=b.bitLength(),e=ka(1);if(0>=
f)return e;var n=18>f?1:48>f?3:144>f?4:768>f?5:6;d=8>f?new Ta(d):d.isEven()?new Ba(d):new p(d);var O=[],v=3,w=n-1,U=(1<<n)-1;O[1]=d.convert(this);if(1<n)for(f=E(),d.sqrTo(O[1],f);v<=U;)O[v]=E(),d.mulTo(f,O[v-2],O[v]),v+=2;var H=b.t-1,I,X=!0,K=E();for(f=h(b[H])-1;0<=H;){f>=w?I=b[H]>>f-w&U:(I=(b[H]&(1<<f+1)-1)<<w-f,0<H&&(I|=b[H-1]>>this.DB+f-w));for(v=n;0==(I&1);)I>>=1,--v;0>(f-=v)&&(f+=this.DB,--H);if(X)O[I].copyTo(e),X=!1;else{for(;1<v;)d.sqrTo(e,K),d.sqrTo(K,e),v-=2;0<v?d.sqrTo(e,K):(v=e,e=K,K=v);
d.mulTo(K,O[I],e)}for(;0<=H&&0==(b[H]&1<<f);)d.sqrTo(e,K),v=e,e=K,K=v,0>--f&&(f=this.DB-1,--H)}return d.revert(e)};w.prototype.modInverse=function(b){var d=b.isEven();if(this.isEven()&&d||0==b.signum())return w.ZERO;for(var f=b.clone(),e=this.clone(),n=ka(1),h=ka(0),v=ka(0),p=ka(1);0!=f.signum();){for(;f.isEven();)f.rShiftTo(1,f),d?(n.isEven()&&h.isEven()||(n.addTo(this,n),h.subTo(b,h)),n.rShiftTo(1,n)):h.isEven()||h.subTo(b,h),h.rShiftTo(1,h);for(;e.isEven();)e.rShiftTo(1,e),d?(v.isEven()&&p.isEven()||
(v.addTo(this,v),p.subTo(b,p)),v.rShiftTo(1,v)):p.isEven()||p.subTo(b,p),p.rShiftTo(1,p);0<=f.compareTo(e)?(f.subTo(e,f),d&&n.subTo(v,n),h.subTo(p,h)):(e.subTo(f,e),d&&v.subTo(n,v),p.subTo(h,p))}if(0!=e.compareTo(w.ONE))return w.ZERO;if(0<=p.compareTo(b))return p.subtract(b);if(0>p.signum())p.addTo(b,p);else return p;return 0>p.signum()?p.add(b):p};w.prototype.pow=function(b){return this.exp(b,new la)};w.prototype.gcd=function(b){var d=0>this.s?this.negate():this.clone();b=0>b.s?b.negate():b.clone();
if(0>d.compareTo(b)){var f=d;d=b;b=f}f=d.getLowestSetBit();var e=b.getLowestSetBit();if(0>e)return d;f<e&&(e=f);for(0<e&&(d.rShiftTo(e,d),b.rShiftTo(e,b));0<d.signum();)0<(f=d.getLowestSetBit())&&d.rShiftTo(f,d),0<(f=b.getLowestSetBit())&&b.rShiftTo(f,b),0<=d.compareTo(b)?(d.subTo(b,d),d.rShiftTo(1,d)):(b.subTo(d,b),b.rShiftTo(1,b));0<e&&b.lShiftTo(e,b);return b};w.prototype.isProbablePrime=function(b){var d,f=this.abs();if(1==f.t&&f[0]<=I[I.length-1]){for(d=0;d<I.length;++d)if(f[0]==I[d])return!0;
return!1}if(f.isEven())return!1;for(d=1;d<I.length;){for(var e=I[d],n=d+1;n<I.length&&e<lc;)e*=I[n++];for(e=f.modInt(e);d<n;)if(0==e%I[d++])return!1}return f.millerRabin(b)};w.prototype.square=function(){var b=E();this.squareTo(b);return b};w.prototype.IsNegative=function(){return-1==this.compareTo(w.ZERO)?!0:!1};w.op_Equality=function(b,d){return 0==b.compareTo(d)?!0:!1};w.op_Inequality=function(b,d){return 0!=b.compareTo(d)?!0:!1};w.op_GreaterThan=function(b,d){return 0<b.compareTo(d)?!0:!1};w.op_LessThan=
function(b,d){return 0>b.compareTo(d)?!0:!1};w.op_Addition=function(b,d){return(new w(b)).add(new w(d))};w.op_Subtraction=function(b,d){return(new w(b)).subtract(new w(d))};w.Int128Mul=function(b,d){return(new w(b)).multiply(new w(d))};w.op_Division=function(b,d){return b.divide(d)};w.prototype.ToDouble=function(){return parseFloat(this.toString())};H=function(b,d){var f;if("undefined"==typeof Object.getOwnPropertyNames)for(f in d.prototype){if("undefined"==typeof b.prototype[f]||b.prototype[f]==
Object.prototype[f])b.prototype[f]=d.prototype[f]}else for(var e=Object.getOwnPropertyNames(d.prototype),n=0;n<e.length;n++)"undefined"==typeof Object.getOwnPropertyDescriptor(b.prototype,e[n])&&Object.defineProperty(b.prototype,e[n],Object.getOwnPropertyDescriptor(d.prototype,e[n]));for(f in d)"undefined"==typeof b[f]&&(b[f]=d[f]);b.$baseCtor=d};e.Path=function(){return[]};e.Paths=function(){return[]};e.DoublePoint=function(){var b=arguments;this.Y=this.X=0;1==b.length?(this.X=b[0].X,this.Y=b[0].Y):
2==b.length&&(this.X=b[0],this.Y=b[1])};e.DoublePoint0=function(){this.Y=this.X=0};e.DoublePoint1=function(b){this.X=b.X;this.Y=b.Y};e.DoublePoint2=function(b,d){this.X=b;this.Y=d};e.PolyNode=function(){this.m_Parent=null;this.m_polygon=new e.Path;this.m_endtype=this.m_jointype=this.m_Index=0;this.m_Childs=[];this.IsOpen=!1};e.PolyNode.prototype.IsHoleNode=function(){for(var b=!0,d=this.m_Parent;null!==d;)b=!b,d=d.m_Parent;return b};e.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length};
e.PolyNode.prototype.Contour=function(){return this.m_polygon};e.PolyNode.prototype.AddChild=function(b){var d=this.m_Childs.length;this.m_Childs.push(b);b.m_Parent=this;b.m_Index=d};e.PolyNode.prototype.GetNext=function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()};e.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]};e.PolyNode.prototype.Childs=
function(){return this.m_Childs};e.PolyNode.prototype.Parent=function(){return this.m_Parent};e.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()};e.PolyTree=function(){this.m_AllPolys=[];e.PolyNode.call(this)};e.PolyTree.prototype.Clear=function(){for(var b=0,d=this.m_AllPolys.length;b<d;b++)this.m_AllPolys[b]=null;this.m_AllPolys.length=0;this.m_Childs.length=0};e.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null};e.PolyTree.prototype.Total=function(){var b=
this.m_AllPolys.length;0<b&&this.m_Childs[0]!=this.m_AllPolys[0]&&b--;return b};H(e.PolyTree,e.PolyNode);e.Math_Abs_Int64=e.Math_Abs_Int32=e.Math_Abs_Double=function(b){return Math.abs(b)};e.Math_Max_Int32_Int32=function(b,d){return Math.max(b,d)};e.Cast_Int32=W||bb||Sc?function(b){return b|0}:function(b){return~~b};e.Cast_Int64=ic?function(b){return-2147483648>b||2147483647<b?0>b?Math.ceil(b):Math.floor(b):~~b}:nb&&"function"==typeof Number.toInteger?function(b){return Number.toInteger(b)}:Tb||ob?
function(b){return parseInt(b,10)}:W?function(b){return-2147483648>b||2147483647<b?0>b?Math.ceil(b):Math.floor(b):b|0}:function(b){return 0>b?Math.ceil(b):Math.floor(b)};e.Clear=function(b){b.length=0};e.PI=3.141592653589793;e.PI2=6.283185307179586;e.IntPoint=function(){var b=arguments,d=b.length;this.Y=this.X=0;e.use_xyz?(this.Z=0,3==d?(this.X=b[0],this.Y=b[1],this.Z=b[2]):2==d?(this.X=b[0],this.Y=b[1],this.Z=0):1==d?b[0]instanceof e.DoublePoint?(b=b[0],this.X=e.Clipper.Round(b.X),this.Y=e.Clipper.Round(b.Y),
this.Z=0):(b=b[0],"undefined"==typeof b.Z&&(b.Z=0),this.X=b.X,this.Y=b.Y,this.Z=b.Z):this.Z=this.Y=this.X=0):2==d?(this.X=b[0],this.Y=b[1]):1==d?b[0]instanceof e.DoublePoint?(b=b[0],this.X=e.Clipper.Round(b.X),this.Y=e.Clipper.Round(b.Y)):(b=b[0],this.X=b.X,this.Y=b.Y):this.Y=this.X=0};e.IntPoint.op_Equality=function(b,d){return b.X==d.X&&b.Y==d.Y};e.IntPoint.op_Inequality=function(b,d){return b.X!=d.X||b.Y!=d.Y};e.use_xyz?(e.IntPoint0=function(){this.Z=this.Y=this.X=0},e.IntPoint1=function(b){this.X=
b.X;this.Y=b.Y;this.Z=b.Z},e.IntPoint1dp=function(b){this.X=e.Clipper.Round(b.X);this.Y=e.Clipper.Round(b.Y);this.Z=0},e.IntPoint2=function(b,d){this.X=b;this.Y=d;this.Z=0},e.IntPoint3=function(b,d,f){this.X=b;this.Y=d;this.Z=f}):(e.IntPoint0=function(){this.Y=this.X=0},e.IntPoint1=function(b){this.X=b.X;this.Y=b.Y},e.IntPoint1dp=function(b){this.X=e.Clipper.Round(b.X);this.Y=e.Clipper.Round(b.Y)},e.IntPoint2=function(b,d){this.X=b;this.Y=d});e.IntRect=function(){var b=arguments,d=b.length;4==d?(this.left=
b[0],this.top=b[1],this.right=b[2],this.bottom=b[3]):1==d?(this.left=b[0].left,this.top=b[0].top,this.right=b[0].right,this.bottom=b[0].bottom):this.bottom=this.right=this.top=this.left=0};e.IntRect0=function(){this.bottom=this.right=this.top=this.left=0};e.IntRect1=function(b){this.left=b.left;this.top=b.top;this.right=b.right;this.bottom=b.bottom};e.IntRect4=function(b,d,f,e){this.left=b;this.top=d;this.right=f;this.bottom=e};e.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3};e.PolyType=
{ptSubject:0,ptClip:1};e.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3};e.JoinType={jtSquare:0,jtRound:1,jtMiter:2};e.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4};e.EdgeSide={esLeft:0,esRight:1};e.Direction={dRightToLeft:0,dLeftToRight:1};e.TEdge=function(){this.Bot=new e.IntPoint;this.Curr=new e.IntPoint;this.Top=new e.IntPoint;this.Delta=new e.IntPoint;this.Dx=0;this.PolyTyp=e.PolyType.ptSubject;this.Side=e.EdgeSide.esLeft;this.OutIdx=
this.WindCnt2=this.WindCnt=this.WindDelta=0;this.PrevInSEL=this.NextInSEL=this.PrevInAEL=this.NextInAEL=this.NextInLML=this.Prev=this.Next=null};e.IntersectNode=function(){this.Edge2=this.Edge1=null;this.Pt=new e.IntPoint};e.MyIntersectNodeSort=function(){};e.MyIntersectNodeSort.Compare=function(b,d){b=d.Pt.Y-b.Pt.Y;return 0<b?1:0>b?-1:0};e.LocalMinima=function(){this.Y=0;this.Next=this.RightBound=this.LeftBound=null};e.Scanbeam=function(){this.Y=0;this.Next=null};e.OutRec=function(){this.Idx=0;this.IsOpen=
this.IsHole=!1;this.PolyNode=this.BottomPt=this.Pts=this.FirstLeft=null};e.OutPt=function(){this.Idx=0;this.Pt=new e.IntPoint;this.Prev=this.Next=null};e.Join=function(){this.OutPt2=this.OutPt1=null;this.OffPt=new e.IntPoint};e.ClipperBase=function(){this.m_CurrentLM=this.m_MinimaList=null;this.m_edges=[];this.PreserveCollinear=this.m_HasOpenPaths=this.m_UseFullRange=!1;this.m_CurrentLM=this.m_MinimaList=null;this.m_HasOpenPaths=this.m_UseFullRange=!1};e.ClipperBase.horizontal=-9007199254740992;e.ClipperBase.Skip=
-2;e.ClipperBase.Unassigned=-1;e.ClipperBase.tolerance=1E-20;e.ClipperBase.loRange=47453132;e.ClipperBase.hiRange=0xfffffffffffff;e.ClipperBase.near_zero=function(b){return b>-e.ClipperBase.tolerance&&b<e.ClipperBase.tolerance};e.ClipperBase.IsHorizontal=function(b){return 0===b.Delta.Y};e.ClipperBase.prototype.PointIsVertex=function(b,d){var f=d;do{if(e.IntPoint.op_Equality(f.Pt,b))return!0;f=f.Next}while(f!=d);return!1};e.ClipperBase.prototype.PointOnLineSegment=function(b,d,f,e){return e?b.X==
d.X&&b.Y==d.Y||b.X==f.X&&b.Y==f.Y||b.X>d.X==b.X<f.X&&b.Y>d.Y==b.Y<f.Y&&w.op_Equality(w.Int128Mul(b.X-d.X,f.Y-d.Y),w.Int128Mul(f.X-d.X,b.Y-d.Y)):b.X==d.X&&b.Y==d.Y||b.X==f.X&&b.Y==f.Y||b.X>d.X==b.X<f.X&&b.Y>d.Y==b.Y<f.Y&&(b.X-d.X)*(f.Y-d.Y)==(f.X-d.X)*(b.Y-d.Y)};e.ClipperBase.prototype.PointOnPolygon=function(b,d,f){for(var e=d;;){if(this.PointOnLineSegment(b,e.Pt,e.Next.Pt,f))return!0;e=e.Next;if(e==d)break}return!1};e.ClipperBase.prototype.SlopesEqual=e.ClipperBase.SlopesEqual=function(){var b=arguments,
d=b.length,f,q;if(3==d)return d=b[0],f=b[1],b[2]?w.op_Equality(w.Int128Mul(d.Delta.Y,f.Delta.X),w.Int128Mul(d.Delta.X,f.Delta.Y)):e.Cast_Int64(d.Delta.Y*f.Delta.X)==e.Cast_Int64(d.Delta.X*f.Delta.Y);if(4==d)return d=b[0],f=b[1],q=b[2],b[3]?w.op_Equality(w.Int128Mul(d.Y-f.Y,f.X-q.X),w.Int128Mul(d.X-f.X,f.Y-q.Y)):0===e.Cast_Int64((d.Y-f.Y)*(f.X-q.X))-e.Cast_Int64((d.X-f.X)*(f.Y-q.Y));d=b[0];f=b[1];q=b[2];var n=b[3];return b[4]?w.op_Equality(w.Int128Mul(d.Y-f.Y,q.X-n.X),w.Int128Mul(d.X-f.X,q.Y-n.Y)):
0===e.Cast_Int64((d.Y-f.Y)*(q.X-n.X))-e.Cast_Int64((d.X-f.X)*(q.Y-n.Y))};e.ClipperBase.SlopesEqual3=function(b,d,f){return f?w.op_Equality(w.Int128Mul(b.Delta.Y,d.Delta.X),w.Int128Mul(b.Delta.X,d.Delta.Y)):e.Cast_Int64(b.Delta.Y*d.Delta.X)==e.Cast_Int64(b.Delta.X*d.Delta.Y)};e.ClipperBase.SlopesEqual4=function(b,d,f,q){return q?w.op_Equality(w.Int128Mul(b.Y-d.Y,d.X-f.X),w.Int128Mul(b.X-d.X,d.Y-f.Y)):0===e.Cast_Int64((b.Y-d.Y)*(d.X-f.X))-e.Cast_Int64((b.X-d.X)*(d.Y-f.Y))};e.ClipperBase.SlopesEqual5=
function(b,d,f,q,n){return n?w.op_Equality(w.Int128Mul(b.Y-d.Y,f.X-q.X),w.Int128Mul(b.X-d.X,f.Y-q.Y)):0===e.Cast_Int64((b.Y-d.Y)*(f.X-q.X))-e.Cast_Int64((b.X-d.X)*(f.Y-q.Y))};e.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var b=0,d=this.m_edges.length;b<d;++b){for(var f=0,q=this.m_edges[b].length;f<q;++f)this.m_edges[b][f]=null;e.Clear(this.m_edges[b])}e.Clear(this.m_edges);this.m_HasOpenPaths=this.m_UseFullRange=!1};e.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==
this.m_MinimaList;){var b=this.m_MinimaList.Next;this.m_MinimaList=null;this.m_MinimaList=b}this.m_CurrentLM=null};e.ClipperBase.prototype.RangeTest=function(b,d){if(d.Value)(b.X>e.ClipperBase.hiRange||b.Y>e.ClipperBase.hiRange||-b.X>e.ClipperBase.hiRange||-b.Y>e.ClipperBase.hiRange)&&e.Error("Coordinate outside allowed range in RangeTest().");else if(b.X>e.ClipperBase.loRange||b.Y>e.ClipperBase.loRange||-b.X>e.ClipperBase.loRange||-b.Y>e.ClipperBase.loRange)d.Value=!0,this.RangeTest(b,d)};e.ClipperBase.prototype.InitEdge=
function(b,d,f,q){b.Next=d;b.Prev=f;b.Curr.X=q.X;b.Curr.Y=q.Y;e.use_xyz&&(b.Curr.Z=q.Z);b.OutIdx=-1};e.ClipperBase.prototype.InitEdge2=function(b,d){b.Curr.Y>=b.Next.Curr.Y?(b.Bot.X=b.Curr.X,b.Bot.Y=b.Curr.Y,e.use_xyz&&(b.Bot.Z=b.Curr.Z),b.Top.X=b.Next.Curr.X,b.Top.Y=b.Next.Curr.Y,e.use_xyz&&(b.Top.Z=b.Next.Curr.Z)):(b.Top.X=b.Curr.X,b.Top.Y=b.Curr.Y,e.use_xyz&&(b.Top.Z=b.Curr.Z),b.Bot.X=b.Next.Curr.X,b.Bot.Y=b.Next.Curr.Y,e.use_xyz&&(b.Bot.Z=b.Next.Curr.Z));this.SetDx(b);b.PolyTyp=d};e.ClipperBase.prototype.FindNextLocMin=
function(b){for(var d;;){for(;e.IntPoint.op_Inequality(b.Bot,b.Prev.Bot)||e.IntPoint.op_Equality(b.Curr,b.Top);)b=b.Next;if(b.Dx!=e.ClipperBase.horizontal&&b.Prev.Dx!=e.ClipperBase.horizontal)break;for(;b.Prev.Dx==e.ClipperBase.horizontal;)b=b.Prev;for(d=b;b.Dx==e.ClipperBase.horizontal;)b=b.Next;if(b.Top.Y!=b.Prev.Bot.Y){d.Prev.Bot.X<b.Bot.X&&(b=d);break}}return b};e.ClipperBase.prototype.ProcessBound=function(b,d){var f,q=b,n;if(q.OutIdx==e.ClipperBase.Skip){b=q;if(d){for(;b.Top.Y==b.Next.Bot.Y;)b=
b.Next;for(;b!=q&&b.Dx==e.ClipperBase.horizontal;)b=b.Prev}else{for(;b.Top.Y==b.Prev.Bot.Y;)b=b.Prev;for(;b!=q&&b.Dx==e.ClipperBase.horizontal;)b=b.Next}b==q?q=d?b.Next:b.Prev:(b=d?q.Next:q.Prev,f=new e.LocalMinima,f.Next=null,f.Y=b.Bot.Y,f.LeftBound=null,f.RightBound=b,b.WindDelta=0,q=this.ProcessBound(b,d),this.InsertLocalMinima(f));return q}b.Dx==e.ClipperBase.horizontal&&(f=d?b.Prev:b.Next,f.OutIdx!=e.ClipperBase.Skip&&(f.Dx==e.ClipperBase.horizontal?f.Bot.X!=b.Bot.X&&f.Top.X!=b.Bot.X&&this.ReverseHorizontal(b):
f.Bot.X!=b.Bot.X&&this.ReverseHorizontal(b)));f=b;if(d){for(;q.Top.Y==q.Next.Bot.Y&&q.Next.OutIdx!=e.ClipperBase.Skip;)q=q.Next;if(q.Dx==e.ClipperBase.horizontal&&q.Next.OutIdx!=e.ClipperBase.Skip){for(n=q;n.Prev.Dx==e.ClipperBase.horizontal;)n=n.Prev;n.Prev.Top.X==q.Next.Top.X?d||(q=n.Prev):n.Prev.Top.X>q.Next.Top.X&&(q=n.Prev)}for(;b!=q;)b.NextInLML=b.Next,b.Dx==e.ClipperBase.horizontal&&b!=f&&b.Bot.X!=b.Prev.Top.X&&this.ReverseHorizontal(b),b=b.Next;b.Dx==e.ClipperBase.horizontal&&b!=f&&b.Bot.X!=
b.Prev.Top.X&&this.ReverseHorizontal(b);q=q.Next}else{for(;q.Top.Y==q.Prev.Bot.Y&&q.Prev.OutIdx!=e.ClipperBase.Skip;)q=q.Prev;if(q.Dx==e.ClipperBase.horizontal&&q.Prev.OutIdx!=e.ClipperBase.Skip){for(n=q;n.Next.Dx==e.ClipperBase.horizontal;)n=n.Next;n.Next.Top.X==q.Prev.Top.X?d||(q=n.Next):n.Next.Top.X>q.Prev.Top.X&&(q=n.Next)}for(;b!=q;)b.NextInLML=b.Prev,b.Dx==e.ClipperBase.horizontal&&b!=f&&b.Bot.X!=b.Next.Top.X&&this.ReverseHorizontal(b),b=b.Prev;b.Dx==e.ClipperBase.horizontal&&b!=f&&b.Bot.X!=
b.Next.Top.X&&this.ReverseHorizontal(b);q=q.Prev}return q};e.ClipperBase.prototype.AddPath=function(b,d,f){e.use_lines?f||d!=e.PolyType.ptClip||e.Error("AddPath: Open paths must be subject."):f||e.Error("AddPath: Open paths have been disabled.");var q=b.length-1;if(f)for(;0<q&&e.IntPoint.op_Equality(b[q],b[0]);)--q;for(;0<q&&e.IntPoint.op_Equality(b[q],b[q-1]);)--q;if(f&&2>q||!f&&1>q)return!1;for(var n=[],h=0;h<=q;h++)n.push(new e.TEdge);var v=!0;n[1].Curr.X=b[1].X;n[1].Curr.Y=b[1].Y;e.use_xyz&&(n[1].Curr.Z=
b[1].Z);var p={Value:this.m_UseFullRange};this.RangeTest(b[0],p);this.m_UseFullRange=p.Value;p.Value=this.m_UseFullRange;this.RangeTest(b[q],p);this.m_UseFullRange=p.Value;this.InitEdge(n[0],n[1],n[q],b[0]);this.InitEdge(n[q],n[0],n[q-1],b[q]);for(h=q-1;1<=h;--h)p.Value=this.m_UseFullRange,this.RangeTest(b[h],p),this.m_UseFullRange=p.Value,this.InitEdge(n[h],n[h+1],n[h-1],b[h]);for(h=b=q=n[0];;)if(b.Curr!=b.Next.Curr||!f&&b.Next==q){if(b.Prev==b.Next)break;else if(f&&e.ClipperBase.SlopesEqual(b.Prev.Curr,
b.Curr,b.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(b.Prev.Curr,b.Curr,b.Next.Curr))){b==q&&(q=b.Next);b=this.RemoveEdge(b);h=b=b.Prev;continue}b=b.Next;if(b==h||!f&&b.Next==q)break}else{if(b==b.Next)break;b==q&&(q=b.Next);h=b=this.RemoveEdge(b)}if(!f&&b==b.Next||f&&b.Prev==b.Next)return!1;f||(this.m_HasOpenPaths=!0,q.Prev.OutIdx=e.ClipperBase.Skip);b=q;do this.InitEdge2(b,d),b=b.Next,v&&b.Curr.Y!=q.Curr.Y&&(v=!1);while(b!=q);if(v){if(f)return!1;b.Prev.OutIdx=
e.ClipperBase.Skip;b.Prev.Bot.X<b.Prev.Top.X&&this.ReverseHorizontal(b.Prev);d=new e.LocalMinima;d.Next=null;d.Y=b.Bot.Y;d.LeftBound=null;d.RightBound=b;d.RightBound.Side=e.EdgeSide.esRight;for(d.RightBound.WindDelta=0;b.Next.OutIdx!=e.ClipperBase.Skip;)b.NextInLML=b.Next,b.Bot.X!=b.Prev.Top.X&&this.ReverseHorizontal(b),b=b.Next;this.InsertLocalMinima(d);this.m_edges.push(n);return!0}this.m_edges.push(n);v=null;for(e.IntPoint.op_Equality(b.Prev.Bot,b.Prev.Top)&&(b=b.Next);;){b=this.FindNextLocMin(b);
if(b==v)break;else null==v&&(v=b);d=new e.LocalMinima;d.Next=null;d.Y=b.Bot.Y;b.Dx<b.Prev.Dx?(d.LeftBound=b.Prev,d.RightBound=b,n=!1):(d.LeftBound=b,d.RightBound=b.Prev,n=!0);d.LeftBound.Side=e.EdgeSide.esLeft;d.RightBound.Side=e.EdgeSide.esRight;d.LeftBound.WindDelta=f?d.LeftBound.Next==d.RightBound?-1:1:0;d.RightBound.WindDelta=-d.LeftBound.WindDelta;b=this.ProcessBound(d.LeftBound,n);b.OutIdx==e.ClipperBase.Skip&&(b=this.ProcessBound(b,n));q=this.ProcessBound(d.RightBound,!n);q.OutIdx==e.ClipperBase.Skip&&
(q=this.ProcessBound(q,!n));d.LeftBound.OutIdx==e.ClipperBase.Skip?d.LeftBound=null:d.RightBound.OutIdx==e.ClipperBase.Skip&&(d.RightBound=null);this.InsertLocalMinima(d);n||(b=q)}return!0};e.ClipperBase.prototype.AddPaths=function(b,d,f){for(var e=!1,n=0,h=b.length;n<h;++n)this.AddPath(b[n],d,f)&&(e=!0);return e};e.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(b,d,f){return e.IntPoint.op_Equality(b,f)||e.IntPoint.op_Equality(b,d)||e.IntPoint.op_Equality(f,d)?!1:b.X!=f.X?d.X>b.X==d.X<f.X:d.Y>
b.Y==d.Y<f.Y};e.ClipperBase.prototype.RemoveEdge=function(b){b.Prev.Next=b.Next;b.Next.Prev=b.Prev;var d=b.Next;b.Prev=null;return d};e.ClipperBase.prototype.SetDx=function(b){b.Delta.X=b.Top.X-b.Bot.X;b.Delta.Y=b.Top.Y-b.Bot.Y;b.Dx=0===b.Delta.Y?e.ClipperBase.horizontal:b.Delta.X/b.Delta.Y};e.ClipperBase.prototype.InsertLocalMinima=function(b){if(null===this.m_MinimaList)this.m_MinimaList=b;else if(b.Y>=this.m_MinimaList.Y)b.Next=this.m_MinimaList,this.m_MinimaList=b;else{for(var d=this.m_MinimaList;null!==
d.Next&&b.Y<d.Next.Y;)d=d.Next;b.Next=d.Next;d.Next=b}};e.ClipperBase.prototype.PopLocalMinima=function(){null!==this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.Next)};e.ClipperBase.prototype.ReverseHorizontal=function(b){var d=b.Top.X;b.Top.X=b.Bot.X;b.Bot.X=d;e.use_xyz&&(d=b.Top.Z,b.Top.Z=b.Bot.Z,b.Bot.Z=d)};e.ClipperBase.prototype.Reset=function(){this.m_CurrentLM=this.m_MinimaList;if(null!=this.m_CurrentLM)for(var b=this.m_MinimaList;null!=b;){var d=b.LeftBound;null!=d&&(d.Curr.X=d.Bot.X,
d.Curr.Y=d.Bot.Y,e.use_xyz&&(d.Curr.Z=d.Bot.Z),d.Side=e.EdgeSide.esLeft,d.OutIdx=e.ClipperBase.Unassigned);d=b.RightBound;null!=d&&(d.Curr.X=d.Bot.X,d.Curr.Y=d.Bot.Y,e.use_xyz&&(d.Curr.Z=d.Bot.Z),d.Side=e.EdgeSide.esRight,d.OutIdx=e.ClipperBase.Unassigned);b=b.Next}};e.Clipper=function(b){"undefined"==typeof b&&(b=0);this.m_PolyOuts=null;this.m_ClipType=e.ClipType.ctIntersection;this.m_IntersectNodeComparer=this.m_IntersectList=this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_ExecuteLocked=
!1;this.m_SubjFillType=this.m_ClipFillType=e.PolyFillType.pftEvenOdd;this.m_GhostJoins=this.m_Joins=null;this.StrictlySimple=this.ReverseSolution=this.m_UsingPolyTree=!1;e.ClipperBase.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_IntersectList=[];this.m_IntersectNodeComparer=e.MyIntersectNodeSort.Compare;this.m_UsingPolyTree=this.m_ExecuteLocked=!1;this.m_PolyOuts=[];this.m_Joins=[];this.m_GhostJoins=[];this.ReverseSolution=0!==(1&b);this.StrictlySimple=0!==(2&b);this.PreserveCollinear=
0!==(4&b);e.use_xyz&&(this.ZFillFunction=null)};e.Clipper.ioReverseSolution=1;e.Clipper.ioStrictlySimple=2;e.Clipper.ioPreserveCollinear=4;e.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),e.ClipperBase.prototype.Clear.call(this))};e.Clipper.prototype.DisposeScanbeamList=function(){for(;null!==this.m_Scanbeam;){var b=this.m_Scanbeam.Next;this.m_Scanbeam=null;this.m_Scanbeam=b}};e.Clipper.prototype.Reset=function(){e.ClipperBase.prototype.Reset.call(this);this.m_SortedEdges=
this.m_ActiveEdges=this.m_Scanbeam=null;for(var b=this.m_MinimaList;null!==b;)this.InsertScanbeam(b.Y),b=b.Next};e.Clipper.prototype.InsertScanbeam=function(b){if(null===this.m_Scanbeam)this.m_Scanbeam=new e.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=b;else if(b>this.m_Scanbeam.Y){var d=new e.Scanbeam;d.Y=b;d.Next=this.m_Scanbeam;this.m_Scanbeam=d}else{for(var f=this.m_Scanbeam;null!==f.Next&&b<=f.Next.Y;)f=f.Next;b!=f.Y&&(d=new e.Scanbeam,d.Y=b,d.Next=f.Next,f.Next=d)}};e.Clipper.prototype.Execute=
function(){var b=arguments,d=b.length,f=b[1]instanceof e.PolyTree;if(4!=d||f){if(4==d&&f){d=b[0];var q=b[1];f=b[2];b=b[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;this.m_SubjFillType=f;this.m_ClipFillType=b;this.m_ClipType=d;this.m_UsingPolyTree=!0;try{(n=this.ExecuteInternal())&&this.BuildResult2(q)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return n}if(2==d&&!f||2==d&&f)return d=b[0],q=b[1],this.Execute(d,q,e.PolyFillType.pftEvenOdd,e.PolyFillType.pftEvenOdd)}else{d=
b[0];q=b[1];f=b[2];b=b[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&e.Error("Error: PolyTree struct is need for open path clipping.");this.m_ExecuteLocked=!0;e.Clear(q);this.m_SubjFillType=f;this.m_ClipFillType=b;this.m_ClipType=d;this.m_UsingPolyTree=!1;try{var n=this.ExecuteInternal();n&&this.BuildResult(q)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return n}};e.Clipper.prototype.FixHoleLinkage=function(b){if(null!==b.FirstLeft&&(b.IsHole==b.FirstLeft.IsHole||null===b.FirstLeft.Pts)){for(var d=
b.FirstLeft;null!==d&&(d.IsHole==b.IsHole||null===d.Pts);)d=d.FirstLeft;b.FirstLeft=d}};e.Clipper.prototype.ExecuteInternal=function(){try{this.Reset();if(null===this.m_CurrentLM)return!1;var b=this.PopScanbeam();do{this.InsertLocalMinimaIntoAEL(b);e.Clear(this.m_GhostJoins);this.ProcessHorizontals(!1);if(null===this.m_Scanbeam)break;var d=this.PopScanbeam();if(!this.ProcessIntersections(d))return!1;this.ProcessEdgesAtTopOfScanbeam(d);b=d}while(null!==this.m_Scanbeam||null!==this.m_CurrentLM);b=0;
for(var f=this.m_PolyOuts.length;b<f;b++){var q=this.m_PolyOuts[b];null===q.Pts||q.IsOpen||(q.IsHole^this.ReverseSolution)==0<this.Area(q)&&this.ReversePolyPtLinks(q.Pts)}this.JoinCommonEdges();b=0;for(f=this.m_PolyOuts.length;b<f;b++)q=this.m_PolyOuts[b],null===q.Pts||q.IsOpen||this.FixupOutPolygon(q);this.StrictlySimple&&this.DoSimplePolygons();return!0}finally{e.Clear(this.m_Joins),e.Clear(this.m_GhostJoins)}};e.Clipper.prototype.PopScanbeam=function(){var b=this.m_Scanbeam.Y;this.m_Scanbeam=this.m_Scanbeam.Next;
return b};e.Clipper.prototype.DisposeAllPolyPts=function(){for(var b=0,d=this.m_PolyOuts.length;b<d;++b)this.DisposeOutRec(b);e.Clear(this.m_PolyOuts)};e.Clipper.prototype.DisposeOutRec=function(b){this.m_PolyOuts[b].Pts=null;this.m_PolyOuts[b]=null};e.Clipper.prototype.AddJoin=function(b,d,f){var q=new e.Join;q.OutPt1=b;q.OutPt2=d;q.OffPt.X=f.X;q.OffPt.Y=f.Y;e.use_xyz&&(q.OffPt.Z=f.Z);this.m_Joins.push(q)};e.Clipper.prototype.AddGhostJoin=function(b,d){var f=new e.Join;f.OutPt1=b;f.OffPt.X=d.X;f.OffPt.Y=
d.Y;e.use_xyz&&(f.OffPt.Z=d.Z);this.m_GhostJoins.push(f)};e.Clipper.prototype.SetZ=function(b,d,f){null!==this.ZFillFunction&&0==b.Z&&null!==this.ZFillFunction&&(e.IntPoint.op_Equality(b,d.Bot)?b.Z=d.Bot.Z:e.IntPoint.op_Equality(b,d.Top)?b.Z=d.Top.Z:e.IntPoint.op_Equality(b,f.Bot)?b.Z=f.Bot.Z:e.IntPoint.op_Equality(b,f.Top)?b.Z=f.Top.Z:this.ZFillFunction(d.Bot,d.Top,f.Bot,f.Top,b))};e.Clipper.prototype.InsertLocalMinimaIntoAEL=function(b){for(;null!==this.m_CurrentLM&&this.m_CurrentLM.Y==b;){var d=
this.m_CurrentLM.LeftBound,f=this.m_CurrentLM.RightBound;this.PopLocalMinima();var q=null;null===d?(this.InsertEdgeIntoAEL(f,null),this.SetWindingCount(f),this.IsContributing(f)&&(q=this.AddOutPt(f,f.Bot))):(null==f?(this.InsertEdgeIntoAEL(d,null),this.SetWindingCount(d),this.IsContributing(d)&&(q=this.AddOutPt(d,d.Bot))):(this.InsertEdgeIntoAEL(d,null),this.InsertEdgeIntoAEL(f,d),this.SetWindingCount(d),f.WindCnt=d.WindCnt,f.WindCnt2=d.WindCnt2,this.IsContributing(d)&&(q=this.AddLocalMinPoly(d,f,
d.Bot))),this.InsertScanbeam(d.Top.Y));null!=f&&(e.ClipperBase.IsHorizontal(f)?this.AddEdgeToSEL(f):this.InsertScanbeam(f.Top.Y));if(null!=d&&null!=f){if(null!==q&&e.ClipperBase.IsHorizontal(f)&&0<this.m_GhostJoins.length&&0!==f.WindDelta)for(var n=0,h=this.m_GhostJoins.length;n<h;n++){var v=this.m_GhostJoins[n];this.HorzSegmentsOverlap(v.OutPt1.Pt.X,v.OffPt.X,f.Bot.X,f.Top.X)&&this.AddJoin(v.OutPt1,q,v.OffPt)}0<=d.OutIdx&&null!==d.PrevInAEL&&d.PrevInAEL.Curr.X==d.Bot.X&&0<=d.PrevInAEL.OutIdx&&e.ClipperBase.SlopesEqual(d.PrevInAEL,
d,this.m_UseFullRange)&&0!==d.WindDelta&&0!==d.PrevInAEL.WindDelta&&(n=this.AddOutPt(d.PrevInAEL,d.Bot),this.AddJoin(q,n,d.Top));if(d.NextInAEL!=f&&(0<=f.OutIdx&&0<=f.PrevInAEL.OutIdx&&e.ClipperBase.SlopesEqual(f.PrevInAEL,f,this.m_UseFullRange)&&0!==f.WindDelta&&0!==f.PrevInAEL.WindDelta&&(n=this.AddOutPt(f.PrevInAEL,f.Bot),this.AddJoin(q,n,f.Top)),q=d.NextInAEL,null!==q))for(;q!=f;)this.IntersectEdges(f,q,d.Curr,!1),q=q.NextInAEL}}};e.Clipper.prototype.InsertEdgeIntoAEL=function(b,d){if(null===
this.m_ActiveEdges)b.PrevInAEL=null,b.NextInAEL=null,this.m_ActiveEdges=b;else if(null===d&&this.E2InsertsBeforeE1(this.m_ActiveEdges,b))b.PrevInAEL=null,b.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges=this.m_ActiveEdges.PrevInAEL=b;else{for(null===d&&(d=this.m_ActiveEdges);null!==d.NextInAEL&&!this.E2InsertsBeforeE1(d.NextInAEL,b);)d=d.NextInAEL;b.NextInAEL=d.NextInAEL;null!==d.NextInAEL&&(d.NextInAEL.PrevInAEL=b);b.PrevInAEL=d;d.NextInAEL=b}};e.Clipper.prototype.E2InsertsBeforeE1=function(b,d){return d.Curr.X==
b.Curr.X?d.Top.Y>b.Top.Y?d.Top.X<e.Clipper.TopX(b,d.Top.Y):b.Top.X>e.Clipper.TopX(d,b.Top.Y):d.Curr.X<b.Curr.X};e.Clipper.prototype.IsEvenOddFillType=function(b){return b.PolyTyp==e.PolyType.ptSubject?this.m_SubjFillType==e.PolyFillType.pftEvenOdd:this.m_ClipFillType==e.PolyFillType.pftEvenOdd};e.Clipper.prototype.IsEvenOddAltFillType=function(b){return b.PolyTyp==e.PolyType.ptSubject?this.m_ClipFillType==e.PolyFillType.pftEvenOdd:this.m_SubjFillType==e.PolyFillType.pftEvenOdd};e.Clipper.prototype.IsContributing=
function(b){var d,f;b.PolyTyp==e.PolyType.ptSubject?(d=this.m_SubjFillType,f=this.m_ClipFillType):(d=this.m_ClipFillType,f=this.m_SubjFillType);switch(d){case e.PolyFillType.pftEvenOdd:if(0===b.WindDelta&&1!=b.WindCnt)return!1;break;case e.PolyFillType.pftNonZero:if(1!=Math.abs(b.WindCnt))return!1;break;case e.PolyFillType.pftPositive:if(1!=b.WindCnt)return!1;break;default:if(-1!=b.WindCnt)return!1}switch(this.m_ClipType){case e.ClipType.ctIntersection:switch(f){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return 0!==
b.WindCnt2;case e.PolyFillType.pftPositive:return 0<b.WindCnt2;default:return 0>b.WindCnt2}case e.ClipType.ctUnion:switch(f){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return 0===b.WindCnt2;case e.PolyFillType.pftPositive:return 0>=b.WindCnt2;default:return 0<=b.WindCnt2}case e.ClipType.ctDifference:if(b.PolyTyp==e.PolyType.ptSubject)switch(f){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return 0===b.WindCnt2;case e.PolyFillType.pftPositive:return 0>=b.WindCnt2;
default:return 0<=b.WindCnt2}else switch(f){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return 0!==b.WindCnt2;case e.PolyFillType.pftPositive:return 0<b.WindCnt2;default:return 0>b.WindCnt2}case e.ClipType.ctXor:if(0===b.WindDelta)switch(f){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return 0===b.WindCnt2;case e.PolyFillType.pftPositive:return 0>=b.WindCnt2;default:return 0<=b.WindCnt2}}return!0};e.Clipper.prototype.SetWindingCount=function(b){for(var d=b.PrevInAEL;null!==
d&&(d.PolyTyp!=b.PolyTyp||0===d.WindDelta);)d=d.PrevInAEL;if(null===d)b.WindCnt=0===b.WindDelta?1:b.WindDelta,b.WindCnt2=0,d=this.m_ActiveEdges;else{if(0===b.WindDelta&&this.m_ClipType!=e.ClipType.ctUnion)b.WindCnt=1;else if(this.IsEvenOddFillType(b))if(0===b.WindDelta){for(var f=!0,q=d.PrevInAEL;null!==q;)q.PolyTyp==d.PolyTyp&&0!==q.WindDelta&&(f=!f),q=q.PrevInAEL;b.WindCnt=f?0:1}else b.WindCnt=b.WindDelta;else b.WindCnt=0>d.WindCnt*d.WindDelta?1<Math.abs(d.WindCnt)?0>d.WindDelta*b.WindDelta?d.WindCnt:
d.WindCnt+b.WindDelta:0===b.WindDelta?1:b.WindDelta:0===b.WindDelta?0>d.WindCnt?d.WindCnt-1:d.WindCnt+1:0>d.WindDelta*b.WindDelta?d.WindCnt:d.WindCnt+b.WindDelta;b.WindCnt2=d.WindCnt2;d=d.NextInAEL}if(this.IsEvenOddAltFillType(b))for(;d!=b;)0!==d.WindDelta&&(b.WindCnt2=0===b.WindCnt2?1:0),d=d.NextInAEL;else for(;d!=b;)b.WindCnt2+=d.WindDelta,d=d.NextInAEL};e.Clipper.prototype.AddEdgeToSEL=function(b){null===this.m_SortedEdges?(this.m_SortedEdges=b,b.PrevInSEL=null,b.NextInSEL=null):(b.NextInSEL=this.m_SortedEdges,
b.PrevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.PrevInSEL=b)};e.Clipper.prototype.CopyAELToSEL=function(){var b=this.m_ActiveEdges;for(this.m_SortedEdges=b;null!==b;)b.PrevInSEL=b.PrevInAEL,b=b.NextInSEL=b.NextInAEL};e.Clipper.prototype.SwapPositionsInAEL=function(b,d){if(b.NextInAEL!=b.PrevInAEL&&d.NextInAEL!=d.PrevInAEL){if(b.NextInAEL==d){var f=d.NextInAEL;null!==f&&(f.PrevInAEL=b);var e=b.PrevInAEL;null!==e&&(e.NextInAEL=d);d.PrevInAEL=e;d.NextInAEL=b;b.PrevInAEL=d;b.NextInAEL=f}else d.NextInAEL==
b?(f=b.NextInAEL,null!==f&&(f.PrevInAEL=d),e=d.PrevInAEL,null!==e&&(e.NextInAEL=b),b.PrevInAEL=e,b.NextInAEL=d,d.PrevInAEL=b,d.NextInAEL=f):(f=b.NextInAEL,e=b.PrevInAEL,b.NextInAEL=d.NextInAEL,null!==b.NextInAEL&&(b.NextInAEL.PrevInAEL=b),b.PrevInAEL=d.PrevInAEL,null!==b.PrevInAEL&&(b.PrevInAEL.NextInAEL=b),d.NextInAEL=f,null!==d.NextInAEL&&(d.NextInAEL.PrevInAEL=d),d.PrevInAEL=e,null!==d.PrevInAEL&&(d.PrevInAEL.NextInAEL=d));null===b.PrevInAEL?this.m_ActiveEdges=b:null===d.PrevInAEL&&(this.m_ActiveEdges=
d)}};e.Clipper.prototype.SwapPositionsInSEL=function(b,d){if(null!==b.NextInSEL||null!==b.PrevInSEL)if(null!==d.NextInSEL||null!==d.PrevInSEL){if(b.NextInSEL==d){var f=d.NextInSEL;null!==f&&(f.PrevInSEL=b);var e=b.PrevInSEL;null!==e&&(e.NextInSEL=d);d.PrevInSEL=e;d.NextInSEL=b;b.PrevInSEL=d;b.NextInSEL=f}else d.NextInSEL==b?(f=b.NextInSEL,null!==f&&(f.PrevInSEL=d),e=d.PrevInSEL,null!==e&&(e.NextInSEL=b),b.PrevInSEL=e,b.NextInSEL=d,d.PrevInSEL=b,d.NextInSEL=f):(f=b.NextInSEL,e=b.PrevInSEL,b.NextInSEL=
d.NextInSEL,null!==b.NextInSEL&&(b.NextInSEL.PrevInSEL=b),b.PrevInSEL=d.PrevInSEL,null!==b.PrevInSEL&&(b.PrevInSEL.NextInSEL=b),d.NextInSEL=f,null!==d.NextInSEL&&(d.NextInSEL.PrevInSEL=d),d.PrevInSEL=e,null!==d.PrevInSEL&&(d.PrevInSEL.NextInSEL=d));null===b.PrevInSEL?this.m_SortedEdges=b:null===d.PrevInSEL&&(this.m_SortedEdges=d)}};e.Clipper.prototype.AddLocalMaxPoly=function(b,d,f){this.AddOutPt(b,f);0==d.WindDelta&&this.AddOutPt(d,f);b.OutIdx==d.OutIdx?(b.OutIdx=-1,d.OutIdx=-1):b.OutIdx<d.OutIdx?
this.AppendPolygon(b,d):this.AppendPolygon(d,b)};e.Clipper.prototype.AddLocalMinPoly=function(b,d,f){var q,n;e.ClipperBase.IsHorizontal(d)||b.Dx>d.Dx?(q=this.AddOutPt(b,f),d.OutIdx=b.OutIdx,b.Side=e.EdgeSide.esLeft,d.Side=e.EdgeSide.esRight,n=b,b=n.PrevInAEL==d?d.PrevInAEL:n.PrevInAEL):(q=this.AddOutPt(d,f),b.OutIdx=d.OutIdx,b.Side=e.EdgeSide.esRight,d.Side=e.EdgeSide.esLeft,n=d,b=n.PrevInAEL==b?b.PrevInAEL:n.PrevInAEL);null!==b&&0<=b.OutIdx&&e.Clipper.TopX(b,f.Y)==e.Clipper.TopX(n,f.Y)&&e.ClipperBase.SlopesEqual(n,
b,this.m_UseFullRange)&&0!==n.WindDelta&&0!==b.WindDelta&&(f=this.AddOutPt(b,f),this.AddJoin(q,f,n.Top));return q};e.Clipper.prototype.CreateOutRec=function(){var b=new e.OutRec;b.Idx=-1;b.IsHole=!1;b.IsOpen=!1;b.FirstLeft=null;b.Pts=null;b.BottomPt=null;b.PolyNode=null;this.m_PolyOuts.push(b);b.Idx=this.m_PolyOuts.length-1;return b};e.Clipper.prototype.AddOutPt=function(b,d){var f=b.Side==e.EdgeSide.esLeft;if(0>b.OutIdx){var q=this.CreateOutRec();q.IsOpen=0===b.WindDelta;var n=new e.OutPt;q.Pts=
n;n.Idx=q.Idx;n.Pt.X=d.X;n.Pt.Y=d.Y;e.use_xyz&&(n.Pt.Z=d.Z);n.Next=n;n.Prev=n;q.IsOpen||this.SetHoleState(b,q);b.OutIdx=q.Idx}else{q=this.m_PolyOuts[b.OutIdx];b=q.Pts;if(f&&e.IntPoint.op_Equality(d,b.Pt))return b;if(!f&&e.IntPoint.op_Equality(d,b.Prev.Pt))return b.Prev;n=new e.OutPt;n.Idx=q.Idx;n.Pt.X=d.X;n.Pt.Y=d.Y;e.use_xyz&&(n.Pt.Z=d.Z);n.Next=b;n.Prev=b.Prev;n.Prev.Next=n;b.Prev=n;f&&(q.Pts=n)}return n};e.Clipper.prototype.SwapPoints=function(b,d){var f=new e.IntPoint(b.Value);b.Value.X=d.Value.X;
b.Value.Y=d.Value.Y;e.use_xyz&&(b.Value.Z=d.Value.Z);d.Value.X=f.X;d.Value.Y=f.Y;e.use_xyz&&(d.Value.Z=f.Z)};e.Clipper.prototype.HorzSegmentsOverlap=function(b,d,f,e){var q;b>d&&(q=b,b=d,d=q);f>e&&(q=f,f=e,e=q);return b<e&&f<d};e.Clipper.prototype.SetHoleState=function(b,d){var f=!1;for(b=b.PrevInAEL;null!==b;)0<=b.OutIdx&&0!=b.WindDelta&&(f=!f,null===d.FirstLeft&&(d.FirstLeft=this.m_PolyOuts[b.OutIdx])),b=b.PrevInAEL;f&&(d.IsHole=!0)};e.Clipper.prototype.GetDx=function(b,d){return b.Y==d.Y?e.ClipperBase.horizontal:
(d.X-b.X)/(d.Y-b.Y)};e.Clipper.prototype.FirstIsBottomPt=function(b,d){for(var f=b.Prev;e.IntPoint.op_Equality(f.Pt,b.Pt)&&f!=b;)f=f.Prev;var q=Math.abs(this.GetDx(b.Pt,f.Pt));for(f=b.Next;e.IntPoint.op_Equality(f.Pt,b.Pt)&&f!=b;)f=f.Next;b=Math.abs(this.GetDx(b.Pt,f.Pt));for(f=d.Prev;e.IntPoint.op_Equality(f.Pt,d.Pt)&&f!=d;)f=f.Prev;var n=Math.abs(this.GetDx(d.Pt,f.Pt));for(f=d.Next;e.IntPoint.op_Equality(f.Pt,d.Pt)&&f!=d;)f=f.Next;f=Math.abs(this.GetDx(d.Pt,f.Pt));return q>=n&&q>=f||b>=n&&b>=f};
e.Clipper.prototype.GetBottomPt=function(b){for(var d=null,f=b.Next;f!=b;)f.Pt.Y>b.Pt.Y?(b=f,d=null):f.Pt.Y==b.Pt.Y&&f.Pt.X<=b.Pt.X&&(f.Pt.X<b.Pt.X?(d=null,b=f):f.Next!=b&&f.Prev!=b&&(d=f)),f=f.Next;if(null!==d)for(;d!=f;)for(this.FirstIsBottomPt(f,d)||(b=d),d=d.Next;e.IntPoint.op_Inequality(d.Pt,b.Pt);)d=d.Next;return b};e.Clipper.prototype.GetLowermostRec=function(b,d){null===b.BottomPt&&(b.BottomPt=this.GetBottomPt(b.Pts));null===d.BottomPt&&(d.BottomPt=this.GetBottomPt(d.Pts));var f=b.BottomPt,
e=d.BottomPt;return f.Pt.Y>e.Pt.Y?b:f.Pt.Y<e.Pt.Y?d:f.Pt.X<e.Pt.X?b:f.Pt.X>e.Pt.X?d:f.Next==f?d:e.Next==e?b:this.FirstIsBottomPt(f,e)?b:d};e.Clipper.prototype.Param1RightOfParam2=function(b,d){do if(b=b.FirstLeft,b==d)return!0;while(null!==b);return!1};e.Clipper.prototype.GetOutRec=function(b){for(b=this.m_PolyOuts[b];b!=this.m_PolyOuts[b.Idx];)b=this.m_PolyOuts[b.Idx];return b};e.Clipper.prototype.AppendPolygon=function(b,d){var f=this.m_PolyOuts[b.OutIdx],q=this.m_PolyOuts[d.OutIdx];var n=this.Param1RightOfParam2(f,
q)?q:this.Param1RightOfParam2(q,f)?f:this.GetLowermostRec(f,q);var h=f.Pts,v=h.Prev,p=q.Pts,w=p.Prev;b.Side==e.EdgeSide.esLeft?(d.Side==e.EdgeSide.esLeft?(this.ReversePolyPtLinks(p),p.Next=h,h.Prev=p,v.Next=w,w.Prev=v,f.Pts=w):(w.Next=h,h.Prev=w,p.Prev=v,v.Next=p,f.Pts=p),h=e.EdgeSide.esLeft):(d.Side==e.EdgeSide.esRight?(this.ReversePolyPtLinks(p),v.Next=w,w.Prev=v,p.Next=h,h.Prev=p):(v.Next=p,p.Prev=v,h.Prev=w,w.Next=h),h=e.EdgeSide.esRight);f.BottomPt=null;n==q&&(q.FirstLeft!=f&&(f.FirstLeft=q.FirstLeft),
f.IsHole=q.IsHole);q.Pts=null;q.BottomPt=null;q.FirstLeft=f;n=b.OutIdx;v=d.OutIdx;b.OutIdx=-1;d.OutIdx=-1;for(p=this.m_ActiveEdges;null!==p;){if(p.OutIdx==v){p.OutIdx=n;p.Side=h;break}p=p.NextInAEL}q.Idx=f.Idx};e.Clipper.prototype.ReversePolyPtLinks=function(b){if(null!==b){var d=b;do{var f=d.Next;d.Next=d.Prev;d=d.Prev=f}while(d!=b)}};e.Clipper.SwapSides=function(b,d){var f=b.Side;b.Side=d.Side;d.Side=f};e.Clipper.SwapPolyIndexes=function(b,d){var f=b.OutIdx;b.OutIdx=d.OutIdx;d.OutIdx=f};e.Clipper.prototype.IntersectEdges=
function(b,d,f){var q=0<=b.OutIdx,n=0<=d.OutIdx;e.use_xyz&&this.SetZ(f,b,d);if(!e.use_lines||0!==b.WindDelta&&0!==d.WindDelta){if(b.PolyTyp==d.PolyTyp)if(this.IsEvenOddFillType(b)){var h=b.WindCnt;b.WindCnt=d.WindCnt;d.WindCnt=h}else b.WindCnt=0===b.WindCnt+d.WindDelta?-b.WindCnt:b.WindCnt+d.WindDelta,d.WindCnt=0===d.WindCnt-b.WindDelta?-d.WindCnt:d.WindCnt-b.WindDelta;else this.IsEvenOddFillType(d)?b.WindCnt2=0===b.WindCnt2?1:0:b.WindCnt2+=d.WindDelta,this.IsEvenOddFillType(b)?d.WindCnt2=0===d.WindCnt2?
1:0:d.WindCnt2-=b.WindDelta;var v,p,w;b.PolyTyp==e.PolyType.ptSubject?(v=this.m_SubjFillType,w=this.m_ClipFillType):(v=this.m_ClipFillType,w=this.m_SubjFillType);d.PolyTyp==e.PolyType.ptSubject?(p=this.m_SubjFillType,h=this.m_ClipFillType):(p=this.m_ClipFillType,h=this.m_SubjFillType);switch(v){case e.PolyFillType.pftPositive:v=b.WindCnt;break;case e.PolyFillType.pftNegative:v=-b.WindCnt;break;default:v=Math.abs(b.WindCnt)}switch(p){case e.PolyFillType.pftPositive:p=d.WindCnt;break;case e.PolyFillType.pftNegative:p=
-d.WindCnt;break;default:p=Math.abs(d.WindCnt)}if(q&&n)0!=v&&1!=v||0!=p&&1!=p||b.PolyTyp!=d.PolyTyp&&this.m_ClipType!=e.ClipType.ctXor?this.AddLocalMaxPoly(b,d,f):(this.AddOutPt(b,f),this.AddOutPt(d,f),e.Clipper.SwapSides(b,d),e.Clipper.SwapPolyIndexes(b,d));else if(q){if(0===p||1==p)this.AddOutPt(b,f),e.Clipper.SwapSides(b,d),e.Clipper.SwapPolyIndexes(b,d)}else if(n){if(0===v||1==v)this.AddOutPt(d,f),e.Clipper.SwapSides(b,d),e.Clipper.SwapPolyIndexes(b,d)}else if(!(0!=v&&1!=v||0!=p&&1!=p)){switch(w){case e.PolyFillType.pftPositive:q=
b.WindCnt2;break;case e.PolyFillType.pftNegative:q=-b.WindCnt2;break;default:q=Math.abs(b.WindCnt2)}switch(h){case e.PolyFillType.pftPositive:n=d.WindCnt2;break;case e.PolyFillType.pftNegative:n=-d.WindCnt2;break;default:n=Math.abs(d.WindCnt2)}if(b.PolyTyp!=d.PolyTyp)this.AddLocalMinPoly(b,d,f);else if(1==v&&1==p)switch(this.m_ClipType){case e.ClipType.ctIntersection:0<q&&0<n&&this.AddLocalMinPoly(b,d,f);break;case e.ClipType.ctUnion:0>=q&&0>=n&&this.AddLocalMinPoly(b,d,f);break;case e.ClipType.ctDifference:(b.PolyTyp==
e.PolyType.ptClip&&0<q&&0<n||b.PolyTyp==e.PolyType.ptSubject&&0>=q&&0>=n)&&this.AddLocalMinPoly(b,d,f);break;case e.ClipType.ctXor:this.AddLocalMinPoly(b,d,f)}else e.Clipper.SwapSides(b,d)}}else if(0!=b.WindDelta||0!=d.WindDelta)b.PolyTyp==d.PolyTyp&&b.WindDelta!=d.WindDelta&&this.m_ClipType==e.ClipType.ctUnion?0===b.WindDelta?n&&(this.AddOutPt(b,f),q&&(b.OutIdx=-1)):q&&(this.AddOutPt(d,f),n&&(d.OutIdx=-1)):b.PolyTyp!=d.PolyTyp&&(0!==b.WindDelta||1!=Math.abs(d.WindCnt)||this.m_ClipType==e.ClipType.ctUnion&&
0!==d.WindCnt2?0!==d.WindDelta||1!=Math.abs(b.WindCnt)||this.m_ClipType==e.ClipType.ctUnion&&0!==b.WindCnt2||(this.AddOutPt(d,f),n&&(d.OutIdx=-1)):(this.AddOutPt(b,f),q&&(b.OutIdx=-1)))};e.Clipper.prototype.DeleteFromAEL=function(b){var d=b.PrevInAEL,f=b.NextInAEL;if(null!==d||null!==f||b==this.m_ActiveEdges)null!==d?d.NextInAEL=f:this.m_ActiveEdges=f,null!==f&&(f.PrevInAEL=d),b.NextInAEL=null,b.PrevInAEL=null};e.Clipper.prototype.DeleteFromSEL=function(b){var d=b.PrevInSEL,f=b.NextInSEL;if(null!==
d||null!==f||b==this.m_SortedEdges)null!==d?d.NextInSEL=f:this.m_SortedEdges=f,null!==f&&(f.PrevInSEL=d),b.NextInSEL=null,b.PrevInSEL=null};e.Clipper.prototype.UpdateEdgeIntoAEL=function(b){null===b.NextInLML&&e.Error("UpdateEdgeIntoAEL: invalid call");var d=b.PrevInAEL,f=b.NextInAEL;b.NextInLML.OutIdx=b.OutIdx;null!==d?d.NextInAEL=b.NextInLML:this.m_ActiveEdges=b.NextInLML;null!==f&&(f.PrevInAEL=b.NextInLML);b.NextInLML.Side=b.Side;b.NextInLML.WindDelta=b.WindDelta;b.NextInLML.WindCnt=b.WindCnt;
b.NextInLML.WindCnt2=b.WindCnt2;b=b.NextInLML;b.Curr.X=b.Bot.X;b.Curr.Y=b.Bot.Y;e.use_xyz&&(b.Curr.Z=b.Bot.Z);b.PrevInAEL=d;b.NextInAEL=f;e.ClipperBase.IsHorizontal(b)||this.InsertScanbeam(b.Top.Y);return b};e.Clipper.prototype.ProcessHorizontals=function(b){for(var d=this.m_SortedEdges;null!==d;)this.DeleteFromSEL(d),this.ProcessHorizontal(d,b),d=this.m_SortedEdges};e.Clipper.prototype.GetHorzDirection=function(b,d){b.Bot.X<b.Top.X?(d.Left=b.Bot.X,d.Right=b.Top.X,d.Dir=e.Direction.dLeftToRight):
(d.Left=b.Top.X,d.Right=b.Bot.X,d.Dir=e.Direction.dRightToLeft)};e.Clipper.prototype.ProcessHorizontal=function(b,d){var f={Dir:null,Left:null,Right:null};this.GetHorzDirection(b,f);for(var q=f.Dir,n=f.Left,h=f.Right,v=b,p=null;null!==v.NextInLML&&e.ClipperBase.IsHorizontal(v.NextInLML);)v=v.NextInLML;for(null===v.NextInLML&&(p=this.GetMaximaPair(v));;){for(var w=b==v,E=this.GetNextInAEL(b,q);null!==E&&!(E.Curr.X==b.Top.X&&null!==b.NextInLML&&E.Dx<b.NextInLML.Dx);){f=this.GetNextInAEL(E,q);if(q==
e.Direction.dLeftToRight&&E.Curr.X<=h||q==e.Direction.dRightToLeft&&E.Curr.X>=n){if(E==p&&w){if(0<=b.OutIdx){q=this.AddOutPt(b,b.Top);for(f=this.m_SortedEdges;null!==f;)0<=f.OutIdx&&this.HorzSegmentsOverlap(b.Bot.X,b.Top.X,f.Bot.X,f.Top.X)&&(n=this.AddOutPt(f,f.Bot),this.AddJoin(n,q,f.Top)),f=f.NextInSEL;this.AddGhostJoin(q,b.Bot);this.AddLocalMaxPoly(b,p,b.Top)}this.DeleteFromAEL(b);this.DeleteFromAEL(p);return}if(q==e.Direction.dLeftToRight){var H=new e.IntPoint(E.Curr.X,b.Curr.Y);this.IntersectEdges(b,
E,H)}else H=new e.IntPoint(E.Curr.X,b.Curr.Y),this.IntersectEdges(E,b,H);this.SwapPositionsInAEL(b,E)}else if(q==e.Direction.dLeftToRight&&E.Curr.X>=h||q==e.Direction.dRightToLeft&&E.Curr.X<=n)break;E=f}if(null!==b.NextInLML&&e.ClipperBase.IsHorizontal(b.NextInLML))b=this.UpdateEdgeIntoAEL(b),0<=b.OutIdx&&this.AddOutPt(b,b.Bot),f={Dir:q,Left:n,Right:h},this.GetHorzDirection(b,f),q=f.Dir,n=f.Left,h=f.Right;else break}null!==b.NextInLML?0<=b.OutIdx?(q=this.AddOutPt(b,b.Top),d&&this.AddGhostJoin(q,b.Bot),
b=this.UpdateEdgeIntoAEL(b),0!==b.WindDelta&&(p=b.PrevInAEL,f=b.NextInAEL,null!==p&&p.Curr.X==b.Bot.X&&p.Curr.Y==b.Bot.Y&&0!==p.WindDelta&&0<=p.OutIdx&&p.Curr.Y>p.Top.Y&&e.ClipperBase.SlopesEqual(b,p,this.m_UseFullRange)?(n=this.AddOutPt(p,b.Bot),this.AddJoin(q,n,b.Top)):null!==f&&f.Curr.X==b.Bot.X&&f.Curr.Y==b.Bot.Y&&0!==f.WindDelta&&0<=f.OutIdx&&f.Curr.Y>f.Top.Y&&e.ClipperBase.SlopesEqual(b,f,this.m_UseFullRange)&&(n=this.AddOutPt(f,b.Bot),this.AddJoin(q,n,b.Top)))):this.UpdateEdgeIntoAEL(b):(0<=
b.OutIdx&&this.AddOutPt(b,b.Top),this.DeleteFromAEL(b))};e.Clipper.prototype.GetNextInAEL=function(b,d){return d==e.Direction.dLeftToRight?b.NextInAEL:b.PrevInAEL};e.Clipper.prototype.IsMinima=function(b){return null!==b&&b.Prev.NextInLML!=b&&b.Next.NextInLML!=b};e.Clipper.prototype.IsMaxima=function(b,d){return null!==b&&b.Top.Y==d&&null===b.NextInLML};e.Clipper.prototype.IsIntermediate=function(b,d){return b.Top.Y==d&&null!==b.NextInLML};e.Clipper.prototype.GetMaximaPair=function(b){var d=null;
e.IntPoint.op_Equality(b.Next.Top,b.Top)&&null===b.Next.NextInLML?d=b.Next:e.IntPoint.op_Equality(b.Prev.Top,b.Top)&&null===b.Prev.NextInLML&&(d=b.Prev);return null===d||-2!=d.OutIdx&&(d.NextInAEL!=d.PrevInAEL||e.ClipperBase.IsHorizontal(d))?d:null};e.Clipper.prototype.ProcessIntersections=function(b){if(null==this.m_ActiveEdges)return!0;try{this.BuildIntersectList(b);if(0==this.m_IntersectList.length)return!0;if(1==this.m_IntersectList.length||this.FixupIntersectionOrder())this.ProcessIntersectList();
else return!1}catch(d){this.m_SortedEdges=null,this.m_IntersectList.length=0,e.Error("ProcessIntersections error")}this.m_SortedEdges=null;return!0};e.Clipper.prototype.BuildIntersectList=function(b){if(null!==this.m_ActiveEdges){var d=this.m_ActiveEdges;for(this.m_SortedEdges=d;null!==d;)d.PrevInSEL=d.PrevInAEL,d.NextInSEL=d.NextInAEL,d.Curr.X=e.Clipper.TopX(d,b),d=d.NextInAEL;for(var f=!0;f&&null!==this.m_SortedEdges;){f=!1;for(d=this.m_SortedEdges;null!==d.NextInSEL;){b=d.NextInSEL;var q=new e.IntPoint;
d.Curr.X>b.Curr.X?(this.IntersectPoint(d,b,q),f=new e.IntersectNode,f.Edge1=d,f.Edge2=b,f.Pt.X=q.X,f.Pt.Y=q.Y,e.use_xyz&&(f.Pt.Z=q.Z),this.m_IntersectList.push(f),this.SwapPositionsInSEL(d,b),f=!0):d=b}if(null!==d.PrevInSEL)d.PrevInSEL.NextInSEL=null;else break}this.m_SortedEdges=null}};e.Clipper.prototype.EdgesAdjacent=function(b){return b.Edge1.NextInSEL==b.Edge2||b.Edge1.PrevInSEL==b.Edge2};e.Clipper.IntersectNodeSort=function(b,d){return d.Pt.Y-b.Pt.Y};e.Clipper.prototype.FixupIntersectionOrder=
function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer);this.CopyAELToSEL();for(var b=this.m_IntersectList.length,d=0;d<b;d++){if(!this.EdgesAdjacent(this.m_IntersectList[d])){for(var f=d+1;f<b&&!this.EdgesAdjacent(this.m_IntersectList[f]);)f++;if(f==b)return!1;var e=this.m_IntersectList[d];this.m_IntersectList[d]=this.m_IntersectList[f];this.m_IntersectList[f]=e}this.SwapPositionsInSEL(this.m_IntersectList[d].Edge1,this.m_IntersectList[d].Edge2)}return!0};e.Clipper.prototype.ProcessIntersectList=
function(){for(var b=0,d=this.m_IntersectList.length;b<d;b++){var f=this.m_IntersectList[b];this.IntersectEdges(f.Edge1,f.Edge2,f.Pt);this.SwapPositionsInAEL(f.Edge1,f.Edge2)}this.m_IntersectList.length=0};ic=function(b){return 0>b?Math.ceil(b-.5):Math.round(b)};nb=function(b){return 0>b?Math.ceil(b-.5):Math.floor(b+.5)};bb=function(b){return 0>b?-Math.round(Math.abs(b)):Math.round(b)};ob=function(b){if(0>b)return b-=.5,-2147483648>b?Math.ceil(b):b|0;b+=.5;return 2147483647<b?Math.floor(b):b|0};e.Clipper.Round=
W?ic:tb?bb:Sc?ob:nb;e.Clipper.TopX=function(b,d){return d==b.Top.Y?b.Top.X:b.Bot.X+e.Clipper.Round(b.Dx*(d-b.Bot.Y))};e.Clipper.prototype.IntersectPoint=function(b,d,f){f.X=0;f.Y=0;var q,n;if(b.Dx==d.Dx)f.Y=b.Curr.Y,f.X=e.Clipper.TopX(b,f.Y);else{if(0===b.Delta.X)f.X=b.Bot.X,e.ClipperBase.IsHorizontal(d)?f.Y=d.Bot.Y:(n=d.Bot.Y-d.Bot.X/d.Dx,f.Y=e.Clipper.Round(f.X/d.Dx+n));else if(0===d.Delta.X)f.X=d.Bot.X,e.ClipperBase.IsHorizontal(b)?f.Y=b.Bot.Y:(q=b.Bot.Y-b.Bot.X/b.Dx,f.Y=e.Clipper.Round(f.X/b.Dx+
q));else{q=b.Bot.X-b.Bot.Y*b.Dx;n=d.Bot.X-d.Bot.Y*d.Dx;var h=(n-q)/(b.Dx-d.Dx);f.Y=e.Clipper.Round(h);f.X=Math.abs(b.Dx)<Math.abs(d.Dx)?e.Clipper.Round(b.Dx*h+q):e.Clipper.Round(d.Dx*h+n)}if(f.Y<b.Top.Y||f.Y<d.Top.Y){if(b.Top.Y>d.Top.Y)return f.Y=b.Top.Y,f.X=e.Clipper.TopX(d,b.Top.Y),f.X<b.Top.X;f.Y=d.Top.Y;f.X=Math.abs(b.Dx)<Math.abs(d.Dx)?e.Clipper.TopX(b,f.Y):e.Clipper.TopX(d,f.Y)}f.Y>b.Curr.Y&&(f.Y=b.Curr.Y,f.X=Math.abs(b.Dx)>Math.abs(d.Dx)?e.Clipper.TopX(d,f.Y):e.Clipper.TopX(b,f.Y))}};e.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=
function(b){for(var d=this.m_ActiveEdges;null!==d;){var f=this.IsMaxima(d,b);f&&(f=this.GetMaximaPair(d),f=null===f||!e.ClipperBase.IsHorizontal(f));if(f){var q=d.PrevInAEL;this.DoMaxima(d);d=null===q?this.m_ActiveEdges:q.NextInAEL}else{this.IsIntermediate(d,b)&&e.ClipperBase.IsHorizontal(d.NextInLML)?(d=this.UpdateEdgeIntoAEL(d),0<=d.OutIdx&&this.AddOutPt(d,d.Bot),this.AddEdgeToSEL(d)):(d.Curr.X=e.Clipper.TopX(d,b),d.Curr.Y=b);if(this.StrictlySimple&&(q=d.PrevInAEL,0<=d.OutIdx&&0!==d.WindDelta&&
null!==q&&0<=q.OutIdx&&q.Curr.X==d.Curr.X&&0!==q.WindDelta)){var n=new e.IntPoint(d.Curr);e.use_xyz&&this.SetZ(n,q,d);f=this.AddOutPt(q,n);q=this.AddOutPt(d,n);this.AddJoin(f,q,n)}d=d.NextInAEL}}this.ProcessHorizontals(!0);for(d=this.m_ActiveEdges;null!==d;)this.IsIntermediate(d,b)&&(f=null,0<=d.OutIdx&&(f=this.AddOutPt(d,d.Top)),d=this.UpdateEdgeIntoAEL(d),q=d.PrevInAEL,n=d.NextInAEL,null!==q&&q.Curr.X==d.Bot.X&&q.Curr.Y==d.Bot.Y&&null!==f&&0<=q.OutIdx&&q.Curr.Y>q.Top.Y&&e.ClipperBase.SlopesEqual(d,
q,this.m_UseFullRange)&&0!==d.WindDelta&&0!==q.WindDelta?(q=this.AddOutPt(q,d.Bot),this.AddJoin(f,q,d.Top)):null!==n&&n.Curr.X==d.Bot.X&&n.Curr.Y==d.Bot.Y&&null!==f&&0<=n.OutIdx&&n.Curr.Y>n.Top.Y&&e.ClipperBase.SlopesEqual(d,n,this.m_UseFullRange)&&0!==d.WindDelta&&0!==n.WindDelta&&(q=this.AddOutPt(n,d.Bot),this.AddJoin(f,q,d.Top))),d=d.NextInAEL};e.Clipper.prototype.DoMaxima=function(b){var d=this.GetMaximaPair(b);if(null===d)0<=b.OutIdx&&this.AddOutPt(b,b.Top),this.DeleteFromAEL(b);else{for(var f=
b.NextInAEL;null!==f&&f!=d;)this.IntersectEdges(b,f,b.Top),this.SwapPositionsInAEL(b,f),f=b.NextInAEL;-1==b.OutIdx&&-1==d.OutIdx?(this.DeleteFromAEL(b),this.DeleteFromAEL(d)):0<=b.OutIdx&&0<=d.OutIdx?(0<=b.OutIdx&&this.AddLocalMaxPoly(b,d,b.Top),this.DeleteFromAEL(b),this.DeleteFromAEL(d)):e.use_lines&&0===b.WindDelta?(0<=b.OutIdx&&(this.AddOutPt(b,b.Top),b.OutIdx=-1),this.DeleteFromAEL(b),0<=d.OutIdx&&(this.AddOutPt(d,b.Top),d.OutIdx=-1),this.DeleteFromAEL(d)):e.Error("DoMaxima error")}};e.Clipper.ReversePaths=
function(b){for(var d=0,f=b.length;d<f;d++)b[d].reverse()};e.Clipper.Orientation=function(b){return 0<=e.Clipper.Area(b)};e.Clipper.prototype.PointCount=function(b){if(null===b)return 0;var d=0,f=b;do d++,f=f.Next;while(f!=b);return d};e.Clipper.prototype.BuildResult=function(b){e.Clear(b);for(var d=0,f=this.m_PolyOuts.length;d<f;d++){var q=this.m_PolyOuts[d];if(null!==q.Pts){q=q.Pts.Prev;var n=this.PointCount(q);if(!(2>n)){for(var h=Array(n),v=0;v<n;v++)h[v]=q.Pt,q=q.Prev;b.push(h)}}}};e.Clipper.prototype.BuildResult2=
function(b){b.Clear();for(var d=0,f=this.m_PolyOuts.length;d<f;d++){var q=this.m_PolyOuts[d],n=this.PointCount(q.Pts);if(!(q.IsOpen&&2>n||!q.IsOpen&&3>n)){this.FixHoleLinkage(q);var h=new e.PolyNode;b.m_AllPolys.push(h);q.PolyNode=h;h.m_polygon.length=n;q=q.Pts.Prev;for(var v=0;v<n;v++)h.m_polygon[v]=q.Pt,q=q.Prev}}d=0;for(f=this.m_PolyOuts.length;d<f;d++)q=this.m_PolyOuts[d],null!==q.PolyNode&&(q.IsOpen?(q.PolyNode.IsOpen=!0,b.AddChild(q.PolyNode)):null!==q.FirstLeft&&null!=q.FirstLeft.PolyNode?
q.FirstLeft.PolyNode.AddChild(q.PolyNode):b.AddChild(q.PolyNode))};e.Clipper.prototype.FixupOutPolygon=function(b){var d=null;b.BottomPt=null;for(var f=b.Pts;;){if(f.Prev==f||f.Prev==f.Next){b.Pts=null;return}if(e.IntPoint.op_Equality(f.Pt,f.Next.Pt)||e.IntPoint.op_Equality(f.Pt,f.Prev.Pt)||e.ClipperBase.SlopesEqual(f.Prev.Pt,f.Pt,f.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(f.Prev.Pt,f.Pt,f.Next.Pt)))d=null,f.Prev.Next=f.Next,f=f.Next.Prev=f.Prev;else if(f==
d)break;else null===d&&(d=f),f=f.Next}b.Pts=f};e.Clipper.prototype.DupOutPt=function(b,d){var f=new e.OutPt;f.Pt.X=b.Pt.X;f.Pt.Y=b.Pt.Y;e.use_xyz&&(f.Pt.Z=b.Pt.Z);f.Idx=b.Idx;d?(f.Next=b.Next,f.Prev=b,b.Next.Prev=f,b.Next=f):(f.Prev=b.Prev,f.Next=b,b.Prev.Next=f,b.Prev=f);return f};e.Clipper.prototype.GetOverlap=function(b,d,f,e,n){b<d?f<e?(n.Left=Math.max(b,f),n.Right=Math.min(d,e)):(n.Left=Math.max(b,e),n.Right=Math.min(d,f)):f<e?(n.Left=Math.max(d,f),n.Right=Math.min(b,e)):(n.Left=Math.max(d,e),
n.Right=Math.min(b,f));return n.Left<n.Right};e.Clipper.prototype.JoinHorz=function(b,d,f,q,n,h){var v=b.Pt.X>d.Pt.X?e.Direction.dRightToLeft:e.Direction.dLeftToRight;q=f.Pt.X>q.Pt.X?e.Direction.dRightToLeft:e.Direction.dLeftToRight;if(v==q)return!1;if(v==e.Direction.dLeftToRight){for(;b.Next.Pt.X<=n.X&&b.Next.Pt.X>=b.Pt.X&&b.Next.Pt.Y==n.Y;)b=b.Next;h&&b.Pt.X!=n.X&&(b=b.Next);d=this.DupOutPt(b,!h);e.IntPoint.op_Inequality(d.Pt,n)&&(b=d,b.Pt.X=n.X,b.Pt.Y=n.Y,e.use_xyz&&(b.Pt.Z=n.Z),d=this.DupOutPt(b,
!h))}else{for(;b.Next.Pt.X>=n.X&&b.Next.Pt.X<=b.Pt.X&&b.Next.Pt.Y==n.Y;)b=b.Next;h||b.Pt.X==n.X||(b=b.Next);d=this.DupOutPt(b,h);e.IntPoint.op_Inequality(d.Pt,n)&&(b=d,b.Pt.X=n.X,b.Pt.Y=n.Y,e.use_xyz&&(b.Pt.Z=n.Z),d=this.DupOutPt(b,h))}if(q==e.Direction.dLeftToRight){for(;f.Next.Pt.X<=n.X&&f.Next.Pt.X>=f.Pt.X&&f.Next.Pt.Y==n.Y;)f=f.Next;h&&f.Pt.X!=n.X&&(f=f.Next);q=this.DupOutPt(f,!h);e.IntPoint.op_Inequality(q.Pt,n)&&(f=q,f.Pt.X=n.X,f.Pt.Y=n.Y,e.use_xyz&&(f.Pt.Z=n.Z),q=this.DupOutPt(f,!h))}else{for(;f.Next.Pt.X>=
n.X&&f.Next.Pt.X<=f.Pt.X&&f.Next.Pt.Y==n.Y;)f=f.Next;h||f.Pt.X==n.X||(f=f.Next);q=this.DupOutPt(f,h);e.IntPoint.op_Inequality(q.Pt,n)&&(f=q,f.Pt.X=n.X,f.Pt.Y=n.Y,e.use_xyz&&(f.Pt.Z=n.Z),q=this.DupOutPt(f,h))}v==e.Direction.dLeftToRight==h?(b.Prev=f,f.Next=b,d.Next=q,q.Prev=d):(b.Next=f,f.Prev=b,d.Prev=q,q.Next=d);return!0};e.Clipper.prototype.JoinPoints=function(b,d,f){var q=b.OutPt1,n;new e.OutPt;var h=b.OutPt2,v;new e.OutPt;if((v=b.OutPt1.Pt.Y==b.OffPt.Y)&&e.IntPoint.op_Equality(b.OffPt,b.OutPt1.Pt)&&
e.IntPoint.op_Equality(b.OffPt,b.OutPt2.Pt)){if(d!=f)return!1;for(n=b.OutPt1.Next;n!=q&&e.IntPoint.op_Equality(n.Pt,b.OffPt);)n=n.Next;n=n.Pt.Y>b.OffPt.Y;for(v=b.OutPt2.Next;v!=h&&e.IntPoint.op_Equality(v.Pt,b.OffPt);)v=v.Next;if(n==v.Pt.Y>b.OffPt.Y)return!1;n?(n=this.DupOutPt(q,!1),v=this.DupOutPt(h,!0),q.Prev=h,h.Next=q,n.Next=v,v.Prev=n):(n=this.DupOutPt(q,!0),v=this.DupOutPt(h,!1),q.Next=h,h.Prev=q,n.Prev=v,v.Next=n);b.OutPt1=q;b.OutPt2=n;return!0}if(v){for(n=q;q.Prev.Pt.Y==q.Pt.Y&&q.Prev!=n&&
q.Prev!=h;)q=q.Prev;for(;n.Next.Pt.Y==n.Pt.Y&&n.Next!=q&&n.Next!=h;)n=n.Next;if(n.Next==q||n.Next==h)return!1;for(v=h;h.Prev.Pt.Y==h.Pt.Y&&h.Prev!=v&&h.Prev!=n;)h=h.Prev;for(;v.Next.Pt.Y==v.Pt.Y&&v.Next!=h&&v.Next!=q;)v=v.Next;if(v.Next==h||v.Next==q)return!1;f={Left:null,Right:null};if(!this.GetOverlap(q.Pt.X,n.Pt.X,h.Pt.X,v.Pt.X,f))return!1;d=f.Left;var p=f.Right;f=new e.IntPoint;q.Pt.X>=d&&q.Pt.X<=p?(f.X=q.Pt.X,f.Y=q.Pt.Y,e.use_xyz&&(f.Z=q.Pt.Z),d=q.Pt.X>n.Pt.X):h.Pt.X>=d&&h.Pt.X<=p?(f.X=h.Pt.X,
f.Y=h.Pt.Y,e.use_xyz&&(f.Z=h.Pt.Z),d=h.Pt.X>v.Pt.X):n.Pt.X>=d&&n.Pt.X<=p?(f.X=n.Pt.X,f.Y=n.Pt.Y,e.use_xyz&&(f.Z=n.Pt.Z),d=n.Pt.X>q.Pt.X):(f.X=v.Pt.X,f.Y=v.Pt.Y,e.use_xyz&&(f.Z=v.Pt.Z),d=v.Pt.X>h.Pt.X);b.OutPt1=q;b.OutPt2=h;return this.JoinHorz(q,n,h,v,f,d)}for(n=q.Next;e.IntPoint.op_Equality(n.Pt,q.Pt)&&n!=q;)n=n.Next;if(p=n.Pt.Y>q.Pt.Y||!e.ClipperBase.SlopesEqual(q.Pt,n.Pt,b.OffPt,this.m_UseFullRange)){for(n=q.Prev;e.IntPoint.op_Equality(n.Pt,q.Pt)&&n!=q;)n=n.Prev;if(n.Pt.Y>q.Pt.Y||!e.ClipperBase.SlopesEqual(q.Pt,
n.Pt,b.OffPt,this.m_UseFullRange))return!1}for(v=h.Next;e.IntPoint.op_Equality(v.Pt,h.Pt)&&v!=h;)v=v.Next;var w=v.Pt.Y>h.Pt.Y||!e.ClipperBase.SlopesEqual(h.Pt,v.Pt,b.OffPt,this.m_UseFullRange);if(w){for(v=h.Prev;e.IntPoint.op_Equality(v.Pt,h.Pt)&&v!=h;)v=v.Prev;if(v.Pt.Y>h.Pt.Y||!e.ClipperBase.SlopesEqual(h.Pt,v.Pt,b.OffPt,this.m_UseFullRange))return!1}if(n==q||v==h||n==v||d==f&&p==w)return!1;p?(n=this.DupOutPt(q,!1),v=this.DupOutPt(h,!0),q.Prev=h,h.Next=q,n.Next=v,v.Prev=n):(n=this.DupOutPt(q,!0),
v=this.DupOutPt(h,!1),q.Next=h,h.Prev=q,n.Prev=v,v.Next=n);b.OutPt1=q;b.OutPt2=n;return!0};e.Clipper.GetBounds=function(b){for(var d=0,f=b.length;d<f&&0==b[d].length;)d++;if(d==f)return new e.IntRect(0,0,0,0);var q=new e.IntRect;q.left=b[d][0].X;q.right=q.left;q.top=b[d][0].Y;for(q.bottom=q.top;d<f;d++)for(var h=0,p=b[d].length;h<p;h++)b[d][h].X<q.left?q.left=b[d][h].X:b[d][h].X>q.right&&(q.right=b[d][h].X),b[d][h].Y<q.top?q.top=b[d][h].Y:b[d][h].Y>q.bottom&&(q.bottom=b[d][h].Y);return q};e.Clipper.prototype.GetBounds2=
function(b){var d=b,f=new e.IntRect;f.left=b.Pt.X;f.right=b.Pt.X;f.top=b.Pt.Y;f.bottom=b.Pt.Y;for(b=b.Next;b!=d;)b.Pt.X<f.left&&(f.left=b.Pt.X),b.Pt.X>f.right&&(f.right=b.Pt.X),b.Pt.Y<f.top&&(f.top=b.Pt.Y),b.Pt.Y>f.bottom&&(f.bottom=b.Pt.Y),b=b.Next;return f};e.Clipper.PointInPolygon=function(b,d){var f=0,e=d.length;if(3>e)return 0;for(var h=d[0],p=1;p<=e;++p){var v=p==e?d[0]:d[p];if(v.Y==b.Y&&(v.X==b.X||h.Y==b.Y&&v.X>b.X==h.X<b.X))return-1;if(h.Y<b.Y!=v.Y<b.Y)if(h.X>=b.X)if(v.X>b.X)f=1-f;else{var w=
(h.X-b.X)*(v.Y-b.Y)-(v.X-b.X)*(h.Y-b.Y);if(0==w)return-1;0<w==v.Y>h.Y&&(f=1-f)}else if(v.X>b.X){w=(h.X-b.X)*(v.Y-b.Y)-(v.X-b.X)*(h.Y-b.Y);if(0==w)return-1;0<w==v.Y>h.Y&&(f=1-f)}h=v}return f};e.Clipper.prototype.PointInPolygon=function(b,d){var f=0,e=d,h=b.X;b=b.Y;var p=d.Pt.X,v=d.Pt.Y;do{d=d.Next;var w=d.Pt.X,E=d.Pt.Y;if(E==b&&(w==h||v==b&&w>h==p<h))return-1;if(v<b!=E<b)if(p>=h)if(w>h)f=1-f;else{p=(p-h)*(E-b)-(w-h)*(v-b);if(0==p)return-1;0<p==E>v&&(f=1-f)}else if(w>h){p=(p-h)*(E-b)-(w-h)*(v-b);if(0==
p)return-1;0<p==E>v&&(f=1-f)}p=w;v=E}while(e!=d);return f};e.Clipper.prototype.Poly2ContainsPoly1=function(b,d){var f=b;do{var e=this.PointInPolygon(f.Pt,d);if(0<=e)return 0<e;f=f.Next}while(f!=b);return!0};e.Clipper.prototype.FixupFirstLefts1=function(b,d){for(var f=0,e=this.m_PolyOuts.length;f<e;f++){var h=this.m_PolyOuts[f];null!=h.Pts&&null!=h.FirstLeft&&this.ParseFirstLeft(h.FirstLeft)==b&&this.Poly2ContainsPoly1(h.Pts,d.Pts)&&(h.FirstLeft=d)}};e.Clipper.prototype.FixupFirstLefts2=function(b,
d){for(var f=0,e=this.m_PolyOuts,h=e.length,p=e[f];f<h;f++,p=e[f])p.FirstLeft==b&&(p.FirstLeft=d)};e.Clipper.ParseFirstLeft=function(b){for(;null!=b&&null==b.Pts;)b=b.FirstLeft;return b};e.Clipper.prototype.JoinCommonEdges=function(){for(var b=0,d=this.m_Joins.length;b<d;b++){var f=this.m_Joins[b],h=this.GetOutRec(f.OutPt1.Idx),n=this.GetOutRec(f.OutPt2.Idx);if(null!=h.Pts&&null!=n.Pts){var p=h==n?h:this.Param1RightOfParam2(h,n)?n:this.Param1RightOfParam2(n,h)?h:this.GetLowermostRec(h,n);if(this.JoinPoints(f,
h,n))if(h==n){h.Pts=f.OutPt1;h.BottomPt=null;n=this.CreateOutRec();n.Pts=f.OutPt2;this.UpdateOutPtIdxs(n);if(this.m_UsingPolyTree){p=0;for(var v=this.m_PolyOuts.length;p<v-1;p++){var w=this.m_PolyOuts[p];null!=w.Pts&&e.Clipper.ParseFirstLeft(w.FirstLeft)==h&&w.IsHole!=h.IsHole&&this.Poly2ContainsPoly1(w.Pts,f.OutPt2)&&(w.FirstLeft=n)}}this.Poly2ContainsPoly1(n.Pts,h.Pts)?(n.IsHole=!h.IsHole,n.FirstLeft=h,this.m_UsingPolyTree&&this.FixupFirstLefts2(n,h),(n.IsHole^this.ReverseSolution)==0<this.Area(n)&&
this.ReversePolyPtLinks(n.Pts)):this.Poly2ContainsPoly1(h.Pts,n.Pts)?(n.IsHole=h.IsHole,h.IsHole=!n.IsHole,n.FirstLeft=h.FirstLeft,h.FirstLeft=n,this.m_UsingPolyTree&&this.FixupFirstLefts2(h,n),(h.IsHole^this.ReverseSolution)==0<this.Area(h)&&this.ReversePolyPtLinks(h.Pts)):(n.IsHole=h.IsHole,n.FirstLeft=h.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(h,n))}else n.Pts=null,n.BottomPt=null,n.Idx=h.Idx,h.IsHole=p.IsHole,p==n&&(h.FirstLeft=n.FirstLeft),n.FirstLeft=h,this.m_UsingPolyTree&&this.FixupFirstLefts2(n,
h)}}};e.Clipper.prototype.UpdateOutPtIdxs=function(b){var d=b.Pts;do d.Idx=b.Idx,d=d.Prev;while(d!=b.Pts)};e.Clipper.prototype.DoSimplePolygons=function(){for(var b=0;b<this.m_PolyOuts.length;){var d=this.m_PolyOuts[b++],f=d.Pts;if(null!=f&&!d.IsOpen){do{for(var h=f.Next;h!=d.Pts;){if(e.IntPoint.op_Equality(f.Pt,h.Pt)&&h.Next!=f&&h.Prev!=f){var n=f.Prev,p=h.Prev;f.Prev=p;p.Next=f;h.Prev=n;n.Next=h;d.Pts=f;n=this.CreateOutRec();n.Pts=h;this.UpdateOutPtIdxs(n);this.Poly2ContainsPoly1(n.Pts,d.Pts)?(n.IsHole=
!d.IsHole,n.FirstLeft=d,this.m_UsingPolyTree&&this.FixupFirstLefts2(n,d)):this.Poly2ContainsPoly1(d.Pts,n.Pts)?(n.IsHole=d.IsHole,d.IsHole=!n.IsHole,n.FirstLeft=d.FirstLeft,d.FirstLeft=n,this.m_UsingPolyTree&&this.FixupFirstLefts2(d,n)):(n.IsHole=d.IsHole,n.FirstLeft=d.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(d,n));h=f}h=h.Next}f=f.Next}while(f!=d.Pts)}}};e.Clipper.Area=function(b){var d=b.length;if(3>d)return 0;for(var f=0,e=0,h=d-1;e<d;++e)f+=(b[h].X+b[e].X)*(b[h].Y-b[e].Y),h=e;return.5*
-f};e.Clipper.prototype.Area=function(b){var d=b.Pts;if(null==d)return 0;var f=0;do f+=(d.Prev.Pt.X+d.Pt.X)*(d.Prev.Pt.Y-d.Pt.Y),d=d.Next;while(d!=b.Pts);return.5*f};e.Clipper.SimplifyPolygon=function(b,d){var f=[],h=new e.Clipper(0);h.StrictlySimple=!0;h.AddPath(b,e.PolyType.ptSubject,!0);h.Execute(e.ClipType.ctUnion,f,d,d);return f};e.Clipper.SimplifyPolygons=function(b,d){"undefined"==typeof d&&(d=e.PolyFillType.pftEvenOdd);var f=[],h=new e.Clipper(0);h.StrictlySimple=!0;h.AddPaths(b,e.PolyType.ptSubject,
!0);h.Execute(e.ClipType.ctUnion,f,d,d);return f};e.Clipper.DistanceSqrd=function(b,d){var f=b.X-d.X;b=b.Y-d.Y;return f*f+b*b};e.Clipper.DistanceFromLineSqrd=function(b,d,f){var e=d.Y-f.Y;f=f.X-d.X;d=e*d.X+f*d.Y;d=e*b.X+f*b.Y-d;return d*d/(e*e+f*f)};e.Clipper.SlopesNearCollinear=function(b,d,f,h){return Math.abs(b.X-d.X)>Math.abs(b.Y-d.Y)?b.X>d.X==b.X<f.X?e.Clipper.DistanceFromLineSqrd(b,d,f)<h:d.X>b.X==d.X<f.X?e.Clipper.DistanceFromLineSqrd(d,b,f)<h:e.Clipper.DistanceFromLineSqrd(f,b,d)<h:b.Y>d.Y==
b.Y<f.Y?e.Clipper.DistanceFromLineSqrd(b,d,f)<h:d.Y>b.Y==d.Y<f.Y?e.Clipper.DistanceFromLineSqrd(d,b,f)<h:e.Clipper.DistanceFromLineSqrd(f,b,d)<h};e.Clipper.PointsAreClose=function(b,d,f){var e=b.X-d.X;b=b.Y-d.Y;return e*e+b*b<=f};e.Clipper.ExcludeOp=function(b){var d=b.Prev;d.Next=b.Next;b.Next.Prev=d;d.Idx=0;return d};e.Clipper.CleanPolygon=function(b,d){"undefined"==typeof d&&(d=1.415);var f=b.length;if(0==f)return[];for(var h=Array(f),n=0;n<f;++n)h[n]=new e.OutPt;for(n=0;n<f;++n)h[n].Pt=b[n],h[n].Next=
h[(n+1)%f],h[n].Next.Prev=h[n],h[n].Idx=0;n=d*d;for(h=h[0];0==h.Idx&&h.Next!=h.Prev;)e.Clipper.PointsAreClose(h.Pt,h.Prev.Pt,n)?(h=e.Clipper.ExcludeOp(h),f--):e.Clipper.PointsAreClose(h.Prev.Pt,h.Next.Pt,n)?(e.Clipper.ExcludeOp(h.Next),h=e.Clipper.ExcludeOp(h),f-=2):e.Clipper.SlopesNearCollinear(h.Prev.Pt,h.Pt,h.Next.Pt,n)?(h=e.Clipper.ExcludeOp(h),f--):(h.Idx=1,h=h.Next);3>f&&(f=0);b=Array(f);for(n=0;n<f;++n)b[n]=new e.IntPoint(h.Pt),h=h.Next;return b};e.Clipper.CleanPolygons=function(b,d){for(var f=
Array(b.length),h=0,n=b.length;h<n;h++)f[h]=e.Clipper.CleanPolygon(b[h],d);return f};e.Clipper.Minkowski=function(b,d,f,h){h=h?1:0;var n=b.length,q=d.length,p=[];if(f)for(f=0;f<q;f++){for(var w=Array(n),E=0,H=b.length,I=b[E];E<H;E++,I=b[E])w[E]=new e.IntPoint(d[f].X+I.X,d[f].Y+I.Y);p.push(w)}else for(f=0;f<q;f++){w=Array(n);E=0;H=b.length;for(I=b[E];E<H;E++,I=b[E])w[E]=new e.IntPoint(d[f].X-I.X,d[f].Y-I.Y);p.push(w)}b=[];for(f=0;f<q-1+h;f++)for(E=0;E<n;E++)d=[],d.push(p[f%q][E%n]),d.push(p[(f+1)%
q][E%n]),d.push(p[(f+1)%q][(E+1)%n]),d.push(p[f%q][(E+1)%n]),e.Clipper.Orientation(d)||d.reverse(),b.push(d);return b};e.Clipper.MinkowskiSum=function(b,d,f){if(d[0]instanceof Array){v=d;d=new e.Paths;for(var h=new e.Clipper,n=0;n<v.length;++n){var p=e.Clipper.Minkowski(b,v[n],!0,f);h.AddPaths(p,e.PolyType.ptSubject,!0);f&&(p=e.Clipper.TranslatePath(v[n],b[0]),h.AddPath(p,e.PolyType.ptClip,!0))}h.Execute(e.ClipType.ctUnion,d,e.PolyFillType.pftNonZero,e.PolyFillType.pftNonZero);return d}var v=e.Clipper.Minkowski(b,
d,!0,f);h=new e.Clipper;h.AddPaths(v,e.PolyType.ptSubject,!0);h.Execute(e.ClipType.ctUnion,v,e.PolyFillType.pftNonZero,e.PolyFillType.pftNonZero);return v};e.Clipper.TranslatePath=function(b,d){for(var f=new e.Path,h=0;h<b.length;h++)f.push(new e.IntPoint(b[h].X+d.X,b[h].Y+d.Y));return f};e.Clipper.MinkowskiDiff=function(b,d){b=e.Clipper.Minkowski(b,d,!1,!0);d=new e.Clipper;d.AddPaths(b,e.PolyType.ptSubject,!0);d.Execute(e.ClipType.ctUnion,b,e.PolyFillType.pftNonZero,e.PolyFillType.pftNonZero);return b};
e.Clipper.PolyTreeToPaths=function(b){var d=[];e.Clipper.AddPolyNodeToPaths(b,e.Clipper.NodeType.ntAny,d);return d};e.Clipper.AddPolyNodeToPaths=function(b,d,f){var h=!0;switch(d){case e.Clipper.NodeType.ntOpen:return;case e.Clipper.NodeType.ntClosed:h=!b.IsOpen}0<b.m_polygon.length&&h&&f.push(b.m_polygon);h=0;b=b.Childs();for(var n=b.length,p=b[h];h<n;h++,p=b[h])e.Clipper.AddPolyNodeToPaths(p,d,f)};e.Clipper.OpenPathsFromPolyTree=function(b){for(var d=new e.Paths,f=0,h=b.ChildCount();f<h;f++)b.Childs()[f].IsOpen&&
d.push(b.Childs()[f].m_polygon);return d};e.Clipper.ClosedPathsFromPolyTree=function(b){var d=new e.Paths;e.Clipper.AddPolyNodeToPaths(b,e.Clipper.NodeType.ntClosed,d);return d};H(e.Clipper,e.ClipperBase);e.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2};e.ClipperOffset=function(b,d){"undefined"==typeof b&&(b=2);"undefined"==typeof d&&(d=e.ClipperOffset.def_arc_tolerance);this.m_destPolys=new e.Paths;this.m_srcPoly=new e.Path;this.m_destPoly=new e.Path;this.m_normals=[];this.m_StepsPerRad=this.m_miterLim=
this.m_cos=this.m_sin=this.m_sinA=this.m_delta=0;this.m_lowest=new e.IntPoint;this.m_polyNodes=new e.PolyNode;this.MiterLimit=b;this.ArcTolerance=d;this.m_lowest.X=-1};e.ClipperOffset.two_pi=6.28318530717959;e.ClipperOffset.def_arc_tolerance=.25;e.ClipperOffset.prototype.Clear=function(){e.Clear(this.m_polyNodes.Childs());this.m_lowest.X=-1};e.ClipperOffset.Round=e.Clipper.Round;e.ClipperOffset.prototype.AddPath=function(b,d,f){var h=b.length-1;if(!(0>h)){var n=new e.PolyNode;n.m_jointype=d;n.m_endtype=
f;if(f==e.EndType.etClosedLine||f==e.EndType.etClosedPolygon)for(;0<h&&e.IntPoint.op_Equality(b[0],b[h]);)h--;n.m_polygon.push(b[0]);var p=0;d=0;for(var v=1;v<=h;v++)e.IntPoint.op_Inequality(n.m_polygon[p],b[v])&&(p++,n.m_polygon.push(b[v]),b[v].Y>n.m_polygon[d].Y||b[v].Y==n.m_polygon[d].Y&&b[v].X<n.m_polygon[d].X)&&(d=p);if(!(f==e.EndType.etClosedPolygon&&2>p)&&(this.m_polyNodes.AddChild(n),f==e.EndType.etClosedPolygon))if(0>this.m_lowest.X)this.m_lowest=new e.IntPoint(this.m_polyNodes.ChildCount()-
1,d);else if(b=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],n.m_polygon[d].Y>b.Y||n.m_polygon[d].Y==b.Y&&n.m_polygon[d].X<b.X)this.m_lowest=new e.IntPoint(this.m_polyNodes.ChildCount()-1,d)}};e.ClipperOffset.prototype.AddPaths=function(b,d,f){for(var e=0,h=b.length;e<h;e++)this.AddPath(b[e],d,f)};e.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!e.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var b=0;b<this.m_polyNodes.ChildCount();b++){var d=
this.m_polyNodes.Childs()[b];(d.m_endtype==e.EndType.etClosedPolygon||d.m_endtype==e.EndType.etClosedLine&&e.Clipper.Orientation(d.m_polygon))&&d.m_polygon.reverse()}else for(b=0;b<this.m_polyNodes.ChildCount();b++)d=this.m_polyNodes.Childs()[b],d.m_endtype!=e.EndType.etClosedLine||e.Clipper.Orientation(d.m_polygon)||d.m_polygon.reverse()};e.ClipperOffset.GetUnitNormal=function(b,d){var f=d.X-b.X;b=d.Y-b.Y;if(0==f&&0==b)return new e.DoublePoint(0,0);d=1/Math.sqrt(f*f+b*b);return new e.DoublePoint(b*
d,-(f*d))};e.ClipperOffset.prototype.DoOffset=function(b){this.m_destPolys=[];this.m_delta=b;if(e.ClipperBase.near_zero(b))for(var d=0;d<this.m_polyNodes.ChildCount();d++){var f=this.m_polyNodes.Childs()[d];f.m_endtype==e.EndType.etClosedPolygon&&this.m_destPolys.push(f.m_polygon)}else{this.m_miterLim=2<this.MiterLimit?2/(this.MiterLimit*this.MiterLimit):.5;var h=3.14159265358979/Math.acos(1-(0>=this.ArcTolerance?e.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(b)*e.ClipperOffset.def_arc_tolerance?
Math.abs(b)*e.ClipperOffset.def_arc_tolerance:this.ArcTolerance)/Math.abs(b));this.m_sin=Math.sin(e.ClipperOffset.two_pi/h);this.m_cos=Math.cos(e.ClipperOffset.two_pi/h);this.m_StepsPerRad=h/e.ClipperOffset.two_pi;0>b&&(this.m_sin=-this.m_sin);for(d=0;d<this.m_polyNodes.ChildCount();d++){f=this.m_polyNodes.Childs()[d];this.m_srcPoly=f.m_polygon;var n=this.m_srcPoly.length;if(!(0==n||0>=b&&(3>n||f.m_endtype!=e.EndType.etClosedPolygon))){this.m_destPoly=[];if(1==n)if(f.m_jointype==e.JoinType.jtRound){f=
1;n=0;for(var p=1;p<=h;p++){this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[0].X+f*b),e.ClipperOffset.Round(this.m_srcPoly[0].Y+n*b)));var v=f;f=f*this.m_cos-this.m_sin*n;n=v*this.m_sin+n*this.m_cos}}else for(n=f=-1,p=0;4>p;++p)this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[0].X+f*b),e.ClipperOffset.Round(this.m_srcPoly[0].Y+n*b))),0>f?f=1:0>n?n=1:f=-1;else{for(p=this.m_normals.length=0;p<n-1;p++)this.m_normals.push(e.ClipperOffset.GetUnitNormal(this.m_srcPoly[p],
this.m_srcPoly[p+1]));f.m_endtype==e.EndType.etClosedLine||f.m_endtype==e.EndType.etClosedPolygon?this.m_normals.push(e.ClipperOffset.GetUnitNormal(this.m_srcPoly[n-1],this.m_srcPoly[0])):this.m_normals.push(new e.DoublePoint(this.m_normals[n-2]));if(f.m_endtype==e.EndType.etClosedPolygon)for(v=n-1,p=0;p<n;p++)v=this.OffsetPoint(p,v,f.m_jointype);else if(f.m_endtype==e.EndType.etClosedLine){v=n-1;for(p=0;p<n;p++)v=this.OffsetPoint(p,v,f.m_jointype);this.m_destPolys.push(this.m_destPoly);this.m_destPoly=
[];v=this.m_normals[n-1];for(p=n-1;0<p;p--)this.m_normals[p]=new e.DoublePoint(-this.m_normals[p-1].X,-this.m_normals[p-1].Y);this.m_normals[0]=new e.DoublePoint(-v.X,-v.Y);v=0;for(p=n-1;0<=p;p--)v=this.OffsetPoint(p,v,f.m_jointype)}else{v=0;for(p=1;p<n-1;++p)v=this.OffsetPoint(p,v,f.m_jointype);f.m_endtype==e.EndType.etOpenButt?(p=n-1,v=new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[p].X+this.m_normals[p].X*b),e.ClipperOffset.Round(this.m_srcPoly[p].Y+this.m_normals[p].Y*b)),this.m_destPoly.push(v),
v=new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[p].X-this.m_normals[p].X*b),e.ClipperOffset.Round(this.m_srcPoly[p].Y-this.m_normals[p].Y*b)),this.m_destPoly.push(v)):(p=n-1,v=n-2,this.m_sinA=0,this.m_normals[p]=new e.DoublePoint(-this.m_normals[p].X,-this.m_normals[p].Y),f.m_endtype==e.EndType.etOpenSquare?this.DoSquare(p,v):this.DoRound(p,v));for(p=n-1;0<p;p--)this.m_normals[p]=new e.DoublePoint(-this.m_normals[p-1].X,-this.m_normals[p-1].Y);this.m_normals[0]=new e.DoublePoint(-this.m_normals[1].X,
-this.m_normals[1].Y);v=n-1;for(p=v-1;0<p;--p)v=this.OffsetPoint(p,v,f.m_jointype);f.m_endtype==e.EndType.etOpenButt?(v=new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*b),e.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*b)),this.m_destPoly.push(v),v=new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*b),e.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*b)),this.m_destPoly.push(v)):(this.m_sinA=0,f.m_endtype==e.EndType.etOpenSquare?
this.DoSquare(0,1):this.DoRound(0,1))}}this.m_destPolys.push(this.m_destPoly)}}}};e.ClipperOffset.prototype.Execute=function(){var b=arguments;if(b[0]instanceof e.PolyTree)if(d=b[0],f=b[1],d.Clear(),this.FixOrientations(),this.DoOffset(f),b=new e.Clipper(0),b.AddPaths(this.m_destPolys,e.PolyType.ptSubject,!0),0<f)b.Execute(e.ClipType.ctUnion,d,e.PolyFillType.pftPositive,e.PolyFillType.pftPositive);else if(f=e.Clipper.GetBounds(this.m_destPolys),h=new e.Path,h.push(new e.IntPoint(f.left-10,f.bottom+
10)),h.push(new e.IntPoint(f.right+10,f.bottom+10)),h.push(new e.IntPoint(f.right+10,f.top-10)),h.push(new e.IntPoint(f.left-10,f.top-10)),b.AddPath(h,e.PolyType.ptSubject,!0),b.ReverseSolution=!0,b.Execute(e.ClipType.ctUnion,d,e.PolyFillType.pftNegative,e.PolyFillType.pftNegative),1==d.ChildCount()&&0<d.Childs()[0].ChildCount())for(b=d.Childs()[0],d.Childs()[0]=b.Childs()[0],d.Childs()[0].m_Parent=d,f=1;f<b.ChildCount();f++)d.AddChild(b.Childs()[f]);else d.Clear();else{var d=b[0],f=b[1];e.Clear(d);
this.FixOrientations();this.DoOffset(f);b=new e.Clipper(0);b.AddPaths(this.m_destPolys,e.PolyType.ptSubject,!0);if(0<f)b.Execute(e.ClipType.ctUnion,d,e.PolyFillType.pftPositive,e.PolyFillType.pftPositive);else{f=e.Clipper.GetBounds(this.m_destPolys);var h=new e.Path;h.push(new e.IntPoint(f.left-10,f.bottom+10));h.push(new e.IntPoint(f.right+10,f.bottom+10));h.push(new e.IntPoint(f.right+10,f.top-10));h.push(new e.IntPoint(f.left-10,f.top-10));b.AddPath(h,e.PolyType.ptSubject,!0);b.ReverseSolution=
!0;b.Execute(e.ClipType.ctUnion,d,e.PolyFillType.pftNegative,e.PolyFillType.pftNegative);0<d.length&&d.splice(0,1)}}};e.ClipperOffset.prototype.OffsetPoint=function(b,d,f){this.m_sinA=this.m_normals[d].X*this.m_normals[b].Y-this.m_normals[b].X*this.m_normals[d].Y;if(1>Math.abs(this.m_sinA*this.m_delta)){if(0<this.m_normals[d].X*this.m_normals[b].X+this.m_normals[b].Y*this.m_normals[d].Y)return this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[d].X*this.m_delta),
e.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[d].Y*this.m_delta))),d}else 1<this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1);if(0>this.m_sinA*this.m_delta)this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[d].X*this.m_delta),e.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[d].Y*this.m_delta))),this.m_destPoly.push(new e.IntPoint(this.m_srcPoly[b])),this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[b].X*
this.m_delta),e.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[b].Y*this.m_delta)));else switch(f){case e.JoinType.jtMiter:f=1+(this.m_normals[b].X*this.m_normals[d].X+this.m_normals[b].Y*this.m_normals[d].Y);f>=this.m_miterLim?this.DoMiter(b,d,f):this.DoSquare(b,d);break;case e.JoinType.jtSquare:this.DoSquare(b,d);break;case e.JoinType.jtRound:this.DoRound(b,d)}return b};e.ClipperOffset.prototype.DoSquare=function(b,d){var f=Math.tan(Math.atan2(this.m_sinA,this.m_normals[d].X*this.m_normals[b].X+
this.m_normals[d].Y*this.m_normals[b].Y)/4);this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_delta*(this.m_normals[d].X-this.m_normals[d].Y*f)),e.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_delta*(this.m_normals[d].Y+this.m_normals[d].X*f))));this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_delta*(this.m_normals[b].X+this.m_normals[b].Y*f)),e.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_delta*(this.m_normals[b].Y-this.m_normals[b].X*
f))))};e.ClipperOffset.prototype.DoMiter=function(b,d,f){f=this.m_delta/f;this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[b].X+(this.m_normals[d].X+this.m_normals[b].X)*f),e.ClipperOffset.Round(this.m_srcPoly[b].Y+(this.m_normals[d].Y+this.m_normals[b].Y)*f)))};e.ClipperOffset.prototype.DoRound=function(b,d){var f=Math.max(e.Cast_Int32(e.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(Math.atan2(this.m_sinA,this.m_normals[d].X*this.m_normals[b].X+this.m_normals[d].Y*this.m_normals[b].Y)))),
1),h=this.m_normals[d].X;d=this.m_normals[d].Y;for(var n,p=0;p<f;++p)this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[b].X+h*this.m_delta),e.ClipperOffset.Round(this.m_srcPoly[b].Y+d*this.m_delta))),n=h,h=h*this.m_cos-this.m_sin*d,d=n*this.m_sin+d*this.m_cos;this.m_destPoly.push(new e.IntPoint(e.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[b].X*this.m_delta),e.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[b].Y*this.m_delta)))};e.Error=function(b){try{throw Error(b);
}catch(d){alert(d.message)}};e.JS={};e.JS.AreaOfPolygon=function(b,d){d||(d=1);return e.Clipper.Area(b)/(d*d)};e.JS.AreaOfPolygons=function(b,d){d||(d=1);for(var f=0,h=0;h<b.length;h++)f+=e.Clipper.Area(b[h]);return f/(d*d)};e.JS.BoundsOfPath=function(b,d){return e.JS.BoundsOfPaths([b],d)};e.JS.BoundsOfPaths=function(b,d){d||(d=1);b=e.Clipper.GetBounds(b);b.left/=d;b.bottom/=d;b.right/=d;b.top/=d;return b};e.JS.Clean=function(b,d){if(!(b instanceof Array))return[];var f=b[0]instanceof Array;b=e.JS.Clone(b);
if("number"!=typeof d||null===d)return e.Error("Delta is not a number in Clean()."),b;if(0===b.length||1==b.length&&0===b[0].length||0>d)return b;f||(b=[b]);for(var h=b.length,n,p,v,w,E,H,I,K=[],X=0;X<h;X++)if(p=b[X],n=p.length,0!==n)if(3>n)v=p,K.push(v);else{v=p;w=d*d;E=p[0];for(I=H=1;I<n;I++)(p[I].X-E.X)*(p[I].X-E.X)+(p[I].Y-E.Y)*(p[I].Y-E.Y)<=w||(v[H]=p[I],E=p[I],H++);E=p[H-1];(p[0].X-E.X)*(p[0].X-E.X)+(p[0].Y-E.Y)*(p[0].Y-E.Y)<=w&&H--;H<n&&v.splice(H,n-H);v.length&&K.push(v)}!f&&K.length?K=K[0]:
f||0!==K.length?f&&0===K.length&&(K=[[]]):K=[];return K};e.JS.Clone=function(b){if(!(b instanceof Array)||0===b.length)return[];if(1==b.length&&0===b[0].length)return[[]];var d=b[0]instanceof Array;d||(b=[b]);var f=b.length,e,h,p=Array(f);for(e=0;e<f;e++){var v=b[e].length;var w=Array(v);for(h=0;h<v;h++)w[h]={X:b[e][h].X,Y:b[e][h].Y};p[e]=w}d||(p=p[0]);return p};e.JS.Lighten=function(b,d){if(!(b instanceof Array))return[];if("number"!=typeof d||null===d)return e.Error("Tolerance is not a number in Lighten()."),
e.JS.Clone(b);if(0===b.length||1==b.length&&0===b[0].length||0>d)return e.JS.Clone(b);b[0]instanceof Array||(b=[b]);var f,h,n,p,v,w=b.length,E=d*d,H=[];for(d=0;d<w;d++)if(h=b[d],p=h.length,0!=p){for(n=0;1E6>n;n++){var I=[];p=h.length;h[p-1].X!=h[0].X||h[p-1].Y!=h[0].Y?(v=1,h.push({X:h[0].X,Y:h[0].Y}),p=h.length):v=0;var K=[];for(f=0;f<p-2;f++){var X=h[f];var ia=h[f+1];var W=h[f+2];var pa=X.X;var la=X.Y;X=W.X-pa;var ba=W.Y-la;if(0!==X||0!==ba){var ka=((ia.X-pa)*X+(ia.Y-la)*ba)/(X*X+ba*ba);1<ka?(pa=
W.X,la=W.Y):0<ka&&(pa+=X*ka,la+=ba*ka)}X=ia.X-pa;ba=ia.Y-la;W=X*X+ba*ba;W<=E&&(K[f+1]=1,f++)}I.push({X:h[0].X,Y:h[0].Y});for(f=1;f<p-1;f++)K[f]||I.push({X:h[f].X,Y:h[f].Y});I.push({X:h[p-1].X,Y:h[p-1].Y});v&&h.pop();if(K.length)h=I;else break}p=I.length;I[p-1].X==I[0].X&&I[p-1].Y==I[0].Y&&I.pop();2<I.length&&H.push(I)}b[0]instanceof Array||(H=H[0]);"undefined"==typeof H&&(H=[[]]);return H};e.JS.PerimeterOfPath=function(b,d,f){if("undefined"==typeof b)return 0;var e=Math.sqrt,h=0,p=b.length;if(2>p)return 0;
for(d&&(b[p]=b[0],p++);--p;){var v=b[p];var w=v.X;v=v.Y;var E=b[p-1];var H=E.X;E=E.Y;h+=e((w-H)*(w-H)+(v-E)*(v-E))}d&&b.pop();return h/f};e.JS.PerimeterOfPaths=function(b,d,f){f||(f=1);for(var h=0,n=0;n<b.length;n++)h+=e.JS.PerimeterOfPath(b[n],d,f);return h};e.JS.ScaleDownPath=function(b,d){var f;d||(d=1);for(f=b.length;f--;){var e=b[f];e.X/=d;e.Y/=d}};e.JS.ScaleDownPaths=function(b,d){var f,e;d||(d=1);for(f=b.length;f--;)for(e=b[f].length;e--;){var h=b[f][e];h.X/=d;h.Y/=d}};e.JS.ScaleUpPath=function(b,
d){var f,e=Math.round;d||(d=1);for(f=b.length;f--;){var h=b[f];h.X=e(h.X*d);h.Y=e(h.Y*d)}};e.JS.ScaleUpPaths=function(b,d){var f,e,h=Math.round;d||(d=1);for(f=b.length;f--;)for(e=b[f].length;e--;){var p=b[f][e];p.X=h(p.X*d);p.Y=h(p.Y*d)}};e.ExPolygons=function(){return[]};e.ExPolygon=function(){this.holes=this.outer=null};e.JS.AddOuterPolyNodeToExPolygons=function(b,d){var f=new e.ExPolygon;f.outer=b.Contour();b=b.Childs();var h=b.length;f.holes=Array(h);var n,p;for(n=0;n<h;n++){var v=b[n];f.holes[n]=
v.Contour();var w=0;var E=v.Childs();for(p=E.length;w<p;w++)v=E[w],e.JS.AddOuterPolyNodeToExPolygons(v,d)}d.push(f)};e.JS.ExPolygonsToPaths=function(b){var d,f,h=new e.Paths;var n=0;for(d=b.length;n<d;n++){h.push(b[n].outer);var p=0;for(f=b[n].holes.length;p<f;p++)h.push(b[n].holes[p])}return h};e.JS.PolyTreeToExPolygons=function(b){var d=new e.ExPolygons,f;var h=0;var n=b.Childs();for(f=n.length;h<f;h++)b=n[h],e.JS.AddOuterPolyNodeToExPolygons(b,d);return d}})();
var CindyJS=function(){function w(h){if(0===ba)return console.error("Waiting for "+h+" after we finished waiting."),function(){};0>ba&&(ba=0);++ba;return function(){--ba;0>ba&&console.error("Wait count mismatch: "+h);if(0===ba)for(var p=0,w=Aa.length;p<w;)Aa[p++].startup()}}function E(h){var p=E.newInstance(h);0>=ba?p.startup():!1!==h.autostart&&Aa.push(p);return p}var ba=-1,Aa=[];"undefined"===typeof document||"undefined"===typeof window||"undefined"===typeof document.addEventListener||"undefined"!==
typeof window.cindyDontWait&&!0===window.cindyDontWait||document.addEventListener("DOMContentLoaded",w("DOMContentLoaded"));var ra=null,Ka=null,ka={};E.getBaseDir=function(){if(null!==ra)return ra;for(var h=document.getElementsByTagName("script"),w=0;w<h.length;++w){var E=h[w],pa=E.src;if(pa){var ia=/Cindy\.js$/.exec(pa);if(ia)return ra=pa.substr(0,ia.index),console.log("Will load extensions from "+ra),Ka=E,ra}}console.error("Could not find <script> tag for Cindy.js");return ra=Ka=!1};E.addNewScript=
function(h,w){w||console.error.bind(console);var p=E.getBaseDir();if(!1===p)return!1;w=document.createElement("script");w.src=p+h;h=Ka.nextSibling;p=Ka.parentElement;h?p.insertBefore(w,h):p.appendChild(w);return w};E.loadScript=function(h,w,K,pa){for(var p=String(h).split("."),X=window;p.length&&"object"===typeof X&&null!==X;)X=X[p.shift()];if(X&&!p.length)return K(),!0;pa||(pa=console.error.bind(console));p=ka[h];if(!p){p=E.addNewScript(w,pa);if(!1===p)return pa("Can't load additional components."),
!1;ka[h]=p}p.addEventListener("load",K);p.addEventListener("error",pa);return null};E._autoLoadingPlugin={};E.autoLoadPlugin=function(h,w,K){if(E._pluginRegistry[h])return K(),!0;var p=E._autoLoadingPlugin[h];if(!p){w||(w=h+"-plugin.js");p=E._autoLoadingPlugin[h]=[];h=E.addNewScript(w);if(!1===h)return!1;h.addEventListener("error",console.error.bind(console))}p.push(K);return null};var h={ctype:"undefined"};E.waitFor=w;E._pluginRegistry={};E.instances=[];E.registerPlugin=function(h,w,K){if(1!==h)return console.error("Plugin API version "+
h+" not supported"),!1;E._pluginRegistry[w]=K;(E._autoLoadingPlugin[w]||[]).forEach(function(h){h()})};var Ta=0;E.dumpState=function(h){h=E.instances[h||0].saveState();console.log(JSON.stringify(h))};E.debugState=function(h){E.instances.map(function(h){var p=h.config;p=JSON.parse(JSON.stringify(p));var w=h.saveState();console.log(JSON.stringify(w));for(var E in w)p[E]=w[E];h.shutdown();return p}).forEach(function(h){E(h)})};E.newInstance=function(p){function w(){qa.width=ca=qa.clientWidth;qa.height=
da=qa.clientHeight;A.setTransform(1,0,0,1,0,0);y.setMat(25,0,0,25,250.5,250.5);if(Eb)for(var a=0;a<Eb.length;a++){var c=Eb[a],m=Object.keys(c)[0];"scale"===m&&(Vb=c.scale,y[m](c.scale));if("translate"===m)y[m](c.translate[0],c.translate[1]);"scaleAndOrigin"===m&&(Vb=c[m][0]/25,y[m].apply(null,c[m]));"visibleRect"===m&&(y[m].apply(null,c[m]),Vb=y.drawingstate.initialmatrix.a/25)}y.createnewbackup();y.greset();a=1;"undefined"!==typeof window&&window.devicePixelRatio&&(a=window.devicePixelRatio);c=A.webkitBackingStorePixelRatio||
A.mozBackingStorePixelRatio||A.msBackingStorePixelRatio||A.oBackingStorePixelRatio||A.backingStorePixelRatio||1;a!==c&&(a/=c,qa.width=ca*a,qa.height=da*a,A.scale(a,a))}function E(a){if("canvas"!==a.tagName.toLowerCase()){var c=a;for(qa=document.createElement("canvas");c.firstChild;)c.removeChild(c.firstChild)}else{qa=a;c=document.createElement("div");var m=null,D=null;Array.prototype.slice.call(qa.attributes).forEach(function(a){"width"===a.name?m=a.value:"height"===a.name?D=a.value:c.setAttributeNodeNS(qa.removeAttributeNode(a))});
null===m||c.style.width||(c.style.width=m+"px");null===D||c.style.height||(c.style.height=D+"px");qa.parentNode.replaceChild(c,qa)}c.classList.add("CindyJS-widget");a=qa.style;a.position="absolute";a.border="none";a.margin=a.padding=a.left=a.top="0px";a.width=a.height="100%";a="static";window.getComputedStyle&&(a=window.getComputedStyle(c).getPropertyValue("position"),a=String(a||"static"));"static"===a&&(c.style.position="relative");c.appendChild(qa);return qa}function ba(){var a=p.cinderella;if(!a||
!a.version)return!1;for(var c=0;c<arguments.length;++c){var m=a.version[c],D=arguments[c];if(m!==D)return typeof m===typeof D&&m<D}return!1}function ia(){nc=!0;if(0===Wb){if(p.exclusive)for(b=xa.instances.length;0<b;)xa.instances[--b].shutdown();void 0!==p.csconsole&&(ya=p.csconsole);ya=null===ya?new wa:!0===ya?new Tb:"string"===typeof ya?new gb(ya):"object"===typeof ya&&"function"===typeof ya.appendChild?new gb(ya):new wa;ta=[100,100];var a=null;Eb=p.transform;if(p.ports&&0<p.ports.length){b=p.ports[0];
(a=b.element)||(a=document.getElementById(b.id));a=E(a);var c=a.parentNode.style;"window"===b.fill?(c.width="100vw",c.height="100vh"):"parent"===b.fill?(c.width="100%",c.height="100%"):b.width&&b.height&&(c.width=b.width+"px",c.height=b.height+"px");b.background&&(a.style.backgroundColor=b.background);void 0!==b.transform&&(Eb=b.transform);La(b.grid)&&0<b.grid&&(Ca=b.grid);La(b.tgrid)&&0<b.tgrid&&(oc=b.tgrid);b.snap&&(Fb=!0);b.axes&&(Gb=!0)}a||(a=p.canvas,a||"undefined"===typeof document||(a=document.getElementById(p.canvasname))&&
(a=E(a)));a&&(qa=a,A=a.getContext("2d"),w(),A.setLineDash||(A.setLineDash=function(){}),(p.animation?p.animation.controls:p.animcontrols)&&ka(p),p.animation&&La(p.animation.speed)&&(void 0===p.animation.accuracy&&ba(2,9,1875)?Ba(.5*p.animation.speed):Ba(p.animation.speed)),p.animation&&La(p.animation.accuracy)&&(Xb=p.animation.accuracy));p.statusbar&&(pc="string"===typeof p.statusbar?document.getElementById(p.statusbar):p.statusbar);var m=p.scripts,D=null;"string"===typeof m&&m.search(/\*/)&&(D=m);
"object"!==typeof m&&(m=null);"move keydown keyup keytyped keytype mousedown mouseup mousedrag mousemove mouseclick init tick draw simulationstep simulationstart simulationstop ondrop".split(" ").forEach(function(a){if(null!==m&&m[a])var c=m[a];else{c=a+"script";if(p[c])c=document.getElementById(p[c]);else if(D){if(c=document.getElementById(D.replace(/\*/,a)),!c)return}else return;c=c.text}c=Wa(c,!1);"error"===c.ctype?console.error("Error compiling "+a+" script: "+c.message):S[a]=Wd(c,a)});ba(2,9,
1888)&&!S.keydown&&(S.keydown=S.keytyped,S.keytyped=S.keytype,S.keytype=void 0);La(p.grid)&&0<p.grid&&(Ca=p.grid);p.snap&&(Fb=!0);t={};var b=0;cb={};p.geometry||(p.geometry=[]);Xd(p.geometry);p.behavior||(p.behavior=[]);"function"===typeof qc&&qc(p.behavior);for(var d in p.images)b=la(p.images[d],!1),b!==h&&(cb[d]=b);for(var g in p.videos)d=la(p.videos[g],!0),d!==h&&(cb[g]=d);ua.canvas=a;if(p.oninit)p.oninit(ua);xa.instances.push(ua);p.use&&p.use.forEach(function(a){r.use$1([u.wrap(a)],{})});hb.convexhull3d$1&&
ra("QuickHull3D","QuickHull3D.js");(hb.colorplot$1||hb.colorplot$2||hb.colorplot$3||hb.colorplot$4)&&ra("CindyGL","CindyGL.js");(hb.playtone$1||hb.playmelody$1)&&ra("midi","midi-plugin.js");H()}}function la(a,c){if("string"===typeof a){if(c){var m=document.createElement("video");m.preload="auto";m.loop=!0;m.setAttribute("playsinline","");enableInlineVideo(m)}else m=new Image;m.src=a}else m=a;if(!m.tagName)return console.error("Not a valid image element",m),h;var D={img:m,width:NaN,height:NaN,ready:!0,
live:!1,generation:0,whenReady:e};a=m.tagName.toLowerCase();var b=[];if("img"===a)m.complete?(D.width=m.width,D.height=m.height):(D.ready=!1,m.addEventListener("load",function(){D.width=m.width;D.height=m.height;D.ready=!0;D.whenReady=e;b.forEach(e);f()}),D.whenReady=b.push.bind(b));else if("video"===a)D.live=!0,m.readyState>=m.HAVE_METADATA?(D.width=m.videoWidth,D.height=m.videoHeight):(D.ready=!1,m.addEventListener("loadedmetadata",function(){D.width=m.videoWidth;D.height=m.videoHeight;D.ready=
!0;D.whenReady=e;b.forEach(e);f()}),D.whenReady=b.push.bind(b));else if("canvas"===a)D.width=m.width,D.height=m.height;else return console.error("Not a valid image element",a,m),h;return{ctype:"image",value:D}}function ka(a){function c(a,c){var m=document.createElement("button"),b=document.createElement("img");m.appendChild(b);h.appendChild(m);Hb(b,a);m.addEventListener("click",c);Xa[a]=function(a){a?m.classList.add("CindyJS-active"):m.classList.remove("CindyJS-active")}}function m(a){if(l){var c=
e.getBoundingClientRect();Ba(f*(a.clientX-c.left-e.clientLeft+.5)/c.width+d)}}var b=document.createElement("div");b.className="CindyJS-animcontrols";qa.parentNode.appendChild(b);var d=0,g=1,f=1;a.animation&&a.animation.speedRange&&La(a.animation.speedRange[0])&&La(a.animation.speedRange[1])&&(d=a.animation.speedRange[0],g=a.animation.speedRange[1],f=g-d);var e=document.createElement("div");e.className="CindyJS-animspeed";b.appendChild(e);var k=document.createElement("div");e.appendChild(k);I(e,"mousedown",
function(a){l=!0;m(a)});I(e,"mousemove",m);I(qa.parentNode,"mouseup",function(a){l=!1},!0);var h=document.createElement("div");h.className="CindyJS-animbuttons";b.appendChild(h);c("play",Aa);c("pause",Ka);c("stop",nb);Xa.stop(!0);rc=function(a){a=(a-d)/f;a=Math.max(0,Math.min(1,a));a=.1*Math.round(1E3*a);k.style.width=a+"%"};var l=!1}function Ba(a){Zc=a;rc&&rc(a)}function e(a){return a()}function ra(a,c,m){var b=null;p.plugins&&(b=p.plugins[a]);b||(b=xa._pluginRegistry[a]);b?r.use$1([u.wrap(a)],{}):
(++$c,xa.autoLoadPlugin(a,c,function(){r.use$1([u.wrap(a)],{});H(m)}))}function H(a){0===--$c&&(a?f():(z(S.init),(p.animation||p).autoplay&&Aa(),ua.canvas&&lc(ua.canvas,p)))}function W(){null!==Ib&&(oa.set(Ib.state),Object.keys(Ib.speeds).forEach(function(a){var c=t.csnames[a];"undefined"!==typeof c.behavior&&(a=Ib.speeds[a],c.behavior.vx=a[0],c.behavior.vy=a[1],c.behavior.vz=a[2],c.behavior.fx=0,c.behavior.fy=0,c.behavior.fz=0)}),ad())}function Aa(){if(!db){if(Yb){var a=Ya.backup;a.set(oa);for(var c=
{},m=0;m<t.points.length;m++){var b=t.points[m];"undefined"!==typeof b.behavior&&(c[b.name]=[b.behavior.vx,b.behavior.vy,b.behavior.vz])}Ib={state:a,speeds:c};Jb=0;Yb=!1;Xa.stop(!1)}else Xa.pause(!1);sc=Date.now();Xa.play(!0);"function"===typeof qc&&tc&&Yd();db=!0;z(S.simulationstart);f()}}function Ka(){db&&(Xa.play(!1),Xa.pause(!0),db=!1)}function nb(){Yb||(db?(z(S.simulationstop),db=!1,Xa.play(!1)):Xa.pause(!1),Xa.stop(!0),Yb=!0,W())}function bb(){if(!Zb){Zb=!0;for(var a=xa.instances.length;0<a;)if(xa.instances[--a]===
ua){xa.instances.splice(a,1);break}for(a=ib.length;0<a;)try{ib[--a]()}catch(c){console.error(c)}}}function ob(a){this.in=function(a,m){console.log(a);m?this.append(this.createTextNode("span","blue",a)):this.append(this.createTextNode("p","blue",a))};this.out=function(a,m){console.log(a);m?this.append(this.createTextNode("span","red",a)):this.append(this.createTextNode("p","red",a))};this.err=function(a,m){console.log(a);m?this.append(this.createTextNode("span","red",a)):this.append(this.createTextNode("p",
"red",a))};this.createTextNode=function(a,m,b){return"undefined"!==typeof document?(a=document.createElement(a),a.appendChild(document.createTextNode(b)),a.style.color=m,a):b+"\n"}}function Tb(){var a=this,c=document.createElement("div");c.innerHTML='<div id="console" style="border-top: 1px solid #333333; bottom: 0px; position: absolute; width: 100%;"><div id="log" style="height: 150px; overflow-y: auto;"></div><input id="cmd" type="text" style="box-sizing: border-box; height: 30px; width: 100%;"></div>';
document.body.appendChild(c);var m=document.getElementById("cmd");var b=document.getElementById("log");m.onkeydown=function(c){13===c.keyCode&&""!==m.value&&(a.in(m.value),c=r.parse$1([u.wrap(m.value)],[]),c=z(c),console.log(U(c)),"undefined"!==c.ctype&&ya.out(U(c)),m.value="",b.scrollTop=b.scrollHeight)};this.append=function(a){b.appendChild(a)};this.clear=function(){b.innerHTML=""}}function gb(a){var c=a;"string"===typeof a&&(c=document.getElementById(a));this.append=function(a){c.appendChild(a)};
this.clear=function(){c.innerHTML=""}}function wa(){this.append=function(a){};this.clear=function(){}}function I(a,c,m,b){void 0===b&&(b=!1);ib.push(function(){a.removeEventListener(c,m,b)});a.addEventListener(c,m,b)}function lc(a,c){function m(c){var m=a.getBoundingClientRect();c=y.to(c.clientX-m.left-a.clientLeft+.5,c.clientY-m.top-a.clientTop+.5);aa.prevx=aa.x;aa.prevy=aa.y;aa.x=c[0];aa.y=c[1];ta[0]=aa.x;ta[1]=aa.y;f()}function b(a){for(var c=a.changedTouches,m=!1,b=0;b<c.length;b++)c[b].identifier===
k&&(m=!0);m&&(k=-1,aa.down=!1,ja=void 0,z(S.mouseup),xb("mouseup"),e||z(S.mouseclick),f(),a.preventDefault())}var P=null,F=null,e=!1;"undefined"!==typeof MutationObserver&&(P=MutationObserver);P||"undefined"===typeof WebKitMutationObserver||(P=WebKitMutationObserver);P?(P=new P(function(c){document.body.contains(a)||bb()}),P.observe(document.documentElement,{childList:!0,subtree:!0}),ib.push(function(){P.disconnect()})):(I(a,"DOMNodeRemovedFromDocument",bb),I(a,"DOMNodeRemoved",bb));if(!0===c.keylistener)I(document,
"keydown",function(a){O(a,S.keydown);return!1}),I(document,"keyup",function(a){O(a,S.keyup);return!1}),I(document,"keypress",function(a){O(a,S.keytyped);return!1});else if(S.keydown||S.keyup||S.keytyped)a.setAttribute("tabindex","0"),I(a,"mousedown",function(){a.focus()}),I(a,"keydown",function(a){9!==a.keyCode&&(O(a,S.keydown),S.keytyped||a.preventDefault())}),I(a,"keyup",function(a){O(a,S.keyup);a.preventDefault()}),I(a,"keypress",function(a){9!==a.keyCode&&(O(a,S.keytyped),a.preventDefault())});
I(a,"mousedown",function(a){F=a;e=!1;aa.button=a.which;m(a);z(S.mousedown);xb("mousedown");aa.down=!0;a.preventDefault()});I(a,"mouseup",function(a){aa.down=!1;ja=void 0;z(S.mouseup);xb("mouseup");f();a.preventDefault()});I(a,"mousemove",function(a){m(a);aa.down?(F&&(2<Math.abs(F.clientX-a.clientX)||2<Math.abs(F.clientY-a.clientY))&&(e=!0),z(S.mousedrag)):z(S.mousemove);xb("mousemove");a.preventDefault()});I(a,"click",function(a){m(a);e||z(S.mouseclick);a.preventDefault()});I(a,"dragenter",function(a){a.preventDefault()});
I(a,"dragover",function(a){a.preventDefault()});I(a,"drop",function(c){function m(a,c){function m(){F.readyState===XMLHttpRequest.DONE&&(200!==F.status?(console.error("GET request for "+a+" failed: "+(F.responseText||"(no error message)")),P(c,h)):D(c,F.responseText))}var g=a.replace(/[?#][^]*/,"");g=g.replace(/[^]*\/([^\/])/,"$1");e[c]={type:"",name:g};var F=new XMLHttpRequest;F.onreadystatechange=function(){if(F.readyState===XMLHttpRequest.DONE)if(200!==F.status)console.error("HEAD request for "+
a+" failed: "+(F.responseText||"(no error message)")),P(c,h);else{var D=F.getResponseHeader("Content-Type");e[c].type=D;/^image\//.test(D)?d(c,a):b(D)?(F=new XMLHttpRequest,F.onreadystatechange=m,F.open("GET",a),F.send()):P(c,h)}};F.open("HEAD",a);F.send()}function b(a){a=a.replace(/;[^]*/,"");return/^text\//.test(a)?1:"application/json"===a?2:0}function D(a,c){switch(b(e[a].type)){case 1:P(a,u.string(c));break;case 2:try{var m=JSON.parse(c);var D=u.wrapJSON(m)}catch(Zd){console.error(Zd),D=h}P(a,
D);break;default:P(a,h)}}function d(a,c){var m=new Image,b=!1;m.onload=function(){b||(b=!0,P(a,la(m,!1)))};m.onerror=function(c){b||(b=!0,console.error(c),P(a,h))};m.src=c}function P(a,c,m){k[a]=g.turnIntoCSList([c,u.string(m||c.ctype),u.string(e[a].type),u.string(e[a].name)]);0===--Ua&&(a=l,uc=g.turnIntoCSList(k),vc=a,z(S.ondrop),vc=uc=h,f())}c.preventDefault();var F=c.dataTransfer,e=F.files,k=Array(e.length),Ua=e.length,Ma=c.currentTarget.getBoundingClientRect(),l=g.realVector(y.to(c.clientX-Ma.left-
a.clientLeft+.5,c.clientY-Ma.top-a.clientTop+.5));if(0<e.length)Array.prototype.forEach.call(e,function(a,c){var m=new FileReader;b(a.type)?(m.onload=function(){D(c,m.result)},m.readAsText(a)):/^image\//.test(a.type)?(m.onload=function(){d(c,m.result)},m.readAsDataURL(a)):(console.log("Unknown MIME type: "+a.type),P(c,h))});else if(c=F.getData("text/uri-list"))c=c.split("\n").filter(function(a){return!/^\s*(#|$)/.test(a)}),Ua=c.length,k=Array(Ua),e=Array(Ua),c.forEach(m)});var k=-1;I(a,"touchstart",
function(a){if(-1===k){var c=a.changedTouches;0!==c.length&&(k=c[0].identifier,m(a.targetTouches[0]),z(S.mousedown),aa.down=!0,F=a.targetTouches[0],e=!1,xb("mousedown"),a.preventDefault())}},!1);I(a,"touchmove",function(a){for(var c=a.changedTouches,b=!1,D=0;D<c.length;D++)c[D].identifier===k&&(b=!0);b&&(m(a.targetTouches[0]),aa.down?(F&&(2<Math.abs(F.clientX-a.targetTouches[0].clientX)||2<Math.abs(F.clientY-a.targetTouches[0].clientY))&&(e=!0),z(S.mousedrag)):z(S.mousemove),xb("mousemove"),a.preventDefault())},
!0);I(a,"touchend",b,!1);"undefined"!==typeof document&&document.body&&I(document.body,"touchcancel",b,!1);"undefined"!==typeof window&&I(window,"resize",function(){wc(function(){w();f()})},!1);d(a.parentNode);f()}function b(a,c){var m=document.createElement("div");m.setAttribute("style",c);a.appendChild(m);return m}function d(a){function c(){D.scrollLeft=D.scrollTop=d.scrollLeft=d.scrollTop=1E5}function m(){if(g!==a.clientWidth||e!==a.clientHeight)g=a.clientWidth,e=a.clientHeight,k||(k=!0,wc(function(){k=
!1;w();f()}));c()}if("undefined"!==typeof document){var D=b(a,"position: absolute; transition: 0s; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;");b(D,"position: absolute; transition: 0s; left: 0; top: 0; width: 100000px; height: 100000px");var d=b(a,"position: absolute; transition: 0s; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;");b(d,"position: absolute; transition: 0s; left: 0; top: 0; width: 200%; height: 200%");
c();var g=a.clientWidth,e=a.clientHeight,k=!1;D.addEventListener("scroll",m);d.addEventListener("scroll",m)}}function f(){xc||(xc=wc(q))}function q(){xc=null;if(!Zb){if(db){var a=Date.now(),c=Math.min(50,a-sc)*Zc*$d;sc=a;a=Jb+c;tc&&"undefined"!==typeof za&&za.tick(c);Jb=a;db&&z(S.tick)}n();db&&f()}}function n(){y.reset();A.save();A.clearRect(0,0,ca,da);var a=y.drawingstate.matrix,c,m;if(0!==Ca){A.beginPath();A.strokeStyle="rgba(0,0,0,0.1)";A.lineWidth=1;A.lineCap="butt";var b=Ca*a.a;for(c=Math.ceil(-a.tx/
b);(m=c*b+a.tx)<ca;){if(c||!Gb)A.moveTo(m,0),A.lineTo(m,da);c++}for(c=Math.floor(a.ty/b);(m=c*b-a.ty)<da;){if(c||!Gb)A.moveTo(0,m),A.lineTo(ca,m);c++}A.stroke()}if(0!==oc){A.beginPath();A.strokeStyle="rgba(0,0,0,0.1)";A.lineWidth=1;A.lineCap="butt";b=oc*a.a;var d=Math.sqrt(3);var F=a.ty/d;var e=(da+a.ty)/d;for(c=Math.ceil(-(a.tx+e)/b);(m=c*b+a.tx)+F<ca;)A.moveTo(m+F,0),A.lineTo(m+e,da),c++;for(c=Math.ceil(-(a.tx-F)/b);(m=c*b+a.tx)-e<ca;)A.moveTo(m-F,0),A.lineTo(m-e,da),c++;b*=.5*d;for(c=Math.floor(a.ty/
b);(m=c*b-a.ty)<da;){if(c||!Gb)A.moveTo(0,m),A.lineTo(ca,m);c++}A.stroke()}Gb&&(A.beginPath(),A.strokeStyle="rgba(0,0,0,0.2)",A.lineWidth=3,A.lineCap="butt",A.lineJoin="miter",A.miterLimit=10,A.beginPath(),A.moveTo(0,-a.ty),A.lineTo(ca-6,-a.ty),A.moveTo(ca-13,-5-a.ty),A.lineTo(ca-3,-a.ty),A.lineTo(ca-13,5-a.ty),A.moveTo(a.tx,da),A.lineTo(a.tx,6),A.moveTo(a.tx-5,13),A.lineTo(a.tx,3),A.lineTo(a.tx+5,13),A.stroke());ae();y.greset();be();for(a=0;a<t.polygons.length;a++)b=t.polygons[a],b.isshowing&&!1!==
b.visible&&(F={color:b.color,alpha:b.alpha,fillcolor:b.fillcolor,fillalpha:b.fillalpha,size:b.size,lineJoin:u.string("miter"),fillrule:u.string(b.fillrule)},C.drawpolygon([b.vertices],F,"D",!0));for(a=0;a<t.conics.length;a++)t.conics[a].isArc?(b=t.conics[a],b.isshowing&&!1!==b.visible&&(F={},F.color=b.color,F.alpha=b.alpha,F.size=b.size,C.drawarc(b,F,b.filled?"F":"D"))):(b=t.conics[a],b.isshowing&&!1!==b.visible&&(F={},F.color=b.color,F.alpha=b.alpha,F.size=b.size,C.drawconic(b.matrix,F)));for(a=
0;a<t.lines.length;a++)a:if(b=t.lines[a],b.isshowing&&!1!==b.visible&&g._helper.isAlmostReal(b.homog))if("S"===b.kind)F={overhang:b.overhang,dashtype:b.dashtype,size:b.size,color:b.color,alpha:b.alpha,arrow:b.arrow,arrowsize:b.arrowsize,arrowposition:b.arrowposition,arrowshape:b.arrowshape,arrowsides:b.arrowsides},0<=k.mult(b.startpos.value[2],k.conjugate(b.endpos.value[2])).value.real?(r.draw$2([b.startpos,b.endpos],F),b.labeled&&!b.tmp&&(F=b.printname||b.name||"S",e=g.scalmult(k.real(Math.sign(b.startpos.value[2].value.real)*
Math.sign(b.endpos.value[2].value.real)),g.cross(b.startpos,b.endpos)),e={x:e.value[0].value.real,y:e.value[1].value.real},c=Math.sqrt(e.x*e.x+e.y*e.y),e={x:8*e.x/c-3,y:8*e.y/c-3},e=b.labelpos||e,c=x.makeColor(ha.textColor),m=l._helper.midpoint(l._helper.midpoint(b.startpos,b.endpos),b.endpos),cd(b,F,m,e,c))):(x.handleModifs(F,x.lineModifs),x.drawRaySegment(b.startpos,b.endpos));else if("end"===b.clip.value&&"Join"===b.type)c=t.csnames[b.args[0]],F=t.csnames[b.args[1]],r.draw$2([c.homog,F.homog],
{overhang:b.overhang,dashtype:b.dashtype,size:b.size,color:b.color,alpha:b.alpha});else{if("inci"===b.clip.value){c=[1E6,0];F=[-1E6,0];m=[1E6,0];e=[-1E6,0];for(d=0;d<b.incidences.length;d++){var f=t.csnames[b.incidences[d]].homog,h=f.value[0],M=f.value[1],n=f.value[2];k._helper.isAlmostZero(n)||(h=k.div(h,n),M=k.div(M,n),k._helper.isAlmostReal(h)&&k._helper.isAlmostReal(M)&&(h.value.real<c[0]&&(c=[h.value.real,f]),h.value.real>F[0]&&(F=[h.value.real,f]),M.value.real<m[0]&&(m=[M.value.real,f]),M.value.real>
e[0]&&(e=[M.value.real,f])))}F[0]-c[0]>e[0]-m[0]?(c=c[1],F=F[1]):(c=m[1],F=e[1]);if(c!==F){r.draw$2([c,F],{dashtype:b.dashtype,size:b.size,color:b.color,alpha:b.alpha,overhang:b.overhang});break a}}r.draw$1([b.homog],{dashtype:b.dashtype,size:b.size,color:b.color,alpha:b.alpha})}for(a=0;a<t.points.length;a++)if(b=t.points[a],b.isshowing&&!1!==b.visible&&g._helper.isAlmostReal(b.homog)&&(F=b.color,b.behavior&&(F=b.color),r.draw$1([b.homog],{size:b.size,color:F,alpha:b.alpha,noborder:b.noborder,border:b.border}),
b.labeled&&!b.tmp)){e=b.printname||b.name||"P";c=b.labelpos||{x:3,y:3};m=x.makeColor(ha.textColor);if(!0===b.noborder.value||!1===b.border.value)m=F;cd(b,e,b.homog,c,m)}for(a=0;a<t.texts.length;a++)ce(t.texts[a]);if(t.ifs.length){if(Y.dirty||!u.deeplyEqual(Y.mat,y.drawingstate.matrix))l.IFS.updateParameters(),Y.dirty=!1;Y.img&&A.drawImage(Y.img,0,0,ca,da)}A.restore()}function O(a,c){a=window.event?event:a;a=a.charCode?a.charCode:a.keyCode;dd=String.fromCharCode(a);ed=a;z(c);f()}function v(a){var c=
a.value;a=c[0].value;var m=c[1].value;c=c[2].value;return g.turnIntoCSList([a[0],k.add(a[1],m[0]),k.add(a[2],c[0]),m[1],k.add(m[2],c[1]),c[2]])}function jc(a){var c=!0;return function(m,b){c&&(console.error("Operator "+a+" is not supported yet."),c=!1);return h}}function U(a){if("undefined"===typeof a)return"_??_";if(null===a)return"_???_";if("undefined"===a.ctype)return"___";if("number"===a.ctype)return k.niceprint(a);if("string"===a.ctype||"boolean"===a.ctype)return a.value;if("list"===a.ctype){for(var c=
"[",m=0;m<a.value.length;m++)c+=U(z(a.value[m])),m!==a.value.length-1&&(c+=", ");return c+"]"}return"dict"===a.ctype?Qa.niceprint(a):"function"===a.ctype?"FUNCTION":"infix"===a.ctype?"INFIX":"modifier"===a.ctype?a.key+"->"+U(a.value):"shape"===a.ctype?a.type:"error"===a.ctype?"Error: "+a.message:"variable"===a.ctype?U(J.getvar(a.name)):"geo"===a.ctype?a.value.name:"image"===a.ctype?"IMAGE":"_?_"}function Ub(a,c){c="undefined"===a[0].ctype;var m="undefined"===a[1].ctype,b=z(a[1]);if(c||m)return h;
"variable"===a[0].ctype?J.setvar(a[0].name,b):"infix"===a[0].ctype?"_"===a[0].oper?C.assigntake(a[0],b):fa("Can't use infix expression as lvalue"):"field"===a[0].ctype?C.assigndot(a[0],b):"userdata"===a[0].ctype?C.assigncolon(a[0],b):"function"===a[0].ctype&&"genList"===a[0].oper?"list"===b.ctype?C.assignlist(a[0].args,b.value):fa("Expected list in rhs of assignment"):fa("Left hand side of assignment is not a recognized lvalue");return b}function vb(a,c){c=z(a[0]);a=z(a[1]);if(c.ctype===a.ctype){if("number"===
c.ctype)return u.bool(c.value.real===a.value.real&&c.value.imag===a.value.imag);if("string"===c.ctype||"boolean"===c.ctype)return u.bool(c.value===a.value);if("list"===c.ctype)return g.equals(c,a);if("geo"===c.ctype)return u.bool(c.value===a.value)}return{ctype:"boolean",value:!1}}function Tc(a,c){return u.not(vb(a,c))}function kc(a,c){c=B(a[0]);a=B(a[1]);return"number"===c.ctype&&"number"===a.ctype?{ctype:"boolean",value:k._helper.isAlmostEqual(c,a)}:"string"===c.ctype&&"string"===a.ctype||"boolean"===
c.ctype&&"boolean"===a.ctype?{ctype:"boolean",value:c.value===a.value}:"list"===c.ctype&&"list"===a.ctype?g.almostequals(c,a):{ctype:"boolean",value:!1}}function Uc(a,c){c=B(a[0]);a=B(a[1]);return"boolean"===c.ctype&&"boolean"===a.ctype?{ctype:"boolean",value:c.value&&a.value}:h}function Vc(a,c){c=B(a[0]);a=B(a[1]);return"boolean"===c.ctype&&"boolean"===a.ctype?{ctype:"boolean",value:c.value||a.value}:h}function Wc(a,c){c=a[0];"void"!==c.ctype&&(c=B(c));a=B(a[1]);var m=u.add(c,a);"Angle"===c.usage&&
"Angle"===a.usage&&(m=u.withUsage(m,"Angle"));return m}function mc(a,c){c=a[0];"void"!==c.ctype&&(c=B(c));a=B(a[1]);var m=u.sub(c,a);"Angle"===c.usage&&"Angle"===a.usage&&(m=u.withUsage(m,"Angle"));return m}function Xc(a,c){c=B(a[0]);a=B(a[1]);var m=u.mult(c,a);"Angle"!==c.usage||a.usage?"Angle"!==a.usage||c.usage||(m=u.withUsage(m,"Angle")):m=u.withUsage(m,"Angle");return m}function Yc(a,c){c=B(a[0]);a=B(a[1]);"number"===a.ctype&&k._helper.isZero(a)&&fa("WARNING: Division by zero!");var m=u.div(c,
a);"Angle"!==c.usage||a.usage?"Angle"!==a.usage||c.usage||(m=u.withUsage(m,"Angle")):m=u.withUsage(m,"Angle");return m}function fd(a,c){c=B(a[0]);a=B(a[1]);return"number"===c.ctype&&"number"===a.ctype?k.pow(c,a):h}function gd(a,c){c=L(a[0]);a=L(a[1]);if(c!==h&&a!==h){var m=g.cross(c,a);"Point"===c.usage&&"Point"===a.usage&&(m=u.withUsage(m,"Line"));"Line"===c.usage&&"Line"===a.usage&&(m=u.withUsage(m,"Point"));return m}return h}function yc(a){var c=a.length;if(0===c)return[];if(1===c)return[0];if(2===
c)return a[0][0]+a[1][1]<=a[0][1]+a[1][0]?[0,1]:[1,0];if(4<c)return de(a);for(var m=ee[c],b=Number.POSITIVE_INFINITY,d=m[0],g=0;g<m.length;++g){for(var e=m[g],f=0,k=0;k<c;++k)f+=a[k][e[k]];f<b&&(b=f,d=e)}return d}function de(a){function c(){return{matched:-1,prev:-1,start:-1,cost:0,used:!1,leaf:!1}}function m(a){for(var c=0;c<g;++c)0<l[a][c]||h[c].used||(h[c].used=!0,m(h[c].matched))}function b(a){for(var c=0;c<g;++c)0<l[c][a]||k[c].used||(k[c].used=!0,b(k[c].matched))}var d=Math.abs,g=a.length,e,
f,k=Array(g),h=Array(g),l=Array(g);for(e=0;e<g;++e)l[e]=Array(g);for(e=0;e<g;++e)for(k[e]=c(),h[e]=c(),k[e].cost=a[e][0],f=1;f<g;++f)k[e].cost>a[e][f]&&(k[e].cost=a[e][f]);for(;;){for(e=0;e<g;++e)for(f=0;f<g;++f)l[e][f]=a[e][f]-k[e].cost-h[f].cost,l[e][f]<1E-14*(d(a[e][f])+d(k[e].cost)+d(h[f].cost))&&(l[e][f]=0);for(e=0;e<g;++e)k[e].matched=h[e].matched=-1;for(var n=0;;){for(e=0;e<g;++e)k[e].used=k[e].leaf=h[e].used=h[e].leaf=!1,-1===k[e].matched&&(k[e].start=e,k[e].used=k[e].leaf=!0,k[e].prev=-1);
for(var p=!1,q=!1;!q;){for(e=0;e<g;++e)if(k[e].leaf)for(k[e].leaf=!1,f=0;f<g;++f)if(!(h[f].used||0<l[e][f])&&k[e].matched!==f&&(h[f].prev=e,h[f].start=k[e].start,h[f].used=h[f].leaf=!0,-1===h[f].matched)){k[h[f].start].prev=f;p=!0;break}if(p)break;q=!0;for(f=0;f<g;++f)h[f].leaf&&(h[f].leaf=!1,e=h[f].matched,k[e].used||(k[e].prev=f,k[e].start=h[f].start,k[e].used=k[e].leaf=!0,q=!1))}if(!p)break;for(p=0;p<g;++p)if(-1===k[p].matched&&-1!==k[p].prev){f=k[p].prev;do e=h[f].prev,h[f].matched=e,k[e].matched=
f,f=k[e].prev;while(e!==p);++n}}if(n===g)break;for(e=0;e<g;++e)k[e].used=k[e].leaf=h[e].used=h[e].leaf=!1;for(e=0;e<g;++e)-1===k[e].matched&&m(e);for(f=0;f<g;++f)-1===h[f].matched&&b(f);for(e=0;e<g;++e)-1===k[e].matched||k[e].used||h[k[e].matched].used||(k[e].used=!0);n=Number.POSITIVE_INFINITY;for(e=0;e<g;++e)if(!k[e].used)for(f=0;f<g;++f)h[f].used||n>l[e][f]&&(n=l[e][f]);for(e=0;e<g;++e)k[e].used||(k[e].cost+=n),h[e].used&&(h[e].cost-=n)}a=Array(g);for(e=0;e<g;++e)f=k[e].matched,a[e]=f;return a}
function zc(a,c){c=z(a[0]);a=B(a[1]);"string"!==c.ctype&&(c=g.asList(c));if("number"===a.ctype){a=Math.floor(a.value.real);0>a&&(a=c.value.length+a+1);if(0<a&&a<c.value.length+1)return"list"===c.ctype?c.value[a-1]:{ctype:"string",value:c.value.charAt(a-1)};fa("WARNING: Index out of range!");return h}if("list"===a.ctype){for(var m=[],b=0;b<a.value.length;b++){var d=B(a.value[b]);m[b]=zc([c,d],[])}return g.turnIntoCSList(m)}return h}function hd(a,c){c=z(a[0]);a=z(a[1]);if("shape"===c.ctype&&"shape"===
a.ctype)return C.shapeconcat(c,a);c=g.asList(c);a=g.asList(a);return"list"===c.ctype&&"list"===a.ctype?g.concat(c,a):h}function id(a,c){c=z(a[0]);a=z(a[1]);return"list"===c.ctype&&"list"===a.ctype?g.set(g.common(c,a)):"shape"===c.ctype&&"shape"===a.ctype?C.shapecommon(c,a):h}function jd(a,c){c=z(a[0]);a=z(a[1]);return"list"===c.ctype&&"list"===a.ctype?g.remove(c,a):"shape"===c.ctype&&"shape"===a.ctype?C.shaperemove(c,a):h}function kd(a,c){c=z(a[0]);a=z(a[1]);return"list"===c.ctype?g.append(c,a):h}
function ld(a,c){c=z(a[0]);a=z(a[1]);return"list"===a.ctype?g.prepend(c,a):h}function Ac(a,c){a|=0;c|=0;if(0===a&&0===c)return 0;for(;0!==c;){var m=a;a=c;c=m%c|0}return a}function fe(a){return 1===a?0:1}function Kb(a,c,m){var b=c*c-4*a*m;0<=b?(b=Math.sqrt(b),0<c&&(b=-b),c=[[b-c,2*a],[2*m,b-c]]):c=null;if(null===c)return null;a=c[0][0]/c[0][1];c=c[1][0]/c[1][1];return c<a?[c,a]:[a,c]}function md(a,c,m,b,d,g,e){if(-1!==c.indexOf("\n")){var D=Infinity,P=-Infinity,f=Infinity,F=-Infinity;c.split("\n").forEach(function(c){c=
md(a,c,m,b,d,g);D>c.left&&(D=c.left);P<c.right&&(P=c.right);f>c.top&&(f=c.top);F<c.bottom&&(F=c.bottom);b+=e});return{left:D,right:P,top:f,bottom:F}}var k=a.measureText(c);a.fillText(c,m-k.width*d,b);return{left:m-k.width*d,right:m+k.width*(1-d),top:b-.84*g,bottom:b+.36*g}}function Na(a){return"image"===a.ctype?a.value:"string"===a.ctype&&cb.hasOwnProperty(a.value)?cb[a.value].value:null}function pb(a,c,m,b,d){var D=[];if(a.readPixels)D=a.readPixels(c,m,b,d);else{if(a.img.getContext){var g=a.img.getContext("2d");
var P=g.getImageData(c,m,b,d).data}else try{Lb||(Lb=document.createElement("canvas")),Lb.width=b,Lb.height=d,g=Lb.getContext("2d"),g.drawImage(a.img,c,m,b,d,0,0,b,d),P=g.getImageData(0,0,b,d).data}catch(M){console.log(M)}for(var e in P)D.push(P[e]/255)}return D}function nd(a){return a.replace(/[^A-Za-z0-9 \u0080-\uffff]/ig,"\\$&")}function ma(a,c,m){var b=a;c&&(b=b+" at "+c.row+":"+c.col);m&&(b=b+": \u2018"+m+"\u2019");b=Error(b);b.name="CindyScriptParseError";b.description=a;b.location=c;b.text=
m;return b}function qb(a){this.input=a;this.re=new RegExp(od,"g");for(var c=[],m=a.indexOf("\n")+1;m;)c.push(m),m=a.indexOf("\n",m)+1;c.push(a.length);this.bols=c;this.bol=this.pos=0;this.line=1}function $b(a){var c=a[a.length-2],m=a[a.length-3],b=a[a.length-1];if(m){if(m.isSuperscript&&c.precedence<=m.precedence)throw ma("Operator not allowed after superscript",c.start,c.text);if(b){if(!c.op.infix)throw ma("Operator may not be used infix",c.start,c.text);}else if(!c.op.postfix)throw ma("Operator may not be used postfix",
c.start,c.text);}else if(b){if(!c.op.prefix)throw ma("Operator may not be used prefix",c.start,c.text);}else if(!c.op.bare)throw ma("Operator without operands",c.start,c.text);c.ctype="infix";c.oper=c.op.sym;c.args=[m,b];a.splice(a.length-3,3,c)}function pd(a,c,m,b){a.length&1||a.push(null);for(m=Ga[m];3<=a.length&&a[a.length-2].precedence<=m.precedence;)$b(a);a.push({op:m,precedence:m.precedence+(m.rassoc?1:0),start:c.start,end:c.end,text:c.text,rawtext:c.rawtext});m="";for(var D=c.text,d=0;d<D.length;++d)m+=
"0123456789+-".charAt(b.indexOf(D.charAt(d)));c.ctype="number";c.value={real:+m,imag:0};a.push(c);$b(a)}function qd(a,c){var m=[];a:for(;;){var b=a.next();switch(b.toktype){case "OP":var d=Ga[b.text];"_"!==d.sym||!m.length||m.length&1||"OP"!==m[m.length-1].toktype||":="!==m[m.length-1].op.sym||(m.pop(),d=Ga[":=_"],b.text=d.sym);b.op=d;b.precedence=d.precedence;for(m.length&1||m.push(null);3<=m.length&&m[m.length-2].precedence<=b.precedence;)$b(m);d.rassoc&&b.precedence++;m.push(b);break;case "ID":b.ctype=
"variable";b.name=b.text;if(m.length&1)throw ma("Missing operator",b.start,b.text);m.push(b);break;case "NUM":b.ctype="number";b.value={real:+b.text,imag:0};if(m.length&1)throw ma("Missing operator",b.start,b.text);m.push(b);break;case "STR":b.ctype="string";b.value=b.raw.substring(1,b.raw.length-1);if(m.length&1)throw ma("Missing operator",b.start,b.text);m.push(b);break;case "SUB":pd(m,b,"_","\u2080\u2081\u2082\u2083\u2084\u2085\u2086\u2087\u2088\u2089\u208a\u208b");break;case "SUP":pd(m,b,"^",
"\u2070\u00b9\u00b2\u00b3\u2074\u2075\u2076\u2077\u2078\u2079\u207a\u207b");m[m.length-1].isSuperscript=!0;break;case "BRA":d="[](){}||".indexOf(b.text);if(b.text===c||d&1)break a;d="[](){}||".charAt(d+1);var g=qd(a,d),e=g.closedBy;if(e.text!==d)throw ma("Opening "+b.text+" at "+b.start.row+":"+b.start.col+" closed by "+(e.text||"EOF")+" at "+e.start.row+":"+e.start.col);e=b.text+e.text;d=[];if(g=g.expr){for(;g&&"infix"===g.ctype&&","===g.oper;)d.push(g.args[0]),g=g.args[1];d.push(g)}if(m.length&
1){if("{}"===e)throw ma("{\u2026} reserved for future use",b.start);g=m[m.length-1];if("variable"!==g.ctype)throw ma("Function name must be an identifier",g.start);if(2<m.length&&m[m.length-2].precedence<rd)throw ma("Function call in indexing construct must be enclosed in parentheses",b.start);g.ctype="function";b=g.args=[];e=g.modifs={};for(var f=0;f<d.length;++f){var k=d[f];if(k&&"infix"===k.ctype&&"->"===k.oper){var h=k.args[0];if("variable"!==h.ctype)throw ma("Modifier name must be an identifier",
k.start);e[h.name]=k.args[1]}else b.push(k)}g.oper=g.name.toLowerCase()+"$"+g.args.length}else if("||"===e)if(1===d.length)m.push({ctype:"function",oper:"abs_infix",args:d,modifs:{}});else if(2===d.length)m.push({ctype:"function",oper:"dist_infix",args:d,modifs:{}});else throw ma("Don't support |\u2026| with "+d.length+" arguments",b.start);else{if("{}"===e)throw ma("{\u2026} reserved for future use",b.start);"[]"!==e&&1===d.length?m.push({ctype:"paren",args:d}):0===d.length?m.push({ctype:"list",
value:[]}):m.push({ctype:"function",oper:"genList",args:d,modifs:{}})}break;case "EOF":break a}}for(m.length&1||m.push(null);3<=m.length;)$b(m);return{expr:m[0],closedBy:b}}function Mb(a){this.usedFunctions={};this.usedVariables={}}function z(a){if(void 0===a)return h;if("infix"===a.ctype)return a.impl(a.args,{},a);if("variable"===a.ctype)return z(J.getvar(a.name));if("function"===a.ctype)return Nb.push(a),a=C.evaluate(a.oper,a.args,a.modifs),Nb.pop(),a;if("void"===a.ctype)return h;if("field"===a.ctype){var c=
z(a.obj);return"geo"===c.ctype?va.getField(c.value,a.key):"list"===c.ctype?g.getField(c,a.key):h}return"userdata"===a.ctype?(c=z(a.obj),a=U(z(a.key)),"_?_"===a&&(a=void 0),"geo"===c.ctype?va.getuserData(c.value,a):"list"===c.ctype||"string"===c.ctype?va.getuserData(c,a):h):a}function B(a){a=z(a);if("geo"===a.ctype){var c=a.value;if("P"===c.kind)return va.getField(c,"xy");if("V"===c.kind)return c.value}return a}function L(a){a=z(a);if("geo"===a.ctype){var c=a.value;if("P"===c.kind||"L"===c.kind)return va.getField(c,
"homog")}return g._helper.isNumberVecN(a,3)?a:g._helper.isNumberVecN(a,2)?(c=g.turnIntoCSList([a.value[0],a.value[1],k.real(1)]),a.usage&&(c=u.withUsage(c,a.usage)),c):h}function Wa(a){var c=new Mb;c.usedFunctions=hb;c.infixmap=T;a=c.parse(a);for(var m in c.usedVariables)J.create(m);return a}function Wd(a,c){return{ctype:"infix",args:[],impl:function(){Nb=[{oper:c}];var m=z(a);Nb=[];return m}}}function fa(a){ya.err(a+Nb.map(function(a){return"\n  at "+a.oper}).join("\n"))}function sd(){this._path=
[];this._defs=["<defs>"];this._imgcache=[];this._body=[];this._saveStack=[""];this._clipIndex=0;this._stroke=this._fill="#000";this._strokeOpacity=this._fillOpacity=null;this.height=this.width=0;this.lineWidth=1;this.lineCap="butt";this.lineJoin="miter";this.miterLimit=10;this.globalAlpha=1}function td(){this._body=[];this._yPos=this._xPos=NaN;this._extGState={Af255:"<< /ca 1 >>",As255:"<< /CA 1 >>"};this._objects=[["%PDF-1.4\n"]];this._offset=this._objects[0][0].length;this._nextIndex=5;this._imgcache=
[];this._xobjects={};this._pathUsed=-1;this._fillAlpha=this._strokeAlpha=this._globalAlpha=1;this.height=this.width=0;this.lineWidth=1;this.lineCap="butt";this.lineJoin="miter";this.miterLimit=10}function ud(a,c){var m=a.width,b=a.height,d=document.createElement("canvas");d.setAttribute("width",m);d.setAttribute("height",b);d.setAttribute("style","display:none;");var g=ua.canvas;g.parentNode.insertBefore(d,g.nextSibling);try{return d.getContext("2d").drawImage(a,0,0,m,b),d.toDataURL(c||"image/png")}finally{d.parentNode.removeChild(d)}}
function ge(a){a=a.replace(/[^ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/]+/g,"");var c=new Uint8Array(3*a.length>>2),m,b;for(b=m=0;m+3<a.length;m+=4){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(m));var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(m+1));var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(m+2));var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(m+
3));c[b++]=d<<2|g>>4;c[b++]=g<<4|e>>2;c[b++]=e<<6|f}switch(a.length-m){case 0:break;case 2:d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(m));g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(m+1));c[b++]=d<<2|g>>4;break;case 3:d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(m));g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(m+1));e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(m+
2));c[b++]=d<<2|g>>4;c[b++]=g<<4|e>>2;break;default:throw Error("Malformed Base64 input: "+(a.length-m)+" chars left: "+a.substr(m));}if(b!==c.length)throw Error("Failed assertion: "+b+" should be "+c.length);return c}function he(a){function c(c){return(a[c]<<24|a[c+1]<<16|a[c+2]<<8|a[c+3])>>>0}if(57>a.length)throw Error("Too short to be a PNG file");if(2303741511!==c(0)||218765834!==c(4))throw Error("PNG signature missing");for(var m=[],b=8;b<a.length;){if(b+12>a.length)throw Error("Incomplete chunk at offset 0x"+
b.toString(16));var d=c(b);if(2147483648<=d)throw Error("Chunk too long");var g=b+12+d;if(g>a.length)throw Error("Incomplete chunk at offset 0x"+b.toString(16));var e=a.subarray(b+4,b+8);e=String.fromCharCode.apply(String,e);m.push({len:d,type:e,data:a.subarray(b+8,b+8+d),crc:c(b+8+d)});b=g}return m}function ac(a,c){var m;if(m=/^rgba\(([0-9.]+), *([0-9.]+), *([0-9.]+), *([0-9.]+)\)$/.exec(a))c(+m[1],+m[2],+m[3],+m[4]);else if(m=/^rgb\(([0-9.]+), *([0-9.]+), *([0-9.]+)\)$/.exec(a))c(+m[1],+m[2],+m[3],
1);else throw Error("Can't handle color style "+a);}function ie(a){var c=1;Object.keys(cb).forEach(function(m){var b=cb[m].value.img;if(void 0===b.cachedDataURL&&b.src)if("data:"===b.src.substr(0,5))b.cachedDataURL=b.src;else{++c;b.cachedDataURL=null;var d=new XMLHttpRequest;d.responseType="blob";d.onreadystatechange=function(){if(d.readyState===XMLHttpRequest.DONE)if(200===d.status){var m=new FileReader;m.onloadend=function(){b.cachedDataURL=m.result;console.log("Cached data for image "+b.src);0===
--c&&a()};m.readAsDataURL(d.response)}else console.error("Failed to load "+b.src+": "+d.statusText),0===--c&&a()};d.open("GET",b.src,!0);d.send()}});0===--c&&a()}function rb(a,c,m){for(m||(m="0");a.length<c;)a=m+a;return a}function vd(){null!==Ob&&(window.URL.revokeObjectURL(Ob),Ob=null)}function wd(a){ie(function(){var c=A;try{A=new a;A.width=ca;A.height=da;n();var m=A.toBlob();Ob=window.URL.createObjectURL(m);xd(Ob)}finally{A=c}})}function Pb(a){var c=null,m=1E6;console.log("getElementAtMouse");
for(var b=0;b<t.gslp.length;b++){var d=t.gslp[b];if(!d.pinned&&!1!==d.visible&&!0!==d.tmp){var e=y.drawingstate.matrix.sdet;if("P"===d.kind){var f=g.normalizeZ(d.homog);if(!g._helper.isAlmostReal(f))continue;var h=f.value[0].value.real-a.x;var l=f.value[1].value.real-a.y;var M=Math.sqrt(h*h+l*l);d.narrow&M>20/e&&(M=1E4)}else if("C"===d.kind)l=t.csnames[d.args[0]],M=0,"undefined"!==typeof d.radius&&(M=d.radius.value.real),h=k.div(l.homog.value[0],l.homog.value[2]).value.real,l=k.div(l.homog.value[1],
l.homog.value[2]).value.real,h-=a.x,l-=a.y,M=Math.sqrt(h*h+l*l)-M,l=h=0,0>M&&(M=-M),M+=30/e;else if("L"===d.kind||"S"===d.kind)h=d.homog,M=k,l=M.add(M.mult(h.value[0],M.conjugate(h.value[0])),M.mult(h.value[1],M.conjugate(h.value[1]))),l=g.scaldiv(M.sqrt(l),h),M=l.value[0].value.real*a.x+l.value[1].value.real*a.y+l.value[2].value.real,h=l.value[0].value.real*M,l=l.value[1].value.real*M,0>M&&(M=-M),M+=1;if(M<m+.2/e){m=M;c=d;var n={x:h,y:l}}}}return null===c?null:{mover:c,offset:n,prev:{x:a.x,y:a.y}}}
function Za(){return"P"+je++}function xb(a){var c=G[Bc].actions;c[yb].event===a&&c[yb].do()&&(f(),yb===c.length-1?(Da=[],yb=$a=0):yb++)}function Cc(a){return a&&.5>Math.abs(a.offset.x)&&.5>Math.abs(a.offset.y)&&!a.mover.tmp}function yd(a){return Cc(a)&&"P"===a.mover.kind}function zd(a){return Cc(a)&&("L"===a.mover.kind||"S"===a.mover.kind)}function Dc(a){ja={mover:a,offset:{x:0,y:0},prev:{x:aa.x,y:aa.y}}}function sb(){var a=Pb(aa);yd(a)?Da[$a]=a.mover:(Da[$a]={type:"Free",name:Za(),labeled:!0,pos:[ta[0],
ta[1],1]},Oa(Da[$a]));$a++}function Ad(){var a=Pb(aa);return zd(a)?(Da[$a]=a.mover,$a++,!0):!1}function Bd(){var a=Pb(aa),c;(c=zd(a))||(c=Cc(a)&&"C"===a.mover.kind);return c?(Da[$a]=a.mover,$a++,!0):!1}function zb(){var a=Pb(aa);if(yd(a))for(Qb.args[1]=a.mover.name,a=0;a<t.gslp.length;a++){var c=t.gslp[a];!0===c.tmp&&bc(c.name)}else for(a=0;a<t.gslp.length;a++)c=t.gslp[a],!0===c.tmp&&(c.tmp=!1)}function cc(a){var c={type:"Free",name:Za(),labeled:!0,pos:[ta[0],ta[1],1],tmp:!0};c=Oa(c);Qb=Oa({type:a,
name:Za(),labeled:!0,args:[Da[0].name,c.name]});Dc(c)}function ke(a){for(var c in a)null!==a[c]&&(ha[c]=a[c])}function Xd(a){Object.keys(l).forEach(function(a){var c=l[a];jb(c.signature||"_helper"===a,a+" has no signature");void 0!==c.updatePosition&&void 0===c.stateSize&&(c.stateSize=0)});t.gslp=[];t.csnames={};t.points=[];t.lines=[];t.conics=[];t.texts=[];t.free=[];t.polygons=[];t.ifs=[];t.sets={points:[],lines:[],conics:[]};a.forEach(Cd);Dd()}function Ed(a){"undefined"===typeof a.tracedim&&(a.tracedim=
1);"undefined"===typeof a.tracelength&&(a.tracelength=100);"undefined"===typeof a.traceskip&&(a.traceskip=1);a._traces=Array(a.tracelength);a._traces_index=0;a._traces_tick=0}function le(a){void 0===a.size&&(a.size=ha.pointSize);a.size=k.real(a.size);!a.movable||a.pinned?(a.color=g.realVector(a.color||ha.pointColor),a.color=g.scalmult(k.real(ha.dimDependent),a.color)):a.color=g.realVector(a.color||ha.pointColor);void 0===a.alpha&&(a.alpha=ha.alpha);a.alpha=k.real(a.alpha);"boolean"!==typeof a.noborder&&
(a.noborder=ha.noborder);a.noborder=u.bool(a.noborder);"boolean"!==typeof a.border&&(a.border=!ha.noborder);a.border=u.bool(a.border);a.drawtrace&&Ed(a)}function dc(a){void 0===a.size&&(a.size=ha.lineSize);a.size=k.real(a.size);a.color=g.realVector(a.color||ha.lineColor);void 0===a.alpha&&(a.alpha=ha.alpha);a.alpha=k.real(a.alpha);a.clip=u.string(a.clip||ha.clip);void 0===a.overhang&&(a.overhang=ha.overhangLine);a.overhang=k.real(a.overhang);a.dashtype&&(a.dashtype=u.wrap(a.dashtype))}function me(a){void 0===
a.overhang&&(a.overhang=ha.overhangSeg);a.arrow&&(a.arrow=u.bool(a.arrow));a.arrowsize&&(a.arrowsize=k.real(a.arrowsize));a.arrowposition&&(a.arrowposition=k.real(a.arrowposition));a.arrowshape&&(a.arrowshape=u.string(a.arrowshape));a.arrowsides&&(a.arrowsides=u.string(a.arrowsides));dc(a);a.clip=u.string("end")}function ne(a){a.size=void 0!==a.textsize?a.textsize:void 0!==a.size?a.size:ha.textsize;a.size=k.real(+a.size)}function oe(a){a.filled=void 0!==a.filled?u.bool(a.filled):u.bool(!0);a.fillcolor=
void 0===a.fillcolor?h:g.realVector(a.fillcolor);void 0===a.fillalpha&&(a.fillalpha=0);a.fillalpha=k.real(a.fillalpha);dc(a)}function Oa(a,c){a=Cd(a);Dd();return"boolean"===typeof c&&c&&a.Duplicate?(c=a.Duplicate,console.log("duplication detected: removing "+a.name+" (type "+a.kind+") (duplicate of "+c.name+")."),bc(a.name),c):a}function Cd(a){if(void 0!==t.csnames[a.name]){console.log("Element name '"+a.name+"' already exists");var c=t.csnames[a.name];l[c.type].isMovable&&"P"===l[c.type].kind&&Ea(c,
a.pos,"homog");return c}for(;Ab.hasOwnProperty(a.type);)a.type=Ab[a.type];if(c=Ec[a.type]){var m=c(a),b=null;for(c=0;c<m.length;++c)b=Oa(m[c]);return b}var d=l[a.type];m=!1;if(!d)return console.error(a),console.error("Operation "+a.type+" not implemented yet"),null;if("**"!==d.signature)if(!Array.isArray(d.signature)&&"*"===d.signature.charAt(1))m=!0,a.args.forEach(function(c){if(t.csnames[c].kind!==d.signature.charAt(0))return console.error("Not all elements in set are of same type: "+a.name+" expects "+
d.signature+" but "+c+" is of kind "+t.csnames[c].kind),"undefined"!==typeof window&&window.alert("Not all elements in set are of same type: "+a.name),null});else if(d.signature.length!==(a.args?a.args.length:0))return console.error("Wrong number of arguments for "+a.name+" of type "+a.type),"undefined"!==typeof window&&window.alert("Wrong number of arguments for "+a.name),null;if(a.args)for(c=0;c<a.args.length;++c){if(!t.csnames.hasOwnProperty(a.args[c]))return console.log("Dropping "+a.name+" due to missing argument "+
a.args[c]),null;if("**"!==d.signature&&!m&&(b=t.csnames[a.args[c]].kind,d.signature[c]!==b&&("S"!==b||"L"!==d.signature[c])))return window.alert("Wrong argument kind "+b+" as argument "+c+" to element "+a.name+" of type "+a.type),null}d.signatureConstraints&&!d.signatureConstraints(a)&&window.alert("signature constraints violated for element "+a.name);t.gslp.push(a);t.csnames[a.name]=a;c=Ha.length;a.kind=d.kind;a.stateIdx=c;c+=d.stateSize;a.incidences=[];a.isshowing=!0;a.movable=!1;d.isMovable&&(a.movable=
!0,t.free.push(a));"P"===a.kind&&(t.points.push(a),le(a));"L"===a.kind&&(t.lines.push(a),dc(a));"C"===a.kind&&(t.conics.push(a),dc(a));"S"===a.kind&&(t.lines.push(a),me(a));"Text"===a.kind&&(t.texts.push(a),ne(a));"Poly"===a.kind&&(t.polygons.push(a),oe(a));"IFS"===a.kind&&t.ifs.push(a);/^[P|L|S|C]s$/.test(a.kind)&&t.sets[{P:"points",L:"lines",S:"lines",C:"conics"}[a.kind[0]]].push(a);pe(c);oa=Ra=Ha;kb=!0;d.initialize&&(Fa=Ia=a.stateIdx,a.param=d.initialize(a),jb(Ia===a.stateIdx+d.stateSize,"State fully initialized"));
Fa=Ia=a.stateIdx;d.updatePosition(a,!1);jb(Fa===a.stateIdx+d.stateSize,"State fully consumed");jb(Ia===a.stateIdx+d.stateSize,"State fully updated");kb=!1;oa=Ya.in;oa.set(Ha);Ra=Ya.out;Fc(a,d);ec={};ea(a);lb(a);return t.csnames[a.name]}function bc(a){if(t.csnames.hasOwnProperty(a)){var c={};Object.keys(t.csnames).forEach(function(a){var m=t.csnames[a];m.hasOwnProperty("args")&&m.args.forEach(function(m){c.hasOwnProperty(m)||(c[m]={});c[m][a]=!0})});var m=function(a,b){b[a]=!0;if(!c.hasOwnProperty(a))return b;
for(var D in c[a])b[D]||m(D,b);return b};a=m(a,{});qe(a)}else console.log("removeElement: name "+a+"does not exist.")}function qe(a){var c=Object.keys(a),m=function(a,c){return function(c){return a[c.name]?!1:!0}},b={};c.forEach(function(c){t.csnames[c].incidences.forEach(function(c){b[c]||(t.csnames[c].incidences=t.csnames[c].incidences.filter(function(c){return!a[c]}),b[c]=!0)})});"conics free gslp ifs lines points polygons texts".split(" ").map(function(c){t[c]=t[c].filter(m(a,c))});for(var d in t.sets)t.sets[d]=
t.sets[d].filter(m(a,"set of "+d));c.forEach(function(a){delete t.csnames[a]});ec={}}function Fd(a,c){var m=t.csnames[c.args[0]].homog,b=t.csnames[c.args[1]].homog;c=a.homog;a=k.div(m.value[0],m.value[2]);m=k.div(m.value[1],m.value[2]);var d=k.div(b.value[0],b.value[2]);b=k.div(b.value[1],b.value[2]);var g=k.div(c.value[0],c.value[2]);c=k.div(c.value[1],c.value[2]);return k._helper.isAlmostReal(a)&&k._helper.isAlmostReal(m)&&k._helper.isAlmostReal(d)&&k._helper.isAlmostReal(b)&&k._helper.isAlmostReal(g)&&
k._helper.isAlmostReal(c)?(a=a.value.real,m=m.value.real,d=d.value.real,b=b.value.real,g=g.value.real,c=c.value.real,a=Math.sqrt((a-d)*(a-d)+(m-b)*(m-b))-Math.sqrt((a-g)*(a-g)+(m-c)*(m-c))-Math.sqrt((d-g)*(d-g)+(b-c)*(b-c)),1E-15>a*a):!1}function Fc(a,c){a.isshowing=!0;if(a.args)for(var m=0;m<a.args.length;m++)if(!t.csnames[a.args[m]].isshowing){a.isshowing=!1;return}c.visiblecheck&&c.visiblecheck(a)}function cd(a,c,m,b,d){var D=a.textsize||ha.textsize,g=!0===a.textbold,e=!0===a.textitalics,P=a.text_fontfamily||
ha.fontFamily,f=b.x*b.x+b.y*b.y,h=1;0<f&&(h=1+a.size.value.real/Math.sqrt(f));a=a.alpha||k.real(ha.alpha);C.drawtext([m,u.wrap(c)],{x_offset:u.wrap(h*b.x),y_offset:u.wrap(h*b.y),size:u.wrap(D),bold:u.wrap(g),italics:u.wrap(e),family:u.wrap(P),color:d,alpha:a})}function ce(a){a._bbox=null;if(a.isshowing&&!1!==a.visible){var c={size:a.size},m=a.homog,b=a.text,d=l[a.type].getText;b=d?d(a):b.replace(/@[$#]"([^"\\]|\\.)*"/g,function(a){try{var c=JSON.parse(a.substring(2));var m=t.csnames[c];if(!m)return"?"}catch(Re){return"?"}switch(a.charAt(1)){case "$":return m.printname||
c;case "#":return"V"!==m.kind?"?":U(m.value)}});d=null;if(a.html){var g=a._textCache||{text:!1},e=a.html,f=e.parentNode,k=f.parentNode;d=function(c,m,b,D,d){g.invisible&&k.style.removeProperty("display");if(c!==g.text||m!==g.font||b!==g.x||D!==g.y||d!==g.align){m!==g.font&&(e.style.font=m,e.style.lineHeight=ha.lineHeight);c!==g.text&&!1!==c&&!1===Gd(e,c,m)&&(c=!1);k.style.left=b+"px";k.style.top=D+"px";if(d||f.style.transform)f.style.transform="translateX("+-100*d+"%)";a._textCache={text:c,font:m,
x:b,y:D,align:d}}}}b=u.string(b);a.dock&&(a.dock.to?m=t.csnames[a.dock.to].homog:Hd.hasOwnProperty(a.dock.corner)&&(m=r.screenbounds$0([],{}),m=m.value[Hd[a.dock.corner]]),c.offset=a.dock.offset);a.align&&(c.align=u.string(a.align));m&&(a._bbox=C.drawtext([m,b],c,d))}else a.html&&(a.html.parentNode.parentNode.style.display="none",a._textCache={invisible:!0})}function be(){function a(){var a=f++/m._traces.length,c=m._traces[e];c&&(a*=b*a*a,r.draw$1([c],{size:k.real(d),color:m.color,alpha:k.real(a)}));
d*=g}for(var c=0;c<t.points.length;c++){var m=t.points[c];if(m.drawtrace){m._traces_tick===m.traceskip?(m._traces[m._traces_index]=m.homog,m._traces_index=(m._traces_index+1)%m._traces.length,m._traces_tick=0):m._traces_tick++;var b=m.alpha.value.real,d=m.size.value.real,g=1;1!==m.tracedim&&(d*=m.tracedim,g=Math.pow(m.tracedim,-1/m._traces.length));var e,f=0;for(e=m._traces_index;e<m._traces.length;++e)a();for(e=0;e<m._traces_index;++e)a()}}}function jb(a,c){c="Assertion failed: "+c;if(!a)throw console.log(c),
bb(),"undefined"!==typeof alert&&alert(c),Error(c);}function pe(a){if(a!==Ha.length){var c,m=Gc.length;if(mb.length<a*m){var b=2*a;mb=new Float64Array(m*b)}else b=mb.length/m|0;for(c=0;c<m;++c)Ya[Gc[c]]=mb.subarray(c*b,c*b+a);a=Ha;oa=Ya.in;Ra=Ya.out;Ha=Ya.good;Ha.set(a)}}function Bb(){Ha.set(oa);Pa=!1;Id(!1);for(var a=Ha.length,c=Math.abs,m=0;m<a;m+=2)c(Ha[m])>1E12*c(Ha[m+1])&&(Ha[m+1]=0)}function fc(){if(Cb)Pa=!0;else throw Jd;}function Kd(a,c,m,b,d){return u.add(b,u.mult(m,u.sub(d,b)))}function ae(){N&&
(N.currentMouseAndScripts=[]);Hc=!0;if(ja){var a=ja.mover,c=g.realVector([aa.x+ja.offset.x,aa.y+ja.offset.y,1]);Ld(a,c,"mouse");ja.prev.x=aa.x;ja.prev.y=aa.y}z(S.move);z(S.draw);Pa||Bb();Hc=!1;N&&(N.fullLog.push(g.turnIntoCSList([g.turnIntoCSList(N.currentMouseAndScripts)])),N.length>N.logLength&&N.splice(0,N.length-N.logLength),N.currentMouseAndScripts=null,N.postMouseHooks.forEach(function(a){a()}))}function Ea(a,c,m){Ld(a,c,m);Hc||Pa||Bb()}function Ld(a,c,m){N&&N.currentMouseAndScripts&&(N.currentMover=
[]);a===Md?(oa.set(Ha),Pa=!1):(Md=a,Bb());Ra.set(oa);var b=1E4;var d=ec[a.name];if(!d){var e={},f=0;d=[];e[a.name]=a;for(var h=t.gslp,n=0;n<h.length;++n){var M=h[n],wb=M.args;if(wb)for(var p=0;p<wb.length;++p)e.hasOwnProperty(wb[p])&&(e[M.name]=M,d[f++]=M)}ec[a.name]=d}e=-1;f=.9;var q;h=l[a.type];n=h.parameterPath||Kd;Fa=a.stateIdx;M=h.getParamFromState(a);Fa=Ia=a.stateIdx;wb=h.getParamForInput(a,c,m);for(p=e+f;e!==p;){var r=p*p,v=.5/(1+r);v=k.complex(2*p*v+.5,(1-r)*v);Cb=e+.5*f<=e||0===b;0===b&&
console.log("tracing limit Reached");r=!1;N&&N.currentMouseAndScripts&&(N.currentStep=[]);try{Fa=Ia=a.stateIdx;var w=n(a,p,v,M,wb);N&&(N.currentParam=w);v=Ra;Ra=oa;h.putParamToState(a,w);Ra=v;Ia=a.stateIdx;N&&(N.currentElement=a);h.updatePosition(a,!0);jb(Fa===a.stateIdx+h.stateSize,"State fully consumed");jb(Ia===a.stateIdx+h.stateSize,"State fully updated");for(q=0;q<d.length;++q){var x=d[q];var y=l[x.type];Fa=Ia=x.stateIdx;N&&(N.currentElement=x);y.updatePosition(x,!1);jb(Fa===x.stateIdx+y.stateSize,
"State fully consumed");jb(Ia===x.stateIdx+y.stateSize,"State fully updated")}N&&(N.currentElement=null);e=p;f*=1.25;p+=f;1<=p&&(p=1);Ra=oa;oa=v}catch(bd){if(bd!==Jd)throw bd;f*=.5;p=e+f;--b;r=!0}N&&N.currentMouseAndScripts&&(N.currentMover.push(g.turnIntoCSList([g.turnIntoCSList(N.currentStep),u.wrap(r),u.wrap(e),u.wrap(p),u.wrap(N.currentParam)])),N.currentStep=null,N.currentParam=null)}Id(Pa);for(q=0;q<d.length;++q)x=d[q],y=l[x.type],Fc(x,y);N&&N.currentMouseAndScripts&&(N.currentMouseAndScripts.push(g.turnIntoCSList([g.turnIntoCSList(N.currentMover),
u.wrap(Pa),u.wrap(a.name),c,u.wrap(m),M,wb])),N.currentMover=null)}function ad(){Bb();Cb=!0;for(var a=t.gslp,c=0;c<a.length;c++){var m=a[c],b=l[m.type];Fa=Ia=m.stateIdx;b.updatePosition(m,!1);Fc(m,b)}a=Ra;Ra=oa;oa=a;Bb()}function Id(a){var c=p.tracingStateReport;"string"===typeof c&&(document.getElementById(c).textContent=a?"BAD":"GOOD")}function re(){return g.turnIntoCSList(N.fullLog.slice())}function se(a){var c=JSON.stringify(N.fullLog);a=new Blob([c],{type:a?"application/octet-stream":"application/json"});
return window.URL.createObjectURL(a)}function Db(){var a=Fa;Fa+=2;return k.complex(oa[a],oa[a+1])}function Z(a){for(var c=Array(a),m=0;m<a;++m)c[m]=Db();return g.turnIntoCSList(c)}function ab(a){Ra[Ia]=a.value.real;Ra[Ia+1]=a.value.imag;Ia+=2}function V(a){for(var c=0,m=a.value.length;c<m;++c)ab(a.value[c])}function Sa(a,c){var m=Z(3),b=Z(3);a=Ic(a,c,m,b);V(a[0]);V(a[1]);return g.turnIntoCSList(a)}function Ic(a,c,m,b){if(kb)return[a,c];var D=g.projectiveDistMinScal(m,a),d=g.projectiveDistMinScal(m,
c),e=g.projectiveDistMinScal(b,a),f=g.projectiveDistMinScal(b,c),k=g.projectiveDistMinScal(m,b),l=g.projectiveDistMinScal(a,c),n=D+f,p=d+e;if(n>p){var q=[c,a];n=p}else q=[a,c];p=function(){};if(N&&N.currentStep){var t=[N.labelTracing2,u.wrap(N.currentElement.name),g.turnIntoCSList(q),g.turnIntoCSList([m,b]),g.realMatrix([[D,d],[e,f]]),u.wrap(n),u.wrap(k),u.wrap(l),h];N.currentStep.push(g.turnIntoCSList(t));p=function(a){N.hasOwnProperty(a)||(N[a]=u.wrap(a));t[t.length-1]=N[a]}}g._helper.isNaN(a)||
g._helper.isNaN(c)?(p("Tracing failed due to NaNs."),Pa=!0):k>3*n&&l>3*n?p("Normal case, everything all right."):1E-5>l?1E-5>k?p("Staying inside singularity."):(p("Moved into singularity."),Pa=!0):1E-5>k?p("Moved out of singularity."):(Cb?p("Reached refinement limit, giving up."):p("Need to refine."),fc());return q}function Jc(a,c,m,b){var D=Z(3),d=Z(3),e=Z(3),f=Z(3);a=te(a,c,m,b,D,d,e,f);V(a[0]);V(a[1]);V(a[2]);V(a[3]);return g.turnIntoCSList(a)}function te(a,c,m,b,d,e,f,k){var D=function(){};d=
[d,e,f,k];a=[a,c,m,b];if(kb)return a;e=0;b=Array(4);for(m=0;4>m;m++)for(b[m]=Array(4),k=0;4>k;k++)f=g.projectiveDistMinScal(d[m],a[k]),b[m][k]=f;f=yc(b);c=Array(4);for(m=0;4>m;++m)c[m]=a[f[m]],e+=b[m][f[m]];var P=1*e,F=Infinity,l=Infinity;for(m=0;4>m;m++){if(g._helper.isNaN(a[m]))return D("Tracing failed due to NaNs."),Pa=!0,c;for(k=m+1;4>k;k++)f=g.projectiveDistMinScal(d[m],d[k]),F>f&&(F=f),f=g.projectiveDistMinScal(c[m],c[k]),l>f&&(l=f)}if(N&&N.currentStep){var Ua=[N.labelTracing4,u.wrap(N.currentElement.name),
g.turnIntoCSList(c),g.turnIntoCSList(d),g.realMatrix(b),u.wrap(e),u.wrap(F),u.wrap(l),h];N.currentStep.push(g.turnIntoCSList(Ua));D=function(a){N.hasOwnProperty(a)||(N[a]=u.wrap(a));Ua[Ua.length-1]=N[a]}}F>P&&l>P||(1E-5>l?1E-5>F?D("Staying inside singularity."):(D("Moved into singularity."),Pa=!0):1E-5>F?D("Moved out of singularity."):(Cb?D("Reached refinement limit, giving up."):D("Need to refine."),fc()));return c}function Nd(a){var c=a.length,m,b;if(kb){for(m=0;m<c;++m)Fa+=2*a[m].value.length,
V(a[m]);return a}var d=Array(c),e=Array(c),f=Array(c),k=99,l=99,M=Array(c);for(m=0;m<c;++m)d[m]=Z(a[m].value.length),e[m]=g.normSquared(d[m]).value.real,f[m]=g.normSquared(a[m]).value.real,M[m]=Array(c);for(m=0;m<c;++m){for(b=0;b<c;++b){var n=g.sesquilinearproduct(d[m],a[b]).value;n=(n.real*n.real+n.imag*n.imag)/(e[m]*f[b]);M[m][b]=1-n}for(b=m+1;b<c;++b)n=g.sesquilinearproduct(d[m],d[b]).value,n=(n.real*n.real+n.imag*n.imag)/(e[m]*e[b]),k>1-n&&(k=1-n),n=g.sesquilinearproduct(a[m],a[b]).value,n=(n.real*
n.real+n.imag*n.imag)/(f[m]*f[b]),l>1-n&&(l=1-n)}n=yc(M);b=Array(c);e=0;f=!1;for(m=0;m<c;++m){e+=M[m][n[m]];var p=b[m]=a[n[m]];V(p);f|=g._helper.isNaN(p)}f|=isNaN(e);a=function(){};if(N&&N.currentStep){var q=[N.labelTracingSesq,u.wrap(N.currentElement.name),g.turnIntoCSList(b),g.turnIntoCSList(d),g.realMatrix(M),u.wrap(e),u.wrap(k),u.wrap(l),h];N.currentStep.push(g.turnIntoCSList(q));a=function(a){N.hasOwnProperty(a)||(N[a]=u.wrap(a));q[q.length-1]=N[a]}}f?(a("Tracing failed due to NaNs."),Pa=!0):
k>3*e&&l>3*e?a("Normal case, everything all right."):1E-5>l?1E-5>k?a("Staying inside singularity."):(a("Moved into singularity."),Pa=!0):1E-5>k?a("Moved out of singularity."):(Cb?a("Reached refinement limit, giving up."):a("Need to refine."),fc());return b}function Rb(a,c){a=l._helper.flattenConicMatrix(a);c=l._helper.flattenConicMatrix(c);var m=Z(6),b=Z(6);c=Ic(a,c,m,b);V(c[0]);V(c[1]);a=l._helper.buildConicMatrix(c[0].value);c=l._helper.buildConicMatrix(c[1].value);return g.turnIntoCSList([a,c])}
function ea(a){if(ea.hasOwnProperty(a.kind))ea[a.kind](a)}function lb(a){lb.hasOwnProperty(a.kind)&&(a.incidences=[],lb[a.kind](a))}function Od(a,c){return function(){a.incidences.push(c.name);c.incidences.push(a.name)}}function Sb(a,c){return function(){a.Duplicate=c}}function Pd(a,c){return{getInvolved:function(){return[a,c]},toString:function(){return"point "+a.name+" incident line "+c.name},apply:Od(a,c),holds:function(){var m=g.scaldiv(g.abs(a.homog),a.homog),b=g.scaldiv(g.abs(c.homog),c.homog);
return k.abs(g.scalproduct(m,b)).value.real<k.epsbig}}}function Qd(a,c){return{getInvolved:function(){return[a,c]},toString:function(){return"point "+a.name+" incident conic "+c.name},apply:Od(a,c),holds:function(){var m=u.mult(c.matrix,a.homog);m=u.mult(a.homog,m);m=k.abs(m);return m.value.real<k.epsbig}}}function Dd(){if(0!==sa.length){Ya.prover.set(oa);var a,c=function(){a={};sa.forEach(function(c){var b;c.getInvolved().forEach(function(c){a[c.name]||(a[c.name]=!0,b=m(c,{}),b.forEach(function(c){a[c]=
!0}))})})},m=function(a,c){a.incidences.forEach(function(a){c[a]||(c[a]=!0,m(t.csnames[a],c))});return Object.keys(c)};c();var b=function(a){return a.holds()};Object.keys(a).forEach(function(c){c=t.csnames[c].args;"undefined"!==typeof c&&c.forEach(function(c){a[c]=!0})});for(var d,g=0;3>g;g++){for(var e in a){var f=t.csnames[e];!f.pinned&&l[f.type].isMovable&&(d=l[f.type].getRandomMove(f),Ea(f,d.value,d.type),sa=sa.filter(b))}c()}oa.set(Ya.prover);ad();for(c=0;c<sa.length;++c)sa[c].apply();sa=[]}}
function Kc(a,c,m){var b=document.createElement("div"),d=document.createElement("img");d.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAPoCAQAAAC1v1zVAAAAGklEQVR42u3BMQEAAADCoPVPbQ0PoAAAgHcDC7gAAVI8ZnwAAAAASUVORK5CYII=";b.className="CindyJS-baseline";b.appendChild(d);d=document.createElement("div");d.className="CindyJS-button";b.appendChild(d);for(var g=2;g<arguments.length;++g)d.appendChild(arguments[g]);qa.parentNode.appendChild(b);a.html=arguments[arguments.length-1];La(a.fillalpha)||
(a.fillalpha=1);a.fillcolor&&(a.html.style.backgroundColor=x.makeColor(a.fillcolor,a.fillalpha));b=f;if(a.script){var e=Wa(a.script);b=function(){z(e);f()}}m.addEventListener(c,b);!p.keylistener&&(S.keydown||S.keyup||S.keytyped)&&(m.addEventListener("keydown",function(a){9!==a.keyCode&&O(a,S.keydown)}),m.addEventListener("keyup",function(a){O(a,S.keyup)}),m.addEventListener("keypress",function(a){9!==a.keyCode&&O(a,S.keytyped)}));l.Text.initialize(a)}function Va(){}function ue(a){if(!/^Select/.test(a.type)&&
!l[a.type].isMovable)return null;var c=u.unwrap,m=k.add;switch(a.kind){case "P":case "L":case "Text":return c(a.homog);case "C":return a=a.matrix.value,{xx:c(a[0].value[0]),yy:c(a[1].value[1]),zz:c(a[2].value[2]),xy:c(m(a[0].value[1],a[1].value[0])),xz:c(m(a[0].value[2],a[2].value[0])),yz:c(m(a[1].value[2],a[2].value[1]))};default:return null}}function ve(a){var c={};c.offset=u.unwrap(a.offset);a.to&&(c.to=a.to);a.corner&&(c.corner=a.corner);return c}function we(a){var c={};xe.forEach(function(m){if(a.hasOwnProperty(m)){var b=
u.unwrap(a[m]);null!==b&&void 0!==b&&(c[m]=b)}});if("P"===a.kind&&(!a.movable||a.pinned)&&c.color){var m=k.real(1/ha.dimDependent);c.color=u.unwrap(g.scalmult(m,a.color))}if(m=ue(a))c.pos=m;a.dock&&(c.dock=ve(a.dock));return c}function ye(){var a=[];t.gslp.forEach(function(c){c.tmp||a.push(we(c))});return a}function Yd(){Ja.forEach(function(a){var c=(a.geo||[]).map(function(a){return t.csnames[a]});Q[a.type].reset(a,c[0],c)})}function qc(a){tc=0!==a.length;Ja=[];na=[];Lc=[];Q.Environment.init({});
a.forEach(function(a){a.behavior?(a.name&&(a.behavior.geo=[a.name]),a=a.behavior,a.gravity&&(a.gravity=-a.gravity)):c=a.geo;var c=(a.geo||[]).map(function(a){return t.csnames[a]}),b=c[0],d=Q[a.type];d?(d.init&&d.init(a,b,c),b&&(b.behavior=a,"Mass"===a.type?na.push(b):"Spring"===a.type&&Lc.push(b)),Ja.push(a)):(console.error(a),console.error("Behavior "+a.type+" not implemented yet"))})}var xa=this,ya,S={},db=!1,Yb=!0,Jb=0,Zc=.5,sc=0,Xb=10,Rd=5/360,$d=.32/Rd/1E3*2,Vb=1,Ca=0,oc=0,Fb=!1,Gb=!1,qa,Eb,
La=Number.isFinite||function(a){return"number"===typeof a&&isFinite(a)},ta,A,ca,da,t,cb,uc=h,vc=h,Xa={play:Va,pause:Va,stop:Va},rc=null,Hb=function(a,c){var m=[];Hb=function(a,c){m.push({img:a,id:c})};Hb(a,c);var b=xa.getBaseDir()+"images/Icons.svg",d=new XMLHttpRequest;d.onreadystatechange=function(){if(d.readyState===XMLHttpRequest.DONE)if(200!==d.status)console.error("Failed to load CindyJS Icons.svg from "+b+": "+d.statusText);else{var a=d.responseXML,c=a.documentElement,D={},g;for(g=c.firstChild;g;g=
e){var e=g.nextSibling;g.nodeType===Node.ELEMENT_NODE&&"http://www.w3.org/2000/svg"===g.namespaceURI&&"g"===g.localName.toLowerCase()&&(c.removeChild(g),g.setAttribute("style","display:inline"),D[g.getAttribute("id")]=g)}var f=new XMLSerializer;Hb=function(m,b){if(D.hasOwnProperty(b)){b=D[b];c.appendChild(b);try{var d=f.serializeToString(a)}finally{c.removeChild(b)}m.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(d)}};m.forEach(function(a){Hb(a.img,a.id)});m=null}};d.responseType="document";
d.open("GET",b);d.send()},$c=1,Ib=null,ib=[],Zb=!1,ua={config:p,startup:ia,shutdown:bb,evokeCS:function(a){a=Wa(a,!1);z(a);f()},play:Aa,pause:Ka,stop:nb,evalcs:function(a){return z(Wa(a,!1))},parse:function(a){return Wa(a)},niceprint:U,canvas:null},nc=!1,Wb=0;p.use&&p.use.forEach(function(a){var c=null;p.plugins&&(c=p.plugins[a]);c||(c=xa._pluginRegistry[a]);c||(++Wb,console.log("Loading script for plugin "+a),xa.loadScript(a+"-plugin",a+"-plugin.js",function(){console.log("Successfully loaded plugin "+
a);0===--Wb&&nc&&ia()},function(){console.error("Failed to auto-load plugin "+a);0===--Wb&&nc&&ia()}))});Tb.prototype=new ob;gb.prototype=new ob;wa.prototype=new ob;var aa={},ja,dd="",ed=0;var wc=p.isNode?process.nextTick:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,0)};var xc=null,ze=[0,8,7,166,"ge802985"],k={_helper:{}};k._helper.roundingfactor=1E4;
k._helper.angleroundingfactor=10;k._helper.niceround=function(a,c){return Math.round(a*c)/c};k.niceprint=function(a,c){c=c||k._helper.roundingfactor;if("Angle"===a.usage)return k._helper.niceangle(a);var m=k._helper.niceround(a.value.real,c);a=k._helper.niceround(a.value.imag,c);return 0===a?""+m:0<a?""+m+" + i*"+a:""+m+" - i*"+-a};var Mc=p.angleUnit||"\u00b0",Ae=Mc.replace(/\s+/g,""),Nc=2*Math.PI,Be=1/Nc,Ce={rad:Nc,"\u00b0":360,deg:360,degree:360,gra:400,grad:400,turn:1,cyc:1,rev:1,rot:1,"\u03c0":2,
pi:2,quad:4};k._helper.niceangle=function(a){var c=Ce[Ae];if(!c)return k.niceprint(u.withUsage(a,null));if("function"===typeof c)return c(a);a=k.niceprint(k.realmult(c*Be,a),200<c?k._helper.angleroundingfactor:null);return-1===a.indexOf("i*")?a+Mc:"("+a+")"+Mc};k.complex=function(a,c){return{ctype:"number",value:{real:a,imag:c}}};k.real=function(a){return{ctype:"number",value:{real:a,imag:0}}};k.zero=k.real(0);k.one=k.real(1);k.infinity=k.complex(Infinity,Infinity);k.nan=k.complex(NaN,NaN);k._helper.input=
function(a){return"object"===typeof a?k.complex(+a.r,+a.i):k.real(+a)};k.argmax=function(a,c){return a.value.real*a.value.real+a.value.imag*a.value.imag<c.value.real*c.value.real+c.value.imag*c.value.imag?c:a};k.max=function(a,c){return{ctype:"number",value:{real:Math.max(a.value.real,c.value.real),imag:Math.max(a.value.imag,c.value.imag)}}};k.min=function(a,c){return{ctype:"number",value:{real:Math.min(a.value.real,c.value.real),imag:Math.min(a.value.imag,c.value.imag)}}};k.add=function(a,c){return{ctype:"number",
value:{real:a.value.real+c.value.real,imag:a.value.imag+c.value.imag}}};k.sub=function(a,c){return{ctype:"number",value:{real:a.value.real-c.value.real,imag:a.value.imag-c.value.imag}}};k.neg=function(a){return{ctype:"number",value:{real:-a.value.real,imag:-a.value.imag}}};k.re=function(a){return{ctype:"number",value:{real:a.value.real,imag:0}}};k.im=function(a){return{ctype:"number",value:{real:a.value.imag,imag:0}}};k.conjugate=function(a){return{ctype:"number",value:{real:a.value.real,imag:-a.value.imag}}};
k.round=function(a){return{ctype:"number",value:{real:Math.round(a.value.real),imag:Math.round(a.value.imag)}}};k.ceil=function(a){return{ctype:"number",value:{real:Math.ceil(a.value.real),imag:Math.ceil(a.value.imag)}}};k.floor=function(a){return{ctype:"number",value:{real:Math.floor(a.value.real),imag:Math.floor(a.value.imag)}}};k.mult=function(a,c){return{ctype:"number",value:{real:a.value.real*c.value.real-a.value.imag*c.value.imag,imag:a.value.real*c.value.imag+a.value.imag*c.value.real}}};k.realmult=
function(a,c){return{ctype:"number",value:{real:a*c.value.real,imag:a*c.value.imag}}};k.multiMult=function(a){var c=a[0];if("number"!==c.ctype)return h;for(var m=1;m<a.length;m++){if("number"!==a[m].ctype)return h;c=k.mult(c,a[m])}return c};k.abs2=function(a){return{ctype:"number",value:{real:a.value.real*a.value.real+a.value.imag*a.value.imag,imag:0}}};k.abs=function(a){return k.sqrt(k.abs2(a))};k.inv=function(a){var c=a.value.real*a.value.real+a.value.imag*a.value.imag;return{ctype:"number",value:{real:a.value.real/
c,imag:-a.value.imag/c}}};k.div=function(a,c){var m=a.value.real;a=a.value.imag;var b=c.value.real;c=c.value.imag;var d=b*b+c*c;return{ctype:"number",value:{real:(m*b+a*c)/d,imag:(a*b-m*c)/d}}};k.eps=1E-10;k.epsbig=1E-6;k.snap=function(a){var c=a.value.real;a=a.value.imag;Math.floor(c+k.eps)!==Math.floor(c-k.eps)&&(c=Math.round(c));Math.floor(a+k.eps)!==Math.floor(a-k.eps)&&(a=Math.round(a));return{ctype:"number",value:{real:c,imag:a}}};k.exp=function(a){var c=Math.exp(a.value.real);return{ctype:"number",
value:{real:c*Math.cos(a.value.imag),imag:c*Math.sin(a.value.imag)}}};k.cos=function(a){var c=a.value.real;a=a.value.imag;var m=Math.exp(a),b=m*Math.sin(-c),d=m*Math.cos(-c);m=Math.exp(-a);return{ctype:"number",value:{real:(d+m*Math.cos(c))/2,imag:(b+m*Math.sin(c))/2}}};k.sin=function(a){var c=a.value.real;a=a.value.imag;var m=Math.exp(a),b=m*Math.sin(-c),d=m*Math.cos(-c);m=Math.exp(-a);return{ctype:"number",value:{real:-(b-m*Math.sin(c))/2,imag:(d-m*Math.cos(c))/2}}};k.tan=function(a){var c=k.sin(a);
a=k.cos(a);return k.div(c,a)};k.arccos=function(a){var c=k.mult(a,k.neg(a));c=k.sqrt(k.add(k.real(1),c));a=k.add(k.mult(a,k.complex(0,1)),c);a=k.add(k.mult(k.log(a),k.complex(0,1)),k.real(.5*Math.PI));return u.withUsage(a,"Angle")};k.arcsin=function(a){var c=k.mult(a,k.neg(a));c=k.sqrt(k.add(k.real(1),c));a=k.add(k.mult(a,k.complex(0,1)),c);a=k.mult(k.log(a),k.complex(0,-1));return u.withUsage(a,"Angle")};k.arctan=function(a){var c=k.log(k.add(k.mult(a,k.complex(0,-1)),k.real(1)));a=k.log(k.add(k.mult(a,
k.complex(0,1)),k.real(1)));c=k.mult(k.sub(c,a),k.complex(0,.5));return u.withUsage(c,"Angle")};k.arctan2=function(a,c){if(void 0===c)var m=k.real(Math.atan2(a.value.imag,a.value.real));else k._helper.isReal(a)&&k._helper.isReal(c)?m=k.real(Math.atan2(c.value.real,a.value.real)):(m=k.add(a,k.mult(k.complex(0,1),c)),a=k.sqrt(k.add(k.mult(a,a),k.mult(c,c))),m=k.mult(k.complex(0,-1),k.log(k.div(m,a))));return u.withUsage(m,"Angle")};k.sqrt=function(a){var c=a.value.real,m=a.value.imag;a=Math.sqrt(Math.sqrt(c*
c+m*m));c=Math.atan2(m,c);return{ctype:"number",value:{real:a*Math.cos(c/2),imag:a*Math.sin(c/2)}}};k.powRealExponent=function(a,c){var m=a.value.real,b=a.value.imag;a=Math.pow(Math.sqrt(m*m+b*b),c);m=Math.atan2(b,m);return{ctype:"number",value:{real:a*Math.cos(m*c),imag:a*Math.sin(m*c)}}};k.log=function(a){var c=a.value.real;a=a.value.imag;var m=Math.sqrt(c*c+a*a),b=Math.atan2(a,c);0>a&&(b+=2*Math.PI);0===a&&0>c&&(b=Math.PI);b>Math.PI&&(b-=2*Math.PI);return k.snap({ctype:"number",value:{real:Math.log(m),
imag:b}})};k.pow=function(a,c){return k._helper.isZero(c)?k.one:k._helper.isZero(a)?k.zero:k._helper.isReal(c)?k.powRealExponent(a,c.value.real):k.exp(k.mult(k.log(a),c))};k.mod=function(a,c){var m=a.value.real,b=c.value.real;a=a.value.imag;c=c.value.imag;m-=Math.floor(m/b)*b;a-=Math.floor(a/c)*c;0===b&&(m=0);0===c&&(a=0);return k.snap({ctype:"number",value:{real:m,imag:a}})};k._helper.seed="NO";k._helper.seedrandom=function(a){a-=Math.floor(a);k._helper.seed=.8*a+.1};k._helper.rand=function(){if("NO"===
k._helper.seed)return Math.random();var a=k._helper.seed;a=1E3*Math.sin(1E3*a);a-=Math.floor(a);return k._helper.seed=a};k._helper.randnormal=function(){var a=k._helper.rand(),c=k._helper.rand();return Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*c)};k._helper.isEqual=function(a,c){return a.value.real===c.value.real&&a.value.imag===c.value.imag};k._helper.isLessThan=function(a,c){return a.value.real<c.value.real||a.value.real===c.value.real&&a.value.imag<c.value.imag};k._helper.compare=function(a,
c){return k._helper.isLessThan(a,c)?-1:k._helper.isEqual(a,c)?0:1};k._helper.isAlmostEqual=function(a,c,m){var b=k.eps;"undefined"!==typeof m&&(b=m);m=a.value.real-c.value.real;a=a.value.imag-c.value.imag;return m<b&&m>-b&&a<b&&a>-b};k._helper.isZero=function(a){return 0===a.value.real&&0===a.value.imag};k._helper.isAlmostZero=function(a){var c=a.value.real;a=a.value.imag;return c<k.eps&&c>-k.eps&&a<k.eps&&a>-k.eps};k._helper.isReal=function(a){return 0===a.value.imag};k._helper.isAlmostReal=function(a){a=
a.value.imag;return a<k.epsbig&&a>-k.epsbig};k._helper.isNaN=function(a){return isNaN(a.value.real)||isNaN(a.value.imag)};k._helper.isFinite=function(a){return isFinite(a.value.real)&&isFinite(a.value.imag)};k._helper.isAlmostImag=function(a){a=a.value.real;return a<k.epsbig&&a>-k.epsbig};k._helper.z3a=k.complex(-.5,.5*Math.sqrt(3));k._helper.z3b=k.complex(-.5,-.5*Math.sqrt(3));k._helper.cub1={ctype:"list",value:[k.one,k.one,k.one]};k._helper.cub2={ctype:"list",value:[k._helper.z3a,k.one,k._helper.z3b]};
k._helper.cub3={ctype:"list",value:[k._helper.z3b,k.one,k._helper.z3a]};k.solveCubic=function(a,c,m,b){a=k._helper.solveCubicHelper(a,c,m,b);return[g.scalproduct(k._helper.cub1,a),g.scalproduct(k._helper.cub2,a),g.scalproduct(k._helper.cub3,a)]};k._helper.solveCubicHelper=function(a,c,m,b){var D=a.value.real;a=a.value.imag;var d=c.value.real;c=c.value.imag;var e=m.value.real,f=m.value.imag,h=b.value.real,l=b.value.imag,n=D*e-a*f;m=D*f+a*e;b=4*n-(d*d-c*c);var p=4*m-2*d*c,q=D*d-a*c,t=D*c+a*d,r=b*e-
p*f-18*(q*h-t*l);p=b*f+p*e-18*(q*l+t*h);b=27*(D*D-a*a);var u=54*a*D,v=b*h-u*l,w=b*l+u*h,x=d*d-c*c,y=2*d*c,z=x*d-y*c,A=x*c+y*d,B=v+4*z;u=w+4*A;b=27*(r*e-p*f+B*h-u*l);p=27*(r*f+p*e+B*l+u*h);B=Math.sqrt(Math.sqrt(b*b+p*p));u=Math.atan2(p,b);p=B*Math.sin(u/2);b=B*Math.cos(u/2);z=-2*z+9*(q*e-t*f)-v+(b*D-p*a);A=-2*A+9*(q*f+t*e)-w+(b*a+p*D);b=Math.exp(Math.log(Math.sqrt(z*z+A*A))/3);e=Math.atan2(A,z);u=b*Math.sin(e/3);p=b*Math.cos(e/3);b*=b;e*=2;n=2*x-6*n;m=2*y-6*m;y=-1.5874010519681996*(d*p-c*u);d=-1.5874010519681996*
(d*u+c*p);c=1.2599210498948732*b*Math.cos(e/3);e=1.2599210498948732*b*Math.sin(e/3);b=4.762203155904599*(p*D-u*a);p=4.762203155904599*(p*a+u*D);D=b*b+p*p;u=(-n*p+m*b)/D;n=(n*b+m*p)/D;m=u;u=(-y*p+d*b)/D;y=(y*b+d*p)/D;d=u;u=(-c*p+e*b)/D;c=(c*b+e*p)/D;e=u;return g.turnIntoCSList([k.complex(n,m),k.complex(y,d),k.complex(c,e)])};k._helper.getRangeRand=function(a,c){return Math.random()*(c-a)+a};k.getRandReal=function(a,c){a=k._helper.getRangeRand(a,c);return k.real(a)};k.getRandComplex=function(a,c){var m=
k._helper.getRangeRand(a,c);a=k._helper.getRangeRand(a,c);return k.complex(m,a)};var g={_helper:{},turnIntoCSList:function(a){return{ctype:"list",value:a}}};g.EMPTY=g.turnIntoCSList([]);g.asList=function(a){return"list"===a.ctype?a:"number"===a.ctype||"boolean"===a.ctype||"geo"===a.ctype?g.turnIntoCSList([a]):g.EMPTY};g.realVector=function(a){for(var c=[],m=0;m<a.length;m++)c[m]={ctype:"number",value:{real:a[m],imag:0}};return{ctype:"list",value:c}};g._helper.unitvector=function(a,c){a=g.zerovector(a);
a.value[Math.floor(c.value.real-1)]=k.real(1);return a};g.idMatrix=function(a){for(var c=g.zeromatrix(a,a),m=k.real(1),b=0;b<a.value.real;b++)c.value[b].value[b]=m;return c};g._helper.flippedidMatrix=function(a){for(var c=g.zeromatrix(a,a),m=k.real(1),b=0;b<a.value.real;b++)c.value[b].value[a.value.real-b-1]=m;return c};g.println=function(a){for(var c=[],m=0;m<a.value.length;m++)if("number"===a.value[m].ctype)c[m]=k.niceprint(a.value[m]);else if("list"===a.value[m].ctype)g.println(a.value[m]);else return h;
"number"===a.value[0].ctype&&console.log(c)};g.matrix=function(a){return g.turnIntoCSList(a.map(g.turnIntoCSList))};g.realMatrix=function(a){for(var c=a.length,m=Array(c),b=0;b<c;b++)m[b]=g.realVector(a[b]);return g.turnIntoCSList(m)};g.ex=g.realVector([1,0,0]);g.ey=g.realVector([0,1,0]);g.ez=g.realVector([0,0,1]);g.linfty=g.realVector([0,0,1]);g.ii=g.turnIntoCSList([k.complex(1,0),k.complex(0,1),k.complex(0,0)]);g.jj=g.turnIntoCSList([k.complex(1,0),k.complex(0,-1),k.complex(0,0)]);g.fundDual=g.realMatrix([[1,
0,0],[0,1,0],[0,0,0]]);g.fund=g.realMatrix([[0,0,0],[0,0,0],[0,0,1]]);g.sequence=function(a,c){var m=[],b=0;for(a=Math.round(a.value.real);a<Math.round(c.value.real)+1;a++)m[b]={ctype:"number",value:{real:a,imag:0}},b++;return{ctype:"list",value:m}};g.pairs=function(a){for(var c=[],m=0;m<a.value.length-1;m++)for(var b=m+1;b<a.value.length;b++)c.push({ctype:"list",value:[a.value[m],a.value[b]]});return{ctype:"list",value:c}};g.triples=function(a){for(var c=[],m=0;m<a.value.length-2;m++)for(var b=m+
1;b<a.value.length-1;b++)for(var d=b+1;d<a.value.length;d++)c.push({ctype:"list",value:[a.value[m],a.value[b],a.value[d]]});return{ctype:"list",value:c}};g.cycle=function(a){for(var c=[],m=0;m<a.value.length-1;m++)c[m]={ctype:"list",value:[a.value[m],a.value[m+1]]};c.push({ctype:"list",value:[a.value[a.value.length-1],a.value[0]]});return{ctype:"list",value:c}};g.consecutive=function(a){for(var c=[],m=0;m<a.value.length-1;m++)c[m]={ctype:"list",value:[a.value[m],a.value[m+1]]};return{ctype:"list",
value:c}};g.reverse=function(a){for(var c=Array(a.value.length),m=a.value.length-1,b=0;0<=m;m--,b++)c[b]=a.value[m];return{ctype:"list",value:c}};g.directproduct=function(a,c){for(var m=[],b=0;b<a.value.length;b++)for(var d=0;d<c.value.length;d++)m.push({ctype:"list",value:[a.value[b],c.value[d]]});return{ctype:"list",value:m}};g.concat=function(a,c){for(var m=[],b=0;b<a.value.length;b++)m.push(a.value[b]);for(a=0;a<c.value.length;a++)m.push(c.value[a]);return{ctype:"list",value:m}};g.prepend=function(a,
c){var m=[];m[0]=a;for(a=0;a<c.value.length;a++)m[a+1]=c.value[a];return{ctype:"list",value:m}};g.append=function(a,c){for(var m=[],b=0;b<a.value.length;b++)m[b]=a.value[b];m.push(c);return{ctype:"list",value:m}};g.contains=function(a,c){for(var m=0;m<a.value.length;m++)if(C.equals(a.value[m],c).value)return{ctype:"boolean",value:!0};return{ctype:"boolean",value:!1}};g.common=function(a,c){for(var m=[],b=0,d=0;d<a.value.length;d++){for(var g=!1,e=a.value[d],f=0;f<c.value.length;f++)g=g||C.equals(e,
c.value[f]).value;g&&(m[b]=a.value[d],b++)}return{ctype:"list",value:m}};g.remove=function(a,c){for(var m=[],b=0,d=0;d<a.value.length;d++){for(var g=!1,e=a.value[d],f=0;f<c.value.length;f++)g=g||C.equals(e,c.value[f]).value;g||(m[b]=a.value[d],b++)}return{ctype:"list",value:m}};g.sort1=function(a){a=a.value.slice();a.sort(u.compare);return g.turnIntoCSList(a)};g._helper.isEqual=function(a,c){return g.equals(a,c).value};g._helper.isLessThan=function(a,c){for(var m=a.value.length,b=c.value.length,d=
0;!(d>=m||d>=b)&&u.isEqual(a.value[d],c.value[d]);)d++;return d===m&&d<b?!0:d===b&&d<m||d===m&&d===b?!1:u.isLessThan(a.value[d],c.value[d])};g._helper.compare=function(a,c){return g._helper.isLessThan(a,c)?-1:g._helper.isEqual(a,c)?0:1};g.equals=function(a,c){if(a.value.length!==c.value.length)return{ctype:"boolean",value:!1};for(var m=!0,b=0;b<a.value.length;b++){var d=a.value[b],e=c.value[b];m="list"===d.ctype&&"list"===e.ctype?m&&g.equals(d,e).value:m&&vb([d,e],[]).value}return{ctype:"boolean",
value:m}};g.almostequals=function(a,c){if(a.value.length!==c.value.length)return{ctype:"boolean",value:!1};for(var m=!0,b=0;b<a.value.length;b++){var d=a.value[b],e=c.value[b];m="list"===d.ctype&&"list"===e.ctype?m&&g.almostequals(d,e).value:m&&kc([d,e],[]).value}return{ctype:"boolean",value:m}};g._helper.isAlmostReal=function(a){for(var c=!0,m=0;m<a.value.length;m++){var b=a.value[m];c="list"===b.ctype?c&&g._helper.isAlmostReal(b):c&&k._helper.isAlmostReal(b)}return c};g._helper.isAlmostZero=function(a){for(var c=
0;c<a.value.length;c++){var m=a.value[c];if("list"===m.ctype){if(!g._helper.isAlmostZero(m))return!1}else if(!k._helper.isAlmostZero(m))return!1}return!0};g._helper.isNaN=function(a){for(var c=!1,m=0;m<a.value.length;m++){var b=a.value[m];c="list"===b.ctype?c||g._helper.isNaN(b):c||k._helper.isNaN(b)}return c};g.set=function(a){var c=[],m=0;a=a.value.slice();a.sort(u.compare);for(var b=0;b<a.length;b++)0!==b&&vb([c[c.length-1],a[b]],[]).value||(c[m]=a[b],m++);return{ctype:"list",value:c}};g.maxval=
function(a){for(var c=k.zero,m=0;m<a.value.length;m++){var b=a.value[m];"number"===b.ctype&&(c=k.argmax(c,b));"list"===b.ctype&&(c=k.argmax(c,g.maxval(b)))}return c};g.maxIndex=function(a,c,m){var b=0;void 0!==m&&(b=m);m=b;for(var d=c(a.value[b]).value.real;b<a.value.length;++b){var g=c(a.value[b]).value.real;g>d&&(m=b,d=g)}return m};g.normalizeMax=function(a){var c=k.inv(g.maxval(a));return k._helper.isFinite(c)?g.scalmult(c,a):a};g.normalizeZ=function(a){var c=k.inv(a.value[2]);return g.scalmult(c,
a)};g.dehom=function(a){a=a.value.slice();var c=a.length-1,m=k.inv(a[c]);a.length=c;for(var b=0;b<c;++b)a[b]=k.mult(m,a[b]);return g.turnIntoCSList(a)};g.normalizeAbs=function(a){var c=k.inv(g.abs(a));return g.scalmult(c,a)};g.max=function(a,c){if(a.value.length!==c.value.length)return h;for(var m=[],b=0;b<a.value.length;b++)m[b]=u.max(a.value[b],c.value[b]);return{ctype:"list",value:m}};g.min=function(a,c){if(a.value.length!==c.value.length)return h;for(var m=[],b=0;b<a.value.length;b++)m[b]=u.min(a.value[b],
c.value[b]);return{ctype:"list",value:m}};g.scaldiv=function(a,c){if("number"!==a.ctype)return h;for(var m=[],b=0;b<c.value.length;b++){var d=c.value[b];m[b]="number"===d.ctype?u.div(d,a):"list"===d.ctype?g.scaldiv(a,d):h}return{ctype:"list",value:m}};g.scalmult=function(a,c){if("number"!==a.ctype)return h;for(var m=[],b=0;b<c.value.length;b++){var d=c.value[b];m[b]="number"===d.ctype?u.mult(d,a):"list"===d.ctype?g.scalmult(a,d):h}return{ctype:"list",value:m}};g.add=function(a,c){if(a.value.length!==
c.value.length)return h;for(var m=[],b=0;b<a.value.length;b++){var d=a.value[b],e=c.value[b];m[b]="number"===d.ctype&&"number"===e.ctype?u.add(d,e):"list"===d.ctype&&"list"===e.ctype?g.add(d,e):h}return{ctype:"list",value:m}};g.sub=function(a,c){if(a.value.length!==c.value.length)return h;for(var m=[],b=0;b<a.value.length;b++){var d=a.value[b],e=c.value[b];m[b]="number"===d.ctype&&"number"===e.ctype?k.sub(d,e):"list"===d.ctype&&"list"===e.ctype?g.sub(d,e):h}return{ctype:"list",value:m}};g.abs2=function(a){for(var c=
0,m=0;m<a.value.length;m++){var b=a.value[m];if("number"===b.ctype)c+=k.abs2(b).value.real;else if("list"===b.ctype)c+=g.abs2(b).value.real;else return h}return{ctype:"number",value:{real:c,imag:0}}};g.abs=function(a){return k.sqrt(g.abs2(a))};g.normalizeMaxXX=function(a){for(var c=-1E4,m=k.real(1),b=0;b<a.value.length;b++){var d=k.abs(a.value[b]);d.value.real>c&&(m=a.value[b],c=d.value.real)}return g.scaldiv(m,a)};g.recursive=function(a,c){for(var m=[],b=0;b<a.value.length;b++){var d=B(a.value[b]);
m[b]="number"===d.ctype?k[c](d):"list"===d.ctype?g[c](d):h}return{ctype:"list",value:m}};g.re=function(a){return g.recursive(a,"re")};g.neg=function(a){return g.recursive(a,"neg")};g.im=function(a){return g.recursive(a,"im")};g.conjugate=function(a){return g.recursive(a,"conjugate")};g.transjugate=function(a){return g.transpose(g.conjugate(a))};g.round=function(a){return g.recursive(a,"round")};g.ceil=function(a){return g.recursive(a,"ceil")};g.floor=function(a){return g.recursive(a,"floor")};g._helper.colNumb=
function(a){if("list"!==a.ctype)return-1;for(var c=-1,m=0;m<a.value.length;m++){if("list"!==a.value[m].ctype)return-1;if(0===m)c=a.value[m].value.length;else if(c!==a.value[m].value.length)return-1}return c};g._helper.isNumberVecN=function(a,c){if("list"!==a.ctype||a.value.length!==c)return!1;for(c=0;c<a.value.length;c++)if("number"!==a.value[c].ctype)return!1;return!0};g.isNumberVector=function(a){if("list"!==a.ctype)return{ctype:"boolean",value:!1};for(var c=0;c<a.value.length;c++)if("number"!==
a.value[c].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};g.isNumberVectorN=function(a,c){if("list"!==a.ctype)return{ctype:"boolean",value:!1};if(a.value)for(c=0;c<a.value.length;c++)if("number"!==a.value[c].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};g.isNumberMatrix=function(a){if(-1===g._helper.colNumb(a))return{ctype:"boolean",value:!1};for(var c=0;c<a.value.length;c++)if(!g.isNumberVector(a.value[c]).value)return{ctype:"boolean",value:!1};
return{ctype:"boolean",value:!0}};g._helper.isNumberMatrixMN=function(a,c,m){return g.isNumberMatrix(a).value&&a.value.length===c&&a.value[0].value.length===m};g.scalproduct=function(a,c){if(a.value.length!==c.value.length)return h;for(var m={ctype:"number",value:{real:0,imag:0}},b=0;b<c.value.length;b++){var d=a.value[b],g=c.value[b];if("number"===d.ctype&&"number"===g.ctype)m=k.add(k.mult(d,g),m);else return h}return m};g.sesquilinearproduct=function(a,c){if(a.value.length!==c.value.length)return h;
for(var m=0,b=0,d=0;d<c.value.length;d++){var g=a.value[d].value,e=c.value[d].value;m+=g.real*e.real+g.imag*e.imag;b+=g.real*e.imag-g.imag*e.real}return k.complex(m,b)};g.normSquared=function(a){for(var c=0,m=0;m<a.value.length;m++){var b=a.value[m].value;c+=b.real*b.real+b.imag*b.imag}return k.real(c)};g.productMV=function(a,c){if(a.value[0].value.length!==c.value.length)return h;for(var m=[],b=0;b<a.value.length;b++){for(var d={ctype:"number",value:{real:0,imag:0}},e=a.value[b],f=0;f<c.value.length;f++){var l=
e.value[f],n=c.value[f];if("number"===l.ctype&&"number"===n.ctype)d=k.add(k.mult(l,n),d);else return h}m[b]=d}return g.turnIntoCSList(m)};g.productVM=function(a,c){if(a.value.length!==c.value.length)return h;for(var m=[],b=0;b<c.value[0].value.length;b++){for(var d={ctype:"number",value:{real:0,imag:0}},e=0;e<a.value.length;e++){var f=a.value[e],l=c.value[e].value[b];if("number"===f.ctype&&"number"===l.ctype)d=k.add(k.mult(f,l),d);else return h}m[b]=d}return g.turnIntoCSList(m)};g.productMM=function(a,
c){if(a.value[0].value.length!==c.value.length)return h;for(var m=[],b=0;b<a.value.length;b++){var d=g.productVM(a.value[b],c);m[b]=d}return g.turnIntoCSList(m)};g.mult=function(a,c){return a.value.length===c.value.length&&g.isNumberVector(a).value&&g.isNumberVector(c).value?g.scalproduct(a,c):g.isNumberMatrix(a).value&&c.value.length===a.value[0].value.length&&g.isNumberVector(c).value?g.productMV(a,c):g.isNumberMatrix(c).value&&a.value.length===c.value.length&&g.isNumberVector(a).value?g.productVM(a,
c):g.isNumberMatrix(a).value&&g.isNumberMatrix(c).value&&c.value.length===a.value[0].value.length?g.productMM(a,c):h};g.projectiveDistMinScal=function(a,c){var m=g.abs(a),b=g.abs(c);if(0===m.value.real||0===b.value.real)return 0;var d=g.conjugate(c);d=g.scalproduct(a,d);d=k._helper.isAlmostZero(d)?k.real(1):k.div(d,k.abs(d));a=g.scaldiv(m,a);c=g.scaldiv(b,c);c=g.scalmult(d,c);b=g.abs(g.add(a,c));c=g.abs(g.sub(a,c));return Math.min(b.value.real,c.value.real)};g.conicDist=function(a,c){a=v(a);c=v(c);
return g.projectiveDistMinScal(a,c)};g.crossOperator=function(a){var c=a.value[0],m=a.value[1];a=a.value[2];return g.turnIntoCSList([g.turnIntoCSList([k.zero,k.neg(a),m]),g.turnIntoCSList([a,k.zero,k.neg(c)]),g.turnIntoCSList([k.neg(m),c,k.zero])])};g.cross=function(a,c){var m=k.sub(k.mult(a.value[1],c.value[2]),k.mult(a.value[2],c.value[1])),b=k.sub(k.mult(a.value[2],c.value[0]),k.mult(a.value[0],c.value[2]));a=k.sub(k.mult(a.value[0],c.value[1]),k.mult(a.value[1],c.value[0]));return g.turnIntoCSList([m,
b,a])};g.crossratio3harm=function(a,c,m,b,d){var D=g.det3(a,m,d),e=g.det3(c,b,d);a=g.det3(a,b,d);c=g.det3(c,m,d);D=k.mult(D,e);e=k.mult(a,c);return g.turnIntoCSList([D,e])};g.crossratio3=function(a,c,m,b,d){a=g.crossratio3harm(a,c,m,b,d);return k.div(a.value[0],a.value[1])};g.veronese=function(a){var c=k.mult(a.value[0],a.value[0]),m=k.mult(a.value[1],a.value[1]),b=k.mult(a.value[2],a.value[2]),d=k.mult(a.value[0],a.value[1]),e=k.mult(a.value[0],a.value[2]);a=k.mult(a.value[1],a.value[2]);return g.turnIntoSCList([c,
m,b,d,e,a])};g.matrixFromVeronese=function(a){var c=a.value[0],m=a.value[1],b=a.value[2],d=k.realmult(.5,a.value[3]),e=k.realmult(.5,a.value[4]);a=k.realmult(.5,a.value[5]);return g.turnIntoCSList([g.turnIntoCSList([c,d,e]),g.turnIntoCSList([d,m,a]),g.turnIntoCSList([e,a,b])])};g.det2=function(a,c){var m=k.mult(a.value[0],c.value[1]);return m=k.sub(m,k.mult(a.value[1],c.value[0]))};g.det3=function(a,c,m){return k.complex(a.value[0].value.real*c.value[1].value.real*m.value[2].value.real-a.value[0].value.imag*
c.value[1].value.imag*m.value[2].value.real-a.value[0].value.imag*c.value[1].value.real*m.value[2].value.imag-a.value[0].value.real*c.value[1].value.imag*m.value[2].value.imag+a.value[2].value.real*c.value[0].value.real*m.value[1].value.real-a.value[2].value.imag*c.value[0].value.imag*m.value[1].value.real-a.value[2].value.imag*c.value[0].value.real*m.value[1].value.imag-a.value[2].value.real*c.value[0].value.imag*m.value[1].value.imag+a.value[1].value.real*c.value[2].value.real*m.value[0].value.real-
a.value[1].value.imag*c.value[2].value.imag*m.value[0].value.real-a.value[1].value.imag*c.value[2].value.real*m.value[0].value.imag-a.value[1].value.real*c.value[2].value.imag*m.value[0].value.imag-a.value[0].value.real*c.value[2].value.real*m.value[1].value.real+a.value[0].value.imag*c.value[2].value.imag*m.value[1].value.real+a.value[0].value.imag*c.value[2].value.real*m.value[1].value.imag+a.value[0].value.real*c.value[2].value.imag*m.value[1].value.imag-a.value[2].value.real*c.value[1].value.real*
m.value[0].value.real+a.value[2].value.imag*c.value[1].value.imag*m.value[0].value.real+a.value[2].value.imag*c.value[1].value.real*m.value[0].value.imag+a.value[2].value.real*c.value[1].value.imag*m.value[0].value.imag-a.value[1].value.real*c.value[0].value.real*m.value[2].value.real+a.value[1].value.imag*c.value[0].value.imag*m.value[2].value.real+a.value[1].value.imag*c.value[0].value.real*m.value[2].value.imag+a.value[1].value.real*c.value[0].value.imag*m.value[2].value.imag,-a.value[0].value.imag*
c.value[1].value.imag*m.value[2].value.imag+a.value[0].value.imag*c.value[1].value.real*m.value[2].value.real+a.value[0].value.real*c.value[1].value.real*m.value[2].value.imag+a.value[0].value.real*c.value[1].value.imag*m.value[2].value.real-a.value[2].value.imag*c.value[0].value.imag*m.value[1].value.imag+a.value[2].value.imag*c.value[0].value.real*m.value[1].value.real+a.value[2].value.real*c.value[0].value.real*m.value[1].value.imag+a.value[2].value.real*c.value[0].value.imag*m.value[1].value.real-
a.value[1].value.imag*c.value[2].value.imag*m.value[0].value.imag+a.value[1].value.imag*c.value[2].value.real*m.value[0].value.real+a.value[1].value.real*c.value[2].value.real*m.value[0].value.imag+a.value[1].value.real*c.value[2].value.imag*m.value[0].value.real+a.value[0].value.imag*c.value[2].value.imag*m.value[1].value.imag-a.value[0].value.imag*c.value[2].value.real*m.value[1].value.real-a.value[0].value.real*c.value[2].value.real*m.value[1].value.imag-a.value[0].value.real*c.value[2].value.imag*
m.value[1].value.real+a.value[2].value.imag*c.value[1].value.imag*m.value[0].value.imag-a.value[2].value.imag*c.value[1].value.real*m.value[0].value.real-a.value[2].value.real*c.value[1].value.real*m.value[0].value.imag-a.value[2].value.real*c.value[1].value.imag*m.value[0].value.real+a.value[1].value.imag*c.value[0].value.imag*m.value[2].value.imag-a.value[1].value.imag*c.value[0].value.real*m.value[2].value.real-a.value[1].value.real*c.value[0].value.real*m.value[2].value.imag-a.value[1].value.real*
c.value[0].value.imag*m.value[2].value.real)};g.det4m=function(a){var c=a.value,m=c[0].value,b=m[0].value,d=+b.real,g=+b.imag;b=m[1].value;var e=+b.real,f=+b.imag;b=m[2].value;var h=+b.real,l=+b.imag;b=m[3].value;var n=+b.real,p=+b.imag;m=c[1].value;b=m[0].value;var q=+b.real,t=+b.imag;b=m[1].value;var r=+b.real,u=+b.imag;b=m[2].value;var v=+b.real,w=+b.imag;b=m[3].value;m=+b.real;b=+b.imag;a=d*r-g*u-e*q+f*t;var x=d*u+g*r-e*t-f*q,y=d*v-g*w-h*q+l*t,z=d*w+g*v-h*t-l*q,A=d*m-g*b-n*q+p*t,B=d*b+g*m-n*t-
p*q,C=e*v-f*w-h*r+l*u,E=e*w+f*v-h*u-l*r,G=e*m-f*b-n*r+p*u,H=e*b+f*m-n*u-p*r,I=h*m-l*b-n*v+p*w,N=h*b+l*m-n*w-p*v;m=c[2].value;b=m[0].value;d=+b.real;g=+b.imag;b=m[1].value;e=+b.real;f=+b.imag;b=m[2].value;h=+b.real;l=+b.imag;b=m[3].value;n=+b.real;p=+b.imag;m=c[3].value;b=m[0].value;q=+b.real;t=+b.imag;b=m[1].value;r=+b.real;u=+b.imag;b=m[2].value;v=+b.real;w=+b.imag;b=m[3].value;m=+b.real;b=+b.imag;c=d*r-g*u-e*q+f*t;var J=d*u+g*r-e*t-f*q,L=d*v-g*w-h*q+l*t,Sd=d*w+g*v-h*t-l*q,K=d*m-g*b-n*q+p*t;d=d*
b+g*m-n*t-p*q;g=e*v-f*w-h*r+l*u;q=e*w+f*v-h*u-l*r;t=e*m-f*b-n*r+p*u;e=e*b+f*m-n*u-p*r;f=h*m-l*b-n*v+p*w;h=h*b+l*m-n*w-p*v;return k.complex(a*f-x*h-y*t+z*e+A*g-B*q+C*K-E*d-G*L+H*Sd+I*c-N*J,a*h+x*f-y*e-z*t+A*q+B*g+C*d+E*K-G*Sd-H*L+I*J+N*c)};g.eucangle=function(a,c){var b=g.cross(a,g.linfty);a=g.cross(c,g.linfty);c=g.det3(g.ez,b,g.ii);b=g.det3(g.ez,b,g.jj);var d=g.det3(g.ez,a,g.ii);a=g.det3(g.ez,a,g.jj);c=k.div(k.mult(c,a),k.mult(d,b));c=k.log(c);return c=k.mult(c,k.complex(0,.5))};g.zerovector=function(a){a=
Math.floor(a.value.real);for(var c=Array(a),b=0;b<a;b++)c[b]=0;return g.realVector(c)};g.zeromatrix=function(a,c){a=Math.floor(a.value.real);for(var b=Array(a),d=0;d<a;d++)b[d]=g.zerovector(c);return g.turnIntoCSList(b)};g.vandermonde=function(a){for(var c=a.value.length,b=g.zeromatrix(c,c),d=0;d<c;d++)for(var e=0;e<c;e++)b.value[d].value[e]=k.pow(a.value[d],k.real(e-1));return b};g.transpose=function(a){for(var c=[],b=a.value[0].value.length,d=a.value.length,e=0;e<b;e++){for(var f=[],k=0;k<d;k++)f[k]=
a.value[k].value[e];c[e]=g.turnIntoCSList(f)}return g.turnIntoCSList(c)};g.column=function(a,c){var b=[],d=a.value.length;c=Math.floor(c.value.real-1);for(var e=0;e<d;e++)b[e]=a.value[e].value[c];return g.turnIntoCSList(b)};g.row=function(a,c){var b=[],d=a.value[0].value.length;c=Math.floor(c.value.real-1);for(var e=0;e<d;e++)b[e]=a.value[c].value[e];return g.turnIntoCSList(b)};g.adjoint2=function(a){var c=a.value[0].value[0],b=a.value[1].value[0],d=Array(2);d[0]=g.turnIntoCSList([a.value[1].value[1],
k.neg(a.value[0].value[1])]);d[1]=g.turnIntoCSList([k.neg(b),c]);return d=g.turnIntoCSList(d)};g.adjoint3=function(a){var c=a.value[0].value;var b=c[0].value;var d=b.real;var g=b.imag;b=c[1].value;var e=b.real;var f=b.imag;b=c[2].value;var k=b.real;var h=b.imag;c=a.value[1].value;b=c[0].value;var l=b.real;var n=b.imag;b=c[1].value;var p=b.real;var q=b.imag;b=c[2].value;var t=b.real;var r=b.imag;c=a.value[2].value;b=c[0].value;a=b.real;var u=b.imag;b=c[1].value;var v=b.real;var w=b.imag;b=c[2].value;
c=b.real;b=b.imag;return{ctype:"list",value:[{ctype:"list",value:[{ctype:"number",value:{real:p*c-t*v-q*b+r*w,imag:p*b-t*w-v*r+c*q}},{ctype:"number",value:{real:-e*c+k*v+f*b-h*w,imag:-e*b+k*w+v*h-c*f}},{ctype:"number",value:{real:e*t-k*p-f*r+h*q,imag:e*r-k*q-p*h+t*f}}]},{ctype:"list",value:[{ctype:"number",value:{real:-l*c+t*a+n*b-r*u,imag:-l*b+t*u+a*r-c*n}},{ctype:"number",value:{real:d*c-k*a-g*b+h*u,imag:d*b-k*u-a*h+c*g}},{ctype:"number",value:{real:-d*t+k*l+g*r-h*n,imag:-d*r+k*n+l*h-t*g}}]},{ctype:"list",
value:[{ctype:"number",value:{real:l*v-p*a-n*w+q*u,imag:l*w-p*u-a*q+v*n}},{ctype:"number",value:{real:-d*v+e*a+g*w-f*u,imag:-d*w+e*u+a*f-v*g}},{ctype:"number",value:{real:d*p-e*l-g*q+f*n,imag:d*q-e*n-l*f+p*g}}]}]}};g.inverse=function(a){var c=a.value.length;if(c!==a.value[0].value.length)return console.log("Inverse works only for square matrices"),h;if(2===c)return g.scaldiv(g.det(a),g.adjoint2(a));if(3===c)return g.scaldiv(g.det(a),g.adjoint3(a));c=g.LUdecomp(a);a=a.value.length;var b=k.real(0),
d=k.real(1),e=g.zerovector(k.real(a));e.value[0]=d;for(var f=Array(a),l=0;l<a;l++)f[l]=g._helper.LUsolve(c,e),e.value[l]=b,e.value[l+1]=d;f=g.turnIntoCSList(f);return f=g.transpose(f)};g.linearsolve=function(a,c){return 2===a.value.length?g.linearsolveCramer2(a,c):3===a.value.length?g.linearsolveCramer3(a,c):g.LUsolve(a,c)};g.getDiag=function(a){if(a.value.length!==a.value[0].value.length)return h;for(var c=Array(a.value.length),b=0;b<a.value.length;b++)c[b]=a.value[b].value[b];return g.turnIntoCSList(c)};
g.getSubDiag=function(a){if(a.value.length!==a.value[0].value.length)return h;for(var c=Array(a.value.length-1),b=0;b<a.value.length-1;b++)c[b]=a.value[b+1].value[b];return g.turnIntoCSList(c)};g.eig2=function(a){var c=k.add(a.value[0].value[0],a.value[1].value[1]);a=g.det2(a.value[0],a.value[1]);var b=k.mult(c,c),d=c=k.mult(c,k.real(.5));a=k.sqrt(k.sub(k.div(b,k.real(4)),a));c=k.add(c,a);d=k.sub(d,a);return g.turnIntoCSList([c,d])};g.eig=function(a,c){var b=c||!0,d=a,e=k.real(d.value.length);c=e.value.real;
k.real(0);d=g._helper.QRIteration(d)[0];d=g.getDiag(d);d=g.sort1(d);e=g.idMatrix(e,e);var f=Array(c);f=g.turnIntoCSList(f);if(b){var h,l=0,n=!1;for(b=0;b<c;b++){if(n)var M=p.value[l];else{var p=d.value[b];p=g.sub(a,g.scalmult(p,e));p=g.nullSpace(p);M=p.value[0];void 0!==M&&(h=M)}void 0===M&&(M=h);1E-8>g.abs(M).value.real&&0===l&&(M=g._helper.inverseIteration(a,d.value[b]));f.value[b]=g._helper.isAlmostZeroVec(M)?M:g.scaldiv(g.abs(M),M);b<c-1&&((n=1E-6>k.abs(k.sub(d.value[b],d.value[b+1])).value.real)?
l++:l=0)}f=g.transpose(f)}return g.turnIntoCSList([d,f])};g._helper.isNormalMatrix=function(a){return 1E-10>g.abs(g.sub(a,g.transjugate(a))).value.real};g._helper.QRIteration=function(a,c){var b=k.real(a.value.length),d=b.value.real,e=b.value.real;k.real(0);g.idMatrix(b,b);var f=g.zeromatrix(b,b);b=g.idMatrix(b,b);var h=c?c:2500,l=0,n=Array(e);for(c=0;c<h;c++){var p=g._helper.getBlock(a,[e-2,e-1],[e-2,e-1]);var q=g.eig2(p);p=q.value[0];q=q.value[1];g.abs(p);g.abs(q);var t=a.value[e-1].value[e-1];
var r=k.abs(k.sub(t,p)).value.real;t=k.abs(k.sub(t,q)).value.real;q=r<t?p:q;p=g.idMatrix(k.real(e),k.real(e));q=g.scalmult(q,p);p=g.QRdecomp(g.sub(a,q));a=u.mult(p.R,p.Q);a=g.add(a,q);p.Q=g._helper.buildBlockMatrix(p.Q,g.idMatrix(k.real(l),k.real(l)));b=u.mult(b,p.Q);if(1E-48>k.abs2(a.value[a.value.length-1].value[a.value[0].value.length-2]).value.real&&1<e){n[d-l-1]=a.value[e-1].value[e-1];for(c=0;c<e;c++)f.value[e-1].value[c]=a.value[e-1].value[c],f.value[c].value[e-1]=a.value[c].value[e-1];a=g._helper.getBlock(a,
[0,e-2],[0,e-2]);l++;e--}if(1===e){f.value[0].value[0]=a.value[0].value[0];break}if(g._helper.isUpperTriangular(a)){for(c=0;c<e;c++)f.value[c].value[c]=a.value[c].value[c];break}}return[f,b]};g.rank=function(a,c){return g.RRQRdecomp(a,c).rank};g._helper.isAlmostZeroVec=function(a){for(var c=a.value.length,b=0;b<c;b++)if(!k._helper.isAlmostZero(a.value[b]))return!1;return!0};g._helper.isLowerTriangular=function(a){for(var c=a.value.length,b=a.value[0].value.length,d=0;d<c;d++)for(var g=d+1;g<b;g++)if(!k._helper.isAlmostZero(a.value[d].value[g]))return!1;
return!0};g._helper.isUpperTriangular=function(a){return g._helper.isLowerTriangular(g.transpose(a))};g._helper.isAlmostId=function(a){var c=a.value.length,b=k.real(c);if(c!==a.value[0].value.length)return!1;a=g.sub(a,g.idMatrix(b),b);for(b=0;b<c;b++)for(var d=0;d<c;d++)if(1E-16<k.abs(a.value[b].value[d]).value.real)return!1;return!0};g.nullSpace=function(a,c){var b=a.value.length;c=g.RRQRdecomp(g.transjugate(a),c);a=g.transpose(c.Q);c=b-c.rank.value.real;var d=Array(c);a.value.reverse();for(var e,
f=0;f<c;f++)e=a.value[f],d[f]=g.scaldiv(g.abs(e),e);d=g.turnIntoCSList(d);return 0<d.value.length?d:g.turnIntoCSList([g.zerovector(k.real(b))])};g._helper.isAlmostDiagonal=function(a){var c=a.value.length;k.real(c);k.real(0);if(c!==a.value[0].value.length)return!1;for(var b=0;b<c;b++)for(var d=0;d<c;d++)if(b!==d&&1E-16<k.abs(a.value[b].value[d]).value.real)return!1;return!0};g._helper.inverseIteration=function(a,c){console.log("warning: code untested");for(var b=a.value.length,d=Array(b),e=0;e<b;e++)d[e]=
2*Math.random()-.5;d=g.realVector(d);b=g.idMatrix(k.real(b),k.real(b));c=k.add(c,k.real(.1*Math.random()-.5));for(e=0;100>e;e++)d=g.scaldiv(g.abs(d),d),d=g.LUsolve(g.sub(a,g.scalmult(c,b)),JSON.parse(JSON.stringify(d)));return g.scaldiv(g.abs(d),d)};g._helper.toHessenberg=function(a){var c=JSON.parse(JSON.stringify(a)),b=c.value.length,d=k.real(b-1),e=k.real(b);k.real(1);if(g._helper.isUpperTriangular(c))return[g.idMatrix(d,d),a];a=g.idMatrix(e,e);for(e=1;e<b-1;e++){var f=g.column(c,k.real(e));f.value=
f.value.splice(e);var h=g.abs2(f).value.real;1E-16<h&&(f=g._helper.getHouseHolder(f),a=u.mult(a,f),c=u.mult(u.mult(f,c),f));d.value.real--}return[a,c]};g._helper.swapEl=function(a,c,b){if("[object Array]"===Object.prototype.toString.call(a)){var m=a[c];a[c]=a[b];a[b]=m}else"list"===a.ctype&&(m=a.value[c],a.value[c]=a.value[b],a.value[b]=m)};g.RRQRdecomp=function(a,c){var b=Math.sqrt(k.eps);void 0!==c&&(b=.1*c.value.real);c=b*b;var d;b=a.value.length;var e=k.real(b),f=k.real(1),h=g._helper.unitvector(k.real(a.value.length),
f),l=g.idMatrix(e,e),n=JSON.parse(JSON.stringify(a)),p=g.transpose(a);a=Array(b);for(d=0;d<b;d++)a[d]=g.abs2(p.value[d]);a=g.turnIntoCSList(a);p=Array(b);for(d=0;d<b;d++)p[d]=d;d=g.maxIndex(a,k.abs);for(var q=a.value[d],t=0,r=0;1E-16<k.abs2(q).value.real;r++){t++;g._helper.swapColumn(n,r,d);g._helper.swapEl(a,r,d);g._helper.swapEl(p,r,d);d=g._helper.getBlock(n,[r],[r]);d=g.column(d,f);q=g.abs2(d).value.real;1E-8<q&&(d=g._helper.getHouseHolder(d),d=g._helper.buildBlockMatrix(g.idMatrix(k.real(r),k.real(r)),
d),l=u.mult(l,g.transjugate(d)),n=u.mult(d,n));for(d=r+1;d<b;d++)a.value[d]=k.sub(a.value[d],k.mult(n.value[r].value[d],k.conjugate(n.value[r].value[d])));d=g.maxIndex(a,k.abs2,r+1);q=a.value[d];if(r+2===b){k.abs(q).value.real>c&&t++;break}e=k.sub(e,f);h.value=h.value.splice(0,h.value.length-1)}return{Q:l,R:n,P:g.turnIntoCSList(p),rank:k.real(t)}};g._helper.getHouseHolder=function(a){var c=k.real(a.value.length);if(1E-16>g.abs2(a))return g.idMatrix(c,c);var b=k.real(1),d=g._helper.unitvector(k.real(a.value.length),
b);var e=g._helper.QRgetAlpha(a,0);e=g.sub(a,g.scalmult(e,d));e=g.scaldiv(g.abs(e),e);a=k.div(g.sesquilinearproduct(a,e),g.sesquilinearproduct(e,a));c=g.idMatrix(c,c);return c=g.sub(c,g.scalmult(k.add(b,a),g._helper.transposeMult(e,g.conjugate(e))))};g._helper.reOrderbyPivots=function(a,c){var b=a.value.length.length;a=g.transpose(a);b=Array(b);for(var d=0;d<c.length;d++)b[c[d]]=a.value[d];b=g.turnIntoCSList(b);return g.transpose(b)};g.QRdecomp=function(a){var c=a.value.length,b=k.real(c);if(g._helper.isUpperTriangular(a))return{Q:g.idMatrix(b,
b),R:a};var d=k.real(1),e=g._helper.unitvector(k.real(a.value.length),d),f=g.idMatrix(b,b);a=JSON.parse(JSON.stringify(a));for(var h=0;;h++){var l=g._helper.getBlock(a,[h],[h]);l=g.column(l,d);var n=g.abs2(l).value.real;1E-8<n&&(l=g._helper.getHouseHolder(l),l=g._helper.buildBlockMatrix(g.idMatrix(k.real(h),k.real(h)),l),f=u.mult(f,g.transjugate(l)),a=u.mult(l,a));if(h+2===c)break;b=k.sub(b,d);e.value=e.value.splice(0,e.value.length-1)}return{Q:f,R:a}};g._helper.swapColumn=function(a,c,b){for(var m,
d=0;d<a.value.length;d++)m=a.value[d].value[c],a.value[d].value[c]=a.value[d].value[b],a.value[d].value[b]=m};g._helper.buildBlockMatrix=function(a,c){if(0===a.value.length)return c;if(0===c.value.length)return a;var b=a.value.length,d=a.value[0].value.length,e=d+c.value[0].value.length;e=g.zeromatrix(k.real(b+c.value.length),k.real(e));for(var f=0;f<a.value.length;f++)for(var h=0;h<a.value[0].value.length;h++)e.value[f].value[h]=a.value[f].value[h];for(a=0;a<c.value.length;a++)for(f=0;f<c.value[0].value.length;f++)e.value[b+
a].value[d+f]=c.value[a].value[f];return e};g._helper.getBlock=function(a,c,b){a=JSON.parse(JSON.stringify(a));var m=c[0],d=b[0];c=void 0===c[1]?a.value.length:c[1];b=void 0===b[1]?a.value[0].value.length:b[1];c++;b++;a.value=a.value.slice(m,c);for(m=0;m<a.value.length;m++)a.value[m].value=a.value[m].value.slice(d,b);return a};g._helper.setBlock=function(a,c,b){a=JSON.parse(JSON.stringify(a));var m=b[0];b=b[1];for(var d=c.value.length,g=c.value[0].value.length,e=0;e<d;e++)for(var f=0;f<g;f++)a.value[m+
e].value[b+f]=c.value[e].value[f];return a};g._helper.transposeMult=function(a,c){if(a.value.length!==c.value.length)return h;for(var b=a.value.length,d=Array(b),e=0;e<b;e++)d[e]=g.scalmult(a.value[e],c);return g.turnIntoCSList(d)};g._helper.QRgetAlpha=function(a,c){return 0>a.value[c].value.real?g.abs(a):k.neg(g.abs(a))};g.LUdecomp=function(a){a=JSON.parse(JSON.stringify(a));var c,b,d=0,g=a.value.length,e=g-1,f=Array(g);for(b=0;b<g;++b){var h=b;var l=a.value[b];var n=k.abs(l.value[b]).value.real;
for(c=b+1;c<g;++c){var p=k.abs(a.value[c].value[b]);n<p.value.real&&(n=p.value.real,h=c)}n<k.eps&&console.log("Warning: singular matrix!");f[b]=h;h!==b&&(a.value[b]=a.value[h],a.value[h]=l,l=a.value[b],d++);c=l.value[b];for(p=b+1;p<g;++p)a.value[p].value[b]=k.div(a.value[p].value[b],c);for(p=b+1;p<g;++p){h=a.value[p];for(c=b+1;c<e;++c)h.value[c]=k.sub(h.value[c],k.mult(h.value[b],l.value[c])),++c,h.value[c]=k.sub(h.value[c],k.mult(h.value[b],l.value[c]));c===e&&(h.value[c]=k.sub(h.value[c],k.mult(h.value[b],
l.value[c])))}}return{LU:a,P:f,TransPos:d}};g.LUsolve=function(a,c){a=g.LUdecomp(a);return g._helper.LUsolve(a,c)};g._helper.LUsolve=function(a,c){var b=JSON.parse(JSON.stringify(c));c=a.LU;var d=c.value.length,g=JSON.parse(JSON.stringify(b)),e=a.P;for(a=d-1;-1!==a;--a)g.value[a]=b.value[a];for(a=0;a<d;++a){b=e[a];if(e[a]!==a){var f=g.value[a];g.value[a]=g.value[b];g.value[b]=f}f=c.value[a];for(b=0;b<a;++b)g.value[a]=k.sub(g.value[a],k.mult(g.value[b],f.value[b]))}for(a=d-1;0<=a;--a){f=c.value[a];
for(b=a+1;b<d;++b)g.value[a]=k.sub(g.value[a],k.mult(g.value[b],f.value[b]));g.value[a]=k.div(g.value[a],f.value[a])}return g};g.linearsolveCramer2=function(a,c){var b=g.column(a,k.real(1)),d=g.column(a,k.real(2));a=g.det2(b,d);k._helper.isZero(a)&&console.log("A is not regular!");d=g.det2(c,d);d=k.div(d,a);c=g.det2(b,c);c=k.div(c,a);return g.turnIntoCSList([d,c])};g.linearsolveCramer3=function(a,c){var b=g.column(a,k.real(1)),d=g.column(a,k.real(2)),e=g.column(a,k.real(3));a=g.det3(b,d,e);k._helper.isZero(a)&&
console.log("A is not regular!");var f=g.det3(c,d,e);e=g.det3(b,c,e);c=g.det3(b,d,c);c=g.turnIntoCSList([f,e,c]);return c=g.scaldiv(a,c)};g.linearsolveCGNR=function(a,c){var b=g.transpose(a);a=u.mult(b,a);c=u.mult(b,c);return g.linearsolveCG(a,c)};g.linearsolveCG=function(a,c){var b;var d=c;var e=c=g.sub(c,u.mult(a,c));for(var f=Math.ceil(1.2*a.value.length),h=0;h<f;){h++;var l=u.mult(a,e);var n=b=g.scalproduct(c,c);b=k.div(b,g.scalproduct(e,l));d=g.add(d,u.mult(b,e));c=g.sub(c,u.mult(b,l));if(g.abs(c).value.real<
k.eps)break;b=g.scalproduct(c,c);b=k.div(b,n);e=g.add(c,u.mult(b,e))}h>=f&&console.log("CG did not converge");return d};g.det=function(a){if(1===a.value.length)return a.value[0].value[0];if(2===a.value.length)return g.det2(a.value[0],a.value[1]);if(3===a.value.length)return g.det3(a.value[0],a.value[1],a.value[2]);if(4===a.value.length)return g.det4m(a);var c=a.value.length,b=k.real(1),d,e=JSON.parse(JSON.stringify(a));for(a=0;a<c-1;a++){var f=a;for(d=a+1;d<c;d++)k.abs(e.value[d].value[a]).value.real>
k.abs(e.value[f].value[a]).value.real&&(f=d);f!==a&&(d=e.value[f],e.value[f]=e.value[a],e.value[a]=d,b=k.neg(b));var h=e.value[a];for(d=a+1;d<c;d++){var l=e.value[d];var n=k.div(l.value[a],h.value[a]);for(f=a+1;f<c-1;f+=2){var p=f+1;l.value[f]=k.sub(l.value[f],k.mult(h.value[f],n));l.value[p]=k.sub(l.value[p],k.mult(h.value[p],n))}f!==c&&(l.value[f]=k.sub(l.value[f],k.mult(h.value[f],n)))}if(k._helper.isZero(h.value[a]))return k.real(0);b=k.mult(b,h.value[a])}return k.mult(b,e.value[a].value[a])};
g.LUdet=function(a){a=g.LUdecomp(a);for(var c=a.LU,b=c.value.length,d=c.value[0].value[0],e=1;e<b;e++)d=k.mult(d,c.value[e].value[e]);1===a.TransPos%2&&(d=k.neg(d));return d};g.getField=function(a,c){if("homog"===c){if(g._helper.isNumberVecN(a,3))return a;if(g._helper.isNumberVecN(a,2))return g.turnIntoCSList([a.value[0],a.value[1],k.real(1)])}if("xy"===c){if(g._helper.isNumberVecN(a,2))return a;if(g._helper.isNumberVecN(a,3))return g.turnIntoCSList([k.div(a.value[0],a.value[2]),k.div(a.value[1],
a.value[2])])}if("x"===c&&g.isNumberVector(a)){var b=a.value.length;if(0<b&&3!==b)return a.value[0];if(3===b)return"Point"===a.usage?k.div(a.value[0],a.value[2]):a.value[0]}if("y"===c&&g.isNumberVector(a)){b=a.value.length;if(1<b&&3!==b)return a.value[1];if(3===b)return"Point"===a.usage?k.div(a.value[1],a.value[2]):a.value[1]}return"z"===c&&g.isNumberVector(a)&&(b=a.value.length,2<b)?a.value[2]:h};g.nil=g.turnIntoCSList([]);g.ofGeos=function(a){return g.turnIntoCSList(a.map(function(a){return{ctype:"geo",
value:a}}))};g._helper.isAlmostFarpoint=function(a){a=g.normalizeMax(a).value[2];return k.abs(a).value.real<k.eps};g.getRandRealVec3=function(a,c){var b=k.getRandReal;return g.turnIntoCSList([b(a,c),b(a,c),b(a,c)])};g.getRandComplexVec3=function(a,c){var b=k.getRandComplex;return g.turnIntoCSList([b(a,c),b(a,c),b(a,c)])};var Qa={key:function(a){if("string"===a.ctype)return"s"+a.value.length+":"+a.value+";";if("number"===a.ctype)return"n"+a.value.real+","+a.value.imag+";";if("list"===a.ctype)return"l"+
a.value.length+":"+a.value.map(Qa.key).join(",")+";";if("boolean"===a.ctype)return"b"+a.value+";";if("dict"===a.ctype)return a=Object.keys(a.value).sort(),"d"+a.length+":"+a.join(",")+";";"undefined"!==a.ctype&&ya.err("Bad dictionary key: "+U(a));return"undef"},create:function(){return{ctype:"dict",value:{}}},clone:function(a){var c=Qa.create(),b;for(b in a.value)a.value.hasOwnProperty(b)&&(c.value[b]=a.value[b]);return c},put:function(a,c,b){a.value[Qa.key(c)]={key:c,value:b}},get:function(a,c,b){return(a=
a.value[Qa.key(c)])?a.value:b},niceprint:function(a){return"{"+Object.keys(a.value).sort().map(function(c){c=a.value[c];return U(c.key)+":"+U(c.value)}).join(", ")+"}"}},u={_helper:{},order:{undefined:0,boolean:1,number:2,term:3,atomic:4,variable:5,geo:6,string:7,list:8},string:function(a){return{ctype:"string",value:a}},bool:function(a){return{ctype:"boolean",value:a}},not:function(a){return u.bool(!a.value)},isLessThan:function(a,c){return-1===u.compare(a,c)},isEqual:function(a,c){return 0===u.compare(a,
c)},compareResults:function(a,c){return u.compare(a.result,c.result)},compare:function(a,c){if(a.ctype!==c.ctype)return u.order[a.ctype]-u.order[c.ctype];if("number"===a.ctype)return k._helper.compare(a,c);if("list"===a.ctype)return g._helper.compare(a,c);if("geo"===a.ctype)return a.value.name===c.value.name?0:a.value.name<c.value.name?-1:1;if("string"===a.ctype)return a.value===c.value?0:a.value<c.value?-1:1;if("boolean"===a.ctype)return a.value===c.value?0:!1===a.value?-1:1},add:function(a,c){return"void"===
a.ctype&&"number"===c.ctype||"void"===a.ctype&&"list"===c.ctype?c:"number"===a.ctype&&"number"===c.ctype?k.add(a,c):"string"===a.ctype||"string"===c.ctype?{ctype:"string",value:U(a)+U(c)}:"list"===a.ctype&&"list"===c.ctype?g.add(a,c):h},sub:function(a,c){return"void"===a.ctype&&"number"===c.ctype?k.neg(c):"void"===a.ctype&&"list"===c.ctype?g.neg(c):"number"===a.ctype&&"number"===c.ctype?k.sub(a,c):"list"===a.ctype&&"list"===c.ctype?g.sub(a,c):h},mult:function(a,c){return"number"===a.ctype&&"number"===
c.ctype?k.mult(a,c):"number"===a.ctype&&"list"===c.ctype?g.scalmult(a,c):"list"===a.ctype&&"number"===c.ctype?g.scalmult(c,a):"list"===a.ctype&&"list"===c.ctype?g.mult(a,c):h},div:function(a,c){return"number"===a.ctype&&"number"===c.ctype?k.div(a,c):"list"===a.ctype&&"number"===c.ctype?g.scaldiv(c,a):h},max:function(a,c){return"number"===a.ctype&&"number"===c.ctype?k.max(a,c):"list"===a.ctype&&"list"===c.ctype?g.max(a,c):h},min:function(a,c){return"number"===a.ctype&&"number"===c.ctype?k.min(a,c):
"list"===a.ctype&&"list"===c.ctype?g.min(a,c):h},wrap:function(a){if("number"===typeof a)return k.real(a);if("object"===typeof a&&void 0!==a.length){for(var c=[],b=0;b<a.length;b++)c[b]=u.wrap(a[b]);return g.turnIntoCSList(c)}return"string"===typeof a?{ctype:"string",value:a}:"boolean"===typeof a?{ctype:"boolean",value:a}:h},unwrap:function(a){if("object"!==typeof a||null===a)return a;if(Array.isArray(a))return a.map(u.unwrap);switch(a.ctype){case "string":case "boolean":return a.value;case "number":return 0===
a.value.imag?a.value.real:{r:a.value.real,i:a.value.imag};case "list":return a.value.map(u.unwrap);default:return null}},withUsage:function(a,c){return{ctype:a.ctype,value:a.value,usage:c}},wrapJSON:function(a){switch(typeof a){case "number":return k.real(a);case "string":return u.string(a);case "boolean":return u.bool(a);case "object":if(null===a)return h;if(Array.isArray(a))return g.turnIntoCSList(a.map(u.wrapJSON));var c=Qa.create(),b;for(b in a)Qa.put(c,u.string(b),u.wrapJSON(a[b]));return c;
default:return console.log("Failed to convert "+typeof a+" to CindyJS data type"),h}},identity:function(a){return a},deeplyEqual:function(a,c){if("object"!==typeof a||"object"!==typeof c||null===a||null===c)return a===c;var b=0,d;for(d in a)if(++b,!(d in c&&u.deeplyEqual(a[d],c[d])))return!1;for(d in c)--b;return 0===b},DeepCloneJSON:function(a){var c;var b=Array.isArray(a)?[]:{};for(c in a){var d=a[c];b[c]="object"===typeof d&&null!==d?u.DeepCloneJSON(d):d}return b}},eb={},T={};T[":"]=jc(":");T["\u00b0"]=
function(a,c){c=B(a[0]);return"number"===c.ctype&&"void"===a[1].ctype?u.withUsage(k.realmult(Math.PI/180,c),"Angle"):h};T._=zc;T["^"]=fd;T["\u221a"]=function(a,c){return"void"===a[0].ctype?r.sqrt$1([a[1]],c):h};T["*"]=Xc;T["\u00d7"]=gd;T["/"]=Yc;T["+"]=Wc;T["-"]=mc;T["!"]=function(a,c){c=B(a[1]);return"void"===a[0].ctype&&"boolean"===c.ctype?{ctype:"boolean",value:!c.value}:h};T["=="]=vb;T["~="]=kc;T["~<"]=function(a,c){c=B(a[0]);a=B(a[1]);return"number"===c.ctype&&"number"===a.ctype&&k._helper.isAlmostReal(c)&&
k._helper.isAlmostReal(a)?{ctype:"boolean",value:c.value.real-a.value.real<=-k.eps}:h};T["~>"]=function(a,c){c=B(a[0]);a=B(a[1]);return"number"===c.ctype&&"number"===a.ctype&&k._helper.isAlmostReal(c)&&k._helper.isAlmostReal(a)?{ctype:"boolean",value:c.value.real-a.value.real>=k.eps}:h};T["=:="]=jc("=:=");T[">="]=function(a,c){c=B(a[0]);a=B(a[1]);return"number"===c.ctype&&"number"===a.ctype&&k._helper.isAlmostReal(c)&&k._helper.isAlmostReal(a)?{ctype:"boolean",value:c.value.real>=a.value.real}:"string"===
c.ctype&&"string"===a.ctype?{ctype:"boolean",value:c.value>=a.value}:h};T["<="]=function(a,c){c=B(a[0]);a=B(a[1]);return"number"===c.ctype&&"number"===a.ctype&&k._helper.isAlmostReal(c)&&k._helper.isAlmostReal(a)?{ctype:"boolean",value:c.value.real<=a.value.real}:"string"===c.ctype&&"string"===a.ctype?{ctype:"boolean",value:c.value<=a.value}:h};T["~>="]=function(a,c){c=B(a[0]);a=B(a[1]);return"number"===c.ctype&&"number"===a.ctype&&k._helper.isAlmostReal(c)&&k._helper.isAlmostReal(a)?{ctype:"boolean",
value:c.value.real-a.value.real>-k.eps}:h};T["~<="]=function(a,c){c=B(a[0]);a=B(a[1]);return"number"===c.ctype&&"number"===a.ctype&&k._helper.isAlmostReal(c)&&k._helper.isAlmostReal(a)?{ctype:"boolean",value:c.value.real-a.value.real<k.eps}:h};T[">"]=function(a,c){c=B(a[0]);a=B(a[1]);return"number"===c.ctype&&"number"===a.ctype&&k._helper.isAlmostReal(c)&&k._helper.isAlmostReal(a)?{ctype:"boolean",value:c.value.real>a.value.real}:"string"===c.ctype&&"string"===a.ctype?{ctype:"boolean",value:c.value>
a.value}:h};T["<"]=function(a,c){c=B(a[0]);a=B(a[1]);return"number"===c.ctype&&"number"===a.ctype&&k._helper.isAlmostReal(c)&&k._helper.isAlmostReal(a)?{ctype:"boolean",value:c.value.real<a.value.real}:"string"===c.ctype&&"string"===a.ctype?{ctype:"boolean",value:c.value<a.value}:h};T["<>"]=Tc;T["\u2208"]=function(a,c){c=z(a[0]);a=z(a[1]);return"list"===a.ctype?g.contains(a,c):h};T["\u2209"]=function(a,c){c=z(a[0]);a=z(a[1]);return"list"===a.ctype?u.not(g.contains(a,c)):h};T["&"]=Uc;T["%"]=Vc;T["!="]=
Tc;T["~!="]=function(a,c){return u.not(kc(a,c))};T[".."]=function(a,c){c=z(a[0]);a=z(a[1]);return"number"===c.ctype&&"number"===a.ctype?g.sequence(c,a):h};T["++"]=hd;T["--"]=jd;T["~~"]=id;T[":>"]=kd;T["<:"]=ld;T["="]=Ub;T[":="]=function(a,c,b){c="undefined"===a[1].ctype;if("undefined"===a[0].ctype||c)return h;if("function"===a[0].ctype){c=a[0].oper;var m=a[0].args,d=a[1],e=1;if(eb.hasOwnProperty(c)){e=eb[c];if(e.definer===b)return h;e=e.generation+1}eb[c]={oper:c,body:d,arglist:m,definer:b,generation:e}}"variable"===
a[0].ctype&&J.setvar(a[0].name,a[1]);return h};T[":=_"]=function(a,c){if("void"!==a[1].ctype)return h;"function"===a[0].ctype&&delete eb[a[0].oper];return h};T["::="]=jc("::=");T[";"]=function(a,c){c="void"===a[0].ctype;var b="void"===a[1].ctype;if(c&&b)return h;if(!c&&b)return z(a[0]);c||b||z(a[0]);return b?h:z(a[1])};var r={},C={evaluate:function(a,c,b){if(eb.hasOwnProperty(a)){a=eb[a];if(void 0===a)c=h;else{var m=[];for(b=0;b<a.arglist.length;b++)m[b]=z(c[b]);for(b=0;b<a.arglist.length;b++)J.newvar(a.arglist[b].name),
J.setvar(a.arglist[b].name,m[b]);J.pushVstack("*");c=z(a.body);J.cleanVstack();for(b=0;b<a.arglist.length;b++)J.removevar(a.arglist[b].name)}return c}if(m=r[a])return m(c,b);var d=a.lastIndexOf("$");if(-1!==d&&(d=a.substr(0,d),m=r[d]))return m(c,b);ya.err("Called undefined function "+d+" (as "+a+")");return h},equals:function(a,c){return"number"===a.ctype&&"number"===c.ctype?{ctype:"boolean",value:a.value.real===c.value.real&&a.value.imag===c.value.imag}:"string"===a.ctype&&"string"===c.ctype||"boolean"===
a.ctype&&"boolean"===c.ctype?{ctype:"boolean",value:a.value===c.value}:"list"===a.ctype&&"list"===c.ctype?g.equals(a,c):"geo"===a.ctype&&"geo"===c.ctype?{ctype:"boolean",value:a.value===c.value}:{ctype:"boolean",value:!1}}},J={};J.vars=function(){var a={pi:k.real(Math.PI),"\u03c0":k.real(Math.PI),i:k.complex(0,1),"true":u.bool(!0),"false":u.bool(!1),"#":h,nil:g.turnIntoCSList([]),newline:u.string("\n"),tab:u.string("\t")},c=[],b;for(b in a)c[b]=[a[b]];return c}();J.isVariable=function(a){return this.vars.hasOwnProperty(a)};
J.create=function(a){if(this.vars.hasOwnProperty(a))return this.vars[a];var c=[null];return this.vars[a]=c};J.newvar=function(a){a=this.vars[a];a.push(h);return a};J.removevar=function(a){var c=this.vars[a];0===c.length&&console.error("Removing non-existing "+a);c.pop();0===c.length&&console.warn("Removing last "+a)};J.setvar=function(a,c){var b=this.vars[a];0===b.length&&console.error("Setting non-existing variable "+a);void 0===c&&(console.error("Setting variable "+a+" to undefined value"),c=h);
"undefined"===c.ctype?b[b.length-1]=c:(a=c,null===a&&(a=h),b[b.length-1]=a)};J.undefinedWarning={};J.getvar=function(a){var c=this.vars[a]||[];0===c.length&&console.error("Getting non-existing variable "+a);c=c[c.length-1];if(null===c){if(t.csnames.hasOwnProperty(a))return{ctype:"geo",value:t.csnames[a]};console&&console.log&&void 0===this.undefinedWarning[a]&&(this.undefinedWarning[a]=!0,console.log("Warning: Accessing undefined variable: "+a));return h}return c};J.dump=function(a){var c=this.vars[a];
console.log("*** Dump "+a);for(a=0;a<c.length;a++)console.log(a+":> "+U(c[a]))};J.vstack=[];J.pushVstack=function(a){this.vstack.push(a)};J.popVstack=function(){this.vstack.pop()};J.cleanVstack=function(){for(var a=this.vstack;0<a.length&&"*"!==a[a.length-1];)this.removevar(a[a.length-1]),a.pop();0<a.length&&a.pop()};var va={generalFields:{color:"color",colorhsb:"",size:"size",alpha:"alpha",fillcolor:"fillcolor",fillalpha:"fillalpha",isshowing:"isshowing",visible:"visible",name:"name",caption:"caption",
trace:"",tracelength:"",selected:"",labeled:"labeled",labelled:"labeled"},getGeoField:function(a,c){return"undefined"!==typeof t.csnames[a]?va.getField(t.csnames[a],c):h},setGeoField:function(a,c,b){return"undefined"!==typeof t.csnames[a]?va.setField(t.csnames[a],c,b):h},getField:function(a,c){if("P"===a.kind){if("xy"===c)return a=g.dehom(a.homog),u.withUsage(a,"Point");if("homog"===c)return u.withUsage(a.homog,"Point");if("x"===c)return k.div(a.homog.value[0],a.homog.value[2]);if("y"===c)return k.div(a.homog.value[1],
a.homog.value[2])}if("L"===a.kind||"S"===a.kind){if("homog"===c)return u.withUsage(a.homog,"Line");if("angle"===c)return a=g.eucangle(g.ey,a.homog),u.withUsage(a,"Angle");if("slope"===c)return k.neg(k.div(a.homog.value[0],a.homog.value[1]))}if("Tr"===a.kind&&"matrix"===c)return a.matrix;if("C"===a.kind){if("radius"===c){var b=a.matrix;a=b.value[0].value[0];var d=b.value[0].value[2];c=b.value[1].value[2];b=b.value[2].value[2];k.mult(a,a);d=k.div(d,a);c=k.div(c,a);a=k.div(b,a);return a=k.sqrt(k.sub(k.add(k.mult(d,
d),k.mult(c,c)),a))}if("size"===c)return a.size;if("matrix"===c)return a.matrix;if("center"===c)return a=l._helper.CenterOfConic(a.matrix),a=g.dehom(a),u.withUsage(a,"Point");if("dualMatrix"===c)return g.normalizeMax(g.adjoint3(a.matrix))}if("Text"===a.kind){if("pressed"===c)return a.checkbox?u.bool(a.checkbox.checked):u.bool(!1);if("xy"===c)return a=g.dehom(a.homog),u.withUsage(a,"Point");if("homog"===c)return u.withUsage(a.homog,"Point");if("x"===c)return k.div(a.homog.value[0],a.homog.value[2]);
if("y"===c)return k.div(a.homog.value[1],a.homog.value[2])}if("trace"===c)return u.bool(!!a.drawtrace);if("pinned"===c)return u.bool(!!a.pinned);if(va.generalFields[c])return(a=a[va.generalFields[c]])&&a.ctype?a:"object"!==typeof a?u.wrap(a):h;if(a.behavior){if("mass"===c&&"Mass"===a.behavior.type)return k.real(a.behavior.mass);if("radius"===c&&"Mass"===a.behavior.type)return k.real(a.behavior.radius);if("charge"===c&&"Mass"===a.behavior.type)return k.real(a.behavior.charge);if("friction"===c&&"Mass"===
a.behavior.type)return k.real(a.behavior.friction);if("vx"===c&&"Mass"===a.behavior.type)return k.real(a.behavior.vx);if("vy"===c&&"Mass"===a.behavior.type)return k.real(a.behavior.vy);if("v"===c&&"Mass"===a.behavior.type)return g.realVector([a.behavior.vx,a.behavior.vy]);if("fx"===c&&"Mass"===a.behavior.type)return k.real(a.behavior.fx);if("fy"===c&&"Mass"===a.behavior.type)return k.real(a.behavior.fy);if("f"===c&&"Mass"===a.behavior.type)return g.realVector([a.behavior.fx,a.behavior.fy]);if("ldiff"===
c&&"Spring"===a.behavior.type)return k.real(a.behavior.ldiff)}c=l[a.type]["get_"+c];return"function"===typeof c?c(a):h},setField:function(a,c,b){"color"===c&&g._helper.isNumberVecN(b,3)&&(a.color=b);"size"===c&&"number"===b.ctype&&(a.size=b);"alpha"===c&&"number"===b.ctype&&(a.alpha=b);"fillcolor"===c&&g._helper.isNumberVecN(b,3)&&(a.fillcolor=b);"fillalpha"===c&&"number"===b.ctype&&(a.fillalpha=b);"visible"===c&&"boolean"===b.ctype&&(a.visible=b.value);"pinned"===c&&"boolean"===b.ctype&&(a.pinned=
b.value);"labeled"!==c&&"labelled"!==c||"boolean"!==b.ctype||(a.labeled=b.value);"printlabel"===c&&(a.printname=U(b));"trace"===c&&"boolean"===b.ctype&&(b.value&&!a.drawtrace?(a.drawtrace=!0,Ed(a)):a.drawtrace=b.value);"P"===a.kind&&a.movable&&("xy"===c&&g._helper.isNumberVecN(b,2)&&Ea(a,g.turnIntoCSList([b.value[0],b.value[1],k.real(1)]),"homog"),"xy"===c&&g._helper.isNumberVecN(b,3)&&Ea(a,b,"homog"),"x"===c&&"number"===b.ctype&&Ea(a,g.turnIntoCSList([k.mult(b,a.homog.value[2]),a.homog.value[1],
a.homog.value[2]]),"homog"),"y"===c&&"number"===b.ctype&&Ea(a,g.turnIntoCSList([a.homog.value[0],k.mult(b,a.homog.value[2]),a.homog.value[2]]),"homog"),"homog"===c&&g._helper.isNumberVecN(b,3)&&Ea(a,b,"homog"));"homog"===c&&"L"===a.kind&&a.movable&&g._helper.isNumberVecN(b,3)&&Ea(a,b,"homog");"Text"===a.kind&&("pressed"===c&&"boolean"===b.ctype&&a.checkbox&&(a.checkbox.checked=b.value),a.movable&&("xy"===c?g._helper.isNumberVecN(b,2)?a.homog=g.turnIntoCSList([b.value[0],b.value[1],k.real(1)]):g._helper.isNumberVecN(b,
3)&&(a.homog=b):"homog"===c&&g._helper.isNumberVecN(b,3)?a.homog=b:"x"===c&&"number"===b.ctype?a.homog=g.turnIntoCSList([k.mult(b,a.homog.value[2]),a.homog.value[1],a.homog.value[2]]):"y"===c&&"number"===b.ctype&&(a.homog=g.turnIntoCSList([a.homog.value[0],k.mult(b,a.homog.value[2]),a.homog.value[2]]))));a.behavior&&("mass"===c&&"Mass"===a.behavior.type&&"number"===b.ctype&&(a.behavior.mass=b.value.real),"mass"===c&&"Sun"===a.behavior.type&&"number"===b.ctype&&(a.behavior.mass=b.value.real),"friction"===
c&&"Mass"===a.behavior.type&&"number"===b.ctype&&(a.behavior.friction=b.value.real),"charge"===c&&"Mass"===a.behavior.type&&"number"===b.ctype&&(a.behavior.charge=b.value.real),"radius"===c&&"Mass"===a.behavior.type&&"number"===b.ctype&&(a.behavior.radius=b.value.real),"vx"===c&&"Mass"===a.behavior.type&&"number"===b.ctype&&(a.behavior.vx=b.value.real),"vy"===c&&"Mass"===a.behavior.type&&"number"===b.ctype&&(a.behavior.vy=b.value.real),"v"===c&&"Mass"===a.behavior.type&&g._helper.isNumberVecN(b,2)&&
(a.behavior.vx=b.value[0].value.real,a.behavior.vy=b.value[1].value.real));c=l[a.type]["set_"+c];if("function"===typeof c)return c(a,b)},getuserData:function(a,c){var b;a.userData&&a.userData[c]&&(b=a.userData[c]);return b&&b.ctype?b:"object"!==typeof b?u.wrap(b):h},setuserData:function(a,c,b){a.userData||(a.userData={});a.userData[c]=b}};r.version$0=function(a,c){a=["CindyJS"].concat(ze);return g.turnIntoCSList(a.map(u.wrap))};r.clearconsole$0=function(a,c){ya.clear()};r.err$1=function(a,c){c="";
"variable"===a[0].ctype?(c=a[0].name,a=J.getvar(a[0].name)):a=a[0];a=c+" ===> "+U(z(a));fa(a);return h};r.errc$1=function(a,c){"variable"===a[0].ctype?(c=z(J.getvar(a[0].name)),console.log(a[0].name+" ===> "+U(c))):(c=z(a[0]),console.log(" ===> "+U(c)));return h};r.print$1=function(a,c){ya.out(U(z(a[0])),!0);return h};r.println$1=function(a,c){ya.out(U(z(a[0])));return h};r.assert$2=function(a,c){var b=z(a[0]);if("boolean"===b.ctype){if(!1===b.value)return r.println$1([a[1]],c)}else fa("Condition for assert is not boolean");
return h};r.dump$1=function(a,c){console.log(JSON.stringify(a[0]));return h};r.repeat$2=function(a,c){return r.repeat$3([a[0],null,a[1]],c)};r.repeat$3=function(a,c){var b=B(a[0]),d="#";null!==a[1]&&"variable"===a[1].ctype&&(d=a[1].name);if("number"!==b.ctype)return h;b=Math.round(b.value.real);var e=1,g=1,f=b+1,k=!1,l=!1,n=!1;if(void 0!==c.start){var p=z(c.start);"number"===p.ctype&&(k=!0,g=p.value.real)}void 0!==c.step&&(p=z(c.step),"number"===p.ctype&&(n=!0,e=p.value.real));void 0!==c.stop&&(p=
z(c.stop),"number"===p.ctype&&(l=!0,f=p.value.real));!k||l||n||(f=e*b+g);k||!l||n||(g=-e*(b-1)+f,f+=e);k||l||!n||(f=e*b+g);k&&l&&!n&&(e=(f-g)/(b-1),f+=e);k&&!l&&n&&(f=e*b+g);!k&&l&&n&&(g=-e*(b-1)+f,f+=e);k&&l&&n&&(f+=e);(g<=f&&0<e||g>=f&&0>e)&&k&&l&&n&&(b=Math.floor((f-g)/e));J.newvar(d);c=h;for(f=0;f<b;f++)J.setvar(d,{ctype:"number",value:{real:f*e+g,imag:0}}),c=z(a[2]);J.removevar(d);return c};r.while$2=function(a,c){c=a[1];a=a[0];for(var b=z(a),d=h;"list"!==b.ctype&&b.value;)d=z(c),b=z(a);return d};
r.apply$2=function(a,c){return r.apply$3([a[0],null,a[1]],c)};r.apply$3=function(a,c){var b=B(a[0]);if("list"!==b.ctype)return h;c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);b=b.value;var d=[];J.newvar(c);for(var e=0;e<b.length;e++)J.setvar(c,b[e]),d[e]=z(a[2]);J.removevar(c);return{ctype:"list",value:d}};r.forall$2=function(a,c){return r.forall$3([a[0],null,a[1]],c)};r.forall$3=function(a,c){var b=B(a[0]);if("list"!==b.ctype)return h;c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);
b=b.value;J.newvar(c);for(var d,e=0;e<b.length;e++)J.setvar(c,b[e]),d=z(a[2]);J.removevar(c);return d};r.select$2=function(a,c){return r.select$3([a[0],null,a[1]],c)};r.select$3=function(a,c){var b=B(a[0]);if("list"!==b.ctype)return h;c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);b=b.value;var d=[];J.newvar(c);for(var e=0,g=0;g<b.length;g++){J.setvar(c,b[g]);var f=z(a[2]);"boolean"===f.ctype&&!0===f.value&&(d[e]=b[g],e++)}J.removevar(c);return{ctype:"list",value:d}};r.flatten$1=function(a,
c){function b(a,c){return-1===c||"list"!==a.ctype?a:[].concat.apply([],a.value.map(function(a){return b(a,c-1)}))}a=B(a[0]);if("list"!==a.ctype)return a;c=c.levels;void 0===c?c=1:(c=z(c),c="number"===c.ctype?c.value.real:"string"===c.ctype&&"all"===c.value?-2:1);return{ctype:"list",value:b(a,c)}};r.createvar$1=function(a,c){"variable"===a[0].ctype&&J.newvar(a[0].name);return h};r.local=function(a,c){for(c=0;c<a.length;c++)"variable"===a[c].ctype&&J.newvar(a[c].name);return h};r.removevar$1=function(a,
c){c=z(a[0]);"variable"===a[0].ctype&&J.removevar(a[0].name);return c};r.release=function(a,c){if(0===a.length)return h;c=z(a[a.length-1]);for(var b=0;b<a.length;b++)"variable"===a[b].ctype&&J.removevar(a[b].name);return c};r.regional=function(a,c){for(c=0;c<a.length;c++)if("variable"===a[c].ctype){var b=a[c].name;J.newvar(b);J.pushVstack(b)}return h};r.genList=function(a,c){return g.turnIntoCSList(a.map(z))};C.assigntake=function(a,c){var b=a.args[0],d=z(b);a=B(a.args[1]);var e=h;if("list"===d.ctype||
"string"===d.ctype)a=Math.floor(a.value.real),0>a&&(a=d.value.length+a+1),0<a&&a<=d.value.length&&("list"===d.ctype?(e=d.value.slice(),e[a-1]=z(c),e=g.turnIntoCSList(e),d.userData&&(e.userData=d.userData)):(d=d.value,d=d.substring(0,a-1)+U(z(c))+d.substring(a,d.length),e=u.string(d)));Ub([b,e])};C.assigndot=function(a,c){var b=z(a.obj);a=a.key;"geo"===b.ctype&&a&&va.setField(b.value,a,B(c));return h};C.assigncolon=function(a,c){var b=a.obj,d=z(b);a=U(z(a.key));"_?_"===a&&(a=void 0);if("geo"===d.ctype&&
a)va.setuserData(d.value,a,B(c));else if("list"===d.ctype||"string"===d.ctype&&a){var e={},g;for(g in d)e[g]=d[g];if(e.userData){d={};for(var f in e.userData)d[f]=e.userData[f];e.userData=d}else e.userData={};e.userData[a]=B(c);Ub([b,e])}else a?console.log("User data can only be assigned to geo objects and lists."):console.log("Key is undefined");return h};r.keys$1=function(a,c){c=z(a[0]);var b=c.ctype;return"geo"===b||"list"===b?(a=[],(c="geo"===b?c.value.userData:c.userData)&&(a=Object.keys(c).map(u.string)),
g.turnIntoCSList(a)):h};C.assignlist=function(a,c){var b=a.length,d=c.length;d<b&&(b=d);for(d=0;d<b;d++)Ub([a[d],c[d]],[])};r.if$2=function(a,c){return r.if$3(a,c)};r.if$3=function(a,c){c=B(a[0]);if("boolean"===c.ctype){if(!0===c.value)return z(a[1]);if(3===a.length)return z(a[2])}else fa("Condition for if is not boolean");return h};r.and$2=Uc;r.or$2=Vc;r.xor$2=function(a,c){c=B(a[0]);a=B(a[1]);return"boolean"===c.ctype&&"boolean"===a.ctype?{ctype:"boolean",value:c.value!==a.value}:h};r.not$1=function(a,
c){a=B(a[0]);return"boolean"===a.ctype?{ctype:"boolean",value:!a.value}:h};C.genericListMathGen=function(a,c,b){r[a+"$1"]=function(a,m){a=z(a[0]);if("list"!==a.ctype)return h;a=a.value;if(0===a.length)return b;m=a[0];for(var d=1;d<a.length;d++)m=c(m,a[d]);return m};var m=a+"$3";r[a+"$2"]=function(a,c){return r[m]([a[0],null,a[1]])};r[m]=function(a,m){m=B(a[0]);if("list"!==m.ctype)return h;m=m.value;if(0===m.length)return b;var d="#";null!==a[1]&&"variable"===a[1].ctype&&(d=a[1].name);J.newvar(d);
J.setvar(d,m[0]);for(var e=z(a[2]),g=1;g<m.length;g++){J.setvar(d,m[g]);var f=z(a[2]);e=c(e,f)}J.removevar(d);return e}};C.genericListMathGen("product",u.mult,k.real(1));C.genericListMathGen("sum",u.add,k.real(0));C.genericListMathGen("max",u.max,h);C.genericListMathGen("min",u.min,h);r.max$2=function(a,c){c=B(a[0]);if("list"===c.ctype)return r.max$3([c,null,a[1]]);a=B(a[1]);return r.max$1([g.turnIntoCSList([c,a])])};r.min$2=function(a,c){c=B(a[0]);if("list"===c.ctype)return r.min$3([c,null,a[1]]);
a=B(a[1]);return r.min$1([g.turnIntoCSList([c,a])])};r.add$2=Wc;r.sub$2=mc;r.mult$2=Xc;r.div$2=Yc;r.mod$2=function(a,c){c=B(a[0]);a=B(a[1]);return"number"===c.ctype&&"number"===a.ctype?k.mod(c,a):h};r.pow$2=fd;r.exp$1=function(a,c){a=B(a[0]);return"number"===a.ctype?k.exp(a):h};r.sin$1=function(a,c){a=B(a[0]);return"number"===a.ctype?k.sin(a):h};r.sqrt$1=function(a,c){a=B(a[0]);return"number"===a.ctype?k.sqrt(a):h};C.laguerre=function(a,c,b){if("list"!==a.ctype)return h;var m=a.value.length-1,d;for(d=
0;d<=m;d++)if("number"!==a.value[d].ctype)return h;if("number"!==c.ctype)return h;for(var e=[1,.3141,.5926,.5358,.9793,.2385,.6264,.3383,.2795,.0288],g,f,l,n=1;n<=b;n++){f=l=k.zero;g=a.value[m];for(d=m-1;0<=d;d--)l=k.add(f,k.mult(l,c)),f=k.add(g,k.mult(f,c)),g=k.add(a.value[d],k.mult(g,c));if(k._helper.isLessThan(k.abs(g),k.real(1E-14)))break;d=k.div(f,g);f=k.mult(d,d);g=k.sub(f,k.div(k.mult(k.real(2),l),g));l=k.sqrt(k.mult(k.real(m-1),k.sub(k.mult(k.real(m),g),f)));g=k.add(d,l);d=k.sub(d,l);k._helper.isLessThan(k.abs(g),
k.abs(d))&&(g=d);d=k._helper.isLessThan(k.real(1E-14),k.abs(g))?k.div(k.real(m),g):k.mult(k.add(k.abs(c),k.one),k.complex(Math.cos(n),Math.sin(n)));if(k._helper.isLessThan(k.abs(d),k.real(1E-14)))break;0===n%20&&n<b-19&&(d=k.mult(d,k.real(e[Math.floor(n/20)])));c=k.sub(c,d)}return c};C.quadratic_roots=function(a){if("list"!==a.ctype)return h;var c=a.value[2],b=a.value[1];a=a.value[0];if(k._helper.isZero(a))return[k.zero,k.neg(k.div(b,c))];var d=k.sqrt(k.sub(k.mult(b,b),k.mult(k.real(4),k.mult(c,a))));
0<=k.re(b)&&(d=k.neg(d));return[k.div(k.sub(d,b),k.mult(k.real(2),c)),k.div(k.mult(k.real(2),a),k.sub(d,b))]};C.roots=function(a){var c=[],b=a,d=a.value.length-1;if(0>=d)return g.turnIntoCSList([]);if(k._helper.isZero(a.value[d]))return c=C.roots(g.turnIntoCSList(a.value.slice(0,d))),g.append(c,k.infinity);if(1===d)c[0]=k.neg(k.div(a.value[0],a.value[1]));else if(2===d)c=C.quadratic_roots(a);else{for(var e=0;e<d-2;e++){c[e]=C.laguerre(a,k.zero,200);c[e]=C.laguerre(b,c[e],1);var f=[];f[d-e]=a.value[d-
e];for(var h=d-e;0<h;h--)f[h-1]=k.add(a.value[h-1],k.mult(f[h],c[e]));f.shift();a=g.turnIntoCSList(f)}a=C.quadratic_roots(a);c[d-2]=a[0];c[d-1]=a[1]}return g.turnIntoCSList(c)};r.roots$1=function(a,c){a=B(a[0]);if("list"===a.ctype){for(c=0;c<a.value.length;c++)if("number"!==a.value[c].ctype)return h;a=C.roots(a);return g.sort1(a)}return h};r.autodiff$3=function(a,c){c="x";if("function"===a[0].ctype){var b=eb[a[0].oper].body;c=a[0].args[0].name}else if("function"===typeof a[0].impl)b=a[0];else return fa("could not parse function"),
h;var d=B(a[1]);a=B(a[2]);if(1>a.value.real)return fa("grade cant be < 1"),h;a=k.add(a,k.real(1));return R.autodiff(b,c,d,a)};r.cos$1=function(a,c){a=B(a[0]);return"number"===a.ctype?k.cos(a):h};r.tan$1=function(a,c){a=B(a[0]);return"number"===a.ctype?k.tan(a):h};r.arccos$1=function(a,c){a=B(a[0]);return"number"===a.ctype?k.arccos(a):h};r.arcsin$1=function(a,c){a=B(a[0]);return"number"===a.ctype?k.arcsin(a):h};r.arctan$1=function(a,c){a=B(a[0]);return"number"===a.ctype?k.arctan(a):h};r.arctan2$2=
function(a,c){c=B(a[0]);a=B(a[1]);return"number"===c.ctype&&"number"===a.ctype?k.arctan2(c,a):h};r.arctan2$1=function(a,c){a=B(a[0]);if("list"===a.ctype&&2===a.value.length){if(a=a.value,"number"===a[0].ctype&&"number"===a[1].ctype)return r.arctan2$2(a,c)}else if("number"===a.ctype)return k.arctan2(a);return h};r.log$1=function(a,c){a=B(a[0]);return"number"===a.ctype?k.log(a):h};C.recursiveGen=function(a){var c=k[a],b=g[a];r[a+"$1"]=function(a,m){a=B(a[0]);return"number"===a.ctype?c(a):"list"===a.ctype?
b(a):h}};C.recursiveGen("im");C.recursiveGen("re");C.recursiveGen("conjugate");C.recursiveGen("round");C.recursiveGen("ceil");C.recursiveGen("floor");C.recursiveGen("abs");r.abs_infix=r.abs$1;r.random$0=function(a,c){return k.real(k._helper.rand())};r.random$1=function(a,c){a=B(a[0]);return"number"===a.ctype?k.complex(a.value.real*k._helper.rand(),a.value.imag*k._helper.rand()):h};r.seedrandom$1=function(a,c){a=B(a[0]);"number"===a.ctype&&k._helper.seedrandom(a.value.real);return h};r.randomnormal$0=
function(a,c){return k.real(k._helper.randnormal())};r.randominteger$1=function(a,c){c=B(a[0]);return"number"===c.ctype?(a=c.value.real|0,c=c.value.imag|0,a=a*k._helper.rand()|0,c=c*k._helper.rand()|0,k.complex(a,c)):h};r.randomint$1=r.randominteger$1;r.randombool$0=function(a,c){return.5<k._helper.rand()?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isreal$1=function(a,c){a=z(a[0]);return"number"===a.ctype&&k._helper.isAlmostReal(a)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};
r.isinteger$1=function(a,c){a=z(a[0]);return"number"===a.ctype&&k._helper.isAlmostReal(a)&&a.value.real===Math.floor(a.value.real)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.iseven$1=function(a,c){a=z(a[0]);return"number"===a.ctype&&k._helper.isAlmostReal(a)&&a.value.real/2===Math.floor(a.value.real/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isodd$1=function(a,c){a=z(a[0]);return"number"===a.ctype&&k._helper.isAlmostReal(a)&&(a.value.real-1)/2===Math.floor((a.value.real-
1)/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.iscomplex$1=function(a,c){return"number"===z(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isstring$1=function(a,c){return"string"===z(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.islist$1=function(a,c){return"list"===z(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.ismatrix$1=function(a,c){a=z(a[0]);return-1!==g._helper.colNumb(a)?{ctype:"boolean",value:!0}:{ctype:"boolean",
value:!1}};r.iscircle$1=function(a,c){a=z(a[0]);return"geo"===a.ctype&&"C"===a.value.kind&&"Circle"===a.value.matrix.usage?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isconic$1=function(a,c){a=z(a[0]);return"geo"===a.ctype&&"C"===a.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isline$1=function(a,c){a=z(a[0]);return"geo"===a.ctype&&"L"===a.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.ispoint$1=function(a,c){a=z(a[0]);return"geo"===a.ctype&&
"P"===a.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isgeometric$1=function(a,c){return"geo"===z(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isnumbermatrix$1=function(a,c){a=z(a[0]);return g.isNumberMatrix(a)};r.isnumbervector$1=function(a,c){a=z(a[0]);return g.isNumberVector(a)};r.issun$1=function(a,c){a=z(a[0]);return"geo"===a.ctype&&void 0!==a.value.behavior&&"Sun"===a.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.ismass$1=
function(a,c){a=z(a[0]);return"geo"===a.ctype&&void 0!==a.value.behavior&&"Mass"===a.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isspring$1=function(a,c){a=z(a[0]);return"geo"===a.ctype&&void 0!==a.value.behavior&&"Spring"===a.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isbouncer$1=function(a,c){a=z(a[0]);return"geo"===a.ctype&&void 0!==a.value.behavior&&"Bouncer"===a.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",
value:!1}};r.isundefined$1=function(a,c){return"undefined"===z(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};var Td={ArcBy3:"Arc",CenterOfConic:"Center",ConicBy1p4l:"Conic1P4L",ConicBy4p1l:"Conic4P1L",ConicBy5lines:"Conic5L",ConicBy2Foci1P:"ConicFoci",ConicFromPrincipalDirections:"ConicPrincipleDirs",Free:"FreePoint",PolarOfLine:"PolarLine",PolarOfPoint:"PolarPoint",PointOnSegment:"PointOnLine",Button:"Text",ToggleButton:"Text",TrReflectionL:"TrReflection",TrReflectionP:"TrReflection",
TrReflectionC:"TrReflection",TrTranslation:"TrProjection",TrSimilarity:"TrProjection",TrAffine:"TrProjection",TransformP:"Transform",TransformL:"Transform",TransformSegment:"Transform",TransformS:"Transform",TransformPolygon:"Transform",TransformArc:"Transform",TransformConic:"Transform",TransformC:"Transform",TrMoebiusP:"Transform",TrMoebiusL:"Transform",TrMoebiusSegment:"Transform",TrMoebiusS:"Transform",TrMoebiusPolygon:"Transform",TrMoebiusArc:"Transform",TrMoebiusCircle:"Transform",TrMoebiusC:"Transform",
TrInverseMoebius:"TrInverse",Perp:"Orthogonal",Para:"Parallel",AngleBisector:"AngularBisector",IntersectLC:"IntersectionConicLine",IntersectCirCir:"IntersectionCircleCircle",OtherPointOnCircle:"PointOnCircle"};r.algorithm$1=function(a,c){a=z(a[0]);if("geo"===a.ctype){a=a.value;var b=a.type;c=B(c.compatibility);"string"===c.ctype&&/^cinderella$/i.test(c.value)&&(/^Select/.test(b)&&(a=t.csnames[a.args[0]],b=a.type),Td.hasOwnProperty(b)?b=Td[b]:"CircleMr"===b&&(b=a.pinned?"CircleByFixedRadius":"CircleByRadius"));
return u.string(b)}return h};r.inputs$1=function(a,c){a=z(a[0]);if("geo"===a.ctype){a=a.value;c=a.type;var b=[];a.args&&(b=a.args.map(function(a){return{ctype:"geo",value:t.csnames[a]}}));if(/^Select/.test(c)||l[c].isMovable)switch(a.kind){case "P":case "L":b.push(a.homog);break;case "C":b.push(a.matrix)}return g.turnIntoCSList(b)}return h};r.moveto$2=function(a,c){c=z(a[0]);a=B(a[1]);"geo"===c.ctype&&(c=c.value,g._helper.isNumberVecN(a,2)?va.setField(c,"xy",a):g._helper.isNumberVecN(a,3)&&va.setField(c,
"homog",a));return h};r.continuefromhere$0=function(a,c){Bb();return h};r.matrixrowcolumn$1=function(a,c){a=z(a[0]);return-1!==g._helper.colNumb(a)?g.realVector([a.value.length,a.value[0].value.length]):h};r.rowmatrix$1=function(a,c){a=z(a[0]);return"list"===a.ctype?g.turnIntoCSList([a]):h};r.columnmatrix$1=function(a,c){a=z(a[0]);return"list"===a.ctype?g.turnIntoCSList(a.value.map(function(a){return g.turnIntoCSList([a])})):h};r.submatrix$3=function(a,c){c=z(a[0]);var b=z(a[1]);a=z(a[2]);if("list"===
c.ctype&&"number"===b.ctype&&"number"===a.ctype){var d=Math.round(b.value.real);a=Math.round(a.value.real);c=c.value.slice();0<a&&a<=c.length&&c.splice(a-1,1);var e=!0;c=c.map(function(a){if("list"!==a.ctype)e=!1;else return a=a.value.slice(),0<d&&d<=a.length&&a.splice(d-1,1),g.turnIntoCSList(a)});return e?g.turnIntoCSList(c):h}return h};r.complex$1=function(a,c){var b=B(a[0]);if("list"===b.ctype&&g.isNumberVector(b)){if(2===b.value.length)return a=b.value[0],c=b.value[1],k.complex(a.value.real-c.value.imag,
c.value.real+a.value.imag);if(3===b.value.length)return a=b.value[0],c=b.value[1],b=b.value[2],a=k.div(a,b),c=k.div(c,b),k.complex(a.value.real-c.value.imag,c.value.real+a.value.imag)}return h};r.gauss$1=function(a,c){a=B(a[0]);return"number"===a.ctype?g.realVector([a.value.real,a.value.imag]):h};r.cross$2=gd;r.crossratio$4=function(a,c){c=z(a[0]);var b=z(a[1]),d=z(a[2]);a=z(a[3]);var e=L(c),f=L(b),l=L(d),n=L(a);return e!==h&&f!==h&&l!==h&&n!==h?g.crossratio3(e,f,l,n,g.ii):"number"===c.ctype&&"number"===
b.ctype&&"number"===d.ctype&&"number"===a.ctype?k.div(k.mult(k.sub(c,d),k.sub(b,a)),k.mult(k.sub(c,a),k.sub(b,d))):h};r.para$2=function(a,c){c=B(a[0]);var b=B(a[1]);a=L(c);var d=L(b);if(c!==h&&b!==h){b=b.usage;var e=a,f=d;if("Line"===c.usage||"Point"===b)e=d,f=a;c=g.cross(g.cross(g.linfty,f),e);return u.withUsage(c,"Line")}return h};r.perp$2=function(a,c){c=B(a[0]);var b=B(a[1]);a=L(c);var d=L(b);if(c!==h&&b!==h){var e=b.usage||d.usage;b=a;var f=d;if("Line"===(c.usage||a.usage)||"Point"===e)b=d,f=
a;c=g.turnIntoCSList([f.value[0],f.value[1],k.zero]);c=g.cross(c,b);return u.withUsage(c,"Line")}return h};r.perp$1=function(a,c){a=B(a[0]);return g._helper.isNumberVecN(a,2)?g.turnIntoCSList([k.neg(a.value[1]),a.value[0]]):h};r.parallel$2=r.para$2;r.perpendicular$2=r.perp$2;r.perpendicular$1=r.perp$1;r.meet$2=function(a,c){c=L(a[0]);a=L(a[1]);return c!==h&&a!==h?(a=g.cross(c,a),u.withUsage(a,"Point")):h};r.join$2=function(a,c){c=L(a[0]);a=L(a[1]);return c!==h&&a!==h?(a=g.cross(c,a),u.withUsage(a,
"Line")):h};r.dist$2=function(a,c){c=B(a[0]);a=B(a[1]);a=mc([c,a],[]);return r.abs$1([a],[])};r.dist_infix=r.dist$2;r.point$1=function(a,c){a=z(a[0]);return g._helper.isNumberVecN(a,3)||g._helper.isNumberVecN(a,2)?u.withUsage(a,"Point"):a};r.line$1=function(a,c){a=z(a[0]);return g._helper.isNumberVecN(a,3)?u.withUsage(a,"Line"):a};r.det$3=function(a,c){c=L(a[0]);var b=L(a[1]);a=L(a[2]);if(c!==h&&b!==h&&a!==h)return g.det3(c,b,a)};r.det$1=function(a,c){a=B(a[0]);return"list"===a.ctype&&(c=g._helper.colNumb(a),
-1!==c&&c===a.value.length)?g.det(a):h};r.eig$1=function(a,c){a=B(a[0]);return"list"===a.ctype&&(c=g._helper.colNumb(a),-1!==c&&c===a.value.length)?g.eig(a):h};r.eigenvalues$1=function(a,c){a=B(a[0]);return"list"===a.ctype&&(c=g._helper.colNumb(a),-1!==c&&c===a.value.length)?g.eig(a,!1).value[0]:h};r.rank$1=function(a,c){a=B(a[0]);if("list"===a.ctype){var b=g._helper.colNumb(a);if(-1!==b&&b===a.value.length)return g.rank(a,c.precision)}return h};r.kernel$1=function(a,c){a=B(a[0]);if("list"===a.ctype){var b=
g._helper.colNumb(a);if(-1!==b&&b===a.value.length)return c=g.nullSpace(a,c.precision),g.transpose(c)}return h};r.eigenvectors$1=function(a,c){a=B(a[0]);return"list"===a.ctype&&(c=g._helper.colNumb(a),-1!==c&&c===a.value.length)?g.eig(a).value[1]:h};r.area$3=function(a,c){c=L(a[0]);var b=L(a[1]);a=L(a[2]);if(c!==h&&b!==h&&a!==h){var d=c.value[2],e=b.value[2],f=a.value[2];if(!k._helper.isAlmostZero(d)&&!k._helper.isAlmostZero(e)&&!k._helper.isAlmostZero(f))return c=g.scaldiv(d,c),b=g.scaldiv(e,b),
a=g.scaldiv(f,a),c=g.det3(c,b,a),k.realmult(.5,c)}return h};r.inverse$1=function(a,c){a=B(a[0]);return"list"===a.ctype&&(c=g._helper.colNumb(a),-1!==c&&c===a.value.length)?g.inverse(a):h};r.linearsolve$2=function(a,c){c=B(a[0]);a=B(a[1]);if("list"===c.ctype){var b=g._helper.colNumb(c);if(-1!==b&&b===c.value.length&&g._helper.isNumberVecN(a,b))return g.linearsolve(c,a)}return h};var ee=[[[]],[[0]],[[0,1],[1,0]],[[0,1,2],[0,2,1],[1,0,2],[1,2,0],[2,0,1],[2,1,0]],[[0,1,2,3],[0,1,3,2],[0,2,1,3],[0,2,3,
1],[0,3,1,2],[0,3,2,1],[1,0,2,3],[1,0,3,2],[1,2,0,3],[1,2,3,0],[1,3,0,2],[1,3,2,0],[2,0,1,3],[2,0,3,1],[2,1,0,3],[2,1,3,0],[2,3,0,1],[2,3,1,0],[3,0,1,2],[3,0,2,1],[3,1,0,2],[3,1,2,0],[3,2,0,1],[3,2,1,0]]];r.mincostmatching$1=function(a,c){var b=z(a[0]);if(g.isNumberMatrix(b).value){a=b.value.length;c=g._helper.colNumb(b);var d=a<c?c:a,e,f,l=Array(d);for(e=0;e<d;++e)for(l[e]=Array(d),f=0;f<d;++f)l[e][f]=e<a&&f<c?b.value[e].value[f].value.real:0;b=yc(l);d=Array(a);for(e=0;e<a;++e)f=b[e],d[e]=f<c?k.real(f+
1):k.real(0);return g.turnIntoCSList(d)}return h};r.take$2=zc;r.length$1=function(a,c){a=z(a[0]);return"list"===a.ctype||"string"===a.ctype?k.real(a.value.length):h};r.pairs$1=function(a,c){a=z(a[0]);return"list"===a.ctype?g.pairs(a):h};r.triples$1=function(a,c){a=z(a[0]);return"list"===a.ctype?g.triples(a):h};r.cycle$1=function(a,c){a=z(a[0]);return"list"===a.ctype?g.cycle(a):h};r.consecutive$1=function(a,c){a=z(a[0]);return"list"===a.ctype?g.consecutive(a):h};r.reverse$1=function(a,c){a=z(a[0]);
return"list"===a.ctype?g.reverse(a):h};r.directproduct$2=function(a,c){c=z(a[0]);a=z(a[1]);return"list"===c.ctype&&"list"===a.ctype?g.directproduct(c,a):h};r.concat$2=hd;r.common$2=id;r.remove$2=jd;r.append$2=kd;r.prepend$2=ld;r.contains$2=function(a,c){c=z(a[0]);a=z(a[1]);return"list"===c.ctype?g.contains(c,a):h};r.sort$2=function(a,c){return r.sort$3([a[0],null,a[1]],c)};r.sort$3=function(a,c){var b=B(a[0]);if("list"!==b.ctype)return h;c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);b=
b.value;var d=[];J.newvar(c);var e;for(e=0;e<b.length;e++)J.setvar(c,b[e]),d[e]={val:b[e],result:z(a[2])};J.removevar(c);d.sort(u.compareResults);a=[];for(e=0;e<b.length;e++)a[e]=d[e].val;return{ctype:"list",value:a}};r.sort$1=function(a,c){a=z(a[0]);return"list"===a.ctype?g.sort1(a):h};r.set$1=function(a,c){a=z(a[0]);return"list"===a.ctype?g.set(a):h};r.combinations$2=function(a,c){function b(a,c){a===e?q.push(g.turnIntoCSList(t.slice())):c<f&&(t[a]=d.value[c],b(a+1,c+1),b(a,c+1))}var d=z(a[0]);
a=z(a[1]);if("number"===a.ctype){var e=a.value.real|0;if("number"===d.ctype){var f=d.value.real|0;f-e<e&&(e=f-e);if(0>e)return k.real(0);if(0===e)return k.real(1);if(1===e)return d;for(var l=c=a=1;l<=e;++l){var n=f-e+l|0,p=l|0,M=Ac(n,p)|0;n=n/M|0;p=p/M|0;M=Ac(a,p)|0;a=a/M|0;p=p/M|0;M=Ac(n,c)|0;n=n/M|0;c=c/M|0;a=a*n|0;c=c*p|0}return k.real(a/c)}if("list"===d.ctype){f=d.value.length;if(0>e||e>f)return g.turnIntoCSList([]);if(0===e)return g.turnIntoCSList([g.turnIntoCSList([])]);if(e===f)return g.turnIntoCSList([d]);
var q=[];var t=Array(e);b(0,0);return g.turnIntoCSList(q)}}return h};r.zeromatrix$2=function(a,c){c=B(a[0]);a=B(a[1]);return"number"===c.ctype&&"number"===a.ctype?g.zeromatrix(c,a):h};r.zerovector$1=function(a,c){a=B(a[0]);return"number"===a.ctype?g.zerovector(a):h};r.transpose$1=function(a,c){a=B(a[0]);return"list"===a.ctype&&-1!==g._helper.colNumb(a)?g.transpose(a):h};r.row$2=function(a,c){c=B(a[0]);a=B(a[1]);return"number"===a.ctype&&"list"===c.ctype&&-1!==g._helper.colNumb(c)?g.row(c,a):h};r.column$2=
function(a,c){c=B(a[0]);a=B(a[1]);return"number"===a.ctype&&"list"===c.ctype&&-1!==g._helper.colNumb(c)?g.column(c,a):h};r.dict$0=function(a,c){a=Qa.create();for(var b in c)c.hasOwnProperty(b)&&Qa.put(a,u.string(b),z(c[b]));return a};r.put$3=function(a,c){c=z(a[0]);var b=z(a[1]);a=z(a[2]);return"dict"===c.ctype?(c=Qa.clone(c),Qa.put(c,b,a),c):h};r.get$2=function(a,c){c=z(a[0]);a=z(a[1]);return"dict"===c.ctype?Qa.get(c,a,h):h};r.red$1=function(a,c){a=z(a[0]);return"number"===a.ctype?g.realVector([Math.min(1,
Math.max(0,a.value.real)),0,0]):h};r.green$1=function(a,c){a=z(a[0]);return"number"===a.ctype?g.realVector([0,Math.min(1,Math.max(0,a.value.real)),0]):h};r.blue$1=function(a,c){a=z(a[0]);return"number"===a.ctype?g.realVector([0,0,Math.min(1,Math.max(0,a.value.real))]):h};r.gray$1=function(a,c){a=z(a[0]);return"number"===a.ctype?(a=Math.min(1,Math.max(0,a.value.real)),g.realVector([a,a,a])):h};r.grey$1=r.gray$1;C.HSVtoRGB=function(a,c,b){a&&void 0===c&&void 0===b&&(c=a.s,b=a.v,a=a.h);var m=Math.floor(6*
a);var d=6*a-m;a=b*(1-c);var e=b*(1-d*c);c=b*(1-(1-d)*c);switch(m%6){case 0:var f=b;var k=c;var h=a;break;case 1:f=e;k=b;h=a;break;case 2:f=a;k=b;h=c;break;case 3:f=a;k=e;h=b;break;case 4:f=c;k=a;h=b;break;case 5:f=b,k=a,h=e}return g.realVector([f,k,h])};r.hue$1=function(a,c){a=z(a[0]);return"number"===a.ctype?(a=a.value.real,a-=Math.floor(a),C.HSVtoRGB(a,1,1)):h};C.shapeconvert=function(a){if("circle"===a.type){var c=a.value.value[0];c=u.div(c,c.value[2]);var b=c.value[0].value.real,d=c.value[1].value.real;
a=a.value.value[1].value.real;var e=Array(125);var g=2*Math.PI/125;for(c=0;125>c;c++)e[c]={X:b+Math.cos(c*g)*a,Y:d+Math.sin(c*g)*a};return[e]}if("polygon"===a.type){b=[];for(c=0;c<a.value.length;c++){d=a.value[c];e=[];for(g=0;g<d.length;g++)e[g]={X:d[g].X,Y:d[g].Y};b[c]=e}return b}};C.shapeop=function(a,c,b){a=C.shapeconvert(a);var m=C.shapeconvert(c);ClipperLib.JS.ScaleUpPaths(a,1E3);ClipperLib.JS.ScaleUpPaths(m,1E3);c=new ClipperLib.Clipper;c.AddPaths(a,ClipperLib.PolyType.ptSubject,!0);c.AddPaths(m,
ClipperLib.PolyType.ptClip,!0);m=a=ClipperLib.PolyFillType.pftNonZero;var d=new ClipperLib.Paths;c.Execute(b,d,a,m);ClipperLib.JS.ScaleDownPaths(d,1E3);return{ctype:"shape",type:"polygon",value:d}};C.shapecommon=function(a,c){return C.shapeop(a,c,ClipperLib.ClipType.ctIntersection)};C.shaperemove=function(a,c){return C.shapeop(a,c,ClipperLib.ClipType.ctDifference)};C.shapeconcat=function(a,c){return C.shapeop(a,c,ClipperLib.ClipType.ctUnion)};r.key$0=function(a,c){return{ctype:"string",value:dd}};
r.keycode$0=function(a,c){return k.real(ed)};r.mouse$0=function(a,c){return g.realVector([ta[0],ta[1]])};r.mover$0=function(a,c){if(ja&&ja.mover)return{ctype:"geo",value:ja.mover};console.log("Not moving anything at the moment");return h};r.translate$1=function(a,c){a=B(a[0]);"list"===a.ctype&&g.isNumberVector(a)&&2===a.value.length&&y.translate(a.value[0].value.real,a.value[1].value.real);return h};r.rotate$1=function(a,c){a=B(a[0]);"number"===a.ctype&&y.rotate(a.value.real);return h};r.scale$1=
function(a,c){a=B(a[0]);"number"===a.ctype&&y.scale(a.value.real);return h};r.greset$0=function(a,c){a=fb.stack.length;y.greset();for(c=0;c<a;c++)A.restore();return h};r.gsave$0=function(a,c){y.gsave();A.save();return h};r.grestore$0=function(a,c){y.grestore();A.restore();return h};r.color$1=function(a,c){a=B(a[0]);"list"===a.ctype&&g.isNumberVector(a).value&&y.setcolor(a);return h};r.linecolor$1=function(a,c){a=B(a[0]);"list"===a.ctype&&g.isNumberVector(a).value&&y.setlinecolor(a);return h};r.pointcolor$1=
function(a,c){a=B(a[0]);"list"===a.ctype&&g.isNumberVector(a).value&&y.setpointcolor(a);return h};r.alpha$1=function(a,c){a=B(a[0]);"number"===a.ctype&&y.setalpha(a);return h};r.pointsize$1=function(a,c){a=B(a[0]);"number"===a.ctype&&y.setpointsize(a);return h};r.linesize$1=function(a,c){a=B(a[0]);"number"===a.ctype&&y.setlinesize(a);return h};r.textsize$1=function(a,c){a=B(a[0]);"number"===a.ctype&&y.settextsize(a);return h};r.playanimation$0=function(a,c){Aa();return h};r.pauseanimation$0=function(a,
c){Ka();return h};r.stopanimation$0=function(a,c){nb();return h};r.text$1=function(a,c){a=B(a[0]);return u.string(U(a))};r.replace$3=function(a,c){var b=z(a[0]);c=z(a[1]);a=z(a[2]);if("string"===b.ctype&&"string"===c.ctype&&"string"===a.ctype)return b=b.value,c=c.value.replace(/[^A-Za-z0-9]/g,"\\$&"),a=a.value.replace(/\$/g,"$$$$"),b=b.replace(new RegExp(c,"g"),a),{ctype:"string",value:b}};r.replace$2=function(a,c){function b(a,c,b){var m="";d=k=-1;for(var e=0;e<c.length;e++){var g=c[e][0],f=a.indexOf(g,
b);-1!==f&&(-1===k?(m=g,k=f,d=e):f<k&&(m=g,k=f,d=e))}return m}var d;c=z(a[0]);var e=z(a[1]);if("string"===c.ctype&&"list"===e.ctype){a=c.value;c=[];for(var g=0;g<e.value.length;g++){var f=e.value[g];"list"===f.ctype&&2===f.value.length&&"string"===f.value[0].ctype&&"string"===f.value[1].ctype&&(c[c.length]=[f.value[0].value,f.value[1].value])}var k=-1;for(e=b(a,c,0);-1!==k;)a=a.substring(0,k)+c[d][1]+a.substring(k+e.length,a.length),e=k+c[d][1].length,e=b(a,c,e);return{ctype:"string",value:a}}return h};
r.substring$3=function(a,c){c=z(a[0]);var b=B(a[1]);a=B(a[2]);return"string"===c.ctype&&"number"===b.ctype&&"number"===a.ctype?{ctype:"string",value:c.value.substring(Math.floor(b.value.real),Math.floor(a.value.real))}:h};r.tokenize$2=function(a,c){var b=z(a[0]);a=z(a[1]);if("string"===b.ctype&&"string"===a.ctype)return r.tokenize$2([b,g.turnIntoCSList([a])],c);if("string"===b.ctype&&"list"===a.ctype){b=b.value;if(0===a.value.length){a=!0;if(void 0!==c.autoconvert){var d=z(c.autoconvert);"boolean"===
d.ctype&&(a=d.value)}return a&&""!==b&&(a=Number(b),!isNaN(a))?k.real(a):u.string(b)}d=a.value[0];var e=g.turnIntoCSList(a.value.slice(1));b=b.split(d.value);return g.turnIntoCSList(b.map(function(a){return r.tokenize$2([u.string(a),e],c)}))}return h};r.indexof$2=function(a,c){c=z(a[0]);a=z(a[1]);return"string"===c.ctype&&"string"===a.ctype?(a=c.value.indexOf(a.value),k.real(a+1)):h};r.indexof$3=function(a,c){c=z(a[0]);var b=z(a[1]);a=z(a[2]);return"string"===c.ctype&&"string"===b.ctype&&"number"===
a.ctype?(a=c.value.indexOf(b.value,Math.round(a.value.real)-1),k.real(a+1)):h};r.parse$1=function(a,c){a=z(a[0]);return"string"===a.ctype?(a=Wa(a.value),z(a)):h};r.unicode$1=function(a,c){a=z(a[0]);var b=16;c.base&&(c=z(c.base),"number"===c.ctype&&(b=c.value.real));if("string"===a.ctype)c=parseInt(a.value,b);else if("number"===a.ctype)c=a.value.real;else return h;"undefined"!==typeof String.fromCodePoint?c=String.fromCodePoint(c):65535>=c?c=String.fromCharCode(c):(c-=65536,c=String.fromCharCode((c>>
10)+55296,(c&1023)+56320));return u.string(c)};r.international$1=function(a,c){return r.international$2([a[0],null],c)};r.international$2=function(a,c){c=z(a[0]);if("string"!==c.ctype)return h;var b=(p.translations||{})[p.language||"en"]||{};if(!b.hasOwnProperty(c.value))return c;var d=b[c.value];if("string"===typeof d)return u.string(d);if(null===a[1])return c;a=z(a[1]);a="number"===a.ctype?a.value.real:0;a=(b._pluralFormFunction||fe)(a);return a<d.length?u.string(d[a]):c};r.currentlanguage$0=function(a,
c){return u.string(p.language||"en")};C.basismap=function(a,c,b,d){var m=g.turnIntoCSList([a,c,b]);m=g.adjoint3(g.transpose(m));d=u.mult(m,d);m=g.turnIntoCSList([u.mult(d.value[0],a),u.mult(d.value[1],c),u.mult(d.value[2],b)]);return g.transpose(m)};r.map$8=function(a,c){c=L(a[0]);var b=L(a[1]),d=L(a[2]),e=L(a[3]),f=L(a[4]),k=L(a[5]),l=L(a[6]);a=L(a[7]);return f!==h&&k!==h&&l!==h&&a!==h&&c!==h&&b!==h&&d!==h&&e!==h?(a=C.basismap(f,k,l,a),c=C.basismap(c,b,d,e),c=u.mult(a,g.adjoint3(c)),g.normalizeMax(c)):
h};r.map$6=function(a,c){c=L(a[0]);var b=L(a[1]),d=L(a[2]),e=g.realVector([0,0,1]),f=g.cross,k=f(f(d,f(e,f(c,b))),f(b,f(e,f(c,d)))),l=L(a[3]),n=L(a[4]);a=L(a[5]);e=f(f(a,f(e,f(l,n))),f(n,f(e,f(l,a))));return l!==h&&n!==h&&a!==h&&e!==h&&c!==h&&b!==h&&d!==h&&k!==h?(l=C.basismap(l,n,a,e),c=C.basismap(c,b,d,k),c=u.mult(l,g.adjoint3(c)),g.normalizeMax(c)):h};r.map$4=function(a,c){c=g.ii;var b=g.jj,d=L(a[0]),e=L(a[1]),f=L(a[2]);a=L(a[3]);return f!==h&&a!==h&&d!==h&&e!==h?(a=C.basismap(f,a,c,b),c=C.basismap(d,
e,c,b),c=u.mult(a,g.adjoint3(c)),g.normalizeMax(c)):h};r.map$2=function(a,c){c=g.ii;var b=g.jj,d=L(a[0]),e=u.add(g.realVector([1,0,0]),d);a=L(a[1]);var f=u.add(g.realVector([1,0,0]),a);return a!==h&&f!==h&&d!==h&&e!==h?(a=C.basismap(a,f,c,b),c=C.basismap(d,e,c,b),c=u.mult(a,g.adjoint3(c)),g.normalizeMax(c)):h};r.pointreflect$1=function(a,c){c=g.ii;var b=g.jj;a=L(a[0]);var d=u.add(g.realVector([1,0,0]),a),e=u.add(g.realVector([-1,0,0]),a);return e!==h&&a!==h&&d!==h?(e=C.basismap(a,e,c,b),c=C.basismap(a,
d,c,b),c=u.mult(e,g.adjoint3(c)),g.normalizeMax(c)):h};r.linereflect$1=function(a,c){c=g.ii;var b=g.jj;a=L(a[0]);var d=g.realVector([Math.random(),Math.random(),Math.random()]),e=g.realVector([Math.random(),Math.random(),Math.random()]);d=g.cross(d,a);e=g.cross(e,a);return a!==h&&d!==h?(a=C.basismap(d,e,c,b),c=C.basismap(d,e,b,c),c=u.mult(a,g.adjoint3(c)),g.normalizeMax(c)):h};C.extractPointVec=function(a){var c={ok:!1};if("geo"===a.ctype){var b=a.value;if("P"===b.kind)return c.x=va.getField(b,"x"),
c.y=va.getField(b,"y"),c.z=k.real(1),c.ok=!0,c}if("list"!==a.ctype)return c;var d=a.value;if(2===d.length&&(a=d[0],b=d[1],"number"===a.ctype&&"number"===b.ctype))return c.x=a,c.y=b,c.z=k.real(1),c.ok=!0,c;3===d.length&&(a=d[0],b=d[1],d=d[2],"number"===a.ctype&&"number"===b.ctype&&"number"===d.ctype&&(c.x=k.div(a,d),c.y=k.div(b,d),c.z=k.real(1),c.ok=!0));return c};r.polygon$1=function(a,c){a=z(a[0]);if("list"===a.ctype){c=[];for(var b=0;b<a.value.length;b++){var d=C.extractPoint(a.value[b]);if(!d.ok)return h;
c[b]={X:d.x,Y:d.y}}return{ctype:"shape",type:"polygon",value:[c]}}return h};r.circle$2=function(a,c){c=B(a[0]);a=B(a[1]);c=C.extractPointVec(c);if(!c.ok||"number"!==a.ctype)return h;c=g.turnIntoCSList([c.x,c.y,c.z]);return{ctype:"shape",type:"circle",value:g.turnIntoCSList([c,a])}};r.screen$0=function(a,c){var b=y.drawingstate.initialmatrix;a=function(a,c){a-=b.tx;c+=b.ty;return{X:(a*b.d-c*b.b)/b.det,Y:-(-a*b.c+c*b.a)/b.det}};return{ctype:"shape",type:"polygon",value:[[a(0,0),a(ca,0),a(ca,da),a(0,
da)]]}};r.halfplane$2=function(a,c){c=B(a[0]);a=B(a[1]);var b=L(c),d=L(a);if(c!==h&&a!==h){var e=a.usage;a=b;var f=d;if("Line"===c.usage||"Point"===e)a=d,f=b;c=g.turnIntoCSList([f.value[0],f.value[1],k.zero]);c=g.cross(c,a);f=g.cross(f,c);f=u.div(f,f.value[2]);a=u.div(a,a.value[2]);a=g.sub(a,f);c=g.abs(a);a=u.div(a,c);c=f.value[0].value.real;f=f.value[1].value.real;b=1E3*a.value[0].value.real;a=1E3*a.value[1].value.real;return{ctype:"shape",type:"polygon",value:[[{X:c+a/2,Y:f-b/2},{X:c+a/2+b,Y:f-
b/2+a},{X:c-a/2+b,Y:f+b/2+a},{X:c-a/2,Y:f+b/2}]]}}return h};r.element$1=function(a,c){a=z(a[0]);return"string"===a.ctype&&t.csnames.hasOwnProperty(a.value)?{ctype:"geo",value:t.csnames[a.value]}:h};C.all$1=function(a,c){a=z(a[0]);return"geo"===a.ctype&&a.value.incidences?g.ofGeos(a.value.incidences.map(function(a){return t.csnames[a]}).filter(c)):g.nil};r.allpoints$0=function(a,c){return g.ofGeos(t.points)};r.allpoints$1=function(a,c){return C.all$1(a,function(a){return"P"===a.kind})};r.allmasses$0=
function(a,c){return g.ofGeos(na)};r.allmasses$1=function(a,c){return C.all$1(a,function(a){return"P"===a.kind&&a.behavior&&"Mass"===a.behavior.type})};r.allsprings$0=function(a,c){return g.ofGeos(Lc)};r.allsprings$1=function(a,c){return C.all$1(a,function(a){return"S"===a.kind&&a.behavior&&"Spring"===a.behavior.type})};r.alllines$0=function(a,c){return g.ofGeos(t.lines)};r.alllines$1=function(a,c){return C.all$1(a,function(a){return"L"===a.kind||"S"===a.kind})};r.allsegments$0=function(a,c){return g.ofGeos(t.lines.filter(function(a){return"S"===
a.kind}))};r.allsegments$1=function(a,c){return C.all$1(a,function(a){return"S"===a.kind})};r.allconics$0=function(a,c){return g.ofGeos(t.conics)};r.allconics$1=function(a,c){return C.all$1(a,function(a){return"C"===a.kind})};r.allcircles$0=function(a,c){return g.ofGeos(t.conics.filter(function(a){return"Circle"===a.matrix.usage}))};r.allcircles$1=function(a,c){return C.all$1(a,function(a){return"C"===a.kind&&"Circle"===a.matrix.usage})};r.allelements$0=function(a,c){return g.ofGeos(t.gslp)};r.allelements$1=
function(a,c){return C.all$1(a,function(a){return!0})};r.elementsatmouse$0=function(a,c){var b=g.realVector([ta[0],ta[1],1]),d=function(a){if(k._helper.isAlmostZero(a.value[2]))return Infinity;a=g.normalizeZ(a);return g.abs(g.sub(a,b)).value.real},e=function(a){a=g.turnIntoCSList([a.value[0],a.value[1],k.zero]);return g.normalizeMax(g.cross(b,a))},f=function(a){var c=u.mult(a.matrix,b);c=e(c);a=l._helper.IntersectLC(c,a.matrix).map(function(a){return d(a)});return.5>Math.min(a[0],a[1])};a=t.points.filter(function(a){return.5>
d(a.homog)});c=t.lines.filter(function(a){var c=e(a.homog);c=g.normalizeMax(g.cross(a.homog,c));if((c=.5>d(c))&&"S"===a.kind){var m=a.homog;m=g.turnIntoCSList([m.value[0],m.value[1],k.zero]);a=g.crossratio3(a.farpoint,a.startpos,a.endpos,b,m).value.real;if(0>a||1<a)c=!1}return c});var h=t.conics.filter(function(a){var c=f(a);if(c&&a.isArc){var d=g.crossratio3harm(a.startPoint,a.endPoint,a.viaPoint,b,g.ii);a=d.value[0];d=d.value[1];k._helper.isAlmostZero(a)?(a=k.div(a,d),d=k.real(1)):(d=k.div(d,a),
a=k.real(1));var m=g.abs(g.turnIntoCSList([d,a]));a=k.div(a,m);d=k.div(d,m);d=k.mult(d,a);0>a.value.real&&(d=k.neg(d));0>d.value.real&&(c=!1)}return c});a=a.concat(c,h);return g.ofGeos(a)};r.incidences$1=r.allelements$1;r.createpoint$2=function(a,c){c=z(a[0]);a=L(a[1]);return"string"!==c.ctype?(fa("Name must be a string"),h):"list"!==a.ctype&&g.isNumberVector(a)?(fa("Position must be a number vector"),h):{ctype:"geo",value:Oa({name:c.value,type:"Free",labeled:!0,pos:a},!0)}};r.create$3=function(a,
c){var b=z(a[0]),d=z(a[1]),e=z(a[2]);a={};for(var f in c)a[f]=B(c[f]);if("string"===b.ctype)f=b.value;else{if("list"!==b.ctype)return fa("Names must be a string or a list of strings"),h;if(1!==b.value.length){f=u.string(b.value.map(function(a){return a.value}).join("__"));e=r.create$3([f,d,e],a);var n=[];if(e!==h)for(d=u.string(e.value.kind.replace(/^(.*)s$/,"Select$1")),e=g.turnIntoCSList([u.string(e.value.name)]),c=0;c<b.value.length;++c)a.index=k.real(c+1),n.push(r.create$3([b.value[c],d,e],a));
return g.turnIntoCSList(n)}if("string"!==b.value[0].ctype)return fa("Element of names list must be a string"),h;f=b.value[0].value}if("string"!==d.ctype)return fa("Type must be a string"),h;if("list"!==e.ctype)return fa("Arguments must be a list"),h;if(!l.hasOwnProperty(d.value)&&!Ab.hasOwnProperty(d.value)&&!Ec.hasOwnProperty(d.value))return fa("Invalid geometric operation: '"+d.value+"'"),h;b=[];var p=null;for(c=0;c<e.value.length;c++){var q=e.value[c];if("string"===q.ctype)b.push(q.value);else if("geo"===
q.ctype)b.push(q.value.name);else if(p=L(q),p===h)return fa("Unknown argument type"),h}e={name:f,type:d.value,labeled:!0};p&&(e.pos=p);0<b.length&&(e.args=b);for(n in a)e[n]=u.unwrap(a[n]);return{ctype:"geo",value:Oa(e,!0)}};r.create$2=function(a,c){function b(a){function c(a){t.csnames[a]||(b=a)}var b=!1,d;if("P"===a)for(d=0;26>d&!b;d++)8!==d&&9!==d&&c(String.fromCharCode(65+d));else if("L"===a||"S"===a)for(d=0;26>d&!b;d++)8!==d&&9!==d&&c(String.fromCharCode(97+d));for(d=0;!b;d++)c(a+d);return b}
var d=z(a[0]);a=z(a[1]);var e={};for(f in c)e[f]=B(c[f]);if(!l.hasOwnProperty(d.value)&&!Ab.hasOwnProperty(d.value)&&!Ec.hasOwnProperty(d.value))return fa("Invalid geometric operation: '"+d.value+"'"),h;for(;Ab.hasOwnProperty(d.value);)d.value=Ab[d.value];var f=l[d.value];c=u.string(b(f.kind));if(a.value.length>f.signature.length){var n="Operation "+d.value+" requieres only "+f.signature.length+" argument"+(1===f.signature.length?"":"s")+" ("+a.value.length+" argument"+(1===a.value.length?"":"s")+
" given) to create "+c.value+". Ignoring the last arguments.";if(!e.pos){var p=L(a.value[a.value.length-1]);p!==h&&(n+=" Use the last argument as modifier `pos`.",e.pos=p)}fa(n);a=g.turnIntoCSList(a.value.slice(0,f.signature.length))}f=r.create$3([c,d,a],e);if(f!==h&&"s"===f.value.kind[1]&&f.value.results){d=u.string("Select"+f.value.kind[0]);a=g.turnIntoCSList([u.string(f.value.name)]);if(e.pos)return c=u.string(b(f.value.kind[0])),r.create$3([c,d,a],e);n=[];for(p=0;p<f.value.results.value.length;p++)e.index=
k.real(p+1),c=u.string(b(f.value.kind[0])),n.push(r.create$3([c,d,a],e));return g.turnIntoCSList(n)}f.isDuplicate&&delete f.isDuplicate;return f};r.javascript$1=function(a,c){a=z(a[0]);"string"===a.ctype&&(new Function(a.value)).call(ua);return h};r.use$1=function(a,c){function b(a,c,b){r[a.toLowerCase()+"$"+c]=b}a=z(a[0]);if("string"===a.ctype){a=a.value;var d;p.plugins&&(d=p.plugins[a]);d||(d=xa._pluginRegistry[a]);if(d)return d({instance:ua,config:p,nada:h,evaluate:z,extractPoint:C.extractPoint,
evaluateAndVal:B,defineFunction:b,addShutdownHook:ib.push.bind(ib),addAutoCleaningEventListener:I,getVariable:J.getvar.bind(J),getInitialMatrix:function(){return y.drawingstate.initialmatrix},setTextRenderer:function(a,c){Oc=a;c&&(Gd=c)},getImage:function(a,c){"string"===typeof a&&(a=u.string(a));a=Na(a);if(!a)return null;!c&&a.cdyUpdate&&a.cdyUpdate();return a},getMyfunction:function(a){return eb.hasOwnProperty(a)?eb[a]:null}}),{ctype:"boolean",value:!0};fa("Plugin "+a+" not found");return{ctype:"boolean",
value:!1}}return h};r.format$2=function(a,c){function b(a){a=a.toFixed(e);do{var c=a;a=a.substring(0,a.length-1)}while(""!==a&&"-"!==a&&+a===+c);return""+c}function d(a){if("number"===a.ctype){var c=b(a.value.real);a=b(a.value.imag);c="0"===a?c:"-"===a.substring(0,1)?c+" - i*"+a.substring(1):c+" + i*"+a;return{ctype:"string",value:c}}return"list"===a.ctype?{ctype:"list",value:a.value.map(d)}:{ctype:"string",value:U(a).toString()}}c=B(a[0]);a=B(a[1]);if(("number"===c.ctype||"list"===c.ctype)&&"number"===
a.ctype){var e=Math.max(0,Math.min(20,Math.round(a.value.real)));return d(c)}return h};Date.now||(Date.now=function(){return(new Date).getTime()});var Ud=0;r.timestamp$0=function(a,c){return k.real(Date.now())};r.seconds$0=function(a,c){return k.real((Date.now()-Ud)/1E3)};r.resetclock$0=function(a,c){Ud=Date.now();return h};r.time$0=function(a,c){a=new Date;return g.realVector([a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()])};r.date$0=function(a,c){a=new Date;return g.realVector([a.getFullYear(),
a.getMonth()+1,a.getDate()])};r.simulationtime$0=function(a,c){return k.real(Jb*Rd)};r.settimeout$2=function(a,c){function b(){z(d);f()}c=z(a[0]);var d=a[1];"number"===c.ctype&&"undefined"!==typeof window&&window.setTimeout(b,1E3*c.value.real);return h};C.formatForWebGL=function(a){return a.toFixed(10)};r.generateWebGL$2=function(a,c){var b=C.formatForWebGL;c=a[0];a=z(a[1]);console.log(a);if("list"!==a.ctype)return h;for(var d=[],e=0;e<a.value.length;e++)"string"===a.value[e].ctype&&d.push(a.value[e].value);
console.log("***********");console.log(d);a=C.plotvars(c);console.log(a);-1===a.indexOf("a")&&-1===a.indexOf("b")&&-1===a.indexOf("c")&&-1===a.indexOf("d")&&-1===a.indexOf("e")&&-1===a.indexOf("f")&&(c=B(c));if("number"===c.ctype)return{ctype:"string",value:"vec2("+b(c.value.real)+","+b(c.value.imag)+")"};if("variable"===c.ctype)return{ctype:"string",value:c.name};if("string"===c.ctype||"void"===c.ctype)return c;if(2===c.args.length&&("infix"===c.ctype||"function"===c.ctype)){b=r.compileToWebGL$1([c.args[0]],
{});a=r.compileToWebGL$1([c.args[1]],{});if("+"===c.oper||"add"===c.oper)return void 0===b.value||"void"===b.ctype?{ctype:"string",value:a.value}:{ctype:"string",value:"addc("+b.value+","+a.value+")"};if("*"===c.oper||"mult"===c.oper)return{ctype:"string",value:"multc("+b.value+","+a.value+")"};if("/"===c.oper||"div"===c.oper)return{ctype:"string",value:"divc("+b.value+","+a.value+")"};if("-"===c.oper||"sub"===c.oper)return void 0===b.value||"void"===b.ctype?{ctype:"string",value:"negc("+a.value+
")"}:{ctype:"string",value:"subc("+b.value+","+a.value+")"};if("^"===c.oper||"pow"===c.oper)return{ctype:"string",value:"powc("+b.value+","+a.value+")"}}if("function"===c.ctype&&1===c.args.length){b=r.compileToWebGL$1([c.args[0]],{});if("sin$1"===c.oper)return{ctype:"string",value:"sinc("+b.value+")"};if("cos$1"===c.oper)return{ctype:"string",value:"cosc("+b.value+")"};if("tan$1"===c.oper)return{ctype:"string",value:"tanc("+b.value+")"};if("exp$1"===c.oper)return{ctype:"string",value:"expc("+b.value+
")"};if("log$1"===c.oper)return{ctype:"string",value:"logc("+b.value+")"};if("arctan$1"===c.oper)return{ctype:"string",value:"arctanc("+b.value+")"};if("arcsin$1"===c.oper)return{ctype:"string",value:"arcsinc("+b.value+")"};if("arccos$1"===c.oper)return{ctype:"string",value:"arccosc("+b.value+")"};if("sqrt$1"===c.oper)return{ctype:"string",value:"sqrtc("+b.value+")"}}return h};r.compileToWebGL$1=function(a,c){c=C.formatForWebGL;a=a[0];var b=C.plotvars(a);-1===b.indexOf("a")&&-1===b.indexOf("b")&&
-1===b.indexOf("c")&&-1===b.indexOf("d")&&-1===b.indexOf("e")&&-1===b.indexOf("f")&&(a=B(a));if("number"===a.ctype)return{ctype:"string",value:"vec2("+c(a.value.real)+","+c(a.value.imag)+")"};if("variable"===a.ctype)return{ctype:"string",value:a.name};if("string"===a.ctype||"void"===a.ctype)return a;if(2===a.args.length&&("infix"===a.ctype||"function"===a.ctype)){c=r.compileToWebGL$1([a.args[0]],{});b=r.compileToWebGL$1([a.args[1]],{});if("+"===a.oper||"add"===a.oper)return void 0===c.value||"void"===
c.ctype?{ctype:"string",value:b.value}:{ctype:"string",value:"addc("+c.value+","+b.value+")"};if("*"===a.oper||"mult"===a.oper)return{ctype:"string",value:"multc("+c.value+","+b.value+")"};if("/"===a.oper||"div"===a.oper)return{ctype:"string",value:"divc("+c.value+","+b.value+")"};if("-"===a.oper||"sub"===a.oper)return void 0===c.value||"void"===c.ctype?{ctype:"string",value:"negc("+b.value+")"}:{ctype:"string",value:"subc("+c.value+","+b.value+")"};if("^"===a.oper||"pow"===a.oper)return{ctype:"string",
value:"powc("+c.value+","+b.value+")"}}if("function"===a.ctype&&1===a.args.length){c=r.compileToWebGL$1([a.args[0]],{});if("sin$1"===a.oper)return{ctype:"string",value:"sinc("+c.value+")"};if("cos$1"===a.oper)return{ctype:"string",value:"cosc("+c.value+")"};if("tan$1"===a.oper)return{ctype:"string",value:"tanc("+c.value+")"};if("exp$1"===a.oper)return{ctype:"string",value:"expc("+c.value+")"};if("log$1"===a.oper)return{ctype:"string",value:"logc("+c.value+")"};if("arctan$1"===a.oper)return{ctype:"string",
value:"arctanc("+c.value+")"};if("arcsin$1"===a.oper)return{ctype:"string",value:"arcsinc("+c.value+")"};if("arccos$1"===a.oper)return{ctype:"string$1",value:"arccosc("+c.value+")"};if("sqrt$1"===a.oper)return{ctype:"string",value:"sqrtc("+c.value+")"}}return h};r.setsimulationspeed$1=function(a,c){a=B(a[0]);"number"===a.ctype&&Ba(a.value.real);return h};r.setsimulationaccuracy$1=function(a,c){a=B(a[0]);"number"===a.ctype&&"undefined"!==typeof Q&&"undefined"!==typeof Q.env&&(Q.env.accuracy=Math.max(1,
a.value.real|0));return h};r.setsimulationquality$1=function(a,c){a=B(a[0]);"number"===a.ctype&&"undefined"!==typeof Q&&"undefined"!==typeof Q.env&&(a=a.value.real,0===a&&(Q.env.errorbound=.01,Q.env.lowestdeltat=1E-5,Q.env.slowdownfactor=2),1===a&&(Q.env.errorbound=.001,Q.env.lowestdeltat=1E-7,Q.env.slowdownfactor=2),2===a&&(Q.env.errorbound=1E-5,Q.env.lowestdeltat=1E-10,Q.env.slowdownfactor=4),3===a&&(Q.env.errorbound=1E-6,Q.env.lowestdeltat=1E-12,Q.env.slowdownfactor=4));return h};var gc=null,pc=
null;r.createtool$3=function(a,c){var b="left",d="top",e=null;if(c.space){var g=z(c.space);"number"===g.ctype&&(e=g.value.real/2)}var f=null;c.toolbar&&(g=z(c.toolbar),"string"===g.ctype&&((f=document.getElementById(g.value))||console.warn("Element #"+g.value+" not found")));if(!f){if(c.reference&&(g=z(c.reference),"string"===g.ctype))switch(g.value){case "UR":b="right";break;case "LL":d="bottom";break;case "LR":b="right",d="bottom"}f=document.createElement("div");f.className="CindyJS-toolbar";qa.parentNode.appendChild(f);
g=z(a[1]);var k=z(a[2]);"number"===g.ctype&&(f.style[b]=g.value.real+"px");"number"===k.ctype&&(f.style[d]=k.value.real+"px");null!==e&&(f.style.margin=-e+"px")}a=z(a[0]);if("string"===a.ctype)a=[[a.value]];else if("list"===a.ctype)a=a.value.map(function(a){return"string"===a.ctype?[a.value]:"list"===a.ctype?a.value.map(function(a){return"string"===a.ctype?a.value:null}):[null]});else return fa("Name must be a string or a list of strings"),h;if(c.flipped&&(g=z(c.flipped),"boolean"===g.ctype&&g.value)){fa("Flipping");
var l=0;c=a.length;a.forEach(function(a){a.length>l&&(l=a.length)});g=[];for(k=0;k<l;++k){g[k]=[];for(var n=0;n<c;++n)g[k][n]=a[n][k]||null}a=g}"bottom"===d&&a.reverse();a.forEach(function(a){"right"===b&&a.reverse();var c=document.createElement("div");f.appendChild(c);a.forEach(function(a){function b(){gc&&gc.classList.remove("CindyJS-active");gc=m;m.classList.add("CindyJS-active");Bc=a;var c=G[Bc].actions;pc&&(pc.textContent=c[0].tooltip||"");Da=[];yb=$a=0}G.hasOwnProperty(a)||(fa("Tool '"+a+"' not implemented yet."),
a=null);if(null===a){var d=document.createElement("span");d.className="CindyJS-spacer";c.appendChild(d)}else{var m=document.createElement("button");d=document.createElement("img");d.src=xa.getBaseDir()+"images/"+a+".png";m.appendChild(d);m.addEventListener("click",b);gc||b();null!==e&&(m.style.margin=e+"px");c.appendChild(m)}})});return h};r.dropped$0=function(){return uc};r.droppoint$0=function(){return vc};r.parsecsv$1=function(a,c){var b=!0,d=B(c.autoconvert);"boolean"===d.ctype&&(b=d.value);d=
null;c=B(c.delimiter);"string"===c.ctype&&/^[^"\r\n]$/.test(c.value)&&(d=c.value);a=B(a[0]);if("string"!==a.ctype)return fa("CSV data is not a string"),h;a=a.value;c='(?:"((?:[^"]+|"")*)"|([^]*?))(\r\n|(,)|[\r\n]|$)';d&&(d=d.replace(/[^A-Za-z0-9]/g,"\\$&").replace(/\$/g,"$$$$"),c=c.replace(/,/g,d));c=new RegExp(c,"g");d=[];for(var e=[],f=null;c.lastIndex<a.length;){var l=c.exec(a),n=l[2];"string"===typeof l[1]&&(n=l[1].replace(/""/g,'"'));n=b?/^[Tt]rue$/.test(n)?u.bool(!0):/^[Ff]alse$/.test(n)?u.bool(!1):
/^[\-+]?([0-9]+(\.[0-9]*)?|\.[0-9]+|Infinity)$/.test(n)?k.real(Number(n)):u.string(n):u.string(n);d.push(n);l[4]&&c.lastIndex===a.length&&(d.push(u.string("")),l={});if(!l[4]){null===f&&(f=d.length);if(f<d.length)for(f=d.length,l=0;l<e.length;++l)for(n=e[l].length;n<f;++n)e[l][n]=h;else if(f>d.length)for(l=d.length;l<f;++l)d[l]=h;e.push(d);d=[]}}return g.turnIntoCSList(e.map(g.turnIntoCSList))};r.load$2=function(a,c){return r.load$3([a[0],null,a[1]],c)};r.load$3=function(a,c){function b(){if(g.readyState===
XMLHttpRequest.DONE){if(200===g.status)var c=u.string(String(g.responseText));else fa("Failed to load "+e+": "+g.statusText),c=h;J.newvar(d);J.setvar(d,c);z(a[2]);J.removevar(d);f()}}var d="#";null!==a[1]&&"variable"===a[1].ctype&&(d=a[1].name);c=B(a[0]);var e=null,g=null;"string"===c.ctype&&/^https?:\/\//.test(c.value)&&(e=c.value);return null!==e?(g=new XMLHttpRequest,g.onreadystatechange=b,g.open("GET",e),g.send(),u.bool(!0)):h};r.removeelement$1=function(a,c){a=z(a[0]);"geo"===a.ctype?bc(a.value.name):
console.log("argument of removeelement is undefined or not of type <geo>")};C.extractPoint=function(a){var c={ok:!1};if("geo"===a.ctype){var b=a.value;if("P"===b.kind)return c.x=va.getField(b,"x").value.real,c.y=va.getField(b,"y").value.real,c.ok=!0,c}if("list"!==a.ctype)return c;var d=a.value;if(2===d.length&&(a=d[0],b=d[1],"number"===a.ctype&&"number"===b.ctype))return c.x=a.value.real,c.y=b.value.real,c.ok=!0,c;3===d.length&&(a=d[0],b=d[1],d=d[2],"number"===a.ctype&&"number"===b.ctype&&"number"===
d.ctype&&(a=k.div(a,d),b=k.div(b,d),c.x=a.value.real,c.y=b.value.real,c.ok=!0));return c};r.draw$1=function(a,c){a=B(a[0]);if("shape"===a.ctype)C.drawshape(a,c);else if("Line"===a.usage)x.handleModifs(c,x.lineModifs),x.drawline(a);else{var b=C.extractPoint(a);if(!b.ok){if("undefined"!==typeof a.value&&2===a.value.length)return r.draw$2(a.value,c);return}null!==c&&x.handleModifs(c,x.pointModifs);x.drawpoint(b)}return h};r.draw$2=function(a,c){var b=B(a[0]);a=B(a[1]);b=C.extractPoint(b);a=C.extractPoint(a);
if(!b.ok||!a.ok)return h;null!==c&&x.handleModifs(c,x.lineModifs);x.drawsegcore(b,a);return h};r.drawcircle$2=function(a,c){return C.drawcircle(a,c,"D")};C.arcHelper=function(a){var c={};c.startPoint=L(a[0]);c.viaPoint=L(a[1]);c.endPoint=L(a[2]);return c};r.fillcircle$2=function(a,c){return C.drawcircle(a,c,"F")};r.drawarc$3=function(a,c){a=C.arcHelper(a);return C.drawarc(a,c,"D")};r.fillarc$3=function(a,c){a=C.arcHelper(a);return C.drawarc(a,c,"F")};C.drawarc=function(a,c,b){var d=a.startPoint,m=
a.viaPoint;a=a.endPoint;if(!g._helper.isAlmostReal(g.turnIntoCSList([d,m,a])))return h;x.handleModifs(c,x.conicModifs);x.preDrawCurve();c=g.det3(d,m,a);if(1E-12<Math.abs(c.value.real)){c=l._helper.ConicBy5(null,d,m,a,g.ii,g.jj);var e=l._helper.CenterOfConic(c);e=g.normalizeMax(e);c=k.real(0);var f=g.turnIntoCSList([g.turnIntoCSList([e.value[2],c,k.neg(e.value[0])]),g.turnIntoCSList([c,e.value[2],k.neg(e.value[1])]),g.turnIntoCSList([c,c,e.value[2]])]);c=g.normalizeZ(u.mult(f,d));g.normalizeZ(u.mult(f,
m));f=g.normalizeZ(u.mult(f,a));c=-Math.atan2(c.value[1].value.real,c.value[0].value.real);f=-Math.atan2(f.value[1].value.real,f.value[0].value.real);e=g.normalizeZ(e);d=g.normalizeZ(d);m=g.normalizeZ(m);a=g.normalizeZ(a);var n=g.abs(g.sub(d,e)),p=[e.value[0].value.real,e.value[1].value.real];e=y.drawingstate.matrix;var q=p[0]*e.a-p[1]*e.b+e.tx;p=p[0]*e.c-p[1]*e.d-e.ty;d=0<g.det3(d,m,a).value.real;A.save();A.beginPath();A.translate(q,p);A.arc(0,0,n.value.real*e.sdet,c,f,d);"F"===b&&(A.fillStyle=x.lineColor,
A.closePath(),A.fill());"D"===b&&A.stroke();A.restore()}else{if("D"!==b)return h;b=C.extractPoint(d);c=C.extractPoint(m);f=C.extractPoint(a);if(!b.ok||!c.ok||!f.ok)return h;n=(b.x-f.x)*(b.x-f.x)+(b.y-f.y)*(b.y-f.y);e=(f.x-c.x)*(f.x-c.x)+(f.y-c.y)*(f.y-c.y);if(1E-12>(b.x-c.x)*(b.x-c.x)+(b.y-c.y)*(b.y-c.y)||1E-12>n||1E-12>e)return h;0>g.crossratio3(d,a,m,g.cross(g.cross(d,m),g.linfty),g.ii).value.real?x.drawsegcore(b,f):x.drawRaySegment(d,a)}return h};C.drawcircle=function(a,c,b){var d=B(a[0]);a=B(a[1]);
var m=C.extractPoint(d);if(!m.ok||"number"!==a.ctype||!k._helper.isAlmostReal(a))return h;d=y.drawingstate.matrix;var e=m.x*d.a-m.y*d.b+d.tx;m=m.x*d.c-m.y*d.d-d.ty;x.handleModifs(c,x.conicModifs);x.preDrawCurve();A.lineJoin="miter";A.beginPath();A.arc(e,m,Math.abs(a.value.real)*d.sdet,0,2*Math.PI);A.closePath();"D"===b&&A.stroke();"F"===b&&(A.fillStyle=x.lineColor,A.fill());"C"===b&&A.clip();return h};r.drawconic$1=function(a,c){a=B(a[0]);if("list"!==a.ctype||3!==a.value.length&&6!==a.value.length)return console.error("could not parse conic"),
h;if(6===a.value.length){for(var b=0;6>b;b++)if("number"!==a.value[b].ctype)return console.error("could not parse conic"),h;var d=k.real(.5);b=a.value[0];var e=a.value[2];e=k.mult(e,d);var f=a.value[1],l=a.value[3];l=k.mult(l,d);var n=a.value[4];n=k.mult(n,d);a=a.value[5];a=g.turnIntoCSList([g.turnIntoCSList([b,e,l]),g.turnIntoCSList([e,f,n]),g.turnIntoCSList([l,n,a])])}else{if(!g.isNumberMatrix(a).value||3!==a.value.length||3!==a.value[0].value.length)return h;b=g.transpose(a);g.equals(a,b).value||
(a=g.add(b,a))}return C.drawconic(a,c)};C.drawconic=function(a,c){function b(a,c){a=(l*a+n*c+p)*a+(q*c+t)*c+r;return 0<=a?1:0>a?-1:NaN}function d(a){L.next=a;a.prev=L;return L=a}function e(a,c,d,m){return{a:a,b1:c,b2:d,vertical:!0,index:m,sign:function(c){return b(a,c)},mkp:function(c){return{x:a,y:c}},sol:Kb(q,n*a+t,(l*a+p)*a+r),discr:function(){return Kb(C,-2*w,u)},tpt:function(a){return{x:a,y:-.5*(n*a+t)/q}}}}function f(a,c,d,m){return{a:a,b1:c,b2:d,vertical:!1,index:m,sign:function(c){return b(c,
a)},mkp:function(c){return{x:c,y:a}},sol:Kb(l,n*a+p,(q*a+t)*a+r),discr:function(){return Kb(C,-2*B,z)},tpt:function(a){return{x:-.5*(n*a+p)/l,y:a}}}}function k(a){var c=Math.min(a.b1,a.b2),b=Math.max(a.b1,a.b2),m=a.sign(c),e=a.sign(b);if(!isFinite(m*e))return!1;var g=a.sol;if(m!==e){if(null===g)return!1;var f=.5*(g[0]+g[1]);f>c&&f<b?(c=a.sign(f),f=g[c===e?0:1]):(m=.5*(c+b),f=g[Math.abs(m-g[0])<Math.abs(m-g[1])?0:1]);J.push(d(a.mkp(f)))}else{if(null===g){if(0>=E)return!0;g=a.discr();if(null===g)return!0;
a=a.tpt(g[a.index]);a.x>=G&&a.x<=I&&a.y>=H&&a.y<=N&&d(a);return!0}f=.5*(g[0]+g[1]);if(!(f>c&&f<b))return!0;c=a.sign(f);if(c===m||isNaN(c))return!0;a.b1>a.b2&&(g=[g[1],g[0]]);J.push(d(a.mkp(g[0])));J.push(d(a.mkp(g[1])))}return!0}function h(a,c,b,d,m){var e=c-d,g=b-a,f=a*d-c*b,k=w*e+B*g+C*f;if(1E-14>Math.abs(k))return A.lineTo(b,d);var D=(u*e+v*g+w*f)/k;e=(v*e+z*g+B*f)/k;if(!isFinite(D)||!isFinite(e)||.04>Math.abs(a*e+D*d+b*c-b*e-D*c-a*d))return A.lineTo(b,d);do if(!(10<m)){f=.5*(a+b);g=.5*(c+d);var F=
D-f;k=e-g;if(!(.04>F*F+k*k)){var P=l*F*F+n*F*k+q*k*k,M=2*l*F*f+n*(F*g+k*f)+2*q*k*g+p*F+t*k,Ua=(l*f+n*g+p)*f+(q*g+t)*g+r,Ma=Kb(P,M,Ua);Ma||(Ma=[-.5*M/P,-2*Ua/M]);if(0<Ma[0])Ma=Ma[0];else if(0<=Ma[1])Ma=Ma[1];else break;F=f+Ma*F;k=g+Ma*k;f=F-.5*(D+f);g=k-.5*(e+g);if(!(.04>f*f+g*g)){h(a,c,F,k,m+1);h(F,k,b,d,m+1);return}}}while(0);A.quadraticCurveTo(D,e,b,d)}x.handleModifs(c,x.conicModifs);if(0!==x.lsize&&(x.preDrawCurve(),a=g.normalizeMax(a),g._helper.isAlmostReal(a))){c=y.toMat();a=g.mult(g.transpose(c),
a);a=g.mult(a,c);a=g.normalizeMax(a);var l=a.value[0].value[0].value.real,n=2*a.value[0].value[1].value.real,p=2*a.value[0].value[2].value.real,q=a.value[1].value[1].value.real,t=2*a.value[1].value[2].value.real,r=a.value[2].value[2].value.real,u=4*r*q-t*t,v=t*p-2*r*n,w=t*n-2*q*p,z=4*r*l-p*p,B=p*n-2*t*l,C=4*q*l-n*n,E=C;a=q*z+n*v+l*u-r*C;0>a&&(l=-l,n=-n,p=-p,q=-q,t=-t,r=-r,a=-a);a=x.lsize;var G=-a,H=-a,I=ca+a,N=da+a,J=[],L=a={};if(k(e(G,H,N,0))&&k(f(N,G,I,1))&&k(e(I,N,H,1))&&k(f(H,I,G,0))&&L!==a){L.next=
a.next;a.next.prev=L;A.beginPath();if(0===J.length){var K=L;A.moveTo(K.x,K.y);do{var Q=K.next;h(K.x,K.y,Q.x,Q.y,0);K=Q}while(K!==L);A.closePath()}c=1===b(G,H)?0:1;if(4===J.length){var O=0;for(a=0;2>a;++a){K=J[a];Q=J[a+2];var R=Q.x-K.x;K=Q.y-K.y;K=(l*R+n*K)*R+q*K*K;Math.abs(K)>Math.abs(O)&&(O=K)}if(isNaN(O))return;0<=O&&(c=1-c)}for(a=c;a<J.length;a+=2)for(K=J[a],c=J[(a+1)%J.length],A.moveTo(K.x,K.y),Q=K.next;K!==c;Q=(K=Q).next)h(K.x,K.y,Q.x,Q.y,0);A.stroke()}}};r.drawall$1=function(a,c){a=z(a[0]);
if("list"===a.ctype)for(x.handleModifs(c,x.pointAndLineModifs),c=0;c<a.value.length;c++)r.draw$1([a.value[c]],null);return h};r.connect$1=function(a,c){return C.drawpolygon(a,c,"D",!1)};r.drawpoly$1=function(a,c){return C.drawpolygon(a,c,"D",!0)};r.fillpoly$1=function(a,c){return C.drawpolygon(a,c,"F",!0)};r.drawpolygon$1=function(a,c){return C.drawpolygon(a,c,"D",!0)};r.fillpolygon$1=function(a,c){return C.drawpolygon(a,c,"F",!0)};C.drawpolygon=function(a,c,b,d){function m(){for(var a=f.value,c=
0;c<a.length;c++){var b=a[c],d;for(d=0;d<b.length;d++){var m=b[d],e=m.X*g.a-m.Y*g.b+g.tx;m=m.X*g.c-m.Y*g.d-g.ty;0===d?A.moveTo(e,m):A.lineTo(e,m)}A.closePath()}}function e(){var a;for(a=0;a<f.value.length;a++){var c=C.extractPoint(f.value[a]);if(!c.ok)return;var b=c.x*g.a-c.y*g.b+g.tx;c=c.x*g.c-c.y*g.d-g.ty;0===a?A.moveTo(b,c):A.lineTo(b,c)}d&&A.closePath()}x.handleModifs(c,x.conicModifs);x.preDrawCurve();var g=y.drawingstate.matrix,f=z(a[0]);A.beginPath();"list"===f.ctype&&e();"shape"===f.ctype&&
m();"D"===b&&(x.fillColor&&(A.fillStyle=x.fillColor,A.fill(x.fillrule)),A.stroke());"F"===b&&(A.fillStyle=x.lineColor,A.fill(x.fillrule));"C"===b&&A.clip();return h};var Oc=md,Gd=function(a,c,b){if(-1!==c.indexOf("\n"))for(c=c.split("\n"),a.textContent=c[0],b=1;b<c.length;++b)a.appendChild(document.createElement("br")),a.appendChild(document.createTextNode(c[b]));else a.textContent=c};C.drawtext=function(a,c,b){var d=B(a[0]);a=z(a[1]);var m=C.extractPoint(d);if(!m.ok)return null;x.handleModifs(c,
x.textModifs);c=y.drawingstate.textsize;null===c&&(c=ha.textsize);null!==x.size&&(c=x.size);A.fillStyle=x.textColor;var e=y.drawingstate.matrix;d=m.x*e.a-m.y*e.b+e.tx+x.xOffset;m=m.x*e.c-m.y*e.d-e.ty-x.yOffset;a=U(a);xa._pluginRegistry.katex||"string"!==typeof a||3<=a.split("$").length&&ra("katex","katex-plugin.js",!0);e=x.bold+x.italics+Math.round(10*c)/10+"px "+x.family;A.font=e;return b?b(a,e,d,m,x.align,c):Oc(A,a,d,m,x.align,c,c*ha.lineHeight)};r.drawtext$2=function(a,c){C.drawtext(a,c,null);
return h};r.drawtable$2=function(a,c){var b=B(a[0]);a=B(a[1]);var d=C.extractPoint(b);if(!d.ok||"list"!==a.ctype)return h;b=a.value;a=b.length;var e=-1,f;for(f=0;f<a;++f)"list"===b[f].ctype&&b[f].value.length>e&&(e=b[f].value.length);-1===e?(b=b.map(function(a){return[a]}),e=1):b=b.map(function(a){return g.asList(a).value});var k=100,l=null,n=!0,p=y.drawingstate.textcolor;x.handleModifs(c,{size:!0,color:function(a){g._helper.isNumberVecN(a,3)&&(p=x.makeColor([a.value[0].value.real,a.value[1].value.real,
a.value[2].value.real]))},alpha:!0,bold:!0,italics:!0,family:!0,align:!0,x_offset:!0,y_offset:!0,offset:!0,width:function(a){"number"===a.ctype&&(k=a.value.real)},height:function(a){"number"===a.ctype&&(l=a.value.real)},border:function(a){"boolean"===a.ctype&&(n=a.value)}});f=y.drawingstate.textsize;null===f&&(f=ha.textsize);null!==x.size&&(f=x.size);null===l&&(l=1.6*f);A.font=x.bold+x.italics+Math.round(10*f)/10+"px "+x.family;f=y.drawingstate.matrix;var q=e*k,t=a*l;c=d.x*f.a-d.y*f.b+f.tx+x.xOffset;
var r=d.x*f.c-d.y*f.d-f.ty-x.yOffset-t;if(n){x.preDrawCurve();A.strokeStyle=x.lineColor;A.beginPath();for(f=1;f<a;++f)A.moveTo(c,r+f*l),A.lineTo(c+q,r+f*l);for(d=1;d<e;++d)A.moveTo(c+d*k,r),A.lineTo(c+d*k,r+t);A.stroke();A.lineWidth=x.lsize+1;A.beginPath();A.rect(c,r,q,t);A.stroke()}c+=x.align*k+(1-2*x.align)*l*.3;r+=.7*l;A.fillStyle=p;for(f=0;f<a;++f)for(d=0;d<e;++d)q=U(b[f][d]),Oc(A,q,c+d*k,r+f*l,x.align);return h};C.drawshape=function(a,c){return"polygon"===a.type?C.drawpolygon([a],c,"D",1):"circle"===
a.type?C.drawcircle([a.value.value[0],a.value.value[1]],c,"D"):h};C.fillshape=function(a,c){return"polygon"===a.type?C.drawpolygon([a],c,"F",1):"circle"===a.type?C.drawcircle([a.value.value[0],a.value.value[1]],c,"F"):h};C.clipshape=function(a,c){return"polygon"===a.type?C.drawpolygon([a],c,"C",1):"circle"===a.type?C.drawcircle([a.value.value[0],a.value.value[1]],c,"C"):h};r.fill$1=function(a,c){a=z(a[0]);return"shape"===a.ctype?C.fillshape(a,c):h};r.clip$1=function(a,c){var b=z(a[0]);return"shape"===
b.ctype?C.clipshape(b,c):"list"===b.ctype?(a=r.polygon$1(a,[]),r.clip$1([a],[])):h};r.plot$1=function(a,c){return r.plot$2([a[0],null],c)};r.plot$2=function(a,c){function b(a){return"number"===a.ctype&&k._helper.isAlmostReal(a)}function d(a,c,b,d,m){n++;c=+c.value.real;m=+d.value.real;d=c*B.a-m*B.b+B.tx;c=c*B.c-m*B.d-B.ty;a=+a.value.real;m=+b.value.real;b=a*B.a-m*B.b+B.tx;a=a*B.c-m*B.d-B.ty;p?(A.lineTo(b,a),A.lineTo(d,c)):(A.beginPath(),A.moveTo(b,a),A.lineTo(d,c),p=!0)}function e(a,c,m,g,h){var D=
b(m),n=b(g);if(.001>h)!f&&p&&(A.stroke(),p=!1);else if(D||n){var F=k.real((a.value.real+c.value.real)/2);J.setvar(w,F);var P=z(v),q=b(P);if(D&&n&&q){var t=m.value.real;n=P.value.real;q=g.value.real;if(D=1>Math.abs(t+q-2*n)/l){var r=k.real((a.value.real+F.value.real)/2);J.setvar(w,r);r=z(v);var M=k.real((F.value.real+c.value.real)/2);J.setvar(w,M);M=z(v);t=Math.abs(t+n-2*r.value.real)/l;n=Math.abs(n+q-2*M.value.real)/l;D=D&&1>t&&1>n}D?(d(a,F,m,P,h/2),d(F,c,P,g,h/2)):(e(a,F,m,P,h/2),e(F,c,P,g,h/2))}else e(a,
F,m,P,h/2),e(F,c,P,g,h/2)}}var f=!1,l=.2/Vb,n=0,p=!1,q=-10,t=10,r=.1,u=1E3,v=a[0];if(null!==a[1]&&"variable"===a[1].ctype)var w=a[1].name;else a=C.plotvars(v),w="#",-1!==a.indexOf("t")&&(w="t"),-1!==a.indexOf("z")&&(w="z"),-1!==a.indexOf("y")&&(w="y"),-1!==a.indexOf("x")&&(w="x");J.newvar(w);var B=y.drawingstate.matrix;x.handleModifs(c,{color:!0,alpha:!0,size:!0,dashpattern:!0,dashtype:!0,dashing:!0,lineCap:!0,lineJoin:!0,miterLimit:!0,connect:function(a){"boolean"===a.ctype&&(f=a.value)},start:function(a){"number"===
a.ctype&&(q=a.value.real)},stop:function(a){"number"===a.ctype&&(t=a.value.real)},steps:function(a){"number"===a.ctype&&(u=a.value.real)}});A.strokeStyle=x.lineColor;A.lineWidth=x.lsize;p=!1;c=k.real(14.32);J.setvar(w,c);var E=z(v);if("number"!==E.ctype){if(g.isNumberVector(E).value&&2===E.value.length){p=!1;r=(t-q)/u;for(c=q;c<t;c+=r){J.setvar(w,k.real(c));var G=z(v);if(g.isNumberVector(G).value&&2===G.value.length){var H=+G.value[0].value.real;G=+G.value[1].value.real;a=H*B.a-G*B.b+B.tx;H=H*B.c-
G*B.d-B.ty;p?A.lineTo(a,H):(A.beginPath(),A.moveTo(a,H),p=!0)}}A.stroke();J.removevar(w)}return h}for(a=q;a<t+r;a+=r)c=k.real(a),J.setvar(w,c),E=z(v),c.value.real>q&&e(H,c,G,E,r),H=c,G=E;J.removevar(w);p&&A.stroke();return h};r.plotX$1=function(a,c){a=a[0];var b=C.plotvars(a);c="#";-1!==b.indexOf("t")&&(c="t");-1!==b.indexOf("z")&&(c="z");-1!==b.indexOf("y")&&(c="y");-1!==b.indexOf("x")&&(c="x");J.newvar(c);b=y.drawingstate.matrix;A.fillStyle=y.drawingstate.linecolor;A.lineWidth=1;A.lineCap=x.lineCap;
A.lineJoin=x.lineJoin;A.miterLimit=x.miterLimit;for(var d=!1,e=-10;10>e;e+=.01){J.setvar(c,k.real(e));var g=z(a);if("number"===g.ctype){var f=+g.value.real;g=e*b.a-f*b.b+b.tx;f=e*b.c-f*b.d-b.ty;d?A.lineTo(g,f):(A.beginPath(),A.moveTo(g,f),d=!0)}}A.stroke();J.removevar(c);return h};C.plotvars=function(a){function c(a,c){var b={},d;for(d=a.length-1;0<=d;--d)b[a[d]]=a[d];for(d=c.length-1;0<=d;--d)b[c[d]]=c[d];a=[];for(var m in b)b.hasOwnProperty(m)&&a.push(b[m]);return a}function b(a,c){for(var b=0;b<
a.length;b++)a[b]===c&&(a.splice(b,1),b--);return a}var d;if("variable"===a.ctype)return[a.name];if("infix"===a.ctype){var e=C.plotvars(a.args[0]);a=C.plotvars(a.args[1]);return c(e,a)}if("list"===a.ctype){var g=a.value;var f=[];for(d=0;d<g.length;d++)e=C.plotvars(g[d]),f=c(f,e);return f}if("function"===a.ctype){g=a.args;f=[];for(d=0;d<g.length;d++)e=C.plotvars(g[d]),f=c(f,e);"apply"!==a.oper&&"select"!==a.oper&&"forall"!==a.oper&&"sum"!==a.oper&&"product"!==a.oper&&"repeat"!==a.oper&&"min"!==a.oper&&
"max"!==a.oper&&"sort"!==a.oper||"variable"!==a.args[1].ctype||(f=b(f,a.args[1].name));return f}return[]};r.clrscr$0=function(a,c){"undefined"!==typeof ca&&"undefined"!==typeof da&&A.clearRect(0,0,ca,da);return h};r.repaint$0=function(a,c){f();return h};r.screenbounds$0=function(a,c){a=u.withUsage(g.realVector(y.to(0,0)),"Point");c=u.withUsage(g.realVector(y.to(ca,0)),"Point");var b=u.withUsage(g.realVector(y.to(ca,da)),"Point"),d=u.withUsage(g.realVector(y.to(0,da)),"Point");return g.turnIntoCSList([a,
c,b,d])};r.createimage$3=function(a,c){c=z(a[0]);var b=B(a[1]);a=B(a[2]);if("number"!==b.ctype||"number"!==a.ctype||"string"!==c.ctype)return h;var d=document.createElement("canvas");d.id=c.value;d.width=b.value.real;d.height=a.value.real;d.style.display="none";document.body.appendChild(d);cb[c.value]=la(d,!1);return h};r.clearimage$1=function(a,c){a=z(a[0]);if("string"!==a.ctype&&"image"!==a.ctype)return h;a=Na(a);if(!a)return h;c=a.img;if("undefined"===typeof c||null===c)return h;var b=a.width,
d=a.height;c.getContext("2d").clearRect(0,0,b,d);a.generation++;return h};r.canvas$4=function(a,c){var b=B(a[0]),d=B(a[1]);c=z(a[2]);a=a[3];var e=C.extractPoint(b),g=C.extractPoint(d);if(!e.ok||!g.ok||"string"!==c.ctype&&"image"!==c.ctype)return h;c=Na(c);if(!c||!c.img.getContext)return h;d=c.img;var f=c.width;b=c.height;var k=g.x-e.x,l=g.y-e.y,n=e.x-l*b/f,p=e.y+k*b/f;l=g.x-l*b/f;k=g.y+k*b/f;g=y.from(e.x,e.y,1);n=y.from(n,p,1);l=y.from(l,k,1);e=g[0];p=g[1];k=n[0];var q=n[1],t=l[0],r=l[1];n=f*(p-q)/
((e-k)*(p-r)-(e-t)*(p-q));f=f*(e-k)/((p-q)*(e-t)-(p-r)*(e-k));l=-n*e-f*p;g=(b*(p-r)-b*(p-q))/((e-k)*(p-r)-(e-t)*(p-q));k=(b*(e-t)-b*(e-k))/((p-q)*(e-t)-(p-r)*(e-k));b=b-g*e-k*p;d=d.getContext("2d");e=A;A=d;A.save();A.transform(n,g,f,k,l,b);c.generation++;z(a);A.restore();A=e};r.canvas$5=function(a,c){var b=B(a[0]),d=B(a[1]),e=B(a[2]);c=z(a[3]);a=a[4];b=C.extractPoint(b);var g=C.extractPoint(d),f=C.extractPoint(e);if(!b.ok||!g.ok||!f.ok||"string"!==c.ctype&&"image"!==c.ctype)return h;c=Na(c);if(!c||
!c.img.getContext)return h;e=c.img;var k=c.width;d=c.height;var l=y.from(b.x,b.y,1),n=y.from(g.x,g.y,1);g=y.from(f.x,f.y,1);b=l[0];f=l[1];var p=n[0],q=n[1],t=g[0],r=g[1];g=((0-k)*(f-r)-0*(f-q))/((b-p)*(f-r)-(b-t)*(f-q));k=((0-k)*(b-t)-0*(b-p))/((f-q)*(b-t)-(f-r)*(b-p));n=-(g*b)-k*f;l=((d-d)*(f-r)-(d-0)*(f-q))/((b-p)*(f-r)-(b-t)*(f-q));p=((d-d)*(b-t)-(d-0)*(b-p))/((f-q)*(b-t)-(f-r)*(b-p));d=d-l*b-p*f;e=e.getContext("2d");b=A;A=e;A.save();A.transform(g,l,k,p,n,d);c.generation++;z(a);A.restore();A=b};
r.screenresolution$0=function(a,c){return k.real(y.drawingstate.matrix.a)};r.layer$1=function(a,c){};r.imagesize$1=function(a,c){return(a=Na(B(a[0])))?g.realVector([+a.width,+a.height]):h};r.imageready$1=function(a,c){a=Na(B(a[0]));return u.bool(!(!a||!a.ready))};r.drawimage$2=function(a,c){function b(){var a=1,b=1,d=1,m=1,k=0,l=1,D=C.extractPoint(e);if(!D.ok)return h;f=Na(f);if(!f)return h;A.save();if(void 0!==c.angle){var n=z(c.angle);"number"===n.ctype&&(k=n.value.real)}void 0!==c.rotation&&(n=
z(c.rotation),"number"===n.ctype&&(k=n.value.real));void 0!==c.scale&&(n=B(c.scale),"number"===n.ctype&&(b=a=n.value.real),g.isNumberVector(n).value&&2===n.value.length&&(a=n.value[0].value.real,b=n.value[1].value.real));void 0!==c.scalex&&(n=z(c.scalex),"number"===n.ctype&&(a=n.value.real));void 0!==c.scaley&&(n=z(c.scaley),"number"===n.ctype&&(b=n.value.real));void 0!==c.flipx&&(n=z(c.flipx),"boolean"===n.ctype&&n.value&&(d=-1));void 0!==c.flipy&&(n=z(c.flipy),"boolean"===n.ctype&&n.value&&(m=-1));
void 0!==c.alpha&&(n=z(c.alpha),"number"===n.ctype&&(l=n.value.real));A.imageSmoothingEnabled=!0;void 0!==c.interpolate&&(n=z(c.interpolate),"boolean"===n.ctype&&(A.imageSmoothingEnabled=n.value));var p=y.drawingstate.matrix,P=y.drawingstate.initialmatrix,F=f.width,q=f.height;n=D.x*p.a-D.y*p.b+p.tx;var t=D.x*p.c-D.y*p.d-p.ty,r=(D.x+1)*p.a-D.y*p.b+p.tx-n;p=(D.x+1)*p.c-D.y*p.d-p.ty-t;var u=(D.x+1)*P.a-D.y*P.b+P.tx-(D.x*P.a-D.y*P.b+P.tx);P=(D.x+1)*P.c-D.y*P.d-P.ty-(D.x*P.c-D.y*P.d-P.ty);D=Math.sqrt(r*
r+p*p)/Math.sqrt(u*u+P*P);r=-Math.atan2(r,p)+Math.atan2(u,P);p=y.drawingstate.matrix.sdet/72;a*=p;b*=p;1!==l&&(A.globalAlpha=l);A.translate(n,t);A.scale(a*d*D,b*m*D);A.rotate(k+r);A.translate(-n,-t);A.translate(-F/2,-q/2);a=f;a.drawTo?a.drawTo(A,n,t):A.drawImage(a.img,n,t);A.globalAlpha=1;A.restore()}function d(){var a=1,b=1,d=1,m=1,g=C.extractPoint(e),D=C.extractPoint(k);if(!g.ok||!D.ok)return h;f=Na(f);if(!f)return h;var n=f.width,p=f.height;if(0===l){var P={};P.x=g.x-(D.y-g.y);P.y=g.y+(D.x-g.x);
m=p/n}else if(P=C.extractPoint(l),!g.ok)return h;A.save();if(void 0!==c.alpha){var F=z(c.alpha);"number"===F.ctype&&(a=F.value.real)}void 0!==c.aspect&&(F=z(c.aspect),"number"===F.ctype&&(m=F.value.real));void 0!==c.flipx&&(F=z(c.flipx),"boolean"===F.ctype&&F.value&&(b=-1));void 0!==c.flipy&&(F=z(c.flipy),"boolean"===F.ctype&&F.value&&(d=-1));A.imageSmoothingEnabled=!0;void 0!==c.interpolate&&(F=z(c.interpolate),"boolean"===F.ctype&&(A.imageSmoothingEnabled=F.value));F=y.drawingstate.matrix;1!==a&&
(A.globalAlpha=a);a=g.x*F.a-g.y*F.b+F.tx;g=g.x*F.c-g.y*F.d-F.ty;A.transform(D.x*F.a-D.y*F.b+F.tx-a,D.x*F.c-D.y*F.d-F.ty-g,P.x*F.a-P.y*F.b+F.tx-a,P.x*F.c-P.y*F.d-F.ty-g,a,g);A.scale(1/n,-1/p*m);A.translate(n/2,-p/2);A.scale(b,d);A.translate(-n/2,p/2);A.translate(0,-p);b=f;b.drawTo?b.drawTo(A,0,0):A.drawImage(b.img,0,0);A.globalAlpha=1;A.restore()}if(2===a.length){var e=B(a[0]);var f=B(a[1]);return b()}if(3===a.length){e=B(a[0]);var k=B(a[1]);var l=0;f=B(a[2]);return d()}return 4===a.length?(e=B(a[0]),
k=B(a[1]),l=B(a[2]),f=B(a[3]),d()):h};r.drawimage$3=r.drawimage$2;r.drawimage$4=r.drawimage$2;r.allimages$0=function(){var a=[];Object.keys(cb).forEach(function(c){a.push({ctype:"string",value:c})});return g.turnIntoCSList(a)};r.cameravideo$0=function(a,c){function b(a){return{video:{width:a,advanced:[{width:{max:a,min:a}},{width:{ideal:a}}]},audio:!1}}a=!0;var d={};void 0!==c.resolution&&(c=z(c.resolution),"string"===c.ctype&&"maximal"===c.value?a=!0:"number"===c.ctype?(a=!1,d=b(c.value.real)):g._helper.isNumberVecN(c,
2)&&(a=!1,d=b(c.value[0].value.real),c=c.value[1].value.real,10>c||!Number.isInteger(c)?(d.video.aspectRatio=c,d.video.advanced[0].aspectRatio={min:c,max:c},d.video.advanced[1].aspectRatio={ideal:c}):(d.video.height=c,d.video.advanced[0].height={min:c,max:c},d.video.advanced[1].height={ideal:c})));a&&(d=[320,640,1024,1280,1920,2560],d=d.map(function(a){return{width:{min:a}}}),d={video:{width:16E3,height:9E3,advanced:d},audio:!1});a=null;var e=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia;
e?a=function(a,c){navigator.mediaDevices.getUserMedia(d).then(a,c)}:(e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)&&(a=function(a,c){e.call(navigator,d,a,c)});if(!a)return console.warn("getUserMedia call not supported"),h;var f=document.createElement("video");f.autoplay=!0;c=la(f,!0);console.log("Opening stream.");a(function(a){f.srcObject=a;f.setAttribute("autoplay","");f.setAttribute("muted","");f.setAttribute("playsinline","");f.play();
f.addEventListener("loadeddata",Aa)},function(a){console.error("Could not get user video:",String(a),a)});return c};r.playvideo$1=function(a,c){a=Na(B(a[0]));a.live&&a.img.play&&a.img.play();return h};r.pausevideo$1=function(a,c){a=Na(B(a[0]));a.live&&a.img.pause&&a.img.pause();return h};var Lb;r.imagergba$3=function(a,c){c=Na(B(a[0]));var b=B(a[1]);a=B(a[2]);if(!c||"number"!==b.ctype||"number"!==a.ctype||!c.ready)return h;b=Math.round(b.value.real);a=Math.round(a.value.real);if(!La(b)||!La(a))return h;
a=pb(c,b,a,1,1);return g.realVector([255*a[0],255*a[1],255*a[2],a[3]])};r.imagergb$3=r.imagergba$3;r.imagergba$4=function(a,c){var b=Na(B(a[2]));if(!b||!b.ready)return h;var d=b.width,e=b.height,f=L(a[0]),k=L(a[1]),l=L(g.realVector([0,e,1]));d=L(g.realVector([d,e,1]));if(f===h||k===h||n===h)return h;n=g.ii;e=g.jj;l=C.basismap(l,d,n,e);f=C.basismap(f,k,e,n);var n=L(a[3]);e=C.extractPoint(u.mult(l,u.mult(g.adjoint3(f),n)));if(e.ok)if(a=b.width,f=b.height,k=!0,l=!1,void 0!==c.interpolate&&(n=z(c.interpolate),
"boolean"===n.ctype&&(k=n.value)),void 0!==c.repeat&&(n=z(c.repeat),"boolean"===n.ctype&&(l=n.value)),k&&(e.x-=.5,e.y-=.5),l&&(e.x=(e.x%a+a)%a,e.y=(e.y%f+f)%f),n=Math.floor(e.x),d=Math.floor(e.y),La(n)&&La(d)){c=[0,0,0,0];if(k){k=e.x-n;e=e.y-d;var p=pb(b,n,d,2,2);if(l){if(n===a-1||d===f-1){l=pb(b,(n+1)%a,d,1,1);var q=pb(b,n,(d+1)%f,1,1);b=pb(b,(n+1)%a,(d+1)%f,1,1);p=p.slice(0,4).concat(l,q,b)}}else{if(-1===n||n===a-1)k=Math.round(k);if(-1===d||d===f-1)e=Math.round(e)}for(b=0;4>b;b++)c[b]=(1-e)*((1-
k)*p[b]+k*p[b+4])+e*((1-k)*p[b+8]+k*p[b+12])}else c=pb(b,n,d,1,1);b=g.realVector(c)}else b=h;else b=h;return b};r.imagergb$4=function(a,c){a=r.imagergba$4(a,c);return a===h?h:g.turnIntoCSList(a.value.slice(0,3))};r.readpixels$1=function(a,c){a=Na(B(a[0]));a=pb(a,0,0,a.width,a.height);c=[];for(var b=0;b+3<a.length;b+=4)c.push(g.turnIntoCSList([k.real(a[b+0]),k.real(a[b+1]),k.real(a[b+2]),k.real(a[b+3])]));return g.turnIntoCSList(c)};"use strict";var De=[{key:[":"],field:["."],deg:["\u00b0"],take:["_"]},
{functionCall:!0},{rassoc:!0,pow:["^"],sqrt:["\u221a"]},{mul:["*","\u2062","\u22c5","\u00b7"],cross:["\u00d7"],div:["/","\u00f7","\u2215","\u2236"]},{add:["+"],sub:["-","\u2212"],neg:["!","\u00ac"]},{seq:[".."]},{eq:["==","\u225f"],ne:["!=","<>","\u2260"],lt:["<"],gt:[">"],le:["<=","\u2264","\u2266"],ge:[">=","\u2265","\u2267"],aeq:["~=","\u2248"],ane:["~!=","\u2249"],alt:["~<","\u2a89"],agt:["~>","\u2a8a"],ale:["~<=","\u2a85"],age:["~>=","\u2a86"],"in":["\u2208"],nin:["\u2209"]},{and:["&","\u2227"],
or:["%","\u2228"]},{rassoc:!0,prepend:["<:"]},{concat:["++","\u222a"],remove:["--","\u2216"],common:["~~","\u2229"],append:[":>"]},{rassoc:!0,assign:["="],define:[":="],undefine:[":=_"],bdefine:["::="]},{seq:[";"]},{modif:["->","\u2192"]},{rassoc:!0,list:[","]}],Ee=["+","-"],Fe=["!","\u221a"],Ge=["\u00b0",":=_"],He=[";",","],Pc=[],Ga={},rd;(function(){var a=0;De.forEach(function(c){a+=2;var b=!!c.rassoc;c.functionCall&&(rd=a);for(var d in c){var e=c[d];if("boolean"!==typeof e)for(var g={name:d,sym:e[0],
symbols:e,rassoc:b,precedence:a,prefix:!1,postfix:!1,infix:!0,bare:!1},f=0;f<e.length;++f){var k=e[f];if(Ga.hasOwnProperty(k))throw Error("Duplicate operator: "+k);Ga[k]=g;Pc.push(k)}}});Ee.forEach(function(a){Ga[a].prefix=!0});Fe.forEach(function(a){Ga[a].prefix=!0;Ga[a].infix=!1});Ge.forEach(function(a){Ga[a].postfix=!0;Ga[a].infix=!1});He.forEach(function(a){Ga[a].prefix=!0;Ga[a].postfix=!0;Ga[a].infix=!0;Ga[a].bare=!0})})();Pc.sort(function(a,c){return c.length-a.length});var Ie="(?:[0-9](?: [0-9])*(?: \\.(?! \\.)(?: [0-9])*)?|\\.(?: [0-9])+)(?: [Ee](?: [+-])?(?: [0-9])+)?".replace(/ /g,
"[ \t]*"),Je="(?:[\u207a\u207b] )?[\u2070\u00b9\u00b2\u00b3\u2074\u2075\u2076\u2077\u2078\u2079](?: [\u2070\u00b9\u00b2\u00b3\u2074\u2075\u2076\u2077\u2078\u2079])*".replace(/ /g,"[ \t]*"),Ke="(?:[\u208a\u208b] )?[\u2080\u2081\u2082\u2083\u2084\u2085\u2086\u2087\u2088\u2089](?: [\u2080\u2081\u2082\u2083\u2084\u2085\u2086\u2087\u2088\u2089])*".replace(/ /g,"[ \t]*"),Qc=function(a,c,b){var d,e=0,m="(?:[",g=c.length;for(d=0;d<g;++d){var f=c.charCodeAt(d);55296<=f?(m+="]|"+c.charAt(d)+"[",e=56320):(m+=
String.fromCharCode(f=e=a[f-32]+e),e+=a[c.charCodeAt(++d)-32],e!==f&&(e!==f+1&&(m+="-"),m+=String.fromCharCode(e)))}return m+"]|["+b+"][\udc00-\udfff])"}([2,0,106,3,4,1,6,5,7,11,17,8,12,21,9,22,30,10,15,24,25,16,13,42,46,14,18,19,29,37,27,28,35,26,32,36,40,43,47,53,20,48,50,56,33,34,39,51,52,55,63,64,65,68,85,23,31,38,45,49,105,59,66,69,72,88,102,114,117,128,157,191,41,44,54,60,67,70,71,73,74,75,76,80,81,82,83,84,86,87,89,93,94,98,99,107,108,116,122,130,132,134,138,160,165,185,195,196,255,268,277,
310,332,339,362,365,390,449,457,470,512,513,541,568,582,619,673,726,768,820,921,991,1164,2684,6581,8453,11171,20949],"T4(4I!)!'!&/ 0 \u0096')2$+! !\u0083$ %## !(!   ! ; u \u0086.\u0088 =#!+YoA& 87C% } !5%+%) #!*! <0a,!4B1%'!&-'!1!$!33`HsG$!;!+.52'(#%#- & !$#$!*!9%  2%H''%#- & % % %B# !H *+   - & % $$!;!5%3!,(#%#- & % $$!X%  5!:! '$  #$% ! %$%$ $)W!G(   / 2$!> &%C(   / . $$!L! %5%;(   D#!*!* 4'&*$W + !#&]F %6&]% !#% !#!(# &   ! !#% # %1!#$ !/#L!S( @?$\u00817-!*''#$!$%+ ',6!:= !&!#7 \u0090 ##& ! ##D ##B ##& ! ##9 K ##^Y2*V#'$\u009d#5 4&p((+, #2*2*2,  5OC!'!Uy.D !&_)0J<#$,E'4Q/1Pv!|8:&K<9%)E>@7 )@\u0080# #$%1gT\u008e#'#=#'#( ! ! ! 0#P & !$  &$##'',&  &d!9!*,b!'!#. !$$(! ! ! # 1##&$'!G%\u00a58 8 \u0084(#$%6= !&!#Q+!*/1& & & & & & & &t!\u0097%E$&%'V(  z #&D${:Aj2\u0099\u00a6q\u00a9E\u00a4UZ#\u008d$2)%-8*0#_J+#b#M#(S1   # /0O2[R'$! !6>)/A?+8<!*$ .)$ D3  (-/$!$[ !$%#$#! !4 #1+ 6'#'#'1& & 7 .)c0\u00a86/'I\u00a7\u0093#\\N&6$&! . , $ ! % % \u007fM\u0092;R#Gh)d$ \u0085=4(4,a$'#'#'# \ud800!) 4 : % 9#6@\u0082\u0094?$IIX*5 ((=)<#@'(\ud801!f~N.Of\u008f1-)(\ud802!'#! E %$!#/)/10^: %)-)4nQ(%T!5#   AZ?$?C( >?G)-):9*\ud803!`KJ9J\ud804#PriL3>@7M$!6F2#/! !C* 3V& ! # 9 .+8N(#%#- & % $$!;!6$\ud805eF-% !\u008987#=F-!k7x4\ud806\u0087RB!\u0095K\ud808!\u00a2\ud809e\u008a\ud80d!8\ud811!\u009c\ud81a!\u009b+0c<;F*#BH&:\ud81b\u00a0U,!l,\ud82c!%\ud82f!\"&,$++.\ud835!w m %#!#%## ) ! & S ##( & > # $ !$& \u0091#3 3 0 3 0 3 0 3 0 3 (\ud83a!\u008b\ud83b\u0098# A % !#! . # ! !(!'! ! !   % !#! ! ! ! ! % !## & # # ! . 5&  $ 5\ud869!\u009f7\u008c\ud86d!\u00a1,g\ud86e!<#\u00a3\ud873!\u009e\ud87e!\u009a",
"\ud80c\ud840-\ud868\ud86a-\ud86c\ud86f-\ud872"),Le=("#(?: [1-9])?|(?:'|"+Qc+")(?: (?:[0-9']|"+Qc+"))*").replace(/ /g,"[ \t]*"),od=["([ \t\n]+)|(//.*)|(/\\*)","("+Ie+")","("+Pc.map(nd).join("|")+")","("+"[](){}||".split("").map(nd).join("|")+")","("+Ke+")","("+Je+")","("+Le+")",'("[^"]*")|($)'].join("|"),Me=new RegExp("[ \t]*".replace(/\*$/,"+"),"g"),Rc="ANY WS COMMENT START_COMMENT NUM OP BRA SUB SUP ID STR EOF".split(" ");(function(){var a=(new RegExp(od,"g")).exec("");if(a.hasOwnProperty(Rc.length))throw Error("RE has more groups than expected");
if(!a.hasOwnProperty(Rc.length-1))throw Error("RE has fewer groups than expected");})();qb.prototype.advanceBy=function(a){this.advanceTo(this.pos+a)};qb.prototype.advanceTo=function(a){for(this.pos=a;this.bols[0]<=a;)this.bol=this.bols.shift(),this.line++};qb.prototype.curPos=function(){return{row:this.line,col:this.pos-this.bol,pos:this.pos}};qb.prototype.nextInternal=function(){var a=this.re.exec(this.input);if(a.index!==this.pos)throw ma("Invalid token",this.curPos(),this.input.substring(this.pos,
a.index));var c=this.curPos();this.advanceBy(a[0].length);var b=this.curPos(),d;for(d=1;null==a[d];++d);return{start:c,end:b,raw:a[0],text:a[0].replace(Me,""),toktype:Rc[d]}};qb.prototype.next=function(){do{var a=this.nextInternal();if("START_COMMENT"===a.toktype){var c=/\*\/|\/\*/g;c.lastIndex=a.start.pos+2;for(var b=1,d;0<b;)if(d=c.exec(this.input))"/*"===d[0]?++b:--b;else throw ma("Unterminated comment",a.start,a.text);this.re.lastIndex=c.lastIndex;this.advanceTo(c.lastIndex);a.end=this.curPos();
a.raw=this.input.substring(a.start.pos,a.end.pos);a.text=a.raw;a.toktype="COMMENT"}}while("WS"===a.toktype||"COMMENT"===a.toktype);return a};var Ne={ctype:"void"};Mb.prototype.postprocess=function(a){if(null===a)return Ne;if(a){if("infix"===a.ctype)if(":="===a.oper){var c=a.args[0];if("function"===c.ctype)c.args.forEach(function(c){if(null===c||"variable"!==c.ctype)throw ma("Function argument must be an identifier",c.start||a.start);});else if("variable"!==c.ctype)throw ma(a.oper+" can only be used to define functions or variables",
a.start);}else if(","===a.oper)throw ma("comma may only be used to delimit list elements",a.start);a.args&&(a.args=a.args.map(this.postprocess,this));if(a.modifs)for(var b in a.modifs)a.modifs[b]=this.postprocess(a.modifs[b]);if("paren"===a.ctype)return a.args[0];if("infix"===a.ctype){if("."===a.oper){if(!a.args[1]||"variable"!==a.args[1].ctype)throw ma("Field name must be identifier",a.start,a.text);a.ctype="field";a.obj=a.args[0];a.key=a.args[1].name;delete a.args}if(":"===a.oper){if(!a.args[1])throw ma("Data key undefined",
a.start,a.text);a.ctype="userdata";a.obj=a.args[0];a.key=a.args[1];delete a.args}this.infixmap&&(a.impl=this.infixmap[a.oper])}else"variable"===a.ctype?this.usedVariables[a.name]=!0:"function"===a.ctype&&(this.usedFunctions[a.oper]=!0)}if("infix"===a.ctype)return{ctype:"infix",oper:String(a.oper),args:[a.args[0],a.args[1]],impl:a.impl};if("variable"===a.ctype)return{ctype:"variable",name:String(a.name)};if("number"===a.ctype)return{ctype:"number",value:{real:+a.value.real,imag:+a.value.imag}};if("string"===
a.ctype)return{ctype:"string",value:String(a.value)};if("list"===a.ctype)return{ctype:"list",value:a.value};if("function"===a.ctype)return{ctype:"function",oper:String(a.oper),args:a.args,modifs:a.modifs};if("field"===a.ctype)return{ctype:"field",obj:a.obj,key:String(a.key)};if("userdata"===a.ctype)return{ctype:"userdata",obj:a.obj,key:a.key};throw Error("Unsupported AST node of type "+a.ctype);};Mb.prototype.parse=function(a){try{var c=qd(new qb(a));if("EOF"!==c.closedBy.toktype)throw ma("Closing bracket never opened.",
c.closedBy.start,c.closedBy.text);return this.postprocess(c.expr)}catch(m){return m.ctype="error",m}};"undefined"!==typeof process&&"undefined"!==typeof module&&"undefined"!==typeof module.exports&&"undefined"===typeof window&&(module.exports.Parser=Mb,module.exports.Tokenizer=qb,module.exports.unicodeLetters=Qc,module.exports.parse=function(a){return(new Mb).parse(a)});var hb={},Nb=[];var Vd=[0,0,0,0,0,0,0,0,0,0,0,0];r.playsin$1=function(a,c){var b=B(a[0]);a=0;"number"===b.ctype&&(void 0!==c.line&&
(c=z(c.line),"number"===c.ctype&&(a=Math.floor(c.value.real),0>a&&(a=0),10<a&&(a=10))),c=b.value.real,0!==Vd[a]&&Vd[a].set({freq:c}));return h};var R={printArr:function(a){for(var c=a.value.length,b=[],d=[],e=!1,g=0;g<c;g++)b[g]=a.value[g].value.real,d[g]=a.value[g].value.imag,0!==d[g]&&(e=!0);console.log(b);e&&console.log(d)},zero:function(a){for(var c=[],b=k.real(0),d=0;d<a.value.real;d++)c[d]=b;return g.turnIntoCSList(c)},number:function(a,c){c=R.zero(c);c.value[0]=a;return c},variable:function(a,
c){c=R.zero(c);c.value[0]=a;c.value[1]=k.real(1);return c},add:function(a,c){return g.add(a,c)},sub:function(a,c){return g.sub(a,c)},mult:function(a,c){if(a.value.length!==c.value.length)return console.error("dims don't fit return nada"),h;for(var b=a.value.length,d=R.zero(k.real(b)),e=k.real(0),g=0;g<b;g++){for(var f=0;f<=g;f++)e=k.add(e,k.mult(a.value[f],c.value[g-f]));d.value[g]=e;e=k.real(0)}return d},pow:function(a,c){if(0>c.value.real||c.value.real!==Math.floor(c.value.real))return R.root(a,
c);for(var b=a,d=1;d<c.value.real;d++)b=R.mult(b,a);return b},root:function(a,c){var b=k.real(0),d=k.real(1),e=k.add(d,c),g=a.value.length,f=R.zero(k.real(g));f.value[0]=k.pow(a.value[0],c);var h=b;for(c=1;c<g;c++){var l=k.real(c);for(var n=1;n<=c;n++){var p=k.mult(e,k.real(n));p=k.div(p,l);p=k.sub(p,d);p=k.mult(p,a.value[n]);p=k.mult(p,f.value[c-n]);h=k.add(h,p)}h=k.div(h,a.value[0]);f.value[c]=h;h=b}return f},findFirstNoneZero:function(a,c,b){for(var d=Infinity,e=Infinity,m=b;m<a.value.length;m++)if(1E-12<
k.abs2(a.value[m]).value.real){d=m;break}for(a=b;a<c.value.length;a++)if(1E-12<k.abs2(c.value[a]).value.real){e=a;break}return[d,e]},div:function(a,c){if(a.value.length!==c.value.length)return console.log("dims don't fit - return nada"),h;for(var b=a.value.length,d=k.real(0),e=R.zero(k.real(b)),g=d,f,l=0;l<b;l++){f=R.findFirstNoneZero(a,c,l);l<f[0]&&f[0]===f[1]&&Infinity!==f[0]&&(a.value.splice(l,f[0]),c.value.splice(l,f[0]),e.value.splice(l,f[0]),b-=f[0]);f=a.value[l];for(var n=0;n<l;n++)g=k.add(g,
k.mult(e.value[n],c.value[l-n]));f=k.sub(f,g);f=k.div(f,c.value[0]);e.value[l]=f;g=d}return e},exp:function(a){var c=k.real(0),b=a.value.length,d=R.zero(k.real(b)),e=c;d.value[0]=k.exp(a.value[0]);for(var g=1;g<b;g++){for(var f=1;f<=g;f++){var h=k.mult(k.real(f),a.value[f]);h=k.mult(h,d.value[g-f]);e=k.add(e,h)}d.value[g]=k.div(e,k.real(g));e=c}return d},log:function(a){var c=k.real(0),b=a.value.length,d=R.zero(k.real(b));d.value[0]=k.log(a.value[0]);for(var e=c,g,f,h=1;h<b;h++){g=a.value[h];for(var l=
1;l<h;l++)f=k.mult(k.real(l),d.value[l]),f=k.mult(f,a.value[h-l]),e=k.add(e,f);e=k.div(e,k.real(h));g=k.sub(g,e);g=k.div(g,a.value[0]);d.value[h]=g;e=c}return d},sincos:function(a){var c=k.real(0),b=a.value.length,d=R.zero(k.real(b)),e=R.zero(k.real(b));d.value[0]=k.sin(a.value[0]);e.value[0]=k.cos(a.value[0]);for(var g=c,f=c,h,l,n,p=1;p<b;p++){n=k.real(p);for(var q=1;q<=p;q++)l=k.mult(k.real(q),a.value[q]),h=k.mult(l,e.value[p-q]),l=k.mult(l,d.value[p-q]),f=k.add(f,h),g=k.add(g,l);f=k.div(f,n);g=
k.div(g,k.neg(n));d.value[p]=f;e.value[p]=g;g=f=c}R.sinsave=d;R.cossave=e;return[d,e]},sin:function(a){return R.sincos(a)[0]},cos:function(a){return R.sincos(a)[1]},faculty:function(a){var c=[];c[0]=k.real(1);for(var b=1,d=1;d<=a.value.real;d++)b*=d,c[d]=k.real(b);return c=g.turnIntoCSList(c)},diff:function(a,c,b,d){if("variable"===a.ctype)var e=a.name!==c?R.number(z(a),d):R.variable(b,d);else if("number"===a.ctype)e=R.number(a,d);else{if("infix"===a.ctype){if("*"===a.oper)return R.mult(R.diff(a.args[0],
c,b,d),R.diff(a.args[1],c,b,d));if("^"===a.oper)return R.pow(R.diff(a.args[0],c,b,d),R.diff(a.args[1],c,b,d).value[0]);if("/"===a.oper)return R.div(R.diff(a.args[0],c,b,d),R.diff(a.args[1],c,b,d));if("+"===a.oper)return R.add(R.diff(a.args[0],c,b,d),R.diff(a.args[1],c,b,d));if("-"===a.oper)return R.sub(R.diff(a.args[0],c,b,d),R.diff(a.args[1],c,b,d));console.log("infix not found",a.oper);return h}if("function"===a.ctype){if("exp$1"===a.oper)return R.exp(R.diff(a.args[0],c,b,d));if("log$1"===a.oper)return R.log(R.diff(a.args[0],
c,b,d));if("sin$1"===a.oper)return R.sin(R.diff(a.args[0],c,b,d));if("cos$1"===a.oper)return R.cos(R.diff(a.args[0],c,b,d))}else return console.log("ctype not found",a.ctype),h}return e},adevaluate:function(a,c,b,d){a=R.diff(a,c,b,d);d=R.faculty(d);for(c=2;c<a.value.length;c++)a.value[c]=k.mult(a.value[c],d.value[c]);return a},autodiff:function(a,c,b,d){for(var e=[],m=b.value.length,f,k=0;k<m;k++)f=R.adevaluate(a,c,b.value[k],d),e[k]=f;return e=g.turnIntoCSList(e)}},x={handleModifs:function(a,c){x.dashing&&
x.unSetDash();x.colorraw=null;x.fillcolorraw=null;x.fillrule="nonzero";x.size=null;0>=x.psize&&(x.psize=0);0>=x.lsize&&(x.lsize=0);x.overhang=1;x.dashing=!1;x.isArrow=!1;x.arrowSides="==>";x.arrowposition=1;x.headlen=10;x.arrowShape=x.arrowShapes.line;x.alpha=y.drawingstate.alpha;x.fillalpha=0;x.bold="";x.italics="";x.family="sans-serif";x.align=0;x.xOffset=0;x.yOffset=0;x.lineCap="round";x.lineJoin="round";x.miterLimit=10;x.noborder=!1;var b,d;for(b in a){var e=a[b];e&&((d=c[b])?(!0===d&&(d=x.modifHandlers[b]),
d(z(e))):console.log("Modifier not supported: "+b))}null!==x.size?x.psize=x.lsize=x.size:(x.psize=y.drawingstate.pointsize,x.lsize=y.drawingstate.linesize);x.dashing&&x.dashing(x.lsize);null!==x.colorraw?x.pointColor=x.lineColor=x.textColor=x.makeColor(x.colorraw):1===x.alpha?(x.pointColor=y.drawingstate.pointcolor,x.lineColor=y.drawingstate.linecolor,x.textColor=y.drawingstate.textcolor):(x.pointColor=x.makeColor(y.drawingstate.pointcolorraw),x.lineColor=x.makeColor(y.drawingstate.linecolorraw),
x.textColor=x.makeColor(y.drawingstate.textcolorraw));x.black=1===x.alpha?"rgb(0,0,0)":"rgba(0,0,0,"+x.alpha+")";x.fillColor=x.fillcolorraw&&0<x.fillalpha?x.makeColor(x.fillcolorraw,x.fillalpha):null},modifHandlers:{size:function(a){"number"===a.ctype&&(x.size=a.value.real,0>x.size&&(x.size=0),1E3<x.size&&(x.size=1E3))},color:function(a){g.isNumberVector(a).value&&3===a.value.length&&(x.colorraw=[a.value[0].value.real,a.value[1].value.real,a.value[2].value.real])},fillcolor:function(a){g.isNumberVector(a).value&&
3===a.value.length&&(x.fillcolorraw=[a.value[0].value.real,a.value[1].value.real,a.value[2].value.real])},alpha:function(a){"number"===a.ctype&&(x.alpha=a.value.real)},fillalpha:function(a){"number"===a.ctype&&(x.fillalpha=a.value.real)},dashpattern:function(a){if("list"===a.ctype){for(var c=[],b=0,d=0;b<a.value.length;b++)"number"===a.value[b].ctype&&(c[d++]=a.value[b].value.real);x.dashing=x.setDash.bind(null,c)}},dashtype:function(a){if("number"===a.ctype)a=Math.floor(a.value.real);else if("string"===
a.ctype)a=a.value;else return;if(a=x.dashTypes[a])x.dashing=x.setDash.bind(null,a)},dashing:function(a){"number"===a.ctype&&(a=Math.floor(a.value.real),x.dashing=x.setDash.bind(null,[2*a,a]))},overhang:function(a){"number"===a.ctype&&(x.overhang=x.overhang*a.value.real+(1-x.overhang)*(1-a.value.real))},arrow:function(a){"boolean"===a.ctype?x.isArrow=a.value:console.error("arrow needs to be of type boolean")},arrowshape:function(a){"string"!==a.ctype?console.error("arrowshape needs to be of type string"):
x.arrowShapes.hasOwnProperty(a.value)?(x.arrowShape=x.arrowShapes[a.value],x.isArrow=!0,x.arrowShape.deprecated&&(console.log("arrowshape "+a.value+" is deprecated, use "+x.arrowShape.deprecated+" instead."),x.arrowShape.deprecated=null)):(a=Object.keys(x.arrowShapes),a.sort(),a=a.join(", "),console.error("arrowshape needs to be one of "+a))},arrowsides:function(a){"string"!==a.ctype?console.error("arrowsides is not of type string"):"==>"!==a.value&&"<==>"!==a.value&&"<=="!==a.value?console.error("arrowsides is unknows"):
(x.arrowSides=a.value,x.isArrow=!0)},arrowposition:function(a){"number"!==a.ctype?console.error("arrowposition is not of type number"):0>a.value.real?console.error("arrowposition has to be positive"):1<a.value.real?x.overhang=x.overhang*a.value.real+(1-x.overhang)*(1-a.value.real):(x.arrowposition=a.value.real,x.isArrow=!0)},arrowsize:function(a){"number"!==a.ctype?console.error("arrowsize is not of type number"):0>a.value.real?console.error("arrowsize has to be positive"):x.headlen*=a.value.real},
bold:function(a){"boolean"===a.ctype&&a.value&&(x.bold="bold ")},italics:function(a){"boolean"===a.ctype&&a.value&&(x.italics="italic ")},family:function(a){"string"===a.ctype&&(x.family=a.value)},align:function(a){"string"===a.ctype&&(a=a.value,"left"===a&&(x.align=0),"right"===a&&(x.align=1),"mid"===a||"center"===a)&&(x.align=.5)},x_offset:function(a){"number"===a.ctype&&(x.xOffset=a.value.real)},y_offset:function(a){"number"===a.ctype&&(x.yOffset=a.value.real)},offset:function(a){"list"===a.ctype&&
2===a.value.length&&"number"===a.value[0].ctype&&"number"===a.value[1].ctype&&(x.xOffset=a.value[0].value.real,x.yOffset=a.value[1].value.real)},lineCap:function(a){"string"!==a.ctype||"round"!==a.value&&"square"!==a.value&&"butt"!==a.value||(x.lineCap=a.value)},lineJoin:function(a){"string"!==a.ctype||"round"!==a.value&&"bevel"!==a.value&&"miter"!==a.value||(x.lineJoin=a.value)},fillrule:function(a){"string"!==a.ctype||"nonzero"!==a.value&&"evenodd"!==a.value||(x.fillrule=a.value)},miterLimit:function(a){"number"===
a.ctype&&0<a.value.real&&(x.miterLimit=Math.round(a.value.real))},noborder:function(a){"boolean"===a.ctype?x.noborder=a.value:console.error("noborder needs to be of type boolean")},border:function(a){"boolean"===a.ctype?x.noborder=!a.value:console.error("border needs to be of type boolean")}},lineModifs:{size:!0,color:!0,alpha:!0,dashpattern:!0,dashtype:!0,dashing:!0,overhang:!0,arrow:!0,arrowshape:!0,arrowsides:!0,arrowposition:!0,arrowsize:!0,lineCap:!0,lineJoin:!0,miterLimit:!0},pointModifs:{size:!0,
color:!0,alpha:!0,noborder:!0,border:!0}};x.pointAndLineModifs=x.lineModifs;x.conicModifs={size:!0,color:!0,alpha:!0,fillcolor:!0,fillrule:!0,fillalpha:!0,lineCap:!0,lineJoin:!0,miterLimit:!0};x.textModifs={size:!0,color:!0,alpha:!0,bold:!0,italics:!0,family:!0,align:!0,x_offset:!0,y_offset:!0,offset:!0};x.makeColor=function(a,c){void 0===c&&(c=x.alpha);return"rgba("+Math.floor(255*a[0])+","+Math.floor(255*a[1])+","+Math.floor(255*a[2])+","+c+")"};x.preDrawCurve=function(){A.lineWidth=x.lsize;A.lineCap=
x.lineCap;A.lineJoin=x.lineJoin;A.mozFillRule=x.fillrule;A.fillrule=x.fillrule;A.miterLimit=x.miterLimit;A.strokeStyle=x.lineColor};x.arrowShapes={"default":{close:!1,fill:!1,ratio:1,deprecated:"line"},line:{close:!1,fill:!1,ratio:1},empty:{close:!0,fill:!1,ratio:1},hollow:{close:!0,fill:!1,ratio:1,deprecated:"empty"},full:{close:!0,fill:!0,ratio:1},jet:{close:!0,fill:!0,ratio:1.5},delta:{close:!0,fill:!0,ratio:1.5,deprecated:"jet"}};x.clipSegment=function(a,c){var b=c.x-a.x,d=c.y-a.y,e=x.clipLineCore(-d,
b,a.x*c.y-c.x*a.y);if(2!==e.length)return[];var g=e[0];e=e[1];var f=1/(b*b+d*d),k=((g.x-a.x)*b+(g.y-a.y)*d)*f;b=((e.x-a.x)*b+(e.y-a.y)*d)*f;0>k&&(g=a);1<k&&(g=c);0>b&&(e=a);1<b&&(e=c);return g===e?[]:[g,e]};x.drawsegcore=function(a,c){function b(a,c,b,d){var e=a-d*n+.5*p,m=c-d*p-.5*n,g=a-d*n-.5*p;d=c-d*p+.5*n;A.beginPath();x.arrowShape.fill&&(A.lineWidth=x.lsize/2);A.moveTo(e,m);A.lineTo(a,c);A.lineTo(g,d);x.arrowShape.close&&(A.fillStyle=x.lineColor,A.lineTo(a-b*n,c-b*p),A.closePath(),x.arrowShape.fill&&
A.fill());A.stroke()}var d=y.drawingstate.matrix,e=a.x*d.a-a.y*d.b+d.tx,g=a.x*d.c-a.y*d.d-d.ty,f=c.x*d.a-c.y*d.b+d.tx,k=c.x*d.c-c.y*d.d-d.ty,h=x.overhang,l=1-h;c=h*e+l*f;d=h*g+l*k;a=h*f+l*e;h=h*k+l*g;if(0>c||c>ca||0>d||d>da||0>a||a>ca||0>h||h>da){h=x.clipSegment({x:c,y:d},{x:a,y:h});if(2!==h.length||.01>x.lsize)return;c=h[0].x;d=h[0].y;a=h[1].x;h=h[1].y}x.preDrawCurve();if(!x.isArrow||e===g&&f===k).01>x.lsize||(A.beginPath(),A.moveTo(c,d),A.lineTo(a,h),A.stroke());else{e=f-e;g=k-g;f=x.headlen/Math.sqrt(e*
e+g*g);var n=e*f,p=g*f;k=x.arrowposition;l=1-k;e=k*c+l*a;g=k*d+l*h;f=k*a+l*c;k=k*h+l*d;l=x.arrowSides;A.beginPath();x.arrowShape.close?("<==>"===l||"<=="===l?(1>x.arrowposition&&(A.moveTo(c,d),A.lineTo(e,g)),A.moveTo(e+n,g+p)):A.moveTo(c,d),"==>"===l||"<==>"===l?(A.lineTo(f-n,k-p),1>x.arrowposition&&(A.moveTo(f,k),A.lineTo(a,h))):A.lineTo(a,h)):(A.moveTo(c,d),A.lineTo(a,h));A.stroke();"==>"!==l&&"<==>"!==l||b(f,k,1,x.arrowShape.ratio);"<=="!==l&&"<==>"!==l||b(e,g,-1,-x.arrowShape.ratio)}};x.drawpoint=
function(a){var c=y.drawingstate.matrix,b=a.x*c.a-a.y*c.b+c.tx;a=a.x*c.c-a.y*c.d-c.ty;A.lineWidth=.3*x.psize;A.beginPath();A.arc(b,a,x.psize,0,2*Math.PI);A.fillStyle=x.pointColor;A.fill();x.noborder||(A.beginPath(),A.arc(b,a,1.15*x.psize,0,2*Math.PI),A.fillStyle=x.black,A.strokeStyle=x.black,A.stroke())};x.clipLineCore=function(a,c,b){var d=Math.SQRT1_2*x.lsize,e=0-d,m=ca+d,g=0-d;d=da+d;var f=0>e*a+g*c+b,k=0>m*a+g*c+b,h=0>e*a+d*c+b,l=0>m*a+d*c+b,n=[];f!==k&&n.push({x:(-b-c*g)/a,y:g});k!==l&&n.push({x:m,
y:(-b-a*m)/c});h!==l&&n.push({x:(-b-c*d)/a,y:d});f!==h&&n.push({x:e,y:(-b-a*e)/c});return n};x.clipLine=function(a){a=g.normalizeMax(g.productVM(a,y.toMat()));return x.clipLineCore(a.value[0].value.real,a.value[1].value.real,a.value[2].value.real)};x.drawline=function(a){g._helper.isAlmostReal(a)&&(a=x.clipLine(a),2===a.length&&.01<=x.lsize&&(x.preDrawCurve(),A.beginPath(),A.moveTo(a[0].x,a[0].y),A.lineTo(a[1].x,a[1].y),A.stroke()))};x.drawRaySegment=function(a,c){a=C.extractPoint(a);c=C.extractPoint(c);
if(a.ok&&c.ok){var b=a.x-c.x,d=a.y-c.y,e=25E3/y.drawingstate.matrix.sdet/Math.sqrt(b*b+d*d);b*=e;d*=e;x.drawsegcore(a,{x:a.x+b,y:a.y+d});x.drawsegcore(c,{x:c.x-b,y:c.y-d})}};x.dashTypes={solid:[],dashed:[10,10],tightdash:[10,4],dotted:[1,3],dashdot:[10,5,1,5],"dashvalue.solid":[],"dashvalue.dashed":[10,10],"dashvalue.tightdash":[10,4],"dashvalue.dotted":[1,3],"dashvalue.dashdot":[10,5,1,5],0:[],1:[10,10],2:[10,4],3:[1,3],4:[10,5,1,5]};x.setDash=function(a,c){c=Math.sqrt(c);a=a.slice();for(var b=0;b<
a.length;b++)a[b]*=c;A.webkitLineDash=a;A.setLineDash(a);A.mozDash=a};x.unSetDash=function(){A.webkitLineDash=[];A.setLineDash([]);A.mozDash=[]};sd.prototype={set fillStyle(a){var c=this;ac(a,function(a,b,d,e){c._fill="#"+rb(a.toString(16),2)+rb(b.toString(16),2)+rb(d.toString(16),2);c._fillOpacity=255===e?null:e})},set strokeStyle(a){var c=this;ac(a,function(a,b,d,e){c._stroke="#"+rb(a.toString(16),2)+rb(b.toString(16),2)+rb(d.toString(16),2);c._strokeOpacity=255===e?null:e})},clearRect:function(){},
beginPath:function(){this._path=[]},_pathcmd:function(){this._path.push.apply(this._path,arguments)},closePath:function(){this._pathcmd("Z")},moveTo:function(a,c){this._pathcmd("M",a,c)},lineTo:function(a,c){this._pathcmd("L",a,c)},bezierCurveTo:function(a,c,b,d,e,g){this._pathcmd("C",a,c,b,d,e,g)},quadraticCurveTo:function(a,c,b,d){this._pathcmd("Q",a,c,b,d)},arc:function(a,c,b,d,e,g){var m=b*Math.cos(d)+a,f=b*Math.sin(d)+c,k=b*Math.cos(e)+a,h=b*Math.sin(e)+c;e=g?d-e:e-d;e>=2*Math.PI?this._pathcmd(this._path.length?
"L":"M",m,f,"A",b,b,0,0,g?1:0,a-b*Math.cos(d),c-b*Math.sin(d),"A",b,b,0,0,g?1:0,m,f):this._pathcmd(this._path.length?"L":"M",m,f,"A",b,b,0,e>Math.PI?1:0,g?1:0,k,h)},rect:function(a,c,b,d){this._pathcmd("M",a,c,"h",b,"v",d,"h",-b,"z")},_cmd:function(a){1!==this.globalAlpha?(this._body.push('<g opacity="'+this.globalAlpha+'">'),this._body.push(a),this._body.push("</g>")):this._body.push(a)},_attrs:function(a){var c="",b;for(b in a)null!==a[b]&&(c+=" "+b+'="'+a[b]+'"');return c},fill:function(){this._cmd("<path"+
this._attrs({d:this._path.join(" "),fill:this._fill,"fill-opacity":this._fillOpacity})+"/>")},stroke:function(){this._cmd("<path"+this._attrs({d:this._path.join(" "),stroke:this._stroke,"stroke-opacity":this._strokeOpacity,"stroke-width":this.lineWidth,"stroke-linecap":this.lineCap,"stroke-linejoin":this.lineJoin,"stroke-miterlimit":"miter"===this.lineJoin?this.miterLimit:null})+"/>")},clip:function(){++this._clipIndex;this._body.push('<clipPath id="clip'+this._clipIndex+'"><path d="'+this._path.join(" ")+
'"/></clipPath>','<g clip-path="url(#clip'+this._clipIndex+')">');this._saveStack[this._saveStack.length-1]+="</g>"},save:function(){this._saveStack.push("")},restore:function(){this._body.push(this._saveStack.pop());0===this._saveStack.length&&this._saveStack.push("")},_transform:function(a){this._body.push('<g transform="'+a+'">');this._saveStack[this._saveStack.length-1]+="</g>"},translate:function(a,c){this._transform("translate("+a+" "+c+")")},rotate:function(a){this._transform("rotate("+Math.PI/
180*a+")")},scale:function(a,c){this._transform("scale("+a+" "+c+")")},transform:function(a,c,b,d,e,g){this._transform("matrix("+[a,c,b,d,e,g].join(" ")+")")},drawImage:function(a,c,b){if(3!==arguments.length)throw Error("SvgWriterContext only supports 3-argument version of drawImage");var d=this._imgcache.indexOf(a);if(-1===d){d=this._imgcache.length;var e=a.cachedDataURL?a.cachedDataURL:ud(a);this._defs.push('<image id="img'+d+'" x="0" y="0" width="'+a.width+'" height="'+a.height+'" xlink:href="'+
e+'"/>');this._imgcache.push(a)}this._cmd('<use x="'+c+'" y="'+b+'" xlink:href="#img'+d+'"/>')},toBlob:function(){for(;1<this._saveStack.length||""!==this._saveStack[0];)this.restore();var a='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="'+this.width+'px" height="'+this.height+'px">\n'+this._defs.join("\n")+'\n</defs>\n<g stroke="none" fill="none">\n'+this._body.join("\n")+"\n</g>\n</svg>\n";
return new Blob([a],{type:"image/svg+xml"})}};td.prototype={_cmd:function(){this._body.push(Array.prototype.join.call(arguments," "))},_setAlpha:function(a,c,b){var d=Math.round(255*a*this._globalAlpha);c+=d;this._extGState[c]="<< /"+b+" "+d/255+" >>";this._cmd("/"+c,"gs");return a},set globalAlpha(a){this._globalAlpha=a;this._setAlpha(this._strokeAlpha,"As","CA");this._setAlpha(this._fillAlpha,"Af","ca")},set fillStyle(a){var c=this;ac(a,function(a,b,d,e){c._cmd(a/255,b/255,d/255,"rg");c._setAlpha(c._fillAlpha=
e,"Af","ca")})},set strokeStyle(a){var c=this;ac(a,function(a,b,d,e){c._cmd(a/255,b/255,d/255,"RG");c._setAlpha(c._strokeAlpha=e,"As","CA")})},set lineWidth(a){this._cmd(a,"w")},set lineCap(a){this._cmd({butt:0,round:1,square:2}[a],"J")},set lineJoin(a){this._cmd({miter:0,round:1,bevel:2}[a],"j")},set miterLimit(a){this._cmd(a,"M")},clearRect:function(){},beginPath:function(){this._pathUsed=!1},closePath:function(){this._cmd("h")},moveTo:function(a,c){this._cmd(this._xPos=a,this._yPos=-c,"m")},lineTo:function(a,
c){this._cmd(this._xPos=a,this._yPos=-c,"l")},bezierCurveTo:function(a,c,b,d,e,g){this._cmd(a,-c,b,-d,this._xPos=e,this._yPos=-g,"c")},quadraticCurveTo:function(a,c,b,d){this.bezierCurveTo((2*a+this._xPos)/3,(2*c-this._yPos)/3,(b+2*a)/3,(d+2*c)/3,b,d)},_kappa:.5522847498307935,arc:function(a,c,b,d,e,g){if(0===d&&e===2*Math.PI)d=this._kappa*b,this.moveTo(a+b,c),this.bezierCurveTo(a+b,c+d,a+d,c+b,a,c+b),this.bezierCurveTo(a-d,c+b,a-b,c+d,a-b,c),this.bezierCurveTo(a-b,c-d,a-d,c-b,a,c-b),this.bezierCurveTo(a+
d,c-b,a+b,c-d,a+b,c);else throw Error("PdfWriterContext.arc only supports full circles");},rect:function(a,c,b,d){this._cmd(a,-c,b,-d,"re")},_usePath:function(a){if(this._pathUsed){var c=this._body[this._pathUsed],b={"S + f":"B","f + S":"B","W n + S":"W S","W n + f":"W f","S + W n":"W S","f + W n":"W f","B + W n":"W B","W S + f":"W B","W f + S":"W B"}[c+" + "+a];if(!b)throw Error("Don't know how to combine '"+c+"' and '"+a+"'");this._body.splice(this._pathUsed,1);a=b}this._pathUsed=this._body.length;
this._cmd(a)},fill:function(){this._usePath("f")},stroke:function(){this._usePath("S")},clip:function(){this._usePath("W n")},save:function(){this._cmd("q")},restore:function(){this._cmd("Q")},translate:function(a,c){this.transform(1,0,0,1,a,c)},rotate:function(a){var c=Math.cos(a);a=Math.sin(a);this.transform(c,a,-a,c,0,0)},scale:function(a,c){this.transform(a,0,0,c,0,0)},transform:function(a,c,b,d,e,g){this._cmd(a,-c,-b,d,e,-g,"cm")},_png:function(a){if("data:image/png;base64,"!==a.substr(0,22))return{error:"Not a base64-encoded PNG file"};
a=ge(a.substr(22));var c=he(a);console.log("PNG chunks:",c.map(function(a){return a.type}));if("IHDR"!==c[0].type)throw Error("Image does not start with an IHDR");var b=c[0].data;a=(b[0]<<24|b[1]<<16|b[2]<<8|b[3])>>>0;var d=(b[4]<<24|b[5]<<16|b[6]<<8|b[7])>>>0,e=b[8],g=b[9],f=0===(g&2),k=0!==(g&4),h=b[10],l=b[11];b=b[12];if(0!==h)throw Error("Unsupported PNG compression method: "+h);if(0!==l)throw Error("Unsupported PNG filter method: "+l);if(0!==b)return{error:"Interlaced image not supported"};if(0!==
(g&1))return{error:"Indexed PNG image not supported"};l=null;g=f?1:3;h=c.filter(function(a){return"IDAT"===a.type}).map(function(a){return a.data});if(k){k=window.pako;l=new k.Inflate;for(c=0;c<h.length;++c)l.push(h[c],c+1===h.length);if(l.err)throw Error(l.err);l=l.result;b=e>>>3;if(l.length!==d*(a*(g+1)*b+1))throw Error("Data length mismatch");var n=g*b;h=new Uint8Array(d*(a*n+1));for(var p=new Uint8Array(d*(a*b+1)),q=0,t=0,r=0,u=0;u<d;++u){h[t++]=p[r++]=l[q++];for(var v=0;v<a;++v){for(c=0;c<n;++c)h[t++]=
l[q++];for(c=0;c<b;++c)p[r++]=l[q++]}}if(q!==l.length||t!==h.length||r!==p.length)throw Error("Seems we garbled our index computation somehow");p=k.deflate(p);l=this._strm({Type:"/XObject",Subtype:"/Image",Width:a,Height:d,ColorSpace:"/DeviceGray",BitsPerComponent:e,Filter:"/FlateDecode",DecodeParms:this._dict({Predictor:15,Colors:1,BitsPerComponent:e,Columns:a})},p).ref;h=[k.deflate(h)]}var w=0;h.forEach(function(a){w+=a.length});return this._obj([this._dict({Type:"/XObject",Subtype:"/Image",Name:"/img"+
this._imgcache.length,Width:a,Height:d,ColorSpace:f?"/DeviceGray":"/DeviceRGB",SMask:l,BitsPerComponent:e,Length:w,Filter:"/FlateDecode",DecodeParms:this._dict({Predictor:15,Colors:g,BitsPerComponent:e,Columns:a})}),"\nstream\n"].concat(h,["\nendstream"]))},drawImage:function(a,c,b){if(3!==arguments.length)throw Error("PdfWriterContext only supports 3-argument version of drawImage");var d=this._imgcache.indexOf(a);if(-1===d){d=this._imgcache.length;this._imgcache.push(a);var e=this._png(a.cachedDataURL||
"");e.hasOwnProperty("error")&&(e=this._png(ud(a)));if(e.hasOwnProperty("error"))throw Error(e.error);this._xobjects["img"+d]=e.ref}this._cmd("q");this._setAlpha(1,"Af","ca");this._cmd(a.width,0,0,a.height,c,-b-a.height,"cm");this._cmd("/img"+d,"Do");this._cmd("Q")},_dict:function(a){var c="<<",b;for(b in a)c+=" /"+b+" "+a[b];return c+" >>"},_obj:function(a,c){c||(c=this._nextIndex++);Array.isArray(a)||(a=[this._dict(a)]);a.index=c;a.ref=c+" 0 R";a.offset=this._offset;var b=0;a.unshift(c+" 0 obj\n");
a.push("\nendobj\n");for(c=0;c<a.length;++c)b+=a[c].length;this._offset+=b;this._objects.push(a);return a},_strm:function(a,c,b){a.Length=c.length;return this._obj([this._dict(a),"\nstream\n",c,"\nendstream"],b)},toBlob:function(){var a="["+[0,-this.height,this.width,0].join(" ")+"]";this._obj({Type:"/Catalog",Pages:"2 0 R"},1);this._obj({Type:"/Pages",Kids:"[3 0 R]",Count:1},2);this._obj({Type:"/Page",Parent:"2 0 R",MediaBox:a,Contents:"4 0 R",Resources:this._dict({ProcSet:"[/PDF /Text /ImageB /ImageC /ImageI]",
XObject:this._dict(this._xobjects),ExtGState:this._dict(this._extGState)})},3);var c=this._body.join("\n"),b=new Uint8Array(c.length);for(a=0;a<c.length;++a)b[a]=c.charCodeAt(a)&255;c=window.pako.deflate(b);this._strm({Filter:"/FlateDecode"},c,4);c=this._objects;var d=[];for(a=1;a<c.length;++a)d[c[a].index]=c[a];b="xref\n0 "+d.length+"\n";for(a=0;a<d.length;++a)b=d[a]?b+(rb(String(d[a].offset),10)+" 00000 n \n"):b+"0000000000 65535 f \n";a="trailer\n"+this._dict({Size:d.length,Root:"1 0 R"})+"\nstartxref\n"+
this._offset+"\n%%EOF\n";c=Array.prototype.concat.apply([],c);c.push(b,a);return new Blob(c,{type:"application/pdf"})}};var Ob=null;ib.push(vd);ua.exportSVG=function(){wd(sd)};ua.exportPDF=function(){xa.loadScript("pako","pako.min.js",function(){wd(td)})};ua.exportPNG=function(){xd(A.canvas.toDataURL())};var xd=function(a){var c=document.createElement("a");document.body.appendChild(c);c.style="display: none";c.href=a;c.download="CindyJSExport";c.click();setTimeout(function(){document.body.removeChild(c);
vd()},100)},Bc="Move",Qb,Da=[],$a=0,je=0,yb=0,G={Delete:{}};G.Delete.actions=[];G.Delete.actions[0]={};G.Delete.actions[0].event="mousedown";G.Delete.actions[0].tooltip="...";G.Delete.actions[0].do=function(){ja=Pb(aa);null!==ja&&bc(ja.mover.name);return!0};G.Move={};G.Move.actions=[];G.Move.actions[0]={};G.Move.actions[0].event="mousedown";G.Move.actions[0].tooltip="Move free elements by dragging the mouse";G.Move.actions[0].do=function(){for(var a=aa,c=null,b=1E6,d,e=0;e<t.free.length;e++){var f=
t.free[e];if(!f.pinned&&!1!==f.visible&&!0!==f.tmp){var h=y.drawingstate.matrix.sdet;if("P"===f.kind){var l=g.normalizeZ(f.homog);if(!g._helper.isAlmostReal(l))continue;var n=l.value[0].value.real-a.x;l=l.value[1].value.real-a.y;var p=Math.sqrt(n*n+l*l);if(f.narrow&&p>("number"===typeof f.narrow?f.narrow:20)/h)continue}else if("C"===f.kind){l=g.normalizeZ(t.csnames[f.args[0]].homog);n=f.radius;if(!g._helper.isAlmostReal(l)||!k._helper.isAlmostReal(n))continue;p=l.value[0].value.real;var q=l.value[1].value.real;
l=a.x-p;var r=a.y-q,u=Math.sqrt(l*l+r*r);if(0===u)continue;q+=r/u*n.value.real;n=p+l/u*n.value.real-a.x;l=q-a.y;p=Math.sqrt(n*n+l*l);p+=30/h;if(f.narrow&&p>(("number"===typeof f.narrow?f.narrow:20)+30)/h)continue}else if("L"===f.kind)n=f.homog,p=k,l=p.add(p.mult(n.value[0],p.conjugate(n.value[0])),p.mult(n.value[1],p.conjugate(n.value[1]))),l=g.scaldiv(p.sqrt(l),n),p=l.value[0].value.real*a.x+l.value[1].value.real*a.y+l.value[2].value.real,n=-l.value[0].value.real*p,l=-l.value[1].value.real*p,0>p&&
(p=-p),p+=25/h;else if("Text"===f.kind){if(!f.homog||f.dock||!f._bbox)continue;l=y.from(a.x,a.y,1);n=Math.max(0,l[0]-f._bbox.right,f._bbox.left-l[0]);l=Math.max(0,l[1]-f._bbox.bottom,f._bbox.top-l[1]);p=Math.sqrt(n*n+l*l);if(20<p)continue;p/=h;l=g.normalizeZ(f.homog);if(!g._helper.isAlmostReal(l))continue;n=l.value[0].value.real-a.x;l=l.value[1].value.real-a.y}else continue;p<b+.2/h&&(b=p,c=f,d={x:n,y:l})}}console.log("Moving "+(c?c.name:"nothing"));ja=null===c?null:{mover:c,offset:d,prev:{x:a.x,
y:a.y}};return!0};G.Point={};G.Point.actions=[];G.Point.actions[0]={};G.Point.actions[0].event="mousedown";G.Point.actions[0].tooltip="Add a single point with the mouse";G.Point.actions[0].do=function(){Oa({type:"Free",name:Za(),labeled:!0,pos:[ta[0],ta[1],1]});return!0};G.Mid={};G.Mid.actions=[];G.Mid.actions[0]={};G.Mid.actions[0].event="mousedown";G.Mid.actions[0].tooltip="Construct two points and their midpoint by dragging";G.Mid.actions[0].do=function(){sb();return!0};G.Mid.actions[1]={};G.Mid.actions[1].event=
"mousemove";G.Mid.actions[1].do=function(){cc("Mid");return!0};G.Mid.actions[2]={};G.Mid.actions[2].event="mouseup";G.Mid.actions[2].do=function(){zb();return!0};G.Circle={};G.Circle.actions=[];G.Circle.actions[0]={};G.Circle.actions[0].event="mousedown";G.Circle.actions[0].tooltip="Construct two points and a circle by dragging the mouse";G.Circle.actions[0].do=function(){sb();return!0};G.Circle.actions[1]={};G.Circle.actions[1].event="mousemove";G.Circle.actions[1].do=function(){cc("CircleMP");return!0};
G.Circle.actions[2]={};G.Circle.actions[2].event="mouseup";G.Circle.actions[2].do=function(){zb();return!0};G.Compass={};G.Compass.actions=[];G.Compass.actions[0]={};G.Compass.actions[0].event="mousedown";G.Compass.actions[0].tooltip="...";G.Compass.actions[0].do=function(){sb();return!0};G.Compass.actions[1]={};G.Compass.actions[1].event="mousedown";G.Compass.actions[1].tooltip="...";G.Compass.actions[1].do=function(){sb();return!0};G.Compass.actions[2]={};G.Compass.actions[2].event="mousedown";
G.Compass.actions[2].tooltip="...";G.Compass.actions[2].do=function(){sb();Oa({type:"Compass",name:Za(),labeled:!0,args:[Da[0].name,Da[1].name,Da[2].name]});return!0};G.Line={};G.Line.actions=[];G.Line.actions[0]={};G.Line.actions[0].event="mousedown";G.Line.actions[0].tooltip="Construct two points and their connecting line by dragging the mouse";G.Line.actions[0].do=function(){sb();return!0};G.Line.actions[1]={};G.Line.actions[1].event="mousemove";G.Line.actions[1].do=function(){cc("Join");return!0};
G.Line.actions[2]={};G.Line.actions[2].event="mouseup";G.Line.actions[2].do=function(){zb();return!0};G.Segment={};G.Segment.actions=[];G.Segment.actions[0]={};G.Segment.actions[0].event="mousedown";G.Segment.actions[0].tooltip="Draw a segment by dragging the mouse";G.Segment.actions[0].do=function(){sb();return!0};G.Segment.actions[1]={};G.Segment.actions[1].event="mousemove";G.Segment.actions[1].do=function(){cc("Segment");return!0};G.Segment.actions[2]={};G.Segment.actions[2].event="mouseup";G.Segment.actions[2].do=
function(){zb();return!0};G.Parallel={};G.Parallel.actions=[];G.Parallel.actions[0]={};G.Parallel.actions[0].event="mousedown";G.Parallel.actions[0].tooltip="Construct a parallel line by dragging a line";G.Parallel.actions[0].do=function(){return Ad()};G.Parallel.actions[1]={};G.Parallel.actions[1].event="mousemove";G.Parallel.actions[1].do=function(){var a={type:"Free",name:Za(),labeled:!0,pos:[ta[0],ta[1],1],tmp:!0};a=Oa(a);Qb=Oa({type:"Para",name:Za(),labeled:!0,args:[Da[0].name,a.name]});Dc(a);
return!0};G.Parallel.actions[2]={};G.Parallel.actions[2].event="mouseup";G.Parallel.actions[2].do=function(){zb();return!0};G.Orthogonal={};G.Orthogonal.actions=[];G.Orthogonal.actions[0]={};G.Orthogonal.actions[0].event="mousedown";G.Orthogonal.actions[0].tooltip="Construct a orthogonal line by dragging a line";G.Orthogonal.actions[0].do=function(){if(Ad()){var a={type:"Free",name:Za(),labeled:!0,pos:[ta[0],ta[1],1],tmp:!0};a=Oa(a);Qb=Oa({type:"Perp",name:Za(),labeled:!0,args:[Da[0].name,a.name]});
Dc(a);return!0}return!1};G.Orthogonal.actions[1]={};G.Orthogonal.actions[1].event="mouseup";G.Orthogonal.actions[1].do=function(){zb();return!0};G.Intersection={};G.Intersection.actions=[];G.Intersection.actions[0]={};G.Intersection.actions[0].event="mousedown";G.Intersection.actions[0].tooltip="Select two elements to define their intersection";G.Intersection.actions[0].do=function(){return Bd()};G.Intersection.actions[1]={};G.Intersection.actions[1].event="mousedown";G.Intersection.actions[1].do=
function(){return Bd()?(Qb=Oa({type:"Meet",name:Za(),labeled:!0,args:[Da[0].name,Da[1].name]}),!0):!1};var fb={},y={drawingstate:{}};y.drawingstate.linecolor="rgb(0,0,255)";y.drawingstate.linecolorraw=[0,0,1];y.drawingstate.pointcolor="rgb(0,255,0)";y.drawingstate.pointcolorraw=[0,1,0];y.drawingstate.textcolor="rgb(0,0,0)";y.drawingstate.textcolorraw=[0,0,0];y.drawingstate.alpha=1;y.drawingstate.pointsize=4;y.drawingstate.linesize=1;y.drawingstate.textsize=null;y.drawingstate.matrix={};y.drawingstate.matrix.a=
25;y.drawingstate.matrix.b=0;y.drawingstate.matrix.c=0;y.drawingstate.matrix.d=25;y.drawingstate.matrix.tx=250.5;y.drawingstate.matrix.ty=250.5;y.drawingstate.matrix.det=y.drawingstate.matrix.a*y.drawingstate.matrix.d-y.drawingstate.matrix.b*y.drawingstate.matrix.c;y.drawingstate.matrix.sdet=Math.sqrt(y.drawingstate.matrix.det);y.drawingstate.initialmatrix={};y.drawingstate.initialmatrix.a=y.drawingstate.matrix.a;y.drawingstate.initialmatrix.b=y.drawingstate.matrix.b;y.drawingstate.initialmatrix.c=
y.drawingstate.matrix.c;y.drawingstate.initialmatrix.d=y.drawingstate.matrix.d;y.drawingstate.initialmatrix.tx=y.drawingstate.matrix.tx;y.drawingstate.initialmatrix.ty=y.drawingstate.matrix.ty;y.drawingstate.initialmatrix.det=y.drawingstate.matrix.det;y.drawingstate.initialmatrix.sdet=y.drawingstate.matrix.sdet;y.clone=function(a){if(null===a||"object"!==typeof a)return a;var c=a.constructor(),b;for(b in a)c[b]=y.clone(a[b]);return c};fb.backup=y.clone(y.drawingstate);fb.stack=[];y.clone(y.drawingstate);
y.reset=function(){y.drawingstate.matrix.a=y.drawingstate.initialmatrix.a;y.drawingstate.matrix.b=y.drawingstate.initialmatrix.b;y.drawingstate.matrix.c=y.drawingstate.initialmatrix.c;y.drawingstate.matrix.d=y.drawingstate.initialmatrix.d;y.drawingstate.matrix.tx=y.drawingstate.initialmatrix.tx;y.drawingstate.matrix.ty=y.drawingstate.initialmatrix.ty;y.drawingstate.matrix.det=y.drawingstate.initialmatrix.det;y.drawingstate.matrix.sdet=y.drawingstate.initialmatrix.sdet};y.from=function(a,c,b){a/=b;
c/=b;b=y.drawingstate.matrix;return[a*b.a-c*b.b+b.tx,a*b.c-c*b.d-b.ty]};y.to=function(a,c){var b=y.drawingstate.matrix;a-=b.tx;c+=b.ty;return[(a*b.d-c*b.b)/b.det,-(-a*b.c+c*b.a)/b.det,1]};y.toMat=function(){var a=y.drawingstate.matrix;return g.realMatrix([[a.d,-a.b,-a.tx*a.d-a.ty*a.b],[a.c,-a.a,-a.tx*a.c-a.ty*a.a],[0,0,a.det]])};y.dumpTrafo=function(){function a(a){return Math.round(1E3*a)/1E3}var c=y.drawingstate.matrix;console.log("a:"+a(c.a)+" b:"+a(c.b)+" c:"+a(c.c)+" d:"+a(c.d)+" tx:"+a(c.ty)+
" ty:"+a(c.tx))};y.setMat=function(a,c,b,d,e,g){var f=y.drawingstate.matrix;f.a=a;f.b=c;f.c=b;f.d=d;f.tx=e;f.ty=g;f.det=a*d-c*b;f.sdet=Math.sqrt(f.det)};y.scaleAndOrigin=function(a,c,b){y.setMat(a,0,0,a,c,b)};y.visibleRect=function(a,c,b,d){var e=b-a,f=c-d;e=ca*f<da*e?ca/e:da/f;y.setMat(e,0,0,e,(ca-e*(a+b))/2,(da-e*(c+d))/2)};y.applyMat=function(a,c,b,d,e,f){var g=y.drawingstate.matrix;y.setMat(g.a*a+g.c*c,g.b*a+g.d*c,g.a*b+g.c*d,g.b*b+g.d*d,g.a*e+g.c*f+g.tx,g.b*e+g.d*f+g.ty)};y.translate=function(a,
c){y.applyMat(1,0,0,1,a,c)};y.rotate=function(a){var c=Math.cos(a);a=Math.sin(a);y.applyMat(c,a,-a,c,0,0)};y.scale=function(a){y.applyMat(a,0,0,a,0,0)};y.gsave=function(){fb.stack.push(y.clone(y.drawingstate))};y.grestore=function(){0!==fb.stack.length&&(y.drawingstate=fb.stack.pop())};y.greset=function(){y.drawingstate=y.clone(fb.backup);y.drawingstate.matrix.ty-=da;y.drawingstate.initialmatrix.ty-=da;fb.stack=[]};y.createnewbackup=function(){y.drawingstate.initialmatrix.a=y.drawingstate.matrix.a;
y.drawingstate.initialmatrix.b=y.drawingstate.matrix.b;y.drawingstate.initialmatrix.c=y.drawingstate.matrix.c;y.drawingstate.initialmatrix.d=y.drawingstate.matrix.d;y.drawingstate.initialmatrix.tx=y.drawingstate.matrix.tx;y.drawingstate.initialmatrix.ty=y.drawingstate.matrix.ty;y.drawingstate.initialmatrix.det=y.drawingstate.matrix.det;y.drawingstate.initialmatrix.sdet=y.drawingstate.matrix.sdet;fb.backup=y.clone(y.drawingstate)};y.makecolor=function(a,c,b){a=Math.floor(255*a);c=Math.floor(255*c);
b=Math.floor(255*b);return 1===y.drawingstate.alpha?"rgb("+a+","+c+","+b+")":"rgba("+a+","+c+","+b+","+y.drawingstate.alpha+")"};y.setcolor=function(a){var c=a.value[0].value.real,b=a.value[1].value.real;a=a.value[2].value.real;y.drawingstate.linecolor=y.drawingstate.pointcolor=y.makecolor(c,b,a);y.drawingstate.linecolorraw=y.drawingstate.pointcolorraw=[c,b,a]};y.setlinecolor=function(a){var c=a.value[0].value.real,b=a.value[1].value.real;a=a.value[2].value.real;y.drawingstate.linecolor=y.makecolor(c,
b,a);y.drawingstate.linecolorraw=[c,b,a]};y.settextcolor=function(a){var c=a.value[0].value.real,b=a.value[1].value.real;a=a.value[2].value.real;y.drawingstate.textcolor=y.makecolor(c,b,a);y.drawingstate.textcolorraw=[c,b,a]};y.setpointcolor=function(a){var c=a.value[0].value.real,b=a.value[1].value.real;a=a.value[2].value.real;y.drawingstate.pointcolor=y.makecolor(c,b,a);y.drawingstate.pointcolorraw=[c,b,a]};y.setalpha=function(a){y.drawingstate.alpha=a.value.real;y.drawingstate.linecolor=y.makecolor(y.drawingstate.linecolorraw[0],
y.drawingstate.linecolorraw[1],y.drawingstate.linecolorraw[2]);y.drawingstate.pointcolor=y.makecolor(y.drawingstate.pointcolorraw[0],y.drawingstate.pointcolorraw[1],y.drawingstate.pointcolorraw[2]);y.drawingstate.textcolor=y.makecolor(y.drawingstate.textcolorraw[0],y.drawingstate.textcolorraw[1],y.drawingstate.textcolorraw[2])};y.setpointsize=function(a){y.drawingstate.pointsize=a.value.real};y.setlinesize=function(a){y.drawingstate.linesize=a.value.real};y.settextsize=function(a){y.drawingstate.textsize=
a.value.real};var ha={clip:"none",pointColor:[1,0,0],lineColor:[0,0,1],pointSize:5,lineSize:1,alpha:1,overhangLine:1,overhangSeg:1,dimDependent:.7,fontFamily:"sans-serif",textColor:[0,0,0],textsize:20,noborder:!1,lineHeight:1.45};p.defaultAppearance&&ke(p.defaultAppearance);var ec={},Hd={UL:0,UR:1,LR:2,LL:3},Gc=["in","out","good","backup","prover"],mb=new Float64Array(0),Ya={};Gc.forEach(function(a){Ya[a]=mb});var oa=mb,Ra=mb,Ha=mb,Fa,Ia,kb,Pa,Cb,Hc=!1,Jd={toString:function(){return"RefineException"}},
Md=null,N=null;p.enableTraceLog&&(N={logLength:Infinity,fullLog:[],currentMouseAndScripts:null,currentMover:null,currentStep:null,currentElement:null,currentParam:null,labelTracing2:u.wrap("tracing2"),labelTracing4:u.wrap("tracing4"),labelTracingSesq:u.wrap("tracingSesq"),postMouseHooks:[]},"number"===typeof p.enableTraceLog&&(N.logLength=p.enableTraceLog),ua.getTraceLog=re,ua.formatTraceLog=se,ua.addTraceHook=N.postMouseHooks.push.bind(N.postMouseHooks));Sa.stateSize=12;Jc.stateSize=24;Rb.stateSize=
24;var sa=[];ea._helper={};ea._helper.duplicatePPLL=function(a,c){return{getInvolved:function(){return[a,c]},toString:function(){return{P:"point",L:"line"}[a.kind]+" "+a.name+" is duplicate of "+c.name},apply:Sb(a,c),holds:function(){return g.projectiveDistMinScal(a.homog,c.homog)<k.epsbig}}};ea._helper.duplicatePsLs=function(a,c){return{getInvolved:function(){return[a,c]},toString:function(){return{Ps:"point set",Ls:"line set"}[a.kind]+" "+a.name+" is duplicate of "+c.name},apply:Sb(a,c),holds:function(){return ea._helper.isSetEq(a.results.value,
c.results.value,g.projectiveDistMinScal)}}};ea._helper.duplicateCC=function(a,c){return{getInvolved:function(){return[a,c]},toString:function(){return"Conic "+a.name+" is duplicate of "+c.name},apply:Sb(a,c),holds:function(){return g.conicDist(a.matrix,c.matrix)<k.epsbig}}};ea._helper.duplicateCs=function(a,c){return{getInvolved:function(){return[a,c]},toString:function(){return"Conic set"+a.name+" is duplicate of "+c.name},apply:Sb(a,c),holds:function(){return ea._helper.isSetEq(a.results,c.results,
g.conicDist)}}};ea._helper.duplicateSS=function(a,c){return{getInvolved:function(){return[a,c]},toString:function(){return"Segment "+a.name+" is duplicate of "+c.name},apply:Sb(a,c),holds:function(){var b=t.csnames[a.args[0]],d=t.csnames[a.args[1]],e=t.csnames[c.args[0]],f=t.csnames[c.args[1]],h=g.projectiveDistMinScal(b.homog,e.homog);h+=g.projectiveDistMinScal(d.homog,f.homog);d=g.projectiveDistMinScal(d.homog,e.homog);d+=g.projectiveDistMinScal(b.homog,f.homog);return Math.min(h,d)<k.epsbig}}};
ea.P=function(a){t.points.forEach(function(c){a.name!==c.name&&(c=ea._helper.duplicatePPLL(a,c),c.holds()&&sa.push(c))})};ea.Ps=function(a){t.sets.points.forEach(function(c){a.name!==c.name&&(c=ea._helper.duplicatePsLs(a,c),c.holds()&&sa.push(c))})};ea.Ls=function(a){t.sets.lines.forEach(function(c){a.name!==c.name&&(c=ea._helper.duplicatePsLs(a,c),c.holds()&&sa.push(c))})};ea.Cs=function(a){t.sets.conics.forEach(function(c){a.name!==c.name&&(c=ea._helper.duplicateCs(a,c),c.holds()&&sa.push(c))})};
ea.L=function(a){t.lines.forEach(function(c){a.name!==c.name&&a.kind===c.kind&&(c=ea._helper.duplicatePPLL(a,c),c.holds()&&sa.push(c))})};ea.S=function(a){t.lines.forEach(function(c){a.name!==c.name&&"S"===c.kind&&(c=ea._helper.duplicateSS(a,c),c.holds()&&sa.push(c))})};ea.C=function(a){t.conics.forEach(function(c){a.name!==c.name&&(c=ea._helper.duplicateCC(a,c),c.holds()&&sa.push(c))})};ea._helper.isSetEq=function(a,c,b){a=a.slice();c=c.slice();if(a.length!==c.length)return!1;if(0===a.length&&0===
c.length)return!0;var d=a.shift(),e=c.reduce(function(a,c,e,g){return b(c,d)<b(g[a],d)?e:a},0);return b(c[e],d)<k.epsbig?(c.splice(e,1),ea._helper.isSetEq(a,c,b)):!1};lb.P=function(a){t.lines.forEach(function(c){c=Pd(a,c);c.holds()&&sa.push(c)});t.conics.forEach(function(c){c=Qd(a,c);c.holds()&&sa.push(c)})};lb.L=function(a){t.points.forEach(function(c){c=Pd(c,a);c.holds()&&sa.push(c)})};lb.S=lb.L;lb.C=function(a){t.points.forEach(function(c){c=Qd(c,a);c.holds()&&sa.push(c)})};var l={_helper:{},RandomLine:{}};
l.RandomLine.kind="L";l.RandomLine.signature=[];l.RandomLine.updatePosition=function(a){a.homog=g.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);a.homog=g.normalizeMax(a.homog);a.homog=u.withUsage(a.homog,"Line")};l._helper.getRandMove=function(a){a=a.homog;var c=g.getRandComplexVec3(-.05,.05);return{type:"homog",value:g.add(a,c)}};l._helper.getRandPointMove=function(a){a=g.normalizeMax(a.homog);var c=a.value[2],b=k.abs(c).value.real,d=k.real(0);b<k.eps&&(d=k.getRandComplex(-.05,
.05),c=k.real(1));b=g.turnIntoCSList([k.getRandComplex(-.1,.1),k.getRandComplex(-.1,.1),d]);c=g.scalmult(c,b);c=g.add(a,c);return{type:"homog",value:c}};l.FreeLine={};l.FreeLine.kind="L";l.FreeLine.signature=[];l.FreeLine.isMovable=!0;l.FreeLine.initialize=function(a){a=l._helper.initializeLine(a);V(a)};l.FreeLine.getParamForInput=function(a,c,b){"mouse"===b?(a=g.cross(c,g.ez),a=g.cross(a,c)):a="homog"===b?c:g.turnIntoCSList([k.zero,k.zero,k.zero]);return g.normalizeMax(a)};l.FreeLine.getParamFromState=
function(a){return Z(3)};l.FreeLine.putParamToState=function(a,c){V(c)};l.FreeLine.updatePosition=function(a){var c=Z(3);V(c);a.homog=u.withUsage(c,"Line")};l.FreeLine.getRandomMove=l._helper.getRandMove;l.FreeLine.stateSize=6;l.RandomPoint={};l.RandomPoint.kind="P";l.RandomPoint.signature=[];l.RandomPoint.updatePosition=function(a){a.homog=g.realVector([100*Math.random(),100*Math.random(),100*Math.random()]);a.homog=g.normalizeMax(a.homog);a.homog=u.withUsage(a.homog,"Point")};l.Join={};l.Join.kind=
"L";l.Join.signature=["P","P"];l.Join.updatePosition=function(a){a.homog=g.cross(t.csnames[a.args[0]].homog,t.csnames[a.args[1]].homog);a.homog=g.normalizeMax(a.homog);a.homog=u.withUsage(a.homog,"Line")};l.Segment={};l.Segment.kind="S";l.Segment.signature=["P","P"];l.Segment.updatePosition=function(a){var c=t.csnames[a.args[0]],b=t.csnames[a.args[1]];l.Segment.setSegmentPos(a,g.cross(c.homog,b.homog),g.scalmult(b.homog.value[2],c.homog),g.scalmult(c.homog.value[2],b.homog))};l.Segment.setSegmentPos=
function(a,c,b,d){c=g.normalizeMax(c);a.homog=u.withUsage(c,"Line");c=g.turnIntoCSList([b,d]);c=g.normalizeMax(c);a.startpos=c.value[0];a.endpos=c.value[1]};l.Meet={};l.Meet.kind="P";l.Meet.signature=["L","L"];l.Meet.updatePosition=function(a){a.homog=g.cross(t.csnames[a.args[0]].homog,t.csnames[a.args[1]].homog);a.homog=g.normalizeMax(a.homog);a.homog=u.withUsage(a.homog,"Point")};l.Meet.visiblecheck=function(a){var c=!0,b=t.csnames[a.args[0]],d=t.csnames[a.args[1]];"S"===b.kind&&(c=Fd(a,b));c&&
"S"===d.kind&&(c=Fd(a,d));a.isshowing=c};l._helper.midpoint=function(a,c){return g.normalizeMax(g.add(g.scalmult(c.value[2],a),g.scalmult(a.value[2],c)))};l.Mid={};l.Mid.kind="P";l.Mid.signature=["P","P"];l.Mid.updatePosition=function(a){var c=l._helper.midpoint(t.csnames[a.args[0]].homog,t.csnames[a.args[1]].homog);a.homog=u.withUsage(c,"Point")};l.Perp={};l.Perp.kind="L";l.Perp.signature=["L","P"];l.Perp.updatePosition=function(a){var c=t.csnames[a.args[0]].homog,b=t.csnames[a.args[1]].homog;c=
g.turnIntoCSList([c.value[0],c.value[1],k.zero]);a.homog=g.cross(c,b);a.homog=g.normalizeMax(a.homog);a.homog=u.withUsage(a.homog,"Line")};l.Para={};l.Para.kind="L";l.Para.signature=["L","P"];l.Para.updatePosition=function(a){var c=t.csnames[a.args[1]].homog;a.homog=g.cross(g.cross(g.linfty,t.csnames[a.args[0]].homog),c);a.homog=g.normalizeMax(a.homog);a.homog=u.withUsage(a.homog,"Line")};l.Horizontal={};l.Horizontal.kind="L";l.Horizontal.signature=["P"];l.Horizontal.updatePosition=function(a){a.homog=
g.cross(g.ex,t.csnames[a.args[0]].homog);a.homog=g.normalizeMax(a.homog);a.homog=u.withUsage(a.homog,"Line")};l.HorizontalLine={};l.HorizontalLine.kind="L";l.HorizontalLine.signature=[];l.HorizontalLine.isMovable=!0;l.HorizontalLine.initialize=function(a){a=l._helper.initializeLine(a);a=g.turnIntoCSList([k.zero,a.value[1],a.value[2]]);a=g.normalizeMax(a);V(a)};l.HorizontalLine.getParamForInput=function(a,c,b){if("mouse"===b)c=g.cross(c,g.ex);else if("homog"===b){if(0!==c.value[0].real||0!==c.value[0].imag)c=
g.turnIntoCSList([k.zero,c.value[1],c.value[2]])}else c=g.turnIntoCSList([k.zero,k.zero,k.zero]);return g.normalizeMax(c)};l.HorizontalLine.getParamFromState=function(a){return Z(3)};l.HorizontalLine.putParamToState=function(a,c){V(c)};l.HorizontalLine.updatePosition=function(a){var c=Z(3);V(c);a.homog=u.withUsage(c,"Line")};l.HorizontalLine.getRandomMove=l._helper.getRandMove;l.HorizontalLine.stateSize=6;l.Vertical={};l.Vertical.kind="L";l.Vertical.signature=["P"];l.Vertical.updatePosition=function(a){a.homog=
g.cross(g.ey,t.csnames[a.args[0]].homog);a.homog=g.normalizeMax(a.homog);a.homog=u.withUsage(a.homog,"Line")};l.VerticalLine={};l.VerticalLine.kind="L";l.VerticalLine.signature=[];l.VerticalLine.isMovable=!0;l.VerticalLine.initialize=function(a){a=l._helper.initializeLine(a);a=g.turnIntoCSList([a.value[0],k.zero,a.value[2]]);a=g.normalizeMax(a);V(a)};l.VerticalLine.getParamForInput=function(a,c,b){if("mouse"===b)c=g.cross(c,g.ey);else if("homog"===b){if(0!==c.value[1].real||0!==c.value[1].imag)c=
g.turnIntoCSList([c.value[0],k.zero,c.value[2]])}else c=g.turnIntoCSList([k.zero,k.zero,k.zero]);return g.normalizeMax(c)};l.VerticalLine.getParamFromState=function(a){return Z(3)};l.VerticalLine.putParamToState=function(a,c){V(c)};l.VerticalLine.updatePosition=function(a){var c=Z(3);V(c);a.homog=u.withUsage(c,"Line")};l.VerticalLine.getRandomMove=l._helper.getRandMove;l.VerticalLine.stateSize=6;l.LineByFixedAngle={};l.LineByFixedAngle.kind="L";l.LineByFixedAngle.signature=["L","P"];l.LineByFixedAngle.initialize=
function(a){var c=k._helper.input(a.angle),b=k.cos(c);c=k.sin(c);a.rot=g.turnIntoCSList([g.turnIntoCSList([c,b,k.zero]),g.turnIntoCSList([k.neg(b),c,k.zero]),g.turnIntoCSList([k.zero,k.zero,k.zero])])};l.LineByFixedAngle.updatePosition=function(a){var c=t.csnames[a.args[1]],b=g.productMV(a.rot,t.csnames[a.args[0]].homog);a.homog=g.cross(c.homog,b);a.homog=g.normalizeMax(a.homog);a.homog=u.withUsage(a.homog,"Line")};l.Through={};l.Through.kind="L";l.Through.signature=["P"];l.Through.isMovable=!0;l.Through.initialize=
function(a){a=a.dir?u.wrap(a.dir):g.realVector([a.pos[1],-a.pos[0],0]);V(a)};l.Through.getParamForInput=function(a,c,b){a="dir"===b||"mouse"===b?g.cross(t.csnames[a.args[0]].homog,c):"homog"===b?c:g.turnIntoCSList([k.zero,k.zero,k.zero]);a=g.cross(g.linfty,a);return g.normalizeMax(a)};l.Through.getParamFromState=function(a){return Z(3)};l.Through.putParamToState=function(a,c){V(c)};l.Through.updatePosition=function(a){var c=Z(3);V(c);c=g.cross(t.csnames[a.args[0]].homog,c);c=g.normalizeMax(c);a.homog=
u.withUsage(c,"Line")};l.Through.getRandomMove=l._helper.getRandMove;l.Through.stateSize=6;l.Through.set_angle=function(a,c){if("number"===c.ctype){var b=k.cos(c);c=k.sin(c);b=g.turnIntoCSList([b,c,k.real(0)]);Ea(a,b,"dir")}};l.Through.set_slope=function(a,c){"number"===c.ctype&&(c=g.turnIntoCSList([k.real(1),c,k.real(0)]),Ea(a,c,"dir"))};l.Free={};l.Free.kind="P";l.Free.signature=[];l.Free.isMovable=!0;l.Free.initialize=function(a){a=l._helper.initializePoint(a);V(a)};l.Free.getParamForInput=function(a,
c,b){if("mouse"===b&&Fb&&0!==Ca){c=g.normalizeZ(c);a=c.value[0].value.real;b=c.value[1].value.real;var d=Math.round(a/Ca)*Ca,e=Math.round(b/Ca)*Ca;.2>Math.abs(d-a)&&.2>Math.abs(e-b)&&(c=g.realVector([d,e,1]))}return g.normalizeMax(c)};l.Free.getParamFromState=function(a){return Z(3)};l.Free.putParamToState=function(a,c){V(c)};l.Free.updatePosition=function(a){var c=Z(3);V(c);a.homog=u.withUsage(c,"Point")};l.Free.getRandomMove=l._helper.getRandPointMove;l.Free.stateSize=6;l._helper.projectPointToLine=
function(a,c){var b=g.turnIntoCSList([c.value[0],c.value[1],k.zero]);a=g.cross(b,a);return g.normalizeMax(g.cross(a,c))};l.PointOnLine={};l.PointOnLine.kind="P";l.PointOnLine.signature=["L"];l.PointOnLine.isMovable=!0;l.PointOnLine.initialize=function(a){var c=l._helper.initializePoint(a);a=t.csnames[a.args[0]].homog;c=l._helper.projectPointToLine(c,a);c=g.normalizeMax(c);var b=g.cross(g.linfty,c);g.normalizeMax(b);V(c);V(a);kb=!1};l.PointOnLine.updatePosition=function(a,c){var b=t.csnames[a.args[0]].homog;
var d=Z(3);Z(3);if(!c){Fa=a.stateIdx;var e=oa;oa=Ha;c=Z(3);var f=Z(3);oa=e;e=g.cross(f,b);g._helper.isAlmostZero(e)&&(e=g.cross(g.linfty,b));c=l._helper.CircleMP(e,c);c=l._helper.IntersectLC(b,c);e=l._helper.pointReflection(e,d);d=Ic(c[0],c[1],d,e)[0]}d=g.normalizeMax(d);V(d);V(b);a.homog=u.withUsage(d,"Point")};l.PointOnLine.getParamForInput=function(a,c,b){a=t.csnames[a.args[0]].homog;c=l._helper.projectPointToLine(c,a);"mouse"===b&&Fb&&0!==Ca&&(c=l._helper.snapPointToLine(c,a));return c};l.PointOnLine.getParamFromState=
function(a){return Z(3)};l.PointOnLine.putParamToState=function(a,c){return V(c)};l.PointOnLine.getRandomMove=l._helper.getRandPointMove;l.PointOnLine.stateSize=12;l.PointOnCircle={};l.PointOnCircle.kind="P";l.PointOnCircle.signature=["C"];l.PointOnCircle.isMovable=!0;l.PointOnCircle.initialize=function(a){var c=t.csnames[a.args[0]];a=g.normalizeZ(l._helper.initializePoint(a));var b=g.normalizeZ(l._helper.CenterOfCircle(c.matrix)),d=g.sub(a,b);d=g.turnIntoCSList([d.value[1],k.neg(d.value[0]),k.zero]);
b=g.cross(a,b);c=l._helper.IntersectLC(b,c.matrix);b=g.projectiveDistMinScal(a,c[0]);g.projectiveDistMinScal(a,c[1])<b?(a=c[1],c=c[0]):(a=c[0],c=c[1]);V(d);V(a);V(c);kb=!1};l.PointOnCircle.putParamToState=function(a,c){V(c)};l.PointOnCircle.getParamFromState=function(a){return Z(3)};l.PointOnCircle.getParamForInput=function(a,c,b){b=g.normalizeZ(l._helper.CenterOfCircle(t.csnames[a.args[0]].matrix));c=g.sub(c,b);Fa=a.stateIdx;a=Z(3);var d=g.normalizeZ(Z(3));b=g.sub(d,b);0>k.sub(k.mult(a.value[0],
b.value[1]),k.mult(a.value[1],b.value[0])).value.real&&(c=g.neg(c));return g.turnIntoCSList([c.value[1],k.neg(c.value[0]),k.zero])};l.PointOnCircle.parameterPath=function(a,c,b,d,e){d=g.normalizeAbs(d);e=g.normalizeAbs(e);var f=g.scalproduct(d,e);if(0<=f.value.real)return Kd(a,c,b,d,e);a=g.turnIntoCSList([k.sub(d.value[1],e.value[1]),k.sub(e.value[0],d.value[0]),k.zero]);f=g.scalproduct(d,a);0>f.value.real&&(a=g.neg(a));0>c?(c=2*c+1,b=c*c,f=.25/(1+b),b=k.complex(2*c*f+.25,(1-b)*f)):(c=2*c-1,b=c*c,
f=.25/(1+b),b=k.complex(2*c*f+.75,(1-b)*f));var m=k.sub(k.real(1),b);c=k.mult(b,b);f=k.mult(m,m);b=k.mult(b,m);d=g.scalmult(f,d);d=g.add(d,g.scalmult(b,a));return d=g.add(d,g.scalmult(c,e))};l.PointOnCircle.updatePosition=function(a){var c=Z(3);V(c);var b=t.csnames[a.args[0]];c=g.productMV(b.matrix,c);b=l._helper.IntersectLC(c,b.matrix);b=Sa(b[0],b[1]);c=g.normalizeMax(b.value[0]);a.homog=u.withUsage(c,"Point");a.antipodalPoint=b.value[1]};l.PointOnCircle.getRandomMove=l._helper.getRandPointMove;
l.PointOnCircle.stateSize=6+Sa.stateSize;l.PointOnCircle.get_angle=function(a){var c=l._helper.CenterOfCircle(t.csnames[a.args[0]].matrix),b=g._helper.isAlmostFarpoint;if(b(a.homog)||b(c))return h;a=g.normalizeZ(a.homog);c=g.normalizeZ(c);c=g.sub(a,c);c=k.arctan2(c.value[0],c.value[1]);a=k.real(Nc);c=k.mod(k.add(c,a),a);return u.withUsage(c,"Angle")};l.PointOnCircle.set_angle=function(a,c){if("number"===c.ctype){var b=t.csnames[a.args[0]],d=l._helper.CenterOfCircle(b.matrix);if(!g._helper.isAlmostFarpoint(d)){d=
g.normalizeZ(d);var e=k.cos(c);c=k.sin(c);b=g.turnIntoCSList([k.mult(e,b.radius),k.mult(c,b.radius),k.real(0)]);Ea(a,g.add(d,b),"homog")}}return h};l.OtherPointOnCircle={};l.OtherPointOnCircle.kind="P";l.OtherPointOnCircle.signature=["P"];l.OtherPointOnCircle.signatureConstraints=function(a){return"PointOnCircle"===t.csnames[a.args[0]].type};l.OtherPointOnCircle.updatePosition=function(a){var c=t.csnames[a.args[0]].antipodalPoint;c=g.normalizeMax(c);a.homog=u.withUsage(c,"Point")};l.PointOnSegment=
{};l.PointOnSegment.kind="P";l.PointOnSegment.signature=["S"];l.PointOnSegment.isMovable=!0;l.PointOnSegment.initialize=function(a){var c=l._helper.initializePoint(a);a=l.PointOnSegment.getParamForInput(a,c);ab(a)};l.PointOnSegment.getParamForInput=function(a,c,b){a=t.csnames[a.args[0]];var d=a.homog;"mouse"===b&&Fb&&0!==Ca&&(c=l._helper.snapPointToLine(c,d));b=g.turnIntoCSList([d.value[0],d.value[1],k.zero]);d=g.sub(a.startpos,a.endpos);c=g.crossratio3(d,a.startpos,a.endpos,c,b);0>c.value.real&&
(c=k.complex(0,c.value.imag));1<c.value.real&&(c=k.complex(1,c.value.imag));return c};l.PointOnSegment.getParamFromState=function(a){return Db()};l.PointOnSegment.putParamToState=function(a,c){ab(c)};l.PointOnSegment.updatePosition=function(a){var c=Db();ab(c);var b=t.csnames[a.args[0]],d=b.startpos;b=g.sub(b.endpos,d);c=g.add(d,g.scalmult(c,b));c=g.normalizeMax(c);a.homog=u.withUsage(c,"Point")};l.PointOnSegment.getRandomMove=l._helper.getRandPointMove;l.PointOnSegment.stateSize=2;l._helper.projectPointToCircle=
function(a,c){var b=l._helper.CenterOfCircle(a.matrix);b=g.normalizeMax(b);b=g.normalizeMax(g.cross(c,b));a=l._helper.IntersectLC(b,a.matrix);b=g.projectiveDistMinScal(c,a[0]);c=g.projectiveDistMinScal(c,a[1]);return b<c?a[0]:a[1]};l.PointOnArc={};l.PointOnArc.kind="P";l.PointOnArc.signature=["C"];l.PointOnArc.signatureConstraints=function(a){return t.csnames[a.args[0]].isArc};l.PointOnArc.isMovable=!0;l.PointOnArc.initialize=function(a){var c=l._helper.initializePoint(a);a=l.PointOnArc.getParamForInput(a,
c);V(a)};l.PointOnArc.getParamForInput=function(a,c){a=t.csnames[a.args[0]];c=l._helper.projectPointToCircle(a,c);c=g.normalizeMax(g.crossratio3harm(a.startPoint,a.endPoint,a.viaPoint,c,g.ii));a=k.div(c.value[0],c.value[1]);0>a.value.real&&(c=-1>a.value.real?g.realVector([1,0]):g.realVector([0,1]));return c};l.PointOnArc.getParamFromState=function(a){return Z(2)};l.PointOnArc.putParamToState=function(a,c){V(c)};l.PointOnArc.updatePosition=function(a){var c=t.csnames[a.args[0]],b=c.startPoint,d=c.viaPoint,
e=c.endPoint,f=g.ii,h=g.cross(b,f);d=g.cross(d,f);var n=g.cross(e,f);n=g.turnIntoCSList([h,n]);h=g.transpose(n);n=g.conjugate(n);h=g.productMM(n,h);d=g.productMV(n,d);h=g.productMV(g.adjoint2(h),d);d=h.value[0];h=h.value[1];n=Z(2);V(n);b=g.normalizeMax(g.add(g.scalmult(k.mult(d,n.value[0]),b),g.scalmult(k.mult(h,n.value[1]),e)));c=l._helper.conicOtherIntersection(c.matrix,f,b);a.homog=u.withUsage(c,"Point")};l.PointOnArc.getRandomMove=l._helper.getRandPointMove;l.PointOnArc.stateSize=4;l._helper.CenterOfCircle=
function(a){return g.turnIntoCSList([a.value[2].value[0],a.value[2].value[1],k.neg(a.value[0].value[0])])};l._helper.CenterOfConic=function(a){a=g.adjoint3(a);return{ctype:"list",value:[a.value[2].value[0],a.value[2].value[1],a.value[2].value[2]]}};l.CenterOfConic={};l.CenterOfConic.kind="P";l.CenterOfConic.signature=["C"];l.CenterOfConic.updatePosition=function(a){var c=l._helper.CenterOfConic(t.csnames[a.args[0]].matrix);a.homog=c;a.homog=g.normalizeMax(a.homog);a.homog=u.withUsage(a.homog,"Point")};
l._helper.CircleMP=function(a,c){var b=a.value[0],d=a.value[1];a=k.neg(a.value[2]);var e=k.zero;b=g.turnIntoCSList([g.turnIntoCSList([a,e,b]),g.turnIntoCSList([e,a,d]),g.turnIntoCSList([b,d,e])]);d=u.mult(u.mult(c,b),c);c=u.mult(u.mult(c,g.fund),c);d=u.mult(d,g.fund);c=u.mult(c,b);return g.sub(d,c)};l.CircleMP={};l.CircleMP.kind="C";l.CircleMP.signature=["P","P"];l.CircleMP.updatePosition=function(a){a.matrix=l._helper.CircleMP(t.csnames[a.args[0]].homog,t.csnames[a.args[1]].homog);a.matrix=g.normalizeMax(a.matrix);
a.matrix=u.withUsage(a.matrix,"Circle")};l.CircleMr={};l.CircleMr.kind="C";l.CircleMr.signature=["P"];l.CircleMr.isMovable=!0;l.CircleMr.initialize=function(a){ab(k.real(a.radius))};l.CircleMr.getParamForInput=function(a,c,b){if("radius"===b)return c;a=t.csnames[a.args[0]].homog;a=g.normalizeZ(a);c=g.normalizeZ(c);c=g.sub(a,c);return c=g.abs(c)};l.CircleMr.getParamFromState=function(a){return Db()};l.CircleMr.putParamToState=function(a,c){ab(c)};l.CircleMr.updatePosition=function(a){var c=Db();ab(c);
var b=t.csnames[a.args[0]].homog,d=k.mult(b.value[2],c);d=k.mult(d,d);if(!k._helper.isFinite(d)&&!k._helper.isNaN(d))return g.fund;b=l._helper.ScaledCircleMrr(b,d);a.matrix=u.withUsage(b,"Circle");a.radius=c};l.CircleMr.getRandomMove=function(a){a=a.radius;return{type:"radius",value:k.abs(a).value.real<k.eps?k.getRandComplex(.05,.1):k.mult(a,k.getRandReal(.95,1.05))}};l.CircleMr.stateSize=2;l.CircleMr.set_radius=function(a,c){"number"===c.ctype&&Ea(a,c,"radius")};l._helper.ScaledCircleMrr=function(a,
c){var b=a.value[0],d=a.value[1];a=k.neg(a.value[2]);a=g.scalmult(a,g.turnIntoCSList([b,d,a])).value;b=g.turnIntoCSList([b,d]);c=k.sub(g.scalproduct(b,b),c);c=l._helper.buildConicMatrix([a[2],k.zero,a[2],a[0],a[1],c]);return g.normalizeMax(c)};l.Compass={};l.Compass.kind="C";l.Compass.signature=["P","P","P"];l.Compass.updatePosition=function(a){var c=t.csnames[a.args[0]].homog,b=t.csnames[a.args[1]].homog,d=t.csnames[a.args[2]].homog,e=c.value[2],f=b.value[2],h=d.value[2];c=g.scalmult(k.mult(f,h),
c);b=g.scalmult(k.mult(e,h),b);d=g.scalmult(k.mult(e,f),d);c=g.sub(b,c);d=l._helper.ScaledCircleMrr(d,g.scalproduct(c,c));a.matrix=u.withUsage(d,"Circle")};l._helper.getConicType=function(a){if(1E-16>k.abs(g.det(a)).value.real)return"degenerate";var c=k.mult(a.value[0].value[0],a.value[1].value[1]);c=k.sub(c,k.pow(a.value[0].value[1],k.real(2)));c=c.value.real;return 1E-16>Math.abs(c)?"parabola":1E-16<c?"ellipsoid":"hyperbola"};l._helper.ConicBy5=function(a,c,b,d,e,f){a=g.turnIntoCSList([g.cross(b,
d)]);var m=g.turnIntoCSList([g.cross(c,e)]);c=g.turnIntoCSList([g.cross(c,b)]);d=g.turnIntoCSList([g.cross(d,e)]);return l._helper.conicFromTwoDegenerates(a,m,c,d,f)};l._helper.conicFromTwoDegenerates=function(a,c,b,d,e){a=u.mult(g.transpose(c),a);b=u.mult(g.transpose(d),b);a=g.add(a,g.transpose(a));b=g.add(b,g.transpose(b));d=u.mult(u.mult(e,a),e);e=u.mult(u.mult(e,b),e);b=u.mult(d,b);e=u.mult(e,a);return g.sub(b,e)};l.ConicBy5={};l.ConicBy5.kind="C";l.ConicBy5.signature=["P","P","P","P","P"];l.ConicBy5.updatePosition=
function(a){var c=l._helper.ConicBy5(a,t.csnames[a.args[0]].homog,t.csnames[a.args[1]].homog,t.csnames[a.args[2]].homog,t.csnames[a.args[3]].homog,t.csnames[a.args[4]].homog);a.matrix=c;a.matrix=g.normalizeMax(a.matrix);a.matrix=u.withUsage(a.matrix,"Conic")};l.FreeConic={};l.FreeConic.kind="C";l.FreeConic.signature=[];l.FreeConic.initialize=function(a){var c=a.pos?l._helper.inputConic(a.pos):g.zeromatrix(k.real(3),k.real(3));l.FreeConic.putParamToState(a,c)};l.FreeConic.getParamForInput=function(a,
c,b){return g.normalizeMax(c)};l.FreeConic.getParamFromState=function(a){return l._helper.buildConicMatrix(Z(6).value)};l.FreeConic.putParamToState=function(a,c){for(a=0;3>a;++a)for(var b=0;b<=a;++b)ab(c.value[a].value[b])};l.FreeConic.updatePosition=function(a){var c=Z(6);V(c);a.matrix=l._helper.buildConicMatrix(c.value);a.matrix=g.normalizeMax(a.matrix);a.matrix=u.withUsage(a.matrix,"Conic")};l.FreeConic.set_matrix=function(a,c){g._helper.isNumberMatrixMN(c,3,3)&&Ea(a,g.add(c,g.transpose(c)),"matrix")};
l.FreeConic.stateSize=12;l._helper.buildConicMatrix=function(a){var c=a[1],b=a[2],d=a[3],e=a[4],f=a[5];return g.turnIntoCSList([g.turnIntoCSList([a[0],c,d]),g.turnIntoCSList([c,b,e]),g.turnIntoCSList([d,e,f])])};l._helper.flattenConicMatrix=function(a){return g.turnIntoCSList([a.value[0].value[0],a.value[0].value[1],a.value[1].value[1],a.value[0].value[2],a.value[1].value[2],a.value[2].value[2]])};l._helper.splitDegenConic=function(a){var c=g.adjoint3(a),b=0,d,e=k.abs2(c.value[0].value[0]).value.real;
for(d=1;3>d;d++){var f=k.abs2(c.value[d].value[d]).value.real;f>e&&(b=d,e=f)}d=k.sqrt(k.mult(k.real(-1),c.value[b].value[b]));if(1E-16>k.abs2(d).value.real)return a=g.turnIntoCSList([k.zero,k.zero,k.zero]),[a,a];b=k.real(b+1);f=g.column(c,b);f=g.scaldiv(d,f);d=f.value[0];e=f.value[1];f=f.value[2];d=g.turnIntoCSList([g.turnIntoCSList([k.real(0),f,k.mult(k.real(-1),e)]),g.turnIntoCSList([k.mult(k.real(-1),f),k.real(0),d]),g.turnIntoCSList([e,k.mult(k.real(-1),d),k.real(0)])]);a=g.add(a,d);var h=0;for(d=
e=c=0;3>d;d++)for(b=0;3>b;b++)f=k.abs2(a.value[d].value[b]).value.real,f>e&&(h=d,c=b,e=f);d=a.value[h];a=g.transpose(a);a=a.value[c];d=g.normalizeMax(d);a=g.normalizeMax(a);d=u.withUsage(d,"Line");a=u.withUsage(a,"Line");return[d,a]};l._helper.inputConic=function(a){var c="xx xy yy xz yz zz".split(" ").map(function(c){var b=k._helper.input(a[c]);c[0]!==c[1]&&(b=k.realmult(.5,b));return b});return l._helper.buildConicMatrix(c)};l.SelectConic={};l.SelectConic.kind="C";l.SelectConic.signature=["Cs"];
l.SelectConic.initialize=function(a){if(void 0!==a.index)return a.index-1;var c=l._helper.inputConic(a.pos);a=t.csnames[a.args[0]].results;for(var b=g.conicDist(c,a[0]),d=0,e=1;e<a.length;++e){var f=g.conicDist(c,a[e]);f<b&&(b=f,d=e)}return d};l.SelectConic.updatePosition=function(a){a.matrix=t.csnames[a.args[0]].results[a.param];a.matrix=g.normalizeMax(a.matrix);a.matrix=u.withUsage(a.matrix,"Conic")};l._helper.ConicBy4p1l=function(a,c,b,d,e,f){var m=g.scalproduct(c,f),h=g.scalproduct(b,f),n=g.scalproduct(d,
f),p=g.scalproduct(e,f),D=g.det3(b,d,e),q=g.det3(c,b,e),t=g.det3(c,d,e),r=g.det3(c,b,d),u=k.mult;h=k.sqrt(u(u(h,p),u(D,q)));m=k.sqrt(u(u(m,n),u(t,r)));n=g.cross(g.cross(c,d),f);f=g.cross(g.cross(b,e),f);n=g.scalmult(h,n);m=g.scalmult(m,f);f=g.normalizeMax(g.add(n,m));m=g.normalizeMax(g.sub(n,m));m=Sa(f,m);f=l._helper.ConicBy5(a,c,b,d,e,m.value[0]);a=l._helper.ConicBy5(a,c,b,d,e,m.value[1]);return[g.normalizeMax(f),g.normalizeMax(a)]};l.ConicBy4p1l={};l.ConicBy4p1l.kind="Cs";l.ConicBy4p1l.signature=
["P","P","P","P","L"];l.ConicBy4p1l.updatePosition=function(a){var c=l._helper.ConicBy4p1l(a,t.csnames[a.args[0]].homog,t.csnames[a.args[1]].homog,t.csnames[a.args[2]].homog,t.csnames[a.args[3]].homog,t.csnames[a.args[4]].homog);a.results=c};l.ConicBy4p1l.stateSize=Sa.stateSize;l._helper.ConicBy3p2l=function(a,c,b,d,e){function f(a,c,b,d){return k.sub(k.mult(a,d),k.mult(c,b))}var m=g.cross(a,c),h=g.cross(d,e);d=g.cross(d,m);e=g.cross(e,m);m=g.turnIntoCSList([d,e,h]);b=g.productVM(b,g.adjoint3(m));
h=g.adjoint3(g.turnIntoCSList([g.scalmult(b.value[0],d),g.scalmult(b.value[1],e),g.scalmult(b.value[2],h)]));b=g.transpose(h);d=k.mult;e=g.productMV(b,a);a=e.value[0];e=e.value[1];m=g.productMV(b,c);c=m.value[0];m=m.value[1];var l=k.sqrt(d(a,e)),n=k.sqrt(d(c,m)),p,q=Array(4);for(p=0;4>p;++p){var D=(p&2)-1,t=d(k.real(((p&1)<<1)-1),l),r=d(k.real(D),n),u=f(e,t,m,r),v=f(c,r,a,t);D=f(a,e,c,m);var w=k.add(k.add(f(c,m,a,e),f(m,r,e,t)),f(r,c,t,a));t=d(u,u);r=d(v,v);var P=d(w,w),x=d(u,v);u=d(u,w);v=d(v,w);
x=k.sub(x,d(k.real(.5),d(D,D)));D=g.turnIntoCSList([g.turnIntoCSList([t,x,u]),g.turnIntoCSList([x,r,v]),g.turnIntoCSList([u,v,P])]);D=g.productMM(h,g.productMM(D,b));D=g.turnIntoCSList([D.value[0].value[0],D.value[0].value[1],D.value[0].value[2],D.value[1].value[1],D.value[1].value[2],D.value[2].value[2]]);q[p]=D}return q};l.ConicBy3p2l={};l.ConicBy3p2l.kind="Cs";l.ConicBy3p2l.signature=["P","P","P","L","L"];l.ConicBy3p2l.updatePosition=function(a){var c=l._helper.ConicBy3p2l(t.csnames[a.args[0]].homog,
t.csnames[a.args[1]].homog,t.csnames[a.args[2]].homog,t.csnames[a.args[3]].homog,t.csnames[a.args[4]].homog);c=Nd(c);for(var b=Array(4),d=0;4>d;++d){var e=c[d].value;b[d]=g.turnIntoCSList([g.turnIntoCSList([e[0],e[1],e[2]]),g.turnIntoCSList([e[1],e[3],e[4]]),g.turnIntoCSList([e[2],e[4],e[5]])])}a.results=b};l.ConicBy3p2l.stateSize=48;l.ConicBy2p3l={};l.ConicBy2p3l.kind="Cs";l.ConicBy2p3l.signature=["P","P","L","L","L"];l.ConicBy2p3l.updatePosition=function(a){var c=l._helper.ConicBy3p2l(t.csnames[a.args[2]].homog,
t.csnames[a.args[3]].homog,t.csnames[a.args[4]].homog,t.csnames[a.args[0]].homog,t.csnames[a.args[1]].homog);c=Nd(c);for(var b=Array(4),d=0;4>d;++d){var e=c[d].value;e=g.turnIntoCSList([g.turnIntoCSList([e[0],e[1],e[2]]),g.turnIntoCSList([e[1],e[3],e[4]]),g.turnIntoCSList([e[2],e[4],e[5]])]);b[d]=g.normalizeMax(g.adjoint3(e))}a.results=b};l.ConicBy2p3l.stateSize=48;l.ConicBy1p4l={};l.ConicBy1p4l.kind="Cs";l.ConicBy1p4l.signature=["P","L","L","L","L"];l.ConicBy1p4l.updatePosition=function(a){var c=
l._helper.ConicBy4p1l(a,t.csnames[a.args[1]].homog,t.csnames[a.args[2]].homog,t.csnames[a.args[3]].homog,t.csnames[a.args[4]].homog,t.csnames[a.args[0]].homog),b=c[0];c=c[1];b=g.adjoint3(b);c=g.adjoint3(c);c=[b,c];a.results=c};l.ConicBy1p4l.stateSize=Sa.stateSize;l.ConicParabolaPL={};l.ConicParabolaPL.kind="C";l.ConicParabolaPL.signature=["P","L"];l.ConicParabolaPL.updatePosition=function(a){var c=t.csnames[a.args[0]].homog.value,b=t.csnames[a.args[1]].homog.value,d=k.mult,e=k.neg,f=k.add,h=k.sub,
n=c[0],p=c[1],q=c[2],r=b[0];c=b[1];b=b[2];var v=d(q,q),w=d(r,r),x=d(c,c),y=d(q,b),z=e(q);q=f(w,x);x=d(v,x);w=d(v,w);e=d(e(v),d(r,c));r=d(z,f(d(n,q),d(y,r)));c=d(z,f(d(p,q),d(y,c)));d=h(d(f(d(n,n),d(p,p)),q),d(v,d(b,b)));d=l._helper.buildConicMatrix([x,e,w,r,c,d]);d=g.normalizeMax(d);a.matrix=u.withUsage(d,"Conic")};l.ConicBy2Foci1P={};l.ConicBy2Foci1P.kind="Cs";l.ConicBy2Foci1P.signature=["P","P","P"];l.ConicBy2Foci1P.updatePosition=function(a){var c=t.csnames[a.args[0]].homog,b=t.csnames[a.args[1]].homog,
d=t.csnames[a.args[2]].homog,e=g.ii,f=g.jj,h=g.normalizeMax(g.cross(c,d)),n=g.normalizeMax(g.cross(b,d)),p=g.normalizeMax(g.cross(d,e));d=g.normalizeMax(g.cross(d,f));n=l._helper.coHarmonic(p,d,h,n);h=g.normalizeMax(n[0]);n=g.normalizeMax(n[1]);e=g.turnIntoCSList([e]);p=g.turnIntoCSList([f]);d=g.turnIntoCSList([c]);var q=g.turnIntoCSList([b]);f=l._helper.conicFromTwoDegenerates(e,p,d,q,h);f=g.normalizeMax(f);e=l._helper.conicFromTwoDegenerates(e,p,d,q,n);e=g.normalizeMax(e);f=g.normalizeMax(g.adjoint3(f));
e=g.normalizeMax(g.adjoint3(e));"ellipsoid"!==l._helper.getConicType(f)&&(h=f,f=e,e=h);g.almostequals(c,b).value&&(c=k.real(3),e=g.zeromatrix(c,c));a.results=[f,e]};l.ConicBy2Pol1P={};l.ConicBy2Pol1P.kind="C";l.ConicBy2Pol1P.signature=["P","L","P","L","P"];l.ConicBy2Pol1P.updatePosition=function(a){var c=t.csnames[a.args[0]].homog,b=t.csnames[a.args[1]].homog,d=t.csnames[a.args[2]].homog,e=t.csnames[a.args[3]].homog,f=t.csnames[a.args[4]].homog,h=g.scalproduct,l=g.scalmult,n=g.sub,p=g.productMM,q=
k.realmult,r=g.transpose,v=g.turnIntoCSList,w=n(l(h(b,c),f),l(q(2,h(b,f)),c)),x=n(l(h(e,d),f),l(q(2,h(e,f)),d)),y=v([g.cross(c,f)]);f=v([g.cross(d,f)]);x=p(r(y),v([g.cross(c,x)]));v=p(r(f),v([g.cross(d,w)]));p=p(r(y),f);c=h(c,e);b=h(d,b);d=g.add(l(b,x),l(c,v));d=n(d,l(q(2,k.mult(c,b)),p));d=g.add(d,r(d));d=g.normalizeMax(d);d=u.withUsage(d,"Conic");a.matrix=d};l.ConicBy2Pol1L={};l.ConicBy2Pol1L.kind="C";l.ConicBy2Pol1L.signature=["P","L","P","L","L"];l.ConicBy2Pol1L.updatePosition=function(a){var c=
t.csnames[a.args[0]].homog,b=t.csnames[a.args[1]].homog,d=t.csnames[a.args[2]].homog,e=t.csnames[a.args[3]].homog,f=t.csnames[a.args[4]].homog,h=g.scalproduct,l=g.scalmult,n=g.productMM,p=k.mult,q=g.transpose,r=g.turnIntoCSList,v=h(b,c),w=h(b,d),x=h(e,c),y=h(e,d),z=h(f,c);h=h(f,d);var A=r([g.sub(l(p(x,h),b),l(p(w,z),e))]);c=g.add(n(q(r([l(p(x,w),f)])),r([g.sub(g.add(l(k.sub(p(v,h),p(w,z)),e),l(k.sub(p(y,z),p(x,h)),b)),l(g.det3(b,e,f),g.cross(c,d)))])),n(q(A),A));c=g.add(c,q(c));c=g.normalizeMax(c);
c=u.withUsage(c,"Conic");a.matrix=c};l._helper.conic1Pol3Inc=function(a,c,b,d,e){var f=g.scalproduct,m=g.scalmult,h=g.productMM,l=g.cross,n=k.realmult,p=k.mult,q=g.transpose,r=g.turnIntoCSList,t=g.det3,D=t(a,b,d),u=r([l(b,e)]),v=r([l(a,e)]),w=r([l(b,d)]),x=f(c,a),y=f(c,b);c=f(c,e);l=r([l(d,g.sub(m(x,e),m(n(2,c),a)))]);u=m(D,h(q(u),l));a=n(2,k.add(p(t(a,d,e),y),p(D,c)));a=k.sub(p(t(b,d,e),x),a);u=g.add(u,m(a,h(q(v),w)));u=g.add(u,q(u));return u=g.normalizeMax(u)};l.ConicBy1Pol3P={};l.ConicBy1Pol3P.kind=
"C";l.ConicBy1Pol3P.signature=["P","L","P","P","P"];l.ConicBy1Pol3P.updatePosition=function(a){var c=l._helper.conic1Pol3Inc(t.csnames[a.args[0]].homog,t.csnames[a.args[1]].homog,t.csnames[a.args[2]].homog,t.csnames[a.args[3]].homog,t.csnames[a.args[4]].homog);c=u.withUsage(c,"Conic");a.matrix=c};l.ConicBy1Pol3L={};l.ConicBy1Pol3L.kind="C";l.ConicBy1Pol3L.signature=["P","L","L","L","L"];l.ConicBy1Pol3L.updatePosition=function(a){var c=l._helper.conic1Pol3Inc(t.csnames[a.args[1]].homog,t.csnames[a.args[0]].homog,
t.csnames[a.args[2]].homog,t.csnames[a.args[3]].homog,t.csnames[a.args[4]].homog);c=g.normalizeMax(g.adjoint3(c));c=u.withUsage(c,"Conic");a.matrix=c};l.ConicBy1Pol2P1L={};l.ConicBy1Pol2P1L.kind="Cs";l.ConicBy1Pol2P1L.signature=["P","L","P","P","L"];l.ConicBy1Pol2P1L.updatePosition=function(a){var c=t.csnames[a.args[0]].homog,b=t.csnames[a.args[1]].homog,d=t.csnames[a.args[2]].homog,e=t.csnames[a.args[3]].homog,f=t.csnames[a.args[4]].homog,h=k.add,l=g.turnIntoCSList,n=g.cross,p=g.productMM,q=k.mult,
r=k.realmult,u=g.scalmult,v=g.scalproduct,w=k.sub,x=g.transpose,y=v(b,c),z=v(b,d),A=v(b,e);b=v(f,c);var B=v(f,d);v=v(f,e);f=l([n(c,d)]);c=l([n(c,e)]);d=l([n(d,e)]);e=k.sqrt(q(q(B,v),q(w(q(y,B),r(2,q(b,z))),w(q(y,v),r(2,q(b,A))))));l=p(x(f),c);e=u(e,g.add(l,x(l)));h=u(w(q(y,q(B,v)),h(q(b,q(z,v)),q(b,q(B,A)))),l);r=g.add(g.sub(u(A,f),u(z,c)),u(r(.5,y),d));h=g.add(h,u(q(b,b),p(x(d),r)));h=g.add(h,x(h));p=g.normalizeMax(g.add(e,h));q=g.normalizeMax(g.sub(e,h));a.results=Rb(p,q).value};l.ConicBy1Pol2P1L.stateSize=
Rb.stateSize;l.ConicBy1Pol1P2L={};l.ConicBy1Pol1P2L.kind="Cs";l.ConicBy1Pol1P2L.signature=["P","L","P","L","L"];l.ConicBy1Pol1P2L.updatePosition=function(a){var c=t.csnames[a.args[0]].homog,b=t.csnames[a.args[1]].homog,d=t.csnames[a.args[2]].homog,e=t.csnames[a.args[3]].homog,f=t.csnames[a.args[4]].homog,h=k.add,l=g.turnIntoCSList,n=g.cross,p=g.productMM,q=k.mult,r=k.realmult,u=g.scalmult,v=g.scalproduct,w=k.sub,x=g.transpose,y=v(b,c),z=v(b,d),A=v(e,c),B=v(e,d),C=v(f,c),E=v(f,d),G=q(y,y),H=q(y,z);
v=q(z,z);var I=q(A,A),J=q(A,B),K=q(B,B),N=q(C,C),L=q(C,E),Q=q(E,E),O=q(q(G,K),Q);O=w(O,r(2,q(q(H,J),Q)));O=w(O,r(2,q(q(H,K),L)));O=h(O,r(.5,q(q(v,I),Q)));O=h(O,r(3,q(q(v,J),L)));O=h(O,r(.5,q(q(v,K),N)));L=q(q(y,B),E);L=w(L,q(q(z,A),E));L=w(L,q(q(z,B),C));L=q(L,q(v,C));Q=w(q(y,B),r(2,q(z,A)));Q=q(Q,q(v,q(B,C)));O=p(x(l([b])),l([g.add(g.add(u(O,b),u(L,e)),u(Q,f))]));L=l([e]);O=g.add(O,u(r(.5,q(q(v,v),N)),p(x(L),L)));O=g.add(O,u(v,p(x(l([f])),l([g.add(u(w(w(r(2,q(H,J)),q(G,K)),r(.5,q(v,I))),f),u(q(g.det3(b,
e,f),w(q(y,B),q(z,A))),n(c,d)))]))));O=g.add(O,x(O));c=k.sqrt(q(q(B,E),q(w(q(y,B),r(2,q(z,A))),w(q(y,E),r(2,q(z,C))))));b=p(x(l([b])),l([g.sub(u(w(q(z,h(q(A,E),q(B,C))),q(y,q(B,E))),b),u(v,g.add(u(C,e),u(A,f))))]));b=g.add(b,u(q(y,v),p(x(l([e])),l([f]))));b=u(c,b);b=g.add(b,x(b));e=g.normalizeMax(g.add(O,b));f=g.normalizeMax(g.sub(O,b));a.results=Rb(e,f).value};l.ConicBy1Pol1P2L.stateSize=Rb.stateSize;l._helper.coHarmonic=function(a,c,b,d){var e=g.realVector([100*Math.random(),100*Math.random(),1]),
f=g.det3(e,b,a),m=g.det3(e,b,c);b=g.det3(e,d,a);d=g.det3(e,d,c);d=k.sqrt(k.mult(d,m));f=k.sqrt(k.mult(b,f));a=u.mult(a,d);f=u.mult(c,f);c=g.add(a,f);a=g.sub(a,f);return[c,a]};l.ConicInSquare={};l.ConicInSquare.kind="C";l.ConicInSquare.signature=["P","P","P","P"];l.ConicInSquare.updatePosition=function(a){var c=C.basismap(t.csnames[a.args[0]].homog,t.csnames[a.args[1]].homog,t.csnames[a.args[2]].homog,t.csnames[a.args[3]].homog),b=k.one;b=l._helper.buildConicMatrix([b,b,b,k.real(-3),b,b]);c=g.adjoint3(c);
c=g.productMM(g.productMM(g.transpose(c),b),c);c=g.normalizeMax(c);a.matrix=u.withUsage(c,"Conic")};l.ConicBy5lines={};l.ConicBy5lines.kind="C";l.ConicBy5lines.signature=["L","L","L","L","L"];l.ConicBy5lines.updatePosition=function(a){var c=l._helper.ConicBy5(a,t.csnames[a.args[0]].homog,t.csnames[a.args[1]].homog,t.csnames[a.args[2]].homog,t.csnames[a.args[3]].homog,t.csnames[a.args[4]].homog);c=g.adjoint3(c);a.matrix=c;a.matrix=g.normalizeMax(a.matrix);a.matrix=u.withUsage(a.matrix,"Conic")};l.ConicFromPrincipalDirections=
{};l.ConicFromPrincipalDirections.kind="C";l.ConicFromPrincipalDirections.signature=["P","P","P"];l.ConicFromPrincipalDirections.updatePosition=function(a){var c=t.csnames[a.args[0]].homog,b=t.csnames[a.args[1]].homog,d=t.csnames[a.args[2]].homog,e=l._helper.pointReflection(c,b),f=g.cross(b,c);c=g.turnIntoCSList([f.value[0],f.value[1],k.zero]);f=g.turnIntoCSList([f]);b=g.turnIntoCSList([g.cross(b,c)]);e=g.turnIntoCSList([g.cross(e,c)]);a.matrix=l._helper.conicFromTwoDegenerates(f,f,b,e,d);a.matrix=
g.normalizeMax(a.matrix);a.matrix=u.withUsage(a.matrix,"Conic")};l.CircleBy3={};l.CircleBy3.kind="C";l.CircleBy3.signature=["P","P","P"];l.CircleBy3.updatePosition=function(a){var c=l._helper.ConicBy5(a,t.csnames[a.args[0]].homog,t.csnames[a.args[1]].homog,g.ii,g.jj,t.csnames[a.args[2]].homog);a.matrix=g.normalizeMax(c);a.matrix=u.withUsage(a.matrix,"Circle")};l.ArcBy3={};l.ArcBy3.kind="C";l.ArcBy3.signature=["P","P","P"];l.ArcBy3.updatePosition=function(a){l.CircleBy3.updatePosition(a);a.startPoint=
t.csnames[a.args[0]].homog;a.viaPoint=t.csnames[a.args[1]].homog;a.endPoint=t.csnames[a.args[2]].homog};l.ArcBy3.initialize=function(a){a.startPoint=t.csnames[a.args[0]].homog;a.viaPoint=t.csnames[a.args[1]].homog;a.endPoint=t.csnames[a.args[2]].homog;a.isArc=!0};l.PolarOfPoint={};l.PolarOfPoint.kind="L";l.PolarOfPoint.signature=["P","C"];l.PolarOfPoint.updatePosition=function(a){var c=u.mult(t.csnames[a.args[1]].matrix,t.csnames[a.args[0]].homog);c=g.normalizeMax(c);a.homog=u.withUsage(c,"Line")};
l.PolarOfLine={};l.PolarOfLine.kind="P";l.PolarOfLine.signature=["L","C"];l.PolarOfLine.updatePosition=function(a){var c=t.csnames[a.args[0]],b=g.adjoint3(t.csnames[a.args[1]].matrix);c=u.mult(b,c.homog);c=g.normalizeMax(c);a.homog=u.withUsage(c,"Point")};l.AngleBisector={};l.AngleBisector.kind="Ls";l.AngleBisector.signature=["L","L","P"];l.AngleBisector.updatePosition=function(a){var c=t.csnames[a.args[0]].homog,b=t.csnames[a.args[1]].homog,d=t.csnames[a.args[2]].homog,e=g.add,f=g.sub,k=g.abs,h=
g.cross,l=g.scalmult,n=g.normalizeMax,p=g._helper.isAlmostZero,q=g.linfty,r=l(k(h(h(q,b),q)),c);c=l(k(h(h(q,c),q)),b);f=f(r,c);e=e(r,c);p(f)&&(f=h(h(h(q,e),q),d));p(e)&&(e=h(h(h(q,f),q),d));a.results=Sa(n(f),n(e))};l.AngleBisector.stateSize=Sa.stateSize;l._helper.IntersectLC=function(a,c){var b=k,d=g.crossOperator(a),e=g.transpose(d);c=u.mult(e,u.mult(c,d));e=g.maxIndex(a,k.abs2);if(0===e){e=c.value[1].value[1];var f=c.value[1].value[2];var h=c.value[2].value[1];var l=c.value[2].value[2];a=a.value[0]}else 1===
e?(e=c.value[0].value[0],f=c.value[0].value[2],h=c.value[2].value[0],l=c.value[2].value[2],a=a.value[1]):(e=c.value[0].value[0],f=c.value[0].value[1],h=c.value[1].value[0],l=c.value[1].value[1],a=a.value[2]);b=b.div(b.sqrt(b.sub(b.mult(f,h),b.mult(e,l))),a);b=g.add(c,g.scalmult(b,d));e=g.maxIndex(b,g.abs2);d=b.value[e];d=g.normalizeMax(d);d=u.withUsage(d,"Point");b=g.transpose(b);e=g.maxIndex(b,g.abs2);b=b.value[e];b=g.normalizeMax(b);b=u.withUsage(b,"Point");return[d,b]};l.IntersectLC={};l.IntersectLC.kind=
"Ps";l.IntersectLC.signature=["L","C"];l.IntersectLC.updatePosition=function(a){var c=l._helper.IntersectLC(t.csnames[a.args[0]].homog,t.csnames[a.args[1]].matrix);a.results=Sa(c[0],c[1])};l.IntersectLC.stateSize=Sa.stateSize;l.OtherIntersectionCL={};l.OtherIntersectionCL.kind="P";l.OtherIntersectionCL.signature=["C","L","P"];l.OtherIntersectionCL.updatePosition=function(a){var c=t.csnames[a.args[2]].homog,b=l._helper.IntersectLC(t.csnames[a.args[1]].homog,t.csnames[a.args[0]].matrix),d=b[0];b=b[1];
var e=g.projectiveDistMinScal(d,c);c=g.projectiveDistMinScal(b,c);a.homog=e<c?b:d;a.homog=g.normalizeMax(a.homog);a.homog=u.withUsage(a.homog,"Point")};l.IntersectCirCir={};l.IntersectCirCir.kind="Ps";l.IntersectCirCir.signature=["C","C"];l.IntersectCirCir.updatePosition=function(a){var c=t.csnames[a.args[0]].matrix,b=t.csnames[a.args[1]].matrix,d=g.scalmult(b.value[0].value[0],c.value[2]);b=g.scalmult(c.value[0].value[0],b.value[2]);d=g.sub(d,b);d=g.turnIntoCSList([d.value[0],d.value[1],k.realmult(.5,
d.value[2])]);d=g.normalizeMax(d);c=l._helper.IntersectLC(d,c);a.results=Sa(c[0],c[1])};l.IntersectCirCir.stateSize=Sa.stateSize;l.OtherIntersectionCC={};l.OtherIntersectionCC.kind="P";l.OtherIntersectionCC.signature=["C","C","P"];l.OtherIntersectionCC.updatePosition=function(a){var c=t.csnames[a.args[0]].matrix,b=t.csnames[a.args[1]].matrix,d=t.csnames[a.args[2]].homog,e=g.scalmult(b.value[0].value[0],c.value[2]);b=g.scalmult(c.value[0].value[0],b.value[2]);e=g.sub(e,b);e=g.turnIntoCSList([e.value[0],
e.value[1],k.realmult(.5,e.value[2])]);e=g.normalizeMax(e);e=l._helper.IntersectLC(e,c);c=e[0];e=e[1];b=g.projectiveDistMinScal(c,d);d=g.projectiveDistMinScal(e,d);a.homog=b<d?e:c;a.homog=g.normalizeMax(a.homog);a.homog=u.withUsage(a.homog,"Point")};l._helper.IntersectConicConic=function(a,c){var b=a.value[0],d=a.value[1],e=a.value[2],f=c.value[0],h=c.value[1],n=c.value[2],p=g.det3(b,d,e),q=k.add(k.add(g.det3(b,d,n),g.det3(b,h,e)),g.det3(f,d,e));b=k.add(k.add(g.det3(b,h,n),g.det3(f,d,n)),g.det3(f,
h,e));f=g.det3(f,h,n);n=k.abs2(p).value.real;h=k.abs2(f).value.real;n<h&&(n=a,a=c,c=n,n=f,f=p,p=n,n=b,b=q,q=n,n=h);1E-24>n?(p=a,q=c):(q=k.solveCubic(p,q,b,f),b=k.abs2(k.sub(q[0],q[1])).value.real,f=k.abs2(k.sub(q[0],q[2])).value.real,h=k.abs2(k.sub(q[1],q[2])).value.real,b>f?(p=q[1],q=b>h?q[0]:q[2]):(p=q[2],q=f>h?q[0]:q[1]),p=g.add(g.scalmult(p,a),c),q=g.add(g.scalmult(q,a),c));c=l._helper.splitDegenConic(p);a=c[0];c=c[1];p=l._helper.splitDegenConic(q);b=p[0];q=p[1];p=g.cross(a,b);b=g.cross(c,b);
a=g.cross(a,q);c=g.cross(c,q);p=g.normalizeMax(p);b=g.normalizeMax(b);a=g.normalizeMax(a);c=g.normalizeMax(c);p=u.withUsage(p,"Point");b=u.withUsage(b,"Point");a=u.withUsage(a,"Point");c=u.withUsage(c,"Point");return[p,b,a,c]};l.IntersectConicConic={};l.IntersectConicConic.kind="Ps";l.IntersectConicConic.signature=["C","C"];l.IntersectConicConic.updatePosition=function(a){var c=l._helper.IntersectConicConic(t.csnames[a.args[0]].matrix,t.csnames[a.args[1]].matrix);c=Jc(c[0],c[1],c[2],c[3]);a.results=
c};l.IntersectConicConic.stateSize=Jc.stateSize;l.SelectP={};l.SelectP.kind="P";l.SelectP.signature=["Ps"];l.SelectP.initialize=function(a){if(void 0!==a.index)return a.index-1;var c=t.csnames[a.args[0]].results.value;a=l._helper.initializePoint(a);for(var b=g.projectiveDistMinScal(a,c[0]),d=0,e=1;e<c.length;++e){var f=g.projectiveDistMinScal(a,c[e]);f<b&&(b=f,d=e)}return d};l.SelectP.updatePosition=function(a){a.homog=t.csnames[a.args[0]].results.value[a.param]};l.SelectL={};l.SelectL.kind="L";l.SelectL.signature=
["Ls"];l.SelectL.initialize=function(a){if(void 0!==a.index)return a.index-1;var c=t.csnames[a.args[0]].results.value;a=l._helper.initializeLine(a);for(var b=g.projectiveDistMinScal(a,c[0]),d=0,e=1;e<c.length;++e){var f=g.projectiveDistMinScal(a,c[e]);f<b&&(b=f,d=e)}return d};l.SelectL.updatePosition=function(a){a.homog=t.csnames[a.args[0]].results.value[a.param];a.homog=u.withUsage(a.homog,"Line")};l._helper.moebiusStep=function(a,c,b){var d=k.add,e=k.sub,f=k.mult,g=a.value[0],m=a.value[1];a=a.value[2];
var h=c.value[0],l=c.value[1];c=c.value[2];var n=b.value[0],p=b.value[1],q=b.value[2];b=e(f(c,n),f(h,q));var r=e(f(c,p),f(l,q));n=e(f(g,q),f(a,n));p=e(f(m,q),f(a,p));return[e(f(g,b),f(m,r)),d(f(m,b),f(g,r)),f(a,b),f(a,r),e(f(h,n),f(l,p)),d(f(l,n),f(h,p)),f(c,n),f(c,p)]};l.TrMoebius={};l.TrMoebius.kind="Mt";l.TrMoebius.signature="PPPPPP".split("");l.TrMoebius.updatePosition=function(a){var c=k.neg,b=l._helper.moebiusStep(t.csnames[a.args[0]].homog,t.csnames[a.args[2]].homog,t.csnames[a.args[4]].homog),
d=l._helper.moebiusStep(t.csnames[a.args[1]].homog,t.csnames[a.args[3]].homog,t.csnames[a.args[5]].homog);d=g.normalizeMax(g.matrix([[d[0],c(d[1]),d[4],c(d[5])],[d[1],d[0],d[5],d[4]],[d[2],c(d[3]),d[6],c(d[7])],[d[3],d[2],d[7],d[6]]]));c=g.normalizeMax(g.matrix([[b[6],c(b[4])],[b[7],c(b[5])],[c(b[2]),b[0]],[c(b[3]),b[1]]]));c=g.normalizeMax(g.productMM(d,c));a.moebius={anti:!1,ar:c.value[0].value[0],ai:c.value[1].value[0],br:c.value[0].value[1],bi:c.value[1].value[1],cr:c.value[2].value[0],ci:c.value[3].value[0],
dr:c.value[2].value[1],di:c.value[3].value[1]};l._helper.moebiusPair(a)};l._helper.moebiusPair=function(a){var c=a.moebius,b=k.neg,d=c.anti?b:u.identity;c=g.normalizeMax(g.turnIntoCSList([g.matrix([[b(c.cr),d(c.ci),b(c.dr)],[c.ci,d(c.cr),c.di],[c.ar,b(d(c.ai)),c.br]]),g.matrix([[b(c.ci),b(d(c.cr)),b(c.di)],[b(c.cr),d(c.ci),b(c.dr)],[c.ai,d(c.ar),c.bi]])]));a.mat1=c.value[0];a.mat2=c.value[1]};l._helper.inverseMoebius=function(a){var c=k.neg,b=a.anti?c:u.identity;return{anti:a.anti,ar:a.dr,ai:b(a.di),
br:c(a.br),bi:c(b(a.bi)),cr:c(a.cr),ci:c(b(a.ci)),dr:a.ar,di:b(a.ai)}};l.TrInverseMoebius={};l.TrInverseMoebius.kind="Mt";l.TrInverseMoebius.signature=["Mt"];l.TrInverseMoebius.updatePosition=function(a){a.moebius=l._helper.inverseMoebius(t.csnames[a.args[0]].moebius);l._helper.moebiusPair(a)};l.TrMoebiusP={};l.TrMoebiusP.kind="P";l.TrMoebiusP.signature=["Mt","P"];l.TrMoebiusP.updatePosition=function(a){var c=t.csnames[a.args[0]],b=t.csnames[a.args[1]].homog,d=g.productMV(c.mat1,b);c=g.productMV(c.mat2,
b);a.homog=g.normalizeMax(g.cross(d,c));a.homog=u.withUsage(a.homog,"Point")};l._helper.TrMoebiusP=function(a,c){var b=g.productMV(c.mat1,a);a=g.productMV(c.mat2,a);return g.normalizeMax(g.cross(b,a))};l.TrMoebiusL={};l.TrMoebiusL.kind="C";l.TrMoebiusL.signature=["Mt","L"];l.TrMoebiusL.updatePosition=function(a){var b=t.csnames[a.args[0]],d=t.csnames[a.args[1]].homog,e=function(){var a=g.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);return g.normalizeMax(a)},f=g.cross(e(),d),k=
g.cross(e(),d);d=g.cross(e(),d);f=l._helper.TrMoebiusP(f,b);k=l._helper.TrMoebiusP(k,b);b=l._helper.TrMoebiusP(d,b);a.matrix=g.normalizeMax(l._helper.ConicBy5(null,f,k,b,g.ii,g.jj));a.matrix=u.withUsage(a.matrix,"Circle")};l.TrMoebiusS={};l.TrMoebiusS.kind="C";l.TrMoebiusS.signature=["Mt","S"];l.TrMoebiusS.updatePosition=function(a){var b=t.csnames[a.args[0]],d=t.csnames[a.args[1]],e=d.startpos;d=d.endpos;var f=g.add(e,d);e=l._helper.TrMoebiusP(e,b);f=l._helper.TrMoebiusP(f,b);b=l._helper.TrMoebiusP(d,
b);a.startPoint=e;a.viaPoint=f;a.endPoint=b;a.isArc=!0;a.matrix=g.normalizeMax(l._helper.ConicBy5(null,e,f,b,g.ii,g.jj));a.matrix=u.withUsage(a.matrix,"Circle")};l.TrMoebiusC={};l.TrMoebiusC.kind="C";l.TrMoebiusC.signature=["Mt","C"];l.TrMoebiusC.signatureConstraints=function(a){return"Circle"===t.csnames[a.args[1]].matrix.usage};l.TrMoebiusC.updatePosition=function(a){var b=t.csnames[a.args[0]],d=t.csnames[a.args[1]].matrix,e=function(){var a=g.realVector([Math.random()-.5,Math.random()-.5,Math.random()-
.5]);return g.normalizeMax(a)},f=l._helper.IntersectLC(e(),d);e=l._helper.IntersectLC(e(),d);d=f[1];e=e[1];f=l._helper.TrMoebiusP(f[0],b);d=l._helper.TrMoebiusP(d,b);b=l._helper.TrMoebiusP(e,b);a.matrix=g.normalizeMax(l._helper.ConicBy5(null,f,d,b,g.ii,g.jj));a.matrix=u.withUsage(a.matrix,"Circle")};l.TrMoebiusArc={};l.TrMoebiusArc.kind="C";l.TrMoebiusArc.signature=["Mt","C"];l.TrMoebiusArc.signatureConstraints=function(a){return t.csnames[a.args[1]].isArc};l.TrMoebiusArc.updatePosition=function(a){var b=
t.csnames[a.args[0]],d=t.csnames[a.args[1]],e=d.viaPoint,f=d.endPoint;d=l._helper.TrMoebiusP(d.startPoint,b);e=l._helper.TrMoebiusP(e,b);b=l._helper.TrMoebiusP(f,b);a.startPoint=d;a.viaPoint=e;a.endPoint=b;a.isArc=!0;a.matrix=g.normalizeMax(l._helper.ConicBy5(null,d,e,b,g.ii,g.jj));a.matrix=u.withUsage(a.matrix,"Circle")};l._helper.trBuildMatrix=function(a,b){var c=b(0);b=b(1);var d=g.productMM(b,g.adjoint3(c));a.matrix=g.normalizeMax(d);d=g.transpose(g.productMM(c,g.adjoint3(b)));a.dualMatrix=g.normalizeMax(d)};
l.TrProjection={};l.TrProjection.kind="Tr";l.TrProjection.signature="PPPPPPPP".split("");l.TrProjection.initialize=function(a){a.isEuclidean=0};l.TrProjection.updatePosition=function(a){l._helper.trBuildMatrix(a,function(b){return C.basismap(t.csnames[a.args[0+b]].homog,t.csnames[a.args[2+b]].homog,t.csnames[a.args[4+b]].homog,t.csnames[a.args[6+b]].homog)})};l.TrAffine={};l.TrAffine.kind="Tr";l.TrAffine.signature="PPPPPP".split("");l.TrAffine.initialize=function(a){a.isEuclidean=0};l.TrAffine.updatePosition=
function(a){var b=k.mult,d=g.scalmult,e=g.turnIntoCSList,f=g.transpose,h=g.normalizeMax,l=g.productMM,n=g.adjoint3,p=e([t.csnames[a.args[0]].homog,t.csnames[a.args[2]].homog,t.csnames[a.args[4]].homog]),q=e([t.csnames[a.args[1]].homog,t.csnames[a.args[3]].homog,t.csnames[a.args[5]].homog]),r=f(p);f=f(q);var u=r.value[2].value,v=f.value[2].value,w=[b(u[0],v[2]),b(u[1],v[0]),b(u[2],v[1])];r=n(r).value;a.matrix=h(l(f,e([d(b(w[0],v[1]),r[0]),d(b(w[1],v[2]),r[1]),d(b(w[2],v[0]),r[2])])));r=p.value;a.dualMatrix=
h(l(n(q),e([d(b(u[2],w[1]),r[0]),d(b(u[0],w[2]),r[1]),d(b(u[1],w[0]),r[2])])))};l.TrSimilarity={};l.TrSimilarity.kind="Tr";l.TrSimilarity.signature=["P","P","P","P"];l.TrSimilarity.initialize=function(a){a.isEuclidean=1};l.TrSimilarity.updatePosition=function(a){l._helper.trBuildMatrix(a,function(b){return C.basismap(t.csnames[a.args[0+b]].homog,t.csnames[a.args[2+b]].homog,g.ii,g.jj)})};l.TrTranslation={};l.TrTranslation.kind="Tr";l.TrTranslation.signature=["P","P"];l.TrTranslation.initialize=function(a){a.isEuclidean=
1};l.TrTranslation.updatePosition=function(a){var b=t.csnames[a.args[0]].homog,d=t.csnames[a.args[1]].homog,e=g.cross(b,d).value;b=k.mult(b.value[2],d.value[2]);d=g.turnIntoCSList;var f=k.neg,h=k.zero;e=d([d([b,h,e[1]]),d([h,b,f(e[0])]),d([h,h,b])]);e=g.normalizeMax(e);a.matrix=e;b=f(e.value[0].value[0]);e=d([d([b,h,h]),d([h,b,h]),d([e.value[0].value[2],e.value[1].value[2],b])]);a.dualMatrix=e};l.TrReflectionP={};l.TrReflectionP.kind="Tr";l.TrReflectionP.signature=["P"];l.TrReflectionP.initialize=
function(a){a.isEuclidean=1};l.TrReflectionP.updatePosition=function(a){var b=t.csnames[a.args[0]].homog.value,d=k.realmult(-.5,b[2]),e=k.zero;b=g.turnIntoCSList([g.turnIntoCSList([d,e,b[0]]),g.turnIntoCSList([e,d,b[1]]),g.turnIntoCSList([e,e,k.neg(d)])]);b=g.normalizeMax(b);a.matrix=b;a.dualMatrix=g.transpose(b)};l.TrReflectionL={};l.TrReflectionL.kind="Tr";l.TrReflectionL.signature=["L"];l.TrReflectionL.initialize=function(a){a.isEuclidean=-1};l.TrReflectionL.updatePosition=function(a){var b=k.mult,
d=k.realmult,e=k.zero,f=t.csnames[a.args[0]].homog.value,h=f[0],l=f[1];f=f[2];var n=b(h,h),p=b(l,l),q=d(-.5,k.sub(n,p)),r=b(h,l);b=g.turnIntoCSList([g.turnIntoCSList([k.neg(q),r,b(h,f)]),g.turnIntoCSList([r,q,b(l,f)]),g.turnIntoCSList([e,e,d(-.5,k.add(n,p))])]);b=g.normalizeMax(b);a.matrix=b;a.dualMatrix=g.transpose(b)};l.TrReflectionS={};l.TrReflectionS.kind="Tr";l.TrReflectionS.signature=["S"];l.TrReflectionS.updatePosition=l.TrReflectionL.updatePosition;l.TrReflectionC={};l.TrReflectionC.kind=
"Mt";l.TrReflectionC.signature=["C"];l.TrReflectionC.signatureConstraints=function(a){return"Circle"===t.csnames[a.args[0]].matrix.usage};l.TrReflectionC.updatePosition=function(a){var b=t.csnames[a.args[0]].matrix,d=b.value[0].value[2],e=b.value[1].value[2],f=k.neg;a.moebius={anti:!0,ar:d,ai:e,br:b.value[2].value[2],bi:k.zero,cr:f(b.value[0].value[0]),ci:k.zero,dr:f(d),di:e};l._helper.moebiusPair(a)};l.TrInverse={};l.TrInverse.kind="Tr";l.TrInverse.signature=["Tr"];l.TrInverse.initialize=function(a){a.isEuclidean=
t.csnames[a.args[0]].isEuclidean};l.TrInverse.updatePosition=function(a){var b=t.csnames[a.args[0]];a.dualMatrix=g.transpose(b.matrix);a.matrix=g.transpose(b.dualMatrix)};l.TransformC={};l.TransformC.kind="C";l.TransformC.signature=["Tr","C"];l.TransformC.updatePosition=function(a){var b=t.csnames[a.args[0]].dualMatrix;b=g.productMM(g.productMM(b,t.csnames[a.args[1]].matrix),g.transpose(b));b=g.normalizeMax(b);a.matrix=u.withUsage(b,"Conic")};l.TransformArc={};l.TransformArc.kind="C";l.TransformArc.signature=
["Tr","C"];l.TransformArc.signatureConstraints=function(a){return t.csnames[a.args[0]].isArc};l.TransformArc.updatePosition=function(a){var b=t.csnames[a.args[0]].matrix,d=t.csnames[a.args[1]],e=d.viaPoint,f=d.endPoint;d=g.normalizeMax(g.productMV(b,d.startPoint));e=g.normalizeMax(g.productMV(b,e));b=g.normalizeMax(g.productMV(b,f));a.startPoint=d;a.viaPoint=e;a.endPoint=b;a.isArc=!0;a.matrix=g.normalizeMax(l._helper.ConicBy5(null,d,e,b,g.ii,g.jj));a.matrix=u.withUsage(a.matrix,"Circle")};l.TransformP=
{};l.TransformP.kind="P";l.TransformP.signature=["Tr","P"];l.TransformP.updatePosition=function(a){a.homog=g.normalizeMax(g.productMV(t.csnames[a.args[0]].matrix,t.csnames[a.args[1]].homog));a.homog=u.withUsage(a.homog,"Point")};l.TransformL={};l.TransformL.kind="L";l.TransformL.signature=["Tr","L"];l.TransformL.updatePosition=function(a){a.homog=g.normalizeMax(g.productMV(t.csnames[a.args[0]].dualMatrix,t.csnames[a.args[1]].homog));a.homog=u.withUsage(a.homog,"Line")};l.TransformS={};l.TransformS.kind=
"S";l.TransformS.signature=["Tr","S"];l.TransformS.updatePosition=function(a){var b=t.csnames[a.args[0]],d=t.csnames[a.args[1]];l.Segment.setSegmentPos(a,g.productMV(b.dualMatrix,d.homog),g.productMV(b.matrix,d.startpos),g.productMV(b.matrix,d.endpos))};l.TransformPolygon={};l.TransformPolygon.kind="Poly";l.TransformPolygon.signature=["Tr","Poly"];l.TransformPolygon.updatePosition=function(a){var b=t.csnames[a.args[0]].matrix;a.vertices=g.turnIntoCSList(t.csnames[a.args[1]].vertices.value.map(function(a){a=
g.normalizeMax(g.productMV(b,a));return a=u.withUsage(a,"Point")}))};l.TrComposeTrTr={};l.TrComposeTrTr.kind="Tr";l.TrComposeTrTr.signature=["Tr","Tr"];l.TrComposeTrTr.initialize=function(a){a.isEuclidean=t.csnames[a.args[0]].isEuclidean*t.csnames[a.args[1]].isEuclidean};l.TrComposeTrTr.updatePosition=function(a){var b=t.csnames[a.args[0]],d=t.csnames[a.args[1]];a.matrix=g.normalizeMax(g.productMM(d.matrix,b.matrix));a.dualMatrix=g.normalizeMax(g.productMM(d.dualMatrix,b.dualMatrix))};l._helper.composeMtMt=
function(a,b,d){function c(a,b,c,d){return m(n(a,b),n(c,d))}function e(a,b,d,e,f,g,h,k){return m(c(a,b,d,e),c(f,g,h,k))}function f(a,b,d,e,f,g,m,k){return h(c(a,b,d,e),c(f,g,m,k))}var m=k.add,h=k.sub,n=k.mult,p=d.anti?f:e,q=d.anti?e:f;p=g.normalizeMax(g.turnIntoCSList([q(b.ar,d.ar,b.cr,d.br,b.ai,d.ai,b.ci,d.bi),p(b.ar,d.ai,b.cr,d.bi,b.ai,d.ar,b.ci,d.br),q(b.br,d.ar,b.dr,d.br,b.bi,d.ai,b.di,d.bi),p(b.br,d.ai,b.dr,d.bi,b.bi,d.ar,b.di,d.br),q(b.ar,d.cr,b.cr,d.dr,b.ai,d.ci,b.ci,d.di),p(b.ar,d.ci,b.cr,
d.di,b.ai,d.cr,b.ci,d.dr),q(b.br,d.cr,b.dr,d.dr,b.bi,d.ci,b.di,d.di),p(b.br,d.ci,b.dr,d.di,b.bi,d.cr,b.di,d.dr)])).value;a.moebius={anti:b.anti!==d.anti,ar:p[0],ai:p[1],br:p[2],bi:p[3],cr:p[4],ci:p[5],dr:p[6],di:p[7]};l._helper.moebiusPair(a)};l._helper.euc2moeb=function(a){var b=a.matrix.value;return{anti:0>a.isEuclidean,ar:b[0].value[0],ai:b[1].value[0],br:b[0].value[2],bi:b[1].value[2],cr:k.zero,ci:k.zero,dr:b[2].value[2],di:k.zero}};l.TrComposeMtMt={};l.TrComposeMtMt.kind="Mt";l.TrComposeMtMt.signature=
["Mt","Mt"];l.TrComposeMtMt.updatePosition=function(a){l._helper.composeMtMt(a,t.csnames[a.args[0]].moebius,t.csnames[a.args[1]].moebius)};l.TrComposeTrMt={};l.TrComposeTrMt.kind="Mt";l.TrComposeTrMt.signature=["Tr","Mt"];l.TrComposeTrMt.signatureConstraints=function(a){return!!t.csnames[a.args[0]].isEuclidean};l.TrComposeTrMt.updatePosition=function(a){l._helper.composeMtMt(a,l._helper.euc2moeb(t.csnames[a.args[0]]),t.csnames[a.args[1]].moebius)};l.TrComposeMtTr={};l.TrComposeMtTr.kind="Mt";l.TrComposeMtTr.signature=
["Mt","Tr"];l.TrComposeMtTr.signatureConstraints=function(a){return!!t.csnames[a.args[1]].isEuclidean};l.TrComposeMtTr.updatePosition=function(a){l._helper.composeMtMt(a,t.csnames[a.args[0]].moebius,l._helper.euc2moeb(t.csnames[a.args[1]]))};l._helper.pointReflection=function(a,b){return g.normalizeMax(g.sub(g.scalmult(k.realmult(2,b.value[2]),a),g.scalmult(a.value[2],b)))};l._helper.conicOtherIntersection=function(a,b,d){var c=g.productMV(a,d);a=g.scalproduct(d,c);c=g.scalproduct(b,c);c=k.realmult(-2,
c);b=g.scalmult(a,b);d=g.scalmult(c,d);d=g.add(b,d);return d=g.normalizeMax(d)};l.Dist={};l.Dist.kind="V";l.Dist.signature=["P","P"];l.Dist.updatePosition=function(a){var b=t.csnames[a.args[1]].homog;a.value=g.abs(g.sub(g.normalizeZ(t.csnames[a.args[0]].homog),g.normalizeZ(b)))};l.Angle={};l.Angle.kind="V";l.Angle.signature=["L","L","P"];l.Angle.initialize=function(a){void 0===a.angle&&(a.angle=.5*Math.PI);ab(k._helper.input(a.angle))};l.Angle.updatePosition=function(a){var b=t.csnames[a.args[1]].homog,
d=t.csnames[a.args[2]].homog,e=g.cross(t.csnames[a.args[0]].homog,g.linfty);b=g.cross(b,g.linfty);d=g.crossratio3(e,b,g.ii,g.jj,d);d=k.mult(k.complex(0,.5),k.log(d));e=(Db().value.real-d.value.real)/Math.PI;b=Math.round(e);!kb&&.01<Math.abs(b-e)&&fc();d=k.complex(b*Math.PI+d.value.real,d.value.imag);ab(d);a.value=u.withUsage(d,"Angle")};l.Angle.stateSize=2;l.Text={};l.Text.kind="Text";l.Text.signature="**";l.Text.isMovable=!0;l.Text.updatePosition=Va;l.Text.initialize=function(a){a.text=String(a.text);
a.pos&&(a.homog=l._helper.initializePoint(a));a.dock&&(a.dock.offset=a.dock.offset&&2===a.dock.offset.length?g.realVector([+a.dock.offset[0],+a.dock.offset[1]]):g.realVector([0,0]))};l.Text.getParamForInput=function(a,b,d){return l.Free.getParamForInput(a,b,d)};l.Text.getParamFromState=function(a){return a.homog};l.Text.putParamToState=function(a,b){a.homog=b};l.Calculation={};l.Calculation.kind="Text";l.Calculation.signature="**";l.Calculation.isMovable=!0;l.Calculation.updatePosition=Va;l.Calculation.initialize=
function(a){l.Text.initialize(a);a.calculation=Wa(a.text)};l.Calculation.getText=function(a){return U(z(a.calculation))};l.Calculation.getParamForInput=l.Text.getParamForInput;l.Calculation.getParamFromState=l.Text.getParamFromState;l.Calculation.putParamToState=l.Text.putParamToState;l.Equation={};l.Equation.kind="Text";l.Equation.isMovable=!0;l.Equation.signature="**";l.Equation.updatePosition=Va;l.Equation.initialize=function(a){l.Text.initialize(a);a.calculation=Wa(a.text)};l.Equation.getText=
function(a){return a.text+" = "+U(z(a.calculation))};l.Equation.getParamForInput=l.Text.getParamForInput;l.Equation.getParamFromState=l.Text.getParamFromState;l.Equation.putParamToState=l.Text.putParamToState;l.Evaluate={};l.Evaluate.kind="Text";l.Evaluate.isMovable=!0;l.Evaluate.signature="**";l.Evaluate.updatePosition=Va;l.Evaluate.initialize=function(a){l.Text.initialize(a);a.calculation=Wa(a.text)};l.Evaluate.getText=function(a){z(a.calculation);return a.text};l.Evaluate.getParamForInput=l.Text.getParamForInput;
l.Evaluate.getParamFromState=l.Text.getParamFromState;l.Evaluate.putParamToState=l.Text.putParamToState;l.Plot={};l.Plot.kind="Text";l.Plot.isMovable=!0;l.Plot.signature="**";l.Plot.updatePosition=Va;l.Plot.initialize=function(a){l.Text.initialize(a);a.calculation=Wa("plot(("+a.text+"))")};l.Plot.getText=function(a){z(a.calculation);return a.text};l.Plot.getParamForInput=l.Text.getParamForInput;l.Plot.getParamFromState=l.Text.getParamFromState;l.Plot.putParamToState=l.Text.putParamToState;l.Button=
{};l.Button.kind="Text";l.Button.signature="**";l.Button.isMovable=!0;l.Button.updatePosition=Va;l.Button.initialize=function(a){var b=document.createElement("button");Kc(a,"click",b)};l.Button.getParamForInput=l.Text.getParamForInput;l.Button.getParamFromState=l.Text.getParamFromState;l.Button.putParamToState=l.Text.putParamToState;l.Button.set_fillcolor=function(a,b){g._helper.isNumberVecN(b,3)&&(a.fillcolor=b.value.map(function(a){return a.value.real}),a.html.style.backgroundColor=x.makeColor(a.fillcolor,
a.fillalpha))};l.ToggleButton={};l.ToggleButton.kind="Text";l.ToggleButton.signature="**";l.ToggleButton.isMovable=!0;l.ToggleButton.updatePosition=Va;l.ToggleButton.initialize=function(a){var b=void 0;void 0===b&&(b="CindyJSid");b+=++Ta;var d=document.createElement("input"),e=document.createElement("label");d.setAttribute("id",b);e.setAttribute("for",b);d.setAttribute("type","checkbox");a.pressed&&(d.checked=!0);a.checkbox=d;Kc(a,"change",d,e)};l.ToggleButton.getParamForInput=l.Text.getParamForInput;
l.ToggleButton.getParamFromState=l.Text.getParamFromState;l.ToggleButton.putParamToState=l.Text.putParamToState;l.ToggleButton.set_fillcolor=l.Button.set_fillcolor;l.EditableText={};l.EditableText.kind="Text";l.EditableText.isMovable=!0;l.EditableText.signature=[];l.EditableText.updatePosition=Va;l.EditableText.initialize=function(a){var b=document.createElement("input");b.setAttribute("type","text");b.className="CindyJS-editabletext";La(a.minwidth)&&(b.style.width=a.minwidth-3+"px");"string"===typeof a.text&&
(b.value=a.text);b.addEventListener("keydown",function(c){13===c.keyCode&&(a.text=a.html.value,b.blur())});b.addEventListener("change",function(b){a.text=a.html.value});Kc(a,"change",b)};l.EditableText.getText=function(a){return!1};l.EditableText.getParamForInput=l.Text.getParamForInput;l.EditableText.getParamFromState=l.Text.getParamFromState;l.EditableText.putParamToState=l.Text.putParamToState;l.EditableText.set_fillcolor=l.Button.set_fillcolor;l.EditableText.get_currenttext=function(a){return u.string(String(a.html.value))};
l.EditableText.get_text=function(a){return u.string(String(a.text))};l.EditableText.set_currenttext=function(a,b){a.html.value=a.text=U(b)};l.EditableText.get_text=l.EditableText.get_text;l.EditableText.set_text=l.EditableText.set_currenttext;l.EditableText.get_val=l.EditableText.get_text;l.EditableText.set_val=l.EditableText.set_currenttext;l.EditableText.get_currenttext=l.EditableText.get_currenttext;l.EditableText.set_currenttext=l.EditableText.set_currenttext;l._helper.initializePoint=function(a){var b=
0,d=0,e=0;if(a.pos){if("list"===a.pos.ctype&&g.isNumberVector(a.pos))return a.pos;2===a.pos.length&&(b=a.pos[0],d=a.pos[1],e=1);3===a.pos.length&&(b=a.pos[0],d=a.pos[1],e=a.pos[2])}a=g.turnIntoCSList([k._helper.input(b),k._helper.input(d),k._helper.input(e)]);return a=g.normalizeMax(a)};l._helper.initializeLine=function(a){var b=0,d=0,e=0;if(a.pos){if("list"===a.pos.ctype&&g.isNumberVector(a.pos))return a.pos;3===a.pos.length&&(b=a.pos[0],d=a.pos[1],e=a.pos[2])}a=g.turnIntoCSList([k._helper.input(b),
k._helper.input(d),k._helper.input(e)]);return a=g.normalizeMax(a)};l.Poly={};l.Poly.kind="Poly";l.Poly.signature="P*";l.Poly.updatePosition=function(a){a.vertices=g.turnIntoCSList(a.args.map(function(a){return t.csnames[a].homog}))};var Y=null;l.IFS={};l.IFS.kind="IFS";l.IFS.signature="**";l.IFS.signatureConstraints=function(a){for(var b=0;b<a.args.length;++b){var d=t.csnames[a.args[b]].kind;if("Tr"!==d&&"Mt"!==d)return!1}return 0<a.args.length};l.IFS.initialize=function(a){if(Y)Y.dirty=!0;else if(a=
xa.getBaseDir(),!1!==a){Y={dirty:!1,params:{generation:0}};var b=Y.worker=new Worker(a+"ifs.js");b.onmessage=function(a){Y.img&&"function"===typeof Y.img.close&&Y.img.close();if(!Zb){a=a.data;if(a.generation===Y.params.generation){if(a.buffer){Y.canvas||(Y.canvas=document.createElement("canvas"),Y.ctx=Y.canvas.getContext("2d"));Y.canvas.width=a.width;Y.canvas.height=a.height;var c=new Uint8ClampedArray(a.buffer,a.imgPtr,a.width*a.height*4);c=new ImageData(c,a.width,a.height);Y.ctx.putImageData(c,
0,0);Y.img=Y.canvas}else Y.img=a.img;f()}else Y.img=null;a.buffer?b.postMessage({cmd:"next",buffer:a.buffer},[a.buffer]):b.postMessage({cmd:"next"})}};ib.push(b.terminate.bind(b))}};l.IFS.updatePosition=function(a){Y.dirty=!0};l.IFS.updateParameters=function(){if(Y.worker){var a={cmd:"init",generation:Y.params.generation,width:4*ca,height:4*da};a.systems=t.ifs.map(function(a){var b=0,c,d=a.ifs||[],e=a.args.map(function(a,b){a=d[b]||{};return{prob:a.prob||1,color:a.color||[0,0,0]}});for(c=0;c<e.length;++c)b+=
e[c].prob;c=g.realMatrix([[1,0,0],[0,1,0],[0,0,4]]);var f=g.productMM(y.toMat(),c);for(c=0;c<a.args.length;++c){var h=t.csnames[a.args[c]],n=h.kind,p=e[c];p.kind=n;p.prob/=b;if("Tr"===n)h=g.normalizeMax(g.productMM(g.adjoint3(f),g.productMM(h.matrix,f))),g._helper.isAlmostReal(h)?p.mat=h.value.map(function(a){return a.value.map(function(a){return a.value.real})}):p.kind="cplx";else if("Mt"===n){n=y.drawingstate.matrix;n={anti:0<n.det,ar:k.real(n.a),ai:k.real(n.c),br:k.real(n.tx),bi:k.real(-n.ty),
cr:k.zero,ci:k.zero,dr:k.real(.25),di:k.zero};var q={};l._helper.composeMtMt(q,h.moebius,n);n=l._helper.inverseMoebius(n);l._helper.composeMtMt(q,n,q.moebius);n=q.moebius;n=g.turnIntoCSList([n.ar,n.ai,n.br,n.bi,n.cr,n.ci,n.dr,n.di]);g._helper.isAlmostReal(n)?(n=n.value,p.moebius={ar:n[0].value.real,ai:n[1].value.real,br:n[2].value.real,bi:n[3].value.real,cr:n[4].value.real,ci:n[5].value.real,dr:n[6].value.real,di:n[7].value.real,sign:h.moebius.anti?-1:1}):p.kind="cplx"}}return{trafos:e}});u.deeplyEqual(a,
Y.params)||(++a.generation,Y.img=null,Y.params=a,Y.mat=y.drawingstate.matrix,Y.worker.postMessage(a))}};l.IFS.probSetter=function(a,b,d){"number"===d.ctype&&(b.ifs[a].prob=d.value.real,Y.dirty=!0)};(function(){for(var a=0;10>a;++a)l.IFS["set_prob"+a]=l.IFS.probSetter.bind(null,a)})();l._helper.snapPointToLine=function(a,b){if(k._helper.isAlmostZero(a.value[2]))return a;var c=l._helper.projectPointToLine(a,b);c=g.normalizeZ(c);var d=c.value[0].value.real;c=c.value[1].value.real;var e=Math.round(d/
Ca)*Ca,f=Math.round(c/Ca)*Ca,h=g.realVector([e,f,1]);.2>Math.abs(e-d)&&.2>Math.abs(f-c)&&k._helper.isAlmostZero(g.scalproduct(b,h))&&(a=l._helper.projectPointToLine(h,b));return a};var Ab={CircleByRadius:"CircleMr",IntersectionCircleCircle:"IntersectCirCir",IntersectionConicConic:"IntersectConicConic",FreePoint:"Free",Orthogonal:"Perp",Parallel:"Para",Pole:"PolarOfLine",Polar:"PolarOfPoint",Arc:"ArcBy3",EuclideanMid:"Mid",AngularBisector:"AngleBisector",TransformConic:"TransformC",TransformSegment:"TransformS",
TrMoebiusSegment:"TrMoebiusS",ReflectCC:"TrMoebiusC",ReflectCL:"TrMoebiusL",ReflectCP:"TrMoebiusP",ReflectCArc:"TrMoebiusArc",ReflectCS:"TrMoebiusS",TrMoebiusCircle:"TrMoebiusC"},Ec={CircleMFixedr:function(a){a.pinned=!0;a.type="CircleMr";return[a]},CircleByFixedRadius:function(a){a.pinned=!0;a.type="CircleMr";return[a]},IntersectionConicLine:function(a){a.args=[a.args[1],a.args[0]];a.type="IntersectLC";return[a]},angleBisector:function(a){var b={name:a.name+"_Intersection",type:"Meet",args:a.args,
visible:!1};a.type="AngleBisector";a.args=[a.args[0],a.args[1],b.name];return[b,a]},Transform:function(a){var b=t.csnames[a.args[1]];b={Tr:"Transform",Mt:"TrMoebius"}[t.csnames[a.args[0]].kind]+(b.isArc?"Arc":b.kind);if(l.hasOwnProperty(b))return a.type=b,[a];console.log(b+" not implemented yet");return[]},TrReflection:function(a){var b="TrReflection"+t.csnames[a.args[0]].kind;if(l.hasOwnProperty(b))return a.type=b,[a];console.log(b+" not implemented yet");return[]},TrCompose:function(a){var b="TrCompose"+
a.args.map(function(a){return t.csnames[a].kind}).join("");if(l.hasOwnProperty(b))return a.type=b,[a];console.log(b+" not implemented yet");return[]}},xe="align alpha angle args arrow arrowposition arrowshape arrowsides arrowsize clip color dashtype drawtrace fillalpha fillcolor filled labeled labelpos name overhang pinned printname radius size text text_fontfamily textbold textitalics textsize tracedim tracelength traceskip tracing type visible".split(" ");ua.saveState=function(){return{geometry:ye()}};
var za={};var Oe=[[],[.2],[.075,.225],[44/45,-56/15,32/9],[19372/6561,-25360/2187,64448/6561,-212/729],[9017/3168,-355/33,46732/5247,49/176,-5103/18656],[35/384,0,500/1113,125/192,-2187/6784,11/84]];var hc=[0,.2,.3,.8,8/9,1,1];var Pe=[35/384,0,500/1113,125/192,-2187/6784,11/84,0];var Qe=[5179/57600,0,7571/16695,.6140625,-92097/339200,187/2100,.025];var Ja,na=[],Lc=[],tc=!1;za.tick=function(a){a/=Xb;for(var b=0;b<Xb;b++)za.tick1(a),Jb+=a,z(S.simulationstep)};za.tick1=function(a){for(var b=a,d=0;0<
a&&d<.999*a||0>a&&d>.999*a;)b=za.oneRKStep(b),d+=b,b=Math.min(2*b,a-d),b=Math.max(b,1E-16),za.restorePosition(),za.doCollisions(),za.calculateForces(),za.moveToFinalPos();return!0};za.restorePosition=function(){Ja.forEach(function(a){Q[a.type].restorePos(a,9)})};za.doCollisions=function(){Ja.forEach(function(a){Q[a.type].doCollisions(a)})};za.calculateForces=function(){Ja.forEach(function(a){Q[a.type].calculateForces(a)})};za.moveToFinalPos=function(){Ja.forEach(function(a){Q[a.type].move(a)})};za.oneRKStep=
function(a){for(var b=function(a){Ja.forEach(function(b){Q[b.type].initRK(b,a);Q[b.type].storePosition(b)})},d=function(a){Ja.forEach(function(b){Q[b.type].setToTimestep(b,hc[a])})},e=function(a){Ja.forEach(function(b){Q[b.type].proceedMotion(b,hc[a],a,Oe[a])})},f=function(){Ja.forEach(function(a){Q[a.type].resetForces(a)})},g=function(a){Ja.forEach(function(b){Q[b.type].calculateDelta(b,a)})},h=function(b){var c=0;Ja.forEach(function(a){Q[a.type].proceedMotion(a,hc[6],7,Pe);Q[a.type].savePos(a,8);
Q[a.type].proceedMotion(a,hc[6],7,Qe);Q[a.type].savePos(a,9);c+=Q[a.type].sqDist(a,8,9)});return c=Math.sqrt(c)/a},k=function(a){Ja.forEach(function(a){Q[a.type].recallPosition(a)})},l=!1;!l;){b(a);for(var n=0;7>n;n++)d(n),e(n),f(),za.calculateForces(),g(n);h(a)>Q.env.errorbound&&a>Q.env.lowestdeltat?(a/=Q.env.slowdownfactor,k()):l=!0}return a};var Q={Mass:{reset:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.mass&&(a.mass=1);"undefined"===typeof a.charge&&(a.charge=0);
"undefined"===typeof a.friction&&(a.friction=0);a.lnfrict=0;"undefined"===typeof a.limitspeed&&(a.limitspeed=!1);"undefined"===typeof a.fixed&&(a.fixed=!1);"undefined"===typeof a.radius&&(a.radius=1);a.internalmove=!1;a.fx=0;a.fy=0;a.fz=0;a.vx=a.vx||0;a.vy=a.vy||0;a.vz=a.vz||0;a.mtype=0;a.env=Q.env;a.deltat=0;a.mx=0;a.my=0;a.mz=0;a.mvx=0;a.mvy=0;a.mvz=0;a.dx=[0,0,0,0,0,0,0,0,0,0];a.dy=[0,0,0,0,0,0,0,0,0,0];a.dz=[0,0,0,0,0,0,0,0,0,0];a.dvx=[0,0,0,0,0,0,0,0,0,0];a.dvy=[0,0,0,0,0,0,0,0,0,0];a.dvz=[0,
0,0,0,0,0,0,0,0,0];a.midx=0;a.midy=0;a.midz=0;a.lx=0;a.ly=0;a.lz=0},resetForces:function(a){a.fx=0;a.fy=0;a.fz=0},getBlock:!1,setToTimestep:function(a,b,d){},initRK:function(a,b){var c=C.extractPoint(a.el.homog);a.x=c.x;a.y=c.y;a.z=0;a.xo=a.x;a.yo=a.y;a.zo=a.z;a.vxo=a.vx;a.vyo=a.vy;a.vzo=a.vz;a.deltat=b;a.fx=0;a.fy=0;a.fz=0},setVelocity:function(a,b,d,e){e||(e=0);a.vx=b;a.vy=d;a.vz=e},move:function(a){a.pos=[a.x,a.y,1];a.internalmove=!0;ja&&aa.down&&a.el===ja.mover||Ea(a.el,g.realVector(a.pos),"homog");
a.el.sx=a.x;a.el.sy=a.y;a.internalmove=!1},proceedMotion:function(a,b,d,e){if(!a.fixed)for(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz,b=0;b<d;b++)a.x+=e[b]*a.dx[b]*a.deltat,a.y+=e[b]*a.dy[b]*a.deltat,a.z+=e[b]*a.dz[b]*a.deltat,a.vx+=e[b]*a.dvx[b]*a.deltat,a.vy+=e[b]*a.dvy[b]*a.deltat,a.vz+=e[b]*a.dvz[b]*a.deltat},calculateForces:function(a){var b=Math.sqrt(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz);a.lnfrict=-Math.log((1-a.friction)*(1-a.env.friction)*(.1<b&&a.limitSpeed?.1/b:1));a.fx+=-a.vx*
a.lnfrict*a.mass;a.fy+=-a.vy*a.lnfrict*a.mass;a.fz+=-a.vz*a.lnfrict*a.mass},calculateDelta:function(a,b){a.dx[b]=a.vx;a.dy[b]=a.vy;a.dz[b]=a.vz;a.dvx[b]=a.fx/a.mass;a.dvy[b]=a.fy/a.mass;a.dvz[b]=a.fz/a.mass},savePos:function(a,b){a.dx[b]=a.x;a.dy[b]=a.y;a.dz[b]=a.z;a.dvx[b]=a.vx;a.dvy[b]=a.vy;a.dvz[b]=a.vz},restorePos:function(a,b){a.fixed||(a.x=a.dx[b],a.y=a.dy[b],a.z=a.dz[b],a.vx=a.dvx[b],a.vy=a.dvy[b],a.vz=a.dvz[b])},sqDist:function(a,b,d){var c=(a.dx[b]-a.dx[d])*(a.dx[b]-a.dx[d]);c+=(a.dy[b]-
a.dy[d])*(a.dy[b]-a.dy[d]);c+=(a.dz[b]-a.dz[d])*(a.dz[b]-a.dz[d]);c+=(a.dvx[b]-a.dvx[d])*(a.dvx[b]-a.dvx[d]);c+=(a.dvy[b]-a.dvy[d])*(a.dvy[b]-a.dvy[d]);return c+=(a.dvz[b]-a.dvz[d])*(a.dvz[b]-a.dvz[d])},kineticEnergy:function(a){return.5*a.mass*(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz)},storePosition:function(a){a.mx=a.x;a.my=a.y;a.mz=a.z;a.mvx=a.vx;a.mvy=a.vy;a.mvz=a.vz},recallPosition:function(a){a.fixed||(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz)},doCollisions:function(a){}},Sun:{reset:function(a,
b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.mass&&(a.mass=10);"undefined"===typeof a.friction&&(a.friction=0);a.charge=0;a.x=0;a.y=0;a.z=0},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,d){},initRK:function(a,b){b=C.extractPoint(a.el.homog);a.x=b.x;a.y=b.y;a.z=0},setVelocity:function(a,b,d,e){},move:function(a){},proceedMotion:function(a,b,d,e){},calculateDelta:function(a,b){},calculateForces:function(a){for(var b=a.x,d=a.y,e=a.z,f=0;f<na.length;f++){var g=na[f],
h=g.behavior.x,k=g.behavior.y,l=g.behavior.z,n=Math.sqrt((b-h)*(b-h)+(d-k)*(d-k)+(e-l)*(e-l));k=(d-k)*a.mass*g.behavior.mass/(n*n*n);l=(e-l)*a.mass*g.behavior.mass/(n*n*n);g.behavior.fx+=(b-h)*a.mass*g.behavior.mass/(n*n*n)*g.behavior.mass;g.behavior.fy+=k*g.behavior.mass;g.behavior.fz+=l*g.behavior.mass}},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,d){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},
Velocity:{reset:function(a){var b=t.csnames[a.geo[1]];console.log(b);var d=C.extractPoint(b.homog);a=C.extractPoint(t.csnames[a.geo[2]].homog);b=b.behavior;Q[b.type].setVelocity(b,a.x-d.x,a.y-d.y,0)},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,d){},initRK:function(a,b){},setVelocity:function(a,b,d,e){},move:function(a){var b=t.csnames[a.geo[2]];if(!ja||!aa.down||b!==ja.mover){var d=t.csnames[a.geo[1]];a=C.extractPoint(d.homog);d=d.behavior;a=g.realVector([a.x+d.vx,a.y+d.vy,1]);
Ea(b,a,"homog")}},proceedMotion:function(a,b,d,e){},calculateForces:function(a){},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,d){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},Gravity:{reset:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.strength&&(a.strength=1);a.namea=b.args[0];a.nameb=b.args[1];a.ma=t.csnames[a.namea];a.mb=t.csnames[a.nameb]},
resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,d){},initRK:function(a,b){},setVelocity:function(a,b,d,e){},move:function(a){},proceedMotion:function(a,b,d,e){},calculateDelta:function(a,b){},calculateForces:function(a){var b=C.extractPoint(a.ma.homog),d=C.extractPoint(a.mb.homog),e=(d.x-b.x)*a.strength;a=(d.y-b.y)*a.strength;for(b=0;b<na.length;b++)d=na[b],d.behavior.fx+=e*d.behavior.mass,d.behavior.fy+=a*d.behavior.mass,d.behavior.fz+=0*d.behavior.mass},savePos:function(a,b){},
restorePos:function(a,b){},sqDist:function(a,b,d){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},Spring:{reset:function(a,b){a.el=b;"undefined"===typeof a.strength&&(a.strength=1);"undefined"===typeof a.amplitude&&(a.amplitude=0);"undefined"===typeof a.phase&&(a.phase=0);"undefined"===typeof a.speed&&(a.speed=1);"undefined"===typeof a.l0&&(a.l0=0);"undefined"===typeof a.stype&&(a.stype=1);"undefined"===typeof a.readOnInit&&
(a.readOnInit=!1);a.namea=b.args[0];a.nameb=b.args[1];a.ma=t.csnames[a.namea];a.mb=t.csnames[a.nameb];b=C.extractPoint(a.ma.homog);var c=C.extractPoint(a.mb.homog);a.l0=Math.sqrt((b.x-c.x)*(b.x-c.x)+(b.y-c.y)*(b.y-c.y));a.env=Q.env;a.ldiff=0},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,d){},initRK:function(a,b){},setVelocity:function(a,b,d,e){},move:function(a){},proceedMotion:function(a,b,d,e){},calculateForces:function(a){if(!a.ma.behavior||ja&&aa.down&&a.ma===ja.mover){var b=
C.extractPoint(a.ma.homog);var d=b.x;var e=b.y}else d=a.ma.behavior.x,e=a.ma.behavior.y;if(!a.mb.behavior||ja&&aa.down&&a.mb===ja.mover){var f=C.extractPoint(a.mb.homog);b=f.x;f=f.y}else b=a.mb.behavior.x,f=a.mb.behavior.y;var g=Math.sqrt((d-b)*(d-b)+(e-f)*(e-f)),h=a.l0;a.ldiff=g-h;var k=a.stype;1===k&&(h=0);var l=0;if(2===k||3===k)l=a.ma.behavior.mass*a.mb.behavior.mass*a.strength;2===k&&(l=-l);if(0===g||0!==k&&1!==k)if(a.ma.behavior&&a.mb.behavior&&0!==g){if(g*=g*g,2===k||3===k){var n=(d-b)*l/g;
var p=(e-f)*l/g}}else n=p=0;else n=-(d-b)*a.strength*(g-h)/g*a.env.springstrength,p=-(e-f)*a.strength*(g-h)/g*a.env.springstrength;a.ma.behavior&&(a.ma.behavior.fx+=n,a.ma.behavior.fy+=p);a.mb.behavior&&(a.mb.behavior.fx-=n,a.mb.behavior.fy-=p)},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,d){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},det:function(a,b,d,e,f,g){return d*
g-f*e+f*b-a*g+a*e-d*b},Bouncer:{reset:function(a,b){a.el=b;"undefined"===typeof a.xdamp&&(a.xdamp=0);"undefined"===typeof a.ydamp&&(a.ydamp=0);"undefined"===typeof a.motorchanger&&(a.motorchanger=!0);a.namea=b.args[0];a.nameb=b.args[1];a.ma=t.csnames[a.namea];a.mb=t.csnames[a.nameb];b=C.extractPoint(a.ma.homog);var c=C.extractPoint(a.mb.homog);a.x1o=1.01*b.x-.01*c.x;a.y1o=1.01*b.y-.01*c.y;a.x2o=1.01*c.x-.01*b.x;a.y2o=1.01*c.y-.01*b.y;a.env=Q.env},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,
b,d){},initRK:function(a,b){a.deltat=b},setVelocity:function(a,b,d,e){},move:function(a){},proceedMotion:function(a,b,d,e){},calculateForces:function(a){},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,d){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){var b=C.extractPoint(a.ma.homog),d=C.extractPoint(a.mb.homog),e=b.x;b=b.y;var f=d.x;d=d.y;var g=a.x1o,h=a.y1o,l=a.x2o,n=a.y2o,
p=Math.sqrt((e-f)*(e-f)+(b-d)*(b-d)),q=(e-f)/p;p=(b-d)/p;for(var r=0;r<na.length;r++){var t=na[r],u=t.behavior.xo,v=t.behavior.yo,w=t.behavior.x,x=t.behavior.y,y=k.mult(k.complex(g,h),k.complex(f,d)),z=k.mult(k.complex(l,n),k.complex(e,b));y=k.sub(y,z);z=k.mult(k.complex(u,v),k.complex(e,b));y=k.add(y,z);z=k.mult(k.complex(u,v),k.complex(f,d));y=k.sub(y,z);z=k.sub(k.complex(g,h),k.complex(l,n));y=k.div(y,z);0>Q.det(e,b,f,d,w,x)*Q.det(e,b,f,d,y.value.real,y.value.imag)&&0>Q.det(e,b,w,x,y.value.real,
y.value.imag)*Q.det(f,d,w,x,y.value.real,y.value.imag)&&(v=t.behavior.mvx+a.deltat*(-y.value.real+t.behavior.xo),w=t.behavior.mvy+a.deltat*(-y.value.imag+t.behavior.yo),u=q*v+p*w,v=p*v-q*w,t.behavior.x=y.value.real,t.behavior.y=y.value.imag,t.behavior.vx=q*u*(1-a.xdamp),t.behavior.vy=p*u*(1-a.xdamp),t.behavior.vx+=-p*v*(1-a.ydamp),t.behavior.vy+=q*v*(1-a.ydamp))}a.x1o=e;a.y1o=b;a.x2o=f;a.y2o=d}},Environment:{init:function(a){"undefined"===typeof a.gravity&&(a.gravity=0);"undefined"===typeof a.friction&&
(a.friction=0);"undefined"===typeof a.springstrength&&(a.springstrength=1);"undefined"!==typeof a.accuracy&&(Xb=a.accuracy);"undefined"!==typeof a.deltat&&Ba(a.deltat/.6);"undefined"===typeof a.charges&&(a.charges=!1);"undefined"===typeof a.balls&&(a.balls=!1);"undefined"===typeof a.newton&&(a.newton=!1);"undefined"===typeof a.ballInteractionBoosting&&(a.ballInteractionBoosting=1);Q.env=a;a.errorbound=.001;a.lowestdeltat=1E-7;a.slowdownfactor=2},reset:function(a){},resetForces:function(a){},getBlock:!1,
setToTimestep:function(a,b,d){},initRK:function(a,b){},setVelocity:function(a,b,d,e){},move:function(a){},proceedMotion:function(a,b,d,e){},calculateForces:function(a){var b,d;if(a.newton)for(b=0;b<na.length-1;b++){var e=na[b];var f=e.behavior.x;var g=e.behavior.y;for(d=b+1;d<na.length;d++){var h=na[d];var k=h.behavior.x;var l=h.behavior.y;var n=Math.sqrt((f-k)*(f-k)+(g-l)*(g-l));k=(f-k)*e.behavior.mass*h.behavior.mass/(n*n*n);l=(g-l)*e.behavior.mass*h.behavior.mass/(n*n*n);e.behavior.fx-=k;e.behavior.fy-=
l;h.behavior.fx+=k;h.behavior.fy+=l}}if(a.charges)for(b=0;b<na.length-1;b++)for(e=na[b],f=e.behavior.x,g=e.behavior.y,d=b+1;d<na.length;d++)h=na[d],k=h.behavior.x,l=h.behavior.y,n=Math.sqrt((f-k)*(f-k)+(g-l)*(g-l)),k=(f-k)*e.behavior.charge*h.behavior.charge/(n*n*n),l=(g-l)*e.behavior.charge*h.behavior.charge/(n*n*n),e.behavior.fx+=k,e.behavior.fy+=l,h.behavior.fx-=k,h.behavior.fy-=l;if(a.balls)for(b=0;b<na.length-1;b++)if(e=na[b],0!==e.behavior.radius)for(f=e.behavior.x,g=e.behavior.y,d=b+1;d<na.length;d++)if(h=
na[d],0!==h.behavior.radius){k=h.behavior.x;l=h.behavior.y;var p=e.behavior.radius+h.behavior.radius;n=Math.sqrt((f-k)*(f-k)+(g-l)*(g-l));0===a.ballInteractionBoosting?(k=(f-k)/(n*n*n)*(n>p?0:(n-p)*(n-p)),l=(g-l)/(n*n*n)*(n>p?0:(n-p)*(n-p))):1===a.ballInteractionBoosting?(k=(f-k)/(n*n*n*n)*(n>p?0:(n-p)*(n-p)),l=(g-l)/(n*n*n*n)*(n>p?0:(n-p)*(n-p))):(k=(f-k)/(n*n*n*n*n)*(n>p?0:(n-p)*(n-p)),l=(g-l)/(n*n*n*n*n)*(n>p?0:(n-p)*(n-p)));e.behavior.fx+=k;e.behavior.fy+=l;h.behavior.fx-=k;h.behavior.fy-=l}for(b=
0;b<na.length;b++)e=na[b],e.behavior.fx+=0,e.behavior.fy+=-a.gravity*e.behavior.mass,e.behavior.fz+=0},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,d){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}}};return ua};return E}(),createCindy=CindyJS;
"undefined"!==typeof process&&"undefined"!==typeof module&&"undefined"!==typeof module.exports&&"undefined"===typeof window&&(module.exports=CindyJS);
//# sourceMappingURL=Cindy.js.map

