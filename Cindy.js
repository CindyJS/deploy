/* CindyJS - (C) 2014-2015  J. Richter-Gebert
 *
 */
'use strict';var numeric="undefined"===typeof exports?function(){}:exports;"undefined"!==typeof global&&(global.numeric=numeric);numeric.version="1.2.6";numeric.bench=function(a,b){var d,c,k;"undefined"===typeof b&&(b=15);k=.5;for(d=new Date;;){for(c=k*=2;3<c;c-=4)a(),a(),a(),a();for(;0<c;)a(),c--;c=new Date;if(c-d>b)break}for(c=k;3<c;c-=4)a(),a(),a(),a();for(;0<c;)a(),c--;c=new Date;return 1E3*(3*k-1)/(c-d)};
numeric._myIndexOf=function(a){var b=this.length,d;for(d=0;d<b;++d)if(this[d]===a)return d;return-1};numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf;numeric.Function=Function;numeric.precision=4;numeric.largeArray=50;
numeric.prettyPrint=function(a){function b(a){if(0===a)return"0";if(isNaN(a))return"NaN";if(0>a)return"-"+b(-a);if(isFinite(a)){var d=Math.floor(Math.log(a)/Math.log(10));a/=Math.pow(10,d);a=a.toPrecision(numeric.precision);10===parseFloat(a)&&(d++,a=(1).toPrecision(numeric.precision));return parseFloat(a).toString()+"e"+d.toString()}return"Infinity"}function d(a){var e;if("undefined"===typeof a)return c.push(Array(numeric.precision+8).join(" ")),!1;if("string"===typeof a)return c.push('"'+a+'"'),
!1;if("boolean"===typeof a)return c.push(a.toString()),!1;if("number"===typeof a){var h=b(a);e=a.toPrecision(numeric.precision);a=parseFloat(a.toString()).toString();a=[h,e,a,parseFloat(e).toString(),parseFloat(a).toString()];for(e=1;e<a.length;e++)a[e].length<h.length&&(h=a[e]);c.push(Array(numeric.precision+8-h.length).join(" ")+h);return!1}if(null===a)return c.push("null"),!1;if("function"===typeof a){c.push(a.toString());h=!1;for(e in a)a.hasOwnProperty(e)&&(h?c.push(",\n"):c.push("\n{"),h=!0,
c.push(e),c.push(": \n"),d(a[e]));h&&c.push("}\n");return!0}if(a instanceof Array){if(a.length>numeric.largeArray)return c.push("...Large Array..."),!0;h=!1;c.push("[");for(e=0;e<a.length;e++)0<e&&(c.push(","),h&&c.push("\n ")),h=d(a[e]);c.push("]");return!0}c.push("{");h=!1;for(e in a)a.hasOwnProperty(e)&&(h&&c.push(",\n"),h=!0,c.push(e),c.push(": \n"),d(a[e]));c.push("}");return!0}var c=[];d(a);return c.join("")};
numeric.parseDate=function(a){function b(a){if("string"===typeof a)return Date.parse(a.replace(/-/g,"/"));if(!(a instanceof Array))throw Error("parseDate: parameter must be arrays of strings");var c=[],k;for(k=0;k<a.length;k++)c[k]=b(a[k]);return c}return b(a)};numeric.parseFloat=function(a){function b(a){if("string"===typeof a)return parseFloat(a);if(!(a instanceof Array))throw Error("parseFloat: parameter must be arrays of strings");var c=[],k;for(k=0;k<a.length;k++)c[k]=b(a[k]);return c}return b(a)};
numeric.parseCSV=function(a){a=a.split("\n");var b,d,c=[],k=/(([^'",]*)|('[^']*')|("[^"]*")),/g,e=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,h=0;for(d=0;d<a.length;d++){var r=(a[d]+",").match(k),n;if(0<r.length){c[h]=[];for(b=0;b<r.length;b++)n=r[b],n=n.substr(0,n.length-1),e.test(n)?c[h][b]=parseFloat(n):c[h][b]=n;h++}}return c};
numeric.toCSV=function(a){var b,d,c,k,e;c=numeric.dim(a)[0];e=[];for(b=0;b<c;b++){k=[];for(d=0;d<c;d++)k[d]=a[b][d].toString();e[b]=k.join(", ")}return e.join("\n")+"\n"};numeric.getURL=function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.send();return b};
numeric.imageURL=function(a){function b(a,b,d){"undefined"===typeof b&&(b=0);"undefined"===typeof d&&(d=a.length);for(var c=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,
1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,
4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,
62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,
3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,
2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],e=-1,h=0;b<d;b++)h=(e^a[b])&255,e=e>>>8^c[h];return e^-1}var d=a[0].length,c=a[0][0].length,k,e,h,r,n,u,v=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,c>>
24&255,c>>16&255,c>>8&255,c&255,d>>24&255,d>>16&255,d>>8&255,d&255,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];k=b(v,12,29);v[29]=k>>24&255;v[30]=k>>16&255;v[31]=k>>8&255;v[32]=k&255;k=1;for(n=e=0;n<d;n++){n<d-1?v.push(0):v.push(1);r=3*c+1+(0===n)&255;h=3*c+1+(0===n)>>8&255;v.push(r);v.push(h);v.push(~r&255);v.push(~h&255);0===n&&v.push(0);for(u=0;u<c;u++)for(h=0;3>h;h++)r=a[h][n][u],r=255<r?255:0>r?0:Math.round(r),k=(k+r)%65521,e=(e+k)%65521,v.push(r);v.push(0)}a=(e<<16)+k;v.push(a>>24&255);
v.push(a>>16&255);v.push(a>>8&255);v.push(a&255);a=v.length-41;v[33]=a>>24&255;v[34]=a>>16&255;v[35]=a>>8&255;v[36]=a&255;k=b(v,37);v.push(k>>24&255);v.push(k>>16&255);v.push(k>>8&255);v.push(k&255);v.push(0);v.push(0);v.push(0);v.push(0);v.push(73);v.push(69);v.push(78);v.push(68);v.push(174);v.push(66);v.push(96);v.push(130);return"data:image/png;base64,"+function(a){var b=a.length,d,c,e,h,l,k="";for(d=0;d<b;d+=3)c=a[d],e=a[d+1],h=a[d+2],l=c>>2,c=((c&3)<<4)+(e>>4),e=((e&15)<<2)+(h>>6),h&=63,d+1>=
b?e=h=64:d+2>=b&&(h=64),k+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h);return k}(v)};numeric._dim=function(a){for(var b=[];"object"===typeof a;)b.push(a.length),a=a[0];return b};
numeric.dim=function(a){var b,d;return"object"===typeof a?(b=a[0],"object"===typeof b?(d=b[0],"object"===typeof d?numeric._dim(a):[a.length,b.length]):[a.length]):[]};
numeric.mapreduce=function(a,b){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+b+';\nif(typeof x === "number") { var xi = x; '+a+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+a+";\n    xi = x[i-1];\n    "+
a+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+a+"\n}\nreturn accum;")};numeric.mapreduce2=function(a,b){return Function("x","var n = x.length;\nvar i,xi;\n"+b+";\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+a+";\n}\nreturn accum;")};numeric.same=function same(b,d){var c,k;if(!(b instanceof Array&&d instanceof Array))return!1;k=b.length;if(k!==d.length)return!1;for(c=0;c<k;c++)if(b[c]!==d[c])if("object"===typeof b[c]){if(!same(b[c],d[c]))return!1}else return!1;return!0};
numeric.rep=function(a,b,d){"undefined"===typeof d&&(d=0);var c=a[d],k=Array(c);if(d===a.length-1){for(c-=2;0<=c;c-=2)k[c+1]=b,k[c]=b;-1===c&&(k[0]=b);return k}for(--c;0<=c;c--)k[c]=numeric.rep(a,b,d+1);return k};numeric.dotMMsmall=function(a,b){var d,c,k,e,h,r,n,u,v,w;d=a.length;e=b.length;h=b[0].length;r=Array(d);for(--d;0<=d;d--){n=Array(h);u=a[d];for(k=h-1;0<=k;k--){v=u[e-1]*b[e-1][k];for(c=e-2;1<=c;c-=2)w=c-1,v+=u[c]*b[c][k]+u[w]*b[w][k];0===c&&(v+=u[0]*b[0][k]);n[k]=v}r[d]=n}return r};
numeric._getCol=function(a,b,d){var c;for(c=a.length-1;0<c;--c)d[c]=a[c][b],--c,d[c]=a[c][b];0===c&&(d[0]=a[0][b])};numeric.dotMMbig=function(a,b){var d=numeric._getCol,c=Array(b.length),k=a.length,e=b[0].length,h=Array(k),r=numeric.dotVV,n,u;--k;for(n=k;-1!==n;--n)h[n]=Array(e);--e;for(n=e;-1!==n;--n)for(d(b,n,c),u=k;-1!==u;--u)e=a[u],h[u][n]=r(e,c);return h};numeric.dotMV=function(a,b){for(var d=a.length,c=Array(d),k=numeric.dotVV,d=d-1;0<=d;d--)c[d]=k(a[d],b);return c};
numeric.dotVM=function(a,b){var d,c,k,e,h,r;k=a.length;d=b[0].length;e=Array(d);for(c=d-1;0<=c;c--){h=a[k-1]*b[k-1][c];for(d=k-2;1<=d;d-=2)r=d-1,h+=a[d]*b[d][c]+a[r]*b[r][c];0===d&&(h+=a[0]*b[0][c]);e[c]=h}return e};numeric.dotVV=function(a,b){var d;d=a.length;var c,k=a[d-1]*b[d-1];for(d-=2;1<=d;d-=2)c=d-1,k+=a[d]*b[d]+a[c]*b[c];0===d&&(k+=a[0]*b[0]);return k};
numeric.dot=function(a,b){var d=numeric.dim;switch(1E3*d(a).length+d(b).length){case 2002:return 10>b.length?numeric.dotMMsmall(a,b):numeric.dotMMbig(a,b);case 2001:return numeric.dotMV(a,b);case 1002:return numeric.dotVM(a,b);case 1001:return numeric.dotVV(a,b);case 1E3:return numeric.mulVS(a,b);case 1:return numeric.mulSV(a,b);case 0:return a*b;default:throw Error("numeric.dot only works on vectors and matrices");}};
numeric.diag=function(a){var b,d,c,k=a.length,e=Array(k),h;for(b=k-1;0<=b;b--){h=Array(k);d=b+2;for(c=k-1;c>=d;c-=2)h[c]=0,h[c-1]=0;c>b&&(h[c]=0);h[b]=a[b];for(c=b-1;1<=c;c-=2)h[c]=0,h[c-1]=0;0===c&&(h[0]=0);e[b]=h}return e};numeric.getDiag=function(a){for(var b=Math.min(a.length,a[0].length),d=Array(b),b=b-1;1<=b;--b)d[b]=a[b][b],--b,d[b]=a[b][b];0===b&&(d[0]=a[0][0]);return d};numeric.identity=function(a){return numeric.diag(numeric.rep([a],1))};
numeric.pointwise=function(a,b,d){"undefined"===typeof d&&(d="");var c=[],k,e=/\[i\]$/,h,r="",n=!1;for(k=0;k<a.length;k++)e.test(a[k])?r=h=a[k].substring(0,a[k].length-3):h=a[k],"ret"===h&&(n=!0),c.push(h);c[a.length]="_s";c[a.length+1]="_k";c[a.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+r+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(n?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+a.join(",")+",_s,_k+1);\n    return ret;\n}\n"+
d+"\nfor(i=_n-1;i!==-1;--i) {\n    "+b+"\n}\nreturn ret;";return Function.apply(null,c)};numeric.pointwise2=function(a,b,d){"undefined"===typeof d&&(d="");var c=[],k,e=/\[i\]$/,h,r="",n=!1;for(k=0;k<a.length;k++)e.test(a[k])?r=h=a[k].substring(0,a[k].length-3):h=a[k],"ret"===h&&(n=!0),c.push(h);c[a.length]="var _n = "+r+".length;\nvar i"+(n?"":", ret = Array(_n)")+";\n"+d+"\nfor(i=_n-1;i!==-1;--i) {\n"+b+"\n}\nreturn ret;";return Function.apply(null,c)};
numeric._biforeach=function _biforeach(b,d,c,k,e){if(k===c.length-1)e(b,d);else{var h;for(h=c[k]-1;0<=h;h--)_biforeach("object"===typeof b?b[h]:b,"object"===typeof d?d[h]:d,c,k+1,e)}};numeric._biforeach2=function _biforeach2(b,d,c,k,e){if(k===c.length-1)return e(b,d);var h;h=c[k];var r=Array(h);for(--h;0<=h;--h)r[h]=_biforeach2("object"===typeof b?b[h]:b,"object"===typeof d?d[h]:d,c,k+1,e);return r};
numeric._foreach=function _foreach(b,d,c,k){if(c===d.length-1)k(b);else{var e;for(e=d[c]-1;0<=e;e--)_foreach(b[e],d,c+1,k)}};numeric._foreach2=function _foreach2(b,d,c,k){if(c===d.length-1)return k(b);var e;e=d[c];var h=Array(e);for(--e;0<=e;e--)h[e]=_foreach2(b[e],d,c+1,k);return h};numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};
numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="};numeric.mathfuns="abs acos asin atan ceil cos exp floor log round sin sqrt tan isNaN isFinite".split(" ");numeric.mathfuns2=["atan2","pow","max","min"];numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""};
numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]};
(function(){var a,b;for(a=0;a<numeric.mathfuns2.length;++a)b=numeric.mathfuns2[a],numeric.ops2[b]=b;for(a in numeric.ops2)if(numeric.ops2.hasOwnProperty(a)){b=numeric.ops2[a];var d,c,k="";-1!==numeric.myIndexOf.call(numeric.mathfuns2,a)?(k="var "+b+" = Math."+b+";\n",d=function(a,d,c){return a+" = "+b+"("+d+","+c+")"},c=function(a,d){return a+" = "+b+"("+a+","+d+")"}):(d=function(a,d,c){return a+" = "+d+" "+b+" "+c},c=numeric.opseq.hasOwnProperty(a+"eq")?function(a,d){return a+" "+b+"= "+d}:function(a,
d){return a+" = "+a+" "+b+" "+d});numeric[a+"VV"]=numeric.pointwise2(["x[i]","y[i]"],d("ret[i]","x[i]","y[i]"),k);numeric[a+"SV"]=numeric.pointwise2(["x","y[i]"],d("ret[i]","x","y[i]"),k);numeric[a+"VS"]=numeric.pointwise2(["x[i]","y"],d("ret[i]","x[i]","y"),k);numeric[a]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+a+"VV, VS = numeric."+a+"VS, SV = numeric."+a+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+
c("x","y")+"\n}\nreturn x;\n");numeric[b]=numeric[a];numeric[a+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],c("ret[i]","x[i]"),k);numeric[a+"eqS"]=numeric.pointwise2(["ret[i]","x"],c("ret[i]","x"),k);numeric[a+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+a+"eqV, S = numeric."+a+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n')}for(a=
0;a<numeric.mathfuns2.length;++a)b=numeric.mathfuns2[a],delete numeric.ops2[b];for(a=0;a<numeric.mathfuns.length;++a)b=numeric.mathfuns[a],numeric.ops1[b]=b;for(a in numeric.ops1)numeric.ops1.hasOwnProperty(a)&&(k="",b=numeric.ops1[a],-1!==numeric.myIndexOf.call(numeric.mathfuns,a)&&Math.hasOwnProperty(b)&&(k="var "+b+" = Math."+b+";\n"),numeric[a+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+b+"(ret[i]);",k),numeric[a+"eq"]=Function("x",'if(typeof x !== "object") return '+b+"x\nvar i;\nvar V = numeric."+
a+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),numeric[a+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+b+"(x[i]);",k),numeric[a]=Function("x",'if(typeof x !== "object") return '+b+"(x)\nvar i;\nvar V = numeric."+a+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));for(a=0;a<numeric.mathfuns.length;++a)b=numeric.mathfuns[a],delete numeric.ops1[b];for(a in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(a)&&(b=numeric.mapreducers[a],numeric[a+"V"]=
numeric.mapreduce2(b[0],b[1]),numeric[a]=Function("x","s","k",b[1]+'if(typeof x !== "object") {    xi = x;\n'+b[0]+';\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+a+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+b[0]+";\n}\nreturn accum;\n"))})();numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;");
numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;");numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;");numeric.trunc=function(a,b){return"object"===typeof a?"object"===typeof b?numeric.truncVV(a,b):numeric.truncVS(a,b):"object"===typeof b?numeric.truncSV(a,b):Math.round(a/b)*b};
numeric.inv=function(a){var b=numeric.dim(a),d=Math.abs,c=b[0],b=b[1],k=numeric.clone(a),e,h,r=numeric.identity(c),n,u,v,w,y;for(w=0;w<b;++w){h=a=-1;for(v=w;v!==c;++v)y=d(k[v][w]),y>h&&(a=v,h=y);h=k[a];k[a]=k[w];k[w]=h;u=r[a];r[a]=r[w];r[w]=u;a=h[w];for(y=w;y!==b;++y)h[y]/=a;for(y=b-1;-1!==y;--y)u[y]/=a;for(v=c-1;-1!==v;--v)if(v!==w){e=k[v];n=r[v];a=e[w];for(y=w+1;y!==b;++y)e[y]-=h[y]*a;for(y=b-1;0<y;--y)n[y]-=u[y]*a,--y,n[y]-=u[y]*a;0===y&&(n[0]-=u[0]*a)}}return r};
numeric.det=function(a){var b=numeric.dim(a);if(2!==b.length||b[0]!==b[1])throw Error("numeric: det() only works on square matrices");var b=b[0],d=1,c,k,e=numeric.clone(a),h,r,n,u;for(a=0;a<b-1;a++){k=a;for(c=a+1;c<b;c++)Math.abs(e[c][a])>Math.abs(e[k][a])&&(k=c);k!==a&&(c=e[k],e[k]=e[a],e[a]=c,d*=-1);h=e[a];for(c=a+1;c<b;c++){r=e[c];n=r[a]/h[a];for(k=a+1;k<b-1;k+=2)u=k+1,r[k]-=h[k]*n,r[u]-=h[u]*n;k!==b&&(r[k]-=h[k]*n)}if(0===h[a])return 0;d*=h[a]}return d*e[a][a]};
numeric.transpose=function(a){var b,d;b=a.length;var c=a[0].length,k=Array(c),e,h,r;for(d=0;d<c;d++)k[d]=Array(b);for(--b;1<=b;b-=2){h=a[b];e=a[b-1];for(d=c-1;1<=d;--d)r=k[d],r[b]=h[d],r[b-1]=e[d],--d,r=k[d],r[b]=h[d],r[b-1]=e[d];0===d&&(r=k[0],r[b]=h[0],r[b-1]=e[0])}if(0===b){e=a[0];for(d=c-1;1<=d;--d)k[d][0]=e[d],--d,k[d][0]=e[d];0===d&&(k[0][0]=e[0])}return k};
numeric.negtranspose=function(a){var b,d;b=a.length;var c=a[0].length,k=Array(c),e,h,r;for(d=0;d<c;d++)k[d]=Array(b);for(--b;1<=b;b-=2){h=a[b];e=a[b-1];for(d=c-1;1<=d;--d)r=k[d],r[b]=-h[d],r[b-1]=-e[d],--d,r=k[d],r[b]=-h[d],r[b-1]=-e[d];0===d&&(r=k[0],r[b]=-h[0],r[b-1]=-e[0])}if(0===b){e=a[0];for(d=c-1;1<=d;--d)k[d][0]=-e[d],--d,k[d][0]=-e[d];0===d&&(k[0][0]=-e[0])}return k};
numeric._random=function _random(b,d){var c;c=b[d];var k=Array(c),e;if(d===b.length-1){e=Math.random;for(--c;1<=c;c-=2)k[c]=e(),k[c-1]=e();0===c&&(k[0]=e());return k}for(--c;0<=c;c--)k[c]=_random(b,d+1);return k};numeric.random=function(a){return numeric._random(a,0)};numeric.norm2=function(a){return Math.sqrt(numeric.norm2Squared(a))};
numeric.linspace=function(a,b,d){"undefined"===typeof d&&(d=Math.max(Math.round(b-a)+1,1));if(2>d)return 1===d?[a]:[];var c,k=Array(d);d--;for(c=d;0<=c;c--)k[c]=(c*b+(d-c)*a)/d;return k};numeric.getBlock=function(a,b,d){function c(a,h){var r,n=b[h];r=d[h]-n;var u=Array(r);if(h===k.length-1){for(;0<=r;r--)u[r]=a[r+n];return u}for(;0<=r;r--)u[r]=c(a[r+n],h+1);return u}var k=numeric.dim(a);return c(a,0)};
numeric.setBlock=function(a,b,d,c){function k(a,c,n){var u,v=b[n],w=d[n]-v;if(n===e.length-1)for(u=w;0<=u;u--)a[u+v]=c[u];for(u=w;0<=u;u--)k(a[u+v],c[u],n+1)}var e=numeric.dim(a);k(a,c,0);return a};numeric.getRange=function(a,b,d){for(var c=b.length,k=d.length,e,h=Array(c),r,n,c=c-1;-1!==c;--c)for(h[c]=Array(k),r=h[c],n=a[b[c]],e=k-1;-1!==e;--e)r[e]=n[d[e]];return h};
numeric.blockMatrix=function(a){var b=numeric.dim(a);if(4>b.length)return numeric.blockMatrix([a]);var d=b[0],b=b[1],c,k,e,h;for(e=k=c=0;e<d;++e)c+=a[e][0].length;for(h=0;h<b;++h)k+=a[0][h][0].length;var r=Array(c);for(e=0;e<c;++e)r[e]=Array(k);var n=0,u,v,w,y,E;for(e=0;e<d;++e){u=k;for(h=b-1;-1!==h;--h)for(c=a[e][h],u-=c[0].length,w=c.length-1;-1!==w;--w)for(E=c[w],v=r[n+w],y=E.length-1;-1!==y;--y)v[u+y]=E[y];n+=a[e][0].length}return r};
numeric.tensor=function(a,b){if("number"===typeof a||"number"===typeof b)return numeric.mul(a,b);var d=numeric.dim(a),c=numeric.dim(b);if(1!==d.length||1!==c.length)throw Error("numeric: tensor product is only defined for vectors");var k=d[0],c=c[0],d=Array(k),e,h,r;for(e=k-1;0<=e;e--){k=Array(c);r=a[e];for(h=c-1;3<=h;--h)k[h]=r*b[h],--h,k[h]=r*b[h],--h,k[h]=r*b[h],--h,k[h]=r*b[h];for(;0<=h;)k[h]=r*b[h],--h;d[e]=k}return d};numeric.T=function(a,b){this.x=a;this.y=b};
numeric.t=function(a,b){return new numeric.T(a,b)};
numeric.Tbinop=function(a,b,d,c,k){if("string"!==typeof k){var e;k="";for(e in numeric)numeric.hasOwnProperty(e)&&(0<=a.indexOf(e)||0<=b.indexOf(e)||0<=d.indexOf(e)||0<=c.indexOf(e))&&1<e.length&&(k+="var "+e+" = numeric."+e+";\n")}return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+k+"\nif(x.y) {  if(y.y) {    return new numeric.T("+c+");\n  }\n  return new numeric.T("+d+");\n}\nif(y.y) {\n  return new numeric.T("+b+");\n}\nreturn new numeric.T("+a+");\n")};
numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)");numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)");numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))");
numeric.T.prototype.reciprocal=function(){var a=numeric.mul,b=numeric.div;return this.y?(a=numeric.add(a(this.x,this.x),a(this.y,this.y)),new numeric.T(b(this.x,a),b(numeric.neg(this.y),a))):new numeric.T(b(1,this.x),0)};numeric.T.prototype.div=function(a){a instanceof numeric.T||(a=new numeric.T(a));if(a.y)return this.mul(a.reciprocal());var b=numeric.div;return this.y?new numeric.T(b(this.x,a.x),b(this.y,a.x)):new numeric.T(b(this.x,a.x))};
numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))");numeric.T.prototype.transpose=function(){var a=numeric.transpose,b=this.x,d=this.y;return d?new numeric.T(a(b),a(d)):new numeric.T(a(b))};numeric.T.prototype.transjugate=function(){var a=numeric.transpose,b=this.x,d=this.y;return d?new numeric.T(a(b),numeric.negtranspose(d)):new numeric.T(a(b))};
numeric.Tunop=function(a,b,d){"string"!==typeof d&&(d="");return Function("var x = this;\n"+d+"\nif(x.y) {  "+b+";\n}\n"+a+";\n")};numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;");numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));");
numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;");numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));");numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);");
numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;");numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);");numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));");
numeric.T.prototype.inv=function(){if("undefined"===typeof this.y)return new numeric.T(numeric.inv(this.x));var a=this.x.length,b,d,c,k=numeric.identity(a),e=numeric.rep([a,a],0),h=numeric.clone(this.x),r=numeric.clone(this.y),n,u,v,w,y,E,C,H,F,l,L,J;for(b=0;b<a;b++){F=h[b][b];l=r[b][b];v=F*F+l*l;c=b;for(d=b+1;d<a;d++)F=h[d][b],l=r[d][b],n=F*F+l*l,n>v&&(c=d,v=n);c!==b&&(d=h[b],h[b]=h[c],h[c]=d,d=r[b],r[b]=r[c],r[c]=d,d=k[b],k[b]=k[c],k[c]=d,d=e[b],e[b]=e[c],e[c]=d);n=h[b];u=r[b];y=k[b];E=e[b];F=n[b];
l=u[b];for(d=b+1;d<a;d++)L=n[d],J=u[d],n[d]=(L*F+J*l)/v,u[d]=(J*F-L*l)/v;for(d=0;d<a;d++)L=y[d],J=E[d],y[d]=(L*F+J*l)/v,E[d]=(J*F-L*l)/v;for(d=b+1;d<a;d++){v=h[d];w=r[d];C=k[d];H=e[d];F=v[b];l=w[b];for(c=b+1;c<a;c++)L=n[c],J=u[c],v[c]-=L*F-J*l,w[c]-=J*F+L*l;for(c=0;c<a;c++)L=y[c],J=E[c],C[c]-=L*F-J*l,H[c]-=J*F+L*l}}for(b=a-1;0<b;b--)for(y=k[b],E=e[b],d=b-1;0<=d;d--)for(C=k[d],H=e[d],F=h[d][b],l=r[d][b],c=a-1;0<=c;c--)L=y[c],J=E[c],C[c]-=F*L-l*J,H[c]-=F*J+l*L;return new numeric.T(k,e)};
numeric.T.prototype.get=function(a){var b=this.x,d=this.y,c=0,k,e=a.length;if(d){for(;c<e;)k=a[c],b=b[k],d=d[k],c++;return new numeric.T(b,d)}for(;c<e;)k=a[c],b=b[k],c++;return new numeric.T(b)};
numeric.T.prototype.set=function(a,b){var d=this.x,c=this.y,k=0,e,h=a.length,r=b.x,n=b.y;if(0===h)return n?this.y=n:c&&(this.y=void 0),this.x=d,this;if(n){c||(this.y=c=numeric.rep(numeric.dim(d),0));for(;k<h-1;)e=a[k],d=d[e],c=c[e],k++;e=a[k];d[e]=r;c[e]=n;return this}if(c){for(;k<h-1;)e=a[k],d=d[e],c=c[e],k++;e=a[k];d[e]=r;c[e]=r instanceof Array?numeric.rep(numeric.dim(r),0):0;return this}for(;k<h-1;)e=a[k],d=d[e],k++;e=a[k];d[e]=r;return this};
numeric.T.prototype.getRows=function(a,b){var d=b-a+1,c,k=Array(d),e=this.x,h=this.y;for(c=a;c<=b;c++)k[c-a]=e[c];if(h){d=Array(d);for(c=a;c<=b;c++)d[c-a]=h[c];return new numeric.T(k,d)}return new numeric.T(k)};numeric.T.prototype.setRows=function(a,b,d){var c=this.x,k=this.y,e=d.x,h=d.y;for(d=a;d<=b;d++)c[d]=e[d-a];if(h)for(k||(this.y=k=numeric.rep(numeric.dim(c),0)),d=a;d<=b;d++)k[d]=h[d-a];else if(k)for(d=a;d<=b;d++)k[d]=numeric.rep([e[d-a].length],0);return this};
numeric.T.prototype.getRow=function(a){var b=this.x,d=this.y;return d?new numeric.T(b[a],d[a]):new numeric.T(b[a])};numeric.T.prototype.setRow=function(a,b){var d=this.x,c=this.y,k=b.x,e=b.y;d[a]=k;e?(c||(this.y=c=numeric.rep(numeric.dim(d),0)),c[a]=e):c&&numeric.rep([k.length],0);return this};numeric.T.prototype.getBlock=function(a,b){var d=this.x,c=this.y,k=numeric.getBlock;return c?new numeric.T(k(d,a,b),k(c,a,b)):new numeric.T(k(d,a,b))};
numeric.T.prototype.setBlock=function(a,b,d){d instanceof numeric.T||(d=new numeric.T(d));var c=this.x,k=this.y,e=numeric.setBlock,h=d.x;if(d=d.y)return k||(k=this.y=numeric.rep(numeric.dim(this),0)),e(c,a,b,h),e(k,a,b,d),this;e(c,a,b,h);k&&e(k,a,b,numeric.rep(numeric.dim(h),0))};numeric.T.rep=function(a,b){var d=numeric.T;b instanceof d||(b=new d(b));var c=b.x,k=b.y,e=numeric.rep;return k?new d(e(a,c),e(a,k)):new d(e(a,c))};
numeric.T.diag=function(a){a instanceof numeric.T||(a=new numeric.T(a));var b=a.x;a=a.y;var d=numeric.diag;return a?new numeric.T(d(b),d(a)):new numeric.T(d(b))};numeric.T.identity=function(a){return new numeric.T(numeric.identity(a))};numeric.T.prototype.getDiag=function(){var a=numeric,b=this.x,d=this.y;return d?new a.T(a.getDiag(b),a.getDiag(d)):new a.T(a.getDiag(b))};
numeric.house=function(a){var b=numeric.clone(a);a=(0<=a[0]?1:-1)*numeric.norm2(a);b[0]+=a;a=numeric.norm2(b);if(0===a)throw Error("eig: internal error");return numeric.div(b,a)};
numeric.toUpperHessenberg=function(a){var b=numeric.dim(a);if(2!==b.length||b[0]!==b[1])throw Error("numeric: toUpperHessenberg() only works on square matrices");var b=b[0],d,c,k,e=numeric.clone(a),h,r,n,u=numeric.identity(b);for(d=0;d<b-2;d++){c=Array(b-d-1);for(a=d+1;a<b;a++)c[a-d-1]=e[a][d];if(0<numeric.norm2(c)){k=numeric.house(c);c=numeric.getBlock(e,[d+1,d],[b-1,b-1]);h=numeric.tensor(k,numeric.dot(k,c));for(a=d+1;a<b;a++)for(r=e[a],n=h[a-d-1],c=d;c<b;c++)r[c]-=2*n[c-d];c=numeric.getBlock(e,
[0,d+1],[b-1,b-1]);h=numeric.tensor(numeric.dot(c,k),k);for(a=0;a<b;a++)for(r=e[a],n=h[a],c=d+1;c<b;c++)r[c]-=2*n[c-d-1];c=Array(b-d-1);for(a=d+1;a<b;a++)c[a-d-1]=u[a];h=numeric.tensor(k,numeric.dot(k,c));for(a=d+1;a<b;a++)for(k=u[a],n=h[a-d-1],c=0;c<b;c++)k[c]-=2*n[c]}}return{H:e,Q:u}};numeric.epsilon=2.220446049250313E-16;
numeric.QRFrancis=function(a,b){"undefined"===typeof b&&(b=1E4);a=numeric.clone(a);numeric.clone(a);var d=numeric.dim(a)[0],c,k,e,h,r,n,u=numeric.identity(d),v,w,y;if(3>d)return{Q:u,B:[[0,d-1]]};var E=numeric.epsilon;for(y=0;y<b;y++){for(e=0;e<d-1;e++)if(Math.abs(a[e+1][e])<E*(Math.abs(a[e][e])+Math.abs(a[e+1][e+1]))){y=numeric.QRFrancis(numeric.getBlock(a,[0,0],[e,e]),b);E=numeric.QRFrancis(numeric.getBlock(a,[e+1,e+1],[d-1,d-1]),b);h=Array(e+1);for(n=0;n<=e;n++)h[n]=u[n];h=numeric.dot(y.Q,h);for(n=
0;n<=e;n++)u[n]=h[n];h=Array(d-e-1);for(n=e+1;n<d;n++)h[n-e-1]=u[n];h=numeric.dot(E.Q,h);for(n=e+1;n<d;n++)u[n]=h[n-e-1];return{Q:u,B:y.B.concat(numeric.add(E.B,e+1))}}e=a[d-2][d-2];c=a[d-2][d-1];h=a[d-1][d-2];r=a[d-1][d-1];n=e+r;h=e*r-c*h;e=numeric.getBlock(a,[0,0],[2,2]);n*n>=4*h?(c=.5*(n+Math.sqrt(n*n-4*h)),n=.5*(n-Math.sqrt(n*n-4*h)),e=numeric.add(numeric.sub(numeric.dot(e,e),numeric.mul(e,c+n)),numeric.diag(numeric.rep([3],c*n)))):e=numeric.add(numeric.sub(numeric.dot(e,e),numeric.mul(e,n)),
numeric.diag(numeric.rep([3],h)));c=[e[0][0],e[1][0],e[2][0]];k=numeric.house(c);h=[a[0],a[1],a[2]];h=numeric.tensor(k,numeric.dot(k,h));for(n=0;3>n;n++)for(v=a[n],w=h[n],c=0;c<d;c++)v[c]-=2*w[c];h=numeric.getBlock(a,[0,0],[d-1,2]);h=numeric.tensor(numeric.dot(h,k),k);for(n=0;n<d;n++)for(v=a[n],w=h[n],c=0;3>c;c++)v[c]-=2*w[c];h=[u[0],u[1],u[2]];h=numeric.tensor(k,numeric.dot(k,h));for(n=0;3>n;n++)for(k=u[n],w=h[n],c=0;c<d;c++)k[c]-=2*w[c];for(e=0;e<d-2;e++){for(c=e;c<=e+1;c++)if(Math.abs(a[c+1][c])<
E*(Math.abs(a[c][c])+Math.abs(a[c+1][c+1]))){y=numeric.QRFrancis(numeric.getBlock(a,[0,0],[c,c]),b);E=numeric.QRFrancis(numeric.getBlock(a,[c+1,c+1],[d-1,d-1]),b);h=Array(c+1);for(n=0;n<=c;n++)h[n]=u[n];h=numeric.dot(y.Q,h);for(n=0;n<=c;n++)u[n]=h[n];h=Array(d-c-1);for(n=c+1;n<d;n++)h[n-c-1]=u[n];h=numeric.dot(E.Q,h);for(n=c+1;n<d;n++)u[n]=h[n-c-1];return{Q:u,B:y.B.concat(numeric.add(E.B,c+1))}}r=Math.min(d-1,e+3);c=Array(r-e);for(n=e+1;n<=r;n++)c[n-e-1]=a[n][e];k=numeric.house(c);h=numeric.getBlock(a,
[e+1,e],[r,d-1]);h=numeric.tensor(k,numeric.dot(k,h));for(n=e+1;n<=r;n++)for(v=a[n],w=h[n-e-1],c=e;c<d;c++)v[c]-=2*w[c-e];h=numeric.getBlock(a,[0,e+1],[d-1,r]);h=numeric.tensor(numeric.dot(h,k),k);for(n=0;n<d;n++)for(v=a[n],w=h[n],c=e+1;c<=r;c++)v[c]-=2*w[c-e-1];h=Array(r-e);for(n=e+1;n<=r;n++)h[n-e-1]=u[n];h=numeric.tensor(k,numeric.dot(k,h));for(n=e+1;n<=r;n++)for(k=u[n],w=h[n-e-1],c=0;c<d;c++)k[c]-=2*w[c]}}throw Error("numeric: eigenvalue iteration does not converge -- increase maxiter?");};
numeric.eig=function(a,b){for(var d=numeric.toUpperHessenberg(a),c=numeric.QRFrancis(d.H,b),k=numeric.T,e=a.length,h,e=c.B,r=numeric.dot(c.Q,numeric.dot(d.H,numeric.transpose(c.Q))),c=new k(numeric.dot(c.Q,d.Q)),n,u=e.length,v,w,y,E,C,H,F,l,L=Math.sqrt,d=0;d<u;d++)if(h=e[d][0],h!==e[d][1]&&(v=h+1,w=r[h][h],y=r[h][v],E=r[v][h],C=r[v][v],0!==y||0!==E))n=-w-C,H=w*C-y*E,H=n*n-4*H,0<=H?(n=0>n?-.5*(n-L(H)):-.5*(n+L(H)),F=(w-n)*(w-n)+y*y,l=E*E+(C-n)*(C-n),F>l?(F=L(F),w=(w-n)/F,y/=F):(l=L(l),w=E/l,y=(C-n)/
l),n=new k([[y,-w],[w,y]])):(n*=-.5,H=.5*L(-H),F=(w-n)*(w-n)+y*y,l=E*E+(C-n)*(C-n),F>l?(F=L(F+H*H),w=(w-n)/F,y/=F,n=0,H/=F):(l=L(l+H*H),w=E/l,y=(C-n)/l,n=H/l,H=0),n=new k([[y,-w],[w,y]],[[n,H],[H,-n]])),c.setRows(h,v,n.dot(c.getRows(h,v)));k=c.dot(a).dot(c.transjugate());e=a.length;r=numeric.T.identity(e);for(v=0;v<e;v++)if(0<v)for(d=v-1;0<=d;d--)h=k.get([d,d]),u=k.get([v,v]),numeric.neq(h.x,u.x)||numeric.neq(h.y,u.y)?(n=k.getRow(d).getBlock([d],[v-1]),H=r.getRow(v).getBlock([d],[v-1]),r.set([v,d],
k.get([d,v]).neg().sub(n.dot(H)).div(h.sub(u)))):r.setRow(v,r.getRow(d));for(v=0;v<e;v++)n=r.getRow(v),r.setRow(v,n.div(n.norm2()));r=r.transpose();r=c.transjugate().dot(r);return{lambda:k.getDiag(),E:r}};
numeric.ccsSparse=function(a){var b=a.length,d,c,k,e=[];for(c=b-1;-1!==c;--c)for(k in d=a[c],d){for(k=parseInt(k);k>=e.length;)e[e.length]=0;0!==d[k]&&e[k]++}d=e.length;var h=Array(d+1);for(c=h[0]=0;c<d;++c)h[c+1]=h[c]+e[c];var r=Array(h[d]),n=Array(h[d]);for(c=b-1;-1!==c;--c)for(k in d=a[c],d)0!==d[k]&&(e[k]--,r[h[k]+e[k]]=c,n[h[k]+e[k]]=d[k]);return[h,r,n]};
numeric.ccsFull=function(a){var b=a[0],d=a[1],c=a[2],k=numeric.ccsDim(a);a=k[1];for(var e,h,r=numeric.rep([k[0],a],0),k=0;k<a;k++)for(e=b[k],h=b[k+1];e<h;++e)r[d[e]][k]=c[e];return r};
numeric.ccsTSolve=function(a,b,d,c,k){function e(a){var b;if(0===d[a]){d[a]=1;for(b=h[a];b<h[a+1];++b)e(r[b]);k[v]=a;++v}}var h=a[0],r=a[1];a=a[2];var n=h.length-1,u=Math.max,v=0;"undefined"===typeof c&&(d=numeric.rep([n],0));"undefined"===typeof c&&(c=numeric.linspace(0,d.length-1));"undefined"===typeof k&&(k=[]);for(var w,y,E,n=c.length-1;-1!==n;--n)e(c[n]);k.length=v;for(n=k.length-1;-1!==n;--n)d[k[n]]=0;for(n=c.length-1;-1!==n;--n)w=c[n],d[w]=b[w];for(n=k.length-1;-1!==n;--n){w=k[n];y=h[w];b=
u(h[w+1],y);for(c=y;c!==b;++c)if(r[c]===w){d[w]/=a[c];break}E=d[w];for(c=y;c!==b;++c)y=r[c],y!==w&&(d[y]-=E*a[c])}return d};numeric.ccsDFS=function(a){this.k=Array(a);this.k1=Array(a);this.j=Array(a)};numeric.ccsDFS.prototype.dfs=function(a,b,d,c,k,e){var h=0,r=k.length,n=this.k,u=this.k1,v=this.j,w,y;if(0===c[a])for(c[a]=1,v[0]=a,n[0]=w=b[a],u[0]=y=b[a+1];;)if(w>=y){k[r]=v[h];if(0===h)break;++r;--h;w=n[h];y=u[h]}else a=e[d[w]],0===c[a]?(c[a]=1,n[h]=w,++h,v[h]=a,w=b[a],u[h]=y=b[a+1]):++w};
numeric.ccsLPSolve=function(a,b,d,c,k,e,h){var r=a[0],n=a[1];a=a[2];var u=b[0],v=b[1];b=b[2];var w;w=u[k];u=u[k+1];c.length=0;for(k=w;k<u;++k)h.dfs(e[v[k]],r,n,d,c,e);for(k=c.length-1;-1!==k;--k)d[c[k]]=0;for(k=w;k!==u;++k)h=e[v[k]],d[h]=b[k];for(k=c.length-1;-1!==k;--k){h=c[k];u=r[h];v=r[h+1];for(b=u;b<v;++b)if(e[n[b]]===h){d[h]/=a[b];break}w=d[h];for(b=u;b<v;++b)u=e[n[b]],u!==h&&(d[u]-=w*a[b])}return d};
numeric.ccsLUP1=function(a,b){var d=a[0].length-1,c=[numeric.rep([d+1],0),[],[]],k=[numeric.rep([d+1],0),[],[]],e=c[0],h=c[1],r=c[2],n=k[0],u=k[1],v=k[2],w=numeric.rep([d],0),y=numeric.rep([d],0),E,C,H,F,l,L,J,P=numeric.ccsLPSolve,O=Math.abs,X=numeric.linspace(0,d-1),ea=numeric.linspace(0,d-1),ia=new numeric.ccsDFS(d);"undefined"===typeof b&&(b=1);for(E=0;E<d;++E){P(c,a,w,y,E,ea,ia);l=F=-1;for(C=y.length-1;-1!==C;--C)H=y[C],H<=E||(L=O(w[H]),L>F&&(l=H,F=L));O(w[E])<b*F&&(C=X[E],F=X[l],X[E]=F,ea[F]=
E,X[l]=C,ea[C]=l,F=w[E],w[E]=w[l],w[l]=F);F=e[E];l=n[E];J=w[E];h[F]=X[E];r[F]=1;++F;for(C=y.length-1;-1!==C;--C)H=y[C],L=w[H],y[C]=0,w[H]=0,H<=E?(u[l]=H,v[l]=L,++l):(h[F]=X[H],r[F]=L/J,++F);e[E+1]=F;n[E+1]=l}for(C=h.length-1;-1!==C;--C)h[C]=ea[h[C]];return{L:c,U:k,P:X,Pinv:ea}};numeric.ccsDFS0=function(a){this.k=Array(a);this.k1=Array(a);this.j=Array(a)};
numeric.ccsDFS0.prototype.dfs=function(a,b,d,c,k,e,h){h=0;var r=k.length,n=this.k,u=this.k1,v=this.j,w,y;if(0===c[a])for(c[a]=1,v[0]=a,n[0]=w=b[e[a]],u[0]=y=b[e[a]+1];;){if(isNaN(w))throw Error("Ow!");if(w>=y){k[r]=e[v[h]];if(0===h)break;++r;--h;w=n[h];y=u[h]}else a=d[w],0===c[a]?(c[a]=1,n[h]=w,++h,v[h]=a,a=e[a],w=b[a],u[h]=y=b[a+1]):++w}};
numeric.ccsLPSolve0=function(a,b,d,c,k,e,h,r){var n=a[0],u=a[1];a=a[2];var v=b[0],w=b[1];b=b[2];var y;y=v[k];v=v[k+1];c.length=0;for(k=y;k<v;++k)r.dfs(w[k],n,u,d,c,e,h);for(k=c.length-1;-1!==k;--k)e=c[k],d[h[e]]=0;for(k=y;k!==v;++k)e=w[k],d[e]=b[k];for(k=c.length-1;-1!==k;--k){e=c[k];w=h[e];r=n[e];e=n[e+1];for(b=r;b<e;++b)if(u[b]===w){d[w]/=a[b];break}y=d[w];for(b=r;b<e;++b)d[u[b]]-=y*a[b];d[w]=y}};
numeric.ccsLUP0=function(a,b){var d=a[0].length-1,c=[numeric.rep([d+1],0),[],[]],k=[numeric.rep([d+1],0),[],[]],e=c[0],h=c[1],r=c[2],n=k[0],u=k[1],v=k[2],w=numeric.rep([d],0),y=numeric.rep([d],0),E,C,H,F,l,L,J,P=numeric.ccsLPSolve0,O=Math.abs,X=numeric.linspace(0,d-1),ea=numeric.linspace(0,d-1),ia=new numeric.ccsDFS0(d);"undefined"===typeof b&&(b=1);for(E=0;E<d;++E){P(c,a,w,y,E,ea,X,ia);l=F=-1;for(C=y.length-1;-1!==C;--C)H=y[C],H<=E||(L=O(w[X[H]]),L>F&&(l=H,F=L));O(w[X[E]])<b*F&&(C=X[E],F=X[l],X[E]=
F,ea[F]=E,X[l]=C,ea[C]=l);F=e[E];l=n[E];J=w[X[E]];h[F]=X[E];r[F]=1;++F;for(C=y.length-1;-1!==C;--C)H=y[C],L=w[X[H]],y[C]=0,w[X[H]]=0,H<=E?(u[l]=H,v[l]=L,++l):(h[F]=X[H],r[F]=L/J,++F);e[E+1]=F;n[E+1]=l}for(C=h.length-1;-1!==C;--C)h[C]=ea[h[C]];return{L:c,U:k,P:X,Pinv:ea}};numeric.ccsLUP=numeric.ccsLUP0;numeric.ccsDim=function(a){return[numeric.sup(a[1])+1,a[0].length-1]};
numeric.ccsGetBlock=function(a,b,d){var c=numeric.ccsDim(a),k=c[0],e=c[1];"undefined"===typeof b?b=numeric.linspace(0,k-1):"number"===typeof b&&(b=[b]);"undefined"===typeof d?d=numeric.linspace(0,e-1):"number"===typeof d&&(d=[d]);var h,c=b.length,r=d.length,n,e=numeric.rep([e],0),u=[],v=[],w=[e,u,v],y=a[0],E=a[1];a=a[2];for(var C=numeric.rep([k],0),H=0,F=numeric.rep([k],0),k=0;k<r;++k){h=d[k];var l=y[h],L=y[h+1];for(h=l;h<L;++h)n=E[h],F[n]=1,C[n]=a[h];for(h=0;h<c;++h)n=b[h],F[n]&&(u[H]=h,v[H]=C[b[h]],
++H);for(h=l;h<L;++h)n=E[h],F[n]=0;e[k+1]=H}return w};
numeric.ccsDot=function(a,b){var d=a[0],c=a[1],k=a[2],e=b[0],h=b[1],r=b[2],n=numeric.ccsDim(a),u=numeric.ccsDim(b),v=n[0],u=u[1],n=numeric.rep([v],0),w=numeric.rep([v],0),v=Array(v),y=numeric.rep([u],0),E=[],C=[],H=[y,E,C],F,l,L,J,P,O,X,ea;for(L=0;L!==u;++L){J=e[L];P=e[L+1];X=0;for(l=J;l<P;++l)for(J=h[l],ea=r[l],F=d[J],J=d[J+1];F<J;++F)O=c[F],0===w[O]&&(v[X]=O,w[O]=1,X+=1),n[O]+=k[F]*ea;J=y[L];P=J+X;y[L+1]=P;for(l=X-1;-1!==l;--l)ea=J+l,F=v[l],E[ea]=F,C[ea]=n[F],w[F]=0,n[F]=0;y[L+1]=y[L]+X}return H};
numeric.ccsLUPSolve=function(a,b){var d=a.L,c=a.U,k=b[0],e=!1;"object"!==typeof k&&(b=[[0,b.length],numeric.linspace(0,b.length-1),b],k=b[0],e=!0);var h=b[1],r=b[2],n=d[0].length-1,u=k.length-1,v=numeric.rep([n],0),w=Array(n),y=numeric.rep([n],0),n=Array(n),E=numeric.rep([u+1],0),C=[],H=[],F=numeric.ccsTSolve,l,L,J,P,O,X=0;for(l=0;l<u;++l){P=0;L=k[l];for(J=k[l+1];L<J;++L)O=a.Pinv[h[L]],n[P]=O,y[O]=r[L],++P;n.length=P;F(d,y,v,n,w);for(L=n.length-1;-1!==L;--L)y[n[L]]=0;F(c,v,y,w,n);if(e)return y;for(L=
w.length-1;-1!==L;--L)v[w[L]]=0;for(L=n.length-1;-1!==L;--L)O=n[L],C[X]=O,H[X]=y[O],y[O]=0,++X;E[l+1]=X}return[E,C,H]};
numeric.ccsbinop=function(a,b){"undefined"===typeof b&&(b="");return Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+b+"for(i=0;i<n;++i) {\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Xj[j];\n    x[k] = 1;\n    Zj[p] = k;\n    ++p;\n  }\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Yj[j];\n    y[k] = Yv[j];\n    if(x[k] === 0) {\n      Zj[p] = k;\n      ++p;\n    }\n  }\n  Zi[i+1] = p;\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n  j0 = Zi[i]; j1 = Zi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Zj[j];\n    xk = x[k];\n    yk = y[k];\n"+a+
"\n    Zv[j] = zk;\n  }\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n}\nreturn [Zi,Zj,Zv];")};
(function(){var a,b,d,c;for(a in numeric.ops2)b=isFinite(eval("1"+numeric.ops2[a]+"0"))?"[Y[0],Y[1],numeric."+a+"(X,Y[2])]":"NaN",d=isFinite(eval("0"+numeric.ops2[a]+"1"))?"[X[0],X[1],numeric."+a+"(X[2],Y)]":"NaN",c=isFinite(eval("1"+numeric.ops2[a]+"0"))&&isFinite(eval("0"+numeric.ops2[a]+"1"))?"numeric.ccs"+a+"MM(X,Y)":"NaN",numeric["ccs"+a+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[a]+"yk;"),numeric["ccs"+a]=Function("X","Y",'if(typeof X === "number") return '+b+';\nif(typeof Y === "number") return '+
d+";\nreturn "+c+";\n")})();numeric.ccsScatter=function(a){var b=a[0],d=a[1];a=a[2];var c=numeric.sup(d)+1,k=b.length,e=numeric.rep([c],0),h=Array(k),r=Array(k),n=numeric.rep([c],0),u;for(u=0;u<k;++u)n[d[u]]++;for(u=0;u<c;++u)e[u+1]=e[u]+n[u];var c=e.slice(0),v;for(u=0;u<k;++u)v=d[u],n=c[v],h[n]=b[u],r[n]=a[u],c[v]+=1;return[e,h,r]};
numeric.ccsGather=function(a){var b=a[0],d=a[1];a=a[2];var c=b.length-1,k=d.length,e=Array(k),h=Array(k),k=Array(k),r,n,u,v;for(r=v=0;r<c;++r)for(n=b[r],u=b[r+1];n!==u;++n)h[v]=r,e[v]=d[n],k[v]=a[n],++v;return[e,h,k]};numeric.sdim=function dim(b,d,c){"undefined"===typeof d&&(d=[]);if("object"!==typeof b)return d;"undefined"===typeof c&&(c=0);c in d||(d[c]=0);b.length>d[c]&&(d[c]=b.length);for(var k in b)b.hasOwnProperty(k)&&dim(b[k],d,c+1);return d};
numeric.sclone=function clone(b,d,c){"undefined"===typeof d&&(d=0);"undefined"===typeof c&&(c=numeric.sdim(b).length);var k,e=Array(b.length);if(d===c-1){for(k in b)b.hasOwnProperty(k)&&(e[k]=b[k]);return e}for(k in b)b.hasOwnProperty(k)&&(e[k]=clone(b[k],d+1,c));return e};numeric.sdiag=function(a){for(var b=a.length,d=Array(b),c,b=b-1;1<=b;b-=2)c=b-1,d[b]=[],d[b][b]=a[b],d[c]=[],d[c][c]=a[c];0===b&&(d[0]=[],d[0][0]=a[b]);return d};
numeric.sidentity=function(a){return numeric.sdiag(numeric.rep([a],1))};numeric.stranspose=function(a){var b=[],d,c,k;for(d in a)if(a.hasOwnProperty(d))for(c in k=a[d],k)k.hasOwnProperty(c)&&("object"!==typeof b[c]&&(b[c]=[]),b[c][d]=k[c]);return b};numeric.sLUP=function(a,b){throw Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.");};
numeric.sdotMM=function(a,b){var d=a.length,c=numeric.stranspose(b),k=c.length,e,h,r,n,u,v=Array(d),w;for(h=d-1;0<=h;h--){w=[];d=a[h];for(n=k-1;0<=n;n--){u=0;e=c[n];for(r in d)d.hasOwnProperty(r)&&r in e&&(u+=d[r]*e[r]);u&&(w[n]=u)}v[h]=w}return v};numeric.sdotMV=function(a,b){var d=a.length,c,k,e=Array(d),h;for(c=d-1;0<=c;c--){d=a[c];h=0;for(k in d)d.hasOwnProperty(k)&&b[k]&&(h+=d[k]*b[k]);h&&(e[c]=h)}return e};
numeric.sdotVM=function(a,b){var d,c,k,e,h=[];for(d in a)if(a.hasOwnProperty(d))for(c in k=b[d],e=a[d],k)k.hasOwnProperty(c)&&(h[c]||(h[c]=0),h[c]+=e*k[c]);return h};numeric.sdotVV=function(a,b){var d,c=0;for(d in a)a[d]&&b[d]&&(c+=a[d]*b[d]);return c};
numeric.sdot=function(a,b){var d=numeric.sdim(a).length,c=numeric.sdim(b).length;switch(1E3*d+c){case 0:return a*b;case 1001:return numeric.sdotVV(a,b);case 2001:return numeric.sdotMV(a,b);case 1002:return numeric.sdotVM(a,b);case 2002:return numeric.sdotMM(a,b);default:throw Error("numeric.sdot not implemented for tensors of order "+d+" and "+c);}};
numeric.sscatter=function(a){var b,d,c,k=a.length,e=[],h;for(d=a[0].length-1;0<=d;--d)if(a[k-1][d]){h=e;for(c=0;c<k-2;c++)b=a[c][d],h[b]||(h[b]=[]),h=h[b];h[a[c][d]]=a[c+1][d]}return e};
numeric.sgather=function gather(b,d,c){"undefined"===typeof d&&(d=[]);"undefined"===typeof c&&(c=[]);var k,e,h;k=c.length;for(e in b)if(b.hasOwnProperty(e))if(c[k]=parseInt(e),h=b[e],"number"===typeof h){if(h){if(0===d.length)for(e=k+1;0<=e;--e)d[e]=[];for(e=k;0<=e;--e)d[e].push(c[e]);d[k+1].push(h)}}else gather(h,d,c);c.length>k&&c.pop();return d};
numeric.cLU=function(a){var b=a[0],d=a[1],c=a[2],k=b.length;a=0;var e,h,r;for(e=0;e<k;e++)b[e]>a&&(a=b[e]);a++;var n=Array(a),u=Array(a),v=numeric.rep([a],Infinity),w=numeric.rep([a],-Infinity),y,E;for(r=0;r<k;r++)e=b[r],h=d[r],h<v[e]&&(v[e]=h),h>w[e]&&(w[e]=h);for(e=0;e<a-1;e++)w[e]>w[e+1]&&(w[e+1]=w[e]);for(e=a-1;1<=e;e--)v[e]<v[e-1]&&(v[e-1]=v[e]);for(e=0;e<a;e++)u[e]=numeric.rep([w[e]-v[e]+1],0),n[e]=numeric.rep([e-v[e]],0);for(r=0;r<k;r++)e=b[r],u[e][d[r]-v[e]]=c[r];for(e=0;e<a-1;e++)for(b=e-
v[e],c=u[e],h=e+1;v[h]<=e&&h<a;h++)if(d=e-v[h],k=w[e]-e,y=u[h],E=y[d]/c[b]){for(r=1;r<=k;r++)y[r+d]-=E*c[r+b];n[h][e-v[h]]=E}c=[];y=[];r=[];E=[];var C=[],H=[],F,l;for(e=F=k=0;e<a;e++){b=v[e];d=w[e];l=u[e];for(h=e;h<=d;h++)l[h-b]&&(c[k]=e,y[k]=h,r[k]=l[h-b],k++);l=n[e];for(h=b;h<e;h++)l[h-b]&&(E[F]=e,C[F]=h,H[F]=l[h-b],F++);E[F]=e;C[F]=e;H[F]=1;F++}return{U:[c,y,r],L:[E,C,H]}};
numeric.cLUsolve=function(a,b){var d=a.L,c=a.U,k=numeric.clone(b),e=d[1],d=d[2],h=c[1],r=c[2],c=c[0].length,n=k.length,u,v;for(u=v=0;u<n;u++){for(;e[v]<u;)k[u]-=d[v]*k[e[v]],v++;v++}v=c-1;for(u=n-1;0<=u;u--){for(;h[v]>u;)k[u]-=r[v]*k[h[v]],v--;k[u]/=r[v];v--}return k};
numeric.cgrid=function(a,b){"number"===typeof a&&(a=[a,a]);var d=numeric.rep(a,-1),c,k,e;if("function"!==typeof b)switch(b){case "L":b=function(d,b){return d>=a[0]/2||b<a[1]/2};break;default:b=function(a,d){return!0}}e=0;for(c=1;c<a[0]-1;c++)for(k=1;k<a[1]-1;k++)b(c,k)&&(d[c][k]=e,e++);return d};
numeric.cdelsq=function(a){var b=[[-1,0],[0,-1],[0,1],[1,0]],d=numeric.dim(a),c=d[0],d=d[1],k,e,h,r,n,u=[],v=[],w=[];for(k=1;k<c-1;k++)for(e=1;e<d-1;e++)if(!(0>a[k][e])){for(h=0;4>h;h++)r=k+b[h][0],n=e+b[h][1],0>a[r][n]||(u.push(a[k][e]),v.push(a[r][n]),w.push(-1));u.push(a[k][e]);v.push(a[k][e]);w.push(4)}return[u,v,w]};numeric.cdotMV=function(a,b){var d,c=a[0],k=a[1],e=a[2],h,r=c.length;for(h=d=0;h<r;h++)c[h]>d&&(d=c[h]);d++;d=numeric.rep([d],0);for(h=0;h<r;h++)d[c[h]]+=e[h]*b[k[h]];return d};
numeric.Spline=function(a,b,d,c,k){this.x=a;this.yl=b;this.yr=d;this.kl=c;this.kr=k};numeric.Spline.prototype._at=function(a,b){var d=this.x,c=this.yl,k=this.yr,e=this.kr,h,r=numeric.add,n=numeric.sub,u=numeric.mul;h=n(u(this.kl[b],d[b+1]-d[b]),n(k[b+1],c[b]));e=r(u(e[b+1],d[b]-d[b+1]),n(k[b+1],c[b]));d=(a-d[b])/(d[b+1]-d[b]);n=d*(1-d);return r(r(r(u(1-d,c[b]),u(d,k[b+1])),u(h,n*(1-d))),u(e,n*d))};
numeric.Spline.prototype.at=function(a){if("number"===typeof a){var b=this.x,d=b.length,c,k,e=Math.floor;c=0;for(--d;1<d-c;)k=e((c+d)/2),b[k]<=a?c=k:d=k;return this._at(a,c)}d=a.length;b=Array(d);for(c=d-1;-1!==c;--c)b[c]=this.at(a[c]);return b};
numeric.Spline.prototype.diff=function(){for(var a=this.x,b=this.yl,d=this.yr,c=this.kl,k=this.kr,e=b.length,h,r,n=Array(e),u=Array(e),v=numeric.add,w=numeric.mul,y=numeric.div,E=numeric.sub,e=e-1;-1!==e;--e)h=a[e+1]-a[e],r=E(d[e+1],b[e]),n[e]=y(v(w(r,6),w(c[e],-4*h),w(k[e+1],-2*h)),h*h),u[e+1]=y(v(w(r,-6),w(c[e],2*h),w(k[e+1],4*h)),h*h);return new numeric.Spline(a,c,k,n,u)};
numeric.Spline.prototype.roots=function(){var a=[],b=this.x,d=this.yl,c=this.yr,k=this.kl,e=this.kr;"number"===typeof d[0]&&(d=[d],c=[c],k=[k],e=[e]);var h=d.length,r=b.length-1,n,u,v,w,y,E,C,a=Array(h),H,F,l,L,J,P,O,X,ea=Math.sqrt;for(n=0;n!==h;++n){w=d[n];y=c[n];E=k[n];C=e[n];H=[];for(u=0;u!==r;u++){0<u&&0>y[u]*w[u]&&H.push(b[u]);J=b[u+1]-b[u];v=w[u];L=y[u+1];F=E[u]/J;l=C[u+1]/J;J=F-l+3*(v-L);P=J*J+12*l*v;J=l+3*v+2*F-3*L;v=3*(l+F+2*(v-L));0>=P?(F=J/v,L=F>b[u]&&F<b[u+1]?[b[u],F,b[u+1]]:[b[u],b[u+
1]]):(F=(J-ea(P))/v,O=(J+ea(P))/v,L=[b[u]],F>b[u]&&F<b[u+1]&&L.push(F),O>b[u]&&O<b[u+1]&&L.push(O),L.push(b[u+1]));P=L[0];F=this._at(P,u);for(v=0;v<L.length-1;v++)if(X=L[v+1],O=this._at(X,u),0===F)H.push(P),P=X,F=O;else if(0===O||0<F*O)P=X,F=O;else{for(var ia=0;;){l=(F*X-O*P)/(F-O);if(l<=P||l>=X)break;J=this._at(l,u);if(0<J*O)X=l,O=J,-1===ia&&(F*=.5),ia=-1;else if(0<J*F)P=l,F=J,1===ia&&(O*=.5),ia=1;else break}H.push(l);P=L[v+1];F=this._at(P,u)}0===O&&H.push(X)}a[n]=H}return"number"===typeof this.yl[0]?
a[0]:a};
numeric.spline=function(a,b,d,c){var k=a.length,e=[],h=[],r=[],n,u=numeric.sub,v=numeric.mul,w=numeric.add;for(n=k-2;0<=n;n--)h[n]=a[n+1]-a[n],r[n]=u(b[n+1],b[n]);if("string"===typeof d||"string"===typeof c)d=c="periodic";u=[[],[],[]];switch(typeof d){case "undefined":e[0]=v(3/(h[0]*h[0]),r[0]);u[0].push(0,0);u[1].push(0,1);u[2].push(2/h[0],1/h[0]);break;case "string":e[0]=w(v(3/(h[k-2]*h[k-2]),r[k-2]),v(3/(h[0]*h[0]),r[0]));u[0].push(0,0,0);u[1].push(k-2,0,1);u[2].push(1/h[k-2],2/h[k-2]+2/h[0],1/
h[0]);break;default:e[0]=d,u[0].push(0),u[1].push(0),u[2].push(1)}for(n=1;n<k-1;n++)e[n]=w(v(3/(h[n-1]*h[n-1]),r[n-1]),v(3/(h[n]*h[n]),r[n])),u[0].push(n,n,n),u[1].push(n-1,n,n+1),u[2].push(1/h[n-1],2/h[n-1]+2/h[n],1/h[n]);switch(typeof c){case "undefined":e[k-1]=v(3/(h[k-2]*h[k-2]),r[k-2]);u[0].push(k-1,k-1);u[1].push(k-2,k-1);u[2].push(1/h[k-2],2/h[k-2]);break;case "string":u[1][u[1].length-1]=0;break;default:e[k-1]=c,u[0].push(k-1),u[1].push(k-1),u[2].push(1)}e="number"!==typeof e[0]?numeric.transpose(e):
[e];c=Array(e.length);if("string"===typeof d)for(n=c.length-1;-1!==n;--n)c[n]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(u)),e[n]),c[n][k-1]=c[n][0];else for(n=c.length-1;-1!==n;--n)c[n]=numeric.cLUsolve(numeric.cLU(u),e[n]);c="number"===typeof b[0]?c[0]:numeric.transpose(c);return new numeric.Spline(a,b,b,c,c)};
numeric.fftpow2=function fftpow2(b,d){var c=b.length;if(1!==c){var k=Math.cos,e=Math.sin,h,r,n=Array(c/2),u=Array(c/2),v=Array(c/2),w=Array(c/2);r=c/2;for(h=c-1;-1!==h;--h)--r,v[r]=b[h],w[r]=d[h],--h,n[r]=b[h],u[r]=d[h];fftpow2(n,u);fftpow2(v,w);r=c/2;var y,E=-6.283185307179586/c,C;for(h=c-1;-1!==h;--h)--r,-1===r&&(r=c/2-1),y=E*h,C=k(y),y=e(y),b[h]=n[r]+C*v[r]-y*w[r],d[h]=u[r]+C*w[r]+y*v[r]}};
numeric._ifftpow2=function _ifftpow2(b,d){var c=b.length;if(1!==c){var k=Math.cos,e=Math.sin,h,r,n=Array(c/2),u=Array(c/2),v=Array(c/2),w=Array(c/2);r=c/2;for(h=c-1;-1!==h;--h)--r,v[r]=b[h],w[r]=d[h],--h,n[r]=b[h],u[r]=d[h];_ifftpow2(n,u);_ifftpow2(v,w);r=c/2;var y,E=6.283185307179586/c,C;for(h=c-1;-1!==h;--h)--r,-1===r&&(r=c/2-1),y=E*h,C=k(y),y=e(y),b[h]=n[r]+C*v[r]-y*w[r],d[h]=u[r]+C*w[r]+y*v[r]}};numeric.ifftpow2=function(a,b){numeric._ifftpow2(a,b);numeric.diveq(a,a.length);numeric.diveq(b,b.length)};
numeric.convpow2=function(a,b,d,c){numeric.fftpow2(a,b);numeric.fftpow2(d,c);var k,e,h,r,n;for(k=a.length-1;-1!==k;--k)e=a[k],r=b[k],h=d[k],n=c[k],a[k]=e*h-r*n,b[k]=e*n+r*h;numeric.ifftpow2(a,b)};
numeric.T.prototype.fft=function(){var a=this.x,b=this.y,d=a.length,c=Math.log,k=c(2),c=Math.ceil(c(2*d-1)/k),e=Math.pow(2,c),c=numeric.rep([e],0),k=numeric.rep([e],0),h=Math.cos,r=Math.sin,n,u=-3.141592653589793/d,v=numeric.rep([e],0),w=numeric.rep([e],0);for(n=0;n<d;n++)v[n]=a[n];if("undefined"!==typeof b)for(n=0;n<d;n++)w[n]=b[n];for(n=c[0]=1;n<=e/2;n++)a=u*n*n,c[n]=h(a),k[n]=r(a),c[e-n]=h(a),k[e-n]=r(a);a=new numeric.T(v,w);b=new numeric.T(c,k);a=a.mul(b);numeric.convpow2(a.x,a.y,numeric.clone(b.x),
numeric.neg(b.y));a=a.mul(b);a.x.length=d;a.y.length=d;return a};
numeric.T.prototype.ifft=function(){var a=this.x,b=this.y,d=a.length,c=Math.log,k=c(2),c=Math.ceil(c(2*d-1)/k),e=Math.pow(2,c),c=numeric.rep([e],0),k=numeric.rep([e],0),h=Math.cos,r=Math.sin,n,u=3.141592653589793/d,v=numeric.rep([e],0),w=numeric.rep([e],0);for(n=0;n<d;n++)v[n]=a[n];if("undefined"!==typeof b)for(n=0;n<d;n++)w[n]=b[n];for(n=c[0]=1;n<=e/2;n++)a=u*n*n,c[n]=h(a),k[n]=r(a),c[e-n]=h(a),k[e-n]=r(a);a=new numeric.T(v,w);b=new numeric.T(c,k);a=a.mul(b);numeric.convpow2(a.x,a.y,numeric.clone(b.x),
numeric.neg(b.y));a=a.mul(b);a.x.length=d;a.y.length=d;return a.div(d)};
numeric.gradient=function(a,b){var d=b.length,c=a(b);if(isNaN(c))throw Error("gradient: f(x) is a NaN!");var k=Math.max,e,h=numeric.clone(b),r,n,u=Array(d),v,k=Math.max,w=Math.abs,y=Math.min,E,C,H,F=0,l;for(e=0;e<d;e++)for(var L=k(1E-6*c,1E-8);;){++F;if(20<F)throw Error("Numerical gradient fails");h[e]=b[e]+L;r=a(h);h[e]=b[e]-L;n=a(h);h[e]=b[e];if(isNaN(r)||isNaN(n))L/=16;else if(u[e]=(r-n)/(2*L),E=b[e]-L,C=b[e],H=b[e]+L,v=(r-c)/L,l=(c-n)/L,r=k(w(u[e]),w(c),w(r),w(n),w(E),w(C),w(H),1E-8),v=y(k(w(v-
u[e]),w(l-u[e]),w(v-l))/r,L/r),.001<v)L/=16;else break}return u};
numeric.uncmin=function(a,b,d,c,k,e,h){var r=numeric.gradient;"undefined"===typeof h&&(h={});"undefined"===typeof d&&(d=1E-8);"undefined"===typeof c&&(c=function(l){return r(a,l)});"undefined"===typeof k&&(k=1E3);b=numeric.clone(b);var n=b.length,u=a(b),v,w;if(isNaN(u))throw Error("uncmin: f(x0) is a NaN!");var y=Math.max,E=numeric.norm2;d=y(d,numeric.epsilon);var C,H;h=h.Hinv||numeric.identity(n);var n=numeric.dot,y=numeric.sub,F=numeric.add,l=numeric.tensor,L=numeric.div,J=numeric.mul,P=numeric.all,
O=numeric.isFinite,X=numeric.neg,ea=0,ia,A,R,S,V="";for(H=c(b);ea<k;){if("function"===typeof e&&e(ea,b,u,H,h)){V="Callback returned true";break}if(!P(O(H))){V="Gradient has Infinity or NaN";break}C=X(n(h,H));if(!P(O(C))){V="Search direction has Infinity or NaN";break}S=E(C);if(S<d){V="Newton step smaller than tol";break}R=1;w=n(H,C);for(A=b;ea<k&&!(R*S<d);)if(ia=J(C,R),A=F(b,ia),v=a(A),v-u>=.1*R*w||isNaN(v))R*=.5,++ea;else break;if(R*S<d){V="Line search step size smaller than tol";break}if(ea===k){V=
"maxit reached during line search";break}w=c(A);b=y(w,H);H=n(b,ia);u=n(h,b);h=y(F(h,J((H+n(b,u))/(H*H),l(ia,ia))),L(F(l(u,ia),l(ia,u)),H));b=A;u=v;H=w;++ea}return{solution:b,f:u,gradient:H,invHessian:h,iterations:ea,message:V}};numeric.Dopri=function(a,b,d,c,k,e,h){this.x=a;this.y=b;this.f=d;this.ymid=c;this.iterations=k;this.events=h;this.message=e};
numeric.Dopri.prototype._at=function(a,b){function d(a){return a*a}var c=this.x,k=this.y,e=this.f,h=this.ymid,r,n,u,v=numeric.add,w=numeric.mul,y=numeric.sub,E;r=c[b];n=c[b+1];c=k[b];k=k[b+1];u=r+.5*(n-r);h=h[b];E=y(e[b],w(c,1/(r-u)+2/(r-n)));e=y(e[b+1],w(k,1/(n-u)+2/(n-r)));r=[d(a-n)*(a-u)/d(r-n)/(r-u),d(a-r)*d(a-n)/d(r-u)/d(n-u),d(a-r)*(a-u)/d(n-r)/(n-u),(a-r)*d(a-n)*(a-u)/d(r-n)/(r-u),(a-n)*d(a-r)*(a-u)/d(r-n)/(n-u)];return v(v(v(v(w(c,r[0]),w(h,r[1])),w(k,r[2])),w(E,r[3])),w(e,r[4]))};
numeric.Dopri.prototype.at=function(a){var b,d,c,k=Math.floor;if("number"!==typeof a){b=a.length;d=Array(b);for(--b;-1!==b;--b)d[b]=this.at(a[b]);return d}var e=this.x;b=0;for(d=e.length-1;1<d-b;)c=k(.5*(b+d)),e[c]<=a?b=c:d=c;return this._at(a,b)};
numeric.dopri=function(a,b,d,c,k,e,h){"undefined"===typeof k&&(k=1E-6);"undefined"===typeof e&&(e=1E3);var r=[a],n=[d],u=[c(a,d)],v,w,y,E,C,H,F=[],l=[.075,.225],L=[44/45,-56/15,32/9],J=[19372/6561,-25360/2187,64448/6561,-212/729],P=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],O=[35/384,0,500/1113,125/192,-2187/6784,11/84],X=[.10013431883002395,0,.3918321794184259,-.02982460176594817,.05893268337240795,-.04497888809104361,.023904308236133973],ea=[.2,.3,.8,8/9,1,1],ia=[-71/57600,0,71/16695,-71/
1920,17253/339200,-22/525,.025],A=0,R,S=(b-a)/10,V=0,Y=numeric.add,T=numeric.mul,ma=Math.min,g=Math.abs,t=numeric.norminf,U=Math.pow,oa=numeric.any,na=numeric.lt,ja=numeric.and,aa,pa,ha=new numeric.Dopri(r,n,u,F,-1,"");for("function"===typeof h&&(aa=h(a,d));a<b&&V<e;)if(++V,a+S>b&&(S=b-a),v=c(a+ea[0]*S,Y(d,T(.2*S,u[A]))),w=c(a+ea[1]*S,Y(Y(d,T(l[0]*S,u[A])),T(l[1]*S,v))),y=c(a+ea[2]*S,Y(Y(Y(d,T(L[0]*S,u[A])),T(L[1]*S,v)),T(L[2]*S,w))),E=c(a+ea[3]*S,Y(Y(Y(Y(d,T(J[0]*S,u[A])),T(J[1]*S,v)),T(J[2]*S,w)),
T(J[3]*S,y))),C=c(a+ea[4]*S,Y(Y(Y(Y(Y(d,T(P[0]*S,u[A])),T(P[1]*S,v)),T(P[2]*S,w)),T(P[3]*S,y)),T(P[4]*S,E))),v=Y(Y(Y(Y(Y(d,T(u[A],S*O[0])),T(w,S*O[2])),T(y,S*O[3])),T(E,S*O[4])),T(C,S*O[5])),H=c(a+S,v),R=Y(Y(Y(Y(Y(T(u[A],S*ia[0]),T(w,S*ia[2])),T(y,S*ia[3])),T(E,S*ia[4])),T(C,S*ia[5])),T(H,S*ia[6])),R="number"===typeof R?g(R):t(R),R>k){if(S=.2*S*U(k/R,.25),a+S===a){ha.msg="Step size became too small";break}}else{F[A]=Y(Y(Y(Y(Y(Y(d,T(u[A],S*X[0])),T(w,S*X[2])),T(y,S*X[3])),T(E,S*X[4])),T(C,S*X[5])),
T(H,S*X[6]));++A;r[A]=a+S;n[A]=v;u[A]=H;if("function"===typeof h){var ka;w=a;y=a+.5*S;pa=h(y,F[A-1]);d=ja(na(aa,0),na(0,pa));oa(d)||(w=y,y=a+S,aa=pa,pa=h(y,v),d=ja(na(aa,0),na(0,pa)));if(oa(d)){k=0;for(r=e=1;;){if("number"===typeof aa)b=(r*pa*w-e*aa*y)/(r*pa-e*aa);else for(b=y,n=aa.length-1;-1!==n;--n)0>aa[n]&&0<pa[n]&&(b=ma(b,(r*pa[n]*w-e*aa[n]*y)/(r*pa[n]-e*aa[n])));if(b<=w||b>=y)break;ka=ha._at(b,A-1);u=h(b,ka);n=ja(na(aa,0),na(0,u));oa(n)?(y=b,pa=u,d=n,r=1,e=-1===k?.5*e:1,k=-1):(w=b,aa=u,e=1,
r=1===k?.5*r:1,k=1)}v=ha._at(.5*(a+b),A-1);ha.f[A]=c(b,ka);ha.x[A]=b;ha.y[A]=ka;ha.ymid[A-1]=v;ha.events=d;ha.iterations=V;return ha}}a+=S;d=v;aa=pa;S=ma(.8*S*U(k/R,.25),4*S)}ha.iterations=V;return ha};
numeric.LU=function(a,b){var d=Math.abs,c,k,e,h,r,n,u=a.length,v=u-1,w=Array(u);b||(a=numeric.clone(a));for(e=0;e<u;++e){r=e;h=a[e];n=d(h[e]);for(k=e+1;k<u;++k)c=d(a[k][e]),n<c&&(n=c,r=k);w[e]=r;r!=e&&(a[e]=a[r],a[r]=h,h=a[e]);k=h[e];for(c=e+1;c<u;++c)a[c][e]/=k;for(c=e+1;c<u;++c){r=a[c];for(k=e+1;k<v;++k)r[k]-=r[e]*h[k],++k,r[k]-=r[e]*h[k];k===v&&(r[k]-=r[e]*h[k])}}return{LU:a,P:w}};
numeric.LUsolve=function(a,b){var d,c,k=a.LU,e=k.length,h=numeric.clone(b),r=a.P,n;for(d=e-1;-1!==d;--d)h[d]=b[d];for(d=0;d<e;++d)for(c=r[d],r[d]!==d&&(n=h[d],h[d]=h[c],h[c]=n),n=k[d],c=0;c<d;++c)h[d]-=h[c]*n[c];for(d=e-1;0<=d;--d){n=k[d];for(c=d+1;c<e;++c)h[d]-=h[c]*n[c];h[d]/=n[d]}return h};numeric.solve=function(a,b,d){return numeric.LUsolve(numeric.LU(a,d),b)};
numeric.echelonize=function(a){var b=numeric.dim(a),d=b[0],b=b[1],c=numeric.identity(d),k=Array(d),e,h,r,n,u,v,w,y,E=Math.abs,C=numeric.diveq;a=numeric.clone(a);for(e=0;e<d;++e){r=0;u=a[e];v=c[e];for(h=1;h<b;++h)E(u[r])<E(u[h])&&(r=h);k[e]=r;C(v,u[r]);C(u,u[r]);for(h=0;h<d;++h)if(h!==e){w=a[h];y=w[r];for(n=b-1;-1!==n;--n)w[n]-=u[n]*y;w=c[h];for(n=d-1;-1!==n;--n)w[n]-=v[n]*y}}return{I:c,A:a,P:k}};
numeric.__solveLP=function(a,b,d,c,k,e,h){var r=numeric.sum,n=numeric.mul,u=numeric.sub,v=numeric.dot,w=numeric.div,y=numeric.add,E=a.length,C=d.length,H,F=!1,l=1;numeric.transpose(b);var L=numeric.transpose,J=Math.sqrt,P=Math.abs,O=Math.min,X=numeric.all,ea=numeric.gt,ia=Array(E),A=Array(C);numeric.rep([C],1);var R=numeric.solve,S=u(d,v(b,e)),V,Y=v(a,a);for(V=0;V<k;++V){var T;for(T=C-1;-1!==T;--T)A[T]=w(b[T],S[T]);H=L(A);for(T=E-1;-1!==T;--T)ia[T]=r(H[T]);l=.25*P(Y/v(a,ia));T=100*J(Y/v(ia,ia));if(!isFinite(l)||
l>T)l=T;F=y(a,n(l,ia));H=v(H,A);for(T=E-1;-1!==T;--T)H[T][T]+=1;H=R(H,w(F,l),!0);var S=w(S,v(b,H)),ma=1;for(T=C-1;-1!==T;--T)0>S[T]&&(ma=O(ma,-.999*S[T]));H=u(e,n(H,ma));S=u(d,v(b,H));if(!X(ea(S,0)))return{solution:e,message:"",iterations:V};e=H;if(l<c)return{solution:H,message:"",iterations:V};if(h)for(l=v(a,F),ma=v(b,F),F=!0,T=C-1;-1!==T;--T){if(0>l*ma[T]){F=!1;break}}else F=0<=e[E-1]?!1:!0;if(F)return{solution:H,message:"Unbounded",iterations:V}}return{solution:e,message:"maximum iteration count exceeded",
iterations:V}};
numeric._solveLP=function(a,b,d,c,k){var e=a.length,h=d.length,r=numeric.sub,n=numeric.dot,u=numeric.rep([e],0).concat([1]),h=numeric.rep([h,1],-1),v=numeric.blockMatrix([[b,h]]),h=numeric.rep([e],0).concat(Math.max(0,numeric.sup(numeric.neg(d)))+1),u=numeric.__solveLP(u,v,d,c,k,h,!1),h=numeric.clone(u.solution);h.length=e;if(0>numeric.inf(r(d,n(b,h))))return{solution:NaN,message:"Infeasible",iterations:u.iterations};a=numeric.__solveLP(a,b,d,c,k-u.iterations,h,!0);a.iterations+=u.iterations;return a};
numeric.solveLP=function(a,b,d,c,k,e,h){"undefined"===typeof h&&(h=1E3);"undefined"===typeof e&&(e=numeric.epsilon);if("undefined"===typeof c)return numeric._solveLP(a,b,d,e,h);var r=c.length,n=c[0].length,u=b.length,v=numeric.echelonize(c),w=numeric.rep([n],0),y=v.P,E=[],C;for(C=y.length-1;-1!==C;--C)w[y[C]]=1;for(C=n-1;-1!==C;--C)0===w[C]&&E.push(C);C=numeric.getRange;r=numeric.linspace(0,r-1);u=numeric.linspace(0,u-1);c=C(c,r,E);r=C(b,u,y);C=C(b,u,E);b=numeric.dot;u=numeric.sub;n=b(r,v.I);r=u(C,
b(n,c));d=u(d,b(n,k));n=Array(y.length);w=Array(E.length);for(C=y.length-1;-1!==C;--C)n[C]=a[y[C]];for(C=E.length-1;-1!==C;--C)w[C]=a[E[C]];C=u(w,b(n,b(v.I,c)));e=numeric._solveLP(C,r,d,e,h);h=e.solution;if(h!==h)return e;k=b(v.I,u(k,b(c,h)));a=Array(a.length);for(C=y.length-1;-1!==C;--C)a[y[C]]=k[C];for(C=E.length-1;-1!==C;--C)a[E[C]]=h[C];return{solution:a,message:e.message,iterations:e.iterations}};
numeric.MPStoLP=function(a){function b(l){throw Error("MPStoLP: "+l+"\nLine "+e+": "+a[e]+"\nCurrent state: "+c[d]+"\n");}a instanceof String&&a.split("\n");var d=0,c="Initial state;NAME;ROWS;COLUMNS;RHS;BOUNDS;ENDATA".split(";"),k=a.length,e,h,r,n=0,u={},v=[],w=0,y={},E=0,C,H=[],F=[],l=[];for(e=0;e<k;++e){r=a[e];var L=r.match(/\S*/g),J=[];for(h=0;h<L.length;++h)""!==L[h]&&J.push(L[h]);if(0!==J.length){for(h=0;h<c.length&&r.substr(0,c[h].length)!==c[h];++h);if(h<c.length){if(d=h,1===h&&(C=J[1]),6===
h)return{name:C,c:H,A:numeric.transpose(F),b:l,rows:u,vars:y}}else switch(d){case 0:case 1:b("Unexpected line");case 2:switch(J[0]){case "N":0===n?n=J[1]:b("Two or more N rows");break;case "L":u[J[1]]=w;v[w]=1;l[w]=0;++w;break;case "G":u[J[1]]=w;v[w]=-1;l[w]=0;++w;break;case "E":u[J[1]]=w;v[w]=0;l[w]=0;++w;break;default:b("Parse error "+numeric.prettyPrint(J))}break;case 3:y.hasOwnProperty(J[0])||(y[J[0]]=E,H[E]=0,F[E]=numeric.rep([w],0),++E);r=y[J[0]];for(h=1;h<J.length;h+=2)J[h]===n?H[r]=parseFloat(J[h+
1]):(L=u[J[h]],F[r][L]=(0>v[L]?-1:1)*parseFloat(J[h+1]));break;case 4:for(h=1;h<J.length;h+=2)l[u[J[h]]]=(0>v[u[J[h]]]?-1:1)*parseFloat(J[h+1]);break;case 6:b("Internal error")}}}b("Reached end of file without ENDATA")};numeric.seedrandom={pow:Math.pow,random:Math.random};
(function(a,b,d,c,k,e,h){function r(a){var b,c,e=this,h=a.length,k=0,n=e.i=e.j=e.m=0;e.S=[];e.c=[];for(h||(a=[h++]);k<d;)e.S[k]=k++;for(k=0;k<d;k++)b=e.S[k],n=n+b+a[k%h]&d-1,c=e.S[n],e.S[k]=c,e.S[n]=b;e.g=function(a){var b=e.S,c=e.i+1&d-1,h=b[c],k=e.j+h&d-1,n=b[k];b[c]=n;b[k]=h;for(var r=b[h+n&d-1];--a;)c=c+1&d-1,h=b[c],k=k+h&d-1,n=b[k],b[c]=n,b[k]=h,r=r*d+b[h+n&d-1];e.i=c;e.j=k;return r};e.g(d)}function n(a,b,d,c,e){d=[];e=typeof a;if(b&&"object"==e)for(c in a)if(5>c.indexOf("S"))try{d.push(n(a[c],
b-1))}catch(h){}return d.length?d:a+("string"!=e?"\x00":"")}function u(a,b,c,e){a+="";for(e=c=0;e<a.length;e++){var h=e&d-1,k=(c^=19*b[e&d-1])+a.charCodeAt(e);b[h]=k&d-1}a="";for(e in b)a+=String.fromCharCode(b[e]);return a}b.seedrandom=function(v,w){var y=[],E;v=u(n(w?[v,a]:arguments.length?v:[(new Date).getTime(),a,window],3),y);E=new r(y);u(E.S,a);b.random=function(){for(var a=E.g(c),b=h,n=0;a<k;)a=(a+n)*d,b*=d,n=E.g(1);for(;a>=e;)a/=2,b/=2,n>>>=1;return(a+n)/b};return v};h=b.pow(d,c);k=b.pow(2,
k);e=2*k;u(b.random(),a)})([],numeric.seedrandom,256,6,52);
(function(a){function b(a){if("object"!==typeof a)return a;var d=[],c,e=a.length;for(c=0;c<e;c++)d[c+1]=b(a[c]);return d}function d(a){if("object"!==typeof a)return a;var b=[],c,e=a.length;for(c=1;c<e;c++)b[c-1]=d(a[c]);return b}function c(a,b,d){var c,e,h;for(b=1;b<=d;b+=1){a[b][b]=1/a[b][b];h=-a[b][b];for(c=1;c<b;c+=1)a[c][b]*=h;c=b+1;if(d<c)break;for(e=c;e<=d;e+=1)for(h=a[b][e],a[b][e]=0,c=1;c<=b;c+=1)a[c][e]+=h*a[c][b]}}function k(a,b,d,c){var e,h,k;for(e=1;e<=d;e+=1){k=0;for(b=1;b<e;b+=1)k+=
a[b][e]*c[b];c[e]=(c[e]-k)/a[e][e]}for(h=1;h<=d;h+=1)for(e=d+1-h,c[e]/=a[e][e],k=-c[e],b=1;b<e;b+=1)c[b]+=k*a[b][e]}function e(a,b,c,d){var e,h,k,C,H;for(e=1;e<=c;e+=1){d[1]=e;H=0;h=e-1;if(!(1>h))for(k=1;k<=h;k+=1){C=a[k][e];for(b=1;b<k;b+=1)C-=a[b][e]*a[b][k];C/=a[k][k];a[k][e]=C;H+=C*C}H=a[e][e]-H;if(0>=H)break;a[e][e]=Math.sqrt(H);d[1]=0}}function h(a,b,d,h,w,y,E,C,H,F,l,L,J,P,O,X){function ea(){for(A=1;A<=h;A+=1){aa=0;for(R=1;R<=h;R+=1)aa+=a[R][A]*E[R][na];O[A]=aa}V=ma;for(A=1;A<=h;A+=1)O[V+A]=
0;for(R=J+1;R<=h;R+=1)for(A=1;A<=h;A+=1)O[V+A]+=a[A][R]*O[R];Pa=!0;for(A=J;1<=A;--A){aa=O[A];S=t+A*(A+3)/2;V=S-A;for(R=A+1;R<=J;R+=1)aa-=O[S]*O[g+R],S+=R;aa/=O[V];O[g+A]=aa;if(L[A]<l)break;if(0>aa)break;Pa=!1;T=A}if(!Pa)for(pa=O[oa+T]/O[g+T],A=1;A<=J&&!(L[A]<l)&&!(0>O[g+A]);A+=1)ja=O[oa+A]/O[g+A],ja<pa&&(pa=ja,T=A);aa=0;for(A=ma+1;A<=ma+h;A+=1)aa+=O[A]*O[A];if(Math.abs(aa)<=Ia){if(Pa)return X[1]=1,999;for(A=1;A<=J;A+=1)O[oa+A]-=pa*O[g+A];O[oa+J+1]+=pa;return 700}aa=0;for(A=1;A<=h;A+=1)aa+=O[ma+A]*
E[A][na];ha=-O[U+na]/aa;bb=!0;!Pa&&pa<ha&&(ha=pa,bb=!1);for(A=1;A<=h;A+=1)w[A]+=ha*O[ma+A],Math.abs(w[A])<Ia&&(w[A]=0);y[1]+=ha*aa*(ha/2+O[oa+J+1]);for(A=1;A<=J;A+=1)O[oa+A]-=ha*O[g+A];O[oa+J+1]+=ha;if(bb){J+=1;L[J]=na;S=t+(J-1)*J/2+1;for(A=1;A<=J-1;A+=1)O[S]=O[A],S+=1;if(J===h)O[S]=O[h];else{for(A=h;A>=J+1&&0!==O[A];--A){ka=Math.max(Math.abs(O[A-1]),Math.abs(O[A]));ta=Math.min(Math.abs(O[A-1]),Math.abs(O[A]));ja=0<=O[A-1]?Math.abs(ka*Math.sqrt(1+ta*ta/(ka*ka))):-Math.abs(ka*Math.sqrt(1+ta*ta/(ka*
ka)));ka=O[A-1]/ja;ta=O[A]/ja;if(1===ka)break;if(0===ka)for(O[A-1]=ta*ja,R=1;R<=h;R+=1)ja=a[R][A-1],a[R][A-1]=a[R][A],a[R][A]=ja;else for(O[A-1]=ja,Na=ta/(1+ka),R=1;R<=h;R+=1)ja=ka*a[R][A-1]+ta*a[R][A],a[R][A]=Na*(a[R][A-1]+ja)-a[R][A],a[R][A-1]=ja}O[S]=O[J]}}else{aa=-C[na];for(R=1;R<=h;R+=1)aa+=w[R]*E[R][na];if(na>l)O[U+na]=aa;else if(O[U+na]=-Math.abs(aa),0<aa){for(R=1;R<=h;R+=1)E[R][na]=-E[R][na];C[na]=-C[na]}return 700}return 0}function ia(){S=t+T*(T+1)/2+1;V=S+T;if(0===O[V])return 798;ka=Math.max(Math.abs(O[V-
1]),Math.abs(O[V]));ta=Math.min(Math.abs(O[V-1]),Math.abs(O[V]));ja=0<=O[V-1]?Math.abs(ka*Math.sqrt(1+ta*ta/(ka*ka))):-Math.abs(ka*Math.sqrt(1+ta*ta/(ka*ka)));ka=O[V-1]/ja;ta=O[V]/ja;if(1===ka)return 798;if(0===ka){for(A=T+1;A<=J;A+=1)ja=O[V-1],O[V-1]=O[V],O[V]=ja,V+=A;for(A=1;A<=h;A+=1)ja=a[A][T],a[A][T]=a[A][T+1],a[A][T+1]=ja}else{Na=ta/(1+ka);for(A=T+1;A<=J;A+=1)ja=ka*O[V-1]+ta*O[V],O[V]=Na*(O[V-1]+ja)-O[V],O[V-1]=ja,V+=A;for(A=1;A<=h;A+=1)ja=ka*a[A][T]+ta*a[A][T+1],a[A][T+1]=Na*(a[A][T]+ja)-a[A][T+
1],a[A][T]=ja}return 0}var A,R,S,V,Y,T,ma,g,t,U,oa,na,ja,aa,pa,ha,ka,ta,Na,Pa,bb,Ia,eb;H=Math.min(h,F);S=2*h+H*(H+5)/2+2*F+1;Ia=1E-60;do Ia+=Ia,Y=1+.1*Ia,eb=1+.2*Ia;while(1>=Y||1>=eb);for(A=1;A<=h;A+=1)O[A]=b[A];for(A=h+1;A<=S;A+=1)O[A]=0;for(A=1;A<=F;A+=1)L[A]=0;Y=[];if(0===X[1]){e(a,d,h,Y);if(0!==Y[1]){X[1]=2;return}k(a,d,h,b);c(a,d,h)}else{for(R=1;R<=h;R+=1)for(w[R]=0,A=1;A<=R;A+=1)w[R]+=a[A][R]*b[A];for(R=1;R<=h;R+=1)for(b[R]=0,A=R;A<=h;A+=1)b[R]+=a[R][A]*w[A]}y[1]=0;for(R=1;R<=h;R+=1)for(w[R]=
b[R],y[1]+=O[R]*w[R],O[R]=0,A=R+1;A<=h;A+=1)a[A][R]=0;y[1]=-y[1]/2;X[1]=0;ma=h;g=ma+h;oa=g+H;t=oa+H+1;U=t+H*(H+1)/2;b=U+F;for(A=1;A<=F;A+=1){aa=0;for(R=1;R<=h;R+=1)aa+=E[R][A]*E[R][A];O[b+A]=Math.sqrt(aa)}J=0;P[1]=0;for(d=P[2]=0;;){P[1]+=1;S=U;for(A=1;A<=F;A+=1){S+=1;aa=-C[A];for(R=1;R<=h;R+=1)aa+=E[R][A]*w[R];Math.abs(aa)<Ia&&(aa=0);if(A>l)O[S]=aa;else if(O[S]=-Math.abs(aa),0<aa){for(R=1;R<=h;R+=1)E[R][A]=-E[R][A];C[A]=-C[A]}}for(A=1;A<=J;A+=1)O[U+L[A]]=0;ja=na=0;for(A=1;A<=F;A+=1)O[U+A]<ja*O[b+
A]&&(na=A,ja=O[U+A]/O[b+A]);d=0===na?999:0;if(999===d)break;for(;;){d=ea();if(0===d)break;if(999===d)return;if(700===d){if(T!==J)for(;;){ia();V=S-T;for(A=1;A<=T;A+=1)O[V]=O[S],S+=1,V+=1;O[oa+T]=O[oa+T+1];L[T]=L[T+1];T+=1;d=T<J?797:0;if(797!==d)break}O[oa+J]=O[oa+J+1];O[oa+J+1]=0;L[J]=0;--J;P[2]+=1}}}}a.solveQP=function(a,c,e,k,w,y){a=b(a);c=b(c);e=b(e);var E,C,H,F,l=[],L=[],J=[],P=[],O=[];w=w||0;y=y?b(y):[void 0,0];k=k?b(k):[];C=a.length-1;H=e[1].length-1;if(!k)for(E=1;E<=H;E+=1)k[E]=0;for(E=1;E<=
H;E+=1)L[E]=0;F=Math.min(C,H);for(E=1;E<=C;E+=1)J[E]=0;l[1]=0;for(E=1;E<=2*C+F*(F+5)/2+2*H+1;E+=1)P[E]=0;for(E=1;2>=E;E+=1)O[E]=0;h(a,c,C,C,J,l,e,k,C,H,w,L,0,O,P,y);a="";1===y[1]&&(a="constraints are inconsistent, no solution!");2===y[1]&&(a="matrix D in quadratic function is not positive definite!");return{solution:d(J),value:d(l),unconstrained_solution:d(c),iterations:d(O),iact:d(L),message:a}}})(numeric);
numeric.svd=function(a){function b(a,b){a=Math.abs(a);b=Math.abs(b);return a>b?a*Math.sqrt(1+b*b/a/a):0==b?a:b*Math.sqrt(1+a*a/b/b)}var d;d=numeric.epsilon;var c=1E-64/d,k=0,e=0,h=0,r=0,n=0;a=numeric.clone(a);var u=a.length,v=a[0].length;if(u<v)throw"Need more rows than columns";for(var w=Array(v),y=Array(v),e=0;e<v;e++)w[e]=y[e]=0;for(var E=numeric.rep([v,v],0),C=0,H=0,F=0,l=0,L=0,J=0,P=0,e=0;e<v;e++){w[e]=H;P=0;n=e+1;for(h=e;h<u;h++)P+=a[h][e]*a[h][e];if(P<=c)H=0;else for(C=a[e][e],H=Math.sqrt(P),
0<=C&&(H=-H),F=C*H-P,a[e][e]=C-H,h=n;h<v;h++){P=0;for(r=e;r<u;r++)P+=a[r][e]*a[r][h];C=P/F;for(r=e;r<u;r++)a[r][h]+=C*a[r][e]}y[e]=H;P=0;for(h=n;h<v;h++)P+=a[e][h]*a[e][h];if(P<=c)H=0;else{C=a[e][e+1];H=Math.sqrt(P);0<=C&&(H=-H);F=C*H-P;a[e][e+1]=C-H;for(h=n;h<v;h++)w[h]=a[e][h]/F;for(h=n;h<u;h++){P=0;for(r=n;r<v;r++)P+=a[h][r]*a[e][r];for(r=n;r<v;r++)a[h][r]+=P*w[r]}}L=Math.abs(y[e])+Math.abs(w[e]);L>l&&(l=L)}for(e=v-1;-1!=e;e+=-1){if(0!=H){F=H*a[e][e+1];for(h=n;h<v;h++)E[h][e]=a[e][h]/F;for(h=n;h<
v;h++){P=0;for(r=n;r<v;r++)P+=a[e][r]*E[r][h];for(r=n;r<v;r++)E[r][h]+=P*E[r][e]}}for(h=n;h<v;h++)E[e][h]=0,E[h][e]=0;E[e][e]=1;H=w[e];n=e}for(e=v-1;-1!=e;e+=-1){n=e+1;H=y[e];for(h=n;h<v;h++)a[e][h]=0;if(0!=H){F=a[e][e]*H;for(h=n;h<v;h++){P=0;for(r=n;r<u;r++)P+=a[r][e]*a[r][h];C=P/F;for(r=e;r<u;r++)a[r][h]+=C*a[r][e]}for(h=e;h<u;h++)a[h][e]/=H}else for(h=e;h<u;h++)a[h][e]=0;a[e][e]+=1}d*=l;for(r=v-1;-1!=r;r+=-1)for(c=0;50>c;c++){e=!1;for(n=r;-1!=n;n+=-1){if(Math.abs(w[n])<=d){e=!0;break}if(Math.abs(y[n-
1])<=d)break}if(!e)for(k=0,P=1,l=n-1,e=n;e<r+1;e++){C=P*w[e];w[e]*=k;if(Math.abs(C)<=d)break;H=y[e];F=b(C,H);y[e]=F;k=H/F;P=-C/F;for(h=0;h<u;h++)L=a[h][l],J=a[h][e],a[h][l]=L*k+J*P,a[h][e]=-L*P+J*k}J=y[r];if(n==r){if(0>J)for(y[r]=-J,h=0;h<v;h++)E[h][r]=-E[h][r];break}if(49<=c)throw"Error: no convergence.";l=y[n];L=y[r-1];H=w[r-1];F=w[r];C=((L-J)*(L+J)+(H-F)*(H+F))/(2*F*L);H=b(C,1);C=0>C?((l-J)*(l+J)+F*(L/(C-H)-F))/l:((l-J)*(l+J)+F*(L/(C+H)-F))/l;P=k=1;for(e=n+1;e<r+1;e++){H=w[e];L=y[e];F=P*H;H*=k;
J=b(C,F);w[e-1]=J;k=C/J;P=F/J;C=l*k+H*P;H=-l*P+H*k;F=L*P;L*=k;for(h=0;h<v;h++)l=E[h][e-1],J=E[h][e],E[h][e-1]=l*k+J*P,E[h][e]=-l*P+J*k;J=b(C,F);y[e-1]=J;k=C/J;P=F/J;C=k*H+P*L;l=-P*H+k*L;for(h=0;h<u;h++)L=a[h][e-1],J=a[h][e],a[h][e-1]=L*k+J*P,a[h][e]=-L*P+J*k}w[n]=0;w[r]=C;y[r]=l}for(e=0;e<y.length;e++)y[e]<d&&(y[e]=0);for(e=0;e<v;e++)for(h=e-1;0<=h;h--)if(y[h]<y[e]){k=y[h];y[h]=y[e];y[e]=k;for(r=0;r<a.length;r++)d=a[r][e],a[r][e]=a[r][h],a[r][h]=d;for(r=0;r<E.length;r++)d=E[r][e],E[r][e]=E[r][h],
E[r][h]=d;e=h}return{U:a,S:y,V:E}};
(function(){function a(g,t,a){l.biginteger_used=1;null!=g&&("number"==typeof g&&"undefined"==typeof t?this.fromInt(g):"number"==typeof g?this.fromNumber(g,t,a):null==t&&"string"!=typeof g?this.fromString(g,256):this.fromString(g,t))}function b(){return new a(null)}function d(g,t,a,b,d,c){for(;0<=--c;){var l=t*this[g++]+a[b]+d;d=Math.floor(l/67108864);a[b++]=l&67108863}return d}function c(g,t,a,b,d,c){var l=t&32767;for(t>>=15;0<=--c;){var e=this[g]&32767,h=this[g++]>>15,k=t*e+h*l,e=l*e+((k&32767)<<
15)+a[b]+(d&1073741823);d=(e>>>30)+(k>>>15)+t*h+(d>>>30);a[b++]=e&1073741823}return d}function k(g,t,a,b,d,c){var l=t&16383;for(t>>=14;0<=--c;){var e=this[g]&16383,h=this[g++]>>14,k=t*e+h*l,e=l*e+((k&16383)<<14)+a[b]+d;d=(e>>28)+(k>>14)+t*h;a[b++]=e&268435455}return d}function e(g,t){var a=S[g.charCodeAt(t)];return null==a?-1:a}function h(g){var t=b();t.fromInt(g);return t}function r(g){var t=1,a;0!=(a=g>>>16)&&(g=a,t+=16);0!=(a=g>>8)&&(g=a,t+=8);0!=(a=g>>4)&&(g=a,t+=4);0!=(a=g>>2)&&(g=a,t+=2);0!=
g>>1&&(t+=1);return t}function n(g){this.m=g}function u(g){this.m=g;this.mp=g.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<g.DB-15)-1;this.mt2=2*g.t}function v(g,t){return g&t}function w(g,t){return g|t}function y(g,t){return g^t}function E(g,t){return g&~t}function C(){}function H(g){return g}function F(g){this.r2=b();this.q3=b();a.ONE.dlShiftTo(2*g.t,this.r2);this.mu=this.r2.divide(g);this.m=g}var l={},L=!1;"undefined"!==typeof module&&module.exports?(module.exports=l,L=!0):
"undefined"!==typeof document?window.ClipperLib=l:self.ClipperLib=l;var J;if(L)P="chrome",J="Netscape";else{var P=navigator.userAgent.toString().toLowerCase();J=navigator.appName}var O,X,ea,ia,A,R;O=-1!=P.indexOf("chrome")&&-1==P.indexOf("chromium")?1:0;L=-1!=P.indexOf("chromium")?1:0;X=-1!=P.indexOf("safari")&&-1==P.indexOf("chrome")&&-1==P.indexOf("chromium")?1:0;ea=-1!=P.indexOf("firefox")?1:0;P.indexOf("firefox/17");P.indexOf("firefox/15");P.indexOf("firefox/3");ia=-1!=P.indexOf("opera")?1:0;
P.indexOf("msie 10");P.indexOf("msie 9");A=-1!=P.indexOf("msie 8")?1:0;R=-1!=P.indexOf("msie 7")?1:0;P=-1!=P.indexOf("msie ")?1:0;l.biginteger_used=null;"Microsoft Internet Explorer"==J?(a.prototype.am=c,J=30):"Netscape"!=J?(a.prototype.am=d,J=26):(a.prototype.am=k,J=28);a.prototype.DB=J;a.prototype.DM=(1<<J)-1;a.prototype.DV=1<<J;a.prototype.FV=Math.pow(2,52);a.prototype.F1=52-J;a.prototype.F2=2*J-52;var S=[],V;J=48;for(V=0;9>=V;++V)S[J++]=V;J=97;for(V=10;36>V;++V)S[J++]=V;J=65;for(V=10;36>V;++V)S[J++]=
V;n.prototype.convert=function(g){return 0>g.s||0<=g.compareTo(this.m)?g.mod(this.m):g};n.prototype.revert=function(g){return g};n.prototype.reduce=function(g){g.divRemTo(this.m,null,g)};n.prototype.mulTo=function(g,t,a){g.multiplyTo(t,a);this.reduce(a)};n.prototype.sqrTo=function(g,t){g.squareTo(t);this.reduce(t)};u.prototype.convert=function(g){var t=b();g.abs().dlShiftTo(this.m.t,t);t.divRemTo(this.m,null,t);0>g.s&&0<t.compareTo(a.ZERO)&&this.m.subTo(t,t);return t};u.prototype.revert=function(g){var t=
b();g.copyTo(t);this.reduce(t);return t};u.prototype.reduce=function(g){for(;g.t<=this.mt2;)g[g.t++]=0;for(var t=0;t<this.m.t;++t){var a=g[t]&32767,b=a*this.mpl+((a*this.mph+(g[t]>>15)*this.mpl&this.um)<<15)&g.DM,a=t+this.m.t;for(g[a]+=this.m.am(0,b,g,t,0,this.m.t);g[a]>=g.DV;)g[a]-=g.DV,g[++a]++}g.clamp();g.drShiftTo(this.m.t,g);0<=g.compareTo(this.m)&&g.subTo(this.m,g)};u.prototype.mulTo=function(g,t,a){g.multiplyTo(t,a);this.reduce(a)};u.prototype.sqrTo=function(g,t){g.squareTo(t);this.reduce(t)};
a.prototype.copyTo=function(g){for(var t=this.t-1;0<=t;--t)g[t]=this[t];g.t=this.t;g.s=this.s};a.prototype.fromInt=function(g){this.t=1;this.s=0>g?-1:0;0<g?this[0]=g:-1>g?this[0]=g+this.DV:this.t=0};a.prototype.fromString=function(g,t){var U;if(16==t)U=4;else if(8==t)U=3;else if(256==t)U=8;else if(2==t)U=1;else if(32==t)U=5;else if(4==t)U=2;else{this.fromRadix(g,t);return}this.s=this.t=0;for(var b=g.length,d=!1,c=0;0<=--b;){var l=8==U?g[b]&255:e(g,b);0>l?"-"==g.charAt(b)&&(d=!0):(d=!1,0==c?this[this.t++]=
l:c+U>this.DB?(this[this.t-1]|=(l&(1<<this.DB-c)-1)<<c,this[this.t++]=l>>this.DB-c):this[this.t-1]|=l<<c,c+=U,c>=this.DB&&(c-=this.DB))}8==U&&0!=(g[0]&128)&&(this.s=-1,0<c&&(this[this.t-1]|=(1<<this.DB-c)-1<<c));this.clamp();d&&a.ZERO.subTo(this,this)};a.prototype.clamp=function(){for(var g=this.s&this.DM;0<this.t&&this[this.t-1]==g;)--this.t};a.prototype.dlShiftTo=function(g,t){var a;for(a=this.t-1;0<=a;--a)t[a+g]=this[a];for(a=g-1;0<=a;--a)t[a]=0;t.t=this.t+g;t.s=this.s};a.prototype.drShiftTo=function(g,
t){for(var a=g;a<this.t;++a)t[a-g]=this[a];t.t=Math.max(this.t-g,0);t.s=this.s};a.prototype.lShiftTo=function(g,t){var a=g%this.DB,b=this.DB-a,d=(1<<b)-1,c=Math.floor(g/this.DB),l=this.s<<a&this.DM,e;for(e=this.t-1;0<=e;--e)t[e+c+1]=this[e]>>b|l,l=(this[e]&d)<<a;for(e=c-1;0<=e;--e)t[e]=0;t[c]=l;t.t=this.t+c+1;t.s=this.s;t.clamp()};a.prototype.rShiftTo=function(g,t){t.s=this.s;var a=Math.floor(g/this.DB);if(a>=this.t)t.t=0;else{var b=g%this.DB,c=this.DB-b,d=(1<<b)-1;t[0]=this[a]>>b;for(var l=a+1;l<
this.t;++l)t[l-a-1]|=(this[l]&d)<<c,t[l-a]=this[l]>>b;0<b&&(t[this.t-a-1]|=(this.s&d)<<c);t.t=this.t-a;t.clamp()}};a.prototype.subTo=function(g,t){for(var a=0,b=0,c=Math.min(g.t,this.t);a<c;)b+=this[a]-g[a],t[a++]=b&this.DM,b>>=this.DB;if(g.t<this.t){for(b-=g.s;a<this.t;)b+=this[a],t[a++]=b&this.DM,b>>=this.DB;b+=this.s}else{for(b+=this.s;a<g.t;)b-=g[a],t[a++]=b&this.DM,b>>=this.DB;b-=g.s}t.s=0>b?-1:0;-1>b?t[a++]=this.DV+b:0<b&&(t[a++]=b);t.t=a;t.clamp()};a.prototype.multiplyTo=function(g,t){var U=
this.abs(),b=g.abs(),c=U.t;for(t.t=c+b.t;0<=--c;)t[c]=0;for(c=0;c<b.t;++c)t[c+U.t]=U.am(0,b[c],t,c,0,U.t);t.s=0;t.clamp();this.s!=g.s&&a.ZERO.subTo(t,t)};a.prototype.squareTo=function(g){for(var t=this.abs(),a=g.t=2*t.t;0<=--a;)g[a]=0;for(a=0;a<t.t-1;++a){var b=t.am(a,t[a],g,2*a,0,1);(g[a+t.t]+=t.am(a+1,2*t[a],g,2*a+1,b,t.t-a-1))>=t.DV&&(g[a+t.t]-=t.DV,g[a+t.t+1]=1)}0<g.t&&(g[g.t-1]+=t.am(a,t[a],g,2*a,0,1));g.s=0;g.clamp()};a.prototype.divRemTo=function(g,t,U){var c=g.abs();if(!(0>=c.t)){var d=this.abs();
if(d.t<c.t)null!=t&&t.fromInt(0),null!=U&&this.copyTo(U);else{null==U&&(U=b());var l=b(),e=this.s;g=g.s;var h=this.DB-r(c[c.t-1]);0<h?(c.lShiftTo(h,l),d.lShiftTo(h,U)):(c.copyTo(l),d.copyTo(U));c=l.t;d=l[c-1];if(0!=d){var k=d*(1<<this.F1)+(1<c?l[c-2]>>this.F2:0),n=this.FV/k,k=(1<<this.F1)/k,u=1<<this.F2,v=U.t,w=v-c,y=null==t?b():t;l.dlShiftTo(w,y);0<=U.compareTo(y)&&(U[U.t++]=1,U.subTo(y,U));a.ONE.dlShiftTo(c,y);for(y.subTo(l,l);l.t<c;)l[l.t++]=0;for(;0<=--w;){var A=U[--v]==d?this.DM:Math.floor(U[v]*
n+(U[v-1]+u)*k);if((U[v]+=l.am(0,A,U,w,0,c))<A)for(l.dlShiftTo(w,y),U.subTo(y,U);U[v]<--A;)U.subTo(y,U)}null!=t&&(U.drShiftTo(c,t),e!=g&&a.ZERO.subTo(t,t));U.t=c;U.clamp();0<h&&U.rShiftTo(h,U);0>e&&a.ZERO.subTo(U,U)}}}};a.prototype.invDigit=function(){if(1>this.t)return 0;var g=this[0];if(0==(g&1))return 0;var t=g&3,t=t*(2-(g&15)*t)&15,t=t*(2-(g&255)*t)&255,t=t*(2-((g&65535)*t&65535))&65535,t=t*(2-g*t%this.DV)%this.DV;return 0<t?this.DV-t:-t};a.prototype.isEven=function(){return 0==(0<this.t?this[0]&
1:this.s)};a.prototype.exp=function(g,t){if(4294967295<g||1>g)return a.ONE;var U=b(),c=b(),d=t.convert(this),l=r(g)-1;for(d.copyTo(U);0<=--l;)if(t.sqrTo(U,c),0<(g&1<<l))t.mulTo(c,d,U);else var e=U,U=c,c=e;return t.revert(U)};a.prototype.toString=function(g){if(0>this.s)return"-"+this.negate().toString(g);if(16==g)g=4;else if(8==g)g=3;else if(2==g)g=1;else if(32==g)g=5;else if(4==g)g=2;else return this.toRadix(g);var t=(1<<g)-1,a,b=!1,c="",d=this.t,l=this.DB-d*this.DB%g;if(0<d--)for(l<this.DB&&0<(a=
this[d]>>l)&&(b=!0,c="0123456789abcdefghijklmnopqrstuvwxyz".charAt(a));0<=d;)l<g?(a=(this[d]&(1<<l)-1)<<g-l,a|=this[--d]>>(l+=this.DB-g)):(a=this[d]>>(l-=g)&t,0>=l&&(l+=this.DB,--d)),0<a&&(b=!0),b&&(c+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(a));return b?c:"0"};a.prototype.negate=function(){var g=b();a.ZERO.subTo(this,g);return g};a.prototype.abs=function(){return 0>this.s?this.negate():this};a.prototype.compareTo=function(g){var t=this.s-g.s;if(0!=t)return t;var a=this.t,t=a-g.t;if(0!=t)return 0>
this.s?-t:t;for(;0<=--a;)if(0!=(t=this[a]-g[a]))return t;return 0};a.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+r(this[this.t-1]^this.s&this.DM)};a.prototype.mod=function(g){var t=b();this.abs().divRemTo(g,null,t);0>this.s&&0<t.compareTo(a.ZERO)&&g.subTo(t,t);return t};a.prototype.modPowInt=function(g,t){var a;a=256>g||t.isEven()?new n(t):new u(t);return this.exp(g,a)};a.ZERO=h(0);a.ONE=h(1);C.prototype.convert=H;C.prototype.revert=H;C.prototype.mulTo=function(g,t,a){g.multiplyTo(t,
a)};C.prototype.sqrTo=function(g,t){g.squareTo(t)};F.prototype.convert=function(g){if(0>g.s||g.t>2*this.m.t)return g.mod(this.m);if(0>g.compareTo(this.m))return g;var t=b();g.copyTo(t);this.reduce(t);return t};F.prototype.revert=function(g){return g};F.prototype.reduce=function(g){g.drShiftTo(this.m.t-1,this.r2);g.t>this.m.t+1&&(g.t=this.m.t+1,g.clamp());this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);for(this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);0>g.compareTo(this.r2);)g.dAddOffset(1,
this.m.t+1);for(g.subTo(this.r2,g);0<=g.compareTo(this.m);)g.subTo(this.m,g)};F.prototype.mulTo=function(g,t,a){g.multiplyTo(t,a);this.reduce(a)};F.prototype.sqrTo=function(g,t){g.squareTo(t);this.reduce(t)};var Y=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,
409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],T=67108864/Y[Y.length-1];a.prototype.chunkSize=function(g){return Math.floor(Math.LN2*this.DB/Math.log(g))};a.prototype.toRadix=function(g){null==
g&&(g=10);if(0==this.signum()||2>g||36<g)return"0";var t=this.chunkSize(g),t=Math.pow(g,t),a=h(t),c=b(),d=b(),l="";for(this.divRemTo(a,c,d);0<c.signum();)l=(t+d.intValue()).toString(g).substr(1)+l,c.divRemTo(a,c,d);return d.intValue().toString(g)+l};a.prototype.fromRadix=function(g,t){this.fromInt(0);null==t&&(t=10);for(var U=this.chunkSize(t),b=Math.pow(t,U),c=!1,d=0,l=0,h=0;h<g.length;++h){var k=e(g,h);0>k?"-"==g.charAt(h)&&0==this.signum()&&(c=!0):(l=t*l+k,++d>=U&&(this.dMultiply(b),this.dAddOffset(l,
0),l=d=0))}0<d&&(this.dMultiply(Math.pow(t,d)),this.dAddOffset(l,0));c&&a.ZERO.subTo(this,this)};a.prototype.fromNumber=function(g,t,U){if("number"==typeof t)if(2>g)this.fromInt(1);else for(this.fromNumber(g,U),this.testBit(g-1)||this.bitwiseTo(a.ONE.shiftLeft(g-1),w,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>g&&this.subTo(a.ONE.shiftLeft(g-1),this);else{U=[];var b=g&7;U.length=(g>>3)+1;t.nextBytes(U);U[0]=0<b?U[0]&(1<<b)-1:0;this.fromString(U,
256)}};a.prototype.bitwiseTo=function(g,t,a){var b,c,d=Math.min(g.t,this.t);for(b=0;b<d;++b)a[b]=t(this[b],g[b]);if(g.t<this.t){c=g.s&this.DM;for(b=d;b<this.t;++b)a[b]=t(this[b],c);a.t=this.t}else{c=this.s&this.DM;for(b=d;b<g.t;++b)a[b]=t(c,g[b]);a.t=g.t}a.s=t(this.s,g.s);a.clamp()};a.prototype.changeBit=function(g,t){var U=a.ONE.shiftLeft(g);this.bitwiseTo(U,t,U);return U};a.prototype.addTo=function(g,t){for(var a=0,b=0,c=Math.min(g.t,this.t);a<c;)b+=this[a]+g[a],t[a++]=b&this.DM,b>>=this.DB;if(g.t<
this.t){for(b+=g.s;a<this.t;)b+=this[a],t[a++]=b&this.DM,b>>=this.DB;b+=this.s}else{for(b+=this.s;a<g.t;)b+=g[a],t[a++]=b&this.DM,b>>=this.DB;b+=g.s}t.s=0>b?-1:0;0<b?t[a++]=b:-1>b&&(t[a++]=this.DV+b);t.t=a;t.clamp()};a.prototype.dMultiply=function(g){this[this.t]=this.am(0,g-1,this,0,0,this.t);++this.t;this.clamp()};a.prototype.dAddOffset=function(g,t){if(0!=g){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=g;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}};a.prototype.multiplyLowerTo=
function(g,t,a){var b=Math.min(this.t+g.t,t);a.s=0;for(a.t=b;0<b;)a[--b]=0;var c;for(c=a.t-this.t;b<c;++b)a[b+this.t]=this.am(0,g[b],a,b,0,this.t);for(c=Math.min(g.t,t);b<c;++b)this.am(0,g[b],a,b,0,t-b);a.clamp()};a.prototype.multiplyUpperTo=function(g,t,a){--t;var b=a.t=this.t+g.t-t;for(a.s=0;0<=--b;)a[b]=0;for(b=Math.max(t-this.t,0);b<g.t;++b)a[this.t+b-t]=this.am(t-b,g[b],a,0,0,this.t+b-t);a.clamp();a.drShiftTo(1,a)};a.prototype.modInt=function(g){if(0>=g)return 0;var t=this.DV%g,a=0>this.s?g-
1:0;if(0<this.t)if(0==t)a=this[0]%g;else for(var b=this.t-1;0<=b;--b)a=(t*a+this[b])%g;return a};a.prototype.millerRabin=function(g){var t=this.subtract(a.ONE),U=t.getLowestSetBit();if(0>=U)return!1;var c=t.shiftRight(U);g=g+1>>1;g>Y.length&&(g=Y.length);for(var d=b(),l=0;l<g;++l){d.fromInt(Y[Math.floor(Math.random()*Y.length)]);var e=d.modPow(c,this);if(0!=e.compareTo(a.ONE)&&0!=e.compareTo(t)){for(var h=1;h++<U&&0!=e.compareTo(t);)if(e=e.modPowInt(2,this),0==e.compareTo(a.ONE))return!1;if(0!=e.compareTo(t))return!1}}return!0};
a.prototype.clone=function(){var g=b();this.copyTo(g);return g};a.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]};a.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24};a.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16};a.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this[0]?
0:1};a.prototype.toByteArray=function(){var g=this.t,t=[];t[0]=this.s;var a=this.DB-g*this.DB%8,b,c=0;if(0<g--)for(a<this.DB&&(b=this[g]>>a)!=(this.s&this.DM)>>a&&(t[c++]=b|this.s<<this.DB-a);0<=g;)if(8>a?(b=(this[g]&(1<<a)-1)<<8-a,b|=this[--g]>>(a+=this.DB-8)):(b=this[g]>>(a-=8)&255,0>=a&&(a+=this.DB,--g)),0!=(b&128)&&(b|=-256),0==c&&(this.s&128)!=(b&128)&&++c,0<c||b!=this.s)t[c++]=b;return t};a.prototype.equals=function(g){return 0==this.compareTo(g)};a.prototype.min=function(g){return 0>this.compareTo(g)?
this:g};a.prototype.max=function(g){return 0<this.compareTo(g)?this:g};a.prototype.and=function(g){var t=b();this.bitwiseTo(g,v,t);return t};a.prototype.or=function(g){var t=b();this.bitwiseTo(g,w,t);return t};a.prototype.xor=function(g){var t=b();this.bitwiseTo(g,y,t);return t};a.prototype.andNot=function(g){var t=b();this.bitwiseTo(g,E,t);return t};a.prototype.not=function(){for(var g=b(),t=0;t<this.t;++t)g[t]=this.DM&~this[t];g.t=this.t;g.s=~this.s;return g};a.prototype.shiftLeft=function(g){var t=
b();0>g?this.rShiftTo(-g,t):this.lShiftTo(g,t);return t};a.prototype.shiftRight=function(g){var t=b();0>g?this.lShiftTo(-g,t):this.rShiftTo(g,t);return t};a.prototype.getLowestSetBit=function(){for(var g=0;g<this.t;++g)if(0!=this[g]){var t=g*this.DB,g=this[g];if(0==g)g=-1;else{var a=0;0==(g&65535)&&(g>>=16,a+=16);0==(g&255)&&(g>>=8,a+=8);0==(g&15)&&(g>>=4,a+=4);0==(g&3)&&(g>>=2,a+=2);0==(g&1)&&++a;g=a}return t+g}return 0>this.s?this.t*this.DB:-1};a.prototype.bitCount=function(){for(var g=0,t=this.s&
this.DM,a=0;a<this.t;++a){for(var b=this[a]^t,c=0;0!=b;)b&=b-1,++c;g+=c}return g};a.prototype.testBit=function(g){var t=Math.floor(g/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<g%this.DB)};a.prototype.setBit=function(g){return this.changeBit(g,w)};a.prototype.clearBit=function(g){return this.changeBit(g,E)};a.prototype.flipBit=function(g){return this.changeBit(g,y)};a.prototype.add=function(g){var t=b();this.addTo(g,t);return t};a.prototype.subtract=function(g){var t=b();this.subTo(g,t);return t};
a.prototype.multiply=function(g){var t=b();this.multiplyTo(g,t);return t};a.prototype.divide=function(g){var t=b();this.divRemTo(g,t,null);return t};a.prototype.remainder=function(g){var t=b();this.divRemTo(g,null,t);return t};a.prototype.divideAndRemainder=function(g){var t=b(),a=b();this.divRemTo(g,t,a);return[t,a]};a.prototype.modPow=function(g,t){var a=g.bitLength(),c,d=h(1),l;if(0>=a)return d;c=18>a?1:48>a?3:144>a?4:768>a?5:6;l=8>a?new n(t):t.isEven()?new F(t):new u(t);var e=[],k=3,v=c-1,w=(1<<
c)-1;e[1]=l.convert(this);if(1<c)for(a=b(),l.sqrTo(e[1],a);k<=w;)e[k]=b(),l.mulTo(a,e[k-2],e[k]),k+=2;for(var y=g.t-1,A,E=!0,C=b(),a=r(g[y])-1;0<=y;){a>=v?A=g[y]>>a-v&w:(A=(g[y]&(1<<a+1)-1)<<v-a,0<y&&(A|=g[y-1]>>this.DB+a-v));for(k=c;0==(A&1);)A>>=1,--k;0>(a-=k)&&(a+=this.DB,--y);if(E)e[A].copyTo(d),E=!1;else{for(;1<k;)l.sqrTo(d,C),l.sqrTo(C,d),k-=2;0<k?l.sqrTo(d,C):(k=d,d=C,C=k);l.mulTo(C,e[A],d)}for(;0<=y&&0==(g[y]&1<<a);)l.sqrTo(d,C),k=d,d=C,C=k,0>--a&&(a=this.DB-1,--y)}return l.revert(d)};a.prototype.modInverse=
function(g){var t=g.isEven();if(this.isEven()&&t||0==g.signum())return a.ZERO;for(var b=g.clone(),c=this.clone(),d=h(1),l=h(0),e=h(0),k=h(1);0!=b.signum();){for(;b.isEven();)b.rShiftTo(1,b),t?(d.isEven()&&l.isEven()||(d.addTo(this,d),l.subTo(g,l)),d.rShiftTo(1,d)):l.isEven()||l.subTo(g,l),l.rShiftTo(1,l);for(;c.isEven();)c.rShiftTo(1,c),t?(e.isEven()&&k.isEven()||(e.addTo(this,e),k.subTo(g,k)),e.rShiftTo(1,e)):k.isEven()||k.subTo(g,k),k.rShiftTo(1,k);0<=b.compareTo(c)?(b.subTo(c,b),t&&d.subTo(e,d),
l.subTo(k,l)):(c.subTo(b,c),t&&e.subTo(d,e),k.subTo(l,k))}if(0!=c.compareTo(a.ONE))return a.ZERO;if(0<=k.compareTo(g))return k.subtract(g);if(0>k.signum())k.addTo(g,k);else return k;return 0>k.signum()?k.add(g):k};a.prototype.pow=function(g){return this.exp(g,new C)};a.prototype.gcd=function(g){var t=0>this.s?this.negate():this.clone();g=0>g.s?g.negate():g.clone();if(0>t.compareTo(g)){var a=t,t=g;g=a}var a=t.getLowestSetBit(),b=g.getLowestSetBit();if(0>b)return t;a<b&&(b=a);for(0<b&&(t.rShiftTo(b,
t),g.rShiftTo(b,g));0<t.signum();)0<(a=t.getLowestSetBit())&&t.rShiftTo(a,t),0<(a=g.getLowestSetBit())&&g.rShiftTo(a,g),0<=t.compareTo(g)?(t.subTo(g,t),t.rShiftTo(1,t)):(g.subTo(t,g),g.rShiftTo(1,g));0<b&&g.lShiftTo(b,g);return g};a.prototype.isProbablePrime=function(g){var a,b=this.abs();if(1==b.t&&b[0]<=Y[Y.length-1]){for(a=0;a<Y.length;++a)if(b[0]==Y[a])return!0;return!1}if(b.isEven())return!1;for(a=1;a<Y.length;){for(var c=Y[a],d=a+1;d<Y.length&&c<T;)c*=Y[d++];for(c=b.modInt(c);a<d;)if(0==c%Y[a++])return!1}return b.millerRabin(g)};
a.prototype.square=function(){var g=b();this.squareTo(g);return g};a.prototype.IsNegative=function(){return-1==this.compareTo(a.ZERO)?!0:!1};a.op_Equality=function(g,a){return 0==g.compareTo(a)?!0:!1};a.op_Inequality=function(g,a){return 0!=g.compareTo(a)?!0:!1};a.op_GreaterThan=function(g,a){return 0<g.compareTo(a)?!0:!1};a.op_LessThan=function(g,a){return 0>g.compareTo(a)?!0:!1};a.op_Addition=function(g,t){return(new a(g)).add(new a(t))};a.op_Subtraction=function(g,t){return(new a(g)).subtract(new a(t))};
a.Int128Mul=function(g,t){return(new a(g)).multiply(new a(t))};a.op_Division=function(g,a){return g.divide(a)};a.prototype.ToDouble=function(){return parseFloat(this.toString())};if("undefined"==typeof ma)var ma=function(g,a){var b;if("undefined"==typeof Object.getOwnPropertyNames)for(b in a.prototype){if("undefined"==typeof g.prototype[b]||g.prototype[b]==Object.prototype[b])g.prototype[b]=a.prototype[b]}else for(var c=Object.getOwnPropertyNames(a.prototype),d=0;d<c.length;d++)"undefined"==typeof Object.getOwnPropertyDescriptor(g.prototype,
c[d])&&Object.defineProperty(g.prototype,c[d],Object.getOwnPropertyDescriptor(a.prototype,c[d]));for(b in a)"undefined"==typeof g[b]&&(g[b]=a[b]);g.$baseCtor=a};l.Path=function(){return[]};l.Paths=function(){return[]};l.DoublePoint=function(){var g=arguments;this.Y=this.X=0;1==g.length?(this.X=g[0].X,this.Y=g[0].Y):2==g.length&&(this.X=g[0],this.Y=g[1])};l.DoublePoint0=function(){this.Y=this.X=0};l.DoublePoint1=function(g){this.X=g.X;this.Y=g.Y};l.DoublePoint2=function(g,a){this.X=g;this.Y=a};l.PolyNode=
function(){this.m_Parent=null;this.m_polygon=new l.Path;this.m_endtype=this.m_jointype=this.m_Index=0;this.m_Childs=[];this.IsOpen=!1};l.PolyNode.prototype.IsHoleNode=function(){for(var g=!0,a=this.m_Parent;null!==a;)g=!g,a=a.m_Parent;return g};l.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length};l.PolyNode.prototype.Contour=function(){return this.m_polygon};l.PolyNode.prototype.AddChild=function(g){var a=this.m_Childs.length;this.m_Childs.push(g);g.m_Parent=this;g.m_Index=a};l.PolyNode.prototype.GetNext=
function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()};l.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]};l.PolyNode.prototype.Childs=function(){return this.m_Childs};l.PolyNode.prototype.Parent=function(){return this.m_Parent};l.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()};l.PolyTree=function(){this.m_AllPolys=
[];l.PolyNode.call(this)};l.PolyTree.prototype.Clear=function(){for(var g=0,a=this.m_AllPolys.length;g<a;g++)this.m_AllPolys[g]=null;this.m_AllPolys.length=0;this.m_Childs.length=0};l.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null};l.PolyTree.prototype.Total=function(){return this.m_AllPolys.length};ma(l.PolyTree,l.PolyNode);l.Math_Abs_Int64=l.Math_Abs_Int32=l.Math_Abs_Double=function(g){return Math.abs(g)};l.Math_Max_Int32_Int32=function(g,a){return Math.max(g,
a)};l.Cast_Int32=P||ia||X?function(g){return g|0}:function(g){return~~g};l.Cast_Int64=O?function(g){return-2147483648>g||2147483647<g?0>g?Math.ceil(g):Math.floor(g):~~g}:ea&&"function"==typeof Number.toInteger?function(g){return Number.toInteger(g)}:R||A?function(g){return parseInt(g,10)}:P?function(g){return-2147483648>g||2147483647<g?0>g?Math.ceil(g):Math.floor(g):g|0}:function(g){return 0>g?Math.ceil(g):Math.floor(g)};l.Clear=function(g){g.length=0};l.PI=3.141592653589793;l.PI2=6.283185307179586;
l.IntPoint=function(){var g;g=arguments;var a=g.length;this.Y=this.X=0;2==a?(this.X=g[0],this.Y=g[1]):1==a?g[0]instanceof l.DoublePoint?(g=g[0],this.X=l.Clipper.Round(g.X),this.Y=l.Clipper.Round(g.Y)):(g=g[0],this.X=g.X,this.Y=g.Y):this.Y=this.X=0};l.IntPoint.op_Equality=function(g,a){return g.X==a.X&&g.Y==a.Y};l.IntPoint.op_Inequality=function(g,a){return g.X!=a.X||g.Y!=a.Y};l.IntPoint0=function(){this.Y=this.X=0};l.IntPoint1=function(g){this.X=g.X;this.Y=g.Y};l.IntPoint1dp=function(g){this.X=l.Clipper.Round(g.X);
this.Y=l.Clipper.Round(g.Y)};l.IntPoint2=function(g,a){this.X=g;this.Y=a};l.IntRect=function(){var g=arguments,a=g.length;4==a?(this.left=g[0],this.top=g[1],this.right=g[2],this.bottom=g[3]):1==a?(this.left=g[0].left,this.top=g[0].top,this.right=g[0].right,this.bottom=g[0].bottom):this.bottom=this.right=this.top=this.left=0};l.IntRect0=function(){this.bottom=this.right=this.top=this.left=0};l.IntRect1=function(g){this.left=g.left;this.top=g.top;this.right=g.right;this.bottom=g.bottom};l.IntRect4=
function(g,a,b,c){this.left=g;this.top=a;this.right=b;this.bottom=c};l.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3};l.PolyType={ptSubject:0,ptClip:1};l.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3};l.JoinType={jtSquare:0,jtRound:1,jtMiter:2};l.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4};l.EdgeSide={esLeft:0,esRight:1};l.Direction={dRightToLeft:0,dLeftToRight:1};l.TEdge=function(){this.Bot=new l.IntPoint;this.Curr=new l.IntPoint;
this.Top=new l.IntPoint;this.Delta=new l.IntPoint;this.Dx=0;this.PolyTyp=l.PolyType.ptSubject;this.Side=l.EdgeSide.esLeft;this.OutIdx=this.WindCnt2=this.WindCnt=this.WindDelta=0;this.PrevInSEL=this.NextInSEL=this.PrevInAEL=this.NextInAEL=this.NextInLML=this.Prev=this.Next=null};l.IntersectNode=function(){this.Edge2=this.Edge1=null;this.Pt=new l.IntPoint};l.MyIntersectNodeSort=function(){};l.MyIntersectNodeSort.Compare=function(g,a){return a.Pt.Y-g.Pt.Y};l.LocalMinima=function(){this.Y=0;this.Next=
this.RightBound=this.LeftBound=null};l.Scanbeam=function(){this.Y=0;this.Next=null};l.OutRec=function(){this.Idx=0;this.IsOpen=this.IsHole=!1;this.PolyNode=this.BottomPt=this.Pts=this.FirstLeft=null};l.OutPt=function(){this.Idx=0;this.Pt=new l.IntPoint;this.Prev=this.Next=null};l.Join=function(){this.OutPt2=this.OutPt1=null;this.OffPt=new l.IntPoint};l.ClipperBase=function(){this.m_CurrentLM=this.m_MinimaList=null;this.m_edges=[];this.PreserveCollinear=this.m_HasOpenPaths=this.m_UseFullRange=!1;this.m_CurrentLM=
this.m_MinimaList=null;this.m_HasOpenPaths=this.m_UseFullRange=!1};l.ClipperBase.horizontal=-9007199254740992;l.ClipperBase.Skip=-2;l.ClipperBase.Unassigned=-1;l.ClipperBase.tolerance=1E-20;l.ClipperBase.loRange=47453132;l.ClipperBase.hiRange=0xfffffffffffff;l.ClipperBase.near_zero=function(g){return g>-l.ClipperBase.tolerance&&g<l.ClipperBase.tolerance};l.ClipperBase.IsHorizontal=function(g){return 0===g.Delta.Y};l.ClipperBase.prototype.PointIsVertex=function(g,a){var b=a;do{if(l.IntPoint.op_Equality(b.Pt,
g))return!0;b=b.Next}while(b!=a);return!1};l.ClipperBase.prototype.PointOnLineSegment=function(g,t,b,c){return c?g.X==t.X&&g.Y==t.Y||g.X==b.X&&g.Y==b.Y||g.X>t.X==g.X<b.X&&g.Y>t.Y==g.Y<b.Y&&a.op_Equality(a.Int128Mul(g.X-t.X,b.Y-t.Y),a.Int128Mul(b.X-t.X,g.Y-t.Y)):g.X==t.X&&g.Y==t.Y||g.X==b.X&&g.Y==b.Y||g.X>t.X==g.X<b.X&&g.Y>t.Y==g.Y<b.Y&&(g.X-t.X)*(b.Y-t.Y)==(b.X-t.X)*(g.Y-t.Y)};l.ClipperBase.prototype.PointOnPolygon=function(g,a,b){for(var c=a;;){if(this.PointOnLineSegment(g,c.Pt,c.Next.Pt,b))return!0;
c=c.Next;if(c==a)break}return!1};l.ClipperBase.prototype.SlopesEqual=l.ClipperBase.SlopesEqual=function(){var g=arguments,t=g.length,b,c,d;if(3==t)return t=g[0],b=g[1],g[2]?a.op_Equality(a.Int128Mul(t.Delta.Y,b.Delta.X),a.Int128Mul(t.Delta.X,b.Delta.Y)):l.Cast_Int64(t.Delta.Y*b.Delta.X)==l.Cast_Int64(t.Delta.X*b.Delta.Y);if(4==t)return t=g[0],b=g[1],c=g[2],g[3]?a.op_Equality(a.Int128Mul(t.Y-b.Y,b.X-c.X),a.Int128Mul(t.X-b.X,b.Y-c.Y)):0===l.Cast_Int64((t.Y-b.Y)*(b.X-c.X))-l.Cast_Int64((t.X-b.X)*(b.Y-
c.Y));t=g[0];b=g[1];c=g[2];d=g[3];return g[4]?a.op_Equality(a.Int128Mul(t.Y-b.Y,c.X-d.X),a.Int128Mul(t.X-b.X,c.Y-d.Y)):0===l.Cast_Int64((t.Y-b.Y)*(c.X-d.X))-l.Cast_Int64((t.X-b.X)*(c.Y-d.Y))};l.ClipperBase.SlopesEqual3=function(g,t,b){return b?a.op_Equality(a.Int128Mul(g.Delta.Y,t.Delta.X),a.Int128Mul(g.Delta.X,t.Delta.Y)):l.Cast_Int64(g.Delta.Y*t.Delta.X)==l.Cast_Int64(g.Delta.X*t.Delta.Y)};l.ClipperBase.SlopesEqual4=function(g,t,b,c){return c?a.op_Equality(a.Int128Mul(g.Y-t.Y,t.X-b.X),a.Int128Mul(g.X-
t.X,t.Y-b.Y)):0===l.Cast_Int64((g.Y-t.Y)*(t.X-b.X))-l.Cast_Int64((g.X-t.X)*(t.Y-b.Y))};l.ClipperBase.SlopesEqual5=function(g,t,b,c,d){return d?a.op_Equality(a.Int128Mul(g.Y-t.Y,b.X-c.X),a.Int128Mul(g.X-t.X,b.Y-c.Y)):0===l.Cast_Int64((g.Y-t.Y)*(b.X-c.X))-l.Cast_Int64((g.X-t.X)*(b.Y-c.Y))};l.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var g=0,a=this.m_edges.length;g<a;++g){for(var b=0,c=this.m_edges[g].length;b<c;++b)this.m_edges[g][b]=null;l.Clear(this.m_edges[g])}l.Clear(this.m_edges);
this.m_HasOpenPaths=this.m_UseFullRange=!1};l.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var g=this.m_MinimaList.Next;this.m_MinimaList=null;this.m_MinimaList=g}this.m_CurrentLM=null};l.ClipperBase.prototype.RangeTest=function(g,a){if(a.Value)(g.X>l.ClipperBase.hiRange||g.Y>l.ClipperBase.hiRange||-g.X>l.ClipperBase.hiRange||-g.Y>l.ClipperBase.hiRange)&&l.Error("Coordinate outside allowed range in RangeTest().");else if(g.X>l.ClipperBase.loRange||g.Y>l.ClipperBase.loRange||
-g.X>l.ClipperBase.loRange||-g.Y>l.ClipperBase.loRange)a.Value=!0,this.RangeTest(g,a)};l.ClipperBase.prototype.InitEdge=function(g,a,b,c){g.Next=a;g.Prev=b;g.Curr.X=c.X;g.Curr.Y=c.Y;g.OutIdx=-1};l.ClipperBase.prototype.InitEdge2=function(g,a){g.Curr.Y>=g.Next.Curr.Y?(g.Bot.X=g.Curr.X,g.Bot.Y=g.Curr.Y,g.Top.X=g.Next.Curr.X,g.Top.Y=g.Next.Curr.Y):(g.Top.X=g.Curr.X,g.Top.Y=g.Curr.Y,g.Bot.X=g.Next.Curr.X,g.Bot.Y=g.Next.Curr.Y);this.SetDx(g);g.PolyTyp=a};l.ClipperBase.prototype.FindNextLocMin=function(g){for(var a;;){for(;l.IntPoint.op_Inequality(g.Bot,
g.Prev.Bot)||l.IntPoint.op_Equality(g.Curr,g.Top);)g=g.Next;if(g.Dx!=l.ClipperBase.horizontal&&g.Prev.Dx!=l.ClipperBase.horizontal)break;for(;g.Prev.Dx==l.ClipperBase.horizontal;)g=g.Prev;for(a=g;g.Dx==l.ClipperBase.horizontal;)g=g.Next;if(g.Top.Y!=g.Prev.Bot.Y){a.Prev.Bot.X<g.Bot.X&&(g=a);break}}return g};l.ClipperBase.prototype.ProcessBound=function(g,a){var b=g,c=g,d;g.Dx==l.ClipperBase.horizontal&&(d=a?g.Prev.Bot.X:g.Next.Bot.X,g.Bot.X!=d&&this.ReverseHorizontal(g));if(c.OutIdx!=l.ClipperBase.Skip)if(a){for(;c.Top.Y==
c.Next.Bot.Y&&c.Next.OutIdx!=l.ClipperBase.Skip;)c=c.Next;if(c.Dx==l.ClipperBase.horizontal&&c.Next.OutIdx!=l.ClipperBase.Skip){for(d=c;d.Prev.Dx==l.ClipperBase.horizontal;)d=d.Prev;d.Prev.Top.X==c.Next.Top.X?a||(c=d.Prev):d.Prev.Top.X>c.Next.Top.X&&(c=d.Prev)}for(;g!=c;)g.NextInLML=g.Next,g.Dx==l.ClipperBase.horizontal&&g!=b&&g.Bot.X!=g.Prev.Top.X&&this.ReverseHorizontal(g),g=g.Next;g.Dx==l.ClipperBase.horizontal&&g!=b&&g.Bot.X!=g.Prev.Top.X&&this.ReverseHorizontal(g);c=c.Next}else{for(;c.Top.Y==
c.Prev.Bot.Y&&c.Prev.OutIdx!=l.ClipperBase.Skip;)c=c.Prev;if(c.Dx==l.ClipperBase.horizontal&&c.Prev.OutIdx!=l.ClipperBase.Skip){for(d=c;d.Next.Dx==l.ClipperBase.horizontal;)d=d.Next;d.Next.Top.X==c.Prev.Top.X?a||(c=d.Next):d.Next.Top.X>c.Prev.Top.X&&(c=d.Next)}for(;g!=c;)g.NextInLML=g.Prev,g.Dx==l.ClipperBase.horizontal&&g!=b&&g.Bot.X!=g.Next.Top.X&&this.ReverseHorizontal(g),g=g.Prev;g.Dx==l.ClipperBase.horizontal&&g!=b&&g.Bot.X!=g.Next.Top.X&&this.ReverseHorizontal(g);c=c.Prev}if(c.OutIdx==l.ClipperBase.Skip){g=
c;if(a){for(;g.Top.Y==g.Next.Bot.Y;)g=g.Next;for(;g!=c&&g.Dx==l.ClipperBase.horizontal;)g=g.Prev}else{for(;g.Top.Y==g.Prev.Bot.Y;)g=g.Prev;for(;g!=c&&g.Dx==l.ClipperBase.horizontal;)g=g.Next}g==c?c=a?g.Next:g.Prev:(g=a?c.Next:c.Prev,b=new l.LocalMinima,b.Next=null,b.Y=g.Bot.Y,b.LeftBound=null,b.RightBound=g,b.RightBound.WindDelta=0,c=this.ProcessBound(b.RightBound,a),this.InsertLocalMinima(b))}return c};l.ClipperBase.prototype.AddPath=function(g,a,b){b||a!=l.PolyType.ptClip||l.Error("AddPath: Open paths must be subject.");
var c=g.length-1;if(b)for(;0<c&&l.IntPoint.op_Equality(g[c],g[0]);)--c;for(;0<c&&l.IntPoint.op_Equality(g[c],g[c-1]);)--c;if(b&&2>c||!b&&1>c)return!1;for(var d=[],e=0;e<=c;e++)d.push(new l.TEdge);var h=!0;try{for(d[1].Curr.X=g[1].X,d[1].Curr.Y=g[1].Y,function(){var a={Value:this.m_UseFullRange},t=this.RangeTest(g[0],a);this.m_UseFullRange=a.Value;return t}.call(this),function(){var a={Value:this.m_UseFullRange},t=this.RangeTest(g[c],a);this.m_UseFullRange=a.Value;return t}.call(this),this.InitEdge(d[0],
d[1],d[c],g[0]),this.InitEdge(d[c],d[0],d[c-1],g[c]),e=c-1;1<=e;--e)(function(){var a={Value:this.m_UseFullRange},t=this.RangeTest(g[e],a);this.m_UseFullRange=a.Value;return t}).call(this),this.InitEdge(d[e],d[e+1],d[e-1],g[e])}catch(k){return!1}var n=d[0];b||(n.Prev.OutIdx=l.ClipperBase.Skip);for(var r=n,u=n;;)if(l.IntPoint.op_Equality(r.Curr,r.Next.Curr)){if(r==r.Next)break;r==n&&(n=r.Next);u=r=this.RemoveEdge(r)}else{if(r.Prev==r.Next)break;else if(b&&l.ClipperBase.SlopesEqual(r.Prev.Curr,r.Curr,
r.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(r.Prev.Curr,r.Curr,r.Next.Curr))){r==n&&(n=r.Next);r=this.RemoveEdge(r);u=r=r.Prev;continue}r=r.Next;if(r==u)break}if(!b&&r==r.Next||b&&r.Prev==r.Next)return!1;b||(this.m_HasOpenPaths=!0);r=n;do this.InitEdge2(r,a),r=r.Next,h&&r.Curr.Y!=n.Curr.Y&&(h=!1);while(r!=n);if(h){if(b)return!1;r.Prev.OutIdx=l.ClipperBase.Skip;r.Prev.Bot.X<r.Prev.Top.X&&this.ReverseHorizontal(r.Prev);a=new l.LocalMinima;a.Next=null;a.Y=
r.Bot.Y;a.LeftBound=null;a.RightBound=r;a.RightBound.Side=l.EdgeSide.esRight;for(a.RightBound.WindDelta=0;r.Next.OutIdx!=l.ClipperBase.Skip;)r.NextInLML=r.Next,r.Bot.X!=r.Prev.Top.X&&this.ReverseHorizontal(r),r=r.Next;this.InsertLocalMinima(a);this.m_edges.push(d);return!0}this.m_edges.push(d);for(h=null;;){r=this.FindNextLocMin(r);if(r==h)break;else null==h&&(h=r);a=new l.LocalMinima;a.Next=null;a.Y=r.Bot.Y;r.Dx<r.Prev.Dx?(a.LeftBound=r.Prev,a.RightBound=r,d=!1):(a.LeftBound=r,a.RightBound=r.Prev,
d=!0);a.LeftBound.Side=l.EdgeSide.esLeft;a.RightBound.Side=l.EdgeSide.esRight;a.LeftBound.WindDelta=b?a.LeftBound.Next==a.RightBound?-1:1:0;a.RightBound.WindDelta=-a.LeftBound.WindDelta;r=this.ProcessBound(a.LeftBound,d);n=this.ProcessBound(a.RightBound,!d);a.LeftBound.OutIdx==l.ClipperBase.Skip?a.LeftBound=null:a.RightBound.OutIdx==l.ClipperBase.Skip&&(a.RightBound=null);this.InsertLocalMinima(a);d||(r=n)}return!0};l.ClipperBase.prototype.AddPaths=function(g,a,b){for(var c=!1,d=0,l=g.length;d<l;++d)this.AddPath(g[d],
a,b)&&(c=!0);return c};l.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(g,a,b){return l.IntPoint.op_Equality(g,b)||l.IntPoint.op_Equality(g,a)||l.IntPoint.op_Equality(b,a)?!1:g.X!=b.X?a.X>g.X==a.X<b.X:a.Y>g.Y==a.Y<b.Y};l.ClipperBase.prototype.RemoveEdge=function(g){g.Prev.Next=g.Next;g.Next.Prev=g.Prev;var a=g.Next;g.Prev=null;return a};l.ClipperBase.prototype.SetDx=function(g){g.Delta.X=g.Top.X-g.Bot.X;g.Delta.Y=g.Top.Y-g.Bot.Y;g.Dx=0===g.Delta.Y?l.ClipperBase.horizontal:g.Delta.X/g.Delta.Y};
l.ClipperBase.prototype.InsertLocalMinima=function(g){if(null===this.m_MinimaList)this.m_MinimaList=g;else if(g.Y>=this.m_MinimaList.Y)g.Next=this.m_MinimaList,this.m_MinimaList=g;else{for(var a=this.m_MinimaList;null!==a.Next&&g.Y<a.Next.Y;)a=a.Next;g.Next=a.Next;a.Next=g}};l.ClipperBase.prototype.PopLocalMinima=function(){null!==this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.Next)};l.ClipperBase.prototype.ReverseHorizontal=function(g){var a=g.Top.X;g.Top.X=g.Bot.X;g.Bot.X=a};l.ClipperBase.prototype.Reset=
function(){this.m_CurrentLM=this.m_MinimaList;if(null!=this.m_CurrentLM)for(var g=this.m_MinimaList;null!=g;){var a=g.LeftBound;null!=a&&(a.Curr.X=a.Bot.X,a.Curr.Y=a.Bot.Y,a.Side=l.EdgeSide.esLeft,a.OutIdx=l.ClipperBase.Unassigned);a=g.RightBound;null!=a&&(a.Curr.X=a.Bot.X,a.Curr.Y=a.Bot.Y,a.Side=l.EdgeSide.esRight,a.OutIdx=l.ClipperBase.Unassigned);g=g.Next}};l.Clipper=function(g){"undefined"==typeof g&&(g=0);this.m_PolyOuts=null;this.m_ClipType=l.ClipType.ctIntersection;this.m_IntersectNodeComparer=
this.m_IntersectList=this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_ExecuteLocked=!1;this.m_SubjFillType=this.m_ClipFillType=l.PolyFillType.pftEvenOdd;this.m_GhostJoins=this.m_Joins=null;this.StrictlySimple=this.ReverseSolution=this.m_UsingPolyTree=!1;l.ClipperBase.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_IntersectList=[];this.m_IntersectNodeComparer=l.MyIntersectNodeSort.Compare;this.m_UsingPolyTree=this.m_ExecuteLocked=!1;this.m_PolyOuts=[];
this.m_Joins=[];this.m_GhostJoins=[];this.ReverseSolution=0!==(1&g);this.StrictlySimple=0!==(2&g);this.PreserveCollinear=0!==(4&g)};l.Clipper.ioReverseSolution=1;l.Clipper.ioStrictlySimple=2;l.Clipper.ioPreserveCollinear=4;l.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),l.ClipperBase.prototype.Clear.call(this))};l.Clipper.prototype.DisposeScanbeamList=function(){for(;null!==this.m_Scanbeam;){var g=this.m_Scanbeam.Next;this.m_Scanbeam=null;this.m_Scanbeam=g}};
l.Clipper.prototype.Reset=function(){l.ClipperBase.prototype.Reset.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.DisposeAllPolyPts();for(var g=this.m_MinimaList;null!==g;)this.InsertScanbeam(g.Y),g=g.Next};l.Clipper.prototype.InsertScanbeam=function(g){if(null===this.m_Scanbeam)this.m_Scanbeam=new l.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=g;else if(g>this.m_Scanbeam.Y){var a=new l.Scanbeam;a.Y=g;a.Next=this.m_Scanbeam;this.m_Scanbeam=a}else{for(var b=this.m_Scanbeam;null!==
b.Next&&g<=b.Next.Y;)b=b.Next;g!=b.Y&&(a=new l.Scanbeam,a.Y=g,a.Next=b.Next,b.Next=a)}};l.Clipper.prototype.Execute=function(){var g=arguments,a=g.length,b=g[1]instanceof l.PolyTree;if(4!=a||b){if(4==a&&b){b=g[0];a=g[1];c=g[2];g=g[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;this.m_SubjFillType=c;this.m_ClipFillType=g;this.m_ClipType=b;this.m_UsingPolyTree=!0;(g=this.ExecuteInternal())&&this.BuildResult2(a);this.m_ExecuteLocked=!1;return g}if(2==a&&!b||2==a&&b)return b=g[0],a=g[1],
this.Execute(b,a,l.PolyFillType.pftEvenOdd,l.PolyFillType.pftEvenOdd)}else{var b=g[0],a=g[1],c=g[2],g=g[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&l.Error("Error: PolyTree struct is need for open path clipping.");this.m_ExecuteLocked=!0;l.Clear(a);this.m_SubjFillType=c;this.m_ClipFillType=g;this.m_ClipType=b;this.m_UsingPolyTree=!1;(g=this.ExecuteInternal())&&this.BuildResult(a);this.m_ExecuteLocked=!1;return g}};l.Clipper.prototype.FixHoleLinkage=function(g){if(null!==g.FirstLeft&&
(g.IsHole==g.FirstLeft.IsHole||null===g.FirstLeft.Pts)){for(var a=g.FirstLeft;null!==a&&(a.IsHole==g.IsHole||null===a.Pts);)a=a.FirstLeft;g.FirstLeft=a}};l.Clipper.prototype.ExecuteInternal=function(){try{this.Reset();if(null===this.m_CurrentLM)return!1;var g=this.PopScanbeam();do{this.InsertLocalMinimaIntoAEL(g);l.Clear(this.m_GhostJoins);this.ProcessHorizontals(!1);if(null===this.m_Scanbeam)break;var a=this.PopScanbeam();if(!this.ProcessIntersections(g,a))return!1;this.ProcessEdgesAtTopOfScanbeam(a);
g=a}while(null!==this.m_Scanbeam||null!==this.m_CurrentLM);for(var g=0,b=this.m_PolyOuts.length;g<b;g++){var c=this.m_PolyOuts[g];null===c.Pts||c.IsOpen||(c.IsHole^this.ReverseSolution)==0<this.Area(c)&&this.ReversePolyPtLinks(c.Pts)}this.JoinCommonEdges();g=0;for(b=this.m_PolyOuts.length;g<b;g++)c=this.m_PolyOuts[g],null===c.Pts||c.IsOpen||this.FixupOutPolygon(c);this.StrictlySimple&&this.DoSimplePolygons();return!0}finally{l.Clear(this.m_Joins),l.Clear(this.m_GhostJoins)}};l.Clipper.prototype.PopScanbeam=
function(){var g=this.m_Scanbeam.Y;this.m_Scanbeam=this.m_Scanbeam.Next;return g};l.Clipper.prototype.DisposeAllPolyPts=function(){for(var g=0,a=this.m_PolyOuts.length;g<a;++g)this.DisposeOutRec(g);l.Clear(this.m_PolyOuts)};l.Clipper.prototype.DisposeOutRec=function(g){var a=this.m_PolyOuts[g];null!==a.Pts&&this.DisposeOutPts(a.Pts);this.m_PolyOuts[g]=null};l.Clipper.prototype.DisposeOutPts=function(g){if(null!==g)for(g.Prev.Next=null;null!==g;)g=g.Next};l.Clipper.prototype.AddJoin=function(g,a,b){var c=
new l.Join;c.OutPt1=g;c.OutPt2=a;c.OffPt.X=b.X;c.OffPt.Y=b.Y;this.m_Joins.push(c)};l.Clipper.prototype.AddGhostJoin=function(g,a){var b=new l.Join;b.OutPt1=g;b.OffPt.X=a.X;b.OffPt.Y=a.Y;this.m_GhostJoins.push(b)};l.Clipper.prototype.InsertLocalMinimaIntoAEL=function(g){for(;null!==this.m_CurrentLM&&this.m_CurrentLM.Y==g;){var a=this.m_CurrentLM.LeftBound,b=this.m_CurrentLM.RightBound;this.PopLocalMinima();var c=null;null===a?(this.InsertEdgeIntoAEL(b,null),this.SetWindingCount(b),this.IsContributing(b)&&
(c=this.AddOutPt(b,b.Bot))):(null==b?(this.InsertEdgeIntoAEL(a,null),this.SetWindingCount(a),this.IsContributing(a)&&(c=this.AddOutPt(a,a.Bot))):(this.InsertEdgeIntoAEL(a,null),this.InsertEdgeIntoAEL(b,a),this.SetWindingCount(a),b.WindCnt=a.WindCnt,b.WindCnt2=a.WindCnt2,this.IsContributing(a)&&(c=this.AddLocalMinPoly(a,b,a.Bot))),this.InsertScanbeam(a.Top.Y));null!=b&&(l.ClipperBase.IsHorizontal(b)?this.AddEdgeToSEL(b):this.InsertScanbeam(b.Top.Y));if(null!=a&&null!=b){if(null!==c&&l.ClipperBase.IsHorizontal(b)&&
0<this.m_GhostJoins.length&&0!==b.WindDelta)for(var d=0,e=this.m_GhostJoins.length;d<e;d++){var h=this.m_GhostJoins[d];this.HorzSegmentsOverlap(h.OutPt1.Pt,h.OffPt,b.Bot,b.Top)&&this.AddJoin(h.OutPt1,c,h.OffPt)}0<=a.OutIdx&&null!==a.PrevInAEL&&a.PrevInAEL.Curr.X==a.Bot.X&&0<=a.PrevInAEL.OutIdx&&l.ClipperBase.SlopesEqual(a.PrevInAEL,a,this.m_UseFullRange)&&0!==a.WindDelta&&0!==a.PrevInAEL.WindDelta&&(d=this.AddOutPt(a.PrevInAEL,a.Bot),this.AddJoin(c,d,a.Top));if(a.NextInAEL!=b&&(0<=b.OutIdx&&0<=b.PrevInAEL.OutIdx&&
l.ClipperBase.SlopesEqual(b.PrevInAEL,b,this.m_UseFullRange)&&0!==b.WindDelta&&0!==b.PrevInAEL.WindDelta&&(d=this.AddOutPt(b.PrevInAEL,b.Bot),this.AddJoin(c,d,b.Top)),c=a.NextInAEL,null!==c))for(;c!=b;)this.IntersectEdges(b,c,a.Curr,!1),c=c.NextInAEL}}};l.Clipper.prototype.InsertEdgeIntoAEL=function(g,a){if(null===this.m_ActiveEdges)g.PrevInAEL=null,g.NextInAEL=null,this.m_ActiveEdges=g;else if(null===a&&this.E2InsertsBeforeE1(this.m_ActiveEdges,g))g.PrevInAEL=null,g.NextInAEL=this.m_ActiveEdges,
this.m_ActiveEdges=this.m_ActiveEdges.PrevInAEL=g;else{for(null===a&&(a=this.m_ActiveEdges);null!==a.NextInAEL&&!this.E2InsertsBeforeE1(a.NextInAEL,g);)a=a.NextInAEL;g.NextInAEL=a.NextInAEL;null!==a.NextInAEL&&(a.NextInAEL.PrevInAEL=g);g.PrevInAEL=a;a.NextInAEL=g}};l.Clipper.prototype.E2InsertsBeforeE1=function(g,a){return a.Curr.X==g.Curr.X?a.Top.Y>g.Top.Y?a.Top.X<l.Clipper.TopX(g,a.Top.Y):g.Top.X>l.Clipper.TopX(a,g.Top.Y):a.Curr.X<g.Curr.X};l.Clipper.prototype.IsEvenOddFillType=function(g){return g.PolyTyp==
l.PolyType.ptSubject?this.m_SubjFillType==l.PolyFillType.pftEvenOdd:this.m_ClipFillType==l.PolyFillType.pftEvenOdd};l.Clipper.prototype.IsEvenOddAltFillType=function(g){return g.PolyTyp==l.PolyType.ptSubject?this.m_ClipFillType==l.PolyFillType.pftEvenOdd:this.m_SubjFillType==l.PolyFillType.pftEvenOdd};l.Clipper.prototype.IsContributing=function(g){var a,b;g.PolyTyp==l.PolyType.ptSubject?(a=this.m_SubjFillType,b=this.m_ClipFillType):(a=this.m_ClipFillType,b=this.m_SubjFillType);switch(a){case l.PolyFillType.pftEvenOdd:if(0===
g.WindDelta&&1!=g.WindCnt)return!1;break;case l.PolyFillType.pftNonZero:if(1!=Math.abs(g.WindCnt))return!1;break;case l.PolyFillType.pftPositive:if(1!=g.WindCnt)return!1;break;default:if(-1!=g.WindCnt)return!1}switch(this.m_ClipType){case l.ClipType.ctIntersection:switch(b){case l.PolyFillType.pftEvenOdd:case l.PolyFillType.pftNonZero:return 0!==g.WindCnt2;case l.PolyFillType.pftPositive:return 0<g.WindCnt2;default:return 0>g.WindCnt2}case l.ClipType.ctUnion:switch(b){case l.PolyFillType.pftEvenOdd:case l.PolyFillType.pftNonZero:return 0===
g.WindCnt2;case l.PolyFillType.pftPositive:return 0>=g.WindCnt2;default:return 0<=g.WindCnt2}case l.ClipType.ctDifference:if(g.PolyTyp==l.PolyType.ptSubject)switch(b){case l.PolyFillType.pftEvenOdd:case l.PolyFillType.pftNonZero:return 0===g.WindCnt2;case l.PolyFillType.pftPositive:return 0>=g.WindCnt2;default:return 0<=g.WindCnt2}else switch(b){case l.PolyFillType.pftEvenOdd:case l.PolyFillType.pftNonZero:return 0!==g.WindCnt2;case l.PolyFillType.pftPositive:return 0<g.WindCnt2;default:return 0>
g.WindCnt2}case l.ClipType.ctXor:if(0===g.WindDelta)switch(b){case l.PolyFillType.pftEvenOdd:case l.PolyFillType.pftNonZero:return 0===g.WindCnt2;case l.PolyFillType.pftPositive:return 0>=g.WindCnt2;default:return 0<=g.WindCnt2}}return!0};l.Clipper.prototype.SetWindingCount=function(g){for(var a=g.PrevInAEL;null!==a&&(a.PolyTyp!=g.PolyTyp||0===a.WindDelta);)a=a.PrevInAEL;if(null===a)g.WindCnt=0===g.WindDelta?1:g.WindDelta,g.WindCnt2=0,a=this.m_ActiveEdges;else{if(0===g.WindDelta&&this.m_ClipType!=
l.ClipType.ctUnion)g.WindCnt=1;else if(this.IsEvenOddFillType(g))if(0===g.WindDelta){for(var b=!0,c=a.PrevInAEL;null!==c;)c.PolyTyp==a.PolyTyp&&0!==c.WindDelta&&(b=!b),c=c.PrevInAEL;g.WindCnt=b?0:1}else g.WindCnt=g.WindDelta;else 0>a.WindCnt*a.WindDelta?1<Math.abs(a.WindCnt)?g.WindCnt=0>a.WindDelta*g.WindDelta?a.WindCnt:a.WindCnt+g.WindDelta:g.WindCnt=0===g.WindDelta?1:g.WindDelta:g.WindCnt=0===g.WindDelta?0>a.WindCnt?a.WindCnt-1:a.WindCnt+1:0>a.WindDelta*g.WindDelta?a.WindCnt:a.WindCnt+g.WindDelta;
g.WindCnt2=a.WindCnt2;a=a.NextInAEL}if(this.IsEvenOddAltFillType(g))for(;a!=g;)0!==a.WindDelta&&(g.WindCnt2=0===g.WindCnt2?1:0),a=a.NextInAEL;else for(;a!=g;)g.WindCnt2+=a.WindDelta,a=a.NextInAEL};l.Clipper.prototype.AddEdgeToSEL=function(g){null===this.m_SortedEdges?(this.m_SortedEdges=g,g.PrevInSEL=null,g.NextInSEL=null):(g.NextInSEL=this.m_SortedEdges,g.PrevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.PrevInSEL=g)};l.Clipper.prototype.CopyAELToSEL=function(){var g=this.m_ActiveEdges;for(this.m_SortedEdges=
g;null!==g;)g.PrevInSEL=g.PrevInAEL,g=g.NextInSEL=g.NextInAEL};l.Clipper.prototype.SwapPositionsInAEL=function(g,a){if(g.NextInAEL!=g.PrevInAEL&&a.NextInAEL!=a.PrevInAEL){if(g.NextInAEL==a){var b=a.NextInAEL;null!==b&&(b.PrevInAEL=g);var c=g.PrevInAEL;null!==c&&(c.NextInAEL=a);a.PrevInAEL=c;a.NextInAEL=g;g.PrevInAEL=a;g.NextInAEL=b}else a.NextInAEL==g?(b=g.NextInAEL,null!==b&&(b.PrevInAEL=a),c=a.PrevInAEL,null!==c&&(c.NextInAEL=g),g.PrevInAEL=c,g.NextInAEL=a,a.PrevInAEL=g,a.NextInAEL=b):(b=g.NextInAEL,
c=g.PrevInAEL,g.NextInAEL=a.NextInAEL,null!==g.NextInAEL&&(g.NextInAEL.PrevInAEL=g),g.PrevInAEL=a.PrevInAEL,null!==g.PrevInAEL&&(g.PrevInAEL.NextInAEL=g),a.NextInAEL=b,null!==a.NextInAEL&&(a.NextInAEL.PrevInAEL=a),a.PrevInAEL=c,null!==a.PrevInAEL&&(a.PrevInAEL.NextInAEL=a));null===g.PrevInAEL?this.m_ActiveEdges=g:null===a.PrevInAEL&&(this.m_ActiveEdges=a)}};l.Clipper.prototype.SwapPositionsInSEL=function(g,a){if(null!==g.NextInSEL||null!==g.PrevInSEL)if(null!==a.NextInSEL||null!==a.PrevInSEL){if(g.NextInSEL==
a){var b=a.NextInSEL;null!==b&&(b.PrevInSEL=g);var c=g.PrevInSEL;null!==c&&(c.NextInSEL=a);a.PrevInSEL=c;a.NextInSEL=g;g.PrevInSEL=a;g.NextInSEL=b}else a.NextInSEL==g?(b=g.NextInSEL,null!==b&&(b.PrevInSEL=a),c=a.PrevInSEL,null!==c&&(c.NextInSEL=g),g.PrevInSEL=c,g.NextInSEL=a,a.PrevInSEL=g,a.NextInSEL=b):(b=g.NextInSEL,c=g.PrevInSEL,g.NextInSEL=a.NextInSEL,null!==g.NextInSEL&&(g.NextInSEL.PrevInSEL=g),g.PrevInSEL=a.PrevInSEL,null!==g.PrevInSEL&&(g.PrevInSEL.NextInSEL=g),a.NextInSEL=b,null!==a.NextInSEL&&
(a.NextInSEL.PrevInSEL=a),a.PrevInSEL=c,null!==a.PrevInSEL&&(a.PrevInSEL.NextInSEL=a));null===g.PrevInSEL?this.m_SortedEdges=g:null===a.PrevInSEL&&(this.m_SortedEdges=a)}};l.Clipper.prototype.AddLocalMaxPoly=function(g,a,b){this.AddOutPt(g,b);0==a.WindDelta&&this.AddOutPt(a,b);g.OutIdx==a.OutIdx?(g.OutIdx=-1,a.OutIdx=-1):g.OutIdx<a.OutIdx?this.AppendPolygon(g,a):this.AppendPolygon(a,g)};l.Clipper.prototype.AddLocalMinPoly=function(g,a,b){var c,d;l.ClipperBase.IsHorizontal(a)||g.Dx>a.Dx?(c=this.AddOutPt(g,
b),a.OutIdx=g.OutIdx,g.Side=l.EdgeSide.esLeft,a.Side=l.EdgeSide.esRight,d=g,g=d.PrevInAEL==a?a.PrevInAEL:d.PrevInAEL):(c=this.AddOutPt(a,b),g.OutIdx=a.OutIdx,g.Side=l.EdgeSide.esRight,a.Side=l.EdgeSide.esLeft,d=a,g=d.PrevInAEL==g?g.PrevInAEL:d.PrevInAEL);null!==g&&0<=g.OutIdx&&l.Clipper.TopX(g,b.Y)==l.Clipper.TopX(d,b.Y)&&l.ClipperBase.SlopesEqual(d,g,this.m_UseFullRange)&&0!==d.WindDelta&&0!==g.WindDelta&&(b=this.AddOutPt(g,b),this.AddJoin(c,b,d.Top));return c};l.Clipper.prototype.CreateOutRec=function(){var g=
new l.OutRec;g.Idx=-1;g.IsHole=!1;g.IsOpen=!1;g.FirstLeft=null;g.Pts=null;g.BottomPt=null;g.PolyNode=null;this.m_PolyOuts.push(g);g.Idx=this.m_PolyOuts.length-1;return g};l.Clipper.prototype.AddOutPt=function(g,a){var b=g.Side==l.EdgeSide.esLeft;if(0>g.OutIdx){var c=this.CreateOutRec();c.IsOpen=0===g.WindDelta;var d=new l.OutPt;c.Pts=d;d.Idx=c.Idx;d.Pt.X=a.X;d.Pt.Y=a.Y;d.Next=d;d.Prev=d;c.IsOpen||this.SetHoleState(g,c);g.OutIdx=c.Idx}else{var c=this.m_PolyOuts[g.OutIdx],e=c.Pts;if(b&&l.IntPoint.op_Equality(a,
e.Pt))return e;if(!b&&l.IntPoint.op_Equality(a,e.Prev.Pt))return e.Prev;d=new l.OutPt;d.Idx=c.Idx;d.Pt.X=a.X;d.Pt.Y=a.Y;d.Next=e;d.Prev=e.Prev;d.Prev.Next=d;e.Prev=d;b&&(c.Pts=d)}return d};l.Clipper.prototype.SwapPoints=function(g,a){var b=new l.IntPoint(g.Value);g.Value.X=a.Value.X;g.Value.Y=a.Value.Y;a.Value.X=b.X;a.Value.Y=b.Y};l.Clipper.prototype.HorzSegmentsOverlap=function(g,a,b,c){return g.X>b.X==g.X<c.X?!0:a.X>b.X==a.X<c.X?!0:b.X>g.X==b.X<a.X?!0:c.X>g.X==c.X<a.X?!0:g.X==b.X&&a.X==c.X?!0:g.X==
c.X&&a.X==b.X?!0:!1};l.Clipper.prototype.InsertPolyPtBetween=function(g,a,b){var c=new l.OutPt;c.Pt.X=b.X;c.Pt.Y=b.Y;a==g.Next?(g.Next=c,a.Prev=c,c.Next=a,c.Prev=g):(a.Next=c,g.Prev=c,c.Next=g,c.Prev=a);return c};l.Clipper.prototype.SetHoleState=function(g,a){for(var b=!1,c=g.PrevInAEL;null!==c;)0<=c.OutIdx&&0!=c.WindDelta&&(b=!b,null===a.FirstLeft&&(a.FirstLeft=this.m_PolyOuts[c.OutIdx])),c=c.PrevInAEL;b&&(a.IsHole=!0)};l.Clipper.prototype.GetDx=function(g,a){return g.Y==a.Y?l.ClipperBase.horizontal:
(a.X-g.X)/(a.Y-g.Y)};l.Clipper.prototype.FirstIsBottomPt=function(g,a){for(var b=g.Prev;l.IntPoint.op_Equality(b.Pt,g.Pt)&&b!=g;)b=b.Prev;for(var c=Math.abs(this.GetDx(g.Pt,b.Pt)),b=g.Next;l.IntPoint.op_Equality(b.Pt,g.Pt)&&b!=g;)b=b.Next;for(var d=Math.abs(this.GetDx(g.Pt,b.Pt)),b=a.Prev;l.IntPoint.op_Equality(b.Pt,a.Pt)&&b!=a;)b=b.Prev;for(var e=Math.abs(this.GetDx(a.Pt,b.Pt)),b=a.Next;l.IntPoint.op_Equality(b.Pt,a.Pt)&&b!=a;)b=b.Next;b=Math.abs(this.GetDx(a.Pt,b.Pt));return c>=e&&c>=b||d>=e&&d>=
b};l.Clipper.prototype.GetBottomPt=function(g){for(var a=null,b=g.Next;b!=g;)b.Pt.Y>g.Pt.Y?(g=b,a=null):b.Pt.Y==g.Pt.Y&&b.Pt.X<=g.Pt.X&&(b.Pt.X<g.Pt.X?(a=null,g=b):b.Next!=g&&b.Prev!=g&&(a=b)),b=b.Next;if(null!==a)for(;a!=b;)for(this.FirstIsBottomPt(b,a)||(g=a),a=a.Next;l.IntPoint.op_Inequality(a.Pt,g.Pt);)a=a.Next;return g};l.Clipper.prototype.GetLowermostRec=function(g,a){null===g.BottomPt&&(g.BottomPt=this.GetBottomPt(g.Pts));null===a.BottomPt&&(a.BottomPt=this.GetBottomPt(a.Pts));var b=g.BottomPt,
c=a.BottomPt;return b.Pt.Y>c.Pt.Y?g:b.Pt.Y<c.Pt.Y?a:b.Pt.X<c.Pt.X?g:b.Pt.X>c.Pt.X?a:b.Next==b?a:c.Next==c?g:this.FirstIsBottomPt(b,c)?g:a};l.Clipper.prototype.Param1RightOfParam2=function(g,a){do if(g=g.FirstLeft,g==a)return!0;while(null!==g);return!1};l.Clipper.prototype.GetOutRec=function(g){for(g=this.m_PolyOuts[g];g!=this.m_PolyOuts[g.Idx];)g=this.m_PolyOuts[g.Idx];return g};l.Clipper.prototype.AppendPolygon=function(g,a){var b=this.m_PolyOuts[g.OutIdx],c=this.m_PolyOuts[a.OutIdx],d;d=this.Param1RightOfParam2(b,
c)?c:this.Param1RightOfParam2(c,b)?b:this.GetLowermostRec(b,c);var e=b.Pts,h=e.Prev,k=c.Pts,r=k.Prev;g.Side==l.EdgeSide.esLeft?(a.Side==l.EdgeSide.esLeft?(this.ReversePolyPtLinks(k),k.Next=e,e.Prev=k,h.Next=r,r.Prev=h,b.Pts=r):(r.Next=e,e.Prev=r,k.Prev=h,h.Next=k,b.Pts=k),e=l.EdgeSide.esLeft):(a.Side==l.EdgeSide.esRight?(this.ReversePolyPtLinks(k),h.Next=r,r.Prev=h,k.Next=e,e.Prev=k):(h.Next=k,k.Prev=h,e.Prev=r,r.Next=e),e=l.EdgeSide.esRight);b.BottomPt=null;d==c&&(c.FirstLeft!=b&&(b.FirstLeft=c.FirstLeft),
b.IsHole=c.IsHole);c.Pts=null;c.BottomPt=null;c.FirstLeft=b;d=g.OutIdx;h=a.OutIdx;g.OutIdx=-1;a.OutIdx=-1;for(k=this.m_ActiveEdges;null!==k;){if(k.OutIdx==h){k.OutIdx=d;k.Side=e;break}k=k.NextInAEL}c.Idx=b.Idx};l.Clipper.prototype.ReversePolyPtLinks=function(g){if(null!==g){var a,b;a=g;do b=a.Next,a.Next=a.Prev,a=a.Prev=b;while(a!=g)}};l.Clipper.SwapSides=function(g,a){var b=g.Side;g.Side=a.Side;a.Side=b};l.Clipper.SwapPolyIndexes=function(g,a){var b=g.OutIdx;g.OutIdx=a.OutIdx;a.OutIdx=b};l.Clipper.prototype.IntersectEdges=
function(g,a,b,c){var d=!c&&null===g.NextInLML&&g.Top.X==b.X&&g.Top.Y==b.Y;c=!c&&null===a.NextInLML&&a.Top.X==b.X&&a.Top.Y==b.Y;var e=0<=g.OutIdx,h=0<=a.OutIdx;if(0===g.WindDelta||0===a.WindDelta)0===g.WindDelta&&0===a.WindDelta?(d||c)&&e&&h&&this.AddLocalMaxPoly(g,a,b):g.PolyTyp==a.PolyTyp&&g.WindDelta!=a.WindDelta&&this.m_ClipType==l.ClipType.ctUnion?0===g.WindDelta?h&&(this.AddOutPt(g,b),e&&(g.OutIdx=-1)):e&&(this.AddOutPt(a,b),h&&(a.OutIdx=-1)):g.PolyTyp!=a.PolyTyp&&(0!==g.WindDelta||1!=Math.abs(a.WindCnt)||
this.m_ClipType==l.ClipType.ctUnion&&0!==a.WindCnt2?0!==a.WindDelta||1!=Math.abs(g.WindCnt)||this.m_ClipType==l.ClipType.ctUnion&&0!==g.WindCnt2||(this.AddOutPt(a,b),h&&(a.OutIdx=-1)):(this.AddOutPt(g,b),e&&(g.OutIdx=-1))),d&&(0>g.OutIdx?this.DeleteFromAEL(g):l.Error("Error intersecting polylines")),c&&(0>a.OutIdx?this.DeleteFromAEL(a):l.Error("Error intersecting polylines"));else{if(g.PolyTyp==a.PolyTyp)if(this.IsEvenOddFillType(g)){var k=g.WindCnt;g.WindCnt=a.WindCnt;a.WindCnt=k}else g.WindCnt=
0===g.WindCnt+a.WindDelta?-g.WindCnt:g.WindCnt+a.WindDelta,a.WindCnt=0===a.WindCnt-g.WindDelta?-a.WindCnt:a.WindCnt-g.WindDelta;else this.IsEvenOddFillType(a)?g.WindCnt2=0===g.WindCnt2?1:0:g.WindCnt2+=a.WindDelta,this.IsEvenOddFillType(g)?a.WindCnt2=0===a.WindCnt2?1:0:a.WindCnt2-=g.WindDelta;var r,n,u;g.PolyTyp==l.PolyType.ptSubject?(r=this.m_SubjFillType,u=this.m_ClipFillType):(r=this.m_ClipFillType,u=this.m_SubjFillType);a.PolyTyp==l.PolyType.ptSubject?(n=this.m_SubjFillType,k=this.m_ClipFillType):
(n=this.m_ClipFillType,k=this.m_SubjFillType);switch(r){case l.PolyFillType.pftPositive:r=g.WindCnt;break;case l.PolyFillType.pftNegative:r=-g.WindCnt;break;default:r=Math.abs(g.WindCnt)}switch(n){case l.PolyFillType.pftPositive:n=a.WindCnt;break;case l.PolyFillType.pftNegative:n=-a.WindCnt;break;default:n=Math.abs(a.WindCnt)}if(e&&h)d||c||0!==r&&1!=r||0!==n&&1!=n||g.PolyTyp!=a.PolyTyp&&this.m_ClipType!=l.ClipType.ctXor?this.AddLocalMaxPoly(g,a,b):(this.AddOutPt(g,b),this.AddOutPt(a,b),l.Clipper.SwapSides(g,
a),l.Clipper.SwapPolyIndexes(g,a));else if(e){if(0===n||1==n)this.AddOutPt(g,b),l.Clipper.SwapSides(g,a),l.Clipper.SwapPolyIndexes(g,a)}else if(h){if(0===r||1==r)this.AddOutPt(a,b),l.Clipper.SwapSides(g,a),l.Clipper.SwapPolyIndexes(g,a)}else if(!(0!==r&&1!=r||0!==n&&1!=n||d||c)){switch(u){case l.PolyFillType.pftPositive:e=g.WindCnt2;break;case l.PolyFillType.pftNegative:e=-g.WindCnt2;break;default:e=Math.abs(g.WindCnt2)}switch(k){case l.PolyFillType.pftPositive:h=a.WindCnt2;break;case l.PolyFillType.pftNegative:h=
-a.WindCnt2;break;default:h=Math.abs(a.WindCnt2)}if(g.PolyTyp!=a.PolyTyp)this.AddLocalMinPoly(g,a,b);else if(1==r&&1==n)switch(this.m_ClipType){case l.ClipType.ctIntersection:0<e&&0<h&&this.AddLocalMinPoly(g,a,b);break;case l.ClipType.ctUnion:0>=e&&0>=h&&this.AddLocalMinPoly(g,a,b);break;case l.ClipType.ctDifference:(g.PolyTyp==l.PolyType.ptClip&&0<e&&0<h||g.PolyTyp==l.PolyType.ptSubject&&0>=e&&0>=h)&&this.AddLocalMinPoly(g,a,b);break;case l.ClipType.ctXor:this.AddLocalMinPoly(g,a,b)}else l.Clipper.SwapSides(g,
a)}d!=c&&(d&&0<=g.OutIdx||c&&0<=a.OutIdx)&&(l.Clipper.SwapSides(g,a),l.Clipper.SwapPolyIndexes(g,a));d&&this.DeleteFromAEL(g);c&&this.DeleteFromAEL(a)}};l.Clipper.prototype.DeleteFromAEL=function(a){var b=a.PrevInAEL,c=a.NextInAEL;if(null!==b||null!==c||a==this.m_ActiveEdges)null!==b?b.NextInAEL=c:this.m_ActiveEdges=c,null!==c&&(c.PrevInAEL=b),a.NextInAEL=null,a.PrevInAEL=null};l.Clipper.prototype.DeleteFromSEL=function(a){var b=a.PrevInSEL,c=a.NextInSEL;if(null!==b||null!==c||a==this.m_SortedEdges)null!==
b?b.NextInSEL=c:this.m_SortedEdges=c,null!==c&&(c.PrevInSEL=b),a.NextInSEL=null,a.PrevInSEL=null};l.Clipper.prototype.UpdateEdgeIntoAEL=function(a){null===a.Value.NextInLML&&l.Error("UpdateEdgeIntoAEL: invalid call");var b=a.Value.PrevInAEL,c=a.Value.NextInAEL;a.Value.NextInLML.OutIdx=a.Value.OutIdx;null!==b?b.NextInAEL=a.Value.NextInLML:this.m_ActiveEdges=a.Value.NextInLML;null!==c&&(c.PrevInAEL=a.Value.NextInLML);a.Value.NextInLML.Side=a.Value.Side;a.Value.NextInLML.WindDelta=a.Value.WindDelta;
a.Value.NextInLML.WindCnt=a.Value.WindCnt;a.Value.NextInLML.WindCnt2=a.Value.WindCnt2;a.Value=a.Value.NextInLML;a.Value.Curr.X=a.Value.Bot.X;a.Value.Curr.Y=a.Value.Bot.Y;a.Value.PrevInAEL=b;a.Value.NextInAEL=c;l.ClipperBase.IsHorizontal(a.Value)||this.InsertScanbeam(a.Value.Top.Y)};l.Clipper.prototype.ProcessHorizontals=function(a){for(var b=this.m_SortedEdges;null!==b;)this.DeleteFromSEL(b),this.ProcessHorizontal(b,a),b=this.m_SortedEdges};l.Clipper.prototype.GetHorzDirection=function(a,b,c,d){a.Bot.X<
a.Top.X?(c.Value=a.Bot.X,d.Value=a.Top.X,b.Value=l.Direction.dLeftToRight):(c.Value=a.Top.X,d.Value=a.Bot.X,b.Value=l.Direction.dRightToLeft)};l.Clipper.prototype.PrepareHorzJoins=function(a,b){var c=this.m_PolyOuts[a.OutIdx].Pts;a.Side!=l.EdgeSide.esLeft&&(c=c.Prev);for(var d=0,e=this.m_GhostJoins.length;d<e;++d){var h=this.m_GhostJoins[d];this.HorzSegmentsOverlap(h.OutPt1.Pt,h.OffPt,a.Bot,a.Top)&&this.AddJoin(h.OutPt1,c,h.OffPt)}b&&(l.IntPoint.op_Equality(c.Pt,a.Top)?this.AddGhostJoin(c,a.Bot):
this.AddGhostJoin(c,a.Top))};l.Clipper.prototype.ProcessHorizontal=function(a,b){var c,d,e;(function(){c={Value:c};d={Value:d};e={Value:e};var b=this.GetHorzDirection(a,c,d,e);c=c.Value;d=d.Value;e=e.Value;return b}).call(this);for(var h=a,k=null;null!==h.NextInLML&&l.ClipperBase.IsHorizontal(h.NextInLML);)h=h.NextInLML;for(null===h.NextInLML&&(k=this.GetMaximaPair(h));;){for(var r=a==h,n=this.GetNextInAEL(a,c);null!==n&&!(n.Curr.X==a.Top.X&&null!==a.NextInLML&&n.Dx<a.NextInLML.Dx);){var u=this.GetNextInAEL(n,
c);if(c==l.Direction.dLeftToRight&&n.Curr.X<=e||c==l.Direction.dRightToLeft&&n.Curr.X>=d){0<=a.OutIdx&&0!=a.WindDelta&&this.PrepareHorzJoins(a,b);if(n==k&&r){c==l.Direction.dLeftToRight?this.IntersectEdges(a,n,n.Top,!1):this.IntersectEdges(n,a,n.Top,!1);0<=k.OutIdx&&l.Error("ProcessHorizontal error");return}if(c==l.Direction.dLeftToRight){var v=new l.IntPoint(n.Curr.X,a.Curr.Y);this.IntersectEdges(a,n,v,!0)}else v=new l.IntPoint(n.Curr.X,a.Curr.Y),this.IntersectEdges(n,a,v,!0);this.SwapPositionsInAEL(a,
n)}else if(c==l.Direction.dLeftToRight&&n.Curr.X>=e||c==l.Direction.dRightToLeft&&n.Curr.X<=d)break;n=u}0<=a.OutIdx&&0!==a.WindDelta&&this.PrepareHorzJoins(a,b);if(null!==a.NextInLML&&l.ClipperBase.IsHorizontal(a.NextInLML))(function(){a={Value:a};var b=this.UpdateEdgeIntoAEL(a);a=a.Value;return b}).call(this),0<=a.OutIdx&&this.AddOutPt(a,a.Bot),function(){c={Value:c};d={Value:d};e={Value:e};var b=this.GetHorzDirection(a,c,d,e);c=c.Value;d=d.Value;e=e.Value;return b}.call(this);else break}null!==
a.NextInLML?0<=a.OutIdx?(h=this.AddOutPt(a,a.Top),function(){a={Value:a};var b=this.UpdateEdgeIntoAEL(a);a=a.Value;return b}.call(this),0!==a.WindDelta&&(k=a.PrevInAEL,u=a.NextInAEL,null!==k&&k.Curr.X==a.Bot.X&&k.Curr.Y==a.Bot.Y&&0!==k.WindDelta&&0<=k.OutIdx&&k.Curr.Y>k.Top.Y&&l.ClipperBase.SlopesEqual(a,k,this.m_UseFullRange)?(u=this.AddOutPt(k,a.Bot),this.AddJoin(h,u,a.Top)):null!==u&&u.Curr.X==a.Bot.X&&u.Curr.Y==a.Bot.Y&&0!==u.WindDelta&&0<=u.OutIdx&&u.Curr.Y>u.Top.Y&&l.ClipperBase.SlopesEqual(a,
u,this.m_UseFullRange)&&(u=this.AddOutPt(u,a.Bot),this.AddJoin(h,u,a.Top)))):function(){a={Value:a};var b=this.UpdateEdgeIntoAEL(a);a=a.Value;return b}.call(this):null!==k?0<=k.OutIdx?(c==l.Direction.dLeftToRight?this.IntersectEdges(a,k,a.Top,!1):this.IntersectEdges(k,a,a.Top,!1),0<=k.OutIdx&&l.Error("ProcessHorizontal error")):(this.DeleteFromAEL(a),this.DeleteFromAEL(k)):(0<=a.OutIdx&&this.AddOutPt(a,a.Top),this.DeleteFromAEL(a))};l.Clipper.prototype.GetNextInAEL=function(a,b){return b==l.Direction.dLeftToRight?
a.NextInAEL:a.PrevInAEL};l.Clipper.prototype.IsMinima=function(a){return null!==a&&a.Prev.NextInLML!=a&&a.Next.NextInLML!=a};l.Clipper.prototype.IsMaxima=function(a,b){return null!==a&&a.Top.Y==b&&null===a.NextInLML};l.Clipper.prototype.IsIntermediate=function(a,b){return a.Top.Y==b&&null!==a.NextInLML};l.Clipper.prototype.GetMaximaPair=function(a){var b=null;l.IntPoint.op_Equality(a.Next.Top,a.Top)&&null===a.Next.NextInLML?b=a.Next:l.IntPoint.op_Equality(a.Prev.Top,a.Top)&&null===a.Prev.NextInLML&&
(b=a.Prev);return null===b||-2!=b.OutIdx&&(b.NextInAEL!=b.PrevInAEL||l.ClipperBase.IsHorizontal(b))?b:null};l.Clipper.prototype.ProcessIntersections=function(a,b){if(null==this.m_ActiveEdges)return!0;try{this.BuildIntersectList(a,b);if(0==this.m_IntersectList.length)return!0;if(1==this.m_IntersectList.length||this.FixupIntersectionOrder())this.ProcessIntersectList();else return!1}catch(c){this.m_SortedEdges=null,this.m_IntersectList.length=0,l.Error("ProcessIntersections error")}this.m_SortedEdges=
null;return!0};l.Clipper.prototype.BuildIntersectList=function(a,b){if(null!==this.m_ActiveEdges){var c=this.m_ActiveEdges;for(this.m_SortedEdges=c;null!==c;)c.PrevInSEL=c.PrevInAEL,c.NextInSEL=c.NextInAEL,c.Curr.X=l.Clipper.TopX(c,b),c=c.NextInAEL;for(var d=!0;d&&null!==this.m_SortedEdges;){d=!1;for(c=this.m_SortedEdges;null!==c.NextInSEL;){var e=c.NextInSEL,h=new l.IntPoint;c.Curr.X>e.Curr.X?(h={Value:h},d=this.IntersectPoint(c,e,h),h=h.Value,!d&&c.Curr.X>e.Curr.X+1&&l.Error("Intersection error"),
h.Y>a&&(h.Y=a,Math.abs(c.Dx)>Math.abs(e.Dx)?h.X=l.Clipper.TopX(e,a):h.X=l.Clipper.TopX(c,a)),d=new l.IntersectNode,d.Edge1=c,d.Edge2=e,d.Pt.X=h.X,d.Pt.Y=h.Y,this.m_IntersectList.push(d),this.SwapPositionsInSEL(c,e),d=!0):c=e}if(null!==c.PrevInSEL)c.PrevInSEL.NextInSEL=null;else break}this.m_SortedEdges=null}};l.Clipper.prototype.EdgesAdjacent=function(a){return a.Edge1.NextInSEL==a.Edge2||a.Edge1.PrevInSEL==a.Edge2};l.Clipper.IntersectNodeSort=function(a,b){return b.Pt.Y-a.Pt.Y};l.Clipper.prototype.FixupIntersectionOrder=
function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer);this.CopyAELToSEL();for(var a=this.m_IntersectList.length,b=0;b<a;b++){if(!this.EdgesAdjacent(this.m_IntersectList[b])){for(var c=b+1;c<a&&!this.EdgesAdjacent(this.m_IntersectList[c]);)c++;if(c==a)return!1;var d=this.m_IntersectList[b];this.m_IntersectList[b]=this.m_IntersectList[c];this.m_IntersectList[c]=d}this.SwapPositionsInSEL(this.m_IntersectList[b].Edge1,this.m_IntersectList[b].Edge2)}return!0};l.Clipper.prototype.ProcessIntersectList=
function(){for(var a=0,b=this.m_IntersectList.length;a<b;a++){var c=this.m_IntersectList[a];this.IntersectEdges(c.Edge1,c.Edge2,c.Pt,!0);this.SwapPositionsInAEL(c.Edge1,c.Edge2)}this.m_IntersectList.length=0};O=function(a){return 0>a?Math.ceil(a-.5):Math.round(a)};ea=function(a){return 0>a?Math.ceil(a-.5):Math.floor(a+.5)};ia=function(a){return 0>a?-Math.round(Math.abs(a)):Math.round(a)};A=function(a){if(0>a)return a-=.5,-2147483648>a?Math.ceil(a):a|0;a+=.5;return 2147483647<a?Math.floor(a):a|0};
l.Clipper.Round=P?O:L?ia:X?A:ea;l.Clipper.TopX=function(a,b){return b==a.Top.Y?a.Top.X:a.Bot.X+l.Clipper.Round(a.Dx*(b-a.Bot.Y))};l.Clipper.prototype.IntersectPoint=function(a,b,c){c.Value=new l.IntPoint;var d,e;if(l.ClipperBase.SlopesEqual(a,b,this.m_UseFullRange)||a.Dx==b.Dx)return b.Bot.Y>a.Bot.Y?(c.Value.X=b.Bot.X,c.Value.Y=b.Bot.Y):(c.Value.X=a.Bot.X,c.Value.Y=a.Bot.Y),!1;if(0===a.Delta.X)c.Value.X=a.Bot.X,l.ClipperBase.IsHorizontal(b)?c.Value.Y=b.Bot.Y:(e=b.Bot.Y-b.Bot.X/b.Dx,c.Value.Y=l.Clipper.Round(c.Value.X/
b.Dx+e));else if(0===b.Delta.X)c.Value.X=b.Bot.X,l.ClipperBase.IsHorizontal(a)?c.Value.Y=a.Bot.Y:(d=a.Bot.Y-a.Bot.X/a.Dx,c.Value.Y=l.Clipper.Round(c.Value.X/a.Dx+d));else{d=a.Bot.X-a.Bot.Y*a.Dx;e=b.Bot.X-b.Bot.Y*b.Dx;var h=(e-d)/(a.Dx-b.Dx);c.Value.Y=l.Clipper.Round(h);Math.abs(a.Dx)<Math.abs(b.Dx)?c.Value.X=l.Clipper.Round(a.Dx*h+d):c.Value.X=l.Clipper.Round(b.Dx*h+e)}if(c.Value.Y<a.Top.Y||c.Value.Y<b.Top.Y){if(a.Top.Y>b.Top.Y)return c.Value.Y=a.Top.Y,c.Value.X=l.Clipper.TopX(b,a.Top.Y),c.Value.X<
a.Top.X;c.Value.Y=b.Top.Y;Math.abs(a.Dx)<Math.abs(b.Dx)?c.Value.X=l.Clipper.TopX(a,c.Value.Y):c.Value.X=l.Clipper.TopX(b,c.Value.Y)}return!0};l.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(a){for(var b=this.m_ActiveEdges;null!==b;){var c=this.IsMaxima(b,a);c&&(c=this.GetMaximaPair(b),c=null===c||!l.ClipperBase.IsHorizontal(c));if(c){var d=b.PrevInAEL;this.DoMaxima(b);b=null===d?this.m_ActiveEdges:d.NextInAEL}else this.IsIntermediate(b,a)&&l.ClipperBase.IsHorizontal(b.NextInLML)?(function(){b=
{Value:b};var a=this.UpdateEdgeIntoAEL(b);b=b.Value;return a}.call(this),0<=b.OutIdx&&this.AddOutPt(b,b.Bot),this.AddEdgeToSEL(b)):(b.Curr.X=l.Clipper.TopX(b,a),b.Curr.Y=a),this.StrictlySimple&&(d=b.PrevInAEL,0<=b.OutIdx&&0!==b.WindDelta&&null!==d&&0<=d.OutIdx&&d.Curr.X==b.Curr.X&&0!==d.WindDelta&&(c=this.AddOutPt(d,b.Curr),d=this.AddOutPt(b,b.Curr),this.AddJoin(c,d,b.Curr))),b=b.NextInAEL}this.ProcessHorizontals(!0);for(b=this.m_ActiveEdges;null!==b;){if(this.IsIntermediate(b,a)){c=null;0<=b.OutIdx&&
(c=this.AddOutPt(b,b.Top));(function(){b={Value:b};var a=this.UpdateEdgeIntoAEL(b);b=b.Value;return a}).call(this);var d=b.PrevInAEL,e=b.NextInAEL;null!==d&&d.Curr.X==b.Bot.X&&d.Curr.Y==b.Bot.Y&&null!==c&&0<=d.OutIdx&&d.Curr.Y>d.Top.Y&&l.ClipperBase.SlopesEqual(b,d,this.m_UseFullRange)&&0!==b.WindDelta&&0!==d.WindDelta?(d=this.AddOutPt(d,b.Bot),this.AddJoin(c,d,b.Top)):null!==e&&e.Curr.X==b.Bot.X&&e.Curr.Y==b.Bot.Y&&null!==c&&0<=e.OutIdx&&e.Curr.Y>e.Top.Y&&l.ClipperBase.SlopesEqual(b,e,this.m_UseFullRange)&&
0!==b.WindDelta&&0!==e.WindDelta&&(d=this.AddOutPt(e,b.Bot),this.AddJoin(c,d,b.Top))}b=b.NextInAEL}};l.Clipper.prototype.DoMaxima=function(a){var b=this.GetMaximaPair(a);if(null===b)0<=a.OutIdx&&this.AddOutPt(a,a.Top),this.DeleteFromAEL(a);else{for(var c=a.NextInAEL;null!==c&&c!=b;)this.IntersectEdges(a,c,a.Top,!0),this.SwapPositionsInAEL(a,c),c=a.NextInAEL;-1==a.OutIdx&&-1==b.OutIdx?(this.DeleteFromAEL(a),this.DeleteFromAEL(b)):0<=a.OutIdx&&0<=b.OutIdx?this.IntersectEdges(a,b,a.Top,!1):0===a.WindDelta?
(0<=a.OutIdx&&(this.AddOutPt(a,a.Top),a.OutIdx=-1),this.DeleteFromAEL(a),0<=b.OutIdx&&(this.AddOutPt(b,a.Top),b.OutIdx=-1),this.DeleteFromAEL(b)):l.Error("DoMaxima error")}};l.Clipper.ReversePaths=function(a){for(var b=0,c=a.length;b<c;b++)a[b].reverse()};l.Clipper.Orientation=function(a){return 0<=l.Clipper.Area(a)};l.Clipper.prototype.PointCount=function(a){if(null===a)return 0;var b=0,c=a;do b++,c=c.Next;while(c!=a);return b};l.Clipper.prototype.BuildResult=function(a){l.Clear(a);for(var b=0,c=
this.m_PolyOuts.length;b<c;b++){var d=this.m_PolyOuts[b];if(null!==d.Pts){var d=d.Pts.Prev,e=this.PointCount(d);if(!(2>e)){for(var h=Array(e),k=0;k<e;k++)h[k]=d.Pt,d=d.Prev;a.push(h)}}}};l.Clipper.prototype.BuildResult2=function(a){a.Clear();for(var b=0,c=this.m_PolyOuts.length;b<c;b++){var d=this.m_PolyOuts[b],e=this.PointCount(d.Pts);if(!(d.IsOpen&&2>e||!d.IsOpen&&3>e)){this.FixHoleLinkage(d);var h=new l.PolyNode;a.m_AllPolys.push(h);d.PolyNode=h;h.m_polygon.length=e;for(var d=d.Pts.Prev,k=0;k<
e;k++)h.m_polygon[k]=d.Pt,d=d.Prev}}b=0;for(c=this.m_PolyOuts.length;b<c;b++)d=this.m_PolyOuts[b],null!==d.PolyNode&&(d.IsOpen?(d.PolyNode.IsOpen=!0,a.AddChild(d.PolyNode)):null!==d.FirstLeft&&null!=d.FirstLeft.PolyNode?d.FirstLeft.PolyNode.AddChild(d.PolyNode):a.AddChild(d.PolyNode))};l.Clipper.prototype.FixupOutPolygon=function(a){var b=null;a.BottomPt=null;for(var c=a.Pts;;){if(c.Prev==c||c.Prev==c.Next){this.DisposeOutPts(c);a.Pts=null;return}if(l.IntPoint.op_Equality(c.Pt,c.Next.Pt)||l.IntPoint.op_Equality(c.Pt,
c.Prev.Pt)||l.ClipperBase.SlopesEqual(c.Prev.Pt,c.Pt,c.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(c.Prev.Pt,c.Pt,c.Next.Pt)))b=null,c.Prev.Next=c.Next,c=c.Next.Prev=c.Prev;else if(c==b)break;else null===b&&(b=c),c=c.Next}a.Pts=c};l.Clipper.prototype.DupOutPt=function(a,b){var c=new l.OutPt;c.Pt.X=a.Pt.X;c.Pt.Y=a.Pt.Y;c.Idx=a.Idx;b?(c.Next=a.Next,c.Prev=a,a.Next.Prev=c,a.Next=c):(c.Prev=a.Prev,c.Next=a,a.Prev.Next=c,a.Prev=c);return c};l.Clipper.prototype.GetOverlap=
function(a,b,c,d,e,l){a<b?c<d?(e.Value=Math.max(a,c),l.Value=Math.min(b,d)):(e.Value=Math.max(a,d),l.Value=Math.min(b,c)):c<d?(e.Value=Math.max(b,c),l.Value=Math.min(a,d)):(e.Value=Math.max(b,d),l.Value=Math.min(a,c));return e.Value<l.Value};l.Clipper.prototype.JoinHorz=function(a,b,c,d,e,h){var k=a.Pt.X>b.Pt.X?l.Direction.dRightToLeft:l.Direction.dLeftToRight;d=c.Pt.X>d.Pt.X?l.Direction.dRightToLeft:l.Direction.dLeftToRight;if(k==d)return!1;if(k==l.Direction.dLeftToRight){for(;a.Next.Pt.X<=e.X&&
a.Next.Pt.X>=a.Pt.X&&a.Next.Pt.Y==e.Y;)a=a.Next;h&&a.Pt.X!=e.X&&(a=a.Next);b=this.DupOutPt(a,!h);l.IntPoint.op_Inequality(b.Pt,e)&&(a=b,a.Pt.X=e.X,a.Pt.Y=e.Y,b=this.DupOutPt(a,!h))}else{for(;a.Next.Pt.X>=e.X&&a.Next.Pt.X<=a.Pt.X&&a.Next.Pt.Y==e.Y;)a=a.Next;h||a.Pt.X==e.X||(a=a.Next);b=this.DupOutPt(a,h);l.IntPoint.op_Inequality(b.Pt,e)&&(a=b,a.Pt.X=e.X,a.Pt.Y=e.Y,b=this.DupOutPt(a,h))}if(d==l.Direction.dLeftToRight){for(;c.Next.Pt.X<=e.X&&c.Next.Pt.X>=c.Pt.X&&c.Next.Pt.Y==e.Y;)c=c.Next;h&&c.Pt.X!=
e.X&&(c=c.Next);d=this.DupOutPt(c,!h);l.IntPoint.op_Inequality(d.Pt,e)&&(c=d,c.Pt.X=e.X,c.Pt.Y=e.Y,d=this.DupOutPt(c,!h))}else{for(;c.Next.Pt.X>=e.X&&c.Next.Pt.X<=c.Pt.X&&c.Next.Pt.Y==e.Y;)c=c.Next;h||c.Pt.X==e.X||(c=c.Next);d=this.DupOutPt(c,h);l.IntPoint.op_Inequality(d.Pt,e)&&(c=d,c.Pt.X=e.X,c.Pt.Y=e.Y,d=this.DupOutPt(c,h))}k==l.Direction.dLeftToRight==h?(a.Prev=c,c.Next=a,b.Next=d,d.Prev=b):(a.Next=c,c.Prev=a,b.Prev=d,d.Next=b);return!0};l.Clipper.prototype.JoinPoints=function(a,b,c){var d=a.OutPt1,
e=new l.OutPt,h=a.OutPt2,k=new l.OutPt;if((k=a.OutPt1.Pt.Y==a.OffPt.Y)&&l.IntPoint.op_Equality(a.OffPt,a.OutPt1.Pt)&&l.IntPoint.op_Equality(a.OffPt,a.OutPt2.Pt)){for(e=a.OutPt1.Next;e!=d&&l.IntPoint.op_Equality(e.Pt,a.OffPt);)e=e.Next;e=e.Pt.Y>a.OffPt.Y;for(k=a.OutPt2.Next;k!=h&&l.IntPoint.op_Equality(k.Pt,a.OffPt);)k=k.Next;if(e==k.Pt.Y>a.OffPt.Y)return!1;e?(e=this.DupOutPt(d,!1),k=this.DupOutPt(h,!0),d.Prev=h,h.Next=d,e.Next=k,k.Prev=e):(e=this.DupOutPt(d,!0),k=this.DupOutPt(h,!1),d.Next=h,h.Prev=
d,e.Prev=k,k.Next=e);a.OutPt1=d;a.OutPt2=e;return!0}if(k){for(e=d;d.Prev.Pt.Y==d.Pt.Y&&d.Prev!=e&&d.Prev!=h;)d=d.Prev;for(;e.Next.Pt.Y==e.Pt.Y&&e.Next!=d&&e.Next!=h;)e=e.Next;if(e.Next==d||e.Next==h)return!1;for(k=h;h.Prev.Pt.Y==h.Pt.Y&&h.Prev!=k&&h.Prev!=e;)h=h.Prev;for(;k.Next.Pt.Y==k.Pt.Y&&k.Next!=h&&k.Next!=d;)k=k.Next;if(k.Next==h||k.Next==d)return!1;var n,r;n={Value:n};r={Value:r};b=this.GetOverlap(d.Pt.X,e.Pt.X,h.Pt.X,k.Pt.X,n,r);n=n.Value;r=r.Value;if(!b)return!1;b=new l.IntPoint;d.Pt.X>=
n&&d.Pt.X<=r?(b.X=d.Pt.X,b.Y=d.Pt.Y,c=d.Pt.X>e.Pt.X):h.Pt.X>=n&&h.Pt.X<=r?(b.X=h.Pt.X,b.Y=h.Pt.Y,c=h.Pt.X>k.Pt.X):e.Pt.X>=n&&e.Pt.X<=r?(b.X=e.Pt.X,b.Y=e.Pt.Y,c=e.Pt.X>d.Pt.X):(b.X=k.Pt.X,b.Y=k.Pt.Y,c=k.Pt.X>h.Pt.X);a.OutPt1=d;a.OutPt2=h;return this.JoinHorz(d,e,h,k,b,c)}for(e=d.Next;l.IntPoint.op_Equality(e.Pt,d.Pt)&&e!=d;)e=e.Next;if(n=e.Pt.Y>d.Pt.Y||!l.ClipperBase.SlopesEqual(d.Pt,e.Pt,a.OffPt,this.m_UseFullRange)){for(e=d.Prev;l.IntPoint.op_Equality(e.Pt,d.Pt)&&e!=d;)e=e.Prev;if(e.Pt.Y>d.Pt.Y||
!l.ClipperBase.SlopesEqual(d.Pt,e.Pt,a.OffPt,this.m_UseFullRange))return!1}for(k=h.Next;l.IntPoint.op_Equality(k.Pt,h.Pt)&&k!=h;)k=k.Next;if(r=k.Pt.Y>h.Pt.Y||!l.ClipperBase.SlopesEqual(h.Pt,k.Pt,a.OffPt,this.m_UseFullRange)){for(k=h.Prev;l.IntPoint.op_Equality(k.Pt,h.Pt)&&k!=h;)k=k.Prev;if(k.Pt.Y>h.Pt.Y||!l.ClipperBase.SlopesEqual(h.Pt,k.Pt,a.OffPt,this.m_UseFullRange))return!1}if(e==d||k==h||e==k||b==c&&n==r)return!1;n?(e=this.DupOutPt(d,!1),k=this.DupOutPt(h,!0),d.Prev=h,h.Next=d,e.Next=k,k.Prev=
e):(e=this.DupOutPt(d,!0),k=this.DupOutPt(h,!1),d.Next=h,h.Prev=d,e.Prev=k,k.Next=e);a.OutPt1=d;a.OutPt2=e;return!0};l.Clipper.GetBounds=function(a){for(var b=0,c=a.length;b<c&&0==a[b].length;)b++;if(b==c)return new l.IntRect(0,0,0,0);var d=new l.IntRect;d.left=a[b][0].X;d.right=d.left;d.top=a[b][0].Y;for(d.bottom=d.top;b<c;b++)for(var e=0,h=a[b].length;e<h;e++)a[b][e].X<d.left?d.left=a[b][e].X:a[b][e].X>d.right&&(d.right=a[b][e].X),a[b][e].Y<d.top?d.top=a[b][e].Y:a[b][e].Y>d.bottom&&(d.bottom=a[b][e].Y);
return d};l.Clipper.prototype.GetBounds2=function(a){var b=a,c=new l.IntRect;c.left=a.Pt.X;c.right=a.Pt.X;c.top=a.Pt.Y;c.bottom=a.Pt.Y;for(a=a.Next;a!=b;)a.Pt.X<c.left&&(c.left=a.Pt.X),a.Pt.X>c.right&&(c.right=a.Pt.X),a.Pt.Y<c.top&&(c.top=a.Pt.Y),a.Pt.Y>c.bottom&&(c.bottom=a.Pt.Y),a=a.Next;return c};l.ClipperBase.prototype.PointInPolygon=l.Clipper.prototype.PointInPolygon=function(){var b=arguments,c=b.length;if(2==c){for(var c=b[0],d=b[1],b=0,e=d;;){var l=d.Pt.X,h=d.Pt.Y,k=d.Next.Pt.X,n=d.Next.Pt.Y;
if(n==c.Y&&(k==c.X||h==c.Y&&k>c.X==l<c.X))return-1;if(h<c.Y!=n<c.Y)if(l>=c.X)if(k>c.X)b=1-b;else{l=(l-c.X)*(n-c.Y)-(k-c.X)*(h-c.Y);if(0==l)return-1;0<l==n>h&&(b=1-b)}else if(k>c.X){l=(l-c.X)*(n-c.Y)-(k-c.X)*(h-c.Y);if(0==l)return-1;0<l==n>h&&(b=1-b)}d=d.Next;if(e==d)break}return b}if(3==c){c=b[0];d=b[1];e=b[2];h=d;b=!1;if(e){do h.Pt.Y>c.Y!=h.Prev.Pt.Y>c.Y&&a.op_LessThan(new a(c.X-h.Pt.X),a.op_Division(a.Int128Mul(h.Prev.Pt.X-h.Pt.X,c.Y-h.Pt.Y),new a(h.Prev.Pt.Y-h.Pt.Y)))&&(b=!b),h=h.Next;while(h!=
d)}else{do h.Pt.Y>c.Y!=h.Prev.Pt.Y>c.Y&&c.X-h.Pt.X<(h.Prev.Pt.X-h.Pt.X)*(c.Y-h.Pt.Y)/(h.Prev.Pt.Y-h.Pt.Y)&&(b=!b),h=h.Next;while(h!=d)}return b}};l.Clipper.prototype.Poly2ContainsPoly1=function(a,b){var c=a;do{var d=this.PointInPolygon(c.Pt,b);if(0<=d)return 0!=d;c=c.Next}while(c!=a);return!0};l.Clipper.prototype.FixupFirstLefts1=function(a,b){for(var c=0,d=this.m_PolyOuts.length;c<d;c++){var e=this.m_PolyOuts[c];null!==e.Pts&&e.FirstLeft==a&&this.Poly2ContainsPoly1(e.Pts,b.Pts)&&(e.FirstLeft=b)}};
l.Clipper.prototype.FixupFirstLefts2=function(a,b){for(var c=0,d=this.m_PolyOuts,e=d.length,h=d[c];c<e;c++,h=d[c])h.FirstLeft==a&&(h.FirstLeft=b)};l.Clipper.ParseFirstLeft=function(a){for(;null!=a&&null==a.Pts;)a=a.FirstLeft;return a};l.Clipper.prototype.JoinCommonEdges=function(){for(var a=0,b=this.m_Joins.length;a<b;a++){var c=this.m_Joins[a],d=this.GetOutRec(c.OutPt1.Idx),e=this.GetOutRec(c.OutPt2.Idx);if(null!=d.Pts&&null!=e.Pts){var h;h=d==e?d:this.Param1RightOfParam2(d,e)?e:this.Param1RightOfParam2(e,
d)?d:this.GetLowermostRec(d,e);if(this.JoinPoints(c,d,e))if(d==e){d.Pts=c.OutPt1;d.BottomPt=null;e=this.CreateOutRec();e.Pts=c.OutPt2;this.UpdateOutPtIdxs(e);if(this.m_UsingPolyTree){h=0;for(var k=this.m_PolyOuts.length;h<k-1;h++){var n=this.m_PolyOuts[h];null!=n.Pts&&l.Clipper.ParseFirstLeft(n.FirstLeft)==d&&n.IsHole!=d.IsHole&&this.Poly2ContainsPoly1(n.Pts,c.OutPt2)&&(n.FirstLeft=e)}}this.Poly2ContainsPoly1(e.Pts,d.Pts)?(e.IsHole=!d.IsHole,e.FirstLeft=d,this.m_UsingPolyTree&&this.FixupFirstLefts2(e,
d),(e.IsHole^this.ReverseSolution)==0<this.Area(e)&&this.ReversePolyPtLinks(e.Pts)):this.Poly2ContainsPoly1(d.Pts,e.Pts)?(e.IsHole=d.IsHole,d.IsHole=!e.IsHole,e.FirstLeft=d.FirstLeft,d.FirstLeft=e,this.m_UsingPolyTree&&this.FixupFirstLefts2(d,e),(d.IsHole^this.ReverseSolution)==0<this.Area(d)&&this.ReversePolyPtLinks(d.Pts)):(e.IsHole=d.IsHole,e.FirstLeft=d.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(d,e))}else e.Pts=null,e.BottomPt=null,e.Idx=d.Idx,d.IsHole=h.IsHole,h==e&&(d.FirstLeft=
e.FirstLeft),e.FirstLeft=d,this.m_UsingPolyTree&&this.FixupFirstLefts2(e,d)}}};l.Clipper.prototype.UpdateOutPtIdxs=function(a){var b=a.Pts;do b.Idx=a.Idx,b=b.Prev;while(b!=a.Pts)};l.Clipper.prototype.DoSimplePolygons=function(){for(var a=0;a<this.m_PolyOuts.length;){var b=this.m_PolyOuts[a++],c=b.Pts;if(null!==c){do{for(var d=c.Next;d!=b.Pts;){if(l.IntPoint.op_Equality(c.Pt,d.Pt)&&d.Next!=c&&d.Prev!=c){var e=c.Prev,h=d.Prev;c.Prev=h;h.Next=c;d.Prev=e;e.Next=d;b.Pts=c;e=this.CreateOutRec();e.Pts=d;
this.UpdateOutPtIdxs(e);this.Poly2ContainsPoly1(e.Pts,b.Pts)?(e.IsHole=!b.IsHole,e.FirstLeft=b):this.Poly2ContainsPoly1(b.Pts,e.Pts)?(e.IsHole=b.IsHole,b.IsHole=!e.IsHole,e.FirstLeft=b.FirstLeft,b.FirstLeft=e):(e.IsHole=b.IsHole,e.FirstLeft=b.FirstLeft);d=c}d=d.Next}c=c.Next}while(c!=b.Pts)}}};l.Clipper.Area=function(a){var b=a.length;if(3>b)return 0;for(var c=0,d=0,e=b-1;d<b;++d)c+=(a[e].X+a[d].X)*(a[e].Y-a[d].Y),e=d;return.5*-c};l.Clipper.prototype.Area=function(a){var b=a.Pts;if(null==b)return 0;
var c=0;do c+=(b.Prev.Pt.X+b.Pt.X)*(b.Prev.Pt.Y-b.Pt.Y),b=b.Next;while(b!=a.Pts);return.5*c};l.Clipper.SimplifyPolygon=function(a,b){var c=[],d=new l.Clipper(0);d.StrictlySimple=!0;d.AddPath(a,l.PolyType.ptSubject,!0);d.Execute(l.ClipType.ctUnion,c,b,b);return c};l.Clipper.SimplifyPolygons=function(a,b){"undefined"==typeof b&&(b=l.PolyFillType.pftEvenOdd);var c=[],d=new l.Clipper(0);d.StrictlySimple=!0;d.AddPaths(a,l.PolyType.ptSubject,!0);d.Execute(l.ClipType.ctUnion,c,b,b);return c};l.Clipper.DistanceSqrd=
function(a,b){var c=a.X-b.X,d=a.Y-b.Y;return c*c+d*d};l.Clipper.DistanceFromLineSqrd=function(a,b,c){var d=b.Y-c.Y;c=c.X-b.X;b=d*b.X+c*b.Y;b=d*a.X+c*a.Y-b;return b*b/(d*d+c*c)};l.Clipper.SlopesNearCollinear=function(a,b,c,d){return l.Clipper.DistanceFromLineSqrd(b,a,c)<d};l.Clipper.PointsAreClose=function(a,b,c){var d=a.X-b.X;a=a.Y-b.Y;return d*d+a*a<=c};l.Clipper.ExcludeOp=function(a){var b=a.Prev;b.Next=a.Next;a.Next.Prev=b;b.Idx=0;return b};l.Clipper.CleanPolygon=function(a,b){"undefined"==typeof b&&
(b=1.415);var c=a.length;if(0==c)return[];for(var d=Array(c),e=0;e<c;++e)d[e]=new l.OutPt;for(e=0;e<c;++e)d[e].Pt=a[e],d[e].Next=d[(e+1)%c],d[e].Next.Prev=d[e],d[e].Idx=0;e=b*b;for(d=d[0];0==d.Idx&&d.Next!=d.Prev;)l.Clipper.PointsAreClose(d.Pt,d.Prev.Pt,e)?(d=l.Clipper.ExcludeOp(d),c--):l.Clipper.PointsAreClose(d.Prev.Pt,d.Next.Pt,e)?(l.Clipper.ExcludeOp(d.Next),d=l.Clipper.ExcludeOp(d),c-=2):l.Clipper.SlopesNearCollinear(d.Prev.Pt,d.Pt,d.Next.Pt,e)?(d=l.Clipper.ExcludeOp(d),c--):(d.Idx=1,d=d.Next);
3>c&&(c=0);for(var h=Array(c),e=0;e<c;++e)h[e]=new l.IntPoint(d.Pt),d=d.Next;return h};l.Clipper.CleanPolygons=function(a,b){for(var c=Array(a.length),d=0,e=a.length;d<e;d++)c[d]=l.Clipper.CleanPolygon(a[d],b);return c};l.Clipper.Minkowski=function(a,b,c,d){var e=d?1:0,h=a.length,k=b.length;d=[];if(c)for(c=0;c<k;c++){for(var n=Array(h),r=0,u=a.length,v=a[r];r<u;r++,v=a[r])n[r]=new l.IntPoint(b[c].X+v.X,b[c].Y+v.Y);d.push(n)}else for(c=0;c<k;c++){n=Array(h);r=0;u=a.length;for(v=a[r];r<u;r++,v=a[r])n[r]=
new l.IntPoint(b[c].X-v.X,b[c].Y-v.Y);d.push(n)}a=[];for(c=0;c<=k-2+e;c++)for(r=0;r<=h-1;r++)b=[],b.push(d[c%k][r%h]),b.push(d[(c+1)%k][r%h]),b.push(d[(c+1)%k][(r+1)%h]),b.push(d[c%k][(r+1)%h]),l.Clipper.Orientation(b)||b.reverse(),a.push(b);e=new l.Clipper(0);e.AddPaths(a,l.PolyType.ptSubject,!0);e.Execute(l.ClipType.ctUnion,d,l.PolyFillType.pftNonZero,l.PolyFillType.pftNonZero);return d};l.Clipper.MinkowskiSum=function(a,b,c){return l.Clipper.Minkowski(a,b,!0,c)};l.Clipper.MinkowskiDiff=function(a,
b,c){return l.Clipper.Minkowski(a,b,!1,c)};l.Clipper.PolyTreeToPaths=function(a){var b=[];l.Clipper.AddPolyNodeToPaths(a,l.Clipper.NodeType.ntAny,b);return b};l.Clipper.AddPolyNodeToPaths=function(a,b,c){var d=!0;switch(b){case l.Clipper.NodeType.ntOpen:return;case l.Clipper.NodeType.ntClosed:d=!a.IsOpen}0<a.m_polygon.length&&d&&c.push(a.m_polygon);d=0;a=a.Childs();for(var e=a.length,h=a[d];d<e;d++,h=a[d])l.Clipper.AddPolyNodeToPaths(h,b,c)};l.Clipper.OpenPathsFromPolyTree=function(a){for(var b=new l.Paths,
c=0,d=a.ChildCount();c<d;c++)a.Childs()[c].IsOpen&&b.push(a.Childs()[c].m_polygon);return b};l.Clipper.ClosedPathsFromPolyTree=function(a){var b=new l.Paths;l.Clipper.AddPolyNodeToPaths(a,l.Clipper.NodeType.ntClosed,b);return b};ma(l.Clipper,l.ClipperBase);l.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2};l.ClipperOffset=function(a,b){"undefined"==typeof a&&(a=2);"undefined"==typeof b&&(b=l.ClipperOffset.def_arc_tolerance);this.m_destPolys=new l.Paths;this.m_srcPoly=new l.Path;this.m_destPoly=new l.Path;
this.m_normals=[];this.m_StepsPerRad=this.m_miterLim=this.m_cos=this.m_sin=this.m_sinA=this.m_delta=0;this.m_lowest=new l.IntPoint;this.m_polyNodes=new l.PolyNode;this.MiterLimit=a;this.ArcTolerance=b;this.m_lowest.X=-1};l.ClipperOffset.two_pi=6.28318530717959;l.ClipperOffset.def_arc_tolerance=.25;l.ClipperOffset.prototype.Clear=function(){l.Clear(this.m_polyNodes.Childs());this.m_lowest.X=-1};l.ClipperOffset.Round=l.Clipper.Round;l.ClipperOffset.prototype.AddPath=function(a,b,c){var d=a.length-1;
if(!(0>d)){var e=new l.PolyNode;e.m_jointype=b;e.m_endtype=c;if(c==l.EndType.etClosedLine||c==l.EndType.etClosedPolygon)for(;0<d&&l.IntPoint.op_Equality(a[0],a[d]);)d--;e.m_polygon.push(a[0]);var h=0;b=0;for(var k=1;k<=d;k++)l.IntPoint.op_Inequality(e.m_polygon[h],a[k])&&(h++,e.m_polygon.push(a[k]),a[k].Y>e.m_polygon[b].Y||a[k].Y==e.m_polygon[b].Y&&a[k].X<e.m_polygon[b].X)&&(b=h);if(!(c==l.EndType.etClosedPolygon&&2>h||c!=l.EndType.etClosedPolygon&&0>h)&&(this.m_polyNodes.AddChild(e),c==l.EndType.etClosedPolygon))if(0>
this.m_lowest.X)this.m_lowest=new l.IntPoint(0,b);else if(a=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],e.m_polygon[b].Y>a.Y||e.m_polygon[b].Y==a.Y&&e.m_polygon[b].X<a.X)this.m_lowest=new l.IntPoint(this.m_polyNodes.ChildCount()-1,b)}};l.ClipperOffset.prototype.AddPaths=function(a,b,c){for(var d=0,e=a.length;d<e;d++)this.AddPath(a[d],b,c)};l.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!l.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var a=
0;a<this.m_polyNodes.ChildCount();a++){var b=this.m_polyNodes.Childs()[a];(b.m_endtype==l.EndType.etClosedPolygon||b.m_endtype==l.EndType.etClosedLine&&l.Clipper.Orientation(b.m_polygon))&&b.m_polygon.reverse()}else for(a=0;a<this.m_polyNodes.ChildCount();a++)b=this.m_polyNodes.Childs()[a],b.m_endtype!=l.EndType.etClosedLine||l.Clipper.Orientation(b.m_polygon)||b.m_polygon.reverse()};l.ClipperOffset.GetUnitNormal=function(a,b){var c=b.X-a.X,d=b.Y-a.Y;if(0==c&&0==d)return new l.DoublePoint(0,0);var e=
1/Math.sqrt(c*c+d*d);return new l.DoublePoint(d*e,-(c*e))};l.ClipperOffset.prototype.DoOffset=function(a){this.m_destPolys=[];this.m_delta=a;if(l.ClipperBase.near_zero(a))for(var b=0;b<this.m_polyNodes.ChildCount();b++){var c=this.m_polyNodes.Childs()[b];c.m_endtype==l.EndType.etClosedPolygon&&this.m_destPolys.push(c.m_polygon)}else{this.m_miterLim=2<this.MiterLimit?2/(this.MiterLimit*this.MiterLimit):.5;var b=0>=this.ArcTolerance?l.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(a)*l.ClipperOffset.def_arc_tolerance?
Math.abs(a)*l.ClipperOffset.def_arc_tolerance:this.ArcTolerance,d=3.14159265358979/Math.acos(1-b/Math.abs(a));this.m_sin=Math.sin(l.ClipperOffset.two_pi/d);this.m_cos=Math.cos(l.ClipperOffset.two_pi/d);this.m_StepsPerRad=d/l.ClipperOffset.two_pi;0>a&&(this.m_sin=-this.m_sin);for(b=0;b<this.m_polyNodes.ChildCount();b++){c=this.m_polyNodes.Childs()[b];this.m_srcPoly=c.m_polygon;var e=this.m_srcPoly.length;if(!(0==e||0>=a&&(3>e||c.m_endtype!=l.EndType.etClosedPolygon))){this.m_destPoly=[];if(1==e)if(c.m_jointype==
l.JoinType.jtRound)for(var c=1,e=0,h=1;h<=d;h++){this.m_destPoly.push(new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[0].X+c*a),l.ClipperOffset.Round(this.m_srcPoly[0].Y+e*a)));var k=c,c=c*this.m_cos-this.m_sin*e,e=k*this.m_sin+e*this.m_cos}else for(e=c=-1,h=0;4>h;++h)this.m_destPoly.push(new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[0].X+c*a),l.ClipperOffset.Round(this.m_srcPoly[0].Y+e*a))),0>c?c=1:0>e?e=1:c=-1;else{for(h=this.m_normals.length=0;h<e-1;h++)this.m_normals.push(l.ClipperOffset.GetUnitNormal(this.m_srcPoly[h],
this.m_srcPoly[h+1]));c.m_endtype==l.EndType.etClosedLine||c.m_endtype==l.EndType.etClosedPolygon?this.m_normals.push(l.ClipperOffset.GetUnitNormal(this.m_srcPoly[e-1],this.m_srcPoly[0])):this.m_normals.push(new l.DoublePoint(this.m_normals[e-2]));if(c.m_endtype==l.EndType.etClosedPolygon)for(k=e-1,h=0;h<e;h++)k=this.OffsetPoint(h,k,c.m_jointype);else if(c.m_endtype==l.EndType.etClosedLine){k=e-1;for(h=0;h<e;h++)k=this.OffsetPoint(h,k,c.m_jointype);this.m_destPolys.push(this.m_destPoly);this.m_destPoly=
[];k=this.m_normals[e-1];for(h=e-1;0<h;h--)this.m_normals[h]=new l.DoublePoint(-this.m_normals[h-1].X,-this.m_normals[h-1].Y);this.m_normals[0]=new l.DoublePoint(-k.X,-k.Y);k=0;for(h=e-1;0<=h;h--)k=this.OffsetPoint(h,k,c.m_jointype)}else{k=0;for(h=1;h<e-1;++h)k=this.OffsetPoint(h,k,c.m_jointype);c.m_endtype==l.EndType.etOpenButt?(h=e-1,k=new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[h].X+this.m_normals[h].X*a),l.ClipperOffset.Round(this.m_srcPoly[h].Y+this.m_normals[h].Y*a)),this.m_destPoly.push(k),
k=new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[h].X-this.m_normals[h].X*a),l.ClipperOffset.Round(this.m_srcPoly[h].Y-this.m_normals[h].Y*a)),this.m_destPoly.push(k)):(h=e-1,k=e-2,this.m_sinA=0,this.m_normals[h]=new l.DoublePoint(-this.m_normals[h].X,-this.m_normals[h].Y),c.m_endtype==l.EndType.etOpenSquare?this.DoSquare(h,k):this.DoRound(h,k));for(h=e-1;0<h;h--)this.m_normals[h]=new l.DoublePoint(-this.m_normals[h-1].X,-this.m_normals[h-1].Y);this.m_normals[0]=new l.DoublePoint(-this.m_normals[1].X,
-this.m_normals[1].Y);k=e-1;for(h=k-1;0<h;--h)k=this.OffsetPoint(h,k,c.m_jointype);c.m_endtype==l.EndType.etOpenButt?(k=new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*a),l.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*a)),this.m_destPoly.push(k),k=new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*a),l.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*a)),this.m_destPoly.push(k)):(this.m_sinA=0,c.m_endtype==l.EndType.etOpenSquare?
this.DoSquare(0,1):this.DoRound(0,1))}}this.m_destPolys.push(this.m_destPoly)}}}};l.ClipperOffset.prototype.Execute=function(){var a=arguments;if(a[0]instanceof l.PolyTree)if(b=a[0],c=a[1],b.Clear(),this.FixOrientations(),this.DoOffset(c),a=new l.Clipper(0),a.AddPaths(this.m_destPolys,l.PolyType.ptSubject,!0),0<c)a.Execute(l.ClipType.ctUnion,b,l.PolyFillType.pftPositive,l.PolyFillType.pftPositive);else if(c=l.Clipper.GetBounds(this.m_destPolys),d=new l.Path,d.push(new l.IntPoint(c.left-10,c.bottom+
10)),d.push(new l.IntPoint(c.right+10,c.bottom+10)),d.push(new l.IntPoint(c.right+10,c.top-10)),d.push(new l.IntPoint(c.left-10,c.top-10)),a.AddPath(d,l.PolyType.ptSubject,!0),a.ReverseSolution=!0,a.Execute(l.ClipType.ctUnion,b,l.PolyFillType.pftNegative,l.PolyFillType.pftNegative),1==b.ChildCount()&&0<b.Childs()[0].ChildCount())for(a=b.Childs()[0],b.Childs()[0]=a.Childs()[0],c=1;c<a.ChildCount();c++)b.AddChild(a.Childs()[c]);else b.Clear();else{var b=a[0],c=a[1];l.Clear(b);this.FixOrientations();
this.DoOffset(c);a=new l.Clipper(0);a.AddPaths(this.m_destPolys,l.PolyType.ptSubject,!0);if(0<c)a.Execute(l.ClipType.ctUnion,b,l.PolyFillType.pftPositive,l.PolyFillType.pftPositive);else{var c=l.Clipper.GetBounds(this.m_destPolys),d=new l.Path;d.push(new l.IntPoint(c.left-10,c.bottom+10));d.push(new l.IntPoint(c.right+10,c.bottom+10));d.push(new l.IntPoint(c.right+10,c.top-10));d.push(new l.IntPoint(c.left-10,c.top-10));a.AddPath(d,l.PolyType.ptSubject,!0);a.ReverseSolution=!0;a.Execute(l.ClipType.ctUnion,
b,l.PolyFillType.pftNegative,l.PolyFillType.pftNegative);0<b.length&&b.splice(0,1)}}};l.ClipperOffset.prototype.OffsetPoint=function(a,b,c){this.m_sinA=this.m_normals[b].X*this.m_normals[a].Y-this.m_normals[a].X*this.m_normals[b].Y;if(5E-5>this.m_sinA&&-5E-5<this.m_sinA)return b;1<this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1);if(0>this.m_sinA*this.m_delta)this.m_destPoly.push(new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[a].X+this.m_normals[b].X*this.m_delta),l.ClipperOffset.Round(this.m_srcPoly[a].Y+
this.m_normals[b].Y*this.m_delta))),this.m_destPoly.push(new l.IntPoint(this.m_srcPoly[a])),this.m_destPoly.push(new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[a].X+this.m_normals[a].X*this.m_delta),l.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_normals[a].Y*this.m_delta)));else switch(c){case l.JoinType.jtMiter:c=1+(this.m_normals[a].X*this.m_normals[b].X+this.m_normals[a].Y*this.m_normals[b].Y);c>=this.m_miterLim?this.DoMiter(a,b,c):this.DoSquare(a,b);break;case l.JoinType.jtSquare:this.DoSquare(a,
b);break;case l.JoinType.jtRound:this.DoRound(a,b)}return a};l.ClipperOffset.prototype.DoSquare=function(a,b){var c=Math.tan(Math.atan2(this.m_sinA,this.m_normals[b].X*this.m_normals[a].X+this.m_normals[b].Y*this.m_normals[a].Y)/4);this.m_destPoly.push(new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[a].X+this.m_delta*(this.m_normals[b].X-this.m_normals[b].Y*c)),l.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_delta*(this.m_normals[b].Y+this.m_normals[b].X*c))));this.m_destPoly.push(new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[a].X+
this.m_delta*(this.m_normals[a].X+this.m_normals[a].Y*c)),l.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_delta*(this.m_normals[a].Y-this.m_normals[a].X*c))))};l.ClipperOffset.prototype.DoMiter=function(a,b,c){c=this.m_delta/c;this.m_destPoly.push(new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[a].X+(this.m_normals[b].X+this.m_normals[a].X)*c),l.ClipperOffset.Round(this.m_srcPoly[a].Y+(this.m_normals[b].Y+this.m_normals[a].Y)*c)))};l.ClipperOffset.prototype.DoRound=function(a,b){for(var c=Math.atan2(this.m_sinA,
this.m_normals[b].X*this.m_normals[a].X+this.m_normals[b].Y*this.m_normals[a].Y),c=l.Cast_Int32(l.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(c))),d=this.m_normals[b].X,e=this.m_normals[b].Y,h,k=0;k<c;++k)this.m_destPoly.push(new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[a].X+d*this.m_delta),l.ClipperOffset.Round(this.m_srcPoly[a].Y+e*this.m_delta))),h=d,d=d*this.m_cos-this.m_sin*e,e=h*this.m_sin+e*this.m_cos;this.m_destPoly.push(new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[a].X+
this.m_normals[a].X*this.m_delta),l.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_normals[a].Y*this.m_delta)))};l.Error=function(a){try{throw Error(a);}catch(b){alert(b.message)}};l.JS={};l.JS.AreaOfPolygon=function(a,b){b||(b=1);return l.Clipper.Area(a)/(b*b)};l.JS.AreaOfPolygons=function(a,b){b||(b=1);for(var c=0,d=0;d<a.length;d++)c+=l.Clipper.Area(a[d]);return c/(b*b)};l.JS.BoundsOfPath=function(a,b){return l.JS.BoundsOfPaths([a],b)};l.JS.BoundsOfPaths=function(a,b){b||(b=1);var c=l.Clipper.GetBounds(a);
c.left/=b;c.bottom/=b;c.right/=b;c.top/=b;return c};l.JS.Clean=function(a,b){if(!(a instanceof Array))return[];var c=a[0]instanceof Array;a=l.JS.Clone(a);if("number"!=typeof b||null===b)return l.Error("Delta is not a number in Clean()."),a;if(0===a.length||1==a.length&&0===a[0].length||0>b)return a;c||(a=[a]);for(var d=a.length,e,h,k,n,r,u,v,w=[],y=0;y<d;y++)if(h=a[y],e=h.length,0!==e)if(3>e)k=h,w.push(k);else{k=h;n=b*b;r=h[0];for(v=u=1;v<e;v++)(h[v].X-r.X)*(h[v].X-r.X)+(h[v].Y-r.Y)*(h[v].Y-r.Y)<=
n||(k[u]=h[v],r=h[v],u++);r=h[u-1];(h[0].X-r.X)*(h[0].X-r.X)+(h[0].Y-r.Y)*(h[0].Y-r.Y)<=n&&u--;u<e&&k.splice(u,e-u);k.length&&w.push(k)}!c&&w.length?w=w[0]:c||0!==w.length?c&&0===w.length&&(w=[[]]):w=[];return w};l.JS.Clone=function(a){if(!(a instanceof Array)||0===a.length)return[];if(1==a.length&&0===a[0].length)return[[]];var b=a[0]instanceof Array;b||(a=[a]);var c=a.length,d,e,h,l,k=Array(c);for(e=0;e<c;e++){d=a[e].length;l=Array(d);for(h=0;h<d;h++)l[h]={X:a[e][h].X,Y:a[e][h].Y};k[e]=l}b||(k=
k[0]);return k};l.JS.Lighten=function(a,b){if(!(a instanceof Array))return[];if("number"!=typeof b||null===b)return l.Error("Tolerance is not a number in Lighten()."),l.JS.Clone(a);if(0===a.length||1==a.length&&0===a[0].length||0>b)return l.JS.Clone(a);a[0]instanceof Array||(a=[a]);var c,d,e,h,k,r,n,u,v,w,y,A,C,E,F,H=a.length,J=b*b,L=[];for(c=0;c<H;c++)if(e=a[c],r=e.length,0!=r){for(h=0;1E6>h;h++){k=[];r=e.length;e[r-1].X!=e[0].X||e[r-1].Y!=e[0].Y?(y=1,e.push({X:e[0].X,Y:e[0].Y}),r=e.length):y=0;
w=[];for(d=0;d<r-2;d++){n=e[d];v=e[d+1];u=e[d+2];E=n.X;F=n.Y;n=u.X-E;A=u.Y-F;if(0!==n||0!==A)C=((v.X-E)*n+(v.Y-F)*A)/(n*n+A*A),1<C?(E=u.X,F=u.Y):0<C&&(E+=n*C,F+=A*C);n=v.X-E;A=v.Y-F;u=n*n+A*A;u<=J&&(w[d+1]=1,d++)}k.push({X:e[0].X,Y:e[0].Y});for(d=1;d<r-1;d++)w[d]||k.push({X:e[d].X,Y:e[d].Y});k.push({X:e[r-1].X,Y:e[r-1].Y});y&&e.pop();if(w.length)e=k;else break}r=k.length;k[r-1].X==k[0].X&&k[r-1].Y==k[0].Y&&k.pop();2<k.length&&L.push(k)}a[0]instanceof Array||(L=L[0]);"undefined"==typeof L&&(L=[[]]);
return L};l.JS.PerimeterOfPath=function(a,b,c){if("undefined"==typeof a)return 0;var d=Math.sqrt,e=0,h,l,k=0,r=0,n=a.length;if(2>n)return 0;for(b&&(a[n]=a[0],n++);--n;)h=a[n],k=h.X,h=h.Y,l=a[n-1],r=l.X,l=l.Y,e+=d((k-r)*(k-r)+(h-l)*(h-l));b&&a.pop();return e/c};l.JS.PerimeterOfPaths=function(a,b,c){c||(c=1);for(var d=0,e=0;e<a.length;e++)d+=l.JS.PerimeterOfPath(a[e],b,c);return d};l.JS.ScaleDownPath=function(a,b){var c,d;b||(b=1);for(c=a.length;c--;)d=a[c],d.X/=b,d.Y/=b};l.JS.ScaleDownPaths=function(a,
b){var c,d,e;b||(b=1);for(c=a.length;c--;)for(d=a[c].length;d--;)e=a[c][d],e.X/=b,e.Y/=b};l.JS.ScaleUpPath=function(a,b){var c,d,e=Math.round;b||(b=1);for(c=a.length;c--;)d=a[c],d.X=e(d.X*b),d.Y=e(d.Y*b)};l.JS.ScaleUpPaths=function(a,b){var c,d,e,h=Math.round;b||(b=1);for(c=a.length;c--;)for(d=a[c].length;d--;)e=a[c][d],e.X=h(e.X*b),e.Y=h(e.Y*b)};l.ExPolygons=function(){return[]};l.ExPolygon=function(){this.holes=this.outer=null};l.JS.AddOuterPolyNodeToExPolygons=function(a,b){var c=new l.ExPolygon;
c.outer=a.Contour();var d=a.Childs(),e=d.length;c.holes=Array(e);var h,k,n,r,u;for(k=0;k<e;k++)for(h=d[k],c.holes[k]=h.Contour(),n=0,r=h.Childs(),u=r.length;n<u;n++)h=r[n],l.JS.AddOuterPolyNodeToExPolygons(h,b);b.push(c)};l.JS.ExPolygonsToPaths=function(a){var b,c,d,e,h=new l.Paths;b=0;for(d=a.length;b<d;b++)for(h.push(a[b].outer),c=0,e=a[b].holes.length;c<e;c++)h.push(a[b].holes[c]);return h};l.JS.PolyTreeToExPolygons=function(a){var b=new l.ExPolygons,c,d,e;c=0;d=a.Childs();for(e=d.length;c<e;c++)a=
d[c],l.JS.AddOuterPolyNodeToExPolygons(a,b);return b}})();
var createCindy=function(){function a(a){if(0===d)return console.error("Waiting for "+a+" after we finished waiting."),function(){};0>d&&(d=0);++d;return function(){--d;0>d&&console.error("Wait count mismatch: "+a);if(0===d)for(var b=0,e=c.length;b<e;)c[b++].startup()}}function b(a){var e=b.newInstance(a);0>=d?e.startup():!1!==a.autostart&&c.push(e);return e}var d=-1,c=[];"undefined"===typeof document||"undefined"===typeof window||"undefined"===typeof document.addEventListener||"undefined"!==typeof window.cindyDontWait&&
!0===window.cindyDontWait||document.addEventListener("DOMContentLoaded",a("DOMContentLoaded"));"undefined"!==typeof window&&"undefined"!==typeof window.__gwt_activeModules&&(Object.keys(window.__gwt_activeModules).forEach(function(b){b=window.__gwt_activeModules[b];b.cindyDoneWaiting=a(b.moduleName)}),window.__gwtStatsEvent=function(a){"moduleStartup"===a.evtGroup&&"end"===a.type&&window.__gwt_activeModules[a.moduleName].cindyDoneWaiting()});var k=null,e=null,h={};b.getBaseDir=function(){if(null!==
k)return k;for(var a=document.getElementsByTagName("script"),b=0;b<a.length;++b){var c=a[b],d=c.src;if(d){var h=/Cindy\.js$/.exec(d);if(h)return k=d.substr(0,h.index),console.log("Will load extensions from "+k),e=c,k}}console.error("Could not find <script> tag for Cindy.js");return k=e=!1};b.loadScript=function(a,c,d,k){if(window[a])return d(),!0;k||(k=console.error.bind(console));var w=b.getBaseDir();if(!1===w)return k("Can't load additional components."),!1;var y=h[a];y||(y=document.createElement("script"),
y.src=w+c,c=e.nextSibling,w=e.parentElement,c?w.insertBefore(y,c):w.appendChild(y),h[a]=y);y.addEventListener("load",d);y.addEventListener("error",k);return null};b.waitFor=a;b._pluginRegistry={};b.instances=[];b.registerPlugin=function(a,c,d){if(1!==a)return console.error("Plugin API version "+a+" not supported"),!1;b._pluginRegistry[c]=d};b.newInstance=function(a){var b,c,d,e,h,k;function C(f){if(f){for(var a=0;a<f.length;a++){var p=f[a],b=Object.keys(p)[0];"scale"===b&&(jb=p.scale,D[b](p.scale));
if("translate"===b)D[b](p.translate[0],p.translate[1]);"scaleAndOrigin"===b&&(jb=p[b][0]/25,D[b].apply(null,p[b]));"visibleRect"===b&&(D[b].apply(null,p[b]),jb=D.drawingstate.initialmatrix.a/25)}D.createnewbackup()}}function H(){ub=!0;if(0===kb){void 0!==a.csconsole&&(ya=a.csconsole);"object"===typeof ya&&null===ya?ya=new A:"boolean"===typeof ya&&!0===ya?ya=new X:"string"===typeof ya&&(ya=new ea(ya));"undefined"===typeof ya&&(ya=new ia);fb=[100,100];var f,Z=null,p=a.transform;a.ports&&0<a.ports.length&&
(f=a.ports[0],(Z=f.element)||(Z=document.getElementById(f.id)),"window"===f.fill?(Z.setAttribute("width",window.innerWidth),Z.setAttribute("height",window.innerHeight)):f.width&&f.height&&(Z.setAttribute("width",f.width),Z.setAttribute("height",f.height)),f.background&&(Z.style.backgroundColor=f.background),void 0!==f.transform&&(p=f.transform));Z||(Z=a.canvas)||"undefined"===typeof document||(Z=document.getElementById(a.canvasname));Z&&(M=Z.getContext("2d"),M.setLineDash||(M.setLineDash=function(){}));
f=gb(rc);f=Fa(f,!1);I(f);var ua=a.scripts,vb=null;"string"===typeof ua&&ua.search(/\*/)&&(vb=ua);"object"!==typeof ua&&(ua=null);"move keydown mousedown mouseup mousedrag init tick draw simulationstep cssimulationstart cssimulationstop".split(" ").forEach(function(f){var p;if(null!==ua&&ua[f])p=ua[f];else{p=f+"script";if(a[p])p=document.getElementById(a[p]);else if(vb){if(p=document.getElementById(vb.replace(/\*/,f)),!p)return}else return;p=p.text}p=gb(p);Da[f]=Fa(p,!1)});a.grid&&0!==a.grid&&(Ua=
a.grid,Sb=Fa("#drawgrid("+Ua+")",!1));a.snap&&(Tb=a.snap);Z&&(Aa=Z.width,va=Z.height,C(p),D.drawingstate.matrix.ty-=va,D.drawingstate.initialmatrix.ty-=va,p=1,"undefined"!==typeof window&&window.devicePixelRatio&&(p=window.devicePixelRatio),f=M.webkitBackingStorePixelRatio||M.mozBackingStorePixelRatio||M.msBackingStorePixelRatio||M.oBackingStorePixelRatio||M.backingStorePixelRatio||1,p!==f&&(p/=f,Z.width=Aa*p,Z.height=va*p,Z.style.width||(Z.style.width=Aa+"px"),Z.style.height||(Z.style.height=va+
"px"),M.scale(p,p)));k=h=e=d=c=b=void 0;p=0;za={};a.geometry||(a.geometry=[]);sc(a.geometry);a.behavior||(a.behavior=[]);"function"===typeof wb&&wb(a.behavior);for(var g in a.images)p=a.images[g],za[g]=new Image,za[g].ready=!1,za[g].onload=function(){za[g].ready=!0;ma()},za[g].src=p;Oa.canvas=Z;if(a.oninit)a.oninit(Oa);if(a.exclusive)for(p=Qa.instances.length;0<p;)Qa.instances[--p].shutdown();Qa.instances.push(Oa);a.use&&a.use.forEach(function(f){z.use$1([G.wrap(f)],{})});I(Da.init);a.autoplay&&l();
Z&&V(Z,a)}}function F(){null!==Ya&&(Ba.set(Ya.state),Object.keys(Ya.speeds).forEach(function(f){var a=c[f];"undefined"!==typeof a.behavior&&(f=Ya.speeds[f],a.behavior.vx=f[0],a.behavior.vy=f[1],a.behavior.vz=f[2],a.behavior.fx=0,a.behavior.fy=0,a.behavior.fz=0)}),tc())}function l(){if(!Va){if(lb){var f=Ya?Ya.state:new Float64Array(Ba.length);f.set(Ba);for(var a={},p=0;p<d.length;p++){var b=d[p];"undefined"!==typeof b.behavior&&(a[b.name]=[b.behavior.vx,b.behavior.vy,b.behavior.vz])}Ya={state:f,speeds:a};
lb=!1}"function"===typeof wb&&xb&&uc(Ga);Va=!0;T()}}function L(){Va&&(Va=!1)}function J(){lb||(Va=!1,lb=!0,F())}function P(){if(!yb){yb=!0;for(var f=Qa.instances.length;0<f;)if(Qa.instances[--f]===Oa){Qa.instances.splice(f,1);break}for(f=cb.length;0<f;)try{cb[--f]()}catch(a){console.error(a)}}}function O(f){this.in=function(f,a){console.log(f);a?this.append(this.createTextNode("span","blue",f)):this.append(this.createTextNode("p","blue",f))};this.out=function(f,a){console.log(f);a?this.append(this.createTextNode("span",
"red",f)):this.append(this.createTextNode("p","red",f))};this.err=function(f,a){console.log(f);a?this.append(this.createTextNode("span","red",f)):this.append(this.createTextNode("p","red",f))};this.createTextNode=function(f,a,b){return"undefined"!==typeof document?(f=document.createElement(f),f.appendChild(document.createTextNode(b)),f.style.color=a,f):b+"\n"}}function X(){var f=this,a,p=document.createElement("div"),b;p.innerHTML='<div id="console" style="border-top: 1px solid #333333; bottom: 0px; position: absolute; width: 100%;"><div id="log" style="height: 150px; overflow-y: auto;"></div><input id="cmd" type="text" style="box-sizing: border-box; height: 30px; width: 100%;"></div>';
document.body.appendChild(p);a=document.getElementById("cmd");b=document.getElementById("log");a.onkeydown=function(p){13===p.keyCode&&""!==a.value&&(f.in(a.value),p=z.parse$1([G.wrap(a.value)],[]),p=I(p),console.log(ha(p)),"undefined"!==p.ctype&&ya.out(ha(p)),a.value="",b.scrollTop=b.scrollHeight)};this.append=function(f){b.appendChild(f)};this.clear=function(){b.innerHTML=""}}function ea(f){var a=document.getElementById(f);this.append=function(f){a.appendChild(f)};this.clear=function(){a.innerHTML=
""}}function ia(){var f=window.open("","","width=200,height=100"),a;f&&(a=f.document.getElementsByTagName("body")[0]);this.append=function(f){a&&a.appendChild(f)};this.clear=function(){a&&(a.innerHTML="")}}function A(){this.append=function(f){};this.clear=function(){}}function R(f){for(var a=null,p=1E6,b,d=0;d<k.length;d++){var e=k[d];if(!e.pinned&&!1!==e.visible){var g,h,l,n=D.drawingstate.matrix.sdet;if("P"===e.kind){var r=m.normalizeZ(e.homog);if(!m._helper.isAlmostReal(r))continue;g=r.value[0].value.real-
f.x;h=r.value[1].value.real-f.y;l=Math.sqrt(g*g+h*h);e.narrow&l>20/n&&(l=1E4)}else"C"===e.kind?(h=c[e.args[0]],l=e.radius,g=q.div(h.homog.value[0],h.homog.value[2]).value.real,h=q.div(h.homog.value[1],h.homog.value[2]).value.real,g-=f.x,h-=f.y,l=Math.sqrt(g*g+h*h)-l.value.real,h=g=0,0>l&&(l=-l),l+=30/n):"L"===e.kind&&(g=e.homog,l=q,h=l.add(l.mult(g.value[0],l.conjugate(g.value[0])),l.mult(g.value[1],l.conjugate(g.value[1]))),h=m.scaldiv(l.sqrt(h),g),l=h.value[0].value.real*f.x+h.value[1].value.real*
f.y+h.value[2].value.real,g=h.value[0].value.real*l,h=h.value[1].value.real*l,0>l&&(l=-l),l+=1);l<p+.2/n&&(p=l,a=e,b={x:g,y:h})}}console.log("Moving "+(a?a.name:"nothing"));return null===a?null:{mover:a,offset:b,prev:{x:f.x,y:f.y}}}function S(f,a,p,b){void 0===b&&(b=!1);cb.push(function(){f.removeEventListener(a,p,b)});f.addEventListener(a,p,b)}function V(f,a){function p(a){var p=f.getBoundingClientRect();a=D.to(a.clientX-p.left-f.clientLeft,a.clientY-p.top-f.clientTop);qa.prevx=qa.x;qa.prevy=qa.y;
qa.x=a[0];qa.y=a[1];fb[0]=qa.x;fb[1]=qa.y}function b(f){qa.down=!1;xa=void 0;Wa();ma();I(Da.mouseup);f.preventDefault()}var c=null;"undefined"!==typeof MutationObserver&&(c=MutationObserver);c||"undefined"===typeof WebKitMutationObserver||(c=WebKitMutationObserver);c?(c=new c(function(a){document.body.contains(f)||P()}),c.observe(document.documentElement,{childList:!0,subtree:!0}),cb.push(function(){c.disconnect()})):(S(f,"DOMNodeRemovedFromDocument",P),S(f,"DOMNodeRemoved",P));!0===a.keylistener?
S(document,"keydown",function(f){g(f);return!1}):Da.keydown&&(f.setAttribute("tabindex","0"),S(f,"mousedown",function(){f.focus()}),S(f,"keydown",function(f){9!==f.keyCode&&(g(f),f.preventDefault())}));S(f,"mousedown",function(f){qa.button=f.which;p(f);I(Da.mousedown);xa=R(qa);T();qa.down=!0;f.preventDefault()});S(f,"mouseup",function(f){qa.down=!1;xa=void 0;Wa();I(Da.mouseup);ma();f.preventDefault()});S(f,"mousemove",function(f){p(f);qa.down?I(Da.mousedrag):I(Da.mousemove);f.preventDefault()});S(f,
"touchstart",function(f){p(f.targetTouches[0]);I(Da.mousedown);qa.down=!0;xa=R(qa);T();f.preventDefault()},!1);S(f,"touchmove",function(f){p(f.targetTouches[0]);qa.down?I(Da.mousedrag):I(Da.mousemove);f.preventDefault()},!0);S(f,"touchend",b,!1);"undefined"!==typeof document&&document.body&&S(document.body,"touchcancel",b,!1);ma()}function Y(){if(yb)return!0;Va&&(xb&&"undefined"!==typeof Ea&&Ea.tick(),Va&&I(Da.tick));ma();mb=Va||qa.down;return!mb}function T(){mb||(mb=!0,Ab.timer(Y))}function ma(){D.reset();
M.save();M.clearRect(0,0,Aa,va);0!==Ua&&I(Sb);wc();D.greset();xc();M.restore()}function g(f){f=window.event?event:f;f=f.charCode?f.charCode:f.keyCode;Ub=String.fromCharCode(f);Vb=f;I(Da.keydown);ma()}function t(f,a){if(a in f)return a;a=a.charAt(0).toUpperCase()+a.substring(1);for(var p=0,b=Wb.length;p<b;++p){var c=Wb[p]+a;if(c in f)return c}}function U(){var f=oa(),f=na()-f;24<f?(isFinite(f)&&(clearTimeout(nb),nb=setTimeout(U,f)),ob=0):(ob=1,Xb(U))}function oa(){var f=Date.now();for(Xa=pb;Xa;)f>=
Xa.t&&(Xa.f=Xa.c(f-Xa.t)),Xa=Xa.n;return f}function na(){for(var f,a=pb,p=Infinity;a;)a.f?a=f?f.n=a.n:pb=a.n:(a.t<p&&(p=a.t),a=(f=a).n);qb=f;return p}function ja(){this.ctype="undefined"}function aa(){this.ctype="void"}function pa(f){this.ctype="error";this.message=f}function ha(f){if("undefined"===typeof f)return"_??_";if("undefined"===f.ctype)return"_?_";if("number"===f.ctype)return q.niceprint(f);if("string"===f.ctype||"boolean"===f.ctype)return f.value;if("list"===f.ctype){for(var a="[",p=0;p<
f.value.length;p++)a+=ha(I(f.value[p])),p!==f.value.length-1&&(a+=", ");return a+"]"}return"function"===f.ctype?"FUNCTION":"infix"===f.ctype?"INFIX":"modifier"===f.ctype?f.key+"->"+ha(f.value):"shape"===f.ctype?f.type:"error"===f.ctype?"Error: "+f.message:"variable"===f.ctype?(console.log("HALLO"),ha(f.stack[length.stack])):"geo"===f.ctype?f.value.name:"__"}function ka(f,a,p){f=ka[f];if(void 0===f)return x;var b=[];for(p=0;p<f.arglist.length;p++)b[p]=I(a[p]);for(p=0;p<f.arglist.length;p++)ca.newvar(f.arglist[p].name),
ca.setvar(f.arglist[p].name,b[p]);ca.pushVstack("*");a=I(f.body);ca.cleanVstack();for(p=0;p<f.arglist.length;p++)ca.removevar(f.arglist[p].name);return a}function ta(f,a){var p="undefined"===f[0].ctype,b="undefined"===f[1].ctype,c=I(f[1]);if(p||b)return x;"variable"===f[0].ctype?ca.setvar(f[0].name,c):"infix"===f[0].ctype?"_"===f[0].oper?Q.assigntake(f[0],c):console.error("Can't use infix expression as lvalue"):"field"===f[0].ctype?Q.assigndot(f[0],c):"function"===f[0].ctype&&"genList"===f[0].oper?
"list"===c.ctype?Q.assignlist(f[0].args,c.value):console.error("Expected list in rhs of assignment"):console.error("Left hand side of assignment is not a recognized lvalue");return c}function Na(f,a){var p=N(f[0]),b=N(f[1]);return"number"===p.ctype&&"number"===b.ctype?{ctype:"boolean",value:p.value.real===b.value.real&&p.value.imag===b.value.imag}:"string"===p.ctype&&"string"===b.ctype||"boolean"===p.ctype&&"boolean"===b.ctype?{ctype:"boolean",value:p.value===b.value}:"list"===p.ctype&&"list"===b.ctype?
m.equals(p,b):{ctype:"boolean",value:!1}}function Pa(f,a){var p=N(f[0]),b=N(f[1]);return"number"===p.ctype&&"number"===b.ctype?{ctype:"boolean",value:q._helper.isAlmostEqual(p,b)}:"string"===p.ctype&&"string"===b.ctype||"boolean"===p.ctype&&"boolean"===b.ctype?{ctype:"boolean",value:p.value===b.value}:"list"===p.ctype&&"list"===b.ctype?m.almostequals(p,b):{ctype:"boolean",value:!1}}function bb(f,a){var p=N(f[0]),b=N(f[1]);return"boolean"===p.ctype&&"boolean"===b.ctype?{ctype:"boolean",value:p.value&&
b.value}:x}function Ia(f,a){var p=N(f[0]),b=N(f[1]);return"boolean"===p.ctype&&"boolean"===b.ctype?{ctype:"boolean",value:p.value||b.value}:x}function eb(f,a){var p=N(f[0]),b=N(f[1]);return G.add(p,b)}function tb(f,a){var p=N(f[0]),b=N(f[1]);return G.sub(p,b)}function Pb(f,a){var p=N(f[0]),b=N(f[1]);return G.mult(p,b)}function Qb(f,a){var p=N(f[0]),b=N(f[1]);return G.div(p,b)}function Rb(f,a){var p=N(f[0]),b=N(f[1]);return"number"===p.ctype&&"number"===b.ctype?q.pow(p,b):x}function Bb(f){var a=f.length;
if(0===a)return[];if(1===a)return[0];if(2===a)return f[0][0]+f[1][1]<=f[0][1]+f[1][0]?[0,1]:[1,0];if(4<a)return yc(f);for(var p=zc[a],b=Number.POSITIVE_INFINITY,c=p[0],d=0;d<p.length;++d){for(var e=p[d],g=0,h=0;h<a;++h)g+=f[h][e[h]];g<b&&(b=g,c=e)}return c}function yc(f){function a(){return{matched:-1,prev:-1,start:-1,cost:0,used:!1,leaf:!1}}function p(f){for(var a=0;a<d;++a)0<l[f][a]||m[a].used||(m[a].used=!0,p(m[a].matched))}function b(f){for(var a=0;a<d;++a)0<l[a][f]||h[a].used||(h[a].used=!0,
b(h[a].matched))}var c=Math.abs,d=f.length,e,g,h=Array(d),m=Array(d),l=Array(d);for(e=0;e<d;++e)l[e]=Array(d);for(e=0;e<d;++e)for(h[e]=a(),m[e]=a(),h[e].cost=f[e][0],g=1;g<d;++g)h[e].cost>f[e][g]&&(h[e].cost=f[e][g]);for(;;){for(e=0;e<d;++e)for(g=0;g<d;++g)l[e][g]=f[e][g]-h[e].cost-m[g].cost,l[e][g]<1E-14*(c(f[e][g])+c(h[e].cost)+c(m[g].cost))&&(l[e][g]=0);for(e=0;e<d;++e)h[e].matched=m[e].matched=-1;for(var k=0;;){for(e=0;e<d;++e)h[e].used=h[e].leaf=m[e].used=m[e].leaf=!1,-1===h[e].matched&&(h[e].start=
e,h[e].used=h[e].leaf=!0,h[e].prev=-1);for(var q=!1,n=!1;!n;){for(e=0;e<d;++e)if(h[e].leaf)for(h[e].leaf=!1,g=0;g<d;++g)if(!(m[g].used||0<l[e][g])&&h[e].matched!==g&&(m[g].prev=e,m[g].start=h[e].start,m[g].used=m[g].leaf=!0,-1===m[g].matched)){h[m[g].start].prev=g;q=!0;break}if(q)break;n=!0;for(g=0;g<d;++g)m[g].leaf&&(m[g].leaf=!1,e=m[g].matched,h[e].used||(h[e].prev=g,h[e].start=m[g].start,h[e].used=h[e].leaf=!0,n=!1))}if(!q)break;for(q=0;q<d;++q)if(-1===h[q].matched&&-1!==h[q].prev){g=h[q].prev;
do e=m[g].prev,m[g].matched=e,h[e].matched=g,g=h[e].prev;while(e!==q);++k}}if(k===d)break;for(e=0;e<d;++e)h[e].used=h[e].leaf=m[e].used=m[e].leaf=!1;for(e=0;e<d;++e)-1===h[e].matched&&p(e);for(g=0;g<d;++g)-1===m[g].matched&&b(g);for(e=0;e<d;++e)-1===h[e].matched||h[e].used||m[h[e].matched].used||(h[e].used=!0);k=Number.POSITIVE_INFINITY;for(e=0;e<d;++e)if(!h[e].used)for(g=0;g<d;++g)m[g].used||k>l[e][g]&&(k=l[e][g]);for(e=0;e<d;++e)h[e].used||(h[e].cost+=k),m[e].used&&(m[e].cost-=k)}f=Array(d);for(e=
0;e<d;++e)g=h[e].matched,f[e]=g;return f}function Yb(f,a){var p=I(f[0]),b=N(f[1]);if("number"===b.ctype){var c=Math.floor(b.value.real);if("list"===p.ctype||"string"===p.ctype)return 0>c&&(c=p.value.length+c+1),0<c&&c<p.value.length+1?"list"===p.ctype?p.value[c-1]:{ctype:"string",value:p.value.charAt(c-1)}:x}if("list"===b.ctype){for(var c=[],d=0;d<b.value.length;d++){var e=N(b.value[d]);c[d]=Yb([p,e],[])}return m.turnIntoCSList(c)}return x}function Zb(f,a){var p=I(f[0]),b=I(f[1]);return"list"===p.ctype&&
"list"===b.ctype?m.concat(p,b):"shape"===p.ctype&&"shape"===b.ctype?Q.shapeconcat(p,b):x}function $b(f,a){var p=I(f[0]),b=I(f[1]);return"list"===p.ctype&&"list"===b.ctype?m.set(m.common(p,b)):"shape"===p.ctype&&"shape"===b.ctype?Q.shapecommon(p,b):x}function ac(f,a){var p=I(f[0]),b=I(f[1]);return"list"===p.ctype&&"list"===b.ctype?m.remove(p,b):"shape"===p.ctype&&"shape"===b.ctype?Q.shaperemove(p,b):x}function bc(f,a){var p=I(f[0]),b=I(f[1]);return"list"===p.ctype?m.append(p,b):x}function cc(f,a){var p=
I(f[0]),b=I(f[1]);return"list"===b.ctype?m.prepend(p,b):x}function Cb(f,a){f|=0;a|=0;if(0===f&&0===a)return 0;for(;0!==a;){var p=f;f=a;a=p%a|0}return f}function Ac(f){return 1===f?0:1}function I(f){if("undefined"===typeof f)return x;if("infix"===f.ctype)return f.impl(f.args,{});if("variable"===f.ctype)return ca.getvar(f.name);if("void"===f.ctype||"geo"===f.ctype||"number"===f.ctype||"boolean"===f.ctype||"string"===f.ctype||"list"===f.ctype||"undefined"===f.ctype||"shape"===f.ctype)return f;if("field"===
f.ctype){var a=I(f.obj);return"geo"===a.ctype?Ja.getField(a.value,f.key):"list"===a.ctype?m.getField(a,f.key):x}return"function"===f.ctype?Q.evaluate(f.oper,f.args,f.modifs):x}function N(f){f=I(f);if("geo"===f.ctype){var a=f.value;if("P"===a.kind)return Ja.getField(a,"xy")}return f}function ga(f){f=I(f);if("geo"===f.ctype){var a=f.value;if("P"===a.kind||"L"===a.kind)return Ja.getField(a,"homog")}return m._helper.isNumberVecN(f,3)?f:m._helper.isNumberVecN(f,2)?(a=m.turnIntoCSList([f.value[0],f.value[1],
q.real(1)]),f.usage&&(a=G.withUsage(a,f.usage)),a):x}function gb(f){for(var a=!1,p=!1,b="",c=0;c<f.length;c++){var d=f[c];'"'!==d||p||(a=!a);"/"===d&&c!==f.length-1&&"/"===f[c+1]&&(p=!0);"\n"===d&&(p=!1);if(" "!==d&&"\t"!==d&&"\n"!==d&&"\f"!==d&&"\r"!==d&&!p||a)b+=d}return b}function dc(f,a,p){var b={ctype:"infix"};b.oper=f;b.impl=la[f];b.args=[a,p];return b}function Bc(f){var a,p;if("function"!==f.ctype)return console.log("Invalid function name."),!1;for(a=0;a<f.args.length;a++)if("variable"!==f.args[a].ctype)return console.log("Argument is not a variable."),
!1;for(a=0;a<f.args.length-1;a++)for(p=a+1;p<f.args.length;p++)if(f.args[a].name===f.args[p].name)return console.log("Variable name used twice."),!1;return!0}function rb(f){return""!==f&&!isNaN(f)}function Db(f){return"["===f||"("===f||"{"===f||"|"===f}function Eb(f){return"]"===f||")"===f||"}"===f||"|"===f}function Fb(f){var a,p=[],b=[],c=[];a=f+",";var d=a.length,e=0,g=0,h=!1,m=!1;for(f=g;f<d;f++){var l;l=a[f];'"'===l&&(m=!m);!m&&(!Db(l)||"|"===l&&h?Eb(l)&&("|"!==l||h)&&(e--,"|"===l&&(h=!1)):(e++,
"|"===l&&(h=!0)),","===l&&0===e||-1===e)&&(l=a.substring(g,f),p.push(l),b.push(g),g=f+1)}for(f=0;f<p.length;f++)if(b=p[f],""===b)c.push("nil");else{b=Fa(b,!1);if("error"===b.ctype)return b;c.push(b)}p={ctype:"function",oper:"genList"};p.args=c;p.modifs={};return p}function Cc(f){var a;return"|"===f[0]?(f=Fb(f.substring(1,f.length-1)),a=f.args.length,1===a?(f.oper="abs_infix",f):2===a?(f.oper="dist_infix",f):x):"()"===f||"[]"===f?a={ctype:"list",value:[]}:"["===f[0]?Fb(f.substring(1,f.length-1)):"("===
f[0]&&(a=Fb(f.substring(1,f.length-1)),1<a.args.length)?a:a=Fa(f.substring(1,f.length-1),!1)}function Fa(f,a){for(var p=!1,b="",c=-1,d=-1,e="",g=0,h=0,m=" ",l=" ",k=0,q=!1,n=f.length,r=0;r<n;r++){var t,u=" ",v=" ";0<k&&k--;t=f[r];r+1<n&&(u=f[r+1]);r+2<n&&(v=f[r+2]);'"'===t&&(p=!p);if(!p){if(Db(t)&&("|"!==t||!q))"|"===t&&(q=!0),b+=t,g++,1===g&&h++," "===m&&(m=t);else if(Eb(t)&&("|"!==t||q)){"|"===t&&(q=!1);if(0===g)return new pa("close without open");l=b[b.length-1]+t;if("[]"===l||"()"===l||"{}"===
l||"||"===l)g--,b=b.substring(0,b.length-1),l=t;else return new pa("unmatched brackets")}if(0===b.length){var w=-1,y="";"undefined"!==typeof sb[t+u+v]&&0===k?(y=t+u+v,k=3):"undefined"!==typeof sb[t+u]&&0===k?(y=""+t+u,k=2):"undefined"!==typeof sb[t]&&0===k&&(y=""+t,k=1);""!==y&&(w=sb[y]);w>=d&&(d=w,c=r,e=y,0<=w&&(r+=y.length-1))}}}if(0!==g)return new pa("open without close");p=f.indexOf(m);b=f.lastIndexOf(l);if(0===g&&-1<d){if("->"===e)return d=e,e=f.substring(0,c),c=Fa(f.substring(c+d.length),!1),
e="error"===c.ctype?c:{ctype:"modifier",key:e,value:c},e;if("."===e)return d=f.indexOf("."),g=f.lastIndexOf("."),(d!==g?0:-1===d?rb(f):rb(f.substring(0,d))||rb(f.substring(d+1)))?(e={},e.value={real:parseFloat(f),imag:0},e.ctype="number"):(d=Fa(f.substring(0,c),!1),e=f.substring(c+e.length),e={ctype:"field",obj:d,key:e}),e;if(":="===e)return d=f.substring(0,c),d=Fa(d,!0),"error"===d.ctype?e=d:"variable"===d.cstring||Bc(d)?(c=f.substring(c+e.length),c=Fa(c,!1),e="error"===c.ctype?c:dc(e,d,c)):(console.log(["Function not definable",
d]),e=new pa("Function not definable")),e;d=Fa(f.substring(0,c),!1);c=Fa(f.substring(c+e.length),!1);e="error"===d.ctype?d:"error"===c.ctype?c:dc(e,d,c);return e}if(0===g&&1===h&&b===f.length-1){if(0===p)return Cc(f);a:{g=[];h=[];e=[];c={};d=f.substring(0,p);b=f.length;m=0;l=p+1;q=k=!1;for(p=l;p<b;p++)if(n=f[p],'"'===n&&(k=!k),!k)if(!Db(n)||"|"===n&&q?Eb(n)&&("|"!==n||q)&&(m--,"|"===n&&(q=!1)):(m++,"|"===n&&(q=!0)),","===n&&0===m||-1===m)n=f.substring(l,p),g.push(n),h.push(l),1!==g.length||-1!==m||
g[0].length||(g=[],h=[]),l=p+1;for(p=0;p<g.length;p++){h=Fa(g[p],!1);if("error"===h.ctype){e=h;break a}"modifier"===h.ctype?c[h.key]=h.value:e.push(h)}g={ctype:"function"};g.oper=d+"$"+e.length;g.args=e;g.modifs=c;e=g}return e}return""===f?new aa:'"'===f.charAt(0)&&'"'===f.charAt(f.length-1)?{ctype:"string",value:f.substring(1,f.length-1)}:rb(f)?{ctype:"number",value:{real:parseInt(f),imag:0}}:ca.isVariable(f)?ca.vars[f]:ca.isVariableName(f)?ca.create(f):x}function Dc(f){for(var a in f)null!==f[a]&&
(Ka[a]=f[a])}function sc(f){function a(f){void 0===f.size&&(f.size=Ka.pointSize);f.size=q.real(f.size);"Free"!==f.type?(f.color=m.realVector(f.color||Ka.pointColor),f.color=m.scalmult(q.real(Ka.dimDependent),f.color)):f.color=m.realVector(f.color||Ka.pointColor);void 0===f.alpha&&(f.alpha=Ka.alpha);f.alpha=q.real(f.alpha)}function p(f){void 0===f.size&&(f.size=Ka.lineSize);f.size=q.real(f.size);f.color=m.realVector(f.color||Ka.lineColor);void 0===f.alpha&&(f.alpha=Ka.alpha);f.alpha=q.real(f.alpha);
f.clip=G.string(f.clip||Ka.clip);void 0===f.overhang&&(f.overhang=Ka.overhangLine);f.overhang=q.real(f.overhang)}function ua(f){p(f);f.clip=G.string("end");void 0===f.overhang&&(f.overhang=Ka.overhangSeg);f.overhang=q.real(f.overhang)}Object.keys(B).forEach(function(f){f=B[f];void 0!==f.updatePosition&&void 0===f.stateSize&&(f.stateSize=0)});b=f;c={};var g,l,da,r,t=0;d=[];e=[];h=[];k=[];var zb=0,vc=0,x=0,z=0,A={};for(g=0;g<f.length;g++)if(da=f[g],l=Ec[da.type])da=l(da).slice(),da.splice(0,0,g,1),
f.splice.apply(f,da),--g;else if(c[da.name]=da,r=B[da.type]){if(da.args){for(l=0;l<da.args.length&&!A.hasOwnProperty(da.args[l]);++l);if(l<da.args.length){console.log("Dropping "+da.name+" due to dropped argument "+da.args[l]);A[da.name]=!0;f.splice(g,1);g--;continue}}da.kind=r.kind;da.stateIdx=t;t+=r.stateSize;da.incidences=[];da.isshowing=!0;da.movable=!1;r.isMovable&&(da.movable=!0,k[vc++]=da);"P"===da.kind&&(d[zb]=da,a(da),zb+=1);"L"===da.kind&&(e[x]=da,p(da),x+=1);"C"===da.kind&&(h[z]=da,p(da),
z+=1);"S"===da.kind&&(e[x]=da,ua(da),x+=1)}else console.error(da),console.error("Operation "+da.type+" not implemented yet"),A[da.name]=!0,f.splice(g,1),g--;Ra=Ba=Ma=new Float64Array(t);for(g=0;g<f.length;g++)da=f[g],r=B[da.type],Za=!0,r.initialize&&(Ca=Ha=da.stateIdx,da.param=r.initialize(da),$a(Ha===da.stateIdx+r.stateSize,"State fully initialized")),Ca=Ha=da.stateIdx,r.updatePosition(da,!1),$a(Ca===da.stateIdx+r.stateSize,"State fully consumed"),$a(Ha===da.stateIdx+r.stateSize,"State fully updated"),
Gb(da,r);Ra=new Float64Array(t);Ma=new Float64Array(t);Wa();Za=!1;Fc()}function ec(f,a){var p=c[a.args[0]].homog,b=c[a.args[1]].homog,d=f.homog,e=q.div(p.value[0],p.value[2]),g=q.div(p.value[1],p.value[2]),p=q.div(b.value[0],b.value[2]),b=q.div(b.value[1],b.value[2]),h=q.div(d.value[0],d.value[2]),m=q.div(d.value[1],d.value[2]);return q._helper.isAlmostReal(e)&&q._helper.isAlmostReal(g)&&q._helper.isAlmostReal(p)&&q._helper.isAlmostReal(b)&&q._helper.isAlmostReal(h)&&q._helper.isAlmostReal(m)?(e=
e.value.real,g=g.value.real,p=p.value.real,b=b.value.real,h=h.value.real,m=m.value.real,d=Math.sqrt((e-p)*(e-p)+(g-b)*(g-b)),e=Math.sqrt((e-h)*(e-h)+(g-m)*(g-m)),p=Math.sqrt((p-h)*(p-h)+(b-m)*(b-m)),e=d-e-p,1E-15>e*e):!1}function Gb(f,a){f.isshowing=!0;if(f.args)for(var p=0;p<f.args.length;p++)if(!c[f.args[p]].isshowing){f.isshowing=!1;return}a.visiblecheck&&a.visiblecheck(f)}function Fc(){for(var f=0;f<e.length;f++)for(var a=e[f],p=0;p<d.length;p++){var b=d[p],c=m.scaldiv(m.abs(b.homog),b.homog),
g=m.scaldiv(m.abs(a.homog),a.homog);1E-13>q.abs(m.scalproduct(c,g)).value.real&&(b.incidences.push(a.name),a.incidences.push(b.name))}}function xc(){function f(f){if(f.isshowing&&!1!==f.visible&&m._helper.isAlmostReal(f.homog)){var a=f.color;f.behavior&&(a=f.color);z.draw$1([f.homog],{size:f.size,color:a,alpha:f.alpha});if(f.labeled){var a=f.printname||f.name||"P",p=f.labelpos||{x:3,y:3},b=f.textsize||12,c=!0===f.textbold,Z=!0===f.textitalics,ua=f.text_fontfamily||"Sans Serif",d=p.x*p.x+p.y*p.y,e=
1;0<d&&(e=1+f.size.value.real/Math.sqrt(d));z.drawtext$2([f.homog,G.wrap(a)],{x_offset:G.wrap(e*p.x),y_offset:G.wrap(e*p.y),size:G.wrap(b),bold:G.wrap(c),italics:G.wrap(Z),family:G.wrap(ua)})}}}function a(f){if(f.isshowing&&!1!==f.visible){var p={};p.color=f.color;p.alpha=f.alpha;p.size=f.size;Q.drawconic(f,p)}}function p(f){var a,p;if(f.isshowing&&!1!==f.visible&&m._helper.isAlmostReal(f.homog))if("none"===f.clip.value)z.draw$1([f.homog],{size:f.size,color:f.color,alpha:f.alpha});else if("end"===
f.clip.value)z.draw$2([f.startpos,f.endpos],{size:f.size,color:f.color,alpha:f.alpha});else if("inci"===f.clip.value){a=[1E6,0];p=[-1E6,0];for(var b=[1E6,0],Z=[-1E6,0],ua=0;ua<f.incidences.length;ua++){var d=c[f.incidences[ua]].homog,e=d.value[0],g=d.value[1],h=d.value[2];q._helper.isAlmostZero(h)||(e=q.div(e,h),g=q.div(g,h),q._helper.isAlmostReal(e)&&q._helper.isAlmostReal(g)&&(e.value.real<a[0]&&(a=[e.value.real,d]),e.value.real>p[0]&&(p=[e.value.real,d]),g.value.real<b[0]&&(b=[g.value.real,d]),
g.value.real>Z[0]&&(Z=[g.value.real,d])))}p[0]-a[0]>Z[0]-b[0]?(a=a[1],p=p[1]):(a=b[1],p=Z[1]);a!==p?z.draw$2([a,p],{size:f.size,color:f.color,alpha:f.alpha,overhang:f.overhang}):z.draw$1([f.homog],{size:f.size,color:f.color,alpha:f.alpha})}else console.error(["Bad clip: ",f.clip])}var b;for(b=0;b<h.length;b++)a(h[b]);for(b=0;b<e.length;b++)p(e[b]);for(b=0;b<d.length;b++)f(d[b])}function $a(f,a){var p="Assertion failed: "+a;if(!f)throw console.log(p),P(),"undefined"!==typeof alert&&alert(p),Error(p);
}function Wa(){Ra.set(Ba);fc(!1);for(var f=Ra.length,a=Math.abs,p=0;p<f;p+=2)a(Ra[p])>1E12*a(Ra[p+1])&&(Ra[p+1]=0)}function Hb(){if(db)La=!0;else throw gc;}function hc(f,a,p,b,c){return G.add(b,G.mult(p,G.sub(c,b)))}function wc(){W&&(W.currentMouseAndScripts=[]);Ib=!0;La=!1;Ba.set(Ra);if(xa){var f=xa.mover,a=m.realVector([qa.x+xa.offset.x,qa.y+xa.offset.y,1]);Jb(f,a,"mouse");xa.prev.x=qa.x;xa.prev.y=qa.y}I(Da.move);I(Da.draw);La||Wa();Ib=!1;W&&(W.fullLog.push(m.turnIntoCSList([m.turnIntoCSList(W.currentMouseAndScripts)])),
W.length>W.logLength&&W.splice(0,W.length-W.logLength),W.currentMouseAndScripts=null,W.postMouseHooks.forEach(function(f){f()}))}function Kb(f,a,p){Ib?Jb(f,a,p):(Wa(),La=!1,Jb(f,a,p),Wa())}function Jb(f,a,p){W&&W.currentMouseAndScripts&&(W.currentMover=[]);Ma.set(Ba);var c=1E4,d;d=ic[f.name];if(!d){var e={},g=0;d=[];e[f.name]=f;for(var h=b,l=0;l<h.length;++l){var k=h[l],r=k.args;if(r)for(var t=0;t<r.length;++t)e.hasOwnProperty(r[t])&&(e[k.name]=k,d[g++]=k)}ic[f.name]=d}var e=-1,g=.9,u,v,w,h=B[f.type],
l=h.parameterPath||hc;Ca=f.stateIdx;k=h.getParamFromState(f);Ca=Ha=f.stateIdx;r=h.getParamForInput(f,a,p);for(t=e+g;e!==t;){var x=t*t,y=.5/(1+x),y=q.complex(2*t*y+.5,(1-x)*y);db=e+.5*g<=e||0===c;0===c&&console.log("tracing limit Reached");x=!1;W&&W.currentMouseAndScripts&&(W.currentStep=[]);try{Ca=Ha=f.stateIdx;var z=l(f,t,y,k,r);W&&(W.currentParam=z);y=Ma;Ma=Ba;h.putParamToState(v,z);Ma=y;Ha=f.stateIdx;W&&(W.currentElement=f);h.updatePosition(f,!0);$a(Ca===f.stateIdx+h.stateSize,"State fully consumed");
$a(Ha===f.stateIdx+h.stateSize,"State fully updated");for(u=0;u<d.length;++u)v=d[u],w=B[v.type],Ca=Ha=v.stateIdx,W&&(W.currentElement=v),w.updatePosition(v,!1),$a(Ca===v.stateIdx+w.stateSize,"State fully consumed"),$a(Ha===v.stateIdx+w.stateSize,"State fully updated");W&&(W.currentElement=null);e=t;g*=1.25;t+=g;1<=t&&(t=1);Ma=Ba;Ba=y}catch(A){if(A!==gc)throw A;g*=.5;t=e+g;--c;x=!0}W&&W.currentMouseAndScripts&&(W.currentMover.push(m.turnIntoCSList([m.turnIntoCSList(W.currentStep),G.wrap(x),G.wrap(e),
G.wrap(t),G.wrap(W.currentParam)])),W.currentStep=null,W.currentParam=null)}fc(La);for(u=0;u<d.length;++u)v=d[u],w=B[v.type],Gb(v,w);W&&W.currentMouseAndScripts&&(W.currentMouseAndScripts.push(m.turnIntoCSList([m.turnIntoCSList(W.currentMover),G.wrap(La),G.wrap(f.name),a,G.wrap(p),k,r])),W.currentMover=null)}function tc(){Wa();db=!0;for(var f=b,a=0;a<f.length;a++){var p=f[a],c=B[p.type];Ca=Ha=p.stateIdx;c.updatePosition(p,!1);Gb(p,c)}f=Ma;Ma=Ba;Ba=f;Wa()}function fc(f){var b=a.tracingStateReport;
"string"===typeof b&&(document.getElementById(b).textContent=f?"BAD":"GOOD")}function Gc(){return m.turnIntoCSList(W.fullLog.slice())}function Hc(f){var a=JSON.stringify(W.fullLog);f=new Blob([a],{type:f?"application/octet-stream":"application/json"});return window.URL.createObjectURL(f)}function hb(){var f=Ca;Ca+=2;return q.complex(Ba[f],Ba[f+1])}function wa(f){for(var a=Array(f),p=0;p<f;++p)a[p]=hb();return m.turnIntoCSList(a)}function ab(f){Ma[Ha]=f.value.real;Ma[Ha+1]=f.value.imag;Ha+=2}function ra(f){for(var a=
0,p=f.value.length;a<p;++a)ab(f.value[a])}function Sa(f,a){var p=wa(3),b=wa(3),p=jc(f,a,p,b);ra(p[0]);ra(p[1]);return m.turnIntoCSList(p)}function jc(f,a,p,b){if(Za)return[f,a];var c=m.projectiveDistMinScal(p,f),d=m.projectiveDistMinScal(p,a),e=m.projectiveDistMinScal(b,f),g=m.projectiveDistMinScal(b,a),h=m.projectiveDistMinScal(p,b),l=m.projectiveDistMinScal(f,a),k=c+g,q=d+e,n;k>q?(n=[a,f],k=q):n=[f,a];q=function(){};if(W&&W.currentStep){var r=[W.labelTracing2,G.wrap(W.currentElement.name),m.turnIntoCSList(n),
m.turnIntoCSList([p,b]),m.realMatrix([[c,d],[e,g]]),G.wrap(k),G.wrap(h),G.wrap(l),x];W.currentStep.push(m.turnIntoCSList(r));q=function(f){W.hasOwnProperty(f)||(W[f]=G.wrap(f));r[r.length-1]=W[f]}}m._helper.isNaN(f)||m._helper.isNaN(a)?(q("Tracing failed due to NaNs."),La=!0):h>3*k&&l>3*k?q("Normal case, everything all right."):1E-5>l?1E-5>h?q("Staying inside singularity."):(q("Moved into singularity."),La=!0):1E-5>h?q("Moved out of singularity."):(db?q("Reached refinement limit, giving up."):q("Need to refine."),
Hb());return n}function Lb(f,a,p,b){var c=wa(3),d=wa(3),e=wa(3),g=wa(3);f=Ic(f,a,p,b,c,d,e,g);ra(f[0]);ra(f[1]);ra(f[2]);ra(f[3]);return m.turnIntoCSList(f)}function Ic(f,a,p,b,c,d,e,g){var h=function(){};c=[c,d,e,g];f=[f,a,p,b];if(Za)return f;d=0;b=Array(4);for(p=0;4>p;p++)for(b[p]=Array(4),g=0;4>g;g++)e=m.projectiveDistMinScal(c[p],f[g]),b[p][g]=e;e=Bb(b);a=Array(4);for(p=0;4>p;++p)a[p]=f[e[p]],d+=b[p][e[p]];var l=1*d,k=Infinity,q=Infinity;for(p=0;4>p;p++){if(m._helper.isNaN(f[p]))return h("Tracing failed due to NaNs."),
La=!0,a;for(g=p+1;4>g;g++)e=m.projectiveDistMinScal(c[p],c[g]),k>e&&(k=e),e=m.projectiveDistMinScal(a[p],a[g]),q>e&&(q=e)}if(W&&W.currentStep){var n=[W.labelTracing4,G.wrap(W.currentElement.name),m.turnIntoCSList(a),m.turnIntoCSList(c),m.realMatrix(b),G.wrap(d),G.wrap(k),G.wrap(q),x];W.currentStep.push(m.turnIntoCSList(n));h=function(f){W.hasOwnProperty(f)||(W[f]=G.wrap(f));n[n.length-1]=W[f]}}k>l&&q>l||(1E-5>q?1E-5>k?h("Staying inside singularity."):(h("Moved into singularity."),La=!0):1E-5>k?h("Moved out of singularity."):
(db?h("Reached refinement limit, giving up."):h("Need to refine."),Hb()));return a}function kc(f){var a=f.length,p,b;if(Za){for(p=0;p<a;++p)Ca+=2*f[p].value.length,ra(f[p]);return f}var c=Array(a),d=Array(a),e=Array(a),g=99,h=99,l=Array(a);for(p=0;p<a;++p)c[p]=wa(f[p].value.length),d[p]=m.normSquared(c[p]).value.real,e[p]=m.normSquared(f[p]).value.real,l[p]=Array(a);var k;for(p=0;p<a;++p){for(b=0;b<a;++b)k=m.sesquilinearproduct(c[p],f[b]).value,k=(k.real*k.real+k.imag*k.imag)/(d[p]*e[b]),l[p][b]=
1-k;for(b=p+1;b<a;++b)k=m.sesquilinearproduct(c[p],c[b]).value,k=(k.real*k.real+k.imag*k.imag)/(d[p]*d[b]),g>1-k&&(g=1-k),k=m.sesquilinearproduct(f[p],f[b]).value,k=(k.real*k.real+k.imag*k.imag)/(e[p]*e[b]),h>1-k&&(h=1-k)}k=Bb(l);b=Array(a);d=0;e=!1;for(p=0;p<a;++p){var d=d+l[p][k[p]],q=b[p]=f[k[p]];ra(q);e|=m._helper.isNaN(q)}e|=isNaN(d);f=function(){};if(W&&W.currentStep){var n=[W.labelTracingSesq,G.wrap(W.currentElement.name),m.turnIntoCSList(b),m.turnIntoCSList(c),m.realMatrix(l),G.wrap(d),G.wrap(g),
G.wrap(h),x];W.currentStep.push(m.turnIntoCSList(n));f=function(f){W.hasOwnProperty(f)||(W[f]=G.wrap(f));n[n.length-1]=W[f]}}e?(f("Tracing failed due to NaNs."),La=!0):g>3*d&&h>3*d?f("Normal case, everything all right."):1E-5>h?1E-5>g?f("Staying inside singularity."):(f("Moved into singularity."),La=!0):1E-5>g?f("Moved out of singularity."):(db?f("Reached refinement limit, giving up."):f("Need to refine."),Hb());return b}function uc(f){Ga.forEach(function(f){ba[f.behavior.type].init(f.behavior,c[f.name])})}
function wb(f){xb=0!==f.length;Ga=f;sa=[];Ga.forEach(function(f){if(f.name){var a=f.name;c[a]&&(c[a].behavior=f.behavior,ba[f.behavior.type].init(f.behavior,c[a]),"Mass"===f.behavior.type&&sa.push(c[a]))}else ba[f.behavior.type].init(f.behavior)})}var Qa=this,ya,Da={},Va=!1,lb=!0,mb=!1,jb=1,Ua=0,Sb,Tb=!1,fb,M,Aa,va,za,Ya=null,rc="           #drawgrid(s):=(              regional(b,xmin,xmax,ymin,ymax,nx,ny);              b=screenbounds();              xmin=b_4_1-s;              xmax=b_2_1+s;              ymin=b_4_2-s;              ymax=b_2_2+s;              nx=round((xmax-xmin)/s);              ny=round((ymax-ymin)/s);              xmin=floor(xmin/s)*s;              ymin=floor(ymin/s)*s;              repeat(nx,x,                 draw((xmin+x*s,ymin),(xmin+x*s,ymax),color->(1,1,1)*.9,size->1);              );              repeat(ny,y,                 draw((xmin,ymin+y*s),(xmax,ymin+y*s),color->(1,1,1)*.9,size->1);              )            );",
cb=[],yb=!1,Oa={config:a,startup:H,shutdown:P,evokeCS:function(f){f=gb(f);f=Fa(f,!1);console.log(f);I(f);ma()},play:l,pause:L,stop:J,evalcs:function(f){return I(Fa(gb(f),!1))},niceprint:ha,canvas:null},ub=!1,kb=0;a.use&&a.use.forEach(function(f){var b=null;a.plugins&&(b=a.plugins[f]);b||(b=Qa._pluginRegistry[f]);b||(++kb,console.log("Loading script for plugin "+f),Qa.loadScript(f+"-plugin",f+"-plugin.js",function(){console.log("Successfully loaded plugin "+f);0===--kb&&ub&&H()},function(){console.error("Failed to auto-load plugin "+
f);0===--kb&&ub&&H()}))});X.prototype=new O;ea.prototype=new O;ia.prototype=new O;A.prototype=new O;var qa={},xa,Ub="",Vb=0,Jc=[].slice,Mb,lc=function(f){return Jc.call(f)};if(!a.isNode){var Kc=document.documentElement;Mb=window;try{lc(Kc.childNodes)[0].nodeType}catch(Lc){lc=function(f){for(var a=f.length,p=Array(a);a--;)p[a]=f[a];return p}}}var Wb="webkit ms moz Moz o O".split(" "),Ab={},pb,qb,ob,nb,Xa,Xb=!a.isNode&&Mb[t(Mb,"requestAnimationFrame")]||function(f){setTimeout(f,17)};Ab.timer=function(f,
a,p){var b=arguments.length;2>b&&(a=0);3>b&&(p=Date.now());b={c:f,t:p+a,f:!1,n:null};qb?qb.n=b:pb=b;qb=b;ob||(nb=clearTimeout(nb),ob=1,Xb(U))};Ab.timer.flush=function(){oa();na()};var x=new ja,Nb=new ja,ca=new function(){this.vars={pi:{ctype:"variable",stack:[{ctype:"number",value:{real:Math.PI,imag:0}}],name:"pi"},i:{ctype:"variable",stack:[{ctype:"number",value:{real:0,imag:1}}],name:"i"},"true":{ctype:"variable",stack:[{ctype:"boolean",value:!0}],name:"true"},"false":{ctype:"variable",stack:[{ctype:"boolean",
value:!1}],name:"false"},"#":{ctype:"variable",stack:[x],name:"#"}};this.isVariable=function(f){return void 0!==this.vars[f]};this.isVariableName=function(f){if("#"===f||"#1"===f||"#2"===f)return!0;var a=/^[a-z,A-Z]+$/.test(f[0]);f=/^[0-9,a-z,A-Z]+$/.test(f);return a&&f};this.create=function(f){var a={ctype:"variable",stack:[Nb],name:f};return this.vars[f]=a};this.newvar=function(f){f=this.vars[f];f.stack.push(x);return f};this.removevar=function(f){var a=this.vars[f].stack;0===a.length&&console.error("Removing non-existing "+
f);a.pop();0===a.length&&console.warn("Removing last "+f)};this.setvar=function(f,a){var p=this.vars[f].stack;0===p.length&&console.error("Setting non-existing variable "+f);void 0===a&&(console.error("Setting variable "+f+" to undefined value"),a=x);if("undefined"===a.ctype)p[p.length-1]=a;else{var b=a;b===Nb&&(b=x);p[p.length-1]=b}};this.undefinedWarning={};this.getvar=function(f){var a=this.vars[f].stack;0===a.length&&console.error("Getting non-existing variable "+f);a=a[a.length-1];if(a===Nb){if(void 0!==
c[f])return{ctype:"geo",value:c[f]};console&&console.log&&void 0===this.undefinedWarning[f]&&(this.undefinedWarning[f]=!0,console.log("Warning: Accessing undefined variable: "+f));return x}return a};this.dump=function(f){var a=this.vars[f].stack;console.log("*** Dump "+f);for(f=0;f<a.length;f++)console.log(f+":> "+ha(a[f]))};this.vstack=[];this.pushVstack=function(f){this.vstack.push(f)};this.popVstack=function(){this.vstack.pop()};this.cleanVstack=function(){for(var f=this.vstack;0<f.length&&"*"!==
f[f.length-1];)this.removevar(f[f.length-1]),f.pop();0<f.length&&f.pop()}},Ja={generalFields:{color:"color",colorhsb:"",size:"size",alpha:"alpha",isshowing:"isshowing",visible:"visible",name:"name",caption:"caption",trace:"trace",tracelength:"",selected:""},getGeoField:function(f,a){return"undefined"!==typeof c[f]?Ja.getField(c[f],a):x},setGeoField:function(f,a,p){return"undefined"!==typeof c[f]?Ja.setField(c[f],a,p):x},getField:function(f,a){var p;if("P"===f.kind){if("xy"===a){p=q.div(f.homog.value[0],
f.homog.value[2]);var b=q.div(f.homog.value[1],f.homog.value[2]);p=m.turnIntoCSList([p,b]);return G.withUsage(p,"Point")}if("homog"===a)return G.withUsage(f.homog,"Point");if("x"===a)return q.div(f.homog.value[0],f.homog.value[2]);if("y"===a)return q.div(f.homog.value[1],f.homog.value[2])}if("L"===f.kind){if("homog"===a)return G.withUsage(f.homog,"Line");if("angle"===a)return p=m.eucangle(m.ey,f.homog),G.withUsage(p,"Angle")}if("Tr"===f.kind&&"matrix"===a)return f.matrix;if("C"===f.kind&&"radius"===
a){var c=f.matrix;p=c.value[0].value[0];var d=c.value[0].value[2],b=c.value[1].value[2],c=c.value[2].value[2];q.mult(p,p);d=q.div(d,p);b=q.div(b,p);p=q.div(c,p);return p=q.sqrt(q.sub(q.add(q.mult(d,d),q.mult(b,b)),p))}if(Ja.generalFields[a])return(p=f[Ja.generalFields[a]])?p:x;if(f.behavior){if("mass"===a&&"Mass"===f.behavior.type)return q.real(f.behavior.mass);if("radius"===a&&"Mass"===f.behavior.type)return q.real(f.behavior.radius);if("charge"===a&&"Mass"===f.behavior.type)return q.real(f.behavior.charge);
if("friction"===a&&"Mass"===f.behavior.type)return q.real(f.behavior.friction);if("vx"===a&&"Mass"===f.behavior.type)return q.real(f.behavior.vx);if("vy"===a&&"Mass"===f.behavior.type)return q.real(f.behavior.vy);if("v"===a&&"Mass"===f.behavior.type)return m.realVector([f.behavior.vx,f.behavior.vy]);if("fx"===a&&"Mass"===f.behavior.type)return q.real(f.behavior.fx);if("fy"===a&&"Mass"===f.behavior.type)return q.real(f.behavior.fy);if("f"===a&&"Mass"===f.behavior.type)return m.realVector([f.behavior.fx,
f.behavior.fy])}return x},setField:function(f,a,p){"color"===a&&(f.color=p);"size"===a&&(f.size=p);"alpha"===a&&(f.alpha=p);"visible"===a&&"boolean"===p.ctype&&(f.visible=p.value);"pinned"===a&&"boolean"===p.ctype&&(f.pinned=p.value);"printlabel"===a&&(f.printname=ha(p));"xy"===a&&"P"===f.kind&&f.movable&&m._helper.isNumberVecN(p,2)&&Kb(f,m.turnIntoCSList([p.value[0],p.value[1],q.real(1)]),"homog");"homog"===a&&"P"===f.kind&&f.movable&&m._helper.isNumberVecN(p,3)&&Kb(f,p,"homog");if("angle"===a&&
"Through"===f.type){var b=q.cos(p),c=q.sin(p),b=m.turnIntoCSList([b,c,q.real(0)]);Kb(f,b,"dir")}f.behavior&&("mass"===a&&"Mass"===f.behavior.type&&"number"===p.ctype&&(f.behavior.mass=p.value.real),"mass"===a&&"Sun"===f.behavior.type&&"number"===p.ctype&&(f.behavior.mass=p.value.real),"friction"===a&&"Mass"===f.behavior.type&&"number"===p.ctype&&(f.behavior.friction=p.value.real),"charge"===a&&"Mass"===f.behavior.type&&"number"===p.ctype&&(f.behavior.charge=p.value.real),"radius"===a&&"Mass"===f.behavior.type&&
"number"===p.ctype&&(f.behavior.radius=p.value.real),"vx"===a&&"Mass"===f.behavior.type&&"number"===p.ctype&&(f.behavior.vx=p.value.real),"vy"===a&&"Mass"===f.behavior.type&&"number"===p.ctype&&(f.behavior.vy=p.value.real),"v"===a&&"Mass"===f.behavior.type&&m._helper.isNumberVecN(p,2)&&(f.behavior.vx=p.value[0].value.real,f.behavior.vy=p.value[1].value.real))}},q={_helper:{}};q._helper.roundingfactor=1E4;q._helper.niceround=function(f){return Math.round(f*q._helper.roundingfactor)/q._helper.roundingfactor};
q.niceprint=function(f){var a=q._helper.niceround(f.value.real);f=q._helper.niceround(f.value.imag);return 0===f?""+a:0<f?""+a+" + i*"+f:""+a+" - i*"+-f};q.complex=function(f,a){return{ctype:"number",value:{real:f,imag:a}}};q.real=function(f){return{ctype:"number",value:{real:f,imag:0}}};q.zero=q.real(0);q.one=q.real(1);q.argmax=function(f,a){return f.value.real*f.value.real+f.value.imag*f.value.imag<a.value.real*a.value.real+a.value.imag*a.value.imag?a:f};q.max=function(f,a){return{ctype:"number",
value:{real:Math.max(f.value.real,a.value.real),imag:Math.max(f.value.imag,a.value.imag)}}};q.min=function(f,a){return{ctype:"number",value:{real:Math.min(f.value.real,a.value.real),imag:Math.min(f.value.imag,a.value.imag)}}};q.add=function(f,a){return{ctype:"number",value:{real:f.value.real+a.value.real,imag:f.value.imag+a.value.imag}}};q.sub=function(f,a){return{ctype:"number",value:{real:f.value.real-a.value.real,imag:f.value.imag-a.value.imag}}};q.neg=function(f){return{ctype:"number",value:{real:-f.value.real,
imag:-f.value.imag}}};q.re=function(f){return{ctype:"number",value:{real:f.value.real,imag:0}}};q.im=function(f){return{ctype:"number",value:{real:f.value.imag,imag:0}}};q.conjugate=function(f){return{ctype:"number",value:{real:f.value.real,imag:-f.value.imag}}};q.round=function(f){return{ctype:"number",value:{real:Math.round(f.value.real),imag:Math.round(f.value.imag)}}};q.ceil=function(f){return{ctype:"number",value:{real:Math.ceil(f.value.real),imag:Math.ceil(f.value.imag)}}};q.floor=function(f){return{ctype:"number",
value:{real:Math.floor(f.value.real),imag:Math.floor(f.value.imag)}}};q.mult=function(f,a){return{ctype:"number",value:{real:f.value.real*a.value.real-f.value.imag*a.value.imag,imag:f.value.real*a.value.imag+f.value.imag*a.value.real}}};q.realmult=function(f,a){return{ctype:"number",value:{real:f*a.value.real,imag:f*a.value.imag}}};q.multiMult=function(f){var a=f[0];if("number"!==a.ctype)return x;for(var p=1;p<f.length;p++){if("number"!==f[p].ctype)return x;a=q.mult(a,f[p])}return a};q.abs2=function(f,
a){return{ctype:"number",value:{real:f.value.real*f.value.real+f.value.imag*f.value.imag,imag:0}}};q.abs=function(f){return q.sqrt(q.abs2(f))};q.inv=function(f){var a=f.value.real*f.value.real+f.value.imag*f.value.imag;0===a&&console.error("DIVISION BY ZERO");return{ctype:"number",value:{real:f.value.real/a,imag:-f.value.imag/a}}};q.div=function(f,a){return q.mult(f,q.inv(a))};q.eps=1E-7;q.snap=function(f){var a=f.value.real;f=f.value.imag;Math.floor(a+q.eps)!==Math.floor(a-q.eps)&&(a=Math.round(a));
Math.floor(f+q.eps)!==Math.floor(f-q.eps)&&(f=Math.round(f));return{ctype:"number",value:{real:a,imag:f}}};q.exp=function(f){var a=Math.exp(f.value.real),p=a*Math.cos(f.value.imag);f=a*Math.sin(f.value.imag);return{ctype:"number",value:{real:p,imag:f}}};q.cos=function(f){var a=f.value.real,p=f.value.imag,b=Math.exp(p);f=b*Math.sin(-a);var c=b*Math.cos(-a),b=Math.exp(-p),p=b*Math.sin(a),a=b*Math.cos(a);return{ctype:"number",value:{real:(c+a)/2,imag:(f+p)/2}}};q.sin=function(f){var a=f.value.real,p=
f.value.imag,b=Math.exp(p);f=b*Math.sin(-a);var c=b*Math.cos(-a),b=Math.exp(-p),p=b*Math.sin(a),a=b*Math.cos(a);return{ctype:"number",value:{real:-(f-p)/2,imag:(c-a)/2}}};q.tan=function(f){var a=q.sin(f);f=q.cos(f);return q.div(a,f)};q.arccos=function(f){var a=q.mult(f,q.neg(f)),a=q.sqrt(q.add(q.real(1),a));f=q.add(q.mult(f,q.complex(0,1)),a);f=q.add(q.mult(q.log(f),q.complex(0,1)),q.real(.5*Math.PI));return G.withUsage(f,"Angle")};q.arcsin=function(f){var a=q.mult(f,q.neg(f)),a=q.sqrt(q.add(q.real(1),
a));f=q.add(q.mult(f,q.complex(0,1)),a);f=q.mult(q.log(f),q.complex(0,-1));return G.withUsage(f,"Angle")};q.arctan=function(f){var a=q.log(q.add(q.mult(f,q.complex(0,-1)),q.real(1)));f=q.log(q.add(q.mult(f,q.complex(0,1)),q.real(1)));a=q.mult(q.sub(a,f),q.complex(0,.5));return G.withUsage(a,"Angle")};q.arctan2=function(f,a){var p=q.real(Math.atan2(a.value.real,f.value.real));return G.withUsage(p,"Angle")};q.sqrt=function(f){var a=f.value.real,p=f.value.imag;f=Math.sqrt(Math.sqrt(a*a+p*p));a=Math.atan2(p,
a);p=f*Math.sin(a/2);return{ctype:"number",value:{real:f*Math.cos(a/2),imag:p}}};q.pow2=function(f,a){var p=f.value.real,b=f.value.imag,c=Math.pow(Math.sqrt(p*p+b*b),a),p=Math.atan2(b,p),b=c*Math.sin(p*a);return{ctype:"number",value:{real:c*Math.cos(p*a),imag:b}}};q.log=function(f){var a=f.value.real,p=f.value.imag,b=Math.sqrt(a*a+p*p);f=Math.atan2(p,a);0>p&&(f+=2*Math.PI);0===p&&0>a&&(f=Math.PI);f>Math.PI&&(f-=2*Math.PI);a=Math.log(b);return q.snap({ctype:"number",value:{real:a,imag:f}})};q.pow=
function(f,a){if(a.value.real===Math.round(a.value.real)&&0===a.value.imag){for(var p={ctype:"number",value:{real:1,imag:0}},b=0;b<Math.abs(a.value.real);b++)p=q.mult(p,f);return 0>a.value.real?q.inv(p):p}return q.exp(q.mult(q.log(f),a))};q.mod=function(f,a){var p=f.value.real,b=a.value.real,c=f.value.imag,d=a.value.imag,p=p-Math.floor(p/b)*b,c=c-Math.floor(c/d)*d;0===b&&(p=0);0===d&&(c=0);return q.snap({ctype:"number",value:{real:p,imag:c}})};q._helper.seed="NO";q.eps=1E-10;q.epsbig=1E-6;q._helper.seedrandom=
function(f){f-=Math.floor(f);q._helper.seed=.8*f+.1};q._helper.rand=function(){if("NO"===q._helper.seed)return Math.random();var f=q._helper.seed,f=1E3*Math.sin(1E3*f),f=f-Math.floor(f);return q._helper.seed=f};q._helper.randnormal=function(){var f=q._helper.rand(),a=q._helper.rand();return Math.sqrt(-2*Math.log(f))*Math.cos(2*Math.PI*a)};q._helper.isEqual=function(f,a){return f.value.real===a.value.real&&f.value.imag===a.value.imag};q._helper.isLessThan=function(f,a){return f.value.real<a.value.real||
f.value.real===a.value.real&&f.value.imag<a.value.imag};q._helper.compare=function(f,a){return q._helper.isLessThan(f,a)?-1:q._helper.isEqual(f,a)?0:1};q._helper.isAlmostEqual=function(f,a,p){var b=q.eps;"undefined"!==typeof p&&(b=p);p=f.value.real-a.value.real;f=f.value.imag-a.value.imag;return p<b&&p>-b&&f<b&&f>-b};q._helper.isZero=function(f){return 0===f.value.real&&0===f.value.imag};q._helper.isAlmostZero=function(f){var a=f.value.real;f=f.value.imag;return a<q.eps&&a>-q.eps&&f<q.eps&&f>-q.eps};
q._helper.isReal=function(f){return 0===f.value.imag};q._helper.isAlmostReal=function(f){f=f.value.imag;return f<q.epsbig&&f>-q.epsbig};q._helper.isNaN=function(f){return isNaN(f.value.real)||isNaN(f.value.imag)};q._helper.isAlmostImag=function(f){f=f.value.real;return f<q.epsbig&&f>-q.epsbig};q._helper.z3a=q.complex(-.5,.5*Math.sqrt(3));q._helper.z3b=q.complex(-.5,-.5*Math.sqrt(3));q._helper.cub1={ctype:"list",value:[q.one,q.one,q.one]};q._helper.cub2={ctype:"list",value:[q._helper.z3a,q.one,q._helper.z3b]};
q._helper.cub3={ctype:"list",value:[q._helper.z3b,q.one,q._helper.z3a]};q.solveCubic=function(f,a,p,b){f=q._helper.solveCubicHelper(f,a,p,b);return[m.scalproduct(q._helper.cub1,f),m.scalproduct(q._helper.cub2,f),m.scalproduct(q._helper.cub3,f)]};q._helper.solveCubicHelper=function(f,a,p,b){var c=f.value.real;f=f.value.imag;var d=a.value.real;a=a.value.imag;var e=p.value.real,g=p.value.imag,h=b.value.real,l=b.value.imag;p=c*e-f*g;b=c*g+f*e;var k=4*p-(d*d-a*a),n=4*b-2*d*a,r=c*d-f*a,t=c*a+f*d,u=k*e-
n*g-18*(r*h-t*l),n=k*g+n*e-18*(r*l+t*h),v=27*(c*c-f*f),w=54*f*c,k=v*h-w*l,x=v*l+w*h,y=d*d-a*a,v=2*d*a,z=y*d-v*a,A=y*a+v*d,w=k+4*z,B=x+4*A,z=-2*z+9*(r*e-t*g),A=-2*A+9*(r*g+t*e),z=z-k,A=A-x,k=27*(u*e-n*g+w*h-B*l),n=27*(u*g+n*e+w*l+B*h),w=Math.sqrt(Math.sqrt(k*k+n*n)),B=Math.atan2(n,k),n=w*Math.sin(B/2),k=w*Math.cos(B/2),z=z+(k*c-n*f),A=A+(k*f+n*c),e=Math.exp(Math.log(Math.sqrt(z*z+A*A))/3),n=Math.atan2(A,z),w=e*Math.sin(n/3),B=e*Math.cos(n/3),e=e*e,n=2*n,k=e*Math.sin(n/3),e=e*Math.cos(n/3);p=2*y-6*
p;b=2*v-6*b;v=-1.5874010519681996*(d*B-a*w);d=-1.5874010519681996*(d*w+a*B);a=1.2599210498948732*e;y=1.2599210498948732*k;k=4.762203155904599*(B*c-w*f);n=4.762203155904599*(B*f+w*c);c=k*k+n*n;w=(p*k+b*n)/c;B=(-p*n+b*k)/c;p=w;b=B;w=(v*k+d*n)/c;B=(-v*n+d*k)/c;v=w;d=B;w=(a*k+y*n)/c;B=(-a*n+y*k)/c;a=w;y=B;return m.turnIntoCSList([q.complex(p,b),q.complex(v,d),q.complex(a,y)])};var m={_helper:{},turnIntoCSList:function(f){return{ctype:"list",value:f}},realVector:function(f){for(var a=[],p=0;p<f.length;p++)a[p]=
{ctype:"number",value:{real:f[p],imag:0}};return{ctype:"list",value:a}}};m._helper.unitvector=function(f,a){var p=m.zerovector(f);p.value[Math.floor(a.value.real-1)]=q.real(1);return p};m.idMatrix=function(f){for(var a=m.zeromatrix(f,f),p=q.real(1),b=0;b<f.value.real;b++)a.value[b].value[b]=p;return a};m._helper.flippedidMatrix=function(f){for(var a=m.zeromatrix(f,f),p=q.real(1),b=0;b<f.value.real;b++)a.value[b].value[f.value.real-b-1]=p;return a};m.println=function(f){for(var a=[],p=0;p<f.value.length;p++)if("number"===
f.value[p].ctype)a[p]=q.niceprint(f.value[p]);else if("list"===f.value[p].ctype)m.println(f.value[p]);else return x;"number"===f.value[0].ctype&&console.log(a)};m.realMatrix=function(f){for(var a=f.length,p=Array(a),b=0;b<a;b++)p[b]=m.realVector(f[b]);return m.turnIntoCSList(p)};m.ex=m.realVector([1,0,0]);m.ey=m.realVector([0,1,0]);m.ez=m.realVector([0,0,1]);m.linfty=m.realVector([0,0,1]);m.ii=m.turnIntoCSList([q.complex(1,0),q.complex(0,1),q.complex(0,0)]);m.jj=m.turnIntoCSList([q.complex(1,0),q.complex(0,
-1),q.complex(0,0)]);m.fundDual=m.realMatrix([[1,0,0],[0,1,0],[0,0,0]]);m.fund=m.realMatrix([[0,0,0],[0,0,0],[0,0,1]]);m.sequence=function(f,a){for(var p=[],b=0,c=Math.round(f.value.real);c<Math.round(a.value.real)+1;c++)p[b]={ctype:"number",value:{real:c,imag:0}},b++;return{ctype:"list",value:p}};m.pairs=function(f){for(var a=[],p=0;p<f.value.length-1;p++)for(var b=p+1;b<f.value.length;b++)a.push({ctype:"list",value:[f.value[p],f.value[b]]});return{ctype:"list",value:a}};m.triples=function(f){for(var a=
[],p=0;p<f.value.length-2;p++)for(var b=p+1;b<f.value.length-1;b++)for(var c=b+1;c<f.value.length;c++)a.push({ctype:"list",value:[f.value[p],f.value[b],f.value[c]]});return{ctype:"list",value:a}};m.triples=function(f){for(var a=[],p=0;p<f.value.length-2;p++)for(var b=p+1;b<f.value.length-1;b++)for(var c=b+1;c<f.value.length;c++)a.push({ctype:"list",value:[f.value[p],f.value[b],f.value[c]]});return{ctype:"list",value:a}};m.cycle=function(f){for(var a=[],p=0;p<f.value.length-1;p++)a[p]={ctype:"list",
value:[f.value[p],f.value[p+1]]};a.push({ctype:"list",value:[f.value[f.value.length-1],f.value[0]]});return{ctype:"list",value:a}};m.consecutive=function(f){for(var a=[],p=0;p<f.value.length-1;p++)a[p]={ctype:"list",value:[f.value[p],f.value[p+1]]};return{ctype:"list",value:a}};m.reverse=function(f){for(var a=[],p=f.value.length-1;0<=p;p--)a.push(f.value[p]);return{ctype:"list",value:a}};m.directproduct=function(f,a){for(var p=[],b=0;b<f.value.length;b++)for(var c=0;c<a.value.length;c++)p.push({ctype:"list",
value:[f.value[b],a.value[c]]});return{ctype:"list",value:p}};m.concat=function(f,a){for(var p=[],b=0;b<f.value.length;b++)p.push(f.value[b]);for(b=0;b<a.value.length;b++)p.push(a.value[b]);return{ctype:"list",value:p}};m.prepend=function(f,a){var p=[];p[0]=f;for(var b=0;b<a.value.length;b++)p[b+1]=a.value[b];return{ctype:"list",value:p}};m.append=function(f,a){for(var p=[],b=0;b<f.value.length;b++)p[b]=f.value[b];p.push(a);return{ctype:"list",value:p}};m.contains=function(f,a){for(var p=0;p<f.value.length;p++)if(Q.equals(f.value[p],
a).value)return{ctype:"boolean",value:!0};return{ctype:"boolean",value:!1}};m.common=function(f,a){for(var p=[],b=0,c=0;c<f.value.length;c++){for(var d=!1,e=f.value[c],g=0;g<a.value.length;g++)d=d||Q.equals(e,a.value[g]).value;d&&(p[b]=f.value[c],b++)}return{ctype:"list",value:p}};m.remove=function(f,a){for(var p=[],b=0,c=0;c<f.value.length;c++){for(var d=!1,e=f.value[c],g=0;g<a.value.length;g++)d=d||Q.equals(e,a.value[g]).value;d||(p[b]=f.value[c],b++)}return{ctype:"list",value:p}};m._helper.compare=
function(f,a){return"number"===f.ctype&&"number"===a.ctype?f.value.real-a.value.real:-1};m.sort1=function(f){f=f.value.slice();f.sort(G.compare);return m.turnIntoCSList(f)};m._helper.isEqual=function(f,a){return m.equals(f,a).value};m._helper.isLessThan=function(f,a){for(var p=f.value.length,b=a.value.length,c=0;!(c>=p||c>=b)&&G.isEqual(f.value[c],a.value[c]);)c++;return c===p&&c<b?!0:c===b&&c<p||c===p&&c===b?!1:G.isLessThan(f.value[c],a.value[c])};m._helper.compare=function(f,a){return m._helper.isLessThan(f,
a)?-1:m._helper.isEqual(f,a)?0:1};m.equals=function(f,a){if(f.value.length!==a.value.length)return{ctype:"boolean",value:!1};for(var p=!0,b=0;b<f.value.length;b++)var c=f.value[b],d=a.value[b],p="list"===c.ctype&&"list"===d.ctype?p&&m.equals(c,d).value:p&&Na([c,d],[]).value;return{ctype:"boolean",value:p}};m.almostequals=function(f,a){if(f.value.length!==a.value.length)return{ctype:"boolean",value:!1};for(var p=!0,b=0;b<f.value.length;b++)var c=f.value[b],d=a.value[b],p="list"===c.ctype&&"list"===
d.ctype?p&&m.comp_almostequals(c,d).value:p&&Pa([c,d],[]).value;return{ctype:"boolean",value:p}};m._helper.isAlmostReal=function(f){for(var a=!0,p=0;p<f.value.length;p++)var b=f.value[p],a="list"===b.ctype?a&&m._helper.isAlmostReal(b):a&&q._helper.isAlmostReal(b);return a};m._helper.isAlmostZero=function(f){for(var a=0;a<f.value.length;a++){var p=f.value[a];if("list"===p.ctype){if(!m._helper.isAlmostZero(p))return!1}else if(!q._helper.isAlmostZero(p))return!1}return!0};m._helper.isNaN=function(f){for(var a=
!1,p=0;p<f.value.length;p++)var b=f.value[p],a="list"===b.ctype?a||m._helper.isNaN(b):a||q._helper.isNaN(b);return a};m.set=function(f){var a=[],p=0;f=f.value.slice();f.sort(G.compare);for(var b=0;b<f.length;b++)0!==b&&Na([a[a.length-1],f[b]],[]).value||(a[p]=f[b],p++);return{ctype:"list",value:a}};m.maxval=function(f){for(var a=q.zero,p=0;p<f.value.length;p++){var b=f.value[p];"number"===b.ctype&&(a=q.argmax(a,b));"list"===b.ctype&&(a=q.argmax(a,m.maxval(b)))}return a};m.maxIndex=function(f,a,p){var b=
0;void 0!==p&&(b=p);p=b;for(var c=a(f.value[b]).value.real;b<f.value.length;++b){var d=a(f.value[b]).value.real;d>c&&(p=b,c=d)}return p};m.normalizeMax=function(f){var a=q.inv(m.maxval(f));return m.scalmult(a,f)};m.normalizeZ=function(f){var a=q.inv(f.value[2]);return m.scalmult(a,f)};m.normalizeAbs=function(f){var a=q.inv(m.abs(f));return m.scalmult(a,f)};m.max=function(f,a){if(f.value.length!==a.value.length)return x;for(var p=[],b=0;b<f.value.length;b++)p[b]=G.max(f.value[b],a.value[b]);return{ctype:"list",
value:p}};m.min=function(f,a){if(f.value.length!==a.value.length)return x;for(var p=[],b=0;b<f.value.length;b++)p[b]=G.min(f.value[b],a.value[b]);return{ctype:"list",value:p}};m.scaldiv=function(f,a){if("number"!==f.ctype)return x;for(var p=[],b=0;b<a.value.length;b++){var c=a.value[b];p[b]="number"===c.ctype?G.div(c,f):"list"===c.ctype?m.scaldiv(f,c):x}return{ctype:"list",value:p}};m.scalmult=function(f,a){if("number"!==f.ctype)return x;for(var p=[],b=0;b<a.value.length;b++){var c=a.value[b];p[b]=
"number"===c.ctype?G.mult(c,f):"list"===c.ctype?m.scalmult(f,c):x}return{ctype:"list",value:p}};m.add=function(f,a){if(f.value.length!==a.value.length)return x;for(var p=[],b=0;b<f.value.length;b++){var c=f.value[b],d=a.value[b];p[b]="number"===c.ctype&&"number"===d.ctype?G.add(c,d):"list"===c.ctype&&"list"===d.ctype?m.add(c,d):x}return{ctype:"list",value:p}};m.sub=function(f,a){if(f.value.length!==a.value.length)return x;for(var p=[],b=0;b<f.value.length;b++){var c=f.value[b],d=a.value[b];p[b]="number"===
c.ctype&&"number"===d.ctype?q.sub(c,d):"list"===c.ctype&&"list"===d.ctype?m.sub(c,d):x}return{ctype:"list",value:p}};m.abs2=function(f){for(var a=0,p=0;p<f.value.length;p++){var b=f.value[p];if("number"===b.ctype)a+=q.abs2(b).value.real;else if("list"===b.ctype)a+=m.abs2(b).value.real;else return x}return{ctype:"number",value:{real:a,imag:0}}};m.abs=function(f){return q.sqrt(m.abs2(f))};m.normalizeMaxXX=function(f){for(var a=-1E4,p=q.real(1),b=0;b<f.value.length;b++){var c=q.abs(f.value[b]);c.value.real>
a&&(p=f.value[b],a=c.value.real)}return m.scaldiv(p,f)};m.recursive=function(f,a){for(var p=[],b=0;b<f.value.length;b++){var c=N(f.value[b]);p[b]="number"===c.ctype?q[a](c):"list"===c.ctype?m[a](c):x}return{ctype:"list",value:p}};m.re=function(f){return m.recursive(f,"re")};m.neg=function(f){return m.recursive(f,"neg")};m.im=function(f){return m.recursive(f,"im")};m.conjugate=function(f){return m.recursive(f,"conjugate")};m.transjugate=function(f){return m.transpose(m.conjugate(f))};m.round=function(f){return m.recursive(f,
"round")};m.ceil=function(f){return m.recursive(f,"ceil")};m.floor=function(f){return m.recursive(f,"floor")};m._helper.colNumb=function(f){if("list"!==f.ctype)return-1;for(var a=-1,p=0;p<f.value.length;p++){if("list"!==f.value[p].ctype)return-1;if(0===p)a=f.value[p].value.length;else if(a!==f.value[p].value.length)return-1}return a};m._helper.isNumberVecN=function(f,a){if("list"!==f.ctype||f.value.length!==a)return!1;for(var p=0;p<f.value.length;p++)if("number"!==f.value[p].ctype)return!1;return!0};
m.isNumberVector=function(f){if("list"!==f.ctype)return{ctype:"boolean",value:!1};for(var a=0;a<f.value.length;a++)if("number"!==f.value[a].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};m.isNumberVectorN=function(f,a){if("list"!==f.ctype)return{ctype:"boolean",value:!1};if(f.value)for(var p=0;p<f.value.length;p++)if("number"!==f.value[p].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};m.isNumberMatrix=function(f){if(-1===m._helper.colNumb(f))return{ctype:"boolean",
value:!1};for(var a=0;a<f.value.length;a++)if(!m.isNumberVector(f.value[a]).value)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};m.scalproduct=function(f,a){if(f.value.length!==a.value.length)return x;for(var p={ctype:"number",value:{real:0,imag:0}},b=0;b<a.value.length;b++){var c=f.value[b],d=a.value[b];if("number"===c.ctype&&"number"===d.ctype)p=q.add(q.mult(c,d),p);else return x}return p};m.sesquilinearproduct=function(f,a){if(f.value.length!==a.value.length)return x;for(var p=
0,b=0,c=0;c<a.value.length;c++)var d=f.value[c].value,e=a.value[c].value,p=p+(d.real*e.real+d.imag*e.imag),b=b+(d.real*e.imag-d.imag*e.real);return q.complex(p,b)};m.normSquared=function(f){for(var a=0,p=0;p<f.value.length;p++)var b=f.value[p].value,a=a+(b.real*b.real+b.imag*b.imag);return q.real(a)};m.productMV=function(f,a){if(f.value[0].value.length!==a.value.length)return x;for(var p=[],b=0;b<f.value.length;b++){for(var c={ctype:"number",value:{real:0,imag:0}},d=f.value[b],e=0;e<a.value.length;e++){var g=
d.value[e],h=a.value[e];if("number"===g.ctype&&"number"===h.ctype)c=q.add(q.mult(g,h),c);else return x}p[b]=c}return m.turnIntoCSList(p)};m.productVM=function(f,a){if(f.value.length!==a.value.length)return x;for(var p=[],b=0;b<a.value[0].value.length;b++){for(var c={ctype:"number",value:{real:0,imag:0}},d=0;d<f.value.length;d++){var e=f.value[d],g=a.value[d].value[b];if("number"===e.ctype&&"number"===g.ctype)c=q.add(q.mult(e,g),c);else return x}p[b]=c}return m.turnIntoCSList(p)};m.productMM=function(f,
a){if(f.value[0].value.length!==a.value.length)return x;for(var p=[],b=0;b<f.value.length;b++){var c=m.productVM(f.value[b],a);p[b]=c}return m.turnIntoCSList(p)};m.mult=function(f,a){return f.value.length===a.value.length&&m.isNumberVector(f).value&&m.isNumberVector(a).value?m.scalproduct(f,a):m.isNumberMatrix(f).value&&a.value.length===f.value[0].value.length&&m.isNumberVector(a).value?m.productMV(f,a):m.isNumberMatrix(a).value&&f.value.length===a.value.length&&m.isNumberVector(f).value?m.productVM(f,
a):m.isNumberMatrix(f).value&&m.isNumberMatrix(a)&&a.value.length===f.value[0].value.length?m.productMM(f,a):x};m.projectiveDistMinScal=function(f,a){var p=m.abs(f),b=m.abs(a);if(0===p.value.real||0===b.value.real)return 0;var c=m.conjugate(a),c=m.scalproduct(f,c),c=q._helper.isAlmostZero(c)?q.real(1):q.div(c,q.abs(c)),p=m.scaldiv(p,f),b=m.scaldiv(b,a),b=m.scalmult(c,b),c=m.abs(m.add(p,b)),b=m.abs(m.sub(p,b));return Math.min(c.value.real,b.value.real)};m.crossOperator=function(f){var a=f.value[0],
p=f.value[1];f=f.value[2];return m.turnIntoCSList([m.turnIntoCSList([q.zero,q.neg(f),p]),m.turnIntoCSList([f,q.zero,q.neg(a)]),m.turnIntoCSList([q.neg(p),a,q.zero])])};m.cross=function(f,a){var p=q.sub(q.mult(f.value[1],a.value[2]),q.mult(f.value[2],a.value[1])),b=q.sub(q.mult(f.value[2],a.value[0]),q.mult(f.value[0],a.value[2])),c=q.sub(q.mult(f.value[0],a.value[1]),q.mult(f.value[1],a.value[0]));return m.turnIntoCSList([p,b,c])};m.crossratio3harm=function(f,a,p,b,c){var d=m.det3(f,p,c),e=m.det3(a,
b,c);f=m.det3(f,b,c);a=m.det3(a,p,c);d=q.mult(d,e);e=q.mult(f,a);return m.turnIntoCSList([d,e])};m.crossratio3=function(f,a,p,b,c){f=m.crossratio3harm(f,a,p,b,c);return q.div(f.value[0],f.value[1])};m.veronese=function(f){var a=q.mult(f.value[0],f.value[0]),p=q.mult(f.value[1],f.value[1]),b=q.mult(f.value[2],f.value[2]),c=q.mult(f.value[0],f.value[1]),d=q.mult(f.value[0],f.value[2]);f=q.mult(f.value[1],f.value[2]);return m.turnIntoSCList([a,p,b,c,d,f])};m.matrixFromVeronese=function(f){var a=f.value[0],
p=f.value[1],b=f.value[2],c=q.realmult(.5,f.value[3]),d=q.realmult(.5,f.value[4]);f=q.realmult(.5,f.value[5]);return m.turnIntoCSList([m.turnIntoCSList([a,c,d]),m.turnIntoCSList([c,p,f]),m.turnIntoCSList([d,f,b])])};m.det2=function(f,a){var p=q.mult(f.value[0],a.value[1]);return p=q.sub(p,q.mult(f.value[1],a.value[0]))};m.det3=function(f,a,p){return q.complex(f.value[0].value.real*a.value[1].value.real*p.value[2].value.real-f.value[0].value.imag*a.value[1].value.imag*p.value[2].value.real-f.value[0].value.imag*
a.value[1].value.real*p.value[2].value.imag-f.value[0].value.real*a.value[1].value.imag*p.value[2].value.imag+f.value[2].value.real*a.value[0].value.real*p.value[1].value.real-f.value[2].value.imag*a.value[0].value.imag*p.value[1].value.real-f.value[2].value.imag*a.value[0].value.real*p.value[1].value.imag-f.value[2].value.real*a.value[0].value.imag*p.value[1].value.imag+f.value[1].value.real*a.value[2].value.real*p.value[0].value.real-f.value[1].value.imag*a.value[2].value.imag*p.value[0].value.real-
f.value[1].value.imag*a.value[2].value.real*p.value[0].value.imag-f.value[1].value.real*a.value[2].value.imag*p.value[0].value.imag-f.value[0].value.real*a.value[2].value.real*p.value[1].value.real+f.value[0].value.imag*a.value[2].value.imag*p.value[1].value.real+f.value[0].value.imag*a.value[2].value.real*p.value[1].value.imag+f.value[0].value.real*a.value[2].value.imag*p.value[1].value.imag-f.value[2].value.real*a.value[1].value.real*p.value[0].value.real+f.value[2].value.imag*a.value[1].value.imag*
p.value[0].value.real+f.value[2].value.imag*a.value[1].value.real*p.value[0].value.imag+f.value[2].value.real*a.value[1].value.imag*p.value[0].value.imag-f.value[1].value.real*a.value[0].value.real*p.value[2].value.real+f.value[1].value.imag*a.value[0].value.imag*p.value[2].value.real+f.value[1].value.imag*a.value[0].value.real*p.value[2].value.imag+f.value[1].value.real*a.value[0].value.imag*p.value[2].value.imag,-f.value[0].value.imag*a.value[1].value.imag*p.value[2].value.imag+f.value[0].value.imag*
a.value[1].value.real*p.value[2].value.real+f.value[0].value.real*a.value[1].value.real*p.value[2].value.imag+f.value[0].value.real*a.value[1].value.imag*p.value[2].value.real-f.value[2].value.imag*a.value[0].value.imag*p.value[1].value.imag+f.value[2].value.imag*a.value[0].value.real*p.value[1].value.real+f.value[2].value.real*a.value[0].value.real*p.value[1].value.imag+f.value[2].value.real*a.value[0].value.imag*p.value[1].value.real-f.value[1].value.imag*a.value[2].value.imag*p.value[0].value.imag+
f.value[1].value.imag*a.value[2].value.real*p.value[0].value.real+f.value[1].value.real*a.value[2].value.real*p.value[0].value.imag+f.value[1].value.real*a.value[2].value.imag*p.value[0].value.real+f.value[0].value.imag*a.value[2].value.imag*p.value[1].value.imag-f.value[0].value.imag*a.value[2].value.real*p.value[1].value.real-f.value[0].value.real*a.value[2].value.real*p.value[1].value.imag-f.value[0].value.real*a.value[2].value.imag*p.value[1].value.real+f.value[2].value.imag*a.value[1].value.imag*
p.value[0].value.imag-f.value[2].value.imag*a.value[1].value.real*p.value[0].value.real-f.value[2].value.real*a.value[1].value.real*p.value[0].value.imag-f.value[2].value.real*a.value[1].value.imag*p.value[0].value.real+f.value[1].value.imag*a.value[0].value.imag*p.value[2].value.imag-f.value[1].value.imag*a.value[0].value.real*p.value[2].value.real-f.value[1].value.real*a.value[0].value.real*p.value[2].value.imag-f.value[1].value.real*a.value[0].value.imag*p.value[2].value.real)};m.det4m=function(f){var a=
f.value,p=a[0].value,b=p[0].value,c=+b.real,d=+b.imag,b=p[1].value,e=+b.real,g=+b.imag,b=p[2].value,h=+b.real,m=+b.imag,b=p[3].value,l=+b.real,k=+b.imag,p=a[1].value,b=p[0].value,n=+b.real,r=+b.imag,b=p[1].value,t=+b.real,u=+b.imag,b=p[2].value,v=+b.real,w=+b.imag,b=p[3].value,p=+b.real,b=+b.imag;f=c*t-d*u-e*n+g*r;var x=c*u+d*t-e*r-g*n,y=c*v-d*w-h*n+m*r,z=c*w+d*v-h*r-m*n,A=c*p-d*b-l*n+k*r,B=c*b+d*p-l*r-k*n,D=e*v-g*w-h*t+m*u,C=e*w+g*v-h*u-m*t,E=e*p-g*b-l*t+k*u,G=e*b+g*p-l*u-k*t,F=h*p-m*b-l*v+k*w,H=
h*b+m*p-l*w-k*v,p=a[2].value,b=p[0].value,c=+b.real,d=+b.imag,b=p[1].value,e=+b.real,g=+b.imag,b=p[2].value,h=+b.real,m=+b.imag,b=p[3].value,l=+b.real,k=+b.imag,p=a[3].value,b=p[0].value,n=+b.real,r=+b.imag,b=p[1].value,t=+b.real,u=+b.imag,b=p[2].value,v=+b.real,w=+b.imag,b=p[3].value,p=+b.real,b=+b.imag,a=c*t-d*u-e*n+g*r,I=c*u+d*t-e*r-g*n,K=c*v-d*w-h*n+m*r,J=c*w+d*v-h*r-m*n,M=c*p-d*b-l*n+k*r,c=c*b+d*p-l*r-k*n,d=e*v-g*w-h*t+m*u,n=e*w+g*v-h*u-m*t,r=e*p-g*b-l*t+k*u,e=e*b+g*p-l*u-k*t,g=h*p-m*b-l*v+k*
w,h=h*b+m*p-l*w-k*v;return q.complex(f*g-x*h-y*r+z*e+A*d-B*n+D*M-C*c-E*K+G*J+F*a-H*I,f*h+x*g-y*e-z*r+A*n+B*d+D*c+C*M-E*J-G*K+F*I+H*a)};m.eucangle=function(f,a){var p=m.cross(f,m.linfty),b=m.cross(a,m.linfty),c=m.det3(m.ez,p,m.ii),p=m.det3(m.ez,p,m.jj),d=m.det3(m.ez,b,m.ii),b=m.det3(m.ez,b,m.jj),c=q.div(q.mult(c,b),q.mult(d,p)),c=q.log(c);return c=q.mult(c,q.complex(0,.5))};m.zerovector=function(f){f=Math.floor(f.value.real);for(var a=Array(f),p=0;p<f;p++)a[p]=0;return m.realVector(a)};m.zeromatrix=
function(f,a){for(var p=Math.floor(f.value.real),b=Array(p),c=0;c<p;c++)b[c]=m.zerovector(a);return m.turnIntoCSList(b)};m.vandermonde=function(f){for(var a=f.value.length,p=m.zeromatrix(a,a),b=0;b<a;b++)for(var c=0;c<a;c++)p.value[b].value[c]=q.pow(f.value[b],q.real(c-1));return p};m.transpose=function(f){for(var a=[],p=f.value[0].value.length,b=f.value.length,c=0;c<p;c++){for(var d=[],e=0;e<b;e++)d[e]=f.value[e].value[c];a[c]=m.turnIntoCSList(d)}return m.turnIntoCSList(a)};m.column=function(f,a){for(var p=
[],b=f.value.length,c=Math.floor(a.value.real-1),d=0;d<b;d++)p[d]=f.value[d].value[c];return m.turnIntoCSList(p)};m.row=function(f,a){for(var p=[],b=f.value[0].value.length,c=Math.floor(a.value.real-1),d=0;d<b;d++)p[d]=f.value[c].value[d];return m.turnIntoCSList(p)};m.adjoint2=function(f){var a=f.value[0].value[0],p=f.value[1].value[0],b=Array(2);b[0]=m.turnIntoCSList([f.value[1].value[1],q.neg(f.value[0].value[1])]);b[1]=m.turnIntoCSList([q.neg(p),a]);return b=m.turnIntoCSList(b)};m.adjoint3=function(f){var a,
p,b,c,d,e,g,h,m,l,k,q,n,r,t,u,v;a=f.value[0].value;p=a[0].value;b=p.real;c=p.imag;p=a[1].value;d=p.real;e=p.imag;p=a[2].value;g=p.real;h=p.imag;a=f.value[1].value;p=a[0].value;m=p.real;l=p.imag;p=a[1].value;k=p.real;q=p.imag;p=a[2].value;n=p.real;r=p.imag;a=f.value[2].value;p=a[0].value;f=p.real;t=p.imag;p=a[1].value;u=p.real;v=p.imag;p=a[2].value;a=p.real;p=p.imag;return{ctype:"list",value:[{ctype:"list",value:[{ctype:"number",value:{real:k*a-n*u-q*p+r*v,imag:k*p-n*v-u*r+a*q}},{ctype:"number",value:{real:-d*
a+g*u+e*p-h*v,imag:-d*p+g*v+u*h-a*e}},{ctype:"number",value:{real:d*n-g*k-e*r+h*q,imag:d*r-g*q-k*h+n*e}}]},{ctype:"list",value:[{ctype:"number",value:{real:-m*a+n*f+l*p-r*t,imag:-m*p+n*t+f*r-a*l}},{ctype:"number",value:{real:b*a-g*f-c*p+h*t,imag:b*p-g*t-f*h+a*c}},{ctype:"number",value:{real:-b*n+g*m+c*r-h*l,imag:-b*r+g*l+m*h-n*c}}]},{ctype:"list",value:[{ctype:"number",value:{real:m*u-k*f-l*v+q*t,imag:m*v-k*t-f*q+u*l}},{ctype:"number",value:{real:-b*u+d*f+c*v-e*t,imag:-b*v+d*t+f*e-u*c}},{ctype:"number",
value:{real:b*k-d*m-c*q+e*l,imag:b*q-d*l-m*e+k*c}}]}]}};m.inverse=function(f){var a=f.value.length;if(a!==f.value[0].value.length)return console.log("Inverse works only for square matrices"),x;if(2===a)return m.scaldiv(m.det(f),m.adjoint2(f));if(3===a)return m.scaldiv(m.det(f),m.adjoint3(f));a=m.LUdecomp(f);f=f.value.length;var p=q.real(0),b=q.real(1),c=m.zerovector(q.real(f));c.value[0]=b;for(var d=Array(f),e=0;e<f;e++)d[e]=m._helper.LUsolve(a,c),c.value[e]=p,c.value[e+1]=b;d=m.turnIntoCSList(d);
return d=m.transpose(d)};m.linearsolve=function(f,a){return 2===f.value.length?m.linearsolveCramer2(f,a):3===f.value.length?m.linearsolveCramer3(f,a):m.LUsolve(f,a)};m.getDiag=function(f){if(f.value.length!==f.value[0].value.length)return x;for(var a=Array(f.value.length),p=0;p<f.value.length;p++)a[p]=f.value[p].value[p];return m.turnIntoCSList(a)};m.getSubDiag=function(f){if(f.value.length!==f.value[0].value.length)return x;for(var a=Array(f.value.length-1),p=0;p<f.value.length-1;p++)a[p]=f.value[p+
1].value[p];return m.turnIntoCSList(a)};m.eig2=function(f){var a=q.add(f.value[0].value[0],f.value[1].value[1]);f=m.det2(f.value[0],f.value[1]);var p=q.mult(a,a),b=a=q.mult(a,q.real(.5));f=q.sqrt(q.sub(q.div(p,q.real(4)),f));a=q.add(a,f);b=q.sub(b,f);return m.turnIntoCSList([a,b])};m.eig=function(f,a){var p=a||!0,b=f,c=q.real(b.value.length),d=c.value.real;q.real(0);var b=m._helper.QRIteration(b)[0],b=m.getDiag(b),b=m.sort1(b),c=m.idMatrix(c,c),e=Array(d),e=m.turnIntoCSList(e);if(p){for(var g,h,l,
k=0,n=!1,p=0;p<d;p++)n?h=g.value[k]:(g=b.value[p],g=m.sub(f,m.scalmult(g,c)),g=m.nullSpace(g),h=g.value[0],void 0!==h&&(l=h)),void 0===h&&(h=l),1E-8>m.abs(h).value.real&&0===k&&(h=m._helper.inverseIteration(f,b.value[p])),e.value[p]=m._helper.isAlmostZeroVec(h)?h:m.scaldiv(m.abs(h),h),p<d-1&&((n=1E-6>q.abs(q.sub(b.value[p],b.value[p+1])).value.real)?k++:k=0);e=m.transpose(e)}return m.turnIntoCSList([b,e])};m._helper.isNormalMatrix=function(f){return 1E-10>m.abs(m.sub(f,m.transjugate(f))).value.real};
m._helper.QRIteration=function(f,a){var p,b=f;p=q.real(b.value.length);var c=p.value.real,d=p.value.real;q.real(0);var e=m.idMatrix(p,p),g=m.zeromatrix(p,p),h=m.idMatrix(p,p),l=a?a:2500,k,n,r,t=0,u=Array(d);for(p=0;p<l;p++){e=m._helper.getBlock(b,[d-2,d-1],[d-2,d-1]);k=m.eig2(e);e=k.value[0];k=k.value[1];m.abs(e);m.abs(k);n=b.value[d-1].value[d-1];r=q.abs(q.sub(n,e)).value.real;n=q.abs(q.sub(n,k)).value.real;k=r<n?e:k;e=m.idMatrix(q.real(d),q.real(d));k=m.scalmult(k,e);e=m.QRdecomp(m.sub(b,k));b=
G.mult(e.R,e.Q);b=m.add(b,k);e.Q=m._helper.buildBlockMatrix(e.Q,m.idMatrix(q.real(t),q.real(t)));h=G.mult(h,e.Q);if(1E-48>q.abs2(b.value[b.value.length-1].value[b.value[0].value.length-2]).value.real&&1<d){u[c-t-1]=b.value[d-1].value[d-1];for(p=0;p<d;p++)g.value[d-1].value[p]=b.value[d-1].value[p],g.value[p].value[d-1]=b.value[p].value[d-1];b=m._helper.getBlock(b,[0,d-2],[0,d-2]);t++;d--}if(1===d){g.value[0].value[0]=b.value[0].value[0];break}if(m._helper.isUpperTriangular(b)){for(p=0;p<d;p++)g.value[p].value[p]=
b.value[p].value[p];break}}return[g,h]};m.rank=function(f,a){return m.RRQRdecomp(f,a).rank};m._helper.isAlmostZeroVec=function(f){for(var a=f.value.length,p=0;p<a;p++)if(!q._helper.isAlmostZero(f.value[p]))return!1;return!0};m._helper.isLowerTriangular=function(f){for(var a=f.value.length,p=f.value[0].value.length,b=0;b<a;b++)for(var c=b+1;c<p;c++)if(!q._helper.isAlmostZero(f.value[b].value[c]))return!1;return!0};m._helper.isUpperTriangular=function(f){return m._helper.isLowerTriangular(m.transpose(f))};
m._helper.isAlmostId=function(f){var a=f.value.length,p=q.real(a);if(a!==f.value[0].value.length)return!1;f=m.sub(f,m.idMatrix(p),p);for(p=0;p<a;p++)for(var b=0;b<a;b++)if(1E-16<q.abs(f.value[p].value[b]).value.real)return!1;return!0};m.nullSpace=function(f,a){var b=f.value.length,c=m.RRQRdecomp(m.transjugate(f),a),d=m.transpose(c.Q),c=b-c.rank.value.real,e=Array(c);d.value.reverse();for(var g,h=0;h<c;h++)g=d.value[h],e[h]=m.scaldiv(m.abs(g),g);e=m.turnIntoCSList(e);return 0<e.value.length?e:m.turnIntoCSList([m.zerovector(q.real(b))])};
m._helper.isAlmostDiagonal=function(f){var a=f.value.length;q.real(a);q.real(0);if(a!==f.value[0].value.length)return!1;for(var b=0;b<a;b++)for(var c=0;c<a;c++)if(b!==c&&1E-16<q.abs(f.value[b].value[c]).value.real)return!1;return!0};m._helper.inverseIteration=function(f,a){console.log("warning: code untested");for(var b=f.value.length,c=Array(b),d=0;d<b;d++)c[d]=2*Math.random()-.5;var d=c=m.realVector(c),b=m.idMatrix(q.real(b),q.real(b)),e;e=q.add(a,q.real(.1*Math.random()-.5));for(var g=0;100>g;g++)d=
m.scaldiv(m.abs(c),c),c=m.LUsolve(m.sub(f,m.scalmult(e,b)),JSON.parse(JSON.stringify(d)));return m.scaldiv(m.abs(c),c)};m._helper.toHessenberg=function(f){var a=JSON.parse(JSON.stringify(f)),b=a.value.length,c=q.real(b-1),d=q.real(b);q.real(1);if(m._helper.isUpperTriangular(a))return[m.idMatrix(c,c),f];var e;f=m.idMatrix(d,d);for(var g,d=1;d<b-1;d++)e=m.column(a,q.real(d)),e.value=e.value.splice(d),g=m.abs2(e).value.real,1E-16<g&&(e=m._helper.getHouseHolder(e),f=G.mult(f,e),a=G.mult(G.mult(e,a),e)),
c.value.real--;return[f,a]};m._helper.swapEl=function(f,a,b){var c;"[object Array]"===Object.prototype.toString.call(f)?(c=f[a],f[a]=f[b],f[b]=c):"list"===f.ctype&&(c=f.value[a],f.value[a]=f.value[b],f.value[b]=c)};m.RRQRdecomp=function(f,a){var b=Math.sqrt(q.eps);void 0!==a&&(b=.1*a.value.real);var b=b*b,c,d=f.value.length,e=q.real(d),g=q.real(1),h=m._helper.unitvector(q.real(f.value.length),g),l=m.idMatrix(e,e),k=JSON.parse(JSON.stringify(f)),n=m.transpose(f),r=Array(d);for(c=0;c<d;c++)r[c]=m.abs2(n.value[c]);
r=m.turnIntoCSList(r);n=Array(d);for(c=0;c<d;c++)n[c]=c;c=m.maxIndex(r,q.abs);for(var t=r.value[c],u=0,v=0;1E-16<q.abs2(t).value.real;v++){u++;m._helper.swapColumn(k,v,c);m._helper.swapEl(r,v,c);m._helper.swapEl(n,v,c);c=m._helper.getBlock(k,[v],[v]);c=m.column(c,g);t=m.abs2(c).value.real;1E-8<t&&(c=m._helper.getHouseHolder(c),c=m._helper.buildBlockMatrix(m.idMatrix(q.real(v),q.real(v)),c),l=G.mult(l,m.transjugate(c)),k=G.mult(c,k));for(c=v+1;c<d;c++)r.value[c]=q.sub(r.value[c],q.mult(k.value[v].value[c],
q.conjugate(k.value[v].value[c])));c=m.maxIndex(r,q.abs2,v+1);t=r.value[c];if(v+2===d){q.abs(t).value.real>b&&u++;break}e=q.sub(e,g);h.value=h.value.splice(0,h.value.length-1)}return{Q:l,R:k,P:m.turnIntoCSList(n),rank:q.real(u)}};m._helper.getHouseHolder=function(f){var a=q.real(f.value.length);if(1E-16>m.abs2(f))return m.idMatrix(a,a);var b,c=q.real(1),d=m._helper.unitvector(q.real(f.value.length),c);b=m._helper.QRgetAlpha(f,0);b=m.sub(f,m.scalmult(b,d));b=m.scaldiv(m.abs(b),b);f=q.div(m.sesquilinearproduct(f,
b),m.sesquilinearproduct(b,f));a=m.idMatrix(a,a);return a=m.sub(a,m.scalmult(q.add(c,f),m._helper.transposeMult(b,m.conjugate(b))))};m._helper.reOrderbyPivots=function(f,a){for(var b=f.value.length.length,c=m.transpose(f),b=Array(b),d=0;d<a.length;d++)b[a[d]]=c.value[d];b=m.turnIntoCSList(b);return m.transpose(b)};m.QRdecomp=function(f){var a,b=f.value.length,c=q.real(b);if(m._helper.isUpperTriangular(f))return{Q:m.idMatrix(c,c),R:f};var d=q.real(1),e=m._helper.unitvector(q.real(f.value.length),d),
g,h=m.idMatrix(c,c);f=JSON.parse(JSON.stringify(f));for(var k=0;;k++){a=m._helper.getBlock(f,[k],[k]);a=m.column(a,d);g=m.abs2(a).value.real;1E-8<g&&(a=m._helper.getHouseHolder(a),a=m._helper.buildBlockMatrix(m.idMatrix(q.real(k),q.real(k)),a),h=G.mult(h,m.transjugate(a)),f=G.mult(a,f));if(k+2===b)break;c=q.sub(c,d);e.value=e.value.splice(0,e.value.length-1)}return{Q:h,R:f}};m._helper.swapColumn=function(f,a,b){for(var c,d=0;d<f.value.length;d++)c=f.value[d].value[a],f.value[d].value[a]=f.value[d].value[b],
f.value[d].value[b]=c};m._helper.buildBlockMatrix=function(f,a){if(0===f.value.length)return a;if(0===a.value.length)return f;for(var b=f.value.length,c=f.value[0].value.length,d=c+a.value[0].value.length,d=m.zeromatrix(q.real(b+a.value.length),q.real(d)),e=0;e<f.value.length;e++)for(var g=0;g<f.value[0].value.length;g++)d.value[e].value[g]=f.value[e].value[g];for(e=0;e<a.value.length;e++)for(g=0;g<a.value[0].value.length;g++)d.value[b+e].value[c+g]=a.value[e].value[g];return d};m._helper.getBlock=
function(f,a,b){f=JSON.parse(JSON.stringify(f));var c=a[0],d=b[0];a=void 0===a[1]?f.value.length:a[1];b=void 0===b[1]?f.value[0].value.length:b[1];a++;b++;f.value=f.value.slice(c,a);for(c=0;c<f.value.length;c++)f.value[c].value=f.value[c].value.slice(d,b);return f};m._helper.setBlock=function(f,a,b){f=JSON.parse(JSON.stringify(f));var c=b[0];b=b[1];for(var d=a.value.length,e=a.value[0].value.length,g=0;g<d;g++)for(var h=0;h<e;h++)f.value[c+g].value[b+h]=a.value[g].value[h];return f};m._helper.transposeMult=
function(f,a){if(f.value.length!==a.value.length)return x;for(var b=f.value.length,c=Array(b),d=0;d<b;d++)c[d]=m.scalmult(f.value[d],a);return m.turnIntoCSList(c)};m._helper.QRgetAlpha=function(f,a){return 0>f.value[a].value.real?m.abs(f):q.neg(m.abs(f))};m.LUdecomp=function(f){f=JSON.parse(JSON.stringify(f));var a,b,c,d,e,g=0,h,k=f.value.length,m=k-1,l=Array(k);for(c=0;c<k;++c){e=c;d=f.value[c];h=q.abs(d.value[c]).value.real;for(b=c+1;b<k;++b)a=q.abs(f.value[b].value[c]),h<a.value.real&&(h=a.value.real,
e=b);h<q.eps&&console.log("Warning: singular matrix!");l[c]=e;e!==c&&(f.value[c]=f.value[e],f.value[e]=d,d=f.value[c],g++);b=d.value[c];for(a=c+1;a<k;++a)f.value[a].value[c]=q.div(f.value[a].value[c],b);for(a=c+1;a<k;++a){e=f.value[a];for(b=c+1;b<m;++b)e.value[b]=q.sub(e.value[b],q.mult(e.value[c],d.value[b])),++b,e.value[b]=q.sub(e.value[b],q.mult(e.value[c],d.value[b]));b===m&&(e.value[b]=q.sub(e.value[b],q.mult(e.value[c],d.value[b])))}}return{LU:f,P:l,TransPos:g}};m.LUsolve=function(f,a){var b=
m.LUdecomp(f);return m._helper.LUsolve(b,a)};m._helper.LUsolve=function(f,a){var b=JSON.parse(JSON.stringify(a)),c,d=f.LU,e=d.value.length,g=JSON.parse(JSON.stringify(b)),h=f.P,k;for(c=e-1;-1!==c;--c)g.value[c]=b.value[c];for(c=0;c<e;++c)for(b=h[c],h[c]!==c&&(k=g.value[c],g.value[c]=g.value[b],g.value[b]=k),k=d.value[c],b=0;b<c;++b)g.value[c]=q.sub(g.value[c],q.mult(g.value[b],k.value[b]));for(c=e-1;0<=c;--c){k=d.value[c];for(b=c+1;b<e;++b)g.value[c]=q.sub(g.value[c],q.mult(g.value[b],k.value[b]));
g.value[c]=q.div(g.value[c],k.value[c])}return g};m.linearsolveCramer2=function(f,a){var b=m.column(f,q.real(1)),c=m.column(f,q.real(2)),d=m.det2(b,c);q._helper.isZero(d)&&console.log("A is not regular!");c=m.det2(a,c);c=q.div(c,d);b=m.det2(b,a);b=q.div(b,d);return m.turnIntoCSList([c,b])};m.linearsolveCramer3=function(f,a){var b=m.column(f,q.real(1)),c=m.column(f,q.real(2)),d=m.column(f,q.real(3)),e=m.det3(b,c,d);q._helper.isZero(e)&&console.log("A is not regular!");var g=m.det3(a,c,d),d=m.det3(b,
a,d),b=m.det3(b,c,a),g=m.turnIntoCSList([g,d,b]);return g=m.scaldiv(e,g)};m.linearsolveCGNR=function(f,a){var b=m.transpose(f),c=G.mult(b,f),b=G.mult(b,a);return m.linearsolveCG(c,b)};m.linearsolveCG=function(f,a){var b,c,d,e,g,h;e=a;c=b=m.sub(a,G.mult(f,a));for(var k=Math.ceil(1.2*f.value.length),l=0;l<k;){l++;g=G.mult(f,c);h=d=m.scalproduct(b,b);d=q.div(d,m.scalproduct(c,g));e=m.add(e,G.mult(d,c));b=m.sub(b,G.mult(d,g));if(m.abs(b).value.real<q.eps)break;d=m.scalproduct(b,b);d=q.div(d,h);c=m.add(b,
G.mult(d,c))}l>=k&&console.log("CG did not converge");return e};m.det=function(f){if(1===f.value.length)return f.value[0].value[0];if(2===f.value.length)return m.det2(f.value[0],f.value[1]);if(3===f.value.length)return m.det3(f.value[0],f.value[1],f.value[2]);if(4===f.value.length)return m.det4m(f);var a=f.value.length,b=q.real(1),c,d,e=JSON.parse(JSON.stringify(f)),g,h,k,l;for(f=0;f<a-1;f++){d=f;for(c=f+1;c<a;c++)q.abs(e.value[c].value[f]).value.real>q.abs(e.value[d].value[f]).value.real&&(d=c);
d!==f&&(c=e.value[d],e.value[d]=e.value[f],e.value[f]=c,b=q.neg(b));g=e.value[f];for(c=f+1;c<a;c++){h=e.value[c];k=q.div(h.value[f],g.value[f]);for(d=f+1;d<a-1;d+=2)l=d+1,h.value[d]=q.sub(h.value[d],q.mult(g.value[d],k)),h.value[l]=q.sub(h.value[l],q.mult(g.value[l],k));d!==a&&(h.value[d]=q.sub(h.value[d],q.mult(g.value[d],k)))}if(q._helper.isZero(g.value[f]))return q.real(0);b=q.mult(b,g.value[f])}return q.mult(b,e.value[f].value[f])};m.LUdet=function(f){f=m.LUdecomp(f);for(var a=f.LU,b=a.value.length,
c=a.value[0].value[0],d=1;d<b;d++)c=q.mult(c,a.value[d].value[d]);1===f.TransPos%2&&(c=q.neg(c));return c};m.inversereal=function(f){var a,b,c=[],d=[],e=f.value.length;for(a=0;a<e;a++){var g=[],h=[];for(b=0;b<e;b++)g[b]=f.value[a].value[b].value.real,h[b]=f.value[a].value[b].value.imag;c[a]=g;d[a]=h}a=new numeric.T(c,d);f=a.inv(a);c=[];for(a=0;a<e;a++){d=[];for(b=0;b<e;b++)d[b]=q.complex(f.x[a][b],f.y[a][b]);c[a]=m.turnIntoCSList(d)}return m.turnIntoCSList(c)};m.linearsolvereal=function(f,a){for(var b=
[],c=[],d=f.value.length,e=0;e<d;e++){for(var g=[],h=0;h<d;h++)g[h]=f.value[e].value[h].value.real;b[e]=g;c[e]=a.value[e].value.real}b=numeric.solve(b,c);return m.realVector(b)};m.detreal=function(f){for(var a=[],b=[],c=f.value.length,d=0;d<c;d++){for(var e=[],g=[],h=0;h<c;h++)e[h]=f.value[d].value[h].value.real,g[h]=f.value[d].value[h].value.imag;a[d]=e;b[d]=g}new numeric.T(a,b);f=numeric.det(a);return q.real(f)};m.getField=function(f,a){var b;if("homog"===a){if(m._helper.isNumberVecN(f,3))return f;
if(m._helper.isNumberVecN(f,2))return m.turnIntoCSList([f.value[0],f.value[1],q.real(1)])}if("xy"===a){if(m._helper.isNumberVecN(f,2))return f;if(m._helper.isNumberVecN(f,3))return m.turnIntoCSList([q.div(f.value[0],f.value[2]),q.div(f.value[1],f.value[2])])}if("x"===a&&m.isNumberVector(f)){b=f.value.length;if(0<b&&3!==b)return f.value[0];if(3===b)return"Point"===f.usage?q.div(f.value[0],f.value[2]):f.value[0]}if("y"===a&&m.isNumberVector(f)){b=f.value.length;if(1<b&&3!==b)return f.value[1];if(3===
b)return"Point"===f.usage?q.div(f.value[1],f.value[2]):f.value[1]}return"z"===a&&m.isNumberVector(f)&&(b=f.value.length,2<b)?f.value[2]:x};var sb={":":20,".":25,"\u00b0":25,_:50,"^":50,"*":100,"/":100,"+":200,"-":200,"!":200,"==":300,"~=":300,"~<":300,"~>":300,"=:=":300,">=":300,"<=":300,"~>=":300,"~<=":300,">":300,"<":300,"<>":300,"&":350,"%":350,"!=":350,"~!=":350,"..":350,"++":370,"--":370,"~~":370,":>":370,"<:":370,"=":400,":=":400,":=_":400,"::=":400,"->":400,",":500,";":500},la={};la["+"]=eb;
la["-"]=tb;la["*"]=Pb;la["/"]=Qb;la["^"]=Rb;la["\u00b0"]=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"void"===c.ctype?q.mult(b,q.real(Math.PI/180)):x};la[";"]=function(f,a){var b="void"===f[0].ctype,c="void"===f[1].ctype;if(b&&c)return x;if(!b&&c)return I(f[0]);b||c||I(f[0]);return c?x:I(f[1])};la["="]=ta;la[".."]=function(f,a){var b=I(f[0]),c=I(f[1]);return"number"===b.ctype&&"number"===c.ctype?m.sequence(b,c):x};la[":="]=function(f,a){var b="undefined"===f[1].ctype;if("undefined"===
f[0].ctype||b)return x;"function"===f[0].ctype&&(b=f[0].oper,ka[b]={oper:b,body:f[1],arglist:f[0].args});return x};la["=="]=Na;la["!="]=function(f,a){return G.not(Na(f,a))};la["~="]=Pa;la["~!="]=function(f,a){return G.not(Pa(f,a))};la[">"]=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype&&q._helper.isAlmostReal(b)&&q._helper.isAlmostReal(c)?{ctype:"boolean",value:b.value.real>c.value.real}:"string"===b.ctype&&"string"===c.ctype?{ctype:"boolean",value:b.value>c.value}:
x};la["<"]=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype&&q._helper.isAlmostReal(b)&&q._helper.isAlmostReal(c)?{ctype:"boolean",value:b.value.real<c.value.real}:"string"===b.ctype&&"string"===c.ctype?{ctype:"boolean",value:b.value<c.value}:x};la[">="]=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype&&q._helper.isAlmostReal(b)&&q._helper.isAlmostReal(c)?{ctype:"boolean",value:b.value.real>=c.value.real}:"string"===b.ctype&&"string"===
c.ctype?{ctype:"boolean",value:b.value>=c.value}:x};la["<="]=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype&&q._helper.isAlmostReal(b)&&q._helper.isAlmostReal(c)?{ctype:"boolean",value:b.value.real<=c.value.real}:"string"===b.ctype&&"string"===c.ctype?{ctype:"boolean",value:b.value<=c.value}:x};la["~>"]=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype&&q._helper.isAlmostReal(b)&&q._helper.isAlmostReal(c)?{ctype:"boolean",value:b.value.real>
c.value.real+q.eps}:x};la["~<"]=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype&&q._helper.isAlmostReal(b)&&q._helper.isAlmostReal(c)?{ctype:"boolean",value:b.value.real<c.value.real-q.eps}:x};la["~>="]=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype&&q._helper.isAlmostReal(b)&&q._helper.isAlmostReal(c)?{ctype:"boolean",value:b.value.real>c.value.real-q.eps}:x};la["~<="]=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&
"number"===c.ctype&&q._helper.isAlmostReal(b)&&q._helper.isAlmostReal(c)?{ctype:"boolean",value:b.value.real<c.value.real+q.eps}:x};la["&"]=bb;la["%"]=Ia;la["!"]=function(f,a){var b=N(f[0]),c=N(f[1]);return"void"===b.ctype&&"boolean"===c.ctype?{ctype:"boolean",value:!c.value}:x};la._=Yb;la["++"]=Zb;la["~~"]=$b;la["--"]=ac;la[":>"]=bc;la["<:"]=cc;var z={},Q={evaluate:function(f,a,b){if(ka.hasOwnProperty(f))return ka(f,a,b);var c=z[f];if(c)return c(a,b);var d=f.lastIndexOf("$");if(-1!==d&&(d=f.substr(0,
d),c=z[d]))return c(a,b);ya.err("Called undefined function "+d+" (as "+f+")");return x},equals:function(f,a){return"number"===f.ctype&&"number"===a.ctype?{ctype:"boolean",value:f.value.real===a.value.real&&f.value.imag===a.value.imag}:"string"===f.ctype&&"string"===a.ctype||"boolean"===f.ctype&&"boolean"===a.ctype?{ctype:"boolean",value:f.value===a.value}:"list"===f.ctype&&"list"===a.ctype?m.equals(f,a):{ctype:"boolean",value:!1}}},G={_helper:{},order:{undefined:0,boolean:1,number:2,term:3,atomic:4,
variable:5,geo:6,string:7,list:8},string:function(f){return{ctype:"string",value:f}},bool:function(f){return{ctype:"boolean",value:f}},not:function(f){return G.bool(!f.value)},isLessThan:function(f,a){return-1===G.compare(f,a)},isEqual:function(f,a){return 0===G.compare(f,a)},compareResults:function(f,a){return G.compare(f.result,a.result)},compare:function(f,a){if(f.ctype!==a.ctype)return G.order[f.ctype]-G.order[a.ctype];if("number"===f.ctype)return q._helper.compare(f,a);if("list"===f.ctype)return m._helper.compare(f,
a);if("string"===f.ctype)return f.value===a.value?0:f.value<a.value?-1:1;if("boolean"===f.ctype)return f.value===a.value?0:!1===f.value?-1:1},add:function(f,a){return"void"===f.ctype&&"number"===a.ctype?a:"number"===f.ctype&&"number"===a.ctype?q.add(f,a):"string"===f.ctype||"string"===a.ctype?{ctype:"string",value:ha(f)+ha(a)}:"list"===f.ctype&&"list"===a.ctype?m.add(f,a):x},sub:function(f,a){return"void"===f.ctype&&"number"===a.ctype?q.neg(a):"void"===f.ctype&&"list"===a.ctype?m.neg(a):"number"===
f.ctype&&"number"===a.ctype?q.sub(f,a):"list"===f.ctype&&"list"===a.ctype?m.sub(f,a):x},mult:function(f,a){return"number"===f.ctype&&"number"===a.ctype?q.mult(f,a):"number"===f.ctype&&"list"===a.ctype?m.scalmult(f,a):"list"===f.ctype&&"number"===a.ctype?m.scalmult(a,f):"list"===f.ctype&&"list"===a.ctype?m.mult(f,a):x},div:function(f,a){return"number"===f.ctype&&"number"===a.ctype?q.div(f,a):"list"===f.ctype&&"number"===a.ctype?m.scaldiv(a,f):x},max:function(f,a){return"number"===f.ctype&&"number"===
a.ctype?q.max(f,a):"list"===f.ctype&&"list"===a.ctype?m.max(f,a):x},min:function(f,a){return"number"===f.ctype&&"number"===a.ctype?q.min(f,a):"list"===f.ctype&&"list"===a.ctype?m.min(f,a):x},wrap:function(f){if("number"===typeof f)return q.real(f);if("object"===typeof f&&void 0!==f.length){for(var a=[],b=0;b<f.length;b++)a[b]=G.wrap(f[b]);return m.turnIntoCSList(a)}return"string"===typeof f?{ctype:"string",value:f}:"boolean"===typeof f?{ctype:"boolean",value:f}:x},withUsage:function(f,a){return{ctype:f.ctype,
value:f.value,usage:a}}};z.timestamp$0=function(f,a){return{ctype:"number",value:{real:(new Date).getTime(),imag:0}}};z.seconds$0=function(f,a){return{ctype:"number",value:{real:(new Date).getTime()/1E3,imag:0}}};z.clearconsole$0=function(f,a){ya.clear()};z.err$1=function(f,a){var b="",c;"variable"===f[0].ctype?(b=f[0].name,c=ca.getvar(f[0].name)):c=f[0];c=b+" ===> "+ha(I(c));ya.err(c);return x};z.errc$1=function(f,a){var b;"variable"===f[0].ctype?(b=I(ca.getvar(f[0].name)),console.log(f[0].name+
" ===> "+ha(b))):(b=I(f[0]),console.log(" ===> "+ha(b)));return x};z.print$1=function(f,a){ya.out(ha(I(f[0])),!0)};z.println$1=function(f,a){ya.out(ha(I(f[0])))};z.dump$1=function(f,a){console.log(JSON.stringify(f[0]));return x};z.repeat$2=function(f,a){return z.repeat$3([f[0],null,f[1]],a)};z.repeat$3=function(f,a){var b=N(f[0]),c="#";null!==f[1]&&"variable"===f[1].ctype&&(c=f[1].name);if("number"!==b.ctype)return x;var b=Math.round(b.value.real),d=1,e=1,g=b+1,h=!1,k=!1,l=!1,m;void 0!==a.start&&
(m=I(a.start),"number"===m.ctype&&(h=!0,e=m.value.real));void 0!==a.step&&(m=I(a.step),"number"===m.ctype&&(l=!0,d=m.value.real));void 0!==a.stop&&(m=I(a.stop),"number"===m.ctype&&(k=!0,g=m.value.real));!h||k||l||(g=d*b+e);h||!k||l||(e=-d*(b-1)+g,g+=d);h||k||!l||(g=d*b+e);h&&k&&!l&&(d=(g-e)/(b-1),g+=d);h&&!k&&l&&(g=d*b+e);!h&&k&&l&&(e=-d*(b-1)+g,g+=d);h&&k&&l&&(g+=d);(e<=g&&0<d||e>=g&&0>d)&&h&&k&&l&&(b=Math.floor((g-e)/d));ca.newvar(c);g=x;for(h=0;h<b;h++)ca.setvar(c,{ctype:"number",value:{real:h*
d+e,imag:0}}),g=I(f[2]);ca.removevar(c);return g};z.while$2=function(f,a){for(var b=f[1],c=f[0],d=I(c),e=x;"list"!==d.ctype&&d.value;)e=I(b),d=I(c);return e};z.apply$2=function(f,a){return z.apply$3([f[0],null,f[1]],a)};z.apply$3=function(f,a){var b=N(f[0]);if("list"!==b.ctype)return x;var c="#";null!==f[1]&&"variable"===f[1].ctype&&(c=f[1].name);var b=b.value,d=[];ca.newvar(c);for(var e=0;e<b.length;e++)ca.setvar(c,b[e]),d[e]=I(f[2]);ca.removevar(c);return{ctype:"list",value:d}};z.forall$2=function(f,
a){return z.forall$3([f[0],null,f[1]],a)};z.forall$3=function(f,a){var b=N(f[0]);if("list"!==b.ctype)return x;var c="#";null!==f[1]&&"variable"===f[1].ctype&&(c=f[1].name);b=b.value;ca.newvar(c);for(var d,e=0;e<b.length;e++)ca.setvar(c,b[e]),d=I(f[2]);ca.removevar(c);return d};z.select$2=function(f,a){return z.select$3([f[0],null,f[1]],a)};z.select$3=function(f,a){var b=N(f[0]);if("list"!==b.ctype)return x;var c="#";null!==f[1]&&"variable"===f[1].ctype&&(c=f[1].name);var b=b.value,d=[];ca.newvar(c);
for(var e=0,g=0;g<b.length;g++){ca.setvar(c,b[g]);var h=I(f[2]);"boolean"===h.ctype&&!0===h.value&&(d[e]=b[g],e++)}ca.removevar(c);return{ctype:"list",value:d}};z.flatten$1=function(f,a){function b(f,a){return-1===a||"list"!==f.ctype?f:[].concat.apply([],f.value.map(function(f){return b(f,a-1)}))}var c=N(f[0]);if("list"!==c.ctype)return c;var d=a.levels;void 0===d?d=1:(d=I(d),d="number"===d.ctype?d.value.real:"string"===d.ctype&&"all"===d.value?-2:1);return{ctype:"list",value:b(c,d)}};z.createvar$1=
function(f,a){"variable"===f[0].ctype&&ca.newvar(f[0].name);return x};z.local=function(f,a){for(var b=0;b<f.length;b++)"variable"===f[b].ctype&&ca.newvar(f[b].name);return x};z.removevar$1=function(f,a){var b=I(f[0]);"variable"===f[0].ctype&&ca.removevar(f[0].name);return b};z.release=function(f,a){if(0===f.length)return x;for(var b=I(f[f.length-1]),c=0;c<f.length;c++)"variable"===f[c].ctype&&ca.removevar(f[c].name);return b};z.regional=function(f,a){for(var b=0;b<f.length;b++)if("variable"===f[b].ctype){var c=
f[b].name;ca.newvar(c);ca.pushVstack(c)}return x};z.genList=function(f,a){for(var b=[],c=0;c<f.length;c++)b[c]=I(f[c]);return{ctype:"list",value:b}};Q.assigntake=function(f,a){var b=f.args[0],c=I(b),d=N(f.args[1]),e=x;if("list"===c.ctype||"string"===c.ctype)d=Math.floor(d.value.real),0>d&&(d=c.value.length+d+1),0<d&&d<=c.value.length&&("list"===c.ctype?(c=c.value.slice(),c[d-1]=I(a),e=m.turnIntoCSList(c)):(c=c.value,c=c.substring(0,d-1)+ha(I(a))+c.substring(d,c.length),e=G.string(c)));ta([b,e])};
Q.assigndot=function(f,a){var b=I(f.obj),c=f.key;"geo"===b.ctype&&c&&Ja.setField(b.value,c,a);return x};Q.assignlist=function(f,a){var b=f.length,c=a.length;c<b&&(b=c);for(c=0;c<b;c++)ta([f[c],a[c]],[])};z.if$2=function(f,a){return z.if$3(f,a)};z.if$3=function(f,a){var b=N(f[0]);if("boolean"===b.ctype){if(!0===b.value)return I(f[1]);if(3===f.length)return I(f[2])}return x};z.and$2=bb;z.or$2=Ia;z.xor$2=function(f,a){var b=N(f[0]),c=N(f[1]);return"boolean"===b.ctype&&"boolean"===c.ctype?{ctype:"boolean",
value:b.value!==c.value}:x};z.not$1=function(f,a){var b=N(f[0]);return"boolean"===b.ctype?{ctype:"boolean",value:!b.value}:x};Q.genericListMathGen=function(f,a,b){z[f+"$1"]=function(f,c){var d=I(f[0]);if("list"!==d.ctype)return x;d=d.value;if(0===d.length)return b;for(var e=d[0],g=1;g<d.length;g++)e=a(e,d[g]);return e};var c=f+"$3";z[f+"$2"]=function(f,a){return z[c]([f[0],null,f[1]])};z[c]=function(f,c){var d=N(f[0]);if("list"!==d.ctype)return x;d=d.value;if(0===d.length)return b;var e="#";null!==
f[1]&&"variable"===f[1].ctype&&(e=f[1].name);ca.newvar(e);ca.setvar(e,d[0]);for(var g=I(f[2]),h=1;h<d.length;h++){ca.setvar(e,d[h]);var k=I(f[2]),g=a(g,k)}ca.removevar(e);return g}};Q.genericListMathGen("product",G.mult,q.real(1));Q.genericListMathGen("sum",G.add,q.real(0));Q.genericListMathGen("max",G.max,x);Q.genericListMathGen("min",G.min,x);z.max$2=function(f,a){var b=N(f[0]);if("list"===b.ctype)return z.max$3([b,null,f[1]]);var c=N(f[1]);return z.max$1([m.turnIntoCSList([b,c])])};z.min$2=function(f,
a){var b=N(f[0]);if("list"===b.ctype)return z.min$3([b,null,f[1]]);var c=N(f[1]);return z.min$1([m.turnIntoCSList([b,c])])};z.add$2=eb;z.sub$2=tb;z.mult$2=Pb;z.div$2=Qb;z.mod$2=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype?q.mod(b,c):x};z.pow$2=Rb;z.exp$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.exp(b):x};z.sin$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.sin(b):x};z.sqrt$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.sqrt(b):
x};Q.laguerre=function(f,a,b){if("list"!==f.ctype)return x;var c=f.value.length-1,d;for(d=0;d<=c;d++)if("number"!==f.value[d].ctype)return x;if("number"!==a.ctype)return x;for(var e=[1,.3141,.5926,.5358,.9793,.2385,.6264,.3383,.2795,.0288],g,h,k,l=1;l<=b;l++){k=q.real(0);h=q.real(0);g=f.value[c];for(d=c-1;0<=d;d--)k=q.add(h,q.mult(k,a)),h=q.add(g,q.mult(h,a)),g=q.add(f.value[d],q.mult(g,a));if(q._helper.isLessThan(q.abs(g),q.real(1E-14)))break;d=q.div(h,g);h=q.mult(d,d);g=q.sub(h,q.div(q.mult(q.real(2),
k),g));k=q.sqrt(q.mult(q.real(c-1),q.sub(q.mult(q.real(c),g),h)));g=q.add(d,k);d=q.sub(d,k);q._helper.isLessThan(q.abs(g),q.abs(d))&&(g=d);d=q._helper.isLessThan(q.real(1E-14),q.abs(g))?q.div(q.real(c),g):q.mult(q.add(q.abs(a),q.real(1)),q.complex(Math.cos(l),Math.sin(l)));if(q._helper.isLessThan(q.abs(d),q.real(1E-14)))break;0===l%20&&(d=q.mult(d,q.real(e[l/20])));a=q.sub(a,d)}return a};z.roots$1=function(f,a){var b=N(f[0]);if("list"===b.ctype){var c;for(c=0;c<b.value.length;c++)if("number"!==b.value[c].ctype)return x;
var d=[],e=b,g=b.value.length-1;for(c=0;c<g;c++){d[c]=Q.laguerre(b,q.zero,200);d[c]=Q.laguerre(e,d[c],1);var h=[];h[g-c]=b.value[g-c];for(var k=g-c;0<k;k--)h[k-1]=q.add(b.value[k-1],q.mult(h[k],d[c]));h.shift();b=m.turnIntoCSList(h)}return m.sort1(m.turnIntoCSList(d))}return x};z.autodiff$3=function(f,a){var b="x",c;if("function"===f[0].ctype)c=ka[f[0].oper].body,b=f[0].args[0].name;else if("function"===typeof f[0].impl)c=f[0];else return console.log("could not parse function"),x;var d=N(f[1]),e=
N(f[2]);if(1>e.value.real)return console.log("grade cant be < 1"),x;e=q.add(e,q.real(1));return fa.autodiff(c,b,d,e)};z.cos$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.cos(b):x};z.tan$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.tan(b):x};z.arccos$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.arccos(b):x};z.arcsin$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.arcsin(b):x};z.arctan$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.arctan(b):x};
z.arctan2$2=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype?q.arctan2(b,c):x};z.arctan2$1=function(f,a){var b=N(f[0]);return"list"===b.ctype&&2===b.value.length&&(b=b.value,"number"===b[0].ctype&&"number"===b[1].ctype)?z.arctan2$2(b,a):x};z.log$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.log(b):x};Q.recursiveGen=function(f){var a=q[f],b=m[f];z[f+"$1"]=function(f,c){var d=N(f[0]);return"number"===d.ctype?a(d):"list"===d.ctype?b(d):x}};Q.recursiveGen("im");
Q.recursiveGen("re");Q.recursiveGen("conjugate");Q.recursiveGen("round");Q.recursiveGen("ceil");Q.recursiveGen("floor");Q.recursiveGen("abs");z.abs_infix=z.abs$1;z.random$0=function(f,a){return q.real(q._helper.rand())};z.random$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.complex(b.value.real*q._helper.rand(),b.value.imag*q._helper.rand()):x};z.seedrandom$1=function(f,a){var b=N(f[0]);"number"===b.ctype&&q._helper.seedrandom(b.value.real);return x};z.randomnormal$0=function(f,a){return q.real(q._helper.randnormal())};
z.randominteger$1=function(f,a){var b=N(f[0]);if("number"===b.ctype){var c=b.value.real|0,b=b.value.imag|0,c=c*q._helper.rand()|0,b=b*q._helper.rand()|0;return q.complex(c,b)}return x};z.randomint$1=z.randominteger$1;z.randombool$0=function(f,a){return.5<q._helper.rand()?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isreal$1=function(f,a){var b=I(f[0]);return"number"===b.ctype&&q._helper.isAlmostReal(b)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isinteger$1=function(f,a){var b=
I(f[0]);return"number"===b.ctype&&q._helper.isAlmostReal(b)&&b.value.real===Math.floor(b.value.real)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.iseven$1=function(f,a){var b=I(f[0]);return"number"===b.ctype&&q._helper.isAlmostReal(b)&&b.value.real/2===Math.floor(b.value.real/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isodd$1=function(f,a){var b=I(f[0]);return"number"===b.ctype&&q._helper.isAlmostReal(b)&&(b.value.real-1)/2===Math.floor((b.value.real-1)/2)?{ctype:"boolean",
value:!0}:{ctype:"boolean",value:!1}};z.iscomplex$1=function(f,a){return"number"===I(f[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isstring$1=function(f,a){return"string"===I(f[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.islist$1=function(f,a){return"list"===I(f[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.ismatrix$1=function(f,a){var b=I(f[0]);return-1!==m._helper.colNumb(b)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};
z.iscircle$1=function(f,a){var b=I(f[0]);return"geo"===b.ctype&&"C"===b.value.kind&&"Circle"===b.value.matrix.usage?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isconic$1=function(f,a){var b=I(f[0]);return"geo"===b.ctype&&"C"===b.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isline$1=function(f,a){var b=I(f[0]);return"geo"===b.ctype&&"L"===b.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.ispoint$1=function(f,a){var b=I(f[0]);return"geo"===b.ctype&&
"P"===b.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isgeometric$1=function(f,a){return"geo"===I(f[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isnumbermatrix$1=function(f,a){var b=I(f[0]);return m.isNumberMatrix(b).value?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isnumbervector$1=function(f,a){var b=I(f[0]);return m.isNumberVector(b).value?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.issun$1=function(f,a){var b=I(f[0]);return"geo"===
b.ctype&&void 0!==b.value.behavior&&"Sun"===b.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.ismass$1=function(f,a){var b=I(f[0]);return"geo"===b.ctype&&void 0!==b.value.behavior&&"Mass"===b.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isspring$1=function(f,a){var b=I(f[0]);return"geo"===b.ctype&&void 0!==b.value.behavior&&"Spring"===b.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isbouncer$1=function(f,a){var b=
I(f[0]);return"geo"===b.ctype&&void 0!==b.value.behavior&&"Bouncer"===b.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isundefined$1=function(f,a){return"undefined"===I(f[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.matrixrowcolumn$1=function(f,a){var b=I(f[0]);return-1!==m._helper.colNumb(b)?m.realVector([b.value.length,b.value[0].value.length]):x};z.rowmatrix$1=function(f,a){var b=I(f[0]);return"list"===b.ctype?m.turnIntoCSList([b]):x};z.columnmatrix$1=
function(f,a){var b=I(f[0]);return"list"===b.ctype?m.turnIntoCSList(b.value.map(function(f){return m.turnIntoCSList([f])})):x};z.submatrix$3=function(f,a){var b=I(f[0]),c=I(f[1]),d=I(f[2]);if("list"===b.ctype&&"number"===c.ctype&&"number"===d.ctype){var e=Math.round(c.value.real),c=Math.round(d.value.real),b=b.value.slice();0<c&&c<=b.length&&b.splice(c-1,1);var g=!0,b=b.map(function(f){if("list"!==f.ctype)g=!1;else return f=f.value.slice(),0<e&&e<=f.length&&f.splice(e-1,1),m.turnIntoCSList(f)});return g?
m.turnIntoCSList(b):x}return x};z.complex$1=function(f,a){var b,c,d;d=N(f[0]);if("list"===d.ctype&&m.isNumberVector(d)){if(2===d.value.length)return b=d.value[0],c=d.value[1],q.complex(b.value.real-c.value.imag,c.value.real+b.value.imag);if(3===d.value.length)return b=d.value[0],c=d.value[1],d=d.value[2],b=q.div(b,d),c=q.div(c,d),q.complex(b.value.real-c.value.imag,c.value.real+b.value.imag)}return x};z.gauss$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?m.realVector([b.value.real,b.value.imag]):
x};z.cross$2=function(f,a){var b=ga(f[0]),c=ga(f[1]);if(b!==x&&c!==x){var d=m.cross(b,c);"Point"===b.usage&&"Point"===c.usage&&(d=G.withUsage(d,"Line"));"Line"===b.usage&&"Line"===c.usage&&(d=G.withUsage(d,"Point"));return d}return x};z.crossratio$4=function(f,a){var b=I(f[0]),c=I(f[1]),d=I(f[2]),e=I(f[3]),g=ga(b),h=ga(c),k=ga(d),l=ga(e);return g!==x&&h!==x&&k!==x&&l!==x?m.crossratio3(g,h,k,l,m.ii):"number"===b.ctype&&"number"===c.ctype&&"number"===d.ctype&&"number"===e.ctype?q.div(q.mult(q.sub(b,
d),q.sub(c,e)),q.mult(q.sub(b,e),q.sub(c,d))):x};z.para$2=function(f,a){var b=N(f[0]),c=N(f[1]),d=ga(b),e=ga(c);if(b!==x&&c!==x){var c=c.usage,g=d,h=e;if("Line"===b.usage||"Point"===c)g=e,h=d;b=m.cross(m.cross(m.linfty,h),g);return G.withUsage(b,"Line")}return x};z.perp$2=function(f,a){var b=N(f[0]),c=N(f[1]),d=ga(b),e=ga(c);if(b!==x&&c!==x){var g=c.usage||e.usage,c=d,h=e;if("Line"===(b.usage||d.usage)||"Point"===g)c=e,h=d;b=m.turnIntoCSList([h.value[0],h.value[1],q.zero]);b=m.cross(b,c);return G.withUsage(b,
"Line")}return x};z.perp$1=function(f,a){var b=N(f[0]);return m._helper.isNumberVecN(b,2)?m.turnIntoCSList([q.neg(b.value[1]),b.value[0]]):x};z.parallel$2=z.para$2;z.perpendicular$2=z.perp$2;z.perpendicular$1=z.perp$1;z.meet$2=function(f,a){var b=ga(f[0]),c=ga(f[1]);return b!==x&&c!==x?(b=m.cross(b,c),G.withUsage(b,"Point")):x};z.join$2=function(f,a){var b=ga(f[0]),c=ga(f[1]);return b!==x&&c!==x?(b=m.cross(b,c),G.withUsage(b,"Line")):x};z.dist$2=function(f,a){var b=N(f[0]),c=N(f[1]),b=tb([b,c],[]);
return z.abs$1([b],[])};z.dist_infix=z.dist$2;z.point$1=function(f,a){var b=I(f[0]);return m._helper.isNumberVecN(b,3)||m._helper.isNumberVecN(b,2)?G.withUsage(b,"Point"):b};z.line$1=function(f,a){var b=I(f[0]);return m._helper.isNumberVecN(b,3)?G.withUsage(b,"Line"):b};z.det$3=function(f,a){var b=ga(f[0]),c=ga(f[1]),d=ga(f[2]);if(b!==x&&c!==x&&d!==x)return m.det3(b,c,d)};z.det$1=function(f,a){var b=N(f[0]);if("list"===b.ctype){var c=m._helper.colNumb(b);if(-1!==c&&c===b.value.length)return m.det(b)}return x};
z.eig$1=function(f,a){var b=N(f[0]);if("list"===b.ctype){var c=m._helper.colNumb(b);if(-1!==c&&c===b.value.length)return m.eig(b)}return x};z.eigenvalues$1=function(f,a){var b=N(f[0]);if("list"===b.ctype){var c=m._helper.colNumb(b);if(-1!==c&&c===b.value.length)return m.eig(b,!1).value[0]}return x};z.rank$1=function(f,a){var b=N(f[0]);if("list"===b.ctype){var c=m._helper.colNumb(b);if(-1!==c&&c===b.value.length)return m.rank(b,a.precision)}return x};z.kernel$1=function(f,a){var b=N(f[0]);if("list"===
b.ctype){var c=m._helper.colNumb(b);if(-1!==c&&c===b.value.length)return b=m.nullSpace(b,a.precision),m.transpose(b)}return x};z.eigenvectors$1=function(f,a){var b=N(f[0]);if("list"===b.ctype){var c=m._helper.colNumb(b);if(-1!==c&&c===b.value.length)return m.eig(b).value[1]}return x};z.area$3=function(f,a){var b=ga(f[0]),c=ga(f[1]),d=ga(f[2]);if(b!==x&&c!==x&&d!==x){var e=b.value[2],g=c.value[2],h=d.value[2];if(!q._helper.isAlmostZero(e)&&!q._helper.isAlmostZero(g)&&!q._helper.isAlmostZero(h))return b=
m.scaldiv(e,b),c=m.scaldiv(g,c),d=m.scaldiv(h,d),b=m.det3(b,c,d),q.realmult(.5,b)}return x};z.inverse$1=function(f,a){var b=N(f[0]);if("list"===b.ctype){var c=m._helper.colNumb(b);if(-1!==c&&c===b.value.length)return m.inverse(b)}return x};z.linearsolve$2=function(f,a){var b=N(f[0]),c=N(f[1]);if("list"===b.ctype){var d=m._helper.colNumb(b);if(-1!==d&&d===b.value.length&&m._helper.isNumberVecN(c,d))return m.linearsolve(b,c)}return x};var zc=[[[]],[[0]],[[0,1],[1,0]],[[0,1,2],[0,2,1],[1,0,2],[1,2,0],
[2,0,1],[2,1,0]],[[0,1,2,3],[0,1,3,2],[0,2,1,3],[0,2,3,1],[0,3,1,2],[0,3,2,1],[1,0,2,3],[1,0,3,2],[1,2,0,3],[1,2,3,0],[1,3,0,2],[1,3,2,0],[2,0,1,3],[2,0,3,1],[2,1,0,3],[2,1,3,0],[2,3,0,1],[2,3,1,0],[3,0,1,2],[3,0,2,1],[3,1,0,2],[3,1,2,0],[3,2,0,1],[3,2,1,0]]];z.mincostmatching$1=function(f,a){var b=I(f[0]);if(m.isNumberMatrix(b)){var c=b.value.length,d=m._helper.colNumb(b),e=c<d?d:c,g,h,k=Array(e);for(g=0;g<e;++g)for(k[g]=Array(e),h=0;h<e;++h)k[g][h]=g<c&&h<d?b.value[g].value[h].value.real:0;b=Bb(k);
e=Array(c);for(g=0;g<c;++g)h=b[g],e[g]=h<d?q.real(h+1):q.real(0);return m.turnIntoCSList(e)}return x};z.length$1=function(f,a){var b=I(f[0]);return"list"===b.ctype||"string"===b.ctype?q.real(b.value.length):x};z.pairs$1=function(f,a){var b=I(f[0]);return"list"===b.ctype?m.pairs(b):x};z.triples$1=function(f,a){var b=I(f[0]);return"list"===b.ctype?m.triples(b):x};z.cycle$1=function(f,a){var b=I(f[0]);return"list"===b.ctype?m.cycle(b):x};z.consecutive$1=function(f,a){var b=I(f[0]);return"list"===b.ctype?
m.consecutive(b):x};z.reverse$1=function(f,a){var b=I(f[0]);return"list"===b.ctype?m.reverse(b):x};z.directproduct$2=function(f,a){var b=I(f[0]),c=I(f[1]);return"list"===b.ctype&&"list"===c.ctype?m.directproduct(b,c):x};z.concat$2=Zb;z.common$2=$b;z.remove$2=ac;z.append$2=bc;z.prepend$2=cc;z.contains$2=function(f,a){var b=I(f[0]),c=I(f[1]);return"list"===b.ctype?m.contains(b,c):x};z.sort$2=function(f,a){return z.sort$3([f[0],null,f[1]],a)};z.sort$3=function(f,a){var b=N(f[0]);if("list"!==b.ctype)return x;
var c="#";null!==f[1]&&"variable"===f[1].ctype&&(c=f[1].name);var b=b.value,d=[];ca.newvar(c);var e;for(e=0;e<b.length;e++)ca.setvar(c,b[e]),d[e]={val:b[e],result:I(f[2])};ca.removevar(c);d.sort(G.compareResults);c=[];for(e=0;e<b.length;e++)c[e]=d[e].val;return{ctype:"list",value:c}};z.sort$1=function(f,a){var b=I(f[0]);return"list"===b.ctype?m.sort1(b):x};z.set$1=function(f,a){var b=I(f[0]);return"list"===b.ctype?m.set(b):x};z.combinations$2=function(f,a){function b(f,a){f===g?k.push(m.turnIntoCSList(h.slice())):
a<e&&(h[f]=c.value[a],b(f+1,a+1),b(f,a+1))}var c=I(f[0]),d=I(f[1]),e,g,h,k;if("number"===d.ctype){g=d.value.real|0;if("number"===c.ctype){e=c.value.real|0;e-g<g&&(g=e-g);if(0>g)return q.real(0);if(0===g)return q.real(1);if(1===g)return c;for(var l=d=1,n=1;n<=g;++n)var r=e-g+n|0,t=n|0,u=Cb(r,t)|0,r=r/u|0,t=t/u|0,u=Cb(d,t)|0,d=d/u|0,t=t/u|0,u=Cb(r,l)|0,r=r/u|0,l=l/u|0,d=d*r|0,l=l*t|0;return q.real(d/l)}if("list"===c.ctype){e=c.value.length;if(0>g||g>e)return m.turnIntoCSList([]);if(0===g)return m.turnIntoCSList([m.turnIntoCSList([])]);
if(g===e)return m.turnIntoCSList([c]);k=[];h=Array(g);b(0,0);return m.turnIntoCSList(k)}}return x};z.zeromatrix$2=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype?m.zeromatrix(b,c):x};z.zerovector$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?m.zerovector(b):x};z.transpose$1=function(f,a){var b=N(f[0]);return"list"===b.ctype&&-1!==m._helper.colNumb(b)?m.transpose(b):x};z.row$2=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===c.ctype&&"list"===b.ctype&&
-1!==m._helper.colNumb(b)?m.row(b,c):x};z.column$2=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===c.ctype&&"list"===b.ctype&&-1!==m._helper.colNumb(b)?m.column(b,c):x};z.red$1=function(f,a){var b=I(f[0]);return"number"===b.ctype?(b=Math.min(1,Math.max(0,b.value.real)),m.realVector([b,0,0])):x};z.green$1=function(f,a){var b=I(f[0]);return"number"===b.ctype?(b=Math.min(1,Math.max(0,b.value.real)),m.realVector([0,b,0])):x};z.blue$1=function(f,a){var b=I(f[0]);return"number"===b.ctype?(b=Math.min(1,
Math.max(0,b.value.real)),m.realVector([0,0,b])):x};z.gray$1=function(f,a){var b=I(f[0]);return"number"===b.ctype?(b=Math.min(1,Math.max(0,b.value.real)),m.realVector([b,b,b])):x};z.grey$1=z.gray$1;Q.HSVtoRGB=function(a,b,c){var d,e,g,h,k,l;a&&void 0===b&&void 0===c&&(b=a.s,c=a.v,a=a.h);h=Math.floor(6*a);k=6*a-h;a=c*(1-b);l=c*(1-k*b);b=c*(1-(1-k)*b);switch(h%6){case 0:d=c;e=b;g=a;break;case 1:d=l;e=c;g=a;break;case 2:d=a;e=c;g=b;break;case 3:d=a;e=l;g=c;break;case 4:d=b;e=a;g=c;break;case 5:d=c,e=
a,g=l}return m.realVector([d,e,g])};z.hue$1=function(a,b){var c=I(a[0]);return"number"===c.ctype?(c=c.value.real,c-=Math.floor(c),Q.HSVtoRGB(c,1,1)):x};Q.shapeconvert=function(a){var b,c;if("circle"===a.type){b=a.value.value[0];b=G.div(b,b.value[2]);var d=b.value[0].value.real,e=b.value[1].value.real;a=a.value.value[1].value.real;c=[];var g=2*Math.PI/36;for(b=0;36>b;b++)c[b]={X:d+Math.cos(b*g)*a,Y:e+Math.sin(b*g)*a};return[c]}if("polygon"===a.type){d=[];for(b=0;b<a.value.length;b++){e=a.value[b];
c=[];for(g=0;g<e.length;g++)c[g]={X:e[g].X,Y:e[g].Y};d[b]=c}return d}};Q.shapeop=function(a,b,c){a=Q.shapeconvert(a);var d=Q.shapeconvert(b);ClipperLib.JS.ScaleUpPaths(a,1E3);ClipperLib.JS.ScaleUpPaths(d,1E3);b=new ClipperLib.Clipper;b.AddPaths(a,ClipperLib.PolyType.ptSubject,!0);b.AddPaths(d,ClipperLib.PolyType.ptClip,!0);var d=a=ClipperLib.PolyFillType.pftNonZero,e=new ClipperLib.Paths;b.Execute(c,e,a,d);ClipperLib.JS.ScaleDownPaths(e,1E3);return{ctype:"shape",type:"polygon",value:e}};Q.shapecommon=
function(a,b){return Q.shapeop(a,b,ClipperLib.ClipType.ctIntersection)};Q.shaperemove=function(a,b){return Q.shapeop(a,b,ClipperLib.ClipType.ctDifference)};Q.shapeconcat=function(a,b){return Q.shapeop(a,b,ClipperLib.ClipType.ctUnion)};z.key$0=function(a,b){return{ctype:"string",value:Ub}};z.keycode$0=function(a,b){return q.real(Vb)};z.mouse$0=function(a,b){return m.realVector([fb[0],fb[1]])};z.mover$0=function(a,b){if(xa&&xa.mover)return{ctype:"geo",value:xa.mover,type:"P"};console.log("Not moving anything at the moment");
return x};z.translate$1=function(a,b){var c=N(a[0]);"list"===c.ctype&&m.isNumberVector(c)&&2===c.value.length&&D.translate(c.value[0].value.real,c.value[1].value.real);return x};z.rotate$1=function(a,b){var c=N(a[0]);"number"===c.ctype&&D.rotate(c.value.real);return x};z.scale$1=function(a,b){var c=N(a[0]);"number"===c.ctype&&D.scale(c.value.real);return x};z.greset$0=function(a,b){var c=Ta.stack.length;D.greset();for(var d=0;d<c;d++)M.restore();return x};z.gsave$0=function(a,b){D.gsave();M.save();
return x};z.grestore$0=function(a,b){D.grestore();M.restore();return x};z.color$1=function(a,b){var c=N(a[0]);"list"===c.ctype&&m.isNumberVector(c).value&&D.setcolor(c);return x};z.linecolor$1=function(a,b){var c=N(a[0]);"list"===c.ctype&&m.isNumberVector(c).value&&D.setlinecolor(c);return x};z.pointcolor$1=function(a,b){var c=N(a[0]);"list"===c.ctype&&m.isNumberVector(c).value&&D.setpointcolor(c);return x};z.alpha$1=function(a,b){var c=N(a[0]);"number"===c.ctype&&D.setalpha(c);return x};z.pointsize$1=
function(a,b){var c=N(a[0]);"number"===c.ctype&&D.setpointsize(c);return x};z.linesize$1=function(a,b){var c=N(a[0]);"number"===c.ctype&&D.setlinesize(c);return x};z.textsize$1=function(a,b){var c=N(a[0]);"number"===c.ctype&&D.settextsize(c);return x};z.playanimation$0=function(a,b){l();return x};z.pauseanimation$0=function(a,b){L();return x};z.stopanimation$0=function(a,b){J();return x};z.replace$3=function(a,b){var c=I(a[0]),d=I(a[1]),e=I(a[2]);if("string"===c.ctype&&"string"===d.ctype&&"string"===
e.ctype)return c=c.value,c=c.replace(new RegExp(d.value,"g"),e.value),{ctype:"string",value:c}};z.replace$2=function(a,b){function c(a,f,b){var p="";e=d=-1;for(var g=0;g<f.length;g++){var h=f[g][0],k=a.indexOf(h,b);-1!==k&&(-1===d?(p=h,d=k,e=g):k<d&&(p=h,d=k,e=g))}return p}var d,e,g,h=I(a[0]);g=I(a[1]);if("string"===h.ctype&&"list"===g.ctype){for(var h=h.value,k=[],l=0;l<g.value.length;l++){var m=g.value[l];"list"===m.ctype&&2===m.value.length&&"string"===m.value[0].ctype&&"string"===m.value[1].ctype&&
(k[k.length]=[m.value[0].value,m.value[1].value])}d=-1;for(g=c(h,k,0);-1!==d;)h=h.substring(0,d)+k[e][1]+h.substring(d+g.length,h.length),g=d+k[e][1].length,g=c(h,k,g);return{ctype:"string",value:h}}return x};z.substring$3=function(a,b){var c=I(a[0]),d=N(a[1]),e=N(a[2]);return"string"===c.ctype&&"number"===d.ctype&&"number"===e.ctype?{ctype:"string",value:c.value.substring(Math.floor(d.value.real),Math.floor(e.value.real))}:x};z.tokenize$2=function(a,b){var c,d;c=I(a[0]);var e=I(a[1]);if("string"===
c.ctype&&"string"===e.ctype){var g=!0;void 0!==b.autoconvert&&(d=I(b.autoconvert),"boolean"===d.ctype&&(g=d.value));e=c.value.split(e.value);c=[];for(d=0;d<e.length;d++){var h=e[d];if(g){var k=parseFloat(h);isNaN(k)||(h=k)}c[d]={ctype:"string",value:h}}return m.turnIntoCSList(c)}if("string"===c.ctype&&"list"===e.ctype){if(0===e.value.length)return c;c=e.value[0];g=m.turnIntoCSList(g);h=z.tokenize$2([a[0],c],b).value;c=[];for(d=0;d<h.length;d++){g=[];for(k=1;k<e.value.length;k++)g[k-1]=e.value[k];
g=m.turnIntoCSList(g);c[d]=z.tokenize$2([h[d],g],b)}return m.turnIntoCSList(c)}return x};z.indexof$2=function(a,b){var c=I(a[0]),d=I(a[1]);return"string"===c.ctype&&"string"===d.ctype?(c=c.value.indexOf(d.value),q.real(c+1)):x};z.indexof$3=function(a,b){var c=I(a[0]),d=I(a[1]),e=I(a[2]);return"string"===c.ctype&&"string"===d.ctype&&"number"===e.ctype?(c=c.value,d=d.value,e=Math.round(e.value.real),e=c.indexOf(d,e-1),q.real(e+1)):x};z.parse$1=function(a,b){var c=I(a[0]);return"string"===c.ctype?(c=
gb(c.value),c=Fa(c),I(c)):x};z.unicode$1=function(a,b){var c;c=I(a[0]);var d=16;if(b.base){var e=I(b.base);"number"===e.ctype&&(d=e.value.real)}if("string"===c.ctype)c=parseInt(c.value,d);else if("number"===c.ctype)c=c.value.real;else return x;"undefined"!==typeof String.fromCodePoint?c=String.fromCodePoint(c):65535>=c?c=String.fromCharCode(c):(c-=65536,c=String.fromCharCode((c>>10)+55296,(c&1023)+56320));return G.string(c)};z.international$1=function(a,b){return z.international$2([a[0],null],b)};
z.international$2=function(f,b){var c=I(f[0]);if("string"!==c.ctype)return x;var d=(a.translations||{})[a.language||"en"]||{};if(!d.hasOwnProperty(c.value))return c;var e=d[c.value];if("string"===typeof e)return G.string(e);if(null===f[1])return c;var g=I(f[1]),g="number"===g.ctype?g.value.real:0,d=(d._pluralFormFunction||Ac)(g);return d<e.length?G.string(e[d]):c};z.currentlanguage$0=function(f,b){return G.string(a.language||"en")};Q.basismap=function(a,b,c,d){var e=m.turnIntoCSList([a,b,c]),e=m.inverse(m.transpose(e));
d=G.mult(e,d);e=m.turnIntoCSList([G.mult(d.value[0],a),G.mult(d.value[1],b),G.mult(d.value[2],c)]);return m.transpose(e)};z.map$8=function(a,b){var c=ga(a[0]),d=ga(a[1]),e=ga(a[2]),g=ga(a[3]),h=ga(a[4]),k=ga(a[5]),l=ga(a[6]),q=ga(a[7]);return h!==x&&k!==x&&l!==x&&q!==x&&c!==x&&d!==x&&e!==x&&g!==x?(h=Q.basismap(h,k,l,q),c=Q.basismap(c,d,e,g),c=G.mult(h,m.inverse(c)),m.normalizeMax(c)):x};z.map$6=function(a,b){var c=ga(a[0]),d=ga(a[1]),e=ga(a[2]),g=m.realVector([0,0,1]),h=m.cross,k=h(h(e,h(g,h(c,d))),
h(d,h(g,h(c,e)))),l=ga(a[3]),q=ga(a[4]),n=ga(a[5]),g=h(h(n,h(g,h(l,q))),h(q,h(g,h(l,n))));return l!==x&&q!==x&&n!==x&&g!==x&&c!==x&&d!==x&&e!==x&&k!==x?(l=Q.basismap(l,q,n,g),c=Q.basismap(c,d,e,k),c=G.mult(l,m.inverse(c)),m.normalizeMax(c)):x};z.map$4=function(a,b){var c=m.ii,d=m.jj,e=ga(a[0]),g=ga(a[1]),h=ga(a[2]),k=ga(a[3]);return h!==x&&k!==x&&e!==x&&g!==x?(h=Q.basismap(h,k,c,d),c=Q.basismap(e,g,c,d),c=G.mult(h,m.inverse(c)),m.normalizeMax(c)):x};z.map$2=function(a,b){var c=m.ii,d=m.jj,e=ga(a[0]),
g=G.add(m.realVector([1,0,0]),e),h=ga(a[1]),k=G.add(m.realVector([1,0,0]),h);return h!==x&&k!==x&&e!==x&&g!==x?(h=Q.basismap(h,k,c,d),c=Q.basismap(e,g,c,d),c=G.mult(h,m.inverse(c)),m.normalizeMax(c)):x};z.pointreflect$1=function(a,b){var c=m.ii,d=m.jj,e=ga(a[0]),g=G.add(m.realVector([1,0,0]),e),h=G.add(m.realVector([-1,0,0]),e);return h!==x&&e!==x&&g!==x?(h=Q.basismap(e,h,c,d),c=Q.basismap(e,g,c,d),c=G.mult(h,m.inverse(c)),m.normalizeMax(c)):x};z.linereflect$1=function(a,b){var c=m.ii,d=m.jj,e=ga(a[0]),
g=m.realVector([Math.random(),Math.random(),Math.random()]),h=m.realVector([Math.random(),Math.random(),Math.random()]),g=m.cross(g,e),h=m.cross(h,e);return e!==x&&g!==x?(e=Q.basismap(g,h,c,d),c=Q.basismap(g,h,d,c),c=G.mult(e,m.inverse(c)),m.normalizeMax(c)):x};Q.extractPointVec=function(a){var b={ok:!1};if("geo"===a.ctype){var c=a.value;if("P"===c.kind)return b.x=Ja.getField(c,"x"),b.y=Ja.getField(c,"y"),b.z=q.real(1),b.ok=!0,b}if("list"!==a.ctype)return b;var d=a.value;if(2===d.length&&(a=d[0],
c=d[1],"number"===a.ctype&&"number"===c.ctype))return b.x=a,b.y=c,b.z=q.real(1),b.ok=!0,b;3===d.length&&(a=d[0],c=d[1],d=d[2],"number"===a.ctype&&"number"===c.ctype&&"number"===d.ctype&&(b.x=q.div(a,d),b.y=q.div(c,d),b.z=q.real(1),b.ok=!0));return b};z.polygon$1=function(a,b){var c=I(a[0]);if("list"===c.ctype){for(var d=[],e=0;e<c.value.length;e++){var g=Q.extractPoint(c.value[e]);if(!g.ok)return x;d[e]={X:g.x,Y:g.y}}return{ctype:"shape",type:"polygon",value:[d]}}return x};z.circle$2=function(a,b){var c=
N(a[0]),d=N(a[1]),c=Q.extractPointVec(c);if(!c.ok||"number"!==d.ctype)return x;c=m.turnIntoCSList([c.x,c.y,c.z]);return{ctype:"shape",type:"circle",value:m.turnIntoCSList([c,d])}};z.screen$0=function(a,b){var c=D.drawingstate.initialmatrix,d=function(a,f){var b=a-c.tx,d=f+c.ty;return{X:(b*c.d-d*c.b)/c.det,Y:-(-b*c.c+d*c.a)/c.det}};return{ctype:"shape",type:"polygon",value:[[d(0,0),d(Aa,0),d(Aa,va),d(0,va)]]}};z.allpoints$0=function(a,b){for(var c=[],e=0;e<d.length;e++)c[e]={ctype:"geo",value:d[e],
type:"P"};return{ctype:"list",value:c}};z.allmasses$0=function(a,b){for(var c=[],d=0;d<sa.length;d++)c[d]={ctype:"geo",value:sa[d],type:"P"};return{ctype:"list",value:c}};z.alllines$0=function(a,b){for(var c=[],d=0;d<e.length;d++)c[d]={ctype:"geo",value:e[d],type:"L"};return{ctype:"list",value:c}};z.halfplane$2=function(a,b){var c=N(a[0]),d=N(a[1]),e=ga(c),g=ga(d);if(c!==x&&d!==x){var h=d.usage,d=g;if("Line"===c.usage||"Point"===h)e=g,d=c;c=m.turnIntoCSList([d.value[0],d.value[1],q.zero]);c=m.cross(c,
e);g=m.cross(d,c);g=G.div(g,g.value[2]);e=G.div(e,e.value[2]);e=m.sub(e,g);c=m.abs(e);e=G.div(e,c);c=g.value[0].value.real;g=g.value[1].value.real;d=1E3*e.value[0].value.real;e=1E3*e.value[1].value.real;return{ctype:"shape",type:"polygon",value:[[{X:c+e/2,Y:g-d/2},{X:c+e/2+d,Y:g-d/2+e},{X:c-e/2+d,Y:g+d/2+e},{X:c-e/2,Y:g+d/2}]]}}return x};z.convexhull3d$1=function(a,b){var c=I(a[0]);if("list"===c.ctype){var d=c.value;if(4>d.length)return console.error("Less than four input points specified"),x;for(var e=
[],g,c=0;c<d.length;c++)if(m._helper.isNumberVecN(d[c],3))for(g=0;3>g;g++)e.push(d[c].value[g].value.real);g=convexhull(e);d=g[0];e=[];for(c=0;c<d.length;c+=3)e.push(m.realVector([d[c],d[c+1],d[c+2]]));for(var d=m.turnIntoCSList(e),e=g[1],h=[],c=0;c<e.length;c++){for(g=0;g<e[c].length;g++)e[c][g]++;h.push(m.realVector(e[c]))}c=m.turnIntoCSList(h);return m.turnIntoCSList([d,c])}return x};z.javascript$1=function(a,b){var c=I(a[0]);"string"===c.ctype&&(new Function(c.value)).call(Oa);return x};z.use$1=
function(f,b){function c(a,f,b){var d=z[a];z[a]=function(c,e){if(c.length===f)return b(c,e);if(d)return d(c,e);throw"No implementation for "+a+"("+f+")";}}var d=I(f[0]);if("string"===d.ctype){var d=d.value,e;a.plugins&&(e=a.plugins[d]);e||(e=Qa._pluginRegistry[d]);if(e)return e({instance:Oa,config:a,nada:x,evaluate:I,evaluateAndVal:N,defineFunction:c,addShutdownHook:cb.push.bind(cb),addAutoCleaningEventListener:S,getVariable:ca.getvar.bind(ca),getInitialMatrix:function(){return D.drawingstate.initialmatrix},
setTextRenderer:function(a){mc=a}}),{ctype:"boolean",value:!0};console.log("Plugin "+d+" not found");return{ctype:"boolean",value:!1}}return x};z.format$2=function(a,b){function c(a){a=a.toFixed(h);var f;do f=a,a=a.substring(0,a.length-1);while(""!==a&&"-"!==a&&+a===+f);return""+f}function d(a){var f;return"number"===a.ctype?(f=c(a.value.real),a=c(a.value.imag),f="0"===a?f:"-"===a.substring(0,1)?f+" - i*"+a.substring(1):f+" + i*"+a,{ctype:"string",value:f}):"list"===a.ctype?{ctype:"list",value:a.value.map(d)}:
{ctype:"string",value:ha(a).toString()}}var e=N(a[0]),g=N(a[1]),h;return"number"!==e.ctype&&"list"!==e.ctype||"number"!==g.ctype?x:(h=Math.round(g.value.real),d(e))};Date.now||(Date.now=function(){return(new Date).getTime()});var nc=0;z.seconds$0=function(a,b){return{ctype:"number",value:{real:(Date.now()-nc)/1E3,imag:0}}};z.resetclock$0=function(a,b){nc=Date.now();return x};z.time$0=function(a,b){var c=new Date;return m.realVector([c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds()])};
z.date$0=function(a,b){var c=new Date;return m.realVector([c.getFullYear(),c.getMonth(),c.getDay()])};z.setTimeout$2=function(a,b){function c(){I(e);ma()}var d=I(a[0]),e=a[1];"number"===d.ctype&&"undefined"!==typeof window&&window.setTimeout(c,1E3*d.value.real);return x};Q.formatForWebGL=function(a){return a.toFixed(10)};z.generateWebGL$2=function(a,b){var c=Q.formatForWebGL,d=a[0],e=I(a[1]);console.log(e);if("list"!==e.ctype)return x;for(var g=[],h=0;h<e.value.length;h++)"string"===e.value[h].ctype&&
g.push(e.value[h].value);console.log("***********");console.log(g);e=Q.plotvars(d);console.log(e);-1===e.indexOf("a")&&-1===e.indexOf("b")&&-1===e.indexOf("c")&&-1===e.indexOf("d")&&-1===e.indexOf("e")&&-1===e.indexOf("f")&&(d=N(d));if("number"===d.ctype)return{ctype:"string",value:"vec2("+c(d.value.real)+","+c(d.value.imag)+")"};if("variable"===d.ctype)return{ctype:"string",value:d.name};if("string"===d.ctype||"void"===d.ctype)return d;if(2===d.args.length&&("infix"===d.ctype||"function"===d.ctype)){c=
z.compileToWebGL$1([d.args[0]],{});e=z.compileToWebGL$1([d.args[1]],{});if("+"===d.oper||"add"===d.oper)return void 0===c.value||"void"===c.ctype?{ctype:"string",value:e.value}:{ctype:"string",value:"addc("+c.value+","+e.value+")"};if("*"===d.oper||"mult"===d.oper)return{ctype:"string",value:"multc("+c.value+","+e.value+")"};if("/"===d.oper||"div"===d.oper)return{ctype:"string",value:"divc("+c.value+","+e.value+")"};if("-"===d.oper||"sub"===d.oper)return void 0===c.value||"void"===c.ctype?{ctype:"string",
value:"negc("+e.value+")"}:{ctype:"string",value:"subc("+c.value+","+e.value+")"};if("^"===d.oper||"pow"===d.oper)return{ctype:"string",value:"powc("+c.value+","+e.value+")"}}if("function"===d.ctype&&1===d.args.length){c=z.compileToWebGL$1([d.args[0]],{});if("sin$1"===d.oper)return{ctype:"string",value:"sinc("+c.value+")"};if("cos$1"===d.oper)return{ctype:"string",value:"cosc("+c.value+")"};if("tan$1"===d.oper)return{ctype:"string",value:"tanc("+c.value+")"};if("exp$1"===d.oper)return{ctype:"string",
value:"expc("+c.value+")"};if("log$1"===d.oper)return{ctype:"string",value:"logc("+c.value+")"};if("arctan$1"===d.oper)return{ctype:"string",value:"arctanc("+c.value+")"};if("arcsin$1"===d.oper)return{ctype:"string",value:"arcsinc("+c.value+")"};if("arccos$1"===d.oper)return{ctype:"string",value:"arccosc("+c.value+")"};if("sqrt$1"===d.oper)return{ctype:"string",value:"sqrtc("+c.value+")"}}return x};z.compileToWebGL$1=function(a,b){var c,d;c=Q.formatForWebGL;var e=a[0];d=Q.plotvars(e);-1===d.indexOf("a")&&
-1===d.indexOf("b")&&-1===d.indexOf("c")&&-1===d.indexOf("d")&&-1===d.indexOf("e")&&-1===d.indexOf("f")&&(e=N(e));if("number"===e.ctype)return{ctype:"string",value:"vec2("+c(e.value.real)+","+c(e.value.imag)+")"};if("variable"===e.ctype)return{ctype:"string",value:e.name};if("string"===e.ctype||"void"===e.ctype)return e;if(2===e.args.length&&("infix"===e.ctype||"function"===e.ctype)){c=z.compileToWebGL$1([e.args[0]],{});d=z.compileToWebGL$1([e.args[1]],{});if("+"===e.oper||"add"===e.oper)return void 0===
c.value||"void"===c.ctype?{ctype:"string",value:d.value}:{ctype:"string",value:"addc("+c.value+","+d.value+")"};if("*"===e.oper||"mult"===e.oper)return{ctype:"string",value:"multc("+c.value+","+d.value+")"};if("/"===e.oper||"div"===e.oper)return{ctype:"string",value:"divc("+c.value+","+d.value+")"};if("-"===e.oper||"sub"===e.oper)return void 0===c.value||"void"===c.ctype?{ctype:"string",value:"negc("+d.value+")"}:{ctype:"string",value:"subc("+c.value+","+d.value+")"};if("^"===e.oper||"pow"===e.oper)return{ctype:"string",
value:"powc("+c.value+","+d.value+")"}}if("function"===e.ctype&&1===e.args.length){c=z.compileToWebGL$1([e.args[0]],{});if("sin$1"===e.oper)return{ctype:"string",value:"sinc("+c.value+")"};if("cos$1"===e.oper)return{ctype:"string",value:"cosc("+c.value+")"};if("tan$1"===e.oper)return{ctype:"string",value:"tanc("+c.value+")"};if("exp$1"===e.oper)return{ctype:"string",value:"expc("+c.value+")"};if("log$1"===e.oper)return{ctype:"string",value:"logc("+c.value+")"};if("arctan$1"===e.oper)return{ctype:"string",
value:"arctanc("+c.value+")"};if("arcsin$1"===e.oper)return{ctype:"string",value:"arcsinc("+c.value+")"};if("arccos$1"===e.oper)return{ctype:"string$1",value:"arccosc("+c.value+")"};if("sqrt$1"===e.oper)return{ctype:"string",value:"sqrtc("+c.value+")"}}return x};z.setsimulationspeed$1=function(a,b){var c=N(a[0]);"number"===c.ctype&&"undefined"!==typeof ba&&"undefined"!==typeof ba.env&&(ba.env.deltat=c.value.real);return x};z.setsimulationaccuracy$1=function(a,b){var c=N(a[0]);"number"===c.ctype&&
"undefined"!==typeof ba&&"undefined"!==typeof ba.env&&(ba.env.accuracy=c.value.real);return x};z.setsimulationquality$1=function(a,b){var c=N(a[0]);"number"===c.ctype&&"undefined"!==typeof ba&&"undefined"!==typeof ba.env&&(c=c.value.real,0===c&&(ba.env.errorbound=.01,ba.env.lowestdeltat=1E-5,ba.env.slowdownfactor=2),1===c&&(ba.env.errorbound=.001,ba.env.lowestdeltat=1E-7,ba.env.slowdownfactor=2),2===c&&(ba.env.errorbound=1E-5,ba.env.lowestdeltat=1E-10,ba.env.slowdownfactor=4),3===c&&(ba.env.errorbound=
1E-6,ba.env.lowestdeltat=1E-12,ba.env.slowdownfactor=4));return x};Q.extractPoint=function(a){var b={ok:!1};if("geo"===a.ctype){var c=a.value;if("P"===c.kind)return b.x=Ja.getField(c,"x").value.real,b.y=Ja.getField(c,"y").value.real,b.ok=!0,b}if("list"!==a.ctype)return b;var d=a.value;if(2===d.length&&(a=d[0],c=d[1],"number"===a.ctype&&"number"===c.ctype))return b.x=a.value.real,b.y=c.value.real,b.ok=!0,b;3===d.length&&(a=d[0],c=d[1],d=d[2],"number"===a.ctype&&"number"===c.ctype&&"number"===d.ctype&&
(a=q.div(a,d),c=q.div(c,d),b.x=a.value.real,b.y=c.value.real,b.ok=!0));return b};z.draw$1=function(a,b){var c=N(a[0]);if("shape"===c.ctype)Q.drawshape(c,b);else if("Line"===c.usage)K.handleModifs(b,K.lineModifs),K.drawline(c);else{var d=Q.extractPoint(c);if(!d.ok){if("undefined"!==typeof c.value&&2===c.value.length)return z.draw$2(c.value,b);return}null!==b&&K.handleModifs(b,K.pointModifs);K.drawpoint(d)}return x};z.draw$2=function(a,b){var c=N(a[0]),d=N(a[1]),c=Q.extractPoint(c),d=Q.extractPoint(d);
if(!c.ok||!d.ok)return x;null!==b&&K.handleModifs(b,K.lineModifs);K.drawsegcore(c,d);return x};z.drawcircle$2=function(a,b){return Q.drawcircle(a,b,"D")};z.fillcircle$2=function(a,b){return Q.drawcircle(a,b,"F")};Q.drawcircle=function(a,b,c){var d=N(a[0]);a=N(a[1]);var e=Q.extractPoint(d);if(!e.ok||"number"!==a.ctype)return x;var d=D.drawingstate.matrix,g=e.x*d.a-e.y*d.b+d.tx,e=e.x*d.c-e.y*d.d-d.ty;K.handleModifs(b,K.conicModifs);b=1.6;null!==K.size&&(b=K.size);M.lineWidth=b;M.beginPath();M.arc(g,
e,a.value.real*d.sdet,0,2*Math.PI);"D"===c&&(M.strokeStyle=K.lineColor,M.stroke());"F"===c&&(M.fillStyle=K.lineColor,M.fill());"C"===c&&M.clip();return x};z.drawconic$1=function(a,b){var c={usage:"conic"},d=N(a[0]);if("list"!==d.ctype||3!==d.value.length&&6!==d.value.length)return console.error("could not parse conic"),x;if(6===d.value.length){for(var e=0;6>e;e++)if("number"!==d.value[e].ctype)return console.error("could not parse conic"),x;var g=q.real(.5),e=d.value[0],h=d.value[2],h=q.mult(h,g),
k=d.value[1],l=d.value[3],l=q.mult(l,g),n=d.value[4],n=q.mult(n,g),d=d.value[5],d=m.turnIntoCSList([m.turnIntoCSList([e,h,l]),m.turnIntoCSList([h,k,n]),m.turnIntoCSList([l,n,d])])}else{for(e=0;3>e;e++)for(h=0;3>h;h++)if("number"!==d.value[e].value[h].ctype)return console.error("could not parse conic"),x;m.equals(d,m.transpose(d)).value||(e=G.mult(d,q.real(.5)),d=G.mult(m.transpose(d),q.real(.5)),d=m.add(e,d))}c.matrix=d;return Q.drawconic(c,b)};Q.drawconic=function(a,b){K.handleModifs(b,K.conicModifs);
var c=1.6;null!==K.size&&(c=K.size);if(0!==c){M.lineWidth=c;for(var d=a.matrix,e=a.matrix,g=0;2>g;g++)for(var h=0;2>h;h++)if(1E-14<Math.abs(d.value[g].value[h].value.imag))return;g=m.turnIntoCSList([m.realVector([-1,-1,1]),m.realVector([1,0,0]),m.realVector([0,1,0])]);h=D.from(0,0,1);h[2]=1;var k=D.from(1,0,1);k[2]=1;var l=D.from(0,1,1);l[2]=1;var h=m.turnIntoCSList([m.realVector(h),m.realVector(k),m.realVector(l)]),h=m.transpose(h),g=G.mult(h,g),g=m.inverse(g),d=G.mult(m.transpose(g),d),d=G.mult(d,
g),g=d.value[0].value[0].value.real,h=d.value[1].value[0].value.real,k=d.value[1].value[1].value.real,l=d.value[2].value[0].value.real,q=d.value[2].value[1].value.real,n=d.value[2].value[2].value.real,d=[[g,h,l],[h,k,q],[l,q,n]],r=1E-14>Math.abs(g*k*n-g*q*q-h*h*n+2*h*l*q-k*l*l),t=Aa>va?Aa:va,u=-1.5*t,v=1.5*t,w=-1.5*t,y=1.5*t,A=1;r&&(A=0);if(A)var l=0,l=1E-14<Math.abs(g-h)?Math.atan(h/g-k)/2:Math.PI/4,C=function(a){var f=Math.cos(a);a=Math.sin(a);return[[f,-a,0],[a,f,0],[0,0,1]]}(l),g=numeric.transpose(C),
d=numeric.dot(d,C),d=numeric.dot(g,d),g=d[0][0],h=d[1][0],k=d[1][1],l=d[2][0],q=d[2][1],n=d[2][2];var d=[g,h,k,l,q,n],g=function(){var a=B._helper.splitDegenConic(e);if(a!==x){var f=a[1],a=[a[0]];z.draw$1(a,b);a[0]=f;z.draw$1(a,b)}},E=function(a){"undefined"!==a&&6===a.length||console.error("this does not define a Conic");if(r)return"degenerate";a=a[0]*a[2]-a[1]*a[1];return 1E-14>Math.abs(a)?"parabola":1E-14<a?"ellipsoid":"hyperbola"};E(d);var F=function(a,f){return 0<a&&a<Aa&&0<f&&f<va},H=[],I=[],
J=[],L=[],N=[],O=[],P=function(){H=[];I=[];J=[];L=[];N=[];O=[]},Q=function(a,f){M.strokeStyle=K.lineColor;M.lineWidth=c;M.beginPath();M.moveTo(a[0],f[0]);for(var b=1;b<a.length;b++)M.lineTo(a[b],f[b]);M.stroke()},R=function(a,f,b){var c,d,e=E(a);if(6!==a.length)console.error("Conic needs 6 Parameters");else{var g=a[0],p=a[1],h=a[2],k=a[3],l=a[4];a=a[5];var m;c=b-f;for(var q=.05*c+f,n=b-.05*c,Z=f;Z<=b;Z+=m){m=Z<q||Z>n||100>Math.abs(b-f)?.5:0>Z||Z>va?10:3;d=-g*h*Math.pow(Z,2)-2*g*l*Z-g*a+Math.pow(p,
2)*Math.pow(Z,2)+2*p*k*Z+Math.pow(k,2);d=Math.sqrt(d);c=1/g*(-p*Z-k+d);d=-1/g*(p*Z+k+d);var r,t;A?(r=[c,Z,1],t=[d,Z,1],r=numeric.dot(C,r),t=numeric.dot(C,t),c=r[0],d=t[0],r=r[1],t=t[1]):t=r=Z;isNaN(c)||"ellipsoid"!==e?!isNaN(c)&&c>=u&&c<=v&&(H.push(c),J.push(r)):(H.push(c),J.push(r));isNaN(d)||"ellipsoid"!==e?!isNaN(d)&&d>=u&&d<=v&&(I.push(d),L.push(t)):(I.push(d),L.push(t))}}},h=function(a){var f,b,c;E(a);if(6!==a.length)console.error("Conic needs 6 Parameters");else{c=a[0];var d=a[1],e=a[2],g=a[3],
p=a[4],h=a[5];f=-c*p+d*g;b=Math.sqrt(c*(-c*e*h+c*Math.pow(p,2)+Math.pow(d,2)*h-2*d*g*p+e*Math.pow(g,2)));e=c*e-Math.pow(d,2);0!==e?(c=(f-b)/e,b=(f+b)/e):b=c=(-c*h+g*g)/(2*c*p-2*d*g);!isNaN(c)&&c>w&&c<y||(c=w);!isNaN(b)&&b>w&&b<y||(b=w);f=c<b?c:b;b=c>b?c:b;R(a,w,f);N=H.concat(I.reverse());O=J.concat(L.reverse());Q(N,O);P();R(a,b,y);Q(H,J);if(F(H[0],J[1])||F(I[0],L[0]))M.beginPath(),M.moveTo(H[0],J[0]),M.lineTo(I[0],L[0]),M.stroke();Q(I,L);P();R(a,f,b);Q(H,J);M.beginPath();M.moveTo(H[0],J[0]);M.lineTo(I[0],
L[0]);M.stroke();M.beginPath();M.moveTo(H[H.length-1],J[J.length-1]);M.lineTo(I[I.length-1],L[L.length-1]);M.stroke();Q(I,L);P()}};r?g():h(d)}};z.drawall$1=function(a,b){var c=I(a[0]);if("list"===c.ctype){K.handleModifs(b,K.pointAndLineModifs);for(var d=0;d<c.value.length;d++)z.draw$1([c.value[d]],null)}return x};z.connect$1=function(a,b){return Q.drawpolygon(a,b,"D",!1)};z.drawpoly$1=function(a,b){return Q.drawpolygon(a,b,"D",!0)};z.fillpoly$1=function(a,b){return Q.drawpolygon(a,b,"F",!0)};z.drawpolygon$1=
function(a,b){return Q.drawpolygon(a,b,"D",!0)};z.fillpolygon$1=function(a,b){return Q.drawpolygon(a,b,"F",!0)};Q.drawpolygon=function(a,b,c,d){function e(){for(var a=k.value,f=0;f<a.length;f++){var b=a[f],c;for(c=0;c<b.length;c++){var d=b[c],g=d.X*h.a-d.Y*h.b+h.tx,d=d.X*h.c-d.Y*h.d-h.ty;0===c?M.moveTo(g,d):M.lineTo(g,d)}M.closePath()}}function g(){var a;for(a=0;a<k.value.length;a++){var f=Q.extractPoint(k.value[a]);if(!f.ok)return;var b=f.x*h.a-f.y*h.b+h.tx,f=f.x*h.c-f.y*h.d-h.ty;0===a?M.moveTo(b,
f):M.lineTo(b,f)}d&&M.closePath()}K.handleModifs(b,K.conicModifs);b=1.6;null!==K.size&&(b=K.size);M.lineWidth=b;M.mozFillRule="evenodd";M.lineJoin="round";var h=D.drawingstate.matrix,k=I(a[0]);M.beginPath();"list"===k.ctype&&g();"shape"===k.ctype&&e();"D"===c&&(M.strokeStyle=K.lineColor,M.stroke());"F"===c&&(M.fillStyle=K.lineColor,M.fill());"C"===c&&M.clip();return x};var mc=function(a,b,c,d,e){var g=a.measureText(b).width;a.fillText(b,c-g*e,d)};z.drawtext$2=function(a,b){var c=N(a[0]),d=I(a[1]),
e=Q.extractPoint(c);if(!e.ok)return x;var g=D.drawingstate.matrix,c=e.x*g.a-e.y*g.b+g.tx,e=e.x*g.c-e.y*g.d-g.ty;K.handleModifs(b,K.textModifs);g=D.drawingstate.textsize;null!==K.size&&(g=K.size);M.fillStyle=K.textColor;M.font=K.bold+K.italics+Math.round(10*g)/10+"px "+K.family;d=ha(d);mc(M,d,c+K.xOffset,e-K.yOffset,K.align);return x};Q.drawshape=function(a,b){return"polygon"===a.type?Q.drawpolygon([a],b,"D",1):"circle"===a.type?Q.drawcircle([a.value.value[0],a.value.value[1]],b,"D"):x};Q.fillshape=
function(a,b){return"polygon"===a.type?Q.drawpolygon([a],b,"F",1):"circle"===a.type?Q.drawcircle([a.value.value[0],a.value.value[1]],b,"F"):x};Q.clipshape=function(a,b){return"polygon"===a.type?Q.drawpolygon([a],b,"C",1):"circle"===a.type?Q.drawcircle([a.value.value[0],a.value.value[1]],b,"C"):x};z.fill$1=function(a,b){var c=I(a[0]);return"shape"===c.ctype?Q.fillshape(c,b):x};z.clip$1=function(a,b){var c=I(a[0]);return"shape"===c.ctype?Q.clipshape(c,b):"list"===c.ctype?(c=z.polygon$1(a,[]),z.clip$1([c],
[])):x};z.plot$1=function(a,b){return z.plot$2([a[0],null],b)};z.plot$2=function(a,b){function c(a){return"number"===a.ctype&&q._helper.isAlmostReal(a)}function d(a,f,b,c,e){k++;f=+f.value.real;e=+c.value.real;c=f*z.a-e*z.b+z.tx;f=f*z.c-e*z.d-z.ty;a=+a.value.real;e=+b.value.real;b=a*z.a-e*z.b+z.tx;a=a*z.c-e*z.d-z.ty;l?(M.lineTo(b,a),M.lineTo(c,f)):(M.beginPath(),M.moveTo(b,a),M.lineTo(c,f),l=!0)}function e(a,f,b,k,m){var n=c(b),Z=c(k);if(.001>m)!g&&l&&(M.stroke(),l=!1);else if(n||Z){var r=q.real((a.value.real+
f.value.real)/2);ca.setvar(w,r);var t=I(v),u=c(t);if(n&&Z&&u){var y=b.value.real,Z=t.value.real,u=k.value.real;if(n=1>Math.abs(y+u-2*Z)/h){var x=q.real((a.value.real+r.value.real)/2);ca.setvar(w,x);var x=I(v),z=q.real((r.value.real+f.value.real)/2);ca.setvar(w,z);z=I(v).value.real;y=Math.abs(y+Z-2*x.value.real)/h;Z=Math.abs(Z+u-2*z)/h;n=n&&1>y&&1>Z}n?(d(a,r,b,t,m/2),d(r,f,t,k,m/2)):(e(a,r,b,t,m/2),e(r,f,t,k,m/2))}else e(a,r,b,t,m/2),e(r,f,t,k,m/2)}}var g=!1,h=.2/jb,k=0,l=!1,n=-10,r=10,t=1,u=1E3,v=
a[0],w;if(null!==a[1]&&"variable"===a[1].ctype)w=a[1].name;else{var y=Q.plotvars(v);w="#";-1!==y.indexOf("t")&&(w="t");-1!==y.indexOf("z")&&(w="z");-1!==y.indexOf("y")&&(w="y");-1!==y.indexOf("x")&&(w="x")}ca.newvar(w);var z=D.drawingstate.matrix;K.handleModifs(b,{color:!0,alpha:!0,size:!0,dashpattern:!0,dashtype:!0,dashing:!0,connect:function(a){"boolean"===a.ctype&&(g=a.value)},start:function(a){"number"===a.ctype&&(n=a.value.real)},stop:function(a){"number"===a.ctype&&(r=a.value.real)},steps:function(a){"number"===
a.ctype&&(u=a.value.real)}});M.strokeStyle=K.lineColor;M.lineWidth=K.lsize;M.lineCap="round";M.lineJoin="round";var A,B,C,E,l=!1,y=q.real(14.32);ca.setvar(w,y);C=I(v);if("number"!==C.ctype){if(m.isNumberVector(C).value&&2===C.value.length){l=!1;t=(r-n)/u;for(y=n;y<r;y+=t)ca.setvar(w,q.real(y)),E=I(v),m.isNumberVector(E).value&&2===E.value.length&&(A=+E.value[0].value.real,B=+E.value[1].value.real,E=A*z.a-B*z.b+z.tx,A=A*z.c-B*z.d-z.ty,l?M.lineTo(E,A):(M.beginPath(),M.moveTo(E,A),l=!0));M.stroke();
ca.removevar(w)}return x}for(E=n;E<r+t;E+=t)y=q.real(E),ca.setvar(w,y),C=I(v),y.value.real>n&&e(A,y,B,C,t),A=y,B=C;ca.removevar(w);l&&M.stroke();return x};z.plotX$1=function(a,b){var c=a[0],d=Q.plotvars(c),e="#";-1!==d.indexOf("t")&&(e="t");-1!==d.indexOf("z")&&(e="z");-1!==d.indexOf("y")&&(e="y");-1!==d.indexOf("x")&&(e="x");ca.newvar(e);d=D.drawingstate.matrix;M.fillStyle=D.drawingstate.linecolor;M.lineWidth=1;M.lineCap="round";for(var g=!1,h=-10;10>h;h+=.01){ca.setvar(e,q.real(h));var k=I(c);if("number"===
k.ctype){var l=+k.value.real,k=h*d.a-l*d.b+d.tx,l=h*d.c-l*d.d-d.ty;g?M.lineTo(k,l):(M.beginPath(),M.moveTo(k,l),g=!0)}}M.stroke();ca.removevar(e);return x};Q.plotvars=function(a){function b(a,f){var c={},d;for(d=a.length-1;0<=d;--d)c[a[d]]=a[d];for(d=f.length-1;0<=d;--d)c[f[d]]=f[d];d=[];for(var e in c)c.hasOwnProperty(e)&&d.push(c[e]);return d}function c(a,f){for(var b=0;b<a.length;b++)a[b]===f&&(a.splice(b,1),b--);return a}var d,e,g,h;if("variable"===a.ctype)return[a.name];if("infix"===a.ctype)return d=
Q.plotvars(a.args[0]),a=Q.plotvars(a.args[1]),b(d,a);if("list"===a.ctype){g=a.value;e=[];for(h=0;h<g.length;h++)d=Q.plotvars(g[h]),e=b(e,d);return e}if("function"===a.ctype){g=a.args;e=[];for(h=0;h<g.length;h++)d=Q.plotvars(g[h]),e=b(e,d);"apply"!==a.oper&&"select"!==a.oper&&"forall"!==a.oper&&"sum"!==a.oper&&"product"!==a.oper&&"repeat"!==a.oper&&"min"!==a.oper&&"max"!==a.oper&&"sort"!==a.oper||"variable"!==a.args[1].ctype||(e=c(e,a.args[1].name));return e}return[]};z.clrscr$0=function(a,b){"undefined"!==
typeof Aa&&"undefined"!==typeof va&&M.clearRect(0,0,Aa,va);return x};z.repaint$0=function(a,b){ma();return x};z.screenbounds$0=function(a,b){var c=G.withUsage(m.realVector(D.to(0,0)),"Point"),d=G.withUsage(m.realVector(D.to(Aa,0)),"Point"),e=G.withUsage(m.realVector(D.to(Aa,va)),"Point"),g=G.withUsage(m.realVector(D.to(0,va)),"Point");return m.turnIntoCSList([c,d,e,g])};z.createimage$3=function(a,b){var c=I(a[0]),d=N(a[1]),e=N(a[2]);if("number"!==d.ctype||"number"!==e.ctype||"string"!==c.ctype)return x;
var g=document.createElement("canvas");g.id=c.value;g.width=d.value.real;g.height=e.value.real;g.style.display="none";document.body.appendChild(g);za[c.value]=g;return x};z.clearimage$1=function(a,b){var c=I(a[0]);if("string"!==c.ctype)return x;c=document.getElementById(c.value);if("undefined"===typeof c||null===c)return x;var d=c.width,e=c.height;c.getContext("2d").clearRect(0,0,d,e);return x};z.canvas$4=function(a,b){var c=N(a[0]),d=N(a[1]),e=I(a[2]),g=a[3],h=Q.extractPoint(c),k=Q.extractPoint(d);
if(!h.ok||!k.ok||"string"!==e.ctype)return x;e=document.getElementById(e.value);if("undefined"===typeof e||null===e)return x;var c=e.width,d=e.height,l=k.x-h.x,m=k.y-h.y,q=h.x-m*d/c,n=h.y+l*d/c,m=k.x-m*d/c,l=k.y+l*d/c,k=D.from(h.x,h.y,1),q=D.from(q,n,1),m=D.from(m,l,1),h=k[0],n=k[1],l=q[0],r=q[1],t=m[0],u=m[1],q=c*(n-r)/((h-l)*(n-u)-(h-t)*(n-r)),c=c*(h-l)/((n-r)*(h-t)-(n-u)*(h-l)),m=-q*h-c*n,k=(d*(n-u)-d*(n-r))/((h-l)*(n-u)-(h-t)*(n-r)),l=(d*(h-t)-d*(h-l))/((n-r)*(h-t)-(n-u)*(h-l)),d=d-k*h-l*n,e=
e.getContext("2d"),h=M;M=e;M.save();M.transform(q,k,c,l,m,d);I(g);M.restore();M=h};z.canvas$5=function(a,b){var c=N(a[0]),d=N(a[1]),e=N(a[2]),g=I(a[3]),h=a[4],c=Q.extractPoint(c),d=Q.extractPoint(d),k=Q.extractPoint(e);if(!c.ok||!d.ok||!k.ok||"string"!==g.ctype)return x;g=document.getElementById(g.value);if("undefined"===typeof g||null===g)return x;var l=g.width,e=g.height,m=D.from(c.x,c.y,1),q=D.from(d.x,d.y,1),d=D.from(k.x,k.y,1),c=m[0],k=m[1],n=q[0],r=q[1],t=d[0],u=d[1],d=((0-l)*(k-u)-0*(k-r))/
((c-n)*(k-u)-(c-t)*(k-r)),l=((0-l)*(c-t)-0*(c-n))/((k-r)*(c-t)-(k-u)*(c-n)),q=0-d*c-l*k,m=((e-e)*(k-u)-(e-0)*(k-r))/((c-n)*(k-u)-(c-t)*(k-r)),n=((e-e)*(c-t)-(e-0)*(c-n))/((k-r)*(c-t)-(k-u)*(c-n)),e=e-m*c-n*k,g=g.getContext("2d"),c=M;M=g;M.save();M.transform(d,m,l,n,q,e);I(h);M.restore();M=c};z.screenresolution$0=function(a,b){return q.real(D.drawingstate.matrix.a)};z.layer$1=function(a,b){};Q.extractReferenceX=function(a,b){};z.imagesize$1=function(a,b){var c=N(a[0]);return"string"===c.ctype&&za[c.value]?
m.realVector([za[c.value].width,za[c.value].height]):x};z.drawimage$2=function(a,b){function c(){var a=1,f=1,d=1,g=1,h=0,p=1,l=Q.extractPoint(e);if(!l.ok||"string"!==k.ctype)return x;M.save();var q;void 0!==b.angle&&(q=I(b.angle),"number"===q.ctype&&(h=q.value.real));void 0!==b.rotation&&(q=I(b.rotation),"number"===q.ctype&&(h=q.value.real));void 0!==b.scale&&(q=N(b.scale),"number"===q.ctype&&(f=a=q.value.real),m.isNumberVector(q).value&&2===q.value.length&&(a=q.value[0].value.real,f=q.value[1].value.real));
void 0!==b.scalex&&(q=I(b.scalex),"number"===q.ctype&&(a=q.value.real));void 0!==b.scaley&&(q=I(b.scaley),"number"===q.ctype&&(f=q.value.real));void 0!==b.flipx&&(q=I(b.flipx),"boolean"===q.ctype&&q.value&&(d=-1));void 0!==b.flipy&&(q=I(b.flipy),"boolean"===q.ctype&&q.value&&(g=-1));void 0!==b.alpha&&(q=I(b.alpha),"number"===q.ctype&&(p=q.value.real));var n=D.drawingstate.matrix,r=D.drawingstate.initialmatrix;q=za[k.value].width;var t=za[k.value].height,u=l.x*n.a-l.y*n.b+n.tx,v=l.x*n.c-l.y*n.d-n.ty,
ua=(l.x+1)*n.a-l.y*n.b+n.tx-u,n=(l.x+1)*n.c-l.y*n.d-n.ty-v,w=(l.x+1)*r.a-l.y*r.b+r.tx-(l.x*r.a-l.y*r.b+r.tx),r=(l.x+1)*r.c-l.y*r.d-r.ty-(l.x*r.c-l.y*r.d-r.ty),l=Math.sqrt(ua*ua+n*n)/Math.sqrt(w*w+r*r),ua=-Math.atan2(ua,n)+Math.atan2(w,r);1!==p&&(M.globalAlpha=p);M.translate(u,v);M.scale(a*d*l,f*g*l);M.rotate(h+ua);M.translate(-u,-v);M.translate(-q/2,-t/2);M.drawImage(za[k.value],u,v);M.globalAlpha=1;M.restore()}function d(){var a=1,f=1,c=1,p=1,l=Q.extractPoint(e),m=Q.extractPoint(g),q;if(!l.ok||!m.ok||
"string"!==k.ctype)return x;if(void 0!==za&&void 0!==za[k.value]){var n=za[k.value].width,r=za[k.value].height;if(0===h)q={},q.x=l.x-(m.y-l.y),q.y=l.y+(m.x-l.x),p=r/n;else if(q=Q.extractPoint(h),!l.ok)return x;M.save();var t;void 0!==b.alpha&&(t=I(b.alpha),"number"===t.ctype&&(a=t.value.real));void 0!==b.aspect&&(t=I(b.aspect),"number"===t.ctype&&(p=t.value.real));void 0!==b.flipx&&(t=I(b.flipx),"boolean"===t.ctype&&t.value&&(f=-1));void 0!==b.flipy&&(t=I(b.flipy),"boolean"===t.ctype&&t.value&&(c=
-1));t=D.drawingstate.matrix;1!==a&&(M.globalAlpha=a);a=l.x*t.a-l.y*t.b+t.tx;l=l.x*t.c-l.y*t.d-t.ty;M.transform(m.x*t.a-m.y*t.b+t.tx-a,m.x*t.c-m.y*t.d-t.ty-l,q.x*t.a-q.y*t.b+t.tx-a,q.x*t.c-q.y*t.d-t.ty-l,a,l);M.scale(1/n,-1/r*p);M.translate(n/2,-r/2);M.scale(f,c);M.translate(-n/2,r/2);M.translate(0,-r);M.drawImage(za[k.value],0,0);M.globalAlpha=1;M.restore()}}var e,g,h,k;return 2===a.length?(e=N(a[0]),k=N(a[1]),c()):3===a.length?(e=N(a[0]),g=N(a[1]),h=0,k=N(a[2]),d()):4===a.length?(e=N(a[0]),g=N(a[1]),
h=N(a[2]),k=N(a[3]),d()):x};z.drawimage$3=z.drawimage$2;z.drawimage$4=z.drawimage$2;var Ob;Ob=[0,0,0,0,0,0,0,0,0,0,0,0];z.playsin$1=function(a,b){var c=N(a[0]),d=0;if("number"===c.ctype){var e;void 0!==b.line&&(e=I(b.line),"number"===e.ctype&&(d=Math.floor(e.value.real),0>d&&(d=0),10<d&&(d=10)));c=c.value.real;0!==Ob[d]&&Ob[d].set({freq:c})}return x};var fa={printArr:function(a){for(var b=a.value.length,c=[],d=[],e=!1,g=0;g<b;g++)c[g]=a.value[g].value.real,d[g]=a.value[g].value.imag,0!==d[g]&&(e=
!0);console.log(c);e&&console.log(d)},zero:function(a){for(var b=[],c=q.real(0),d=0;d<a.value.real;d++)b[d]=c;return m.turnIntoCSList(b)},number:function(a,b){var c=fa.zero(b);c.value[0]=a;return c},variable:function(a,b){var c=fa.zero(b);c.value[0]=a;c.value[1]=q.real(1);return c},add:function(a,b){return m.add(a,b)},sub:function(a,b){return m.sub(a,b)},mult:function(a,b){if(a.value.length!==b.value.length)return console.error("dims don't fit return nada"),x;for(var c=a.value.length,d=fa.zero(q.real(c)),
e=q.real(0),g=0;g<c;g++){for(var h=0;h<=g;h++)e=q.add(e,q.mult(a.value[h],b.value[g-h]));d.value[g]=e;e=q.real(0)}return d},pow:function(a,b){if(0>b.value.real||b.value.real!==Math.floor(b.value.real))return fa.root(a,b);for(var c=a,d=1;d<b.value.real;d++)c=fa.mult(c,a);return c},root:function(a,b){var c=q.real(0),d=q.real(1),e=q.add(d,b),g=a.value.length,h=fa.zero(q.real(g));h.value[0]=q.pow(a.value[0],b);for(var k=c,l,m,n=1;n<g;n++){m=q.real(n);for(var r=1;r<=n;r++)l=q.mult(e,q.real(r)),l=q.div(l,
m),l=q.sub(l,d),l=q.mult(l,a.value[r]),l=q.mult(l,h.value[n-r]),k=q.add(k,l);k=q.div(k,a.value[0]);h.value[n]=k;k=c}return h},findFirstNoneZero:function(a,b,c){for(var d=Infinity,e=Infinity,g=c;g<a.value.length;g++)if(1E-12<q.abs2(a.value[g]).value.real){d=g;break}for(a=c;a<b.value.length;a++)if(1E-12<q.abs2(b.value[a]).value.real){e=a;break}return[d,e]},div:function(a,b){if(a.value.length!==b.value.length)return console.log("dims don't fit - return nada"),x;for(var c=a.value.length,d=q.real(0),e=
fa.zero(q.real(c)),g=d,h=d,k=0;k<c;k++){h=fa.findFirstNoneZero(a,b,k);k<h[0]&&h[0]===h[1]&&Infinity!==h[0]&&(a.value.splice(k,h[0]),b.value.splice(k,h[0]),e.value.splice(k,h[0]),c-=h[0]);for(var h=a.value[k],l=0;l<k;l++)g=q.add(g,q.mult(e.value[l],b.value[k-l]));h=q.sub(h,g);h=q.div(h,b.value[0]);e.value[k]=h;g=d}return e},exp:function(a){var b=q.real(0),c=a.value.length,d=fa.zero(q.real(c)),e=b,g;d.value[0]=q.exp(a.value[0]);for(var h=1;h<c;h++){for(var k=1;k<=h;k++)g=q.mult(q.real(k),a.value[k]),
g=q.mult(g,d.value[h-k]),e=q.add(e,g);d.value[h]=q.div(e,q.real(h));e=b}return d},log:function(a){var b=q.real(0),c=a.value.length,d=fa.zero(q.real(c));d.value[0]=q.log(a.value[0]);for(var e=b,g,h,k=1;k<c;k++){g=a.value[k];for(var l=1;l<k;l++)h=q.mult(q.real(l),d.value[l]),h=q.mult(h,a.value[k-l]),e=q.add(e,h);e=q.div(e,q.real(k));g=q.sub(g,e);g=q.div(g,a.value[0]);d.value[k]=g;e=b}return d},sincos:function(a){var b=q.real(0),c=a.value.length,d=fa.zero(q.real(c)),e=fa.zero(q.real(c));d.value[0]=q.sin(a.value[0]);
e.value[0]=q.cos(a.value[0]);for(var g=b,h=b,k,l,m,n=1;n<c;n++){m=q.real(n);for(var r=1;r<=n;r++)l=q.mult(q.real(r),a.value[r]),k=q.mult(l,e.value[n-r]),l=q.mult(l,d.value[n-r]),h=q.add(h,k),g=q.add(g,l);h=q.div(h,m);g=q.div(g,q.neg(m));d.value[n]=h;e.value[n]=g;g=h=b}fa.sinsave=d;fa.cossave=e;return[d,e]},sin:function(a){return fa.sincos(a)[0]},cos:function(a){return fa.sincos(a)[1]},faculty:function(a){var b=[];b[0]=q.real(1);for(var c=1,d=1;d<=a.value.real;d++)c*=d,b[d]=q.real(c);return b=m.turnIntoCSList(b)},
diff:function(a,b,c,d){var e;if("variable"===a.ctype)e=a.name!==b?fa.number(I(a),d):fa.variable(c,d);else if("number"===a.ctype)e=fa.number(a,d);else{if("infix"===a.ctype){if("*"===a.oper)return fa.mult(fa.diff(a.args[0],b,c,d),fa.diff(a.args[1],b,c,d));if("^"===a.oper)return fa.pow(fa.diff(a.args[0],b,c,d),fa.diff(a.args[1],b,c,d).value[0]);if("/"===a.oper)return fa.div(fa.diff(a.args[0],b,c,d),fa.diff(a.args[1],b,c,d));if("+"===a.oper)return fa.add(fa.diff(a.args[0],b,c,d),fa.diff(a.args[1],b,c,
d));if("-"===a.oper)return fa.sub(fa.diff(a.args[0],b,c,d),fa.diff(a.args[1],b,c,d));console.log("infix not found",a.oper);return x}if("function"===a.ctype){if("exp$1"===a.oper)return fa.exp(fa.diff(a.args[0],b,c,d));if("log$1"===a.oper)return fa.log(fa.diff(a.args[0],b,c,d));if("sin$1"===a.oper)return fa.sin(fa.diff(a.args[0],b,c,d));if("cos$1"===a.oper)return fa.cos(fa.diff(a.args[0],b,c,d))}else return console.log("ctype not found",a.ctype),x}return e},adevaluate:function(a,b,c,d){a=fa.diff(a,
b,c,d);d=fa.faculty(d);for(b=2;b<a.value.length;b++)a.value[b]=q.mult(a.value[b],d.value[b]);return a},autodiff:function(a,b,c,d){for(var e=[],g=c.value.length,h,k=0;k<g;k++)h=fa.adevaluate(a,b,c.value[k],d),e[k]=h;return e=m.turnIntoCSList(e)}},K={handleModifs:function(a,b){K.dashing&&K.unSetDash();K.colorraw=null;K.size=null;0>=K.psize&&(K.psize=0);0>=K.lsize&&(K.lsize=0);K.overhang=1;K.dashing=!1;K.isArrow=!1;K.arrowSides="==>";K.arrowposition=1;K.headlen=10;K.arrowShape="default";K.alpha=D.drawingstate.alpha;
K.bold="";K.italics="";K.family="Arial";K.align=0;K.xOffset=0;K.yOffset=0;var c,d;for(c in a)(d=b[c])?(!0===d&&(d=K.modifHandlers[c]),d(I(a[c]))):console.log("Modifier not supported: "+c);null!==K.size?K.psize=K.lsize=K.size:(K.psize=D.drawingstate.pointsize,K.lsize=D.drawingstate.linesize);K.dashing&&K.dashing(K.lsize);null!==K.colorraw?K.pointColor=K.lineColor=K.textColor=K.makeColor(K.colorraw):1===K.alpha?(K.pointColor=D.drawingstate.pointcolor,K.lineColor=D.drawingstate.linecolor,K.textColor=
D.drawingstate.textcolor):(K.pointColor=K.makeColor(D.drawingstate.pointcolorraw),K.lineColor=K.makeColor(D.drawingstate.linecolorraw),K.textColor=K.makeColor(D.drawingstate.textcolorraw));K.black=1===K.alpha?"rgb(0,0,0)":"rgba(0,0,0,"+K.alpha+")"},sin30deg:.5};K.cos30deg=Math.sqrt(.75);K.modifHandlers={size:function(a){"number"===a.ctype&&(K.size=a.value.real,0>K.size&&(K.size=0),1E3<K.size&&(K.size=1E3))},color:function(a){m.isNumberVector(a).value&&3===a.value.length&&(K.colorraw=[a.value[0].value.real,
a.value[1].value.real,a.value[2].value.real])},alpha:function(a){"number"===a.ctype&&(K.alpha=a.value.real)},dashpattern:function(a){if("list"===a.ctype){for(var b=[],c=0,d=0;c<a.value.length;c++)"number"===a.value[c].ctype&&(b[d++]=a.value[c].value.real);K.dashing=K.setDash.bind(null,b)}},dashtype:function(a){"number"===a.ctype&&(K.dashing=K.setDashType.bind(null,Math.floor(a.value.real)))},dashing:function(a){"number"===a.ctype&&(a=Math.floor(a.value.real),K.dashing=K.setDash.bind(null,[2*a,a]))},
overhang:function(a){"number"===a.ctype&&(K.overhang=K.overhang*a.value.real+(1-K.overhang)*(1-a.value.real))},arrow:function(a){"boolean"===a.ctype?K.isArrow=a.value:console.error("arrow needs to be of type boolean")},arrowshape:function(a){"string"===a.ctype?(K.arrowShape=a.value,K.isArrow=!0):console.error("arrowshape needs to be of type string")},arrowsides:function(a){"string"!==a.ctype?console.error("arrowsides is not of type string"):"==>"!==a.value&&"<==>"!==a.value&&"<=="!==a.value?console.error("arrowsides is unknows"):
(K.arrowSides=a.value,K.isArrow=!0)},arrowposition:function(a){"number"!==a.ctype?console.error("arrowposition is not of type number"):0>a.value.real?console.error("arrowposition has to be positive"):1<a.value.real?K.overhang=K.overhang*a.value.real+(1-K.overhang)*(1-a.value.real):(K.arrowposition=a.value.real,K.isArrow=!0)},arrowsize:function(a){"number"!==a.ctype?console.error("arrowsize is not of type number"):0>a.value.real?console.error("arrowsize has to be positive"):K.headlen*=a.value.real},
bold:function(a){"boolean"===a.ctype&&a.value&&(K.bold="bold ")},italics:function(a){"boolean"===a.ctype&&a.value&&(K.italics="italic ")},family:function(a){"string"===a.ctype&&(K.family=a.value)},align:function(a){"string"===a.ctype&&(a=a.value,"left"===a&&(K.align=0),"right"===a&&(K.align=1),"mid"===a&&(K.align=.5))},x_offset:function(a){"number"===a.ctype&&(K.xOffset=a.value.real)},y_offset:function(a){"number"===a.ctype&&(K.yOffset=a.value.real)},offset:function(a){"list"===a.ctype&&2===a.value.length&&
"number"===a.value[0].ctype&&"number"===a.value[1].ctype&&(K.xOffset=a.value[0].value.real,K.yOffset=a.value[1].value.real)}};K.lineModifs={size:!0,color:!0,alpha:!0,dashpattern:!0,dashtype:!0,dashing:!0,overhang:!0,arrow:!0,arrowshape:!0,arrowsides:!0,arrowposition:!0,arrowsize:!0};K.pointModifs={size:!0,color:!0,alpha:!0};K.pointAndLineModifs=K.lineModifs;K.conicModifs=K.pointModifs;K.textModifs={size:!0,color:!0,alpha:!0,bold:!0,italics:!0,family:!0,align:!0,x_offset:!0,y_offset:!0,offset:!0};
K.makeColor=function(a){return"rgba("+Math.floor(255*a[0])+","+Math.floor(255*a[1])+","+Math.floor(255*a[2])+","+K.alpha+")"};K.drawsegcore=function(a,b){function c(a,b,f){var d=a-f*w,e=b-f*x;M.beginPath();"full"===K.arrowShape&&(M.lineWidth=K.lsize/2);var g=a-f*y;f=b-f*z;M.moveTo(d,e);M.lineTo(a,b);M.lineTo(g,f);"full"===K.arrowShape?(M.fillStyle=K.lineColor,M.closePath(),M.fill()):"default"!==K.arrowShape&&console.error("arrowshape is unknown");M.stroke()}var d=D.drawingstate.matrix,e=a.x*d.a-a.y*
d.b+d.tx,g=a.x*d.c-a.y*d.d-d.ty,h=b.x*d.a-b.y*d.b+d.tx,k=b.x*d.c-b.y*d.d-d.ty,l=K.overhang,m=1-l,d=l*e+m*h,q=l*g+m*k,n=l*h+m*e,l=l*k+m*g;M.lineWidth=K.lsize;M.lineCap="round";M.lineJoin="miter";M.strokeStyle=K.lineColor;if(!K.isArrow||e===g&&h===k).01>K.lsize||(M.beginPath(),M.moveTo(d,q),M.lineTo(n,l),M.stroke());else{var e=h-e,g=k-g,h=Math.sqrt(e*e+g*g),m=e/h,r=g/h,k=K.arrowposition,t=1-k,g=k*d+t*n,e=k*q+t*l,h=k*n+t*d,k=k*l+t*q,t=K.headlen,u=K.sin30deg,v=K.cos30deg,w=t*(m*v+r*u),y=t*(m*v-r*u),x=
t*(r*v-m*u),z=t*(r*v+m*u),m=K.arrowSides;M.beginPath();"full"===K.arrowShape?("<==>"===m||"<=="===m?(r=g+w,t=e+x,u=g+y,v=e+z,1>K.arrowposition&&(M.moveTo(d,q),M.lineTo(g,e)),M.moveTo((r+u)/2,(t+v)/2)):M.moveTo(d,q),"==>"===m||"<==>"===m?(M.lineTo((h-w+(h-y))/2,(k-x+(k-z))/2),1>K.arrowposition&&(M.moveTo(h,k),M.lineTo(n,l))):M.lineTo(n,l)):(M.moveTo(d,q),M.lineTo(n,l));M.stroke();"==>"!==m&&"<==>"!==m||c(h,k,1);"<=="!==m&&"<==>"!==m||c(g,e,-1)}};K.drawpoint=function(a){var b=D.drawingstate.matrix,
c=a.x*b.a-a.y*b.b+b.tx;a=a.x*b.c-a.y*b.d-b.ty;M.lineWidth=.3*K.psize;M.beginPath();M.arc(c,a,K.psize,0,2*Math.PI);M.fillStyle=K.pointColor;M.fill();M.beginPath();M.arc(c,a,1.15*K.psize,0,2*Math.PI);M.fillStyle=K.black;M.strokeStyle=K.black;M.stroke()};K.drawline=function(a){var b=q.abs(a.value[0]).value.real,c=q.abs(a.value[1]).value.real,d=q.abs(a.value[2]).value.real,e;b>=c&&b>=d&&(e=a.value[0]);c>=b&&c>=d&&(e=a.value[1]);d>=c&&d>=b&&(e=a.value[2]);b=q.div(a.value[0],e);c=q.div(a.value[1],e);a=
q.div(a.value[2],e);a=[b.value.real,c.value.real,a.value.real];Math.abs(a[0])<Math.abs(a[1])?(b=[1,0,30],e=[-1,0,30]):(b=[0,1,30],e=[0,-1,30]);b=[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]];a=[a[1]*e[2]-a[2]*e[1],a[2]*e[0]-a[0]*e[2],a[0]*e[1]-a[1]*e[0]];K.drawsegcore({x:b[0]/b[2],y:b[1]/b[2]},{x:a[0]/a[2],y:a[1]/a[2]})};K.setDash=function(a,b){for(var c=Math.sqrt(b),d=0;d<a.length;d++)a[d]*=c;M.webkitLineDash=a;M.setLineDash(a);M.mozDash=a};K.unSetDash=function(){M.webkitLineDash=
[];M.setLineDash([]);M.mozDash=[]};K.setDashType=function(a,b){0===a&&K.setDash([]);1===a&&K.setDash([10,10],b);2===a&&K.setDash([10,4],b);3===a&&K.setDash([1,3],b);4===a&&K.setDash([10,5,1,5],b)};var Ta={},D={drawingstate:{}};D.drawingstate.linecolor="rgb(0,0,255)";D.drawingstate.linecolorraw=[0,0,1];D.drawingstate.pointcolor="rgb(255,200,0)";D.drawingstate.pointcolorraw=[1,.78,0];D.drawingstate.textcolor="rgb(0,0,0)";D.drawingstate.textcolorraw=[0,0,0];D.drawingstate.alpha=1;D.drawingstate.pointsize=
4;D.drawingstate.linesize=1;D.drawingstate.textsize=20;D.drawingstate.matrix={};D.drawingstate.matrix.a=25;D.drawingstate.matrix.b=0;D.drawingstate.matrix.c=0;D.drawingstate.matrix.d=25;D.drawingstate.matrix.tx=250;D.drawingstate.matrix.ty=250;D.drawingstate.matrix.det=D.drawingstate.matrix.a*D.drawingstate.matrix.d-D.drawingstate.matrix.b*D.drawingstate.matrix.c;D.drawingstate.matrix.sdet=Math.sqrt(D.drawingstate.matrix.det);D.drawingstate.initialmatrix={};D.drawingstate.initialmatrix.a=D.drawingstate.matrix.a;
D.drawingstate.initialmatrix.b=D.drawingstate.matrix.b;D.drawingstate.initialmatrix.c=D.drawingstate.matrix.c;D.drawingstate.initialmatrix.d=D.drawingstate.matrix.d;D.drawingstate.initialmatrix.tx=D.drawingstate.matrix.tx;D.drawingstate.initialmatrix.ty=D.drawingstate.matrix.ty;D.drawingstate.initialmatrix.det=D.drawingstate.matrix.det;D.drawingstate.initialmatrix.sdet=D.drawingstate.matrix.sdet;D.clone=function(a){if(null===a||"object"!==typeof a)return a;var b=a.constructor(),c;for(c in a)b[c]=
D.clone(a[c]);return b};Ta.backup=D.clone(D.drawingstate);Ta.stack=[];D.clone(D.drawingstate);D.reset=function(){D.drawingstate.matrix.a=D.drawingstate.initialmatrix.a;D.drawingstate.matrix.b=D.drawingstate.initialmatrix.b;D.drawingstate.matrix.c=D.drawingstate.initialmatrix.c;D.drawingstate.matrix.d=D.drawingstate.initialmatrix.d;D.drawingstate.matrix.tx=D.drawingstate.initialmatrix.tx;D.drawingstate.matrix.ty=D.drawingstate.initialmatrix.ty;D.drawingstate.matrix.det=D.drawingstate.initialmatrix.det;
D.drawingstate.matrix.sdet=D.drawingstate.initialmatrix.sdet};D.from=function(a,b,c){a/=c;b/=c;c=D.drawingstate.matrix;return[a*c.a-b*c.b+c.tx,a*c.c-b*c.d-c.ty]};D.to=function(a,b){var c=D.drawingstate.matrix,d=a-c.tx,e=b+c.ty;return[(d*c.d-e*c.b)/c.det,-(-d*c.c+e*c.a)/c.det,1]};D.dumpTrafo=function(){function a(b){return Math.round(1E3*b)/1E3}var b=D.drawingstate.matrix;console.log("a:"+a(b.a)+" b:"+a(b.b)+" c:"+a(b.c)+" d:"+a(b.d)+" tx:"+a(b.ty)+" ty:"+a(b.tx))};D.setMat=function(a,b,c,d,e,g){var h=
D.drawingstate.matrix;h.a=a;h.b=b;h.c=c;h.d=d;h.tx=e;h.ty=g;h.det=a*d-b*c;h.sdet=Math.sqrt(h.det)};D.scaleAndOrigin=function(a,b,c){D.setMat(a,0,0,a,b,c)};D.visibleRect=function(a,b,c,d){var e=c-a,g=b-d,e=Aa*g<va*e?Aa/e:va/g;D.setMat(e,0,0,e,(Aa-e*(a+c))/2,(va-e*(b+d))/2)};D.applyMat=function(a,b,c,d,e,g){var h=D.drawingstate.matrix;D.setMat(h.a*a+h.c*b,h.b*a+h.d*b,h.a*c+h.c*d,h.b*c+h.d*d,h.a*e+h.c*g+h.tx,h.b*e+h.d*g+h.ty);a=D.to(0,-va);b=D.to(Aa,0);console.log("{visibleRect: ["+a[0]+","+a[1]+","+
b[0]+","+b[1]+"]}")};D.translate=function(a,b){D.applyMat(1,0,0,1,a,b)};D.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);D.applyMat(b,a,-a,b,0,0)};D.scale=function(a){D.applyMat(a,0,0,a,0,0)};D.gsave=function(){Ta.stack.push(D.clone(D.drawingstate))};D.grestore=function(){0!==Ta.stack.length&&(D.drawingstate=Ta.stack.pop())};D.greset=function(){D.drawingstate=D.clone(Ta.backup);D.drawingstate.matrix.ty-=va;D.drawingstate.initialmatrix.ty-=va;Ta.stack=[]};D.createnewbackup=function(){D.drawingstate.initialmatrix.a=
D.drawingstate.matrix.a;D.drawingstate.initialmatrix.b=D.drawingstate.matrix.b;D.drawingstate.initialmatrix.c=D.drawingstate.matrix.c;D.drawingstate.initialmatrix.d=D.drawingstate.matrix.d;D.drawingstate.initialmatrix.tx=D.drawingstate.matrix.tx;D.drawingstate.initialmatrix.ty=D.drawingstate.matrix.ty;D.drawingstate.initialmatrix.det=D.drawingstate.matrix.det;D.drawingstate.initialmatrix.sdet=D.drawingstate.matrix.sdet;Ta.backup=D.clone(D.drawingstate)};D.makecolor=function(a,b,c){a=Math.floor(255*
a);b=Math.floor(255*b);c=Math.floor(255*c);return 1===D.drawingstate.alpha?"rgb("+a+","+b+","+c+")":"rgba("+a+","+b+","+c+","+D.drawingstate.alpha+")"};D.setcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;D.drawingstate.linecolor=D.drawingstate.pointcolor=D.makecolor(b,c,a);D.drawingstate.linecolorraw=D.drawingstate.pointcolorraw=[b,c,a]};D.setlinecolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;D.drawingstate.linecolor=
D.makecolor(b,c,a);D.drawingstate.linecolorraw=[b,c,a]};D.settextcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;D.drawingstate.textcolor=D.makecolor(b,c,a);D.drawingstate.textcolorraw=[b,c,a]};D.setpointcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;D.drawingstate.pointcolor=D.makecolor(b,c,a);D.drawingstate.pointcolorraw=[b,c,a]};D.setalpha=function(a){D.drawingstate.alpha=a.value.real;D.drawingstate.linecolor=
D.makecolor(D.drawingstate.linecolorraw[0],D.drawingstate.linecolorraw[1],D.drawingstate.linecolorraw[2]);D.drawingstate.pointcolor=D.makecolor(D.drawingstate.pointcolorraw[0],D.drawingstate.pointcolorraw[1],D.drawingstate.pointcolorraw[2]);D.drawingstate.textcolor=D.makecolor(D.drawingstate.textcolorraw[0],D.drawingstate.textcolorraw[1],D.drawingstate.textcolorraw[2])};D.setpointsize=function(a){D.drawingstate.pointsize=a.value.real};D.setlinesize=function(a){D.drawingstate.linesize=a.value.real};
D.settextsize=function(a){D.drawingstate.textsize=a.value.real};var Ka={clip:"none",pointColor:[1,0,0],lineColor:[0,0,1],pointSize:5,lineSize:2,alpha:1,overhangLine:1.1,overhangSeg:1,dimDependent:1};a.defaultAppearance&&Dc(a.defaultAppearance);var ic={},Ba,Ma,Ra,Ca,Ha,Za,La,db,Ib=!1,gc={toString:function(){return"RefineException"}},W=null;a.enableTraceLog&&(W={logLength:Infinity,fullLog:[],currentMouseAndScripts:null,currentMover:null,currentStep:null,currentElement:null,currentParam:null,labelTracing2:G.wrap("tracing2"),
labelTracing4:G.wrap("tracing4"),labelTracingSesq:G.wrap("tracingSesq"),postMouseHooks:[]},"number"===typeof a.enableTraceLog&&(W.logLength=a.enableTraceLog),Oa.getTraceLog=Gc,Oa.formatTraceLog=Hc,Oa.addTraceHook=W.postMouseHooks.push.bind(W.postMouseHooks));Sa.stateSize=12;Lb.stateSize=24;var B={_helper:{},RandomLine:{}};B.RandomLine.kind="L";B.RandomLine.updatePosition=function(a){a.homog=m.realVector([100*Math.random(),100*Math.random(),100*Math.random()]);a.homog=m.normalizeMax(a.homog);a.homog=
G.withUsage(a.homog,"Line")};B.FreeLine={};B.FreeLine.kind="L";B.FreeLine.updatePosition=function(a){a.homog=m.realVector([100*Math.random(),100*Math.random(),100*Math.random()]);a.homog=m.normalizeMax(a.homog);a.homog=G.withUsage(a.homog,"Line")};B.RandomPoint={};B.RandomPoint.kind="P";B.RandomPoint.updatePosition=function(a){a.homog=m.realVector([100*Math.random(),100*Math.random(),100*Math.random()]);a.homog=m.normalizeMax(a.homog);a.homog=G.withUsage(a.homog,"Point")};B.Join={};B.Join.kind="L";
B.Join.updatePosition=function(a){a.homog=m.cross(c[a.args[0]].homog,c[a.args[1]].homog);a.homog=m.normalizeMax(a.homog);a.homog=G.withUsage(a.homog,"Line")};B.Segment={};B.Segment.kind="S";B.Segment.updatePosition=function(a){var b=c[a.args[0]],d=c[a.args[1]];a.homog=m.cross(b.homog,d.homog);a.homog=m.normalizeMax(a.homog);a.homog=G.withUsage(a.homog,"Line");a.startpos=b.homog;a.endpos=d.homog;a.farpoint=m.cross(a.homog,m.linfty)};B.Meet={};B.Meet.kind="P";B.Meet.updatePosition=function(a){a.homog=
m.cross(c[a.args[0]].homog,c[a.args[1]].homog);a.homog=m.normalizeMax(a.homog);a.homog=G.withUsage(a.homog,"Point")};B.Meet.visiblecheck=function(a){var b=!0,d=c[a.args[0]],e=c[a.args[1]];"Segment"===d.type&&(b=ec(a,d));b&&"Segment"===d.type&&(b=ec(a,e));a.isshowing=b};B.Mid={};B.Mid.kind="P";B.Mid.updatePosition=function(a){var b=c[a.args[0]].homog,d=c[a.args[1]].homog,e=m.cross(b,d),g=m.cross(e,m.linfty),h=m.det3(b,g,e),e=m.det3(d,g,e),b=m.scalmult(e,b),d=m.scalmult(h,d);a.homog=m.add(b,d);a.homog=
m.normalizeMax(a.homog);a.homog=G.withUsage(a.homog,"Point")};B.Perp={};B.Perp.kind="L";B.Perp.updatePosition=function(a){var b=c[a.args[0]].homog,d=c[a.args[1]].homog,b=m.turnIntoCSList([b.value[0],b.value[1],q.zero]);a.homog=m.cross(b,d);a.homog=m.normalizeMax(a.homog);a.homog=G.withUsage(a.homog,"Line")};B.Para={};B.Para.kind="L";B.Para.updatePosition=function(a){var b=c[a.args[1]].homog;a.homog=m.cross(m.cross(m.linfty,c[a.args[0]].homog),b);a.homog=m.normalizeMax(a.homog);a.homog=G.withUsage(a.homog,
"Line")};B.Horizontal={};B.Horizontal.kind="L";B.Horizontal.updatePosition=function(a){a.homog=m.cross(m.ex,c[a.args[0]].homog);a.homog=m.normalizeMax(a.homog);a.homog=G.withUsage(a.homog,"Line")};B.Vertical={};B.Vertical.kind="L";B.Vertical.updatePosition=function(a){a.homog=m.cross(m.ey,c[a.args[0]].homog);a.homog=m.normalizeMax(a.homog);a.homog=G.withUsage(a.homog,"Line")};B.Through={};B.Through.kind="L";B.Through.isMovable=!0;B.Through.initialize=function(a){a=a.dir?G.wrap(a.dir):m.realVector([a.pos[1],
-a.pos[0],0]);ra(a)};B.Through.getParamForInput=function(a,b,d){a="mouse"===d?m.cross(c[a.args[0]].homog,b):"homog"===d?b:m.turnIntoCSList([q.zero,q.zero,q.zero]);a=m.cross(m.linfty,a);return m.normalizeMax(a)};B.Through.getParamFromState=function(a){return wa(3)};B.Through.putParamToState=function(a,b){ra(b)};B.Through.updatePosition=function(a){var b=wa(3);ra(b);b=m.cross(c[a.args[0]].homog,b);b=m.normalizeMax(b);a.homog=G.withUsage(b,"Line")};B.Through.stateSize=6;B.Free={};B.Free.kind="P";B.Free.isMovable=
!0;B.Free.initialize=function(a){a=B._helper.initializePoint(a);ra(a)};B.Free.getParamForInput=function(a,b,c){if("mouse"===c&&Tb&&0!==Ua){b=m.normalizeZ(b);a=b.value[0].value.real;c=b.value[1].value.real;var d=Math.round(a/Ua)*Ua,e=Math.round(c/Ua)*Ua;.2>Math.abs(d-a)&&.2>Math.abs(e-c)&&(b=m.realVector([d,e,1]))}return m.normalizeMax(b)};B.Free.getParamFromState=function(a){return wa(3)};B.Free.putParamToState=function(a,b){ra(b)};B.Free.updatePosition=function(a){var b=wa(3);ra(b);a.homog=G.withUsage(b,
"Point")};B.Free.stateSize=6;B._helper.projectPointToLine=function(a,b){var c=m.turnIntoCSList([b.value[0],b.value[1],q.zero]),c=m.cross(c,a);return m.normalizeMax(m.cross(c,b))};B.PointOnLine={};B.PointOnLine.kind="P";B.PointOnLine.isMovable=!0;B.PointOnLine.initialize=function(a){var b=B._helper.initializePoint(a);a=c[a.args[0]].homog;var b=B._helper.projectPointToLine(b,a),b=m.normalizeMax(b),d=m.cross(m.linfty,b);m.normalizeMax(d);ra(b);ra(a);Za=!1};B.PointOnLine.updatePosition=function(a,b){var d,
e=c[a.args[0]].homog;d=wa(3);wa(3);if(!b){Ca=a.stateIdx;var g=Ba;Ba=Ra;var h=wa(3),k=wa(3);Ba=g;g=m.cross(k,e);m._helper.isAlmostZero(g)&&(g=m.cross(m.linfty,e));h=B._helper.CircleMP(g,h);h=B._helper.IntersectLC(e,h);g=B._helper.pointReflection(g,d);d=jc(h[0],h[1],d,g)[0]}d=m.normalizeMax(d);ra(d);ra(e);a.homog=G.withUsage(d,"Point")};B.PointOnLine.getParamForInput=function(a,b,d){return b=B._helper.projectPointToLine(b,c[a.args[0]].homog)};B.PointOnLine.getParamFromState=function(a){return wa(3)};
B.PointOnLine.putParamToState=function(a,b){return ra(b)};B.PointOnLine.stateSize=12;B.PointOnCircle={};B.PointOnCircle.kind="P";B.PointOnCircle.isMovable=!0;B.PointOnCircle.initialize=function(a){var b=c[a.args[0]];a=m.normalizeZ(B._helper.initializePoint(a));var d=m.normalizeZ(B._helper.CenterOfConic(b.matrix)),e=m.sub(a,d),e=m.turnIntoCSList([e.value[1],q.neg(e.value[0]),q.zero]),d=m.cross(a,d),b=B._helper.IntersectLC(d,b.matrix),d=m.projectiveDistMinScal(a,b[0]);m.projectiveDistMinScal(a,b[1])<
d?(a=b[1],b=b[0]):(a=b[0],b=b[1]);ra(e);ra(a);ra(b);Za=!1};B.PointOnCircle.putParamToState=function(a,b){ra(b)};B.PointOnCircle.getParamFromState=function(a){return wa(3)};B.PointOnCircle.getParamForInput=function(a,b,d){d=m.normalizeZ(B._helper.CenterOfConic(c[a.args[0]].matrix));b=m.sub(b,d);Ca=a.stateIdx;a=wa(3);var e=m.normalizeZ(wa(3));d=m.sub(e,d);0>q.sub(q.mult(a.value[0],d.value[1]),q.mult(a.value[1],d.value[0])).value.real&&(b=m.neg(b));return m.turnIntoCSList([b.value[1],q.neg(b.value[0]),
q.zero])};B.PointOnCircle.parameterPath=function(a,b,c,d,e){d=m.normalizeAbs(d);e=m.normalizeAbs(e);var g=m.scalproduct(d,e);if(0<=g.value.real)return hc(a,b,c,d,e);a=m.turnIntoCSList([q.sub(d.value[1],e.value[1]),q.sub(e.value[0],d.value[0]),q.zero]);g=m.scalproduct(d,a);0>g.value.real&&(a=m.neg(a));0>b?(b=2*b+1,c=b*b,g=.25/(1+c),c=q.complex(2*b*g+.25,(1-c)*g)):(b=2*b-1,c=b*b,g=.25/(1+c),c=q.complex(2*b*g+.75,(1-c)*g));var h=q.sub(q.real(1),c);b=q.mult(c,c);g=q.mult(h,h);c=q.mult(c,h);d=m.scalmult(g,
d);d=m.add(d,m.scalmult(c,a));return d=m.add(d,m.scalmult(b,e))};B.PointOnCircle.updatePosition=function(a){var b=wa(3);ra(b);var d=c[a.args[0]],b=m.productMV(d.matrix,b),d=B._helper.IntersectLC(b,d.matrix),d=Sa(d[0],d[1]),b=m.normalizeMax(d.value[0]);a.homog=G.withUsage(b,"Point");a.antipodalPoint=d.value[1]};B.PointOnCircle.stateSize=6+Sa.stateSize;B.OtherPointOnCircle={};B.OtherPointOnCircle.kind="P";B.OtherPointOnCircle.updatePosition=function(a){var b=c[a.args[0]].antipodalPoint,b=m.normalizeMax(b);
a.homog=G.withUsage(b,"Point")};B.PointOnSegment={};B.PointOnSegment.kind="P";B.PointOnSegment.isMovable=!0;B.PointOnSegment.initialize=function(a){var b=B._helper.initializePoint(a);a=B.PointOnSegment.getParamForInput(a,b);ab(a)};B.PointOnSegment.getParamForInput=function(a,b){var d=c[a.args[0]],e=d.homog,e=m.turnIntoCSList([e.value[0],e.value[1],q.zero]),d=m.crossratio3(d.farpoint,d.startpos,d.endpos,b,e);0>d.value.real&&(d=q.complex(0,d.value.imag));1<d.value.real&&(d=q.complex(1,d.value.imag));
return d};B.PointOnSegment.getParamFromState=function(a){return hb()};B.PointOnSegment.putParamToState=function(a,b){ab(b)};B.PointOnSegment.updatePosition=function(a){var b=hb();ab(b);var d=c[a.args[0]],e=m.scalmult(d.endpos.value[2],d.startpos),d=m.scalmult(d.startpos.value[2],d.endpos),d=m.sub(d,e),b=m.add(e,m.scalmult(b,d)),b=m.normalizeMax(b);a.homog=G.withUsage(b,"Point")};B.PointOnSegment.stateSize=2;B._helper.CenterOfConic=function(a){var b=B._helper.IntersectLC(m.linfty,a),c=G.mult(a,b[0]);
a=G.mult(a,b[1]);return m.cross(c,a)};B.CenterOfConic={};B.CenterOfConic.kind="P";B.CenterOfConic.updatePosition=function(a){var b=B._helper.CenterOfConic(c[a.args[0]].matrix);a.homog=b;a.homog=m.normalizeMax(a.homog);a.homog=G.withUsage(a.homog,"Point")};B._helper.CircleMP=function(a,b){var c=a.value[0],d=a.value[1],e=q.neg(a.value[2]),g=q.zero,c=m.turnIntoCSList([m.turnIntoCSList([e,g,c]),m.turnIntoCSList([g,e,d]),m.turnIntoCSList([c,d,g])]),e=G.mult(G.mult(b,c),b),d=G.mult(G.mult(b,m.fund),b),
e=G.mult(e,m.fund),c=G.mult(d,c);return m.sub(e,c)};B.CircleMP={};B.CircleMP.kind="C";B.CircleMP.updatePosition=function(a){a.matrix=B._helper.CircleMP(c[a.args[0]].homog,c[a.args[1]].homog);a.matrix=m.normalizeMax(a.matrix);a.matrix=G.withUsage(a.matrix,"Circle")};B.CircleMr={};B.CircleMr.kind="C";B.CircleMr.isMovable=!0;B.CircleMr.initialize=function(a){ab(q.real(a.radius))};B.CircleMr.getParamForInput=function(a,b){var d=c[a.args[0]].homog,d=m.normalizeZ(d);b=m.normalizeZ(b);d=m.sub(d,b);return d=
m.abs(d)};B.CircleMr.getParamFromState=function(a){return hb()};B.CircleMr.putParamToState=function(a,b){ab(b)};B.CircleMr.updatePosition=function(a){var b=hb();ab(b);var d=c[a.args[0]].homog,d=m.normalizeZ(d),e=m.turnIntoCSList([b,q.zero,q.zero]),e=m.add(e,d),d=B._helper.CircleMP(d,e),d=m.normalizeMax(d);a.matrix=G.withUsage(d,"Circle");a.radius=b};B.CircleMr.stateSize=2;B.Compass={};B.Compass.kind="C";B.Compass.updatePosition=function(a){var b=c[a.args[2]].homog,d=c[a.args[1]].homog,e=c[a.args[0]].homog,
b=m.normalizeZ(b),d=m.normalizeZ(d),e=m.normalizeZ(e),d=m.sub(d,e),d=m.add(d,b),d=m.normalizeZ(d),b=B._helper.CircleMP(b,d),b=m.normalizeMax(b);a.matrix=G.withUsage(b,"Circle")};B._helper.getConicType=function(a){if(1E-16>q.abs(m.det(a)).value.real)return"degenerate";var b=q.mult(a.value[0].value[0],a.value[1].value[1]),b=q.sub(b,q.pow(a.value[0].value[1],q.real(2))),b=b.value.real;return 1E-16>Math.abs(b)?"parabola":1E-16<b?"ellipsoid":"hyperbola"};B._helper.ConicBy5=function(a,b,c,d,e,g){a=m.turnIntoCSList([m.cross(c,
d)]);var h=m.turnIntoCSList([m.cross(b,e)]);b=m.turnIntoCSList([m.cross(b,c)]);d=m.turnIntoCSList([m.cross(d,e)]);G.mult(m.transpose(h),a);return B._helper.conicFromTwoDegenerates(a,h,b,d,g)};B._helper.conicFromTwoDegenerates=function(a,b,c,d,e){a=G.mult(m.transpose(b),a);c=G.mult(m.transpose(d),c);a=m.add(a,m.transpose(a));c=m.add(c,m.transpose(c));d=G.mult(G.mult(e,a),e);e=G.mult(G.mult(e,c),e);c=G.mult(d,c);e=G.mult(e,a);return m.sub(c,e)};B.ConicBy5={};B.ConicBy5.kind="C";B.ConicBy5.updatePosition=
function(a){var b=B._helper.ConicBy5(a,c[a.args[0]].homog,c[a.args[1]].homog,c[a.args[2]].homog,c[a.args[3]].homog,c[a.args[4]].homog);a.matrix=b;a.matrix=m.normalizeMax(a.matrix);a.matrix=G.withUsage(a.matrix,"Conic")};B._helper.buildConicMatrix=function(a){var b=a[1],c=a[2],d=a[3],e=a[4],g=a[5];return m.turnIntoCSList([m.turnIntoCSList([a[0],b,d]),m.turnIntoCSList([b,c,e]),m.turnIntoCSList([d,e,g])])};B._helper.splitDegenConic=function(a){var b=m.adjoint3(a),c=0,d,e,g=q.abs2(b.value[0].value[0]).value.real;
for(d=1;3>d;d++)e=q.abs2(b.value[d].value[d]).value.real,e>g&&(c=d,g=e);d=q.sqrt(q.mult(q.real(-1),b.value[c].value[c]));c=q.real(c+1);e=m.column(b,c);if(1E-16>q.abs2(d).value.real)return x;e=m.scaldiv(d,e);d=e.value[0];g=e.value[1];e=e.value[2];d=m.turnIntoCSList([m.turnIntoCSList([q.real(0),e,q.mult(q.real(-1),g)]),m.turnIntoCSList([q.mult(q.real(-1),e),q.real(0),d]),m.turnIntoCSList([g,q.mult(q.real(-1),d),q.real(0)])]);a=m.add(a,d);var h=0;for(d=g=b=0;3>d;d++)for(c=0;3>c;c++)e=q.abs2(a.value[d].value[c]).value.real,
e>g&&(h=d,b=c,g=e);d=a.value[h];a=m.transpose(a);a=a.value[b];d=m.normalizeMax(d);a=m.normalizeMax(a);d=G.withUsage(d,"Line");a=G.withUsage(a,"Line");return[d,a]};B.SelectConic={};B.SelectConic.kind="C";B.SelectConic.updatePosition=function(a){a.matrix=c[a.args[0]].results[a.index-1];a.matrix=m.normalizeMax(a.matrix);a.matrix=G.withUsage(a.matrix,"Conic")};B._helper.ConicBy4p1l=function(a,b,c,d,e,g){var h=m.cross(m.cross(b,d),g),k=m.cross(m.cross(c,e),g),l=m.cross(m.cross(b,c),g),n=m.cross(m.cross(d,
e),g),r=m.realVector(D.to(100*Math.random(),100*Math.random()));g=q.mult(m.det3(r,k,l),m.det3(r,k,n));g=q.sqrt(g);l=q.mult(m.det3(r,h,l),m.det3(r,h,n));l=q.sqrt(l);h=m.scalmult(g,h);l=m.scalmult(l,k);k=m.add(h,l);h=m.sub(h,l);k=B._helper.ConicBy5(a,b,c,d,e,k);a=B._helper.ConicBy5(a,b,c,d,e,h);return[k,a]};B.ConicBy4p1l={};B.ConicBy4p1l.kind="Cs";B.ConicBy4p1l.updatePosition=function(a){var b=B._helper.ConicBy4p1l(a,c[a.args[0]].homog,c[a.args[1]].homog,c[a.args[2]].homog,c[a.args[3]].homog,c[a.args[4]].homog);
a.results=b};B._helper.ConicBy3p2l=function(a,b,c,d,e){function g(a,b,c,f){return q.sub(q.mult(a,f),q.mult(b,c))}var h=m.cross(a,b),k=m.cross(d,e);d=m.cross(d,h);e=m.cross(e,h);h=m.turnIntoCSList([d,e,k]);c=m.productVM(c,m.adjoint3(h));k=m.adjoint3(m.turnIntoCSList([m.scalmult(c.value[0],d),m.scalmult(c.value[1],e),m.scalmult(c.value[2],k)]));c=m.transpose(k);d=q.mult;e=m.productMV(c,a);a=e.value[0];e=e.value[1];h=m.productMV(c,b);b=h.value[0];var h=h.value[1],l=q.sqrt(d(a,e)),n=q.sqrt(d(b,h)),r,
t=Array(4);for(r=0;4>r;++r){var u=(r&2)-1,v=d(q.real(((r&1)<<1)-1),l),w=d(q.real(u),n),y=g(e,v,h,w),x=g(b,w,a,v),u=g(a,e,b,h),z=q.add(q.add(g(b,h,a,e),g(h,w,e,v)),g(w,b,v,a)),v=d(y,y),w=d(x,x),A=d(z,z),B=d(y,x),y=d(y,z),x=d(x,z),B=q.sub(B,d(q.real(.5),d(u,u))),u=m.turnIntoCSList([m.turnIntoCSList([v,B,y]),m.turnIntoCSList([B,w,x]),m.turnIntoCSList([y,x,A])]),u=m.productMM(k,m.productMM(u,c)),u=m.turnIntoCSList([u.value[0].value[0],u.value[0].value[1],u.value[0].value[2],u.value[1].value[1],u.value[1].value[2],
u.value[2].value[2]]);t[r]=u}return t};B.ConicBy3p2l={};B.ConicBy3p2l.kind="Cs";B.ConicBy3p2l.updatePosition=function(a){for(var b=B._helper.ConicBy3p2l(c[a.args[0]].homog,c[a.args[1]].homog,c[a.args[2]].homog,c[a.args[3]].homog,c[a.args[4]].homog),b=kc(b),d=Array(4),e=0;4>e;++e){var g=b[e].value;d[e]=m.turnIntoCSList([m.turnIntoCSList([g[0],g[1],g[2]]),m.turnIntoCSList([g[1],g[3],g[4]]),m.turnIntoCSList([g[2],g[4],g[5]])])}a.results=d};B.ConicBy3p2l.stateSize=48;B.ConicBy2p3l={};B.ConicBy2p3l.kind=
"Cs";B.ConicBy2p3l.updatePosition=function(a){for(var b=B._helper.ConicBy3p2l(c[a.args[2]].homog,c[a.args[3]].homog,c[a.args[4]].homog,c[a.args[0]].homog,c[a.args[1]].homog),b=kc(b),d=Array(4),e=0;4>e;++e){var g=b[e].value,g=m.turnIntoCSList([m.turnIntoCSList([g[0],g[1],g[2]]),m.turnIntoCSList([g[1],g[3],g[4]]),m.turnIntoCSList([g[2],g[4],g[5]])]);d[e]=m.normalizeMax(m.adjoint3(g))}a.results=d};B.ConicBy2p3l.stateSize=48;B.ConicBy1p4l={};B.ConicBy1p4l.kind="Cs";B.ConicBy1p4l.updatePosition=function(a){var b=
B._helper.ConicBy4p1l(a,c[a.args[0]].homog,c[a.args[1]].homog,c[a.args[2]].homog,c[a.args[3]].homog,c[a.args[4]].homog),d=b[0],b=b[1],d=m.adjoint3(d),b=m.adjoint3(b),b=[d,b];a.results=b};B.ConicBy2Foci1P={};B.ConicBy2Foci1P.kind="Cs";B.ConicBy2Foci1P.updatePosition=function(a){var b=c[a.args[0]].homog,d=c[a.args[1]].homog,e=c[a.args[2]].homog,g=m.ii,h=m.jj,k=m.normalizeMax(m.cross(b,e)),l=m.normalizeMax(m.cross(d,e)),n=m.normalizeMax(m.cross(e,g)),e=m.normalizeMax(m.cross(e,h)),l=B._helper.coHarmonic(n,
e,k,l),k=m.normalizeMax(l[0]),l=m.normalizeMax(l[1]),g=m.turnIntoCSList([g]),n=m.turnIntoCSList([h]),e=m.turnIntoCSList([b]),r=m.turnIntoCSList([d]),h=B._helper.conicFromTwoDegenerates(g,n,e,r,k),h=m.normalizeMax(h),g=B._helper.conicFromTwoDegenerates(g,n,e,r,l),g=m.normalizeMax(g),h=m.normalizeMax(m.adjoint3(h)),g=m.normalizeMax(m.adjoint3(g));"ellipsoid"!==B._helper.getConicType(h)&&(k=h,h=g,g=k);m.almostequals(b,d).value&&(b=q.real(3),g=m.zeromatrix(b,b));a.results=[h,g]};B._helper.coHarmonic=
function(a,b,c,d){var e=m.realVector([100*Math.random(),100*Math.random(),1]),g=m.det3(e,c,a),h=m.det3(e,c,b);c=m.det3(e,d,a);d=m.det3(e,d,b);d=q.sqrt(q.mult(d,h));g=q.sqrt(q.mult(c,g));a=G.mult(a,d);g=G.mult(b,g);b=m.add(a,g);a=m.sub(a,g);return[b,a]};B.ConicBy5lines={};B.ConicBy5lines.kind="C";B.ConicBy5lines.updatePosition=function(a){var b=B._helper.ConicBy5(a,c[a.args[0]].homog,c[a.args[1]].homog,c[a.args[2]].homog,c[a.args[3]].homog,c[a.args[4]].homog),b=m.adjoint3(b);a.matrix=b;a.matrix=m.normalizeMax(a.matrix);
a.matrix=G.withUsage(a.matrix,"Conic")};B.CircleBy3={};B.CircleBy3.kind="C";B.CircleBy3.updatePosition=function(a){var b=B._helper.ConicBy5(a,c[a.args[0]].homog,c[a.args[1]].homog,m.ii,m.jj,c[a.args[2]].homog);a.matrix=m.normalizeMax(b);a.matrix=G.withUsage(a.matrix,"Circle")};B.Polar={};B.Polar.kind="L";B.Polar.updatePosition=function(a){var b=c[a.args[1]],d=m.inverse(c[a.args[0]].matrix);a.homog=G.mult(d,b.homog);a.homog=m.normalizeMax(a.homog);a.homog=G.withUsage(a.homog,"Point")};B.PolarPoint=
{};B.PolarPoint.kind="P";B.PolarPoint.updatePosition=function(a){a.homog=G.mult(c[a.args[1]].matrix,c[a.args[0]].homog);a.homog=m.normalizeMax(a.homog);a.homog=G.withUsage(a.homog,"Line")};B.angleBisector={};B.angleBisector.kind="Ls";B.angleBisector.updatePosition=function(a){var b=c[a.args[0]],d=c[a.args[1]],e=m.normalizeMax(m.cross(b.homog,d.homog)),g=m.normalizeMax(m.cross(m.ii,e)),h=m.normalizeMax(m.cross(m.jj,e)),k=q.sqrt(q.mult(m.det3(e,d.homog,g),m.det3(e,b.homog,g))),l=q.sqrt(q.mult(m.det3(e,
d.homog,h),m.det3(e,b.homog,h))),g=G.mult(g,l),k=G.mult(h,k),h=m.add(g,k),k=m.sub(g,k),g=m.abs(h).value.real<q.eps,l=m.abs(k).value.real<q.eps;g||l?g?k=m.normalizeMax(k):l&&(h=m.normalizeMax(h)):(h=m.normalizeMax(h),k=m.normalizeMax(k));if(m.almostequals(h,m.linfty).value&&l||m.almostequals(k,m.linfty).value&&g)m.abs(h).value.real<m.abs(k).value.real?(g=m.det3(e,d.homog,k),e=m.det3(e,b.homog,k),b=G.mult(b.homog,g),d=G.mult(d.homog,e),h=m.add(b,d)):(g=m.det3(e,d.homog,h),e=m.det3(e,b.homog,h),b=G.mult(b.homog,
g),d=G.mult(d.homog,e),k=m.add(b,d));h=m.normalizeMax(h);k=m.normalizeMax(k);a.results=Sa(h,k)};B.angleBisector.stateSize=Sa.stateSize;B._helper.IntersectLC=function(a,b){var c=q,d=m.crossOperator(a),e=m.transpose(d),e=G.mult(e,G.mult(b,d)),g=m.maxIndex(a,q.abs2),h,k,l,n;0===g?(g=e.value[1].value[1],h=e.value[1].value[2],k=e.value[2].value[1],l=e.value[2].value[2],n=a.value[0]):1===g?(g=e.value[0].value[0],h=e.value[0].value[2],k=e.value[2].value[0],l=e.value[2].value[2],n=a.value[1]):(g=e.value[0].value[0],
h=e.value[0].value[1],k=e.value[1].value[0],l=e.value[1].value[1],n=a.value[2]);c=c.div(c.sqrt(c.sub(c.mult(h,k),c.mult(g,l))),n);c=m.add(e,m.scalmult(c,d));g=m.maxIndex(c,m.abs2);d=c.value[g];d=m.normalizeMax(d);d=G.withUsage(d,"Point");c=m.transpose(c);g=m.maxIndex(c,m.abs2);c=c.value[g];c=m.normalizeMax(c);c=G.withUsage(c,"Point");return[d,c]};B.IntersectLC={};B.IntersectLC.kind="Ps";B.IntersectLC.updatePosition=function(a){var b=B._helper.IntersectLC(c[a.args[0]].homog,c[a.args[1]].matrix);a.results=
Sa(b[0],b[1])};B.IntersectLC.stateSize=Sa.stateSize;B.OtherIntersectionCL={};B.OtherIntersectionCL.kind="P";B.OtherIntersectionCL.updatePosition=function(a){var b=c[a.args[2]].homog,d=B._helper.IntersectLC(c[a.args[1]].homog,c[a.args[0]].matrix),e=d[0],d=d[1],g=m.projectiveDistMinScal(e,b),b=m.projectiveDistMinScal(d,b);a.homog=g<b?d:e;a.homog=m.normalizeMax(a.homog);a.homog=G.withUsage(a.homog,"Point")};B.IntersectCirCir={};B.IntersectCirCir.kind="Ps";B.IntersectCirCir.updatePosition=function(a){var b=
c[a.args[0]].matrix,d=c[a.args[1]].matrix,e=m.scalmult(d.value[0].value[0],b.value[2]),d=m.scalmult(b.value[0].value[0],d.value[2]),e=m.sub(e,d),e=m.turnIntoCSList([e.value[0],e.value[1],q.realmult(.5,e.value[2])]),e=m.normalizeMax(e),b=B._helper.IntersectLC(e,b);a.results=Sa(b[0],b[1])};B.IntersectCirCir.stateSize=Sa.stateSize;B.OtherIntersectionCC={};B.OtherIntersectionCC.kind="P";B.OtherIntersectionCC.updatePosition=function(a){var b=c[a.args[0]].matrix,d=c[a.args[1]].matrix,e=c[a.args[2]].homog,
g=m.scalmult(d.value[0].value[0],b.value[2]),d=m.scalmult(b.value[0].value[0],d.value[2]),g=m.sub(g,d),g=m.turnIntoCSList([g.value[0],g.value[1],q.realmult(.5,g.value[2])]),g=m.normalizeMax(g),g=B._helper.IntersectLC(g,b),b=g[0],g=g[1],d=m.projectiveDistMinScal(b,e),e=m.projectiveDistMinScal(g,e);a.homog=d<e?g:b;a.homog=m.normalizeMax(a.homog);a.homog=G.withUsage(a.homog,"Point")};B._helper.IntersectConicConic=function(a,b){var c=a.value[0],d=a.value[1],e=a.value[2],g=b.value[0],h=b.value[1],k=b.value[2],
l=m.det3(c,d,e),n=q.add(q.add(m.det3(c,d,k),m.det3(c,h,e)),m.det3(g,d,e)),c=q.add(q.add(m.det3(c,h,k),m.det3(g,d,k)),m.det3(g,h,e)),g=m.det3(g,h,k),k=q.abs2(l).value.real,h=q.abs2(g).value.real;k<h&&(k=a,a=b,b=k,k=g,g=l,l=k,k=c,c=n,n=k,k=h);1E-24>k?(l=a,c=b):(n=q.solveCubic(l,n,c,g),c=q.abs2(q.sub(n[0],n[1])).value.real,g=q.abs2(q.sub(n[0],n[2])).value.real,h=q.abs2(q.sub(n[1],n[2])).value.real,c>g?(l=n[1],n=c>h?n[0]:n[2]):(l=n[2],n=g>h?n[0]:n[1]),l=m.add(m.scalmult(l,a),b),c=m.add(m.scalmult(n,a),
b));n=B._helper.splitDegenConic(l);l=n[0];n=n[1];c=B._helper.splitDegenConic(c);h=c[0];g=c[1];c=m.cross(l,h);h=m.cross(n,h);l=m.cross(l,g);n=m.cross(n,g);c=m.normalizeMax(c);h=m.normalizeMax(h);l=m.normalizeMax(l);n=m.normalizeMax(n);c=G.withUsage(c,"Point");h=G.withUsage(h,"Point");l=G.withUsage(l,"Point");n=G.withUsage(n,"Point");return[c,h,l,n]};B.IntersectConicConic={};B.IntersectConicConic.kind="Ps";B.IntersectConicConic.updatePosition=function(a){var b=B._helper.IntersectConicConic(c[a.args[0]].matrix,
c[a.args[1]].matrix),b=Lb(b[0],b[1],b[2],b[3]);a.results=b};B.IntersectConicConic.stateSize=Lb.stateSize;B.SelectP={};B.SelectP.kind="P";B.SelectP.initialize=function(a){if(void 0!==a.index)return a.index-1;var b=c[a.args[0]].results.value;a=B._helper.initializePoint(a);for(var d=m.projectiveDistMinScal(a,b[0]),e=0,g=1;g<b.length;++g){var h=m.projectiveDistMinScal(a,b[g]);h<d&&(d=h,e=g)}return e};B.SelectP.updatePosition=function(a){a.homog=c[a.args[0]].results.value[a.param]};B.SelectL={};B.SelectL.kind=
"L";B.SelectL.updatePosition=function(a){a.homog=c[a.args[0]].results.value[a.index-1];a.homog=G.withUsage(a.homog,"Line")};B.TrProjection={};B.TrProjection.kind="Tr";B.TrProjection.updatePosition=function(a){function b(d){var e=c[a.args[0+d]].homog,g=c[a.args[2+d]].homog,h=c[a.args[4+d]].homog,k=c[a.args[6+d]].homog;d=m.adjoint3(m.turnIntoCSList([e,g,h]));d=m.productVM(k,d).value;return d=m.transpose(m.turnIntoCSList([m.scalmult(d[0],e),m.scalmult(d[1],g),m.scalmult(d[2],h)]))}var d=m.productMM(b(1),
m.adjoint3(b(0))),d=m.normalizeMax(d);a.matrix=d;d=m.transpose(m.adjoint3(d));d=m.normalizeMax(d);a.dualMatrix=d};B.TrInverse={};B.TrInverse.kind="Tr";B.TrInverse.updatePosition=function(a){var b=c[a.args[0]];a.dualMatrix=m.transpose(b.matrix);a.matrix=m.transpose(b.dualMatrix)};B.TransformP={};B.TransformP.kind="P";B.TransformP.updatePosition=function(a){a.homog=m.normalizeMax(m.productMV(c[a.args[0]].matrix,c[a.args[1]].homog));a.homog=G.withUsage(a.homog,"Point")};B.TransformL={};B.TransformL.kind=
"L";B.TransformL.updatePosition=function(a){a.homog=m.normalizeMax(m.productMV(c[a.args[0]].dualMatrix,c[a.args[1]].homog));a.homog=G.withUsage(a.homog,"Line")};B.TransformS={};B.TransformS.kind="S";B.TransformS.updatePosition=function(a){var b=c[a.args[0]],d=c[a.args[1]];a.homog=m.normalizeMax(m.productMV(b.dualMatrix,d.homog));a.homog=G.withUsage(a.homog,"Line");a.startpos=m.normalizeMax(m.productMV(b.matrix,d.startpos));a.endpos=m.normalizeMax(m.productMV(b.matrix,d.endpos));a.farpoint=m.normalizeMax(m.productMV(b.matrix,
d.farpoint))};B._helper.pointReflection=function(a,b){var c=B._helper.CircleMP(a,b);return B._helper.conicOtherIntersection(c,b,a)};B._helper.conicOtherIntersection=function(a,b,c){var d=m.productMV(a,c);a=m.scalproduct(c,d);d=m.scalproduct(b,d);d=q.realmult(-2,d);b=m.scalmult(a,b);c=m.scalmult(d,c);c=m.add(b,c);return c=m.normalizeMax(c)};B._helper.initializePoint=function(a){var b=0,c=0,d=0;a.pos&&(2===a.pos.length&&(b=a.pos[0],c=a.pos[1],d=1),3===a.pos.length&&(b=a.pos[0],c=a.pos[1],d=a.pos[2]));
a=m.realVector([b,c,d]);return a=m.normalizeMax(a)};var Ec={CircleMFixedr:function(a){a.pinned=!0;a.type="CircleMr";return[a]},CircleByRadius:function(a){a.type="CircleMr";return[a]},IntersectionConicLine:function(a){a.args=[a.args[1],a.args[0]];a.type="IntersectLC";return[a]},IntersectionCircleCircle:function(a){a.type="IntersectCirCir";return[a]},PolarLine:function(a){a.args=[a.args[1],a.args[0]];a.type="Polar";return[a]},Parallel:function(a){a.type="Para";return[a]},Calculation:function(a){console.log("Calculation stripped from construction");
return[]},Transform:function(a){var b="Transform"+B[c[a.args[1]].type].kind;if(B.hasOwnProperty(b))return a.type=b,[a];console.log(b+" not implemented yet");return[]}},Ea={},oc,ib,pc,qc;oc=[[],[.2],[.075,.225],[44/45,-56/15,32/9],[19372/6561,-25360/2187,64448/6561,-212/729],[9017/3168,-355/33,46732/5247,49/176,-5103/18656],[35/384,0,500/1113,125/192,-2187/6784,11/84]];ib=[0,.2,.3,.8,8/9,1,1];pc=[35/384,0,500/1113,125/192,-2187/6784,11/84,0];qc=[5179/57600,0,7571/16695,.6140625,-92097/339200,187/2100,
.025];var Ga,sa=[],xb=!1;Ea.tick=function(){for(var a=0;a<ba.env.accuracy;a++)Ea.tick1(ba.env.deltat/ba.env.accuracy),I(Da.simulationstep)};Ea.tick1=function(a){for(var b=a,c=0;0<a&&c<.999*a||0>a&&c>.999*a;)b=Ea.oneRKStep(b),c+=b,b=Math.min(2*b,a-c),b=Math.max(b,1E-16),Ea.restorePosition(),Ea.doCollisions(),Ea.calculateForces(),Ea.moveToFinalPos();return!0};Ea.restorePosition=function(){Ga.forEach(function(a){a=a.behavior;ba[a.type].restorePos(a,9)})};Ea.doCollisions=function(){Ga.forEach(function(a){a=
a.behavior;ba[a.type].doCollisions(a)})};Ea.calculateForces=function(){Ga.forEach(function(a){a=a.behavior;ba[a.type].calculateForces(a)})};Ea.moveToFinalPos=function(){Ga.forEach(function(a){a=a.behavior;ba[a.type].move(a)})};Ea.oneRKStep=function(a){for(var b=function(a){Ga.forEach(function(b){b=b.behavior;ba[b.type].initRK(b,a);ba[b.type].storePosition(b)})},c=function(a){Ga.forEach(function(b){b=b.behavior;ba[b.type].setToTimestep(b,ib[a])})},d=function(a){Ga.forEach(function(b){b=b.behavior;
ba[b.type].proceedMotion(b,ib[a],a,oc[a])})},e=function(){Ga.forEach(function(a){a=a.behavior;ba[a.type].resetForces(a)})},g=function(a){Ga.forEach(function(b){b=b.behavior;ba[b.type].calculateDelta(b,a)})},h=function(b){var c=0;Ga.forEach(function(a){a=a.behavior;ba[a.type].proceedMotion(a,ib[6],7,pc);ba[a.type].savePos(a,8);ba[a.type].proceedMotion(a,ib[6],7,qc);ba[a.type].savePos(a,9);c+=ba[a.type].sqDist(a,8,9)});return c=Math.sqrt(c)/a},k=function(a){Ga.forEach(function(a){a=a.behavior;ba[a.type].recallPosition(a)})},
l=!1;!l;){b(a);for(var m=0;7>m;m++)c(m),d(m),e(),Ea.calculateForces(),g(m);h(a)>ba.env.errorbound&&a>ba.env.lowestdeltat?(a/=ba.env.slowdownfactor,k()):l=!0}return a};var ba={Mass:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.mass&&(a.mass=1);"undefined"===typeof a.charge&&(a.charge=0);"undefined"===typeof a.friction&&(a.friction=0);a.lnfrict=0;"undefined"===typeof a.limitspeed&&(a.limitspeed=!1);"undefined"===typeof a.fixed&&(a.fixed=!1);"undefined"===typeof a.radius&&
(a.radius=1);a.internalmove=!1;a.fx=0;a.fy=0;a.fz=0;a.vx=a.vx||0;a.vy=a.vy||0;a.vz=a.vz||0;a.mtype=0;a.env=ba.env;a.deltat=0;a.mx=0;a.my=0;a.mz=0;a.mvx=0;a.mvy=0;a.mvz=0;a.dx=[0,0,0,0,0,0,0,0,0,0];a.dy=[0,0,0,0,0,0,0,0,0,0];a.dz=[0,0,0,0,0,0,0,0,0,0];a.dvx=[0,0,0,0,0,0,0,0,0,0];a.dvy=[0,0,0,0,0,0,0,0,0,0];a.dvz=[0,0,0,0,0,0,0,0,0,0];a.midx=0;a.midy=0;a.midz=0;a.lx=0;a.ly=0;a.lz=0},resetForces:function(a){a.fx=0;a.fy=0;a.fz=0},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){var c=
Q.extractPoint(a.el.homog);a.x=c.x;a.y=c.y;a.z=0;a.xo=a.x;a.yo=a.y;a.zo=a.z;a.vxo=a.vx;a.vyo=a.vy;a.vzo=a.vz;a.deltat=b;a.fx=0;a.fy=0;a.fz=0},setVelocity:function(a,b,c,d){d||(d=0);a.vx=b;a.vy=c;a.vz=d},move:function(a){a.pos=[a.x,a.y,1];a.internalmove=!0;xa&&qa.down&&a.el===xa.mover||(a.el.homog=m.realVector(a.pos));a.el.sx=a.x;a.el.sy=a.y;a.internalmove=!1},proceedMotion:function(a,b,c,d){if(!a.fixed)for(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz,b=0;b<c;b++)a.x+=d[b]*a.dx[b]*a.deltat,
a.y+=d[b]*a.dy[b]*a.deltat,a.z+=d[b]*a.dz[b]*a.deltat,a.vx+=d[b]*a.dvx[b]*a.deltat,a.vy+=d[b]*a.dvy[b]*a.deltat,a.vz+=d[b]*a.dvz[b]*a.deltat},calculateForces:function(a){var b=Math.sqrt(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz);a.lnfrict=-Math.log((1-a.friction)*(1-a.env.friction)*(.1<b&&a.limitSpeed?.1/b:1));a.fx+=-a.vx*a.lnfrict*a.mass;a.fy+=-a.vy*a.lnfrict*a.mass;a.fz+=-a.vz*a.lnfrict*a.mass},calculateDelta:function(a,b){a.dx[b]=a.vx;a.dy[b]=a.vy;a.dz[b]=a.vz;a.dvx[b]=a.fx/a.mass;a.dvy[b]=a.fy/a.mass;a.dvz[b]=
a.fz/a.mass},savePos:function(a,b){a.dx[b]=a.x;a.dy[b]=a.y;a.dz[b]=a.z;a.dvx[b]=a.vx;a.dvy[b]=a.vy;a.dvz[b]=a.vz},restorePos:function(a,b){a.fixed||(a.x=a.dx[b],a.y=a.dy[b],a.z=a.dz[b],a.vx=a.dvx[b],a.vy=a.dvy[b],a.vz=a.dvz[b])},sqDist:function(a,b,c){var d=(a.dx[b]-a.dx[c])*(a.dx[b]-a.dx[c]),d=d+(a.dy[b]-a.dy[c])*(a.dy[b]-a.dy[c]),d=d+(a.dz[b]-a.dz[c])*(a.dz[b]-a.dz[c]),d=d+(a.dvx[b]-a.dvx[c])*(a.dvx[b]-a.dvx[c]),d=d+(a.dvy[b]-a.dvy[c])*(a.dvy[b]-a.dvy[c]);return d+=(a.dvz[b]-a.dvz[c])*(a.dvz[b]-
a.dvz[c])},kineticEnergy:function(a){return.5*a.mass*(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz)},storePosition:function(a){a.mx=a.x;a.my=a.y;a.mz=a.z;a.mvx=a.vx;a.mvy=a.vy;a.mvz=a.vz},recallPosition:function(a){a.fixed||(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz)},doCollisions:function(a){}},Sun:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.mass&&(a.mass=10);"undefined"===typeof a.friction&&(a.friction=0);a.charge=0;a.x=0;a.y=0;a.z=0},resetForces:function(a){},
getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){var c=Q.extractPoint(a.el.homog);a.x=c.x;a.y=c.y;a.z=0},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateDelta:function(a,b){},calculateForces:function(a){for(var b=a.x,c=a.y,d=a.z,e=0;e<sa.length;e++){var g=sa[e],h=g.behavior.x,k=g.behavior.y,l=g.behavior.z,m=Math.sqrt((b-h)*(b-h)+(c-k)*(c-k)+(d-l)*(d-l)),k=(c-k)*a.mass*g.behavior.mass/(m*m*m),l=(d-l)*a.mass*g.behavior.mass/(m*m*m);g.behavior.fx+=
(b-h)*a.mass*g.behavior.mass/(m*m*m)*g.behavior.mass;g.behavior.fy+=k*g.behavior.mass;g.behavior.fz+=l*g.behavior.mass}},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},Gravity:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.strength&&(a.strength=1);a.namea=b.args[0];a.nameb=b.args[1];a.ma=c[a.namea];a.mb=c[a.nameb]},resetForces:function(a){},
getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateDelta:function(a,b){},calculateForces:function(a){var b=Q.extractPoint(a.ma.homog),c=Q.extractPoint(a.mb.homog),d=(c.x-b.x)*a.strength;a=(c.y-b.y)*a.strength;for(b=0;b<sa.length;b++)c=sa[b],c.behavior.fx+=d*c.behavior.mass,c.behavior.fy+=a*c.behavior.mass,c.behavior.fz+=0*c.behavior.mass},savePos:function(a,b){},restorePos:function(a,b){},
sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},Spring:{init:function(a,b){a.el=b;"undefined"===typeof a.strength&&(a.strength=1);"undefined"===typeof a.amplitude&&(a.amplitude=0);"undefined"===typeof a.phase&&(a.phase=0);"undefined"===typeof a.speed&&(a.speed=1);"undefined"===typeof a.l0&&(a.l0=0);"undefined"===typeof a.stype&&(a.stype=1);"undefined"===typeof a.readOnInit&&(a.readOnInit=!1);a.namea=
b.args[0];a.nameb=b.args[1];a.ma=c[a.namea];a.mb=c[a.nameb];var d=Q.extractPoint(a.ma.homog),e=Q.extractPoint(a.mb.homog);a.l0=Math.sqrt((d.x-e.x)*(d.x-e.x)+(d.y-e.y)*(d.y-e.y));a.env=ba.env},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateForces:function(a){var b,c,d,e;!a.ma.behavior||xa&&qa.down&&a.ma===xa.mover?(c=Q.extractPoint(a.ma.homog),b=c.x,d=c.y):(b=
a.ma.behavior.x,d=a.ma.behavior.y);!a.mb.behavior||xa&&qa.down&&a.mb===xa.mover?(e=Q.extractPoint(a.mb.homog),c=e.x,e=e.y):(c=a.mb.behavior.x,e=a.mb.behavior.y);var g=Math.sqrt((b-c)*(b-c)+(d-e)*(d-e)),h=a.l0,k=a.stype;1===k&&(h=0);var l=0;if(2===k||3===k)l=a.ma.behavior.mass*a.mb.behavior.mass*a.strength;2===k&&(l=-l);var m,n;if(0===g||0!==k&&1!==k)if(a.ma.behavior&&a.mb.behavior&&0!==g){if(g*=g*g,2===k||3===k)m=(b-c)*l/g,n=(d-e)*l/g}else m=n=0;else m=-(b-c)*a.strength*(g-h)/g*a.env.springstrength,
n=-(d-e)*a.strength*(g-h)/g*a.env.springstrength;a.ma.behavior&&(a.ma.behavior.fx+=m,a.ma.behavior.fy+=n);a.mb.behavior&&(a.mb.behavior.fx-=m,a.mb.behavior.fy-=n)},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},det:function(a,b,c,d,e,g){return c*g-e*d+e*b-a*g+a*d-c*b},Bouncer:{init:function(a,b){a.el=b;"undefined"===typeof a.xdamp&&
(a.xdamp=0);"undefined"===typeof a.ydamp&&(a.ydamp=0);"undefined"===typeof a.motorchanger&&(a.motorchanger=!0);a.namea=b.args[0];a.nameb=b.args[1];a.ma=c[a.namea];a.mb=c[a.nameb];var d=Q.extractPoint(a.ma.homog),e=Q.extractPoint(a.mb.homog);a.x1o=1.01*d.x-.01*e.x;a.y1o=1.01*d.y-.01*e.y;a.x2o=1.01*e.x-.01*d.x;a.y2o=1.01*e.y-.01*d.y;a.env=ba.env},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){a.deltat=b},setVelocity:function(a,b,c,d){},move:function(a){},
proceedMotion:function(a,b,c,d){},calculateForces:function(a){},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){for(var b=Q.extractPoint(a.ma.homog),c=Q.extractPoint(a.mb.homog),d=b.x,b=b.y,e=c.x,c=c.y,g=a.x1o,h=a.y1o,k=a.x2o,l=a.y2o,m=Math.sqrt((d-e)*(d-e)+(b-c)*(b-c)),n=(d-e)/m,m=(b-c)/m,r=0;r<sa.length;r++){var t=sa[r],
u=t.behavior.xo,v=t.behavior.yo,w=t.behavior.x,y=t.behavior.y,x=q.mult(q.complex(g,h),q.complex(e,c)),z=q.mult(q.complex(k,l),q.complex(d,b)),x=q.sub(x,z),z=q.mult(q.complex(u,v),q.complex(d,b)),x=q.add(x,z),z=q.mult(q.complex(u,v),q.complex(e,c)),x=q.sub(x,z),z=q.sub(q.complex(g,h),q.complex(k,l)),x=q.div(x,z);0>ba.det(d,b,e,c,w,y)*ba.det(d,b,e,c,x.value.real,x.value.imag)&&0>ba.det(d,b,w,y,x.value.real,x.value.imag)*ba.det(e,c,w,y,x.value.real,x.value.imag)&&(v=t.behavior.mvx+a.deltat*(-x.value.real+
t.behavior.xo),w=t.behavior.mvy+a.deltat*(-x.value.imag+t.behavior.yo),u=n*v+m*w,v=m*v-n*w,t.behavior.x=x.value.real,t.behavior.y=x.value.imag,t.behavior.vx=n*u*(1-a.xdamp),t.behavior.vy=m*u*(1-a.xdamp),t.behavior.vx+=-m*v*(1-a.ydamp),t.behavior.vy+=n*v*(1-a.ydamp))}a.x1o=d;a.y1o=b;a.x2o=e;a.y2o=c}},Environment:{init:function(a){"undefined"===typeof a.gravity&&(a.gravity=0);"undefined"===typeof a.friction&&(a.friction=0);"undefined"===typeof a.springstrength&&(a.springstrength=1);"undefined"===typeof a.accuracy&&
(a.accuracy=10);"undefined"===typeof a.deltat&&(a.deltat=.3);"undefined"===typeof a.charges&&(a.charges=!1);"undefined"===typeof a.balls&&(a.balls=!1);"undefined"===typeof a.newton&&(a.newton=!1);"undefined"===typeof a.ballInteractionBoosting&&(a.ballInteractionBoosting=1);ba.env=a;a.errorbound=.001;a.lowestdeltat=1E-7;a.slowdownfactor=2},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,
b,c,d){},calculateForces:function(a){var b,c,d,e,g,h,k,l,m,n;if(a.newton)for(b=0;b<sa.length-1;b++)for(c=sa[b],d=c.behavior.x,e=c.behavior.y,g=b+1;g<sa.length;g++)h=sa[g],k=h.behavior.x,l=h.behavior.y,n=Math.sqrt((d-k)*(d-k)+(e-l)*(e-l)),k=(d-k)*c.behavior.mass*h.behavior.mass/(n*n*n),l=(e-l)*c.behavior.mass*h.behavior.mass/(n*n*n),c.behavior.fx-=k,c.behavior.fy-=l,h.behavior.fx+=k,h.behavior.fy+=l;if(a.charges)for(b=0;b<sa.length-1;b++)for(c=sa[b],d=c.behavior.x,e=c.behavior.y,g=b+1;g<sa.length;g++)h=
sa[g],k=h.behavior.x,l=h.behavior.y,n=Math.sqrt((d-k)*(d-k)+(e-l)*(e-l)),k=(d-k)*c.behavior.charge*h.behavior.charge/(n*n*n),l=(e-l)*c.behavior.charge*h.behavior.charge/(n*n*n),c.behavior.fx+=k,c.behavior.fy+=l,h.behavior.fx-=k,h.behavior.fy-=l;if(a.balls)for(b=0;b<sa.length-1;b++)if(c=sa[b],0!==c.behavior.radius)for(d=c.behavior.x,e=c.behavior.y,g=b+1;g<sa.length;g++)h=sa[g],0!==h.behavior.radius&&(k=h.behavior.x,l=h.behavior.y,m=c.behavior.radius+h.behavior.radius,n=Math.sqrt((d-k)*(d-k)+(e-l)*
(e-l)),0===a.ballInteractionBoosting?(k=(d-k)/(n*n*n)*(n>m?0:(n-m)*(n-m)),l=(e-l)/(n*n*n)*(n>m?0:(n-m)*(n-m))):1===a.ballInteractionBoosting?(k=(d-k)/(n*n*n*n)*(n>m?0:(n-m)*(n-m)),l=(e-l)/(n*n*n*n)*(n>m?0:(n-m)*(n-m))):(k=(d-k)/(n*n*n*n*n)*(n>m?0:(n-m)*(n-m)),l=(e-l)/(n*n*n*n*n)*(n>m?0:(n-m)*(n-m))),c.behavior.fx+=k,c.behavior.fy+=l,h.behavior.fx-=k,h.behavior.fy-=l);for(b=0;b<sa.length;b++)c=sa[b],c.behavior.fx+=0,c.behavior.fy+=a.gravity,c.behavior.fz+=0},calculateDelta:function(a,b){},savePos:function(a,
b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}}};return Oa};return b}();"undefined"!==typeof process&&"undefined"!==typeof module&&"undefined"!==typeof module.exports&&"undefined"===typeof window&&(module.exports=createCindy);
//# sourceMappingURL=Cindy.js.map

