/* CindyJS - (C) 2014-2015  The CindyJS Project
 * Mostly licensed under the Apache License 2.0, but subprojects may use different licensing.
 * See https://github.com/CindyJS/CindyJS/tree/b292c8bf129e6dff899bb1202d8cbe2e74516feb
 * for corresponding sources and their respective licensing conditions.
 */
(function(){function r(b,c,e){f.biginteger_used=1;null!=b&&("number"==typeof b&&"undefined"==typeof c?this.fromInt(b):"number"==typeof b?this.fromNumber(b,c,e):null==c&&"string"!=typeof b?this.fromString(b,256):this.fromString(b,c))}function F(){return new r(null)}function X(b,c,e,h,f,p){for(;0<=--p;){var E=c*this[b++]+e[h]+f;f=Math.floor(E/67108864);e[h++]=E&67108863}return f}function La(b,c,e,h,f,p){var E=c&32767;for(c>>=15;0<=--p;){var l=this[b]&32767,x=this[b++]>>15,r=c*l+x*E,l=E*l+((r&32767)<<
15)+e[h]+(f&1073741823);f=(l>>>30)+(r>>>15)+c*x+(f>>>30);e[h++]=l&1073741823}return f}function xa(b,c,e,h,f,p){var E=c&16383;for(c>>=14;0<=--p;){var l=this[b]&16383,x=this[b++]>>14,r=c*l+x*E,l=E*l+((r&16383)<<14)+e[h]+f;f=(l>>28)+(r>>14)+c*x;e[h++]=l&268435455}return f}function va(b,c){var e=Na[b.charCodeAt(c)];return null==e?-1:e}function ba(b){var c=F();c.fromInt(b);return c}function G(b){var c=1,e;0!=(e=b>>>16)&&(b=e,c+=16);0!=(e=b>>8)&&(b=e,c+=8);0!=(e=b>>4)&&(b=e,c+=4);0!=(e=b>>2)&&(b=e,c+=2);
0!=b>>1&&(c+=1);return c}function P(b){this.m=b}function l(b){this.m=b;this.mp=b.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<b.DB-15)-1;this.mt2=2*b.t}function H(b,c){return b&c}function M(b,c){return b|c}function Tb(b,c){return b^c}function Ub(b,c){return b&~c}function $a(){}function Vb(b){return b}function Ca(b){this.r2=F();this.q3=F();r.ONE.dlShiftTo(2*b.t,this.r2);this.mu=this.r2.divide(b);this.m=b}var f={},Ua=!1;"undefined"!==typeof module&&module.exports?(module.exports=
f,Ua=!0):"undefined"!==typeof document?window.ClipperLib=f:self.ClipperLib=f;var U;if(Ua)R="chrome",U="Netscape";else{var R=navigator.userAgent.toString().toLowerCase();U=navigator.appName}var Oa,ya,Da,Pa,Ea,Va;Oa=-1!=R.indexOf("chrome")&&-1==R.indexOf("chromium")?1:0;Ua=-1!=R.indexOf("chromium")?1:0;ya=-1!=R.indexOf("safari")&&-1==R.indexOf("chrome")&&-1==R.indexOf("chromium")?1:0;Da=-1!=R.indexOf("firefox")?1:0;R.indexOf("firefox/17");R.indexOf("firefox/15");R.indexOf("firefox/3");Pa=-1!=R.indexOf("opera")?
1:0;R.indexOf("msie 10");R.indexOf("msie 9");Ea=-1!=R.indexOf("msie 8")?1:0;Va=-1!=R.indexOf("msie 7")?1:0;R=-1!=R.indexOf("msie ")?1:0;f.biginteger_used=null;"Microsoft Internet Explorer"==U?(r.prototype.am=La,U=30):"Netscape"!=U?(r.prototype.am=X,U=26):(r.prototype.am=xa,U=28);r.prototype.DB=U;r.prototype.DM=(1<<U)-1;r.prototype.DV=1<<U;r.prototype.FV=Math.pow(2,52);r.prototype.F1=52-U;r.prototype.F2=2*U-52;var Na=[],S;U=48;for(S=0;9>=S;++S)Na[U++]=S;U=97;for(S=10;36>S;++S)Na[U++]=S;U=65;for(S=
10;36>S;++S)Na[U++]=S;P.prototype.convert=function(b){return 0>b.s||0<=b.compareTo(this.m)?b.mod(this.m):b};P.prototype.revert=function(b){return b};P.prototype.reduce=function(b){b.divRemTo(this.m,null,b)};P.prototype.mulTo=function(b,c,e){b.multiplyTo(c,e);this.reduce(e)};P.prototype.sqrTo=function(b,c){b.squareTo(c);this.reduce(c)};l.prototype.convert=function(b){var c=F();b.abs().dlShiftTo(this.m.t,c);c.divRemTo(this.m,null,c);0>b.s&&0<c.compareTo(r.ZERO)&&this.m.subTo(c,c);return c};l.prototype.revert=
function(b){var c=F();b.copyTo(c);this.reduce(c);return c};l.prototype.reduce=function(b){for(;b.t<=this.mt2;)b[b.t++]=0;for(var c=0;c<this.m.t;++c){var e=b[c]&32767,h=e*this.mpl+((e*this.mph+(b[c]>>15)*this.mpl&this.um)<<15)&b.DM,e=c+this.m.t;for(b[e]+=this.m.am(0,h,b,c,0,this.m.t);b[e]>=b.DV;)b[e]-=b.DV,b[++e]++}b.clamp();b.drShiftTo(this.m.t,b);0<=b.compareTo(this.m)&&b.subTo(this.m,b)};l.prototype.mulTo=function(b,c,e){b.multiplyTo(c,e);this.reduce(e)};l.prototype.sqrTo=function(b,c){b.squareTo(c);
this.reduce(c)};r.prototype.copyTo=function(b){for(var c=this.t-1;0<=c;--c)b[c]=this[c];b.t=this.t;b.s=this.s};r.prototype.fromInt=function(b){this.t=1;this.s=0>b?-1:0;0<b?this[0]=b:-1>b?this[0]=b+this.DV:this.t=0};r.prototype.fromString=function(b,c){var e;if(16==c)e=4;else if(8==c)e=3;else if(256==c)e=8;else if(2==c)e=1;else if(32==c)e=5;else if(4==c)e=2;else{this.fromRadix(b,c);return}this.s=this.t=0;for(var h=b.length,f=!1,p=0;0<=--h;){var E=8==e?b[h]&255:va(b,h);0>E?"-"==b.charAt(h)&&(f=!0):
(f=!1,0==p?this[this.t++]=E:p+e>this.DB?(this[this.t-1]|=(E&(1<<this.DB-p)-1)<<p,this[this.t++]=E>>this.DB-p):this[this.t-1]|=E<<p,p+=e,p>=this.DB&&(p-=this.DB))}8==e&&0!=(b[0]&128)&&(this.s=-1,0<p&&(this[this.t-1]|=(1<<this.DB-p)-1<<p));this.clamp();f&&r.ZERO.subTo(this,this)};r.prototype.clamp=function(){for(var b=this.s&this.DM;0<this.t&&this[this.t-1]==b;)--this.t};r.prototype.dlShiftTo=function(b,c){var e;for(e=this.t-1;0<=e;--e)c[e+b]=this[e];for(e=b-1;0<=e;--e)c[e]=0;c.t=this.t+b;c.s=this.s};
r.prototype.drShiftTo=function(b,c){for(var e=b;e<this.t;++e)c[e-b]=this[e];c.t=Math.max(this.t-b,0);c.s=this.s};r.prototype.lShiftTo=function(b,c){var e=b%this.DB,h=this.DB-e,f=(1<<h)-1,p=Math.floor(b/this.DB),E=this.s<<e&this.DM,l;for(l=this.t-1;0<=l;--l)c[l+p+1]=this[l]>>h|E,E=(this[l]&f)<<e;for(l=p-1;0<=l;--l)c[l]=0;c[p]=E;c.t=this.t+p+1;c.s=this.s;c.clamp()};r.prototype.rShiftTo=function(b,c){c.s=this.s;var e=Math.floor(b/this.DB);if(e>=this.t)c.t=0;else{var h=b%this.DB,f=this.DB-h,p=(1<<h)-
1;c[0]=this[e]>>h;for(var E=e+1;E<this.t;++E)c[E-e-1]|=(this[E]&p)<<f,c[E-e]=this[E]>>h;0<h&&(c[this.t-e-1]|=(this.s&p)<<f);c.t=this.t-e;c.clamp()}};r.prototype.subTo=function(b,c){for(var e=0,h=0,f=Math.min(b.t,this.t);e<f;)h+=this[e]-b[e],c[e++]=h&this.DM,h>>=this.DB;if(b.t<this.t){for(h-=b.s;e<this.t;)h+=this[e],c[e++]=h&this.DM,h>>=this.DB;h+=this.s}else{for(h+=this.s;e<b.t;)h-=b[e],c[e++]=h&this.DM,h>>=this.DB;h-=b.s}c.s=0>h?-1:0;-1>h?c[e++]=this.DV+h:0<h&&(c[e++]=h);c.t=e;c.clamp()};r.prototype.multiplyTo=
function(b,c){var e=this.abs(),h=b.abs(),f=e.t;for(c.t=f+h.t;0<=--f;)c[f]=0;for(f=0;f<h.t;++f)c[f+e.t]=e.am(0,h[f],c,f,0,e.t);c.s=0;c.clamp();this.s!=b.s&&r.ZERO.subTo(c,c)};r.prototype.squareTo=function(b){for(var c=this.abs(),e=b.t=2*c.t;0<=--e;)b[e]=0;for(e=0;e<c.t-1;++e){var h=c.am(e,c[e],b,2*e,0,1);(b[e+c.t]+=c.am(e+1,2*c[e],b,2*e+1,h,c.t-e-1))>=c.DV&&(b[e+c.t]-=c.DV,b[e+c.t+1]=1)}0<b.t&&(b[b.t-1]+=c.am(e,c[e],b,2*e,0,1));b.s=0;b.clamp()};r.prototype.divRemTo=function(b,c,e){var h=b.abs();if(!(0>=
h.t)){var f=this.abs();if(f.t<h.t)null!=c&&c.fromInt(0),null!=e&&this.copyTo(e);else{null==e&&(e=F());var p=F(),E=this.s;b=b.s;var l=this.DB-G(h[h.t-1]);0<l?(h.lShiftTo(l,p),f.lShiftTo(l,e)):(h.copyTo(p),f.copyTo(e));h=p.t;f=p[h-1];if(0!=f){var x=f*(1<<this.F1)+(1<h?p[h-2]>>this.F2:0),Ma=this.FV/x,x=(1<<this.F1)/x,I=1<<this.F2,aa=e.t,P=aa-h,H=null==c?F():c;p.dlShiftTo(P,H);0<=e.compareTo(H)&&(e[e.t++]=1,e.subTo(H,e));r.ONE.dlShiftTo(h,H);for(H.subTo(p,p);p.t<h;)p[p.t++]=0;for(;0<=--P;){var M=e[--aa]==
f?this.DM:Math.floor(e[aa]*Ma+(e[aa-1]+I)*x);if((e[aa]+=p.am(0,M,e,P,0,h))<M)for(p.dlShiftTo(P,H),e.subTo(H,e);e[aa]<--M;)e.subTo(H,e)}null!=c&&(e.drShiftTo(h,c),E!=b&&r.ZERO.subTo(c,c));e.t=h;e.clamp();0<l&&e.rShiftTo(l,e);0>E&&r.ZERO.subTo(e,e)}}}};r.prototype.invDigit=function(){if(1>this.t)return 0;var b=this[0];if(0==(b&1))return 0;var c=b&3,c=c*(2-(b&15)*c)&15,c=c*(2-(b&255)*c)&255,c=c*(2-((b&65535)*c&65535))&65535,c=c*(2-b*c%this.DV)%this.DV;return 0<c?this.DV-c:-c};r.prototype.isEven=function(){return 0==
(0<this.t?this[0]&1:this.s)};r.prototype.exp=function(b,c){if(4294967295<b||1>b)return r.ONE;var e=F(),h=F(),f=c.convert(this),p=G(b)-1;for(f.copyTo(e);0<=--p;)if(c.sqrTo(e,h),0<(b&1<<p))c.mulTo(h,f,e);else var E=e,e=h,h=E;return c.revert(e)};r.prototype.toString=function(b){if(0>this.s)return"-"+this.negate().toString(b);if(16==b)b=4;else if(8==b)b=3;else if(2==b)b=1;else if(32==b)b=5;else if(4==b)b=2;else return this.toRadix(b);var c=(1<<b)-1,e,h=!1,f="",p=this.t,E=this.DB-p*this.DB%b;if(0<p--)for(E<
this.DB&&0<(e=this[p]>>E)&&(h=!0,f="0123456789abcdefghijklmnopqrstuvwxyz".charAt(e));0<=p;)E<b?(e=(this[p]&(1<<E)-1)<<b-E,e|=this[--p]>>(E+=this.DB-b)):(e=this[p]>>(E-=b)&c,0>=E&&(E+=this.DB,--p)),0<e&&(h=!0),h&&(f+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(e));return h?f:"0"};r.prototype.negate=function(){var b=F();r.ZERO.subTo(this,b);return b};r.prototype.abs=function(){return 0>this.s?this.negate():this};r.prototype.compareTo=function(b){var c=this.s-b.s;if(0!=c)return c;var e=this.t,c=e-
b.t;if(0!=c)return 0>this.s?-c:c;for(;0<=--e;)if(0!=(c=this[e]-b[e]))return c;return 0};r.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+G(this[this.t-1]^this.s&this.DM)};r.prototype.mod=function(b){var c=F();this.abs().divRemTo(b,null,c);0>this.s&&0<c.compareTo(r.ZERO)&&b.subTo(c,c);return c};r.prototype.modPowInt=function(b,c){var e;e=256>b||c.isEven()?new P(c):new l(c);return this.exp(b,e)};r.ZERO=ba(0);r.ONE=ba(1);$a.prototype.convert=Vb;$a.prototype.revert=Vb;$a.prototype.mulTo=
function(b,c,e){b.multiplyTo(c,e)};$a.prototype.sqrTo=function(b,c){b.squareTo(c)};Ca.prototype.convert=function(b){if(0>b.s||b.t>2*this.m.t)return b.mod(this.m);if(0>b.compareTo(this.m))return b;var c=F();b.copyTo(c);this.reduce(c);return c};Ca.prototype.revert=function(b){return b};Ca.prototype.reduce=function(b){b.drShiftTo(this.m.t-1,this.r2);b.t>this.m.t+1&&(b.t=this.m.t+1,b.clamp());this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);for(this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);0>
b.compareTo(this.r2);)b.dAddOffset(1,this.m.t+1);for(b.subTo(this.r2,b);0<=b.compareTo(this.m);)b.subTo(this.m,b)};Ca.prototype.mulTo=function(b,c,e){b.multiplyTo(c,e);this.reduce(e)};Ca.prototype.sqrTo=function(b,c){b.squareTo(c);this.reduce(c)};var ca=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,
349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Ec=67108864/ca[ca.length-1];r.prototype.chunkSize=function(b){return Math.floor(Math.LN2*this.DB/Math.log(b))};
r.prototype.toRadix=function(b){null==b&&(b=10);if(0==this.signum()||2>b||36<b)return"0";var c=this.chunkSize(b),c=Math.pow(b,c),e=ba(c),h=F(),f=F(),p="";for(this.divRemTo(e,h,f);0<h.signum();)p=(c+f.intValue()).toString(b).substr(1)+p,h.divRemTo(e,h,f);return f.intValue().toString(b)+p};r.prototype.fromRadix=function(b,c){this.fromInt(0);null==c&&(c=10);for(var e=this.chunkSize(c),h=Math.pow(c,e),f=!1,p=0,E=0,l=0;l<b.length;++l){var x=va(b,l);0>x?"-"==b.charAt(l)&&0==this.signum()&&(f=!0):(E=c*E+
x,++p>=e&&(this.dMultiply(h),this.dAddOffset(E,0),E=p=0))}0<p&&(this.dMultiply(Math.pow(c,p)),this.dAddOffset(E,0));f&&r.ZERO.subTo(this,this)};r.prototype.fromNumber=function(b,c,e){if("number"==typeof c)if(2>b)this.fromInt(1);else for(this.fromNumber(b,e),this.testBit(b-1)||this.bitwiseTo(r.ONE.shiftLeft(b-1),M,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(c);)this.dAddOffset(2,0),this.bitLength()>b&&this.subTo(r.ONE.shiftLeft(b-1),this);else{e=[];var h=b&7;e.length=(b>>3)+1;c.nextBytes(e);
e[0]=0<h?e[0]&(1<<h)-1:0;this.fromString(e,256)}};r.prototype.bitwiseTo=function(b,c,e){var h,f,p=Math.min(b.t,this.t);for(h=0;h<p;++h)e[h]=c(this[h],b[h]);if(b.t<this.t){f=b.s&this.DM;for(h=p;h<this.t;++h)e[h]=c(this[h],f);e.t=this.t}else{f=this.s&this.DM;for(h=p;h<b.t;++h)e[h]=c(f,b[h]);e.t=b.t}e.s=c(this.s,b.s);e.clamp()};r.prototype.changeBit=function(b,c){var e=r.ONE.shiftLeft(b);this.bitwiseTo(e,c,e);return e};r.prototype.addTo=function(b,c){for(var e=0,h=0,f=Math.min(b.t,this.t);e<f;)h+=this[e]+
b[e],c[e++]=h&this.DM,h>>=this.DB;if(b.t<this.t){for(h+=b.s;e<this.t;)h+=this[e],c[e++]=h&this.DM,h>>=this.DB;h+=this.s}else{for(h+=this.s;e<b.t;)h+=b[e],c[e++]=h&this.DM,h>>=this.DB;h+=b.s}c.s=0>h?-1:0;0<h?c[e++]=h:-1>h&&(c[e++]=this.DV+h);c.t=e;c.clamp()};r.prototype.dMultiply=function(b){this[this.t]=this.am(0,b-1,this,0,0,this.t);++this.t;this.clamp()};r.prototype.dAddOffset=function(b,c){if(0!=b){for(;this.t<=c;)this[this.t++]=0;for(this[c]+=b;this[c]>=this.DV;)this[c]-=this.DV,++c>=this.t&&
(this[this.t++]=0),++this[c]}};r.prototype.multiplyLowerTo=function(b,c,e){var h=Math.min(this.t+b.t,c);e.s=0;for(e.t=h;0<h;)e[--h]=0;var f;for(f=e.t-this.t;h<f;++h)e[h+this.t]=this.am(0,b[h],e,h,0,this.t);for(f=Math.min(b.t,c);h<f;++h)this.am(0,b[h],e,h,0,c-h);e.clamp()};r.prototype.multiplyUpperTo=function(b,c,e){--c;var h=e.t=this.t+b.t-c;for(e.s=0;0<=--h;)e[h]=0;for(h=Math.max(c-this.t,0);h<b.t;++h)e[this.t+h-c]=this.am(c-h,b[h],e,0,0,this.t+h-c);e.clamp();e.drShiftTo(1,e)};r.prototype.modInt=
function(b){if(0>=b)return 0;var c=this.DV%b,e=0>this.s?b-1:0;if(0<this.t)if(0==c)e=this[0]%b;else for(var h=this.t-1;0<=h;--h)e=(c*e+this[h])%b;return e};r.prototype.millerRabin=function(b){var c=this.subtract(r.ONE),e=c.getLowestSetBit();if(0>=e)return!1;var h=c.shiftRight(e);b=b+1>>1;b>ca.length&&(b=ca.length);for(var f=F(),p=0;p<b;++p){f.fromInt(ca[Math.floor(Math.random()*ca.length)]);var E=f.modPow(h,this);if(0!=E.compareTo(r.ONE)&&0!=E.compareTo(c)){for(var l=1;l++<e&&0!=E.compareTo(c);)if(E=
E.modPowInt(2,this),0==E.compareTo(r.ONE))return!1;if(0!=E.compareTo(c))return!1}}return!0};r.prototype.clone=function(){var b=F();this.copyTo(b);return b};r.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]};r.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24};r.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<
16>>16};r.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this[0]?0:1};r.prototype.toByteArray=function(){var b=this.t,c=[];c[0]=this.s;var e=this.DB-b*this.DB%8,h,f=0;if(0<b--)for(e<this.DB&&(h=this[b]>>e)!=(this.s&this.DM)>>e&&(c[f++]=h|this.s<<this.DB-e);0<=b;)if(8>e?(h=(this[b]&(1<<e)-1)<<8-e,h|=this[--b]>>(e+=this.DB-8)):(h=this[b]>>(e-=8)&255,0>=e&&(e+=this.DB,--b)),0!=(h&128)&&(h|=-256),0==f&&(this.s&128)!=(h&128)&&++f,0<f||h!=this.s)c[f++]=h;return c};r.prototype.equals=
function(b){return 0==this.compareTo(b)};r.prototype.min=function(b){return 0>this.compareTo(b)?this:b};r.prototype.max=function(b){return 0<this.compareTo(b)?this:b};r.prototype.and=function(b){var c=F();this.bitwiseTo(b,H,c);return c};r.prototype.or=function(b){var c=F();this.bitwiseTo(b,M,c);return c};r.prototype.xor=function(b){var c=F();this.bitwiseTo(b,Tb,c);return c};r.prototype.andNot=function(b){var c=F();this.bitwiseTo(b,Ub,c);return c};r.prototype.not=function(){for(var b=F(),c=0;c<this.t;++c)b[c]=
this.DM&~this[c];b.t=this.t;b.s=~this.s;return b};r.prototype.shiftLeft=function(b){var c=F();0>b?this.rShiftTo(-b,c):this.lShiftTo(b,c);return c};r.prototype.shiftRight=function(b){var c=F();0>b?this.lShiftTo(-b,c):this.rShiftTo(b,c);return c};r.prototype.getLowestSetBit=function(){for(var b=0;b<this.t;++b)if(0!=this[b]){var c=b*this.DB,b=this[b];if(0==b)b=-1;else{var e=0;0==(b&65535)&&(b>>=16,e+=16);0==(b&255)&&(b>>=8,e+=8);0==(b&15)&&(b>>=4,e+=4);0==(b&3)&&(b>>=2,e+=2);0==(b&1)&&++e;b=e}return c+
b}return 0>this.s?this.t*this.DB:-1};r.prototype.bitCount=function(){for(var b=0,c=this.s&this.DM,e=0;e<this.t;++e){for(var h=this[e]^c,f=0;0!=h;)h&=h-1,++f;b+=f}return b};r.prototype.testBit=function(b){var c=Math.floor(b/this.DB);return c>=this.t?0!=this.s:0!=(this[c]&1<<b%this.DB)};r.prototype.setBit=function(b){return this.changeBit(b,M)};r.prototype.clearBit=function(b){return this.changeBit(b,Ub)};r.prototype.flipBit=function(b){return this.changeBit(b,Tb)};r.prototype.add=function(b){var c=
F();this.addTo(b,c);return c};r.prototype.subtract=function(b){var c=F();this.subTo(b,c);return c};r.prototype.multiply=function(b){var c=F();this.multiplyTo(b,c);return c};r.prototype.divide=function(b){var c=F();this.divRemTo(b,c,null);return c};r.prototype.remainder=function(b){var c=F();this.divRemTo(b,null,c);return c};r.prototype.divideAndRemainder=function(b){var c=F(),e=F();this.divRemTo(b,c,e);return[c,e]};r.prototype.modPow=function(b,c){var e=b.bitLength(),h,f=ba(1),p;if(0>=e)return f;
h=18>e?1:48>e?3:144>e?4:768>e?5:6;p=8>e?new P(c):c.isEven()?new Ca(c):new l(c);var E=[],r=3,x=h-1,Ma=(1<<h)-1;E[1]=p.convert(this);if(1<h)for(e=F(),p.sqrTo(E[1],e);r<=Ma;)E[r]=F(),p.mulTo(e,E[r-2],E[r]),r+=2;for(var I=b.t-1,aa,H=!0,M=F(),e=G(b[I])-1;0<=I;){e>=x?aa=b[I]>>e-x&Ma:(aa=(b[I]&(1<<e+1)-1)<<x-e,0<I&&(aa|=b[I-1]>>this.DB+e-x));for(r=h;0==(aa&1);)aa>>=1,--r;0>(e-=r)&&(e+=this.DB,--I);if(H)E[aa].copyTo(f),H=!1;else{for(;1<r;)p.sqrTo(f,M),p.sqrTo(M,f),r-=2;0<r?p.sqrTo(f,M):(r=f,f=M,M=r);p.mulTo(M,
E[aa],f)}for(;0<=I&&0==(b[I]&1<<e);)p.sqrTo(f,M),r=f,f=M,M=r,0>--e&&(e=this.DB-1,--I)}return p.revert(f)};r.prototype.modInverse=function(b){var c=b.isEven();if(this.isEven()&&c||0==b.signum())return r.ZERO;for(var e=b.clone(),h=this.clone(),f=ba(1),p=ba(0),E=ba(0),l=ba(1);0!=e.signum();){for(;e.isEven();)e.rShiftTo(1,e),c?(f.isEven()&&p.isEven()||(f.addTo(this,f),p.subTo(b,p)),f.rShiftTo(1,f)):p.isEven()||p.subTo(b,p),p.rShiftTo(1,p);for(;h.isEven();)h.rShiftTo(1,h),c?(E.isEven()&&l.isEven()||(E.addTo(this,
E),l.subTo(b,l)),E.rShiftTo(1,E)):l.isEven()||l.subTo(b,l),l.rShiftTo(1,l);0<=e.compareTo(h)?(e.subTo(h,e),c&&f.subTo(E,f),p.subTo(l,p)):(h.subTo(e,h),c&&E.subTo(f,E),l.subTo(p,l))}if(0!=h.compareTo(r.ONE))return r.ZERO;if(0<=l.compareTo(b))return l.subtract(b);if(0>l.signum())l.addTo(b,l);else return l;return 0>l.signum()?l.add(b):l};r.prototype.pow=function(b){return this.exp(b,new $a)};r.prototype.gcd=function(b){var c=0>this.s?this.negate():this.clone();b=0>b.s?b.negate():b.clone();if(0>c.compareTo(b)){var e=
c,c=b;b=e}var e=c.getLowestSetBit(),h=b.getLowestSetBit();if(0>h)return c;e<h&&(h=e);for(0<h&&(c.rShiftTo(h,c),b.rShiftTo(h,b));0<c.signum();)0<(e=c.getLowestSetBit())&&c.rShiftTo(e,c),0<(e=b.getLowestSetBit())&&b.rShiftTo(e,b),0<=c.compareTo(b)?(c.subTo(b,c),c.rShiftTo(1,c)):(b.subTo(c,b),b.rShiftTo(1,b));0<h&&b.lShiftTo(h,b);return b};r.prototype.isProbablePrime=function(b){var c,e=this.abs();if(1==e.t&&e[0]<=ca[ca.length-1]){for(c=0;c<ca.length;++c)if(e[0]==ca[c])return!0;return!1}if(e.isEven())return!1;
for(c=1;c<ca.length;){for(var h=ca[c],f=c+1;f<ca.length&&h<Ec;)h*=ca[f++];for(h=e.modInt(h);c<f;)if(0==h%ca[c++])return!1}return e.millerRabin(b)};r.prototype.square=function(){var b=F();this.squareTo(b);return b};r.prototype.IsNegative=function(){return-1==this.compareTo(r.ZERO)?!0:!1};r.op_Equality=function(b,c){return 0==b.compareTo(c)?!0:!1};r.op_Inequality=function(b,c){return 0!=b.compareTo(c)?!0:!1};r.op_GreaterThan=function(b,c){return 0<b.compareTo(c)?!0:!1};r.op_LessThan=function(b,c){return 0>
b.compareTo(c)?!0:!1};r.op_Addition=function(b,c){return(new r(b)).add(new r(c))};r.op_Subtraction=function(b,c){return(new r(b)).subtract(new r(c))};r.Int128Mul=function(b,c){return(new r(b)).multiply(new r(c))};r.op_Division=function(b,c){return b.divide(c)};r.prototype.ToDouble=function(){return parseFloat(this.toString())};if("undefined"==typeof Qa)var Qa=function(b,c){var e;if("undefined"==typeof Object.getOwnPropertyNames)for(e in c.prototype){if("undefined"==typeof b.prototype[e]||b.prototype[e]==
Object.prototype[e])b.prototype[e]=c.prototype[e]}else for(var h=Object.getOwnPropertyNames(c.prototype),f=0;f<h.length;f++)"undefined"==typeof Object.getOwnPropertyDescriptor(b.prototype,h[f])&&Object.defineProperty(b.prototype,h[f],Object.getOwnPropertyDescriptor(c.prototype,h[f]));for(e in c)"undefined"==typeof b[e]&&(b[e]=c[e]);b.$baseCtor=c};f.Path=function(){return[]};f.Paths=function(){return[]};f.DoublePoint=function(){var b=arguments;this.Y=this.X=0;1==b.length?(this.X=b[0].X,this.Y=b[0].Y):
2==b.length&&(this.X=b[0],this.Y=b[1])};f.DoublePoint0=function(){this.Y=this.X=0};f.DoublePoint1=function(b){this.X=b.X;this.Y=b.Y};f.DoublePoint2=function(b,c){this.X=b;this.Y=c};f.PolyNode=function(){this.m_Parent=null;this.m_polygon=new f.Path;this.m_endtype=this.m_jointype=this.m_Index=0;this.m_Childs=[];this.IsOpen=!1};f.PolyNode.prototype.IsHoleNode=function(){for(var b=!0,c=this.m_Parent;null!==c;)b=!b,c=c.m_Parent;return b};f.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length};
f.PolyNode.prototype.Contour=function(){return this.m_polygon};f.PolyNode.prototype.AddChild=function(b){var c=this.m_Childs.length;this.m_Childs.push(b);b.m_Parent=this;b.m_Index=c};f.PolyNode.prototype.GetNext=function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()};f.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]};f.PolyNode.prototype.Childs=
function(){return this.m_Childs};f.PolyNode.prototype.Parent=function(){return this.m_Parent};f.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()};f.PolyTree=function(){this.m_AllPolys=[];f.PolyNode.call(this)};f.PolyTree.prototype.Clear=function(){for(var b=0,c=this.m_AllPolys.length;b<c;b++)this.m_AllPolys[b]=null;this.m_AllPolys.length=0;this.m_Childs.length=0};f.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null};f.PolyTree.prototype.Total=function(){return this.m_AllPolys.length};
Qa(f.PolyTree,f.PolyNode);f.Math_Abs_Int64=f.Math_Abs_Int32=f.Math_Abs_Double=function(b){return Math.abs(b)};f.Math_Max_Int32_Int32=function(b,c){return Math.max(b,c)};f.Cast_Int32=R||Pa||ya?function(b){return b|0}:function(b){return~~b};f.Cast_Int64=Oa?function(b){return-2147483648>b||2147483647<b?0>b?Math.ceil(b):Math.floor(b):~~b}:Da&&"function"==typeof Number.toInteger?function(b){return Number.toInteger(b)}:Va||Ea?function(b){return parseInt(b,10)}:R?function(b){return-2147483648>b||2147483647<
b?0>b?Math.ceil(b):Math.floor(b):b|0}:function(b){return 0>b?Math.ceil(b):Math.floor(b)};f.Clear=function(b){b.length=0};f.PI=3.141592653589793;f.PI2=6.283185307179586;f.IntPoint=function(){var b;b=arguments;var c=b.length;this.Y=this.X=0;2==c?(this.X=b[0],this.Y=b[1]):1==c?b[0]instanceof f.DoublePoint?(b=b[0],this.X=f.Clipper.Round(b.X),this.Y=f.Clipper.Round(b.Y)):(b=b[0],this.X=b.X,this.Y=b.Y):this.Y=this.X=0};f.IntPoint.op_Equality=function(b,c){return b.X==c.X&&b.Y==c.Y};f.IntPoint.op_Inequality=
function(b,c){return b.X!=c.X||b.Y!=c.Y};f.IntPoint0=function(){this.Y=this.X=0};f.IntPoint1=function(b){this.X=b.X;this.Y=b.Y};f.IntPoint1dp=function(b){this.X=f.Clipper.Round(b.X);this.Y=f.Clipper.Round(b.Y)};f.IntPoint2=function(b,c){this.X=b;this.Y=c};f.IntRect=function(){var b=arguments,c=b.length;4==c?(this.left=b[0],this.top=b[1],this.right=b[2],this.bottom=b[3]):1==c?(this.left=b[0].left,this.top=b[0].top,this.right=b[0].right,this.bottom=b[0].bottom):this.bottom=this.right=this.top=this.left=
0};f.IntRect0=function(){this.bottom=this.right=this.top=this.left=0};f.IntRect1=function(b){this.left=b.left;this.top=b.top;this.right=b.right;this.bottom=b.bottom};f.IntRect4=function(b,c,e,h){this.left=b;this.top=c;this.right=e;this.bottom=h};f.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3};f.PolyType={ptSubject:0,ptClip:1};f.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3};f.JoinType={jtSquare:0,jtRound:1,jtMiter:2};f.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,
etClosedLine:3,etClosedPolygon:4};f.EdgeSide={esLeft:0,esRight:1};f.Direction={dRightToLeft:0,dLeftToRight:1};f.TEdge=function(){this.Bot=new f.IntPoint;this.Curr=new f.IntPoint;this.Top=new f.IntPoint;this.Delta=new f.IntPoint;this.Dx=0;this.PolyTyp=f.PolyType.ptSubject;this.Side=f.EdgeSide.esLeft;this.OutIdx=this.WindCnt2=this.WindCnt=this.WindDelta=0;this.PrevInSEL=this.NextInSEL=this.PrevInAEL=this.NextInAEL=this.NextInLML=this.Prev=this.Next=null};f.IntersectNode=function(){this.Edge2=this.Edge1=
null;this.Pt=new f.IntPoint};f.MyIntersectNodeSort=function(){};f.MyIntersectNodeSort.Compare=function(b,c){return c.Pt.Y-b.Pt.Y};f.LocalMinima=function(){this.Y=0;this.Next=this.RightBound=this.LeftBound=null};f.Scanbeam=function(){this.Y=0;this.Next=null};f.OutRec=function(){this.Idx=0;this.IsOpen=this.IsHole=!1;this.PolyNode=this.BottomPt=this.Pts=this.FirstLeft=null};f.OutPt=function(){this.Idx=0;this.Pt=new f.IntPoint;this.Prev=this.Next=null};f.Join=function(){this.OutPt2=this.OutPt1=null;this.OffPt=
new f.IntPoint};f.ClipperBase=function(){this.m_CurrentLM=this.m_MinimaList=null;this.m_edges=[];this.PreserveCollinear=this.m_HasOpenPaths=this.m_UseFullRange=!1;this.m_CurrentLM=this.m_MinimaList=null;this.m_HasOpenPaths=this.m_UseFullRange=!1};f.ClipperBase.horizontal=-9007199254740992;f.ClipperBase.Skip=-2;f.ClipperBase.Unassigned=-1;f.ClipperBase.tolerance=1E-20;f.ClipperBase.loRange=47453132;f.ClipperBase.hiRange=0xfffffffffffff;f.ClipperBase.near_zero=function(b){return b>-f.ClipperBase.tolerance&&
b<f.ClipperBase.tolerance};f.ClipperBase.IsHorizontal=function(b){return 0===b.Delta.Y};f.ClipperBase.prototype.PointIsVertex=function(b,c){var e=c;do{if(f.IntPoint.op_Equality(e.Pt,b))return!0;e=e.Next}while(e!=c);return!1};f.ClipperBase.prototype.PointOnLineSegment=function(b,c,e,h){return h?b.X==c.X&&b.Y==c.Y||b.X==e.X&&b.Y==e.Y||b.X>c.X==b.X<e.X&&b.Y>c.Y==b.Y<e.Y&&r.op_Equality(r.Int128Mul(b.X-c.X,e.Y-c.Y),r.Int128Mul(e.X-c.X,b.Y-c.Y)):b.X==c.X&&b.Y==c.Y||b.X==e.X&&b.Y==e.Y||b.X>c.X==b.X<e.X&&
b.Y>c.Y==b.Y<e.Y&&(b.X-c.X)*(e.Y-c.Y)==(e.X-c.X)*(b.Y-c.Y)};f.ClipperBase.prototype.PointOnPolygon=function(b,c,e){for(var h=c;;){if(this.PointOnLineSegment(b,h.Pt,h.Next.Pt,e))return!0;h=h.Next;if(h==c)break}return!1};f.ClipperBase.prototype.SlopesEqual=f.ClipperBase.SlopesEqual=function(){var b=arguments,c=b.length,e,h,q;if(3==c)return c=b[0],e=b[1],b[2]?r.op_Equality(r.Int128Mul(c.Delta.Y,e.Delta.X),r.Int128Mul(c.Delta.X,e.Delta.Y)):f.Cast_Int64(c.Delta.Y*e.Delta.X)==f.Cast_Int64(c.Delta.X*e.Delta.Y);
if(4==c)return c=b[0],e=b[1],h=b[2],b[3]?r.op_Equality(r.Int128Mul(c.Y-e.Y,e.X-h.X),r.Int128Mul(c.X-e.X,e.Y-h.Y)):0===f.Cast_Int64((c.Y-e.Y)*(e.X-h.X))-f.Cast_Int64((c.X-e.X)*(e.Y-h.Y));c=b[0];e=b[1];h=b[2];q=b[3];return b[4]?r.op_Equality(r.Int128Mul(c.Y-e.Y,h.X-q.X),r.Int128Mul(c.X-e.X,h.Y-q.Y)):0===f.Cast_Int64((c.Y-e.Y)*(h.X-q.X))-f.Cast_Int64((c.X-e.X)*(h.Y-q.Y))};f.ClipperBase.SlopesEqual3=function(b,c,e){return e?r.op_Equality(r.Int128Mul(b.Delta.Y,c.Delta.X),r.Int128Mul(b.Delta.X,c.Delta.Y)):
f.Cast_Int64(b.Delta.Y*c.Delta.X)==f.Cast_Int64(b.Delta.X*c.Delta.Y)};f.ClipperBase.SlopesEqual4=function(b,c,e,h){return h?r.op_Equality(r.Int128Mul(b.Y-c.Y,c.X-e.X),r.Int128Mul(b.X-c.X,c.Y-e.Y)):0===f.Cast_Int64((b.Y-c.Y)*(c.X-e.X))-f.Cast_Int64((b.X-c.X)*(c.Y-e.Y))};f.ClipperBase.SlopesEqual5=function(b,c,e,h,q){return q?r.op_Equality(r.Int128Mul(b.Y-c.Y,e.X-h.X),r.Int128Mul(b.X-c.X,e.Y-h.Y)):0===f.Cast_Int64((b.Y-c.Y)*(e.X-h.X))-f.Cast_Int64((b.X-c.X)*(e.Y-h.Y))};f.ClipperBase.prototype.Clear=
function(){this.DisposeLocalMinimaList();for(var b=0,c=this.m_edges.length;b<c;++b){for(var e=0,h=this.m_edges[b].length;e<h;++e)this.m_edges[b][e]=null;f.Clear(this.m_edges[b])}f.Clear(this.m_edges);this.m_HasOpenPaths=this.m_UseFullRange=!1};f.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var b=this.m_MinimaList.Next;this.m_MinimaList=null;this.m_MinimaList=b}this.m_CurrentLM=null};f.ClipperBase.prototype.RangeTest=function(b,c){if(c.Value)(b.X>f.ClipperBase.hiRange||
b.Y>f.ClipperBase.hiRange||-b.X>f.ClipperBase.hiRange||-b.Y>f.ClipperBase.hiRange)&&f.Error("Coordinate outside allowed range in RangeTest().");else if(b.X>f.ClipperBase.loRange||b.Y>f.ClipperBase.loRange||-b.X>f.ClipperBase.loRange||-b.Y>f.ClipperBase.loRange)c.Value=!0,this.RangeTest(b,c)};f.ClipperBase.prototype.InitEdge=function(b,c,e,h){b.Next=c;b.Prev=e;b.Curr.X=h.X;b.Curr.Y=h.Y;b.OutIdx=-1};f.ClipperBase.prototype.InitEdge2=function(b,c){b.Curr.Y>=b.Next.Curr.Y?(b.Bot.X=b.Curr.X,b.Bot.Y=b.Curr.Y,
b.Top.X=b.Next.Curr.X,b.Top.Y=b.Next.Curr.Y):(b.Top.X=b.Curr.X,b.Top.Y=b.Curr.Y,b.Bot.X=b.Next.Curr.X,b.Bot.Y=b.Next.Curr.Y);this.SetDx(b);b.PolyTyp=c};f.ClipperBase.prototype.FindNextLocMin=function(b){for(var c;;){for(;f.IntPoint.op_Inequality(b.Bot,b.Prev.Bot)||f.IntPoint.op_Equality(b.Curr,b.Top);)b=b.Next;if(b.Dx!=f.ClipperBase.horizontal&&b.Prev.Dx!=f.ClipperBase.horizontal)break;for(;b.Prev.Dx==f.ClipperBase.horizontal;)b=b.Prev;for(c=b;b.Dx==f.ClipperBase.horizontal;)b=b.Next;if(b.Top.Y!=
b.Prev.Bot.Y){c.Prev.Bot.X<b.Bot.X&&(b=c);break}}return b};f.ClipperBase.prototype.ProcessBound=function(b,c){var e=b,h=b,q;b.Dx==f.ClipperBase.horizontal&&(q=c?b.Prev.Bot.X:b.Next.Bot.X,b.Bot.X!=q&&this.ReverseHorizontal(b));if(h.OutIdx!=f.ClipperBase.Skip)if(c){for(;h.Top.Y==h.Next.Bot.Y&&h.Next.OutIdx!=f.ClipperBase.Skip;)h=h.Next;if(h.Dx==f.ClipperBase.horizontal&&h.Next.OutIdx!=f.ClipperBase.Skip){for(q=h;q.Prev.Dx==f.ClipperBase.horizontal;)q=q.Prev;q.Prev.Top.X==h.Next.Top.X?c||(h=q.Prev):
q.Prev.Top.X>h.Next.Top.X&&(h=q.Prev)}for(;b!=h;)b.NextInLML=b.Next,b.Dx==f.ClipperBase.horizontal&&b!=e&&b.Bot.X!=b.Prev.Top.X&&this.ReverseHorizontal(b),b=b.Next;b.Dx==f.ClipperBase.horizontal&&b!=e&&b.Bot.X!=b.Prev.Top.X&&this.ReverseHorizontal(b);h=h.Next}else{for(;h.Top.Y==h.Prev.Bot.Y&&h.Prev.OutIdx!=f.ClipperBase.Skip;)h=h.Prev;if(h.Dx==f.ClipperBase.horizontal&&h.Prev.OutIdx!=f.ClipperBase.Skip){for(q=h;q.Next.Dx==f.ClipperBase.horizontal;)q=q.Next;q.Next.Top.X==h.Prev.Top.X?c||(h=q.Next):
q.Next.Top.X>h.Prev.Top.X&&(h=q.Next)}for(;b!=h;)b.NextInLML=b.Prev,b.Dx==f.ClipperBase.horizontal&&b!=e&&b.Bot.X!=b.Next.Top.X&&this.ReverseHorizontal(b),b=b.Prev;b.Dx==f.ClipperBase.horizontal&&b!=e&&b.Bot.X!=b.Next.Top.X&&this.ReverseHorizontal(b);h=h.Prev}if(h.OutIdx==f.ClipperBase.Skip){b=h;if(c){for(;b.Top.Y==b.Next.Bot.Y;)b=b.Next;for(;b!=h&&b.Dx==f.ClipperBase.horizontal;)b=b.Prev}else{for(;b.Top.Y==b.Prev.Bot.Y;)b=b.Prev;for(;b!=h&&b.Dx==f.ClipperBase.horizontal;)b=b.Next}b==h?h=c?b.Next:
b.Prev:(b=c?h.Next:h.Prev,e=new f.LocalMinima,e.Next=null,e.Y=b.Bot.Y,e.LeftBound=null,e.RightBound=b,e.RightBound.WindDelta=0,h=this.ProcessBound(e.RightBound,c),this.InsertLocalMinima(e))}return h};f.ClipperBase.prototype.AddPath=function(b,c,e){e||c!=f.PolyType.ptClip||f.Error("AddPath: Open paths must be subject.");var h=b.length-1;if(e)for(;0<h&&f.IntPoint.op_Equality(b[h],b[0]);)--h;for(;0<h&&f.IntPoint.op_Equality(b[h],b[h-1]);)--h;if(e&&2>h||!e&&1>h)return!1;for(var q=[],p=0;p<=h;p++)q.push(new f.TEdge);
var E=!0;try{for(q[1].Curr.X=b[1].X,q[1].Curr.Y=b[1].Y,function(){var c={Value:this.m_UseFullRange},e=this.RangeTest(b[0],c);this.m_UseFullRange=c.Value;return e}.call(this),function(){var c={Value:this.m_UseFullRange},e=this.RangeTest(b[h],c);this.m_UseFullRange=c.Value;return e}.call(this),this.InitEdge(q[0],q[1],q[h],b[0]),this.InitEdge(q[h],q[0],q[h-1],b[h]),p=h-1;1<=p;--p)(function(){var c={Value:this.m_UseFullRange},e=this.RangeTest(b[p],c);this.m_UseFullRange=c.Value;return e}).call(this),
this.InitEdge(q[p],q[p+1],q[p-1],b[p])}catch(l){return!1}var r=q[0];e||(r.Prev.OutIdx=f.ClipperBase.Skip);for(var x=r,G=r;;)if(f.IntPoint.op_Equality(x.Curr,x.Next.Curr)){if(x==x.Next)break;x==r&&(r=x.Next);G=x=this.RemoveEdge(x)}else{if(x.Prev==x.Next)break;else if(e&&f.ClipperBase.SlopesEqual(x.Prev.Curr,x.Curr,x.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(x.Prev.Curr,x.Curr,x.Next.Curr))){x==r&&(r=x.Next);x=this.RemoveEdge(x);G=x=x.Prev;continue}x=x.Next;
if(x==G)break}if(!e&&x==x.Next||e&&x.Prev==x.Next)return!1;e||(this.m_HasOpenPaths=!0);x=r;do this.InitEdge2(x,c),x=x.Next,E&&x.Curr.Y!=r.Curr.Y&&(E=!1);while(x!=r);if(E){if(e)return!1;x.Prev.OutIdx=f.ClipperBase.Skip;x.Prev.Bot.X<x.Prev.Top.X&&this.ReverseHorizontal(x.Prev);c=new f.LocalMinima;c.Next=null;c.Y=x.Bot.Y;c.LeftBound=null;c.RightBound=x;c.RightBound.Side=f.EdgeSide.esRight;for(c.RightBound.WindDelta=0;x.Next.OutIdx!=f.ClipperBase.Skip;)x.NextInLML=x.Next,x.Bot.X!=x.Prev.Top.X&&this.ReverseHorizontal(x),
x=x.Next;this.InsertLocalMinima(c);this.m_edges.push(q);return!0}this.m_edges.push(q);for(E=null;;){x=this.FindNextLocMin(x);if(x==E)break;else null==E&&(E=x);c=new f.LocalMinima;c.Next=null;c.Y=x.Bot.Y;x.Dx<x.Prev.Dx?(c.LeftBound=x.Prev,c.RightBound=x,q=!1):(c.LeftBound=x,c.RightBound=x.Prev,q=!0);c.LeftBound.Side=f.EdgeSide.esLeft;c.RightBound.Side=f.EdgeSide.esRight;c.LeftBound.WindDelta=e?c.LeftBound.Next==c.RightBound?-1:1:0;c.RightBound.WindDelta=-c.LeftBound.WindDelta;x=this.ProcessBound(c.LeftBound,
q);r=this.ProcessBound(c.RightBound,!q);c.LeftBound.OutIdx==f.ClipperBase.Skip?c.LeftBound=null:c.RightBound.OutIdx==f.ClipperBase.Skip&&(c.RightBound=null);this.InsertLocalMinima(c);q||(x=r)}return!0};f.ClipperBase.prototype.AddPaths=function(b,c,e){for(var h=!1,f=0,p=b.length;f<p;++f)this.AddPath(b[f],c,e)&&(h=!0);return h};f.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(b,c,e){return f.IntPoint.op_Equality(b,e)||f.IntPoint.op_Equality(b,c)||f.IntPoint.op_Equality(e,c)?!1:b.X!=e.X?c.X>b.X==
c.X<e.X:c.Y>b.Y==c.Y<e.Y};f.ClipperBase.prototype.RemoveEdge=function(b){b.Prev.Next=b.Next;b.Next.Prev=b.Prev;var c=b.Next;b.Prev=null;return c};f.ClipperBase.prototype.SetDx=function(b){b.Delta.X=b.Top.X-b.Bot.X;b.Delta.Y=b.Top.Y-b.Bot.Y;b.Dx=0===b.Delta.Y?f.ClipperBase.horizontal:b.Delta.X/b.Delta.Y};f.ClipperBase.prototype.InsertLocalMinima=function(b){if(null===this.m_MinimaList)this.m_MinimaList=b;else if(b.Y>=this.m_MinimaList.Y)b.Next=this.m_MinimaList,this.m_MinimaList=b;else{for(var c=this.m_MinimaList;null!==
c.Next&&b.Y<c.Next.Y;)c=c.Next;b.Next=c.Next;c.Next=b}};f.ClipperBase.prototype.PopLocalMinima=function(){null!==this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.Next)};f.ClipperBase.prototype.ReverseHorizontal=function(b){var c=b.Top.X;b.Top.X=b.Bot.X;b.Bot.X=c};f.ClipperBase.prototype.Reset=function(){this.m_CurrentLM=this.m_MinimaList;if(null!=this.m_CurrentLM)for(var b=this.m_MinimaList;null!=b;){var c=b.LeftBound;null!=c&&(c.Curr.X=c.Bot.X,c.Curr.Y=c.Bot.Y,c.Side=f.EdgeSide.esLeft,c.OutIdx=
f.ClipperBase.Unassigned);c=b.RightBound;null!=c&&(c.Curr.X=c.Bot.X,c.Curr.Y=c.Bot.Y,c.Side=f.EdgeSide.esRight,c.OutIdx=f.ClipperBase.Unassigned);b=b.Next}};f.Clipper=function(b){"undefined"==typeof b&&(b=0);this.m_PolyOuts=null;this.m_ClipType=f.ClipType.ctIntersection;this.m_IntersectNodeComparer=this.m_IntersectList=this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_ExecuteLocked=!1;this.m_SubjFillType=this.m_ClipFillType=f.PolyFillType.pftEvenOdd;this.m_GhostJoins=this.m_Joins=
null;this.StrictlySimple=this.ReverseSolution=this.m_UsingPolyTree=!1;f.ClipperBase.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_IntersectList=[];this.m_IntersectNodeComparer=f.MyIntersectNodeSort.Compare;this.m_UsingPolyTree=this.m_ExecuteLocked=!1;this.m_PolyOuts=[];this.m_Joins=[];this.m_GhostJoins=[];this.ReverseSolution=0!==(1&b);this.StrictlySimple=0!==(2&b);this.PreserveCollinear=0!==(4&b)};f.Clipper.ioReverseSolution=1;f.Clipper.ioStrictlySimple=2;f.Clipper.ioPreserveCollinear=
4;f.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),f.ClipperBase.prototype.Clear.call(this))};f.Clipper.prototype.DisposeScanbeamList=function(){for(;null!==this.m_Scanbeam;){var b=this.m_Scanbeam.Next;this.m_Scanbeam=null;this.m_Scanbeam=b}};f.Clipper.prototype.Reset=function(){f.ClipperBase.prototype.Reset.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.DisposeAllPolyPts();for(var b=this.m_MinimaList;null!==b;)this.InsertScanbeam(b.Y),
b=b.Next};f.Clipper.prototype.InsertScanbeam=function(b){if(null===this.m_Scanbeam)this.m_Scanbeam=new f.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=b;else if(b>this.m_Scanbeam.Y){var c=new f.Scanbeam;c.Y=b;c.Next=this.m_Scanbeam;this.m_Scanbeam=c}else{for(var e=this.m_Scanbeam;null!==e.Next&&b<=e.Next.Y;)e=e.Next;b!=e.Y&&(c=new f.Scanbeam,c.Y=b,c.Next=e.Next,e.Next=c)}};f.Clipper.prototype.Execute=function(){var b=arguments,c=b.length,e=b[1]instanceof f.PolyTree;if(4!=c||e){if(4==c&&e){e=
b[0];c=b[1];h=b[2];b=b[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;this.m_SubjFillType=h;this.m_ClipFillType=b;this.m_ClipType=e;this.m_UsingPolyTree=!0;(b=this.ExecuteInternal())&&this.BuildResult2(c);this.m_ExecuteLocked=!1;return b}if(2==c&&!e||2==c&&e)return e=b[0],c=b[1],this.Execute(e,c,f.PolyFillType.pftEvenOdd,f.PolyFillType.pftEvenOdd)}else{var e=b[0],c=b[1],h=b[2],b=b[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&f.Error("Error: PolyTree struct is need for open path clipping.");
this.m_ExecuteLocked=!0;f.Clear(c);this.m_SubjFillType=h;this.m_ClipFillType=b;this.m_ClipType=e;this.m_UsingPolyTree=!1;(b=this.ExecuteInternal())&&this.BuildResult(c);this.m_ExecuteLocked=!1;return b}};f.Clipper.prototype.FixHoleLinkage=function(b){if(null!==b.FirstLeft&&(b.IsHole==b.FirstLeft.IsHole||null===b.FirstLeft.Pts)){for(var c=b.FirstLeft;null!==c&&(c.IsHole==b.IsHole||null===c.Pts);)c=c.FirstLeft;b.FirstLeft=c}};f.Clipper.prototype.ExecuteInternal=function(){try{this.Reset();if(null===
this.m_CurrentLM)return!1;var b=this.PopScanbeam();do{this.InsertLocalMinimaIntoAEL(b);f.Clear(this.m_GhostJoins);this.ProcessHorizontals(!1);if(null===this.m_Scanbeam)break;var c=this.PopScanbeam();if(!this.ProcessIntersections(b,c))return!1;this.ProcessEdgesAtTopOfScanbeam(c);b=c}while(null!==this.m_Scanbeam||null!==this.m_CurrentLM);for(var b=0,e=this.m_PolyOuts.length;b<e;b++){var h=this.m_PolyOuts[b];null===h.Pts||h.IsOpen||(h.IsHole^this.ReverseSolution)==0<this.Area(h)&&this.ReversePolyPtLinks(h.Pts)}this.JoinCommonEdges();
b=0;for(e=this.m_PolyOuts.length;b<e;b++)h=this.m_PolyOuts[b],null===h.Pts||h.IsOpen||this.FixupOutPolygon(h);this.StrictlySimple&&this.DoSimplePolygons();return!0}finally{f.Clear(this.m_Joins),f.Clear(this.m_GhostJoins)}};f.Clipper.prototype.PopScanbeam=function(){var b=this.m_Scanbeam.Y;this.m_Scanbeam=this.m_Scanbeam.Next;return b};f.Clipper.prototype.DisposeAllPolyPts=function(){for(var b=0,c=this.m_PolyOuts.length;b<c;++b)this.DisposeOutRec(b);f.Clear(this.m_PolyOuts)};f.Clipper.prototype.DisposeOutRec=
function(b){var c=this.m_PolyOuts[b];null!==c.Pts&&this.DisposeOutPts(c.Pts);this.m_PolyOuts[b]=null};f.Clipper.prototype.DisposeOutPts=function(b){if(null!==b)for(b.Prev.Next=null;null!==b;)b=b.Next};f.Clipper.prototype.AddJoin=function(b,c,e){var h=new f.Join;h.OutPt1=b;h.OutPt2=c;h.OffPt.X=e.X;h.OffPt.Y=e.Y;this.m_Joins.push(h)};f.Clipper.prototype.AddGhostJoin=function(b,c){var e=new f.Join;e.OutPt1=b;e.OffPt.X=c.X;e.OffPt.Y=c.Y;this.m_GhostJoins.push(e)};f.Clipper.prototype.InsertLocalMinimaIntoAEL=
function(b){for(;null!==this.m_CurrentLM&&this.m_CurrentLM.Y==b;){var c=this.m_CurrentLM.LeftBound,e=this.m_CurrentLM.RightBound;this.PopLocalMinima();var h=null;null===c?(this.InsertEdgeIntoAEL(e,null),this.SetWindingCount(e),this.IsContributing(e)&&(h=this.AddOutPt(e,e.Bot))):(null==e?(this.InsertEdgeIntoAEL(c,null),this.SetWindingCount(c),this.IsContributing(c)&&(h=this.AddOutPt(c,c.Bot))):(this.InsertEdgeIntoAEL(c,null),this.InsertEdgeIntoAEL(e,c),this.SetWindingCount(c),e.WindCnt=c.WindCnt,e.WindCnt2=
c.WindCnt2,this.IsContributing(c)&&(h=this.AddLocalMinPoly(c,e,c.Bot))),this.InsertScanbeam(c.Top.Y));null!=e&&(f.ClipperBase.IsHorizontal(e)?this.AddEdgeToSEL(e):this.InsertScanbeam(e.Top.Y));if(null!=c&&null!=e){if(null!==h&&f.ClipperBase.IsHorizontal(e)&&0<this.m_GhostJoins.length&&0!==e.WindDelta)for(var q=0,p=this.m_GhostJoins.length;q<p;q++){var E=this.m_GhostJoins[q];this.HorzSegmentsOverlap(E.OutPt1.Pt,E.OffPt,e.Bot,e.Top)&&this.AddJoin(E.OutPt1,h,E.OffPt)}0<=c.OutIdx&&null!==c.PrevInAEL&&
c.PrevInAEL.Curr.X==c.Bot.X&&0<=c.PrevInAEL.OutIdx&&f.ClipperBase.SlopesEqual(c.PrevInAEL,c,this.m_UseFullRange)&&0!==c.WindDelta&&0!==c.PrevInAEL.WindDelta&&(q=this.AddOutPt(c.PrevInAEL,c.Bot),this.AddJoin(h,q,c.Top));if(c.NextInAEL!=e&&(0<=e.OutIdx&&0<=e.PrevInAEL.OutIdx&&f.ClipperBase.SlopesEqual(e.PrevInAEL,e,this.m_UseFullRange)&&0!==e.WindDelta&&0!==e.PrevInAEL.WindDelta&&(q=this.AddOutPt(e.PrevInAEL,e.Bot),this.AddJoin(h,q,e.Top)),h=c.NextInAEL,null!==h))for(;h!=e;)this.IntersectEdges(e,h,
c.Curr,!1),h=h.NextInAEL}}};f.Clipper.prototype.InsertEdgeIntoAEL=function(b,c){if(null===this.m_ActiveEdges)b.PrevInAEL=null,b.NextInAEL=null,this.m_ActiveEdges=b;else if(null===c&&this.E2InsertsBeforeE1(this.m_ActiveEdges,b))b.PrevInAEL=null,b.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges=this.m_ActiveEdges.PrevInAEL=b;else{for(null===c&&(c=this.m_ActiveEdges);null!==c.NextInAEL&&!this.E2InsertsBeforeE1(c.NextInAEL,b);)c=c.NextInAEL;b.NextInAEL=c.NextInAEL;null!==c.NextInAEL&&(c.NextInAEL.PrevInAEL=
b);b.PrevInAEL=c;c.NextInAEL=b}};f.Clipper.prototype.E2InsertsBeforeE1=function(b,c){return c.Curr.X==b.Curr.X?c.Top.Y>b.Top.Y?c.Top.X<f.Clipper.TopX(b,c.Top.Y):b.Top.X>f.Clipper.TopX(c,b.Top.Y):c.Curr.X<b.Curr.X};f.Clipper.prototype.IsEvenOddFillType=function(b){return b.PolyTyp==f.PolyType.ptSubject?this.m_SubjFillType==f.PolyFillType.pftEvenOdd:this.m_ClipFillType==f.PolyFillType.pftEvenOdd};f.Clipper.prototype.IsEvenOddAltFillType=function(b){return b.PolyTyp==f.PolyType.ptSubject?this.m_ClipFillType==
f.PolyFillType.pftEvenOdd:this.m_SubjFillType==f.PolyFillType.pftEvenOdd};f.Clipper.prototype.IsContributing=function(b){var c,e;b.PolyTyp==f.PolyType.ptSubject?(c=this.m_SubjFillType,e=this.m_ClipFillType):(c=this.m_ClipFillType,e=this.m_SubjFillType);switch(c){case f.PolyFillType.pftEvenOdd:if(0===b.WindDelta&&1!=b.WindCnt)return!1;break;case f.PolyFillType.pftNonZero:if(1!=Math.abs(b.WindCnt))return!1;break;case f.PolyFillType.pftPositive:if(1!=b.WindCnt)return!1;break;default:if(-1!=b.WindCnt)return!1}switch(this.m_ClipType){case f.ClipType.ctIntersection:switch(e){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0!==
b.WindCnt2;case f.PolyFillType.pftPositive:return 0<b.WindCnt2;default:return 0>b.WindCnt2}case f.ClipType.ctUnion:switch(e){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0===b.WindCnt2;case f.PolyFillType.pftPositive:return 0>=b.WindCnt2;default:return 0<=b.WindCnt2}case f.ClipType.ctDifference:if(b.PolyTyp==f.PolyType.ptSubject)switch(e){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0===b.WindCnt2;case f.PolyFillType.pftPositive:return 0>=b.WindCnt2;
default:return 0<=b.WindCnt2}else switch(e){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0!==b.WindCnt2;case f.PolyFillType.pftPositive:return 0<b.WindCnt2;default:return 0>b.WindCnt2}case f.ClipType.ctXor:if(0===b.WindDelta)switch(e){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0===b.WindCnt2;case f.PolyFillType.pftPositive:return 0>=b.WindCnt2;default:return 0<=b.WindCnt2}}return!0};f.Clipper.prototype.SetWindingCount=function(b){for(var c=b.PrevInAEL;null!==
c&&(c.PolyTyp!=b.PolyTyp||0===c.WindDelta);)c=c.PrevInAEL;if(null===c)b.WindCnt=0===b.WindDelta?1:b.WindDelta,b.WindCnt2=0,c=this.m_ActiveEdges;else{if(0===b.WindDelta&&this.m_ClipType!=f.ClipType.ctUnion)b.WindCnt=1;else if(this.IsEvenOddFillType(b))if(0===b.WindDelta){for(var e=!0,h=c.PrevInAEL;null!==h;)h.PolyTyp==c.PolyTyp&&0!==h.WindDelta&&(e=!e),h=h.PrevInAEL;b.WindCnt=e?0:1}else b.WindCnt=b.WindDelta;else 0>c.WindCnt*c.WindDelta?1<Math.abs(c.WindCnt)?b.WindCnt=0>c.WindDelta*b.WindDelta?c.WindCnt:
c.WindCnt+b.WindDelta:b.WindCnt=0===b.WindDelta?1:b.WindDelta:b.WindCnt=0===b.WindDelta?0>c.WindCnt?c.WindCnt-1:c.WindCnt+1:0>c.WindDelta*b.WindDelta?c.WindCnt:c.WindCnt+b.WindDelta;b.WindCnt2=c.WindCnt2;c=c.NextInAEL}if(this.IsEvenOddAltFillType(b))for(;c!=b;)0!==c.WindDelta&&(b.WindCnt2=0===b.WindCnt2?1:0),c=c.NextInAEL;else for(;c!=b;)b.WindCnt2+=c.WindDelta,c=c.NextInAEL};f.Clipper.prototype.AddEdgeToSEL=function(b){null===this.m_SortedEdges?(this.m_SortedEdges=b,b.PrevInSEL=null,b.NextInSEL=
null):(b.NextInSEL=this.m_SortedEdges,b.PrevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.PrevInSEL=b)};f.Clipper.prototype.CopyAELToSEL=function(){var b=this.m_ActiveEdges;for(this.m_SortedEdges=b;null!==b;)b.PrevInSEL=b.PrevInAEL,b=b.NextInSEL=b.NextInAEL};f.Clipper.prototype.SwapPositionsInAEL=function(b,c){if(b.NextInAEL!=b.PrevInAEL&&c.NextInAEL!=c.PrevInAEL){if(b.NextInAEL==c){var e=c.NextInAEL;null!==e&&(e.PrevInAEL=b);var h=b.PrevInAEL;null!==h&&(h.NextInAEL=c);c.PrevInAEL=h;c.NextInAEL=
b;b.PrevInAEL=c;b.NextInAEL=e}else c.NextInAEL==b?(e=b.NextInAEL,null!==e&&(e.PrevInAEL=c),h=c.PrevInAEL,null!==h&&(h.NextInAEL=b),b.PrevInAEL=h,b.NextInAEL=c,c.PrevInAEL=b,c.NextInAEL=e):(e=b.NextInAEL,h=b.PrevInAEL,b.NextInAEL=c.NextInAEL,null!==b.NextInAEL&&(b.NextInAEL.PrevInAEL=b),b.PrevInAEL=c.PrevInAEL,null!==b.PrevInAEL&&(b.PrevInAEL.NextInAEL=b),c.NextInAEL=e,null!==c.NextInAEL&&(c.NextInAEL.PrevInAEL=c),c.PrevInAEL=h,null!==c.PrevInAEL&&(c.PrevInAEL.NextInAEL=c));null===b.PrevInAEL?this.m_ActiveEdges=
b:null===c.PrevInAEL&&(this.m_ActiveEdges=c)}};f.Clipper.prototype.SwapPositionsInSEL=function(b,c){if(null!==b.NextInSEL||null!==b.PrevInSEL)if(null!==c.NextInSEL||null!==c.PrevInSEL){if(b.NextInSEL==c){var e=c.NextInSEL;null!==e&&(e.PrevInSEL=b);var h=b.PrevInSEL;null!==h&&(h.NextInSEL=c);c.PrevInSEL=h;c.NextInSEL=b;b.PrevInSEL=c;b.NextInSEL=e}else c.NextInSEL==b?(e=b.NextInSEL,null!==e&&(e.PrevInSEL=c),h=c.PrevInSEL,null!==h&&(h.NextInSEL=b),b.PrevInSEL=h,b.NextInSEL=c,c.PrevInSEL=b,c.NextInSEL=
e):(e=b.NextInSEL,h=b.PrevInSEL,b.NextInSEL=c.NextInSEL,null!==b.NextInSEL&&(b.NextInSEL.PrevInSEL=b),b.PrevInSEL=c.PrevInSEL,null!==b.PrevInSEL&&(b.PrevInSEL.NextInSEL=b),c.NextInSEL=e,null!==c.NextInSEL&&(c.NextInSEL.PrevInSEL=c),c.PrevInSEL=h,null!==c.PrevInSEL&&(c.PrevInSEL.NextInSEL=c));null===b.PrevInSEL?this.m_SortedEdges=b:null===c.PrevInSEL&&(this.m_SortedEdges=c)}};f.Clipper.prototype.AddLocalMaxPoly=function(b,c,e){this.AddOutPt(b,e);0==c.WindDelta&&this.AddOutPt(c,e);b.OutIdx==c.OutIdx?
(b.OutIdx=-1,c.OutIdx=-1):b.OutIdx<c.OutIdx?this.AppendPolygon(b,c):this.AppendPolygon(c,b)};f.Clipper.prototype.AddLocalMinPoly=function(b,c,e){var h,q;f.ClipperBase.IsHorizontal(c)||b.Dx>c.Dx?(h=this.AddOutPt(b,e),c.OutIdx=b.OutIdx,b.Side=f.EdgeSide.esLeft,c.Side=f.EdgeSide.esRight,q=b,b=q.PrevInAEL==c?c.PrevInAEL:q.PrevInAEL):(h=this.AddOutPt(c,e),b.OutIdx=c.OutIdx,b.Side=f.EdgeSide.esRight,c.Side=f.EdgeSide.esLeft,q=c,b=q.PrevInAEL==b?b.PrevInAEL:q.PrevInAEL);null!==b&&0<=b.OutIdx&&f.Clipper.TopX(b,
e.Y)==f.Clipper.TopX(q,e.Y)&&f.ClipperBase.SlopesEqual(q,b,this.m_UseFullRange)&&0!==q.WindDelta&&0!==b.WindDelta&&(e=this.AddOutPt(b,e),this.AddJoin(h,e,q.Top));return h};f.Clipper.prototype.CreateOutRec=function(){var b=new f.OutRec;b.Idx=-1;b.IsHole=!1;b.IsOpen=!1;b.FirstLeft=null;b.Pts=null;b.BottomPt=null;b.PolyNode=null;this.m_PolyOuts.push(b);b.Idx=this.m_PolyOuts.length-1;return b};f.Clipper.prototype.AddOutPt=function(b,c){var e=b.Side==f.EdgeSide.esLeft;if(0>b.OutIdx){var h=this.CreateOutRec();
h.IsOpen=0===b.WindDelta;var q=new f.OutPt;h.Pts=q;q.Idx=h.Idx;q.Pt.X=c.X;q.Pt.Y=c.Y;q.Next=q;q.Prev=q;h.IsOpen||this.SetHoleState(b,h);b.OutIdx=h.Idx}else{var h=this.m_PolyOuts[b.OutIdx],p=h.Pts;if(e&&f.IntPoint.op_Equality(c,p.Pt))return p;if(!e&&f.IntPoint.op_Equality(c,p.Prev.Pt))return p.Prev;q=new f.OutPt;q.Idx=h.Idx;q.Pt.X=c.X;q.Pt.Y=c.Y;q.Next=p;q.Prev=p.Prev;q.Prev.Next=q;p.Prev=q;e&&(h.Pts=q)}return q};f.Clipper.prototype.SwapPoints=function(b,c){var e=new f.IntPoint(b.Value);b.Value.X=
c.Value.X;b.Value.Y=c.Value.Y;c.Value.X=e.X;c.Value.Y=e.Y};f.Clipper.prototype.HorzSegmentsOverlap=function(b,c,e,h){return b.X>e.X==b.X<h.X?!0:c.X>e.X==c.X<h.X?!0:e.X>b.X==e.X<c.X?!0:h.X>b.X==h.X<c.X?!0:b.X==e.X&&c.X==h.X?!0:b.X==h.X&&c.X==e.X?!0:!1};f.Clipper.prototype.InsertPolyPtBetween=function(b,c,e){var h=new f.OutPt;h.Pt.X=e.X;h.Pt.Y=e.Y;c==b.Next?(b.Next=h,c.Prev=h,h.Next=c,h.Prev=b):(c.Next=h,b.Prev=h,h.Next=b,h.Prev=c);return h};f.Clipper.prototype.SetHoleState=function(b,c){for(var e=
!1,h=b.PrevInAEL;null!==h;)0<=h.OutIdx&&0!=h.WindDelta&&(e=!e,null===c.FirstLeft&&(c.FirstLeft=this.m_PolyOuts[h.OutIdx])),h=h.PrevInAEL;e&&(c.IsHole=!0)};f.Clipper.prototype.GetDx=function(b,c){return b.Y==c.Y?f.ClipperBase.horizontal:(c.X-b.X)/(c.Y-b.Y)};f.Clipper.prototype.FirstIsBottomPt=function(b,c){for(var e=b.Prev;f.IntPoint.op_Equality(e.Pt,b.Pt)&&e!=b;)e=e.Prev;for(var h=Math.abs(this.GetDx(b.Pt,e.Pt)),e=b.Next;f.IntPoint.op_Equality(e.Pt,b.Pt)&&e!=b;)e=e.Next;for(var q=Math.abs(this.GetDx(b.Pt,
e.Pt)),e=c.Prev;f.IntPoint.op_Equality(e.Pt,c.Pt)&&e!=c;)e=e.Prev;for(var p=Math.abs(this.GetDx(c.Pt,e.Pt)),e=c.Next;f.IntPoint.op_Equality(e.Pt,c.Pt)&&e!=c;)e=e.Next;e=Math.abs(this.GetDx(c.Pt,e.Pt));return h>=p&&h>=e||q>=p&&q>=e};f.Clipper.prototype.GetBottomPt=function(b){for(var c=null,e=b.Next;e!=b;)e.Pt.Y>b.Pt.Y?(b=e,c=null):e.Pt.Y==b.Pt.Y&&e.Pt.X<=b.Pt.X&&(e.Pt.X<b.Pt.X?(c=null,b=e):e.Next!=b&&e.Prev!=b&&(c=e)),e=e.Next;if(null!==c)for(;c!=e;)for(this.FirstIsBottomPt(e,c)||(b=c),c=c.Next;f.IntPoint.op_Inequality(c.Pt,
b.Pt);)c=c.Next;return b};f.Clipper.prototype.GetLowermostRec=function(b,c){null===b.BottomPt&&(b.BottomPt=this.GetBottomPt(b.Pts));null===c.BottomPt&&(c.BottomPt=this.GetBottomPt(c.Pts));var e=b.BottomPt,h=c.BottomPt;return e.Pt.Y>h.Pt.Y?b:e.Pt.Y<h.Pt.Y?c:e.Pt.X<h.Pt.X?b:e.Pt.X>h.Pt.X?c:e.Next==e?c:h.Next==h?b:this.FirstIsBottomPt(e,h)?b:c};f.Clipper.prototype.Param1RightOfParam2=function(b,c){do if(b=b.FirstLeft,b==c)return!0;while(null!==b);return!1};f.Clipper.prototype.GetOutRec=function(b){for(b=
this.m_PolyOuts[b];b!=this.m_PolyOuts[b.Idx];)b=this.m_PolyOuts[b.Idx];return b};f.Clipper.prototype.AppendPolygon=function(b,c){var e=this.m_PolyOuts[b.OutIdx],h=this.m_PolyOuts[c.OutIdx],q;q=this.Param1RightOfParam2(e,h)?h:this.Param1RightOfParam2(h,e)?e:this.GetLowermostRec(e,h);var p=e.Pts,E=p.Prev,l=h.Pts,x=l.Prev;b.Side==f.EdgeSide.esLeft?(c.Side==f.EdgeSide.esLeft?(this.ReversePolyPtLinks(l),l.Next=p,p.Prev=l,E.Next=x,x.Prev=E,e.Pts=x):(x.Next=p,p.Prev=x,l.Prev=E,E.Next=l,e.Pts=l),p=f.EdgeSide.esLeft):
(c.Side==f.EdgeSide.esRight?(this.ReversePolyPtLinks(l),E.Next=x,x.Prev=E,l.Next=p,p.Prev=l):(E.Next=l,l.Prev=E,p.Prev=x,x.Next=p),p=f.EdgeSide.esRight);e.BottomPt=null;q==h&&(h.FirstLeft!=e&&(e.FirstLeft=h.FirstLeft),e.IsHole=h.IsHole);h.Pts=null;h.BottomPt=null;h.FirstLeft=e;q=b.OutIdx;E=c.OutIdx;b.OutIdx=-1;c.OutIdx=-1;for(l=this.m_ActiveEdges;null!==l;){if(l.OutIdx==E){l.OutIdx=q;l.Side=p;break}l=l.NextInAEL}h.Idx=e.Idx};f.Clipper.prototype.ReversePolyPtLinks=function(b){if(null!==b){var c,e;
c=b;do e=c.Next,c.Next=c.Prev,c=c.Prev=e;while(c!=b)}};f.Clipper.SwapSides=function(b,c){var e=b.Side;b.Side=c.Side;c.Side=e};f.Clipper.SwapPolyIndexes=function(b,c){var e=b.OutIdx;b.OutIdx=c.OutIdx;c.OutIdx=e};f.Clipper.prototype.IntersectEdges=function(b,c,e,h){var q=!h&&null===b.NextInLML&&b.Top.X==e.X&&b.Top.Y==e.Y;h=!h&&null===c.NextInLML&&c.Top.X==e.X&&c.Top.Y==e.Y;var p=0<=b.OutIdx,l=0<=c.OutIdx;if(0===b.WindDelta||0===c.WindDelta)0===b.WindDelta&&0===c.WindDelta?(q||h)&&p&&l&&this.AddLocalMaxPoly(b,
c,e):b.PolyTyp==c.PolyTyp&&b.WindDelta!=c.WindDelta&&this.m_ClipType==f.ClipType.ctUnion?0===b.WindDelta?l&&(this.AddOutPt(b,e),p&&(b.OutIdx=-1)):p&&(this.AddOutPt(c,e),l&&(c.OutIdx=-1)):b.PolyTyp!=c.PolyTyp&&(0!==b.WindDelta||1!=Math.abs(c.WindCnt)||this.m_ClipType==f.ClipType.ctUnion&&0!==c.WindCnt2?0!==c.WindDelta||1!=Math.abs(b.WindCnt)||this.m_ClipType==f.ClipType.ctUnion&&0!==b.WindCnt2||(this.AddOutPt(c,e),l&&(c.OutIdx=-1)):(this.AddOutPt(b,e),p&&(b.OutIdx=-1))),q&&(0>b.OutIdx?this.DeleteFromAEL(b):
f.Error("Error intersecting polylines")),h&&(0>c.OutIdx?this.DeleteFromAEL(c):f.Error("Error intersecting polylines"));else{if(b.PolyTyp==c.PolyTyp)if(this.IsEvenOddFillType(b)){var r=b.WindCnt;b.WindCnt=c.WindCnt;c.WindCnt=r}else b.WindCnt=0===b.WindCnt+c.WindDelta?-b.WindCnt:b.WindCnt+c.WindDelta,c.WindCnt=0===c.WindCnt-b.WindDelta?-c.WindCnt:c.WindCnt-b.WindDelta;else this.IsEvenOddFillType(c)?b.WindCnt2=0===b.WindCnt2?1:0:b.WindCnt2+=c.WindDelta,this.IsEvenOddFillType(b)?c.WindCnt2=0===c.WindCnt2?
1:0:c.WindCnt2-=b.WindDelta;var x,G,I;b.PolyTyp==f.PolyType.ptSubject?(x=this.m_SubjFillType,I=this.m_ClipFillType):(x=this.m_ClipFillType,I=this.m_SubjFillType);c.PolyTyp==f.PolyType.ptSubject?(G=this.m_SubjFillType,r=this.m_ClipFillType):(G=this.m_ClipFillType,r=this.m_SubjFillType);switch(x){case f.PolyFillType.pftPositive:x=b.WindCnt;break;case f.PolyFillType.pftNegative:x=-b.WindCnt;break;default:x=Math.abs(b.WindCnt)}switch(G){case f.PolyFillType.pftPositive:G=c.WindCnt;break;case f.PolyFillType.pftNegative:G=
-c.WindCnt;break;default:G=Math.abs(c.WindCnt)}if(p&&l)q||h||0!==x&&1!=x||0!==G&&1!=G||b.PolyTyp!=c.PolyTyp&&this.m_ClipType!=f.ClipType.ctXor?this.AddLocalMaxPoly(b,c,e):(this.AddOutPt(b,e),this.AddOutPt(c,e),f.Clipper.SwapSides(b,c),f.Clipper.SwapPolyIndexes(b,c));else if(p){if(0===G||1==G)this.AddOutPt(b,e),f.Clipper.SwapSides(b,c),f.Clipper.SwapPolyIndexes(b,c)}else if(l){if(0===x||1==x)this.AddOutPt(c,e),f.Clipper.SwapSides(b,c),f.Clipper.SwapPolyIndexes(b,c)}else if(!(0!==x&&1!=x||0!==G&&1!=
G||q||h)){switch(I){case f.PolyFillType.pftPositive:p=b.WindCnt2;break;case f.PolyFillType.pftNegative:p=-b.WindCnt2;break;default:p=Math.abs(b.WindCnt2)}switch(r){case f.PolyFillType.pftPositive:l=c.WindCnt2;break;case f.PolyFillType.pftNegative:l=-c.WindCnt2;break;default:l=Math.abs(c.WindCnt2)}if(b.PolyTyp!=c.PolyTyp)this.AddLocalMinPoly(b,c,e);else if(1==x&&1==G)switch(this.m_ClipType){case f.ClipType.ctIntersection:0<p&&0<l&&this.AddLocalMinPoly(b,c,e);break;case f.ClipType.ctUnion:0>=p&&0>=
l&&this.AddLocalMinPoly(b,c,e);break;case f.ClipType.ctDifference:(b.PolyTyp==f.PolyType.ptClip&&0<p&&0<l||b.PolyTyp==f.PolyType.ptSubject&&0>=p&&0>=l)&&this.AddLocalMinPoly(b,c,e);break;case f.ClipType.ctXor:this.AddLocalMinPoly(b,c,e)}else f.Clipper.SwapSides(b,c)}q!=h&&(q&&0<=b.OutIdx||h&&0<=c.OutIdx)&&(f.Clipper.SwapSides(b,c),f.Clipper.SwapPolyIndexes(b,c));q&&this.DeleteFromAEL(b);h&&this.DeleteFromAEL(c)}};f.Clipper.prototype.DeleteFromAEL=function(b){var c=b.PrevInAEL,e=b.NextInAEL;if(null!==
c||null!==e||b==this.m_ActiveEdges)null!==c?c.NextInAEL=e:this.m_ActiveEdges=e,null!==e&&(e.PrevInAEL=c),b.NextInAEL=null,b.PrevInAEL=null};f.Clipper.prototype.DeleteFromSEL=function(b){var c=b.PrevInSEL,e=b.NextInSEL;if(null!==c||null!==e||b==this.m_SortedEdges)null!==c?c.NextInSEL=e:this.m_SortedEdges=e,null!==e&&(e.PrevInSEL=c),b.NextInSEL=null,b.PrevInSEL=null};f.Clipper.prototype.UpdateEdgeIntoAEL=function(b){null===b.Value.NextInLML&&f.Error("UpdateEdgeIntoAEL: invalid call");var c=b.Value.PrevInAEL,
e=b.Value.NextInAEL;b.Value.NextInLML.OutIdx=b.Value.OutIdx;null!==c?c.NextInAEL=b.Value.NextInLML:this.m_ActiveEdges=b.Value.NextInLML;null!==e&&(e.PrevInAEL=b.Value.NextInLML);b.Value.NextInLML.Side=b.Value.Side;b.Value.NextInLML.WindDelta=b.Value.WindDelta;b.Value.NextInLML.WindCnt=b.Value.WindCnt;b.Value.NextInLML.WindCnt2=b.Value.WindCnt2;b.Value=b.Value.NextInLML;b.Value.Curr.X=b.Value.Bot.X;b.Value.Curr.Y=b.Value.Bot.Y;b.Value.PrevInAEL=c;b.Value.NextInAEL=e;f.ClipperBase.IsHorizontal(b.Value)||
this.InsertScanbeam(b.Value.Top.Y)};f.Clipper.prototype.ProcessHorizontals=function(b){for(var c=this.m_SortedEdges;null!==c;)this.DeleteFromSEL(c),this.ProcessHorizontal(c,b),c=this.m_SortedEdges};f.Clipper.prototype.GetHorzDirection=function(b,c,e,h){b.Bot.X<b.Top.X?(e.Value=b.Bot.X,h.Value=b.Top.X,c.Value=f.Direction.dLeftToRight):(e.Value=b.Top.X,h.Value=b.Bot.X,c.Value=f.Direction.dRightToLeft)};f.Clipper.prototype.PrepareHorzJoins=function(b,c){var e=this.m_PolyOuts[b.OutIdx].Pts;b.Side!=f.EdgeSide.esLeft&&
(e=e.Prev);for(var h=0,q=this.m_GhostJoins.length;h<q;++h){var p=this.m_GhostJoins[h];this.HorzSegmentsOverlap(p.OutPt1.Pt,p.OffPt,b.Bot,b.Top)&&this.AddJoin(p.OutPt1,e,p.OffPt)}c&&(f.IntPoint.op_Equality(e.Pt,b.Top)?this.AddGhostJoin(e,b.Bot):this.AddGhostJoin(e,b.Top))};f.Clipper.prototype.ProcessHorizontal=function(b,c){var e,h,q;(function(){e={Value:e};h={Value:h};q={Value:q};var c=this.GetHorzDirection(b,e,h,q);e=e.Value;h=h.Value;q=q.Value;return c}).call(this);for(var p=b,l=null;null!==p.NextInLML&&
f.ClipperBase.IsHorizontal(p.NextInLML);)p=p.NextInLML;for(null===p.NextInLML&&(l=this.GetMaximaPair(p));;){for(var r=b==p,x=this.GetNextInAEL(b,e);null!==x&&!(x.Curr.X==b.Top.X&&null!==b.NextInLML&&x.Dx<b.NextInLML.Dx);){var G=this.GetNextInAEL(x,e);if(e==f.Direction.dLeftToRight&&x.Curr.X<=q||e==f.Direction.dRightToLeft&&x.Curr.X>=h){0<=b.OutIdx&&0!=b.WindDelta&&this.PrepareHorzJoins(b,c);if(x==l&&r){e==f.Direction.dLeftToRight?this.IntersectEdges(b,x,x.Top,!1):this.IntersectEdges(x,b,x.Top,!1);
0<=l.OutIdx&&f.Error("ProcessHorizontal error");return}if(e==f.Direction.dLeftToRight){var I=new f.IntPoint(x.Curr.X,b.Curr.Y);this.IntersectEdges(b,x,I,!0)}else I=new f.IntPoint(x.Curr.X,b.Curr.Y),this.IntersectEdges(x,b,I,!0);this.SwapPositionsInAEL(b,x)}else if(e==f.Direction.dLeftToRight&&x.Curr.X>=q||e==f.Direction.dRightToLeft&&x.Curr.X<=h)break;x=G}0<=b.OutIdx&&0!==b.WindDelta&&this.PrepareHorzJoins(b,c);if(null!==b.NextInLML&&f.ClipperBase.IsHorizontal(b.NextInLML))(function(){b={Value:b};
var c=this.UpdateEdgeIntoAEL(b);b=b.Value;return c}).call(this),0<=b.OutIdx&&this.AddOutPt(b,b.Bot),function(){e={Value:e};h={Value:h};q={Value:q};var c=this.GetHorzDirection(b,e,h,q);e=e.Value;h=h.Value;q=q.Value;return c}.call(this);else break}null!==b.NextInLML?0<=b.OutIdx?(p=this.AddOutPt(b,b.Top),function(){b={Value:b};var c=this.UpdateEdgeIntoAEL(b);b=b.Value;return c}.call(this),0!==b.WindDelta&&(l=b.PrevInAEL,G=b.NextInAEL,null!==l&&l.Curr.X==b.Bot.X&&l.Curr.Y==b.Bot.Y&&0!==l.WindDelta&&0<=
l.OutIdx&&l.Curr.Y>l.Top.Y&&f.ClipperBase.SlopesEqual(b,l,this.m_UseFullRange)?(G=this.AddOutPt(l,b.Bot),this.AddJoin(p,G,b.Top)):null!==G&&G.Curr.X==b.Bot.X&&G.Curr.Y==b.Bot.Y&&0!==G.WindDelta&&0<=G.OutIdx&&G.Curr.Y>G.Top.Y&&f.ClipperBase.SlopesEqual(b,G,this.m_UseFullRange)&&(G=this.AddOutPt(G,b.Bot),this.AddJoin(p,G,b.Top)))):function(){b={Value:b};var c=this.UpdateEdgeIntoAEL(b);b=b.Value;return c}.call(this):null!==l?0<=l.OutIdx?(e==f.Direction.dLeftToRight?this.IntersectEdges(b,l,b.Top,!1):
this.IntersectEdges(l,b,b.Top,!1),0<=l.OutIdx&&f.Error("ProcessHorizontal error")):(this.DeleteFromAEL(b),this.DeleteFromAEL(l)):(0<=b.OutIdx&&this.AddOutPt(b,b.Top),this.DeleteFromAEL(b))};f.Clipper.prototype.GetNextInAEL=function(b,c){return c==f.Direction.dLeftToRight?b.NextInAEL:b.PrevInAEL};f.Clipper.prototype.IsMinima=function(b){return null!==b&&b.Prev.NextInLML!=b&&b.Next.NextInLML!=b};f.Clipper.prototype.IsMaxima=function(b,c){return null!==b&&b.Top.Y==c&&null===b.NextInLML};f.Clipper.prototype.IsIntermediate=
function(b,c){return b.Top.Y==c&&null!==b.NextInLML};f.Clipper.prototype.GetMaximaPair=function(b){var c=null;f.IntPoint.op_Equality(b.Next.Top,b.Top)&&null===b.Next.NextInLML?c=b.Next:f.IntPoint.op_Equality(b.Prev.Top,b.Top)&&null===b.Prev.NextInLML&&(c=b.Prev);return null===c||-2!=c.OutIdx&&(c.NextInAEL!=c.PrevInAEL||f.ClipperBase.IsHorizontal(c))?c:null};f.Clipper.prototype.ProcessIntersections=function(b,c){if(null==this.m_ActiveEdges)return!0;try{this.BuildIntersectList(b,c);if(0==this.m_IntersectList.length)return!0;
if(1==this.m_IntersectList.length||this.FixupIntersectionOrder())this.ProcessIntersectList();else return!1}catch(e){this.m_SortedEdges=null,this.m_IntersectList.length=0,f.Error("ProcessIntersections error")}this.m_SortedEdges=null;return!0};f.Clipper.prototype.BuildIntersectList=function(b,c){if(null!==this.m_ActiveEdges){var e=this.m_ActiveEdges;for(this.m_SortedEdges=e;null!==e;)e.PrevInSEL=e.PrevInAEL,e.NextInSEL=e.NextInAEL,e.Curr.X=f.Clipper.TopX(e,c),e=e.NextInAEL;for(var h=!0;h&&null!==this.m_SortedEdges;){h=
!1;for(e=this.m_SortedEdges;null!==e.NextInSEL;){var q=e.NextInSEL,p=new f.IntPoint;e.Curr.X>q.Curr.X?(p={Value:p},h=this.IntersectPoint(e,q,p),p=p.Value,!h&&e.Curr.X>q.Curr.X+1&&f.Error("Intersection error"),p.Y>b&&(p.Y=b,Math.abs(e.Dx)>Math.abs(q.Dx)?p.X=f.Clipper.TopX(q,b):p.X=f.Clipper.TopX(e,b)),h=new f.IntersectNode,h.Edge1=e,h.Edge2=q,h.Pt.X=p.X,h.Pt.Y=p.Y,this.m_IntersectList.push(h),this.SwapPositionsInSEL(e,q),h=!0):e=q}if(null!==e.PrevInSEL)e.PrevInSEL.NextInSEL=null;else break}this.m_SortedEdges=
null}};f.Clipper.prototype.EdgesAdjacent=function(b){return b.Edge1.NextInSEL==b.Edge2||b.Edge1.PrevInSEL==b.Edge2};f.Clipper.IntersectNodeSort=function(b,c){return c.Pt.Y-b.Pt.Y};f.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer);this.CopyAELToSEL();for(var b=this.m_IntersectList.length,c=0;c<b;c++){if(!this.EdgesAdjacent(this.m_IntersectList[c])){for(var e=c+1;e<b&&!this.EdgesAdjacent(this.m_IntersectList[e]);)e++;if(e==b)return!1;var h=
this.m_IntersectList[c];this.m_IntersectList[c]=this.m_IntersectList[e];this.m_IntersectList[e]=h}this.SwapPositionsInSEL(this.m_IntersectList[c].Edge1,this.m_IntersectList[c].Edge2)}return!0};f.Clipper.prototype.ProcessIntersectList=function(){for(var b=0,c=this.m_IntersectList.length;b<c;b++){var e=this.m_IntersectList[b];this.IntersectEdges(e.Edge1,e.Edge2,e.Pt,!0);this.SwapPositionsInAEL(e.Edge1,e.Edge2)}this.m_IntersectList.length=0};Oa=function(b){return 0>b?Math.ceil(b-.5):Math.round(b)};Da=
function(b){return 0>b?Math.ceil(b-.5):Math.floor(b+.5)};Pa=function(b){return 0>b?-Math.round(Math.abs(b)):Math.round(b)};Ea=function(b){if(0>b)return b-=.5,-2147483648>b?Math.ceil(b):b|0;b+=.5;return 2147483647<b?Math.floor(b):b|0};f.Clipper.Round=R?Oa:Ua?Pa:ya?Ea:Da;f.Clipper.TopX=function(b,c){return c==b.Top.Y?b.Top.X:b.Bot.X+f.Clipper.Round(b.Dx*(c-b.Bot.Y))};f.Clipper.prototype.IntersectPoint=function(b,c,e){e.Value=new f.IntPoint;var h,q;if(f.ClipperBase.SlopesEqual(b,c,this.m_UseFullRange)||
b.Dx==c.Dx)return c.Bot.Y>b.Bot.Y?(e.Value.X=c.Bot.X,e.Value.Y=c.Bot.Y):(e.Value.X=b.Bot.X,e.Value.Y=b.Bot.Y),!1;if(0===b.Delta.X)e.Value.X=b.Bot.X,f.ClipperBase.IsHorizontal(c)?e.Value.Y=c.Bot.Y:(q=c.Bot.Y-c.Bot.X/c.Dx,e.Value.Y=f.Clipper.Round(e.Value.X/c.Dx+q));else if(0===c.Delta.X)e.Value.X=c.Bot.X,f.ClipperBase.IsHorizontal(b)?e.Value.Y=b.Bot.Y:(h=b.Bot.Y-b.Bot.X/b.Dx,e.Value.Y=f.Clipper.Round(e.Value.X/b.Dx+h));else{h=b.Bot.X-b.Bot.Y*b.Dx;q=c.Bot.X-c.Bot.Y*c.Dx;var p=(q-h)/(b.Dx-c.Dx);e.Value.Y=
f.Clipper.Round(p);Math.abs(b.Dx)<Math.abs(c.Dx)?e.Value.X=f.Clipper.Round(b.Dx*p+h):e.Value.X=f.Clipper.Round(c.Dx*p+q)}if(e.Value.Y<b.Top.Y||e.Value.Y<c.Top.Y){if(b.Top.Y>c.Top.Y)return e.Value.Y=b.Top.Y,e.Value.X=f.Clipper.TopX(c,b.Top.Y),e.Value.X<b.Top.X;e.Value.Y=c.Top.Y;Math.abs(b.Dx)<Math.abs(c.Dx)?e.Value.X=f.Clipper.TopX(b,e.Value.Y):e.Value.X=f.Clipper.TopX(c,e.Value.Y)}return!0};f.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(b){for(var c=this.m_ActiveEdges;null!==c;){var e=this.IsMaxima(c,
b);e&&(e=this.GetMaximaPair(c),e=null===e||!f.ClipperBase.IsHorizontal(e));if(e){var h=c.PrevInAEL;this.DoMaxima(c);c=null===h?this.m_ActiveEdges:h.NextInAEL}else this.IsIntermediate(c,b)&&f.ClipperBase.IsHorizontal(c.NextInLML)?(function(){c={Value:c};var b=this.UpdateEdgeIntoAEL(c);c=c.Value;return b}.call(this),0<=c.OutIdx&&this.AddOutPt(c,c.Bot),this.AddEdgeToSEL(c)):(c.Curr.X=f.Clipper.TopX(c,b),c.Curr.Y=b),this.StrictlySimple&&(h=c.PrevInAEL,0<=c.OutIdx&&0!==c.WindDelta&&null!==h&&0<=h.OutIdx&&
h.Curr.X==c.Curr.X&&0!==h.WindDelta&&(e=this.AddOutPt(h,c.Curr),h=this.AddOutPt(c,c.Curr),this.AddJoin(e,h,c.Curr))),c=c.NextInAEL}this.ProcessHorizontals(!0);for(c=this.m_ActiveEdges;null!==c;){if(this.IsIntermediate(c,b)){e=null;0<=c.OutIdx&&(e=this.AddOutPt(c,c.Top));(function(){c={Value:c};var b=this.UpdateEdgeIntoAEL(c);c=c.Value;return b}).call(this);var h=c.PrevInAEL,q=c.NextInAEL;null!==h&&h.Curr.X==c.Bot.X&&h.Curr.Y==c.Bot.Y&&null!==e&&0<=h.OutIdx&&h.Curr.Y>h.Top.Y&&f.ClipperBase.SlopesEqual(c,
h,this.m_UseFullRange)&&0!==c.WindDelta&&0!==h.WindDelta?(h=this.AddOutPt(h,c.Bot),this.AddJoin(e,h,c.Top)):null!==q&&q.Curr.X==c.Bot.X&&q.Curr.Y==c.Bot.Y&&null!==e&&0<=q.OutIdx&&q.Curr.Y>q.Top.Y&&f.ClipperBase.SlopesEqual(c,q,this.m_UseFullRange)&&0!==c.WindDelta&&0!==q.WindDelta&&(h=this.AddOutPt(q,c.Bot),this.AddJoin(e,h,c.Top))}c=c.NextInAEL}};f.Clipper.prototype.DoMaxima=function(b){var c=this.GetMaximaPair(b);if(null===c)0<=b.OutIdx&&this.AddOutPt(b,b.Top),this.DeleteFromAEL(b);else{for(var e=
b.NextInAEL;null!==e&&e!=c;)this.IntersectEdges(b,e,b.Top,!0),this.SwapPositionsInAEL(b,e),e=b.NextInAEL;-1==b.OutIdx&&-1==c.OutIdx?(this.DeleteFromAEL(b),this.DeleteFromAEL(c)):0<=b.OutIdx&&0<=c.OutIdx?this.IntersectEdges(b,c,b.Top,!1):0===b.WindDelta?(0<=b.OutIdx&&(this.AddOutPt(b,b.Top),b.OutIdx=-1),this.DeleteFromAEL(b),0<=c.OutIdx&&(this.AddOutPt(c,b.Top),c.OutIdx=-1),this.DeleteFromAEL(c)):f.Error("DoMaxima error")}};f.Clipper.ReversePaths=function(b){for(var c=0,e=b.length;c<e;c++)b[c].reverse()};
f.Clipper.Orientation=function(b){return 0<=f.Clipper.Area(b)};f.Clipper.prototype.PointCount=function(b){if(null===b)return 0;var c=0,e=b;do c++,e=e.Next;while(e!=b);return c};f.Clipper.prototype.BuildResult=function(b){f.Clear(b);for(var c=0,e=this.m_PolyOuts.length;c<e;c++){var h=this.m_PolyOuts[c];if(null!==h.Pts){var h=h.Pts.Prev,q=this.PointCount(h);if(!(2>q)){for(var p=Array(q),l=0;l<q;l++)p[l]=h.Pt,h=h.Prev;b.push(p)}}}};f.Clipper.prototype.BuildResult2=function(b){b.Clear();for(var c=0,e=
this.m_PolyOuts.length;c<e;c++){var h=this.m_PolyOuts[c],q=this.PointCount(h.Pts);if(!(h.IsOpen&&2>q||!h.IsOpen&&3>q)){this.FixHoleLinkage(h);var p=new f.PolyNode;b.m_AllPolys.push(p);h.PolyNode=p;p.m_polygon.length=q;for(var h=h.Pts.Prev,l=0;l<q;l++)p.m_polygon[l]=h.Pt,h=h.Prev}}c=0;for(e=this.m_PolyOuts.length;c<e;c++)h=this.m_PolyOuts[c],null!==h.PolyNode&&(h.IsOpen?(h.PolyNode.IsOpen=!0,b.AddChild(h.PolyNode)):null!==h.FirstLeft&&null!=h.FirstLeft.PolyNode?h.FirstLeft.PolyNode.AddChild(h.PolyNode):
b.AddChild(h.PolyNode))};f.Clipper.prototype.FixupOutPolygon=function(b){var c=null;b.BottomPt=null;for(var e=b.Pts;;){if(e.Prev==e||e.Prev==e.Next){this.DisposeOutPts(e);b.Pts=null;return}if(f.IntPoint.op_Equality(e.Pt,e.Next.Pt)||f.IntPoint.op_Equality(e.Pt,e.Prev.Pt)||f.ClipperBase.SlopesEqual(e.Prev.Pt,e.Pt,e.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(e.Prev.Pt,e.Pt,e.Next.Pt)))c=null,e.Prev.Next=e.Next,e=e.Next.Prev=e.Prev;else if(e==c)break;else null===
c&&(c=e),e=e.Next}b.Pts=e};f.Clipper.prototype.DupOutPt=function(b,c){var e=new f.OutPt;e.Pt.X=b.Pt.X;e.Pt.Y=b.Pt.Y;e.Idx=b.Idx;c?(e.Next=b.Next,e.Prev=b,b.Next.Prev=e,b.Next=e):(e.Prev=b.Prev,e.Next=b,b.Prev.Next=e,b.Prev=e);return e};f.Clipper.prototype.GetOverlap=function(b,c,e,h,f,p){b<c?e<h?(f.Value=Math.max(b,e),p.Value=Math.min(c,h)):(f.Value=Math.max(b,h),p.Value=Math.min(c,e)):e<h?(f.Value=Math.max(c,e),p.Value=Math.min(b,h)):(f.Value=Math.max(c,h),p.Value=Math.min(b,e));return f.Value<p.Value};
f.Clipper.prototype.JoinHorz=function(b,c,e,h,q,p){var l=b.Pt.X>c.Pt.X?f.Direction.dRightToLeft:f.Direction.dLeftToRight;h=e.Pt.X>h.Pt.X?f.Direction.dRightToLeft:f.Direction.dLeftToRight;if(l==h)return!1;if(l==f.Direction.dLeftToRight){for(;b.Next.Pt.X<=q.X&&b.Next.Pt.X>=b.Pt.X&&b.Next.Pt.Y==q.Y;)b=b.Next;p&&b.Pt.X!=q.X&&(b=b.Next);c=this.DupOutPt(b,!p);f.IntPoint.op_Inequality(c.Pt,q)&&(b=c,b.Pt.X=q.X,b.Pt.Y=q.Y,c=this.DupOutPt(b,!p))}else{for(;b.Next.Pt.X>=q.X&&b.Next.Pt.X<=b.Pt.X&&b.Next.Pt.Y==
q.Y;)b=b.Next;p||b.Pt.X==q.X||(b=b.Next);c=this.DupOutPt(b,p);f.IntPoint.op_Inequality(c.Pt,q)&&(b=c,b.Pt.X=q.X,b.Pt.Y=q.Y,c=this.DupOutPt(b,p))}if(h==f.Direction.dLeftToRight){for(;e.Next.Pt.X<=q.X&&e.Next.Pt.X>=e.Pt.X&&e.Next.Pt.Y==q.Y;)e=e.Next;p&&e.Pt.X!=q.X&&(e=e.Next);h=this.DupOutPt(e,!p);f.IntPoint.op_Inequality(h.Pt,q)&&(e=h,e.Pt.X=q.X,e.Pt.Y=q.Y,h=this.DupOutPt(e,!p))}else{for(;e.Next.Pt.X>=q.X&&e.Next.Pt.X<=e.Pt.X&&e.Next.Pt.Y==q.Y;)e=e.Next;p||e.Pt.X==q.X||(e=e.Next);h=this.DupOutPt(e,
p);f.IntPoint.op_Inequality(h.Pt,q)&&(e=h,e.Pt.X=q.X,e.Pt.Y=q.Y,h=this.DupOutPt(e,p))}l==f.Direction.dLeftToRight==p?(b.Prev=e,e.Next=b,c.Next=h,h.Prev=c):(b.Next=e,e.Prev=b,c.Prev=h,h.Next=c);return!0};f.Clipper.prototype.JoinPoints=function(b,c,e){var h=b.OutPt1,q=new f.OutPt,p=b.OutPt2,l=new f.OutPt;if((l=b.OutPt1.Pt.Y==b.OffPt.Y)&&f.IntPoint.op_Equality(b.OffPt,b.OutPt1.Pt)&&f.IntPoint.op_Equality(b.OffPt,b.OutPt2.Pt)){for(q=b.OutPt1.Next;q!=h&&f.IntPoint.op_Equality(q.Pt,b.OffPt);)q=q.Next;q=
q.Pt.Y>b.OffPt.Y;for(l=b.OutPt2.Next;l!=p&&f.IntPoint.op_Equality(l.Pt,b.OffPt);)l=l.Next;if(q==l.Pt.Y>b.OffPt.Y)return!1;q?(q=this.DupOutPt(h,!1),l=this.DupOutPt(p,!0),h.Prev=p,p.Next=h,q.Next=l,l.Prev=q):(q=this.DupOutPt(h,!0),l=this.DupOutPt(p,!1),h.Next=p,p.Prev=h,q.Prev=l,l.Next=q);b.OutPt1=h;b.OutPt2=q;return!0}if(l){for(q=h;h.Prev.Pt.Y==h.Pt.Y&&h.Prev!=q&&h.Prev!=p;)h=h.Prev;for(;q.Next.Pt.Y==q.Pt.Y&&q.Next!=h&&q.Next!=p;)q=q.Next;if(q.Next==h||q.Next==p)return!1;for(l=p;p.Prev.Pt.Y==p.Pt.Y&&
p.Prev!=l&&p.Prev!=q;)p=p.Prev;for(;l.Next.Pt.Y==l.Pt.Y&&l.Next!=p&&l.Next!=h;)l=l.Next;if(l.Next==p||l.Next==h)return!1;var r,x;r={Value:r};x={Value:x};c=this.GetOverlap(h.Pt.X,q.Pt.X,p.Pt.X,l.Pt.X,r,x);r=r.Value;x=x.Value;if(!c)return!1;c=new f.IntPoint;h.Pt.X>=r&&h.Pt.X<=x?(c.X=h.Pt.X,c.Y=h.Pt.Y,e=h.Pt.X>q.Pt.X):p.Pt.X>=r&&p.Pt.X<=x?(c.X=p.Pt.X,c.Y=p.Pt.Y,e=p.Pt.X>l.Pt.X):q.Pt.X>=r&&q.Pt.X<=x?(c.X=q.Pt.X,c.Y=q.Pt.Y,e=q.Pt.X>h.Pt.X):(c.X=l.Pt.X,c.Y=l.Pt.Y,e=l.Pt.X>p.Pt.X);b.OutPt1=h;b.OutPt2=p;
return this.JoinHorz(h,q,p,l,c,e)}for(q=h.Next;f.IntPoint.op_Equality(q.Pt,h.Pt)&&q!=h;)q=q.Next;if(r=q.Pt.Y>h.Pt.Y||!f.ClipperBase.SlopesEqual(h.Pt,q.Pt,b.OffPt,this.m_UseFullRange)){for(q=h.Prev;f.IntPoint.op_Equality(q.Pt,h.Pt)&&q!=h;)q=q.Prev;if(q.Pt.Y>h.Pt.Y||!f.ClipperBase.SlopesEqual(h.Pt,q.Pt,b.OffPt,this.m_UseFullRange))return!1}for(l=p.Next;f.IntPoint.op_Equality(l.Pt,p.Pt)&&l!=p;)l=l.Next;if(x=l.Pt.Y>p.Pt.Y||!f.ClipperBase.SlopesEqual(p.Pt,l.Pt,b.OffPt,this.m_UseFullRange)){for(l=p.Prev;f.IntPoint.op_Equality(l.Pt,
p.Pt)&&l!=p;)l=l.Prev;if(l.Pt.Y>p.Pt.Y||!f.ClipperBase.SlopesEqual(p.Pt,l.Pt,b.OffPt,this.m_UseFullRange))return!1}if(q==h||l==p||q==l||c==e&&r==x)return!1;r?(q=this.DupOutPt(h,!1),l=this.DupOutPt(p,!0),h.Prev=p,p.Next=h,q.Next=l,l.Prev=q):(q=this.DupOutPt(h,!0),l=this.DupOutPt(p,!1),h.Next=p,p.Prev=h,q.Prev=l,l.Next=q);b.OutPt1=h;b.OutPt2=q;return!0};f.Clipper.GetBounds=function(b){for(var c=0,e=b.length;c<e&&0==b[c].length;)c++;if(c==e)return new f.IntRect(0,0,0,0);var h=new f.IntRect;h.left=b[c][0].X;
h.right=h.left;h.top=b[c][0].Y;for(h.bottom=h.top;c<e;c++)for(var q=0,p=b[c].length;q<p;q++)b[c][q].X<h.left?h.left=b[c][q].X:b[c][q].X>h.right&&(h.right=b[c][q].X),b[c][q].Y<h.top?h.top=b[c][q].Y:b[c][q].Y>h.bottom&&(h.bottom=b[c][q].Y);return h};f.Clipper.prototype.GetBounds2=function(b){var c=b,e=new f.IntRect;e.left=b.Pt.X;e.right=b.Pt.X;e.top=b.Pt.Y;e.bottom=b.Pt.Y;for(b=b.Next;b!=c;)b.Pt.X<e.left&&(e.left=b.Pt.X),b.Pt.X>e.right&&(e.right=b.Pt.X),b.Pt.Y<e.top&&(e.top=b.Pt.Y),b.Pt.Y>e.bottom&&
(e.bottom=b.Pt.Y),b=b.Next;return e};f.ClipperBase.prototype.PointInPolygon=f.Clipper.prototype.PointInPolygon=function(){var b=arguments,c=b.length;if(2==c){for(var c=b[0],e=b[1],b=0,h=e;;){var f=e.Pt.X,p=e.Pt.Y,l=e.Next.Pt.X,G=e.Next.Pt.Y;if(G==c.Y&&(l==c.X||p==c.Y&&l>c.X==f<c.X))return-1;if(p<c.Y!=G<c.Y)if(f>=c.X)if(l>c.X)b=1-b;else{f=(f-c.X)*(G-c.Y)-(l-c.X)*(p-c.Y);if(0==f)return-1;0<f==G>p&&(b=1-b)}else if(l>c.X){f=(f-c.X)*(G-c.Y)-(l-c.X)*(p-c.Y);if(0==f)return-1;0<f==G>p&&(b=1-b)}e=e.Next;if(h==
e)break}return b}if(3==c){c=b[0];e=b[1];h=b[2];p=e;b=!1;if(h){do p.Pt.Y>c.Y!=p.Prev.Pt.Y>c.Y&&r.op_LessThan(new r(c.X-p.Pt.X),r.op_Division(r.Int128Mul(p.Prev.Pt.X-p.Pt.X,c.Y-p.Pt.Y),new r(p.Prev.Pt.Y-p.Pt.Y)))&&(b=!b),p=p.Next;while(p!=e)}else{do p.Pt.Y>c.Y!=p.Prev.Pt.Y>c.Y&&c.X-p.Pt.X<(p.Prev.Pt.X-p.Pt.X)*(c.Y-p.Pt.Y)/(p.Prev.Pt.Y-p.Pt.Y)&&(b=!b),p=p.Next;while(p!=e)}return b}};f.Clipper.prototype.Poly2ContainsPoly1=function(b,c){var e=b;do{var h=this.PointInPolygon(e.Pt,c);if(0<=h)return 0!=h;
e=e.Next}while(e!=b);return!0};f.Clipper.prototype.FixupFirstLefts1=function(b,c){for(var e=0,h=this.m_PolyOuts.length;e<h;e++){var f=this.m_PolyOuts[e];null!==f.Pts&&f.FirstLeft==b&&this.Poly2ContainsPoly1(f.Pts,c.Pts)&&(f.FirstLeft=c)}};f.Clipper.prototype.FixupFirstLefts2=function(b,c){for(var e=0,h=this.m_PolyOuts,f=h.length,p=h[e];e<f;e++,p=h[e])p.FirstLeft==b&&(p.FirstLeft=c)};f.Clipper.ParseFirstLeft=function(b){for(;null!=b&&null==b.Pts;)b=b.FirstLeft;return b};f.Clipper.prototype.JoinCommonEdges=
function(){for(var b=0,c=this.m_Joins.length;b<c;b++){var e=this.m_Joins[b],h=this.GetOutRec(e.OutPt1.Idx),q=this.GetOutRec(e.OutPt2.Idx);if(null!=h.Pts&&null!=q.Pts){var p;p=h==q?h:this.Param1RightOfParam2(h,q)?q:this.Param1RightOfParam2(q,h)?h:this.GetLowermostRec(h,q);if(this.JoinPoints(e,h,q))if(h==q){h.Pts=e.OutPt1;h.BottomPt=null;q=this.CreateOutRec();q.Pts=e.OutPt2;this.UpdateOutPtIdxs(q);if(this.m_UsingPolyTree){p=0;for(var l=this.m_PolyOuts.length;p<l-1;p++){var r=this.m_PolyOuts[p];null!=
r.Pts&&f.Clipper.ParseFirstLeft(r.FirstLeft)==h&&r.IsHole!=h.IsHole&&this.Poly2ContainsPoly1(r.Pts,e.OutPt2)&&(r.FirstLeft=q)}}this.Poly2ContainsPoly1(q.Pts,h.Pts)?(q.IsHole=!h.IsHole,q.FirstLeft=h,this.m_UsingPolyTree&&this.FixupFirstLefts2(q,h),(q.IsHole^this.ReverseSolution)==0<this.Area(q)&&this.ReversePolyPtLinks(q.Pts)):this.Poly2ContainsPoly1(h.Pts,q.Pts)?(q.IsHole=h.IsHole,h.IsHole=!q.IsHole,q.FirstLeft=h.FirstLeft,h.FirstLeft=q,this.m_UsingPolyTree&&this.FixupFirstLefts2(h,q),(h.IsHole^this.ReverseSolution)==
0<this.Area(h)&&this.ReversePolyPtLinks(h.Pts)):(q.IsHole=h.IsHole,q.FirstLeft=h.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(h,q))}else q.Pts=null,q.BottomPt=null,q.Idx=h.Idx,h.IsHole=p.IsHole,p==q&&(h.FirstLeft=q.FirstLeft),q.FirstLeft=h,this.m_UsingPolyTree&&this.FixupFirstLefts2(q,h)}}};f.Clipper.prototype.UpdateOutPtIdxs=function(b){var c=b.Pts;do c.Idx=b.Idx,c=c.Prev;while(c!=b.Pts)};f.Clipper.prototype.DoSimplePolygons=function(){for(var b=0;b<this.m_PolyOuts.length;){var c=this.m_PolyOuts[b++],
e=c.Pts;if(null!==e){do{for(var h=e.Next;h!=c.Pts;){if(f.IntPoint.op_Equality(e.Pt,h.Pt)&&h.Next!=e&&h.Prev!=e){var q=e.Prev,p=h.Prev;e.Prev=p;p.Next=e;h.Prev=q;q.Next=h;c.Pts=e;q=this.CreateOutRec();q.Pts=h;this.UpdateOutPtIdxs(q);this.Poly2ContainsPoly1(q.Pts,c.Pts)?(q.IsHole=!c.IsHole,q.FirstLeft=c):this.Poly2ContainsPoly1(c.Pts,q.Pts)?(q.IsHole=c.IsHole,c.IsHole=!q.IsHole,q.FirstLeft=c.FirstLeft,c.FirstLeft=q):(q.IsHole=c.IsHole,q.FirstLeft=c.FirstLeft);h=e}h=h.Next}e=e.Next}while(e!=c.Pts)}}};
f.Clipper.Area=function(b){var c=b.length;if(3>c)return 0;for(var e=0,h=0,f=c-1;h<c;++h)e+=(b[f].X+b[h].X)*(b[f].Y-b[h].Y),f=h;return.5*-e};f.Clipper.prototype.Area=function(b){var c=b.Pts;if(null==c)return 0;var e=0;do e+=(c.Prev.Pt.X+c.Pt.X)*(c.Prev.Pt.Y-c.Pt.Y),c=c.Next;while(c!=b.Pts);return.5*e};f.Clipper.SimplifyPolygon=function(b,c){var e=[],h=new f.Clipper(0);h.StrictlySimple=!0;h.AddPath(b,f.PolyType.ptSubject,!0);h.Execute(f.ClipType.ctUnion,e,c,c);return e};f.Clipper.SimplifyPolygons=function(b,
c){"undefined"==typeof c&&(c=f.PolyFillType.pftEvenOdd);var e=[],h=new f.Clipper(0);h.StrictlySimple=!0;h.AddPaths(b,f.PolyType.ptSubject,!0);h.Execute(f.ClipType.ctUnion,e,c,c);return e};f.Clipper.DistanceSqrd=function(b,c){var e=b.X-c.X,h=b.Y-c.Y;return e*e+h*h};f.Clipper.DistanceFromLineSqrd=function(b,c,e){var h=c.Y-e.Y;e=e.X-c.X;c=h*c.X+e*c.Y;c=h*b.X+e*b.Y-c;return c*c/(h*h+e*e)};f.Clipper.SlopesNearCollinear=function(b,c,e,h){return f.Clipper.DistanceFromLineSqrd(c,b,e)<h};f.Clipper.PointsAreClose=
function(b,c,e){var h=b.X-c.X;b=b.Y-c.Y;return h*h+b*b<=e};f.Clipper.ExcludeOp=function(b){var c=b.Prev;c.Next=b.Next;b.Next.Prev=c;c.Idx=0;return c};f.Clipper.CleanPolygon=function(b,c){"undefined"==typeof c&&(c=1.415);var e=b.length;if(0==e)return[];for(var h=Array(e),q=0;q<e;++q)h[q]=new f.OutPt;for(q=0;q<e;++q)h[q].Pt=b[q],h[q].Next=h[(q+1)%e],h[q].Next.Prev=h[q],h[q].Idx=0;q=c*c;for(h=h[0];0==h.Idx&&h.Next!=h.Prev;)f.Clipper.PointsAreClose(h.Pt,h.Prev.Pt,q)?(h=f.Clipper.ExcludeOp(h),e--):f.Clipper.PointsAreClose(h.Prev.Pt,
h.Next.Pt,q)?(f.Clipper.ExcludeOp(h.Next),h=f.Clipper.ExcludeOp(h),e-=2):f.Clipper.SlopesNearCollinear(h.Prev.Pt,h.Pt,h.Next.Pt,q)?(h=f.Clipper.ExcludeOp(h),e--):(h.Idx=1,h=h.Next);3>e&&(e=0);for(var p=Array(e),q=0;q<e;++q)p[q]=new f.IntPoint(h.Pt),h=h.Next;return p};f.Clipper.CleanPolygons=function(b,c){for(var e=Array(b.length),h=0,q=b.length;h<q;h++)e[h]=f.Clipper.CleanPolygon(b[h],c);return e};f.Clipper.Minkowski=function(b,c,e,h){var q=h?1:0,p=b.length,l=c.length;h=[];if(e)for(e=0;e<l;e++){for(var r=
Array(p),x=0,G=b.length,I=b[x];x<G;x++,I=b[x])r[x]=new f.IntPoint(c[e].X+I.X,c[e].Y+I.Y);h.push(r)}else for(e=0;e<l;e++){r=Array(p);x=0;G=b.length;for(I=b[x];x<G;x++,I=b[x])r[x]=new f.IntPoint(c[e].X-I.X,c[e].Y-I.Y);h.push(r)}b=[];for(e=0;e<=l-2+q;e++)for(x=0;x<=p-1;x++)c=[],c.push(h[e%l][x%p]),c.push(h[(e+1)%l][x%p]),c.push(h[(e+1)%l][(x+1)%p]),c.push(h[e%l][(x+1)%p]),f.Clipper.Orientation(c)||c.reverse(),b.push(c);q=new f.Clipper(0);q.AddPaths(b,f.PolyType.ptSubject,!0);q.Execute(f.ClipType.ctUnion,
h,f.PolyFillType.pftNonZero,f.PolyFillType.pftNonZero);return h};f.Clipper.MinkowskiSum=function(b,c,e){return f.Clipper.Minkowski(b,c,!0,e)};f.Clipper.MinkowskiDiff=function(b,c,e){return f.Clipper.Minkowski(b,c,!1,e)};f.Clipper.PolyTreeToPaths=function(b){var c=[];f.Clipper.AddPolyNodeToPaths(b,f.Clipper.NodeType.ntAny,c);return c};f.Clipper.AddPolyNodeToPaths=function(b,c,e){var h=!0;switch(c){case f.Clipper.NodeType.ntOpen:return;case f.Clipper.NodeType.ntClosed:h=!b.IsOpen}0<b.m_polygon.length&&
h&&e.push(b.m_polygon);h=0;b=b.Childs();for(var q=b.length,p=b[h];h<q;h++,p=b[h])f.Clipper.AddPolyNodeToPaths(p,c,e)};f.Clipper.OpenPathsFromPolyTree=function(b){for(var c=new f.Paths,e=0,h=b.ChildCount();e<h;e++)b.Childs()[e].IsOpen&&c.push(b.Childs()[e].m_polygon);return c};f.Clipper.ClosedPathsFromPolyTree=function(b){var c=new f.Paths;f.Clipper.AddPolyNodeToPaths(b,f.Clipper.NodeType.ntClosed,c);return c};Qa(f.Clipper,f.ClipperBase);f.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2};f.ClipperOffset=
function(b,c){"undefined"==typeof b&&(b=2);"undefined"==typeof c&&(c=f.ClipperOffset.def_arc_tolerance);this.m_destPolys=new f.Paths;this.m_srcPoly=new f.Path;this.m_destPoly=new f.Path;this.m_normals=[];this.m_StepsPerRad=this.m_miterLim=this.m_cos=this.m_sin=this.m_sinA=this.m_delta=0;this.m_lowest=new f.IntPoint;this.m_polyNodes=new f.PolyNode;this.MiterLimit=b;this.ArcTolerance=c;this.m_lowest.X=-1};f.ClipperOffset.two_pi=6.28318530717959;f.ClipperOffset.def_arc_tolerance=.25;f.ClipperOffset.prototype.Clear=
function(){f.Clear(this.m_polyNodes.Childs());this.m_lowest.X=-1};f.ClipperOffset.Round=f.Clipper.Round;f.ClipperOffset.prototype.AddPath=function(b,c,e){var h=b.length-1;if(!(0>h)){var q=new f.PolyNode;q.m_jointype=c;q.m_endtype=e;if(e==f.EndType.etClosedLine||e==f.EndType.etClosedPolygon)for(;0<h&&f.IntPoint.op_Equality(b[0],b[h]);)h--;q.m_polygon.push(b[0]);var p=0;c=0;for(var l=1;l<=h;l++)f.IntPoint.op_Inequality(q.m_polygon[p],b[l])&&(p++,q.m_polygon.push(b[l]),b[l].Y>q.m_polygon[c].Y||b[l].Y==
q.m_polygon[c].Y&&b[l].X<q.m_polygon[c].X)&&(c=p);if(!(e==f.EndType.etClosedPolygon&&2>p||e!=f.EndType.etClosedPolygon&&0>p)&&(this.m_polyNodes.AddChild(q),e==f.EndType.etClosedPolygon))if(0>this.m_lowest.X)this.m_lowest=new f.IntPoint(0,c);else if(b=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],q.m_polygon[c].Y>b.Y||q.m_polygon[c].Y==b.Y&&q.m_polygon[c].X<b.X)this.m_lowest=new f.IntPoint(this.m_polyNodes.ChildCount()-1,c)}};f.ClipperOffset.prototype.AddPaths=function(b,c,
e){for(var h=0,f=b.length;h<f;h++)this.AddPath(b[h],c,e)};f.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!f.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var b=0;b<this.m_polyNodes.ChildCount();b++){var c=this.m_polyNodes.Childs()[b];(c.m_endtype==f.EndType.etClosedPolygon||c.m_endtype==f.EndType.etClosedLine&&f.Clipper.Orientation(c.m_polygon))&&c.m_polygon.reverse()}else for(b=0;b<this.m_polyNodes.ChildCount();b++)c=this.m_polyNodes.Childs()[b],
c.m_endtype!=f.EndType.etClosedLine||f.Clipper.Orientation(c.m_polygon)||c.m_polygon.reverse()};f.ClipperOffset.GetUnitNormal=function(b,c){var e=c.X-b.X,h=c.Y-b.Y;if(0==e&&0==h)return new f.DoublePoint(0,0);var q=1/Math.sqrt(e*e+h*h);return new f.DoublePoint(h*q,-(e*q))};f.ClipperOffset.prototype.DoOffset=function(b){this.m_destPolys=[];this.m_delta=b;if(f.ClipperBase.near_zero(b))for(var c=0;c<this.m_polyNodes.ChildCount();c++){var e=this.m_polyNodes.Childs()[c];e.m_endtype==f.EndType.etClosedPolygon&&
this.m_destPolys.push(e.m_polygon)}else{this.m_miterLim=2<this.MiterLimit?2/(this.MiterLimit*this.MiterLimit):.5;var c=0>=this.ArcTolerance?f.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(b)*f.ClipperOffset.def_arc_tolerance?Math.abs(b)*f.ClipperOffset.def_arc_tolerance:this.ArcTolerance,h=3.14159265358979/Math.acos(1-c/Math.abs(b));this.m_sin=Math.sin(f.ClipperOffset.two_pi/h);this.m_cos=Math.cos(f.ClipperOffset.two_pi/h);this.m_StepsPerRad=h/f.ClipperOffset.two_pi;0>b&&(this.m_sin=
-this.m_sin);for(c=0;c<this.m_polyNodes.ChildCount();c++){e=this.m_polyNodes.Childs()[c];this.m_srcPoly=e.m_polygon;var q=this.m_srcPoly.length;if(!(0==q||0>=b&&(3>q||e.m_endtype!=f.EndType.etClosedPolygon))){this.m_destPoly=[];if(1==q)if(e.m_jointype==f.JoinType.jtRound)for(var e=1,q=0,p=1;p<=h;p++){this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[0].X+e*b),f.ClipperOffset.Round(this.m_srcPoly[0].Y+q*b)));var l=e,e=e*this.m_cos-this.m_sin*q,q=l*this.m_sin+q*this.m_cos}else for(q=
e=-1,p=0;4>p;++p)this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[0].X+e*b),f.ClipperOffset.Round(this.m_srcPoly[0].Y+q*b))),0>e?e=1:0>q?q=1:e=-1;else{for(p=this.m_normals.length=0;p<q-1;p++)this.m_normals.push(f.ClipperOffset.GetUnitNormal(this.m_srcPoly[p],this.m_srcPoly[p+1]));e.m_endtype==f.EndType.etClosedLine||e.m_endtype==f.EndType.etClosedPolygon?this.m_normals.push(f.ClipperOffset.GetUnitNormal(this.m_srcPoly[q-1],this.m_srcPoly[0])):this.m_normals.push(new f.DoublePoint(this.m_normals[q-
2]));if(e.m_endtype==f.EndType.etClosedPolygon)for(l=q-1,p=0;p<q;p++)l=this.OffsetPoint(p,l,e.m_jointype);else if(e.m_endtype==f.EndType.etClosedLine){l=q-1;for(p=0;p<q;p++)l=this.OffsetPoint(p,l,e.m_jointype);this.m_destPolys.push(this.m_destPoly);this.m_destPoly=[];l=this.m_normals[q-1];for(p=q-1;0<p;p--)this.m_normals[p]=new f.DoublePoint(-this.m_normals[p-1].X,-this.m_normals[p-1].Y);this.m_normals[0]=new f.DoublePoint(-l.X,-l.Y);l=0;for(p=q-1;0<=p;p--)l=this.OffsetPoint(p,l,e.m_jointype)}else{l=
0;for(p=1;p<q-1;++p)l=this.OffsetPoint(p,l,e.m_jointype);e.m_endtype==f.EndType.etOpenButt?(p=q-1,l=new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[p].X+this.m_normals[p].X*b),f.ClipperOffset.Round(this.m_srcPoly[p].Y+this.m_normals[p].Y*b)),this.m_destPoly.push(l),l=new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[p].X-this.m_normals[p].X*b),f.ClipperOffset.Round(this.m_srcPoly[p].Y-this.m_normals[p].Y*b)),this.m_destPoly.push(l)):(p=q-1,l=q-2,this.m_sinA=0,this.m_normals[p]=new f.DoublePoint(-this.m_normals[p].X,
-this.m_normals[p].Y),e.m_endtype==f.EndType.etOpenSquare?this.DoSquare(p,l):this.DoRound(p,l));for(p=q-1;0<p;p--)this.m_normals[p]=new f.DoublePoint(-this.m_normals[p-1].X,-this.m_normals[p-1].Y);this.m_normals[0]=new f.DoublePoint(-this.m_normals[1].X,-this.m_normals[1].Y);l=q-1;for(p=l-1;0<p;--p)l=this.OffsetPoint(p,l,e.m_jointype);e.m_endtype==f.EndType.etOpenButt?(l=new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*b),f.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*
b)),this.m_destPoly.push(l),l=new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*b),f.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*b)),this.m_destPoly.push(l)):(this.m_sinA=0,e.m_endtype==f.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1))}}this.m_destPolys.push(this.m_destPoly)}}}};f.ClipperOffset.prototype.Execute=function(){var b=arguments;if(b[0]instanceof f.PolyTree)if(c=b[0],e=b[1],c.Clear(),this.FixOrientations(),this.DoOffset(e),b=new f.Clipper(0),
b.AddPaths(this.m_destPolys,f.PolyType.ptSubject,!0),0<e)b.Execute(f.ClipType.ctUnion,c,f.PolyFillType.pftPositive,f.PolyFillType.pftPositive);else if(e=f.Clipper.GetBounds(this.m_destPolys),h=new f.Path,h.push(new f.IntPoint(e.left-10,e.bottom+10)),h.push(new f.IntPoint(e.right+10,e.bottom+10)),h.push(new f.IntPoint(e.right+10,e.top-10)),h.push(new f.IntPoint(e.left-10,e.top-10)),b.AddPath(h,f.PolyType.ptSubject,!0),b.ReverseSolution=!0,b.Execute(f.ClipType.ctUnion,c,f.PolyFillType.pftNegative,f.PolyFillType.pftNegative),
1==c.ChildCount()&&0<c.Childs()[0].ChildCount())for(b=c.Childs()[0],c.Childs()[0]=b.Childs()[0],e=1;e<b.ChildCount();e++)c.AddChild(b.Childs()[e]);else c.Clear();else{var c=b[0],e=b[1];f.Clear(c);this.FixOrientations();this.DoOffset(e);b=new f.Clipper(0);b.AddPaths(this.m_destPolys,f.PolyType.ptSubject,!0);if(0<e)b.Execute(f.ClipType.ctUnion,c,f.PolyFillType.pftPositive,f.PolyFillType.pftPositive);else{var e=f.Clipper.GetBounds(this.m_destPolys),h=new f.Path;h.push(new f.IntPoint(e.left-10,e.bottom+
10));h.push(new f.IntPoint(e.right+10,e.bottom+10));h.push(new f.IntPoint(e.right+10,e.top-10));h.push(new f.IntPoint(e.left-10,e.top-10));b.AddPath(h,f.PolyType.ptSubject,!0);b.ReverseSolution=!0;b.Execute(f.ClipType.ctUnion,c,f.PolyFillType.pftNegative,f.PolyFillType.pftNegative);0<c.length&&c.splice(0,1)}}};f.ClipperOffset.prototype.OffsetPoint=function(b,c,e){this.m_sinA=this.m_normals[c].X*this.m_normals[b].Y-this.m_normals[b].X*this.m_normals[c].Y;if(5E-5>this.m_sinA&&-5E-5<this.m_sinA)return c;
1<this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1);if(0>this.m_sinA*this.m_delta)this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[c].X*this.m_delta),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[c].Y*this.m_delta))),this.m_destPoly.push(new f.IntPoint(this.m_srcPoly[b])),this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[b].X*this.m_delta),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[b].Y*
this.m_delta)));else switch(e){case f.JoinType.jtMiter:e=1+(this.m_normals[b].X*this.m_normals[c].X+this.m_normals[b].Y*this.m_normals[c].Y);e>=this.m_miterLim?this.DoMiter(b,c,e):this.DoSquare(b,c);break;case f.JoinType.jtSquare:this.DoSquare(b,c);break;case f.JoinType.jtRound:this.DoRound(b,c)}return b};f.ClipperOffset.prototype.DoSquare=function(b,c){var e=Math.tan(Math.atan2(this.m_sinA,this.m_normals[c].X*this.m_normals[b].X+this.m_normals[c].Y*this.m_normals[b].Y)/4);this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+
this.m_delta*(this.m_normals[c].X-this.m_normals[c].Y*e)),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_delta*(this.m_normals[c].Y+this.m_normals[c].X*e))));this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_delta*(this.m_normals[b].X+this.m_normals[b].Y*e)),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_delta*(this.m_normals[b].Y-this.m_normals[b].X*e))))};f.ClipperOffset.prototype.DoMiter=function(b,c,e){e=this.m_delta/e;this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+
(this.m_normals[c].X+this.m_normals[b].X)*e),f.ClipperOffset.Round(this.m_srcPoly[b].Y+(this.m_normals[c].Y+this.m_normals[b].Y)*e)))};f.ClipperOffset.prototype.DoRound=function(b,c){for(var e=Math.atan2(this.m_sinA,this.m_normals[c].X*this.m_normals[b].X+this.m_normals[c].Y*this.m_normals[b].Y),e=f.Cast_Int32(f.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(e))),h=this.m_normals[c].X,l=this.m_normals[c].Y,p,r=0;r<e;++r)this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+
h*this.m_delta),f.ClipperOffset.Round(this.m_srcPoly[b].Y+l*this.m_delta))),p=h,h=h*this.m_cos-this.m_sin*l,l=p*this.m_sin+l*this.m_cos;this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[b].X*this.m_delta),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[b].Y*this.m_delta)))};f.Error=function(b){try{throw Error(b);}catch(c){alert(c.message)}};f.JS={};f.JS.AreaOfPolygon=function(b,c){c||(c=1);return f.Clipper.Area(b)/(c*c)};f.JS.AreaOfPolygons=function(b,
c){c||(c=1);for(var e=0,h=0;h<b.length;h++)e+=f.Clipper.Area(b[h]);return e/(c*c)};f.JS.BoundsOfPath=function(b,c){return f.JS.BoundsOfPaths([b],c)};f.JS.BoundsOfPaths=function(b,c){c||(c=1);var e=f.Clipper.GetBounds(b);e.left/=c;e.bottom/=c;e.right/=c;e.top/=c;return e};f.JS.Clean=function(b,c){if(!(b instanceof Array))return[];var e=b[0]instanceof Array;b=f.JS.Clone(b);if("number"!=typeof c||null===c)return f.Error("Delta is not a number in Clean()."),b;if(0===b.length||1==b.length&&0===b[0].length||
0>c)return b;e||(b=[b]);for(var h=b.length,l,p,r,G,x,F,I,H=[],P=0;P<h;P++)if(p=b[P],l=p.length,0!==l)if(3>l)r=p,H.push(r);else{r=p;G=c*c;x=p[0];for(I=F=1;I<l;I++)(p[I].X-x.X)*(p[I].X-x.X)+(p[I].Y-x.Y)*(p[I].Y-x.Y)<=G||(r[F]=p[I],x=p[I],F++);x=p[F-1];(p[0].X-x.X)*(p[0].X-x.X)+(p[0].Y-x.Y)*(p[0].Y-x.Y)<=G&&F--;F<l&&r.splice(F,l-F);r.length&&H.push(r)}!e&&H.length?H=H[0]:e||0!==H.length?e&&0===H.length&&(H=[[]]):H=[];return H};f.JS.Clone=function(b){if(!(b instanceof Array)||0===b.length)return[];if(1==
b.length&&0===b[0].length)return[[]];var c=b[0]instanceof Array;c||(b=[b]);var e=b.length,h,f,l,r,G=Array(e);for(f=0;f<e;f++){h=b[f].length;r=Array(h);for(l=0;l<h;l++)r[l]={X:b[f][l].X,Y:b[f][l].Y};G[f]=r}c||(G=G[0]);return G};f.JS.Lighten=function(b,c){if(!(b instanceof Array))return[];if("number"!=typeof c||null===c)return f.Error("Tolerance is not a number in Lighten()."),f.JS.Clone(b);if(0===b.length||1==b.length&&0===b[0].length||0>c)return f.JS.Clone(b);b[0]instanceof Array||(b=[b]);var e,h,
l,p,r,G,x,F,I,H,P,M,S,R,U,ca=b.length,ba=c*c,X=[];for(e=0;e<ca;e++)if(l=b[e],G=l.length,0!=G){for(p=0;1E6>p;p++){r=[];G=l.length;l[G-1].X!=l[0].X||l[G-1].Y!=l[0].Y?(P=1,l.push({X:l[0].X,Y:l[0].Y}),G=l.length):P=0;H=[];for(h=0;h<G-2;h++){x=l[h];I=l[h+1];F=l[h+2];R=x.X;U=x.Y;x=F.X-R;M=F.Y-U;if(0!==x||0!==M)S=((I.X-R)*x+(I.Y-U)*M)/(x*x+M*M),1<S?(R=F.X,U=F.Y):0<S&&(R+=x*S,U+=M*S);x=I.X-R;M=I.Y-U;F=x*x+M*M;F<=ba&&(H[h+1]=1,h++)}r.push({X:l[0].X,Y:l[0].Y});for(h=1;h<G-1;h++)H[h]||r.push({X:l[h].X,Y:l[h].Y});
r.push({X:l[G-1].X,Y:l[G-1].Y});P&&l.pop();if(H.length)l=r;else break}G=r.length;r[G-1].X==r[0].X&&r[G-1].Y==r[0].Y&&r.pop();2<r.length&&X.push(r)}b[0]instanceof Array||(X=X[0]);"undefined"==typeof X&&(X=[[]]);return X};f.JS.PerimeterOfPath=function(b,c,e){if("undefined"==typeof b)return 0;var h=Math.sqrt,f=0,l,r,G=0,x=0,F=b.length;if(2>F)return 0;for(c&&(b[F]=b[0],F++);--F;)l=b[F],G=l.X,l=l.Y,r=b[F-1],x=r.X,r=r.Y,f+=h((G-x)*(G-x)+(l-r)*(l-r));c&&b.pop();return f/e};f.JS.PerimeterOfPaths=function(b,
c,e){e||(e=1);for(var h=0,l=0;l<b.length;l++)h+=f.JS.PerimeterOfPath(b[l],c,e);return h};f.JS.ScaleDownPath=function(b,c){var e,h;c||(c=1);for(e=b.length;e--;)h=b[e],h.X/=c,h.Y/=c};f.JS.ScaleDownPaths=function(b,c){var e,h,f;c||(c=1);for(e=b.length;e--;)for(h=b[e].length;h--;)f=b[e][h],f.X/=c,f.Y/=c};f.JS.ScaleUpPath=function(b,c){var e,f,l=Math.round;c||(c=1);for(e=b.length;e--;)f=b[e],f.X=l(f.X*c),f.Y=l(f.Y*c)};f.JS.ScaleUpPaths=function(b,c){var e,f,l,p=Math.round;c||(c=1);for(e=b.length;e--;)for(f=
b[e].length;f--;)l=b[e][f],l.X=p(l.X*c),l.Y=p(l.Y*c)};f.ExPolygons=function(){return[]};f.ExPolygon=function(){this.holes=this.outer=null};f.JS.AddOuterPolyNodeToExPolygons=function(b,c){var e=new f.ExPolygon;e.outer=b.Contour();var h=b.Childs(),l=h.length;e.holes=Array(l);var p,r,G,x,F;for(r=0;r<l;r++)for(p=h[r],e.holes[r]=p.Contour(),G=0,x=p.Childs(),F=x.length;G<F;G++)p=x[G],f.JS.AddOuterPolyNodeToExPolygons(p,c);c.push(e)};f.JS.ExPolygonsToPaths=function(b){var c,e,h,l,p=new f.Paths;c=0;for(h=
b.length;c<h;c++)for(p.push(b[c].outer),e=0,l=b[c].holes.length;e<l;e++)p.push(b[c].holes[e]);return p};f.JS.PolyTreeToExPolygons=function(b){var c=new f.ExPolygons,e,h,l;e=0;h=b.Childs();for(l=h.length;e<l;e++)b=h[e],f.JS.AddOuterPolyNodeToExPolygons(b,c);return c}})();
var createCindy=function(){function r(r){if(0===X)return console.error("Waiting for "+r+" after we finished waiting."),function(){};0>X&&(X=0);++X;return function(){--X;0>X&&console.error("Wait count mismatch: "+r);if(0===X)for(var F=0,l=La.length;F<l;)La[F++].startup()}}function F(r){var P=F.newInstance(r);0>=X?P.startup():!1!==r.autostart&&La.push(P);return P}var X=-1,La=[];"undefined"===typeof document||"undefined"===typeof window||"undefined"===typeof document.addEventListener||"undefined"!==
typeof window.cindyDontWait&&!0===window.cindyDontWait||document.addEventListener("DOMContentLoaded",r("DOMContentLoaded"));var xa=null,va=null,ba={};F.getBaseDir=function(){if(null!==xa)return xa;for(var r=document.getElementsByTagName("script"),F=0;F<r.length;++F){var l=r[F],H=l.src;if(H){var M=/Cindy\.js$/.exec(H);if(M)return xa=H.substr(0,M.index),console.log("Will load extensions from "+xa),va=l,xa}}console.error("Could not find <script> tag for Cindy.js");return xa=va=!1};F.addNewScript=function(r,
P){P||console.error.bind(console);var l=F.getBaseDir();if(!1===l)return!1;var H=document.createElement("script");H.src=l+r;var l=va.nextSibling,M=va.parentElement;l?M.insertBefore(H,l):M.appendChild(H);return H};F.loadScript=function(r,P,l,H){if(window[r])return l(),!0;H||(H=console.error.bind(console));var M=ba[r];if(!M){M=F.addNewScript(P,H);if(!1===M)return H("Can't load additional components."),!1;ba[r]=M}M.addEventListener("load",l);M.addEventListener("error",H);return null};F._autoLoadingPlugin=
{};F.autoLoadPlugin=function(r,P,l){if(F._pluginRegistry[r])return l(),!0;var H=F._autoLoadingPlugin[r];if(!H){P||(P=r+"-plugin.js");H=F._autoLoadingPlugin[r]=[];r=F.addNewScript(P);if(!1===r)return!1;r.addEventListener("error",console.error.bind(console))}H.push(l);return null};F.waitFor=r;F._pluginRegistry={};F.instances=[];F.registerPlugin=function(r,P,l){if(1!==r)return console.error("Plugin API version "+r+" not supported"),!1;F._pluginRegistry[P]=l;(F._autoLoadingPlugin[P]||[]).forEach(function(l){l()})};
F.newInstance=function(r){var F,l,H,M,X,ba;function xa(a){if(a){for(var m=0;m<a.length;m++){var d=a[m],z=Object.keys(d)[0];"scale"===z&&(hb=d.scale,v[z](d.scale));if("translate"===z)v[z](d.translate[0],d.translate[1]);"scaleAndOrigin"===z&&(hb=d[z][0]/25,v[z].apply(null,d[z]));"visibleRect"===z&&(v[z].apply(null,d[z]),hb=v.drawingstate.initialmatrix.a/25)}v.createnewbackup()}}function va(){ub=!0;if(0===ib){void 0!==r.csconsole&&(ha=r.csconsole);ha=null===ha?new Va:!0===ha?new Pa:"string"===typeof ha?
new Ea(ha):"object"===typeof ha&&"function"===typeof ha.appendChild?new Ea(ha):new Va;ab=[100,100];var a,m=null,d=r.transform;r.ports&&0<r.ports.length&&(a=r.ports[0],(m=a.element)||(m=document.getElementById(a.id)),"window"===a.fill?(m.setAttribute("width",window.innerWidth),m.setAttribute("height",window.innerHeight)):a.width&&a.height&&(m.setAttribute("width",a.width),m.setAttribute("height",a.height)),a.background&&(m.style.backgroundColor=a.background),void 0!==a.transform&&(d=a.transform));
m||(m=r.canvas)||"undefined"===typeof document||(m=document.getElementById(r.canvasname));m&&(C=m.getContext("2d"),C.setLineDash||(C.setLineDash=function(){}));a=bb(Fc);a=la(a,!1);A(a);var z=r.scripts,c=null;"string"===typeof z&&z.search(/\*/)&&(c=z);"object"!==typeof z&&(z=null);"move keydown mousedown mouseup mousedrag init tick draw simulationstep cssimulationstart cssimulationstop".split(" ").forEach(function(a){var d;if(null!==z&&z[a])d=z[a];else{d=a+"script";if(r[d])d=document.getElementById(r[d]);
else if(c){if(d=document.getElementById(c.replace(/\*/,a)),!d)return}else return;d=d.text}d=bb(d);d=la(d,!1);"error"===d.ctype?console.error("Error compiling "+a+" script: "+d.message):ja[a]=d});r.grid&&0!==r.grid&&(Fa=r.grid,ac=la("#drawgrid("+Fa+")",!1));r.snap&&(bc=r.snap);m&&(fa=m.width,Z=m.height,xa(d),v.drawingstate.matrix.ty-=Z,v.drawingstate.initialmatrix.ty-=Z,d=1,"undefined"!==typeof window&&window.devicePixelRatio&&(d=window.devicePixelRatio),a=C.webkitBackingStorePixelRatio||C.mozBackingStorePixelRatio||
C.msBackingStorePixelRatio||C.oBackingStorePixelRatio||C.backingStorePixelRatio||1,d!==a&&(d/=a,m.width=fa*d,m.height=Z*d,m.style.width||(m.style.width=fa+"px"),m.style.height||(m.style.height=Z+"px"),C.scale(d,d)));ba=X=M=H=l=F=void 0;d=0;oa={};r.geometry||(r.geometry=[]);Gc(r.geometry);r.behavior||(r.behavior=[]);"function"===typeof xb&&xb(r.behavior);for(var g in r.images)d=r.images[g],oa[g]=new Image,oa[g].ready=!1,oa[g].onload=function(){oa[g].ready=!0;b()},oa[g].src=d;qa.canvas=m;if(r.oninit)r.oninit(qa);
if(r.exclusive)for(d=wa.instances.length;0<d;)wa.instances[--d].shutdown();wa.instances.push(qa);r.use&&r.use.forEach(function(a){u.use$1([w.wrap(a)],{})});cc.convexhull3d$1&&Ca("quickhull3d","quickhull3d/quickhull3d.nocache.js");f()}}function Ca(a,m){var d=null;r.plugins&&(d=r.plugins[a]);d||(d=wa._pluginRegistry[a]);d?u.use$1([w.wrap(a)],{}):(++dc,wa.autoLoadPlugin(a,m,function(){u.use$1([w.wrap(a)],{});f()}))}function f(){0===--dc&&(A(ja.init),r.autoplay&&U(),qa.canvas&&ca(qa.canvas,r))}function Ua(){null!==
db&&(da.set(db.state),Object.keys(db.speeds).forEach(function(a){var m=l[a];"undefined"!==typeof m.behavior&&(a=db.speeds[a],m.behavior.vx=a[0],m.behavior.vy=a[1],m.behavior.vz=a[2],m.behavior.fx=0,m.behavior.fy=0,m.behavior.fz=0)}),Hc())}function U(){if(!za){if(jb){var a=Ga.backup;a.set(da);for(var m={},d=0;d<H.length;d++){var z=H[d];"undefined"!==typeof z.behavior&&(m[z.name]=[z.behavior.vx,z.behavior.vy,z.behavior.vz])}db={state:a,speeds:m};jb=!1}"function"===typeof xb&&yb&&Ic(ma);za=!0;Qa()}}
function R(){za&&(za=!1)}function Oa(){jb||(za=!1,jb=!0,Ua())}function ya(){if(!zb){zb=!0;for(var a=wa.instances.length;0<a;)if(wa.instances[--a]===qa){wa.instances.splice(a,1);break}for(a=Wa.length;0<a;)try{Wa[--a]()}catch(m){console.error(m)}}}function Da(a){this["in"]=function(a,d){console.log(a);d?this.append(this.createTextNode("span","blue",a)):this.append(this.createTextNode("p","blue",a))};this.out=function(a,d){console.log(a);d?this.append(this.createTextNode("span","red",a)):this.append(this.createTextNode("p",
"red",a))};this.err=function(a,d){console.log(a);d?this.append(this.createTextNode("span","red",a)):this.append(this.createTextNode("p","red",a))};this.createTextNode=function(a,d,z){return"undefined"!==typeof document?(a=document.createElement(a),a.appendChild(document.createTextNode(z)),a.style.color=d,a):z+"\n"}}function Pa(){var a=this,m,d=document.createElement("div"),z;d.innerHTML='<div id="console" style="border-top: 1px solid #333333; bottom: 0px; position: absolute; width: 100%;"><div id="log" style="height: 150px; overflow-y: auto;"></div><input id="cmd" type="text" style="box-sizing: border-box; height: 30px; width: 100%;"></div>';
document.body.appendChild(d);m=document.getElementById("cmd");z=document.getElementById("log");m.onkeydown=function(d){13===d.keyCode&&""!==m.value&&(a["in"](m.value),d=u.parse$1([w.wrap(m.value)],[]),d=A(d),console.log(I(d)),"undefined"!==d.ctype&&ha.out(I(d)),m.value="",z.scrollTop=z.scrollHeight)};this.append=function(a){z.appendChild(a)};this.clear=function(){z.innerHTML=""}}function Ea(a){var m=a;"string"===typeof a&&(m=document.getElementById(a));this.append=function(a){m.appendChild(a)};this.clear=
function(){m.innerHTML=""}}function Va(){this.append=function(a){};this.clear=function(){}}function Na(a){for(var m=null,d=1E6,z,b=0;b<ba.length;b++){var c=ba[b];if(!c.pinned&&!1!==c.visible){var e,f,h,n=v.drawingstate.matrix.sdet;if("P"===c.kind){var p=g.normalizeZ(c.homog);if(!g._helper.isAlmostReal(p))continue;e=p.value[0].value.real-a.x;f=p.value[1].value.real-a.y;h=Math.sqrt(e*e+f*f);if(c.narrow&&h>("number"===typeof c.narrow?c.narrow:20)/n)continue}else"C"===c.kind?(f=l[c.args[0]],h=c.radius,
e=k.div(f.homog.value[0],f.homog.value[2]).value.real,f=k.div(f.homog.value[1],f.homog.value[2]).value.real,e-=a.x,f-=a.y,h=Math.sqrt(e*e+f*f)-h.value.real,f=e=0,0>h&&(h=-h),h+=30/n):"L"===c.kind&&(e=c.homog,h=k,f=h.add(h.mult(e.value[0],h.conjugate(e.value[0])),h.mult(e.value[1],h.conjugate(e.value[1]))),f=g.scaldiv(h.sqrt(f),e),h=f.value[0].value.real*a.x+f.value[1].value.real*a.y+f.value[2].value.real,e=-f.value[0].value.real*h,f=-f.value[1].value.real*h,0>h&&(h=-h),h+=1);h<d+.2/n&&(d=h,m=c,z=
{x:e,y:f})}}console.log("Moving "+(m?m.name:"nothing"));return null===m?null:{mover:m,offset:z,prev:{x:a.x,y:a.y}}}function S(a,m,d,z){void 0===z&&(z=!1);Wa.push(function(){a.removeEventListener(m,d,z)});a.addEventListener(m,d,z)}function ca(a,m){function d(d){var m=a.getBoundingClientRect();d=v.to(d.clientX-m.left-a.clientLeft+.5,d.clientY-m.top-a.clientTop+.5);V.prevx=V.x;V.prevy=V.y;V.x=d[0];V.y=d[1];ab[0]=V.x;ab[1]=V.y;V.moved=!0}function z(a){V.down=!1;ea=void 0;Ra();b();A(ja.mouseup);a.preventDefault()}
var ia=null;"undefined"!==typeof MutationObserver&&(ia=MutationObserver);ia||"undefined"===typeof WebKitMutationObserver||(ia=WebKitMutationObserver);ia?(ia=new ia(function(d){document.body.contains(a)||ya()}),ia.observe(document.documentElement,{childList:!0,subtree:!0}),Wa.push(function(){ia.disconnect()})):(S(a,"DOMNodeRemovedFromDocument",ya),S(a,"DOMNodeRemoved",ya));!0===m.keylistener?S(document,"keydown",function(a){c(a);return!1}):ja.keydown&&(a.setAttribute("tabindex","0"),S(a,"mousedown",
function(){a.focus()}),S(a,"keydown",function(a){9!==a.keyCode&&(c(a),a.preventDefault())}));S(a,"mousedown",function(a){V.button=a.which;d(a);A(ja.mousedown);ea=Na(V);Qa();V.down=!0;a.preventDefault()});S(a,"mouseup",function(a){V.down=!1;ea=void 0;Ra();A(ja.mouseup);b();a.preventDefault()});S(a,"mousemove",function(a){d(a);V.down?A(ja.mousedrag):A(ja.mousemove);a.preventDefault()});S(a,"touchstart",function(a){d(a.targetTouches[0]);A(ja.mousedown);V.down=!0;ea=Na(V);Qa();a.preventDefault()},!1);
S(a,"touchmove",function(a){d(a.targetTouches[0]);V.down?A(ja.mousedrag):A(ja.mousemove);a.preventDefault()},!0);S(a,"touchend",z,!1);"undefined"!==typeof document&&document.body&&S(document.body,"touchcancel",z,!1);b()}function La(){if(zb)return!0;za&&(yb&&"undefined"!==typeof ka&&ka.tick(),za&&A(ja.tick));if(za||V.moved)V.moved=!1,b();kb=za||V.down;return!kb}function Qa(){kb||(kb=!0,Ab.timer(La))}function b(){v.reset();C.save();C.clearRect(0,0,fa,Z);0!==Fa&&A(ac);Jc();v.greset();Kc();Lc();C.restore()}
function c(a){a=window.event?event:a;a=a.charCode?a.charCode:a.keyCode;ec=String.fromCharCode(a);fc=a;A(ja.keydown);b()}function e(a,m){if(m in a)return m;m=m.charAt(0).toUpperCase()+m.substring(1);for(var d=0,z=gc.length;d<z;++d){var b=gc[d]+m;if(b in a)return b}}function h(){var a=q(),a=p()-a;24<a?(isFinite(a)&&(clearTimeout(lb),lb=setTimeout(h,a)),mb=0):(mb=1,hc(h))}function q(){var a=Date.now();for(Ha=nb;Ha;)a>=Ha.t&&(Ha.f=Ha.c(a-Ha.t)),Ha=Ha.n;return a}function p(){for(var a,m=nb,d=Infinity;m;)m.f?
m=a?a.n=m.n:nb=m.n:(m.t<d&&(d=m.t),m=(a=m).n);ob=a;return d}function E(){this.ctype="undefined"}function Dc(){this.ctype="void"}function x(a){this.ctype="error";this.message=a}function Ma(a){var m=a.value;a=m[0].value;var d=m[1].value,m=m[2].value;return g.turnIntoCSList([a[0],k.add(a[1],d[0]),k.add(a[2],m[0]),d[1],k.add(d[2],m[1]),m[2]])}function I(a){if("undefined"===typeof a)return"_??_";if("undefined"===a.ctype)return"___";if("number"===a.ctype)return k.niceprint(a);if("string"===a.ctype||"boolean"===
a.ctype)return a.value;if("list"===a.ctype){for(var m="[",d=0;d<a.value.length;d++)m+=I(A(a.value[d])),d!==a.value.length-1&&(m+=", ");return m+"]"}return"function"===a.ctype?"FUNCTION":"infix"===a.ctype?"INFIX":"modifier"===a.ctype?a.key+"->"+I(a.value):"shape"===a.ctype?a.type:"error"===a.ctype?"Error: "+a.message:"variable"===a.ctype?(console.log("HALLO"),I(a.stack[length.stack])):"geo"===a.ctype?a.value.name:"_?_"}function aa(a,m){var d="undefined"===a[0].ctype,z="undefined"===a[1].ctype,b=A(a[1]);
if(d||z)return t;"variable"===a[0].ctype?L.setvar(a[0].name,b):"infix"===a[0].ctype?"_"===a[0].oper?D.assigntake(a[0],b):console.error("Can't use infix expression as lvalue"):"field"===a[0].ctype?D.assigndot(a[0],b):"function"===a[0].ctype&&"genList"===a[0].oper?"list"===b.ctype?D.assignlist(a[0].args,b.value):console.error("Expected list in rhs of assignment"):console.error("Left hand side of assignment is not a recognized lvalue");return b}function gb(a,m){var d=B(a[0]),z=B(a[1]);return"number"===
d.ctype&&"number"===z.ctype?{ctype:"boolean",value:d.value.real===z.value.real&&d.value.imag===z.value.imag}:"string"===d.ctype&&"string"===z.ctype||"boolean"===d.ctype&&"boolean"===z.ctype?{ctype:"boolean",value:d.value===z.value}:"list"===d.ctype&&"list"===z.ctype?g.equals(d,z):{ctype:"boolean",value:!1}}function sb(a,m){var d=B(a[0]),z=B(a[1]);return"number"===d.ctype&&"number"===z.ctype?{ctype:"boolean",value:k._helper.isAlmostEqual(d,z)}:"string"===d.ctype&&"string"===z.ctype||"boolean"===d.ctype&&
"boolean"===z.ctype?{ctype:"boolean",value:d.value===z.value}:"list"===d.ctype&&"list"===z.ctype?g.almostequals(d,z):{ctype:"boolean",value:!1}}function Wb(a,m){var d=B(a[0]),z=B(a[1]);return"boolean"===d.ctype&&"boolean"===z.ctype?{ctype:"boolean",value:d.value&&z.value}:t}function Xb(a,m){var d=B(a[0]),z=B(a[1]);return"boolean"===d.ctype&&"boolean"===z.ctype?{ctype:"boolean",value:d.value||z.value}:t}function Yb(a,m){var d=B(a[0]),z=B(a[1]),b=w.add(d,z);"Angle"===d.usage&&"Angle"===z.usage&&(b=
w.withUsage(b,"Angle"));return b}function tb(a,m){var d=B(a[0]),z=B(a[1]),b=w.sub(d,z);"Angle"===d.usage&&"Angle"===z.usage&&(b=w.withUsage(b,"Angle"));return b}function Zb(a,m){var d=B(a[0]),z=B(a[1]),b=w.mult(d,z);"Angle"!==d.usage||z.usage?"Angle"!==z.usage||d.usage||(b=w.withUsage(b,"Angle")):b=w.withUsage(b,"Angle");return b}function $b(a,m){var d=B(a[0]),z=B(a[1]);k._helper.isZero(z)&&ha.err("WARNING: Division by zero!");var b=w.div(d,z);"Angle"!==d.usage||z.usage?"Angle"!==z.usage||d.usage||
(b=w.withUsage(b,"Angle")):b=w.withUsage(b,"Angle");return b}function ic(a,m){var d=B(a[0]),z=B(a[1]);return"number"===d.ctype&&"number"===z.ctype?k.pow(d,z):t}function Bb(a){var m=a.length;if(0===m)return[];if(1===m)return[0];if(2===m)return a[0][0]+a[1][1]<=a[0][1]+a[1][0]?[0,1]:[1,0];if(4<m)return Mc(a);for(var d=Nc[m],z=Number.POSITIVE_INFINITY,b=d[0],c=0;c<d.length;++c){for(var g=d[c],e=0,f=0;f<m;++f)e+=a[f][g[f]];e<z&&(z=e,b=g)}return b}function Mc(a){function m(){return{matched:-1,prev:-1,
start:-1,cost:0,used:!1,leaf:!1}}function d(a){for(var m=0;m<c;++m)0<h[a][m]||k[m].used||(k[m].used=!0,d(k[m].matched))}function z(a){for(var d=0;d<c;++d)0<h[d][a]||f[d].used||(f[d].used=!0,z(f[d].matched))}var b=Math.abs,c=a.length,g,e,f=Array(c),k=Array(c),h=Array(c);for(g=0;g<c;++g)h[g]=Array(c);for(g=0;g<c;++g)for(f[g]=m(),k[g]=m(),f[g].cost=a[g][0],e=1;e<c;++e)f[g].cost>a[g][e]&&(f[g].cost=a[g][e]);for(;;){for(g=0;g<c;++g)for(e=0;e<c;++e)h[g][e]=a[g][e]-f[g].cost-k[e].cost,h[g][e]<1E-14*(b(a[g][e])+
b(f[g].cost)+b(k[e].cost))&&(h[g][e]=0);for(g=0;g<c;++g)f[g].matched=k[g].matched=-1;for(var l=0;;){for(g=0;g<c;++g)f[g].used=f[g].leaf=k[g].used=k[g].leaf=!1,-1===f[g].matched&&(f[g].start=g,f[g].used=f[g].leaf=!0,f[g].prev=-1);for(var n=!1,p=!1;!p;){for(g=0;g<c;++g)if(f[g].leaf)for(f[g].leaf=!1,e=0;e<c;++e)if(!(k[e].used||0<h[g][e])&&f[g].matched!==e&&(k[e].prev=g,k[e].start=f[g].start,k[e].used=k[e].leaf=!0,-1===k[e].matched)){f[k[e].start].prev=e;n=!0;break}if(n)break;p=!0;for(e=0;e<c;++e)k[e].leaf&&
(k[e].leaf=!1,g=k[e].matched,f[g].used||(f[g].prev=e,f[g].start=k[e].start,f[g].used=f[g].leaf=!0,p=!1))}if(!n)break;for(n=0;n<c;++n)if(-1===f[n].matched&&-1!==f[n].prev){e=f[n].prev;do g=k[e].prev,k[e].matched=g,f[g].matched=e,e=f[g].prev;while(g!==n);++l}}if(l===c)break;for(g=0;g<c;++g)f[g].used=f[g].leaf=k[g].used=k[g].leaf=!1;for(g=0;g<c;++g)-1===f[g].matched&&d(g);for(e=0;e<c;++e)-1===k[e].matched&&z(e);for(g=0;g<c;++g)-1===f[g].matched||f[g].used||k[f[g].matched].used||(f[g].used=!0);l=Number.POSITIVE_INFINITY;
for(g=0;g<c;++g)if(!f[g].used)for(e=0;e<c;++e)k[e].used||l>h[g][e]&&(l=h[g][e]);for(g=0;g<c;++g)f[g].used||(f[g].cost+=l),k[g].used&&(k[g].cost-=l)}a=Array(c);for(g=0;g<c;++g)e=f[g].matched,a[g]=e;return a}function Cb(a,m){var d=A(a[0]),z=B(a[1]);if("number"===z.ctype){var b=Math.floor(z.value.real);if("list"===d.ctype||"string"===d.ctype)return 0>b&&(b=d.value.length+b+1),0<b&&b<d.value.length+1?"list"===d.ctype?d.value[b-1]:{ctype:"string",value:d.value.charAt(b-1)}:t}if("list"===z.ctype){for(var b=
[],c=0;c<z.value.length;c++){var e=B(z.value[c]);b[c]=Cb([d,e],[])}return g.turnIntoCSList(b)}return t}function jc(a,m){var d=A(a[0]),z=A(a[1]);return"list"===d.ctype&&"list"===z.ctype?g.concat(d,z):"shape"===d.ctype&&"shape"===z.ctype?D.shapeconcat(d,z):t}function kc(a,m){var d=A(a[0]),z=A(a[1]);return"list"===d.ctype&&"list"===z.ctype?g.set(g.common(d,z)):"shape"===d.ctype&&"shape"===z.ctype?D.shapecommon(d,z):t}function lc(a,m){var d=A(a[0]),z=A(a[1]);return"list"===d.ctype&&"list"===z.ctype?g.remove(d,
z):"shape"===d.ctype&&"shape"===z.ctype?D.shaperemove(d,z):t}function mc(a,m){var d=A(a[0]),z=A(a[1]);return"list"===d.ctype?g.append(d,z):t}function nc(a,m){var d=A(a[0]),z=A(a[1]);return"list"===z.ctype?g.prepend(d,z):t}function Db(a,m){a|=0;m|=0;if(0===a&&0===m)return 0;for(;0!==m;){var d=a;a=m;m=d%m|0}return a}function Oc(a){return 1===a?0:1}function A(a){if("undefined"===typeof a)return t;if("infix"===a.ctype)return a.impl(a.args,{});if("variable"===a.ctype)return L.getvar(a.name);if("void"===
a.ctype||"geo"===a.ctype||"number"===a.ctype||"boolean"===a.ctype||"string"===a.ctype||"list"===a.ctype||"undefined"===a.ctype||"shape"===a.ctype)return a;if("field"===a.ctype){var m=A(a.obj);return"geo"===m.ctype?sa.getField(m.value,a.key):"list"===m.ctype?g.getField(m,a.key):t}return"function"===a.ctype?D.evaluate(a.oper,a.args,a.modifs):t}function B(a){a=A(a);if("geo"===a.ctype){var m=a.value;if("P"===m.kind)return sa.getField(m,"xy")}return a}function N(a){a=A(a);if("geo"===a.ctype){var m=a.value;
if("P"===m.kind||"L"===m.kind)return sa.getField(m,"homog")}return g._helper.isNumberVecN(a,3)?a:g._helper.isNumberVecN(a,2)?(m=g.turnIntoCSList([a.value[0],a.value[1],k.real(1)]),a.usage&&(m=w.withUsage(m,a.usage)),m):t}function bb(a){for(var m=!1,d=!1,z="",b=0;b<a.length;b++){var c=a[b];'"'!==c||d||(m=!m);"/"===c&&b!==a.length-1&&"/"===a[b+1]&&(d=!0);"\n"===c&&(d=!1);if(" "!==c&&"\t"!==c&&"\n"!==c&&"\f"!==c&&"\r"!==c&&!d||m)z+=c}return z}function oc(a,m,d){var z={ctype:"infix"};z.oper=a;z.impl=
T[a];z.args=[m,d];return z}function Pc(a){var m,d;if("function"!==a.ctype)return console.log("Invalid function name."),!1;for(m=0;m<a.args.length;m++)if("variable"!==a.args[m].ctype)return console.log("Argument is not a variable."),!1;for(m=0;m<a.args.length-1;m++)for(d=m+1;d<a.args.length;d++)if(a.args[m].name===a.args[d].name)return console.log("Variable name used twice."),!1;return!0}function pb(a){return""!==a&&!isNaN(a)}function Eb(a){return"["===a||"("===a||"{"===a||"|"===a}function Fb(a){return"]"===
a||")"===a||"}"===a||"|"===a}function Gb(a){var m,d=[],z=[],b=[];m=a+",";var c=m.length,g=0,e=0,f=!1,k=!1;for(a=e;a<c;a++){var h;h=m[a];'"'===h&&(k=!k);!k&&(!Eb(h)||"|"===h&&f?Fb(h)&&("|"!==h||f)&&(g--,"|"===h&&(f=!1)):(g++,"|"===h&&(f=!0)),","===h&&0===g||-1===g)&&(h=m.substring(e,a),d.push(h),z.push(e),e=a+1)}for(a=0;a<d.length;a++)if(z=d[a],""===z)b.push("nil");else{z=la(z,!1);if("error"===z.ctype)return z;b.push(z)}d={ctype:"function",oper:"genList"};d.args=b;d.modifs={};return d}function Qc(a){var m;
return"|"===a[0]?(a=Gb(a.substring(1,a.length-1)),m=a.args.length,1===m?(a.oper="abs_infix",a):2===m?(a.oper="dist_infix",a):t):"()"===a||"[]"===a?m={ctype:"list",value:[]}:"["===a[0]?Gb(a.substring(1,a.length-1)):"("===a[0]&&(m=Gb(a.substring(1,a.length-1)),1<m.args.length)?m:m=la(a.substring(1,a.length-1),!1)}function la(a,m){for(var d=!1,z="",b=-1,c=-1,g="",e=0,f=0,k=" ",h=" ",l=0,n=!1,p=a.length,q=0;q<p;q++){var r,u=" ",w=" ";0<l&&l--;r=a[q];q+1<p&&(u=a[q+1]);q+2<p&&(w=a[q+2]);'"'===r&&(d=!d);
if(!d){if(Eb(r)&&("|"!==r||!n))"|"===r&&(n=!0),z+=r,e++,1===e&&f++," "===k&&(k=r);else if(Fb(r)&&("|"!==r||n)){"|"===r&&(n=!1);if(0===e)return new x("close without open");h=z[z.length-1]+r;if("[]"===h||"()"===h||"{}"===h||"||"===h)e--,z=z.substring(0,z.length-1),h=r;else return new x("unmatched brackets")}if(0===z.length){var v=-1,y="";"undefined"!==typeof qb[r+u+w]&&0===l?(y=r+u+w,l=3):"undefined"!==typeof qb[r+u]&&0===l?(y=""+r+u,l=2):"undefined"!==typeof qb[r]&&0===l&&(y=""+r,l=1);""!==y&&(v=qb[y]);
v>=c&&(c=v,b=q,g=y,0<=v&&(q+=y.length-1))}}}if(0!==e)return new x("open without close");d=a.indexOf(k);z=a.lastIndexOf(h);if(0===e&&-1<c){if("->"===g)return c=g,g=a.substring(0,b),b=la(a.substring(b+c.length),!1),g="error"===b.ctype?b:{ctype:"modifier",key:g,value:b},g;if("."===g)return c=a.indexOf("."),e=a.lastIndexOf("."),(c!==e?0:-1===c?pb(a):pb(a.substring(0,c))||pb(a.substring(c+1)))?(g={},g.value={real:parseFloat(a),imag:0},g.ctype="number"):(c=la(a.substring(0,b),!1),g=a.substring(b+g.length),
g={ctype:"field",obj:c,key:g}),g;if(":="===g)return c=a.substring(0,b),c=la(c,!0),"error"===c.ctype?g=c:"variable"===c.cstring||Pc(c)?(b=a.substring(b+g.length),b=la(b,!1),g="error"===b.ctype?b:oc(g,c,b)):(console.log(["Function not definable",c]),g=new x("Function not definable")),g;c=la(a.substring(0,b),!1);b=la(a.substring(b+g.length),!1);g="error"===c.ctype?c:"error"===b.ctype?b:oc(g,c,b);return g}if(0===e&&1===f&&z===a.length-1){if(0===d)return Qc(a);a:{e=[];f=[];g=[];b={};c=a.substring(0,d);
z=a.length;k=0;h=d+1;n=l=!1;for(d=h;d<z;d++)if(p=a[d],'"'===p&&(l=!l),!l)if(!Eb(p)||"|"===p&&n?Fb(p)&&("|"!==p||n)&&(k--,"|"===p&&(n=!1)):(k++,"|"===p&&(n=!0)),","===p&&0===k||-1===k)p=a.substring(h,d),e.push(p),f.push(h),1!==e.length||-1!==k||e[0].length||(e=[],f=[]),h=d+1;for(d=0;d<e.length;d++){f=la(e[d],!1);if("error"===f.ctype){g=f;break a}"modifier"===f.ctype?b[f.key]=f.value:g.push(f)}e={ctype:"function"};e.oper=c+"$"+g.length;cc[e.oper]=!0;e.args=g;e.modifs=b;g=e}return g}return""===a?new Dc:
'"'===a.charAt(0)&&'"'===a.charAt(a.length-1)?{ctype:"string",value:a.substring(1,a.length-1)}:pb(a)?{ctype:"number",value:{real:parseInt(a),imag:0}}:L.isVariable(a)?L.vars[a]:L.isVariableName(a)?L.create(a):t}function Rc(a){for(var m in a)null!==a[m]&&(ra[m]=a[m])}function Gc(a){Object.keys(n).forEach(function(a){var d=n[a];Ia(d.signature||"_helper"===a,a+" has no signature");void 0!==d.updatePosition&&void 0===d.stateSize&&(d.stateSize=0)});F=[];l={};H=[];M=[];X=[];ba=[];a.forEach(rb);Sc()}function Hb(a){void 0===
a.size&&(a.size=ra.lineSize);a.size=k.real(a.size);a.color=g.realVector(a.color||ra.lineColor);void 0===a.alpha&&(a.alpha=ra.alpha);a.alpha=k.real(a.alpha);a.clip=w.string(a.clip||ra.clip);void 0===a.overhang&&(a.overhang=ra.overhangLine);a.overhang=k.real(a.overhang);a.dashtype&&(a.dashtype=w.wrap(a.dashtype))}function rb(a){var m;if(void 0!==l[a.name]){console.log("Element name '"+a.name+"' already exists");var d=l[a.name];n[d.type].isMovable&&Ja(d,a.pos,"homog");return{ctype:"geo",value:d}}if(d=
Tc[a.type]){a=d(a);d=null;for(m=0;m<a.length;++m)d=rb(a[m]);return d}d=n[a.type];if(!d)return console.error(a),console.error("Operation "+a.type+" not implemented yet"),null;if(d.signature.length!==(a.args?a.args.length:0))return window.alert("Wrong number of arguments for "+a.name),null;if(a.args)for(m=0;m<a.args.length;++m){if(!l.hasOwnProperty(a.args[m]))return console.log("Dropping "+a.name+" due to missing argument "+a.args[m]),null;var z=l[a.args[m]].kind;if(d.signature[m]!==z&&("S"!==z||"L"!==
d.signature[m]))return window.alert("Wrong argument kind "+z+" as argument "+m+" to element "+a.name+" of type "+a.type),null}d.signatureConstraints&&!d.signatureConstraints(a)&&window.alert("signature constraints violated for element "+a.name);F.push(a);l[a.name]=a;m=pa.length;a.kind=d.kind;a.stateIdx=m;m+=d.stateSize;a.incidences=[];a.isshowing=!0;a.movable=!1;d.isMovable&&(a.movable=!0,ba.push(a));"P"===a.kind&&(H.push(a),void 0===a.size&&(a.size=ra.pointSize),a.size=k.real(a.size),"Free"!==a.type?
(a.color=g.realVector(a.color||ra.pointColor),a.color=g.scalmult(k.real(ra.dimDependent),a.color)):a.color=g.realVector(a.color||ra.pointColor),void 0===a.alpha&&(a.alpha=ra.alpha),a.alpha=k.real(a.alpha),a.drawtrace&&("undefined"===typeof a.tracedim&&(a.tracedim=1),"undefined"===typeof a.tracelength&&(a.tracelength=100),"undefined"===typeof a.traceskip&&(a.traceskip=1),a._traces=Array(a.tracelength),a._traces_index=0,a._traces_tick=0));"L"===a.kind&&(M.push(a),Hb(a));"C"===a.kind&&(X.push(a),Hb(a));
"S"===a.kind&&(M.push(a),void 0===a.overhang&&(a.overhang=ra.overhangSeg),a.arrow&&(a.arrow=w.bool(a.arrow)),a.arrowsize&&(a.arrowsize=k.real(a.arrowsize)),a.arrowposition&&(a.arrowposition=k.real(a.arrowposition)),a.arrowshape&&(a.arrowshape=w.string(a.arrowshape)),a.arrowsides&&(a.arrowsides=w.string(a.arrowsides)),Hb(a),a.clip=w.string("end"));if(m!==pa.length){var b,c=Ib.length;Ka.length<m*c?(z=2*m,Ka=new Float64Array(c*z)):z=Ka.length/c|0;for(b=0;b<c;++b)Ga[Ib[b]]=Ka.subarray(b*z,b*z+m);m=pa;
da=Ga["in"];ta=Ga.out;pa=Ga.good;pa.set(m)}da=ta=pa;Sa=!0;d.initialize&&(ga=na=a.stateIdx,a.param=d.initialize(a),Ia(na===a.stateIdx+d.stateSize,"State fully initialized"));ga=na=a.stateIdx;d.updatePosition(a,!1);Ia(ga===a.stateIdx+d.stateSize,"State fully consumed");Ia(na===a.stateIdx+d.stateSize,"State fully updated");Sa=!1;da=Ga["in"];da.set(pa);ta=Ga.out;Jb(a,d);Kb={}}function pc(a,m){var d=l[m.args[0]].homog,z=l[m.args[1]].homog,b=a.homog,c=k.div(d.value[0],d.value[2]),d=k.div(d.value[1],d.value[2]),
g=k.div(z.value[0],z.value[2]),z=k.div(z.value[1],z.value[2]),e=k.div(b.value[0],b.value[2]),b=k.div(b.value[1],b.value[2]);return k._helper.isAlmostReal(c)&&k._helper.isAlmostReal(d)&&k._helper.isAlmostReal(g)&&k._helper.isAlmostReal(z)&&k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(b)?(c=c.value.real,d=d.value.real,g=g.value.real,z=z.value.real,e=e.value.real,b=b.value.real,c=Math.sqrt((c-g)*(c-g)+(d-z)*(d-z))-Math.sqrt((c-e)*(c-e)+(d-b)*(d-b))-Math.sqrt((g-e)*(g-e)+(z-b)*(z-b)),1E-15>c*c):
!1}function Jb(a,m){a.isshowing=!0;if(a.args)for(var d=0;d<a.args.length;d++)if(!l[a.args[d]].isshowing){a.isshowing=!1;return}m.visiblecheck&&m.visiblecheck(a)}function Sc(){for(var a=0;a<M.length;a++)for(var m=M[a],d=0;d<H.length;d++){var b=H[d],c=g.scaldiv(g.abs(b.homog),b.homog),e=g.scaldiv(g.abs(m.homog),m.homog);1E-13>k.abs(g.scalproduct(c,e)).value.real&&(b.incidences.push(m.name),m.incidences.push(b.name))}}function Lc(){function a(a){if(a.isshowing&&!1!==a.visible&&g._helper.isAlmostReal(a.homog)){var d=
a.color;a.behavior&&(d=a.color);u.draw$1([a.homog],{size:a.size,color:d,alpha:a.alpha});if(a.labeled){var d=a.printname||a.name||"P",m=a.labelpos||{x:3,y:3},b=a.textsize||12,z=!0===a.textbold,c=!0===a.textitalics,ia=a.text_fontfamily||ra.fontFamily,e=m.x*m.x+m.y*m.y,f=1;0<e&&(f=1+a.size.value.real/Math.sqrt(e));u.drawtext$2([a.homog,w.wrap(d)],{x_offset:w.wrap(f*m.x),y_offset:w.wrap(f*m.y),size:w.wrap(b),bold:w.wrap(z),italics:w.wrap(c),family:w.wrap(ia)})}}}function m(a){if(a.isshowing&&!1!==a.visible){var d=
{};d.color=a.color;d.alpha=a.alpha;d.size=a.size;D.drawarc(a,d,a.filled?"F":"D")}}function d(a){if(a.isshowing&&!1!==a.visible){var d={};d.color=a.color;d.alpha=a.alpha;d.size=a.size;D.drawconic(a.matrix,d)}}function b(a){var d,m;if(a.isshowing&&!1!==a.visible&&g._helper.isAlmostReal(a.homog))if("S"===a.kind)u.draw$2([a.startpos,a.endpos],{overhang:a.overhang,dashtype:a.dashtype,size:a.size,color:a.color,alpha:a.alpha,arrow:a.arrow,arrowsize:a.arrowsize,arrowposition:a.arrowposition,arrowshape:a.arrowshape,
arrowsides:a.arrowsides});else if("end"===a.clip.value&&"Join"===a.type)d=l[a.args[0]],m=l[a.args[1]],u.draw$2([d.homog,m.homog],{overhang:a.overhang,dashtype:a.dashtype,size:a.size,color:a.color,alpha:a.alpha});else{if("inci"===a.clip.value){d=[1E6,0];m=[-1E6,0];for(var z=[1E6,0],c=[-1E6,0],ia=0;ia<a.incidences.length;ia++){var e=l[a.incidences[ia]].homog,f=e.value[0],h=e.value[1],n=e.value[2];k._helper.isAlmostZero(n)||(f=k.div(f,n),h=k.div(h,n),k._helper.isAlmostReal(f)&&k._helper.isAlmostReal(h)&&
(f.value.real<d[0]&&(d=[f.value.real,e]),f.value.real>m[0]&&(m=[f.value.real,e]),h.value.real<z[0]&&(z=[h.value.real,e]),h.value.real>c[0]&&(c=[h.value.real,e])))}m[0]-d[0]>c[0]-z[0]?(d=d[1],m=m[1]):(d=z[1],m=c[1]);if(d!==m){u.draw$2([d,m],{dashtype:a.dashtype,size:a.size,color:a.color,alpha:a.alpha,overhang:a.overhang});return}}u.draw$1([a.homog],{dashtype:a.dashtype,size:a.size,color:a.color,alpha:a.alpha})}}var c;for(c=0;c<X.length;c++)X[c].isArc?m(X[c]):d(X[c]);for(c=0;c<M.length;c++)b(M[c]);
for(c=0;c<H.length;c++)a(H[c])}function Kc(){function a(){var a=f++/d._traces.length,m=d._traces[e];m&&(a*=b*a*a,u.draw$1([m],{size:k.real(c),color:d.color,alpha:k.real(a)}));c*=g}for(var m=0;m<H.length;m++){var d=H[m];if(d.drawtrace){d._traces_tick===d.traceskip?(d._traces[d._traces_index]=d.homog,d._traces_index=(d._traces_index+1)%d._traces.length,d._traces_tick=0):d._traces_tick++;var b=d.alpha.value.real,c=d.size.value.real,g=1;1!==d.tracedim&&(c*=d.tracedim,g=Math.pow(d.tracedim,-1/d._traces.length));
var e,f=0;for(e=d._traces_index;e<d._traces.length;++e)a();for(e=0;e<d._traces_index;++e)a()}}}function Ia(a,m){var d="Assertion failed: "+m;if(!a)throw console.log(d),ya(),"undefined"!==typeof alert&&alert(d),Error(d);}function Ra(){pa.set(da);qc(!1);for(var a=pa.length,m=Math.abs,d=0;d<a;d+=2)m(pa[d])>1E12*m(pa[d+1])&&(pa[d+1]=0)}function Lb(){if(Ya)ua=!0;else throw rc;}function sc(a,m,d,b,c){return w.add(b,w.mult(d,w.sub(c,b)))}function Jc(){J&&(J.currentMouseAndScripts=[]);Mb=!0;ua=!1;da.set(pa);
if(ea){var a=ea.mover,m=g.realVector([V.x+ea.offset.x,V.y+ea.offset.y,1]);Nb(a,m,"mouse");ea.prev.x=V.x;ea.prev.y=V.y}A(ja.move);A(ja.draw);ua||Ra();Mb=!1;J&&(J.fullLog.push(g.turnIntoCSList([g.turnIntoCSList(J.currentMouseAndScripts)])),J.length>J.logLength&&J.splice(0,J.length-J.logLength),J.currentMouseAndScripts=null,J.postMouseHooks.forEach(function(a){a()}))}function Ja(a,m,d){Mb?Nb(a,m,d):(Ra(),ua=!1,Nb(a,m,d),Ra())}function Nb(a,m,d){J&&J.currentMouseAndScripts&&(J.currentMover=[]);ta.set(da);
var b=1E4,c;c=Kb[a.name];if(!c){var e={},f=0;c=[];e[a.name]=a;for(var h=F,l=0;l<h.length;++l){var p=h[l],q=p.args;if(q)for(var r=0;r<q.length;++r)e.hasOwnProperty(q[r])&&(e[p.name]=p,c[f++]=p)}Kb[a.name]=c}var e=-1,f=.9,t,u,v,h=n[a.type],l=h.parameterPath||sc;ga=a.stateIdx;p=h.getParamFromState(a);ga=na=a.stateIdx;q=h.getParamForInput(a,m,d);for(r=e+f;e!==r;){var y=r*r,x=.5/(1+y),x=k.complex(2*r*x+.5,(1-y)*x);Ya=e+.5*f<=e||0===b;0===b&&console.log("tracing limit Reached");y=!1;J&&J.currentMouseAndScripts&&
(J.currentStep=[]);try{ga=na=a.stateIdx;var A=l(a,r,x,p,q);J&&(J.currentParam=A);x=ta;ta=da;h.putParamToState(u,A);ta=x;na=a.stateIdx;J&&(J.currentElement=a);h.updatePosition(a,!0);Ia(ga===a.stateIdx+h.stateSize,"State fully consumed");Ia(na===a.stateIdx+h.stateSize,"State fully updated");for(t=0;t<c.length;++t)u=c[t],v=n[u.type],ga=na=u.stateIdx,J&&(J.currentElement=u),v.updatePosition(u,!1),Ia(ga===u.stateIdx+v.stateSize,"State fully consumed"),Ia(na===u.stateIdx+v.stateSize,"State fully updated");
J&&(J.currentElement=null);e=r;f*=1.25;r+=f;1<=r&&(r=1);ta=da;da=x}catch(C){if(C!==rc)throw C;f*=.5;r=e+f;--b;y=!0}J&&J.currentMouseAndScripts&&(J.currentMover.push(g.turnIntoCSList([g.turnIntoCSList(J.currentStep),w.wrap(y),w.wrap(e),w.wrap(r),w.wrap(J.currentParam)])),J.currentStep=null,J.currentParam=null)}qc(ua);for(t=0;t<c.length;++t)u=c[t],v=n[u.type],Jb(u,v);J&&J.currentMouseAndScripts&&(J.currentMouseAndScripts.push(g.turnIntoCSList([g.turnIntoCSList(J.currentMover),w.wrap(ua),w.wrap(a.name),
m,w.wrap(d),p,q])),J.currentMover=null)}function Hc(){Ra();Ya=!0;for(var a=F,m=0;m<a.length;m++){var d=a[m],b=n[d.type];ga=na=d.stateIdx;b.updatePosition(d,!1);Jb(d,b)}a=ta;ta=da;da=a;Ra()}function qc(a){var m=r.tracingStateReport;"string"===typeof m&&(document.getElementById(m).textContent=a?"BAD":"GOOD")}function Uc(){return g.turnIntoCSList(J.fullLog.slice())}function Vc(a){var m=JSON.stringify(J.fullLog);a=new Blob([m],{type:a?"application/octet-stream":"application/json"});return window.URL.createObjectURL(a)}
function eb(){var a=ga;ga+=2;return k.complex(da[a],da[a+1])}function W(a){for(var m=Array(a),d=0;d<a;++d)m[d]=eb();return g.turnIntoCSList(m)}function Ta(a){ta[na]=a.value.real;ta[na+1]=a.value.imag;na+=2}function Q(a){for(var m=0,d=a.value.length;m<d;++m)Ta(a.value[m])}function Aa(a,m){var d=W(3),b=W(3),d=tc(a,m,d,b);Q(d[0]);Q(d[1]);return g.turnIntoCSList(d)}function tc(a,m,d,b){if(Sa)return[a,m];var c=g.projectiveDistMinScal(d,a),e=g.projectiveDistMinScal(d,m),f=g.projectiveDistMinScal(b,a),k=
g.projectiveDistMinScal(b,m),h=g.projectiveDistMinScal(d,b),l=g.projectiveDistMinScal(a,m),n=c+k,p=e+f,q;n>p?(q=[m,a],n=p):q=[a,m];p=function(){};if(J&&J.currentStep){var r=[J.labelTracing2,w.wrap(J.currentElement.name),g.turnIntoCSList(q),g.turnIntoCSList([d,b]),g.realMatrix([[c,e],[f,k]]),w.wrap(n),w.wrap(h),w.wrap(l),t];J.currentStep.push(g.turnIntoCSList(r));p=function(a){J.hasOwnProperty(a)||(J[a]=w.wrap(a));r[r.length-1]=J[a]}}g._helper.isNaN(a)||g._helper.isNaN(m)?(p("Tracing failed due to NaNs."),
ua=!0):h>3*n&&l>3*n?p("Normal case, everything all right."):1E-5>l?1E-5>h?p("Staying inside singularity."):(p("Moved into singularity."),ua=!0):1E-5>h?p("Moved out of singularity."):(Ya?p("Reached refinement limit, giving up."):p("Need to refine."),Lb());return q}function Ob(a,m,d,b){var c=W(3),e=W(3),f=W(3),h=W(3);a=Wc(a,m,d,b,c,e,f,h);Q(a[0]);Q(a[1]);Q(a[2]);Q(a[3]);return g.turnIntoCSList(a)}function Wc(a,m,d,b,c,e,f,h){var k=function(){};c=[c,e,f,h];a=[a,m,d,b];if(Sa)return a;e=0;b=Array(4);for(d=
0;4>d;d++)for(b[d]=Array(4),h=0;4>h;h++)f=g.projectiveDistMinScal(c[d],a[h]),b[d][h]=f;f=Bb(b);m=Array(4);for(d=0;4>d;++d)m[d]=a[f[d]],e+=b[d][f[d]];var l=1*e,n=Infinity,p=Infinity;for(d=0;4>d;d++){if(g._helper.isNaN(a[d]))return k("Tracing failed due to NaNs."),ua=!0,m;for(h=d+1;4>h;h++)f=g.projectiveDistMinScal(c[d],c[h]),n>f&&(n=f),f=g.projectiveDistMinScal(m[d],m[h]),p>f&&(p=f)}if(J&&J.currentStep){var q=[J.labelTracing4,w.wrap(J.currentElement.name),g.turnIntoCSList(m),g.turnIntoCSList(c),g.realMatrix(b),
w.wrap(e),w.wrap(n),w.wrap(p),t];J.currentStep.push(g.turnIntoCSList(q));k=function(a){J.hasOwnProperty(a)||(J[a]=w.wrap(a));q[q.length-1]=J[a]}}n>l&&p>l||(1E-5>p?1E-5>n?k("Staying inside singularity."):(k("Moved into singularity."),ua=!0):1E-5>n?k("Moved out of singularity."):(Ya?k("Reached refinement limit, giving up."):k("Need to refine."),Lb()));return m}function uc(a){var m=a.length,d,b;if(Sa){for(d=0;d<m;++d)ga+=2*a[d].value.length,Q(a[d]);return a}var c=Array(m),e=Array(m),f=Array(m),h=99,
k=99,l=Array(m);for(d=0;d<m;++d)c[d]=W(a[d].value.length),e[d]=g.normSquared(c[d]).value.real,f[d]=g.normSquared(a[d]).value.real,l[d]=Array(m);var n;for(d=0;d<m;++d){for(b=0;b<m;++b)n=g.sesquilinearproduct(c[d],a[b]).value,n=(n.real*n.real+n.imag*n.imag)/(e[d]*f[b]),l[d][b]=1-n;for(b=d+1;b<m;++b)n=g.sesquilinearproduct(c[d],c[b]).value,n=(n.real*n.real+n.imag*n.imag)/(e[d]*e[b]),h>1-n&&(h=1-n),n=g.sesquilinearproduct(a[d],a[b]).value,n=(n.real*n.real+n.imag*n.imag)/(f[d]*f[b]),k>1-n&&(k=1-n)}n=Bb(l);
b=Array(m);e=0;f=!1;for(d=0;d<m;++d){var e=e+l[d][n[d]],p=b[d]=a[n[d]];Q(p);f|=g._helper.isNaN(p)}f|=isNaN(e);a=function(){};if(J&&J.currentStep){var q=[J.labelTracingSesq,w.wrap(J.currentElement.name),g.turnIntoCSList(b),g.turnIntoCSList(c),g.realMatrix(l),w.wrap(e),w.wrap(h),w.wrap(k),t];J.currentStep.push(g.turnIntoCSList(q));a=function(a){J.hasOwnProperty(a)||(J[a]=w.wrap(a));q[q.length-1]=J[a]}}f?(a("Tracing failed due to NaNs."),ua=!0):h>3*e&&k>3*e?a("Normal case, everything all right."):1E-5>
k?1E-5>h?a("Staying inside singularity."):(a("Moved into singularity."),ua=!0):1E-5>h?a("Moved out of singularity."):(Ya?a("Reached refinement limit, giving up."):a("Need to refine."),Lb());return b}function Xc(a){if(!/^Select/.test(a.type)&&!n[a.type].isMovable)return null;var m=w.unwrap,d=k.sum;switch(a.kind){case "P":case "L":return m(a.homog);case "C":return a=a.mat.value,{xx:m(a[0].value[0]),yy:m(a[1].value[1]),zz:m(a[2].value[2]),xy:m(d(a[0].value[1],a[1].value[0])),xz:m(d(a[0].value[2],a[2].value[0])),
yz:m(d(a[1].value[2],a[2].value[1]))};default:return null}}function Yc(a){var m={};Zc.forEach(function(d){if(a.hasOwnProperty(d)){var b=w.unwrap(a[d]);null!==b&&void 0!==b&&(m[d]=b)}});var d=Xc(a);d&&(m.pos=d);return m}function $c(){var a=[];F.forEach(function(m){m.tmp||a.push(Yc(m))});return a}function Ic(a){ma.forEach(function(a){K[a.behavior.type].init(a.behavior,l[a.name])})}function xb(a){yb=0!==a.length;ma=a;Y=[];ma.forEach(function(a){if(a.name){var d=a.name;l[d]&&(l[d].behavior=a.behavior,
K[a.behavior.type].init(a.behavior,l[d]),"Mass"===a.behavior.type&&Y.push(l[d]))}else K[a.behavior.type].init(a.behavior)})}var wa=this,ha,ja={},za=!1,jb=!0,kb=!1,hb=1,Fa=0,ac,bc=!1,ab,C,fa,Z,oa,dc=1,db=null,Fc="           #drawgrid(s):=(              regional(b,xmin,xmax,ymin,ymax,nx,ny);              b=screenbounds();              xmin=b_4_1-s;              xmax=b_2_1+s;              ymin=b_4_2-s;              ymax=b_2_2+s;              nx=round((xmax-xmin)/s);              ny=round((ymax-ymin)/s);              xmin=floor(xmin/s)*s;              ymin=floor(ymin/s)*s;              repeat(nx,x,                 draw((xmin+x*s,ymin),(xmin+x*s,ymax),color->(1,1,1)*.9,size->1);              );              repeat(ny,y,                 draw((xmin,ymin+y*s),(xmax,ymin+y*s),color->(1,1,1)*.9,size->1);              )            );",
Wa=[],zb=!1,qa={config:r,startup:va,shutdown:ya,evokeCS:function(a){a=bb(a);a=la(a,!1);console.log(a);A(a);b()},play:U,pause:R,stop:Oa,evalcs:function(a){return A(la(bb(a),!1))},niceprint:I,canvas:null},ub=!1,ib=0;r.use&&r.use.forEach(function(a){var m=null;r.plugins&&(m=r.plugins[a]);m||(m=wa._pluginRegistry[a]);m||(++ib,console.log("Loading script for plugin "+a),wa.loadScript(a+"-plugin",a+"-plugin.js",function(){console.log("Successfully loaded plugin "+a);0===--ib&&ub&&va()},function(){console.error("Failed to auto-load plugin "+
a);0===--ib&&ub&&va()}))});Pa.prototype=new Da;Ea.prototype=new Da;Va.prototype=new Da;var V={},ea,ec="",fc=0,ad=[].slice,Pb,vc=function(a){return ad.call(a)};if(!r.isNode){var bd=document.documentElement;Pb=window;try{vc(bd.childNodes)[0].nodeType}catch(a){vc=function(a){for(var d=a.length,b=Array(d);d--;)b[d]=a[d];return b}}}var gc="webkit ms moz Moz o O".split(" "),Ab={},nb,ob,mb,lb,Ha,hc=!r.isNode&&Pb[e(Pb,"requestAnimationFrame")]||function(a){setTimeout(a,17)};Ab.timer=function(a,m,d){var b=
arguments.length;2>b&&(m=0);3>b&&(d=Date.now());b={c:a,t:d+m,f:!1,n:null};ob?ob.n=b:nb=b;ob=b;mb||(lb=clearTimeout(lb),mb=1,hc(h))};Ab.timer.flush=function(){q();p()};var cd=[0,0,0,-1,"gb292c8b"],t=new E,Qb=new E,L=new function(){this.vars={pi:{ctype:"variable",stack:[{ctype:"number",value:{real:Math.PI,imag:0}}],name:"pi"},i:{ctype:"variable",stack:[{ctype:"number",value:{real:0,imag:1}}],name:"i"},"true":{ctype:"variable",stack:[{ctype:"boolean",value:!0}],name:"true"},"false":{ctype:"variable",
stack:[{ctype:"boolean",value:!1}],name:"false"},"#":{ctype:"variable",stack:[t],name:"#"}};this.isVariable=function(a){return void 0!==this.vars[a]};this.isVariableName=function(a){if("#"===a||"#1"===a||"#2"===a)return!0;var m=/^[a-z,A-Z]+$/.test(a[0]);a=/^[0-9,a-z,A-Z]+$/.test(a);return m&&a};this.create=function(a){var m={ctype:"variable",stack:[Qb],name:a};return this.vars[a]=m};this.newvar=function(a){a=this.vars[a];a.stack.push(t);return a};this.removevar=function(a){var m=this.vars[a].stack;
0===m.length&&console.error("Removing non-existing "+a);m.pop();0===m.length&&console.warn("Removing last "+a)};this.setvar=function(a,m){var d=this.vars[a].stack;0===d.length&&console.error("Setting non-existing variable "+a);void 0===m&&(console.error("Setting variable "+a+" to undefined value"),m=t);if("undefined"===m.ctype)d[d.length-1]=m;else{var b=m;b===Qb&&(b=t);d[d.length-1]=b}};this.undefinedWarning={};this.getvar=function(a){var m=this.vars[a].stack;0===m.length&&console.error("Getting non-existing variable "+
a);m=m[m.length-1];if(m===Qb){if(void 0!==l[a])return{ctype:"geo",value:l[a]};console&&console.log&&void 0===this.undefinedWarning[a]&&(this.undefinedWarning[a]=!0,console.log("Warning: Accessing undefined variable: "+a));return t}return m};this.dump=function(a){var m=this.vars[a].stack;console.log("*** Dump "+a);for(a=0;a<m.length;a++)console.log(a+":> "+I(m[a]))};this.vstack=[];this.pushVstack=function(a){this.vstack.push(a)};this.popVstack=function(){this.vstack.pop()};this.cleanVstack=function(){for(var a=
this.vstack;0<a.length&&"*"!==a[a.length-1];)this.removevar(a[a.length-1]),a.pop();0<a.length&&a.pop()}},sa={generalFields:{color:"color",colorhsb:"",size:"size",alpha:"alpha",isshowing:"isshowing",visible:"visible",name:"name",caption:"caption",trace:"trace",tracelength:"",selected:""},getGeoField:function(a,m){return"undefined"!==typeof l[a]?sa.getField(l[a],m):t},setGeoField:function(a,m,d){return"undefined"!==typeof l[a]?sa.setField(l[a],m,d):t},getField:function(a,m){var d;if("P"===a.kind){if("xy"===
m){d=k.div(a.homog.value[0],a.homog.value[2]);var b=k.div(a.homog.value[1],a.homog.value[2]);d=g.turnIntoCSList([d,b]);return w.withUsage(d,"Point")}if("homog"===m)return w.withUsage(a.homog,"Point");if("x"===m)return k.div(a.homog.value[0],a.homog.value[2]);if("y"===m)return k.div(a.homog.value[1],a.homog.value[2])}if("L"===a.kind||"S"===a.kind){if("homog"===m)return w.withUsage(a.homog,"Line");if("angle"===m)return d=g.eucangle(g.ey,a.homog),w.withUsage(d,"Angle")}if("Tr"===a.kind&&"matrix"===m)return a.matrix;
if("C"===a.kind){if("radius"===m){var c=a.matrix;d=c.value[0].value[0];var e=c.value[0].value[2],b=c.value[1].value[2],c=c.value[2].value[2];k.mult(d,d);e=k.div(e,d);b=k.div(b,d);d=k.div(c,d);return d=k.sqrt(k.sub(k.add(k.mult(e,e),k.mult(b,b)),d))}if("size"===m)return a.size;if("matrix"===m)return a.matrix;if("center"===m)return d=n._helper.CenterOfConic(a.matrix),w.withUsage(d,"Point");if("dualMatrix"===m)return g.normalizeMax(g.adjoint3(a.matrix))}if(sa.generalFields[m])return(d=a[sa.generalFields[m]])&&
d.ctype?d:"object"!==typeof d?w.wrap(d):t;if(a.behavior){if("mass"===m&&"Mass"===a.behavior.type)return k.real(a.behavior.mass);if("radius"===m&&"Mass"===a.behavior.type)return k.real(a.behavior.radius);if("charge"===m&&"Mass"===a.behavior.type)return k.real(a.behavior.charge);if("friction"===m&&"Mass"===a.behavior.type)return k.real(a.behavior.friction);if("vx"===m&&"Mass"===a.behavior.type)return k.real(a.behavior.vx);if("vy"===m&&"Mass"===a.behavior.type)return k.real(a.behavior.vy);if("v"===m&&
"Mass"===a.behavior.type)return g.realVector([a.behavior.vx,a.behavior.vy]);if("fx"===m&&"Mass"===a.behavior.type)return k.real(a.behavior.fx);if("fy"===m&&"Mass"===a.behavior.type)return k.real(a.behavior.fy);if("f"===m&&"Mass"===a.behavior.type)return g.realVector([a.behavior.fx,a.behavior.fy])}return t},setField:function(a,m,d){"color"===m&&(a.color=d);"size"===m&&(a.size=d);"alpha"===m&&(a.alpha=d);"visible"===m&&"boolean"===d.ctype&&(a.visible=d.value);"pinned"===m&&"boolean"===d.ctype&&(a.pinned=
d.value);"printlabel"===m&&(a.printname=I(d));"xy"===m&&"P"===a.kind&&a.movable&&g._helper.isNumberVecN(d,2)&&Ja(a,g.turnIntoCSList([d.value[0],d.value[1],k.real(1)]),"homog");"xy"===m&&"P"===a.kind&&a.movable&&g._helper.isNumberVecN(d,3)&&Ja(a,d,"homog");"x"===m&&"P"===a.kind&&a.movable&&"number"===d.ctype&&Ja(a,g.turnIntoCSList([k.mult(d,a.homog.value[2]),a.homog.value[1],a.homog.value[2]]),"homog");"y"===m&&"P"===a.kind&&a.movable&&"number"===d.ctype&&Ja(a,g.turnIntoCSList([a.homog.value[0],k.mult(d,
a.homog.value[2]),a.homog.value[2]]),"homog");"homog"===m&&"P"===a.kind&&a.movable&&g._helper.isNumberVecN(d,3)&&Ja(a,d,"homog");if("angle"===m&&"Through"===a.type){var b=k.cos(d),c=k.sin(d),b=g.turnIntoCSList([b,c,k.real(0)]);Ja(a,b,"dir")}a.behavior&&("mass"===m&&"Mass"===a.behavior.type&&"number"===d.ctype&&(a.behavior.mass=d.value.real),"mass"===m&&"Sun"===a.behavior.type&&"number"===d.ctype&&(a.behavior.mass=d.value.real),"friction"===m&&"Mass"===a.behavior.type&&"number"===d.ctype&&(a.behavior.friction=
d.value.real),"charge"===m&&"Mass"===a.behavior.type&&"number"===d.ctype&&(a.behavior.charge=d.value.real),"radius"===m&&"Mass"===a.behavior.type&&"number"===d.ctype&&(a.behavior.radius=d.value.real),"vx"===m&&"Mass"===a.behavior.type&&"number"===d.ctype&&(a.behavior.vx=d.value.real),"vy"===m&&"Mass"===a.behavior.type&&"number"===d.ctype&&(a.behavior.vy=d.value.real),"v"===m&&"Mass"===a.behavior.type&&g._helper.isNumberVecN(d,2)&&(a.behavior.vx=d.value[0].value.real,a.behavior.vy=d.value[1].value.real))}},
k={_helper:{}};k._helper.roundingfactor=1E4;k._helper.angleroundingfactor=10;k._helper.niceround=function(a,m){return Math.round(a*m)/m};k.niceprint=function(a,m){m=m||k._helper.roundingfactor;if("Angle"===a.usage)return k._helper.niceangle(a);var d=k._helper.niceround(a.value.real,m),b=k._helper.niceround(a.value.imag,m);return 0===b?""+d:0<b?""+d+" + i*"+b:""+d+" - i*"+-b};var Rb=r.angleUnit||"\u00b0",dd=Rb.replace(/\s+/g,""),wc=2*Math.PI,ed=1/wc,fd={rad:wc,"\u00b0":360,deg:360,degree:360,gra:400,
grad:400,turn:1,cyc:1,rev:1,rot:1,"\u03c0":2,pi:2,quad:4};k._helper.niceangle=function(a){var m=fd[dd];if(!m)return k.niceprint(w.withUsage(a,null));if("function"===typeof m)return m(a);a=k.niceprint(k.realmult(m*ed,a),200<m?k._helper.angleroundingfactor:null);return-1===a.indexOf("i*")?a+Rb:"("+a+")"+Rb};k.complex=function(a,m){return{ctype:"number",value:{real:a,imag:m}}};k.real=function(a){return{ctype:"number",value:{real:a,imag:0}}};k.zero=k.real(0);k.one=k.real(1);k.infinity=k.complex(Infinity,
Infinity);k.nan=k.complex(NaN,NaN);k._helper.input=function(a){return"object"===typeof a?k.complex(+a.r,+a.i):k.real(+a)};k.argmax=function(a,m){return a.value.real*a.value.real+a.value.imag*a.value.imag<m.value.real*m.value.real+m.value.imag*m.value.imag?m:a};k.max=function(a,m){return{ctype:"number",value:{real:Math.max(a.value.real,m.value.real),imag:Math.max(a.value.imag,m.value.imag)}}};k.min=function(a,m){return{ctype:"number",value:{real:Math.min(a.value.real,m.value.real),imag:Math.min(a.value.imag,
m.value.imag)}}};k.add=function(a,m){return{ctype:"number",value:{real:a.value.real+m.value.real,imag:a.value.imag+m.value.imag}}};k.sub=function(a,m){return{ctype:"number",value:{real:a.value.real-m.value.real,imag:a.value.imag-m.value.imag}}};k.neg=function(a){return{ctype:"number",value:{real:-a.value.real,imag:-a.value.imag}}};k.re=function(a){return{ctype:"number",value:{real:a.value.real,imag:0}}};k.im=function(a){return{ctype:"number",value:{real:a.value.imag,imag:0}}};k.conjugate=function(a){return{ctype:"number",
value:{real:a.value.real,imag:-a.value.imag}}};k.round=function(a){return{ctype:"number",value:{real:Math.round(a.value.real),imag:Math.round(a.value.imag)}}};k.ceil=function(a){return{ctype:"number",value:{real:Math.ceil(a.value.real),imag:Math.ceil(a.value.imag)}}};k.floor=function(a){return{ctype:"number",value:{real:Math.floor(a.value.real),imag:Math.floor(a.value.imag)}}};k.mult=function(a,m){return{ctype:"number",value:{real:a.value.real*m.value.real-a.value.imag*m.value.imag,imag:a.value.real*
m.value.imag+a.value.imag*m.value.real}}};k.realmult=function(a,m){return{ctype:"number",value:{real:a*m.value.real,imag:a*m.value.imag}}};k.multiMult=function(a){var m=a[0];if("number"!==m.ctype)return t;for(var d=1;d<a.length;d++){if("number"!==a[d].ctype)return t;m=k.mult(m,a[d])}return m};k.abs2=function(a,m){return{ctype:"number",value:{real:a.value.real*a.value.real+a.value.imag*a.value.imag,imag:0}}};k.abs=function(a){return k.sqrt(k.abs2(a))};k.inv=function(a){var m=a.value.real*a.value.real+
a.value.imag*a.value.imag;return{ctype:"number",value:{real:a.value.real/m,imag:-a.value.imag/m}}};k.div=function(a,m){return k.mult(a,k.inv(m))};k.eps=1E-7;k.snap=function(a){var m=a.value.real;a=a.value.imag;Math.floor(m+k.eps)!==Math.floor(m-k.eps)&&(m=Math.round(m));Math.floor(a+k.eps)!==Math.floor(a-k.eps)&&(a=Math.round(a));return{ctype:"number",value:{real:m,imag:a}}};k.exp=function(a){var m=Math.exp(a.value.real);return{ctype:"number",value:{real:m*Math.cos(a.value.imag),imag:m*Math.sin(a.value.imag)}}};
k.cos=function(a){var m=a.value.real;a=a.value.imag;var d=Math.exp(a),b=d*Math.sin(-m),c=d*Math.cos(-m),d=Math.exp(-a);return{ctype:"number",value:{real:(c+d*Math.cos(m))/2,imag:(b+d*Math.sin(m))/2}}};k.sin=function(a){var m=a.value.real;a=a.value.imag;var d=Math.exp(a),b=d*Math.sin(-m),c=d*Math.cos(-m),d=Math.exp(-a);return{ctype:"number",value:{real:-(b-d*Math.sin(m))/2,imag:(c-d*Math.cos(m))/2}}};k.tan=function(a){var m=k.sin(a);a=k.cos(a);return k.div(m,a)};k.arccos=function(a){var m=k.mult(a,
k.neg(a)),m=k.sqrt(k.add(k.real(1),m));a=k.add(k.mult(a,k.complex(0,1)),m);a=k.add(k.mult(k.log(a),k.complex(0,1)),k.real(.5*Math.PI));return w.withUsage(a,"Angle")};k.arcsin=function(a){var m=k.mult(a,k.neg(a)),m=k.sqrt(k.add(k.real(1),m));a=k.add(k.mult(a,k.complex(0,1)),m);a=k.mult(k.log(a),k.complex(0,-1));return w.withUsage(a,"Angle")};k.arctan=function(a){var m=k.log(k.add(k.mult(a,k.complex(0,-1)),k.real(1)));a=k.log(k.add(k.mult(a,k.complex(0,1)),k.real(1)));m=k.mult(k.sub(m,a),k.complex(0,
.5));return w.withUsage(m,"Angle")};k.arctan2=function(a,m){var d;if(void 0===m)d=k.real(Math.atan2(a.value.imag,a.value.real));else if(k._helper.isReal(a)&&k._helper.isReal(m))d=k.real(Math.atan2(m.value.real,a.value.real));else{d=k.add(a,k.mult(k.complex(0,1),m));var b=k.sqrt(k.add(k.mult(a,a),k.mult(m,m)));d=k.mult(k.complex(0,-1),k.log(k.div(d,b)))}return w.withUsage(d,"Angle")};k.sqrt=function(a){var m=a.value.real,d=a.value.imag;a=Math.sqrt(Math.sqrt(m*m+d*d));m=Math.atan2(d,m);return{ctype:"number",
value:{real:a*Math.cos(m/2),imag:a*Math.sin(m/2)}}};k.powRealExponent=function(a,m){var d=a.value.real,b=a.value.imag,c=Math.pow(Math.sqrt(d*d+b*b),m),d=Math.atan2(b,d);return{ctype:"number",value:{real:c*Math.cos(d*m),imag:c*Math.sin(d*m)}}};k.log=function(a){var m=a.value.real;a=a.value.imag;var d=Math.sqrt(m*m+a*a),b=Math.atan2(a,m);0>a&&(b+=2*Math.PI);0===a&&0>m&&(b=Math.PI);b>Math.PI&&(b-=2*Math.PI);return k.snap({ctype:"number",value:{real:Math.log(d),imag:b}})};k.pow=function(a,m){return k._helper.isZero(m)?
k.one:k._helper.isZero(a)?k.zero:k._helper.isReal(m)?k.powRealExponent(a,m.value.real):k.exp(k.mult(k.log(a),m))};k.mod=function(a,m){var d=a.value.real,b=m.value.real,c=a.value.imag,g=m.value.imag,d=d-Math.floor(d/b)*b,c=c-Math.floor(c/g)*g;0===b&&(d=0);0===g&&(c=0);return k.snap({ctype:"number",value:{real:d,imag:c}})};k._helper.seed="NO";k.eps=1E-10;k.epsbig=1E-6;k._helper.seedrandom=function(a){a-=Math.floor(a);k._helper.seed=.8*a+.1};k._helper.rand=function(){if("NO"===k._helper.seed)return Math.random();
var a=k._helper.seed,a=1E3*Math.sin(1E3*a),a=a-Math.floor(a);return k._helper.seed=a};k._helper.randnormal=function(){var a=k._helper.rand(),m=k._helper.rand();return Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*m)};k._helper.isEqual=function(a,m){return a.value.real===m.value.real&&a.value.imag===m.value.imag};k._helper.isLessThan=function(a,m){return a.value.real<m.value.real||a.value.real===m.value.real&&a.value.imag<m.value.imag};k._helper.compare=function(a,m){return k._helper.isLessThan(a,m)?
-1:k._helper.isEqual(a,m)?0:1};k._helper.isAlmostEqual=function(a,m,d){var b=k.eps;"undefined"!==typeof d&&(b=d);d=a.value.real-m.value.real;a=a.value.imag-m.value.imag;return d<b&&d>-b&&a<b&&a>-b};k._helper.isZero=function(a){return 0===a.value.real&&0===a.value.imag};k._helper.isAlmostZero=function(a){var m=a.value.real;a=a.value.imag;return m<k.eps&&m>-k.eps&&a<k.eps&&a>-k.eps};k._helper.isReal=function(a){return 0===a.value.imag};k._helper.isAlmostReal=function(a){a=a.value.imag;return a<k.epsbig&&
a>-k.epsbig};k._helper.isNaN=function(a){return isNaN(a.value.real)||isNaN(a.value.imag)};k._helper.isFinite=function(a){return isFinite(a.value.real)&&isFinite(a.value.imag)};k._helper.isAlmostImag=function(a){a=a.value.real;return a<k.epsbig&&a>-k.epsbig};k._helper.z3a=k.complex(-.5,.5*Math.sqrt(3));k._helper.z3b=k.complex(-.5,-.5*Math.sqrt(3));k._helper.cub1={ctype:"list",value:[k.one,k.one,k.one]};k._helper.cub2={ctype:"list",value:[k._helper.z3a,k.one,k._helper.z3b]};k._helper.cub3={ctype:"list",
value:[k._helper.z3b,k.one,k._helper.z3a]};k.solveCubic=function(a,m,d,b){a=k._helper.solveCubicHelper(a,m,d,b);return[g.scalproduct(k._helper.cub1,a),g.scalproduct(k._helper.cub2,a),g.scalproduct(k._helper.cub3,a)]};k._helper.solveCubicHelper=function(a,m,d,b){var c=a.value.real;a=a.value.imag;var e=m.value.real;m=m.value.imag;var f=d.value.real,h=d.value.imag,l=b.value.real,n=b.value.imag,p=c*f-a*h;b=c*h+a*f;d=4*p-(e*e-m*m);var q=4*b-2*e*m,r=c*e-a*m,t=c*m+a*e,u=d*f-q*h-18*(r*l-t*n),q=d*h+q*f-18*
(r*n+t*l),w=27*(c*c-a*a),v=54*a*c;d=w*l-v*n;var y=w*n+v*l,x=e*e-m*m,A=2*e*m,C=x*e-A*m,B=x*m+A*e,w=d+4*C,v=y+4*B,C=-2*C+9*(r*f-t*h),B=-2*B+9*(r*h+t*f),C=C-d,B=B-y;d=27*(u*f-q*h+w*l-v*n);q=27*(u*h+q*f+w*n+v*l);w=Math.sqrt(Math.sqrt(d*d+q*q));v=Math.atan2(q,d);q=w*Math.sin(v/2);d=w*Math.cos(v/2);C+=d*c-q*a;B+=d*a+q*c;d=Math.exp(Math.log(Math.sqrt(C*C+B*B))/3);f=Math.atan2(B,C);w=d*Math.sin(f/3);v=d*Math.cos(f/3);d*=d;f*=2;p=2*x-6*p;b=2*A-6*b;A=-1.5874010519681996*(e*v-m*w);e=-1.5874010519681996*(e*w+
m*v);m=1.2599210498948732*d*Math.cos(f/3);f=1.2599210498948732*d*Math.sin(f/3);d=4.762203155904599*(v*c-w*a);q=4.762203155904599*(v*a+w*c);c=d*d+q*q;w=(p*d+b*q)/c;v=(-p*q+b*d)/c;p=w;b=v;w=(A*d+e*q)/c;v=(-A*q+e*d)/c;A=w;e=v;w=(m*d+f*q)/c;v=(-m*q+f*d)/c;m=w;f=v;return g.turnIntoCSList([k.complex(p,b),k.complex(A,e),k.complex(m,f)])};var g={_helper:{},turnIntoCSList:function(a){return{ctype:"list",value:a}},realVector:function(a){for(var m=[],d=0;d<a.length;d++)m[d]={ctype:"number",value:{real:a[d],
imag:0}};return{ctype:"list",value:m}}};g._helper.unitvector=function(a,m){var d=g.zerovector(a);d.value[Math.floor(m.value.real-1)]=k.real(1);return d};g.idMatrix=function(a){for(var m=g.zeromatrix(a,a),d=k.real(1),b=0;b<a.value.real;b++)m.value[b].value[b]=d;return m};g._helper.flippedidMatrix=function(a){for(var m=g.zeromatrix(a,a),d=k.real(1),b=0;b<a.value.real;b++)m.value[b].value[a.value.real-b-1]=d;return m};g.println=function(a){for(var m=[],d=0;d<a.value.length;d++)if("number"===a.value[d].ctype)m[d]=
k.niceprint(a.value[d]);else if("list"===a.value[d].ctype)g.println(a.value[d]);else return t;"number"===a.value[0].ctype&&console.log(m)};g.matrix=function(a){return g.turnIntoCSList(a.map(g.turnIntoCSList))};g.realMatrix=function(a){for(var m=a.length,d=Array(m),b=0;b<m;b++)d[b]=g.realVector(a[b]);return g.turnIntoCSList(d)};g.ex=g.realVector([1,0,0]);g.ey=g.realVector([0,1,0]);g.ez=g.realVector([0,0,1]);g.linfty=g.realVector([0,0,1]);g.ii=g.turnIntoCSList([k.complex(1,0),k.complex(0,1),k.complex(0,
0)]);g.jj=g.turnIntoCSList([k.complex(1,0),k.complex(0,-1),k.complex(0,0)]);g.fundDual=g.realMatrix([[1,0,0],[0,1,0],[0,0,0]]);g.fund=g.realMatrix([[0,0,0],[0,0,0],[0,0,1]]);g.sequence=function(a,m){for(var d=[],b=0,c=Math.round(a.value.real);c<Math.round(m.value.real)+1;c++)d[b]={ctype:"number",value:{real:c,imag:0}},b++;return{ctype:"list",value:d}};g.pairs=function(a){for(var m=[],d=0;d<a.value.length-1;d++)for(var b=d+1;b<a.value.length;b++)m.push({ctype:"list",value:[a.value[d],a.value[b]]});
return{ctype:"list",value:m}};g.triples=function(a){for(var m=[],d=0;d<a.value.length-2;d++)for(var b=d+1;b<a.value.length-1;b++)for(var c=b+1;c<a.value.length;c++)m.push({ctype:"list",value:[a.value[d],a.value[b],a.value[c]]});return{ctype:"list",value:m}};g.cycle=function(a){for(var m=[],d=0;d<a.value.length-1;d++)m[d]={ctype:"list",value:[a.value[d],a.value[d+1]]};m.push({ctype:"list",value:[a.value[a.value.length-1],a.value[0]]});return{ctype:"list",value:m}};g.consecutive=function(a){for(var m=
[],d=0;d<a.value.length-1;d++)m[d]={ctype:"list",value:[a.value[d],a.value[d+1]]};return{ctype:"list",value:m}};g.reverse=function(a){for(var m=[],d=a.value.length-1;0<=d;d--)m.push(a.value[d]);return{ctype:"list",value:m}};g.directproduct=function(a,m){for(var d=[],b=0;b<a.value.length;b++)for(var c=0;c<m.value.length;c++)d.push({ctype:"list",value:[a.value[b],m.value[c]]});return{ctype:"list",value:d}};g.concat=function(a,m){for(var d=[],b=0;b<a.value.length;b++)d.push(a.value[b]);for(b=0;b<m.value.length;b++)d.push(m.value[b]);
return{ctype:"list",value:d}};g.prepend=function(a,m){var d=[];d[0]=a;for(var b=0;b<m.value.length;b++)d[b+1]=m.value[b];return{ctype:"list",value:d}};g.append=function(a,m){for(var d=[],b=0;b<a.value.length;b++)d[b]=a.value[b];d.push(m);return{ctype:"list",value:d}};g.contains=function(a,m){for(var d=0;d<a.value.length;d++)if(D.equals(a.value[d],m).value)return{ctype:"boolean",value:!0};return{ctype:"boolean",value:!1}};g.common=function(a,m){for(var d=[],b=0,c=0;c<a.value.length;c++){for(var g=
!1,e=a.value[c],f=0;f<m.value.length;f++)g=g||D.equals(e,m.value[f]).value;g&&(d[b]=a.value[c],b++)}return{ctype:"list",value:d}};g.remove=function(a,m){for(var d=[],b=0,c=0;c<a.value.length;c++){for(var g=!1,e=a.value[c],f=0;f<m.value.length;f++)g=g||D.equals(e,m.value[f]).value;g||(d[b]=a.value[c],b++)}return{ctype:"list",value:d}};g.sort1=function(a){a=a.value.slice();a.sort(w.compare);return g.turnIntoCSList(a)};g._helper.isEqual=function(a,m){return g.equals(a,m).value};g._helper.isLessThan=
function(a,m){for(var d=a.value.length,b=m.value.length,c=0;!(c>=d||c>=b)&&w.isEqual(a.value[c],m.value[c]);)c++;return c===d&&c<b?!0:c===b&&c<d||c===d&&c===b?!1:w.isLessThan(a.value[c],m.value[c])};g._helper.compare=function(a,m){return g._helper.isLessThan(a,m)?-1:g._helper.isEqual(a,m)?0:1};g.equals=function(a,m){if(a.value.length!==m.value.length)return{ctype:"boolean",value:!1};for(var d=!0,b=0;b<a.value.length;b++)var c=a.value[b],e=m.value[b],d="list"===c.ctype&&"list"===e.ctype?d&&g.equals(c,
e).value:d&&gb([c,e],[]).value;return{ctype:"boolean",value:d}};g.almostequals=function(a,m){if(a.value.length!==m.value.length)return{ctype:"boolean",value:!1};for(var d=!0,b=0;b<a.value.length;b++)var c=a.value[b],e=m.value[b],d="list"===c.ctype&&"list"===e.ctype?d&&g.comp_almostequals(c,e).value:d&&sb([c,e],[]).value;return{ctype:"boolean",value:d}};g._helper.isAlmostReal=function(a){for(var m=!0,d=0;d<a.value.length;d++)var b=a.value[d],m="list"===b.ctype?m&&g._helper.isAlmostReal(b):m&&k._helper.isAlmostReal(b);
return m};g._helper.isAlmostZero=function(a){for(var m=0;m<a.value.length;m++){var d=a.value[m];if("list"===d.ctype){if(!g._helper.isAlmostZero(d))return!1}else if(!k._helper.isAlmostZero(d))return!1}return!0};g._helper.isNaN=function(a){for(var m=!1,d=0;d<a.value.length;d++)var b=a.value[d],m="list"===b.ctype?m||g._helper.isNaN(b):m||k._helper.isNaN(b);return m};g.set=function(a){var m=[],d=0;a=a.value.slice();a.sort(w.compare);for(var b=0;b<a.length;b++)0!==b&&gb([m[m.length-1],a[b]],[]).value||
(m[d]=a[b],d++);return{ctype:"list",value:m}};g.maxval=function(a){for(var m=k.zero,d=0;d<a.value.length;d++){var b=a.value[d];"number"===b.ctype&&(m=k.argmax(m,b));"list"===b.ctype&&(m=k.argmax(m,g.maxval(b)))}return m};g.maxIndex=function(a,m,d){var b=0;void 0!==d&&(b=d);d=b;for(var c=m(a.value[b]).value.real;b<a.value.length;++b){var e=m(a.value[b]).value.real;e>c&&(d=b,c=e)}return d};g.normalizeMax=function(a){var m=k.inv(g.maxval(a));return k._helper.isFinite(m)?g.scalmult(m,a):a};g.normalizeZ=
function(a){var m=k.inv(a.value[2]);return g.scalmult(m,a)};g.normalizeAbs=function(a){var m=k.inv(g.abs(a));return g.scalmult(m,a)};g.max=function(a,m){if(a.value.length!==m.value.length)return t;for(var d=[],b=0;b<a.value.length;b++)d[b]=w.max(a.value[b],m.value[b]);return{ctype:"list",value:d}};g.min=function(a,m){if(a.value.length!==m.value.length)return t;for(var d=[],b=0;b<a.value.length;b++)d[b]=w.min(a.value[b],m.value[b]);return{ctype:"list",value:d}};g.scaldiv=function(a,m){if("number"!==
a.ctype)return t;for(var d=[],b=0;b<m.value.length;b++){var c=m.value[b];d[b]="number"===c.ctype?w.div(c,a):"list"===c.ctype?g.scaldiv(a,c):t}return{ctype:"list",value:d}};g.scalmult=function(a,m){if("number"!==a.ctype)return t;for(var d=[],b=0;b<m.value.length;b++){var c=m.value[b];d[b]="number"===c.ctype?w.mult(c,a):"list"===c.ctype?g.scalmult(a,c):t}return{ctype:"list",value:d}};g.add=function(a,m){if(a.value.length!==m.value.length)return t;for(var d=[],b=0;b<a.value.length;b++){var c=a.value[b],
e=m.value[b];d[b]="number"===c.ctype&&"number"===e.ctype?w.add(c,e):"list"===c.ctype&&"list"===e.ctype?g.add(c,e):t}return{ctype:"list",value:d}};g.sub=function(a,m){if(a.value.length!==m.value.length)return t;for(var d=[],b=0;b<a.value.length;b++){var c=a.value[b],e=m.value[b];d[b]="number"===c.ctype&&"number"===e.ctype?k.sub(c,e):"list"===c.ctype&&"list"===e.ctype?g.sub(c,e):t}return{ctype:"list",value:d}};g.abs2=function(a){for(var m=0,d=0;d<a.value.length;d++){var b=a.value[d];if("number"===b.ctype)m+=
k.abs2(b).value.real;else if("list"===b.ctype)m+=g.abs2(b).value.real;else return t}return{ctype:"number",value:{real:m,imag:0}}};g.abs=function(a){return k.sqrt(g.abs2(a))};g.normalizeMaxXX=function(a){for(var m=-1E4,d=k.real(1),b=0;b<a.value.length;b++){var c=k.abs(a.value[b]);c.value.real>m&&(d=a.value[b],m=c.value.real)}return g.scaldiv(d,a)};g.recursive=function(a,m){for(var d=[],b=0;b<a.value.length;b++){var c=B(a.value[b]);d[b]="number"===c.ctype?k[m](c):"list"===c.ctype?g[m](c):t}return{ctype:"list",
value:d}};g.re=function(a){return g.recursive(a,"re")};g.neg=function(a){return g.recursive(a,"neg")};g.im=function(a){return g.recursive(a,"im")};g.conjugate=function(a){return g.recursive(a,"conjugate")};g.transjugate=function(a){return g.transpose(g.conjugate(a))};g.round=function(a){return g.recursive(a,"round")};g.ceil=function(a){return g.recursive(a,"ceil")};g.floor=function(a){return g.recursive(a,"floor")};g._helper.colNumb=function(a){if("list"!==a.ctype)return-1;for(var m=-1,d=0;d<a.value.length;d++){if("list"!==
a.value[d].ctype)return-1;if(0===d)m=a.value[d].value.length;else if(m!==a.value[d].value.length)return-1}return m};g._helper.isNumberVecN=function(a,m){if("list"!==a.ctype||a.value.length!==m)return!1;for(var d=0;d<a.value.length;d++)if("number"!==a.value[d].ctype)return!1;return!0};g.isNumberVector=function(a){if("list"!==a.ctype)return{ctype:"boolean",value:!1};for(var m=0;m<a.value.length;m++)if("number"!==a.value[m].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};g.isNumberVectorN=
function(a,m){if("list"!==a.ctype)return{ctype:"boolean",value:!1};if(a.value)for(var d=0;d<a.value.length;d++)if("number"!==a.value[d].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};g.isNumberMatrix=function(a){if(-1===g._helper.colNumb(a))return{ctype:"boolean",value:!1};for(var m=0;m<a.value.length;m++)if(!g.isNumberVector(a.value[m]).value)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};g.scalproduct=function(a,m){if(a.value.length!==m.value.length)return t;
for(var d={ctype:"number",value:{real:0,imag:0}},b=0;b<m.value.length;b++){var c=a.value[b],e=m.value[b];if("number"===c.ctype&&"number"===e.ctype)d=k.add(k.mult(c,e),d);else return t}return d};g.sesquilinearproduct=function(a,m){if(a.value.length!==m.value.length)return t;for(var d=0,b=0,c=0;c<m.value.length;c++)var e=a.value[c].value,g=m.value[c].value,d=d+(e.real*g.real+e.imag*g.imag),b=b+(e.real*g.imag-e.imag*g.real);return k.complex(d,b)};g.normSquared=function(a){for(var m=0,d=0;d<a.value.length;d++)var b=
a.value[d].value,m=m+(b.real*b.real+b.imag*b.imag);return k.real(m)};g.productMV=function(a,m){if(a.value[0].value.length!==m.value.length)return t;for(var d=[],b=0;b<a.value.length;b++){for(var c={ctype:"number",value:{real:0,imag:0}},e=a.value[b],f=0;f<m.value.length;f++){var h=e.value[f],l=m.value[f];if("number"===h.ctype&&"number"===l.ctype)c=k.add(k.mult(h,l),c);else return t}d[b]=c}return g.turnIntoCSList(d)};g.productVM=function(a,m){if(a.value.length!==m.value.length)return t;for(var d=[],
b=0;b<m.value[0].value.length;b++){for(var c={ctype:"number",value:{real:0,imag:0}},e=0;e<a.value.length;e++){var f=a.value[e],h=m.value[e].value[b];if("number"===f.ctype&&"number"===h.ctype)c=k.add(k.mult(f,h),c);else return t}d[b]=c}return g.turnIntoCSList(d)};g.productMM=function(a,m){if(a.value[0].value.length!==m.value.length)return t;for(var d=[],b=0;b<a.value.length;b++){var c=g.productVM(a.value[b],m);d[b]=c}return g.turnIntoCSList(d)};g.mult=function(a,m){return a.value.length===m.value.length&&
g.isNumberVector(a).value&&g.isNumberVector(m).value?g.scalproduct(a,m):g.isNumberMatrix(a).value&&m.value.length===a.value[0].value.length&&g.isNumberVector(m).value?g.productMV(a,m):g.isNumberMatrix(m).value&&a.value.length===m.value.length&&g.isNumberVector(a).value?g.productVM(a,m):g.isNumberMatrix(a).value&&g.isNumberMatrix(m)&&m.value.length===a.value[0].value.length?g.productMM(a,m):t};g.projectiveDistMinScal=function(a,m){var d=g.abs(a),b=g.abs(m);if(0===d.value.real||0===b.value.real)return 0;
var c=g.conjugate(m),c=g.scalproduct(a,c),c=k._helper.isAlmostZero(c)?k.real(1):k.div(c,k.abs(c)),d=g.scaldiv(d,a),b=g.scaldiv(b,m),b=g.scalmult(c,b),c=g.abs(g.add(d,b)),b=g.abs(g.sub(d,b));return Math.min(c.value.real,b.value.real)};g.conicDist=function(a,m){var d=Ma(a),b=Ma(m);console.log(I(d),I(b));return g.projectiveDistMinScal(d,b)};g.crossOperator=function(a){var m=a.value[0],d=a.value[1];a=a.value[2];return g.turnIntoCSList([g.turnIntoCSList([k.zero,k.neg(a),d]),g.turnIntoCSList([a,k.zero,
k.neg(m)]),g.turnIntoCSList([k.neg(d),m,k.zero])])};g.cross=function(a,m){var d=k.sub(k.mult(a.value[1],m.value[2]),k.mult(a.value[2],m.value[1])),b=k.sub(k.mult(a.value[2],m.value[0]),k.mult(a.value[0],m.value[2])),c=k.sub(k.mult(a.value[0],m.value[1]),k.mult(a.value[1],m.value[0]));return g.turnIntoCSList([d,b,c])};g.crossratio3harm=function(a,m,d,b,c){var e=g.det3(a,d,c),f=g.det3(m,b,c);a=g.det3(a,b,c);m=g.det3(m,d,c);e=k.mult(e,f);f=k.mult(a,m);return g.turnIntoCSList([e,f])};g.crossratio3=function(a,
m,d,b,c){a=g.crossratio3harm(a,m,d,b,c);return k.div(a.value[0],a.value[1])};g.veronese=function(a){var m=k.mult(a.value[0],a.value[0]),d=k.mult(a.value[1],a.value[1]),b=k.mult(a.value[2],a.value[2]),c=k.mult(a.value[0],a.value[1]),e=k.mult(a.value[0],a.value[2]);a=k.mult(a.value[1],a.value[2]);return g.turnIntoSCList([m,d,b,c,e,a])};g.matrixFromVeronese=function(a){var m=a.value[0],d=a.value[1],b=a.value[2],c=k.realmult(.5,a.value[3]),e=k.realmult(.5,a.value[4]);a=k.realmult(.5,a.value[5]);return g.turnIntoCSList([g.turnIntoCSList([m,
c,e]),g.turnIntoCSList([c,d,a]),g.turnIntoCSList([e,a,b])])};g.det2=function(a,m){var d=k.mult(a.value[0],m.value[1]);return d=k.sub(d,k.mult(a.value[1],m.value[0]))};g.det3=function(a,m,d){return k.complex(a.value[0].value.real*m.value[1].value.real*d.value[2].value.real-a.value[0].value.imag*m.value[1].value.imag*d.value[2].value.real-a.value[0].value.imag*m.value[1].value.real*d.value[2].value.imag-a.value[0].value.real*m.value[1].value.imag*d.value[2].value.imag+a.value[2].value.real*m.value[0].value.real*
d.value[1].value.real-a.value[2].value.imag*m.value[0].value.imag*d.value[1].value.real-a.value[2].value.imag*m.value[0].value.real*d.value[1].value.imag-a.value[2].value.real*m.value[0].value.imag*d.value[1].value.imag+a.value[1].value.real*m.value[2].value.real*d.value[0].value.real-a.value[1].value.imag*m.value[2].value.imag*d.value[0].value.real-a.value[1].value.imag*m.value[2].value.real*d.value[0].value.imag-a.value[1].value.real*m.value[2].value.imag*d.value[0].value.imag-a.value[0].value.real*
m.value[2].value.real*d.value[1].value.real+a.value[0].value.imag*m.value[2].value.imag*d.value[1].value.real+a.value[0].value.imag*m.value[2].value.real*d.value[1].value.imag+a.value[0].value.real*m.value[2].value.imag*d.value[1].value.imag-a.value[2].value.real*m.value[1].value.real*d.value[0].value.real+a.value[2].value.imag*m.value[1].value.imag*d.value[0].value.real+a.value[2].value.imag*m.value[1].value.real*d.value[0].value.imag+a.value[2].value.real*m.value[1].value.imag*d.value[0].value.imag-
a.value[1].value.real*m.value[0].value.real*d.value[2].value.real+a.value[1].value.imag*m.value[0].value.imag*d.value[2].value.real+a.value[1].value.imag*m.value[0].value.real*d.value[2].value.imag+a.value[1].value.real*m.value[0].value.imag*d.value[2].value.imag,-a.value[0].value.imag*m.value[1].value.imag*d.value[2].value.imag+a.value[0].value.imag*m.value[1].value.real*d.value[2].value.real+a.value[0].value.real*m.value[1].value.real*d.value[2].value.imag+a.value[0].value.real*m.value[1].value.imag*
d.value[2].value.real-a.value[2].value.imag*m.value[0].value.imag*d.value[1].value.imag+a.value[2].value.imag*m.value[0].value.real*d.value[1].value.real+a.value[2].value.real*m.value[0].value.real*d.value[1].value.imag+a.value[2].value.real*m.value[0].value.imag*d.value[1].value.real-a.value[1].value.imag*m.value[2].value.imag*d.value[0].value.imag+a.value[1].value.imag*m.value[2].value.real*d.value[0].value.real+a.value[1].value.real*m.value[2].value.real*d.value[0].value.imag+a.value[1].value.real*
m.value[2].value.imag*d.value[0].value.real+a.value[0].value.imag*m.value[2].value.imag*d.value[1].value.imag-a.value[0].value.imag*m.value[2].value.real*d.value[1].value.real-a.value[0].value.real*m.value[2].value.real*d.value[1].value.imag-a.value[0].value.real*m.value[2].value.imag*d.value[1].value.real+a.value[2].value.imag*m.value[1].value.imag*d.value[0].value.imag-a.value[2].value.imag*m.value[1].value.real*d.value[0].value.real-a.value[2].value.real*m.value[1].value.real*d.value[0].value.imag-
a.value[2].value.real*m.value[1].value.imag*d.value[0].value.real+a.value[1].value.imag*m.value[0].value.imag*d.value[2].value.imag-a.value[1].value.imag*m.value[0].value.real*d.value[2].value.real-a.value[1].value.real*m.value[0].value.real*d.value[2].value.imag-a.value[1].value.real*m.value[0].value.imag*d.value[2].value.real)};g.det4m=function(a){var m=a.value,d=m[0].value,b=d[0].value,c=+b.real,e=+b.imag,b=d[1].value,g=+b.real,f=+b.imag,b=d[2].value,h=+b.real,l=+b.imag,b=d[3].value,n=+b.real,
p=+b.imag,d=m[1].value,b=d[0].value,q=+b.real,r=+b.imag,b=d[1].value,t=+b.real,u=+b.imag,b=d[2].value,w=+b.real,v=+b.imag,b=d[3].value,d=+b.real,b=+b.imag;a=c*t-e*u-g*q+f*r;var y=c*u+e*t-g*r-f*q,x=c*w-e*v-h*q+l*r,A=c*v+e*w-h*r-l*q,C=c*d-e*b-n*q+p*r,B=c*b+e*d-n*r-p*q,D=g*w-f*v-h*t+l*u,E=g*v+f*w-h*u-l*t,F=g*d-f*b-n*t+p*u,G=g*b+f*d-n*u-p*t,J=h*d-l*b-n*w+p*v,I=h*b+l*d-n*v-p*w,d=m[2].value,b=d[0].value,c=+b.real,e=+b.imag,b=d[1].value,g=+b.real,f=+b.imag,b=d[2].value,h=+b.real,l=+b.imag,b=d[3].value,n=
+b.real,p=+b.imag,d=m[3].value,b=d[0].value,q=+b.real,r=+b.imag,b=d[1].value,t=+b.real,u=+b.imag,b=d[2].value,w=+b.real,v=+b.imag,b=d[3].value,d=+b.real,b=+b.imag,m=c*t-e*u-g*q+f*r,xc=c*u+e*t-g*r-f*q,H=c*w-e*v-h*q+l*r,K=c*v+e*w-h*r-l*q,L=c*d-e*b-n*q+p*r,c=c*b+e*d-n*r-p*q,e=g*w-f*v-h*t+l*u,q=g*v+f*w-h*u-l*t,r=g*d-f*b-n*t+p*u,g=g*b+f*d-n*u-p*t,f=h*d-l*b-n*w+p*v,h=h*b+l*d-n*v-p*w;return k.complex(a*f-y*h-x*r+A*g+C*e-B*q+D*L-E*c-F*H+G*K+J*m-I*xc,a*h+y*f-x*g-A*r+C*q+B*e+D*c+E*L-F*K-G*H+J*xc+I*m)};g.eucangle=
function(a,m){var d=g.cross(a,g.linfty),b=g.cross(m,g.linfty),c=g.det3(g.ez,d,g.ii),d=g.det3(g.ez,d,g.jj),e=g.det3(g.ez,b,g.ii),b=g.det3(g.ez,b,g.jj),c=k.div(k.mult(c,b),k.mult(e,d)),c=k.log(c);return c=k.mult(c,k.complex(0,.5))};g.zerovector=function(a){a=Math.floor(a.value.real);for(var m=Array(a),d=0;d<a;d++)m[d]=0;return g.realVector(m)};g.zeromatrix=function(a,m){for(var d=Math.floor(a.value.real),b=Array(d),c=0;c<d;c++)b[c]=g.zerovector(m);return g.turnIntoCSList(b)};g.vandermonde=function(a){for(var m=
a.value.length,d=g.zeromatrix(m,m),b=0;b<m;b++)for(var c=0;c<m;c++)d.value[b].value[c]=k.pow(a.value[b],k.real(c-1));return d};g.transpose=function(a){for(var m=[],d=a.value[0].value.length,b=a.value.length,c=0;c<d;c++){for(var e=[],f=0;f<b;f++)e[f]=a.value[f].value[c];m[c]=g.turnIntoCSList(e)}return g.turnIntoCSList(m)};g.column=function(a,m){for(var d=[],b=a.value.length,c=Math.floor(m.value.real-1),e=0;e<b;e++)d[e]=a.value[e].value[c];return g.turnIntoCSList(d)};g.row=function(a,m){for(var d=[],
b=a.value[0].value.length,c=Math.floor(m.value.real-1),e=0;e<b;e++)d[e]=a.value[c].value[e];return g.turnIntoCSList(d)};g.adjoint2=function(a){var b=a.value[0].value[0],d=a.value[1].value[0],c=Array(2);c[0]=g.turnIntoCSList([a.value[1].value[1],k.neg(a.value[0].value[1])]);c[1]=g.turnIntoCSList([k.neg(d),b]);return c=g.turnIntoCSList(c)};g.adjoint3=function(a){var b,d,c,e,g,f,h,k,l,n,p,q,r,t,u,w,v;b=a.value[0].value;d=b[0].value;c=d.real;e=d.imag;d=b[1].value;g=d.real;f=d.imag;d=b[2].value;h=d.real;
k=d.imag;b=a.value[1].value;d=b[0].value;l=d.real;n=d.imag;d=b[1].value;p=d.real;q=d.imag;d=b[2].value;r=d.real;t=d.imag;b=a.value[2].value;d=b[0].value;a=d.real;u=d.imag;d=b[1].value;w=d.real;v=d.imag;d=b[2].value;b=d.real;d=d.imag;return{ctype:"list",value:[{ctype:"list",value:[{ctype:"number",value:{real:p*b-r*w-q*d+t*v,imag:p*d-r*v-w*t+b*q}},{ctype:"number",value:{real:-g*b+h*w+f*d-k*v,imag:-g*d+h*v+w*k-b*f}},{ctype:"number",value:{real:g*r-h*p-f*t+k*q,imag:g*t-h*q-p*k+r*f}}]},{ctype:"list",value:[{ctype:"number",
value:{real:-l*b+r*a+n*d-t*u,imag:-l*d+r*u+a*t-b*n}},{ctype:"number",value:{real:c*b-h*a-e*d+k*u,imag:c*d-h*u-a*k+b*e}},{ctype:"number",value:{real:-c*r+h*l+e*t-k*n,imag:-c*t+h*n+l*k-r*e}}]},{ctype:"list",value:[{ctype:"number",value:{real:l*w-p*a-n*v+q*u,imag:l*v-p*u-a*q+w*n}},{ctype:"number",value:{real:-c*w+g*a+e*v-f*u,imag:-c*v+g*u+a*f-w*e}},{ctype:"number",value:{real:c*p-g*l-e*q+f*n,imag:c*q-g*n-l*f+p*e}}]}]}};g.inverse=function(a){var b=a.value.length;if(b!==a.value[0].value.length)return console.log("Inverse works only for square matrices"),
t;if(2===b)return g.scaldiv(g.det(a),g.adjoint2(a));if(3===b)return g.scaldiv(g.det(a),g.adjoint3(a));b=g.LUdecomp(a);a=a.value.length;var d=k.real(0),c=k.real(1),e=g.zerovector(k.real(a));e.value[0]=c;for(var f=Array(a),h=0;h<a;h++)f[h]=g._helper.LUsolve(b,e),e.value[h]=d,e.value[h+1]=c;f=g.turnIntoCSList(f);return f=g.transpose(f)};g.linearsolve=function(a,b){return 2===a.value.length?g.linearsolveCramer2(a,b):3===a.value.length?g.linearsolveCramer3(a,b):g.LUsolve(a,b)};g.getDiag=function(a){if(a.value.length!==
a.value[0].value.length)return t;for(var b=Array(a.value.length),d=0;d<a.value.length;d++)b[d]=a.value[d].value[d];return g.turnIntoCSList(b)};g.getSubDiag=function(a){if(a.value.length!==a.value[0].value.length)return t;for(var b=Array(a.value.length-1),d=0;d<a.value.length-1;d++)b[d]=a.value[d+1].value[d];return g.turnIntoCSList(b)};g.eig2=function(a){var b=k.add(a.value[0].value[0],a.value[1].value[1]);a=g.det2(a.value[0],a.value[1]);var d=k.mult(b,b),c=b=k.mult(b,k.real(.5));a=k.sqrt(k.sub(k.div(d,
k.real(4)),a));b=k.add(b,a);c=k.sub(c,a);return g.turnIntoCSList([b,c])};g.eig=function(a,b){var d=b||!0,c=a,e=k.real(c.value.length),f=e.value.real;k.real(0);var c=g._helper.QRIteration(c)[0],c=g.getDiag(c),c=g.sort1(c),e=g.idMatrix(e,e),h=Array(f),h=g.turnIntoCSList(h);if(d){for(var l,n,p,q=0,r=!1,d=0;d<f;d++)r?n=l.value[q]:(l=c.value[d],l=g.sub(a,g.scalmult(l,e)),l=g.nullSpace(l),n=l.value[0],void 0!==n&&(p=n)),void 0===n&&(n=p),1E-8>g.abs(n).value.real&&0===q&&(n=g._helper.inverseIteration(a,
c.value[d])),h.value[d]=g._helper.isAlmostZeroVec(n)?n:g.scaldiv(g.abs(n),n),d<f-1&&((r=1E-6>k.abs(k.sub(c.value[d],c.value[d+1])).value.real)?q++:q=0);h=g.transpose(h)}return g.turnIntoCSList([c,h])};g._helper.isNormalMatrix=function(a){return 1E-10>g.abs(g.sub(a,g.transjugate(a))).value.real};g._helper.QRIteration=function(a,b){var d,c=a;d=k.real(c.value.length);var e=d.value.real,f=d.value.real;k.real(0);var h=g.idMatrix(d,d),l=g.zeromatrix(d,d),n=g.idMatrix(d,d),p=b?b:2500,q,r,t,u=0,v=Array(f);
for(d=0;d<p;d++){h=g._helper.getBlock(c,[f-2,f-1],[f-2,f-1]);q=g.eig2(h);h=q.value[0];q=q.value[1];g.abs(h);g.abs(q);r=c.value[f-1].value[f-1];t=k.abs(k.sub(r,h)).value.real;r=k.abs(k.sub(r,q)).value.real;q=t<r?h:q;h=g.idMatrix(k.real(f),k.real(f));q=g.scalmult(q,h);h=g.QRdecomp(g.sub(c,q));c=w.mult(h.R,h.Q);c=g.add(c,q);h.Q=g._helper.buildBlockMatrix(h.Q,g.idMatrix(k.real(u),k.real(u)));n=w.mult(n,h.Q);if(1E-48>k.abs2(c.value[c.value.length-1].value[c.value[0].value.length-2]).value.real&&1<f){v[e-
u-1]=c.value[f-1].value[f-1];for(d=0;d<f;d++)l.value[f-1].value[d]=c.value[f-1].value[d],l.value[d].value[f-1]=c.value[d].value[f-1];c=g._helper.getBlock(c,[0,f-2],[0,f-2]);u++;f--}if(1===f){l.value[0].value[0]=c.value[0].value[0];break}if(g._helper.isUpperTriangular(c)){for(d=0;d<f;d++)l.value[d].value[d]=c.value[d].value[d];break}}return[l,n]};g.rank=function(a,b){return g.RRQRdecomp(a,b).rank};g._helper.isAlmostZeroVec=function(a){for(var b=a.value.length,d=0;d<b;d++)if(!k._helper.isAlmostZero(a.value[d]))return!1;
return!0};g._helper.isLowerTriangular=function(a){for(var b=a.value.length,d=a.value[0].value.length,c=0;c<b;c++)for(var e=c+1;e<d;e++)if(!k._helper.isAlmostZero(a.value[c].value[e]))return!1;return!0};g._helper.isUpperTriangular=function(a){return g._helper.isLowerTriangular(g.transpose(a))};g._helper.isAlmostId=function(a){var b=a.value.length,d=k.real(b);if(b!==a.value[0].value.length)return!1;a=g.sub(a,g.idMatrix(d),d);for(d=0;d<b;d++)for(var c=0;c<b;c++)if(1E-16<k.abs(a.value[d].value[c]).value.real)return!1;
return!0};g.nullSpace=function(a,b){var d=a.value.length,c=g.RRQRdecomp(g.transjugate(a),b),e=g.transpose(c.Q),c=d-c.rank.value.real,f=Array(c);e.value.reverse();for(var h,l=0;l<c;l++)h=e.value[l],f[l]=g.scaldiv(g.abs(h),h);f=g.turnIntoCSList(f);return 0<f.value.length?f:g.turnIntoCSList([g.zerovector(k.real(d))])};g._helper.isAlmostDiagonal=function(a){var b=a.value.length;k.real(b);k.real(0);if(b!==a.value[0].value.length)return!1;for(var d=0;d<b;d++)for(var c=0;c<b;c++)if(d!==c&&1E-16<k.abs(a.value[d].value[c]).value.real)return!1;
return!0};g._helper.inverseIteration=function(a,b){console.log("warning: code untested");for(var d=a.value.length,c=Array(d),e=0;e<d;e++)c[e]=2*Math.random()-.5;var e=c=g.realVector(c),d=g.idMatrix(k.real(d),k.real(d)),f;f=k.add(b,k.real(.1*Math.random()-.5));for(var h=0;100>h;h++)e=g.scaldiv(g.abs(c),c),c=g.LUsolve(g.sub(a,g.scalmult(f,d)),JSON.parse(JSON.stringify(e)));return g.scaldiv(g.abs(c),c)};g._helper.toHessenberg=function(a){var b=JSON.parse(JSON.stringify(a)),d=b.value.length,c=k.real(d-
1),e=k.real(d);k.real(1);if(g._helper.isUpperTriangular(b))return[g.idMatrix(c,c),a];var f;a=g.idMatrix(e,e);for(var h,e=1;e<d-1;e++)f=g.column(b,k.real(e)),f.value=f.value.splice(e),h=g.abs2(f).value.real,1E-16<h&&(f=g._helper.getHouseHolder(f),a=w.mult(a,f),b=w.mult(w.mult(f,b),f)),c.value.real--;return[a,b]};g._helper.swapEl=function(a,b,d){var c;"[object Array]"===Object.prototype.toString.call(a)?(c=a[b],a[b]=a[d],a[d]=c):"list"===a.ctype&&(c=a.value[b],a.value[b]=a.value[d],a.value[d]=c)};g.RRQRdecomp=
function(a,b){var d=Math.sqrt(k.eps);void 0!==b&&(d=.1*b.value.real);var d=d*d,c,e=a.value.length,f=k.real(e),h=k.real(1),l=g._helper.unitvector(k.real(a.value.length),h),n=g.idMatrix(f,f),p=JSON.parse(JSON.stringify(a)),q=g.transpose(a),r=Array(e);for(c=0;c<e;c++)r[c]=g.abs2(q.value[c]);r=g.turnIntoCSList(r);q=Array(e);for(c=0;c<e;c++)q[c]=c;c=g.maxIndex(r,k.abs);for(var t=r.value[c],u=0,v=0;1E-16<k.abs2(t).value.real;v++){u++;g._helper.swapColumn(p,v,c);g._helper.swapEl(r,v,c);g._helper.swapEl(q,
v,c);c=g._helper.getBlock(p,[v],[v]);c=g.column(c,h);t=g.abs2(c).value.real;1E-8<t&&(c=g._helper.getHouseHolder(c),c=g._helper.buildBlockMatrix(g.idMatrix(k.real(v),k.real(v)),c),n=w.mult(n,g.transjugate(c)),p=w.mult(c,p));for(c=v+1;c<e;c++)r.value[c]=k.sub(r.value[c],k.mult(p.value[v].value[c],k.conjugate(p.value[v].value[c])));c=g.maxIndex(r,k.abs2,v+1);t=r.value[c];if(v+2===e){k.abs(t).value.real>d&&u++;break}f=k.sub(f,h);l.value=l.value.splice(0,l.value.length-1)}return{Q:n,R:p,P:g.turnIntoCSList(q),
rank:k.real(u)}};g._helper.getHouseHolder=function(a){var b=k.real(a.value.length);if(1E-16>g.abs2(a))return g.idMatrix(b,b);var d,c=k.real(1),e=g._helper.unitvector(k.real(a.value.length),c);d=g._helper.QRgetAlpha(a,0);d=g.sub(a,g.scalmult(d,e));d=g.scaldiv(g.abs(d),d);a=k.div(g.sesquilinearproduct(a,d),g.sesquilinearproduct(d,a));b=g.idMatrix(b,b);return b=g.sub(b,g.scalmult(k.add(c,a),g._helper.transposeMult(d,g.conjugate(d))))};g._helper.reOrderbyPivots=function(a,b){for(var d=a.value.length.length,
c=g.transpose(a),d=Array(d),e=0;e<b.length;e++)d[b[e]]=c.value[e];d=g.turnIntoCSList(d);return g.transpose(d)};g.QRdecomp=function(a){var b,d=a.value.length,c=k.real(d);if(g._helper.isUpperTriangular(a))return{Q:g.idMatrix(c,c),R:a};var e=k.real(1),f=g._helper.unitvector(k.real(a.value.length),e),h,l=g.idMatrix(c,c);a=JSON.parse(JSON.stringify(a));for(var n=0;;n++){b=g._helper.getBlock(a,[n],[n]);b=g.column(b,e);h=g.abs2(b).value.real;1E-8<h&&(b=g._helper.getHouseHolder(b),b=g._helper.buildBlockMatrix(g.idMatrix(k.real(n),
k.real(n)),b),l=w.mult(l,g.transjugate(b)),a=w.mult(b,a));if(n+2===d)break;c=k.sub(c,e);f.value=f.value.splice(0,f.value.length-1)}return{Q:l,R:a}};g._helper.swapColumn=function(a,b,d){for(var c,e=0;e<a.value.length;e++)c=a.value[e].value[b],a.value[e].value[b]=a.value[e].value[d],a.value[e].value[d]=c};g._helper.buildBlockMatrix=function(a,b){if(0===a.value.length)return b;if(0===b.value.length)return a;for(var d=a.value.length,c=a.value[0].value.length,e=c+b.value[0].value.length,e=g.zeromatrix(k.real(d+
b.value.length),k.real(e)),f=0;f<a.value.length;f++)for(var h=0;h<a.value[0].value.length;h++)e.value[f].value[h]=a.value[f].value[h];for(f=0;f<b.value.length;f++)for(h=0;h<b.value[0].value.length;h++)e.value[d+f].value[c+h]=b.value[f].value[h];return e};g._helper.getBlock=function(a,b,d){a=JSON.parse(JSON.stringify(a));var c=b[0],e=d[0];b=void 0===b[1]?a.value.length:b[1];d=void 0===d[1]?a.value[0].value.length:d[1];b++;d++;a.value=a.value.slice(c,b);for(c=0;c<a.value.length;c++)a.value[c].value=
a.value[c].value.slice(e,d);return a};g._helper.setBlock=function(a,b,d){a=JSON.parse(JSON.stringify(a));var c=d[0];d=d[1];for(var e=b.value.length,g=b.value[0].value.length,f=0;f<e;f++)for(var h=0;h<g;h++)a.value[c+f].value[d+h]=b.value[f].value[h];return a};g._helper.transposeMult=function(a,b){if(a.value.length!==b.value.length)return t;for(var d=a.value.length,c=Array(d),e=0;e<d;e++)c[e]=g.scalmult(a.value[e],b);return g.turnIntoCSList(c)};g._helper.QRgetAlpha=function(a,b){return 0>a.value[b].value.real?
g.abs(a):k.neg(g.abs(a))};g.LUdecomp=function(a){a=JSON.parse(JSON.stringify(a));var b,d,c,e,g,f=0,h,l=a.value.length,n=l-1,p=Array(l);for(c=0;c<l;++c){g=c;e=a.value[c];h=k.abs(e.value[c]).value.real;for(d=c+1;d<l;++d)b=k.abs(a.value[d].value[c]),h<b.value.real&&(h=b.value.real,g=d);h<k.eps&&console.log("Warning: singular matrix!");p[c]=g;g!==c&&(a.value[c]=a.value[g],a.value[g]=e,e=a.value[c],f++);d=e.value[c];for(b=c+1;b<l;++b)a.value[b].value[c]=k.div(a.value[b].value[c],d);for(b=c+1;b<l;++b){g=
a.value[b];for(d=c+1;d<n;++d)g.value[d]=k.sub(g.value[d],k.mult(g.value[c],e.value[d])),++d,g.value[d]=k.sub(g.value[d],k.mult(g.value[c],e.value[d]));d===n&&(g.value[d]=k.sub(g.value[d],k.mult(g.value[c],e.value[d])))}}return{LU:a,P:p,TransPos:f}};g.LUsolve=function(a,b){var d=g.LUdecomp(a);return g._helper.LUsolve(d,b)};g._helper.LUsolve=function(a,b){var d=JSON.parse(JSON.stringify(b)),c,e=a.LU,g=e.value.length,f=JSON.parse(JSON.stringify(d)),h=a.P,l;for(c=g-1;-1!==c;--c)f.value[c]=d.value[c];
for(c=0;c<g;++c)for(d=h[c],h[c]!==c&&(l=f.value[c],f.value[c]=f.value[d],f.value[d]=l),l=e.value[c],d=0;d<c;++d)f.value[c]=k.sub(f.value[c],k.mult(f.value[d],l.value[d]));for(c=g-1;0<=c;--c){l=e.value[c];for(d=c+1;d<g;++d)f.value[c]=k.sub(f.value[c],k.mult(f.value[d],l.value[d]));f.value[c]=k.div(f.value[c],l.value[c])}return f};g.linearsolveCramer2=function(a,b){var d=g.column(a,k.real(1)),c=g.column(a,k.real(2)),e=g.det2(d,c);k._helper.isZero(e)&&console.log("A is not regular!");c=g.det2(b,c);c=
k.div(c,e);d=g.det2(d,b);d=k.div(d,e);return g.turnIntoCSList([c,d])};g.linearsolveCramer3=function(a,b){var d=g.column(a,k.real(1)),c=g.column(a,k.real(2)),e=g.column(a,k.real(3)),f=g.det3(d,c,e);k._helper.isZero(f)&&console.log("A is not regular!");var h=g.det3(b,c,e),e=g.det3(d,b,e),d=g.det3(d,c,b),h=g.turnIntoCSList([h,e,d]);return h=g.scaldiv(f,h)};g.linearsolveCGNR=function(a,b){var d=g.transpose(a),c=w.mult(d,a),d=w.mult(d,b);return g.linearsolveCG(c,d)};g.linearsolveCG=function(a,b){var d,
c,e,f,h,l;f=b;c=d=g.sub(b,w.mult(a,b));for(var n=Math.ceil(1.2*a.value.length),p=0;p<n;){p++;h=w.mult(a,c);l=e=g.scalproduct(d,d);e=k.div(e,g.scalproduct(c,h));f=g.add(f,w.mult(e,c));d=g.sub(d,w.mult(e,h));if(g.abs(d).value.real<k.eps)break;e=g.scalproduct(d,d);e=k.div(e,l);c=g.add(d,w.mult(e,c))}p>=n&&console.log("CG did not converge");return f};g.det=function(a){if(1===a.value.length)return a.value[0].value[0];if(2===a.value.length)return g.det2(a.value[0],a.value[1]);if(3===a.value.length)return g.det3(a.value[0],
a.value[1],a.value[2]);if(4===a.value.length)return g.det4m(a);var b=a.value.length,d=k.real(1),c,e,f=JSON.parse(JSON.stringify(a)),h,l,n,p;for(a=0;a<b-1;a++){e=a;for(c=a+1;c<b;c++)k.abs(f.value[c].value[a]).value.real>k.abs(f.value[e].value[a]).value.real&&(e=c);e!==a&&(c=f.value[e],f.value[e]=f.value[a],f.value[a]=c,d=k.neg(d));h=f.value[a];for(c=a+1;c<b;c++){l=f.value[c];n=k.div(l.value[a],h.value[a]);for(e=a+1;e<b-1;e+=2)p=e+1,l.value[e]=k.sub(l.value[e],k.mult(h.value[e],n)),l.value[p]=k.sub(l.value[p],
k.mult(h.value[p],n));e!==b&&(l.value[e]=k.sub(l.value[e],k.mult(h.value[e],n)))}if(k._helper.isZero(h.value[a]))return k.real(0);d=k.mult(d,h.value[a])}return k.mult(d,f.value[a].value[a])};g.LUdet=function(a){a=g.LUdecomp(a);for(var b=a.LU,d=b.value.length,c=b.value[0].value[0],e=1;e<d;e++)c=k.mult(c,b.value[e].value[e]);1===a.TransPos%2&&(c=k.neg(c));return c};g.getField=function(a,b){var d;if("homog"===b){if(g._helper.isNumberVecN(a,3))return a;if(g._helper.isNumberVecN(a,2))return g.turnIntoCSList([a.value[0],
a.value[1],k.real(1)])}if("xy"===b){if(g._helper.isNumberVecN(a,2))return a;if(g._helper.isNumberVecN(a,3))return g.turnIntoCSList([k.div(a.value[0],a.value[2]),k.div(a.value[1],a.value[2])])}if("x"===b&&g.isNumberVector(a)){d=a.value.length;if(0<d&&3!==d)return a.value[0];if(3===d)return"Point"===a.usage?k.div(a.value[0],a.value[2]):a.value[0]}if("y"===b&&g.isNumberVector(a)){d=a.value.length;if(1<d&&3!==d)return a.value[1];if(3===d)return"Point"===a.usage?k.div(a.value[1],a.value[2]):a.value[1]}return"z"===
b&&g.isNumberVector(a)&&(d=a.value.length,2<d)?a.value[2]:t};var Za={},qb={":":20,".":25,"\u00b0":25,_:50,"^":50,"*":100,"/":100,"+":200,"-":200,"!":200,"==":300,"~=":300,"~<":300,"~>":300,"=:=":300,">=":300,"<=":300,"~>=":300,"~<=":300,">":300,"<":300,"<>":300,"&":350,"%":350,"!=":350,"~!=":350,"..":350,"++":370,"--":370,"~~":370,":>":370,"<:":370,"=":400,":=":400,":=_":400,"::=":400,"->":400,",":500,";":500},T={};T["+"]=Yb;T["-"]=tb;T["*"]=Zb;T["/"]=$b;T["^"]=ic;T["\u00b0"]=function(a,b){var d=
B(a[0]),c=B(a[1]);return"number"===d.ctype&&"void"===c.ctype?w.withUsage(k.realmult(Math.PI/180,d),"Angle"):t};T[";"]=function(a,b){var d="void"===a[0].ctype,c="void"===a[1].ctype;if(d&&c)return t;if(!d&&c)return A(a[0]);d||c||A(a[0]);return c?t:A(a[1])};T["="]=aa;T[".."]=function(a,b){var d=A(a[0]),c=A(a[1]);return"number"===d.ctype&&"number"===c.ctype?g.sequence(d,c):t};T[":="]=function(a,b){var d="undefined"===a[1].ctype;if("undefined"===a[0].ctype||d)return t;"function"===a[0].ctype&&(d=a[0].oper,
Za[d]={oper:d,body:a[1],arglist:a[0].args});return t};T["=="]=gb;T["!="]=function(a,b){return w.not(gb(a,b))};T["~="]=sb;T["~!="]=function(a,b){return w.not(sb(a,b))};T[">"]=function(a,b){var d=B(a[0]),c=B(a[1]);return"number"===d.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(d)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:d.value.real>c.value.real}:"string"===d.ctype&&"string"===c.ctype?{ctype:"boolean",value:d.value>c.value}:t};T["<"]=function(a,b){var d=B(a[0]),c=B(a[1]);return"number"===
d.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(d)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:d.value.real<c.value.real}:"string"===d.ctype&&"string"===c.ctype?{ctype:"boolean",value:d.value<c.value}:t};T[">="]=function(a,b){var d=B(a[0]),c=B(a[1]);return"number"===d.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(d)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:d.value.real>=c.value.real}:"string"===d.ctype&&"string"===c.ctype?{ctype:"boolean",value:d.value>=c.value}:t};T["<="]=
function(a,b){var d=B(a[0]),c=B(a[1]);return"number"===d.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(d)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:d.value.real<=c.value.real}:"string"===d.ctype&&"string"===c.ctype?{ctype:"boolean",value:d.value<=c.value}:t};T["~>"]=function(a,b){var d=B(a[0]),c=B(a[1]);return"number"===d.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(d)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:d.value.real>c.value.real+k.eps}:t};T["~<"]=function(a,b){var d=
B(a[0]),c=B(a[1]);return"number"===d.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(d)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:d.value.real<c.value.real-k.eps}:t};T["~>="]=function(a,b){var d=B(a[0]),c=B(a[1]);return"number"===d.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(d)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:d.value.real>c.value.real-k.eps}:t};T["~<="]=function(a,b){var d=B(a[0]),c=B(a[1]);return"number"===d.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(d)&&
k._helper.isAlmostReal(c)?{ctype:"boolean",value:d.value.real<c.value.real+k.eps}:t};T["&"]=Wb;T["%"]=Xb;T["!"]=function(a,b){var d=B(a[0]),c=B(a[1]);return"void"===d.ctype&&"boolean"===c.ctype?{ctype:"boolean",value:!c.value}:t};T._=Cb;T["++"]=jc;T["~~"]=kc;T["--"]=lc;T[":>"]=mc;T["<:"]=nc;var u={},D={evaluate:function(a,b,d){if(Za.hasOwnProperty(a)){a=Za[a];if(void 0===a)b=t;else{var c=[];for(d=0;d<a.arglist.length;d++)c[d]=A(b[d]);for(d=0;d<a.arglist.length;d++)L.newvar(a.arglist[d].name),L.setvar(a.arglist[d].name,
c[d]);L.pushVstack("*");b=A(a.body);L.cleanVstack();for(d=0;d<a.arglist.length;d++)L.removevar(a.arglist[d].name)}return b}if(c=u[a])return c(b,d);var e=a.lastIndexOf("$");if(-1!==e&&(e=a.substr(0,e),c=u[e]))return c(b,d);ha.err("Called undefined function "+e+" (as "+a+")");return t},equals:function(a,b){return"number"===a.ctype&&"number"===b.ctype?{ctype:"boolean",value:a.value.real===b.value.real&&a.value.imag===b.value.imag}:"string"===a.ctype&&"string"===b.ctype||"boolean"===a.ctype&&"boolean"===
b.ctype?{ctype:"boolean",value:a.value===b.value}:"list"===a.ctype&&"list"===b.ctype?g.equals(a,b):{ctype:"boolean",value:!1}}},w={_helper:{},order:{undefined:0,"boolean":1,number:2,term:3,atomic:4,variable:5,geo:6,string:7,list:8},string:function(a){return{ctype:"string",value:a}},bool:function(a){return{ctype:"boolean",value:a}},not:function(a){return w.bool(!a.value)},isLessThan:function(a,b){return-1===w.compare(a,b)},isEqual:function(a,b){return 0===w.compare(a,b)},compareResults:function(a,
b){return w.compare(a.result,b.result)},compare:function(a,b){if(a.ctype!==b.ctype)return w.order[a.ctype]-w.order[b.ctype];if("number"===a.ctype)return k._helper.compare(a,b);if("list"===a.ctype)return g._helper.compare(a,b);if("string"===a.ctype)return a.value===b.value?0:a.value<b.value?-1:1;if("boolean"===a.ctype)return a.value===b.value?0:!1===a.value?-1:1},add:function(a,b){return"void"===a.ctype&&"number"===b.ctype?b:"number"===a.ctype&&"number"===b.ctype?k.add(a,b):"string"===a.ctype||"string"===
b.ctype?{ctype:"string",value:I(a)+I(b)}:"list"===a.ctype&&"list"===b.ctype?g.add(a,b):t},sub:function(a,b){return"void"===a.ctype&&"number"===b.ctype?k.neg(b):"void"===a.ctype&&"list"===b.ctype?g.neg(b):"number"===a.ctype&&"number"===b.ctype?k.sub(a,b):"list"===a.ctype&&"list"===b.ctype?g.sub(a,b):t},mult:function(a,b){return"number"===a.ctype&&"number"===b.ctype?k.mult(a,b):"number"===a.ctype&&"list"===b.ctype?g.scalmult(a,b):"list"===a.ctype&&"number"===b.ctype?g.scalmult(b,a):"list"===a.ctype&&
"list"===b.ctype?g.mult(a,b):t},div:function(a,b){return"number"===a.ctype&&"number"===b.ctype?k.div(a,b):"list"===a.ctype&&"number"===b.ctype?g.scaldiv(b,a):t},max:function(a,b){return"number"===a.ctype&&"number"===b.ctype?k.max(a,b):"list"===a.ctype&&"list"===b.ctype?g.max(a,b):t},min:function(a,b){return"number"===a.ctype&&"number"===b.ctype?k.min(a,b):"list"===a.ctype&&"list"===b.ctype?g.min(a,b):t},wrap:function(a){if("number"===typeof a)return k.real(a);if("object"===typeof a&&void 0!==a.length){for(var b=
[],d=0;d<a.length;d++)b[d]=w.wrap(a[d]);return g.turnIntoCSList(b)}return"string"===typeof a?{ctype:"string",value:a}:"boolean"===typeof a?{ctype:"boolean",value:a}:t},unwrap:function(a){if("object"!==typeof a||null===a)return a;if(Array.isArray(a))return a.map(w.unwrap);switch(a.ctype){case "string":case "boolean":return a.value;case "number":return 0===a.value.imag?a.value.real:{r:a.value.real,i:a.value.imag};case "list":return a.value.map(w.unwrap);default:return null}},withUsage:function(a,b){return{ctype:a.ctype,
value:a.value,usage:b}}};u.version$0=function(a,b){var d=["CindyJS"].concat(cd);return g.turnIntoCSList(d.map(w.wrap))};u.timestamp$0=function(a,b){return{ctype:"number",value:{real:(new Date).getTime(),imag:0}}};u.seconds$0=function(a,b){return{ctype:"number",value:{real:(new Date).getTime()/1E3,imag:0}}};u.clearconsole$0=function(a,b){ha.clear()};u.err$1=function(a,b){var d="",c;"variable"===a[0].ctype?(d=a[0].name,c=L.getvar(a[0].name)):c=a[0];c=d+" ===> "+I(A(c));ha.err(c);return t};u.errc$1=
function(a,b){var d;"variable"===a[0].ctype?(d=A(L.getvar(a[0].name)),console.log(a[0].name+" ===> "+I(d))):(d=A(a[0]),console.log(" ===> "+I(d)));return t};u.print$1=function(a,b){ha.out(I(A(a[0])),!0);return t};u.println$1=function(a,b){ha.out(I(A(a[0])));return t};u.dump$1=function(a,b){console.log(JSON.stringify(a[0]));return t};u.repeat$2=function(a,b){return u.repeat$3([a[0],null,a[1]],b)};u.repeat$3=function(a,b){var d=B(a[0]),c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);if("number"!==
d.ctype)return t;var d=Math.round(d.value.real),e=1,g=1,f=d+1,h=!1,k=!1,l=!1,n;void 0!==b.start&&(n=A(b.start),"number"===n.ctype&&(h=!0,g=n.value.real));void 0!==b.step&&(n=A(b.step),"number"===n.ctype&&(l=!0,e=n.value.real));void 0!==b.stop&&(n=A(b.stop),"number"===n.ctype&&(k=!0,f=n.value.real));!h||k||l||(f=e*d+g);h||!k||l||(g=-e*(d-1)+f,f+=e);h||k||!l||(f=e*d+g);h&&k&&!l&&(e=(f-g)/(d-1),f+=e);h&&!k&&l&&(f=e*d+g);!h&&k&&l&&(g=-e*(d-1)+f,f+=e);h&&k&&l&&(f+=e);(g<=f&&0<e||g>=f&&0>e)&&h&&k&&l&&(d=
Math.floor((f-g)/e));L.newvar(c);f=t;for(h=0;h<d;h++)L.setvar(c,{ctype:"number",value:{real:h*e+g,imag:0}}),f=A(a[2]);L.removevar(c);return f};u.while$2=function(a,b){for(var d=a[1],c=a[0],e=A(c),g=t;"list"!==e.ctype&&e.value;)g=A(d),e=A(c);return g};u.apply$2=function(a,b){return u.apply$3([a[0],null,a[1]],b)};u.apply$3=function(a,b){var d=B(a[0]);if("list"!==d.ctype)return t;var c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);var d=d.value,e=[];L.newvar(c);for(var g=0;g<d.length;g++)L.setvar(c,
d[g]),e[g]=A(a[2]);L.removevar(c);return{ctype:"list",value:e}};u.forall$2=function(a,b){return u.forall$3([a[0],null,a[1]],b)};u.forall$3=function(a,b){var d=B(a[0]);if("list"!==d.ctype)return t;var c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);d=d.value;L.newvar(c);for(var e,g=0;g<d.length;g++)L.setvar(c,d[g]),e=A(a[2]);L.removevar(c);return e};u.select$2=function(a,b){return u.select$3([a[0],null,a[1]],b)};u.select$3=function(a,b){var d=B(a[0]);if("list"!==d.ctype)return t;var c="#";
null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);var d=d.value,e=[];L.newvar(c);for(var g=0,f=0;f<d.length;f++){L.setvar(c,d[f]);var h=A(a[2]);"boolean"===h.ctype&&!0===h.value&&(e[g]=d[f],g++)}L.removevar(c);return{ctype:"list",value:e}};u.flatten$1=function(a,b){function d(a,b){return-1===b||"list"!==a.ctype?a:[].concat.apply([],a.value.map(function(a){return d(a,b-1)}))}var c=B(a[0]);if("list"!==c.ctype)return c;var e=b.levels;void 0===e?e=1:(e=A(e),e="number"===e.ctype?e.value.real:"string"===
e.ctype&&"all"===e.value?-2:1);return{ctype:"list",value:d(c,e)}};u.createvar$1=function(a,b){"variable"===a[0].ctype&&L.newvar(a[0].name);return t};u.local=function(a,b){for(var d=0;d<a.length;d++)"variable"===a[d].ctype&&L.newvar(a[d].name);return t};u.removevar$1=function(a,b){var d=A(a[0]);"variable"===a[0].ctype&&L.removevar(a[0].name);return d};u.release=function(a,b){if(0===a.length)return t;for(var d=A(a[a.length-1]),c=0;c<a.length;c++)"variable"===a[c].ctype&&L.removevar(a[c].name);return d};
u.regional=function(a,b){for(var d=0;d<a.length;d++)if("variable"===a[d].ctype){var c=a[d].name;L.newvar(c);L.pushVstack(c)}return t};u.genList=function(a,b){for(var d=[],c=0;c<a.length;c++)d[c]=A(a[c]);return{ctype:"list",value:d}};D.assigntake=function(a,b){var d=a.args[0],c=A(d),e=B(a.args[1]),f=t;if("list"===c.ctype||"string"===c.ctype)e=Math.floor(e.value.real),0>e&&(e=c.value.length+e+1),0<e&&e<=c.value.length&&("list"===c.ctype?(c=c.value.slice(),c[e-1]=A(b),f=g.turnIntoCSList(c)):(c=c.value,
c=c.substring(0,e-1)+I(A(b))+c.substring(e,c.length),f=w.string(c)));aa([d,f])};D.assigndot=function(a,b){var d=A(a.obj),c=a.key;"geo"===d.ctype&&c&&sa.setField(d.value,c,b);return t};D.assignlist=function(a,b){var d=a.length,c=b.length;c<d&&(d=c);for(c=0;c<d;c++)aa([a[c],b[c]],[])};u.if$2=function(a,b){return u.if$3(a,b)};u.if$3=function(a,b){var d=B(a[0]);if("boolean"===d.ctype){if(!0===d.value)return A(a[1]);if(3===a.length)return A(a[2])}return t};u.and$2=Wb;u.or$2=Xb;u.xor$2=function(a,b){var d=
B(a[0]),c=B(a[1]);return"boolean"===d.ctype&&"boolean"===c.ctype?{ctype:"boolean",value:d.value!==c.value}:t};u.not$1=function(a,b){var d=B(a[0]);return"boolean"===d.ctype?{ctype:"boolean",value:!d.value}:t};D.genericListMathGen=function(a,b,d){u[a+"$1"]=function(a,c){var e=A(a[0]);if("list"!==e.ctype)return t;e=e.value;if(0===e.length)return d;for(var g=e[0],z=1;z<e.length;z++)g=b(g,e[z]);return g};var c=a+"$3";u[a+"$2"]=function(a,d){return u[c]([a[0],null,a[1]])};u[c]=function(a,c){var e=B(a[0]);
if("list"!==e.ctype)return t;e=e.value;if(0===e.length)return d;var g="#";null!==a[1]&&"variable"===a[1].ctype&&(g=a[1].name);L.newvar(g);L.setvar(g,e[0]);for(var z=A(a[2]),f=1;f<e.length;f++){L.setvar(g,e[f]);var h=A(a[2]),z=b(z,h)}L.removevar(g);return z}};D.genericListMathGen("product",w.mult,k.real(1));D.genericListMathGen("sum",w.add,k.real(0));D.genericListMathGen("max",w.max,t);D.genericListMathGen("min",w.min,t);u.max$2=function(a,b){var d=B(a[0]);if("list"===d.ctype)return u.max$3([d,null,
a[1]]);var c=B(a[1]);return u.max$1([g.turnIntoCSList([d,c])])};u.min$2=function(a,b){var d=B(a[0]);if("list"===d.ctype)return u.min$3([d,null,a[1]]);var c=B(a[1]);return u.min$1([g.turnIntoCSList([d,c])])};u.add$2=Yb;u.sub$2=tb;u.mult$2=Zb;u.div$2=$b;u.mod$2=function(a,b){var d=B(a[0]),c=B(a[1]);return"number"===d.ctype&&"number"===c.ctype?k.mod(d,c):t};u.pow$2=ic;u.exp$1=function(a,b){var d=B(a[0]);return"number"===d.ctype?k.exp(d):t};u.sin$1=function(a,b){var d=B(a[0]);return"number"===d.ctype?
k.sin(d):t};u.sqrt$1=function(a,b){var d=B(a[0]);return"number"===d.ctype?k.sqrt(d):t};D.laguerre=function(a,b,d){if("list"!==a.ctype)return t;var c=a.value.length-1,e;for(e=0;e<=c;e++)if("number"!==a.value[e].ctype)return t;if("number"!==b.ctype)return t;for(var g=[1,.3141,.5926,.5358,.9793,.2385,.6264,.3383,.2795,.0288],f,h,l,n=1;n<=d;n++){h=l=k.zero;f=a.value[c];for(e=c-1;0<=e;e--)l=k.add(h,k.mult(l,b)),h=k.add(f,k.mult(h,b)),f=k.add(a.value[e],k.mult(f,b));if(k._helper.isLessThan(k.abs(f),k.real(1E-14)))break;
e=k.div(h,f);h=k.mult(e,e);f=k.sub(h,k.div(k.mult(k.real(2),l),f));l=k.sqrt(k.mult(k.real(c-1),k.sub(k.mult(k.real(c),f),h)));f=k.add(e,l);e=k.sub(e,l);k._helper.isLessThan(k.abs(f),k.abs(e))&&(f=e);e=k._helper.isLessThan(k.real(1E-14),k.abs(f))?k.div(k.real(c),f):k.mult(k.add(k.abs(b),k.one),k.complex(Math.cos(n),Math.sin(n)));if(k._helper.isLessThan(k.abs(e),k.real(1E-14)))break;0===n%20&&n<d-19&&(e=k.mult(e,k.real(g[Math.floor(n/20)])));b=k.sub(b,e)}return b};D.quadratic_roots=function(a){if("list"!==
a.ctype)return t;var b=a.value[2],d=a.value[1];a=a.value[0];if(k._helper.isZero(a))return g.turnIntoCSList([k.zero,k.neg(k.div(d,b))]);var c=k.sqrt(k.sub(k.mult(d,d),k.mult(k.real(4),k.mult(b,a))));0<=k.re(d)&&(c=k.neg(c));return[k.div(k.sub(c,d),k.mult(k.real(2),b)),k.div(k.mult(k.real(2),a),k.sub(c,d))]};D.roots=function(a){var b=[],d=a,c=a.value.length-1;if(0>=c)return g.turnIntoCSList([]);if(k._helper.isZero(a.value[c]))return b=D.roots(g.turnIntoCSList(a.value.slice(0,c))),g.append(b,k.infinity);
if(1===c)b[0]=k.neg(k.div(a.value[0],a.value[1]));else if(2===c)b=D.quadratic_roots(a);else{for(var e=0;e<c-2;e++){b[e]=D.laguerre(a,k.zero,200);b[e]=D.laguerre(d,b[e],1);var f=[];f[c-e]=a.value[c-e];for(var h=c-e;0<h;h--)f[h-1]=k.add(a.value[h-1],k.mult(f[h],b[e]));f.shift();a=g.turnIntoCSList(f)}a=D.quadratic_roots(a);b[c-2]=a[0];b[c-1]=a[1]}return g.turnIntoCSList(b)};u.roots$1=function(a,b){var d=B(a[0]);if("list"===d.ctype){for(var c=0;c<d.value.length;c++)if("number"!==d.value[c].ctype)return t;
d=D.roots(d);return g.sort1(d)}return t};u.autodiff$3=function(a,b){var d="x",c;if("function"===a[0].ctype)c=Za[a[0].oper].body,d=a[0].args[0].name;else if("function"===typeof a[0].impl)c=a[0];else return console.log("could not parse function"),t;var e=B(a[1]),g=B(a[2]);if(1>g.value.real)return console.log("grade cant be < 1"),t;g=k.add(g,k.real(1));return O.autodiff(c,d,e,g)};u.cos$1=function(a,b){var d=B(a[0]);return"number"===d.ctype?k.cos(d):t};u.tan$1=function(a,b){var d=B(a[0]);return"number"===
d.ctype?k.tan(d):t};u.arccos$1=function(a,b){var d=B(a[0]);return"number"===d.ctype?k.arccos(d):t};u.arcsin$1=function(a,b){var d=B(a[0]);return"number"===d.ctype?k.arcsin(d):t};u.arctan$1=function(a,b){var d=B(a[0]);return"number"===d.ctype?k.arctan(d):t};u.arctan2$2=function(a,b){var d=B(a[0]),c=B(a[1]);return"number"===d.ctype&&"number"===c.ctype?k.arctan2(d,c):t};u.arctan2$1=function(a,b){var d=B(a[0]);if("list"===d.ctype&&2===d.value.length){if(d=d.value,"number"===d[0].ctype&&"number"===d[1].ctype)return u.arctan2$2(d,
b)}else if("number"===d.ctype)return k.arctan2(d);return t};u.log$1=function(a,b){var d=B(a[0]);return"number"===d.ctype?k.log(d):t};D.recursiveGen=function(a){var b=k[a],d=g[a];u[a+"$1"]=function(a,c){var e=B(a[0]);return"number"===e.ctype?b(e):"list"===e.ctype?d(e):t}};D.recursiveGen("im");D.recursiveGen("re");D.recursiveGen("conjugate");D.recursiveGen("round");D.recursiveGen("ceil");D.recursiveGen("floor");D.recursiveGen("abs");u.abs_infix=u.abs$1;u.random$0=function(a,b){return k.real(k._helper.rand())};
u.random$1=function(a,b){var d=B(a[0]);return"number"===d.ctype?k.complex(d.value.real*k._helper.rand(),d.value.imag*k._helper.rand()):t};u.seedrandom$1=function(a,b){var d=B(a[0]);"number"===d.ctype&&k._helper.seedrandom(d.value.real);return t};u.randomnormal$0=function(a,b){return k.real(k._helper.randnormal())};u.randominteger$1=function(a,b){var d=B(a[0]);if("number"===d.ctype){var c=d.value.real|0,d=d.value.imag|0,c=c*k._helper.rand()|0,d=d*k._helper.rand()|0;return k.complex(c,d)}return t};
u.randomint$1=u.randominteger$1;u.randombool$0=function(a,b){return.5<k._helper.rand()?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.isreal$1=function(a,b){var d=A(a[0]);return"number"===d.ctype&&k._helper.isAlmostReal(d)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.isinteger$1=function(a,b){var d=A(a[0]);return"number"===d.ctype&&k._helper.isAlmostReal(d)&&d.value.real===Math.floor(d.value.real)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.iseven$1=function(a,b){var d=
A(a[0]);return"number"===d.ctype&&k._helper.isAlmostReal(d)&&d.value.real/2===Math.floor(d.value.real/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.isodd$1=function(a,b){var d=A(a[0]);return"number"===d.ctype&&k._helper.isAlmostReal(d)&&(d.value.real-1)/2===Math.floor((d.value.real-1)/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.iscomplex$1=function(a,b){return"number"===A(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.isstring$1=function(a,b){return"string"===
A(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.islist$1=function(a,b){return"list"===A(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.ismatrix$1=function(a,b){var d=A(a[0]);return-1!==g._helper.colNumb(d)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.iscircle$1=function(a,b){var d=A(a[0]);return"geo"===d.ctype&&"C"===d.value.kind&&"Circle"===d.value.matrix.usage?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.isconic$1=function(a,b){var d=
A(a[0]);return"geo"===d.ctype&&"C"===d.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.isline$1=function(a,b){var d=A(a[0]);return"geo"===d.ctype&&"L"===d.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.ispoint$1=function(a,b){var d=A(a[0]);return"geo"===d.ctype&&"P"===d.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.isgeometric$1=function(a,b){return"geo"===A(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.isnumbermatrix$1=
function(a,b){var d=A(a[0]);return g.isNumberMatrix(d).value?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.isnumbervector$1=function(a,b){var d=A(a[0]);return g.isNumberVector(d).value?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.issun$1=function(a,b){var d=A(a[0]);return"geo"===d.ctype&&void 0!==d.value.behavior&&"Sun"===d.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.ismass$1=function(a,b){var d=A(a[0]);return"geo"===d.ctype&&void 0!==d.value.behavior&&
"Mass"===d.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.isspring$1=function(a,b){var d=A(a[0]);return"geo"===d.ctype&&void 0!==d.value.behavior&&"Spring"===d.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.isbouncer$1=function(a,b){var d=A(a[0]);return"geo"===d.ctype&&void 0!==d.value.behavior&&"Bouncer"===d.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.isundefined$1=function(a,b){return"undefined"===A(a[0]).ctype?
{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};u.matrixrowcolumn$1=function(a,b){var d=A(a[0]);return-1!==g._helper.colNumb(d)?g.realVector([d.value.length,d.value[0].value.length]):t};u.rowmatrix$1=function(a,b){var d=A(a[0]);return"list"===d.ctype?g.turnIntoCSList([d]):t};u.columnmatrix$1=function(a,b){var d=A(a[0]);return"list"===d.ctype?g.turnIntoCSList(d.value.map(function(a){return g.turnIntoCSList([a])})):t};u.submatrix$3=function(a,b){var d=A(a[0]),c=A(a[1]),e=A(a[2]);if("list"===
d.ctype&&"number"===c.ctype&&"number"===e.ctype){var f=Math.round(c.value.real),c=Math.round(e.value.real),d=d.value.slice();0<c&&c<=d.length&&d.splice(c-1,1);var h=!0,d=d.map(function(a){if("list"!==a.ctype)h=!1;else return a=a.value.slice(),0<f&&f<=a.length&&a.splice(f-1,1),g.turnIntoCSList(a)});return h?g.turnIntoCSList(d):t}return t};u.complex$1=function(a,b){var d,c,e;e=B(a[0]);if("list"===e.ctype&&g.isNumberVector(e)){if(2===e.value.length)return d=e.value[0],c=e.value[1],k.complex(d.value.real-
c.value.imag,c.value.real+d.value.imag);if(3===e.value.length)return d=e.value[0],c=e.value[1],e=e.value[2],d=k.div(d,e),c=k.div(c,e),k.complex(d.value.real-c.value.imag,c.value.real+d.value.imag)}return t};u.gauss$1=function(a,b){var d=B(a[0]);return"number"===d.ctype?g.realVector([d.value.real,d.value.imag]):t};u.cross$2=function(a,b){var d=N(a[0]),c=N(a[1]);if(d!==t&&c!==t){var e=g.cross(d,c);"Point"===d.usage&&"Point"===c.usage&&(e=w.withUsage(e,"Line"));"Line"===d.usage&&"Line"===c.usage&&(e=
w.withUsage(e,"Point"));return e}return t};u.crossratio$4=function(a,b){var d=A(a[0]),c=A(a[1]),e=A(a[2]),f=A(a[3]),h=N(d),l=N(c),n=N(e),p=N(f);return h!==t&&l!==t&&n!==t&&p!==t?g.crossratio3(h,l,n,p,g.ii):"number"===d.ctype&&"number"===c.ctype&&"number"===e.ctype&&"number"===f.ctype?k.div(k.mult(k.sub(d,e),k.sub(c,f)),k.mult(k.sub(d,f),k.sub(c,e))):t};u.para$2=function(a,b){var d=B(a[0]),c=B(a[1]),e=N(d),f=N(c);if(d!==t&&c!==t){var c=c.usage,h=e,k=f;if("Line"===d.usage||"Point"===c)h=f,k=e;d=g.cross(g.cross(g.linfty,
k),h);return w.withUsage(d,"Line")}return t};u.perp$2=function(a,b){var d=B(a[0]),c=B(a[1]),e=N(d),f=N(c);if(d!==t&&c!==t){var h=c.usage||f.usage,c=e,l=f;if("Line"===(d.usage||e.usage)||"Point"===h)c=f,l=e;d=g.turnIntoCSList([l.value[0],l.value[1],k.zero]);d=g.cross(d,c);return w.withUsage(d,"Line")}return t};u.perp$1=function(a,b){var d=B(a[0]);return g._helper.isNumberVecN(d,2)?g.turnIntoCSList([k.neg(d.value[1]),d.value[0]]):t};u.parallel$2=u.para$2;u.perpendicular$2=u.perp$2;u.perpendicular$1=
u.perp$1;u.meet$2=function(a,b){var d=N(a[0]),c=N(a[1]);return d!==t&&c!==t?(d=g.cross(d,c),w.withUsage(d,"Point")):t};u.join$2=function(a,b){var d=N(a[0]),c=N(a[1]);return d!==t&&c!==t?(d=g.cross(d,c),w.withUsage(d,"Line")):t};u.dist$2=function(a,b){var d=B(a[0]),c=B(a[1]),d=tb([d,c],[]);return u.abs$1([d],[])};u.dist_infix=u.dist$2;u.point$1=function(a,b){var d=A(a[0]);return g._helper.isNumberVecN(d,3)||g._helper.isNumberVecN(d,2)?w.withUsage(d,"Point"):d};u.line$1=function(a,b){var d=A(a[0]);
return g._helper.isNumberVecN(d,3)?w.withUsage(d,"Line"):d};u.det$3=function(a,b){var d=N(a[0]),c=N(a[1]),e=N(a[2]);if(d!==t&&c!==t&&e!==t)return g.det3(d,c,e)};u.det$1=function(a,b){var d=B(a[0]);if("list"===d.ctype){var c=g._helper.colNumb(d);if(-1!==c&&c===d.value.length)return g.det(d)}return t};u.eig$1=function(a,b){var d=B(a[0]);if("list"===d.ctype){var c=g._helper.colNumb(d);if(-1!==c&&c===d.value.length)return g.eig(d)}return t};u.eigenvalues$1=function(a,b){var d=B(a[0]);if("list"===d.ctype){var c=
g._helper.colNumb(d);if(-1!==c&&c===d.value.length)return g.eig(d,!1).value[0]}return t};u.rank$1=function(a,b){var d=B(a[0]);if("list"===d.ctype){var c=g._helper.colNumb(d);if(-1!==c&&c===d.value.length)return g.rank(d,b.precision)}return t};u.kernel$1=function(a,b){var d=B(a[0]);if("list"===d.ctype){var c=g._helper.colNumb(d);if(-1!==c&&c===d.value.length)return d=g.nullSpace(d,b.precision),g.transpose(d)}return t};u.eigenvectors$1=function(a,b){var d=B(a[0]);if("list"===d.ctype){var c=g._helper.colNumb(d);
if(-1!==c&&c===d.value.length)return g.eig(d).value[1]}return t};u.area$3=function(a,b){var d=N(a[0]),c=N(a[1]),e=N(a[2]);if(d!==t&&c!==t&&e!==t){var f=d.value[2],h=c.value[2],l=e.value[2];if(!k._helper.isAlmostZero(f)&&!k._helper.isAlmostZero(h)&&!k._helper.isAlmostZero(l))return d=g.scaldiv(f,d),c=g.scaldiv(h,c),e=g.scaldiv(l,e),d=g.det3(d,c,e),k.realmult(.5,d)}return t};u.inverse$1=function(a,b){var d=B(a[0]);if("list"===d.ctype){var c=g._helper.colNumb(d);if(-1!==c&&c===d.value.length)return g.inverse(d)}return t};
u.linearsolve$2=function(a,b){var d=B(a[0]),c=B(a[1]);if("list"===d.ctype){var e=g._helper.colNumb(d);if(-1!==e&&e===d.value.length&&g._helper.isNumberVecN(c,e))return g.linearsolve(d,c)}return t};var Nc=[[[]],[[0]],[[0,1],[1,0]],[[0,1,2],[0,2,1],[1,0,2],[1,2,0],[2,0,1],[2,1,0]],[[0,1,2,3],[0,1,3,2],[0,2,1,3],[0,2,3,1],[0,3,1,2],[0,3,2,1],[1,0,2,3],[1,0,3,2],[1,2,0,3],[1,2,3,0],[1,3,0,2],[1,3,2,0],[2,0,1,3],[2,0,3,1],[2,1,0,3],[2,1,3,0],[2,3,0,1],[2,3,1,0],[3,0,1,2],[3,0,2,1],[3,1,0,2],[3,1,2,0],
[3,2,0,1],[3,2,1,0]]];u.mincostmatching$1=function(a,b){var d=A(a[0]);if(g.isNumberMatrix(d)){var c=d.value.length,e=g._helper.colNumb(d),f=c<e?e:c,h,l,n=Array(f);for(h=0;h<f;++h)for(n[h]=Array(f),l=0;l<f;++l)n[h][l]=h<c&&l<e?d.value[h].value[l].value.real:0;d=Bb(n);f=Array(c);for(h=0;h<c;++h)l=d[h],f[h]=l<e?k.real(l+1):k.real(0);return g.turnIntoCSList(f)}return t};u.take$2=Cb;u.length$1=function(a,b){var d=A(a[0]);return"list"===d.ctype||"string"===d.ctype?k.real(d.value.length):t};u.pairs$1=function(a,
b){var d=A(a[0]);return"list"===d.ctype?g.pairs(d):t};u.triples$1=function(a,b){var d=A(a[0]);return"list"===d.ctype?g.triples(d):t};u.cycle$1=function(a,b){var d=A(a[0]);return"list"===d.ctype?g.cycle(d):t};u.consecutive$1=function(a,b){var d=A(a[0]);return"list"===d.ctype?g.consecutive(d):t};u.reverse$1=function(a,b){var d=A(a[0]);return"list"===d.ctype?g.reverse(d):t};u.directproduct$2=function(a,b){var d=A(a[0]),c=A(a[1]);return"list"===d.ctype&&"list"===c.ctype?g.directproduct(d,c):t};u.concat$2=
jc;u.common$2=kc;u.remove$2=lc;u.append$2=mc;u.prepend$2=nc;u.contains$2=function(a,b){var d=A(a[0]),c=A(a[1]);return"list"===d.ctype?g.contains(d,c):t};u.sort$2=function(a,b){return u.sort$3([a[0],null,a[1]],b)};u.sort$3=function(a,b){var d=B(a[0]);if("list"!==d.ctype)return t;var c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);var d=d.value,e=[];L.newvar(c);var g;for(g=0;g<d.length;g++)L.setvar(c,d[g]),e[g]={val:d[g],result:A(a[2])};L.removevar(c);e.sort(w.compareResults);c=[];for(g=0;g<
d.length;g++)c[g]=e[g].val;return{ctype:"list",value:c}};u.sort$1=function(a,b){var d=A(a[0]);return"list"===d.ctype?g.sort1(d):t};u.set$1=function(a,b){var d=A(a[0]);return"list"===d.ctype?g.set(d):t};u.combinations$2=function(a,b){function d(a,b){a===h?n.push(g.turnIntoCSList(l.slice())):b<f&&(l[a]=c.value[b],d(a+1,b+1),d(a,b+1))}var c=A(a[0]),e=A(a[1]),f,h,l,n;if("number"===e.ctype){h=e.value.real|0;if("number"===c.ctype){f=c.value.real|0;f-h<h&&(h=f-h);if(0>h)return k.real(0);if(0===h)return k.real(1);
if(1===h)return c;for(var p=e=1,q=1;q<=h;++q)var r=f-h+q|0,u=q|0,v=Db(r,u)|0,r=r/v|0,u=u/v|0,v=Db(e,u)|0,e=e/v|0,u=u/v|0,v=Db(r,p)|0,r=r/v|0,p=p/v|0,e=e*r|0,p=p*u|0;return k.real(e/p)}if("list"===c.ctype){f=c.value.length;if(0>h||h>f)return g.turnIntoCSList([]);if(0===h)return g.turnIntoCSList([g.turnIntoCSList([])]);if(h===f)return g.turnIntoCSList([c]);n=[];l=Array(h);d(0,0);return g.turnIntoCSList(n)}}return t};u.zeromatrix$2=function(a,b){var d=B(a[0]),c=B(a[1]);return"number"===d.ctype&&"number"===
c.ctype?g.zeromatrix(d,c):t};u.zerovector$1=function(a,b){var d=B(a[0]);return"number"===d.ctype?g.zerovector(d):t};u.transpose$1=function(a,b){var d=B(a[0]);return"list"===d.ctype&&-1!==g._helper.colNumb(d)?g.transpose(d):t};u.row$2=function(a,b){var d=B(a[0]),c=B(a[1]);return"number"===c.ctype&&"list"===d.ctype&&-1!==g._helper.colNumb(d)?g.row(d,c):t};u.column$2=function(a,b){var d=B(a[0]),c=B(a[1]);return"number"===c.ctype&&"list"===d.ctype&&-1!==g._helper.colNumb(d)?g.column(d,c):t};u.red$1=function(a,
b){var d=A(a[0]);return"number"===d.ctype?g.realVector([Math.min(1,Math.max(0,d.value.real)),0,0]):t};u.green$1=function(a,b){var d=A(a[0]);return"number"===d.ctype?g.realVector([0,Math.min(1,Math.max(0,d.value.real)),0]):t};u.blue$1=function(a,b){var d=A(a[0]);return"number"===d.ctype?g.realVector([0,0,Math.min(1,Math.max(0,d.value.real))]):t};u.gray$1=function(a,b){var d=A(a[0]);return"number"===d.ctype?(d=Math.min(1,Math.max(0,d.value.real)),g.realVector([d,d,d])):t};u.grey$1=u.gray$1;D.HSVtoRGB=
function(a,b,d){var c,e,f,h,k,l;a&&void 0===b&&void 0===d&&(b=a.s,d=a.v,a=a.h);h=Math.floor(6*a);k=6*a-h;a=d*(1-b);l=d*(1-k*b);b=d*(1-(1-k)*b);switch(h%6){case 0:c=d;e=b;f=a;break;case 1:c=l;e=d;f=a;break;case 2:c=a;e=d;f=b;break;case 3:c=a;e=l;f=d;break;case 4:c=b;e=a;f=d;break;case 5:c=d,e=a,f=l}return g.realVector([c,e,f])};u.hue$1=function(a,b){var d=A(a[0]);return"number"===d.ctype?(d=d.value.real,d-=Math.floor(d),D.HSVtoRGB(d,1,1)):t};D.shapeconvert=function(a){var b,d;if("circle"===a.type){b=
a.value.value[0];b=w.div(b,b.value[2]);var c=b.value[0].value.real,e=b.value[1].value.real;a=a.value.value[1].value.real;d=[];var g=2*Math.PI/36;for(b=0;36>b;b++)d[b]={X:c+Math.cos(b*g)*a,Y:e+Math.sin(b*g)*a};return[d]}if("polygon"===a.type){c=[];for(b=0;b<a.value.length;b++){e=a.value[b];d=[];for(g=0;g<e.length;g++)d[g]={X:e[g].X,Y:e[g].Y};c[b]=d}return c}};D.shapeop=function(a,b,d){a=D.shapeconvert(a);var c=D.shapeconvert(b);ClipperLib.JS.ScaleUpPaths(a,1E3);ClipperLib.JS.ScaleUpPaths(c,1E3);b=
new ClipperLib.Clipper;b.AddPaths(a,ClipperLib.PolyType.ptSubject,!0);b.AddPaths(c,ClipperLib.PolyType.ptClip,!0);var c=a=ClipperLib.PolyFillType.pftNonZero,e=new ClipperLib.Paths;b.Execute(d,e,a,c);ClipperLib.JS.ScaleDownPaths(e,1E3);return{ctype:"shape",type:"polygon",value:e}};D.shapecommon=function(a,b){return D.shapeop(a,b,ClipperLib.ClipType.ctIntersection)};D.shaperemove=function(a,b){return D.shapeop(a,b,ClipperLib.ClipType.ctDifference)};D.shapeconcat=function(a,b){return D.shapeop(a,b,ClipperLib.ClipType.ctUnion)};
u.key$0=function(a,b){return{ctype:"string",value:ec}};u.keycode$0=function(a,b){return k.real(fc)};u.mouse$0=function(a,b){return g.realVector([ab[0],ab[1]])};u.mover$0=function(a,b){if(ea&&ea.mover)return{ctype:"geo",value:ea.mover,type:"P"};console.log("Not moving anything at the moment");return t};u.translate$1=function(a,b){var d=B(a[0]);"list"===d.ctype&&g.isNumberVector(d)&&2===d.value.length&&v.translate(d.value[0].value.real,d.value[1].value.real);return t};u.rotate$1=function(a,b){var d=
B(a[0]);"number"===d.ctype&&v.rotate(d.value.real);return t};u.scale$1=function(a,b){var d=B(a[0]);"number"===d.ctype&&v.scale(d.value.real);return t};u.greset$0=function(a,b){var d=Ba.stack.length;v.greset();for(var c=0;c<d;c++)C.restore();return t};u.gsave$0=function(a,b){v.gsave();C.save();return t};u.grestore$0=function(a,b){v.grestore();C.restore();return t};u.color$1=function(a,b){var d=B(a[0]);"list"===d.ctype&&g.isNumberVector(d).value&&v.setcolor(d);return t};u.linecolor$1=function(a,b){var d=
B(a[0]);"list"===d.ctype&&g.isNumberVector(d).value&&v.setlinecolor(d);return t};u.pointcolor$1=function(a,b){var d=B(a[0]);"list"===d.ctype&&g.isNumberVector(d).value&&v.setpointcolor(d);return t};u.alpha$1=function(a,b){var d=B(a[0]);"number"===d.ctype&&v.setalpha(d);return t};u.pointsize$1=function(a,b){var d=B(a[0]);"number"===d.ctype&&v.setpointsize(d);return t};u.linesize$1=function(a,b){var d=B(a[0]);"number"===d.ctype&&v.setlinesize(d);return t};u.textsize$1=function(a,b){var d=B(a[0]);"number"===
d.ctype&&v.settextsize(d);return t};u.playanimation$0=function(a,b){U();return t};u.pauseanimation$0=function(a,b){R();return t};u.stopanimation$0=function(a,b){Oa();return t};u.replace$3=function(a,b){var d=A(a[0]),c=A(a[1]),e=A(a[2]);if("string"===d.ctype&&"string"===c.ctype&&"string"===e.ctype)return d=d.value,c=c.value.replace(/[^A-Za-z0-9]/g,"\\$&"),e=e.value.replace(/\$/g,"$$$$"),d=d.replace(new RegExp(c,"g"),e),{ctype:"string",value:d}};u.replace$2=function(a,b){function d(a,b,d){var m="";
e=c=-1;for(var g=0;g<b.length;g++){var f=b[g][0],h=a.indexOf(f,d);-1!==h&&(-1===c?(m=f,c=h,e=g):h<c&&(m=f,c=h,e=g))}return m}var c,e,g,f=A(a[0]);g=A(a[1]);if("string"===f.ctype&&"list"===g.ctype){for(var f=f.value,h=[],k=0;k<g.value.length;k++){var l=g.value[k];"list"===l.ctype&&2===l.value.length&&"string"===l.value[0].ctype&&"string"===l.value[1].ctype&&(h[h.length]=[l.value[0].value,l.value[1].value])}c=-1;for(g=d(f,h,0);-1!==c;)f=f.substring(0,c)+h[e][1]+f.substring(c+g.length,f.length),g=c+h[e][1].length,
g=d(f,h,g);return{ctype:"string",value:f}}return t};u.substring$3=function(a,b){var d=A(a[0]),c=B(a[1]),e=B(a[2]);return"string"===d.ctype&&"number"===c.ctype&&"number"===e.ctype?{ctype:"string",value:d.value.substring(Math.floor(c.value.real),Math.floor(e.value.real))}:t};u.tokenize$2=function(a,b){var d=A(a[0]),c=A(a[1]);if("string"===d.ctype&&"string"===c.ctype)return u.tokenize$2([d,g.turnIntoCSList([c])],b);if("string"===d.ctype&&"list"===c.ctype){d=d.value;if(0===c.value.length){c=!0;if(void 0!==
b.autoconvert){var e=A(b.autoconvert);"boolean"===e.ctype&&(c=e.value)}return c&&(c=parseFloat(d),!isNaN(c))?k.real(c):w.string(d)}var e=c.value[0],f=g.turnIntoCSList(c.value.slice(1)),d=d.split(e.value);return g.turnIntoCSList(d.map(function(a){return u.tokenize$2([w.string(a),f],b)}))}return t};u.indexof$2=function(a,b){var d=A(a[0]),c=A(a[1]);return"string"===d.ctype&&"string"===c.ctype?(d=d.value.indexOf(c.value),k.real(d+1)):t};u.indexof$3=function(a,b){var d=A(a[0]),c=A(a[1]),e=A(a[2]);return"string"===
d.ctype&&"string"===c.ctype&&"number"===e.ctype?(d=d.value.indexOf(c.value,Math.round(e.value.real)-1),k.real(d+1)):t};u.parse$1=function(a,b){var d=A(a[0]);return"string"===d.ctype?(d=bb(d.value),d=la(d),A(d)):t};u.unicode$1=function(a,b){var d;d=A(a[0]);var c=16;if(b.base){var e=A(b.base);"number"===e.ctype&&(c=e.value.real)}if("string"===d.ctype)d=parseInt(d.value,c);else if("number"===d.ctype)d=d.value.real;else return t;"undefined"!==typeof String.fromCodePoint?d=String.fromCodePoint(d):65535>=
d?d=String.fromCharCode(d):(d-=65536,d=String.fromCharCode((d>>10)+55296,(d&1023)+56320));return w.string(d)};u.international$1=function(a,b){return u.international$2([a[0],null],b)};u.international$2=function(a,b){var d=A(a[0]);if("string"!==d.ctype)return t;var c=(r.translations||{})[r.language||"en"]||{};if(!c.hasOwnProperty(d.value))return d;var e=c[d.value];if("string"===typeof e)return w.string(e);if(null===a[1])return d;var g=A(a[1]),g="number"===g.ctype?g.value.real:0,c=(c._pluralFormFunction||
Oc)(g);return c<e.length?w.string(e[c]):d};u.currentlanguage$0=function(a,b){return w.string(r.language||"en")};D.basismap=function(a,b,d,c){var e=g.turnIntoCSList([a,b,d]),e=g.adjoint3(g.transpose(e));c=w.mult(e,c);e=g.turnIntoCSList([w.mult(c.value[0],a),w.mult(c.value[1],b),w.mult(c.value[2],d)]);return g.transpose(e)};u.map$8=function(a,b){var d=N(a[0]),c=N(a[1]),e=N(a[2]),f=N(a[3]),h=N(a[4]),k=N(a[5]),l=N(a[6]),n=N(a[7]);return h!==t&&k!==t&&l!==t&&n!==t&&d!==t&&c!==t&&e!==t&&f!==t?(h=D.basismap(h,
k,l,n),d=D.basismap(d,c,e,f),d=w.mult(h,g.adjoint3(d)),g.normalizeMax(d)):t};u.map$6=function(a,b){var d=N(a[0]),c=N(a[1]),e=N(a[2]),f=g.realVector([0,0,1]),h=g.cross,k=h(h(e,h(f,h(d,c))),h(c,h(f,h(d,e)))),l=N(a[3]),n=N(a[4]),p=N(a[5]),f=h(h(p,h(f,h(l,n))),h(n,h(f,h(l,p))));return l!==t&&n!==t&&p!==t&&f!==t&&d!==t&&c!==t&&e!==t&&k!==t?(l=D.basismap(l,n,p,f),d=D.basismap(d,c,e,k),d=w.mult(l,g.adjoint3(d)),g.normalizeMax(d)):t};u.map$4=function(a,b){var d=g.ii,c=g.jj,e=N(a[0]),f=N(a[1]),h=N(a[2]),k=
N(a[3]);return h!==t&&k!==t&&e!==t&&f!==t?(h=D.basismap(h,k,d,c),d=D.basismap(e,f,d,c),d=w.mult(h,g.adjoint3(d)),g.normalizeMax(d)):t};u.map$2=function(a,b){var d=g.ii,c=g.jj,e=N(a[0]),f=w.add(g.realVector([1,0,0]),e),h=N(a[1]),k=w.add(g.realVector([1,0,0]),h);return h!==t&&k!==t&&e!==t&&f!==t?(h=D.basismap(h,k,d,c),d=D.basismap(e,f,d,c),d=w.mult(h,g.adjoint3(d)),g.normalizeMax(d)):t};u.pointreflect$1=function(a,b){var d=g.ii,c=g.jj,e=N(a[0]),f=w.add(g.realVector([1,0,0]),e),h=w.add(g.realVector([-1,
0,0]),e);return h!==t&&e!==t&&f!==t?(h=D.basismap(e,h,d,c),d=D.basismap(e,f,d,c),d=w.mult(h,g.adjoint3(d)),g.normalizeMax(d)):t};u.linereflect$1=function(a,b){var d=g.ii,c=g.jj,e=N(a[0]),f=g.realVector([Math.random(),Math.random(),Math.random()]),h=g.realVector([Math.random(),Math.random(),Math.random()]),f=g.cross(f,e),h=g.cross(h,e);return e!==t&&f!==t?(e=D.basismap(f,h,d,c),d=D.basismap(f,h,c,d),d=w.mult(e,g.adjoint3(d)),g.normalizeMax(d)):t};D.extractPointVec=function(a){var b={ok:!1};if("geo"===
a.ctype){var d=a.value;if("P"===d.kind)return b.x=sa.getField(d,"x"),b.y=sa.getField(d,"y"),b.z=k.real(1),b.ok=!0,b}if("list"!==a.ctype)return b;var c=a.value;if(2===c.length&&(a=c[0],d=c[1],"number"===a.ctype&&"number"===d.ctype))return b.x=a,b.y=d,b.z=k.real(1),b.ok=!0,b;3===c.length&&(a=c[0],d=c[1],c=c[2],"number"===a.ctype&&"number"===d.ctype&&"number"===c.ctype&&(b.x=k.div(a,c),b.y=k.div(d,c),b.z=k.real(1),b.ok=!0));return b};u.polygon$1=function(a,b){var d=A(a[0]);if("list"===d.ctype){for(var c=
[],e=0;e<d.value.length;e++){var g=D.extractPoint(d.value[e]);if(!g.ok)return t;c[e]={X:g.x,Y:g.y}}return{ctype:"shape",type:"polygon",value:[c]}}return t};u.circle$2=function(a,b){var d=B(a[0]),c=B(a[1]),d=D.extractPointVec(d);if(!d.ok||"number"!==c.ctype)return t;d=g.turnIntoCSList([d.x,d.y,d.z]);return{ctype:"shape",type:"circle",value:g.turnIntoCSList([d,c])}};u.screen$0=function(a,b){var d=v.drawingstate.initialmatrix,c=function(a,b){var c=a-d.tx,m=b+d.ty;return{X:(c*d.d-m*d.b)/d.det,Y:-(-c*
d.c+m*d.a)/d.det}};return{ctype:"shape",type:"polygon",value:[[c(0,0),c(fa,0),c(fa,Z),c(0,Z)]]}};u.halfplane$2=function(a,b){var d=B(a[0]),c=B(a[1]),e=N(d),f=N(c);if(d!==t&&c!==t){var h=c.usage,c=f;if("Line"===d.usage||"Point"===h)e=f,c=d;d=g.turnIntoCSList([c.value[0],c.value[1],k.zero]);d=g.cross(d,e);f=g.cross(c,d);f=w.div(f,f.value[2]);e=w.div(e,e.value[2]);e=g.sub(e,f);d=g.abs(e);e=w.div(e,d);d=f.value[0].value.real;f=f.value[1].value.real;c=1E3*e.value[0].value.real;e=1E3*e.value[1].value.real;
return{ctype:"shape",type:"polygon",value:[[{X:d+e/2,Y:f-c/2},{X:d+e/2+c,Y:f-c/2+e},{X:d-e/2+c,Y:f+c/2+e},{X:d-e/2,Y:f+c/2}]]}}return t};u.allpoints$0=function(a,b){for(var d=[],c=0;c<H.length;c++)d[c]={ctype:"geo",value:H[c],type:"P"};return{ctype:"list",value:d}};u.allmasses$0=function(a,b){for(var d=[],c=0;c<Y.length;c++)d[c]={ctype:"geo",value:Y[c],type:"P"};return{ctype:"list",value:d}};u.alllines$0=function(a,b){for(var d=[],c=0;c<M.length;c++)d[c]={ctype:"geo",value:M[c],type:"L"};return{ctype:"list",
value:d}};u.createpoint$2=function(a,b){var d=A(a[0]),c=N(a[1]);return"string"!==d.ctype?(console.log("Name must be a string"),t):"list"!==c.ctype&&g.isNumberVector(c)?(console.log("Position must be a number vector"),t):rb({name:d.value,type:"Free",labeled:!0,pos:c})};u.create$3=function(a,b){var d=A(a[0]),c=A(a[1]),e=A(a[2]),g;if("string"===d.ctype)g=d.value;else{if("list"!==d.ctype)return console.log("Names must be a string or a list of strings"),t;if(1!==d.value.length)return console.log("multi-result compatibility operations not supported yet"),
t;if("string"!==d.value[0].ctype)return console.log("Element of names list must be a string"),t;g=d.value[0].value}if("string"!==c.ctype)return console.log("Type must be a string"),t;if("list"!==e.ctype)return console.log("Arguments must be a list"),t;if(void 0===n[c.value])return console.log("Invalid geometric operation: '"+c.value+"'"),t;for(var d=[],f=null,h=0;h<e.value.length;h++){var k=e.value[h];if("string"===k.ctype)d.push(k.value);else if(f=N(k),f===t)return console.log("Unknown argument type"),
t}c={name:g,type:c.value,labeled:!0};f&&(c.pos=f);0<d.length&&(c.args=d);return rb(c)};u.javascript$1=function(a,b){var d=A(a[0]);"string"===d.ctype&&(new Function(d.value)).call(qa);return t};u.use$1=function(a,b){function d(a,b,d){u[a+"$"+b]=d}var c=A(a[0]);if("string"===c.ctype){var c=c.value,e;r.plugins&&(e=r.plugins[c]);e||(e=wa._pluginRegistry[c]);if(e)return e({instance:qa,config:r,nada:t,evaluate:A,extractPoint:D.extractPoint,evaluateAndVal:B,defineFunction:d,addShutdownHook:Wa.push.bind(Wa),
addAutoCleaningEventListener:S,getVariable:L.getvar.bind(L),getInitialMatrix:function(){return v.drawingstate.initialmatrix},setTextRenderer:function(a){yc=a},getImage:function(a,b){if(!oa.hasOwnProperty(a))return null;var d=oa[a];!b&&d.cdyUpdate()&&d.cdyUpdate();return d},getMyfunction:function(a){return Za.hasOwnProperty(a)?Za[a]:null}}),{ctype:"boolean",value:!0};console.log("Plugin "+c+" not found");return{ctype:"boolean",value:!1}}return t};u.format$2=function(a,b){function d(a){a=a.toFixed(f);
var b;do b=a,a=a.substring(0,a.length-1);while(""!==a&&"-"!==a&&+a===+b);return""+b}function c(a){var b;return"number"===a.ctype?(b=d(a.value.real),a=d(a.value.imag),b="0"===a?b:"-"===a.substring(0,1)?b+" - i*"+a.substring(1):b+" + i*"+a,{ctype:"string",value:b}):"list"===a.ctype?{ctype:"list",value:a.value.map(c)}:{ctype:"string",value:I(a).toString()}}var e=B(a[0]),g=B(a[1]),f;return"number"!==e.ctype&&"list"!==e.ctype||"number"!==g.ctype?t:(f=Math.round(g.value.real),c(e))};Date.now||(Date.now=
function(){return(new Date).getTime()});var zc=0;u.seconds$0=function(a,b){return{ctype:"number",value:{real:(Date.now()-zc)/1E3,imag:0}}};u.resetclock$0=function(a,b){zc=Date.now();return t};u.time$0=function(a,b){var d=new Date;return g.realVector([d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds()])};u.date$0=function(a,b){var d=new Date;return g.realVector([d.getFullYear(),d.getMonth(),d.getDay()])};u.setTimeout$2=function(a,c){function d(){A(g);b()}var e=A(a[0]),g=a[1];"number"===
e.ctype&&"undefined"!==typeof window&&window.setTimeout(d,1E3*e.value.real);return t};D.formatForWebGL=function(a){return a.toFixed(10)};u.generateWebGL$2=function(a,b){var d=D.formatForWebGL,c=a[0],e=A(a[1]);console.log(e);if("list"!==e.ctype)return t;for(var g=[],f=0;f<e.value.length;f++)"string"===e.value[f].ctype&&g.push(e.value[f].value);console.log("***********");console.log(g);e=D.plotvars(c);console.log(e);-1===e.indexOf("a")&&-1===e.indexOf("b")&&-1===e.indexOf("c")&&-1===e.indexOf("d")&&
-1===e.indexOf("e")&&-1===e.indexOf("f")&&(c=B(c));if("number"===c.ctype)return{ctype:"string",value:"vec2("+d(c.value.real)+","+d(c.value.imag)+")"};if("variable"===c.ctype)return{ctype:"string",value:c.name};if("string"===c.ctype||"void"===c.ctype)return c;if(2===c.args.length&&("infix"===c.ctype||"function"===c.ctype)){d=u.compileToWebGL$1([c.args[0]],{});e=u.compileToWebGL$1([c.args[1]],{});if("+"===c.oper||"add"===c.oper)return void 0===d.value||"void"===d.ctype?{ctype:"string",value:e.value}:
{ctype:"string",value:"addc("+d.value+","+e.value+")"};if("*"===c.oper||"mult"===c.oper)return{ctype:"string",value:"multc("+d.value+","+e.value+")"};if("/"===c.oper||"div"===c.oper)return{ctype:"string",value:"divc("+d.value+","+e.value+")"};if("-"===c.oper||"sub"===c.oper)return void 0===d.value||"void"===d.ctype?{ctype:"string",value:"negc("+e.value+")"}:{ctype:"string",value:"subc("+d.value+","+e.value+")"};if("^"===c.oper||"pow"===c.oper)return{ctype:"string",value:"powc("+d.value+","+e.value+
")"}}if("function"===c.ctype&&1===c.args.length){d=u.compileToWebGL$1([c.args[0]],{});if("sin$1"===c.oper)return{ctype:"string",value:"sinc("+d.value+")"};if("cos$1"===c.oper)return{ctype:"string",value:"cosc("+d.value+")"};if("tan$1"===c.oper)return{ctype:"string",value:"tanc("+d.value+")"};if("exp$1"===c.oper)return{ctype:"string",value:"expc("+d.value+")"};if("log$1"===c.oper)return{ctype:"string",value:"logc("+d.value+")"};if("arctan$1"===c.oper)return{ctype:"string",value:"arctanc("+d.value+
")"};if("arcsin$1"===c.oper)return{ctype:"string",value:"arcsinc("+d.value+")"};if("arccos$1"===c.oper)return{ctype:"string",value:"arccosc("+d.value+")"};if("sqrt$1"===c.oper)return{ctype:"string",value:"sqrtc("+d.value+")"}}return t};u.compileToWebGL$1=function(a,b){var d,c;d=D.formatForWebGL;var e=a[0];c=D.plotvars(e);-1===c.indexOf("a")&&-1===c.indexOf("b")&&-1===c.indexOf("c")&&-1===c.indexOf("d")&&-1===c.indexOf("e")&&-1===c.indexOf("f")&&(e=B(e));if("number"===e.ctype)return{ctype:"string",
value:"vec2("+d(e.value.real)+","+d(e.value.imag)+")"};if("variable"===e.ctype)return{ctype:"string",value:e.name};if("string"===e.ctype||"void"===e.ctype)return e;if(2===e.args.length&&("infix"===e.ctype||"function"===e.ctype)){d=u.compileToWebGL$1([e.args[0]],{});c=u.compileToWebGL$1([e.args[1]],{});if("+"===e.oper||"add"===e.oper)return void 0===d.value||"void"===d.ctype?{ctype:"string",value:c.value}:{ctype:"string",value:"addc("+d.value+","+c.value+")"};if("*"===e.oper||"mult"===e.oper)return{ctype:"string",
value:"multc("+d.value+","+c.value+")"};if("/"===e.oper||"div"===e.oper)return{ctype:"string",value:"divc("+d.value+","+c.value+")"};if("-"===e.oper||"sub"===e.oper)return void 0===d.value||"void"===d.ctype?{ctype:"string",value:"negc("+c.value+")"}:{ctype:"string",value:"subc("+d.value+","+c.value+")"};if("^"===e.oper||"pow"===e.oper)return{ctype:"string",value:"powc("+d.value+","+c.value+")"}}if("function"===e.ctype&&1===e.args.length){d=u.compileToWebGL$1([e.args[0]],{});if("sin$1"===e.oper)return{ctype:"string",
value:"sinc("+d.value+")"};if("cos$1"===e.oper)return{ctype:"string",value:"cosc("+d.value+")"};if("tan$1"===e.oper)return{ctype:"string",value:"tanc("+d.value+")"};if("exp$1"===e.oper)return{ctype:"string",value:"expc("+d.value+")"};if("log$1"===e.oper)return{ctype:"string",value:"logc("+d.value+")"};if("arctan$1"===e.oper)return{ctype:"string",value:"arctanc("+d.value+")"};if("arcsin$1"===e.oper)return{ctype:"string",value:"arcsinc("+d.value+")"};if("arccos$1"===e.oper)return{ctype:"string$1",value:"arccosc("+
d.value+")"};if("sqrt$1"===e.oper)return{ctype:"string",value:"sqrtc("+d.value+")"}}return t};u.setsimulationspeed$1=function(a,b){var d=B(a[0]);"number"===d.ctype&&"undefined"!==typeof K&&"undefined"!==typeof K.env&&(K.env.deltat=d.value.real);return t};u.setsimulationaccuracy$1=function(a,b){var d=B(a[0]);"number"===d.ctype&&"undefined"!==typeof K&&"undefined"!==typeof K.env&&(K.env.accuracy=d.value.real);return t};u.setsimulationquality$1=function(a,b){var d=B(a[0]);"number"===d.ctype&&"undefined"!==
typeof K&&"undefined"!==typeof K.env&&(d=d.value.real,0===d&&(K.env.errorbound=.01,K.env.lowestdeltat=1E-5,K.env.slowdownfactor=2),1===d&&(K.env.errorbound=.001,K.env.lowestdeltat=1E-7,K.env.slowdownfactor=2),2===d&&(K.env.errorbound=1E-5,K.env.lowestdeltat=1E-10,K.env.slowdownfactor=4),3===d&&(K.env.errorbound=1E-6,K.env.lowestdeltat=1E-12,K.env.slowdownfactor=4));return t};D.extractPoint=function(a){var b={ok:!1};if("geo"===a.ctype){var d=a.value;if("P"===d.kind)return b.x=sa.getField(d,"x").value.real,
b.y=sa.getField(d,"y").value.real,b.ok=!0,b}if("list"!==a.ctype)return b;var c=a.value;if(2===c.length&&(a=c[0],d=c[1],"number"===a.ctype&&"number"===d.ctype))return b.x=a.value.real,b.y=d.value.real,b.ok=!0,b;3===c.length&&(a=c[0],d=c[1],c=c[2],"number"===a.ctype&&"number"===d.ctype&&"number"===c.ctype&&(a=k.div(a,c),d=k.div(d,c),b.x=a.value.real,b.y=d.value.real,b.ok=!0));return b};u.draw$1=function(a,b){var d=B(a[0]);if("shape"===d.ctype)D.drawshape(d,b);else if("Line"===d.usage)y.handleModifs(b,
y.lineModifs),y.drawline(d);else{var c=D.extractPoint(d);if(!c.ok){if("undefined"!==typeof d.value&&2===d.value.length)return u.draw$2(d.value,b);return}null!==b&&y.handleModifs(b,y.pointModifs);y.drawpoint(c)}return t};u.draw$2=function(a,b){var d=B(a[0]),c=B(a[1]),d=D.extractPoint(d),c=D.extractPoint(c);if(!d.ok||!c.ok)return t;null!==b&&y.handleModifs(b,y.lineModifs);y.drawsegcore(d,c);return t};u.drawcircle$2=function(a,b){return D.drawcircle(a,b,"D")};D.arcHelper=function(a){var b={};b.startPoint=
N(a[0]);b.viaPoint=N(a[1]);b.endPoint=N(a[2]);return b};u.fillcircle$2=function(a,b){return D.drawcircle(a,b,"F")};u.drawarc$3=function(a,b){var d=D.arcHelper(a);return D.drawarc(d,b,"D")};u.fillarc$3=function(a,b){var d=D.arcHelper(a);return D.drawarc(d,b,"F")};D.drawarc=function(a,b,d){var c=a.startPoint,e=a.viaPoint;a=a.endPoint;if(!g._helper.isAlmostReal(g.turnIntoCSList([c,e,a])))return t;y.handleModifs(b,y.conicModifs);y.preDrawCurve();b=g.det3(c,e,a);if(1E-12<Math.abs(b.value.real)){b=n._helper.ConicBy5(null,
c,e,a,g.ii,g.jj);var f=n._helper.CenterOfConic(b),f=g.normalizeMax(f);b=k.real(0);var h=g.turnIntoCSList([g.turnIntoCSList([f.value[2],b,k.neg(f.value[0])]),g.turnIntoCSList([b,f.value[2],k.neg(f.value[1])]),g.turnIntoCSList([b,b,f.value[2]])]);b=g.normalizeZ(w.mult(h,c));g.normalizeZ(w.mult(h,e));h=g.normalizeZ(w.mult(h,a));b=-Math.atan2(b.value[1].value.real,b.value[0].value.real);h=-Math.atan2(h.value[1].value.real,h.value[0].value.real);f=g.normalizeZ(f);c=g.normalizeZ(c);e=g.normalizeZ(e);a=
g.normalizeZ(a);var l=g.abs(g.sub(c,f)),p=[f.value[0].value.real,f.value[1].value.real],q=v.drawingstate.matrix,f=p[0]*q.a-p[1]*q.b+q.tx,p=p[0]*q.c-p[1]*q.d-q.ty,e=0<g.det3(c,e,a).value.real;C.save();c=l.value.real*q.sdet;C.beginPath();C.translate(f,p);b>h&&(h+=2*Math.PI);e=e?-(2*Math.PI-h+b)/500:(h-b)/500;C.moveTo(c*Math.cos(b),c*Math.sin(b));for(h=0;500>=h;h++)a=b+h*e,C.lineTo(c*Math.cos(a),c*Math.sin(a));"F"===d&&(C.fillStyle=y.lineColor,C.closePath(),C.fill());"D"===d&&C.stroke();C.restore()}else{if("D"!==
d)return t;d=D.extractPoint(c);h=D.extractPoint(e);b=D.extractPoint(a);if(!d.ok||!h.ok||!b.ok)return t;l=(d.x-h.x)*(d.x-h.x)+(d.y-h.y)*(d.y-h.y);f=(d.x-b.x)*(d.x-b.x)+(d.y-b.y)*(d.y-b.y);q=(b.x-h.x)*(b.x-h.x)+(b.y-h.y)*(b.y-h.y);if(1E-12>l||1E-12>f||1E-12>q)return t;0>g.crossratio3(c,a,e,g.cross(g.cross(c,e),g.linfty),g.ii).value.real?y.drawsegcore(d,b):(e=l>q?1:-1,c=e*(d.x-h.x),e*=d.y-h.y,a=25E3/v.drawingstate.matrix.sdet/Math.sqrt(c*c+e*e),c*=a,e*=a,y.drawsegcore(d,{x:d.x+c,y:d.y+e}),y.drawsegcore(b,
{x:b.x-c,y:b.y-e}))}return t};D.drawcircle=function(a,b,d){var c=B(a[0]);a=B(a[1]);var e=D.extractPoint(c);if(!e.ok||"number"!==a.ctype)return t;var c=v.drawingstate.matrix,g=e.x*c.a-e.y*c.b+c.tx,e=e.x*c.c-e.y*c.d-c.ty;y.handleModifs(b,y.conicModifs);y.preDrawCurve();C.beginPath();C.arc(g,e,a.value.real*c.sdet,0,2*Math.PI);"D"===d&&C.stroke();"F"===d&&(C.fillStyle=y.lineColor,C.fill());"C"===d&&C.clip();return t};u.drawconic$1=function(a,b){var d;d=B(a[0]);if("list"!==d.ctype||3!==d.value.length&&
6!==d.value.length)return console.error("could not parse conic"),t;if(6===d.value.length){for(var c=0;6>c;c++)if("number"!==d.value[c].ctype)return console.error("could not parse conic"),t;var e=k.real(.5),c=d.value[0],f=d.value[2],f=k.mult(f,e),h=d.value[1],l=d.value[3],l=k.mult(l,e),n=d.value[4],n=k.mult(n,e);d=d.value[5];d=g.turnIntoCSList([g.turnIntoCSList([c,f,l]),g.turnIntoCSList([f,h,n]),g.turnIntoCSList([l,n,d])])}else{for(c=0;3>c;c++)for(f=0;3>f;f++)if("number"!==d.value[c].value[f].ctype)return console.error("could not parse conic"),
t;g.equals(d,g.transpose(d)).value||(c=w.mult(d,k.real(.5)),d=w.mult(g.transpose(d),k.real(.5)),d=g.add(c,d))}d=g.normalizeMax(d);return D.drawconic(d,b)};D.drawconic=function(a,b){y.handleModifs(b,y.conicModifs);if(0!==y.lsize){y.preDrawCurve();for(var d=g.normalizeMax(a),c=d,e=0;2>e;e++)for(var f=0;2>f;f++)if(Math.abs(d.value[e].value[f].value.imag)>k.eps)return;e=g.turnIntoCSList([g.realVector([-1,-1,1]),g.realVector([1,0,0]),g.realVector([0,1,0])]);f=v.from(0,0,1);f[2]=1;var h=v.from(1,0,1);h[2]=
1;var l=v.from(0,1,1);l[2]=1;var f=g.turnIntoCSList([g.realVector(f),g.realVector(h),g.realVector(l)]),f=g.transpose(f),e=w.mult(f,e),e=g.inverse(e),d=w.mult(g.transpose(e),d),d=w.mult(d,e),e=d.value[0].value[0].value.real,f=d.value[1].value[0].value.real,h=d.value[1].value[1].value.real,l=d.value[2].value[0].value.real,p=d.value[2].value[1].value.real,q=d.value[2].value[2].value.real,d=[[e,f,l],[f,h,p],[l,p,q]],r=1E-14>Math.abs(e*h*q-e*p*p-f*f*q+2*f*l*p-h*l*l);if(r&&"Circle"===a.usage){var x=w.mult(g.adjoint3(c),
g.linfty);k.abs(x.value[2]).value.real>k.eps&&(r=!1)}var x=fa>Z?fa:Z,A=-1.5*x,B=1.5*x,D=-1.5*x,E=1.5*x,F=1;r&&(F=0);if(F)var l=0,l=1E-14<Math.abs(e-f)?Math.atan(f/e-h)/2:Math.PI/4,Xa=function(a){var b=Math.cos(a);a=Math.sin(a);return[[b,-a,0],[a,b,0],[0,0,1]]}(l),Xa=g.realMatrix(Xa),e=g.transpose(Xa),d=w.mult(g.realMatrix(d),Xa),d=w.mult(e,d),e=d.value[0].value[0].value.real,f=d.value[1].value[0].value.real,h=d.value[1].value[1].value.real,l=d.value[2].value[0].value.real,p=d.value[2].value[1].value.real,
q=d.value[2].value[2].value.real;var d=[e,f,h,l,p,q],e=function(){var a=n._helper.splitDegenConic(c);if(a!==t){var d=a[1],a=[a[0]];u.draw$1(a,b);a[0]=d;u.draw$1(a,b)}},G=function(a){"undefined"!==a&&6===a.length||console.error("this does not define a Conic");if(r)return"degenerate";a=a[0]*a[2]-a[1]*a[1];return 1E-14>Math.abs(a)?"parabola":1E-14<a?"ellipsoid":"hyperbola"};G(d);var J=function(a,b){return 0<a&&a<fa&&0<b&&b<Z},I=[],H=[],K=[],L=[],M=[],N=[],O=function(){I=[];H=[];K=[];L=[];M=[];N=[]},
P=function(a,b){C.beginPath();C.moveTo(a[0],b[0]);for(var d=1;d<a.length;d++)C.lineTo(a[d],b[d]);C.stroke()},Q=function(a,b,d){var c,e,m=G(a);if(6!==a.length)console.error("Conic needs 6 Parameters");else{var f=a[0],h=a[1],k=a[2],z=a[3],l=a[4];a=a[5];var n;c=d-b;for(var p=.1*c+b,ia=d-.1*c,q=b;q<=d;q+=n){n=q<p||q>ia||100>Math.abs(d-b)?.5:0>q||q>Z?10:3;e=-f*k*q*q-2*f*l*q-f*a+h*h*q*q+2*h*z*q+z*z;e=Math.sqrt(e);c=1/f*(-h*q-z+e);e=-1/f*(h*q+z+e);var r,t;F?(r=[c,q,1],t=[e,q,1],r=w.mult(Xa,g.realVector(r)),
t=w.mult(Xa,g.realVector(t)),c=r.value[0].value.real,e=t.value[0].value.real,r=r.value[1].value.real,t=t.value[1].value.real):t=r=q;isNaN(c)||"ellipsoid"!==m?!isNaN(c)&&c>=A&&c<=B&&(I.push(c),K.push(r)):(I.push(c),K.push(r));isNaN(e)||"ellipsoid"!==m?!isNaN(e)&&e>=A&&e<=B&&(H.push(e),L.push(t)):(H.push(e),L.push(t))}}},f=function(a){var b,d,c;G(a);if(6!==a.length)console.error("Conic needs 6 Parameters");else{c=a[0];var e=a[1],m=a[2],g=a[3],f=a[4],h=a[5];b=-c*f+e*g;d=Math.sqrt(c*(-c*m*h+c*Math.pow(f,
2)+Math.pow(e,2)*h-2*e*g*f+m*Math.pow(g,2)));m=c*m-Math.pow(e,2);1E-14<Math.abs(m)?(c=(b-d)/m,d=(b+d)/m):d=c=(-c*h+g*g)/(2*c*f-2*e*g);!isNaN(c)&&c>D&&c<E||(c=D);!isNaN(d)&&d>D&&d<E||(d=D);b=c<d?c:d;d=c>d?c:d;Q(a,D,b);M=I.concat(H.reverse());N=K.concat(L.reverse());P(M,N);O();Q(a,d,E);P(I,K);if(J(I[0],K[1])||J(H[0],L[0]))C.beginPath(),C.moveTo(I[0],K[0]),C.lineTo(H[0],L[0]),C.stroke();P(H,L);O();Q(a,b,d);P(I,K);C.beginPath();C.moveTo(I[0],K[0]);C.lineTo(H[0],L[0]);C.stroke();C.beginPath();C.moveTo(I[I.length-
1],K[K.length-1]);C.lineTo(H[H.length-1],L[L.length-1]);C.stroke();P(H,L);O()}};r?e():f(d)}};u.drawall$1=function(a,b){var d=A(a[0]);if("list"===d.ctype){y.handleModifs(b,y.pointAndLineModifs);for(var c=0;c<d.value.length;c++)u.draw$1([d.value[c]],null)}return t};u.connect$1=function(a,b){return D.drawpolygon(a,b,"D",!1)};u.drawpoly$1=function(a,b){return D.drawpolygon(a,b,"D",!0)};u.fillpoly$1=function(a,b){return D.drawpolygon(a,b,"F",!0)};u.drawpolygon$1=function(a,b){return D.drawpolygon(a,b,
"D",!0)};u.fillpolygon$1=function(a,b){return D.drawpolygon(a,b,"F",!0)};D.drawpolygon=function(a,b,d,c){function e(){for(var a=h.value,b=0;b<a.length;b++){var d=a[b],c;for(c=0;c<d.length;c++){var m=d[c],g=m.X*f.a-m.Y*f.b+f.tx,m=m.X*f.c-m.Y*f.d-f.ty;0===c?C.moveTo(g,m):C.lineTo(g,m)}C.closePath()}}function g(){var a;for(a=0;a<h.value.length;a++){var b=D.extractPoint(h.value[a]);if(!b.ok)return;var d=b.x*f.a-b.y*f.b+f.tx,b=b.x*f.c-b.y*f.d-f.ty;0===a?C.moveTo(d,b):C.lineTo(d,b)}c&&C.closePath()}y.handleModifs(b,
y.conicModifs);y.preDrawCurve();C.mozFillRule="evenodd";var f=v.drawingstate.matrix,h=A(a[0]);C.beginPath();"list"===h.ctype&&g();"shape"===h.ctype&&e();"D"===d&&C.stroke();"F"===d&&(C.fillStyle=y.lineColor,C.fill());"C"===d&&C.clip();return t};var yc=function(a,b,d,c,e){var g=a.measureText(b).width;a.fillText(b,d-g*e,c)};u.drawtext$2=function(a,b){var d=B(a[0]),c=A(a[1]),e=D.extractPoint(d);if(!e.ok)return t;var g=v.drawingstate.matrix,d=e.x*g.a-e.y*g.b+g.tx,e=e.x*g.c-e.y*g.d-g.ty;y.handleModifs(b,
y.textModifs);g=v.drawingstate.textsize;null!==y.size&&(g=y.size);C.fillStyle=y.textColor;C.font=y.bold+y.italics+Math.round(10*g)/10+"px "+y.family;c=I(c);yc(C,c,d+y.xOffset,e-y.yOffset,y.align);return t};D.drawshape=function(a,b){return"polygon"===a.type?D.drawpolygon([a],b,"D",1):"circle"===a.type?D.drawcircle([a.value.value[0],a.value.value[1]],b,"D"):t};D.fillshape=function(a,b){return"polygon"===a.type?D.drawpolygon([a],b,"F",1):"circle"===a.type?D.drawcircle([a.value.value[0],a.value.value[1]],
b,"F"):t};D.clipshape=function(a,b){return"polygon"===a.type?D.drawpolygon([a],b,"C",1):"circle"===a.type?D.drawcircle([a.value.value[0],a.value.value[1]],b,"C"):t};u.fill$1=function(a,b){var d=A(a[0]);return"shape"===d.ctype?D.fillshape(d,b):t};u.clip$1=function(a,b){var d=A(a[0]);return"shape"===d.ctype?D.clipshape(d,b):"list"===d.ctype?(d=u.polygon$1(a,[]),u.clip$1([d],[])):t};u.plot$1=function(a,b){return u.plot$2([a[0],null],b)};u.plot$2=function(a,b){function d(a){return"number"===a.ctype&&
k._helper.isAlmostReal(a)}function c(a,b,d,e,m){l++;b=+b.value.real;m=+e.value.real;e=b*E.a-m*E.b+E.tx;b=b*E.c-m*E.d-E.ty;a=+a.value.real;m=+d.value.real;d=a*E.a-m*E.b+E.tx;a=a*E.c-m*E.d-E.ty;n?(C.lineTo(d,a),C.lineTo(e,b)):(C.beginPath(),C.moveTo(d,a),C.lineTo(e,b),n=!0)}function e(a,b,m,g,l){var p=d(m),q=d(g);if(.001>l)!f&&n&&(C.stroke(),n=!1);else if(p||q){var r=k.real((a.value.real+b.value.real)/2);L.setvar(x,r);var t=A(w),u=d(t);if(p&&q&&u){var v=m.value.real,q=t.value.real,u=g.value.real;if(p=
1>Math.abs(v+u-2*q)/h){var wb=k.real((a.value.real+r.value.real)/2);L.setvar(x,wb);var wb=A(w),y=k.real((r.value.real+b.value.real)/2);L.setvar(x,y);y=A(w);v=Math.abs(v+q-2*wb.value.real)/h;q=Math.abs(q+u-2*y.value.real)/h;p=p&&1>v&&1>q}p?(c(a,r,m,t,l/2),c(r,b,t,g,l/2)):(e(a,r,m,t,l/2),e(r,b,t,g,l/2))}else e(a,r,m,t,l/2),e(r,b,t,g,l/2)}}var f=!1,h=.2/hb,l=0,n=!1,p=-10,q=10,r=1,u=1E3,w=a[0],x;if(null!==a[1]&&"variable"===a[1].ctype)x=a[1].name;else{var B=D.plotvars(w);x="#";-1!==B.indexOf("t")&&(x=
"t");-1!==B.indexOf("z")&&(x="z");-1!==B.indexOf("y")&&(x="y");-1!==B.indexOf("x")&&(x="x")}L.newvar(x);var E=v.drawingstate.matrix;y.handleModifs(b,{color:!0,alpha:!0,size:!0,dashpattern:!0,dashtype:!0,dashing:!0,lineCap:!0,lineJoin:!0,miterLimit:!0,connect:function(a){"boolean"===a.ctype&&(f=a.value)},start:function(a){"number"===a.ctype&&(p=a.value.real)},stop:function(a){"number"===a.ctype&&(q=a.value.real)},steps:function(a){"number"===a.ctype&&(u=a.value.real)}});C.strokeStyle=y.lineColor;C.lineWidth=
y.lsize;var F,G,I,H,n=!1,B=k.real(14.32);L.setvar(x,B);I=A(w);if("number"!==I.ctype){if(g.isNumberVector(I).value&&2===I.value.length){n=!1;r=(q-p)/u;for(B=p;B<q;B+=r)L.setvar(x,k.real(B)),H=A(w),g.isNumberVector(H).value&&2===H.value.length&&(F=+H.value[0].value.real,G=+H.value[1].value.real,H=F*E.a-G*E.b+E.tx,F=F*E.c-G*E.d-E.ty,n?C.lineTo(H,F):(C.beginPath(),C.moveTo(H,F),n=!0));C.stroke();L.removevar(x)}return t}for(H=p;H<q+r;H+=r)B=k.real(H),L.setvar(x,B),I=A(w),B.value.real>p&&e(F,B,G,I,r),F=
B,G=I;L.removevar(x);n&&C.stroke();return t};u.plotX$1=function(a,b){var d=a[0],c=D.plotvars(d),e="#";-1!==c.indexOf("t")&&(e="t");-1!==c.indexOf("z")&&(e="z");-1!==c.indexOf("y")&&(e="y");-1!==c.indexOf("x")&&(e="x");L.newvar(e);c=v.drawingstate.matrix;C.fillStyle=v.drawingstate.linecolor;C.lineWidth=1;C.lineCap=y.lineCap;C.lineJoin=y.lineJoin;C.miterLimit=y.miterLimit;for(var g=!1,f=-10;10>f;f+=.01){L.setvar(e,k.real(f));var h=A(d);if("number"===h.ctype){var l=+h.value.real,h=f*c.a-l*c.b+c.tx,l=
f*c.c-l*c.d-c.ty;g?C.lineTo(h,l):(C.beginPath(),C.moveTo(h,l),g=!0)}}C.stroke();L.removevar(e);return t};D.plotvars=function(a){function b(a,d){var c={},e;for(e=a.length-1;0<=e;--e)c[a[e]]=a[e];for(e=d.length-1;0<=e;--e)c[d[e]]=d[e];e=[];for(var m in c)c.hasOwnProperty(m)&&e.push(c[m]);return e}function d(a,b){for(var d=0;d<a.length;d++)a[d]===b&&(a.splice(d,1),d--);return a}var c,e,g,f;if("variable"===a.ctype)return[a.name];if("infix"===a.ctype)return c=D.plotvars(a.args[0]),a=D.plotvars(a.args[1]),
b(c,a);if("list"===a.ctype){g=a.value;e=[];for(f=0;f<g.length;f++)c=D.plotvars(g[f]),e=b(e,c);return e}if("function"===a.ctype){g=a.args;e=[];for(f=0;f<g.length;f++)c=D.plotvars(g[f]),e=b(e,c);"apply"!==a.oper&&"select"!==a.oper&&"forall"!==a.oper&&"sum"!==a.oper&&"product"!==a.oper&&"repeat"!==a.oper&&"min"!==a.oper&&"max"!==a.oper&&"sort"!==a.oper||"variable"!==a.args[1].ctype||(e=d(e,a.args[1].name));return e}return[]};u.clrscr$0=function(a,b){"undefined"!==typeof fa&&"undefined"!==typeof Z&&C.clearRect(0,
0,fa,Z);return t};u.repaint$0=function(a,c){b();return t};u.screenbounds$0=function(a,b){var d=w.withUsage(g.realVector(v.to(0,0)),"Point"),c=w.withUsage(g.realVector(v.to(fa,0)),"Point"),e=w.withUsage(g.realVector(v.to(fa,Z)),"Point"),f=w.withUsage(g.realVector(v.to(0,Z)),"Point");return g.turnIntoCSList([d,c,e,f])};u.createimage$3=function(a,b){var d=A(a[0]),c=B(a[1]),e=B(a[2]);if("number"!==c.ctype||"number"!==e.ctype||"string"!==d.ctype)return t;var g=document.createElement("canvas");g.id=d.value;
g.width=c.value.real;g.height=e.value.real;g.style.display="none";document.body.appendChild(g);oa[d.value]=g;return t};u.clearimage$1=function(a,b){var d=A(a[0]);if("string"!==d.ctype)return t;d=document.getElementById(d.value);if("undefined"===typeof d||null===d)return t;var c=d.width,e=d.height;d.getContext("2d").clearRect(0,0,c,e);return t};u.canvas$4=function(a,b){var d=B(a[0]),c=B(a[1]),e=A(a[2]),g=a[3],f=D.extractPoint(d),h=D.extractPoint(c);if(!f.ok||!h.ok||"string"!==e.ctype)return t;e=document.getElementById(e.value);
if("undefined"===typeof e||null===e)return t;var d=e.width,c=e.height,k=h.x-f.x,l=h.y-f.y,n=f.x-l*c/d,p=f.y+k*c/d,l=h.x-l*c/d,k=h.y+k*c/d,h=v.from(f.x,f.y,1),n=v.from(n,p,1),l=v.from(l,k,1),f=h[0],p=h[1],k=n[0],q=n[1],r=l[0],u=l[1],n=d*(p-q)/((f-k)*(p-u)-(f-r)*(p-q)),d=d*(f-k)/((p-q)*(f-r)-(p-u)*(f-k)),l=-n*f-d*p,h=(c*(p-u)-c*(p-q))/((f-k)*(p-u)-(f-r)*(p-q)),k=(c*(f-r)-c*(f-k))/((p-q)*(f-r)-(p-u)*(f-k)),c=c-h*f-k*p,e=e.getContext("2d"),f=C;C=e;C.save();C.transform(n,h,d,k,l,c);A(g);C.restore();C=
f};u.canvas$5=function(a,b){var d=B(a[0]),c=B(a[1]),e=B(a[2]),g=A(a[3]),f=a[4],d=D.extractPoint(d),c=D.extractPoint(c),h=D.extractPoint(e);if(!d.ok||!c.ok||!h.ok||"string"!==g.ctype)return t;g=document.getElementById(g.value);if("undefined"===typeof g||null===g)return t;var k=g.width,e=g.height,l=v.from(d.x,d.y,1),n=v.from(c.x,c.y,1),c=v.from(h.x,h.y,1),d=l[0],h=l[1],p=n[0],q=n[1],r=c[0],u=c[1],c=((0-k)*(h-u)-0*(h-q))/((d-p)*(h-u)-(d-r)*(h-q)),k=((0-k)*(d-r)-0*(d-p))/((h-q)*(d-r)-(h-u)*(d-p)),n=0-
c*d-k*h,l=((e-e)*(h-u)-(e-0)*(h-q))/((d-p)*(h-u)-(d-r)*(h-q)),p=((e-e)*(d-r)-(e-0)*(d-p))/((h-q)*(d-r)-(h-u)*(d-p)),e=e-l*d-p*h,g=g.getContext("2d"),d=C;C=g;C.save();C.transform(c,l,k,p,n,e);A(f);C.restore();C=d};u.screenresolution$0=function(a,b){return k.real(v.drawingstate.matrix.a)};u.layer$1=function(a,b){};D.extractReferenceX=function(a,b){};u.imagesize$1=function(a,b){var d=B(a[0]);return"string"===d.ctype&&oa[d.value]?g.realVector([oa[d.value].width,oa[d.value].height]):t};u.drawimage$2=function(a,
b){function d(){var a=1,d=1,c=1,f=1,h=0,l=1,z=D.extractPoint(e);if(!z.ok||"string"!==k.ctype)return t;k=oa[k.value];if(!k)return t;C.save();var n;void 0!==b.angle&&(n=A(b.angle),"number"===n.ctype&&(h=n.value.real));void 0!==b.rotation&&(n=A(b.rotation),"number"===n.ctype&&(h=n.value.real));void 0!==b.scale&&(n=B(b.scale),"number"===n.ctype&&(d=a=n.value.real),g.isNumberVector(n).value&&2===n.value.length&&(a=n.value[0].value.real,d=n.value[1].value.real));void 0!==b.scalex&&(n=A(b.scalex),"number"===
n.ctype&&(a=n.value.real));void 0!==b.scaley&&(n=A(b.scaley),"number"===n.ctype&&(d=n.value.real));void 0!==b.flipx&&(n=A(b.flipx),"boolean"===n.ctype&&n.value&&(c=-1));void 0!==b.flipy&&(n=A(b.flipy),"boolean"===n.ctype&&n.value&&(f=-1));void 0!==b.alpha&&(n=A(b.alpha),"number"===n.ctype&&(l=n.value.real));var p=v.drawingstate.matrix,q=v.drawingstate.initialmatrix,r=k.width,u=k.height;n=z.x*p.a-z.y*p.b+p.tx;var cb=z.x*p.c-z.y*p.d-p.ty,w=(z.x+1)*p.a-z.y*p.b+p.tx-n,p=(z.x+1)*p.c-z.y*p.d-p.ty-cb,vb=
(z.x+1)*q.a-z.y*q.b+q.tx-(z.x*q.a-z.y*q.b+q.tx),q=(z.x+1)*q.c-z.y*q.d-q.ty-(z.x*q.c-z.y*q.d-q.ty),z=Math.sqrt(w*w+p*p)/Math.sqrt(vb*vb+q*q),w=-Math.atan2(w,p)+Math.atan2(vb,q);1!==l&&(C.globalAlpha=l);C.translate(n,cb);C.scale(a*c*z,d*f*z);C.rotate(h+w);C.translate(-n,-cb);C.translate(-r/2,-u/2);a=k;a.drawTo?a.drawTo(C,n,cb):C.drawImage(a,n,cb);C.globalAlpha=1;C.restore()}function c(){var a=1,d=1,g=1,l=1,z=D.extractPoint(e),n=D.extractPoint(f),p;if(!z.ok||!n.ok||"string"!==k.ctype)return t;k=oa[k.value];
if(!k)return t;var q=k.width,r=k.height;if(0===h)p={},p.x=z.x-(n.y-z.y),p.y=z.y+(n.x-z.x),l=r/q;else if(p=D.extractPoint(h),!z.ok)return t;C.save();var u;void 0!==b.alpha&&(u=A(b.alpha),"number"===u.ctype&&(a=u.value.real));void 0!==b.aspect&&(u=A(b.aspect),"number"===u.ctype&&(l=u.value.real));void 0!==b.flipx&&(u=A(b.flipx),"boolean"===u.ctype&&u.value&&(d=-1));void 0!==b.flipy&&(u=A(b.flipy),"boolean"===u.ctype&&u.value&&(g=-1));u=v.drawingstate.matrix;1!==a&&(C.globalAlpha=a);a=z.x*u.a-z.y*u.b+
u.tx;z=z.x*u.c-z.y*u.d-u.ty;C.transform(n.x*u.a-n.y*u.b+u.tx-a,n.x*u.c-n.y*u.d-u.ty-z,p.x*u.a-p.y*u.b+u.tx-a,p.x*u.c-p.y*u.d-u.ty-z,a,z);C.scale(1/q,-1/r*l);C.translate(q/2,-r/2);C.scale(d,g);C.translate(-q/2,r/2);C.translate(0,-r);d=k;d.drawTo?d.drawTo(C,0,0):C.drawImage(d,0,0);C.globalAlpha=1;C.restore()}var e,f,h,k;return 2===a.length?(e=B(a[0]),k=B(a[1]),d()):3===a.length?(e=B(a[0]),f=B(a[1]),h=0,k=B(a[2]),c()):4===a.length?(e=B(a[0]),f=B(a[1]),h=B(a[2]),k=B(a[3]),c()):t};u.drawimage$3=u.drawimage$2;
u.drawimage$4=u.drawimage$2;var cc={},Sb;Sb=[0,0,0,0,0,0,0,0,0,0,0,0];u.playsin$1=function(a,b){var d=B(a[0]),c=0;if("number"===d.ctype){var e;void 0!==b.line&&(e=A(b.line),"number"===e.ctype&&(c=Math.floor(e.value.real),0>c&&(c=0),10<c&&(c=10)));d=d.value.real;0!==Sb[c]&&Sb[c].set({freq:d})}return t};var O={printArr:function(a){for(var b=a.value.length,d=[],c=[],e=!1,g=0;g<b;g++)d[g]=a.value[g].value.real,c[g]=a.value[g].value.imag,0!==c[g]&&(e=!0);console.log(d);e&&console.log(c)},zero:function(a){for(var b=
[],d=k.real(0),c=0;c<a.value.real;c++)b[c]=d;return g.turnIntoCSList(b)},number:function(a,b){var d=O.zero(b);d.value[0]=a;return d},variable:function(a,b){var d=O.zero(b);d.value[0]=a;d.value[1]=k.real(1);return d},add:function(a,b){return g.add(a,b)},sub:function(a,b){return g.sub(a,b)},mult:function(a,b){if(a.value.length!==b.value.length)return console.error("dims don't fit return nada"),t;for(var d=a.value.length,c=O.zero(k.real(d)),e=k.real(0),g=0;g<d;g++){for(var f=0;f<=g;f++)e=k.add(e,k.mult(a.value[f],
b.value[g-f]));c.value[g]=e;e=k.real(0)}return c},pow:function(a,b){if(0>b.value.real||b.value.real!==Math.floor(b.value.real))return O.root(a,b);for(var d=a,c=1;c<b.value.real;c++)d=O.mult(d,a);return d},root:function(a,b){var d=k.real(0),c=k.real(1),e=k.add(c,b),g=a.value.length,f=O.zero(k.real(g));f.value[0]=k.pow(a.value[0],b);for(var h=d,l,n,p=1;p<g;p++){n=k.real(p);for(var q=1;q<=p;q++)l=k.mult(e,k.real(q)),l=k.div(l,n),l=k.sub(l,c),l=k.mult(l,a.value[q]),l=k.mult(l,f.value[p-q]),h=k.add(h,
l);h=k.div(h,a.value[0]);f.value[p]=h;h=d}return f},findFirstNoneZero:function(a,b,d){for(var c=Infinity,e=Infinity,g=d;g<a.value.length;g++)if(1E-12<k.abs2(a.value[g]).value.real){c=g;break}for(a=d;a<b.value.length;a++)if(1E-12<k.abs2(b.value[a]).value.real){e=a;break}return[c,e]},div:function(a,b){if(a.value.length!==b.value.length)return console.log("dims don't fit - return nada"),t;for(var d=a.value.length,c=k.real(0),e=O.zero(k.real(d)),g=c,f=c,h=0;h<d;h++){f=O.findFirstNoneZero(a,b,h);h<f[0]&&
f[0]===f[1]&&Infinity!==f[0]&&(a.value.splice(h,f[0]),b.value.splice(h,f[0]),e.value.splice(h,f[0]),d-=f[0]);for(var f=a.value[h],l=0;l<h;l++)g=k.add(g,k.mult(e.value[l],b.value[h-l]));f=k.sub(f,g);f=k.div(f,b.value[0]);e.value[h]=f;g=c}return e},exp:function(a){var b=k.real(0),d=a.value.length,c=O.zero(k.real(d)),e=b,g;c.value[0]=k.exp(a.value[0]);for(var f=1;f<d;f++){for(var h=1;h<=f;h++)g=k.mult(k.real(h),a.value[h]),g=k.mult(g,c.value[f-h]),e=k.add(e,g);c.value[f]=k.div(e,k.real(f));e=b}return c},
log:function(a){var b=k.real(0),d=a.value.length,c=O.zero(k.real(d));c.value[0]=k.log(a.value[0]);for(var e=b,g,f,h=1;h<d;h++){g=a.value[h];for(var l=1;l<h;l++)f=k.mult(k.real(l),c.value[l]),f=k.mult(f,a.value[h-l]),e=k.add(e,f);e=k.div(e,k.real(h));g=k.sub(g,e);g=k.div(g,a.value[0]);c.value[h]=g;e=b}return c},sincos:function(a){var b=k.real(0),d=a.value.length,c=O.zero(k.real(d)),e=O.zero(k.real(d));c.value[0]=k.sin(a.value[0]);e.value[0]=k.cos(a.value[0]);for(var g=b,f=b,h,l,n,p=1;p<d;p++){n=k.real(p);
for(var q=1;q<=p;q++)l=k.mult(k.real(q),a.value[q]),h=k.mult(l,e.value[p-q]),l=k.mult(l,c.value[p-q]),f=k.add(f,h),g=k.add(g,l);f=k.div(f,n);g=k.div(g,k.neg(n));c.value[p]=f;e.value[p]=g;g=f=b}O.sinsave=c;O.cossave=e;return[c,e]},sin:function(a){return O.sincos(a)[0]},cos:function(a){return O.sincos(a)[1]},faculty:function(a){var b=[];b[0]=k.real(1);for(var d=1,c=1;c<=a.value.real;c++)d*=c,b[c]=k.real(d);return b=g.turnIntoCSList(b)},diff:function(a,b,d,c){var e;if("variable"===a.ctype)e=a.name!==
b?O.number(A(a),c):O.variable(d,c);else if("number"===a.ctype)e=O.number(a,c);else{if("infix"===a.ctype){if("*"===a.oper)return O.mult(O.diff(a.args[0],b,d,c),O.diff(a.args[1],b,d,c));if("^"===a.oper)return O.pow(O.diff(a.args[0],b,d,c),O.diff(a.args[1],b,d,c).value[0]);if("/"===a.oper)return O.div(O.diff(a.args[0],b,d,c),O.diff(a.args[1],b,d,c));if("+"===a.oper)return O.add(O.diff(a.args[0],b,d,c),O.diff(a.args[1],b,d,c));if("-"===a.oper)return O.sub(O.diff(a.args[0],b,d,c),O.diff(a.args[1],b,d,
c));console.log("infix not found",a.oper);return t}if("function"===a.ctype){if("exp$1"===a.oper)return O.exp(O.diff(a.args[0],b,d,c));if("log$1"===a.oper)return O.log(O.diff(a.args[0],b,d,c));if("sin$1"===a.oper)return O.sin(O.diff(a.args[0],b,d,c));if("cos$1"===a.oper)return O.cos(O.diff(a.args[0],b,d,c))}else return console.log("ctype not found",a.ctype),t}return e},adevaluate:function(a,b,d,c){a=O.diff(a,b,d,c);c=O.faculty(c);for(b=2;b<a.value.length;b++)a.value[b]=k.mult(a.value[b],c.value[b]);
return a},autodiff:function(a,b,d,c){for(var e=[],f=d.value.length,h,k=0;k<f;k++)h=O.adevaluate(a,b,d.value[k],c),e[k]=h;return e=g.turnIntoCSList(e)}},y={handleModifs:function(a,b){y.dashing&&y.unSetDash();y.colorraw=null;y.size=null;0>=y.psize&&(y.psize=0);0>=y.lsize&&(y.lsize=0);y.overhang=1;y.dashing=!1;y.isArrow=!1;y.arrowSides="==>";y.arrowposition=1;y.headlen=10;y.arrowShape="default";y.alpha=v.drawingstate.alpha;y.bold="";y.italics="";y.family="sans-serif";y.align=0;y.xOffset=0;y.yOffset=
0;y.lineCap="round";y.lineJoin="round";y.miterLimit=10;var d,c;for(d in a){var e=a[d];e&&((c=b[d])?(!0===c&&(c=y.modifHandlers[d]),c(A(e))):console.log("Modifier not supported: "+d))}null!==y.size?y.psize=y.lsize=y.size:(y.psize=v.drawingstate.pointsize,y.lsize=v.drawingstate.linesize);y.dashing&&y.dashing(y.lsize);null!==y.colorraw?y.pointColor=y.lineColor=y.textColor=y.makeColor(y.colorraw):1===y.alpha?(y.pointColor=v.drawingstate.pointcolor,y.lineColor=v.drawingstate.linecolor,y.textColor=v.drawingstate.textcolor):
(y.pointColor=y.makeColor(v.drawingstate.pointcolorraw),y.lineColor=y.makeColor(v.drawingstate.linecolorraw),y.textColor=y.makeColor(v.drawingstate.textcolorraw));y.black=1===y.alpha?"rgb(0,0,0)":"rgba(0,0,0,"+y.alpha+")"},sin30deg:.5};y.cos30deg=Math.sqrt(.75);y.modifHandlers={size:function(a){"number"===a.ctype&&(y.size=a.value.real,0>y.size&&(y.size=0),1E3<y.size&&(y.size=1E3))},color:function(a){g.isNumberVector(a).value&&3===a.value.length&&(y.colorraw=[a.value[0].value.real,a.value[1].value.real,
a.value[2].value.real])},alpha:function(a){"number"===a.ctype&&(y.alpha=a.value.real)},dashpattern:function(a){if("list"===a.ctype){for(var b=[],d=0,c=0;d<a.value.length;d++)"number"===a.value[d].ctype&&(b[c++]=a.value[d].value.real);y.dashing=y.setDash.bind(null,b)}},dashtype:function(a){if("number"===a.ctype)a=Math.floor(a.value.real);else if("string"===a.ctype)a=a.value;else return;if(a=y.dashTypes[a])y.dashing=y.setDash.bind(null,a)},dashing:function(a){"number"===a.ctype&&(a=Math.floor(a.value.real),
y.dashing=y.setDash.bind(null,[2*a,a]))},overhang:function(a){"number"===a.ctype&&(y.overhang=y.overhang*a.value.real+(1-y.overhang)*(1-a.value.real))},arrow:function(a){"boolean"===a.ctype?y.isArrow=a.value:console.error("arrow needs to be of type boolean")},arrowshape:function(a){"string"===a.ctype?(y.arrowShape=a.value,y.isArrow=!0):console.error("arrowshape needs to be of type string")},arrowsides:function(a){"string"!==a.ctype?console.error("arrowsides is not of type string"):"==>"!==a.value&&
"<==>"!==a.value&&"<=="!==a.value?console.error("arrowsides is unknows"):(y.arrowSides=a.value,y.isArrow=!0)},arrowposition:function(a){"number"!==a.ctype?console.error("arrowposition is not of type number"):0>a.value.real?console.error("arrowposition has to be positive"):1<a.value.real?y.overhang=y.overhang*a.value.real+(1-y.overhang)*(1-a.value.real):(y.arrowposition=a.value.real,y.isArrow=!0)},arrowsize:function(a){"number"!==a.ctype?console.error("arrowsize is not of type number"):0>a.value.real?
console.error("arrowsize has to be positive"):y.headlen*=a.value.real},bold:function(a){"boolean"===a.ctype&&a.value&&(y.bold="bold ")},italics:function(a){"boolean"===a.ctype&&a.value&&(y.italics="italic ")},family:function(a){"string"===a.ctype&&(y.family=a.value)},align:function(a){"string"===a.ctype&&(a=a.value,"left"===a&&(y.align=0),"right"===a&&(y.align=1),"mid"===a&&(y.align=.5))},x_offset:function(a){"number"===a.ctype&&(y.xOffset=a.value.real)},y_offset:function(a){"number"===a.ctype&&(y.yOffset=
a.value.real)},offset:function(a){"list"===a.ctype&&2===a.value.length&&"number"===a.value[0].ctype&&"number"===a.value[1].ctype&&(y.xOffset=a.value[0].value.real,y.yOffset=a.value[1].value.real)},lineCap:function(a){"string"!==a.ctype||"round"!==a.value&&"square"!==a.value&&"butt"!==a.value||(y.lineCap=a.value)},lineJoin:function(a){"string"!==a.ctype||"round"!==a.value&&"bevel"!==a.value&&"miter"!==a.value||(y.lineJoin=a.value)},miterLimit:function(a){"number"===a.ctype&&0<a.value.real&&(y.miterLimit=
Math.round(a.value.real))}};y.lineModifs={size:!0,color:!0,alpha:!0,dashpattern:!0,dashtype:!0,dashing:!0,overhang:!0,arrow:!0,arrowshape:!0,arrowsides:!0,arrowposition:!0,arrowsize:!0,lineCap:!0};y.pointModifs={size:!0,color:!0,alpha:!0};y.pointAndLineModifs=y.lineModifs;y.conicModifs={size:!0,color:!0,alpha:!0,lineCap:!0,lineJoin:!0,miterLimit:!0};y.textModifs={size:!0,color:!0,alpha:!0,bold:!0,italics:!0,family:!0,align:!0,x_offset:!0,y_offset:!0,offset:!0};y.makeColor=function(a){return"rgba("+
Math.floor(255*a[0])+","+Math.floor(255*a[1])+","+Math.floor(255*a[2])+","+y.alpha+")"};y.preDrawCurve=function(){C.lineWidth=y.lsize;C.lineCap=y.lineCap;C.lineJoin=y.lineJoin;C.miterLimit=y.miterLimit;C.strokeStyle=y.lineColor};y.drawsegcore=function(a,b){function d(a,b,d){var c=a-d*w,e=b-d*A;C.beginPath();"full"===y.arrowShape&&(C.lineWidth=y.lsize/2);var m=a-d*x;d=b-d*B;C.moveTo(c,e);C.lineTo(a,b);C.lineTo(m,d);"full"===y.arrowShape?(C.fillStyle=y.lineColor,C.closePath(),C.fill()):"default"!==
y.arrowShape&&console.error("arrowshape is unknown");C.stroke()}var c=v.drawingstate.matrix,e=a.x*c.a-a.y*c.b+c.tx,g=a.x*c.c-a.y*c.d-c.ty,f=b.x*c.a-b.y*c.b+c.tx,h=b.x*c.c-b.y*c.d-c.ty,k=y.overhang,l=1-k,c=k*e+l*f,n=k*g+l*h,p=k*f+l*e,k=k*h+l*g;C.lineWidth=y.lsize;C.lineCap=y.lineCap;C.lineJoin=y.lineJoin;C.miterLimit=y.miterLimit;C.strokeStyle=y.lineColor;if(!y.isArrow||e===g&&f===h).01>y.lsize||(C.beginPath(),C.moveTo(c,n),C.lineTo(p,k),C.stroke());else{var e=f-e,g=h-g,f=Math.sqrt(e*e+g*g),l=e/f,
q=g/f,h=y.arrowposition,r=1-h,g=h*c+r*p,e=h*n+r*k,f=h*p+r*c,h=h*k+r*n,r=y.headlen,u=y.sin30deg,t=y.cos30deg,w=r*(l*t+q*u),x=r*(l*t-q*u),A=r*(q*t-l*u),B=r*(q*t+l*u),l=y.arrowSides;C.beginPath();"full"===y.arrowShape?("<==>"===l||"<=="===l?(q=g+w,r=e+A,u=g+x,t=e+B,1>y.arrowposition&&(C.moveTo(c,n),C.lineTo(g,e)),C.moveTo((q+u)/2,(r+t)/2)):C.moveTo(c,n),"==>"===l||"<==>"===l?(C.lineTo((f-w+(f-x))/2,(h-A+(h-B))/2),1>y.arrowposition&&(C.moveTo(f,h),C.lineTo(p,k))):C.lineTo(p,k)):(C.moveTo(c,n),C.lineTo(p,
k));C.stroke();"==>"!==l&&"<==>"!==l||d(f,h,1);"<=="!==l&&"<==>"!==l||d(g,e,-1)}};y.drawpoint=function(a){var b=v.drawingstate.matrix,d=a.x*b.a-a.y*b.b+b.tx;a=a.x*b.c-a.y*b.d-b.ty;C.lineWidth=.3*y.psize;C.beginPath();C.arc(d,a,y.psize,0,2*Math.PI);C.fillStyle=y.pointColor;C.fill();C.beginPath();C.arc(d,a,1.15*y.psize,0,2*Math.PI);C.fillStyle=y.black;C.strokeStyle=y.black;C.stroke()};y.drawline=function(a){var b=k.abs(a.value[0]).value.real,d=k.abs(a.value[1]).value.real,c=k.abs(a.value[2]).value.real,
e;b>=d&&b>=c&&(e=a.value[0]);d>=b&&d>=c&&(e=a.value[1]);c>=d&&c>=b&&(e=a.value[2]);b=k.div(a.value[0],e);d=k.div(a.value[1],e);a=k.div(a.value[2],e);a=[b.value.real,d.value.real,a.value.real];Math.abs(a[0])<Math.abs(a[1])?(b=[1,0,30],e=[-1,0,30]):(b=[0,1,30],e=[0,-1,30]);b=[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]];a=[a[1]*e[2]-a[2]*e[1],a[2]*e[0]-a[0]*e[2],a[0]*e[1]-a[1]*e[0]];y.drawsegcore({x:b[0]/b[2],y:b[1]/b[2]},{x:a[0]/a[2],y:a[1]/a[2]})};y.dashTypes={solid:[],dashed:[10,
10],tightdash:[10,4],dotted:[1,3],dashdot:[10,5,1,5],"dashvalue.solid":[],"dashvalue.dashed":[10,10],"dashvalue.tightdash":[10,4],"dashvalue.dotted":[1,3],"dashvalue.dashdot":[10,5,1,5],0:[],1:[10,10],2:[10,4],3:[1,3],4:[10,5,1,5]};y.setDash=function(a,b){var d=Math.sqrt(b);a=a.slice();for(var c=0;c<a.length;c++)a[c]*=d;C.webkitLineDash=a;C.setLineDash(a);C.mozDash=a};y.unSetDash=function(){C.webkitLineDash=[];C.setLineDash([]);C.mozDash=[]};var Ba={},v={drawingstate:{}};v.drawingstate.linecolor=
"rgb(0,0,255)";v.drawingstate.linecolorraw=[0,0,1];v.drawingstate.pointcolor="rgb(255,200,0)";v.drawingstate.pointcolorraw=[1,.78,0];v.drawingstate.textcolor="rgb(0,0,0)";v.drawingstate.textcolorraw=[0,0,0];v.drawingstate.alpha=1;v.drawingstate.pointsize=4;v.drawingstate.linesize=1;v.drawingstate.textsize=20;v.drawingstate.matrix={};v.drawingstate.matrix.a=25;v.drawingstate.matrix.b=0;v.drawingstate.matrix.c=0;v.drawingstate.matrix.d=25;v.drawingstate.matrix.tx=250.5;v.drawingstate.matrix.ty=250.5;
v.drawingstate.matrix.det=v.drawingstate.matrix.a*v.drawingstate.matrix.d-v.drawingstate.matrix.b*v.drawingstate.matrix.c;v.drawingstate.matrix.sdet=Math.sqrt(v.drawingstate.matrix.det);v.drawingstate.initialmatrix={};v.drawingstate.initialmatrix.a=v.drawingstate.matrix.a;v.drawingstate.initialmatrix.b=v.drawingstate.matrix.b;v.drawingstate.initialmatrix.c=v.drawingstate.matrix.c;v.drawingstate.initialmatrix.d=v.drawingstate.matrix.d;v.drawingstate.initialmatrix.tx=v.drawingstate.matrix.tx;v.drawingstate.initialmatrix.ty=
v.drawingstate.matrix.ty;v.drawingstate.initialmatrix.det=v.drawingstate.matrix.det;v.drawingstate.initialmatrix.sdet=v.drawingstate.matrix.sdet;v.clone=function(a){if(null===a||"object"!==typeof a)return a;var b=a.constructor(),d;for(d in a)b[d]=v.clone(a[d]);return b};Ba.backup=v.clone(v.drawingstate);Ba.stack=[];v.clone(v.drawingstate);v.reset=function(){v.drawingstate.matrix.a=v.drawingstate.initialmatrix.a;v.drawingstate.matrix.b=v.drawingstate.initialmatrix.b;v.drawingstate.matrix.c=v.drawingstate.initialmatrix.c;
v.drawingstate.matrix.d=v.drawingstate.initialmatrix.d;v.drawingstate.matrix.tx=v.drawingstate.initialmatrix.tx;v.drawingstate.matrix.ty=v.drawingstate.initialmatrix.ty;v.drawingstate.matrix.det=v.drawingstate.initialmatrix.det;v.drawingstate.matrix.sdet=v.drawingstate.initialmatrix.sdet};v.from=function(a,b,d){a/=d;b/=d;d=v.drawingstate.matrix;return[a*d.a-b*d.b+d.tx,a*d.c-b*d.d-d.ty]};v.to=function(a,b){var d=v.drawingstate.matrix,c=a-d.tx,e=b+d.ty;return[(c*d.d-e*d.b)/d.det,-(-c*d.c+e*d.a)/d.det,
1]};v.dumpTrafo=function(){function a(a){return Math.round(1E3*a)/1E3}var b=v.drawingstate.matrix;console.log("a:"+a(b.a)+" b:"+a(b.b)+" c:"+a(b.c)+" d:"+a(b.d)+" tx:"+a(b.ty)+" ty:"+a(b.tx))};v.setMat=function(a,b,d,c,e,g){var f=v.drawingstate.matrix;f.a=a;f.b=b;f.c=d;f.d=c;f.tx=e;f.ty=g;f.det=a*c-b*d;f.sdet=Math.sqrt(f.det)};v.scaleAndOrigin=function(a,b,d){v.setMat(a,0,0,a,b,d)};v.visibleRect=function(a,b,d,c){var e=d-a,g=b-c,e=fa*g<Z*e?fa/e:Z/g;v.setMat(e,0,0,e,(fa-e*(a+d))/2,(Z-e*(b+c))/2)};
v.applyMat=function(a,b,d,c,e,g){var f=v.drawingstate.matrix;v.setMat(f.a*a+f.c*b,f.b*a+f.d*b,f.a*d+f.c*c,f.b*d+f.d*c,f.a*e+f.c*g+f.tx,f.b*e+f.d*g+f.ty);a=v.to(0,-Z);b=v.to(fa,0);console.log("{visibleRect: ["+a[0]+","+a[1]+","+b[0]+","+b[1]+"]}")};v.translate=function(a,b){v.applyMat(1,0,0,1,a,b)};v.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);v.applyMat(b,a,-a,b,0,0)};v.scale=function(a){v.applyMat(a,0,0,a,0,0)};v.gsave=function(){Ba.stack.push(v.clone(v.drawingstate))};v.grestore=function(){0!==
Ba.stack.length&&(v.drawingstate=Ba.stack.pop())};v.greset=function(){v.drawingstate=v.clone(Ba.backup);v.drawingstate.matrix.ty-=Z;v.drawingstate.initialmatrix.ty-=Z;Ba.stack=[]};v.createnewbackup=function(){v.drawingstate.initialmatrix.a=v.drawingstate.matrix.a;v.drawingstate.initialmatrix.b=v.drawingstate.matrix.b;v.drawingstate.initialmatrix.c=v.drawingstate.matrix.c;v.drawingstate.initialmatrix.d=v.drawingstate.matrix.d;v.drawingstate.initialmatrix.tx=v.drawingstate.matrix.tx;v.drawingstate.initialmatrix.ty=
v.drawingstate.matrix.ty;v.drawingstate.initialmatrix.det=v.drawingstate.matrix.det;v.drawingstate.initialmatrix.sdet=v.drawingstate.matrix.sdet;Ba.backup=v.clone(v.drawingstate)};v.makecolor=function(a,b,d){a=Math.floor(255*a);b=Math.floor(255*b);d=Math.floor(255*d);return 1===v.drawingstate.alpha?"rgb("+a+","+b+","+d+")":"rgba("+a+","+b+","+d+","+v.drawingstate.alpha+")"};v.setcolor=function(a){var b=a.value[0].value.real,d=a.value[1].value.real;a=a.value[2].value.real;v.drawingstate.linecolor=
v.drawingstate.pointcolor=v.makecolor(b,d,a);v.drawingstate.linecolorraw=v.drawingstate.pointcolorraw=[b,d,a]};v.setlinecolor=function(a){var b=a.value[0].value.real,d=a.value[1].value.real;a=a.value[2].value.real;v.drawingstate.linecolor=v.makecolor(b,d,a);v.drawingstate.linecolorraw=[b,d,a]};v.settextcolor=function(a){var b=a.value[0].value.real,d=a.value[1].value.real;a=a.value[2].value.real;v.drawingstate.textcolor=v.makecolor(b,d,a);v.drawingstate.textcolorraw=[b,d,a]};v.setpointcolor=function(a){var b=
a.value[0].value.real,d=a.value[1].value.real;a=a.value[2].value.real;v.drawingstate.pointcolor=v.makecolor(b,d,a);v.drawingstate.pointcolorraw=[b,d,a]};v.setalpha=function(a){v.drawingstate.alpha=a.value.real;v.drawingstate.linecolor=v.makecolor(v.drawingstate.linecolorraw[0],v.drawingstate.linecolorraw[1],v.drawingstate.linecolorraw[2]);v.drawingstate.pointcolor=v.makecolor(v.drawingstate.pointcolorraw[0],v.drawingstate.pointcolorraw[1],v.drawingstate.pointcolorraw[2]);v.drawingstate.textcolor=
v.makecolor(v.drawingstate.textcolorraw[0],v.drawingstate.textcolorraw[1],v.drawingstate.textcolorraw[2])};v.setpointsize=function(a){v.drawingstate.pointsize=a.value.real};v.setlinesize=function(a){v.drawingstate.linesize=a.value.real};v.settextsize=function(a){v.drawingstate.textsize=a.value.real};var ra={clip:"none",pointColor:[1,0,0],lineColor:[0,0,1],pointSize:5,lineSize:1,alpha:1,overhangLine:1.1,overhangSeg:1,dimDependent:1,fontFamily:"sans-serif"};r.defaultAppearance&&Rc(r.defaultAppearance);
var Kb={},Ib=["in","out","good","backup"],Ka=new Float64Array(0),Ga={};Ib.forEach(function(a){Ga[a]=Ka});var da=Ka,ta=Ka,pa=Ka,ga,na,Sa,ua,Ya,Mb=!1,rc={toString:function(){return"RefineException"}},J=null;r.enableTraceLog&&(J={logLength:Infinity,fullLog:[],currentMouseAndScripts:null,currentMover:null,currentStep:null,currentElement:null,currentParam:null,labelTracing2:w.wrap("tracing2"),labelTracing4:w.wrap("tracing4"),labelTracingSesq:w.wrap("tracingSesq"),postMouseHooks:[]},"number"===typeof r.enableTraceLog&&
(J.logLength=r.enableTraceLog),qa.getTraceLog=Uc,qa.formatTraceLog=Vc,qa.addTraceHook=J.postMouseHooks.push.bind(J.postMouseHooks));Aa.stateSize=12;Ob.stateSize=24;var n={_helper:{},RandomLine:{}};n.RandomLine.kind="L";n.RandomLine.signature=[];n.RandomLine.updatePosition=function(a){a.homog=g.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};n.FreeLine={};n.FreeLine.kind="L";n.FreeLine.signature=[];n.FreeLine.isMovable=
!0;n.FreeLine.initialize=function(a){a=n._helper.initializePoint(a);Q(a)};n.FreeLine.getParamForInput=function(a,b,d){a=g.cross(b,g.ez);a=g.cross(a,b);return g.normalizeMax(a)};n.FreeLine.getParamFromState=function(a){return W(3)};n.FreeLine.putParamToState=function(a,b){Q(b)};n.FreeLine.updatePosition=function(a){var b=W(3);Q(b);a.homog=w.withUsage(b,"Line")};n.FreeLine.stateSize=6;n.RandomPoint={};n.RandomPoint.kind="P";n.RandomPoint.signature=[];n.RandomPoint.updatePosition=function(a){a.homog=
g.realVector([100*Math.random(),100*Math.random(),100*Math.random()]);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};n.Join={};n.Join.kind="L";n.Join.signature=["P","P"];n.Join.updatePosition=function(a){a.homog=g.cross(l[a.args[0]].homog,l[a.args[1]].homog);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};n.Segment={};n.Segment.kind="S";n.Segment.signature=["P","P"];n.Segment.updatePosition=function(a){var b=l[a.args[0]],d=l[a.args[1]];a.homog=g.cross(b.homog,
d.homog);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line");a.startpos=b.homog;a.endpos=d.homog;a.farpoint=g.cross(a.homog,g.linfty)};n.Meet={};n.Meet.kind="P";n.Meet.signature=["L","L"];n.Meet.updatePosition=function(a){a.homog=g.cross(l[a.args[0]].homog,l[a.args[1]].homog);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};n.Meet.visiblecheck=function(a){var b=!0,d=l[a.args[0]],c=l[a.args[1]];"S"===d.kind&&(b=pc(a,d));b&&"S"===c.kind&&(b=pc(a,c));a.isshowing=
b};n._helper.midpoint=function(a,b){return g.normalizeMax(g.add(g.scalmult(b.value[2],a),g.scalmult(a.value[2],b)))};n.Mid={};n.Mid.kind="P";n.Mid.signature=["P","P"];n.Mid.updatePosition=function(a){var b=n._helper.midpoint(l[a.args[0]].homog,l[a.args[1]].homog);a.homog=w.withUsage(b,"Point")};n.Perp={};n.Perp.kind="L";n.Perp.signature=["L","P"];n.Perp.updatePosition=function(a){var b=l[a.args[0]].homog,d=l[a.args[1]].homog,b=g.turnIntoCSList([b.value[0],b.value[1],k.zero]);a.homog=g.cross(b,d);
a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};n.Para={};n.Para.kind="L";n.Para.signature=["L","P"];n.Para.updatePosition=function(a){var b=l[a.args[1]].homog;a.homog=g.cross(g.cross(g.linfty,l[a.args[0]].homog),b);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};n.Horizontal={};n.Horizontal.kind="L";n.Horizontal.signature=["P"];n.Horizontal.updatePosition=function(a){a.homog=g.cross(g.ex,l[a.args[0]].homog);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,
"Line")};n.HorizontalLine={};n.HorizontalLine.kind="L";n.HorizontalLine.signature=[];n.HorizontalLine.isMovable=!0;n.HorizontalLine.initialize=function(a){a=n._helper.initializePoint(a);a=g.turnIntoCSList([k.zero,a.value[1],a.value[2]]);a=g.normalizeMax(a);Q(a)};n.HorizontalLine.getParamForInput=function(a,b,d){a=g.cross(b,g.ex);return g.normalizeMax(a)};n.HorizontalLine.getParamFromState=function(a){return W(3)};n.HorizontalLine.putParamToState=function(a,b){Q(b)};n.HorizontalLine.updatePosition=
function(a){var b=W(3);Q(b);a.homog=w.withUsage(b,"Line")};n.HorizontalLine.stateSize=6;n.Vertical={};n.Vertical.kind="L";n.Vertical.signature=["P"];n.Vertical.updatePosition=function(a){a.homog=g.cross(g.ey,l[a.args[0]].homog);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};n.VerticalLine={};n.VerticalLine.kind="L";n.VerticalLine.signature=[];n.VerticalLine.isMovable=!0;n.VerticalLine.initialize=function(a){a=n._helper.initializePoint(a);a=g.turnIntoCSList([a.value[0],k.zero,
a.value[2]]);a=g.normalizeMax(a);Q(a)};n.VerticalLine.getParamForInput=function(a,b,d){a=g.cross(b,g.ey);return g.normalizeMax(a)};n.VerticalLine.getParamFromState=function(a){return W(3)};n.VerticalLine.putParamToState=function(a,b){Q(b)};n.VerticalLine.updatePosition=function(a){var b=W(3);Q(b);a.homog=w.withUsage(b,"Line")};n.VerticalLine.stateSize=6;n.LineByFixedAngle={};n.LineByFixedAngle.kind="L";n.LineByFixedAngle.signature=["L","P"];n.LineByFixedAngle.initialize=function(a){var b=k._helper.input(a.angle),
d=k.cos(b),b=k.sin(b);a.rot=g.turnIntoCSList([g.turnIntoCSList([b,d,k.zero]),g.turnIntoCSList([k.neg(d),b,k.zero]),g.turnIntoCSList([k.zero,k.zero,k.zero])])};n.LineByFixedAngle.updatePosition=function(a){var b=l[a.args[1]],d=g.productMV(a.rot,l[a.args[0]].homog);a.homog=g.cross(b.homog,d);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};n.Through={};n.Through.kind="L";n.Through.signature=["P"];n.Through.isMovable=!0;n.Through.initialize=function(a){a=a.dir?w.wrap(a.dir):g.realVector([a.pos[1],
-a.pos[0],0]);Q(a)};n.Through.getParamForInput=function(a,b,d){a="mouse"===d?g.cross(l[a.args[0]].homog,b):"homog"===d?b:g.turnIntoCSList([k.zero,k.zero,k.zero]);a=g.cross(g.linfty,a);return g.normalizeMax(a)};n.Through.getParamFromState=function(a){return W(3)};n.Through.putParamToState=function(a,b){Q(b)};n.Through.updatePosition=function(a){var b=W(3);Q(b);b=g.cross(l[a.args[0]].homog,b);b=g.normalizeMax(b);a.homog=w.withUsage(b,"Line")};n.Through.stateSize=6;n.Free={};n.Free.kind="P";n.Free.signature=
[];n.Free.isMovable=!0;n.Free.initialize=function(a){a=n._helper.initializePoint(a);Q(a)};n.Free.getParamForInput=function(a,b,d){if("mouse"===d&&bc&&0!==Fa){b=g.normalizeZ(b);a=b.value[0].value.real;d=b.value[1].value.real;var c=Math.round(a/Fa)*Fa,e=Math.round(d/Fa)*Fa;.2>Math.abs(c-a)&&.2>Math.abs(e-d)&&(b=g.realVector([c,e,1]))}return g.normalizeMax(b)};n.Free.getParamFromState=function(a){return W(3)};n.Free.putParamToState=function(a,b){Q(b)};n.Free.updatePosition=function(a){var b=W(3);Q(b);
a.homog=w.withUsage(b,"Point")};n.Free.stateSize=6;n._helper.projectPointToLine=function(a,b){var d=g.turnIntoCSList([b.value[0],b.value[1],k.zero]),d=g.cross(d,a);return g.normalizeMax(g.cross(d,b))};n.PointOnLine={};n.PointOnLine.kind="P";n.PointOnLine.signature=["L"];n.PointOnLine.isMovable=!0;n.PointOnLine.initialize=function(a){var b=n._helper.initializePoint(a);a=l[a.args[0]].homog;var b=n._helper.projectPointToLine(b,a),b=g.normalizeMax(b),d=g.cross(g.linfty,b);g.normalizeMax(d);Q(b);Q(a);
Sa=!1};n.PointOnLine.updatePosition=function(a,b){var d,c=l[a.args[0]].homog;d=W(3);W(3);if(!b){ga=a.stateIdx;var e=da;da=pa;var f=W(3),h=W(3);da=e;e=g.cross(h,c);g._helper.isAlmostZero(e)&&(e=g.cross(g.linfty,c));f=n._helper.CircleMP(e,f);f=n._helper.IntersectLC(c,f);e=n._helper.pointReflection(e,d);d=tc(f[0],f[1],d,e)[0]}d=g.normalizeMax(d);Q(d);Q(c);a.homog=w.withUsage(d,"Point")};n.PointOnLine.getParamForInput=function(a,b,d){return b=n._helper.projectPointToLine(b,l[a.args[0]].homog)};n.PointOnLine.getParamFromState=
function(a){return W(3)};n.PointOnLine.putParamToState=function(a,b){return Q(b)};n.PointOnLine.stateSize=12;n.PointOnCircle={};n.PointOnCircle.kind="P";n.PointOnCircle.signature=["C"];n.PointOnCircle.isMovable=!0;n.PointOnCircle.initialize=function(a){var b=l[a.args[0]];a=g.normalizeZ(n._helper.initializePoint(a));var d=g.normalizeZ(n._helper.CenterOfConic(b.matrix)),c=g.sub(a,d),c=g.turnIntoCSList([c.value[1],k.neg(c.value[0]),k.zero]),d=g.cross(a,d),b=n._helper.IntersectLC(d,b.matrix),d=g.projectiveDistMinScal(a,
b[0]);g.projectiveDistMinScal(a,b[1])<d?(a=b[1],b=b[0]):(a=b[0],b=b[1]);Q(c);Q(a);Q(b);Sa=!1};n.PointOnCircle.putParamToState=function(a,b){Q(b)};n.PointOnCircle.getParamFromState=function(a){return W(3)};n.PointOnCircle.getParamForInput=function(a,b,d){d=g.normalizeZ(n._helper.CenterOfConic(l[a.args[0]].matrix));b=g.sub(b,d);ga=a.stateIdx;a=W(3);var c=g.normalizeZ(W(3));d=g.sub(c,d);0>k.sub(k.mult(a.value[0],d.value[1]),k.mult(a.value[1],d.value[0])).value.real&&(b=g.neg(b));return g.turnIntoCSList([b.value[1],
k.neg(b.value[0]),k.zero])};n.PointOnCircle.parameterPath=function(a,b,d,c,e){c=g.normalizeAbs(c);e=g.normalizeAbs(e);var f=g.scalproduct(c,e);if(0<=f.value.real)return sc(a,b,d,c,e);a=g.turnIntoCSList([k.sub(c.value[1],e.value[1]),k.sub(e.value[0],c.value[0]),k.zero]);f=g.scalproduct(c,a);0>f.value.real&&(a=g.neg(a));0>b?(b=2*b+1,d=b*b,f=.25/(1+d),d=k.complex(2*b*f+.25,(1-d)*f)):(b=2*b-1,d=b*b,f=.25/(1+d),d=k.complex(2*b*f+.75,(1-d)*f));var h=k.sub(k.real(1),d);b=k.mult(d,d);f=k.mult(h,h);d=k.mult(d,
h);c=g.scalmult(f,c);c=g.add(c,g.scalmult(d,a));return c=g.add(c,g.scalmult(b,e))};n.PointOnCircle.updatePosition=function(a){var b=W(3);Q(b);var d=l[a.args[0]],b=g.productMV(d.matrix,b),d=n._helper.IntersectLC(b,d.matrix),d=Aa(d[0],d[1]),b=g.normalizeMax(d.value[0]);a.homog=w.withUsage(b,"Point");a.antipodalPoint=d.value[1]};n.PointOnCircle.stateSize=6+Aa.stateSize;n.OtherPointOnCircle={};n.OtherPointOnCircle.kind="P";n.OtherPointOnCircle.signature=["P"];n.OtherPointOnCircle.signatureConstraints=
function(a){return"PointOnCircle"===l[a.args[0]].type};n.OtherPointOnCircle.updatePosition=function(a){var b=l[a.args[0]].antipodalPoint,b=g.normalizeMax(b);a.homog=w.withUsage(b,"Point")};n.PointOnSegment={};n.PointOnSegment.kind="P";n.PointOnSegment.signature=["S"];n.PointOnSegment.isMovable=!0;n.PointOnSegment.initialize=function(a){var b=n._helper.initializePoint(a);a=n.PointOnSegment.getParamForInput(a,b);Ta(a)};n.PointOnSegment.getParamForInput=function(a,b){var d=l[a.args[0]],c=d.homog,c=g.turnIntoCSList([c.value[0],
c.value[1],k.zero]),d=g.crossratio3(d.farpoint,d.startpos,d.endpos,b,c);0>d.value.real&&(d=k.complex(0,d.value.imag));1<d.value.real&&(d=k.complex(1,d.value.imag));return d};n.PointOnSegment.getParamFromState=function(a){return eb()};n.PointOnSegment.putParamToState=function(a,b){Ta(b)};n.PointOnSegment.updatePosition=function(a){var b=eb();Ta(b);var d=l[a.args[0]],c=g.scalmult(d.endpos.value[2],d.startpos),d=g.scalmult(d.startpos.value[2],d.endpos),d=g.sub(d,c),b=g.add(c,g.scalmult(b,d)),b=g.normalizeMax(b);
a.homog=w.withUsage(b,"Point")};n.PointOnSegment.stateSize=2;n._helper.CenterOfConic=function(a){return w.mult(g.adjoint3(a),g.linfty)};n.CenterOfConic={};n.CenterOfConic.kind="P";n.CenterOfConic.signature=["C"];n.CenterOfConic.updatePosition=function(a){var b=n._helper.CenterOfConic(l[a.args[0]].matrix);a.homog=b;a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};n._helper.CircleMP=function(a,b){var d=a.value[0],c=a.value[1],e=k.neg(a.value[2]),f=k.zero,d=g.turnIntoCSList([g.turnIntoCSList([e,
f,d]),g.turnIntoCSList([f,e,c]),g.turnIntoCSList([d,c,f])]),e=w.mult(w.mult(b,d),b),c=w.mult(w.mult(b,g.fund),b),e=w.mult(e,g.fund),d=w.mult(c,d);return g.sub(e,d)};n.CircleMP={};n.CircleMP.kind="C";n.CircleMP.signature=["P","P"];n.CircleMP.updatePosition=function(a){a.matrix=n._helper.CircleMP(l[a.args[0]].homog,l[a.args[1]].homog);a.matrix=g.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Circle")};n.CircleMr={};n.CircleMr.kind="C";n.CircleMr.signature=["P"];n.CircleMr.isMovable=!0;n.CircleMr.initialize=
function(a){Ta(k.real(a.radius))};n.CircleMr.getParamForInput=function(a,b){var d=l[a.args[0]].homog,d=g.normalizeZ(d);b=g.normalizeZ(b);d=g.sub(d,b);return d=g.abs(d)};n.CircleMr.getParamFromState=function(a){return eb()};n.CircleMr.putParamToState=function(a,b){Ta(b)};n.CircleMr.updatePosition=function(a){var b=eb();Ta(b);var d=l[a.args[0]].homog,c=k.mult(d.value[2],b),c=k.mult(c,c);if(!k._helper.isFinite(c)&&!k._helper.isNaN(c))return g.fund;d=n._helper.ScaledCircleMrr(d,c);a.matrix=w.withUsage(d,
"Circle");a.radius=b};n.CircleMr.stateSize=2;n._helper.ScaledCircleMrr=function(a,b){var d=a.value[0],c=a.value[1],e=k.neg(a.value[2]),e=g.scalmult(e,g.turnIntoCSList([d,c,e])).value,d=g.turnIntoCSList([d,c]),d=k.sub(g.scalproduct(d,d),b),e=n._helper.buildConicMatrix([e[2],k.zero,e[2],e[0],e[1],d]);return g.normalizeMax(e)};n.Compass={};n.Compass.kind="C";n.Compass.signature=["P","P","P"];n.Compass.updatePosition=function(a){var b=l[a.args[0]].homog,d=l[a.args[1]].homog,c=l[a.args[2]].homog,e=b.value[2],
f=d.value[2],h=c.value[2],b=g.scalmult(k.mult(f,h),b),d=g.scalmult(k.mult(e,h),d),c=g.scalmult(k.mult(e,f),c),b=g.sub(d,b),c=n._helper.ScaledCircleMrr(c,g.scalproduct(b,b));a.matrix=w.withUsage(c,"Circle")};n._helper.getConicType=function(a){if(1E-16>k.abs(g.det(a)).value.real)return"degenerate";var b=k.mult(a.value[0].value[0],a.value[1].value[1]),b=k.sub(b,k.pow(a.value[0].value[1],k.real(2))),b=b.value.real;return 1E-16>Math.abs(b)?"parabola":1E-16<b?"ellipsoid":"hyperbola"};n._helper.ConicBy5=
function(a,b,d,c,e,f){a=g.turnIntoCSList([g.cross(d,c)]);var h=g.turnIntoCSList([g.cross(b,e)]);b=g.turnIntoCSList([g.cross(b,d)]);c=g.turnIntoCSList([g.cross(c,e)]);return n._helper.conicFromTwoDegenerates(a,h,b,c,f)};n._helper.conicFromTwoDegenerates=function(a,b,d,c,e){a=w.mult(g.transpose(b),a);d=w.mult(g.transpose(c),d);a=g.add(a,g.transpose(a));d=g.add(d,g.transpose(d));c=w.mult(w.mult(e,a),e);e=w.mult(w.mult(e,d),e);d=w.mult(c,d);e=w.mult(e,a);return g.sub(d,e)};n.ConicBy5={};n.ConicBy5.kind=
"C";n.ConicBy5.signature=["P","P","P","P","P"];n.ConicBy5.updatePosition=function(a){var b=n._helper.ConicBy5(a,l[a.args[0]].homog,l[a.args[1]].homog,l[a.args[2]].homog,l[a.args[3]].homog,l[a.args[4]].homog);a.matrix=b;a.matrix=g.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};n._helper.buildConicMatrix=function(a){var b=a[1],d=a[2],c=a[3],e=a[4],f=a[5];return g.turnIntoCSList([g.turnIntoCSList([a[0],b,c]),g.turnIntoCSList([b,d,e]),g.turnIntoCSList([c,e,f])])};n._helper.splitDegenConic=
function(a){var b=g.adjoint3(a),d=0,c,e,f=k.abs2(b.value[0].value[0]).value.real;for(c=1;3>c;c++)e=k.abs2(b.value[c].value[c]).value.real,e>f&&(d=c,f=e);c=k.sqrt(k.mult(k.real(-1),b.value[d].value[d]));if(1E-16>k.abs2(c).value.real)return a=g.turnIntoCSList([k.zero,k.zero,k.zero]),[a,a];d=k.real(d+1);e=g.column(b,d);e=g.scaldiv(c,e);c=e.value[0];f=e.value[1];e=e.value[2];c=g.turnIntoCSList([g.turnIntoCSList([k.real(0),e,k.mult(k.real(-1),f)]),g.turnIntoCSList([k.mult(k.real(-1),e),k.real(0),c]),g.turnIntoCSList([f,
k.mult(k.real(-1),c),k.real(0)])]);a=g.add(a,c);var h=0;for(c=f=b=0;3>c;c++)for(d=0;3>d;d++)e=k.abs2(a.value[c].value[d]).value.real,e>f&&(h=c,b=d,f=e);c=a.value[h];a=g.transpose(a);a=a.value[b];c=g.normalizeMax(c);a=g.normalizeMax(a);c=w.withUsage(c,"Line");a=w.withUsage(a,"Line");return[c,a]};n.SelectConic={};n.SelectConic.kind="C";n.SelectConic.signature=["Cs"];n.SelectConic.initialize=function(a){if(void 0!==a.index)return a.index-1;var b=k._helper.input(a.pos.xx),d=k._helper.input(a.pos.yy),
c=k._helper.input(a.pos.zz),e=k.realmult(.5,k._helper.input(a.pos.xy)),f=k.realmult(.5,k._helper.input(a.pos.xz)),h=k.realmult(.5,k._helper.input(a.pos.yz)),b=g.turnIntoCSList([g.turnIntoCSList([b,e,f]),g.turnIntoCSList([e,d,h]),g.turnIntoCSList([f,h,c])]);a=l[a.args[0]].results;d=g.conicDist(b,a[0]);c=0;for(e=1;e<a.length;++e)f=g.conicDist(b,a[e]),f<d&&(d=f,c=e);return c};n.SelectConic.updatePosition=function(a){a.matrix=l[a.args[0]].results[a.param];a.matrix=g.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,
"Conic")};n._helper.ConicBy4p1l=function(a,b,c,e,f,h){var l=g.cross(g.cross(b,e),h),p=g.cross(g.cross(c,f),h),q=g.cross(g.cross(b,c),h),r=g.cross(g.cross(e,f),h),u=g.realVector(v.to(100*Math.random(),100*Math.random()));h=k.mult(g.det3(u,p,q),g.det3(u,p,r));h=k.sqrt(h);q=k.mult(g.det3(u,l,q),g.det3(u,l,r));q=k.sqrt(q);l=g.scalmult(h,l);q=g.scalmult(q,p);p=g.add(l,q);l=g.sub(l,q);p=n._helper.ConicBy5(a,b,c,e,f,p);a=n._helper.ConicBy5(a,b,c,e,f,l);return[p,a]};n.ConicBy4p1l={};n.ConicBy4p1l.kind="Cs";
n.ConicBy4p1l.signature=["P","P","P","P","L"];n.ConicBy4p1l.updatePosition=function(a){var b=n._helper.ConicBy4p1l(a,l[a.args[0]].homog,l[a.args[1]].homog,l[a.args[2]].homog,l[a.args[3]].homog,l[a.args[4]].homog);a.results=b};n._helper.ConicBy3p2l=function(a,b,c,e,f){function h(a,b,c,d){return k.sub(k.mult(a,d),k.mult(b,c))}var l=g.cross(a,b),n=g.cross(e,f);e=g.cross(e,l);f=g.cross(f,l);l=g.turnIntoCSList([e,f,n]);c=g.productVM(c,g.adjoint3(l));n=g.adjoint3(g.turnIntoCSList([g.scalmult(c.value[0],
e),g.scalmult(c.value[1],f),g.scalmult(c.value[2],n)]));c=g.transpose(n);e=k.mult;f=g.productMV(c,a);a=f.value[0];f=f.value[1];l=g.productMV(c,b);b=l.value[0];var l=l.value[1],p=k.sqrt(e(a,f)),q=k.sqrt(e(b,l)),r,u=Array(4);for(r=0;4>r;++r){var t=(r&2)-1,v=e(k.real(((r&1)<<1)-1),p),w=e(k.real(t),q),x=h(f,v,l,w),y=h(b,w,a,v),t=h(a,f,b,l),A=k.add(k.add(h(b,l,a,f),h(l,w,f,v)),h(w,b,v,a)),v=e(x,x),w=e(y,y),B=e(A,A),C=e(x,y),x=e(x,A),y=e(y,A),C=k.sub(C,e(k.real(.5),e(t,t))),t=g.turnIntoCSList([g.turnIntoCSList([v,
C,x]),g.turnIntoCSList([C,w,y]),g.turnIntoCSList([x,y,B])]),t=g.productMM(n,g.productMM(t,c)),t=g.turnIntoCSList([t.value[0].value[0],t.value[0].value[1],t.value[0].value[2],t.value[1].value[1],t.value[1].value[2],t.value[2].value[2]]);u[r]=t}return u};n.ConicBy3p2l={};n.ConicBy3p2l.kind="Cs";n.ConicBy3p2l.signature=["P","P","P","L","L"];n.ConicBy3p2l.updatePosition=function(a){for(var b=n._helper.ConicBy3p2l(l[a.args[0]].homog,l[a.args[1]].homog,l[a.args[2]].homog,l[a.args[3]].homog,l[a.args[4]].homog),
b=uc(b),c=Array(4),e=0;4>e;++e){var f=b[e].value;c[e]=g.turnIntoCSList([g.turnIntoCSList([f[0],f[1],f[2]]),g.turnIntoCSList([f[1],f[3],f[4]]),g.turnIntoCSList([f[2],f[4],f[5]])])}a.results=c};n.ConicBy3p2l.stateSize=48;n.ConicBy2p3l={};n.ConicBy2p3l.kind="Cs";n.ConicBy2p3l.signature=["P","P","L","L","L"];n.ConicBy2p3l.updatePosition=function(a){for(var b=n._helper.ConicBy3p2l(l[a.args[2]].homog,l[a.args[3]].homog,l[a.args[4]].homog,l[a.args[0]].homog,l[a.args[1]].homog),b=uc(b),c=Array(4),e=0;4>e;++e){var f=
b[e].value,f=g.turnIntoCSList([g.turnIntoCSList([f[0],f[1],f[2]]),g.turnIntoCSList([f[1],f[3],f[4]]),g.turnIntoCSList([f[2],f[4],f[5]])]);c[e]=g.normalizeMax(g.adjoint3(f))}a.results=c};n.ConicBy2p3l.stateSize=48;n.ConicBy1p4l={};n.ConicBy1p4l.kind="Cs";n.ConicBy1p4l.signature=["P","L","L","L","L"];n.ConicBy1p4l.updatePosition=function(a){var b=n._helper.ConicBy4p1l(a,l[a.args[1]].homog,l[a.args[2]].homog,l[a.args[3]].homog,l[a.args[4]].homog,l[a.args[0]].homog),c=b[0],b=b[1],c=g.adjoint3(c),b=g.adjoint3(b),
b=[c,b];a.results=b};n.ConicParabolaPL={};n.ConicParabolaPL.kind="C";n.ConicParabolaPL.signature=["P","L"];n.ConicParabolaPL.updatePosition=function(a){var b=l[a.args[0]].homog.value,c=l[a.args[1]].homog.value,e=k.mult,f=k.neg,h=k.add,p=k.sub,q=b[0],r=b[1],t=b[2],u=c[0],b=c[1],c=c[2],v=e(t,t),x=e(u,u),y=e(b,b),A=e(t,c),B=f(t),t=h(x,y),y=e(v,y),x=e(v,x),f=e(f(v),e(u,b)),u=e(B,h(e(q,t),e(A,u))),b=e(B,h(e(r,t),e(A,b))),e=p(e(h(e(q,q),e(r,r)),t),e(v,e(c,c))),e=n._helper.buildConicMatrix([y,f,x,u,b,e]),
e=g.normalizeMax(e);a.matrix=w.withUsage(e,"Conic")};n.ConicBy2Foci1P={};n.ConicBy2Foci1P.kind="Cs";n.ConicBy2Foci1P.signature=["P","P","P"];n.ConicBy2Foci1P.updatePosition=function(a){var b=l[a.args[0]].homog,c=l[a.args[1]].homog,e=l[a.args[2]].homog,f=g.ii,h=g.jj,p=g.normalizeMax(g.cross(b,e)),q=g.normalizeMax(g.cross(c,e)),r=g.normalizeMax(g.cross(e,f)),e=g.normalizeMax(g.cross(e,h)),q=n._helper.coHarmonic(r,e,p,q),p=g.normalizeMax(q[0]),q=g.normalizeMax(q[1]),f=g.turnIntoCSList([f]),r=g.turnIntoCSList([h]),
e=g.turnIntoCSList([b]),t=g.turnIntoCSList([c]),h=n._helper.conicFromTwoDegenerates(f,r,e,t,p),h=g.normalizeMax(h),f=n._helper.conicFromTwoDegenerates(f,r,e,t,q),f=g.normalizeMax(f),h=g.normalizeMax(g.adjoint3(h)),f=g.normalizeMax(g.adjoint3(f));"ellipsoid"!==n._helper.getConicType(h)&&(p=h,h=f,f=p);g.almostequals(b,c).value&&(b=k.real(3),f=g.zeromatrix(b,b));a.results=[h,f]};n._helper.coHarmonic=function(a,b,c,e){var f=g.realVector([100*Math.random(),100*Math.random(),1]),h=g.det3(f,c,a),l=g.det3(f,
c,b);c=g.det3(f,e,a);e=g.det3(f,e,b);e=k.sqrt(k.mult(e,l));h=k.sqrt(k.mult(c,h));a=w.mult(a,e);h=w.mult(b,h);b=g.add(a,h);a=g.sub(a,h);return[b,a]};n.ConicInSquare={};n.ConicInSquare.kind="C";n.ConicInSquare.signature=["P","P","P","P"];n.ConicInSquare.updatePosition=function(a){var b=D.basismap(l[a.args[0]].homog,l[a.args[1]].homog,l[a.args[2]].homog,l[a.args[3]].homog),c=k.one,c=n._helper.buildConicMatrix([c,c,c,k.real(-3),c,c]),b=g.adjoint3(b),b=g.productMM(g.productMM(g.transpose(b),c),b),b=g.normalizeMax(b);
a.matrix=w.withUsage(b,"Conic")};n.ConicBy5lines={};n.ConicBy5lines.kind="C";n.ConicBy5lines.signature=["L","L","L","L","L"];n.ConicBy5lines.updatePosition=function(a){var b=n._helper.ConicBy5(a,l[a.args[0]].homog,l[a.args[1]].homog,l[a.args[2]].homog,l[a.args[3]].homog,l[a.args[4]].homog),b=g.adjoint3(b);a.matrix=b;a.matrix=g.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};n.ConicFromPrincipalDirections={};n.ConicFromPrincipalDirections.kind="C";n.ConicFromPrincipalDirections.signature=
["P","P","P"];n.ConicFromPrincipalDirections.updatePosition=function(a){var b=l[a.args[0]].homog,c=l[a.args[1]].homog,e=l[a.args[2]].homog,f=n._helper.pointReflection(b,c),h=g.cross(c,b),b=g.turnIntoCSList([h.value[0],h.value[1],k.zero]),h=g.turnIntoCSList([h]),c=g.turnIntoCSList([g.cross(c,b)]),f=g.turnIntoCSList([g.cross(f,b)]);a.matrix=n._helper.conicFromTwoDegenerates(h,h,c,f,e);a.matrix=g.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};n.CircleBy3={};n.CircleBy3.kind="C";n.CircleBy3.signature=
["P","P","P"];n.CircleBy3.updatePosition=function(a){var b=n._helper.ConicBy5(a,l[a.args[0]].homog,l[a.args[1]].homog,g.ii,g.jj,l[a.args[2]].homog);a.matrix=g.normalizeMax(b);a.matrix=w.withUsage(a.matrix,"Circle")};n.ArcBy3={};n.ArcBy3.kind="C";n.ArcBy3.signature=["P","P","P"];n.ArcBy3.updatePosition=function(a){n.CircleBy3.updatePosition(a);a.startPoint=l[a.args[0]].homog;a.viaPoint=l[a.args[1]].homog;a.endPoint=l[a.args[2]].homog};n.ArcBy3.initialize=function(a){a.startPoint=l[a.args[0]].homog;
a.viaPoint=l[a.args[1]].homog;a.endPoint=l[a.args[2]].homog;a.isArc=!0};n.PolarOfPoint={};n.PolarOfPoint.kind="L";n.PolarOfPoint.signature=["P","C"];n.PolarOfPoint.updatePosition=function(a){var b=w.mult(l[a.args[1]].matrix,l[a.args[0]].homog),b=g.normalizeMax(b);a.homog=w.withUsage(b,"Line")};n.PolarOfLine={};n.PolarOfLine.kind="P";n.PolarOfLine.signature=["L","C"];n.PolarOfLine.updatePosition=function(a){var b=l[a.args[0]],c=g.adjoint3(l[a.args[1]].matrix),b=w.mult(c,b.homog),b=g.normalizeMax(b);
a.homog=w.withUsage(b,"Point")};n.angleBisector={};n.angleBisector.kind="Ls";n.angleBisector.signature=["L","L"];n.angleBisector.updatePosition=function(a){var b=l[a.args[0]],c=l[a.args[1]],e=g.normalizeMax(g.cross(b.homog,c.homog)),f=g.normalizeMax(g.cross(g.ii,e)),h=g.normalizeMax(g.cross(g.jj,e)),n=k.sqrt(k.mult(g.det3(e,c.homog,f),g.det3(e,b.homog,f))),p=k.sqrt(k.mult(g.det3(e,c.homog,h),g.det3(e,b.homog,h))),f=w.mult(f,p),n=w.mult(h,n),h=g.add(f,n),n=g.sub(f,n),f=g.abs(h).value.real<k.eps,p=
g.abs(n).value.real<k.eps;f||p?f?n=g.normalizeMax(n):p&&(h=g.normalizeMax(h)):(h=g.normalizeMax(h),n=g.normalizeMax(n));if(g.almostequals(h,g.linfty).value&&p||g.almostequals(n,g.linfty).value&&f)g.abs(h).value.real<g.abs(n).value.real?(f=g.det3(e,c.homog,n),e=g.det3(e,b.homog,n),b=w.mult(b.homog,f),c=w.mult(c.homog,e),h=g.add(b,c)):(f=g.det3(e,c.homog,h),e=g.det3(e,b.homog,h),b=w.mult(b.homog,f),c=w.mult(c.homog,e),n=g.add(b,c));h=g.normalizeMax(h);n=g.normalizeMax(n);a.results=Aa(h,n)};n.angleBisector.stateSize=
Aa.stateSize;n._helper.IntersectLC=function(a,b){var c=k,e=g.crossOperator(a),f=g.transpose(e),f=w.mult(f,w.mult(b,e)),h=g.maxIndex(a,k.abs2),l,n,p,q;0===h?(h=f.value[1].value[1],l=f.value[1].value[2],n=f.value[2].value[1],p=f.value[2].value[2],q=a.value[0]):1===h?(h=f.value[0].value[0],l=f.value[0].value[2],n=f.value[2].value[0],p=f.value[2].value[2],q=a.value[1]):(h=f.value[0].value[0],l=f.value[0].value[1],n=f.value[1].value[0],p=f.value[1].value[1],q=a.value[2]);c=c.div(c.sqrt(c.sub(c.mult(l,
n),c.mult(h,p))),q);c=g.add(f,g.scalmult(c,e));h=g.maxIndex(c,g.abs2);e=c.value[h];e=g.normalizeMax(e);e=w.withUsage(e,"Point");c=g.transpose(c);h=g.maxIndex(c,g.abs2);c=c.value[h];c=g.normalizeMax(c);c=w.withUsage(c,"Point");return[e,c]};n.IntersectLC={};n.IntersectLC.kind="Ps";n.IntersectLC.signature=["L","C"];n.IntersectLC.updatePosition=function(a){var b=n._helper.IntersectLC(l[a.args[0]].homog,l[a.args[1]].matrix);a.results=Aa(b[0],b[1])};n.IntersectLC.stateSize=Aa.stateSize;n.OtherIntersectionCL=
{};n.OtherIntersectionCL.kind="P";n.OtherIntersectionCL.signature=["C","L","P"];n.OtherIntersectionCL.updatePosition=function(a){var b=l[a.args[2]].homog,c=n._helper.IntersectLC(l[a.args[1]].homog,l[a.args[0]].matrix),e=c[0],c=c[1],f=g.projectiveDistMinScal(e,b),b=g.projectiveDistMinScal(c,b);a.homog=f<b?c:e;a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};n.IntersectCirCir={};n.IntersectCirCir.kind="Ps";n.IntersectCirCir.signature=["C","C"];n.IntersectCirCir.updatePosition=function(a){var b=
l[a.args[0]].matrix,c=l[a.args[1]].matrix,e=g.scalmult(c.value[0].value[0],b.value[2]),c=g.scalmult(b.value[0].value[0],c.value[2]),e=g.sub(e,c),e=g.turnIntoCSList([e.value[0],e.value[1],k.realmult(.5,e.value[2])]),e=g.normalizeMax(e),b=n._helper.IntersectLC(e,b);a.results=Aa(b[0],b[1])};n.IntersectCirCir.stateSize=Aa.stateSize;n.OtherIntersectionCC={};n.OtherIntersectionCC.kind="P";n.OtherIntersectionCC.signature=["C","C","P"];n.OtherIntersectionCC.updatePosition=function(a){var b=l[a.args[0]].matrix,
c=l[a.args[1]].matrix,e=l[a.args[2]].homog,f=g.scalmult(c.value[0].value[0],b.value[2]),c=g.scalmult(b.value[0].value[0],c.value[2]),f=g.sub(f,c),f=g.turnIntoCSList([f.value[0],f.value[1],k.realmult(.5,f.value[2])]),f=g.normalizeMax(f),f=n._helper.IntersectLC(f,b),b=f[0],f=f[1],c=g.projectiveDistMinScal(b,e),e=g.projectiveDistMinScal(f,e);a.homog=c<e?f:b;a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};n._helper.IntersectConicConic=function(a,b){var c=a.value[0],e=a.value[1],
f=a.value[2],h=b.value[0],l=b.value[1],p=b.value[2],q=g.det3(c,e,f),r=k.add(k.add(g.det3(c,e,p),g.det3(c,l,f)),g.det3(h,e,f)),c=k.add(k.add(g.det3(c,l,p),g.det3(h,e,p)),g.det3(h,l,f)),h=g.det3(h,l,p),p=k.abs2(q).value.real,l=k.abs2(h).value.real;p<l&&(p=a,a=b,b=p,p=h,h=q,q=p,p=c,c=r,r=p,p=l);1E-24>p?(q=a,c=b):(r=k.solveCubic(q,r,c,h),c=k.abs2(k.sub(r[0],r[1])).value.real,h=k.abs2(k.sub(r[0],r[2])).value.real,l=k.abs2(k.sub(r[1],r[2])).value.real,c>h?(q=r[1],r=c>l?r[0]:r[2]):(q=r[2],r=h>l?r[0]:r[1]),
q=g.add(g.scalmult(q,a),b),c=g.add(g.scalmult(r,a),b));r=n._helper.splitDegenConic(q);q=r[0];r=r[1];c=n._helper.splitDegenConic(c);l=c[0];h=c[1];c=g.cross(q,l);l=g.cross(r,l);q=g.cross(q,h);r=g.cross(r,h);c=g.normalizeMax(c);l=g.normalizeMax(l);q=g.normalizeMax(q);r=g.normalizeMax(r);c=w.withUsage(c,"Point");l=w.withUsage(l,"Point");q=w.withUsage(q,"Point");r=w.withUsage(r,"Point");return[c,l,q,r]};n.IntersectConicConic={};n.IntersectConicConic.kind="Ps";n.IntersectConicConic.signature=["C","C"];
n.IntersectConicConic.updatePosition=function(a){var b=n._helper.IntersectConicConic(l[a.args[0]].matrix,l[a.args[1]].matrix),b=Ob(b[0],b[1],b[2],b[3]);a.results=b};n.IntersectConicConic.stateSize=Ob.stateSize;n.SelectP={};n.SelectP.kind="P";n.SelectP.signature=["Ps"];n.SelectP.initialize=function(a){if(void 0!==a.index)return a.index-1;var b=l[a.args[0]].results.value;a=n._helper.initializePoint(a);for(var c=g.projectiveDistMinScal(a,b[0]),e=0,f=1;f<b.length;++f){var h=g.projectiveDistMinScal(a,
b[f]);h<c&&(c=h,e=f)}return e};n.SelectP.updatePosition=function(a){a.homog=l[a.args[0]].results.value[a.param]};n.SelectL={};n.SelectL.kind="L";n.SelectL.signature=["Ls"];n.SelectL.updatePosition=function(a){a.homog=l[a.args[0]].results.value[a.index-1];a.homog=w.withUsage(a.homog,"Line")};n._helper.moebiusStep=function(a,b,c){var e=k.add,f=k.sub,g=k.mult,h=a.value[0],l=a.value[1];a=a.value[2];var n=b.value[0],p=b.value[1];b=b.value[2];var q=c.value[0],r=c.value[1],t=c.value[2];c=f(g(b,q),g(n,t));
var u=f(g(b,r),g(p,t)),q=f(g(h,t),g(a,q)),r=f(g(l,t),g(a,r));return[f(g(h,c),g(l,u)),e(g(l,c),g(h,u)),g(a,c),g(a,u),f(g(n,q),g(p,r)),e(g(p,q),g(n,r)),g(b,q),g(b,r)]};n.TrMoebius={};n.TrMoebius.kind="Mt";n.TrMoebius.signature="PPPPPP".split("");n.TrMoebius.updatePosition=function(a){var b=k.neg,c=n._helper.moebiusStep(l[a.args[0]].homog,l[a.args[2]].homog,l[a.args[4]].homog),e=n._helper.moebiusStep(l[a.args[1]].homog,l[a.args[3]].homog,l[a.args[5]].homog),e=g.normalizeMax(g.matrix([[e[0],b(e[1]),e[4],
b(e[5])],[e[1],e[0],e[5],e[4]],[e[2],b(e[3]),e[6],b(e[7])],[e[3],e[2],e[7],e[6]]])),c=g.normalizeMax(g.matrix([[c[6],b(c[4])],[c[7],b(c[5])],[b(c[2]),c[0]],[b(c[3]),c[1]]])),f=g.productMM(e,c),c=f.value[0].value[0],e=f.value[1].value[0],h=f.value[0].value[1],p=f.value[1].value[1],q=f.value[2].value[0],r=f.value[3].value[0],t=f.value[2].value[1],f=f.value[3].value[1];a.mat1=g.normalizeMax(g.matrix([[b(q),r,b(t)],[r,q,f],[c,b(e),h]]));a.mat2=g.normalizeMax(g.matrix([[b(r),b(q),b(f)],[b(q),r,b(t)],[e,
c,p]]))};n.TrMoebiusP={};n.TrMoebiusP.kind="P";n.TrMoebiusP.signature=["Mt","P"];n.TrMoebiusP.updatePosition=function(a){var b=l[a.args[0]],c=l[a.args[1]].homog,e=g.productMV(b.mat1,c),b=g.productMV(b.mat2,c);a.homog=g.normalizeMax(g.cross(e,b));a.homog=w.withUsage(a.homog,"Point")};n._helper.TrMoebiusP=function(a,b){var c=g.productMV(b.mat1,a),e=g.productMV(b.mat2,a);return g.normalizeMax(g.cross(c,e))};n.TrMoebiusL={};n.TrMoebiusL.kind="C";n.TrMoebiusL.signature=["Mt","L"];n.TrMoebiusL.updatePosition=
function(a){var b=l[a.args[0]],c=l[a.args[1]].homog,e=function(){var a=g.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);return g.normalizeMax(a)},f=g.cross(e(),c),h=g.cross(e(),c),c=g.cross(e(),c),f=n._helper.TrMoebiusP(f,b),h=n._helper.TrMoebiusP(h,b),b=n._helper.TrMoebiusP(c,b);a.matrix=g.normalizeMax(n._helper.ConicBy5(null,f,h,b,g.ii,g.jj));a.matrix=w.withUsage(a.matrix,"Circle")};n.TrMoebiusC={};n.TrMoebiusC.kind="C";n.TrMoebiusC.signature=["Mt","C"];n.TrMoebiusC.updatePosition=
function(a){var b=l[a.args[0]],c=l[a.args[1]].matrix;if("Circle"!==c.usage)console.log("applying Moebius transform to conics is not implemented yet"),b=k.real(3),a.matrix=g.zeromatrix(b,b);else{var e=function(){var a=g.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);return g.normalizeMax(a)},f=n._helper.IntersectLC(e(),c),e=n._helper.IntersectLC(e(),c),c=f[1],e=e[1],f=n._helper.TrMoebiusP(f[0],b),c=n._helper.TrMoebiusP(c,b),b=n._helper.TrMoebiusP(e,b);a.matrix=g.normalizeMax(n._helper.ConicBy5(null,
f,c,b,g.ii,g.jj))}a.matrix=w.withUsage(a.matrix,"Circle")};n.TrMoebiusArc={};n.TrMoebiusArc.kind="C";n.TrMoebiusArc.signature=["Mt","C"];n.TrMoebiusArc.updatePosition=function(a){var b=l[a.args[0]],c=l[a.args[1]],e=c.viaPoint,f=c.endPoint,c=n._helper.TrMoebiusP(c.startPoint,b),e=n._helper.TrMoebiusP(e,b),b=n._helper.TrMoebiusP(f,b);a.startPoint=c;a.viaPoint=e;a.endPoint=b;a.isArc=!0;a.matrix=g.normalizeMax(n._helper.ConicBy5(null,c,e,b,g.ii,g.jj));a.matrix=w.withUsage(a.matrix,"Circle")};n._helper.trBuildMatrix=
function(a,b){var c=b(0),e=b(1),f=g.productMM(e,g.adjoint3(c));a.matrix=g.normalizeMax(f);f=g.transpose(g.productMM(c,g.adjoint3(e)));a.dualMatrix=g.normalizeMax(f)};n.TrProjection={};n.TrProjection.kind="Tr";n.TrProjection.signature="PPPPPPPP".split("");n.TrProjection.updatePosition=function(a){n._helper.trBuildMatrix(a,function(b){return D.basismap(l[a.args[0+b]].homog,l[a.args[2+b]].homog,l[a.args[4+b]].homog,l[a.args[6+b]].homog)})};n.TrAffine={};n.TrAffine.kind="Tr";n.TrAffine.signature="PPPPPP".split("");
n.TrAffine.updatePosition=function(a){var b=k.mult,c=g.scalmult,e=g.turnIntoCSList,f=g.transpose,h=g.normalizeMax,n=g.productMM,p=g.adjoint3,q=e([l[a.args[0]].homog,l[a.args[2]].homog,l[a.args[4]].homog]),r=e([l[a.args[1]].homog,l[a.args[3]].homog,l[a.args[5]].homog]),t=f(q),f=f(r),u=t.value[2].value,v=f.value[2].value,w=[b(u[0],v[2]),b(u[1],v[0]),b(u[2],v[1])],t=p(t).value;a.matrix=h(n(f,e([c(b(w[0],v[1]),t[0]),c(b(w[1],v[2]),t[1]),c(b(w[2],v[0]),t[2])])));t=q.value;a.dualMatrix=h(n(p(r),e([c(b(u[2],
w[1]),t[0]),c(b(u[0],w[2]),t[1]),c(b(u[1],w[0]),t[2])])))};n.TrSimilarity={};n.TrSimilarity.kind="Tr";n.TrSimilarity.signature=["P","P","P","P"];n.TrSimilarity.updatePosition=function(a){n._helper.trBuildMatrix(a,function(b){return D.basismap(l[a.args[0+b]].homog,l[a.args[2+b]].homog,g.ii,g.jj)})};n.TrTranslation={};n.TrTranslation.kind="Tr";n.TrTranslation.signature=["P","P"];n.TrTranslation.updatePosition=function(a){var b=l[a.args[0]].homog,c=l[a.args[1]].homog,e=g.cross(b,c).value,b=k.mult(b.value[2],
c.value[2]),c=g.turnIntoCSList,f=k.neg,h=k.zero,e=c([c([b,h,e[1]]),c([h,b,f(e[0])]),c([h,h,b])]),e=g.normalizeMax(e);a.matrix=e;b=f(e.value[0].value[0]);e=c([c([b,h,h]),c([h,b,h]),c([e.value[0].value[2],e.value[1].value[2],b])]);a.dualMatrix=e};n.TrReflectionP={};n.TrReflectionP.kind="Tr";n.TrReflectionP.signature=["P"];n.TrReflectionP.updatePosition=function(a){var b=l[a.args[0]].homog.value,c=k.realmult(-.5,b[2]),e=k.zero,b=g.turnIntoCSList([g.turnIntoCSList([c,e,b[0]]),g.turnIntoCSList([e,c,b[1]]),
g.turnIntoCSList([e,e,k.neg(c)])]),b=g.normalizeMax(b);a.matrix=b;a.dualMatrix=g.transpose(b)};n.TrReflectionL={};n.TrReflectionL.kind="Tr";n.TrReflectionL.signature=["L"];n.TrReflectionL.updatePosition=function(a){var b=k.mult,c=k.realmult,e=k.zero,f=l[a.args[0]].homog.value,h=f[0],n=f[1],f=f[2],p=b(h,h),q=b(n,n),r=c(-.5,k.sub(p,q)),t=b(h,n),b=g.turnIntoCSList([g.turnIntoCSList([k.neg(r),t,b(h,f)]),g.turnIntoCSList([t,r,b(n,f)]),g.turnIntoCSList([e,e,c(-.5,k.add(p,q))])]),b=g.normalizeMax(b);a.matrix=
b;a.dualMatrix=g.transpose(b)};n.TrReflectionS={};n.TrReflectionS.kind="Tr";n.TrReflectionS.signature=["S"];n.TrReflectionS.updatePosition=n.TrReflectionL.updatePosition;n.TrReflectionC={};n.TrReflectionC.kind="Rc";n.TrReflectionC.signature=["C"];n.TrReflectionC.updatePosition=function(a){var b=l[a.args[0]].matrix;if("Circle"!==b.usage)console.log("reflection in general conics is not defined"),a.sclRsq=k.zero,a.matrix=g.fund;else{var c=k.add,e=k.mult,f=b.value[2].value,h=f[0],n=f[1],f=f[2],p=b.value[0].value[0];
a.sclRsq=k.sub(c(e(h,h),e(n,n)),e(p,f))}a.dualMatrix=a.matrix=b};n._helper.ReflectC=function(a,b){var c=k.add,e=k.sub,f=k.mult,h=g.scalmult,l=a.matrix,n=l.value[0].value[0],p=l.value[2].value,q=p[1],r=p[2],t=b.value[0].value[0],u=b.value[2].value,v=u[1],x=u[2],c=e(k.realmult(2,c(f(p[0],u[0]),f(q,v))),c(f(n,x),f(t,r)));return w.withUsage(g.normalizeMax(g.sub(h(c,l),h(a.sclRsq,b))),"Circle")};n.ReflectCC={};n.ReflectCC.kind="C";n.ReflectCC.signature=["Rc","C"];n.ReflectCC.updatePosition=function(a){var b=
l[a.args[1]];"Circle"!==b.matrix.usage?(console.log("reflecting general conics in circles is not defined"),a.matrix=w.withUsage(g.fund,"Circle")):a.matrix=n._helper.ReflectC(l[a.args[0]],b.matrix)};n.ReflectCL={};n.ReflectCL.kind="C";n.ReflectCL.signature=["Rc","L"];n.ReflectCL.updatePosition=function(a){var b=k.zero,c=l[a.args[1]].homog.value,b=n._helper.buildConicMatrix([b,b,b,c[0],c[1],k.realmult(2,c[2])]);a.matrix=n._helper.ReflectC(l[a.args[0]],b)};n._helper.ReflectCP=function(a,b){var c=b.matrix,
e=c.value[2].value,e=g.turnIntoCSList([e[0],e[1],k.neg(c.value[0].value[0])]),f=g.cross;return g.normalizeMax(f(g.productMV(c,a),f(e,a)))};n.ReflectCP={};n.ReflectCP.kind="P";n.ReflectCP.signature=["Rc","P"];n.ReflectCP.updatePosition=function(a){a.homog=w.withUsage(n._helper.ReflectCP(l[a.args[1]].homog,l[a.args[0]]),"Point")};n.ReflectCArc={};n.ReflectCArc.kind="C";n.ReflectCArc.signature=["Rc","C"];n.ReflectCArc.updatePosition=function(a){var b=l[a.args[0]],c=l[a.args[1]],e=c.viaPoint,f=c.endPoint,
g=n._helper.ReflectCP(c.startPoint,b),e=n._helper.ReflectCP(e,b),f=n._helper.ReflectCP(f,b);a.startPoint=g;a.viaPoint=e;a.endPoint=f;a.isArc=!0;a.matrix=n._helper.ReflectC(b,c.matrix)};n.ReflectCS={};n.ReflectCS.kind="C";n.ReflectCS.signature=["Rc","S"];n.ReflectCS.updatePosition=function(a){var b=l[a.args[0]],c=l[a.args[1]],e=c.startpos,f=c.endpos,g=n._helper.midpoint(e,f),e=n._helper.ReflectCP(e,b),g=n._helper.ReflectCP(g,b),f=n._helper.ReflectCP(f,b);a.startPoint=e;a.viaPoint=g;a.endPoint=f;a.isArc=
!0;f=k.zero;c=c.homog.value;c=n._helper.buildConicMatrix([f,f,f,c[0],c[1],k.realmult(2,c[2])]);a.matrix=n._helper.ReflectC(b,c)};n.TrInverse={};n.TrInverse.kind="Tr";n.TrInverse.signature=["Tr"];n.TrInverse.updatePosition=function(a){var b=l[a.args[0]];a.dualMatrix=g.transpose(b.matrix);a.matrix=g.transpose(b.dualMatrix)};n.TransformC={};n.TransformC.kind="C";n.TransformC.signature=["Tr","C"];n.TransformC.updatePosition=function(a){var b=l[a.args[0]].dualMatrix,b=g.productMM(g.productMM(b,l[a.args[1]].matrix),
g.transpose(b)),b=g.normalizeMax(b);a.matrix=w.withUsage(b,"Conic")};n.TransformArc={};n.TransformArc.kind="C";n.TransformArc.signature=["Tr","C"];n.TransformArc.updatePosition=function(a){var b=l[a.args[0]].matrix,c=l[a.args[1]],e=c.viaPoint,f=c.endPoint,c=g.normalizeMax(g.productMV(b,c.startPoint)),e=g.normalizeMax(g.productMV(b,e)),b=g.normalizeMax(g.productMV(b,f));a.startPoint=c;a.viaPoint=e;a.endPoint=b;a.isArc=!0;a.matrix=g.normalizeMax(n._helper.ConicBy5(null,c,e,b,g.ii,g.jj));a.matrix=w.withUsage(a.matrix,
"Circle")};n.TransformP={};n.TransformP.kind="P";n.TransformP.signature=["Tr","P"];n.TransformP.updatePosition=function(a){a.homog=g.normalizeMax(g.productMV(l[a.args[0]].matrix,l[a.args[1]].homog));a.homog=w.withUsage(a.homog,"Point")};n.TransformL={};n.TransformL.kind="L";n.TransformL.signature=["Tr","L"];n.TransformL.updatePosition=function(a){a.homog=g.normalizeMax(g.productMV(l[a.args[0]].dualMatrix,l[a.args[1]].homog));a.homog=w.withUsage(a.homog,"Line")};n.TransformS={};n.TransformS.kind="S";
n.TransformS.signature=["Tr","S"];n.TransformS.updatePosition=function(a){var b=l[a.args[0]],c=l[a.args[1]];a.homog=g.normalizeMax(g.productMV(b.dualMatrix,c.homog));a.homog=w.withUsage(a.homog,"Line");a.startpos=g.normalizeMax(g.productMV(b.matrix,c.startpos));a.endpos=g.normalizeMax(g.productMV(b.matrix,c.endpos));a.farpoint=g.normalizeMax(g.productMV(b.matrix,c.farpoint))};n._helper.pointReflection=function(a,b){return g.normalizeMax(g.sub(g.scalmult(k.realmult(2,b.value[2]),a),g.scalmult(a.value[2],
b)))};n._helper.conicOtherIntersection=function(a,b,c){var e=g.productMV(a,c);a=g.scalproduct(c,e);e=g.scalproduct(b,e);e=k.realmult(-2,e);b=g.scalmult(a,b);c=g.scalmult(e,c);c=g.add(b,c);return c=g.normalizeMax(c)};n._helper.initializePoint=function(a){var b=0,c=0,e=0;if(a.pos){if("list"===a.pos.ctype&&g.isNumberVector(a.pos))return a.pos;2===a.pos.length&&(b=a.pos[0],c=a.pos[1],e=1);3===a.pos.length&&(b=a.pos[0],c=a.pos[1],e=a.pos[2])}a=g.turnIntoCSList([k._helper.input(b),k._helper.input(c),k._helper.input(e)]);
return a=g.normalizeMax(a)};var Tc={CircleMFixedr:function(a){a.pinned=!0;a.type="CircleMr";return[a]},CircleByRadius:function(a){a.type="CircleMr";return[a]},IntersectionConicLine:function(a){a.args=[a.args[1],a.args[0]];a.type="IntersectLC";return[a]},IntersectionCircleCircle:function(a){a.type="IntersectCirCir";return[a]},IntersectionConicConic:function(a){a.type="IntersectConicConic";return[a]},FreePoint:function(a){a.type="Free";return[a]},Orthogonal:function(a){a.type="Perp";return[a]},Parallel:function(a){a.type=
"Para";return[a]},Pole:function(a){a.type="PolarOfLine";return[a]},Polar:function(a){a.type="PolarOfPoint";return[a]},Calculation:function(a){console.log("Calculation stripped from construction");return[]},Arc:function(a){a.type="ArcBy3";return[a]},EuclideanMid:function(a){a.type="Mid";return[a]},Transform:function(a){var b=l[a.args[1]],b={Tr:"Transform",Mt:"TrMoebius",Rc:"ReflectC"}[l[a.args[0]].kind]+(b.isArc?"Arc":b.kind);if(n.hasOwnProperty(b))return a.type=b,[a];console.log(b+" not implemented yet");
return[]},TrReflection:function(a){var b="TrReflection"+l[a.args[0]].kind;if(n.hasOwnProperty(b))return a.type=b,[a];console.log(b+" not implemented yet");return[]}},Zc="alpha angle args arrow arrowposition arrowshape arrowsides arrowsize clip color dashtype drawtrace filled labeled labelpos name overhang pinned printname radius size text_fontfamily textbold textitalics textsize tracedim tracelength traceskip tracing type visible".split(" ");qa.saveState=function(){return{geometry:$c()}};var ka={},
Ac,fb,Bc,Cc;Ac=[[],[.2],[.075,.225],[44/45,-56/15,32/9],[19372/6561,-25360/2187,64448/6561,-212/729],[9017/3168,-355/33,46732/5247,49/176,-5103/18656],[35/384,0,500/1113,125/192,-2187/6784,11/84]];fb=[0,.2,.3,.8,8/9,1,1];Bc=[35/384,0,500/1113,125/192,-2187/6784,11/84,0];Cc=[5179/57600,0,7571/16695,.6140625,-92097/339200,187/2100,.025];var ma,Y=[],yb=!1;ka.tick=function(){for(var a=0;a<K.env.accuracy;a++)ka.tick1(K.env.deltat/K.env.accuracy),A(ja.simulationstep)};ka.tick1=function(a){for(var b=a,c=
0;0<a&&c<.999*a||0>a&&c>.999*a;)b=ka.oneRKStep(b),c+=b,b=Math.min(2*b,a-c),b=Math.max(b,1E-16),ka.restorePosition(),ka.doCollisions(),ka.calculateForces(),ka.moveToFinalPos();return!0};ka.restorePosition=function(){ma.forEach(function(a){a=a.behavior;K[a.type].restorePos(a,9)})};ka.doCollisions=function(){ma.forEach(function(a){a=a.behavior;K[a.type].doCollisions(a)})};ka.calculateForces=function(){ma.forEach(function(a){a=a.behavior;K[a.type].calculateForces(a)})};ka.moveToFinalPos=function(){ma.forEach(function(a){a=
a.behavior;K[a.type].move(a)})};ka.oneRKStep=function(a){for(var b=function(a){ma.forEach(function(b){b=b.behavior;K[b.type].initRK(b,a);K[b.type].storePosition(b)})},c=function(a){ma.forEach(function(b){b=b.behavior;K[b.type].setToTimestep(b,fb[a])})},e=function(a){ma.forEach(function(b){b=b.behavior;K[b.type].proceedMotion(b,fb[a],a,Ac[a])})},f=function(){ma.forEach(function(a){a=a.behavior;K[a.type].resetForces(a)})},g=function(a){ma.forEach(function(b){b=b.behavior;K[b.type].calculateDelta(b,
a)})},h=function(b){var c=0;ma.forEach(function(a){a=a.behavior;K[a.type].proceedMotion(a,fb[6],7,Bc);K[a.type].savePos(a,8);K[a.type].proceedMotion(a,fb[6],7,Cc);K[a.type].savePos(a,9);c+=K[a.type].sqDist(a,8,9)});return c=Math.sqrt(c)/a},k=function(a){ma.forEach(function(a){a=a.behavior;K[a.type].recallPosition(a)})},l=!1;!l;){b(a);for(var n=0;7>n;n++)c(n),e(n),f(),ka.calculateForces(),g(n);h(a)>K.env.errorbound&&a>K.env.lowestdeltat?(a/=K.env.slowdownfactor,k()):l=!0}return a};var K={Mass:{init:function(a,
b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.mass&&(a.mass=1);"undefined"===typeof a.charge&&(a.charge=0);"undefined"===typeof a.friction&&(a.friction=0);a.lnfrict=0;"undefined"===typeof a.limitspeed&&(a.limitspeed=!1);"undefined"===typeof a.fixed&&(a.fixed=!1);"undefined"===typeof a.radius&&(a.radius=1);a.internalmove=!1;a.fx=0;a.fy=0;a.fz=0;a.vx=a.vx||0;a.vy=a.vy||0;a.vz=a.vz||0;a.mtype=0;a.env=K.env;a.deltat=0;a.mx=0;a.my=0;a.mz=0;a.mvx=0;a.mvy=0;a.mvz=0;a.dx=[0,0,0,0,0,0,0,0,
0,0];a.dy=[0,0,0,0,0,0,0,0,0,0];a.dz=[0,0,0,0,0,0,0,0,0,0];a.dvx=[0,0,0,0,0,0,0,0,0,0];a.dvy=[0,0,0,0,0,0,0,0,0,0];a.dvz=[0,0,0,0,0,0,0,0,0,0];a.midx=0;a.midy=0;a.midz=0;a.lx=0;a.ly=0;a.lz=0},resetForces:function(a){a.fx=0;a.fy=0;a.fz=0},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){var c=D.extractPoint(a.el.homog);a.x=c.x;a.y=c.y;a.z=0;a.xo=a.x;a.yo=a.y;a.zo=a.z;a.vxo=a.vx;a.vyo=a.vy;a.vzo=a.vz;a.deltat=b;a.fx=0;a.fy=0;a.fz=0},setVelocity:function(a,b,c,e){e||(e=0);a.vx=b;a.vy=
c;a.vz=e},move:function(a){a.pos=[a.x,a.y,1];a.internalmove=!0;ea&&V.down&&a.el===ea.mover||Ja(a.el,g.realVector(a.pos),"homog");a.el.sx=a.x;a.el.sy=a.y;a.internalmove=!1},proceedMotion:function(a,b,c,e){if(!a.fixed)for(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz,b=0;b<c;b++)a.x+=e[b]*a.dx[b]*a.deltat,a.y+=e[b]*a.dy[b]*a.deltat,a.z+=e[b]*a.dz[b]*a.deltat,a.vx+=e[b]*a.dvx[b]*a.deltat,a.vy+=e[b]*a.dvy[b]*a.deltat,a.vz+=e[b]*a.dvz[b]*a.deltat},calculateForces:function(a){var b=Math.sqrt(a.vx*
a.vx+a.vy*a.vy+a.vz*a.vz);a.lnfrict=-Math.log((1-a.friction)*(1-a.env.friction)*(.1<b&&a.limitSpeed?.1/b:1));a.fx+=-a.vx*a.lnfrict*a.mass;a.fy+=-a.vy*a.lnfrict*a.mass;a.fz+=-a.vz*a.lnfrict*a.mass},calculateDelta:function(a,b){a.dx[b]=a.vx;a.dy[b]=a.vy;a.dz[b]=a.vz;a.dvx[b]=a.fx/a.mass;a.dvy[b]=a.fy/a.mass;a.dvz[b]=a.fz/a.mass},savePos:function(a,b){a.dx[b]=a.x;a.dy[b]=a.y;a.dz[b]=a.z;a.dvx[b]=a.vx;a.dvy[b]=a.vy;a.dvz[b]=a.vz},restorePos:function(a,b){a.fixed||(a.x=a.dx[b],a.y=a.dy[b],a.z=a.dz[b],
a.vx=a.dvx[b],a.vy=a.dvy[b],a.vz=a.dvz[b])},sqDist:function(a,b,c){var e=(a.dx[b]-a.dx[c])*(a.dx[b]-a.dx[c]),e=e+(a.dy[b]-a.dy[c])*(a.dy[b]-a.dy[c]),e=e+(a.dz[b]-a.dz[c])*(a.dz[b]-a.dz[c]),e=e+(a.dvx[b]-a.dvx[c])*(a.dvx[b]-a.dvx[c]),e=e+(a.dvy[b]-a.dvy[c])*(a.dvy[b]-a.dvy[c]);return e+=(a.dvz[b]-a.dvz[c])*(a.dvz[b]-a.dvz[c])},kineticEnergy:function(a){return.5*a.mass*(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz)},storePosition:function(a){a.mx=a.x;a.my=a.y;a.mz=a.z;a.mvx=a.vx;a.mvy=a.vy;a.mvz=a.vz},recallPosition:function(a){a.fixed||
(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz)},doCollisions:function(a){}},Sun:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.mass&&(a.mass=10);"undefined"===typeof a.friction&&(a.friction=0);a.charge=0;a.x=0;a.y=0;a.z=0},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){var c=D.extractPoint(a.el.homog);a.x=c.x;a.y=c.y;a.z=0},setVelocity:function(a,b,c,e){},move:function(a){},proceedMotion:function(a,b,c,e){},
calculateDelta:function(a,b){},calculateForces:function(a){for(var b=a.x,c=a.y,e=a.z,f=0;f<Y.length;f++){var g=Y[f],h=g.behavior.x,k=g.behavior.y,l=g.behavior.z,n=Math.sqrt((b-h)*(b-h)+(c-k)*(c-k)+(e-l)*(e-l)),k=(c-k)*a.mass*g.behavior.mass/(n*n*n),l=(e-l)*a.mass*g.behavior.mass/(n*n*n);g.behavior.fx+=(b-h)*a.mass*g.behavior.mass/(n*n*n)*g.behavior.mass;g.behavior.fy+=k*g.behavior.mass;g.behavior.fz+=l*g.behavior.mass}},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},
kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},Gravity:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.strength&&(a.strength=1);a.namea=b.args[0];a.nameb=b.args[1];a.ma=l[a.namea];a.mb=l[a.nameb]},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,e){},move:function(a){},proceedMotion:function(a,b,c,e){},calculateDelta:function(a,b){},
calculateForces:function(a){var b=D.extractPoint(a.ma.homog),c=D.extractPoint(a.mb.homog),e=(c.x-b.x)*a.strength;a=(c.y-b.y)*a.strength;for(b=0;b<Y.length;b++)c=Y[b],c.behavior.fx+=e*c.behavior.mass,c.behavior.fy+=a*c.behavior.mass,c.behavior.fz+=0*c.behavior.mass},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},Spring:{init:function(a,b){a.el=b;"undefined"===
typeof a.strength&&(a.strength=1);"undefined"===typeof a.amplitude&&(a.amplitude=0);"undefined"===typeof a.phase&&(a.phase=0);"undefined"===typeof a.speed&&(a.speed=1);"undefined"===typeof a.l0&&(a.l0=0);"undefined"===typeof a.stype&&(a.stype=1);"undefined"===typeof a.readOnInit&&(a.readOnInit=!1);a.namea=b.args[0];a.nameb=b.args[1];a.ma=l[a.namea];a.mb=l[a.nameb];var c=D.extractPoint(a.ma.homog),e=D.extractPoint(a.mb.homog);a.l0=Math.sqrt((c.x-e.x)*(c.x-e.x)+(c.y-e.y)*(c.y-e.y));a.env=K.env},resetForces:function(a){},
getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,e){},move:function(a){},proceedMotion:function(a,b,c,e){},calculateForces:function(a){var b,c,e,f;!a.ma.behavior||ea&&V.down&&a.ma===ea.mover?(c=D.extractPoint(a.ma.homog),b=c.x,e=c.y):(b=a.ma.behavior.x,e=a.ma.behavior.y);!a.mb.behavior||ea&&V.down&&a.mb===ea.mover?(f=D.extractPoint(a.mb.homog),c=f.x,f=f.y):(c=a.mb.behavior.x,f=a.mb.behavior.y);var g=Math.sqrt((b-c)*(b-c)+(e-f)*(e-f)),h=a.l0,k=a.stype;1===
k&&(h=0);var l=0;if(2===k||3===k)l=a.ma.behavior.mass*a.mb.behavior.mass*a.strength;2===k&&(l=-l);var n,p;if(0===g||0!==k&&1!==k)if(a.ma.behavior&&a.mb.behavior&&0!==g){if(g*=g*g,2===k||3===k)n=(b-c)*l/g,p=(e-f)*l/g}else n=p=0;else n=-(b-c)*a.strength*(g-h)/g*a.env.springstrength,p=-(e-f)*a.strength*(g-h)/g*a.env.springstrength;a.ma.behavior&&(a.ma.behavior.fx+=n,a.ma.behavior.fy+=p);a.mb.behavior&&(a.mb.behavior.fx-=n,a.mb.behavior.fy-=p)},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,
b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},det:function(a,b,c,e,f,g){return c*g-f*e+f*b-a*g+a*e-c*b},Bouncer:{init:function(a,b){a.el=b;"undefined"===typeof a.xdamp&&(a.xdamp=0);"undefined"===typeof a.ydamp&&(a.ydamp=0);"undefined"===typeof a.motorchanger&&(a.motorchanger=!0);a.namea=b.args[0];a.nameb=b.args[1];a.ma=l[a.namea];a.mb=l[a.nameb];var c=D.extractPoint(a.ma.homog),e=D.extractPoint(a.mb.homog);
a.x1o=1.01*c.x-.01*e.x;a.y1o=1.01*c.y-.01*e.y;a.x2o=1.01*e.x-.01*c.x;a.y2o=1.01*e.y-.01*c.y;a.env=K.env},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){a.deltat=b},setVelocity:function(a,b,c,e){},move:function(a){},proceedMotion:function(a,b,c,e){},calculateForces:function(a){},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},
doCollisions:function(a){for(var b=D.extractPoint(a.ma.homog),c=D.extractPoint(a.mb.homog),e=b.x,b=b.y,f=c.x,c=c.y,g=a.x1o,h=a.y1o,l=a.x2o,n=a.y2o,p=Math.sqrt((e-f)*(e-f)+(b-c)*(b-c)),q=(e-f)/p,p=(b-c)/p,r=0;r<Y.length;r++){var t=Y[r],u=t.behavior.xo,v=t.behavior.yo,w=t.behavior.x,x=t.behavior.y,y=k.mult(k.complex(g,h),k.complex(f,c)),A=k.mult(k.complex(l,n),k.complex(e,b)),y=k.sub(y,A),A=k.mult(k.complex(u,v),k.complex(e,b)),y=k.add(y,A),A=k.mult(k.complex(u,v),k.complex(f,c)),y=k.sub(y,A),A=k.sub(k.complex(g,
h),k.complex(l,n)),y=k.div(y,A);0>K.det(e,b,f,c,w,x)*K.det(e,b,f,c,y.value.real,y.value.imag)&&0>K.det(e,b,w,x,y.value.real,y.value.imag)*K.det(f,c,w,x,y.value.real,y.value.imag)&&(v=t.behavior.mvx+a.deltat*(-y.value.real+t.behavior.xo),w=t.behavior.mvy+a.deltat*(-y.value.imag+t.behavior.yo),u=q*v+p*w,v=p*v-q*w,t.behavior.x=y.value.real,t.behavior.y=y.value.imag,t.behavior.vx=q*u*(1-a.xdamp),t.behavior.vy=p*u*(1-a.xdamp),t.behavior.vx+=-p*v*(1-a.ydamp),t.behavior.vy+=q*v*(1-a.ydamp))}a.x1o=e;a.y1o=
b;a.x2o=f;a.y2o=c}},Environment:{init:function(a){"undefined"===typeof a.gravity&&(a.gravity=0);"undefined"===typeof a.friction&&(a.friction=0);"undefined"===typeof a.springstrength&&(a.springstrength=1);"undefined"===typeof a.accuracy&&(a.accuracy=10);"undefined"===typeof a.deltat&&(a.deltat=.3);"undefined"===typeof a.charges&&(a.charges=!1);"undefined"===typeof a.balls&&(a.balls=!1);"undefined"===typeof a.newton&&(a.newton=!1);"undefined"===typeof a.ballInteractionBoosting&&(a.ballInteractionBoosting=
1);K.env=a;a.errorbound=.001;a.lowestdeltat=1E-7;a.slowdownfactor=2},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,e){},move:function(a){},proceedMotion:function(a,b,c,e){},calculateForces:function(a){var b,c,e,f,g,h,k,l,n,p;if(a.newton)for(b=0;b<Y.length-1;b++)for(c=Y[b],e=c.behavior.x,f=c.behavior.y,g=b+1;g<Y.length;g++)h=Y[g],k=h.behavior.x,l=h.behavior.y,p=Math.sqrt((e-k)*(e-k)+(f-l)*(f-l)),k=(e-k)*c.behavior.mass*h.behavior.mass/
(p*p*p),l=(f-l)*c.behavior.mass*h.behavior.mass/(p*p*p),c.behavior.fx-=k,c.behavior.fy-=l,h.behavior.fx+=k,h.behavior.fy+=l;if(a.charges)for(b=0;b<Y.length-1;b++)for(c=Y[b],e=c.behavior.x,f=c.behavior.y,g=b+1;g<Y.length;g++)h=Y[g],k=h.behavior.x,l=h.behavior.y,p=Math.sqrt((e-k)*(e-k)+(f-l)*(f-l)),k=(e-k)*c.behavior.charge*h.behavior.charge/(p*p*p),l=(f-l)*c.behavior.charge*h.behavior.charge/(p*p*p),c.behavior.fx+=k,c.behavior.fy+=l,h.behavior.fx-=k,h.behavior.fy-=l;if(a.balls)for(b=0;b<Y.length-1;b++)if(c=
Y[b],0!==c.behavior.radius)for(e=c.behavior.x,f=c.behavior.y,g=b+1;g<Y.length;g++)h=Y[g],0!==h.behavior.radius&&(k=h.behavior.x,l=h.behavior.y,n=c.behavior.radius+h.behavior.radius,p=Math.sqrt((e-k)*(e-k)+(f-l)*(f-l)),0===a.ballInteractionBoosting?(k=(e-k)/(p*p*p)*(p>n?0:(p-n)*(p-n)),l=(f-l)/(p*p*p)*(p>n?0:(p-n)*(p-n))):1===a.ballInteractionBoosting?(k=(e-k)/(p*p*p*p)*(p>n?0:(p-n)*(p-n)),l=(f-l)/(p*p*p*p)*(p>n?0:(p-n)*(p-n))):(k=(e-k)/(p*p*p*p*p)*(p>n?0:(p-n)*(p-n)),l=(f-l)/(p*p*p*p*p)*(p>n?0:(p-
n)*(p-n))),c.behavior.fx+=k,c.behavior.fy+=l,h.behavior.fx-=k,h.behavior.fy-=l);for(b=0;b<Y.length;b++)c=Y[b],c.behavior.fx+=0,c.behavior.fy+=a.gravity,c.behavior.fz+=0},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}}};return qa};return F}();
"undefined"!==typeof process&&"undefined"!==typeof module&&"undefined"!==typeof module.exports&&"undefined"===typeof window&&(module.exports=createCindy);
//# sourceMappingURL=Cindy.js.map

