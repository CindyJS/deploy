/* CindyJS - (C) 2014-2015  The CindyJS Project
 * Mostly licensed under the Apache License 2.0, but subprojects may use different licensing.
 * See https://github.com/CindyJS/CindyJS/tree/31eff2ff81ac124db8f98661f6348d049e86be4a
 * for corresponding sources and their respective licensing conditions.
 */
(function(){function p(b,c,e){g.biginteger_used=1;null!=b&&("number"==typeof b&&"undefined"==typeof c?this.fromInt(b):"number"==typeof b?this.fromNumber(b,c,e):null==c&&"string"!=typeof b?this.fromString(b,256):this.fromString(b,c))}function E(){return new p(null)}function ha(b,c,e,h,g,r){for(;0<=--r;){var F=c*this[b++]+e[h]+g;g=Math.floor(F/67108864);e[h++]=F&67108863}return g}function Ta(b,c,e,h,g,r){var F=c&32767;for(c>>=15;0<=--r;){var m=this[b]&32767,z=this[b++]>>15,p=c*m+z*F,m=F*m+((p&32767)<<
15)+e[h]+(g&1073741823);g=(m>>>30)+(p>>>15)+c*z+(g>>>30);e[h++]=m&1073741823}return g}function ya(b,c,e,h,g,r){var F=c&16383;for(c>>=14;0<=--r;){var m=this[b]&16383,z=this[b++]>>14,p=c*m+z*F,m=F*m+((p&16383)<<14)+e[h]+g;g=(m>>28)+(p>>14)+c*z;e[h++]=m&268435455}return g}function za(b,c){var e=Ja[b.charCodeAt(c)];return null==e?-1:e}function U(b){var c=E();c.fromInt(b);return c}function G(b){var c=1,e;0!=(e=b>>>16)&&(b=e,c+=16);0!=(e=b>>8)&&(b=e,c+=8);0!=(e=b>>4)&&(b=e,c+=4);0!=(e=b>>2)&&(b=e,c+=2);
0!=b>>1&&(c+=1);return c}function O(b){this.m=b}function m(b){this.m=b;this.mp=b.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<b.DB-15)-1;this.mt2=2*b.t}function H(b,c){return b&c}function T(b,c){return b|c}function lb(b,c){return b^c}function dc(b,c){return b&~c}function xa(){}function ec(b){return b}function Aa(b){this.r2=E();this.q3=E();p.ONE.dlShiftTo(2*b.t,this.r2);this.mu=this.r2.divide(b);this.m=b}var g={},mb=!1;"undefined"!==typeof module&&module.exports?(module.exports=
g,mb=!0):"undefined"!==typeof document?window.ClipperLib=g:self.ClipperLib=g;var V;if(mb)R="chrome",V="Netscape";else{var R=navigator.userAgent.toString().toLowerCase();V=navigator.appName}var Ua,$a,Ba,Ka,Va,ab;Ua=-1!=R.indexOf("chrome")&&-1==R.indexOf("chromium")?1:0;mb=-1!=R.indexOf("chromium")?1:0;$a=-1!=R.indexOf("safari")&&-1==R.indexOf("chrome")&&-1==R.indexOf("chromium")?1:0;Ba=-1!=R.indexOf("firefox")?1:0;R.indexOf("firefox/17");R.indexOf("firefox/15");R.indexOf("firefox/3");Ka=-1!=R.indexOf("opera")?
1:0;R.indexOf("msie 10");R.indexOf("msie 9");Va=-1!=R.indexOf("msie 8")?1:0;ab=-1!=R.indexOf("msie 7")?1:0;R=-1!=R.indexOf("msie ")?1:0;g.biginteger_used=null;"Microsoft Internet Explorer"==V?(p.prototype.am=Ta,V=30):"Netscape"!=V?(p.prototype.am=ha,V=26):(p.prototype.am=ya,V=28);p.prototype.DB=V;p.prototype.DM=(1<<V)-1;p.prototype.DV=1<<V;p.prototype.FV=Math.pow(2,52);p.prototype.F1=52-V;p.prototype.F2=2*V-52;var Ja=[],fa;V=48;for(fa=0;9>=fa;++fa)Ja[V++]=fa;V=97;for(fa=10;36>fa;++fa)Ja[V++]=fa;V=
65;for(fa=10;36>fa;++fa)Ja[V++]=fa;O.prototype.convert=function(b){return 0>b.s||0<=b.compareTo(this.m)?b.mod(this.m):b};O.prototype.revert=function(b){return b};O.prototype.reduce=function(b){b.divRemTo(this.m,null,b)};O.prototype.mulTo=function(b,c,e){b.multiplyTo(c,e);this.reduce(e)};O.prototype.sqrTo=function(b,c){b.squareTo(c);this.reduce(c)};m.prototype.convert=function(b){var c=E();b.abs().dlShiftTo(this.m.t,c);c.divRemTo(this.m,null,c);0>b.s&&0<c.compareTo(p.ZERO)&&this.m.subTo(c,c);return c};
m.prototype.revert=function(b){var c=E();b.copyTo(c);this.reduce(c);return c};m.prototype.reduce=function(b){for(;b.t<=this.mt2;)b[b.t++]=0;for(var c=0;c<this.m.t;++c){var e=b[c]&32767,h=e*this.mpl+((e*this.mph+(b[c]>>15)*this.mpl&this.um)<<15)&b.DM,e=c+this.m.t;for(b[e]+=this.m.am(0,h,b,c,0,this.m.t);b[e]>=b.DV;)b[e]-=b.DV,b[++e]++}b.clamp();b.drShiftTo(this.m.t,b);0<=b.compareTo(this.m)&&b.subTo(this.m,b)};m.prototype.mulTo=function(b,c,e){b.multiplyTo(c,e);this.reduce(e)};m.prototype.sqrTo=function(b,
c){b.squareTo(c);this.reduce(c)};p.prototype.copyTo=function(b){for(var c=this.t-1;0<=c;--c)b[c]=this[c];b.t=this.t;b.s=this.s};p.prototype.fromInt=function(b){this.t=1;this.s=0>b?-1:0;0<b?this[0]=b:-1>b?this[0]=b+this.DV:this.t=0};p.prototype.fromString=function(b,c){var e;if(16==c)e=4;else if(8==c)e=3;else if(256==c)e=8;else if(2==c)e=1;else if(32==c)e=5;else if(4==c)e=2;else{this.fromRadix(b,c);return}this.s=this.t=0;for(var h=b.length,g=!1,r=0;0<=--h;){var F=8==e?b[h]&255:za(b,h);0>F?"-"==b.charAt(h)&&
(g=!0):(g=!1,0==r?this[this.t++]=F:r+e>this.DB?(this[this.t-1]|=(F&(1<<this.DB-r)-1)<<r,this[this.t++]=F>>this.DB-r):this[this.t-1]|=F<<r,r+=e,r>=this.DB&&(r-=this.DB))}8==e&&0!=(b[0]&128)&&(this.s=-1,0<r&&(this[this.t-1]|=(1<<this.DB-r)-1<<r));this.clamp();g&&p.ZERO.subTo(this,this)};p.prototype.clamp=function(){for(var b=this.s&this.DM;0<this.t&&this[this.t-1]==b;)--this.t};p.prototype.dlShiftTo=function(b,c){var e;for(e=this.t-1;0<=e;--e)c[e+b]=this[e];for(e=b-1;0<=e;--e)c[e]=0;c.t=this.t+b;c.s=
this.s};p.prototype.drShiftTo=function(b,c){for(var e=b;e<this.t;++e)c[e-b]=this[e];c.t=Math.max(this.t-b,0);c.s=this.s};p.prototype.lShiftTo=function(b,c){var e=b%this.DB,h=this.DB-e,g=(1<<h)-1,r=Math.floor(b/this.DB),F=this.s<<e&this.DM,m;for(m=this.t-1;0<=m;--m)c[m+r+1]=this[m]>>h|F,F=(this[m]&g)<<e;for(m=r-1;0<=m;--m)c[m]=0;c[r]=F;c.t=this.t+r+1;c.s=this.s;c.clamp()};p.prototype.rShiftTo=function(b,c){c.s=this.s;var e=Math.floor(b/this.DB);if(e>=this.t)c.t=0;else{var h=b%this.DB,g=this.DB-h,r=
(1<<h)-1;c[0]=this[e]>>h;for(var F=e+1;F<this.t;++F)c[F-e-1]|=(this[F]&r)<<g,c[F-e]=this[F]>>h;0<h&&(c[this.t-e-1]|=(this.s&r)<<g);c.t=this.t-e;c.clamp()}};p.prototype.subTo=function(b,c){for(var e=0,h=0,g=Math.min(b.t,this.t);e<g;)h+=this[e]-b[e],c[e++]=h&this.DM,h>>=this.DB;if(b.t<this.t){for(h-=b.s;e<this.t;)h+=this[e],c[e++]=h&this.DM,h>>=this.DB;h+=this.s}else{for(h+=this.s;e<b.t;)h-=b[e],c[e++]=h&this.DM,h>>=this.DB;h-=b.s}c.s=0>h?-1:0;-1>h?c[e++]=this.DV+h:0<h&&(c[e++]=h);c.t=e;c.clamp()};
p.prototype.multiplyTo=function(b,c){var e=this.abs(),h=b.abs(),g=e.t;for(c.t=g+h.t;0<=--g;)c[g]=0;for(g=0;g<h.t;++g)c[g+e.t]=e.am(0,h[g],c,g,0,e.t);c.s=0;c.clamp();this.s!=b.s&&p.ZERO.subTo(c,c)};p.prototype.squareTo=function(b){for(var c=this.abs(),e=b.t=2*c.t;0<=--e;)b[e]=0;for(e=0;e<c.t-1;++e){var h=c.am(e,c[e],b,2*e,0,1);(b[e+c.t]+=c.am(e+1,2*c[e],b,2*e+1,h,c.t-e-1))>=c.DV&&(b[e+c.t]-=c.DV,b[e+c.t+1]=1)}0<b.t&&(b[b.t-1]+=c.am(e,c[e],b,2*e,0,1));b.s=0;b.clamp()};p.prototype.divRemTo=function(b,
c,e){var h=b.abs();if(!(0>=h.t)){var g=this.abs();if(g.t<h.t)null!=c&&c.fromInt(0),null!=e&&this.copyTo(e);else{null==e&&(e=E());var r=E(),F=this.s;b=b.s;var m=this.DB-G(h[h.t-1]);0<m?(h.lShiftTo(m,r),g.lShiftTo(m,e)):(h.copyTo(r),g.copyTo(e));h=r.t;g=r[h-1];if(0!=g){var z=g*(1<<this.F1)+(1<h?r[h-2]>>this.F2:0),Fa=this.FV/z,z=(1<<this.F1)/z,ma=1<<this.F2,aa=e.t,O=aa-h,L=null==c?E():c;r.dlShiftTo(O,L);0<=e.compareTo(L)&&(e[e.t++]=1,e.subTo(L,e));p.ONE.dlShiftTo(h,L);for(L.subTo(r,r);r.t<h;)r[r.t++]=
0;for(;0<=--O;){var H=e[--aa]==g?this.DM:Math.floor(e[aa]*Fa+(e[aa-1]+ma)*z);if((e[aa]+=r.am(0,H,e,O,0,h))<H)for(r.dlShiftTo(O,L),e.subTo(L,e);e[aa]<--H;)e.subTo(L,e)}null!=c&&(e.drShiftTo(h,c),F!=b&&p.ZERO.subTo(c,c));e.t=h;e.clamp();0<m&&e.rShiftTo(m,e);0>F&&p.ZERO.subTo(e,e)}}}};p.prototype.invDigit=function(){if(1>this.t)return 0;var b=this[0];if(0==(b&1))return 0;var c=b&3,c=c*(2-(b&15)*c)&15,c=c*(2-(b&255)*c)&255,c=c*(2-((b&65535)*c&65535))&65535,c=c*(2-b*c%this.DV)%this.DV;return 0<c?this.DV-
c:-c};p.prototype.isEven=function(){return 0==(0<this.t?this[0]&1:this.s)};p.prototype.exp=function(b,c){if(4294967295<b||1>b)return p.ONE;var e=E(),h=E(),g=c.convert(this),r=G(b)-1;for(g.copyTo(e);0<=--r;)if(c.sqrTo(e,h),0<(b&1<<r))c.mulTo(h,g,e);else var F=e,e=h,h=F;return c.revert(e)};p.prototype.toString=function(b){if(0>this.s)return"-"+this.negate().toString(b);if(16==b)b=4;else if(8==b)b=3;else if(2==b)b=1;else if(32==b)b=5;else if(4==b)b=2;else return this.toRadix(b);var c=(1<<b)-1,e,h=!1,
g="",r=this.t,F=this.DB-r*this.DB%b;if(0<r--)for(F<this.DB&&0<(e=this[r]>>F)&&(h=!0,g="0123456789abcdefghijklmnopqrstuvwxyz".charAt(e));0<=r;)F<b?(e=(this[r]&(1<<F)-1)<<b-F,e|=this[--r]>>(F+=this.DB-b)):(e=this[r]>>(F-=b)&c,0>=F&&(F+=this.DB,--r)),0<e&&(h=!0),h&&(g+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(e));return h?g:"0"};p.prototype.negate=function(){var b=E();p.ZERO.subTo(this,b);return b};p.prototype.abs=function(){return 0>this.s?this.negate():this};p.prototype.compareTo=function(b){var c=
this.s-b.s;if(0!=c)return c;var e=this.t,c=e-b.t;if(0!=c)return 0>this.s?-c:c;for(;0<=--e;)if(0!=(c=this[e]-b[e]))return c;return 0};p.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+G(this[this.t-1]^this.s&this.DM)};p.prototype.mod=function(b){var c=E();this.abs().divRemTo(b,null,c);0>this.s&&0<c.compareTo(p.ZERO)&&b.subTo(c,c);return c};p.prototype.modPowInt=function(b,c){var e;e=256>b||c.isEven()?new O(c):new m(c);return this.exp(b,e)};p.ZERO=U(0);p.ONE=U(1);xa.prototype.convert=
ec;xa.prototype.revert=ec;xa.prototype.mulTo=function(b,c,e){b.multiplyTo(c,e)};xa.prototype.sqrTo=function(b,c){b.squareTo(c)};Aa.prototype.convert=function(b){if(0>b.s||b.t>2*this.m.t)return b.mod(this.m);if(0>b.compareTo(this.m))return b;var c=E();b.copyTo(c);this.reduce(c);return c};Aa.prototype.revert=function(b){return b};Aa.prototype.reduce=function(b){b.drShiftTo(this.m.t-1,this.r2);b.t>this.m.t+1&&(b.t=this.m.t+1,b.clamp());this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);for(this.m.multiplyLowerTo(this.q3,
this.m.t+1,this.r2);0>b.compareTo(this.r2);)b.dAddOffset(1,this.m.t+1);for(b.subTo(this.r2,b);0<=b.compareTo(this.m);)b.subTo(this.m,b)};Aa.prototype.mulTo=function(b,c,e){b.multiplyTo(c,e);this.reduce(e)};Aa.prototype.sqrTo=function(b,c){b.squareTo(c);this.reduce(c)};var P=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,
313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Zc=67108864/P[P.length-1];p.prototype.chunkSize=function(b){return Math.floor(Math.LN2*
this.DB/Math.log(b))};p.prototype.toRadix=function(b){null==b&&(b=10);if(0==this.signum()||2>b||36<b)return"0";var c=this.chunkSize(b),c=Math.pow(b,c),e=U(c),h=E(),g=E(),r="";for(this.divRemTo(e,h,g);0<h.signum();)r=(c+g.intValue()).toString(b).substr(1)+r,h.divRemTo(e,h,g);return g.intValue().toString(b)+r};p.prototype.fromRadix=function(b,c){this.fromInt(0);null==c&&(c=10);for(var e=this.chunkSize(c),h=Math.pow(c,e),g=!1,r=0,F=0,m=0;m<b.length;++m){var z=za(b,m);0>z?"-"==b.charAt(m)&&0==this.signum()&&
(g=!0):(F=c*F+z,++r>=e&&(this.dMultiply(h),this.dAddOffset(F,0),F=r=0))}0<r&&(this.dMultiply(Math.pow(c,r)),this.dAddOffset(F,0));g&&p.ZERO.subTo(this,this)};p.prototype.fromNumber=function(b,c,e){if("number"==typeof c)if(2>b)this.fromInt(1);else for(this.fromNumber(b,e),this.testBit(b-1)||this.bitwiseTo(p.ONE.shiftLeft(b-1),T,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(c);)this.dAddOffset(2,0),this.bitLength()>b&&this.subTo(p.ONE.shiftLeft(b-1),this);else{e=[];var h=b&7;e.length=
(b>>3)+1;c.nextBytes(e);e[0]=0<h?e[0]&(1<<h)-1:0;this.fromString(e,256)}};p.prototype.bitwiseTo=function(b,c,e){var h,g,r=Math.min(b.t,this.t);for(h=0;h<r;++h)e[h]=c(this[h],b[h]);if(b.t<this.t){g=b.s&this.DM;for(h=r;h<this.t;++h)e[h]=c(this[h],g);e.t=this.t}else{g=this.s&this.DM;for(h=r;h<b.t;++h)e[h]=c(g,b[h]);e.t=b.t}e.s=c(this.s,b.s);e.clamp()};p.prototype.changeBit=function(b,c){var e=p.ONE.shiftLeft(b);this.bitwiseTo(e,c,e);return e};p.prototype.addTo=function(b,c){for(var e=0,h=0,g=Math.min(b.t,
this.t);e<g;)h+=this[e]+b[e],c[e++]=h&this.DM,h>>=this.DB;if(b.t<this.t){for(h+=b.s;e<this.t;)h+=this[e],c[e++]=h&this.DM,h>>=this.DB;h+=this.s}else{for(h+=this.s;e<b.t;)h+=b[e],c[e++]=h&this.DM,h>>=this.DB;h+=b.s}c.s=0>h?-1:0;0<h?c[e++]=h:-1>h&&(c[e++]=this.DV+h);c.t=e;c.clamp()};p.prototype.dMultiply=function(b){this[this.t]=this.am(0,b-1,this,0,0,this.t);++this.t;this.clamp()};p.prototype.dAddOffset=function(b,c){if(0!=b){for(;this.t<=c;)this[this.t++]=0;for(this[c]+=b;this[c]>=this.DV;)this[c]-=
this.DV,++c>=this.t&&(this[this.t++]=0),++this[c]}};p.prototype.multiplyLowerTo=function(b,c,e){var h=Math.min(this.t+b.t,c);e.s=0;for(e.t=h;0<h;)e[--h]=0;var g;for(g=e.t-this.t;h<g;++h)e[h+this.t]=this.am(0,b[h],e,h,0,this.t);for(g=Math.min(b.t,c);h<g;++h)this.am(0,b[h],e,h,0,c-h);e.clamp()};p.prototype.multiplyUpperTo=function(b,c,e){--c;var h=e.t=this.t+b.t-c;for(e.s=0;0<=--h;)e[h]=0;for(h=Math.max(c-this.t,0);h<b.t;++h)e[this.t+h-c]=this.am(c-h,b[h],e,0,0,this.t+h-c);e.clamp();e.drShiftTo(1,e)};
p.prototype.modInt=function(b){if(0>=b)return 0;var c=this.DV%b,e=0>this.s?b-1:0;if(0<this.t)if(0==c)e=this[0]%b;else for(var h=this.t-1;0<=h;--h)e=(c*e+this[h])%b;return e};p.prototype.millerRabin=function(b){var c=this.subtract(p.ONE),e=c.getLowestSetBit();if(0>=e)return!1;var h=c.shiftRight(e);b=b+1>>1;b>P.length&&(b=P.length);for(var g=E(),r=0;r<b;++r){g.fromInt(P[Math.floor(Math.random()*P.length)]);var F=g.modPow(h,this);if(0!=F.compareTo(p.ONE)&&0!=F.compareTo(c)){for(var m=1;m++<e&&0!=F.compareTo(c);)if(F=
F.modPowInt(2,this),0==F.compareTo(p.ONE))return!1;if(0!=F.compareTo(c))return!1}}return!0};p.prototype.clone=function(){var b=E();this.copyTo(b);return b};p.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]};p.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24};p.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<
16>>16};p.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this[0]?0:1};p.prototype.toByteArray=function(){var b=this.t,c=[];c[0]=this.s;var e=this.DB-b*this.DB%8,h,g=0;if(0<b--)for(e<this.DB&&(h=this[b]>>e)!=(this.s&this.DM)>>e&&(c[g++]=h|this.s<<this.DB-e);0<=b;)if(8>e?(h=(this[b]&(1<<e)-1)<<8-e,h|=this[--b]>>(e+=this.DB-8)):(h=this[b]>>(e-=8)&255,0>=e&&(e+=this.DB,--b)),0!=(h&128)&&(h|=-256),0==g&&(this.s&128)!=(h&128)&&++g,0<g||h!=this.s)c[g++]=h;return c};p.prototype.equals=
function(b){return 0==this.compareTo(b)};p.prototype.min=function(b){return 0>this.compareTo(b)?this:b};p.prototype.max=function(b){return 0<this.compareTo(b)?this:b};p.prototype.and=function(b){var c=E();this.bitwiseTo(b,H,c);return c};p.prototype.or=function(b){var c=E();this.bitwiseTo(b,T,c);return c};p.prototype.xor=function(b){var c=E();this.bitwiseTo(b,lb,c);return c};p.prototype.andNot=function(b){var c=E();this.bitwiseTo(b,dc,c);return c};p.prototype.not=function(){for(var b=E(),c=0;c<this.t;++c)b[c]=
this.DM&~this[c];b.t=this.t;b.s=~this.s;return b};p.prototype.shiftLeft=function(b){var c=E();0>b?this.rShiftTo(-b,c):this.lShiftTo(b,c);return c};p.prototype.shiftRight=function(b){var c=E();0>b?this.lShiftTo(-b,c):this.rShiftTo(b,c);return c};p.prototype.getLowestSetBit=function(){for(var b=0;b<this.t;++b)if(0!=this[b]){var c=b*this.DB,b=this[b];if(0==b)b=-1;else{var e=0;0==(b&65535)&&(b>>=16,e+=16);0==(b&255)&&(b>>=8,e+=8);0==(b&15)&&(b>>=4,e+=4);0==(b&3)&&(b>>=2,e+=2);0==(b&1)&&++e;b=e}return c+
b}return 0>this.s?this.t*this.DB:-1};p.prototype.bitCount=function(){for(var b=0,c=this.s&this.DM,e=0;e<this.t;++e){for(var h=this[e]^c,g=0;0!=h;)h&=h-1,++g;b+=g}return b};p.prototype.testBit=function(b){var c=Math.floor(b/this.DB);return c>=this.t?0!=this.s:0!=(this[c]&1<<b%this.DB)};p.prototype.setBit=function(b){return this.changeBit(b,T)};p.prototype.clearBit=function(b){return this.changeBit(b,dc)};p.prototype.flipBit=function(b){return this.changeBit(b,lb)};p.prototype.add=function(b){var c=
E();this.addTo(b,c);return c};p.prototype.subtract=function(b){var c=E();this.subTo(b,c);return c};p.prototype.multiply=function(b){var c=E();this.multiplyTo(b,c);return c};p.prototype.divide=function(b){var c=E();this.divRemTo(b,c,null);return c};p.prototype.remainder=function(b){var c=E();this.divRemTo(b,null,c);return c};p.prototype.divideAndRemainder=function(b){var c=E(),e=E();this.divRemTo(b,c,e);return[c,e]};p.prototype.modPow=function(b,c){var e=b.bitLength(),h,g=U(1),r;if(0>=e)return g;h=
18>e?1:48>e?3:144>e?4:768>e?5:6;r=8>e?new O(c):c.isEven()?new Aa(c):new m(c);var F=[],p=3,z=h-1,Fa=(1<<h)-1;F[1]=r.convert(this);if(1<h)for(e=E(),r.sqrTo(F[1],e);p<=Fa;)F[p]=E(),r.mulTo(e,F[p-2],F[p]),p+=2;for(var ma=b.t-1,aa,H=!0,L=E(),e=G(b[ma])-1;0<=ma;){e>=z?aa=b[ma]>>e-z&Fa:(aa=(b[ma]&(1<<e+1)-1)<<z-e,0<ma&&(aa|=b[ma-1]>>this.DB+e-z));for(p=h;0==(aa&1);)aa>>=1,--p;0>(e-=p)&&(e+=this.DB,--ma);if(H)F[aa].copyTo(g),H=!1;else{for(;1<p;)r.sqrTo(g,L),r.sqrTo(L,g),p-=2;0<p?r.sqrTo(g,L):(p=g,g=L,L=p);
r.mulTo(L,F[aa],g)}for(;0<=ma&&0==(b[ma]&1<<e);)r.sqrTo(g,L),p=g,g=L,L=p,0>--e&&(e=this.DB-1,--ma)}return r.revert(g)};p.prototype.modInverse=function(b){var c=b.isEven();if(this.isEven()&&c||0==b.signum())return p.ZERO;for(var e=b.clone(),h=this.clone(),g=U(1),r=U(0),F=U(0),m=U(1);0!=e.signum();){for(;e.isEven();)e.rShiftTo(1,e),c?(g.isEven()&&r.isEven()||(g.addTo(this,g),r.subTo(b,r)),g.rShiftTo(1,g)):r.isEven()||r.subTo(b,r),r.rShiftTo(1,r);for(;h.isEven();)h.rShiftTo(1,h),c?(F.isEven()&&m.isEven()||
(F.addTo(this,F),m.subTo(b,m)),F.rShiftTo(1,F)):m.isEven()||m.subTo(b,m),m.rShiftTo(1,m);0<=e.compareTo(h)?(e.subTo(h,e),c&&g.subTo(F,g),r.subTo(m,r)):(h.subTo(e,h),c&&F.subTo(g,F),m.subTo(r,m))}if(0!=h.compareTo(p.ONE))return p.ZERO;if(0<=m.compareTo(b))return m.subtract(b);if(0>m.signum())m.addTo(b,m);else return m;return 0>m.signum()?m.add(b):m};p.prototype.pow=function(b){return this.exp(b,new xa)};p.prototype.gcd=function(b){var c=0>this.s?this.negate():this.clone();b=0>b.s?b.negate():b.clone();
if(0>c.compareTo(b)){var e=c,c=b;b=e}var e=c.getLowestSetBit(),h=b.getLowestSetBit();if(0>h)return c;e<h&&(h=e);for(0<h&&(c.rShiftTo(h,c),b.rShiftTo(h,b));0<c.signum();)0<(e=c.getLowestSetBit())&&c.rShiftTo(e,c),0<(e=b.getLowestSetBit())&&b.rShiftTo(e,b),0<=c.compareTo(b)?(c.subTo(b,c),c.rShiftTo(1,c)):(b.subTo(c,b),b.rShiftTo(1,b));0<h&&b.lShiftTo(h,b);return b};p.prototype.isProbablePrime=function(b){var c,e=this.abs();if(1==e.t&&e[0]<=P[P.length-1]){for(c=0;c<P.length;++c)if(e[0]==P[c])return!0;
return!1}if(e.isEven())return!1;for(c=1;c<P.length;){for(var h=P[c],g=c+1;g<P.length&&h<Zc;)h*=P[g++];for(h=e.modInt(h);c<g;)if(0==h%P[c++])return!1}return e.millerRabin(b)};p.prototype.square=function(){var b=E();this.squareTo(b);return b};p.prototype.IsNegative=function(){return-1==this.compareTo(p.ZERO)?!0:!1};p.op_Equality=function(b,c){return 0==b.compareTo(c)?!0:!1};p.op_Inequality=function(b,c){return 0!=b.compareTo(c)?!0:!1};p.op_GreaterThan=function(b,c){return 0<b.compareTo(c)?!0:!1};p.op_LessThan=
function(b,c){return 0>b.compareTo(c)?!0:!1};p.op_Addition=function(b,c){return(new p(b)).add(new p(c))};p.op_Subtraction=function(b,c){return(new p(b)).subtract(new p(c))};p.Int128Mul=function(b,c){return(new p(b)).multiply(new p(c))};p.op_Division=function(b,c){return b.divide(c)};p.prototype.ToDouble=function(){return parseFloat(this.toString())};if("undefined"==typeof fb)var fb=function(b,c){var e;if("undefined"==typeof Object.getOwnPropertyNames)for(e in c.prototype){if("undefined"==typeof b.prototype[e]||
b.prototype[e]==Object.prototype[e])b.prototype[e]=c.prototype[e]}else for(var h=Object.getOwnPropertyNames(c.prototype),g=0;g<h.length;g++)"undefined"==typeof Object.getOwnPropertyDescriptor(b.prototype,h[g])&&Object.defineProperty(b.prototype,h[g],Object.getOwnPropertyDescriptor(c.prototype,h[g]));for(e in c)"undefined"==typeof b[e]&&(b[e]=c[e]);b.$baseCtor=c};g.Path=function(){return[]};g.Paths=function(){return[]};g.DoublePoint=function(){var b=arguments;this.Y=this.X=0;1==b.length?(this.X=b[0].X,
this.Y=b[0].Y):2==b.length&&(this.X=b[0],this.Y=b[1])};g.DoublePoint0=function(){this.Y=this.X=0};g.DoublePoint1=function(b){this.X=b.X;this.Y=b.Y};g.DoublePoint2=function(b,c){this.X=b;this.Y=c};g.PolyNode=function(){this.m_Parent=null;this.m_polygon=new g.Path;this.m_endtype=this.m_jointype=this.m_Index=0;this.m_Childs=[];this.IsOpen=!1};g.PolyNode.prototype.IsHoleNode=function(){for(var b=!0,c=this.m_Parent;null!==c;)b=!b,c=c.m_Parent;return b};g.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length};
g.PolyNode.prototype.Contour=function(){return this.m_polygon};g.PolyNode.prototype.AddChild=function(b){var c=this.m_Childs.length;this.m_Childs.push(b);b.m_Parent=this;b.m_Index=c};g.PolyNode.prototype.GetNext=function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()};g.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]};g.PolyNode.prototype.Childs=
function(){return this.m_Childs};g.PolyNode.prototype.Parent=function(){return this.m_Parent};g.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()};g.PolyTree=function(){this.m_AllPolys=[];g.PolyNode.call(this)};g.PolyTree.prototype.Clear=function(){for(var b=0,c=this.m_AllPolys.length;b<c;b++)this.m_AllPolys[b]=null;this.m_AllPolys.length=0;this.m_Childs.length=0};g.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null};g.PolyTree.prototype.Total=function(){return this.m_AllPolys.length};
fb(g.PolyTree,g.PolyNode);g.Math_Abs_Int64=g.Math_Abs_Int32=g.Math_Abs_Double=function(b){return Math.abs(b)};g.Math_Max_Int32_Int32=function(b,c){return Math.max(b,c)};g.Cast_Int32=R||Ka||$a?function(b){return b|0}:function(b){return~~b};g.Cast_Int64=Ua?function(b){return-2147483648>b||2147483647<b?0>b?Math.ceil(b):Math.floor(b):~~b}:Ba&&"function"==typeof Number.toInteger?function(b){return Number.toInteger(b)}:ab||Va?function(b){return parseInt(b,10)}:R?function(b){return-2147483648>b||2147483647<
b?0>b?Math.ceil(b):Math.floor(b):b|0}:function(b){return 0>b?Math.ceil(b):Math.floor(b)};g.Clear=function(b){b.length=0};g.PI=3.141592653589793;g.PI2=6.283185307179586;g.IntPoint=function(){var b;b=arguments;var c=b.length;this.Y=this.X=0;2==c?(this.X=b[0],this.Y=b[1]):1==c?b[0]instanceof g.DoublePoint?(b=b[0],this.X=g.Clipper.Round(b.X),this.Y=g.Clipper.Round(b.Y)):(b=b[0],this.X=b.X,this.Y=b.Y):this.Y=this.X=0};g.IntPoint.op_Equality=function(b,c){return b.X==c.X&&b.Y==c.Y};g.IntPoint.op_Inequality=
function(b,c){return b.X!=c.X||b.Y!=c.Y};g.IntPoint0=function(){this.Y=this.X=0};g.IntPoint1=function(b){this.X=b.X;this.Y=b.Y};g.IntPoint1dp=function(b){this.X=g.Clipper.Round(b.X);this.Y=g.Clipper.Round(b.Y)};g.IntPoint2=function(b,c){this.X=b;this.Y=c};g.IntRect=function(){var b=arguments,c=b.length;4==c?(this.left=b[0],this.top=b[1],this.right=b[2],this.bottom=b[3]):1==c?(this.left=b[0].left,this.top=b[0].top,this.right=b[0].right,this.bottom=b[0].bottom):this.bottom=this.right=this.top=this.left=
0};g.IntRect0=function(){this.bottom=this.right=this.top=this.left=0};g.IntRect1=function(b){this.left=b.left;this.top=b.top;this.right=b.right;this.bottom=b.bottom};g.IntRect4=function(b,c,e,h){this.left=b;this.top=c;this.right=e;this.bottom=h};g.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3};g.PolyType={ptSubject:0,ptClip:1};g.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3};g.JoinType={jtSquare:0,jtRound:1,jtMiter:2};g.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,
etClosedLine:3,etClosedPolygon:4};g.EdgeSide={esLeft:0,esRight:1};g.Direction={dRightToLeft:0,dLeftToRight:1};g.TEdge=function(){this.Bot=new g.IntPoint;this.Curr=new g.IntPoint;this.Top=new g.IntPoint;this.Delta=new g.IntPoint;this.Dx=0;this.PolyTyp=g.PolyType.ptSubject;this.Side=g.EdgeSide.esLeft;this.OutIdx=this.WindCnt2=this.WindCnt=this.WindDelta=0;this.PrevInSEL=this.NextInSEL=this.PrevInAEL=this.NextInAEL=this.NextInLML=this.Prev=this.Next=null};g.IntersectNode=function(){this.Edge2=this.Edge1=
null;this.Pt=new g.IntPoint};g.MyIntersectNodeSort=function(){};g.MyIntersectNodeSort.Compare=function(b,c){return c.Pt.Y-b.Pt.Y};g.LocalMinima=function(){this.Y=0;this.Next=this.RightBound=this.LeftBound=null};g.Scanbeam=function(){this.Y=0;this.Next=null};g.OutRec=function(){this.Idx=0;this.IsOpen=this.IsHole=!1;this.PolyNode=this.BottomPt=this.Pts=this.FirstLeft=null};g.OutPt=function(){this.Idx=0;this.Pt=new g.IntPoint;this.Prev=this.Next=null};g.Join=function(){this.OutPt2=this.OutPt1=null;this.OffPt=
new g.IntPoint};g.ClipperBase=function(){this.m_CurrentLM=this.m_MinimaList=null;this.m_edges=[];this.PreserveCollinear=this.m_HasOpenPaths=this.m_UseFullRange=!1;this.m_CurrentLM=this.m_MinimaList=null;this.m_HasOpenPaths=this.m_UseFullRange=!1};g.ClipperBase.horizontal=-9007199254740992;g.ClipperBase.Skip=-2;g.ClipperBase.Unassigned=-1;g.ClipperBase.tolerance=1E-20;g.ClipperBase.loRange=47453132;g.ClipperBase.hiRange=0xfffffffffffff;g.ClipperBase.near_zero=function(b){return b>-g.ClipperBase.tolerance&&
b<g.ClipperBase.tolerance};g.ClipperBase.IsHorizontal=function(b){return 0===b.Delta.Y};g.ClipperBase.prototype.PointIsVertex=function(b,c){var e=c;do{if(g.IntPoint.op_Equality(e.Pt,b))return!0;e=e.Next}while(e!=c);return!1};g.ClipperBase.prototype.PointOnLineSegment=function(b,c,e,h){return h?b.X==c.X&&b.Y==c.Y||b.X==e.X&&b.Y==e.Y||b.X>c.X==b.X<e.X&&b.Y>c.Y==b.Y<e.Y&&p.op_Equality(p.Int128Mul(b.X-c.X,e.Y-c.Y),p.Int128Mul(e.X-c.X,b.Y-c.Y)):b.X==c.X&&b.Y==c.Y||b.X==e.X&&b.Y==e.Y||b.X>c.X==b.X<e.X&&
b.Y>c.Y==b.Y<e.Y&&(b.X-c.X)*(e.Y-c.Y)==(e.X-c.X)*(b.Y-c.Y)};g.ClipperBase.prototype.PointOnPolygon=function(b,c,e){for(var h=c;;){if(this.PointOnLineSegment(b,h.Pt,h.Next.Pt,e))return!0;h=h.Next;if(h==c)break}return!1};g.ClipperBase.prototype.SlopesEqual=g.ClipperBase.SlopesEqual=function(){var b=arguments,c=b.length,e,h,q;if(3==c)return c=b[0],e=b[1],b[2]?p.op_Equality(p.Int128Mul(c.Delta.Y,e.Delta.X),p.Int128Mul(c.Delta.X,e.Delta.Y)):g.Cast_Int64(c.Delta.Y*e.Delta.X)==g.Cast_Int64(c.Delta.X*e.Delta.Y);
if(4==c)return c=b[0],e=b[1],h=b[2],b[3]?p.op_Equality(p.Int128Mul(c.Y-e.Y,e.X-h.X),p.Int128Mul(c.X-e.X,e.Y-h.Y)):0===g.Cast_Int64((c.Y-e.Y)*(e.X-h.X))-g.Cast_Int64((c.X-e.X)*(e.Y-h.Y));c=b[0];e=b[1];h=b[2];q=b[3];return b[4]?p.op_Equality(p.Int128Mul(c.Y-e.Y,h.X-q.X),p.Int128Mul(c.X-e.X,h.Y-q.Y)):0===g.Cast_Int64((c.Y-e.Y)*(h.X-q.X))-g.Cast_Int64((c.X-e.X)*(h.Y-q.Y))};g.ClipperBase.SlopesEqual3=function(b,c,e){return e?p.op_Equality(p.Int128Mul(b.Delta.Y,c.Delta.X),p.Int128Mul(b.Delta.X,c.Delta.Y)):
g.Cast_Int64(b.Delta.Y*c.Delta.X)==g.Cast_Int64(b.Delta.X*c.Delta.Y)};g.ClipperBase.SlopesEqual4=function(b,c,e,h){return h?p.op_Equality(p.Int128Mul(b.Y-c.Y,c.X-e.X),p.Int128Mul(b.X-c.X,c.Y-e.Y)):0===g.Cast_Int64((b.Y-c.Y)*(c.X-e.X))-g.Cast_Int64((b.X-c.X)*(c.Y-e.Y))};g.ClipperBase.SlopesEqual5=function(b,c,e,h,q){return q?p.op_Equality(p.Int128Mul(b.Y-c.Y,e.X-h.X),p.Int128Mul(b.X-c.X,e.Y-h.Y)):0===g.Cast_Int64((b.Y-c.Y)*(e.X-h.X))-g.Cast_Int64((b.X-c.X)*(e.Y-h.Y))};g.ClipperBase.prototype.Clear=
function(){this.DisposeLocalMinimaList();for(var b=0,c=this.m_edges.length;b<c;++b){for(var e=0,h=this.m_edges[b].length;e<h;++e)this.m_edges[b][e]=null;g.Clear(this.m_edges[b])}g.Clear(this.m_edges);this.m_HasOpenPaths=this.m_UseFullRange=!1};g.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var b=this.m_MinimaList.Next;this.m_MinimaList=null;this.m_MinimaList=b}this.m_CurrentLM=null};g.ClipperBase.prototype.RangeTest=function(b,c){if(c.Value)(b.X>g.ClipperBase.hiRange||
b.Y>g.ClipperBase.hiRange||-b.X>g.ClipperBase.hiRange||-b.Y>g.ClipperBase.hiRange)&&g.Error("Coordinate outside allowed range in RangeTest().");else if(b.X>g.ClipperBase.loRange||b.Y>g.ClipperBase.loRange||-b.X>g.ClipperBase.loRange||-b.Y>g.ClipperBase.loRange)c.Value=!0,this.RangeTest(b,c)};g.ClipperBase.prototype.InitEdge=function(b,c,e,h){b.Next=c;b.Prev=e;b.Curr.X=h.X;b.Curr.Y=h.Y;b.OutIdx=-1};g.ClipperBase.prototype.InitEdge2=function(b,c){b.Curr.Y>=b.Next.Curr.Y?(b.Bot.X=b.Curr.X,b.Bot.Y=b.Curr.Y,
b.Top.X=b.Next.Curr.X,b.Top.Y=b.Next.Curr.Y):(b.Top.X=b.Curr.X,b.Top.Y=b.Curr.Y,b.Bot.X=b.Next.Curr.X,b.Bot.Y=b.Next.Curr.Y);this.SetDx(b);b.PolyTyp=c};g.ClipperBase.prototype.FindNextLocMin=function(b){for(var c;;){for(;g.IntPoint.op_Inequality(b.Bot,b.Prev.Bot)||g.IntPoint.op_Equality(b.Curr,b.Top);)b=b.Next;if(b.Dx!=g.ClipperBase.horizontal&&b.Prev.Dx!=g.ClipperBase.horizontal)break;for(;b.Prev.Dx==g.ClipperBase.horizontal;)b=b.Prev;for(c=b;b.Dx==g.ClipperBase.horizontal;)b=b.Next;if(b.Top.Y!=
b.Prev.Bot.Y){c.Prev.Bot.X<b.Bot.X&&(b=c);break}}return b};g.ClipperBase.prototype.ProcessBound=function(b,c){var e=b,h=b,q;b.Dx==g.ClipperBase.horizontal&&(q=c?b.Prev.Bot.X:b.Next.Bot.X,b.Bot.X!=q&&this.ReverseHorizontal(b));if(h.OutIdx!=g.ClipperBase.Skip)if(c){for(;h.Top.Y==h.Next.Bot.Y&&h.Next.OutIdx!=g.ClipperBase.Skip;)h=h.Next;if(h.Dx==g.ClipperBase.horizontal&&h.Next.OutIdx!=g.ClipperBase.Skip){for(q=h;q.Prev.Dx==g.ClipperBase.horizontal;)q=q.Prev;q.Prev.Top.X==h.Next.Top.X?c||(h=q.Prev):
q.Prev.Top.X>h.Next.Top.X&&(h=q.Prev)}for(;b!=h;)b.NextInLML=b.Next,b.Dx==g.ClipperBase.horizontal&&b!=e&&b.Bot.X!=b.Prev.Top.X&&this.ReverseHorizontal(b),b=b.Next;b.Dx==g.ClipperBase.horizontal&&b!=e&&b.Bot.X!=b.Prev.Top.X&&this.ReverseHorizontal(b);h=h.Next}else{for(;h.Top.Y==h.Prev.Bot.Y&&h.Prev.OutIdx!=g.ClipperBase.Skip;)h=h.Prev;if(h.Dx==g.ClipperBase.horizontal&&h.Prev.OutIdx!=g.ClipperBase.Skip){for(q=h;q.Next.Dx==g.ClipperBase.horizontal;)q=q.Next;q.Next.Top.X==h.Prev.Top.X?c||(h=q.Next):
q.Next.Top.X>h.Prev.Top.X&&(h=q.Next)}for(;b!=h;)b.NextInLML=b.Prev,b.Dx==g.ClipperBase.horizontal&&b!=e&&b.Bot.X!=b.Next.Top.X&&this.ReverseHorizontal(b),b=b.Prev;b.Dx==g.ClipperBase.horizontal&&b!=e&&b.Bot.X!=b.Next.Top.X&&this.ReverseHorizontal(b);h=h.Prev}if(h.OutIdx==g.ClipperBase.Skip){b=h;if(c){for(;b.Top.Y==b.Next.Bot.Y;)b=b.Next;for(;b!=h&&b.Dx==g.ClipperBase.horizontal;)b=b.Prev}else{for(;b.Top.Y==b.Prev.Bot.Y;)b=b.Prev;for(;b!=h&&b.Dx==g.ClipperBase.horizontal;)b=b.Next}b==h?h=c?b.Next:
b.Prev:(b=c?h.Next:h.Prev,e=new g.LocalMinima,e.Next=null,e.Y=b.Bot.Y,e.LeftBound=null,e.RightBound=b,e.RightBound.WindDelta=0,h=this.ProcessBound(e.RightBound,c),this.InsertLocalMinima(e))}return h};g.ClipperBase.prototype.AddPath=function(b,c,e){e||c!=g.PolyType.ptClip||g.Error("AddPath: Open paths must be subject.");var h=b.length-1;if(e)for(;0<h&&g.IntPoint.op_Equality(b[h],b[0]);)--h;for(;0<h&&g.IntPoint.op_Equality(b[h],b[h-1]);)--h;if(e&&2>h||!e&&1>h)return!1;for(var q=[],r=0;r<=h;r++)q.push(new g.TEdge);
var F=!0;try{for(q[1].Curr.X=b[1].X,q[1].Curr.Y=b[1].Y,function(){var c={Value:this.m_UseFullRange},e=this.RangeTest(b[0],c);this.m_UseFullRange=c.Value;return e}.call(this),function(){var c={Value:this.m_UseFullRange},e=this.RangeTest(b[h],c);this.m_UseFullRange=c.Value;return e}.call(this),this.InitEdge(q[0],q[1],q[h],b[0]),this.InitEdge(q[h],q[0],q[h-1],b[h]),r=h-1;1<=r;--r)(function(){var c={Value:this.m_UseFullRange},e=this.RangeTest(b[r],c);this.m_UseFullRange=c.Value;return e}).call(this),
this.InitEdge(q[r],q[r+1],q[r-1],b[r])}catch(m){return!1}var p=q[0];e||(p.Prev.OutIdx=g.ClipperBase.Skip);for(var z=p,G=p;;)if(g.IntPoint.op_Equality(z.Curr,z.Next.Curr)){if(z==z.Next)break;z==p&&(p=z.Next);G=z=this.RemoveEdge(z)}else{if(z.Prev==z.Next)break;else if(e&&g.ClipperBase.SlopesEqual(z.Prev.Curr,z.Curr,z.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(z.Prev.Curr,z.Curr,z.Next.Curr))){z==p&&(p=z.Next);z=this.RemoveEdge(z);G=z=z.Prev;continue}z=z.Next;
if(z==G)break}if(!e&&z==z.Next||e&&z.Prev==z.Next)return!1;e||(this.m_HasOpenPaths=!0);z=p;do this.InitEdge2(z,c),z=z.Next,F&&z.Curr.Y!=p.Curr.Y&&(F=!1);while(z!=p);if(F){if(e)return!1;z.Prev.OutIdx=g.ClipperBase.Skip;z.Prev.Bot.X<z.Prev.Top.X&&this.ReverseHorizontal(z.Prev);c=new g.LocalMinima;c.Next=null;c.Y=z.Bot.Y;c.LeftBound=null;c.RightBound=z;c.RightBound.Side=g.EdgeSide.esRight;for(c.RightBound.WindDelta=0;z.Next.OutIdx!=g.ClipperBase.Skip;)z.NextInLML=z.Next,z.Bot.X!=z.Prev.Top.X&&this.ReverseHorizontal(z),
z=z.Next;this.InsertLocalMinima(c);this.m_edges.push(q);return!0}this.m_edges.push(q);for(F=null;;){z=this.FindNextLocMin(z);if(z==F)break;else null==F&&(F=z);c=new g.LocalMinima;c.Next=null;c.Y=z.Bot.Y;z.Dx<z.Prev.Dx?(c.LeftBound=z.Prev,c.RightBound=z,q=!1):(c.LeftBound=z,c.RightBound=z.Prev,q=!0);c.LeftBound.Side=g.EdgeSide.esLeft;c.RightBound.Side=g.EdgeSide.esRight;c.LeftBound.WindDelta=e?c.LeftBound.Next==c.RightBound?-1:1:0;c.RightBound.WindDelta=-c.LeftBound.WindDelta;z=this.ProcessBound(c.LeftBound,
q);p=this.ProcessBound(c.RightBound,!q);c.LeftBound.OutIdx==g.ClipperBase.Skip?c.LeftBound=null:c.RightBound.OutIdx==g.ClipperBase.Skip&&(c.RightBound=null);this.InsertLocalMinima(c);q||(z=p)}return!0};g.ClipperBase.prototype.AddPaths=function(b,c,e){for(var h=!1,g=0,r=b.length;g<r;++g)this.AddPath(b[g],c,e)&&(h=!0);return h};g.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(b,c,e){return g.IntPoint.op_Equality(b,e)||g.IntPoint.op_Equality(b,c)||g.IntPoint.op_Equality(e,c)?!1:b.X!=e.X?c.X>b.X==
c.X<e.X:c.Y>b.Y==c.Y<e.Y};g.ClipperBase.prototype.RemoveEdge=function(b){b.Prev.Next=b.Next;b.Next.Prev=b.Prev;var c=b.Next;b.Prev=null;return c};g.ClipperBase.prototype.SetDx=function(b){b.Delta.X=b.Top.X-b.Bot.X;b.Delta.Y=b.Top.Y-b.Bot.Y;b.Dx=0===b.Delta.Y?g.ClipperBase.horizontal:b.Delta.X/b.Delta.Y};g.ClipperBase.prototype.InsertLocalMinima=function(b){if(null===this.m_MinimaList)this.m_MinimaList=b;else if(b.Y>=this.m_MinimaList.Y)b.Next=this.m_MinimaList,this.m_MinimaList=b;else{for(var c=this.m_MinimaList;null!==
c.Next&&b.Y<c.Next.Y;)c=c.Next;b.Next=c.Next;c.Next=b}};g.ClipperBase.prototype.PopLocalMinima=function(){null!==this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.Next)};g.ClipperBase.prototype.ReverseHorizontal=function(b){var c=b.Top.X;b.Top.X=b.Bot.X;b.Bot.X=c};g.ClipperBase.prototype.Reset=function(){this.m_CurrentLM=this.m_MinimaList;if(null!=this.m_CurrentLM)for(var b=this.m_MinimaList;null!=b;){var c=b.LeftBound;null!=c&&(c.Curr.X=c.Bot.X,c.Curr.Y=c.Bot.Y,c.Side=g.EdgeSide.esLeft,c.OutIdx=
g.ClipperBase.Unassigned);c=b.RightBound;null!=c&&(c.Curr.X=c.Bot.X,c.Curr.Y=c.Bot.Y,c.Side=g.EdgeSide.esRight,c.OutIdx=g.ClipperBase.Unassigned);b=b.Next}};g.Clipper=function(b){"undefined"==typeof b&&(b=0);this.m_PolyOuts=null;this.m_ClipType=g.ClipType.ctIntersection;this.m_IntersectNodeComparer=this.m_IntersectList=this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_ExecuteLocked=!1;this.m_SubjFillType=this.m_ClipFillType=g.PolyFillType.pftEvenOdd;this.m_GhostJoins=this.m_Joins=
null;this.StrictlySimple=this.ReverseSolution=this.m_UsingPolyTree=!1;g.ClipperBase.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_IntersectList=[];this.m_IntersectNodeComparer=g.MyIntersectNodeSort.Compare;this.m_UsingPolyTree=this.m_ExecuteLocked=!1;this.m_PolyOuts=[];this.m_Joins=[];this.m_GhostJoins=[];this.ReverseSolution=0!==(1&b);this.StrictlySimple=0!==(2&b);this.PreserveCollinear=0!==(4&b)};g.Clipper.ioReverseSolution=1;g.Clipper.ioStrictlySimple=2;g.Clipper.ioPreserveCollinear=
4;g.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),g.ClipperBase.prototype.Clear.call(this))};g.Clipper.prototype.DisposeScanbeamList=function(){for(;null!==this.m_Scanbeam;){var b=this.m_Scanbeam.Next;this.m_Scanbeam=null;this.m_Scanbeam=b}};g.Clipper.prototype.Reset=function(){g.ClipperBase.prototype.Reset.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.DisposeAllPolyPts();for(var b=this.m_MinimaList;null!==b;)this.InsertScanbeam(b.Y),
b=b.Next};g.Clipper.prototype.InsertScanbeam=function(b){if(null===this.m_Scanbeam)this.m_Scanbeam=new g.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=b;else if(b>this.m_Scanbeam.Y){var c=new g.Scanbeam;c.Y=b;c.Next=this.m_Scanbeam;this.m_Scanbeam=c}else{for(var e=this.m_Scanbeam;null!==e.Next&&b<=e.Next.Y;)e=e.Next;b!=e.Y&&(c=new g.Scanbeam,c.Y=b,c.Next=e.Next,e.Next=c)}};g.Clipper.prototype.Execute=function(){var b=arguments,c=b.length,e=b[1]instanceof g.PolyTree;if(4!=c||e){if(4==c&&e){e=
b[0];c=b[1];h=b[2];b=b[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;this.m_SubjFillType=h;this.m_ClipFillType=b;this.m_ClipType=e;this.m_UsingPolyTree=!0;(b=this.ExecuteInternal())&&this.BuildResult2(c);this.m_ExecuteLocked=!1;return b}if(2==c&&!e||2==c&&e)return e=b[0],c=b[1],this.Execute(e,c,g.PolyFillType.pftEvenOdd,g.PolyFillType.pftEvenOdd)}else{var e=b[0],c=b[1],h=b[2],b=b[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&g.Error("Error: PolyTree struct is need for open path clipping.");
this.m_ExecuteLocked=!0;g.Clear(c);this.m_SubjFillType=h;this.m_ClipFillType=b;this.m_ClipType=e;this.m_UsingPolyTree=!1;(b=this.ExecuteInternal())&&this.BuildResult(c);this.m_ExecuteLocked=!1;return b}};g.Clipper.prototype.FixHoleLinkage=function(b){if(null!==b.FirstLeft&&(b.IsHole==b.FirstLeft.IsHole||null===b.FirstLeft.Pts)){for(var c=b.FirstLeft;null!==c&&(c.IsHole==b.IsHole||null===c.Pts);)c=c.FirstLeft;b.FirstLeft=c}};g.Clipper.prototype.ExecuteInternal=function(){try{this.Reset();if(null===
this.m_CurrentLM)return!1;var b=this.PopScanbeam();do{this.InsertLocalMinimaIntoAEL(b);g.Clear(this.m_GhostJoins);this.ProcessHorizontals(!1);if(null===this.m_Scanbeam)break;var c=this.PopScanbeam();if(!this.ProcessIntersections(b,c))return!1;this.ProcessEdgesAtTopOfScanbeam(c);b=c}while(null!==this.m_Scanbeam||null!==this.m_CurrentLM);for(var b=0,e=this.m_PolyOuts.length;b<e;b++){var h=this.m_PolyOuts[b];null===h.Pts||h.IsOpen||(h.IsHole^this.ReverseSolution)==0<this.Area(h)&&this.ReversePolyPtLinks(h.Pts)}this.JoinCommonEdges();
b=0;for(e=this.m_PolyOuts.length;b<e;b++)h=this.m_PolyOuts[b],null===h.Pts||h.IsOpen||this.FixupOutPolygon(h);this.StrictlySimple&&this.DoSimplePolygons();return!0}finally{g.Clear(this.m_Joins),g.Clear(this.m_GhostJoins)}};g.Clipper.prototype.PopScanbeam=function(){var b=this.m_Scanbeam.Y;this.m_Scanbeam=this.m_Scanbeam.Next;return b};g.Clipper.prototype.DisposeAllPolyPts=function(){for(var b=0,c=this.m_PolyOuts.length;b<c;++b)this.DisposeOutRec(b);g.Clear(this.m_PolyOuts)};g.Clipper.prototype.DisposeOutRec=
function(b){var c=this.m_PolyOuts[b];null!==c.Pts&&this.DisposeOutPts(c.Pts);this.m_PolyOuts[b]=null};g.Clipper.prototype.DisposeOutPts=function(b){if(null!==b)for(b.Prev.Next=null;null!==b;)b=b.Next};g.Clipper.prototype.AddJoin=function(b,c,e){var h=new g.Join;h.OutPt1=b;h.OutPt2=c;h.OffPt.X=e.X;h.OffPt.Y=e.Y;this.m_Joins.push(h)};g.Clipper.prototype.AddGhostJoin=function(b,c){var e=new g.Join;e.OutPt1=b;e.OffPt.X=c.X;e.OffPt.Y=c.Y;this.m_GhostJoins.push(e)};g.Clipper.prototype.InsertLocalMinimaIntoAEL=
function(b){for(;null!==this.m_CurrentLM&&this.m_CurrentLM.Y==b;){var c=this.m_CurrentLM.LeftBound,e=this.m_CurrentLM.RightBound;this.PopLocalMinima();var h=null;null===c?(this.InsertEdgeIntoAEL(e,null),this.SetWindingCount(e),this.IsContributing(e)&&(h=this.AddOutPt(e,e.Bot))):(null==e?(this.InsertEdgeIntoAEL(c,null),this.SetWindingCount(c),this.IsContributing(c)&&(h=this.AddOutPt(c,c.Bot))):(this.InsertEdgeIntoAEL(c,null),this.InsertEdgeIntoAEL(e,c),this.SetWindingCount(c),e.WindCnt=c.WindCnt,e.WindCnt2=
c.WindCnt2,this.IsContributing(c)&&(h=this.AddLocalMinPoly(c,e,c.Bot))),this.InsertScanbeam(c.Top.Y));null!=e&&(g.ClipperBase.IsHorizontal(e)?this.AddEdgeToSEL(e):this.InsertScanbeam(e.Top.Y));if(null!=c&&null!=e){if(null!==h&&g.ClipperBase.IsHorizontal(e)&&0<this.m_GhostJoins.length&&0!==e.WindDelta)for(var q=0,r=this.m_GhostJoins.length;q<r;q++){var F=this.m_GhostJoins[q];this.HorzSegmentsOverlap(F.OutPt1.Pt,F.OffPt,e.Bot,e.Top)&&this.AddJoin(F.OutPt1,h,F.OffPt)}0<=c.OutIdx&&null!==c.PrevInAEL&&
c.PrevInAEL.Curr.X==c.Bot.X&&0<=c.PrevInAEL.OutIdx&&g.ClipperBase.SlopesEqual(c.PrevInAEL,c,this.m_UseFullRange)&&0!==c.WindDelta&&0!==c.PrevInAEL.WindDelta&&(q=this.AddOutPt(c.PrevInAEL,c.Bot),this.AddJoin(h,q,c.Top));if(c.NextInAEL!=e&&(0<=e.OutIdx&&0<=e.PrevInAEL.OutIdx&&g.ClipperBase.SlopesEqual(e.PrevInAEL,e,this.m_UseFullRange)&&0!==e.WindDelta&&0!==e.PrevInAEL.WindDelta&&(q=this.AddOutPt(e.PrevInAEL,e.Bot),this.AddJoin(h,q,e.Top)),h=c.NextInAEL,null!==h))for(;h!=e;)this.IntersectEdges(e,h,
c.Curr,!1),h=h.NextInAEL}}};g.Clipper.prototype.InsertEdgeIntoAEL=function(b,c){if(null===this.m_ActiveEdges)b.PrevInAEL=null,b.NextInAEL=null,this.m_ActiveEdges=b;else if(null===c&&this.E2InsertsBeforeE1(this.m_ActiveEdges,b))b.PrevInAEL=null,b.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges=this.m_ActiveEdges.PrevInAEL=b;else{for(null===c&&(c=this.m_ActiveEdges);null!==c.NextInAEL&&!this.E2InsertsBeforeE1(c.NextInAEL,b);)c=c.NextInAEL;b.NextInAEL=c.NextInAEL;null!==c.NextInAEL&&(c.NextInAEL.PrevInAEL=
b);b.PrevInAEL=c;c.NextInAEL=b}};g.Clipper.prototype.E2InsertsBeforeE1=function(b,c){return c.Curr.X==b.Curr.X?c.Top.Y>b.Top.Y?c.Top.X<g.Clipper.TopX(b,c.Top.Y):b.Top.X>g.Clipper.TopX(c,b.Top.Y):c.Curr.X<b.Curr.X};g.Clipper.prototype.IsEvenOddFillType=function(b){return b.PolyTyp==g.PolyType.ptSubject?this.m_SubjFillType==g.PolyFillType.pftEvenOdd:this.m_ClipFillType==g.PolyFillType.pftEvenOdd};g.Clipper.prototype.IsEvenOddAltFillType=function(b){return b.PolyTyp==g.PolyType.ptSubject?this.m_ClipFillType==
g.PolyFillType.pftEvenOdd:this.m_SubjFillType==g.PolyFillType.pftEvenOdd};g.Clipper.prototype.IsContributing=function(b){var c,e;b.PolyTyp==g.PolyType.ptSubject?(c=this.m_SubjFillType,e=this.m_ClipFillType):(c=this.m_ClipFillType,e=this.m_SubjFillType);switch(c){case g.PolyFillType.pftEvenOdd:if(0===b.WindDelta&&1!=b.WindCnt)return!1;break;case g.PolyFillType.pftNonZero:if(1!=Math.abs(b.WindCnt))return!1;break;case g.PolyFillType.pftPositive:if(1!=b.WindCnt)return!1;break;default:if(-1!=b.WindCnt)return!1}switch(this.m_ClipType){case g.ClipType.ctIntersection:switch(e){case g.PolyFillType.pftEvenOdd:case g.PolyFillType.pftNonZero:return 0!==
b.WindCnt2;case g.PolyFillType.pftPositive:return 0<b.WindCnt2;default:return 0>b.WindCnt2}case g.ClipType.ctUnion:switch(e){case g.PolyFillType.pftEvenOdd:case g.PolyFillType.pftNonZero:return 0===b.WindCnt2;case g.PolyFillType.pftPositive:return 0>=b.WindCnt2;default:return 0<=b.WindCnt2}case g.ClipType.ctDifference:if(b.PolyTyp==g.PolyType.ptSubject)switch(e){case g.PolyFillType.pftEvenOdd:case g.PolyFillType.pftNonZero:return 0===b.WindCnt2;case g.PolyFillType.pftPositive:return 0>=b.WindCnt2;
default:return 0<=b.WindCnt2}else switch(e){case g.PolyFillType.pftEvenOdd:case g.PolyFillType.pftNonZero:return 0!==b.WindCnt2;case g.PolyFillType.pftPositive:return 0<b.WindCnt2;default:return 0>b.WindCnt2}case g.ClipType.ctXor:if(0===b.WindDelta)switch(e){case g.PolyFillType.pftEvenOdd:case g.PolyFillType.pftNonZero:return 0===b.WindCnt2;case g.PolyFillType.pftPositive:return 0>=b.WindCnt2;default:return 0<=b.WindCnt2}}return!0};g.Clipper.prototype.SetWindingCount=function(b){for(var c=b.PrevInAEL;null!==
c&&(c.PolyTyp!=b.PolyTyp||0===c.WindDelta);)c=c.PrevInAEL;if(null===c)b.WindCnt=0===b.WindDelta?1:b.WindDelta,b.WindCnt2=0,c=this.m_ActiveEdges;else{if(0===b.WindDelta&&this.m_ClipType!=g.ClipType.ctUnion)b.WindCnt=1;else if(this.IsEvenOddFillType(b))if(0===b.WindDelta){for(var e=!0,h=c.PrevInAEL;null!==h;)h.PolyTyp==c.PolyTyp&&0!==h.WindDelta&&(e=!e),h=h.PrevInAEL;b.WindCnt=e?0:1}else b.WindCnt=b.WindDelta;else 0>c.WindCnt*c.WindDelta?1<Math.abs(c.WindCnt)?b.WindCnt=0>c.WindDelta*b.WindDelta?c.WindCnt:
c.WindCnt+b.WindDelta:b.WindCnt=0===b.WindDelta?1:b.WindDelta:b.WindCnt=0===b.WindDelta?0>c.WindCnt?c.WindCnt-1:c.WindCnt+1:0>c.WindDelta*b.WindDelta?c.WindCnt:c.WindCnt+b.WindDelta;b.WindCnt2=c.WindCnt2;c=c.NextInAEL}if(this.IsEvenOddAltFillType(b))for(;c!=b;)0!==c.WindDelta&&(b.WindCnt2=0===b.WindCnt2?1:0),c=c.NextInAEL;else for(;c!=b;)b.WindCnt2+=c.WindDelta,c=c.NextInAEL};g.Clipper.prototype.AddEdgeToSEL=function(b){null===this.m_SortedEdges?(this.m_SortedEdges=b,b.PrevInSEL=null,b.NextInSEL=
null):(b.NextInSEL=this.m_SortedEdges,b.PrevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.PrevInSEL=b)};g.Clipper.prototype.CopyAELToSEL=function(){var b=this.m_ActiveEdges;for(this.m_SortedEdges=b;null!==b;)b.PrevInSEL=b.PrevInAEL,b=b.NextInSEL=b.NextInAEL};g.Clipper.prototype.SwapPositionsInAEL=function(b,c){if(b.NextInAEL!=b.PrevInAEL&&c.NextInAEL!=c.PrevInAEL){if(b.NextInAEL==c){var e=c.NextInAEL;null!==e&&(e.PrevInAEL=b);var h=b.PrevInAEL;null!==h&&(h.NextInAEL=c);c.PrevInAEL=h;c.NextInAEL=
b;b.PrevInAEL=c;b.NextInAEL=e}else c.NextInAEL==b?(e=b.NextInAEL,null!==e&&(e.PrevInAEL=c),h=c.PrevInAEL,null!==h&&(h.NextInAEL=b),b.PrevInAEL=h,b.NextInAEL=c,c.PrevInAEL=b,c.NextInAEL=e):(e=b.NextInAEL,h=b.PrevInAEL,b.NextInAEL=c.NextInAEL,null!==b.NextInAEL&&(b.NextInAEL.PrevInAEL=b),b.PrevInAEL=c.PrevInAEL,null!==b.PrevInAEL&&(b.PrevInAEL.NextInAEL=b),c.NextInAEL=e,null!==c.NextInAEL&&(c.NextInAEL.PrevInAEL=c),c.PrevInAEL=h,null!==c.PrevInAEL&&(c.PrevInAEL.NextInAEL=c));null===b.PrevInAEL?this.m_ActiveEdges=
b:null===c.PrevInAEL&&(this.m_ActiveEdges=c)}};g.Clipper.prototype.SwapPositionsInSEL=function(b,c){if(null!==b.NextInSEL||null!==b.PrevInSEL)if(null!==c.NextInSEL||null!==c.PrevInSEL){if(b.NextInSEL==c){var e=c.NextInSEL;null!==e&&(e.PrevInSEL=b);var h=b.PrevInSEL;null!==h&&(h.NextInSEL=c);c.PrevInSEL=h;c.NextInSEL=b;b.PrevInSEL=c;b.NextInSEL=e}else c.NextInSEL==b?(e=b.NextInSEL,null!==e&&(e.PrevInSEL=c),h=c.PrevInSEL,null!==h&&(h.NextInSEL=b),b.PrevInSEL=h,b.NextInSEL=c,c.PrevInSEL=b,c.NextInSEL=
e):(e=b.NextInSEL,h=b.PrevInSEL,b.NextInSEL=c.NextInSEL,null!==b.NextInSEL&&(b.NextInSEL.PrevInSEL=b),b.PrevInSEL=c.PrevInSEL,null!==b.PrevInSEL&&(b.PrevInSEL.NextInSEL=b),c.NextInSEL=e,null!==c.NextInSEL&&(c.NextInSEL.PrevInSEL=c),c.PrevInSEL=h,null!==c.PrevInSEL&&(c.PrevInSEL.NextInSEL=c));null===b.PrevInSEL?this.m_SortedEdges=b:null===c.PrevInSEL&&(this.m_SortedEdges=c)}};g.Clipper.prototype.AddLocalMaxPoly=function(b,c,e){this.AddOutPt(b,e);0==c.WindDelta&&this.AddOutPt(c,e);b.OutIdx==c.OutIdx?
(b.OutIdx=-1,c.OutIdx=-1):b.OutIdx<c.OutIdx?this.AppendPolygon(b,c):this.AppendPolygon(c,b)};g.Clipper.prototype.AddLocalMinPoly=function(b,c,e){var h,q;g.ClipperBase.IsHorizontal(c)||b.Dx>c.Dx?(h=this.AddOutPt(b,e),c.OutIdx=b.OutIdx,b.Side=g.EdgeSide.esLeft,c.Side=g.EdgeSide.esRight,q=b,b=q.PrevInAEL==c?c.PrevInAEL:q.PrevInAEL):(h=this.AddOutPt(c,e),b.OutIdx=c.OutIdx,b.Side=g.EdgeSide.esRight,c.Side=g.EdgeSide.esLeft,q=c,b=q.PrevInAEL==b?b.PrevInAEL:q.PrevInAEL);null!==b&&0<=b.OutIdx&&g.Clipper.TopX(b,
e.Y)==g.Clipper.TopX(q,e.Y)&&g.ClipperBase.SlopesEqual(q,b,this.m_UseFullRange)&&0!==q.WindDelta&&0!==b.WindDelta&&(e=this.AddOutPt(b,e),this.AddJoin(h,e,q.Top));return h};g.Clipper.prototype.CreateOutRec=function(){var b=new g.OutRec;b.Idx=-1;b.IsHole=!1;b.IsOpen=!1;b.FirstLeft=null;b.Pts=null;b.BottomPt=null;b.PolyNode=null;this.m_PolyOuts.push(b);b.Idx=this.m_PolyOuts.length-1;return b};g.Clipper.prototype.AddOutPt=function(b,c){var e=b.Side==g.EdgeSide.esLeft;if(0>b.OutIdx){var h=this.CreateOutRec();
h.IsOpen=0===b.WindDelta;var q=new g.OutPt;h.Pts=q;q.Idx=h.Idx;q.Pt.X=c.X;q.Pt.Y=c.Y;q.Next=q;q.Prev=q;h.IsOpen||this.SetHoleState(b,h);b.OutIdx=h.Idx}else{var h=this.m_PolyOuts[b.OutIdx],r=h.Pts;if(e&&g.IntPoint.op_Equality(c,r.Pt))return r;if(!e&&g.IntPoint.op_Equality(c,r.Prev.Pt))return r.Prev;q=new g.OutPt;q.Idx=h.Idx;q.Pt.X=c.X;q.Pt.Y=c.Y;q.Next=r;q.Prev=r.Prev;q.Prev.Next=q;r.Prev=q;e&&(h.Pts=q)}return q};g.Clipper.prototype.SwapPoints=function(b,c){var e=new g.IntPoint(b.Value);b.Value.X=
c.Value.X;b.Value.Y=c.Value.Y;c.Value.X=e.X;c.Value.Y=e.Y};g.Clipper.prototype.HorzSegmentsOverlap=function(b,c,e,h){return b.X>e.X==b.X<h.X?!0:c.X>e.X==c.X<h.X?!0:e.X>b.X==e.X<c.X?!0:h.X>b.X==h.X<c.X?!0:b.X==e.X&&c.X==h.X?!0:b.X==h.X&&c.X==e.X?!0:!1};g.Clipper.prototype.InsertPolyPtBetween=function(b,c,e){var h=new g.OutPt;h.Pt.X=e.X;h.Pt.Y=e.Y;c==b.Next?(b.Next=h,c.Prev=h,h.Next=c,h.Prev=b):(c.Next=h,b.Prev=h,h.Next=b,h.Prev=c);return h};g.Clipper.prototype.SetHoleState=function(b,c){for(var e=
!1,h=b.PrevInAEL;null!==h;)0<=h.OutIdx&&0!=h.WindDelta&&(e=!e,null===c.FirstLeft&&(c.FirstLeft=this.m_PolyOuts[h.OutIdx])),h=h.PrevInAEL;e&&(c.IsHole=!0)};g.Clipper.prototype.GetDx=function(b,c){return b.Y==c.Y?g.ClipperBase.horizontal:(c.X-b.X)/(c.Y-b.Y)};g.Clipper.prototype.FirstIsBottomPt=function(b,c){for(var e=b.Prev;g.IntPoint.op_Equality(e.Pt,b.Pt)&&e!=b;)e=e.Prev;for(var h=Math.abs(this.GetDx(b.Pt,e.Pt)),e=b.Next;g.IntPoint.op_Equality(e.Pt,b.Pt)&&e!=b;)e=e.Next;for(var q=Math.abs(this.GetDx(b.Pt,
e.Pt)),e=c.Prev;g.IntPoint.op_Equality(e.Pt,c.Pt)&&e!=c;)e=e.Prev;for(var r=Math.abs(this.GetDx(c.Pt,e.Pt)),e=c.Next;g.IntPoint.op_Equality(e.Pt,c.Pt)&&e!=c;)e=e.Next;e=Math.abs(this.GetDx(c.Pt,e.Pt));return h>=r&&h>=e||q>=r&&q>=e};g.Clipper.prototype.GetBottomPt=function(b){for(var c=null,e=b.Next;e!=b;)e.Pt.Y>b.Pt.Y?(b=e,c=null):e.Pt.Y==b.Pt.Y&&e.Pt.X<=b.Pt.X&&(e.Pt.X<b.Pt.X?(c=null,b=e):e.Next!=b&&e.Prev!=b&&(c=e)),e=e.Next;if(null!==c)for(;c!=e;)for(this.FirstIsBottomPt(e,c)||(b=c),c=c.Next;g.IntPoint.op_Inequality(c.Pt,
b.Pt);)c=c.Next;return b};g.Clipper.prototype.GetLowermostRec=function(b,c){null===b.BottomPt&&(b.BottomPt=this.GetBottomPt(b.Pts));null===c.BottomPt&&(c.BottomPt=this.GetBottomPt(c.Pts));var e=b.BottomPt,h=c.BottomPt;return e.Pt.Y>h.Pt.Y?b:e.Pt.Y<h.Pt.Y?c:e.Pt.X<h.Pt.X?b:e.Pt.X>h.Pt.X?c:e.Next==e?c:h.Next==h?b:this.FirstIsBottomPt(e,h)?b:c};g.Clipper.prototype.Param1RightOfParam2=function(b,c){do if(b=b.FirstLeft,b==c)return!0;while(null!==b);return!1};g.Clipper.prototype.GetOutRec=function(b){for(b=
this.m_PolyOuts[b];b!=this.m_PolyOuts[b.Idx];)b=this.m_PolyOuts[b.Idx];return b};g.Clipper.prototype.AppendPolygon=function(b,c){var e=this.m_PolyOuts[b.OutIdx],h=this.m_PolyOuts[c.OutIdx],q;q=this.Param1RightOfParam2(e,h)?h:this.Param1RightOfParam2(h,e)?e:this.GetLowermostRec(e,h);var r=e.Pts,F=r.Prev,m=h.Pts,z=m.Prev;b.Side==g.EdgeSide.esLeft?(c.Side==g.EdgeSide.esLeft?(this.ReversePolyPtLinks(m),m.Next=r,r.Prev=m,F.Next=z,z.Prev=F,e.Pts=z):(z.Next=r,r.Prev=z,m.Prev=F,F.Next=m,e.Pts=m),r=g.EdgeSide.esLeft):
(c.Side==g.EdgeSide.esRight?(this.ReversePolyPtLinks(m),F.Next=z,z.Prev=F,m.Next=r,r.Prev=m):(F.Next=m,m.Prev=F,r.Prev=z,z.Next=r),r=g.EdgeSide.esRight);e.BottomPt=null;q==h&&(h.FirstLeft!=e&&(e.FirstLeft=h.FirstLeft),e.IsHole=h.IsHole);h.Pts=null;h.BottomPt=null;h.FirstLeft=e;q=b.OutIdx;F=c.OutIdx;b.OutIdx=-1;c.OutIdx=-1;for(m=this.m_ActiveEdges;null!==m;){if(m.OutIdx==F){m.OutIdx=q;m.Side=r;break}m=m.NextInAEL}h.Idx=e.Idx};g.Clipper.prototype.ReversePolyPtLinks=function(b){if(null!==b){var c,e;
c=b;do e=c.Next,c.Next=c.Prev,c=c.Prev=e;while(c!=b)}};g.Clipper.SwapSides=function(b,c){var e=b.Side;b.Side=c.Side;c.Side=e};g.Clipper.SwapPolyIndexes=function(b,c){var e=b.OutIdx;b.OutIdx=c.OutIdx;c.OutIdx=e};g.Clipper.prototype.IntersectEdges=function(b,c,e,h){var q=!h&&null===b.NextInLML&&b.Top.X==e.X&&b.Top.Y==e.Y;h=!h&&null===c.NextInLML&&c.Top.X==e.X&&c.Top.Y==e.Y;var r=0<=b.OutIdx,m=0<=c.OutIdx;if(0===b.WindDelta||0===c.WindDelta)0===b.WindDelta&&0===c.WindDelta?(q||h)&&r&&m&&this.AddLocalMaxPoly(b,
c,e):b.PolyTyp==c.PolyTyp&&b.WindDelta!=c.WindDelta&&this.m_ClipType==g.ClipType.ctUnion?0===b.WindDelta?m&&(this.AddOutPt(b,e),r&&(b.OutIdx=-1)):r&&(this.AddOutPt(c,e),m&&(c.OutIdx=-1)):b.PolyTyp!=c.PolyTyp&&(0!==b.WindDelta||1!=Math.abs(c.WindCnt)||this.m_ClipType==g.ClipType.ctUnion&&0!==c.WindCnt2?0!==c.WindDelta||1!=Math.abs(b.WindCnt)||this.m_ClipType==g.ClipType.ctUnion&&0!==b.WindCnt2||(this.AddOutPt(c,e),m&&(c.OutIdx=-1)):(this.AddOutPt(b,e),r&&(b.OutIdx=-1))),q&&(0>b.OutIdx?this.DeleteFromAEL(b):
g.Error("Error intersecting polylines")),h&&(0>c.OutIdx?this.DeleteFromAEL(c):g.Error("Error intersecting polylines"));else{if(b.PolyTyp==c.PolyTyp)if(this.IsEvenOddFillType(b)){var p=b.WindCnt;b.WindCnt=c.WindCnt;c.WindCnt=p}else b.WindCnt=0===b.WindCnt+c.WindDelta?-b.WindCnt:b.WindCnt+c.WindDelta,c.WindCnt=0===c.WindCnt-b.WindDelta?-c.WindCnt:c.WindCnt-b.WindDelta;else this.IsEvenOddFillType(c)?b.WindCnt2=0===b.WindCnt2?1:0:b.WindCnt2+=c.WindDelta,this.IsEvenOddFillType(b)?c.WindCnt2=0===c.WindCnt2?
1:0:c.WindCnt2-=b.WindDelta;var z,G,E;b.PolyTyp==g.PolyType.ptSubject?(z=this.m_SubjFillType,E=this.m_ClipFillType):(z=this.m_ClipFillType,E=this.m_SubjFillType);c.PolyTyp==g.PolyType.ptSubject?(G=this.m_SubjFillType,p=this.m_ClipFillType):(G=this.m_ClipFillType,p=this.m_SubjFillType);switch(z){case g.PolyFillType.pftPositive:z=b.WindCnt;break;case g.PolyFillType.pftNegative:z=-b.WindCnt;break;default:z=Math.abs(b.WindCnt)}switch(G){case g.PolyFillType.pftPositive:G=c.WindCnt;break;case g.PolyFillType.pftNegative:G=
-c.WindCnt;break;default:G=Math.abs(c.WindCnt)}if(r&&m)q||h||0!==z&&1!=z||0!==G&&1!=G||b.PolyTyp!=c.PolyTyp&&this.m_ClipType!=g.ClipType.ctXor?this.AddLocalMaxPoly(b,c,e):(this.AddOutPt(b,e),this.AddOutPt(c,e),g.Clipper.SwapSides(b,c),g.Clipper.SwapPolyIndexes(b,c));else if(r){if(0===G||1==G)this.AddOutPt(b,e),g.Clipper.SwapSides(b,c),g.Clipper.SwapPolyIndexes(b,c)}else if(m){if(0===z||1==z)this.AddOutPt(c,e),g.Clipper.SwapSides(b,c),g.Clipper.SwapPolyIndexes(b,c)}else if(!(0!==z&&1!=z||0!==G&&1!=
G||q||h)){switch(E){case g.PolyFillType.pftPositive:r=b.WindCnt2;break;case g.PolyFillType.pftNegative:r=-b.WindCnt2;break;default:r=Math.abs(b.WindCnt2)}switch(p){case g.PolyFillType.pftPositive:m=c.WindCnt2;break;case g.PolyFillType.pftNegative:m=-c.WindCnt2;break;default:m=Math.abs(c.WindCnt2)}if(b.PolyTyp!=c.PolyTyp)this.AddLocalMinPoly(b,c,e);else if(1==z&&1==G)switch(this.m_ClipType){case g.ClipType.ctIntersection:0<r&&0<m&&this.AddLocalMinPoly(b,c,e);break;case g.ClipType.ctUnion:0>=r&&0>=
m&&this.AddLocalMinPoly(b,c,e);break;case g.ClipType.ctDifference:(b.PolyTyp==g.PolyType.ptClip&&0<r&&0<m||b.PolyTyp==g.PolyType.ptSubject&&0>=r&&0>=m)&&this.AddLocalMinPoly(b,c,e);break;case g.ClipType.ctXor:this.AddLocalMinPoly(b,c,e)}else g.Clipper.SwapSides(b,c)}q!=h&&(q&&0<=b.OutIdx||h&&0<=c.OutIdx)&&(g.Clipper.SwapSides(b,c),g.Clipper.SwapPolyIndexes(b,c));q&&this.DeleteFromAEL(b);h&&this.DeleteFromAEL(c)}};g.Clipper.prototype.DeleteFromAEL=function(b){var c=b.PrevInAEL,e=b.NextInAEL;if(null!==
c||null!==e||b==this.m_ActiveEdges)null!==c?c.NextInAEL=e:this.m_ActiveEdges=e,null!==e&&(e.PrevInAEL=c),b.NextInAEL=null,b.PrevInAEL=null};g.Clipper.prototype.DeleteFromSEL=function(b){var c=b.PrevInSEL,e=b.NextInSEL;if(null!==c||null!==e||b==this.m_SortedEdges)null!==c?c.NextInSEL=e:this.m_SortedEdges=e,null!==e&&(e.PrevInSEL=c),b.NextInSEL=null,b.PrevInSEL=null};g.Clipper.prototype.UpdateEdgeIntoAEL=function(b){null===b.Value.NextInLML&&g.Error("UpdateEdgeIntoAEL: invalid call");var c=b.Value.PrevInAEL,
e=b.Value.NextInAEL;b.Value.NextInLML.OutIdx=b.Value.OutIdx;null!==c?c.NextInAEL=b.Value.NextInLML:this.m_ActiveEdges=b.Value.NextInLML;null!==e&&(e.PrevInAEL=b.Value.NextInLML);b.Value.NextInLML.Side=b.Value.Side;b.Value.NextInLML.WindDelta=b.Value.WindDelta;b.Value.NextInLML.WindCnt=b.Value.WindCnt;b.Value.NextInLML.WindCnt2=b.Value.WindCnt2;b.Value=b.Value.NextInLML;b.Value.Curr.X=b.Value.Bot.X;b.Value.Curr.Y=b.Value.Bot.Y;b.Value.PrevInAEL=c;b.Value.NextInAEL=e;g.ClipperBase.IsHorizontal(b.Value)||
this.InsertScanbeam(b.Value.Top.Y)};g.Clipper.prototype.ProcessHorizontals=function(b){for(var c=this.m_SortedEdges;null!==c;)this.DeleteFromSEL(c),this.ProcessHorizontal(c,b),c=this.m_SortedEdges};g.Clipper.prototype.GetHorzDirection=function(b,c,e,h){b.Bot.X<b.Top.X?(e.Value=b.Bot.X,h.Value=b.Top.X,c.Value=g.Direction.dLeftToRight):(e.Value=b.Top.X,h.Value=b.Bot.X,c.Value=g.Direction.dRightToLeft)};g.Clipper.prototype.PrepareHorzJoins=function(b,c){var e=this.m_PolyOuts[b.OutIdx].Pts;b.Side!=g.EdgeSide.esLeft&&
(e=e.Prev);for(var h=0,q=this.m_GhostJoins.length;h<q;++h){var r=this.m_GhostJoins[h];this.HorzSegmentsOverlap(r.OutPt1.Pt,r.OffPt,b.Bot,b.Top)&&this.AddJoin(r.OutPt1,e,r.OffPt)}c&&(g.IntPoint.op_Equality(e.Pt,b.Top)?this.AddGhostJoin(e,b.Bot):this.AddGhostJoin(e,b.Top))};g.Clipper.prototype.ProcessHorizontal=function(b,c){var e,h,q;(function(){e={Value:e};h={Value:h};q={Value:q};var c=this.GetHorzDirection(b,e,h,q);e=e.Value;h=h.Value;q=q.Value;return c}).call(this);for(var r=b,m=null;null!==r.NextInLML&&
g.ClipperBase.IsHorizontal(r.NextInLML);)r=r.NextInLML;for(null===r.NextInLML&&(m=this.GetMaximaPair(r));;){for(var p=b==r,z=this.GetNextInAEL(b,e);null!==z&&!(z.Curr.X==b.Top.X&&null!==b.NextInLML&&z.Dx<b.NextInLML.Dx);){var G=this.GetNextInAEL(z,e);if(e==g.Direction.dLeftToRight&&z.Curr.X<=q||e==g.Direction.dRightToLeft&&z.Curr.X>=h){0<=b.OutIdx&&0!=b.WindDelta&&this.PrepareHorzJoins(b,c);if(z==m&&p){e==g.Direction.dLeftToRight?this.IntersectEdges(b,z,z.Top,!1):this.IntersectEdges(z,b,z.Top,!1);
0<=m.OutIdx&&g.Error("ProcessHorizontal error");return}if(e==g.Direction.dLeftToRight){var E=new g.IntPoint(z.Curr.X,b.Curr.Y);this.IntersectEdges(b,z,E,!0)}else E=new g.IntPoint(z.Curr.X,b.Curr.Y),this.IntersectEdges(z,b,E,!0);this.SwapPositionsInAEL(b,z)}else if(e==g.Direction.dLeftToRight&&z.Curr.X>=q||e==g.Direction.dRightToLeft&&z.Curr.X<=h)break;z=G}0<=b.OutIdx&&0!==b.WindDelta&&this.PrepareHorzJoins(b,c);if(null!==b.NextInLML&&g.ClipperBase.IsHorizontal(b.NextInLML))(function(){b={Value:b};
var c=this.UpdateEdgeIntoAEL(b);b=b.Value;return c}).call(this),0<=b.OutIdx&&this.AddOutPt(b,b.Bot),function(){e={Value:e};h={Value:h};q={Value:q};var c=this.GetHorzDirection(b,e,h,q);e=e.Value;h=h.Value;q=q.Value;return c}.call(this);else break}null!==b.NextInLML?0<=b.OutIdx?(r=this.AddOutPt(b,b.Top),function(){b={Value:b};var c=this.UpdateEdgeIntoAEL(b);b=b.Value;return c}.call(this),0!==b.WindDelta&&(m=b.PrevInAEL,G=b.NextInAEL,null!==m&&m.Curr.X==b.Bot.X&&m.Curr.Y==b.Bot.Y&&0!==m.WindDelta&&0<=
m.OutIdx&&m.Curr.Y>m.Top.Y&&g.ClipperBase.SlopesEqual(b,m,this.m_UseFullRange)?(G=this.AddOutPt(m,b.Bot),this.AddJoin(r,G,b.Top)):null!==G&&G.Curr.X==b.Bot.X&&G.Curr.Y==b.Bot.Y&&0!==G.WindDelta&&0<=G.OutIdx&&G.Curr.Y>G.Top.Y&&g.ClipperBase.SlopesEqual(b,G,this.m_UseFullRange)&&(G=this.AddOutPt(G,b.Bot),this.AddJoin(r,G,b.Top)))):function(){b={Value:b};var c=this.UpdateEdgeIntoAEL(b);b=b.Value;return c}.call(this):null!==m?0<=m.OutIdx?(e==g.Direction.dLeftToRight?this.IntersectEdges(b,m,b.Top,!1):
this.IntersectEdges(m,b,b.Top,!1),0<=m.OutIdx&&g.Error("ProcessHorizontal error")):(this.DeleteFromAEL(b),this.DeleteFromAEL(m)):(0<=b.OutIdx&&this.AddOutPt(b,b.Top),this.DeleteFromAEL(b))};g.Clipper.prototype.GetNextInAEL=function(b,c){return c==g.Direction.dLeftToRight?b.NextInAEL:b.PrevInAEL};g.Clipper.prototype.IsMinima=function(b){return null!==b&&b.Prev.NextInLML!=b&&b.Next.NextInLML!=b};g.Clipper.prototype.IsMaxima=function(b,c){return null!==b&&b.Top.Y==c&&null===b.NextInLML};g.Clipper.prototype.IsIntermediate=
function(b,c){return b.Top.Y==c&&null!==b.NextInLML};g.Clipper.prototype.GetMaximaPair=function(b){var c=null;g.IntPoint.op_Equality(b.Next.Top,b.Top)&&null===b.Next.NextInLML?c=b.Next:g.IntPoint.op_Equality(b.Prev.Top,b.Top)&&null===b.Prev.NextInLML&&(c=b.Prev);return null===c||-2!=c.OutIdx&&(c.NextInAEL!=c.PrevInAEL||g.ClipperBase.IsHorizontal(c))?c:null};g.Clipper.prototype.ProcessIntersections=function(b,c){if(null==this.m_ActiveEdges)return!0;try{this.BuildIntersectList(b,c);if(0==this.m_IntersectList.length)return!0;
if(1==this.m_IntersectList.length||this.FixupIntersectionOrder())this.ProcessIntersectList();else return!1}catch(e){this.m_SortedEdges=null,this.m_IntersectList.length=0,g.Error("ProcessIntersections error")}this.m_SortedEdges=null;return!0};g.Clipper.prototype.BuildIntersectList=function(b,c){if(null!==this.m_ActiveEdges){var e=this.m_ActiveEdges;for(this.m_SortedEdges=e;null!==e;)e.PrevInSEL=e.PrevInAEL,e.NextInSEL=e.NextInAEL,e.Curr.X=g.Clipper.TopX(e,c),e=e.NextInAEL;for(var h=!0;h&&null!==this.m_SortedEdges;){h=
!1;for(e=this.m_SortedEdges;null!==e.NextInSEL;){var q=e.NextInSEL,r=new g.IntPoint;e.Curr.X>q.Curr.X?(r={Value:r},h=this.IntersectPoint(e,q,r),r=r.Value,!h&&e.Curr.X>q.Curr.X+1&&g.Error("Intersection error"),r.Y>b&&(r.Y=b,Math.abs(e.Dx)>Math.abs(q.Dx)?r.X=g.Clipper.TopX(q,b):r.X=g.Clipper.TopX(e,b)),h=new g.IntersectNode,h.Edge1=e,h.Edge2=q,h.Pt.X=r.X,h.Pt.Y=r.Y,this.m_IntersectList.push(h),this.SwapPositionsInSEL(e,q),h=!0):e=q}if(null!==e.PrevInSEL)e.PrevInSEL.NextInSEL=null;else break}this.m_SortedEdges=
null}};g.Clipper.prototype.EdgesAdjacent=function(b){return b.Edge1.NextInSEL==b.Edge2||b.Edge1.PrevInSEL==b.Edge2};g.Clipper.IntersectNodeSort=function(b,c){return c.Pt.Y-b.Pt.Y};g.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer);this.CopyAELToSEL();for(var b=this.m_IntersectList.length,c=0;c<b;c++){if(!this.EdgesAdjacent(this.m_IntersectList[c])){for(var e=c+1;e<b&&!this.EdgesAdjacent(this.m_IntersectList[e]);)e++;if(e==b)return!1;var h=
this.m_IntersectList[c];this.m_IntersectList[c]=this.m_IntersectList[e];this.m_IntersectList[e]=h}this.SwapPositionsInSEL(this.m_IntersectList[c].Edge1,this.m_IntersectList[c].Edge2)}return!0};g.Clipper.prototype.ProcessIntersectList=function(){for(var b=0,c=this.m_IntersectList.length;b<c;b++){var e=this.m_IntersectList[b];this.IntersectEdges(e.Edge1,e.Edge2,e.Pt,!0);this.SwapPositionsInAEL(e.Edge1,e.Edge2)}this.m_IntersectList.length=0};Ua=function(b){return 0>b?Math.ceil(b-.5):Math.round(b)};Ba=
function(b){return 0>b?Math.ceil(b-.5):Math.floor(b+.5)};Ka=function(b){return 0>b?-Math.round(Math.abs(b)):Math.round(b)};Va=function(b){if(0>b)return b-=.5,-2147483648>b?Math.ceil(b):b|0;b+=.5;return 2147483647<b?Math.floor(b):b|0};g.Clipper.Round=R?Ua:mb?Ka:$a?Va:Ba;g.Clipper.TopX=function(b,c){return c==b.Top.Y?b.Top.X:b.Bot.X+g.Clipper.Round(b.Dx*(c-b.Bot.Y))};g.Clipper.prototype.IntersectPoint=function(b,c,e){e.Value=new g.IntPoint;var h,q;if(g.ClipperBase.SlopesEqual(b,c,this.m_UseFullRange)||
b.Dx==c.Dx)return c.Bot.Y>b.Bot.Y?(e.Value.X=c.Bot.X,e.Value.Y=c.Bot.Y):(e.Value.X=b.Bot.X,e.Value.Y=b.Bot.Y),!1;if(0===b.Delta.X)e.Value.X=b.Bot.X,g.ClipperBase.IsHorizontal(c)?e.Value.Y=c.Bot.Y:(q=c.Bot.Y-c.Bot.X/c.Dx,e.Value.Y=g.Clipper.Round(e.Value.X/c.Dx+q));else if(0===c.Delta.X)e.Value.X=c.Bot.X,g.ClipperBase.IsHorizontal(b)?e.Value.Y=b.Bot.Y:(h=b.Bot.Y-b.Bot.X/b.Dx,e.Value.Y=g.Clipper.Round(e.Value.X/b.Dx+h));else{h=b.Bot.X-b.Bot.Y*b.Dx;q=c.Bot.X-c.Bot.Y*c.Dx;var r=(q-h)/(b.Dx-c.Dx);e.Value.Y=
g.Clipper.Round(r);Math.abs(b.Dx)<Math.abs(c.Dx)?e.Value.X=g.Clipper.Round(b.Dx*r+h):e.Value.X=g.Clipper.Round(c.Dx*r+q)}if(e.Value.Y<b.Top.Y||e.Value.Y<c.Top.Y){if(b.Top.Y>c.Top.Y)return e.Value.Y=b.Top.Y,e.Value.X=g.Clipper.TopX(c,b.Top.Y),e.Value.X<b.Top.X;e.Value.Y=c.Top.Y;Math.abs(b.Dx)<Math.abs(c.Dx)?e.Value.X=g.Clipper.TopX(b,e.Value.Y):e.Value.X=g.Clipper.TopX(c,e.Value.Y)}return!0};g.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(b){for(var c=this.m_ActiveEdges;null!==c;){var e=this.IsMaxima(c,
b);e&&(e=this.GetMaximaPair(c),e=null===e||!g.ClipperBase.IsHorizontal(e));if(e){var h=c.PrevInAEL;this.DoMaxima(c);c=null===h?this.m_ActiveEdges:h.NextInAEL}else this.IsIntermediate(c,b)&&g.ClipperBase.IsHorizontal(c.NextInLML)?(function(){c={Value:c};var b=this.UpdateEdgeIntoAEL(c);c=c.Value;return b}.call(this),0<=c.OutIdx&&this.AddOutPt(c,c.Bot),this.AddEdgeToSEL(c)):(c.Curr.X=g.Clipper.TopX(c,b),c.Curr.Y=b),this.StrictlySimple&&(h=c.PrevInAEL,0<=c.OutIdx&&0!==c.WindDelta&&null!==h&&0<=h.OutIdx&&
h.Curr.X==c.Curr.X&&0!==h.WindDelta&&(e=this.AddOutPt(h,c.Curr),h=this.AddOutPt(c,c.Curr),this.AddJoin(e,h,c.Curr))),c=c.NextInAEL}this.ProcessHorizontals(!0);for(c=this.m_ActiveEdges;null!==c;){if(this.IsIntermediate(c,b)){e=null;0<=c.OutIdx&&(e=this.AddOutPt(c,c.Top));(function(){c={Value:c};var b=this.UpdateEdgeIntoAEL(c);c=c.Value;return b}).call(this);var h=c.PrevInAEL,q=c.NextInAEL;null!==h&&h.Curr.X==c.Bot.X&&h.Curr.Y==c.Bot.Y&&null!==e&&0<=h.OutIdx&&h.Curr.Y>h.Top.Y&&g.ClipperBase.SlopesEqual(c,
h,this.m_UseFullRange)&&0!==c.WindDelta&&0!==h.WindDelta?(h=this.AddOutPt(h,c.Bot),this.AddJoin(e,h,c.Top)):null!==q&&q.Curr.X==c.Bot.X&&q.Curr.Y==c.Bot.Y&&null!==e&&0<=q.OutIdx&&q.Curr.Y>q.Top.Y&&g.ClipperBase.SlopesEqual(c,q,this.m_UseFullRange)&&0!==c.WindDelta&&0!==q.WindDelta&&(h=this.AddOutPt(q,c.Bot),this.AddJoin(e,h,c.Top))}c=c.NextInAEL}};g.Clipper.prototype.DoMaxima=function(b){var c=this.GetMaximaPair(b);if(null===c)0<=b.OutIdx&&this.AddOutPt(b,b.Top),this.DeleteFromAEL(b);else{for(var e=
b.NextInAEL;null!==e&&e!=c;)this.IntersectEdges(b,e,b.Top,!0),this.SwapPositionsInAEL(b,e),e=b.NextInAEL;-1==b.OutIdx&&-1==c.OutIdx?(this.DeleteFromAEL(b),this.DeleteFromAEL(c)):0<=b.OutIdx&&0<=c.OutIdx?this.IntersectEdges(b,c,b.Top,!1):0===b.WindDelta?(0<=b.OutIdx&&(this.AddOutPt(b,b.Top),b.OutIdx=-1),this.DeleteFromAEL(b),0<=c.OutIdx&&(this.AddOutPt(c,b.Top),c.OutIdx=-1),this.DeleteFromAEL(c)):g.Error("DoMaxima error")}};g.Clipper.ReversePaths=function(b){for(var c=0,e=b.length;c<e;c++)b[c].reverse()};
g.Clipper.Orientation=function(b){return 0<=g.Clipper.Area(b)};g.Clipper.prototype.PointCount=function(b){if(null===b)return 0;var c=0,e=b;do c++,e=e.Next;while(e!=b);return c};g.Clipper.prototype.BuildResult=function(b){g.Clear(b);for(var c=0,e=this.m_PolyOuts.length;c<e;c++){var h=this.m_PolyOuts[c];if(null!==h.Pts){var h=h.Pts.Prev,q=this.PointCount(h);if(!(2>q)){for(var r=Array(q),m=0;m<q;m++)r[m]=h.Pt,h=h.Prev;b.push(r)}}}};g.Clipper.prototype.BuildResult2=function(b){b.Clear();for(var c=0,e=
this.m_PolyOuts.length;c<e;c++){var h=this.m_PolyOuts[c],q=this.PointCount(h.Pts);if(!(h.IsOpen&&2>q||!h.IsOpen&&3>q)){this.FixHoleLinkage(h);var r=new g.PolyNode;b.m_AllPolys.push(r);h.PolyNode=r;r.m_polygon.length=q;for(var h=h.Pts.Prev,m=0;m<q;m++)r.m_polygon[m]=h.Pt,h=h.Prev}}c=0;for(e=this.m_PolyOuts.length;c<e;c++)h=this.m_PolyOuts[c],null!==h.PolyNode&&(h.IsOpen?(h.PolyNode.IsOpen=!0,b.AddChild(h.PolyNode)):null!==h.FirstLeft&&null!=h.FirstLeft.PolyNode?h.FirstLeft.PolyNode.AddChild(h.PolyNode):
b.AddChild(h.PolyNode))};g.Clipper.prototype.FixupOutPolygon=function(b){var c=null;b.BottomPt=null;for(var e=b.Pts;;){if(e.Prev==e||e.Prev==e.Next){this.DisposeOutPts(e);b.Pts=null;return}if(g.IntPoint.op_Equality(e.Pt,e.Next.Pt)||g.IntPoint.op_Equality(e.Pt,e.Prev.Pt)||g.ClipperBase.SlopesEqual(e.Prev.Pt,e.Pt,e.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(e.Prev.Pt,e.Pt,e.Next.Pt)))c=null,e.Prev.Next=e.Next,e=e.Next.Prev=e.Prev;else if(e==c)break;else null===
c&&(c=e),e=e.Next}b.Pts=e};g.Clipper.prototype.DupOutPt=function(b,c){var e=new g.OutPt;e.Pt.X=b.Pt.X;e.Pt.Y=b.Pt.Y;e.Idx=b.Idx;c?(e.Next=b.Next,e.Prev=b,b.Next.Prev=e,b.Next=e):(e.Prev=b.Prev,e.Next=b,b.Prev.Next=e,b.Prev=e);return e};g.Clipper.prototype.GetOverlap=function(b,c,e,h,g,r){b<c?e<h?(g.Value=Math.max(b,e),r.Value=Math.min(c,h)):(g.Value=Math.max(b,h),r.Value=Math.min(c,e)):e<h?(g.Value=Math.max(c,e),r.Value=Math.min(b,h)):(g.Value=Math.max(c,h),r.Value=Math.min(b,e));return g.Value<r.Value};
g.Clipper.prototype.JoinHorz=function(b,c,e,h,q,r){var m=b.Pt.X>c.Pt.X?g.Direction.dRightToLeft:g.Direction.dLeftToRight;h=e.Pt.X>h.Pt.X?g.Direction.dRightToLeft:g.Direction.dLeftToRight;if(m==h)return!1;if(m==g.Direction.dLeftToRight){for(;b.Next.Pt.X<=q.X&&b.Next.Pt.X>=b.Pt.X&&b.Next.Pt.Y==q.Y;)b=b.Next;r&&b.Pt.X!=q.X&&(b=b.Next);c=this.DupOutPt(b,!r);g.IntPoint.op_Inequality(c.Pt,q)&&(b=c,b.Pt.X=q.X,b.Pt.Y=q.Y,c=this.DupOutPt(b,!r))}else{for(;b.Next.Pt.X>=q.X&&b.Next.Pt.X<=b.Pt.X&&b.Next.Pt.Y==
q.Y;)b=b.Next;r||b.Pt.X==q.X||(b=b.Next);c=this.DupOutPt(b,r);g.IntPoint.op_Inequality(c.Pt,q)&&(b=c,b.Pt.X=q.X,b.Pt.Y=q.Y,c=this.DupOutPt(b,r))}if(h==g.Direction.dLeftToRight){for(;e.Next.Pt.X<=q.X&&e.Next.Pt.X>=e.Pt.X&&e.Next.Pt.Y==q.Y;)e=e.Next;r&&e.Pt.X!=q.X&&(e=e.Next);h=this.DupOutPt(e,!r);g.IntPoint.op_Inequality(h.Pt,q)&&(e=h,e.Pt.X=q.X,e.Pt.Y=q.Y,h=this.DupOutPt(e,!r))}else{for(;e.Next.Pt.X>=q.X&&e.Next.Pt.X<=e.Pt.X&&e.Next.Pt.Y==q.Y;)e=e.Next;r||e.Pt.X==q.X||(e=e.Next);h=this.DupOutPt(e,
r);g.IntPoint.op_Inequality(h.Pt,q)&&(e=h,e.Pt.X=q.X,e.Pt.Y=q.Y,h=this.DupOutPt(e,r))}m==g.Direction.dLeftToRight==r?(b.Prev=e,e.Next=b,c.Next=h,h.Prev=c):(b.Next=e,e.Prev=b,c.Prev=h,h.Next=c);return!0};g.Clipper.prototype.JoinPoints=function(b,c,e){var h=b.OutPt1,q=new g.OutPt,r=b.OutPt2,m=new g.OutPt;if((m=b.OutPt1.Pt.Y==b.OffPt.Y)&&g.IntPoint.op_Equality(b.OffPt,b.OutPt1.Pt)&&g.IntPoint.op_Equality(b.OffPt,b.OutPt2.Pt)){for(q=b.OutPt1.Next;q!=h&&g.IntPoint.op_Equality(q.Pt,b.OffPt);)q=q.Next;q=
q.Pt.Y>b.OffPt.Y;for(m=b.OutPt2.Next;m!=r&&g.IntPoint.op_Equality(m.Pt,b.OffPt);)m=m.Next;if(q==m.Pt.Y>b.OffPt.Y)return!1;q?(q=this.DupOutPt(h,!1),m=this.DupOutPt(r,!0),h.Prev=r,r.Next=h,q.Next=m,m.Prev=q):(q=this.DupOutPt(h,!0),m=this.DupOutPt(r,!1),h.Next=r,r.Prev=h,q.Prev=m,m.Next=q);b.OutPt1=h;b.OutPt2=q;return!0}if(m){for(q=h;h.Prev.Pt.Y==h.Pt.Y&&h.Prev!=q&&h.Prev!=r;)h=h.Prev;for(;q.Next.Pt.Y==q.Pt.Y&&q.Next!=h&&q.Next!=r;)q=q.Next;if(q.Next==h||q.Next==r)return!1;for(m=r;r.Prev.Pt.Y==r.Pt.Y&&
r.Prev!=m&&r.Prev!=q;)r=r.Prev;for(;m.Next.Pt.Y==m.Pt.Y&&m.Next!=r&&m.Next!=h;)m=m.Next;if(m.Next==r||m.Next==h)return!1;var p,z;p={Value:p};z={Value:z};c=this.GetOverlap(h.Pt.X,q.Pt.X,r.Pt.X,m.Pt.X,p,z);p=p.Value;z=z.Value;if(!c)return!1;c=new g.IntPoint;h.Pt.X>=p&&h.Pt.X<=z?(c.X=h.Pt.X,c.Y=h.Pt.Y,e=h.Pt.X>q.Pt.X):r.Pt.X>=p&&r.Pt.X<=z?(c.X=r.Pt.X,c.Y=r.Pt.Y,e=r.Pt.X>m.Pt.X):q.Pt.X>=p&&q.Pt.X<=z?(c.X=q.Pt.X,c.Y=q.Pt.Y,e=q.Pt.X>h.Pt.X):(c.X=m.Pt.X,c.Y=m.Pt.Y,e=m.Pt.X>r.Pt.X);b.OutPt1=h;b.OutPt2=r;
return this.JoinHorz(h,q,r,m,c,e)}for(q=h.Next;g.IntPoint.op_Equality(q.Pt,h.Pt)&&q!=h;)q=q.Next;if(p=q.Pt.Y>h.Pt.Y||!g.ClipperBase.SlopesEqual(h.Pt,q.Pt,b.OffPt,this.m_UseFullRange)){for(q=h.Prev;g.IntPoint.op_Equality(q.Pt,h.Pt)&&q!=h;)q=q.Prev;if(q.Pt.Y>h.Pt.Y||!g.ClipperBase.SlopesEqual(h.Pt,q.Pt,b.OffPt,this.m_UseFullRange))return!1}for(m=r.Next;g.IntPoint.op_Equality(m.Pt,r.Pt)&&m!=r;)m=m.Next;if(z=m.Pt.Y>r.Pt.Y||!g.ClipperBase.SlopesEqual(r.Pt,m.Pt,b.OffPt,this.m_UseFullRange)){for(m=r.Prev;g.IntPoint.op_Equality(m.Pt,
r.Pt)&&m!=r;)m=m.Prev;if(m.Pt.Y>r.Pt.Y||!g.ClipperBase.SlopesEqual(r.Pt,m.Pt,b.OffPt,this.m_UseFullRange))return!1}if(q==h||m==r||q==m||c==e&&p==z)return!1;p?(q=this.DupOutPt(h,!1),m=this.DupOutPt(r,!0),h.Prev=r,r.Next=h,q.Next=m,m.Prev=q):(q=this.DupOutPt(h,!0),m=this.DupOutPt(r,!1),h.Next=r,r.Prev=h,q.Prev=m,m.Next=q);b.OutPt1=h;b.OutPt2=q;return!0};g.Clipper.GetBounds=function(b){for(var c=0,e=b.length;c<e&&0==b[c].length;)c++;if(c==e)return new g.IntRect(0,0,0,0);var h=new g.IntRect;h.left=b[c][0].X;
h.right=h.left;h.top=b[c][0].Y;for(h.bottom=h.top;c<e;c++)for(var q=0,r=b[c].length;q<r;q++)b[c][q].X<h.left?h.left=b[c][q].X:b[c][q].X>h.right&&(h.right=b[c][q].X),b[c][q].Y<h.top?h.top=b[c][q].Y:b[c][q].Y>h.bottom&&(h.bottom=b[c][q].Y);return h};g.Clipper.prototype.GetBounds2=function(b){var c=b,e=new g.IntRect;e.left=b.Pt.X;e.right=b.Pt.X;e.top=b.Pt.Y;e.bottom=b.Pt.Y;for(b=b.Next;b!=c;)b.Pt.X<e.left&&(e.left=b.Pt.X),b.Pt.X>e.right&&(e.right=b.Pt.X),b.Pt.Y<e.top&&(e.top=b.Pt.Y),b.Pt.Y>e.bottom&&
(e.bottom=b.Pt.Y),b=b.Next;return e};g.ClipperBase.prototype.PointInPolygon=g.Clipper.prototype.PointInPolygon=function(){var b=arguments,c=b.length;if(2==c){for(var c=b[0],e=b[1],b=0,h=e;;){var g=e.Pt.X,r=e.Pt.Y,m=e.Next.Pt.X,G=e.Next.Pt.Y;if(G==c.Y&&(m==c.X||r==c.Y&&m>c.X==g<c.X))return-1;if(r<c.Y!=G<c.Y)if(g>=c.X)if(m>c.X)b=1-b;else{g=(g-c.X)*(G-c.Y)-(m-c.X)*(r-c.Y);if(0==g)return-1;0<g==G>r&&(b=1-b)}else if(m>c.X){g=(g-c.X)*(G-c.Y)-(m-c.X)*(r-c.Y);if(0==g)return-1;0<g==G>r&&(b=1-b)}e=e.Next;if(h==
e)break}return b}if(3==c){c=b[0];e=b[1];h=b[2];r=e;b=!1;if(h){do r.Pt.Y>c.Y!=r.Prev.Pt.Y>c.Y&&p.op_LessThan(new p(c.X-r.Pt.X),p.op_Division(p.Int128Mul(r.Prev.Pt.X-r.Pt.X,c.Y-r.Pt.Y),new p(r.Prev.Pt.Y-r.Pt.Y)))&&(b=!b),r=r.Next;while(r!=e)}else{do r.Pt.Y>c.Y!=r.Prev.Pt.Y>c.Y&&c.X-r.Pt.X<(r.Prev.Pt.X-r.Pt.X)*(c.Y-r.Pt.Y)/(r.Prev.Pt.Y-r.Pt.Y)&&(b=!b),r=r.Next;while(r!=e)}return b}};g.Clipper.prototype.Poly2ContainsPoly1=function(b,c){var e=b;do{var h=this.PointInPolygon(e.Pt,c);if(0<=h)return 0!=h;
e=e.Next}while(e!=b);return!0};g.Clipper.prototype.FixupFirstLefts1=function(b,c){for(var e=0,h=this.m_PolyOuts.length;e<h;e++){var g=this.m_PolyOuts[e];null!==g.Pts&&g.FirstLeft==b&&this.Poly2ContainsPoly1(g.Pts,c.Pts)&&(g.FirstLeft=c)}};g.Clipper.prototype.FixupFirstLefts2=function(b,c){for(var e=0,h=this.m_PolyOuts,g=h.length,r=h[e];e<g;e++,r=h[e])r.FirstLeft==b&&(r.FirstLeft=c)};g.Clipper.ParseFirstLeft=function(b){for(;null!=b&&null==b.Pts;)b=b.FirstLeft;return b};g.Clipper.prototype.JoinCommonEdges=
function(){for(var b=0,c=this.m_Joins.length;b<c;b++){var e=this.m_Joins[b],h=this.GetOutRec(e.OutPt1.Idx),q=this.GetOutRec(e.OutPt2.Idx);if(null!=h.Pts&&null!=q.Pts){var r;r=h==q?h:this.Param1RightOfParam2(h,q)?q:this.Param1RightOfParam2(q,h)?h:this.GetLowermostRec(h,q);if(this.JoinPoints(e,h,q))if(h==q){h.Pts=e.OutPt1;h.BottomPt=null;q=this.CreateOutRec();q.Pts=e.OutPt2;this.UpdateOutPtIdxs(q);if(this.m_UsingPolyTree){r=0;for(var m=this.m_PolyOuts.length;r<m-1;r++){var p=this.m_PolyOuts[r];null!=
p.Pts&&g.Clipper.ParseFirstLeft(p.FirstLeft)==h&&p.IsHole!=h.IsHole&&this.Poly2ContainsPoly1(p.Pts,e.OutPt2)&&(p.FirstLeft=q)}}this.Poly2ContainsPoly1(q.Pts,h.Pts)?(q.IsHole=!h.IsHole,q.FirstLeft=h,this.m_UsingPolyTree&&this.FixupFirstLefts2(q,h),(q.IsHole^this.ReverseSolution)==0<this.Area(q)&&this.ReversePolyPtLinks(q.Pts)):this.Poly2ContainsPoly1(h.Pts,q.Pts)?(q.IsHole=h.IsHole,h.IsHole=!q.IsHole,q.FirstLeft=h.FirstLeft,h.FirstLeft=q,this.m_UsingPolyTree&&this.FixupFirstLefts2(h,q),(h.IsHole^this.ReverseSolution)==
0<this.Area(h)&&this.ReversePolyPtLinks(h.Pts)):(q.IsHole=h.IsHole,q.FirstLeft=h.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(h,q))}else q.Pts=null,q.BottomPt=null,q.Idx=h.Idx,h.IsHole=r.IsHole,r==q&&(h.FirstLeft=q.FirstLeft),q.FirstLeft=h,this.m_UsingPolyTree&&this.FixupFirstLefts2(q,h)}}};g.Clipper.prototype.UpdateOutPtIdxs=function(b){var c=b.Pts;do c.Idx=b.Idx,c=c.Prev;while(c!=b.Pts)};g.Clipper.prototype.DoSimplePolygons=function(){for(var b=0;b<this.m_PolyOuts.length;){var c=this.m_PolyOuts[b++],
e=c.Pts;if(null!==e){do{for(var h=e.Next;h!=c.Pts;){if(g.IntPoint.op_Equality(e.Pt,h.Pt)&&h.Next!=e&&h.Prev!=e){var q=e.Prev,r=h.Prev;e.Prev=r;r.Next=e;h.Prev=q;q.Next=h;c.Pts=e;q=this.CreateOutRec();q.Pts=h;this.UpdateOutPtIdxs(q);this.Poly2ContainsPoly1(q.Pts,c.Pts)?(q.IsHole=!c.IsHole,q.FirstLeft=c):this.Poly2ContainsPoly1(c.Pts,q.Pts)?(q.IsHole=c.IsHole,c.IsHole=!q.IsHole,q.FirstLeft=c.FirstLeft,c.FirstLeft=q):(q.IsHole=c.IsHole,q.FirstLeft=c.FirstLeft);h=e}h=h.Next}e=e.Next}while(e!=c.Pts)}}};
g.Clipper.Area=function(b){var c=b.length;if(3>c)return 0;for(var e=0,h=0,g=c-1;h<c;++h)e+=(b[g].X+b[h].X)*(b[g].Y-b[h].Y),g=h;return.5*-e};g.Clipper.prototype.Area=function(b){var c=b.Pts;if(null==c)return 0;var e=0;do e+=(c.Prev.Pt.X+c.Pt.X)*(c.Prev.Pt.Y-c.Pt.Y),c=c.Next;while(c!=b.Pts);return.5*e};g.Clipper.SimplifyPolygon=function(b,c){var e=[],h=new g.Clipper(0);h.StrictlySimple=!0;h.AddPath(b,g.PolyType.ptSubject,!0);h.Execute(g.ClipType.ctUnion,e,c,c);return e};g.Clipper.SimplifyPolygons=function(b,
c){"undefined"==typeof c&&(c=g.PolyFillType.pftEvenOdd);var e=[],h=new g.Clipper(0);h.StrictlySimple=!0;h.AddPaths(b,g.PolyType.ptSubject,!0);h.Execute(g.ClipType.ctUnion,e,c,c);return e};g.Clipper.DistanceSqrd=function(b,c){var e=b.X-c.X,h=b.Y-c.Y;return e*e+h*h};g.Clipper.DistanceFromLineSqrd=function(b,c,e){var h=c.Y-e.Y;e=e.X-c.X;c=h*c.X+e*c.Y;c=h*b.X+e*b.Y-c;return c*c/(h*h+e*e)};g.Clipper.SlopesNearCollinear=function(b,c,e,h){return g.Clipper.DistanceFromLineSqrd(c,b,e)<h};g.Clipper.PointsAreClose=
function(b,c,e){var h=b.X-c.X;b=b.Y-c.Y;return h*h+b*b<=e};g.Clipper.ExcludeOp=function(b){var c=b.Prev;c.Next=b.Next;b.Next.Prev=c;c.Idx=0;return c};g.Clipper.CleanPolygon=function(b,c){"undefined"==typeof c&&(c=1.415);var e=b.length;if(0==e)return[];for(var h=Array(e),q=0;q<e;++q)h[q]=new g.OutPt;for(q=0;q<e;++q)h[q].Pt=b[q],h[q].Next=h[(q+1)%e],h[q].Next.Prev=h[q],h[q].Idx=0;q=c*c;for(h=h[0];0==h.Idx&&h.Next!=h.Prev;)g.Clipper.PointsAreClose(h.Pt,h.Prev.Pt,q)?(h=g.Clipper.ExcludeOp(h),e--):g.Clipper.PointsAreClose(h.Prev.Pt,
h.Next.Pt,q)?(g.Clipper.ExcludeOp(h.Next),h=g.Clipper.ExcludeOp(h),e-=2):g.Clipper.SlopesNearCollinear(h.Prev.Pt,h.Pt,h.Next.Pt,q)?(h=g.Clipper.ExcludeOp(h),e--):(h.Idx=1,h=h.Next);3>e&&(e=0);for(var r=Array(e),q=0;q<e;++q)r[q]=new g.IntPoint(h.Pt),h=h.Next;return r};g.Clipper.CleanPolygons=function(b,c){for(var e=Array(b.length),h=0,q=b.length;h<q;h++)e[h]=g.Clipper.CleanPolygon(b[h],c);return e};g.Clipper.Minkowski=function(b,c,e,h){var q=h?1:0,r=b.length,m=c.length;h=[];if(e)for(e=0;e<m;e++){for(var p=
Array(r),z=0,G=b.length,E=b[z];z<G;z++,E=b[z])p[z]=new g.IntPoint(c[e].X+E.X,c[e].Y+E.Y);h.push(p)}else for(e=0;e<m;e++){p=Array(r);z=0;G=b.length;for(E=b[z];z<G;z++,E=b[z])p[z]=new g.IntPoint(c[e].X-E.X,c[e].Y-E.Y);h.push(p)}b=[];for(e=0;e<=m-2+q;e++)for(z=0;z<=r-1;z++)c=[],c.push(h[e%m][z%r]),c.push(h[(e+1)%m][z%r]),c.push(h[(e+1)%m][(z+1)%r]),c.push(h[e%m][(z+1)%r]),g.Clipper.Orientation(c)||c.reverse(),b.push(c);q=new g.Clipper(0);q.AddPaths(b,g.PolyType.ptSubject,!0);q.Execute(g.ClipType.ctUnion,
h,g.PolyFillType.pftNonZero,g.PolyFillType.pftNonZero);return h};g.Clipper.MinkowskiSum=function(b,c,e){return g.Clipper.Minkowski(b,c,!0,e)};g.Clipper.MinkowskiDiff=function(b,c,e){return g.Clipper.Minkowski(b,c,!1,e)};g.Clipper.PolyTreeToPaths=function(b){var c=[];g.Clipper.AddPolyNodeToPaths(b,g.Clipper.NodeType.ntAny,c);return c};g.Clipper.AddPolyNodeToPaths=function(b,c,e){var h=!0;switch(c){case g.Clipper.NodeType.ntOpen:return;case g.Clipper.NodeType.ntClosed:h=!b.IsOpen}0<b.m_polygon.length&&
h&&e.push(b.m_polygon);h=0;b=b.Childs();for(var q=b.length,m=b[h];h<q;h++,m=b[h])g.Clipper.AddPolyNodeToPaths(m,c,e)};g.Clipper.OpenPathsFromPolyTree=function(b){for(var c=new g.Paths,e=0,h=b.ChildCount();e<h;e++)b.Childs()[e].IsOpen&&c.push(b.Childs()[e].m_polygon);return c};g.Clipper.ClosedPathsFromPolyTree=function(b){var c=new g.Paths;g.Clipper.AddPolyNodeToPaths(b,g.Clipper.NodeType.ntClosed,c);return c};fb(g.Clipper,g.ClipperBase);g.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2};g.ClipperOffset=
function(b,c){"undefined"==typeof b&&(b=2);"undefined"==typeof c&&(c=g.ClipperOffset.def_arc_tolerance);this.m_destPolys=new g.Paths;this.m_srcPoly=new g.Path;this.m_destPoly=new g.Path;this.m_normals=[];this.m_StepsPerRad=this.m_miterLim=this.m_cos=this.m_sin=this.m_sinA=this.m_delta=0;this.m_lowest=new g.IntPoint;this.m_polyNodes=new g.PolyNode;this.MiterLimit=b;this.ArcTolerance=c;this.m_lowest.X=-1};g.ClipperOffset.two_pi=6.28318530717959;g.ClipperOffset.def_arc_tolerance=.25;g.ClipperOffset.prototype.Clear=
function(){g.Clear(this.m_polyNodes.Childs());this.m_lowest.X=-1};g.ClipperOffset.Round=g.Clipper.Round;g.ClipperOffset.prototype.AddPath=function(b,c,e){var h=b.length-1;if(!(0>h)){var q=new g.PolyNode;q.m_jointype=c;q.m_endtype=e;if(e==g.EndType.etClosedLine||e==g.EndType.etClosedPolygon)for(;0<h&&g.IntPoint.op_Equality(b[0],b[h]);)h--;q.m_polygon.push(b[0]);var m=0;c=0;for(var p=1;p<=h;p++)g.IntPoint.op_Inequality(q.m_polygon[m],b[p])&&(m++,q.m_polygon.push(b[p]),b[p].Y>q.m_polygon[c].Y||b[p].Y==
q.m_polygon[c].Y&&b[p].X<q.m_polygon[c].X)&&(c=m);if(!(e==g.EndType.etClosedPolygon&&2>m||e!=g.EndType.etClosedPolygon&&0>m)&&(this.m_polyNodes.AddChild(q),e==g.EndType.etClosedPolygon))if(0>this.m_lowest.X)this.m_lowest=new g.IntPoint(0,c);else if(b=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],q.m_polygon[c].Y>b.Y||q.m_polygon[c].Y==b.Y&&q.m_polygon[c].X<b.X)this.m_lowest=new g.IntPoint(this.m_polyNodes.ChildCount()-1,c)}};g.ClipperOffset.prototype.AddPaths=function(b,c,
e){for(var h=0,g=b.length;h<g;h++)this.AddPath(b[h],c,e)};g.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!g.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var b=0;b<this.m_polyNodes.ChildCount();b++){var c=this.m_polyNodes.Childs()[b];(c.m_endtype==g.EndType.etClosedPolygon||c.m_endtype==g.EndType.etClosedLine&&g.Clipper.Orientation(c.m_polygon))&&c.m_polygon.reverse()}else for(b=0;b<this.m_polyNodes.ChildCount();b++)c=this.m_polyNodes.Childs()[b],
c.m_endtype!=g.EndType.etClosedLine||g.Clipper.Orientation(c.m_polygon)||c.m_polygon.reverse()};g.ClipperOffset.GetUnitNormal=function(b,c){var e=c.X-b.X,h=c.Y-b.Y;if(0==e&&0==h)return new g.DoublePoint(0,0);var q=1/Math.sqrt(e*e+h*h);return new g.DoublePoint(h*q,-(e*q))};g.ClipperOffset.prototype.DoOffset=function(b){this.m_destPolys=[];this.m_delta=b;if(g.ClipperBase.near_zero(b))for(var c=0;c<this.m_polyNodes.ChildCount();c++){var e=this.m_polyNodes.Childs()[c];e.m_endtype==g.EndType.etClosedPolygon&&
this.m_destPolys.push(e.m_polygon)}else{this.m_miterLim=2<this.MiterLimit?2/(this.MiterLimit*this.MiterLimit):.5;var c=0>=this.ArcTolerance?g.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(b)*g.ClipperOffset.def_arc_tolerance?Math.abs(b)*g.ClipperOffset.def_arc_tolerance:this.ArcTolerance,h=3.14159265358979/Math.acos(1-c/Math.abs(b));this.m_sin=Math.sin(g.ClipperOffset.two_pi/h);this.m_cos=Math.cos(g.ClipperOffset.two_pi/h);this.m_StepsPerRad=h/g.ClipperOffset.two_pi;0>b&&(this.m_sin=
-this.m_sin);for(c=0;c<this.m_polyNodes.ChildCount();c++){e=this.m_polyNodes.Childs()[c];this.m_srcPoly=e.m_polygon;var q=this.m_srcPoly.length;if(!(0==q||0>=b&&(3>q||e.m_endtype!=g.EndType.etClosedPolygon))){this.m_destPoly=[];if(1==q)if(e.m_jointype==g.JoinType.jtRound)for(var e=1,q=0,m=1;m<=h;m++){this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[0].X+e*b),g.ClipperOffset.Round(this.m_srcPoly[0].Y+q*b)));var p=e,e=e*this.m_cos-this.m_sin*q,q=p*this.m_sin+q*this.m_cos}else for(q=
e=-1,m=0;4>m;++m)this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[0].X+e*b),g.ClipperOffset.Round(this.m_srcPoly[0].Y+q*b))),0>e?e=1:0>q?q=1:e=-1;else{for(m=this.m_normals.length=0;m<q-1;m++)this.m_normals.push(g.ClipperOffset.GetUnitNormal(this.m_srcPoly[m],this.m_srcPoly[m+1]));e.m_endtype==g.EndType.etClosedLine||e.m_endtype==g.EndType.etClosedPolygon?this.m_normals.push(g.ClipperOffset.GetUnitNormal(this.m_srcPoly[q-1],this.m_srcPoly[0])):this.m_normals.push(new g.DoublePoint(this.m_normals[q-
2]));if(e.m_endtype==g.EndType.etClosedPolygon)for(p=q-1,m=0;m<q;m++)p=this.OffsetPoint(m,p,e.m_jointype);else if(e.m_endtype==g.EndType.etClosedLine){p=q-1;for(m=0;m<q;m++)p=this.OffsetPoint(m,p,e.m_jointype);this.m_destPolys.push(this.m_destPoly);this.m_destPoly=[];p=this.m_normals[q-1];for(m=q-1;0<m;m--)this.m_normals[m]=new g.DoublePoint(-this.m_normals[m-1].X,-this.m_normals[m-1].Y);this.m_normals[0]=new g.DoublePoint(-p.X,-p.Y);p=0;for(m=q-1;0<=m;m--)p=this.OffsetPoint(m,p,e.m_jointype)}else{p=
0;for(m=1;m<q-1;++m)p=this.OffsetPoint(m,p,e.m_jointype);e.m_endtype==g.EndType.etOpenButt?(m=q-1,p=new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[m].X+this.m_normals[m].X*b),g.ClipperOffset.Round(this.m_srcPoly[m].Y+this.m_normals[m].Y*b)),this.m_destPoly.push(p),p=new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[m].X-this.m_normals[m].X*b),g.ClipperOffset.Round(this.m_srcPoly[m].Y-this.m_normals[m].Y*b)),this.m_destPoly.push(p)):(m=q-1,p=q-2,this.m_sinA=0,this.m_normals[m]=new g.DoublePoint(-this.m_normals[m].X,
-this.m_normals[m].Y),e.m_endtype==g.EndType.etOpenSquare?this.DoSquare(m,p):this.DoRound(m,p));for(m=q-1;0<m;m--)this.m_normals[m]=new g.DoublePoint(-this.m_normals[m-1].X,-this.m_normals[m-1].Y);this.m_normals[0]=new g.DoublePoint(-this.m_normals[1].X,-this.m_normals[1].Y);p=q-1;for(m=p-1;0<m;--m)p=this.OffsetPoint(m,p,e.m_jointype);e.m_endtype==g.EndType.etOpenButt?(p=new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*b),g.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*
b)),this.m_destPoly.push(p),p=new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*b),g.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*b)),this.m_destPoly.push(p)):(this.m_sinA=0,e.m_endtype==g.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1))}}this.m_destPolys.push(this.m_destPoly)}}}};g.ClipperOffset.prototype.Execute=function(){var b=arguments;if(b[0]instanceof g.PolyTree)if(c=b[0],e=b[1],c.Clear(),this.FixOrientations(),this.DoOffset(e),b=new g.Clipper(0),
b.AddPaths(this.m_destPolys,g.PolyType.ptSubject,!0),0<e)b.Execute(g.ClipType.ctUnion,c,g.PolyFillType.pftPositive,g.PolyFillType.pftPositive);else if(e=g.Clipper.GetBounds(this.m_destPolys),h=new g.Path,h.push(new g.IntPoint(e.left-10,e.bottom+10)),h.push(new g.IntPoint(e.right+10,e.bottom+10)),h.push(new g.IntPoint(e.right+10,e.top-10)),h.push(new g.IntPoint(e.left-10,e.top-10)),b.AddPath(h,g.PolyType.ptSubject,!0),b.ReverseSolution=!0,b.Execute(g.ClipType.ctUnion,c,g.PolyFillType.pftNegative,g.PolyFillType.pftNegative),
1==c.ChildCount()&&0<c.Childs()[0].ChildCount())for(b=c.Childs()[0],c.Childs()[0]=b.Childs()[0],e=1;e<b.ChildCount();e++)c.AddChild(b.Childs()[e]);else c.Clear();else{var c=b[0],e=b[1];g.Clear(c);this.FixOrientations();this.DoOffset(e);b=new g.Clipper(0);b.AddPaths(this.m_destPolys,g.PolyType.ptSubject,!0);if(0<e)b.Execute(g.ClipType.ctUnion,c,g.PolyFillType.pftPositive,g.PolyFillType.pftPositive);else{var e=g.Clipper.GetBounds(this.m_destPolys),h=new g.Path;h.push(new g.IntPoint(e.left-10,e.bottom+
10));h.push(new g.IntPoint(e.right+10,e.bottom+10));h.push(new g.IntPoint(e.right+10,e.top-10));h.push(new g.IntPoint(e.left-10,e.top-10));b.AddPath(h,g.PolyType.ptSubject,!0);b.ReverseSolution=!0;b.Execute(g.ClipType.ctUnion,c,g.PolyFillType.pftNegative,g.PolyFillType.pftNegative);0<c.length&&c.splice(0,1)}}};g.ClipperOffset.prototype.OffsetPoint=function(b,c,e){this.m_sinA=this.m_normals[c].X*this.m_normals[b].Y-this.m_normals[b].X*this.m_normals[c].Y;if(5E-5>this.m_sinA&&-5E-5<this.m_sinA)return c;
1<this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1);if(0>this.m_sinA*this.m_delta)this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[c].X*this.m_delta),g.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[c].Y*this.m_delta))),this.m_destPoly.push(new g.IntPoint(this.m_srcPoly[b])),this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[b].X*this.m_delta),g.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[b].Y*
this.m_delta)));else switch(e){case g.JoinType.jtMiter:e=1+(this.m_normals[b].X*this.m_normals[c].X+this.m_normals[b].Y*this.m_normals[c].Y);e>=this.m_miterLim?this.DoMiter(b,c,e):this.DoSquare(b,c);break;case g.JoinType.jtSquare:this.DoSquare(b,c);break;case g.JoinType.jtRound:this.DoRound(b,c)}return b};g.ClipperOffset.prototype.DoSquare=function(b,c){var e=Math.tan(Math.atan2(this.m_sinA,this.m_normals[c].X*this.m_normals[b].X+this.m_normals[c].Y*this.m_normals[b].Y)/4);this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+
this.m_delta*(this.m_normals[c].X-this.m_normals[c].Y*e)),g.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_delta*(this.m_normals[c].Y+this.m_normals[c].X*e))));this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_delta*(this.m_normals[b].X+this.m_normals[b].Y*e)),g.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_delta*(this.m_normals[b].Y-this.m_normals[b].X*e))))};g.ClipperOffset.prototype.DoMiter=function(b,c,e){e=this.m_delta/e;this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+
(this.m_normals[c].X+this.m_normals[b].X)*e),g.ClipperOffset.Round(this.m_srcPoly[b].Y+(this.m_normals[c].Y+this.m_normals[b].Y)*e)))};g.ClipperOffset.prototype.DoRound=function(b,c){for(var e=Math.atan2(this.m_sinA,this.m_normals[c].X*this.m_normals[b].X+this.m_normals[c].Y*this.m_normals[b].Y),e=g.Cast_Int32(g.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(e))),h=this.m_normals[c].X,m=this.m_normals[c].Y,r,p=0;p<e;++p)this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+
h*this.m_delta),g.ClipperOffset.Round(this.m_srcPoly[b].Y+m*this.m_delta))),r=h,h=h*this.m_cos-this.m_sin*m,m=r*this.m_sin+m*this.m_cos;this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[b].X*this.m_delta),g.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[b].Y*this.m_delta)))};g.Error=function(b){try{throw Error(b);}catch(c){alert(c.message)}};g.JS={};g.JS.AreaOfPolygon=function(b,c){c||(c=1);return g.Clipper.Area(b)/(c*c)};g.JS.AreaOfPolygons=function(b,
c){c||(c=1);for(var e=0,h=0;h<b.length;h++)e+=g.Clipper.Area(b[h]);return e/(c*c)};g.JS.BoundsOfPath=function(b,c){return g.JS.BoundsOfPaths([b],c)};g.JS.BoundsOfPaths=function(b,c){c||(c=1);var e=g.Clipper.GetBounds(b);e.left/=c;e.bottom/=c;e.right/=c;e.top/=c;return e};g.JS.Clean=function(b,c){if(!(b instanceof Array))return[];var e=b[0]instanceof Array;b=g.JS.Clone(b);if("number"!=typeof c||null===c)return g.Error("Delta is not a number in Clean()."),b;if(0===b.length||1==b.length&&0===b[0].length||
0>c)return b;e||(b=[b]);for(var h=b.length,m,r,p,G,z,E,O,H=[],P=0;P<h;P++)if(r=b[P],m=r.length,0!==m)if(3>m)p=r,H.push(p);else{p=r;G=c*c;z=r[0];for(O=E=1;O<m;O++)(r[O].X-z.X)*(r[O].X-z.X)+(r[O].Y-z.Y)*(r[O].Y-z.Y)<=G||(p[E]=r[O],z=r[O],E++);z=r[E-1];(r[0].X-z.X)*(r[0].X-z.X)+(r[0].Y-z.Y)*(r[0].Y-z.Y)<=G&&E--;E<m&&p.splice(E,m-E);p.length&&H.push(p)}!e&&H.length?H=H[0]:e||0!==H.length?e&&0===H.length&&(H=[[]]):H=[];return H};g.JS.Clone=function(b){if(!(b instanceof Array)||0===b.length)return[];if(1==
b.length&&0===b[0].length)return[[]];var c=b[0]instanceof Array;c||(b=[b]);var e=b.length,h,g,m,p,G=Array(e);for(g=0;g<e;g++){h=b[g].length;p=Array(h);for(m=0;m<h;m++)p[m]={X:b[g][m].X,Y:b[g][m].Y};G[g]=p}c||(G=G[0]);return G};g.JS.Lighten=function(b,c){if(!(b instanceof Array))return[];if("number"!=typeof c||null===c)return g.Error("Tolerance is not a number in Lighten()."),g.JS.Clone(b);if(0===b.length||1==b.length&&0===b[0].length||0>c)return g.JS.Clone(b);b[0]instanceof Array||(b=[b]);var e,h,
m,r,p,G,z,E,H,O,P,L,T,R,V,fa=b.length,lb=c*c,U=[];for(e=0;e<fa;e++)if(m=b[e],G=m.length,0!=G){for(r=0;1E6>r;r++){p=[];G=m.length;m[G-1].X!=m[0].X||m[G-1].Y!=m[0].Y?(P=1,m.push({X:m[0].X,Y:m[0].Y}),G=m.length):P=0;O=[];for(h=0;h<G-2;h++){z=m[h];H=m[h+1];E=m[h+2];R=z.X;V=z.Y;z=E.X-R;L=E.Y-V;if(0!==z||0!==L)T=((H.X-R)*z+(H.Y-V)*L)/(z*z+L*L),1<T?(R=E.X,V=E.Y):0<T&&(R+=z*T,V+=L*T);z=H.X-R;L=H.Y-V;E=z*z+L*L;E<=lb&&(O[h+1]=1,h++)}p.push({X:m[0].X,Y:m[0].Y});for(h=1;h<G-1;h++)O[h]||p.push({X:m[h].X,Y:m[h].Y});
p.push({X:m[G-1].X,Y:m[G-1].Y});P&&m.pop();if(O.length)m=p;else break}G=p.length;p[G-1].X==p[0].X&&p[G-1].Y==p[0].Y&&p.pop();2<p.length&&U.push(p)}b[0]instanceof Array||(U=U[0]);"undefined"==typeof U&&(U=[[]]);return U};g.JS.PerimeterOfPath=function(b,c,e){if("undefined"==typeof b)return 0;var h=Math.sqrt,g=0,m,p,G=0,z=0,E=b.length;if(2>E)return 0;for(c&&(b[E]=b[0],E++);--E;)m=b[E],G=m.X,m=m.Y,p=b[E-1],z=p.X,p=p.Y,g+=h((G-z)*(G-z)+(m-p)*(m-p));c&&b.pop();return g/e};g.JS.PerimeterOfPaths=function(b,
c,e){e||(e=1);for(var h=0,m=0;m<b.length;m++)h+=g.JS.PerimeterOfPath(b[m],c,e);return h};g.JS.ScaleDownPath=function(b,c){var e,h;c||(c=1);for(e=b.length;e--;)h=b[e],h.X/=c,h.Y/=c};g.JS.ScaleDownPaths=function(b,c){var e,h,g;c||(c=1);for(e=b.length;e--;)for(h=b[e].length;h--;)g=b[e][h],g.X/=c,g.Y/=c};g.JS.ScaleUpPath=function(b,c){var e,g,m=Math.round;c||(c=1);for(e=b.length;e--;)g=b[e],g.X=m(g.X*c),g.Y=m(g.Y*c)};g.JS.ScaleUpPaths=function(b,c){var e,g,m,r=Math.round;c||(c=1);for(e=b.length;e--;)for(g=
b[e].length;g--;)m=b[e][g],m.X=r(m.X*c),m.Y=r(m.Y*c)};g.ExPolygons=function(){return[]};g.ExPolygon=function(){this.holes=this.outer=null};g.JS.AddOuterPolyNodeToExPolygons=function(b,c){var e=new g.ExPolygon;e.outer=b.Contour();var h=b.Childs(),m=h.length;e.holes=Array(m);var r,p,G,z,E;for(p=0;p<m;p++)for(r=h[p],e.holes[p]=r.Contour(),G=0,z=r.Childs(),E=z.length;G<E;G++)r=z[G],g.JS.AddOuterPolyNodeToExPolygons(r,c);c.push(e)};g.JS.ExPolygonsToPaths=function(b){var c,e,h,m,r=new g.Paths;c=0;for(h=
b.length;c<h;c++)for(r.push(b[c].outer),e=0,m=b[c].holes.length;e<m;e++)r.push(b[c].holes[e]);return r};g.JS.PolyTreeToExPolygons=function(b){var c=new g.ExPolygons,e,h,m;e=0;h=b.Childs();for(m=h.length;e<m;e++)b=h[e],g.JS.AddOuterPolyNodeToExPolygons(b,c);return c}})();
var createCindy=function(){function p(p){if(0===ha)return console.error("Waiting for "+p+" after we finished waiting."),function(){};0>ha&&(ha=0);++ha;return function(){--ha;0>ha&&console.error("Wait count mismatch: "+p);if(0===ha)for(var E=0,m=Ta.length;E<m;)Ta[E++].startup()}}function E(p){var O=E.newInstance(p);0>=ha?O.startup():!1!==p.autostart&&Ta.push(O);return O}var ha=-1,Ta=[];"undefined"===typeof document||"undefined"===typeof window||"undefined"===typeof document.addEventListener||"undefined"!==
typeof window.cindyDontWait&&!0===window.cindyDontWait||document.addEventListener("DOMContentLoaded",p("DOMContentLoaded"));var ya=null,za=null,U={};E.getBaseDir=function(){if(null!==ya)return ya;for(var p=document.getElementsByTagName("script"),E=0;E<p.length;++E){var m=p[E],H=m.src;if(H){var T=/Cindy\.js$/.exec(H);if(T)return ya=H.substr(0,T.index),console.log("Will load extensions from "+ya),za=m,ya}}console.error("Could not find <script> tag for Cindy.js");return ya=za=!1};E.addNewScript=function(p,
O){O||console.error.bind(console);var m=E.getBaseDir();if(!1===m)return!1;var H=document.createElement("script");H.src=m+p;var m=za.nextSibling,T=za.parentElement;m?T.insertBefore(H,m):T.appendChild(H);return H};E.loadScript=function(p,O,m,H){if(window[p])return m(),!0;H||(H=console.error.bind(console));var T=U[p];if(!T){T=E.addNewScript(O,H);if(!1===T)return H("Can't load additional components."),!1;U[p]=T}T.addEventListener("load",m);T.addEventListener("error",H);return null};E._autoLoadingPlugin=
{};E.autoLoadPlugin=function(p,O,m){if(E._pluginRegistry[p])return m(),!0;var H=E._autoLoadingPlugin[p];if(!H){O||(O=p+"-plugin.js");H=E._autoLoadingPlugin[p]=[];p=E.addNewScript(O);if(!1===p)return!1;p.addEventListener("error",console.error.bind(console))}H.push(m);return null};E.waitFor=p;E._pluginRegistry={};E.instances=[];E.registerPlugin=function(p,O,m){if(1!==p)return console.error("Plugin API version "+p+" not supported"),!1;E._pluginRegistry[O]=m;(E._autoLoadingPlugin[O]||[]).forEach(function(m){m()})};
E.newInstance=function(p){var E,m,H,T,U,ha,xa;function ya(a){if(a){for(var k=0;k<a.length;k++){var d=a[k],v=Object.keys(d)[0];"scale"===v&&(pb=d.scale,x[v](d.scale));if("translate"===v)x[v](d.translate[0],d.translate[1]);"scaleAndOrigin"===v&&(pb=d[v][0]/25,x[v].apply(null,d[v]));"visibleRect"===v&&(x[v].apply(null,d[v]),pb=x.drawingstate.initialmatrix.a/25)}x.createnewbackup()}}function Aa(){Cb=!0;if(0===qb){void 0!==p.csconsole&&(ia=p.csconsole);ia=null===ia?new Ja:!0===ia?new Va:"string"===typeof ia?
new ab(ia):"object"===typeof ia&&"function"===typeof ia.appendChild?new ab(ia):new Ja;gb=[100,100];var a,k=null,d=p.transform;p.ports&&0<p.ports.length&&(a=p.ports[0],(k=a.element)||(k=document.getElementById(a.id)),"window"===a.fill?(k.setAttribute("width",window.innerWidth),k.setAttribute("height",window.innerHeight)):a.width&&a.height&&(k.setAttribute("width",a.width),k.setAttribute("height",a.height)),a.background&&(k.style.backgroundColor=a.background),void 0!==a.transform&&(d=a.transform));
k||(k=p.canvas)||"undefined"===typeof document||(k=document.getElementById(p.canvasname));k&&(B=k.getContext("2d"),B.setLineDash||(B.setLineDash=function(){}));a=hb($c);a=na(a,!1);A(a);var v=p.scripts,b=null;"string"===typeof v&&v.search(/\*/)&&(b=v);"object"!==typeof v&&(v=null);"move keydown mousedown mouseup mousedrag init tick draw simulationstep simulationstart simulationstop".split(" ").forEach(function(a){var d;if(null!==v&&v[a])d=v[a];else{d=a+"script";if(p[d])d=document.getElementById(p[d]);
else if(b){if(d=document.getElementById(b.replace(/\*/,a)),!d)return}else return;d=d.text}d=hb(d);d=na(d,!1);"error"===d.ctype?console.error("Error compiling "+a+" script: "+d.message):da[a]=d});p.grid&&0!==p.grid&&(La=p.grid,ic=na("#drawgrid("+La+")",!1));p.snap&&(jc=p.snap);k&&(ea=k.width,Y=k.height,ya(d),x.drawingstate.matrix.ty-=Y,x.drawingstate.initialmatrix.ty-=Y,d=1,"undefined"!==typeof window&&window.devicePixelRatio&&(d=window.devicePixelRatio),a=B.webkitBackingStorePixelRatio||B.mozBackingStorePixelRatio||
B.msBackingStorePixelRatio||B.oBackingStorePixelRatio||B.backingStorePixelRatio||1,d!==a&&(d/=a,k.width=ea*d,k.height=Y*d,k.style.width||(k.style.width=ea+"px"),k.style.height||(k.style.height=Y+"px"),B.scale(d,d)));xa=ha=U=T=H=m=E=void 0;d=0;ja={};p.geometry||(p.geometry=[]);ad(p.geometry);p.behavior||(p.behavior=[]);"function"===typeof Fb&&Fb(p.behavior);for(var f in p.images)d=p.images[f],ja[f]=new Image,ja[f].ready=!1,ja[f].onload=function(){ja[f].ready=!0;c()},ja[f].src=d;ka.canvas=k;if(p.oninit)p.oninit(ka);
if(p.exclusive)for(d=ta.instances.length;0<d;)ta.instances[--d].shutdown();ta.instances.push(ka);p.use&&p.use.forEach(function(a){t.use$1([w.wrap(a)],{})});kc.convexhull3d$1&&g("quickhull3d","quickhull3d/quickhull3d.nocache.js");za()}}function g(a,k){var d=null;p.plugins&&(d=p.plugins[a]);d||(d=ta._pluginRegistry[a]);d?t.use$1([w.wrap(a)],{}):(++lc,ta.autoLoadPlugin(a,k,function(){t.use$1([w.wrap(a)],{});za()}))}function za(){0===--lc&&(A(da.init),p.autoplay&&R(),ka.canvas&&Ta(ka.canvas,p))}function V(){null!==
ib&&(ba.set(ib.state),Object.keys(ib.speeds).forEach(function(a){var k=m[a];"undefined"!==typeof k.behavior&&(a=ib.speeds[a],k.behavior.vx=a[0],k.behavior.vy=a[1],k.behavior.vz=a[2],k.behavior.fx=0,k.behavior.fy=0,k.behavior.fz=0)}),bd())}function R(){if(!Da){if(rb){var a=Ma.backup;a.set(ba);for(var k={},d=0;d<H.length;d++){var v=H[d];"undefined"!==typeof v.behavior&&(k[v.name]=[v.behavior.vx,v.behavior.vy,v.behavior.vz])}ib={state:a,speeds:k};rb=!1}"function"===typeof Fb&&Gb&&cd(pa);Da=!0;A(da.simulationstart);
b()}}function Ua(){Da&&(Da=!1)}function $a(){rb||(Da&&(A(da.simulationstop),Da=!1),rb=!0,V())}function Ba(){if(!Hb){Hb=!0;for(var a=ta.instances.length;0<a;)if(ta.instances[--a]===ka){ta.instances.splice(a,1);break}for(a=Wa.length;0<a;)try{Wa[--a]()}catch(k){console.error(k)}}}function Ka(a){this["in"]=function(a,d){console.log(a);d?this.append(this.createTextNode("span","blue",a)):this.append(this.createTextNode("p","blue",a))};this.out=function(a,d){console.log(a);d?this.append(this.createTextNode("span",
"red",a)):this.append(this.createTextNode("p","red",a))};this.err=function(a,d){console.log(a);d?this.append(this.createTextNode("span","red",a)):this.append(this.createTextNode("p","red",a))};this.createTextNode=function(a,d,v){return"undefined"!==typeof document?(a=document.createElement(a),a.appendChild(document.createTextNode(v)),a.style.color=d,a):v+"\n"}}function Va(){var a=this,k,d=document.createElement("div"),v;d.innerHTML='<div id="console" style="border-top: 1px solid #333333; bottom: 0px; position: absolute; width: 100%;"><div id="log" style="height: 150px; overflow-y: auto;"></div><input id="cmd" type="text" style="box-sizing: border-box; height: 30px; width: 100%;"></div>';
document.body.appendChild(d);k=document.getElementById("cmd");v=document.getElementById("log");k.onkeydown=function(d){13===d.keyCode&&""!==k.value&&(a["in"](k.value),d=t.parse$1([w.wrap(k.value)],[]),d=A(d),console.log(L(d)),"undefined"!==d.ctype&&ia.out(L(d)),k.value="",v.scrollTop=v.scrollHeight)};this.append=function(a){v.appendChild(a)};this.clear=function(){v.innerHTML=""}}function ab(a){var k=a;"string"===typeof a&&(k=document.getElementById(a));this.append=function(a){k.appendChild(a)};this.clear=
function(){k.innerHTML=""}}function Ja(){this.append=function(a){};this.clear=function(){}}function fa(a){for(var k=null,d=1E6,v,b=0;b<xa.length;b++){var c=xa[b];if(!c.pinned&&!1!==c.visible){var e,g,h,n=x.drawingstate.matrix.sdet;if("P"===c.kind){var Xa=f.normalizeZ(c.homog);if(!f._helper.isAlmostReal(Xa))continue;e=Xa.value[0].value.real-a.x;g=Xa.value[1].value.real-a.y;h=Math.sqrt(e*e+g*g);if(c.narrow&&h>("number"===typeof c.narrow?c.narrow:20)/n)continue}else"C"===c.kind?(g=m[c.args[0]],h=c.radius,
e=l.div(g.homog.value[0],g.homog.value[2]).value.real,g=l.div(g.homog.value[1],g.homog.value[2]).value.real,e-=a.x,g-=a.y,h=Math.sqrt(e*e+g*g)-h.value.real,g=e=0,0>h&&(h=-h),h+=30/n):"L"===c.kind&&(e=c.homog,h=l,g=h.add(h.mult(e.value[0],h.conjugate(e.value[0])),h.mult(e.value[1],h.conjugate(e.value[1]))),g=f.scaldiv(h.sqrt(g),e),h=g.value[0].value.real*a.x+g.value[1].value.real*a.y+g.value[2].value.real,e=-g.value[0].value.real*h,g=-g.value[1].value.real*h,0>h&&(h=-h),h+=1);h<d+.2/n&&(d=h,k=c,v=
{x:e,y:g})}}console.log("Moving "+(k?k.name:"nothing"));return null===k?null:{mover:k,offset:v,prev:{x:a.x,y:a.y}}}function P(a,k,d,v){void 0===v&&(v=!1);Wa.push(function(){a.removeEventListener(k,d,v)});a.addEventListener(k,d,v)}function Ta(a,k){function d(d){var k=a.getBoundingClientRect();d=x.to(d.clientX-k.left-a.clientLeft+.5,d.clientY-k.top-a.clientTop+.5);W.prevx=W.x;W.prevy=W.y;W.x=d[0];W.y=d[1];gb[0]=W.x;gb[1]=W.y;W.moved=!0}function v(a){W.down=!1;ca=void 0;Ya();c();A(da.mouseup);a.preventDefault()}
var Ca=null;"undefined"!==typeof MutationObserver&&(Ca=MutationObserver);Ca||"undefined"===typeof WebKitMutationObserver||(Ca=WebKitMutationObserver);Ca?(Ca=new Ca(function(d){document.body.contains(a)||Ba()}),Ca.observe(document.documentElement,{childList:!0,subtree:!0}),Wa.push(function(){Ca.disconnect()})):(P(a,"DOMNodeRemovedFromDocument",Ba),P(a,"DOMNodeRemoved",Ba));!0===k.keylistener?P(document,"keydown",function(a){e(a);return!1}):da.keydown&&(a.setAttribute("tabindex","0"),P(a,"mousedown",
function(){a.focus()}),P(a,"keydown",function(a){9!==a.keyCode&&(e(a),a.preventDefault())}));P(a,"mousedown",function(a){W.button=a.which;d(a);A(da.mousedown);ca=fa(W);b();W.down=!0;a.preventDefault()});P(a,"mouseup",function(a){W.down=!1;ca=void 0;Ya();A(da.mouseup);c();a.preventDefault()});P(a,"mousemove",function(a){d(a);W.down?A(da.mousedrag):A(da.mousemove);a.preventDefault()});P(a,"touchstart",function(a){d(a.targetTouches[0]);A(da.mousedown);W.down=!0;ca=fa(W);b();a.preventDefault()},!1);P(a,
"touchmove",function(a){d(a.targetTouches[0]);W.down?A(da.mousedrag):A(da.mousemove);a.preventDefault()},!0);P(a,"touchend",v,!1);"undefined"!==typeof document&&document.body&&P(document.body,"touchcancel",v,!1);c()}function fb(){if(Hb)return!0;Da&&(Gb&&"undefined"!==typeof la&&la.tick(),Da&&A(da.tick));if(Da||W.moved)W.moved=!1,c();sb=Da||W.down;return!sb}function b(){sb||(sb=!0,Ib.timer(fb))}function c(){x.reset();B.save();B.clearRect(0,0,ea,Y);0!==La&&A(ic);dd();x.greset();ed();var a;for(a=0;a<
U.length;a++)if(U[a].isArc){var k=U[a];if(k.isshowing&&!1!==k.visible){var d={};d.color=k.color;d.alpha=k.alpha;d.size=k.size;D.drawarc(k,d,k.filled?"F":"D")}}else k=U[a],k.isshowing&&!1!==k.visible&&(d={},d.color=k.color,d.alpha=k.alpha,d.size=k.size,D.drawconic(k.matrix,d));for(a=0;a<T.length;a++)a:{var k=T[a],v=void 0,d=void 0;if(k.isshowing&&!1!==k.visible&&f._helper.isAlmostReal(k.homog))if("S"===k.kind)t.draw$2([k.startpos,k.endpos],{overhang:k.overhang,dashtype:k.dashtype,size:k.size,color:k.color,
alpha:k.alpha,arrow:k.arrow,arrowsize:k.arrowsize,arrowposition:k.arrowposition,arrowshape:k.arrowshape,arrowsides:k.arrowsides});else if("end"===k.clip.value&&"Join"===k.type)v=m[k.args[0]],d=m[k.args[1]],t.draw$2([v.homog,d.homog],{overhang:k.overhang,dashtype:k.dashtype,size:k.size,color:k.color,alpha:k.alpha});else{if("inci"===k.clip.value){for(var v=[1E6,0],d=[-1E6,0],b=[1E6,0],c=[-1E6,0],e=0;e<k.incidences.length;e++){var g=m[k.incidences[e]].homog,h=g.value[0],n=g.value[1],Xa=g.value[2];l._helper.isAlmostZero(Xa)||
(h=l.div(h,Xa),n=l.div(n,Xa),l._helper.isAlmostReal(h)&&l._helper.isAlmostReal(n)&&(h.value.real<v[0]&&(v=[h.value.real,g]),h.value.real>d[0]&&(d=[h.value.real,g]),n.value.real<b[0]&&(b=[n.value.real,g]),n.value.real>c[0]&&(c=[n.value.real,g])))}d[0]-v[0]>c[0]-b[0]?(v=v[1],d=d[1]):(v=b[1],d=c[1]);if(v!==d){t.draw$2([v,d],{dashtype:k.dashtype,size:k.size,color:k.color,alpha:k.alpha,overhang:k.overhang});break a}}t.draw$1([k.homog],{dashtype:k.dashtype,size:k.size,color:k.color,alpha:k.alpha})}}for(a=
0;a<H.length;a++)k=H[a],k.isshowing&&!1!==k.visible&&f._helper.isAlmostReal(k.homog)&&(d=k.color,k.behavior&&(d=k.color),t.draw$1([k.homog],{size:k.size,color:d,alpha:k.alpha}),k.labeled&&(d=k.printname||k.name||"P",c=k.labelpos||{x:3,y:3},v=k.textsize||12,b=!0===k.textbold,e=!0===k.textitalics,g=k.text_fontfamily||ra.fontFamily,h=c.x*c.x+c.y*c.y,n=1,0<h&&(n=1+k.size.value.real/Math.sqrt(h)),t.drawtext$2([k.homog,w.wrap(d)],{x_offset:w.wrap(n*c.x),y_offset:w.wrap(n*c.y),size:w.wrap(v),bold:w.wrap(b),
italics:w.wrap(e),family:w.wrap(g)})));for(a=0;a<ha.length;a++)fd(ha[a]);B.restore()}function e(a){a=window.event?event:a;a=a.charCode?a.charCode:a.keyCode;mc=String.fromCharCode(a);nc=a;A(da.keydown);c()}function h(a,k){if(k in a)return k;k=k.charAt(0).toUpperCase()+k.substring(1);for(var d=0,v=oc.length;d<v;++d){var b=oc[d]+k;if(b in a)return b}}function q(){var a=r(),a=F()-a;24<a?(isFinite(a)&&(clearTimeout(tb),tb=setTimeout(q,a)),ub=0):(ub=1,pc(q))}function r(){var a=Date.now();for(Na=vb;Na;)a>=
Na.t&&(Na.f=Na.c(a-Na.t)),Na=Na.n;return a}function F(){for(var a,k=vb,d=Infinity;k;)k.f?k=a?a.n=k.n:vb=k.n:(k.t<d&&(d=k.t),k=(a=k).n);wb=a;return d}function cc(){this.ctype="undefined"}function z(){this.ctype="void"}function Fa(a){this.ctype="error";this.message=a}function ma(a){a=a.value.slice();var k=a.length-1,d=l.inv(a[k]);a.length=k;for(var v=0;v<k;++v)a[v]=l.mult(d,a[v]);return f.turnIntoCSList(a)}function aa(a){var k=a.value;a=k[0].value;var d=k[1].value,k=k[2].value;return f.turnIntoCSList([a[0],
l.add(a[1],d[0]),l.add(a[2],k[0]),d[1],l.add(d[2],k[1]),k[2]])}function nb(a){var k=!0;return function(d,v){k&&(console.error("Operator "+a+" is not supported yet."),k=!1);return u}}function L(a){if("undefined"===typeof a)return"_??_";if("undefined"===a.ctype)return"___";if("number"===a.ctype)return l.niceprint(a);if("string"===a.ctype||"boolean"===a.ctype)return a.value;if("list"===a.ctype){for(var k="[",d=0;d<a.value.length;d++)k+=L(A(a.value[d])),d!==a.value.length-1&&(k+=", ");return k+"]"}return"function"===
a.ctype?"FUNCTION":"infix"===a.ctype?"INFIX":"modifier"===a.ctype?a.key+"->"+L(a.value):"shape"===a.ctype?a.type:"error"===a.ctype?"Error: "+a.message:"variable"===a.ctype?(console.log("HALLO"),L(a.stack[length.stack])):"geo"===a.ctype?a.value.name:"_?_"}function Ab(a,k){var d="undefined"===a[0].ctype,v="undefined"===a[1].ctype,b=A(a[1]);if(d||v)return u;"variable"===a[0].ctype?K.setvar(a[0].name,b):"infix"===a[0].ctype?"_"===a[0].oper?D.assigntake(a[0],b):console.error("Can't use infix expression as lvalue"):
"field"===a[0].ctype?D.assigndot(a[0],b):"function"===a[0].ctype&&"genList"===a[0].oper?"list"===b.ctype?D.assignlist(a[0].args,b.value):console.error("Expected list in rhs of assignment"):console.error("Left hand side of assignment is not a recognized lvalue");return b}function ob(a,k){var d=A(a[0]),v=A(a[1]);if(d.ctype===v.ctype){if("number"===d.ctype)return w.bool(d.value.real===v.value.real&&d.value.imag===v.value.imag);if("string"===d.ctype||"boolean"===d.ctype)return w.bool(d.value===v.value);
if("list"===d.ctype)return f.equals(d,v);if("geo"===d.ctype)return w.bool(d.value===v.value)}return{ctype:"boolean",value:!1}}function fc(a,k){return w.not(ob(a,k))}function Bb(a,k){var d=C(a[0]),v=C(a[1]);return"number"===d.ctype&&"number"===v.ctype?{ctype:"boolean",value:l._helper.isAlmostEqual(d,v)}:"string"===d.ctype&&"string"===v.ctype||"boolean"===d.ctype&&"boolean"===v.ctype?{ctype:"boolean",value:d.value===v.value}:"list"===d.ctype&&"list"===v.ctype?f.almostequals(d,v):{ctype:"boolean",value:!1}}
function gc(a,k){var d=C(a[0]),v=C(a[1]);return"boolean"===d.ctype&&"boolean"===v.ctype?{ctype:"boolean",value:d.value&&v.value}:u}function hc(a,k){var d=C(a[0]),v=C(a[1]);return"boolean"===d.ctype&&"boolean"===v.ctype?{ctype:"boolean",value:d.value||v.value}:u}function qc(a,k){var d=C(a[0]),v=C(a[1]),b=w.add(d,v);"Angle"===d.usage&&"Angle"===v.usage&&(b=w.withUsage(b,"Angle"));return b}function Jb(a,k){var d=C(a[0]),v=C(a[1]),b=w.sub(d,v);"Angle"===d.usage&&"Angle"===v.usage&&(b=w.withUsage(b,"Angle"));
return b}function rc(a,k){var d=C(a[0]),v=C(a[1]),b=w.mult(d,v);"Angle"!==d.usage||v.usage?"Angle"!==v.usage||d.usage||(b=w.withUsage(b,"Angle")):b=w.withUsage(b,"Angle");return b}function sc(a,k){var d=C(a[0]),v=C(a[1]);l._helper.isZero(v)&&ia.err("WARNING: Division by zero!");var b=w.div(d,v);"Angle"!==d.usage||v.usage?"Angle"!==v.usage||d.usage||(b=w.withUsage(b,"Angle")):b=w.withUsage(b,"Angle");return b}function tc(a,k){var d=C(a[0]),v=C(a[1]);return"number"===d.ctype&&"number"===v.ctype?l.pow(d,
v):u}function Kb(a){var k=a.length;if(0===k)return[];if(1===k)return[0];if(2===k)return a[0][0]+a[1][1]<=a[0][1]+a[1][0]?[0,1]:[1,0];if(4<k)return gd(a);for(var d=hd[k],v=Number.POSITIVE_INFINITY,b=d[0],c=0;c<d.length;++c){for(var f=d[c],e=0,g=0;g<k;++g)e+=a[g][f[g]];e<v&&(v=e,b=f)}return b}function gd(a){function k(){return{matched:-1,prev:-1,start:-1,cost:0,used:!1,leaf:!1}}function d(a){for(var k=0;k<c;++k)0<h[a][k]||l[k].used||(l[k].used=!0,d(l[k].matched))}function v(a){for(var d=0;d<c;++d)0<
h[d][a]||g[d].used||(g[d].used=!0,v(g[d].matched))}var b=Math.abs,c=a.length,f,e,g=Array(c),l=Array(c),h=Array(c);for(f=0;f<c;++f)h[f]=Array(c);for(f=0;f<c;++f)for(g[f]=k(),l[f]=k(),g[f].cost=a[f][0],e=1;e<c;++e)g[f].cost>a[f][e]&&(g[f].cost=a[f][e]);for(;;){for(f=0;f<c;++f)for(e=0;e<c;++e)h[f][e]=a[f][e]-g[f].cost-l[e].cost,h[f][e]<1E-14*(b(a[f][e])+b(g[f].cost)+b(l[e].cost))&&(h[f][e]=0);for(f=0;f<c;++f)g[f].matched=l[f].matched=-1;for(var m=0;;){for(f=0;f<c;++f)g[f].used=g[f].leaf=l[f].used=l[f].leaf=
!1,-1===g[f].matched&&(g[f].start=f,g[f].used=g[f].leaf=!0,g[f].prev=-1);for(var n=!1,q=!1;!q;){for(f=0;f<c;++f)if(g[f].leaf)for(g[f].leaf=!1,e=0;e<c;++e)if(!(l[e].used||0<h[f][e])&&g[f].matched!==e&&(l[e].prev=f,l[e].start=g[f].start,l[e].used=l[e].leaf=!0,-1===l[e].matched)){g[l[e].start].prev=e;n=!0;break}if(n)break;q=!0;for(e=0;e<c;++e)l[e].leaf&&(l[e].leaf=!1,f=l[e].matched,g[f].used||(g[f].prev=e,g[f].start=l[e].start,g[f].used=g[f].leaf=!0,q=!1))}if(!n)break;for(n=0;n<c;++n)if(-1===g[n].matched&&
-1!==g[n].prev){e=g[n].prev;do f=l[e].prev,l[e].matched=f,g[f].matched=e,e=g[f].prev;while(f!==n);++m}}if(m===c)break;for(f=0;f<c;++f)g[f].used=g[f].leaf=l[f].used=l[f].leaf=!1;for(f=0;f<c;++f)-1===g[f].matched&&d(f);for(e=0;e<c;++e)-1===l[e].matched&&v(e);for(f=0;f<c;++f)-1===g[f].matched||g[f].used||l[g[f].matched].used||(g[f].used=!0);m=Number.POSITIVE_INFINITY;for(f=0;f<c;++f)if(!g[f].used)for(e=0;e<c;++e)l[e].used||m>h[f][e]&&(m=h[f][e]);for(f=0;f<c;++f)g[f].used||(g[f].cost+=m),l[f].used&&(l[f].cost-=
m)}a=Array(c);for(f=0;f<c;++f)e=g[f].matched,a[f]=e;return a}function Lb(a,k){var d=A(a[0]),v=C(a[1]);if("number"===v.ctype){var b=Math.floor(v.value.real);if("list"===d.ctype||"string"===d.ctype)return 0>b&&(b=d.value.length+b+1),0<b&&b<d.value.length+1?"list"===d.ctype?d.value[b-1]:{ctype:"string",value:d.value.charAt(b-1)}:u}if("list"===v.ctype){for(var b=[],c=0;c<v.value.length;c++){var e=C(v.value[c]);b[c]=Lb([d,e],[])}return f.turnIntoCSList(b)}return u}function uc(a,k){var d=A(a[0]),v=A(a[1]);
return"list"===d.ctype&&"list"===v.ctype?f.concat(d,v):"shape"===d.ctype&&"shape"===v.ctype?D.shapeconcat(d,v):u}function vc(a,k){var d=A(a[0]),v=A(a[1]);return"list"===d.ctype&&"list"===v.ctype?f.set(f.common(d,v)):"shape"===d.ctype&&"shape"===v.ctype?D.shapecommon(d,v):u}function wc(a,k){var d=A(a[0]),v=A(a[1]);return"list"===d.ctype&&"list"===v.ctype?f.remove(d,v):"shape"===d.ctype&&"shape"===v.ctype?D.shaperemove(d,v):u}function xc(a,k){var d=A(a[0]),v=A(a[1]);return"list"===d.ctype?f.append(d,
v):u}function yc(a,k){var d=A(a[0]),v=A(a[1]);return"list"===v.ctype?f.prepend(d,v):u}function Mb(a,k){a|=0;k|=0;if(0===a&&0===k)return 0;for(;0!==k;){var d=a;a=k;k=d%k|0}return a}function id(a){return 1===a?0:1}function A(a){if("undefined"===typeof a)return u;if("infix"===a.ctype)return a.impl(a.args,{});if("variable"===a.ctype)return K.getvar(a.name);if("void"===a.ctype||"geo"===a.ctype||"number"===a.ctype||"boolean"===a.ctype||"string"===a.ctype||"list"===a.ctype||"undefined"===a.ctype||"shape"===
a.ctype)return a;if("field"===a.ctype){var k=A(a.obj);return"geo"===k.ctype?ua.getField(k.value,a.key):"list"===k.ctype?f.getField(k,a.key):u}return"function"===a.ctype?D.evaluate(a.oper,a.args,a.modifs):u}function C(a){a=A(a);if("geo"===a.ctype){var k=a.value;if("P"===k.kind)return ua.getField(k,"xy")}return a}function M(a){a=A(a);if("geo"===a.ctype){var k=a.value;if("P"===k.kind||"L"===k.kind)return ua.getField(k,"homog")}return f._helper.isNumberVecN(a,3)?a:f._helper.isNumberVecN(a,2)?(k=f.turnIntoCSList([a.value[0],
a.value[1],l.real(1)]),a.usage&&(k=w.withUsage(k,a.usage)),k):u}function hb(a){for(var k=!1,d=!1,v="",b=0;b<a.length;b++){var c=a[b];'"'!==c||d||(k=!k);"/"===c&&b!==a.length-1&&"/"===a[b+1]&&(d=!0);"\n"===c&&(d=!1);if(" "!==c&&"\t"!==c&&"\n"!==c&&"\r"!==c&&!d||k)v+=c}return v}function zc(a,k,d){var v={ctype:"infix"};v.oper=a;v.impl=Q[a];v.args=[k,d];return v}function jd(a){var k,d;if("function"!==a.ctype)return console.log("Invalid function name."),!1;for(k=0;k<a.args.length;k++)if("variable"!==a.args[k].ctype)return console.log("Argument is not a variable."),
!1;for(k=0;k<a.args.length-1;k++)for(d=k+1;d<a.args.length;d++)if(a.args[k].name===a.args[d].name)return console.log("Variable name used twice."),!1;return!0}function Nb(a){return"["===a||"("===a||"{"===a||"|"===a}function Ob(a){return"]"===a||")"===a||"}"===a||"|"===a}function Pb(a){var k,d=[],v=[],b=[];k=a+",";var c=k.length,f=0,e=0,g=!1,l=!1;for(a=e;a<c;a++){var h;h=k[a];'"'===h&&(l=!l);!l&&(!Nb(h)||"|"===h&&g?Ob(h)&&("|"!==h||g)&&(f--,"|"===h&&(g=!1)):(f++,"|"===h&&(g=!0)),","===h&&0===f||-1===
f)&&(h=k.substring(e,a),d.push(h),v.push(e),e=a+1)}for(a=0;a<d.length;a++)if(v=d[a],""===v)b.push("nil");else{v=na(v,!1);if("error"===v.ctype)return v;b.push(v)}d={ctype:"function",oper:"genList"};d.args=b;d.modifs={};return d}function kd(a){var k;return"|"===a[0]?(a=Pb(a.substring(1,a.length-1)),k=a.args.length,1===k?(a.oper="abs_infix",a):2===k?(a.oper="dist_infix",a):u):"()"===a||"[]"===a?k={ctype:"list",value:[]}:"["===a[0]?Pb(a.substring(1,a.length-1)):"("===a[0]&&(k=Pb(a.substring(1,a.length-
1)),1<k.args.length)?k:k=na(a.substring(1,a.length-1),!1)}function na(a,k){for(var d=!1,v="",b=-1,c=-1,f="",e=0,g=0,l=" ",h=" ",m=0,n=!1,q=a.length,p=0;p<q;p++){var r,t=" ",w=" ";0<m&&m--;r=a[p];p+1<q&&(t=a[p+1]);p+2<q&&(w=a[p+2]);'"'===r&&(d=!d);if(!d){if(Nb(r)&&("|"!==r||!n))"|"===r&&(n=!0),v+=r,e++,1===e&&g++," "===l&&(l=r);else if(Ob(r)&&("|"!==r||n)){"|"===r&&(n=!1);if(0===e)return new Fa("close without open");h=v[v.length-1]+r;if("[]"===h||"()"===h||"{}"===h||"||"===h)e--,v=v.substring(0,v.length-
1),h=r;else return new Fa("unmatched brackets")}if(0===v.length){var x=-1,y="";"undefined"!==typeof xb[r+t+w]&&0===m?(y=r+t+w,m=3):"undefined"!==typeof xb[r+t]&&0===m?(y=""+r+t,m=2):"undefined"!==typeof xb[r]&&0===m&&(y=""+r,m=1);""!==y&&(x=xb[y]);x>=c&&(c=x,b=p,f=y,0<=x&&(p+=y.length-1))}}}if(0!==e)return new Fa("open without close");d=a.indexOf(l);v=a.lastIndexOf(h);if(0===e&&-1<c){if("->"===f)return c=f,f=a.substring(0,b),b=na(a.substring(b+c.length),!1),f="error"===b.ctype?b:{ctype:"modifier",
key:f,value:b},f;if("."===f)return c=f,/^[0-9]+(?:\.[0-9])*|\.[0-9]*$/.test(a)?(f={},f.value={real:"."===a?0:+a,imag:0},f.ctype="number"):(f=na(a.substring(0,b),!1),b=a.substring(b+c.length),f={ctype:"field",obj:f,key:b}),f;if(":="===f)return c=a.substring(0,b),c=na(c,!0),"error"===c.ctype?f=c:"variable"===c.cstring||jd(c)?(b=a.substring(b+f.length),b=na(b,!1),f="error"===b.ctype?b:zc(f,c,b)):(console.log(["Function not definable",c]),f=new Fa("Function not definable")),f;c=na(a.substring(0,b),!1);
b=na(a.substring(b+f.length),!1);f="error"===c.ctype?c:"error"===b.ctype?b:zc(f,c,b);return f}if(0===e&&1===g&&v===a.length-1){if(0===d)return kd(a);a:{e=[];g=[];f=[];b={};c=a.substring(0,d);v=a.length;l=0;h=d+1;n=m=!1;for(d=h;d<v;d++)if(q=a[d],'"'===q&&(m=!m),!m)if(!Nb(q)||"|"===q&&n?Ob(q)&&("|"!==q||n)&&(l--,"|"===q&&(n=!1)):(l++,"|"===q&&(n=!0)),","===q&&0===l||-1===l)q=a.substring(h,d),e.push(q),g.push(h),1!==e.length||-1!==l||e[0].length||(e=[],g=[]),h=d+1;for(d=0;d<e.length;d++){g=na(e[d],!1);
if("error"===g.ctype){f=g;break a}"modifier"===g.ctype?b[g.key]=g.value:f.push(g)}e={ctype:"function"};e.oper=c+"$"+f.length;kc[e.oper]=!0;e.args=f;e.modifs=b;f=e}return f}return""===a?new z:'"'===a.charAt(0)&&'"'===a.charAt(a.length-1)?{ctype:"string",value:a.substring(1,a.length-1)}:/^[0-9]+$/.test(a)?{ctype:"number",value:{real:parseInt(a),imag:0}}:K.isVariable(a)?K.vars[a]:K.isVariableName(a)?K.create(a):u}function Ac(){this._path=[];this._defs=["<defs>"];this._imgcache=[];this._body=[];this._saveStack=
[""];this._clipIndex=0;this._stroke=this._fill="#000";this._strokeOpacity=this._fillOpacity=null;this.height=this.width=0;this.lineWidth=1;this.lineCap="butt";this.lineJoin="miter";this.miterLimit=10;this.globalAlpha=1}function Bc(){this._body=[];this._yPos=this._xPos=NaN;this._extGState={Af255:"<< /ca 1 >>",As255:"<< /CA 1 >>"};this._objects=[["%PDF-1.4\n"]];this._offset=this._objects[0][0].length;this._nextIndex=5;this._imgcache=[];this._xobjects={};this._pathUsed=-1;this._fillAlpha=this._strokeAlpha=
this._globalAlpha=1;this.height=this.width=0;this.lineWidth=1;this.lineCap="butt";this.lineJoin="miter";this.miterLimit=10}function Cc(a,k){var d=a.width,v=a.height,b=document.createElement("canvas");b.setAttribute("width",d);b.setAttribute("height",v);b.setAttribute("style","display:none;");var c=ka.canvas;c.parentNode.insertBefore(b,c.nextSibling);try{return b.getContext("2d").drawImage(a,0,0,d,v),b.toDataURL(k||"image/png")}finally{b.parentNode.removeChild(b)}}function ld(a){a=a.replace(RegExp("[^ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/]+",
"g"),"");var k=new Uint8Array(3*a.length>>2),d,v,b,c,f,e;for(v=d=0;d+3<a.length;d+=4)b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(d)),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(d+1)),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(d+2)),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(d+3)),k[v++]=b<<2|c>>4,k[v++]=c<<4|f>>2,k[v++]=f<<6|e;switch(a.length-
d){case 0:break;case 2:b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(d));c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(d+1));k[v++]=b<<2|c>>4;break;case 3:b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(d));c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(d+1));f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(d+
2));k[v++]=b<<2|c>>4;k[v++]=c<<4|f>>2;break;default:throw Error("Malformed Base64 input: "+(a.length-d)+" chars left: "+a.substr(d));}if(v!==k.length)throw Error("Failed assertion: "+v+" should be "+k.length);return k}function md(a){function k(d){return(a[d]<<24|a[d+1]<<16|a[d+2]<<8|a[d+3])>>>0}if(57>a.length)throw Error("Too short to be a PNG file");if(2303741511!==k(0)||218765834!==k(4))throw Error("PNG signature missing");for(var d=[],v=8;v<a.length;){if(v+12>a.length)throw Error("Incomplete chunk at offset 0x"+
v.toString(16));var b=k(v);if(2147483648<=b)throw Error("Chunk too long");var c=v+12+b;if(c>a.length)throw Error("Incomplete chunk at offset 0x"+v.toString(16));var f=a.subarray(v+4,v+8),f=String.fromCharCode.apply(String,f);d.push({len:b,type:f,data:a.subarray(v+8,v+8+b),crc:k(v+8+b)});v=c}return d}function yb(a,k){var d;if(d=/^rgba\(([0-9]+), *([0-9]+), *([0-9]+), *([0-9]+)\)$/.exec(a))k(+d[1],+d[2],+d[3],+d[4]);else if(d=/^rgb\(([0-9]+), *([0-9]+), *([0-9]+)\)$/.exec(a))k(+d[1],+d[2],+d[3],1);
else throw Error("Can't handle color style "+a);}function nd(a){var k=1;Object.keys(ja).forEach(function(d){var v=ja[d];if(void 0===v.cachedDataURL&&v.src)if("data:"===v.src.substr(0,5))v.cachedDataURL=v.src;else{++k;v.cachedDataURL=null;var b=new XMLHttpRequest;b.responseType="blob";b.onreadystatechange=function(){if(b.readyState===XMLHttpRequest.DONE)if(200===b.status){var d=new FileReader;d.onloadend=function(){v.cachedDataURL=d.result;console.log("Cached data for image "+v.src);0===--k&&a()};
d.readAsDataURL(b.response)}else console.error("Failed to load "+v.src+": "+b.statusText),0===--k&&a()};b.open("GET",v.src,!0);b.send()}});0===--k&&a()}function Za(a,k,d){for(d||(d="0");a.length<k;)a=d+a;return a}function Dc(){null!==jb&&(window.URL.revokeObjectURL(jb),jb=null)}function Ec(a){nd(function(){var k=B;try{B=new a;B.width=ea;B.height=Y;c();var d=B.toBlob();Dc();jb=window.URL.createObjectURL(d);window.open(jb,"_blank")}finally{B=k}})}function od(a){for(var k in a)null!==a[k]&&(ra[k]=a[k])}
function ad(a){Object.keys(n).forEach(function(a){var d=n[a];Oa(d.signature||"_helper"===a,a+" has no signature");void 0!==d.updatePosition&&void 0===d.stateSize&&(d.stateSize=0)});E=[];m={};H=[];T=[];U=[];ha=[];xa=[];a.forEach(Fc);Gc()}function Qb(a){void 0===a.size&&(a.size=ra.lineSize);a.size=l.real(a.size);a.color=f.realVector(a.color||ra.lineColor);void 0===a.alpha&&(a.alpha=ra.alpha);a.alpha=l.real(a.alpha);a.clip=w.string(a.clip||ra.clip);void 0===a.overhang&&(a.overhang=ra.overhangLine);a.overhang=
l.real(a.overhang);a.dashtype&&(a.dashtype=w.wrap(a.dashtype))}function Rb(a){a=Fc(a);Gc();return a}function Fc(a){var k;if(void 0!==m[a.name]){console.log("Element name '"+a.name+"' already exists");var d=m[a.name];n[d.type].isMovable&&Ea(d,a.pos,"homog");return{ctype:"geo",value:d}}if(d=pd[a.type]){a=d(a);d=null;for(k=0;k<a.length;++k)d=Rb(a[k]);return d}d=n[a.type];if(!d)return console.error(a),console.error("Operation "+a.type+" not implemented yet"),null;if(d.signature.length!==(a.args?a.args.length:
0))return window.alert("Wrong number of arguments for "+a.name),null;if(a.args)for(k=0;k<a.args.length;++k){if(!m.hasOwnProperty(a.args[k]))return console.log("Dropping "+a.name+" due to missing argument "+a.args[k]),null;var v=m[a.args[k]].kind;if(d.signature[k]!==v&&("S"!==v||"L"!==d.signature[k]))return window.alert("Wrong argument kind "+v+" as argument "+k+" to element "+a.name+" of type "+a.type),null}d.signatureConstraints&&!d.signatureConstraints(a)&&window.alert("signature constraints violated for element "+
a.name);E.push(a);m[a.name]=a;k=sa.length;a.kind=d.kind;a.stateIdx=k;k+=d.stateSize;a.incidences=[];a.isshowing=!0;a.movable=!1;d.isMovable&&(a.movable=!0,xa.push(a));"P"===a.kind&&(H.push(a),void 0===a.size&&(a.size=ra.pointSize),a.size=l.real(a.size),!a.movable||a.pinned?(a.color=f.realVector(a.color||ra.pointColor),a.color=f.scalmult(l.real(ra.dimDependent),a.color)):a.color=f.realVector(a.color||ra.pointColor),void 0===a.alpha&&(a.alpha=ra.alpha),a.alpha=l.real(a.alpha),a.drawtrace&&("undefined"===
typeof a.tracedim&&(a.tracedim=1),"undefined"===typeof a.tracelength&&(a.tracelength=100),"undefined"===typeof a.traceskip&&(a.traceskip=1),a._traces=Array(a.tracelength),a._traces_index=0,a._traces_tick=0));"L"===a.kind&&(T.push(a),Qb(a));"C"===a.kind&&(U.push(a),Qb(a));"S"===a.kind&&(T.push(a),void 0===a.overhang&&(a.overhang=ra.overhangSeg),a.arrow&&(a.arrow=w.bool(a.arrow)),a.arrowsize&&(a.arrowsize=l.real(a.arrowsize)),a.arrowposition&&(a.arrowposition=l.real(a.arrowposition)),a.arrowshape&&
(a.arrowshape=w.string(a.arrowshape)),a.arrowsides&&(a.arrowsides=w.string(a.arrowsides)),Qb(a),a.clip=w.string("end"));"Text"===a.kind&&ha.push(a);if(k!==sa.length){var b,c=Sb.length;Pa.length<k*c?(v=2*k,Pa=new Float64Array(c*v)):v=Pa.length/c|0;for(b=0;b<c;++b)Ma[Sb[b]]=Pa.subarray(b*v,b*v+k);k=sa;ba=Ma["in"];va=Ma.out;sa=Ma.good;sa.set(k)}ba=va=sa;Qa=!0;d.initialize&&(ga=qa=a.stateIdx,a.param=d.initialize(a),Oa(qa===a.stateIdx+d.stateSize,"State fully initialized"));ga=qa=a.stateIdx;d.updatePosition(a,
!1);Oa(ga===a.stateIdx+d.stateSize,"State fully consumed");Oa(qa===a.stateIdx+d.stateSize,"State fully updated");Qa=!1;ba=Ma["in"];ba.set(sa);va=Ma.out;Tb(a,d);Ub={};Ra(a)}function Hc(a,k){var d=m[k.args[0]].homog,v=m[k.args[1]].homog,b=a.homog,c=l.div(d.value[0],d.value[2]),d=l.div(d.value[1],d.value[2]),f=l.div(v.value[0],v.value[2]),v=l.div(v.value[1],v.value[2]),e=l.div(b.value[0],b.value[2]),b=l.div(b.value[1],b.value[2]);return l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(d)&&l._helper.isAlmostReal(f)&&
l._helper.isAlmostReal(v)&&l._helper.isAlmostReal(e)&&l._helper.isAlmostReal(b)?(c=c.value.real,d=d.value.real,f=f.value.real,v=v.value.real,e=e.value.real,b=b.value.real,c=Math.sqrt((c-f)*(c-f)+(d-v)*(d-v))-Math.sqrt((c-e)*(c-e)+(d-b)*(d-b))-Math.sqrt((f-e)*(f-e)+(v-b)*(v-b)),1E-15>c*c):!1}function Tb(a,k){a.isshowing=!0;if(a.args)for(var d=0;d<a.args.length;d++)if(!m[a.args[d]].isshowing){a.isshowing=!1;return}k.visiblecheck&&k.visiblecheck(a)}function fd(a){var k={size:a.size},d=a.pos,v=a.text,
v=v.replace(/@[$#]"([^"\\]|\\.)*"/g,function(a){var d,k;try{if(d=JSON.parse(a.substring(2)),k=m[d],!k)return"?"}catch(v){return"?"}switch(a.charAt(1)){case "$":return k.printname||d;case "#":return"V"!==k.kind?"?":L(k.value)}}),v=w.string(v);a.dock&&(a.dock.to?d=m[a.dock.to].homog:Ic.hasOwnProperty(a.dock.corner)&&(d=t.screenbounds$0([],{}),d=d.value[Ic[a.dock.corner]]),k.offset=a.dock.offset);d&&t.drawtext$2([d,v],k)}function ed(){function a(){var a=e++/d._traces.length,k=d._traces[f];k&&(a*=v*a*
a,t.draw$1([k],{size:l.real(b),color:d.color,alpha:l.real(a)}));b*=c}for(var k=0;k<H.length;k++){var d=H[k];if(d.drawtrace){d._traces_tick===d.traceskip?(d._traces[d._traces_index]=d.homog,d._traces_index=(d._traces_index+1)%d._traces.length,d._traces_tick=0):d._traces_tick++;var v=d.alpha.value.real,b=d.size.value.real,c=1;1!==d.tracedim&&(b*=d.tracedim,c=Math.pow(d.tracedim,-1/d._traces.length));var f,e=0;for(f=d._traces_index;f<d._traces.length;++f)a();for(f=0;f<d._traces_index;++f)a()}}}function Oa(a,
k){var d="Assertion failed: "+k;if(!a)throw console.log(d),Ba(),"undefined"!==typeof alert&&alert(d),Error(d);}function Ya(){sa.set(ba);Jc(!1);for(var a=sa.length,k=Math.abs,d=0;d<a;d+=2)k(sa[d])>1E12*k(sa[d+1])&&(sa[d+1]=0)}function zb(){if(cb)wa=!0;else throw Kc;}function Lc(a,k,d,v,b){return w.add(v,w.mult(d,w.sub(b,v)))}function dd(){I&&(I.currentMouseAndScripts=[]);Vb=!0;wa=!1;ba.set(sa);if(ca){var a=ca.mover,k=f.realVector([W.x+ca.offset.x,W.y+ca.offset.y,1]);Wb(a,k,"mouse");ca.prev.x=W.x;ca.prev.y=
W.y}A(da.move);A(da.draw);wa||Ya();Vb=!1;I&&(I.fullLog.push(f.turnIntoCSList([f.turnIntoCSList(I.currentMouseAndScripts)])),I.length>I.logLength&&I.splice(0,I.length-I.logLength),I.currentMouseAndScripts=null,I.postMouseHooks.forEach(function(a){a()}))}function Ea(a,k,d){Vb?Wb(a,k,d):(Ya(),wa=!1,Wb(a,k,d),Ya())}function Wb(a,k,d){I&&I.currentMouseAndScripts&&(I.currentMover=[]);va.set(ba);var v=1E4,b;b=Ub[a.name];if(!b){var c={},e=0;b=[];c[a.name]=a;for(var g=E,h=0;h<g.length;++h){var m=g[h],q=m.args;
if(q)for(var p=0;p<q.length;++p)c.hasOwnProperty(q[p])&&(c[m.name]=m,b[e++]=m)}Ub[a.name]=b}var c=-1,e=.9,r,u,t,g=n[a.type],h=g.parameterPath||Lc;ga=a.stateIdx;m=g.getParamFromState(a);ga=qa=a.stateIdx;q=g.getParamForInput(a,k,d);for(p=c+e;c!==p;){var x=p*p,y=.5/(1+x),y=l.complex(2*p*y+.5,(1-x)*y);cb=c+.5*e<=c||0===v;0===v&&console.log("tracing limit Reached");x=!1;I&&I.currentMouseAndScripts&&(I.currentStep=[]);try{ga=qa=a.stateIdx;var A=h(a,p,y,m,q);I&&(I.currentParam=A);y=va;va=ba;g.putParamToState(u,
A);va=y;qa=a.stateIdx;I&&(I.currentElement=a);g.updatePosition(a,!0);Oa(ga===a.stateIdx+g.stateSize,"State fully consumed");Oa(qa===a.stateIdx+g.stateSize,"State fully updated");for(r=0;r<b.length;++r)u=b[r],t=n[u.type],ga=qa=u.stateIdx,I&&(I.currentElement=u),t.updatePosition(u,!1),Oa(ga===u.stateIdx+t.stateSize,"State fully consumed"),Oa(qa===u.stateIdx+t.stateSize,"State fully updated");I&&(I.currentElement=null);c=p;e*=1.25;p+=e;1<=p&&(p=1);va=ba;ba=y}catch(z){if(z!==Kc)throw z;e*=.5;p=c+e;--v;
x=!0}I&&I.currentMouseAndScripts&&(I.currentMover.push(f.turnIntoCSList([f.turnIntoCSList(I.currentStep),w.wrap(x),w.wrap(c),w.wrap(p),w.wrap(I.currentParam)])),I.currentStep=null,I.currentParam=null)}Jc(wa);for(r=0;r<b.length;++r)u=b[r],t=n[u.type],Tb(u,t);I&&I.currentMouseAndScripts&&(I.currentMouseAndScripts.push(f.turnIntoCSList([f.turnIntoCSList(I.currentMover),w.wrap(wa),w.wrap(a.name),k,w.wrap(d),m,q])),I.currentMover=null)}function bd(){Ya();cb=!0;for(var a=E,k=0;k<a.length;k++){var d=a[k],
v=n[d.type];ga=qa=d.stateIdx;v.updatePosition(d,!1);Tb(d,v)}a=va;va=ba;ba=a;Ya()}function Jc(a){var k=p.tracingStateReport;"string"===typeof k&&(document.getElementById(k).textContent=a?"BAD":"GOOD")}function qd(){return f.turnIntoCSList(I.fullLog.slice())}function rd(a){var k=JSON.stringify(I.fullLog);a=new Blob([k],{type:a?"application/octet-stream":"application/json"});return window.URL.createObjectURL(a)}function db(){var a=ga;ga+=2;return l.complex(ba[a],ba[a+1])}function X(a){for(var k=Array(a),
d=0;d<a;++d)k[d]=db();return f.turnIntoCSList(k)}function Ga(a){va[qa]=a.value.real;va[qa+1]=a.value.imag;qa+=2}function S(a){for(var k=0,d=a.value.length;k<d;++k)Ga(a.value[k])}function Ha(a,k){var d=X(3),v=X(3),d=Mc(a,k,d,v);S(d[0]);S(d[1]);return f.turnIntoCSList(d)}function Mc(a,k,d,v){if(Qa)return[a,k];var b=f.projectiveDistMinScal(d,a),c=f.projectiveDistMinScal(d,k),e=f.projectiveDistMinScal(v,a),g=f.projectiveDistMinScal(v,k),l=f.projectiveDistMinScal(d,v),h=f.projectiveDistMinScal(a,k),m=
b+g,n=c+e,p;m>n?(p=[k,a],m=n):p=[a,k];n=function(){};if(I&&I.currentStep){var q=[I.labelTracing2,w.wrap(I.currentElement.name),f.turnIntoCSList(p),f.turnIntoCSList([d,v]),f.realMatrix([[b,c],[e,g]]),w.wrap(m),w.wrap(l),w.wrap(h),u];I.currentStep.push(f.turnIntoCSList(q));n=function(a){I.hasOwnProperty(a)||(I[a]=w.wrap(a));q[q.length-1]=I[a]}}f._helper.isNaN(a)||f._helper.isNaN(k)?(n("Tracing failed due to NaNs."),wa=!0):l>3*m&&h>3*m?n("Normal case, everything all right."):1E-5>h?1E-5>l?n("Staying inside singularity."):
(n("Moved into singularity."),wa=!0):1E-5>l?n("Moved out of singularity."):(cb?n("Reached refinement limit, giving up."):n("Need to refine."),zb());return p}function Xb(a,k,d,v){var b=X(3),c=X(3),e=X(3),g=X(3);a=sd(a,k,d,v,b,c,e,g);S(a[0]);S(a[1]);S(a[2]);S(a[3]);return f.turnIntoCSList(a)}function sd(a,k,d,v,b,c,e,g){var l=function(){};b=[b,c,e,g];a=[a,k,d,v];if(Qa)return a;c=0;v=Array(4);for(d=0;4>d;d++)for(v[d]=Array(4),g=0;4>g;g++)e=f.projectiveDistMinScal(b[d],a[g]),v[d][g]=e;e=Kb(v);k=Array(4);
for(d=0;4>d;++d)k[d]=a[e[d]],c+=v[d][e[d]];var h=1*c,m=Infinity,n=Infinity;for(d=0;4>d;d++){if(f._helper.isNaN(a[d]))return l("Tracing failed due to NaNs."),wa=!0,k;for(g=d+1;4>g;g++)e=f.projectiveDistMinScal(b[d],b[g]),m>e&&(m=e),e=f.projectiveDistMinScal(k[d],k[g]),n>e&&(n=e)}if(I&&I.currentStep){var p=[I.labelTracing4,w.wrap(I.currentElement.name),f.turnIntoCSList(k),f.turnIntoCSList(b),f.realMatrix(v),w.wrap(c),w.wrap(m),w.wrap(n),u];I.currentStep.push(f.turnIntoCSList(p));l=function(a){I.hasOwnProperty(a)||
(I[a]=w.wrap(a));p[p.length-1]=I[a]}}m>h&&n>h||(1E-5>n?1E-5>m?l("Staying inside singularity."):(l("Moved into singularity."),wa=!0):1E-5>m?l("Moved out of singularity."):(cb?l("Reached refinement limit, giving up."):l("Need to refine."),zb()));return k}function Nc(a){var k=a.length,d,v;if(Qa){for(d=0;d<k;++d)ga+=2*a[d].value.length,S(a[d]);return a}var b=Array(k),c=Array(k),e=Array(k),g=99,l=99,h=Array(k);for(d=0;d<k;++d)b[d]=X(a[d].value.length),c[d]=f.normSquared(b[d]).value.real,e[d]=f.normSquared(a[d]).value.real,
h[d]=Array(k);var m;for(d=0;d<k;++d){for(v=0;v<k;++v)m=f.sesquilinearproduct(b[d],a[v]).value,m=(m.real*m.real+m.imag*m.imag)/(c[d]*e[v]),h[d][v]=1-m;for(v=d+1;v<k;++v)m=f.sesquilinearproduct(b[d],b[v]).value,m=(m.real*m.real+m.imag*m.imag)/(c[d]*c[v]),g>1-m&&(g=1-m),m=f.sesquilinearproduct(a[d],a[v]).value,m=(m.real*m.real+m.imag*m.imag)/(e[d]*e[v]),l>1-m&&(l=1-m)}m=Kb(h);v=Array(k);c=0;e=!1;for(d=0;d<k;++d){var c=c+h[d][m[d]],n=v[d]=a[m[d]];S(n);e|=f._helper.isNaN(n)}e|=isNaN(c);a=function(){};
if(I&&I.currentStep){var p=[I.labelTracingSesq,w.wrap(I.currentElement.name),f.turnIntoCSList(v),f.turnIntoCSList(b),f.realMatrix(h),w.wrap(c),w.wrap(g),w.wrap(l),u];I.currentStep.push(f.turnIntoCSList(p));a=function(a){I.hasOwnProperty(a)||(I[a]=w.wrap(a));p[p.length-1]=I[a]}}e?(a("Tracing failed due to NaNs."),wa=!0):g>3*c&&l>3*c?a("Normal case, everything all right."):1E-5>l?1E-5>g?a("Staying inside singularity."):(a("Moved into singularity."),wa=!0):1E-5>g?a("Moved out of singularity."):(cb?a("Reached refinement limit, giving up."):
a("Need to refine."),zb());return v}function Ra(a){if(Ra.hasOwnProperty(a.kind))Ra[a.kind](a)}function Oc(a,k){return function(){a.incidences.push(k.name);k.incidences.push(a.name)}}function Pc(a,k){return{toString:function(){return"point "+a.name+" incident line "+k.name},apply:Oc(a,k),holds:function(){var d=f.scaldiv(f.abs(a.homog),a.homog),v=f.scaldiv(f.abs(k.homog),k.homog);return 1E-13>l.abs(f.scalproduct(d,v)).value.real}}}function Qc(a,k){return{toString:function(){return"point "+a.name+" incident conic "+
k.name},apply:Oc(a,k),holds:function(){var d=w.mult(k.matrix,a.homog),d=w.mult(a.homog,d),d=l.abs(d);1E-13>d.value.real&&(a.incidences.push(k.name),k.incidences.push(a.name))}}}function Gc(){if(0!==Sa.length){for(var a=0;a<Sa.length;++a)Sa[a].apply();Sa=[]}}function td(a){if(!/^Select/.test(a.type)&&!n[a.type].isMovable)return null;var k=w.unwrap,d=l.sum;switch(a.kind){case "P":case "L":return k(a.homog);case "C":return a=a.mat.value,{xx:k(a[0].value[0]),yy:k(a[1].value[1]),zz:k(a[2].value[2]),xy:k(d(a[0].value[1],
a[1].value[0])),xz:k(d(a[0].value[2],a[2].value[0])),yz:k(d(a[1].value[2],a[2].value[1]))};default:return null}}function ud(a){var k={};k.offset=w.unwrap(a.offset);a.to&&(k.to=a.to);a.corner&&(k.corner=a.corner);return k}function vd(a){var k={};wd.forEach(function(d){if(a.hasOwnProperty(d)){var b=w.unwrap(a[d]);null!==b&&void 0!==b&&(k[d]=b)}});var d=td(a);d&&(k.pos=d);a.dock&&(k.dock=ud(a.dock));return k}function xd(){var a=[];E.forEach(function(k){k.tmp||a.push(vd(k))});return a}function cd(a){pa.forEach(function(a){J[a.behavior.type].init(a.behavior,
m[a.name])})}function Fb(a){Gb=0!==a.length;pa=a;Z=[];Yb=[];pa.forEach(function(a){if(a.name){var d=a.name;m[d]&&(m[d].behavior=a.behavior,J[a.behavior.type].init(a.behavior,m[d]),"Mass"===a.behavior.type&&Z.push(m[d]),"Spring"===a.behavior.type&&Yb.push(m[d]))}else J[a.behavior.type].init(a.behavior)})}var ta=this,ia,da={},Da=!1,rb=!0,sb=!1,pb=1,La=0,ic,jc=!1,gb,B,ea,Y,ja,lc=1,ib=null,$c="           #drawgrid(s):=(              regional(b,xmin,xmax,ymin,ymax,nx,ny);              b=screenbounds();              xmin=b_4_1-s;              xmax=b_2_1+s;              ymin=b_4_2-s;              ymax=b_2_2+s;              nx=round((xmax-xmin)/s);              ny=round((ymax-ymin)/s);              xmin=floor(xmin/s)*s;              ymin=floor(ymin/s)*s;              repeat(nx,x,                 draw((xmin+x*s,ymin),(xmin+x*s,ymax),color->(1,1,1)*.9,size->1);              );              repeat(ny,y,                 draw((xmin,ymin+y*s),(xmax,ymin+y*s),color->(1,1,1)*.9,size->1);              )            );",
Wa=[],Hb=!1,ka={config:p,startup:Aa,shutdown:Ba,evokeCS:function(a){a=hb(a);a=na(a,!1);console.log(a);A(a);c()},play:R,pause:Ua,stop:$a,evalcs:function(a){return A(na(hb(a),!1))},niceprint:L,canvas:null},Cb=!1,qb=0;p.use&&p.use.forEach(function(a){var k=null;p.plugins&&(k=p.plugins[a]);k||(k=ta._pluginRegistry[a]);k||(++qb,console.log("Loading script for plugin "+a),ta.loadScript(a+"-plugin",a+"-plugin.js",function(){console.log("Successfully loaded plugin "+a);0===--qb&&Cb&&Aa()},function(){console.error("Failed to auto-load plugin "+
a);0===--qb&&Cb&&Aa()}))});Va.prototype=new Ka;ab.prototype=new Ka;Ja.prototype=new Ka;var W={},ca,mc="",nc=0,yd=[].slice,Zb,Rc=function(a){return yd.call(a)};if(!p.isNode){var zd=document.documentElement;Zb=window;try{Rc(zd.childNodes)[0].nodeType}catch(a){Rc=function(a){for(var d=a.length,v=Array(d);d--;)v[d]=a[d];return v}}}var oc="webkit ms moz Moz o O".split(" "),Ib={},vb,wb,ub,tb,Na,pc=!p.isNode&&Zb[h(Zb,"requestAnimationFrame")]||function(a){setTimeout(a,17)};Ib.timer=function(a,k,d){var v=
arguments.length;2>v&&(k=0);3>v&&(d=Date.now());v={c:a,t:d+k,f:!1,n:null};wb?wb.n=v:vb=v;wb=v;ub||(tb=clearTimeout(tb),ub=1,pc(q))};Ib.timer.flush=function(){r();F()};var Ad=[0,0,0,-1,"g31eff2f"],u=new cc,$b=new cc,Bd=function(a,k){var d,v=0,b=[],c=k.length;for(d=0;d<c;++d)b[d]=v=a[k.charCodeAt(d)-32]+v;v="";for(d=0;d<c;d+=2)v+=String.fromCharCode(b[d]),b[d+1]!==b[d]&&(v+="-"+String.fromCharCode(b[d+1]));return v}([2,0,277,3,4,6,1,5,7,10,17,22,8,9,11,15,12,13,21,25,16,46,18,19,30,37,40,14,24,29,36,
42,52,53,26,27,28,32,35,43,88,20,23,33,34,38,47,48,49,51,56,59,63,65,68,69,102,117,31,39,268,41,45,50,54,55,57,64,66,72,73,74,75,78,81,82,83,84,85,87,89,93,94,98,105,107,108,116,130,132,134,138,146,157,191,332,362,365,457,470,513,619,1164,2684,6581,8453,11171,20940],"U3(3O!.!'!%+ 8 \u0082'./$,! !x$ &##-!   ! 7 k {-})9#!,MfB% 5?>& s !4&,&. #!*! =8H0!3E)&'!%2'!)!$!<<e! )HA$!7!,-4% %%(#&#2 % !$#$!*!;&  /&I''&#2 % & & &E# !I *,   2 % & $$!7!4&>(#&#2 % & $$!Z&  4!6! '$  #$& ! &$&$ $.J!A(   + - $$!C&(&>(   + - $$!K! &4&7(   :#!*!6&3'%*$J , !#%SN &1%S& !#& !#!(# %   ! !#& # &)!#$ !+#K!c( FD$w?2!*''#$!$&, '01!69 !%!#? \u007f ##% ! ##: ##E ##% ! ##; R ##dM/*m1\u0085#4 3%g+0 #/*/*/0  4Q>!'!Vo-: !%W.D@=#$0G+%b+)@l!r56%R=;&.GCF? .Fv# #$&)~U\"#'#9#'#( ! ! ! 8#@ % !$  %$##''0%  %Y!;!*0X!'!#- !$$(! ! ! # )##%$'!A&\u00875 5 y(#$&19 !%!#a,!*+)% % % % % % % %j!\u0083&G$%&'n(  p #%:$q6B`/\u0084\u0088h\u008b@\u0086V^#\\$/.&25*<-W_,#X## #1)i-   # +8Q/PT'$!/C.+BD,5=!P:<  (2+$!%N !$&#$#! !3 #), 1'#'#')% %|L8\u008a1+'O\u0089\u0081#t[%1$%! - 0 $ ! & & uL\u00807T#A].Y$ z93(30H$'#'#'# "),
Cd=new RegExp("^(?:#[1-9]?|[0-9'"+Bd+"]+)$"),K=new function(){this.vars={pi:{ctype:"variable",stack:[{ctype:"number",value:{real:Math.PI,imag:0}}],name:"pi"},i:{ctype:"variable",stack:[{ctype:"number",value:{real:0,imag:1}}],name:"i"},"true":{ctype:"variable",stack:[{ctype:"boolean",value:!0}],name:"true"},"false":{ctype:"variable",stack:[{ctype:"boolean",value:!1}],name:"false"},"#":{ctype:"variable",stack:[u],name:"#"}};this.isVariable=function(a){return this.vars.hasOwnProperty(a)};this.isVariableName=
function(a){return Cd.test(a)};this.create=function(a){var k={ctype:"variable",stack:[$b],name:a};return this.vars[a]=k};this.newvar=function(a){a=this.vars[a];a.stack.push(u);return a};this.removevar=function(a){var k=this.vars[a].stack;0===k.length&&console.error("Removing non-existing "+a);k.pop();0===k.length&&console.warn("Removing last "+a)};this.setvar=function(a,k){var d=this.vars[a].stack;0===d.length&&console.error("Setting non-existing variable "+a);void 0===k&&(console.error("Setting variable "+
a+" to undefined value"),k=u);if("undefined"===k.ctype)d[d.length-1]=k;else{var v=k;v===$b&&(v=u);d[d.length-1]=v}};this.undefinedWarning={};this.getvar=function(a){var k=this.vars[a].stack;0===k.length&&console.error("Getting non-existing variable "+a);k=k[k.length-1];if(k===$b){if(m.hasOwnProperty(a))return{ctype:"geo",value:m[a]};console&&console.log&&void 0===this.undefinedWarning[a]&&(this.undefinedWarning[a]=!0,console.log("Warning: Accessing undefined variable: "+a));return u}return k};this.dump=
function(a){var k=this.vars[a].stack;console.log("*** Dump "+a);for(a=0;a<k.length;a++)console.log(a+":> "+L(k[a]))};this.vstack=[];this.pushVstack=function(a){this.vstack.push(a)};this.popVstack=function(){this.vstack.pop()};this.cleanVstack=function(){for(var a=this.vstack;0<a.length&&"*"!==a[a.length-1];)this.removevar(a[a.length-1]),a.pop();0<a.length&&a.pop()}},ua={generalFields:{color:"color",colorhsb:"",size:"size",alpha:"alpha",isshowing:"isshowing",visible:"visible",name:"name",caption:"caption",
trace:"trace",tracelength:"",selected:""},getGeoField:function(a,k){return"undefined"!==typeof m[a]?ua.getField(m[a],k):u},setGeoField:function(a,k,d){return"undefined"!==typeof m[a]?ua.setField(m[a],k,d):u},getField:function(a,k){var d;if("P"===a.kind){if("xy"===k)return d=ma(a.homog),w.withUsage(d,"Point");if("homog"===k)return w.withUsage(a.homog,"Point");if("x"===k)return l.div(a.homog.value[0],a.homog.value[2]);if("y"===k)return l.div(a.homog.value[1],a.homog.value[2])}if("L"===a.kind||"S"===
a.kind){if("homog"===k)return w.withUsage(a.homog,"Line");if("angle"===k)return d=f.eucangle(f.ey,a.homog),w.withUsage(d,"Angle")}if("Tr"===a.kind&&"matrix"===k)return a.matrix;if("C"===a.kind){if("radius"===k){var v=a.matrix;d=v.value[0].value[0];var b=v.value[0].value[2],c=v.value[1].value[2],v=v.value[2].value[2];l.mult(d,d);b=l.div(b,d);c=l.div(c,d);d=l.div(v,d);return d=l.sqrt(l.sub(l.add(l.mult(b,b),l.mult(c,c)),d))}if("size"===k)return a.size;if("matrix"===k)return a.matrix;if("center"===k)return d=
n._helper.CenterOfConic(a.matrix),d=ma(d),w.withUsage(d,"Point");if("dualMatrix"===k)return f.normalizeMax(f.adjoint3(a.matrix))}if(ua.generalFields[k])return(d=a[ua.generalFields[k]])&&d.ctype?d:"object"!==typeof d?w.wrap(d):u;if(a.behavior){if("mass"===k&&"Mass"===a.behavior.type)return l.real(a.behavior.mass);if("radius"===k&&"Mass"===a.behavior.type)return l.real(a.behavior.radius);if("charge"===k&&"Mass"===a.behavior.type)return l.real(a.behavior.charge);if("friction"===k&&"Mass"===a.behavior.type)return l.real(a.behavior.friction);
if("vx"===k&&"Mass"===a.behavior.type)return l.real(a.behavior.vx);if("vy"===k&&"Mass"===a.behavior.type)return l.real(a.behavior.vy);if("v"===k&&"Mass"===a.behavior.type)return f.realVector([a.behavior.vx,a.behavior.vy]);if("fx"===k&&"Mass"===a.behavior.type)return l.real(a.behavior.fx);if("fy"===k&&"Mass"===a.behavior.type)return l.real(a.behavior.fy);if("f"===k&&"Mass"===a.behavior.type)return f.realVector([a.behavior.fx,a.behavior.fy])}return u},setField:function(a,k,d){var v;"color"===k&&(a.color=
d);"size"===k&&(a.size=d);"alpha"===k&&(a.alpha=d);"visible"===k&&"boolean"===d.ctype&&(a.visible=d.value);"pinned"===k&&"boolean"===d.ctype&&(a.pinned=d.value);"printlabel"===k&&(a.printname=L(d));"xy"===k&&"P"===a.kind&&a.movable&&f._helper.isNumberVecN(d,2)&&Ea(a,f.turnIntoCSList([d.value[0],d.value[1],l.real(1)]),"homog");"xy"===k&&"P"===a.kind&&a.movable&&f._helper.isNumberVecN(d,3)&&Ea(a,d,"homog");"x"===k&&"P"===a.kind&&a.movable&&"number"===d.ctype&&Ea(a,f.turnIntoCSList([l.mult(d,a.homog.value[2]),
a.homog.value[1],a.homog.value[2]]),"homog");"y"===k&&"P"===a.kind&&a.movable&&"number"===d.ctype&&Ea(a,f.turnIntoCSList([a.homog.value[0],l.mult(d,a.homog.value[2]),a.homog.value[2]]),"homog");"homog"===k&&"P"===a.kind&&a.movable&&f._helper.isNumberVecN(d,3)&&Ea(a,d,"homog");"homog"===k&&"L"===a.kind&&a.movable&&f._helper.isNumberVecN(d,3)&&Ea(a,d,"homog");if("angle"===k&&"Through"===a.type){v=l.cos(d);var b=l.sin(d);v=f.turnIntoCSList([v,b,l.real(0)]);Ea(a,v,"dir")}"C"===a.kind&&"radius"===k&&"CircleMr"===
a.type&&"number"===d.ctype&&Ea(a,d,"radius");a.behavior&&("mass"===k&&"Mass"===a.behavior.type&&"number"===d.ctype&&(a.behavior.mass=d.value.real),"mass"===k&&"Sun"===a.behavior.type&&"number"===d.ctype&&(a.behavior.mass=d.value.real),"friction"===k&&"Mass"===a.behavior.type&&"number"===d.ctype&&(a.behavior.friction=d.value.real),"charge"===k&&"Mass"===a.behavior.type&&"number"===d.ctype&&(a.behavior.charge=d.value.real),"radius"===k&&"Mass"===a.behavior.type&&"number"===d.ctype&&(a.behavior.radius=
d.value.real),"vx"===k&&"Mass"===a.behavior.type&&"number"===d.ctype&&(a.behavior.vx=d.value.real),"vy"===k&&"Mass"===a.behavior.type&&"number"===d.ctype&&(a.behavior.vy=d.value.real),"v"===k&&"Mass"===a.behavior.type&&f._helper.isNumberVecN(d,2)&&(a.behavior.vx=d.value[0].value.real,a.behavior.vy=d.value[1].value.real))}},l={_helper:{}};l._helper.roundingfactor=1E4;l._helper.angleroundingfactor=10;l._helper.niceround=function(a,k){return Math.round(a*k)/k};l.niceprint=function(a,k){k=k||l._helper.roundingfactor;
if("Angle"===a.usage)return l._helper.niceangle(a);var d=l._helper.niceround(a.value.real,k),v=l._helper.niceround(a.value.imag,k);return 0===v?""+d:0<v?""+d+" + i*"+v:""+d+" - i*"+-v};var ac=p.angleUnit||"\u00b0",Dd=ac.replace(/\s+/g,""),Sc=2*Math.PI,Ed=1/Sc,Fd={rad:Sc,"\u00b0":360,deg:360,degree:360,gra:400,grad:400,turn:1,cyc:1,rev:1,rot:1,"\u03c0":2,pi:2,quad:4};l._helper.niceangle=function(a){var k=Fd[Dd];if(!k)return l.niceprint(w.withUsage(a,null));if("function"===typeof k)return k(a);a=l.niceprint(l.realmult(k*
Ed,a),200<k?l._helper.angleroundingfactor:null);return-1===a.indexOf("i*")?a+ac:"("+a+")"+ac};l.complex=function(a,k){return{ctype:"number",value:{real:a,imag:k}}};l.real=function(a){return{ctype:"number",value:{real:a,imag:0}}};l.zero=l.real(0);l.one=l.real(1);l.infinity=l.complex(Infinity,Infinity);l.nan=l.complex(NaN,NaN);l._helper.input=function(a){return"object"===typeof a?l.complex(+a.r,+a.i):l.real(+a)};l.argmax=function(a,k){return a.value.real*a.value.real+a.value.imag*a.value.imag<k.value.real*
k.value.real+k.value.imag*k.value.imag?k:a};l.max=function(a,k){return{ctype:"number",value:{real:Math.max(a.value.real,k.value.real),imag:Math.max(a.value.imag,k.value.imag)}}};l.min=function(a,k){return{ctype:"number",value:{real:Math.min(a.value.real,k.value.real),imag:Math.min(a.value.imag,k.value.imag)}}};l.add=function(a,k){return{ctype:"number",value:{real:a.value.real+k.value.real,imag:a.value.imag+k.value.imag}}};l.sub=function(a,k){return{ctype:"number",value:{real:a.value.real-k.value.real,
imag:a.value.imag-k.value.imag}}};l.neg=function(a){return{ctype:"number",value:{real:-a.value.real,imag:-a.value.imag}}};l.re=function(a){return{ctype:"number",value:{real:a.value.real,imag:0}}};l.im=function(a){return{ctype:"number",value:{real:a.value.imag,imag:0}}};l.conjugate=function(a){return{ctype:"number",value:{real:a.value.real,imag:-a.value.imag}}};l.round=function(a){return{ctype:"number",value:{real:Math.round(a.value.real),imag:Math.round(a.value.imag)}}};l.ceil=function(a){return{ctype:"number",
value:{real:Math.ceil(a.value.real),imag:Math.ceil(a.value.imag)}}};l.floor=function(a){return{ctype:"number",value:{real:Math.floor(a.value.real),imag:Math.floor(a.value.imag)}}};l.mult=function(a,k){return{ctype:"number",value:{real:a.value.real*k.value.real-a.value.imag*k.value.imag,imag:a.value.real*k.value.imag+a.value.imag*k.value.real}}};l.realmult=function(a,k){return{ctype:"number",value:{real:a*k.value.real,imag:a*k.value.imag}}};l.multiMult=function(a){var k=a[0];if("number"!==k.ctype)return u;
for(var d=1;d<a.length;d++){if("number"!==a[d].ctype)return u;k=l.mult(k,a[d])}return k};l.abs2=function(a,k){return{ctype:"number",value:{real:a.value.real*a.value.real+a.value.imag*a.value.imag,imag:0}}};l.abs=function(a){return l.sqrt(l.abs2(a))};l.inv=function(a){var k=a.value.real*a.value.real+a.value.imag*a.value.imag;return{ctype:"number",value:{real:a.value.real/k,imag:-a.value.imag/k}}};l.div=function(a,k){return l.mult(a,l.inv(k))};l.eps=1E-10;l.epsbig=1E-6;l.snap=function(a){var k=a.value.real;
a=a.value.imag;Math.floor(k+l.eps)!==Math.floor(k-l.eps)&&(k=Math.round(k));Math.floor(a+l.eps)!==Math.floor(a-l.eps)&&(a=Math.round(a));return{ctype:"number",value:{real:k,imag:a}}};l.exp=function(a){var k=Math.exp(a.value.real);return{ctype:"number",value:{real:k*Math.cos(a.value.imag),imag:k*Math.sin(a.value.imag)}}};l.cos=function(a){var k=a.value.real;a=a.value.imag;var d=Math.exp(a),v=d*Math.sin(-k),b=d*Math.cos(-k),d=Math.exp(-a);return{ctype:"number",value:{real:(b+d*Math.cos(k))/2,imag:(v+
d*Math.sin(k))/2}}};l.sin=function(a){var k=a.value.real;a=a.value.imag;var d=Math.exp(a),v=d*Math.sin(-k),b=d*Math.cos(-k),d=Math.exp(-a);return{ctype:"number",value:{real:-(v-d*Math.sin(k))/2,imag:(b-d*Math.cos(k))/2}}};l.tan=function(a){var k=l.sin(a);a=l.cos(a);return l.div(k,a)};l.arccos=function(a){var k=l.mult(a,l.neg(a)),k=l.sqrt(l.add(l.real(1),k));a=l.add(l.mult(a,l.complex(0,1)),k);a=l.add(l.mult(l.log(a),l.complex(0,1)),l.real(.5*Math.PI));return w.withUsage(a,"Angle")};l.arcsin=function(a){var k=
l.mult(a,l.neg(a)),k=l.sqrt(l.add(l.real(1),k));a=l.add(l.mult(a,l.complex(0,1)),k);a=l.mult(l.log(a),l.complex(0,-1));return w.withUsage(a,"Angle")};l.arctan=function(a){var k=l.log(l.add(l.mult(a,l.complex(0,-1)),l.real(1)));a=l.log(l.add(l.mult(a,l.complex(0,1)),l.real(1)));k=l.mult(l.sub(k,a),l.complex(0,.5));return w.withUsage(k,"Angle")};l.arctan2=function(a,k){var d;if(void 0===k)d=l.real(Math.atan2(a.value.imag,a.value.real));else if(l._helper.isReal(a)&&l._helper.isReal(k))d=l.real(Math.atan2(k.value.real,
a.value.real));else{d=l.add(a,l.mult(l.complex(0,1),k));var v=l.sqrt(l.add(l.mult(a,a),l.mult(k,k)));d=l.mult(l.complex(0,-1),l.log(l.div(d,v)))}return w.withUsage(d,"Angle")};l.sqrt=function(a){var k=a.value.real,d=a.value.imag;a=Math.sqrt(Math.sqrt(k*k+d*d));k=Math.atan2(d,k);return{ctype:"number",value:{real:a*Math.cos(k/2),imag:a*Math.sin(k/2)}}};l.powRealExponent=function(a,k){var d=a.value.real,v=a.value.imag,b=Math.pow(Math.sqrt(d*d+v*v),k),d=Math.atan2(v,d);return{ctype:"number",value:{real:b*
Math.cos(d*k),imag:b*Math.sin(d*k)}}};l.log=function(a){var k=a.value.real;a=a.value.imag;var d=Math.sqrt(k*k+a*a),v=Math.atan2(a,k);0>a&&(v+=2*Math.PI);0===a&&0>k&&(v=Math.PI);v>Math.PI&&(v-=2*Math.PI);return l.snap({ctype:"number",value:{real:Math.log(d),imag:v}})};l.pow=function(a,k){return l._helper.isZero(k)?l.one:l._helper.isZero(a)?l.zero:l._helper.isReal(k)?l.powRealExponent(a,k.value.real):l.exp(l.mult(l.log(a),k))};l.mod=function(a,k){var d=a.value.real,v=k.value.real,b=a.value.imag,c=k.value.imag,
d=d-Math.floor(d/v)*v,b=b-Math.floor(b/c)*c;0===v&&(d=0);0===c&&(b=0);return l.snap({ctype:"number",value:{real:d,imag:b}})};l._helper.seed="NO";l._helper.seedrandom=function(a){a-=Math.floor(a);l._helper.seed=.8*a+.1};l._helper.rand=function(){if("NO"===l._helper.seed)return Math.random();var a=l._helper.seed,a=1E3*Math.sin(1E3*a),a=a-Math.floor(a);return l._helper.seed=a};l._helper.randnormal=function(){var a=l._helper.rand(),k=l._helper.rand();return Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*
k)};l._helper.isEqual=function(a,k){return a.value.real===k.value.real&&a.value.imag===k.value.imag};l._helper.isLessThan=function(a,k){return a.value.real<k.value.real||a.value.real===k.value.real&&a.value.imag<k.value.imag};l._helper.compare=function(a,k){return l._helper.isLessThan(a,k)?-1:l._helper.isEqual(a,k)?0:1};l._helper.isAlmostEqual=function(a,k,d){var v=l.eps;"undefined"!==typeof d&&(v=d);d=a.value.real-k.value.real;a=a.value.imag-k.value.imag;return d<v&&d>-v&&a<v&&a>-v};l._helper.isZero=
function(a){return 0===a.value.real&&0===a.value.imag};l._helper.isAlmostZero=function(a){var k=a.value.real;a=a.value.imag;return k<l.eps&&k>-l.eps&&a<l.eps&&a>-l.eps};l._helper.isReal=function(a){return 0===a.value.imag};l._helper.isAlmostReal=function(a){a=a.value.imag;return a<l.epsbig&&a>-l.epsbig};l._helper.isNaN=function(a){return isNaN(a.value.real)||isNaN(a.value.imag)};l._helper.isFinite=function(a){return isFinite(a.value.real)&&isFinite(a.value.imag)};l._helper.isAlmostImag=function(a){a=
a.value.real;return a<l.epsbig&&a>-l.epsbig};l._helper.z3a=l.complex(-.5,.5*Math.sqrt(3));l._helper.z3b=l.complex(-.5,-.5*Math.sqrt(3));l._helper.cub1={ctype:"list",value:[l.one,l.one,l.one]};l._helper.cub2={ctype:"list",value:[l._helper.z3a,l.one,l._helper.z3b]};l._helper.cub3={ctype:"list",value:[l._helper.z3b,l.one,l._helper.z3a]};l.solveCubic=function(a,k,d,v){a=l._helper.solveCubicHelper(a,k,d,v);return[f.scalproduct(l._helper.cub1,a),f.scalproduct(l._helper.cub2,a),f.scalproduct(l._helper.cub3,
a)]};l._helper.solveCubicHelper=function(a,k,d,v){var b=a.value.real;a=a.value.imag;var c=k.value.real;k=k.value.imag;var e=d.value.real,g=d.value.imag,h=v.value.real,m=v.value.imag,n=b*e-a*g;v=b*g+a*e;d=4*n-(c*c-k*k);var p=4*v-2*c*k,q=b*c-a*k,r=b*k+a*c,u=d*e-p*g-18*(q*h-r*m),p=d*g+p*e-18*(q*m+r*h),t=27*(b*b-a*a),w=54*a*b;d=t*h-w*m;var x=t*m+w*h,y=c*c-k*k,A=2*c*k,z=y*c-A*k,B=y*k+A*c,t=d+4*z,w=x+4*B,z=-2*z+9*(q*e-r*g),B=-2*B+9*(q*g+r*e),z=z-d,B=B-x;d=27*(u*e-p*g+t*h-w*m);p=27*(u*g+p*e+t*m+w*h);t=Math.sqrt(Math.sqrt(d*
d+p*p));w=Math.atan2(p,d);p=t*Math.sin(w/2);d=t*Math.cos(w/2);z+=d*b-p*a;B+=d*a+p*b;d=Math.exp(Math.log(Math.sqrt(z*z+B*B))/3);e=Math.atan2(B,z);t=d*Math.sin(e/3);w=d*Math.cos(e/3);d*=d;e*=2;n=2*y-6*n;v=2*A-6*v;A=-1.5874010519681996*(c*w-k*t);c=-1.5874010519681996*(c*t+k*w);k=1.2599210498948732*d*Math.cos(e/3);e=1.2599210498948732*d*Math.sin(e/3);d=4.762203155904599*(w*b-t*a);p=4.762203155904599*(w*a+t*b);b=d*d+p*p;t=(n*d+v*p)/b;w=(-n*p+v*d)/b;n=t;v=w;t=(A*d+c*p)/b;w=(-A*p+c*d)/b;A=t;c=w;t=(k*d+e*
p)/b;w=(-k*p+e*d)/b;k=t;e=w;return f.turnIntoCSList([l.complex(n,v),l.complex(A,c),l.complex(k,e)])};var f={_helper:{},turnIntoCSList:function(a){return{ctype:"list",value:a}},realVector:function(a){for(var k=[],d=0;d<a.length;d++)k[d]={ctype:"number",value:{real:a[d],imag:0}};return{ctype:"list",value:k}}};f._helper.unitvector=function(a,k){var d=f.zerovector(a);d.value[Math.floor(k.value.real-1)]=l.real(1);return d};f.idMatrix=function(a){for(var k=f.zeromatrix(a,a),d=l.real(1),b=0;b<a.value.real;b++)k.value[b].value[b]=
d;return k};f._helper.flippedidMatrix=function(a){for(var k=f.zeromatrix(a,a),d=l.real(1),b=0;b<a.value.real;b++)k.value[b].value[a.value.real-b-1]=d;return k};f.println=function(a){for(var k=[],d=0;d<a.value.length;d++)if("number"===a.value[d].ctype)k[d]=l.niceprint(a.value[d]);else if("list"===a.value[d].ctype)f.println(a.value[d]);else return u;"number"===a.value[0].ctype&&console.log(k)};f.matrix=function(a){return f.turnIntoCSList(a.map(f.turnIntoCSList))};f.realMatrix=function(a){for(var k=
a.length,d=Array(k),b=0;b<k;b++)d[b]=f.realVector(a[b]);return f.turnIntoCSList(d)};f.ex=f.realVector([1,0,0]);f.ey=f.realVector([0,1,0]);f.ez=f.realVector([0,0,1]);f.linfty=f.realVector([0,0,1]);f.ii=f.turnIntoCSList([l.complex(1,0),l.complex(0,1),l.complex(0,0)]);f.jj=f.turnIntoCSList([l.complex(1,0),l.complex(0,-1),l.complex(0,0)]);f.fundDual=f.realMatrix([[1,0,0],[0,1,0],[0,0,0]]);f.fund=f.realMatrix([[0,0,0],[0,0,0],[0,0,1]]);f.sequence=function(a,k){for(var d=[],b=0,c=Math.round(a.value.real);c<
Math.round(k.value.real)+1;c++)d[b]={ctype:"number",value:{real:c,imag:0}},b++;return{ctype:"list",value:d}};f.pairs=function(a){for(var k=[],d=0;d<a.value.length-1;d++)for(var b=d+1;b<a.value.length;b++)k.push({ctype:"list",value:[a.value[d],a.value[b]]});return{ctype:"list",value:k}};f.triples=function(a){for(var k=[],d=0;d<a.value.length-2;d++)for(var b=d+1;b<a.value.length-1;b++)for(var c=b+1;c<a.value.length;c++)k.push({ctype:"list",value:[a.value[d],a.value[b],a.value[c]]});return{ctype:"list",
value:k}};f.cycle=function(a){for(var k=[],d=0;d<a.value.length-1;d++)k[d]={ctype:"list",value:[a.value[d],a.value[d+1]]};k.push({ctype:"list",value:[a.value[a.value.length-1],a.value[0]]});return{ctype:"list",value:k}};f.consecutive=function(a){for(var k=[],d=0;d<a.value.length-1;d++)k[d]={ctype:"list",value:[a.value[d],a.value[d+1]]};return{ctype:"list",value:k}};f.reverse=function(a){for(var k=[],d=a.value.length-1;0<=d;d--)k.push(a.value[d]);return{ctype:"list",value:k}};f.directproduct=function(a,
k){for(var d=[],b=0;b<a.value.length;b++)for(var c=0;c<k.value.length;c++)d.push({ctype:"list",value:[a.value[b],k.value[c]]});return{ctype:"list",value:d}};f.concat=function(a,k){for(var d=[],b=0;b<a.value.length;b++)d.push(a.value[b]);for(b=0;b<k.value.length;b++)d.push(k.value[b]);return{ctype:"list",value:d}};f.prepend=function(a,k){var d=[];d[0]=a;for(var b=0;b<k.value.length;b++)d[b+1]=k.value[b];return{ctype:"list",value:d}};f.append=function(a,k){for(var d=[],b=0;b<a.value.length;b++)d[b]=
a.value[b];d.push(k);return{ctype:"list",value:d}};f.contains=function(a,k){for(var d=0;d<a.value.length;d++)if(D.equals(a.value[d],k).value)return{ctype:"boolean",value:!0};return{ctype:"boolean",value:!1}};f.common=function(a,k){for(var d=[],b=0,c=0;c<a.value.length;c++){for(var f=!1,e=a.value[c],g=0;g<k.value.length;g++)f=f||D.equals(e,k.value[g]).value;f&&(d[b]=a.value[c],b++)}return{ctype:"list",value:d}};f.remove=function(a,k){for(var d=[],b=0,c=0;c<a.value.length;c++){for(var f=!1,e=a.value[c],
g=0;g<k.value.length;g++)f=f||D.equals(e,k.value[g]).value;f||(d[b]=a.value[c],b++)}return{ctype:"list",value:d}};f.sort1=function(a){a=a.value.slice();a.sort(w.compare);return f.turnIntoCSList(a)};f._helper.isEqual=function(a,k){return f.equals(a,k).value};f._helper.isLessThan=function(a,k){for(var d=a.value.length,b=k.value.length,c=0;!(c>=d||c>=b)&&w.isEqual(a.value[c],k.value[c]);)c++;return c===d&&c<b?!0:c===b&&c<d||c===d&&c===b?!1:w.isLessThan(a.value[c],k.value[c])};f._helper.compare=function(a,
k){return f._helper.isLessThan(a,k)?-1:f._helper.isEqual(a,k)?0:1};f.equals=function(a,k){if(a.value.length!==k.value.length)return{ctype:"boolean",value:!1};for(var d=!0,b=0;b<a.value.length;b++)var c=a.value[b],e=k.value[b],d="list"===c.ctype&&"list"===e.ctype?d&&f.equals(c,e).value:d&&ob([c,e],[]).value;return{ctype:"boolean",value:d}};f.almostequals=function(a,k){if(a.value.length!==k.value.length)return{ctype:"boolean",value:!1};for(var d=!0,b=0;b<a.value.length;b++)var c=a.value[b],e=k.value[b],
d="list"===c.ctype&&"list"===e.ctype?d&&f.comp_almostequals(c,e).value:d&&Bb([c,e],[]).value;return{ctype:"boolean",value:d}};f._helper.isAlmostReal=function(a){for(var k=!0,d=0;d<a.value.length;d++)var b=a.value[d],k="list"===b.ctype?k&&f._helper.isAlmostReal(b):k&&l._helper.isAlmostReal(b);return k};f._helper.isAlmostZero=function(a){for(var k=0;k<a.value.length;k++){var d=a.value[k];if("list"===d.ctype){if(!f._helper.isAlmostZero(d))return!1}else if(!l._helper.isAlmostZero(d))return!1}return!0};
f._helper.isNaN=function(a){for(var k=!1,d=0;d<a.value.length;d++)var b=a.value[d],k="list"===b.ctype?k||f._helper.isNaN(b):k||l._helper.isNaN(b);return k};f.set=function(a){var k=[],d=0;a=a.value.slice();a.sort(w.compare);for(var b=0;b<a.length;b++)0!==b&&ob([k[k.length-1],a[b]],[]).value||(k[d]=a[b],d++);return{ctype:"list",value:k}};f.maxval=function(a){for(var k=l.zero,d=0;d<a.value.length;d++){var b=a.value[d];"number"===b.ctype&&(k=l.argmax(k,b));"list"===b.ctype&&(k=l.argmax(k,f.maxval(b)))}return k};
f.maxIndex=function(a,k,d){var b=0;void 0!==d&&(b=d);d=b;for(var c=k(a.value[b]).value.real;b<a.value.length;++b){var f=k(a.value[b]).value.real;f>c&&(d=b,c=f)}return d};f.normalizeMax=function(a){var k=l.inv(f.maxval(a));return l._helper.isFinite(k)?f.scalmult(k,a):a};f.normalizeZ=function(a){var k=l.inv(a.value[2]);return f.scalmult(k,a)};f.normalizeAbs=function(a){var k=l.inv(f.abs(a));return f.scalmult(k,a)};f.max=function(a,k){if(a.value.length!==k.value.length)return u;for(var d=[],b=0;b<a.value.length;b++)d[b]=
w.max(a.value[b],k.value[b]);return{ctype:"list",value:d}};f.min=function(a,k){if(a.value.length!==k.value.length)return u;for(var d=[],b=0;b<a.value.length;b++)d[b]=w.min(a.value[b],k.value[b]);return{ctype:"list",value:d}};f.scaldiv=function(a,k){if("number"!==a.ctype)return u;for(var d=[],b=0;b<k.value.length;b++){var c=k.value[b];d[b]="number"===c.ctype?w.div(c,a):"list"===c.ctype?f.scaldiv(a,c):u}return{ctype:"list",value:d}};f.scalmult=function(a,k){if("number"!==a.ctype)return u;for(var d=
[],b=0;b<k.value.length;b++){var c=k.value[b];d[b]="number"===c.ctype?w.mult(c,a):"list"===c.ctype?f.scalmult(a,c):u}return{ctype:"list",value:d}};f.add=function(a,k){if(a.value.length!==k.value.length)return u;for(var d=[],b=0;b<a.value.length;b++){var c=a.value[b],e=k.value[b];d[b]="number"===c.ctype&&"number"===e.ctype?w.add(c,e):"list"===c.ctype&&"list"===e.ctype?f.add(c,e):u}return{ctype:"list",value:d}};f.sub=function(a,k){if(a.value.length!==k.value.length)return u;for(var d=[],b=0;b<a.value.length;b++){var c=
a.value[b],e=k.value[b];d[b]="number"===c.ctype&&"number"===e.ctype?l.sub(c,e):"list"===c.ctype&&"list"===e.ctype?f.sub(c,e):u}return{ctype:"list",value:d}};f.abs2=function(a){for(var k=0,d=0;d<a.value.length;d++){var b=a.value[d];if("number"===b.ctype)k+=l.abs2(b).value.real;else if("list"===b.ctype)k+=f.abs2(b).value.real;else return u}return{ctype:"number",value:{real:k,imag:0}}};f.abs=function(a){return l.sqrt(f.abs2(a))};f.normalizeMaxXX=function(a){for(var k=-1E4,d=l.real(1),b=0;b<a.value.length;b++){var c=
l.abs(a.value[b]);c.value.real>k&&(d=a.value[b],k=c.value.real)}return f.scaldiv(d,a)};f.recursive=function(a,k){for(var d=[],b=0;b<a.value.length;b++){var c=C(a.value[b]);d[b]="number"===c.ctype?l[k](c):"list"===c.ctype?f[k](c):u}return{ctype:"list",value:d}};f.re=function(a){return f.recursive(a,"re")};f.neg=function(a){return f.recursive(a,"neg")};f.im=function(a){return f.recursive(a,"im")};f.conjugate=function(a){return f.recursive(a,"conjugate")};f.transjugate=function(a){return f.transpose(f.conjugate(a))};
f.round=function(a){return f.recursive(a,"round")};f.ceil=function(a){return f.recursive(a,"ceil")};f.floor=function(a){return f.recursive(a,"floor")};f._helper.colNumb=function(a){if("list"!==a.ctype)return-1;for(var k=-1,d=0;d<a.value.length;d++){if("list"!==a.value[d].ctype)return-1;if(0===d)k=a.value[d].value.length;else if(k!==a.value[d].value.length)return-1}return k};f._helper.isNumberVecN=function(a,k){if("list"!==a.ctype||a.value.length!==k)return!1;for(var d=0;d<a.value.length;d++)if("number"!==
a.value[d].ctype)return!1;return!0};f.isNumberVector=function(a){if("list"!==a.ctype)return{ctype:"boolean",value:!1};for(var k=0;k<a.value.length;k++)if("number"!==a.value[k].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};f.isNumberVectorN=function(a,k){if("list"!==a.ctype)return{ctype:"boolean",value:!1};if(a.value)for(var d=0;d<a.value.length;d++)if("number"!==a.value[d].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};f.isNumberMatrix=function(a){if(-1===
f._helper.colNumb(a))return{ctype:"boolean",value:!1};for(var k=0;k<a.value.length;k++)if(!f.isNumberVector(a.value[k]).value)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};f.scalproduct=function(a,k){if(a.value.length!==k.value.length)return u;for(var d={ctype:"number",value:{real:0,imag:0}},b=0;b<k.value.length;b++){var c=a.value[b],f=k.value[b];if("number"===c.ctype&&"number"===f.ctype)d=l.add(l.mult(c,f),d);else return u}return d};f.sesquilinearproduct=function(a,k){if(a.value.length!==
k.value.length)return u;for(var d=0,b=0,c=0;c<k.value.length;c++)var f=a.value[c].value,e=k.value[c].value,d=d+(f.real*e.real+f.imag*e.imag),b=b+(f.real*e.imag-f.imag*e.real);return l.complex(d,b)};f.normSquared=function(a){for(var k=0,d=0;d<a.value.length;d++)var b=a.value[d].value,k=k+(b.real*b.real+b.imag*b.imag);return l.real(k)};f.productMV=function(a,k){if(a.value[0].value.length!==k.value.length)return u;for(var d=[],b=0;b<a.value.length;b++){for(var c={ctype:"number",value:{real:0,imag:0}},
e=a.value[b],g=0;g<k.value.length;g++){var h=e.value[g],m=k.value[g];if("number"===h.ctype&&"number"===m.ctype)c=l.add(l.mult(h,m),c);else return u}d[b]=c}return f.turnIntoCSList(d)};f.productVM=function(a,k){if(a.value.length!==k.value.length)return u;for(var d=[],b=0;b<k.value[0].value.length;b++){for(var c={ctype:"number",value:{real:0,imag:0}},e=0;e<a.value.length;e++){var g=a.value[e],h=k.value[e].value[b];if("number"===g.ctype&&"number"===h.ctype)c=l.add(l.mult(g,h),c);else return u}d[b]=c}return f.turnIntoCSList(d)};
f.productMM=function(a,k){if(a.value[0].value.length!==k.value.length)return u;for(var d=[],b=0;b<a.value.length;b++){var c=f.productVM(a.value[b],k);d[b]=c}return f.turnIntoCSList(d)};f.mult=function(a,k){return a.value.length===k.value.length&&f.isNumberVector(a).value&&f.isNumberVector(k).value?f.scalproduct(a,k):f.isNumberMatrix(a).value&&k.value.length===a.value[0].value.length&&f.isNumberVector(k).value?f.productMV(a,k):f.isNumberMatrix(k).value&&a.value.length===k.value.length&&f.isNumberVector(a).value?
f.productVM(a,k):f.isNumberMatrix(a).value&&f.isNumberMatrix(k)&&k.value.length===a.value[0].value.length?f.productMM(a,k):u};f.projectiveDistMinScal=function(a,k){var d=f.abs(a),b=f.abs(k);if(0===d.value.real||0===b.value.real)return 0;var c=f.conjugate(k),c=f.scalproduct(a,c),c=l._helper.isAlmostZero(c)?l.real(1):l.div(c,l.abs(c)),d=f.scaldiv(d,a),b=f.scaldiv(b,k),b=f.scalmult(c,b),c=f.abs(f.add(d,b)),b=f.abs(f.sub(d,b));return Math.min(c.value.real,b.value.real)};f.conicDist=function(a,k){var d=
aa(a),b=aa(k);console.log(L(d),L(b));return f.projectiveDistMinScal(d,b)};f.crossOperator=function(a){var k=a.value[0],d=a.value[1];a=a.value[2];return f.turnIntoCSList([f.turnIntoCSList([l.zero,l.neg(a),d]),f.turnIntoCSList([a,l.zero,l.neg(k)]),f.turnIntoCSList([l.neg(d),k,l.zero])])};f.cross=function(a,k){var d=l.sub(l.mult(a.value[1],k.value[2]),l.mult(a.value[2],k.value[1])),b=l.sub(l.mult(a.value[2],k.value[0]),l.mult(a.value[0],k.value[2])),c=l.sub(l.mult(a.value[0],k.value[1]),l.mult(a.value[1],
k.value[0]));return f.turnIntoCSList([d,b,c])};f.crossratio3harm=function(a,k,d,b,c){var e=f.det3(a,d,c),g=f.det3(k,b,c);a=f.det3(a,b,c);k=f.det3(k,d,c);e=l.mult(e,g);g=l.mult(a,k);return f.turnIntoCSList([e,g])};f.crossratio3=function(a,k,d,b,c){a=f.crossratio3harm(a,k,d,b,c);return l.div(a.value[0],a.value[1])};f.veronese=function(a){var k=l.mult(a.value[0],a.value[0]),d=l.mult(a.value[1],a.value[1]),b=l.mult(a.value[2],a.value[2]),c=l.mult(a.value[0],a.value[1]),e=l.mult(a.value[0],a.value[2]);
a=l.mult(a.value[1],a.value[2]);return f.turnIntoSCList([k,d,b,c,e,a])};f.matrixFromVeronese=function(a){var k=a.value[0],d=a.value[1],b=a.value[2],c=l.realmult(.5,a.value[3]),e=l.realmult(.5,a.value[4]);a=l.realmult(.5,a.value[5]);return f.turnIntoCSList([f.turnIntoCSList([k,c,e]),f.turnIntoCSList([c,d,a]),f.turnIntoCSList([e,a,b])])};f.det2=function(a,k){var d=l.mult(a.value[0],k.value[1]);return d=l.sub(d,l.mult(a.value[1],k.value[0]))};f.det3=function(a,k,d){return l.complex(a.value[0].value.real*
k.value[1].value.real*d.value[2].value.real-a.value[0].value.imag*k.value[1].value.imag*d.value[2].value.real-a.value[0].value.imag*k.value[1].value.real*d.value[2].value.imag-a.value[0].value.real*k.value[1].value.imag*d.value[2].value.imag+a.value[2].value.real*k.value[0].value.real*d.value[1].value.real-a.value[2].value.imag*k.value[0].value.imag*d.value[1].value.real-a.value[2].value.imag*k.value[0].value.real*d.value[1].value.imag-a.value[2].value.real*k.value[0].value.imag*d.value[1].value.imag+
a.value[1].value.real*k.value[2].value.real*d.value[0].value.real-a.value[1].value.imag*k.value[2].value.imag*d.value[0].value.real-a.value[1].value.imag*k.value[2].value.real*d.value[0].value.imag-a.value[1].value.real*k.value[2].value.imag*d.value[0].value.imag-a.value[0].value.real*k.value[2].value.real*d.value[1].value.real+a.value[0].value.imag*k.value[2].value.imag*d.value[1].value.real+a.value[0].value.imag*k.value[2].value.real*d.value[1].value.imag+a.value[0].value.real*k.value[2].value.imag*
d.value[1].value.imag-a.value[2].value.real*k.value[1].value.real*d.value[0].value.real+a.value[2].value.imag*k.value[1].value.imag*d.value[0].value.real+a.value[2].value.imag*k.value[1].value.real*d.value[0].value.imag+a.value[2].value.real*k.value[1].value.imag*d.value[0].value.imag-a.value[1].value.real*k.value[0].value.real*d.value[2].value.real+a.value[1].value.imag*k.value[0].value.imag*d.value[2].value.real+a.value[1].value.imag*k.value[0].value.real*d.value[2].value.imag+a.value[1].value.real*
k.value[0].value.imag*d.value[2].value.imag,-a.value[0].value.imag*k.value[1].value.imag*d.value[2].value.imag+a.value[0].value.imag*k.value[1].value.real*d.value[2].value.real+a.value[0].value.real*k.value[1].value.real*d.value[2].value.imag+a.value[0].value.real*k.value[1].value.imag*d.value[2].value.real-a.value[2].value.imag*k.value[0].value.imag*d.value[1].value.imag+a.value[2].value.imag*k.value[0].value.real*d.value[1].value.real+a.value[2].value.real*k.value[0].value.real*d.value[1].value.imag+
a.value[2].value.real*k.value[0].value.imag*d.value[1].value.real-a.value[1].value.imag*k.value[2].value.imag*d.value[0].value.imag+a.value[1].value.imag*k.value[2].value.real*d.value[0].value.real+a.value[1].value.real*k.value[2].value.real*d.value[0].value.imag+a.value[1].value.real*k.value[2].value.imag*d.value[0].value.real+a.value[0].value.imag*k.value[2].value.imag*d.value[1].value.imag-a.value[0].value.imag*k.value[2].value.real*d.value[1].value.real-a.value[0].value.real*k.value[2].value.real*
d.value[1].value.imag-a.value[0].value.real*k.value[2].value.imag*d.value[1].value.real+a.value[2].value.imag*k.value[1].value.imag*d.value[0].value.imag-a.value[2].value.imag*k.value[1].value.real*d.value[0].value.real-a.value[2].value.real*k.value[1].value.real*d.value[0].value.imag-a.value[2].value.real*k.value[1].value.imag*d.value[0].value.real+a.value[1].value.imag*k.value[0].value.imag*d.value[2].value.imag-a.value[1].value.imag*k.value[0].value.real*d.value[2].value.real-a.value[1].value.real*
k.value[0].value.real*d.value[2].value.imag-a.value[1].value.real*k.value[0].value.imag*d.value[2].value.real)};f.det4m=function(a){var k=a.value,d=k[0].value,b=d[0].value,c=+b.real,f=+b.imag,b=d[1].value,e=+b.real,g=+b.imag,b=d[2].value,h=+b.real,m=+b.imag,b=d[3].value,n=+b.real,p=+b.imag,d=k[1].value,b=d[0].value,q=+b.real,r=+b.imag,b=d[1].value,u=+b.real,t=+b.imag,b=d[2].value,w=+b.real,x=+b.imag,b=d[3].value,d=+b.real,b=+b.imag;a=c*u-f*t-e*q+g*r;var y=c*t+f*u-e*r-g*q,z=c*w-f*x-h*q+m*r,A=c*x+f*
w-h*r-m*q,B=c*d-f*b-n*q+p*r,C=c*b+f*d-n*r-p*q,D=e*w-g*x-h*u+m*t,E=e*x+g*w-h*t-m*u,F=e*d-g*b-n*u+p*t,G=e*b+g*d-n*t-p*u,I=h*d-m*b-n*w+p*x,H=h*b+m*d-n*x-p*w,d=k[2].value,b=d[0].value,c=+b.real,f=+b.imag,b=d[1].value,e=+b.real,g=+b.imag,b=d[2].value,h=+b.real,m=+b.imag,b=d[3].value,n=+b.real,p=+b.imag,d=k[3].value,b=d[0].value,q=+b.real,r=+b.imag,b=d[1].value,u=+b.real,t=+b.imag,b=d[2].value,w=+b.real,x=+b.imag,b=d[3].value,d=+b.real,b=+b.imag,k=c*u-f*t-e*q+g*r,Tc=c*t+f*u-e*r-g*q,J=c*w-f*x-h*q+m*r,K=
c*x+f*w-h*r-m*q,L=c*d-f*b-n*q+p*r,c=c*b+f*d-n*r-p*q,f=e*w-g*x-h*u+m*t,q=e*x+g*w-h*t-m*u,r=e*d-g*b-n*u+p*t,e=e*b+g*d-n*t-p*u,g=h*d-m*b-n*w+p*x,h=h*b+m*d-n*x-p*w;return l.complex(a*g-y*h-z*r+A*e+B*f-C*q+D*L-E*c-F*J+G*K+I*k-H*Tc,a*h+y*g-z*e-A*r+B*q+C*f+D*c+E*L-F*K-G*J+I*Tc+H*k)};f.eucangle=function(a,k){var d=f.cross(a,f.linfty),b=f.cross(k,f.linfty),c=f.det3(f.ez,d,f.ii),d=f.det3(f.ez,d,f.jj),e=f.det3(f.ez,b,f.ii),b=f.det3(f.ez,b,f.jj),c=l.div(l.mult(c,b),l.mult(e,d)),c=l.log(c);return c=l.mult(c,l.complex(0,
.5))};f.zerovector=function(a){a=Math.floor(a.value.real);for(var k=Array(a),d=0;d<a;d++)k[d]=0;return f.realVector(k)};f.zeromatrix=function(a,k){for(var d=Math.floor(a.value.real),b=Array(d),c=0;c<d;c++)b[c]=f.zerovector(k);return f.turnIntoCSList(b)};f.vandermonde=function(a){for(var k=a.value.length,d=f.zeromatrix(k,k),b=0;b<k;b++)for(var c=0;c<k;c++)d.value[b].value[c]=l.pow(a.value[b],l.real(c-1));return d};f.transpose=function(a){for(var k=[],d=a.value[0].value.length,b=a.value.length,c=0;c<
d;c++){for(var e=[],g=0;g<b;g++)e[g]=a.value[g].value[c];k[c]=f.turnIntoCSList(e)}return f.turnIntoCSList(k)};f.column=function(a,k){for(var d=[],b=a.value.length,c=Math.floor(k.value.real-1),e=0;e<b;e++)d[e]=a.value[e].value[c];return f.turnIntoCSList(d)};f.row=function(a,k){for(var d=[],b=a.value[0].value.length,c=Math.floor(k.value.real-1),e=0;e<b;e++)d[e]=a.value[c].value[e];return f.turnIntoCSList(d)};f.adjoint2=function(a){var k=a.value[0].value[0],d=a.value[1].value[0],b=Array(2);b[0]=f.turnIntoCSList([a.value[1].value[1],
l.neg(a.value[0].value[1])]);b[1]=f.turnIntoCSList([l.neg(d),k]);return b=f.turnIntoCSList(b)};f.adjoint3=function(a){var k,d,b,c,e,f,g,h,l,m,n,p,q,r,u,t,w;k=a.value[0].value;d=k[0].value;b=d.real;c=d.imag;d=k[1].value;e=d.real;f=d.imag;d=k[2].value;g=d.real;h=d.imag;k=a.value[1].value;d=k[0].value;l=d.real;m=d.imag;d=k[1].value;n=d.real;p=d.imag;d=k[2].value;q=d.real;r=d.imag;k=a.value[2].value;d=k[0].value;a=d.real;u=d.imag;d=k[1].value;t=d.real;w=d.imag;d=k[2].value;k=d.real;d=d.imag;return{ctype:"list",
value:[{ctype:"list",value:[{ctype:"number",value:{real:n*k-q*t-p*d+r*w,imag:n*d-q*w-t*r+k*p}},{ctype:"number",value:{real:-e*k+g*t+f*d-h*w,imag:-e*d+g*w+t*h-k*f}},{ctype:"number",value:{real:e*q-g*n-f*r+h*p,imag:e*r-g*p-n*h+q*f}}]},{ctype:"list",value:[{ctype:"number",value:{real:-l*k+q*a+m*d-r*u,imag:-l*d+q*u+a*r-k*m}},{ctype:"number",value:{real:b*k-g*a-c*d+h*u,imag:b*d-g*u-a*h+k*c}},{ctype:"number",value:{real:-b*q+g*l+c*r-h*m,imag:-b*r+g*m+l*h-q*c}}]},{ctype:"list",value:[{ctype:"number",value:{real:l*
t-n*a-m*w+p*u,imag:l*w-n*u-a*p+t*m}},{ctype:"number",value:{real:-b*t+e*a+c*w-f*u,imag:-b*w+e*u+a*f-t*c}},{ctype:"number",value:{real:b*n-e*l-c*p+f*m,imag:b*p-e*m-l*f+n*c}}]}]}};f.inverse=function(a){var k=a.value.length;if(k!==a.value[0].value.length)return console.log("Inverse works only for square matrices"),u;if(2===k)return f.scaldiv(f.det(a),f.adjoint2(a));if(3===k)return f.scaldiv(f.det(a),f.adjoint3(a));k=f.LUdecomp(a);a=a.value.length;var d=l.real(0),b=l.real(1),c=f.zerovector(l.real(a));
c.value[0]=b;for(var e=Array(a),g=0;g<a;g++)e[g]=f._helper.LUsolve(k,c),c.value[g]=d,c.value[g+1]=b;e=f.turnIntoCSList(e);return e=f.transpose(e)};f.linearsolve=function(a,k){return 2===a.value.length?f.linearsolveCramer2(a,k):3===a.value.length?f.linearsolveCramer3(a,k):f.LUsolve(a,k)};f.getDiag=function(a){if(a.value.length!==a.value[0].value.length)return u;for(var k=Array(a.value.length),d=0;d<a.value.length;d++)k[d]=a.value[d].value[d];return f.turnIntoCSList(k)};f.getSubDiag=function(a){if(a.value.length!==
a.value[0].value.length)return u;for(var k=Array(a.value.length-1),d=0;d<a.value.length-1;d++)k[d]=a.value[d+1].value[d];return f.turnIntoCSList(k)};f.eig2=function(a){var k=l.add(a.value[0].value[0],a.value[1].value[1]);a=f.det2(a.value[0],a.value[1]);var d=l.mult(k,k),b=k=l.mult(k,l.real(.5));a=l.sqrt(l.sub(l.div(d,l.real(4)),a));k=l.add(k,a);b=l.sub(b,a);return f.turnIntoCSList([k,b])};f.eig=function(a,k){var d=k||!0,b=a,c=l.real(b.value.length),e=c.value.real;l.real(0);var b=f._helper.QRIteration(b)[0],
b=f.getDiag(b),b=f.sort1(b),c=f.idMatrix(c,c),g=Array(e),g=f.turnIntoCSList(g);if(d){for(var h,m,n,p=0,q=!1,d=0;d<e;d++)q?m=h.value[p]:(h=b.value[d],h=f.sub(a,f.scalmult(h,c)),h=f.nullSpace(h),m=h.value[0],void 0!==m&&(n=m)),void 0===m&&(m=n),1E-8>f.abs(m).value.real&&0===p&&(m=f._helper.inverseIteration(a,b.value[d])),g.value[d]=f._helper.isAlmostZeroVec(m)?m:f.scaldiv(f.abs(m),m),d<e-1&&((q=1E-6>l.abs(l.sub(b.value[d],b.value[d+1])).value.real)?p++:p=0);g=f.transpose(g)}return f.turnIntoCSList([b,
g])};f._helper.isNormalMatrix=function(a){return 1E-10>f.abs(f.sub(a,f.transjugate(a))).value.real};f._helper.QRIteration=function(a,k){var d,b=a;d=l.real(b.value.length);var c=d.value.real,e=d.value.real;l.real(0);var g=f.idMatrix(d,d),h=f.zeromatrix(d,d),m=f.idMatrix(d,d),n=k?k:2500,p,q,r,u=0,t=Array(e);for(d=0;d<n;d++){g=f._helper.getBlock(b,[e-2,e-1],[e-2,e-1]);p=f.eig2(g);g=p.value[0];p=p.value[1];f.abs(g);f.abs(p);q=b.value[e-1].value[e-1];r=l.abs(l.sub(q,g)).value.real;q=l.abs(l.sub(q,p)).value.real;
p=r<q?g:p;g=f.idMatrix(l.real(e),l.real(e));p=f.scalmult(p,g);g=f.QRdecomp(f.sub(b,p));b=w.mult(g.R,g.Q);b=f.add(b,p);g.Q=f._helper.buildBlockMatrix(g.Q,f.idMatrix(l.real(u),l.real(u)));m=w.mult(m,g.Q);if(1E-48>l.abs2(b.value[b.value.length-1].value[b.value[0].value.length-2]).value.real&&1<e){t[c-u-1]=b.value[e-1].value[e-1];for(d=0;d<e;d++)h.value[e-1].value[d]=b.value[e-1].value[d],h.value[d].value[e-1]=b.value[d].value[e-1];b=f._helper.getBlock(b,[0,e-2],[0,e-2]);u++;e--}if(1===e){h.value[0].value[0]=
b.value[0].value[0];break}if(f._helper.isUpperTriangular(b)){for(d=0;d<e;d++)h.value[d].value[d]=b.value[d].value[d];break}}return[h,m]};f.rank=function(a,k){return f.RRQRdecomp(a,k).rank};f._helper.isAlmostZeroVec=function(a){for(var k=a.value.length,d=0;d<k;d++)if(!l._helper.isAlmostZero(a.value[d]))return!1;return!0};f._helper.isLowerTriangular=function(a){for(var k=a.value.length,d=a.value[0].value.length,b=0;b<k;b++)for(var c=b+1;c<d;c++)if(!l._helper.isAlmostZero(a.value[b].value[c]))return!1;
return!0};f._helper.isUpperTriangular=function(a){return f._helper.isLowerTriangular(f.transpose(a))};f._helper.isAlmostId=function(a){var k=a.value.length,d=l.real(k);if(k!==a.value[0].value.length)return!1;a=f.sub(a,f.idMatrix(d),d);for(d=0;d<k;d++)for(var b=0;b<k;b++)if(1E-16<l.abs(a.value[d].value[b]).value.real)return!1;return!0};f.nullSpace=function(a,k){var d=a.value.length,b=f.RRQRdecomp(f.transjugate(a),k),c=f.transpose(b.Q),b=d-b.rank.value.real,e=Array(b);c.value.reverse();for(var g,h=
0;h<b;h++)g=c.value[h],e[h]=f.scaldiv(f.abs(g),g);e=f.turnIntoCSList(e);return 0<e.value.length?e:f.turnIntoCSList([f.zerovector(l.real(d))])};f._helper.isAlmostDiagonal=function(a){var k=a.value.length;l.real(k);l.real(0);if(k!==a.value[0].value.length)return!1;for(var d=0;d<k;d++)for(var b=0;b<k;b++)if(d!==b&&1E-16<l.abs(a.value[d].value[b]).value.real)return!1;return!0};f._helper.inverseIteration=function(a,k){console.log("warning: code untested");for(var d=a.value.length,b=Array(d),c=0;c<d;c++)b[c]=
2*Math.random()-.5;var c=b=f.realVector(b),d=f.idMatrix(l.real(d),l.real(d)),e;e=l.add(k,l.real(.1*Math.random()-.5));for(var g=0;100>g;g++)c=f.scaldiv(f.abs(b),b),b=f.LUsolve(f.sub(a,f.scalmult(e,d)),JSON.parse(JSON.stringify(c)));return f.scaldiv(f.abs(b),b)};f._helper.toHessenberg=function(a){var k=JSON.parse(JSON.stringify(a)),d=k.value.length,b=l.real(d-1),c=l.real(d);l.real(1);if(f._helper.isUpperTriangular(k))return[f.idMatrix(b,b),a];var e;a=f.idMatrix(c,c);for(var g,c=1;c<d-1;c++)e=f.column(k,
l.real(c)),e.value=e.value.splice(c),g=f.abs2(e).value.real,1E-16<g&&(e=f._helper.getHouseHolder(e),a=w.mult(a,e),k=w.mult(w.mult(e,k),e)),b.value.real--;return[a,k]};f._helper.swapEl=function(a,k,d){var b;"[object Array]"===Object.prototype.toString.call(a)?(b=a[k],a[k]=a[d],a[d]=b):"list"===a.ctype&&(b=a.value[k],a.value[k]=a.value[d],a.value[d]=b)};f.RRQRdecomp=function(a,k){var d=Math.sqrt(l.eps);void 0!==k&&(d=.1*k.value.real);var d=d*d,b,c=a.value.length,e=l.real(c),g=l.real(1),h=f._helper.unitvector(l.real(a.value.length),
g),m=f.idMatrix(e,e),n=JSON.parse(JSON.stringify(a)),p=f.transpose(a),q=Array(c);for(b=0;b<c;b++)q[b]=f.abs2(p.value[b]);q=f.turnIntoCSList(q);p=Array(c);for(b=0;b<c;b++)p[b]=b;b=f.maxIndex(q,l.abs);for(var r=q.value[b],u=0,t=0;1E-16<l.abs2(r).value.real;t++){u++;f._helper.swapColumn(n,t,b);f._helper.swapEl(q,t,b);f._helper.swapEl(p,t,b);b=f._helper.getBlock(n,[t],[t]);b=f.column(b,g);r=f.abs2(b).value.real;1E-8<r&&(b=f._helper.getHouseHolder(b),b=f._helper.buildBlockMatrix(f.idMatrix(l.real(t),l.real(t)),
b),m=w.mult(m,f.transjugate(b)),n=w.mult(b,n));for(b=t+1;b<c;b++)q.value[b]=l.sub(q.value[b],l.mult(n.value[t].value[b],l.conjugate(n.value[t].value[b])));b=f.maxIndex(q,l.abs2,t+1);r=q.value[b];if(t+2===c){l.abs(r).value.real>d&&u++;break}e=l.sub(e,g);h.value=h.value.splice(0,h.value.length-1)}return{Q:m,R:n,P:f.turnIntoCSList(p),rank:l.real(u)}};f._helper.getHouseHolder=function(a){var k=l.real(a.value.length);if(1E-16>f.abs2(a))return f.idMatrix(k,k);var d,b=l.real(1),c=f._helper.unitvector(l.real(a.value.length),
b);d=f._helper.QRgetAlpha(a,0);d=f.sub(a,f.scalmult(d,c));d=f.scaldiv(f.abs(d),d);a=l.div(f.sesquilinearproduct(a,d),f.sesquilinearproduct(d,a));k=f.idMatrix(k,k);return k=f.sub(k,f.scalmult(l.add(b,a),f._helper.transposeMult(d,f.conjugate(d))))};f._helper.reOrderbyPivots=function(a,k){for(var d=a.value.length.length,b=f.transpose(a),d=Array(d),c=0;c<k.length;c++)d[k[c]]=b.value[c];d=f.turnIntoCSList(d);return f.transpose(d)};f.QRdecomp=function(a){var k,d=a.value.length,b=l.real(d);if(f._helper.isUpperTriangular(a))return{Q:f.idMatrix(b,
b),R:a};var c=l.real(1),e=f._helper.unitvector(l.real(a.value.length),c),g,h=f.idMatrix(b,b);a=JSON.parse(JSON.stringify(a));for(var m=0;;m++){k=f._helper.getBlock(a,[m],[m]);k=f.column(k,c);g=f.abs2(k).value.real;1E-8<g&&(k=f._helper.getHouseHolder(k),k=f._helper.buildBlockMatrix(f.idMatrix(l.real(m),l.real(m)),k),h=w.mult(h,f.transjugate(k)),a=w.mult(k,a));if(m+2===d)break;b=l.sub(b,c);e.value=e.value.splice(0,e.value.length-1)}return{Q:h,R:a}};f._helper.swapColumn=function(a,k,d){for(var b,c=0;c<
a.value.length;c++)b=a.value[c].value[k],a.value[c].value[k]=a.value[c].value[d],a.value[c].value[d]=b};f._helper.buildBlockMatrix=function(a,k){if(0===a.value.length)return k;if(0===k.value.length)return a;for(var d=a.value.length,b=a.value[0].value.length,c=b+k.value[0].value.length,c=f.zeromatrix(l.real(d+k.value.length),l.real(c)),e=0;e<a.value.length;e++)for(var g=0;g<a.value[0].value.length;g++)c.value[e].value[g]=a.value[e].value[g];for(e=0;e<k.value.length;e++)for(g=0;g<k.value[0].value.length;g++)c.value[d+
e].value[b+g]=k.value[e].value[g];return c};f._helper.getBlock=function(a,k,d){a=JSON.parse(JSON.stringify(a));var b=k[0],c=d[0];k=void 0===k[1]?a.value.length:k[1];d=void 0===d[1]?a.value[0].value.length:d[1];k++;d++;a.value=a.value.slice(b,k);for(b=0;b<a.value.length;b++)a.value[b].value=a.value[b].value.slice(c,d);return a};f._helper.setBlock=function(a,k,d){a=JSON.parse(JSON.stringify(a));var b=d[0];d=d[1];for(var c=k.value.length,e=k.value[0].value.length,f=0;f<c;f++)for(var g=0;g<e;g++)a.value[b+
f].value[d+g]=k.value[f].value[g];return a};f._helper.transposeMult=function(a,k){if(a.value.length!==k.value.length)return u;for(var d=a.value.length,b=Array(d),c=0;c<d;c++)b[c]=f.scalmult(a.value[c],k);return f.turnIntoCSList(b)};f._helper.QRgetAlpha=function(a,k){return 0>a.value[k].value.real?f.abs(a):l.neg(f.abs(a))};f.LUdecomp=function(a){a=JSON.parse(JSON.stringify(a));var k,d,b,c,e,f=0,g,h=a.value.length,m=h-1,n=Array(h);for(b=0;b<h;++b){e=b;c=a.value[b];g=l.abs(c.value[b]).value.real;for(d=
b+1;d<h;++d)k=l.abs(a.value[d].value[b]),g<k.value.real&&(g=k.value.real,e=d);g<l.eps&&console.log("Warning: singular matrix!");n[b]=e;e!==b&&(a.value[b]=a.value[e],a.value[e]=c,c=a.value[b],f++);d=c.value[b];for(k=b+1;k<h;++k)a.value[k].value[b]=l.div(a.value[k].value[b],d);for(k=b+1;k<h;++k){e=a.value[k];for(d=b+1;d<m;++d)e.value[d]=l.sub(e.value[d],l.mult(e.value[b],c.value[d])),++d,e.value[d]=l.sub(e.value[d],l.mult(e.value[b],c.value[d]));d===m&&(e.value[d]=l.sub(e.value[d],l.mult(e.value[b],
c.value[d])))}}return{LU:a,P:n,TransPos:f}};f.LUsolve=function(a,k){var d=f.LUdecomp(a);return f._helper.LUsolve(d,k)};f._helper.LUsolve=function(a,k){var d=JSON.parse(JSON.stringify(k)),b,c=a.LU,e=c.value.length,f=JSON.parse(JSON.stringify(d)),g=a.P,h;for(b=e-1;-1!==b;--b)f.value[b]=d.value[b];for(b=0;b<e;++b)for(d=g[b],g[b]!==b&&(h=f.value[b],f.value[b]=f.value[d],f.value[d]=h),h=c.value[b],d=0;d<b;++d)f.value[b]=l.sub(f.value[b],l.mult(f.value[d],h.value[d]));for(b=e-1;0<=b;--b){h=c.value[b];for(d=
b+1;d<e;++d)f.value[b]=l.sub(f.value[b],l.mult(f.value[d],h.value[d]));f.value[b]=l.div(f.value[b],h.value[b])}return f};f.linearsolveCramer2=function(a,k){var d=f.column(a,l.real(1)),b=f.column(a,l.real(2)),c=f.det2(d,b);l._helper.isZero(c)&&console.log("A is not regular!");b=f.det2(k,b);b=l.div(b,c);d=f.det2(d,k);d=l.div(d,c);return f.turnIntoCSList([b,d])};f.linearsolveCramer3=function(a,k){var d=f.column(a,l.real(1)),b=f.column(a,l.real(2)),c=f.column(a,l.real(3)),e=f.det3(d,b,c);l._helper.isZero(e)&&
console.log("A is not regular!");var g=f.det3(k,b,c),c=f.det3(d,k,c),d=f.det3(d,b,k),g=f.turnIntoCSList([g,c,d]);return g=f.scaldiv(e,g)};f.linearsolveCGNR=function(a,k){var d=f.transpose(a),b=w.mult(d,a),d=w.mult(d,k);return f.linearsolveCG(b,d)};f.linearsolveCG=function(a,k){var d,b,c,e,g,h;e=k;b=d=f.sub(k,w.mult(a,k));for(var m=Math.ceil(1.2*a.value.length),n=0;n<m;){n++;g=w.mult(a,b);h=c=f.scalproduct(d,d);c=l.div(c,f.scalproduct(b,g));e=f.add(e,w.mult(c,b));d=f.sub(d,w.mult(c,g));if(f.abs(d).value.real<
l.eps)break;c=f.scalproduct(d,d);c=l.div(c,h);b=f.add(d,w.mult(c,b))}n>=m&&console.log("CG did not converge");return e};f.det=function(a){if(1===a.value.length)return a.value[0].value[0];if(2===a.value.length)return f.det2(a.value[0],a.value[1]);if(3===a.value.length)return f.det3(a.value[0],a.value[1],a.value[2]);if(4===a.value.length)return f.det4m(a);var k=a.value.length,d=l.real(1),b,c,e=JSON.parse(JSON.stringify(a)),g,h,m,n;for(a=0;a<k-1;a++){c=a;for(b=a+1;b<k;b++)l.abs(e.value[b].value[a]).value.real>
l.abs(e.value[c].value[a]).value.real&&(c=b);c!==a&&(b=e.value[c],e.value[c]=e.value[a],e.value[a]=b,d=l.neg(d));g=e.value[a];for(b=a+1;b<k;b++){h=e.value[b];m=l.div(h.value[a],g.value[a]);for(c=a+1;c<k-1;c+=2)n=c+1,h.value[c]=l.sub(h.value[c],l.mult(g.value[c],m)),h.value[n]=l.sub(h.value[n],l.mult(g.value[n],m));c!==k&&(h.value[c]=l.sub(h.value[c],l.mult(g.value[c],m)))}if(l._helper.isZero(g.value[a]))return l.real(0);d=l.mult(d,g.value[a])}return l.mult(d,e.value[a].value[a])};f.LUdet=function(a){a=
f.LUdecomp(a);for(var k=a.LU,d=k.value.length,b=k.value[0].value[0],c=1;c<d;c++)b=l.mult(b,k.value[c].value[c]);1===a.TransPos%2&&(b=l.neg(b));return b};f.getField=function(a,k){var d;if("homog"===k){if(f._helper.isNumberVecN(a,3))return a;if(f._helper.isNumberVecN(a,2))return f.turnIntoCSList([a.value[0],a.value[1],l.real(1)])}if("xy"===k){if(f._helper.isNumberVecN(a,2))return a;if(f._helper.isNumberVecN(a,3))return f.turnIntoCSList([l.div(a.value[0],a.value[2]),l.div(a.value[1],a.value[2])])}if("x"===
k&&f.isNumberVector(a)){d=a.value.length;if(0<d&&3!==d)return a.value[0];if(3===d)return"Point"===a.usage?l.div(a.value[0],a.value[2]):a.value[0]}if("y"===k&&f.isNumberVector(a)){d=a.value.length;if(1<d&&3!==d)return a.value[1];if(3===d)return"Point"===a.usage?l.div(a.value[1],a.value[2]):a.value[1]}return"z"===k&&f.isNumberVector(a)&&(d=a.value.length,2<d)?a.value[2]:u};f.nil=f.turnIntoCSList([]);f.ofGeos=function(a){return f.turnIntoCSList(a.map(function(a){return{ctype:"geo",value:a}}))};var eb=
{},xb={":":20,".":25,"\u00b0":25,_:50,"^":50,"*":100,"/":100,"+":200,"-":200,"!":200,"==":300,"~=":300,"~<":300,"~>":300,"=:=":300,">=":300,"<=":300,"~>=":300,"~<=":300,">":300,"<":300,"<>":300,"&":350,"%":350,"!=":350,"~!=":350,"..":350,"++":370,"--":370,"~~":370,":>":370,"<:":370,"=":400,":=":400,":=_":400,"::=":400,"->":400,";":500},Q={};Q[":"]=nb(":");Q["\u00b0"]=function(a,k){var d=C(a[0]),b=C(a[1]);return"number"===d.ctype&&"void"===b.ctype?w.withUsage(l.realmult(Math.PI/180,d),"Angle"):u};
Q._=Lb;Q["^"]=tc;Q["*"]=rc;Q["/"]=sc;Q["+"]=qc;Q["-"]=Jb;Q["!"]=function(a,k){var d=C(a[0]),b=C(a[1]);return"void"===d.ctype&&"boolean"===b.ctype?{ctype:"boolean",value:!b.value}:u};Q["=="]=ob;Q["~="]=Bb;Q["~<"]=function(a,k){var d=C(a[0]),b=C(a[1]);return"number"===d.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(d)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:d.value.real-b.value.real<=-l.eps}:u};Q["~>"]=function(a,k){var d=C(a[0]),b=C(a[1]);return"number"===d.ctype&&"number"===b.ctype&&
l._helper.isAlmostReal(d)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:d.value.real-b.value.real>=l.eps}:u};Q["=:="]=nb("=:=");Q[">="]=function(a,k){var d=C(a[0]),b=C(a[1]);return"number"===d.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(d)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:d.value.real>=b.value.real}:"string"===d.ctype&&"string"===b.ctype?{ctype:"boolean",value:d.value>=b.value}:u};Q["<="]=function(a,k){var d=C(a[0]),b=C(a[1]);return"number"===d.ctype&&"number"===b.ctype&&
l._helper.isAlmostReal(d)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:d.value.real<=b.value.real}:"string"===d.ctype&&"string"===b.ctype?{ctype:"boolean",value:d.value<=b.value}:u};Q["~>="]=function(a,k){var d=C(a[0]),b=C(a[1]);return"number"===d.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(d)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:d.value.real-b.value.real>-l.eps}:u};Q["~<="]=function(a,k){var d=C(a[0]),b=C(a[1]);return"number"===d.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(d)&&
l._helper.isAlmostReal(b)?{ctype:"boolean",value:d.value.real-b.value.real<l.eps}:u};Q[">"]=function(a,k){var d=C(a[0]),b=C(a[1]);return"number"===d.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(d)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:d.value.real>b.value.real}:"string"===d.ctype&&"string"===b.ctype?{ctype:"boolean",value:d.value>b.value}:u};Q["<"]=function(a,k){var d=C(a[0]),b=C(a[1]);return"number"===d.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(d)&&l._helper.isAlmostReal(b)?
{ctype:"boolean",value:d.value.real<b.value.real}:"string"===d.ctype&&"string"===b.ctype?{ctype:"boolean",value:d.value<b.value}:u};Q["<>"]=fc;Q["&"]=gc;Q["%"]=hc;Q["!="]=fc;Q["~!="]=function(a,k){return w.not(Bb(a,k))};Q[".."]=function(a,k){var d=A(a[0]),b=A(a[1]);return"number"===d.ctype&&"number"===b.ctype?f.sequence(d,b):u};Q["++"]=uc;Q["--"]=wc;Q["~~"]=vc;Q[":>"]=xc;Q["<:"]=yc;Q["="]=Ab;Q[":="]=function(a,k){var d="undefined"===a[1].ctype;if("undefined"===a[0].ctype||d)return u;"function"===
a[0].ctype&&(d=a[0].oper,eb[d]={oper:d,body:a[1],arglist:a[0].args});return u};Q[":=_"]=nb(":=_");Q["::="]=nb("::=");Q[";"]=function(a,k){var d="void"===a[0].ctype,b="void"===a[1].ctype;if(d&&b)return u;if(!d&&b)return A(a[0]);d||b||A(a[0]);return b?u:A(a[1])};var t={},D={evaluate:function(a,k,d){if(eb.hasOwnProperty(a)){a=eb[a];if(void 0===a)k=u;else{var b=[];for(d=0;d<a.arglist.length;d++)b[d]=A(k[d]);for(d=0;d<a.arglist.length;d++)K.newvar(a.arglist[d].name),K.setvar(a.arglist[d].name,b[d]);K.pushVstack("*");
k=A(a.body);K.cleanVstack();for(d=0;d<a.arglist.length;d++)K.removevar(a.arglist[d].name)}return k}if(b=t[a])return b(k,d);var c=a.lastIndexOf("$");if(-1!==c&&(c=a.substr(0,c),b=t[c]))return b(k,d);ia.err("Called undefined function "+c+" (as "+a+")");return u},equals:function(a,k){return"number"===a.ctype&&"number"===k.ctype?{ctype:"boolean",value:a.value.real===k.value.real&&a.value.imag===k.value.imag}:"string"===a.ctype&&"string"===k.ctype||"boolean"===a.ctype&&"boolean"===k.ctype?{ctype:"boolean",
value:a.value===k.value}:"list"===a.ctype&&"list"===k.ctype?f.equals(a,k):{ctype:"boolean",value:!1}}},w={_helper:{},order:{undefined:0,"boolean":1,number:2,term:3,atomic:4,variable:5,geo:6,string:7,list:8},string:function(a){return{ctype:"string",value:a}},bool:function(a){return{ctype:"boolean",value:a}},not:function(a){return w.bool(!a.value)},isLessThan:function(a,k){return-1===w.compare(a,k)},isEqual:function(a,k){return 0===w.compare(a,k)},compareResults:function(a,k){return w.compare(a.result,
k.result)},compare:function(a,k){if(a.ctype!==k.ctype)return w.order[a.ctype]-w.order[k.ctype];if("number"===a.ctype)return l._helper.compare(a,k);if("list"===a.ctype)return f._helper.compare(a,k);if("string"===a.ctype)return a.value===k.value?0:a.value<k.value?-1:1;if("boolean"===a.ctype)return a.value===k.value?0:!1===a.value?-1:1},add:function(a,k){return"void"===a.ctype&&"number"===k.ctype||"void"===a.ctype&&"list"===k.ctype?k:"number"===a.ctype&&"number"===k.ctype?l.add(a,k):"string"===a.ctype||
"string"===k.ctype?{ctype:"string",value:L(a)+L(k)}:"list"===a.ctype&&"list"===k.ctype?f.add(a,k):u},sub:function(a,k){return"void"===a.ctype&&"number"===k.ctype?l.neg(k):"void"===a.ctype&&"list"===k.ctype?f.neg(k):"number"===a.ctype&&"number"===k.ctype?l.sub(a,k):"list"===a.ctype&&"list"===k.ctype?f.sub(a,k):u},mult:function(a,k){return"number"===a.ctype&&"number"===k.ctype?l.mult(a,k):"number"===a.ctype&&"list"===k.ctype?f.scalmult(a,k):"list"===a.ctype&&"number"===k.ctype?f.scalmult(k,a):"list"===
a.ctype&&"list"===k.ctype?f.mult(a,k):u},div:function(a,k){return"number"===a.ctype&&"number"===k.ctype?l.div(a,k):"list"===a.ctype&&"number"===k.ctype?f.scaldiv(k,a):u},max:function(a,k){return"number"===a.ctype&&"number"===k.ctype?l.max(a,k):"list"===a.ctype&&"list"===k.ctype?f.max(a,k):u},min:function(a,k){return"number"===a.ctype&&"number"===k.ctype?l.min(a,k):"list"===a.ctype&&"list"===k.ctype?f.min(a,k):u},wrap:function(a){if("number"===typeof a)return l.real(a);if("object"===typeof a&&void 0!==
a.length){for(var k=[],d=0;d<a.length;d++)k[d]=w.wrap(a[d]);return f.turnIntoCSList(k)}return"string"===typeof a?{ctype:"string",value:a}:"boolean"===typeof a?{ctype:"boolean",value:a}:u},unwrap:function(a){if("object"!==typeof a||null===a)return a;if(Array.isArray(a))return a.map(w.unwrap);switch(a.ctype){case "string":case "boolean":return a.value;case "number":return 0===a.value.imag?a.value.real:{r:a.value.real,i:a.value.imag};case "list":return a.value.map(w.unwrap);default:return null}},withUsage:function(a,
k){return{ctype:a.ctype,value:a.value,usage:k}}};t.version$0=function(a,k){var d=["CindyJS"].concat(Ad);return f.turnIntoCSList(d.map(w.wrap))};t.timestamp$0=function(a,k){return{ctype:"number",value:{real:(new Date).getTime(),imag:0}}};t.seconds$0=function(a,k){return{ctype:"number",value:{real:(new Date).getTime()/1E3,imag:0}}};t.clearconsole$0=function(a,k){ia.clear()};t.err$1=function(a,k){var d="",b;"variable"===a[0].ctype?(d=a[0].name,b=K.getvar(a[0].name)):b=a[0];b=d+" ===> "+L(A(b));ia.err(b);
return u};t.errc$1=function(a,k){var d;"variable"===a[0].ctype?(d=A(K.getvar(a[0].name)),console.log(a[0].name+" ===> "+L(d))):(d=A(a[0]),console.log(" ===> "+L(d)));return u};t.print$1=function(a,k){ia.out(L(A(a[0])),!0);return u};t.println$1=function(a,k){ia.out(L(A(a[0])));return u};t.dump$1=function(a,k){console.log(JSON.stringify(a[0]));return u};t.repeat$2=function(a,k){return t.repeat$3([a[0],null,a[1]],k)};t.repeat$3=function(a,k){var d=C(a[0]),b="#";null!==a[1]&&"variable"===a[1].ctype&&
(b=a[1].name);if("number"!==d.ctype)return u;var d=Math.round(d.value.real),c=1,e=1,f=d+1,g=!1,h=!1,l=!1,m;void 0!==k.start&&(m=A(k.start),"number"===m.ctype&&(g=!0,e=m.value.real));void 0!==k.step&&(m=A(k.step),"number"===m.ctype&&(l=!0,c=m.value.real));void 0!==k.stop&&(m=A(k.stop),"number"===m.ctype&&(h=!0,f=m.value.real));!g||h||l||(f=c*d+e);g||!h||l||(e=-c*(d-1)+f,f+=c);g||h||!l||(f=c*d+e);g&&h&&!l&&(c=(f-e)/(d-1),f+=c);g&&!h&&l&&(f=c*d+e);!g&&h&&l&&(e=-c*(d-1)+f,f+=c);g&&h&&l&&(f+=c);(e<=f&&
0<c||e>=f&&0>c)&&g&&h&&l&&(d=Math.floor((f-e)/c));K.newvar(b);f=u;for(g=0;g<d;g++)K.setvar(b,{ctype:"number",value:{real:g*c+e,imag:0}}),f=A(a[2]);K.removevar(b);return f};t.while$2=function(a,k){for(var d=a[1],b=a[0],c=A(b),e=u;"list"!==c.ctype&&c.value;)e=A(d),c=A(b);return e};t.apply$2=function(a,k){return t.apply$3([a[0],null,a[1]],k)};t.apply$3=function(a,k){var d=C(a[0]);if("list"!==d.ctype)return u;var b="#";null!==a[1]&&"variable"===a[1].ctype&&(b=a[1].name);var d=d.value,c=[];K.newvar(b);
for(var e=0;e<d.length;e++)K.setvar(b,d[e]),c[e]=A(a[2]);K.removevar(b);return{ctype:"list",value:c}};t.forall$2=function(a,b){return t.forall$3([a[0],null,a[1]],b)};t.forall$3=function(a,b){var d=C(a[0]);if("list"!==d.ctype)return u;var c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);d=d.value;K.newvar(c);for(var e,f=0;f<d.length;f++)K.setvar(c,d[f]),e=A(a[2]);K.removevar(c);return e};t.select$2=function(a,b){return t.select$3([a[0],null,a[1]],b)};t.select$3=function(a,b){var d=C(a[0]);
if("list"!==d.ctype)return u;var c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);var d=d.value,e=[];K.newvar(c);for(var f=0,g=0;g<d.length;g++){K.setvar(c,d[g]);var h=A(a[2]);"boolean"===h.ctype&&!0===h.value&&(e[f]=d[g],f++)}K.removevar(c);return{ctype:"list",value:e}};t.flatten$1=function(a,b){function d(a,b){return-1===b||"list"!==a.ctype?a:[].concat.apply([],a.value.map(function(a){return d(a,b-1)}))}var c=C(a[0]);if("list"!==c.ctype)return c;var e=b.levels;void 0===e?e=1:(e=A(e),e=
"number"===e.ctype?e.value.real:"string"===e.ctype&&"all"===e.value?-2:1);return{ctype:"list",value:d(c,e)}};t.createvar$1=function(a,b){"variable"===a[0].ctype&&K.newvar(a[0].name);return u};t.local=function(a,b){for(var d=0;d<a.length;d++)"variable"===a[d].ctype&&K.newvar(a[d].name);return u};t.removevar$1=function(a,b){var d=A(a[0]);"variable"===a[0].ctype&&K.removevar(a[0].name);return d};t.release=function(a,b){if(0===a.length)return u;for(var d=A(a[a.length-1]),c=0;c<a.length;c++)"variable"===
a[c].ctype&&K.removevar(a[c].name);return d};t.regional=function(a,b){for(var d=0;d<a.length;d++)if("variable"===a[d].ctype){var c=a[d].name;K.newvar(c);K.pushVstack(c)}return u};t.genList=function(a,b){for(var d=[],c=0;c<a.length;c++)d[c]=A(a[c]);return{ctype:"list",value:d}};D.assigntake=function(a,b){var d=a.args[0],c=A(d),e=C(a.args[1]),g=u;if("list"===c.ctype||"string"===c.ctype)e=Math.floor(e.value.real),0>e&&(e=c.value.length+e+1),0<e&&e<=c.value.length&&("list"===c.ctype?(c=c.value.slice(),
c[e-1]=A(b),g=f.turnIntoCSList(c)):(c=c.value,c=c.substring(0,e-1)+L(A(b))+c.substring(e,c.length),g=w.string(c)));Ab([d,g])};D.assigndot=function(a,b){var d=A(a.obj),c=a.key;"geo"===d.ctype&&c&&ua.setField(d.value,c,b);return u};D.assignlist=function(a,b){var d=a.length,c=b.length;c<d&&(d=c);for(c=0;c<d;c++)Ab([a[c],b[c]],[])};t.if$2=function(a,b){return t.if$3(a,b)};t.if$3=function(a,b){var d=C(a[0]);if("boolean"===d.ctype){if(!0===d.value)return A(a[1]);if(3===a.length)return A(a[2])}return u};
t.and$2=gc;t.or$2=hc;t.xor$2=function(a,b){var d=C(a[0]),c=C(a[1]);return"boolean"===d.ctype&&"boolean"===c.ctype?{ctype:"boolean",value:d.value!==c.value}:u};t.not$1=function(a,b){var d=C(a[0]);return"boolean"===d.ctype?{ctype:"boolean",value:!d.value}:u};D.genericListMathGen=function(a,b,d){t[a+"$1"]=function(a,c){var e=A(a[0]);if("list"!==e.ctype)return u;e=e.value;if(0===e.length)return d;for(var v=e[0],f=1;f<e.length;f++)v=b(v,e[f]);return v};var c=a+"$3";t[a+"$2"]=function(a,d){return t[c]([a[0],
null,a[1]])};t[c]=function(a,c){var e=C(a[0]);if("list"!==e.ctype)return u;e=e.value;if(0===e.length)return d;var v="#";null!==a[1]&&"variable"===a[1].ctype&&(v=a[1].name);K.newvar(v);K.setvar(v,e[0]);for(var f=A(a[2]),g=1;g<e.length;g++){K.setvar(v,e[g]);var h=A(a[2]),f=b(f,h)}K.removevar(v);return f}};D.genericListMathGen("product",w.mult,l.real(1));D.genericListMathGen("sum",w.add,l.real(0));D.genericListMathGen("max",w.max,u);D.genericListMathGen("min",w.min,u);t.max$2=function(a,b){var d=C(a[0]);
if("list"===d.ctype)return t.max$3([d,null,a[1]]);var c=C(a[1]);return t.max$1([f.turnIntoCSList([d,c])])};t.min$2=function(a,b){var d=C(a[0]);if("list"===d.ctype)return t.min$3([d,null,a[1]]);var c=C(a[1]);return t.min$1([f.turnIntoCSList([d,c])])};t.add$2=qc;t.sub$2=Jb;t.mult$2=rc;t.div$2=sc;t.mod$2=function(a,b){var d=C(a[0]),c=C(a[1]);return"number"===d.ctype&&"number"===c.ctype?l.mod(d,c):u};t.pow$2=tc;t.exp$1=function(a,b){var d=C(a[0]);return"number"===d.ctype?l.exp(d):u};t.sin$1=function(a,
b){var d=C(a[0]);return"number"===d.ctype?l.sin(d):u};t.sqrt$1=function(a,b){var d=C(a[0]);return"number"===d.ctype?l.sqrt(d):u};D.laguerre=function(a,b,d){if("list"!==a.ctype)return u;var c=a.value.length-1,e;for(e=0;e<=c;e++)if("number"!==a.value[e].ctype)return u;if("number"!==b.ctype)return u;for(var f=[1,.3141,.5926,.5358,.9793,.2385,.6264,.3383,.2795,.0288],g,h,m,n=1;n<=d;n++){h=m=l.zero;g=a.value[c];for(e=c-1;0<=e;e--)m=l.add(h,l.mult(m,b)),h=l.add(g,l.mult(h,b)),g=l.add(a.value[e],l.mult(g,
b));if(l._helper.isLessThan(l.abs(g),l.real(1E-14)))break;e=l.div(h,g);h=l.mult(e,e);g=l.sub(h,l.div(l.mult(l.real(2),m),g));m=l.sqrt(l.mult(l.real(c-1),l.sub(l.mult(l.real(c),g),h)));g=l.add(e,m);e=l.sub(e,m);l._helper.isLessThan(l.abs(g),l.abs(e))&&(g=e);e=l._helper.isLessThan(l.real(1E-14),l.abs(g))?l.div(l.real(c),g):l.mult(l.add(l.abs(b),l.one),l.complex(Math.cos(n),Math.sin(n)));if(l._helper.isLessThan(l.abs(e),l.real(1E-14)))break;0===n%20&&n<d-19&&(e=l.mult(e,l.real(f[Math.floor(n/20)])));
b=l.sub(b,e)}return b};D.quadratic_roots=function(a){if("list"!==a.ctype)return u;var b=a.value[2],d=a.value[1];a=a.value[0];if(l._helper.isZero(a))return[l.zero,l.neg(l.div(d,b))];var c=l.sqrt(l.sub(l.mult(d,d),l.mult(l.real(4),l.mult(b,a))));0<=l.re(d)&&(c=l.neg(c));return[l.div(l.sub(c,d),l.mult(l.real(2),b)),l.div(l.mult(l.real(2),a),l.sub(c,d))]};D.roots=function(a){var b=[],d=a,c=a.value.length-1;if(0>=c)return f.turnIntoCSList([]);if(l._helper.isZero(a.value[c]))return b=D.roots(f.turnIntoCSList(a.value.slice(0,
c))),f.append(b,l.infinity);if(1===c)b[0]=l.neg(l.div(a.value[0],a.value[1]));else if(2===c)b=D.quadratic_roots(a);else{for(var e=0;e<c-2;e++){b[e]=D.laguerre(a,l.zero,200);b[e]=D.laguerre(d,b[e],1);var g=[];g[c-e]=a.value[c-e];for(var h=c-e;0<h;h--)g[h-1]=l.add(a.value[h-1],l.mult(g[h],b[e]));g.shift();a=f.turnIntoCSList(g)}a=D.quadratic_roots(a);b[c-2]=a[0];b[c-1]=a[1]}return f.turnIntoCSList(b)};t.roots$1=function(a,b){var d=C(a[0]);if("list"===d.ctype){for(var c=0;c<d.value.length;c++)if("number"!==
d.value[c].ctype)return u;d=D.roots(d);return f.sort1(d)}return u};t.autodiff$3=function(a,b){var d="x",c;if("function"===a[0].ctype)c=eb[a[0].oper].body,d=a[0].args[0].name;else if("function"===typeof a[0].impl)c=a[0];else return console.log("could not parse function"),u;var e=C(a[1]),f=C(a[2]);if(1>f.value.real)return console.log("grade cant be < 1"),u;f=l.add(f,l.real(1));return N.autodiff(c,d,e,f)};t.cos$1=function(a,b){var d=C(a[0]);return"number"===d.ctype?l.cos(d):u};t.tan$1=function(a,b){var d=
C(a[0]);return"number"===d.ctype?l.tan(d):u};t.arccos$1=function(a,b){var d=C(a[0]);return"number"===d.ctype?l.arccos(d):u};t.arcsin$1=function(a,b){var d=C(a[0]);return"number"===d.ctype?l.arcsin(d):u};t.arctan$1=function(a,b){var d=C(a[0]);return"number"===d.ctype?l.arctan(d):u};t.arctan2$2=function(a,b){var d=C(a[0]),c=C(a[1]);return"number"===d.ctype&&"number"===c.ctype?l.arctan2(d,c):u};t.arctan2$1=function(a,b){var d=C(a[0]);if("list"===d.ctype&&2===d.value.length){if(d=d.value,"number"===d[0].ctype&&
"number"===d[1].ctype)return t.arctan2$2(d,b)}else if("number"===d.ctype)return l.arctan2(d);return u};t.log$1=function(a,b){var d=C(a[0]);return"number"===d.ctype?l.log(d):u};D.recursiveGen=function(a){var b=l[a],d=f[a];t[a+"$1"]=function(a,c){var e=C(a[0]);return"number"===e.ctype?b(e):"list"===e.ctype?d(e):u}};D.recursiveGen("im");D.recursiveGen("re");D.recursiveGen("conjugate");D.recursiveGen("round");D.recursiveGen("ceil");D.recursiveGen("floor");D.recursiveGen("abs");t.abs_infix=t.abs$1;t.random$0=
function(a,b){return l.real(l._helper.rand())};t.random$1=function(a,b){var d=C(a[0]);return"number"===d.ctype?l.complex(d.value.real*l._helper.rand(),d.value.imag*l._helper.rand()):u};t.seedrandom$1=function(a,b){var d=C(a[0]);"number"===d.ctype&&l._helper.seedrandom(d.value.real);return u};t.randomnormal$0=function(a,b){return l.real(l._helper.randnormal())};t.randominteger$1=function(a,b){var d=C(a[0]);if("number"===d.ctype){var c=d.value.real|0,d=d.value.imag|0,c=c*l._helper.rand()|0,d=d*l._helper.rand()|
0;return l.complex(c,d)}return u};t.randomint$1=t.randominteger$1;t.randombool$0=function(a,b){return.5<l._helper.rand()?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isreal$1=function(a,b){var d=A(a[0]);return"number"===d.ctype&&l._helper.isAlmostReal(d)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isinteger$1=function(a,b){var d=A(a[0]);return"number"===d.ctype&&l._helper.isAlmostReal(d)&&d.value.real===Math.floor(d.value.real)?{ctype:"boolean",value:!0}:{ctype:"boolean",
value:!1}};t.iseven$1=function(a,b){var d=A(a[0]);return"number"===d.ctype&&l._helper.isAlmostReal(d)&&d.value.real/2===Math.floor(d.value.real/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isodd$1=function(a,b){var d=A(a[0]);return"number"===d.ctype&&l._helper.isAlmostReal(d)&&(d.value.real-1)/2===Math.floor((d.value.real-1)/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.iscomplex$1=function(a,b){return"number"===A(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",
value:!1}};t.isstring$1=function(a,b){return"string"===A(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.islist$1=function(a,b){return"list"===A(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.ismatrix$1=function(a,b){var d=A(a[0]);return-1!==f._helper.colNumb(d)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.iscircle$1=function(a,b){var d=A(a[0]);return"geo"===d.ctype&&"C"===d.value.kind&&"Circle"===d.value.matrix.usage?{ctype:"boolean",value:!0}:
{ctype:"boolean",value:!1}};t.isconic$1=function(a,b){var d=A(a[0]);return"geo"===d.ctype&&"C"===d.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isline$1=function(a,b){var d=A(a[0]);return"geo"===d.ctype&&"L"===d.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.ispoint$1=function(a,b){var d=A(a[0]);return"geo"===d.ctype&&"P"===d.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isgeometric$1=function(a,b){return"geo"===A(a[0]).ctype?{ctype:"boolean",
value:!0}:{ctype:"boolean",value:!1}};t.isnumbermatrix$1=function(a,b){var d=A(a[0]);return f.isNumberMatrix(d).value?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isnumbervector$1=function(a,b){var d=A(a[0]);return f.isNumberVector(d).value?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.issun$1=function(a,b){var d=A(a[0]);return"geo"===d.ctype&&void 0!==d.value.behavior&&"Sun"===d.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.ismass$1=function(a,
b){var d=A(a[0]);return"geo"===d.ctype&&void 0!==d.value.behavior&&"Mass"===d.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isspring$1=function(a,b){var d=A(a[0]);return"geo"===d.ctype&&void 0!==d.value.behavior&&"Spring"===d.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isbouncer$1=function(a,b){var d=A(a[0]);return"geo"===d.ctype&&void 0!==d.value.behavior&&"Bouncer"===d.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",
value:!1}};t.isundefined$1=function(a,b){return"undefined"===A(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.matrixrowcolumn$1=function(a,b){var d=A(a[0]);return-1!==f._helper.colNumb(d)?f.realVector([d.value.length,d.value[0].value.length]):u};t.rowmatrix$1=function(a,b){var d=A(a[0]);return"list"===d.ctype?f.turnIntoCSList([d]):u};t.columnmatrix$1=function(a,b){var d=A(a[0]);return"list"===d.ctype?f.turnIntoCSList(d.value.map(function(a){return f.turnIntoCSList([a])})):u};
t.submatrix$3=function(a,b){var d=A(a[0]),c=A(a[1]),e=A(a[2]);if("list"===d.ctype&&"number"===c.ctype&&"number"===e.ctype){var g=Math.round(c.value.real),c=Math.round(e.value.real),d=d.value.slice();0<c&&c<=d.length&&d.splice(c-1,1);var h=!0,d=d.map(function(a){if("list"!==a.ctype)h=!1;else return a=a.value.slice(),0<g&&g<=a.length&&a.splice(g-1,1),f.turnIntoCSList(a)});return h?f.turnIntoCSList(d):u}return u};t.complex$1=function(a,b){var d,c,e;e=C(a[0]);if("list"===e.ctype&&f.isNumberVector(e)){if(2===
e.value.length)return d=e.value[0],c=e.value[1],l.complex(d.value.real-c.value.imag,c.value.real+d.value.imag);if(3===e.value.length)return d=e.value[0],c=e.value[1],e=e.value[2],d=l.div(d,e),c=l.div(c,e),l.complex(d.value.real-c.value.imag,c.value.real+d.value.imag)}return u};t.gauss$1=function(a,b){var d=C(a[0]);return"number"===d.ctype?f.realVector([d.value.real,d.value.imag]):u};t.cross$2=function(a,b){var d=M(a[0]),c=M(a[1]);if(d!==u&&c!==u){var e=f.cross(d,c);"Point"===d.usage&&"Point"===c.usage&&
(e=w.withUsage(e,"Line"));"Line"===d.usage&&"Line"===c.usage&&(e=w.withUsage(e,"Point"));return e}return u};t.crossratio$4=function(a,b){var d=A(a[0]),c=A(a[1]),e=A(a[2]),g=A(a[3]),h=M(d),m=M(c),n=M(e),p=M(g);return h!==u&&m!==u&&n!==u&&p!==u?f.crossratio3(h,m,n,p,f.ii):"number"===d.ctype&&"number"===c.ctype&&"number"===e.ctype&&"number"===g.ctype?l.div(l.mult(l.sub(d,e),l.sub(c,g)),l.mult(l.sub(d,g),l.sub(c,e))):u};t.para$2=function(a,b){var d=C(a[0]),c=C(a[1]),e=M(d),g=M(c);if(d!==u&&c!==u){var c=
c.usage,h=e,l=g;if("Line"===d.usage||"Point"===c)h=g,l=e;d=f.cross(f.cross(f.linfty,l),h);return w.withUsage(d,"Line")}return u};t.perp$2=function(a,b){var d=C(a[0]),c=C(a[1]),e=M(d),g=M(c);if(d!==u&&c!==u){var h=c.usage||g.usage,c=e,m=g;if("Line"===(d.usage||e.usage)||"Point"===h)c=g,m=e;d=f.turnIntoCSList([m.value[0],m.value[1],l.zero]);d=f.cross(d,c);return w.withUsage(d,"Line")}return u};t.perp$1=function(a,b){var d=C(a[0]);return f._helper.isNumberVecN(d,2)?f.turnIntoCSList([l.neg(d.value[1]),
d.value[0]]):u};t.parallel$2=t.para$2;t.perpendicular$2=t.perp$2;t.perpendicular$1=t.perp$1;t.meet$2=function(a,b){var d=M(a[0]),c=M(a[1]);return d!==u&&c!==u?(d=f.cross(d,c),w.withUsage(d,"Point")):u};t.join$2=function(a,b){var d=M(a[0]),c=M(a[1]);return d!==u&&c!==u?(d=f.cross(d,c),w.withUsage(d,"Line")):u};t.dist$2=function(a,b){var d=C(a[0]),c=C(a[1]),d=Jb([d,c],[]);return t.abs$1([d],[])};t.dist_infix=t.dist$2;t.point$1=function(a,b){var d=A(a[0]);return f._helper.isNumberVecN(d,3)||f._helper.isNumberVecN(d,
2)?w.withUsage(d,"Point"):d};t.line$1=function(a,b){var d=A(a[0]);return f._helper.isNumberVecN(d,3)?w.withUsage(d,"Line"):d};t.det$3=function(a,b){var d=M(a[0]),c=M(a[1]),e=M(a[2]);if(d!==u&&c!==u&&e!==u)return f.det3(d,c,e)};t.det$1=function(a,b){var d=C(a[0]);if("list"===d.ctype){var c=f._helper.colNumb(d);if(-1!==c&&c===d.value.length)return f.det(d)}return u};t.eig$1=function(a,b){var d=C(a[0]);if("list"===d.ctype){var c=f._helper.colNumb(d);if(-1!==c&&c===d.value.length)return f.eig(d)}return u};
t.eigenvalues$1=function(a,b){var d=C(a[0]);if("list"===d.ctype){var c=f._helper.colNumb(d);if(-1!==c&&c===d.value.length)return f.eig(d,!1).value[0]}return u};t.rank$1=function(a,b){var d=C(a[0]);if("list"===d.ctype){var c=f._helper.colNumb(d);if(-1!==c&&c===d.value.length)return f.rank(d,b.precision)}return u};t.kernel$1=function(a,b){var d=C(a[0]);if("list"===d.ctype){var c=f._helper.colNumb(d);if(-1!==c&&c===d.value.length)return d=f.nullSpace(d,b.precision),f.transpose(d)}return u};t.eigenvectors$1=
function(a,b){var d=C(a[0]);if("list"===d.ctype){var c=f._helper.colNumb(d);if(-1!==c&&c===d.value.length)return f.eig(d).value[1]}return u};t.area$3=function(a,b){var d=M(a[0]),c=M(a[1]),e=M(a[2]);if(d!==u&&c!==u&&e!==u){var g=d.value[2],h=c.value[2],m=e.value[2];if(!l._helper.isAlmostZero(g)&&!l._helper.isAlmostZero(h)&&!l._helper.isAlmostZero(m))return d=f.scaldiv(g,d),c=f.scaldiv(h,c),e=f.scaldiv(m,e),d=f.det3(d,c,e),l.realmult(.5,d)}return u};t.inverse$1=function(a,b){var d=C(a[0]);if("list"===
d.ctype){var c=f._helper.colNumb(d);if(-1!==c&&c===d.value.length)return f.inverse(d)}return u};t.linearsolve$2=function(a,b){var d=C(a[0]),c=C(a[1]);if("list"===d.ctype){var e=f._helper.colNumb(d);if(-1!==e&&e===d.value.length&&f._helper.isNumberVecN(c,e))return f.linearsolve(d,c)}return u};var hd=[[[]],[[0]],[[0,1],[1,0]],[[0,1,2],[0,2,1],[1,0,2],[1,2,0],[2,0,1],[2,1,0]],[[0,1,2,3],[0,1,3,2],[0,2,1,3],[0,2,3,1],[0,3,1,2],[0,3,2,1],[1,0,2,3],[1,0,3,2],[1,2,0,3],[1,2,3,0],[1,3,0,2],[1,3,2,0],[2,0,
1,3],[2,0,3,1],[2,1,0,3],[2,1,3,0],[2,3,0,1],[2,3,1,0],[3,0,1,2],[3,0,2,1],[3,1,0,2],[3,1,2,0],[3,2,0,1],[3,2,1,0]]];t.mincostmatching$1=function(a,b){var d=A(a[0]);if(f.isNumberMatrix(d)){var c=d.value.length,e=f._helper.colNumb(d),g=c<e?e:c,h,m,n=Array(g);for(h=0;h<g;++h)for(n[h]=Array(g),m=0;m<g;++m)n[h][m]=h<c&&m<e?d.value[h].value[m].value.real:0;d=Kb(n);g=Array(c);for(h=0;h<c;++h)m=d[h],g[h]=m<e?l.real(m+1):l.real(0);return f.turnIntoCSList(g)}return u};t.take$2=Lb;t.length$1=function(a,b){var d=
A(a[0]);return"list"===d.ctype||"string"===d.ctype?l.real(d.value.length):u};t.pairs$1=function(a,b){var d=A(a[0]);return"list"===d.ctype?f.pairs(d):u};t.triples$1=function(a,b){var d=A(a[0]);return"list"===d.ctype?f.triples(d):u};t.cycle$1=function(a,b){var d=A(a[0]);return"list"===d.ctype?f.cycle(d):u};t.consecutive$1=function(a,b){var d=A(a[0]);return"list"===d.ctype?f.consecutive(d):u};t.reverse$1=function(a,b){var d=A(a[0]);return"list"===d.ctype?f.reverse(d):u};t.directproduct$2=function(a,
b){var d=A(a[0]),c=A(a[1]);return"list"===d.ctype&&"list"===c.ctype?f.directproduct(d,c):u};t.concat$2=uc;t.common$2=vc;t.remove$2=wc;t.append$2=xc;t.prepend$2=yc;t.contains$2=function(a,b){var d=A(a[0]),c=A(a[1]);return"list"===d.ctype?f.contains(d,c):u};t.sort$2=function(a,b){return t.sort$3([a[0],null,a[1]],b)};t.sort$3=function(a,b){var d=C(a[0]);if("list"!==d.ctype)return u;var c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);var d=d.value,e=[];K.newvar(c);var f;for(f=0;f<d.length;f++)K.setvar(c,
d[f]),e[f]={val:d[f],result:A(a[2])};K.removevar(c);e.sort(w.compareResults);c=[];for(f=0;f<d.length;f++)c[f]=e[f].val;return{ctype:"list",value:c}};t.sort$1=function(a,b){var d=A(a[0]);return"list"===d.ctype?f.sort1(d):u};t.set$1=function(a,b){var d=A(a[0]);return"list"===d.ctype?f.set(d):u};t.combinations$2=function(a,b){function d(a,b){a===h?n.push(f.turnIntoCSList(m.slice())):b<g&&(m[a]=c.value[b],d(a+1,b+1),d(a,b+1))}var c=A(a[0]),e=A(a[1]),g,h,m,n;if("number"===e.ctype){h=e.value.real|0;if("number"===
c.ctype){g=c.value.real|0;g-h<h&&(h=g-h);if(0>h)return l.real(0);if(0===h)return l.real(1);if(1===h)return c;for(var p=e=1,q=1;q<=h;++q)var r=g-h+q|0,t=q|0,w=Mb(r,t)|0,r=r/w|0,t=t/w|0,w=Mb(e,t)|0,e=e/w|0,t=t/w|0,w=Mb(r,p)|0,r=r/w|0,p=p/w|0,e=e*r|0,p=p*t|0;return l.real(e/p)}if("list"===c.ctype){g=c.value.length;if(0>h||h>g)return f.turnIntoCSList([]);if(0===h)return f.turnIntoCSList([f.turnIntoCSList([])]);if(h===g)return f.turnIntoCSList([c]);n=[];m=Array(h);d(0,0);return f.turnIntoCSList(n)}}return u};
t.zeromatrix$2=function(a,b){var d=C(a[0]),c=C(a[1]);return"number"===d.ctype&&"number"===c.ctype?f.zeromatrix(d,c):u};t.zerovector$1=function(a,b){var d=C(a[0]);return"number"===d.ctype?f.zerovector(d):u};t.transpose$1=function(a,b){var d=C(a[0]);return"list"===d.ctype&&-1!==f._helper.colNumb(d)?f.transpose(d):u};t.row$2=function(a,b){var d=C(a[0]),c=C(a[1]);return"number"===c.ctype&&"list"===d.ctype&&-1!==f._helper.colNumb(d)?f.row(d,c):u};t.column$2=function(a,b){var d=C(a[0]),c=C(a[1]);return"number"===
c.ctype&&"list"===d.ctype&&-1!==f._helper.colNumb(d)?f.column(d,c):u};t.red$1=function(a,b){var d=A(a[0]);return"number"===d.ctype?f.realVector([Math.min(1,Math.max(0,d.value.real)),0,0]):u};t.green$1=function(a,b){var d=A(a[0]);return"number"===d.ctype?f.realVector([0,Math.min(1,Math.max(0,d.value.real)),0]):u};t.blue$1=function(a,b){var d=A(a[0]);return"number"===d.ctype?f.realVector([0,0,Math.min(1,Math.max(0,d.value.real))]):u};t.gray$1=function(a,b){var d=A(a[0]);return"number"===d.ctype?(d=
Math.min(1,Math.max(0,d.value.real)),f.realVector([d,d,d])):u};t.grey$1=t.gray$1;D.HSVtoRGB=function(a,b,d){var c,e,g,h,l,m;a&&void 0===b&&void 0===d&&(b=a.s,d=a.v,a=a.h);h=Math.floor(6*a);l=6*a-h;a=d*(1-b);m=d*(1-l*b);b=d*(1-(1-l)*b);switch(h%6){case 0:c=d;e=b;g=a;break;case 1:c=m;e=d;g=a;break;case 2:c=a;e=d;g=b;break;case 3:c=a;e=m;g=d;break;case 4:c=b;e=a;g=d;break;case 5:c=d,e=a,g=m}return f.realVector([c,e,g])};t.hue$1=function(a,b){var d=A(a[0]);return"number"===d.ctype?(d=d.value.real,d-=
Math.floor(d),D.HSVtoRGB(d,1,1)):u};D.shapeconvert=function(a){var b,d;if("circle"===a.type){b=a.value.value[0];b=w.div(b,b.value[2]);var c=b.value[0].value.real,e=b.value[1].value.real;a=a.value.value[1].value.real;d=Array(125);var f=2*Math.PI/125;for(b=0;125>b;b++)d[b]={X:c+Math.cos(b*f)*a,Y:e+Math.sin(b*f)*a};return[d]}if("polygon"===a.type){c=[];for(b=0;b<a.value.length;b++){e=a.value[b];d=[];for(f=0;f<e.length;f++)d[f]={X:e[f].X,Y:e[f].Y};c[b]=d}return c}};D.shapeop=function(a,b,d){a=D.shapeconvert(a);
var c=D.shapeconvert(b);ClipperLib.JS.ScaleUpPaths(a,1E3);ClipperLib.JS.ScaleUpPaths(c,1E3);b=new ClipperLib.Clipper;b.AddPaths(a,ClipperLib.PolyType.ptSubject,!0);b.AddPaths(c,ClipperLib.PolyType.ptClip,!0);var c=a=ClipperLib.PolyFillType.pftNonZero,e=new ClipperLib.Paths;b.Execute(d,e,a,c);ClipperLib.JS.ScaleDownPaths(e,1E3);return{ctype:"shape",type:"polygon",value:e}};D.shapecommon=function(a,b){return D.shapeop(a,b,ClipperLib.ClipType.ctIntersection)};D.shaperemove=function(a,b){return D.shapeop(a,
b,ClipperLib.ClipType.ctDifference)};D.shapeconcat=function(a,b){return D.shapeop(a,b,ClipperLib.ClipType.ctUnion)};t.key$0=function(a,b){return{ctype:"string",value:mc}};t.keycode$0=function(a,b){return l.real(nc)};t.mouse$0=function(a,b){return f.realVector([gb[0],gb[1]])};t.mover$0=function(a,b){if(ca&&ca.mover)return{ctype:"geo",value:ca.mover};console.log("Not moving anything at the moment");return u};t.translate$1=function(a,b){var d=C(a[0]);"list"===d.ctype&&f.isNumberVector(d)&&2===d.value.length&&
x.translate(d.value[0].value.real,d.value[1].value.real);return u};t.rotate$1=function(a,b){var d=C(a[0]);"number"===d.ctype&&x.rotate(d.value.real);return u};t.scale$1=function(a,b){var d=C(a[0]);"number"===d.ctype&&x.scale(d.value.real);return u};t.greset$0=function(a,b){var d=Ia.stack.length;x.greset();for(var c=0;c<d;c++)B.restore();return u};t.gsave$0=function(a,b){x.gsave();B.save();return u};t.grestore$0=function(a,b){x.grestore();B.restore();return u};t.color$1=function(a,b){var d=C(a[0]);
"list"===d.ctype&&f.isNumberVector(d).value&&x.setcolor(d);return u};t.linecolor$1=function(a,b){var d=C(a[0]);"list"===d.ctype&&f.isNumberVector(d).value&&x.setlinecolor(d);return u};t.pointcolor$1=function(a,b){var d=C(a[0]);"list"===d.ctype&&f.isNumberVector(d).value&&x.setpointcolor(d);return u};t.alpha$1=function(a,b){var d=C(a[0]);"number"===d.ctype&&x.setalpha(d);return u};t.pointsize$1=function(a,b){var d=C(a[0]);"number"===d.ctype&&x.setpointsize(d);return u};t.linesize$1=function(a,b){var d=
C(a[0]);"number"===d.ctype&&x.setlinesize(d);return u};t.textsize$1=function(a,b){var d=C(a[0]);"number"===d.ctype&&x.settextsize(d);return u};t.playanimation$0=function(a,b){R();return u};t.pauseanimation$0=function(a,b){Ua();return u};t.stopanimation$0=function(a,b){$a();return u};t.replace$3=function(a,b){var d=A(a[0]),c=A(a[1]),e=A(a[2]);if("string"===d.ctype&&"string"===c.ctype&&"string"===e.ctype)return d=d.value,c=c.value.replace(/[^A-Za-z0-9]/g,"\\$&"),e=e.value.replace(/\$/g,"$$$$"),d=d.replace(new RegExp(c,
"g"),e),{ctype:"string",value:d}};t.replace$2=function(a,b){function d(a,d,b){var k="";e=c=-1;for(var f=0;f<d.length;f++){var g=d[f][0],h=a.indexOf(g,b);-1!==h&&(-1===c?(k=g,c=h,e=f):h<c&&(k=g,c=h,e=f))}return k}var c,e,f,g=A(a[0]);f=A(a[1]);if("string"===g.ctype&&"list"===f.ctype){for(var g=g.value,h=[],l=0;l<f.value.length;l++){var m=f.value[l];"list"===m.ctype&&2===m.value.length&&"string"===m.value[0].ctype&&"string"===m.value[1].ctype&&(h[h.length]=[m.value[0].value,m.value[1].value])}c=-1;for(f=
d(g,h,0);-1!==c;)g=g.substring(0,c)+h[e][1]+g.substring(c+f.length,g.length),f=c+h[e][1].length,f=d(g,h,f);return{ctype:"string",value:g}}return u};t.substring$3=function(a,b){var d=A(a[0]),c=C(a[1]),e=C(a[2]);return"string"===d.ctype&&"number"===c.ctype&&"number"===e.ctype?{ctype:"string",value:d.value.substring(Math.floor(c.value.real),Math.floor(e.value.real))}:u};t.tokenize$2=function(a,b){var d=A(a[0]),c=A(a[1]);if("string"===d.ctype&&"string"===c.ctype)return t.tokenize$2([d,f.turnIntoCSList([c])],
b);if("string"===d.ctype&&"list"===c.ctype){d=d.value;if(0===c.value.length){c=!0;if(void 0!==b.autoconvert){var e=A(b.autoconvert);"boolean"===e.ctype&&(c=e.value)}return c&&(c=parseFloat(d),!isNaN(c))?l.real(c):w.string(d)}var e=c.value[0],g=f.turnIntoCSList(c.value.slice(1)),d=d.split(e.value);return f.turnIntoCSList(d.map(function(a){return t.tokenize$2([w.string(a),g],b)}))}return u};t.indexof$2=function(a,b){var d=A(a[0]),c=A(a[1]);return"string"===d.ctype&&"string"===c.ctype?(d=d.value.indexOf(c.value),
l.real(d+1)):u};t.indexof$3=function(a,b){var d=A(a[0]),c=A(a[1]),e=A(a[2]);return"string"===d.ctype&&"string"===c.ctype&&"number"===e.ctype?(d=d.value.indexOf(c.value,Math.round(e.value.real)-1),l.real(d+1)):u};t.parse$1=function(a,b){var d=A(a[0]);return"string"===d.ctype?(d=hb(d.value),d=na(d),A(d)):u};t.unicode$1=function(a,b){var d;d=A(a[0]);var c=16;if(b.base){var e=A(b.base);"number"===e.ctype&&(c=e.value.real)}if("string"===d.ctype)d=parseInt(d.value,c);else if("number"===d.ctype)d=d.value.real;
else return u;"undefined"!==typeof String.fromCodePoint?d=String.fromCodePoint(d):65535>=d?d=String.fromCharCode(d):(d-=65536,d=String.fromCharCode((d>>10)+55296,(d&1023)+56320));return w.string(d)};t.international$1=function(a,b){return t.international$2([a[0],null],b)};t.international$2=function(a,b){var d=A(a[0]);if("string"!==d.ctype)return u;var c=(p.translations||{})[p.language||"en"]||{};if(!c.hasOwnProperty(d.value))return d;var e=c[d.value];if("string"===typeof e)return w.string(e);if(null===
a[1])return d;var f=A(a[1]),f="number"===f.ctype?f.value.real:0,c=(c._pluralFormFunction||id)(f);return c<e.length?w.string(e[c]):d};t.currentlanguage$0=function(a,b){return w.string(p.language||"en")};D.basismap=function(a,b,d,c){var e=f.turnIntoCSList([a,b,d]),e=f.adjoint3(f.transpose(e));c=w.mult(e,c);e=f.turnIntoCSList([w.mult(c.value[0],a),w.mult(c.value[1],b),w.mult(c.value[2],d)]);return f.transpose(e)};t.map$8=function(a,b){var d=M(a[0]),c=M(a[1]),e=M(a[2]),g=M(a[3]),h=M(a[4]),l=M(a[5]),m=
M(a[6]),n=M(a[7]);return h!==u&&l!==u&&m!==u&&n!==u&&d!==u&&c!==u&&e!==u&&g!==u?(h=D.basismap(h,l,m,n),d=D.basismap(d,c,e,g),d=w.mult(h,f.adjoint3(d)),f.normalizeMax(d)):u};t.map$6=function(a,b){var d=M(a[0]),c=M(a[1]),e=M(a[2]),g=f.realVector([0,0,1]),h=f.cross,l=h(h(e,h(g,h(d,c))),h(c,h(g,h(d,e)))),m=M(a[3]),n=M(a[4]),p=M(a[5]),g=h(h(p,h(g,h(m,n))),h(n,h(g,h(m,p))));return m!==u&&n!==u&&p!==u&&g!==u&&d!==u&&c!==u&&e!==u&&l!==u?(m=D.basismap(m,n,p,g),d=D.basismap(d,c,e,l),d=w.mult(m,f.adjoint3(d)),
f.normalizeMax(d)):u};t.map$4=function(a,b){var d=f.ii,c=f.jj,e=M(a[0]),g=M(a[1]),h=M(a[2]),l=M(a[3]);return h!==u&&l!==u&&e!==u&&g!==u?(h=D.basismap(h,l,d,c),d=D.basismap(e,g,d,c),d=w.mult(h,f.adjoint3(d)),f.normalizeMax(d)):u};t.map$2=function(a,b){var d=f.ii,c=f.jj,e=M(a[0]),g=w.add(f.realVector([1,0,0]),e),h=M(a[1]),l=w.add(f.realVector([1,0,0]),h);return h!==u&&l!==u&&e!==u&&g!==u?(h=D.basismap(h,l,d,c),d=D.basismap(e,g,d,c),d=w.mult(h,f.adjoint3(d)),f.normalizeMax(d)):u};t.pointreflect$1=function(a,
b){var d=f.ii,c=f.jj,e=M(a[0]),g=w.add(f.realVector([1,0,0]),e),h=w.add(f.realVector([-1,0,0]),e);return h!==u&&e!==u&&g!==u?(h=D.basismap(e,h,d,c),d=D.basismap(e,g,d,c),d=w.mult(h,f.adjoint3(d)),f.normalizeMax(d)):u};t.linereflect$1=function(a,b){var d=f.ii,c=f.jj,e=M(a[0]),g=f.realVector([Math.random(),Math.random(),Math.random()]),h=f.realVector([Math.random(),Math.random(),Math.random()]),g=f.cross(g,e),h=f.cross(h,e);return e!==u&&g!==u?(e=D.basismap(g,h,d,c),d=D.basismap(g,h,c,d),d=w.mult(e,
f.adjoint3(d)),f.normalizeMax(d)):u};D.extractPointVec=function(a){var b={ok:!1};if("geo"===a.ctype){var d=a.value;if("P"===d.kind)return b.x=ua.getField(d,"x"),b.y=ua.getField(d,"y"),b.z=l.real(1),b.ok=!0,b}if("list"!==a.ctype)return b;var c=a.value;if(2===c.length&&(a=c[0],d=c[1],"number"===a.ctype&&"number"===d.ctype))return b.x=a,b.y=d,b.z=l.real(1),b.ok=!0,b;3===c.length&&(a=c[0],d=c[1],c=c[2],"number"===a.ctype&&"number"===d.ctype&&"number"===c.ctype&&(b.x=l.div(a,c),b.y=l.div(d,c),b.z=l.real(1),
b.ok=!0));return b};t.polygon$1=function(a,b){var d=A(a[0]);if("list"===d.ctype){for(var c=[],e=0;e<d.value.length;e++){var f=D.extractPoint(d.value[e]);if(!f.ok)return u;c[e]={X:f.x,Y:f.y}}return{ctype:"shape",type:"polygon",value:[c]}}return u};t.circle$2=function(a,b){var d=C(a[0]),c=C(a[1]),d=D.extractPointVec(d);if(!d.ok||"number"!==c.ctype)return u;d=f.turnIntoCSList([d.x,d.y,d.z]);return{ctype:"shape",type:"circle",value:f.turnIntoCSList([d,c])}};t.screen$0=function(a,b){var d=x.drawingstate.initialmatrix,
c=function(a,b){var k=a-d.tx,c=b+d.ty;return{X:(k*d.d-c*d.b)/d.det,Y:-(-k*d.c+c*d.a)/d.det}};return{ctype:"shape",type:"polygon",value:[[c(0,0),c(ea,0),c(ea,Y),c(0,Y)]]}};t.halfplane$2=function(a,b){var d=C(a[0]),c=C(a[1]),e=M(d),g=M(c);if(d!==u&&c!==u){var h=c.usage,c=g;if("Line"===d.usage||"Point"===h)e=g,c=d;d=f.turnIntoCSList([c.value[0],c.value[1],l.zero]);d=f.cross(d,e);g=f.cross(c,d);g=w.div(g,g.value[2]);e=w.div(e,e.value[2]);e=f.sub(e,g);d=f.abs(e);e=w.div(e,d);d=g.value[0].value.real;g=
g.value[1].value.real;c=1E3*e.value[0].value.real;e=1E3*e.value[1].value.real;return{ctype:"shape",type:"polygon",value:[[{X:d+e/2,Y:g-c/2},{X:d+e/2+c,Y:g-c/2+e},{X:d-e/2+c,Y:g+c/2+e},{X:d-e/2,Y:g+c/2}]]}}return u};t.element$1=function(a,b){var d=A(a[0]);return"string"===d.ctype&&m.hasOwnProperty(d.value)?{ctype:"geo",value:m[d.value]}:u};D.all$1=function(a,b){var d=A(a[0]);return"geo"===d.ctype&&d.value.incidences?f.ofGeos(d.value.incidences.map(function(a){return m[a]}).filter(b)):f.nil};t.allpoints$0=
function(a,b){return f.ofGeos(H)};t.allpoints$1=function(a,b){return D.all$1(a,function(a){return"P"===a.kind})};t.allmasses$0=function(a,b){return f.ofGeos(Z)};t.allmasses$1=function(a,b){return D.all$1(a,function(a){return"P"===a.kind&&a.behavior&&"Mass"===a.behavior.type})};t.allsprings$0=function(a,b){return f.ofGeos(Yb)};t.allsprings$1=function(a,b){return D.all$1(a,function(a){return"S"===a.kind&&a.behavior&&"Spring"===a.behavior.type})};t.alllines$0=function(a,b){return f.ofGeos(T)};t.alllines$1=
function(a,b){return D.all$1(a,function(a){return"L"===a.kind||"S"===a.kind})};t.allsegments$0=function(a,b){return f.ofGeos(T.filter(function(a){return"S"===a.kind}))};t.allsegments$1=function(a,b){return D.all$1(a,function(a){return"S"===a.kind})};t.allconics$0=function(a,b){return f.ofGeos(U)};t.allconics$1=function(a,b){return D.all$1(a,function(a){return"C"===a.kind})};t.allcircles$0=function(a,b){return f.ofGeos(U.filter(function(a){return"Circle"===a.matrix.usage}))};t.allcircles$1=function(a,
b){return D.all$1(a,function(a){return"C"===a.kind&&"Circle"===a.matrix.usage})};t.allelements$0=function(a,b){return f.ofGeos(E)};t.allelements$1=function(a,b){return D.all$1(a,function(a){return!0})};t.incidences$1=t.allelements$1;t.createpoint$2=function(a,b){var d=A(a[0]),c=M(a[1]);return"string"!==d.ctype?(console.log("Name must be a string"),u):"list"!==c.ctype&&f.isNumberVector(c)?(console.log("Position must be a number vector"),u):Rb({name:d.value,type:"Free",labeled:!0,pos:c})};t.create$3=
function(a,b){var d=A(a[0]),c=A(a[1]),e=A(a[2]),f;if("string"===d.ctype)f=d.value;else{if("list"!==d.ctype)return console.log("Names must be a string or a list of strings"),u;if(1!==d.value.length)return console.log("multi-result compatibility operations not supported yet"),u;if("string"!==d.value[0].ctype)return console.log("Element of names list must be a string"),u;f=d.value[0].value}if("string"!==c.ctype)return console.log("Type must be a string"),u;if("list"!==e.ctype)return console.log("Arguments must be a list"),
u;if(void 0===n[c.value])return console.log("Invalid geometric operation: '"+c.value+"'"),u;for(var d=[],g=null,h=0;h<e.value.length;h++){var l=e.value[h];if("string"===l.ctype)d.push(l.value);else if(g=M(l),g===u)return console.log("Unknown argument type"),u}c={name:f,type:c.value,labeled:!0};g&&(c.pos=g);0<d.length&&(c.args=d);return Rb(c)};t.javascript$1=function(a,b){var d=A(a[0]);"string"===d.ctype&&(new Function(d.value)).call(ka);return u};t.use$1=function(a,b){function d(a,d,b){t[a+"$"+d]=
b}var c=A(a[0]);if("string"===c.ctype){var c=c.value,e;p.plugins&&(e=p.plugins[c]);e||(e=ta._pluginRegistry[c]);if(e)return e({instance:ka,config:p,nada:u,evaluate:A,extractPoint:D.extractPoint,evaluateAndVal:C,defineFunction:d,addShutdownHook:Wa.push.bind(Wa),addAutoCleaningEventListener:P,getVariable:K.getvar.bind(K),getInitialMatrix:function(){return x.drawingstate.initialmatrix},setTextRenderer:function(a){Uc=a},getImage:function(a,d){if(!ja.hasOwnProperty(a))return null;var b=ja[a];!d&&b.cdyUpdate()&&
b.cdyUpdate();return b},getMyfunction:function(a){return eb.hasOwnProperty(a)?eb[a]:null}}),{ctype:"boolean",value:!0};console.log("Plugin "+c+" not found");return{ctype:"boolean",value:!1}}return u};t.format$2=function(a,b){function d(a){a=a.toFixed(g);var d;do d=a,a=a.substring(0,a.length-1);while(""!==a&&"-"!==a&&+a===+d);return""+d}function c(a){var b;return"number"===a.ctype?(b=d(a.value.real),a=d(a.value.imag),b="0"===a?b:"-"===a.substring(0,1)?b+" - i*"+a.substring(1):b+" + i*"+a,{ctype:"string",
value:b}):"list"===a.ctype?{ctype:"list",value:a.value.map(c)}:{ctype:"string",value:L(a).toString()}}var e=C(a[0]),f=C(a[1]),g;return"number"!==e.ctype&&"list"!==e.ctype||"number"!==f.ctype?u:(g=Math.round(f.value.real),c(e))};Date.now||(Date.now=function(){return(new Date).getTime()});var Vc=0;t.seconds$0=function(a,b){return{ctype:"number",value:{real:(Date.now()-Vc)/1E3,imag:0}}};t.resetclock$0=function(a,b){Vc=Date.now();return u};t.time$0=function(a,b){var d=new Date;return f.realVector([d.getHours(),
d.getMinutes(),d.getSeconds(),d.getMilliseconds()])};t.date$0=function(a,b){var d=new Date;return f.realVector([d.getFullYear(),d.getMonth(),d.getDay()])};t.setTimeout$2=function(a,b){function d(){A(f);c()}var e=A(a[0]),f=a[1];"number"===e.ctype&&"undefined"!==typeof window&&window.setTimeout(d,1E3*e.value.real);return u};D.formatForWebGL=function(a){return a.toFixed(10)};t.generateWebGL$2=function(a,b){var d=D.formatForWebGL,c=a[0],e=A(a[1]);console.log(e);if("list"!==e.ctype)return u;for(var f=
[],g=0;g<e.value.length;g++)"string"===e.value[g].ctype&&f.push(e.value[g].value);console.log("***********");console.log(f);e=D.plotvars(c);console.log(e);-1===e.indexOf("a")&&-1===e.indexOf("b")&&-1===e.indexOf("c")&&-1===e.indexOf("d")&&-1===e.indexOf("e")&&-1===e.indexOf("f")&&(c=C(c));if("number"===c.ctype)return{ctype:"string",value:"vec2("+d(c.value.real)+","+d(c.value.imag)+")"};if("variable"===c.ctype)return{ctype:"string",value:c.name};if("string"===c.ctype||"void"===c.ctype)return c;if(2===
c.args.length&&("infix"===c.ctype||"function"===c.ctype)){d=t.compileToWebGL$1([c.args[0]],{});e=t.compileToWebGL$1([c.args[1]],{});if("+"===c.oper||"add"===c.oper)return void 0===d.value||"void"===d.ctype?{ctype:"string",value:e.value}:{ctype:"string",value:"addc("+d.value+","+e.value+")"};if("*"===c.oper||"mult"===c.oper)return{ctype:"string",value:"multc("+d.value+","+e.value+")"};if("/"===c.oper||"div"===c.oper)return{ctype:"string",value:"divc("+d.value+","+e.value+")"};if("-"===c.oper||"sub"===
c.oper)return void 0===d.value||"void"===d.ctype?{ctype:"string",value:"negc("+e.value+")"}:{ctype:"string",value:"subc("+d.value+","+e.value+")"};if("^"===c.oper||"pow"===c.oper)return{ctype:"string",value:"powc("+d.value+","+e.value+")"}}if("function"===c.ctype&&1===c.args.length){d=t.compileToWebGL$1([c.args[0]],{});if("sin$1"===c.oper)return{ctype:"string",value:"sinc("+d.value+")"};if("cos$1"===c.oper)return{ctype:"string",value:"cosc("+d.value+")"};if("tan$1"===c.oper)return{ctype:"string",
value:"tanc("+d.value+")"};if("exp$1"===c.oper)return{ctype:"string",value:"expc("+d.value+")"};if("log$1"===c.oper)return{ctype:"string",value:"logc("+d.value+")"};if("arctan$1"===c.oper)return{ctype:"string",value:"arctanc("+d.value+")"};if("arcsin$1"===c.oper)return{ctype:"string",value:"arcsinc("+d.value+")"};if("arccos$1"===c.oper)return{ctype:"string",value:"arccosc("+d.value+")"};if("sqrt$1"===c.oper)return{ctype:"string",value:"sqrtc("+d.value+")"}}return u};t.compileToWebGL$1=function(a,
b){var d,c;d=D.formatForWebGL;var e=a[0];c=D.plotvars(e);-1===c.indexOf("a")&&-1===c.indexOf("b")&&-1===c.indexOf("c")&&-1===c.indexOf("d")&&-1===c.indexOf("e")&&-1===c.indexOf("f")&&(e=C(e));if("number"===e.ctype)return{ctype:"string",value:"vec2("+d(e.value.real)+","+d(e.value.imag)+")"};if("variable"===e.ctype)return{ctype:"string",value:e.name};if("string"===e.ctype||"void"===e.ctype)return e;if(2===e.args.length&&("infix"===e.ctype||"function"===e.ctype)){d=t.compileToWebGL$1([e.args[0]],{});
c=t.compileToWebGL$1([e.args[1]],{});if("+"===e.oper||"add"===e.oper)return void 0===d.value||"void"===d.ctype?{ctype:"string",value:c.value}:{ctype:"string",value:"addc("+d.value+","+c.value+")"};if("*"===e.oper||"mult"===e.oper)return{ctype:"string",value:"multc("+d.value+","+c.value+")"};if("/"===e.oper||"div"===e.oper)return{ctype:"string",value:"divc("+d.value+","+c.value+")"};if("-"===e.oper||"sub"===e.oper)return void 0===d.value||"void"===d.ctype?{ctype:"string",value:"negc("+c.value+")"}:
{ctype:"string",value:"subc("+d.value+","+c.value+")"};if("^"===e.oper||"pow"===e.oper)return{ctype:"string",value:"powc("+d.value+","+c.value+")"}}if("function"===e.ctype&&1===e.args.length){d=t.compileToWebGL$1([e.args[0]],{});if("sin$1"===e.oper)return{ctype:"string",value:"sinc("+d.value+")"};if("cos$1"===e.oper)return{ctype:"string",value:"cosc("+d.value+")"};if("tan$1"===e.oper)return{ctype:"string",value:"tanc("+d.value+")"};if("exp$1"===e.oper)return{ctype:"string",value:"expc("+d.value+")"};
if("log$1"===e.oper)return{ctype:"string",value:"logc("+d.value+")"};if("arctan$1"===e.oper)return{ctype:"string",value:"arctanc("+d.value+")"};if("arcsin$1"===e.oper)return{ctype:"string",value:"arcsinc("+d.value+")"};if("arccos$1"===e.oper)return{ctype:"string$1",value:"arccosc("+d.value+")"};if("sqrt$1"===e.oper)return{ctype:"string",value:"sqrtc("+d.value+")"}}return u};t.setsimulationspeed$1=function(a,b){var d=C(a[0]);"number"===d.ctype&&"undefined"!==typeof J&&"undefined"!==typeof J.env&&(J.env.deltat=
d.value.real);return u};t.setsimulationaccuracy$1=function(a,b){var d=C(a[0]);"number"===d.ctype&&"undefined"!==typeof J&&"undefined"!==typeof J.env&&(J.env.accuracy=d.value.real);return u};t.setsimulationquality$1=function(a,b){var d=C(a[0]);"number"===d.ctype&&"undefined"!==typeof J&&"undefined"!==typeof J.env&&(d=d.value.real,0===d&&(J.env.errorbound=.01,J.env.lowestdeltat=1E-5,J.env.slowdownfactor=2),1===d&&(J.env.errorbound=.001,J.env.lowestdeltat=1E-7,J.env.slowdownfactor=2),2===d&&(J.env.errorbound=
1E-5,J.env.lowestdeltat=1E-10,J.env.slowdownfactor=4),3===d&&(J.env.errorbound=1E-6,J.env.lowestdeltat=1E-12,J.env.slowdownfactor=4));return u};D.extractPoint=function(a){var b={ok:!1};if("geo"===a.ctype){var d=a.value;if("P"===d.kind)return b.x=ua.getField(d,"x").value.real,b.y=ua.getField(d,"y").value.real,b.ok=!0,b}if("list"!==a.ctype)return b;var c=a.value;if(2===c.length&&(a=c[0],d=c[1],"number"===a.ctype&&"number"===d.ctype))return b.x=a.value.real,b.y=d.value.real,b.ok=!0,b;3===c.length&&(a=
c[0],d=c[1],c=c[2],"number"===a.ctype&&"number"===d.ctype&&"number"===c.ctype&&(a=l.div(a,c),d=l.div(d,c),b.x=a.value.real,b.y=d.value.real,b.ok=!0));return b};t.draw$1=function(a,b){var d=C(a[0]);if("shape"===d.ctype)D.drawshape(d,b);else if("Line"===d.usage)y.handleModifs(b,y.lineModifs),y.drawline(d);else{var c=D.extractPoint(d);if(!c.ok){if("undefined"!==typeof d.value&&2===d.value.length)return t.draw$2(d.value,b);return}null!==b&&y.handleModifs(b,y.pointModifs);y.drawpoint(c)}return u};t.draw$2=
function(a,b){var d=C(a[0]),c=C(a[1]),d=D.extractPoint(d),c=D.extractPoint(c);if(!d.ok||!c.ok)return u;null!==b&&y.handleModifs(b,y.lineModifs);y.drawsegcore(d,c);return u};t.drawcircle$2=function(a,b){return D.drawcircle(a,b,"D")};D.arcHelper=function(a){var b={};b.startPoint=M(a[0]);b.viaPoint=M(a[1]);b.endPoint=M(a[2]);return b};t.fillcircle$2=function(a,b){return D.drawcircle(a,b,"F")};t.drawarc$3=function(a,b){var d=D.arcHelper(a);return D.drawarc(d,b,"D")};t.fillarc$3=function(a,b){var d=D.arcHelper(a);
return D.drawarc(d,b,"F")};D.drawarc=function(a,b,d){var c=a.startPoint,e=a.viaPoint;a=a.endPoint;if(!f._helper.isAlmostReal(f.turnIntoCSList([c,e,a])))return u;y.handleModifs(b,y.conicModifs);y.preDrawCurve();b=f.det3(c,e,a);if(1E-12<Math.abs(b.value.real)){b=n._helper.ConicBy5(null,c,e,a,f.ii,f.jj);var g=n._helper.CenterOfConic(b),g=f.normalizeMax(g);b=l.real(0);var h=f.turnIntoCSList([f.turnIntoCSList([g.value[2],b,l.neg(g.value[0])]),f.turnIntoCSList([b,g.value[2],l.neg(g.value[1])]),f.turnIntoCSList([b,
b,g.value[2]])]);b=f.normalizeZ(w.mult(h,c));f.normalizeZ(w.mult(h,e));h=f.normalizeZ(w.mult(h,a));b=-Math.atan2(b.value[1].value.real,b.value[0].value.real);h=-Math.atan2(h.value[1].value.real,h.value[0].value.real);g=f.normalizeZ(g);c=f.normalizeZ(c);e=f.normalizeZ(e);a=f.normalizeZ(a);var m=f.abs(f.sub(c,g)),p=[g.value[0].value.real,g.value[1].value.real],q=x.drawingstate.matrix,g=p[0]*q.a-p[1]*q.b+q.tx,p=p[0]*q.c-p[1]*q.d-q.ty,e=0<f.det3(c,e,a).value.real;B.save();c=m.value.real*q.sdet;B.beginPath();
B.translate(g,p);b>h&&(h+=2*Math.PI);e=e?-(2*Math.PI-h+b)/500:(h-b)/500;B.moveTo(c*Math.cos(b),c*Math.sin(b));for(h=0;500>=h;h++)a=b+h*e,B.lineTo(c*Math.cos(a),c*Math.sin(a));"F"===d&&(B.fillStyle=y.lineColor,B.closePath(),B.fill());"D"===d&&B.stroke();B.restore()}else{if("D"!==d)return u;d=D.extractPoint(c);h=D.extractPoint(e);b=D.extractPoint(a);if(!d.ok||!h.ok||!b.ok)return u;m=(d.x-h.x)*(d.x-h.x)+(d.y-h.y)*(d.y-h.y);g=(d.x-b.x)*(d.x-b.x)+(d.y-b.y)*(d.y-b.y);q=(b.x-h.x)*(b.x-h.x)+(b.y-h.y)*(b.y-
h.y);if(1E-12>m||1E-12>g||1E-12>q)return u;0>f.crossratio3(c,a,e,f.cross(f.cross(c,e),f.linfty),f.ii).value.real?y.drawsegcore(d,b):(e=m>q?1:-1,c=e*(d.x-h.x),e*=d.y-h.y,a=25E3/x.drawingstate.matrix.sdet/Math.sqrt(c*c+e*e),c*=a,e*=a,y.drawsegcore(d,{x:d.x+c,y:d.y+e}),y.drawsegcore(b,{x:b.x-c,y:b.y-e}))}return u};D.drawcircle=function(a,b,d){var c=C(a[0]);a=C(a[1]);var e=D.extractPoint(c);if(!e.ok||"number"!==a.ctype||!l._helper.isAlmostReal(a))return u;var c=x.drawingstate.matrix,f=e.x*c.a-e.y*c.b+
c.tx,e=e.x*c.c-e.y*c.d-c.ty;y.handleModifs(b,y.conicModifs);y.preDrawCurve();B.lineJoin="miter";B.beginPath();B.arc(f,e,Math.abs(a.value.real)*c.sdet,0,2*Math.PI);B.closePath();"D"===d&&B.stroke();"F"===d&&(B.fillStyle=y.lineColor,B.fill());"C"===d&&B.clip();return u};t.drawconic$1=function(a,b){var d;d=C(a[0]);if("list"!==d.ctype||3!==d.value.length&&6!==d.value.length)return console.error("could not parse conic"),u;if(6===d.value.length){for(var c=0;6>c;c++)if("number"!==d.value[c].ctype)return console.error("could not parse conic"),
u;var e=l.real(.5),c=d.value[0],g=d.value[2],g=l.mult(g,e),h=d.value[1],m=d.value[3],m=l.mult(m,e),n=d.value[4],n=l.mult(n,e);d=d.value[5];d=f.turnIntoCSList([f.turnIntoCSList([c,g,m]),f.turnIntoCSList([g,h,n]),f.turnIntoCSList([m,n,d])])}else{for(c=0;3>c;c++)for(g=0;3>g;g++)if("number"!==d.value[c].value[g].ctype)return console.error("could not parse conic"),u;f.equals(d,f.transpose(d)).value||(c=w.mult(d,l.real(.5)),d=w.mult(f.transpose(d),l.real(.5)),d=f.add(c,d))}d=f.normalizeMax(d);return D.drawconic(d,
b)};D.drawconic=function(a,b){y.handleModifs(b,y.conicModifs);if(0!==y.lsize){y.preDrawCurve();for(var d=f.normalizeMax(a),c=d,e=0;2>e;e++)for(var g=0;2>g;g++)if(Math.abs(d.value[e].value[g].value.imag)>l.eps)return;e=f.turnIntoCSList([f.realVector([-1,-1,1]),f.realVector([1,0,0]),f.realVector([0,1,0])]);g=x.from(0,0,1);g[2]=1;var h=x.from(1,0,1);h[2]=1;var m=x.from(0,1,1);m[2]=1;var g=f.turnIntoCSList([f.realVector(g),f.realVector(h),f.realVector(m)]),g=f.transpose(g),e=w.mult(g,e),e=f.inverse(e),
d=w.mult(f.transpose(e),d),d=w.mult(d,e),e=d.value[0].value[0].value.real,g=d.value[1].value[0].value.real,h=d.value[1].value[1].value.real,m=d.value[2].value[0].value.real,p=d.value[2].value[1].value.real,q=d.value[2].value[2].value.real,d=[[e,g,m],[g,h,p],[m,p,q]],r=1E-14>Math.abs(e*h*q-e*p*p-g*g*q+2*g*m*p-h*m*m);if(r&&"Circle"===a.usage){var z=w.mult(f.adjoint3(c),f.linfty);l.abs(z.value[2]).value.real>l.eps&&(r=!1)}var z=ea>Y?ea:Y,A=-1.5*z,C=1.5*z,D=-1.5*z,E=1.5*z,F=1;r&&(F=0);if(F)var m=0,m=
1E-14<Math.abs(e-g)?Math.atan(g/e-h)/2:Math.PI/4,bb=function(a){var b=Math.cos(a);a=Math.sin(a);return[[b,-a,0],[a,b,0],[0,0,1]]}(m),bb=f.realMatrix(bb),e=f.transpose(bb),d=w.mult(f.realMatrix(d),bb),d=w.mult(e,d),e=d.value[0].value[0].value.real,g=d.value[1].value[0].value.real,h=d.value[1].value[1].value.real,m=d.value[2].value[0].value.real,p=d.value[2].value[1].value.real,q=d.value[2].value[2].value.real;var d=[e,g,h,m,p,q],e=function(){var a=n._helper.splitDegenConic(c);if(a!==u){var d=a[1],
a=[a[0]];t.draw$1(a,b);a[0]=d;t.draw$1(a,b)}},G=function(a){"undefined"!==a&&6===a.length||console.error("this does not define a Conic");if(r)return"degenerate";a=a[0]*a[2]-a[1]*a[1];return 1E-14>Math.abs(a)?"parabola":1E-14<a?"ellipsoid":"hyperbola"};G(d);var I=function(a,b){return 0<a&&a<ea&&0<b&&b<Y},H=[],J=[],K=[],L=[],M=[],N=[],O=function(){H=[];J=[];K=[];L=[];M=[];N=[]},P=function(a,b){B.beginPath();B.moveTo(a[0],b[0]);for(var d=1;d<a.length;d++)B.lineTo(a[d],b[d]);B.stroke()},Q=function(a,
b,d){var c,k,e=G(a);if(6!==a.length)console.error("Conic needs 6 Parameters");else{var g=a[0],h=a[1],v=a[2],l=a[3],m=a[4];a=a[5];var n;c=d-b;for(var Ca=.1*c+b,p=d-.1*c,q=b;q<=d;q+=n){n=q<Ca||q>p||100>Math.abs(d-b)?.5:0>q||q>Y?10:3;k=-g*v*q*q-2*g*m*q-g*a+h*h*q*q+2*h*l*q+l*l;k=Math.sqrt(k);c=1/g*(-h*q-l+k);k=-1/g*(h*q+l+k);var r,oa;F?(r=[c,q,1],oa=[k,q,1],r=w.mult(bb,f.realVector(r)),oa=w.mult(bb,f.realVector(oa)),c=r.value[0].value.real,k=oa.value[0].value.real,r=r.value[1].value.real,oa=oa.value[1].value.real):
oa=r=q;isNaN(c)||"ellipsoid"!==e?!isNaN(c)&&c>=A&&c<=C&&(H.push(c),K.push(r)):(H.push(c),K.push(r));isNaN(k)||"ellipsoid"!==e?!isNaN(k)&&k>=A&&k<=C&&(J.push(k),L.push(oa)):(J.push(k),L.push(oa))}}},g=function(a){var b,d,c;G(a);if(6!==a.length)console.error("Conic needs 6 Parameters");else{c=a[0];var k=a[1],e=a[2],f=a[3],g=a[4],h=a[5];b=-c*g+k*f;d=Math.sqrt(c*(-c*e*h+c*Math.pow(g,2)+Math.pow(k,2)*h-2*k*f*g+e*Math.pow(f,2)));e=c*e-Math.pow(k,2);1E-14<Math.abs(e)?(c=(b-d)/e,d=(b+d)/e):d=c=(-c*h+f*f)/
(2*c*g-2*k*f);!isNaN(c)&&c>D&&c<E||(c=D);!isNaN(d)&&d>D&&d<E||(d=D);b=c<d?c:d;d=c>d?c:d;Q(a,D,b);M=H.concat(J.reverse());N=K.concat(L.reverse());P(M,N);O();Q(a,d,E);P(H,K);if(I(H[0],K[1])||I(J[0],L[0]))B.beginPath(),B.moveTo(H[0],K[0]),B.lineTo(J[0],L[0]),B.stroke();P(J,L);O();Q(a,b,d);P(H,K);B.beginPath();B.moveTo(H[0],K[0]);B.lineTo(J[0],L[0]);B.stroke();B.beginPath();B.moveTo(H[H.length-1],K[K.length-1]);B.lineTo(J[J.length-1],L[L.length-1]);B.stroke();P(J,L);O()}};r?e():g(d)}};t.drawall$1=function(a,
b){var d=A(a[0]);if("list"===d.ctype){y.handleModifs(b,y.pointAndLineModifs);for(var c=0;c<d.value.length;c++)t.draw$1([d.value[c]],null)}return u};t.connect$1=function(a,b){return D.drawpolygon(a,b,"D",!1)};t.drawpoly$1=function(a,b){return D.drawpolygon(a,b,"D",!0)};t.fillpoly$1=function(a,b){return D.drawpolygon(a,b,"F",!0)};t.drawpolygon$1=function(a,b){return D.drawpolygon(a,b,"D",!0)};t.fillpolygon$1=function(a,b){return D.drawpolygon(a,b,"F",!0)};D.drawpolygon=function(a,b,d,c){function e(){for(var a=
h.value,b=0;b<a.length;b++){var d=a[b],c;for(c=0;c<d.length;c++){var k=d[c],f=k.X*g.a-k.Y*g.b+g.tx,k=k.X*g.c-k.Y*g.d-g.ty;0===c?B.moveTo(f,k):B.lineTo(f,k)}B.closePath()}}function f(){var a;for(a=0;a<h.value.length;a++){var b=D.extractPoint(h.value[a]);if(!b.ok)return;var d=b.x*g.a-b.y*g.b+g.tx,b=b.x*g.c-b.y*g.d-g.ty;0===a?B.moveTo(d,b):B.lineTo(d,b)}c&&B.closePath()}y.handleModifs(b,y.conicModifs);y.preDrawCurve();B.mozFillRule="evenodd";var g=x.drawingstate.matrix,h=A(a[0]);B.beginPath();"list"===
h.ctype&&f();"shape"===h.ctype&&e();"D"===d&&B.stroke();"F"===d&&(B.fillStyle=y.lineColor,B.fill());"C"===d&&B.clip();return u};var Uc=function(a,b,d,c,e){var f=a.measureText(b).width;a.fillText(b,d-f*e,c)};t.drawtext$2=function(a,b){var d=C(a[0]),c=A(a[1]),e=D.extractPoint(d);if(!e.ok)return u;var f=x.drawingstate.matrix,d=e.x*f.a-e.y*f.b+f.tx,e=e.x*f.c-e.y*f.d-f.ty;y.handleModifs(b,y.textModifs);f=x.drawingstate.textsize;null!==y.size&&(f=y.size);B.fillStyle=y.textColor;B.font=y.bold+y.italics+
Math.round(10*f)/10+"px "+y.family;c=L(c);Uc(B,c,d+y.xOffset,e-y.yOffset,y.align);return u};D.drawshape=function(a,b){return"polygon"===a.type?D.drawpolygon([a],b,"D",1):"circle"===a.type?D.drawcircle([a.value.value[0],a.value.value[1]],b,"D"):u};D.fillshape=function(a,b){return"polygon"===a.type?D.drawpolygon([a],b,"F",1):"circle"===a.type?D.drawcircle([a.value.value[0],a.value.value[1]],b,"F"):u};D.clipshape=function(a,b){return"polygon"===a.type?D.drawpolygon([a],b,"C",1):"circle"===a.type?D.drawcircle([a.value.value[0],
a.value.value[1]],b,"C"):u};t.fill$1=function(a,b){var d=A(a[0]);return"shape"===d.ctype?D.fillshape(d,b):u};t.clip$1=function(a,b){var d=A(a[0]);return"shape"===d.ctype?D.clipshape(d,b):"list"===d.ctype?(d=t.polygon$1(a,[]),t.clip$1([d],[])):u};t.plot$1=function(a,b){return t.plot$2([a[0],null],b)};t.plot$2=function(a,b){function d(a){return"number"===a.ctype&&l._helper.isAlmostReal(a)}function c(a,b,d,k,e){m++;b=+b.value.real;e=+k.value.real;k=b*E.a-e*E.b+E.tx;b=b*E.c-e*E.d-E.ty;a=+a.value.real;
e=+d.value.real;d=a*E.a-e*E.b+E.tx;a=a*E.c-e*E.d-E.ty;n?(B.lineTo(d,a),B.lineTo(k,b)):(B.beginPath(),B.moveTo(d,a),B.lineTo(k,b),n=!0)}function e(a,b,k,f,m){var p=d(k),q=d(f);if(.001>m)!g&&n&&(B.stroke(),n=!1);else if(p||q){var r=l.real((a.value.real+b.value.real)/2);K.setvar(z,r);var t=A(w),u=d(t);if(p&&q&&u){var x=k.value.real,q=t.value.real,u=f.value.real;if(p=1>Math.abs(x+u-2*q)/h){var Eb=l.real((a.value.real+r.value.real)/2);K.setvar(z,Eb);var Eb=A(w),y=l.real((r.value.real+b.value.real)/2);
K.setvar(z,y);y=A(w);x=Math.abs(x+q-2*Eb.value.real)/h;q=Math.abs(q+u-2*y.value.real)/h;p=p&&1>x&&1>q}p?(c(a,r,k,t,m/2),c(r,b,t,f,m/2)):(e(a,r,k,t,m/2),e(r,b,t,f,m/2))}else e(a,r,k,t,m/2),e(r,b,t,f,m/2)}}var g=!1,h=.2/pb,m=0,n=!1,p=-10,q=10,r=1,t=1E3,w=a[0],z;if(null!==a[1]&&"variable"===a[1].ctype)z=a[1].name;else{var C=D.plotvars(w);z="#";-1!==C.indexOf("t")&&(z="t");-1!==C.indexOf("z")&&(z="z");-1!==C.indexOf("y")&&(z="y");-1!==C.indexOf("x")&&(z="x")}K.newvar(z);var E=x.drawingstate.matrix;y.handleModifs(b,
{color:!0,alpha:!0,size:!0,dashpattern:!0,dashtype:!0,dashing:!0,lineCap:!0,lineJoin:!0,miterLimit:!0,connect:function(a){"boolean"===a.ctype&&(g=a.value)},start:function(a){"number"===a.ctype&&(p=a.value.real)},stop:function(a){"number"===a.ctype&&(q=a.value.real)},steps:function(a){"number"===a.ctype&&(t=a.value.real)}});B.strokeStyle=y.lineColor;B.lineWidth=y.lsize;var F,G,I,H,n=!1,C=l.real(14.32);K.setvar(z,C);I=A(w);if("number"!==I.ctype){if(f.isNumberVector(I).value&&2===I.value.length){n=!1;
r=(q-p)/t;for(C=p;C<q;C+=r)K.setvar(z,l.real(C)),H=A(w),f.isNumberVector(H).value&&2===H.value.length&&(F=+H.value[0].value.real,G=+H.value[1].value.real,H=F*E.a-G*E.b+E.tx,F=F*E.c-G*E.d-E.ty,n?B.lineTo(H,F):(B.beginPath(),B.moveTo(H,F),n=!0));B.stroke();K.removevar(z)}return u}for(H=p;H<q+r;H+=r)C=l.real(H),K.setvar(z,C),I=A(w),C.value.real>p&&e(F,C,G,I,r),F=C,G=I;K.removevar(z);n&&B.stroke();return u};t.plotX$1=function(a,b){var d=a[0],c=D.plotvars(d),e="#";-1!==c.indexOf("t")&&(e="t");-1!==c.indexOf("z")&&
(e="z");-1!==c.indexOf("y")&&(e="y");-1!==c.indexOf("x")&&(e="x");K.newvar(e);c=x.drawingstate.matrix;B.fillStyle=x.drawingstate.linecolor;B.lineWidth=1;B.lineCap=y.lineCap;B.lineJoin=y.lineJoin;B.miterLimit=y.miterLimit;for(var f=!1,g=-10;10>g;g+=.01){K.setvar(e,l.real(g));var h=A(d);if("number"===h.ctype){var m=+h.value.real,h=g*c.a-m*c.b+c.tx,m=g*c.c-m*c.d-c.ty;f?B.lineTo(h,m):(B.beginPath(),B.moveTo(h,m),f=!0)}}B.stroke();K.removevar(e);return u};D.plotvars=function(a){function b(a,d){var c={},
k;for(k=a.length-1;0<=k;--k)c[a[k]]=a[k];for(k=d.length-1;0<=k;--k)c[d[k]]=d[k];k=[];for(var e in c)c.hasOwnProperty(e)&&k.push(c[e]);return k}function d(a,b){for(var d=0;d<a.length;d++)a[d]===b&&(a.splice(d,1),d--);return a}var c,e,f,g;if("variable"===a.ctype)return[a.name];if("infix"===a.ctype)return c=D.plotvars(a.args[0]),a=D.plotvars(a.args[1]),b(c,a);if("list"===a.ctype){f=a.value;e=[];for(g=0;g<f.length;g++)c=D.plotvars(f[g]),e=b(e,c);return e}if("function"===a.ctype){f=a.args;e=[];for(g=0;g<
f.length;g++)c=D.plotvars(f[g]),e=b(e,c);"apply"!==a.oper&&"select"!==a.oper&&"forall"!==a.oper&&"sum"!==a.oper&&"product"!==a.oper&&"repeat"!==a.oper&&"min"!==a.oper&&"max"!==a.oper&&"sort"!==a.oper||"variable"!==a.args[1].ctype||(e=d(e,a.args[1].name));return e}return[]};t.clrscr$0=function(a,b){"undefined"!==typeof ea&&"undefined"!==typeof Y&&B.clearRect(0,0,ea,Y);return u};t.repaint$0=function(a,b){c();return u};t.screenbounds$0=function(a,b){var d=w.withUsage(f.realVector(x.to(0,0)),"Point"),
c=w.withUsage(f.realVector(x.to(ea,0)),"Point"),e=w.withUsage(f.realVector(x.to(ea,Y)),"Point"),g=w.withUsage(f.realVector(x.to(0,Y)),"Point");return f.turnIntoCSList([d,c,e,g])};t.createimage$3=function(a,b){var d=A(a[0]),c=C(a[1]),e=C(a[2]);if("number"!==c.ctype||"number"!==e.ctype||"string"!==d.ctype)return u;var f=document.createElement("canvas");f.id=d.value;f.width=c.value.real;f.height=e.value.real;f.style.display="none";document.body.appendChild(f);ja[d.value]=f;return u};t.clearimage$1=function(a,
b){var d=A(a[0]);if("string"!==d.ctype)return u;d=document.getElementById(d.value);if("undefined"===typeof d||null===d)return u;var c=d.width,e=d.height;d.getContext("2d").clearRect(0,0,c,e);return u};t.canvas$4=function(a,b){var d=C(a[0]),c=C(a[1]),e=A(a[2]),f=a[3],g=D.extractPoint(d),h=D.extractPoint(c);if(!g.ok||!h.ok||"string"!==e.ctype)return u;e=document.getElementById(e.value);if("undefined"===typeof e||null===e)return u;var d=e.width,c=e.height,l=h.x-g.x,m=h.y-g.y,n=g.x-m*c/d,p=g.y+l*c/d,
m=h.x-m*c/d,l=h.y+l*c/d,h=x.from(g.x,g.y,1),n=x.from(n,p,1),m=x.from(m,l,1),g=h[0],p=h[1],l=n[0],q=n[1],r=m[0],t=m[1],n=d*(p-q)/((g-l)*(p-t)-(g-r)*(p-q)),d=d*(g-l)/((p-q)*(g-r)-(p-t)*(g-l)),m=-n*g-d*p,h=(c*(p-t)-c*(p-q))/((g-l)*(p-t)-(g-r)*(p-q)),l=(c*(g-r)-c*(g-l))/((p-q)*(g-r)-(p-t)*(g-l)),c=c-h*g-l*p,e=e.getContext("2d"),g=B;B=e;B.save();B.transform(n,h,d,l,m,c);A(f);B.restore();B=g};t.canvas$5=function(a,b){var d=C(a[0]),c=C(a[1]),e=C(a[2]),f=A(a[3]),g=a[4],d=D.extractPoint(d),c=D.extractPoint(c),
h=D.extractPoint(e);if(!d.ok||!c.ok||!h.ok||"string"!==f.ctype)return u;f=document.getElementById(f.value);if("undefined"===typeof f||null===f)return u;var l=f.width,e=f.height,m=x.from(d.x,d.y,1),n=x.from(c.x,c.y,1),c=x.from(h.x,h.y,1),d=m[0],h=m[1],p=n[0],q=n[1],r=c[0],t=c[1],c=((0-l)*(h-t)-0*(h-q))/((d-p)*(h-t)-(d-r)*(h-q)),l=((0-l)*(d-r)-0*(d-p))/((h-q)*(d-r)-(h-t)*(d-p)),n=0-c*d-l*h,m=((e-e)*(h-t)-(e-0)*(h-q))/((d-p)*(h-t)-(d-r)*(h-q)),p=((e-e)*(d-r)-(e-0)*(d-p))/((h-q)*(d-r)-(h-t)*(d-p)),e=
e-m*d-p*h,f=f.getContext("2d"),d=B;B=f;B.save();B.transform(c,m,l,p,n,e);A(g);B.restore();B=d};t.screenresolution$0=function(a,b){return l.real(x.drawingstate.matrix.a)};t.layer$1=function(a,b){};D.extractReferenceX=function(a,b){};t.imagesize$1=function(a,b){var d=C(a[0]);return"string"===d.ctype&&ja[d.value]?f.realVector([ja[d.value].width,ja[d.value].height]):u};t.drawimage$2=function(a,b){function d(){var a=1,d=1,c=1,g=1,h=0,v=1,m=D.extractPoint(e);if(!m.ok||"string"!==l.ctype)return u;l=ja[l.value];
if(!l)return u;B.save();var n;void 0!==b.angle&&(n=A(b.angle),"number"===n.ctype&&(h=n.value.real));void 0!==b.rotation&&(n=A(b.rotation),"number"===n.ctype&&(h=n.value.real));void 0!==b.scale&&(n=C(b.scale),"number"===n.ctype&&(d=a=n.value.real),f.isNumberVector(n).value&&2===n.value.length&&(a=n.value[0].value.real,d=n.value[1].value.real));void 0!==b.scalex&&(n=A(b.scalex),"number"===n.ctype&&(a=n.value.real));void 0!==b.scaley&&(n=A(b.scaley),"number"===n.ctype&&(d=n.value.real));void 0!==b.flipx&&
(n=A(b.flipx),"boolean"===n.ctype&&n.value&&(c=-1));void 0!==b.flipy&&(n=A(b.flipy),"boolean"===n.ctype&&n.value&&(g=-1));void 0!==b.alpha&&(n=A(b.alpha),"number"===n.ctype&&(v=n.value.real));var p=x.drawingstate.matrix,q=x.drawingstate.initialmatrix,r=l.width,t=l.height;n=m.x*p.a-m.y*p.b+p.tx;var oa=m.x*p.c-m.y*p.d-p.ty,w=(m.x+1)*p.a-m.y*p.b+p.tx-n,p=(m.x+1)*p.c-m.y*p.d-p.ty-oa,Db=(m.x+1)*q.a-m.y*q.b+q.tx-(m.x*q.a-m.y*q.b+q.tx),q=(m.x+1)*q.c-m.y*q.d-q.ty-(m.x*q.c-m.y*q.d-q.ty),m=Math.sqrt(w*w+p*
p)/Math.sqrt(Db*Db+q*q),w=-Math.atan2(w,p)+Math.atan2(Db,q);1!==v&&(B.globalAlpha=v);B.translate(n,oa);B.scale(a*c*m,d*g*m);B.rotate(h+w);B.translate(-n,-oa);B.translate(-r/2,-t/2);a=l;a.drawTo?a.drawTo(B,n,oa):B.drawImage(a,n,oa);B.globalAlpha=1;B.restore()}function c(){var a=1,d=1,f=1,v=1,m=D.extractPoint(e),n=D.extractPoint(g),p;if(!m.ok||!n.ok||"string"!==l.ctype)return u;l=ja[l.value];if(!l)return u;var q=l.width,r=l.height;if(0===h)p={},p.x=m.x-(n.y-m.y),p.y=m.y+(n.x-m.x),v=r/q;else if(p=D.extractPoint(h),
!m.ok)return u;B.save();var t;void 0!==b.alpha&&(t=A(b.alpha),"number"===t.ctype&&(a=t.value.real));void 0!==b.aspect&&(t=A(b.aspect),"number"===t.ctype&&(v=t.value.real));void 0!==b.flipx&&(t=A(b.flipx),"boolean"===t.ctype&&t.value&&(d=-1));void 0!==b.flipy&&(t=A(b.flipy),"boolean"===t.ctype&&t.value&&(f=-1));t=x.drawingstate.matrix;1!==a&&(B.globalAlpha=a);a=m.x*t.a-m.y*t.b+t.tx;m=m.x*t.c-m.y*t.d-t.ty;B.transform(n.x*t.a-n.y*t.b+t.tx-a,n.x*t.c-n.y*t.d-t.ty-m,p.x*t.a-p.y*t.b+t.tx-a,p.x*t.c-p.y*t.d-
t.ty-m,a,m);B.scale(1/q,-1/r*v);B.translate(q/2,-r/2);B.scale(d,f);B.translate(-q/2,r/2);B.translate(0,-r);d=l;d.drawTo?d.drawTo(B,0,0):B.drawImage(d,0,0);B.globalAlpha=1;B.restore()}var e,g,h,l;return 2===a.length?(e=C(a[0]),l=C(a[1]),d()):3===a.length?(e=C(a[0]),g=C(a[1]),h=0,l=C(a[2]),c()):4===a.length?(e=C(a[0]),g=C(a[1]),h=C(a[2]),l=C(a[3]),c()):u};t.drawimage$3=t.drawimage$2;t.drawimage$4=t.drawimage$2;var kc={},bc;bc=[0,0,0,0,0,0,0,0,0,0,0,0];t.playsin$1=function(a,b){var d=C(a[0]),c=0;if("number"===
d.ctype){var e;void 0!==b.line&&(e=A(b.line),"number"===e.ctype&&(c=Math.floor(e.value.real),0>c&&(c=0),10<c&&(c=10)));d=d.value.real;0!==bc[c]&&bc[c].set({freq:d})}return u};var N={printArr:function(a){for(var b=a.value.length,d=[],c=[],e=!1,f=0;f<b;f++)d[f]=a.value[f].value.real,c[f]=a.value[f].value.imag,0!==c[f]&&(e=!0);console.log(d);e&&console.log(c)},zero:function(a){for(var b=[],d=l.real(0),c=0;c<a.value.real;c++)b[c]=d;return f.turnIntoCSList(b)},number:function(a,b){var d=N.zero(b);d.value[0]=
a;return d},variable:function(a,b){var d=N.zero(b);d.value[0]=a;d.value[1]=l.real(1);return d},add:function(a,b){return f.add(a,b)},sub:function(a,b){return f.sub(a,b)},mult:function(a,b){if(a.value.length!==b.value.length)return console.error("dims don't fit return nada"),u;for(var d=a.value.length,c=N.zero(l.real(d)),e=l.real(0),f=0;f<d;f++){for(var g=0;g<=f;g++)e=l.add(e,l.mult(a.value[g],b.value[f-g]));c.value[f]=e;e=l.real(0)}return c},pow:function(a,b){if(0>b.value.real||b.value.real!==Math.floor(b.value.real))return N.root(a,
b);for(var d=a,c=1;c<b.value.real;c++)d=N.mult(d,a);return d},root:function(a,b){var d=l.real(0),c=l.real(1),e=l.add(c,b),f=a.value.length,g=N.zero(l.real(f));g.value[0]=l.pow(a.value[0],b);for(var h=d,m,n,p=1;p<f;p++){n=l.real(p);for(var q=1;q<=p;q++)m=l.mult(e,l.real(q)),m=l.div(m,n),m=l.sub(m,c),m=l.mult(m,a.value[q]),m=l.mult(m,g.value[p-q]),h=l.add(h,m);h=l.div(h,a.value[0]);g.value[p]=h;h=d}return g},findFirstNoneZero:function(a,b,d){for(var c=Infinity,e=Infinity,f=d;f<a.value.length;f++)if(1E-12<
l.abs2(a.value[f]).value.real){c=f;break}for(a=d;a<b.value.length;a++)if(1E-12<l.abs2(b.value[a]).value.real){e=a;break}return[c,e]},div:function(a,b){if(a.value.length!==b.value.length)return console.log("dims don't fit - return nada"),u;for(var d=a.value.length,c=l.real(0),e=N.zero(l.real(d)),f=c,g=c,h=0;h<d;h++){g=N.findFirstNoneZero(a,b,h);h<g[0]&&g[0]===g[1]&&Infinity!==g[0]&&(a.value.splice(h,g[0]),b.value.splice(h,g[0]),e.value.splice(h,g[0]),d-=g[0]);for(var g=a.value[h],m=0;m<h;m++)f=l.add(f,
l.mult(e.value[m],b.value[h-m]));g=l.sub(g,f);g=l.div(g,b.value[0]);e.value[h]=g;f=c}return e},exp:function(a){var b=l.real(0),d=a.value.length,c=N.zero(l.real(d)),e=b,f;c.value[0]=l.exp(a.value[0]);for(var g=1;g<d;g++){for(var h=1;h<=g;h++)f=l.mult(l.real(h),a.value[h]),f=l.mult(f,c.value[g-h]),e=l.add(e,f);c.value[g]=l.div(e,l.real(g));e=b}return c},log:function(a){var b=l.real(0),d=a.value.length,c=N.zero(l.real(d));c.value[0]=l.log(a.value[0]);for(var e=b,f,g,h=1;h<d;h++){f=a.value[h];for(var m=
1;m<h;m++)g=l.mult(l.real(m),c.value[m]),g=l.mult(g,a.value[h-m]),e=l.add(e,g);e=l.div(e,l.real(h));f=l.sub(f,e);f=l.div(f,a.value[0]);c.value[h]=f;e=b}return c},sincos:function(a){var b=l.real(0),d=a.value.length,c=N.zero(l.real(d)),e=N.zero(l.real(d));c.value[0]=l.sin(a.value[0]);e.value[0]=l.cos(a.value[0]);for(var f=b,g=b,h,m,n,p=1;p<d;p++){n=l.real(p);for(var q=1;q<=p;q++)m=l.mult(l.real(q),a.value[q]),h=l.mult(m,e.value[p-q]),m=l.mult(m,c.value[p-q]),g=l.add(g,h),f=l.add(f,m);g=l.div(g,n);f=
l.div(f,l.neg(n));c.value[p]=g;e.value[p]=f;f=g=b}N.sinsave=c;N.cossave=e;return[c,e]},sin:function(a){return N.sincos(a)[0]},cos:function(a){return N.sincos(a)[1]},faculty:function(a){var b=[];b[0]=l.real(1);for(var d=1,c=1;c<=a.value.real;c++)d*=c,b[c]=l.real(d);return b=f.turnIntoCSList(b)},diff:function(a,b,d,c){var e;if("variable"===a.ctype)e=a.name!==b?N.number(A(a),c):N.variable(d,c);else if("number"===a.ctype)e=N.number(a,c);else{if("infix"===a.ctype){if("*"===a.oper)return N.mult(N.diff(a.args[0],
b,d,c),N.diff(a.args[1],b,d,c));if("^"===a.oper)return N.pow(N.diff(a.args[0],b,d,c),N.diff(a.args[1],b,d,c).value[0]);if("/"===a.oper)return N.div(N.diff(a.args[0],b,d,c),N.diff(a.args[1],b,d,c));if("+"===a.oper)return N.add(N.diff(a.args[0],b,d,c),N.diff(a.args[1],b,d,c));if("-"===a.oper)return N.sub(N.diff(a.args[0],b,d,c),N.diff(a.args[1],b,d,c));console.log("infix not found",a.oper);return u}if("function"===a.ctype){if("exp$1"===a.oper)return N.exp(N.diff(a.args[0],b,d,c));if("log$1"===a.oper)return N.log(N.diff(a.args[0],
b,d,c));if("sin$1"===a.oper)return N.sin(N.diff(a.args[0],b,d,c));if("cos$1"===a.oper)return N.cos(N.diff(a.args[0],b,d,c))}else return console.log("ctype not found",a.ctype),u}return e},adevaluate:function(a,b,d,c){a=N.diff(a,b,d,c);c=N.faculty(c);for(b=2;b<a.value.length;b++)a.value[b]=l.mult(a.value[b],c.value[b]);return a},autodiff:function(a,b,d,c){for(var e=[],g=d.value.length,h,l=0;l<g;l++)h=N.adevaluate(a,b,d.value[l],c),e[l]=h;return e=f.turnIntoCSList(e)}},y={handleModifs:function(a,b){y.dashing&&
y.unSetDash();y.colorraw=null;y.size=null;0>=y.psize&&(y.psize=0);0>=y.lsize&&(y.lsize=0);y.overhang=1;y.dashing=!1;y.isArrow=!1;y.arrowSides="==>";y.arrowposition=1;y.headlen=10;y.arrowShape=y.arrowShapes.line;y.alpha=x.drawingstate.alpha;y.bold="";y.italics="";y.family="sans-serif";y.align=0;y.xOffset=0;y.yOffset=0;y.lineCap="round";y.lineJoin="round";y.miterLimit=10;var d,c;for(d in a){var e=a[d];e&&((c=b[d])?(!0===c&&(c=y.modifHandlers[d]),c(A(e))):console.log("Modifier not supported: "+d))}null!==
y.size?y.psize=y.lsize=y.size:(y.psize=x.drawingstate.pointsize,y.lsize=x.drawingstate.linesize);y.dashing&&y.dashing(y.lsize);null!==y.colorraw?y.pointColor=y.lineColor=y.textColor=y.makeColor(y.colorraw):1===y.alpha?(y.pointColor=x.drawingstate.pointcolor,y.lineColor=x.drawingstate.linecolor,y.textColor=x.drawingstate.textcolor):(y.pointColor=y.makeColor(x.drawingstate.pointcolorraw),y.lineColor=y.makeColor(x.drawingstate.linecolorraw),y.textColor=y.makeColor(x.drawingstate.textcolorraw));y.black=
1===y.alpha?"rgb(0,0,0)":"rgba(0,0,0,"+y.alpha+")"},modifHandlers:{size:function(a){"number"===a.ctype&&(y.size=a.value.real,0>y.size&&(y.size=0),1E3<y.size&&(y.size=1E3))},color:function(a){f.isNumberVector(a).value&&3===a.value.length&&(y.colorraw=[a.value[0].value.real,a.value[1].value.real,a.value[2].value.real])},alpha:function(a){"number"===a.ctype&&(y.alpha=a.value.real)},dashpattern:function(a){if("list"===a.ctype){for(var b=[],d=0,c=0;d<a.value.length;d++)"number"===a.value[d].ctype&&(b[c++]=
a.value[d].value.real);y.dashing=y.setDash.bind(null,b)}},dashtype:function(a){if("number"===a.ctype)a=Math.floor(a.value.real);else if("string"===a.ctype)a=a.value;else return;if(a=y.dashTypes[a])y.dashing=y.setDash.bind(null,a)},dashing:function(a){"number"===a.ctype&&(a=Math.floor(a.value.real),y.dashing=y.setDash.bind(null,[2*a,a]))},overhang:function(a){"number"===a.ctype&&(y.overhang=y.overhang*a.value.real+(1-y.overhang)*(1-a.value.real))},arrow:function(a){"boolean"===a.ctype?y.isArrow=a.value:
console.error("arrow needs to be of type boolean")},arrowshape:function(a){"string"!==a.ctype?console.error("arrowshape needs to be of type string"):y.arrowShapes.hasOwnProperty(a.value)?(y.arrowShape=y.arrowShapes[a.value],y.isArrow=!0,y.arrowShape.deprecated&&(console.log("arrowshape "+a.value+" is deprecated, use "+y.arrowShape.deprecated+" instead."),y.arrowShape.deprecated=null)):(a=Object.keys(y.arrowShapes),a.sort(),a=a.join(", "),console.error("arrowshape needs to be one of "+a))},arrowsides:function(a){"string"!==
a.ctype?console.error("arrowsides is not of type string"):"==>"!==a.value&&"<==>"!==a.value&&"<=="!==a.value?console.error("arrowsides is unknows"):(y.arrowSides=a.value,y.isArrow=!0)},arrowposition:function(a){"number"!==a.ctype?console.error("arrowposition is not of type number"):0>a.value.real?console.error("arrowposition has to be positive"):1<a.value.real?y.overhang=y.overhang*a.value.real+(1-y.overhang)*(1-a.value.real):(y.arrowposition=a.value.real,y.isArrow=!0)},arrowsize:function(a){"number"!==
a.ctype?console.error("arrowsize is not of type number"):0>a.value.real?console.error("arrowsize has to be positive"):y.headlen*=a.value.real},bold:function(a){"boolean"===a.ctype&&a.value&&(y.bold="bold ")},italics:function(a){"boolean"===a.ctype&&a.value&&(y.italics="italic ")},family:function(a){"string"===a.ctype&&(y.family=a.value)},align:function(a){"string"===a.ctype&&(a=a.value,"left"===a&&(y.align=0),"right"===a&&(y.align=1),"mid"===a&&(y.align=.5))},x_offset:function(a){"number"===a.ctype&&
(y.xOffset=a.value.real)},y_offset:function(a){"number"===a.ctype&&(y.yOffset=a.value.real)},offset:function(a){"list"===a.ctype&&2===a.value.length&&"number"===a.value[0].ctype&&"number"===a.value[1].ctype&&(y.xOffset=a.value[0].value.real,y.yOffset=a.value[1].value.real)},lineCap:function(a){"string"!==a.ctype||"round"!==a.value&&"square"!==a.value&&"butt"!==a.value||(y.lineCap=a.value)},lineJoin:function(a){"string"!==a.ctype||"round"!==a.value&&"bevel"!==a.value&&"miter"!==a.value||(y.lineJoin=
a.value)},miterLimit:function(a){"number"===a.ctype&&0<a.value.real&&(y.miterLimit=Math.round(a.value.real))}},lineModifs:{size:!0,color:!0,alpha:!0,dashpattern:!0,dashtype:!0,dashing:!0,overhang:!0,arrow:!0,arrowshape:!0,arrowsides:!0,arrowposition:!0,arrowsize:!0,lineCap:!0},pointModifs:{size:!0,color:!0,alpha:!0}};y.pointAndLineModifs=y.lineModifs;y.conicModifs={size:!0,color:!0,alpha:!0,lineCap:!0,lineJoin:!0,miterLimit:!0};y.textModifs={size:!0,color:!0,alpha:!0,bold:!0,italics:!0,family:!0,
align:!0,x_offset:!0,y_offset:!0,offset:!0};y.makeColor=function(a){return"rgba("+Math.floor(255*a[0])+","+Math.floor(255*a[1])+","+Math.floor(255*a[2])+","+y.alpha+")"};y.preDrawCurve=function(){B.lineWidth=y.lsize;B.lineCap=y.lineCap;B.lineJoin=y.lineJoin;B.miterLimit=y.miterLimit;B.strokeStyle=y.lineColor};y.arrowShapes={"default":{close:!1,fill:!1,ratio:1,deprecated:"line"},line:{close:!1,fill:!1,ratio:1},empty:{close:!0,fill:!1,ratio:1},hollow:{close:!0,fill:!1,ratio:1,deprecated:"empty"},full:{close:!0,
fill:!0,ratio:1},jet:{close:!0,fill:!0,ratio:1.5},delta:{close:!0,fill:!0,ratio:1.5,deprecated:"jet"}};y.drawsegcore=function(a,b){function d(a,b,d,c){var k=a-c*q+.5*r,e=b-c*r-.5*q,f=a-c*q-.5*r;c=b-c*r+.5*q;B.beginPath();y.arrowShape.fill&&(B.lineWidth=y.lsize/2);B.moveTo(k,e);B.lineTo(a,b);B.lineTo(f,c);y.arrowShape.close&&(B.fillStyle=y.lineColor,B.lineTo(a-d*q,b-d*r),B.closePath(),y.arrowShape.fill&&B.fill());B.stroke()}var c=x.drawingstate.matrix,e=a.x*c.a-a.y*c.b+c.tx,f=a.x*c.c-a.y*c.d-c.ty,
g=b.x*c.a-b.y*c.b+c.tx,h=b.x*c.c-b.y*c.d-c.ty,l=y.overhang,m=1-l,c=l*e+m*g,n=l*f+m*h,p=l*g+m*e,l=l*h+m*f;B.lineWidth=y.lsize;B.lineCap=y.lineCap;B.lineJoin=y.lineJoin;B.miterLimit=y.miterLimit;B.strokeStyle=y.lineColor;if(!y.isArrow||e===f&&g===h).01>y.lsize||(B.beginPath(),B.moveTo(c,n),B.lineTo(p,l),B.stroke());else{var e=g-e,f=h-f,g=y.headlen/Math.sqrt(e*e+f*f),q=e*g,r=f*g,h=y.arrowposition,m=1-h,f=h*c+m*p,e=h*n+m*l,g=h*p+m*c,h=h*l+m*n,m=y.arrowSides;B.beginPath();y.arrowShape.close?("<==>"===
m||"<=="===m?(1>y.arrowposition&&(B.moveTo(c,n),B.lineTo(f,e)),B.moveTo(f+q,e+r)):B.moveTo(c,n),"==>"===m||"<==>"===m?(B.lineTo(g-q,h-r),1>y.arrowposition&&(B.moveTo(g,h),B.lineTo(p,l))):B.lineTo(p,l)):(B.moveTo(c,n),B.lineTo(p,l));B.stroke();"==>"!==m&&"<==>"!==m||d(g,h,1,y.arrowShape.ratio);"<=="!==m&&"<==>"!==m||d(f,e,-1,-y.arrowShape.ratio)}};y.drawpoint=function(a){var b=x.drawingstate.matrix,d=a.x*b.a-a.y*b.b+b.tx;a=a.x*b.c-a.y*b.d-b.ty;B.lineWidth=.3*y.psize;B.beginPath();B.arc(d,a,y.psize,
0,2*Math.PI);B.fillStyle=y.pointColor;B.fill();B.beginPath();B.arc(d,a,1.15*y.psize,0,2*Math.PI);B.fillStyle=y.black;B.strokeStyle=y.black;B.stroke()};y.drawline=function(a){var b=l.abs(a.value[0]).value.real,d=l.abs(a.value[1]).value.real,c=l.abs(a.value[2]).value.real,e;b>=d&&b>=c&&(e=a.value[0]);d>=b&&d>=c&&(e=a.value[1]);c>=d&&c>=b&&(e=a.value[2]);b=l.div(a.value[0],e);d=l.div(a.value[1],e);a=l.div(a.value[2],e);a=[b.value.real,d.value.real,a.value.real];Math.abs(a[0])<Math.abs(a[1])?(b=[1,0,
30],e=[-1,0,30]):(b=[0,1,30],e=[0,-1,30]);b=[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]];a=[a[1]*e[2]-a[2]*e[1],a[2]*e[0]-a[0]*e[2],a[0]*e[1]-a[1]*e[0]];y.drawsegcore({x:b[0]/b[2],y:b[1]/b[2]},{x:a[0]/a[2],y:a[1]/a[2]})};y.dashTypes={solid:[],dashed:[10,10],tightdash:[10,4],dotted:[1,3],dashdot:[10,5,1,5],"dashvalue.solid":[],"dashvalue.dashed":[10,10],"dashvalue.tightdash":[10,4],"dashvalue.dotted":[1,3],"dashvalue.dashdot":[10,5,1,5],0:[],1:[10,10],2:[10,4],3:[1,3],4:[10,5,1,5]};
y.setDash=function(a,b){var d=Math.sqrt(b);a=a.slice();for(var c=0;c<a.length;c++)a[c]*=d;B.webkitLineDash=a;B.setLineDash(a);B.mozDash=a};y.unSetDash=function(){B.webkitLineDash=[];B.setLineDash([]);B.mozDash=[]};Ac.prototype={set fillStyle(a){var b=this;yb(a,function(a,c,e,f){b._fill="#"+Za(a.toString(16),2)+Za(c.toString(16),2)+Za(e.toString(16),2);b._fillOpacity=255===f?null:f})},set strokeStyle(a){var b=this;yb(a,function(a,c,e,f){b._stroke="#"+Za(a.toString(16),2)+Za(c.toString(16),2)+Za(e.toString(16),
2);b._strokeOpacity=255===f?null:f})},clearRect:function(){},beginPath:function(){this._path=[]},_pathcmd:function(){this._path.push.apply(this._path,arguments)},closePath:function(){this._pathcmd("Z")},moveTo:function(a,b){this._pathcmd("M",a,b)},lineTo:function(a,b){this._pathcmd("L",a,b)},bezierCurveTo:function(a,b,d,c,e,f){this._pathcmd("C",a,b,d,c,e,f)},quadraticCurveTo:function(a,b,d,c){this._pathcmd("Q",a,b,d,c)},arc:function(a,b,d,c,e,f){var g=d*Math.cos(c)+a,h=d*Math.sin(c)+b,l=d*Math.cos(e)+
a,m=d*Math.sin(e)+b;e=f?c-e:e-c;e>=2*Math.PI?this._pathcmd(this._path.length?"L":"M",g,h,"A",d,d,0,0,f?1:0,a-d*Math.cos(c),b-d*Math.sin(c),"A",d,d,0,0,f?1:0,g,h):this._pathcmd(this._path.length?"L":"M",g,h,"A",d,d,0,e>Math.PI?1:0,f?1:0,l,m)},rect:function(a,b,d,c){this._pathcmd("M",a,b,"h",d,"v",c,"h",-d,"z")},_cmd:function(a){1!==this.globalAlpha?(this._body.push('<g opacity="'+this.globalAlpha+'">'),this._body.push(a),this._body.push("</g>")):this._body.push(a)},_attrs:function(a){var b="",d;for(d in a)null!==
a[d]&&(b+=" "+d+'="'+a[d]+'"');return b},fill:function(){this._cmd("<path"+this._attrs({d:this._path.join(" "),fill:this._fill,"fill-opacity":this._fillOpacity})+"/>")},stroke:function(){this._cmd("<path"+this._attrs({d:this._path.join(" "),stroke:this._stroke,"stroke-opacity":this._strokeOpacity,"stroke-width":this.lineWidth,"stroke-linecap":this.lineCap,"stroke-linejoin":this.lineJoin,"stroke-miterlimit":"miter"===this.lineJoin?this.miterLimit:null})+"/>")},clip:function(){++this._clipIndex;this._body.push('<clipPath id="clip'+
this._clipIndex+'"><path d="'+this._path.join(" ")+'"/></clipPath>','<g clip-path="url(#clip'+this._clipIndex+')">');this._saveStack[this._saveStack.length-1]+="</g>"},save:function(){this._saveStack.push("")},restore:function(){this._body.push(this._saveStack.pop());0===this._saveStack.length&&this._saveStack.push("")},_transform:function(a){this._body.push('<g transform="'+a+'">');this._saveStack[this._saveStack.length-1]+="</g>"},translate:function(a,b){this._transform("translate("+a+" "+b+")")},
rotate:function(a){this._transform("rotate("+Math.PI/180*a+")")},scale:function(a,b){this._transform("scale("+a+" "+b+")")},transform:function(a,b,d,c,e,f){this._transform("matrix("+[a,b,d,c,e,f].join(" ")+")")},drawImage:function(a,b,d){if(3!==arguments.length)throw Error("SvgWriterContext only supports 3-argument version of drawImage");var c=this._imgcache.indexOf(a);if(-1===c){var c=this._imgcache.length,e;e=a.cachedDataURL?a.cachedDataURL:Cc(a);this._defs.push('<image id="img'+c+'" x="0" y="0" width="'+
a.width+'" height="'+a.height+'" xlink:href="'+e+'"/>');this._imgcache.push(a)}this._cmd('<use x="'+b+'" y="'+d+'" xlink:href="#img'+c+'"/>')},toBlob:function(){for(;1<this._saveStack.length||""!==this._saveStack[0];)this.restore();var a='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="'+this.width+'px" height="'+this.height+'px">\n'+this._defs.join("\n")+'\n</defs>\n<g stroke="none" fill="none">\n'+
this._body.join("\n")+"\n</g>\n</svg>\n";return new Blob([a],{type:"image/svg+xml"})}};Bc.prototype={_cmd:function(){this._body.push(Array.prototype.join.call(arguments," "))},_setAlpha:function(a,b,d){var c=Math.round(255*a*this._globalAlpha);b+=c;this._extGState[b]="<< /"+d+" "+c/255+" >>";this._cmd("/"+b,"gs");return a},set globalAlpha(a){this._globalAlpha=a;this._setAlpha(this._strokeAlpha,"As","CA");this._setAlpha(this._fillAlpha,"Af","ca")},set fillStyle(a){var b=this;yb(a,function(a,c,e,f){b._cmd(a/
255,c/255,e/255,"rg");b._setAlpha(b._fillAlpha=f,"Af","ca")})},set strokeStyle(a){var b=this;yb(a,function(a,c,e,f){b._cmd(a/255,c/255,e/255,"RG");b._setAlpha(b._strokeAlpha=f,"As","CA")})},set lineWidth(a){this._cmd(a,"w")},set lineCap(a){this._cmd({butt:0,round:1,square:2}[a],"J")},set lineJoin(a){this._cmd({miter:0,round:1,bevel:2}[a],"j")},set miterLimit(a){this._cmd(a,"M")},clearRect:function(){},beginPath:function(){this._pathUsed=!1},closePath:function(){this._cmd("h")},moveTo:function(a,b){this._cmd(this._xPos=
a,this._yPos=-b,"m")},lineTo:function(a,b){this._cmd(this._xPos=a,this._yPos=-b,"l")},bezierCurveTo:function(a,b,d,c,e,f){this._cmd(a,-b,d,-c,this._xPos=e,this._yPos=-f,"c")},quadraticCurveTo:function(a,b,d,c){this.bezierCurveTo((2*a+this._xPos)/3,(2*b-this._yPos)/3,(d+2*a)/3,(c+2*b)/3,d,c)},_kappa:.5522847498307935,arc:function(a,b,d,c,e,f){if(0===c&&e===2*Math.PI)c=this._kappa*d,this.moveTo(a+d,b),this.bezierCurveTo(a+d,b+c,a+c,b+d,a,b+d),this.bezierCurveTo(a-c,b+d,a-d,b+c,a-d,b),this.bezierCurveTo(a-
d,b-c,a-c,b-d,a,b-d),this.bezierCurveTo(a+c,b-d,a+d,b-c,a+d,b);else throw Error("PdfWriterContext.arc only supports full circles");},rect:function(a,b,d,c){this._cmd(a,-b,d,-c,"re")},_usePath:function(a){if(this._pathUsed){var b=this._body[this._pathUsed],d={"S + f":"B","f + S":"B","W n + S":"W S","W n + f":"W f","S + W n":"W S","f + W n":"W f","B + W n":"W B","W S + f":"W B","W f + S":"W B"}[b+" + "+a];if(!d)throw Error("Don't know how to combine '"+b+"' and '"+a+"'");this._body.splice(this._pathUsed,
1);a=d}this._pathUsed=this._body.length;this._cmd(a)},fill:function(){this._usePath("f")},stroke:function(){this._usePath("S")},clip:function(){this._usePath("W n")},save:function(){this._cmd("q")},restore:function(){this._cmd("Q")},translate:function(a,b){this.transform(1,0,0,1,a,b)},rotate:function(a){var b=Math.cos(a);a=Math.sin(a);this.transform(b,a,-a,b,0,0)},scale:function(a,b){this.transform(a,0,0,b,0,0)},transform:function(a,b,d,c,e,f){this._cmd(a,-b,-d,c,e,-f,"cm")},_png:function(a){if("data:image/png;base64,"!==
a.substr(0,22))return{error:"Not a base64-encoded PNG file"};a=ld(a.substr(22));var b=md(a);console.log("PNG chunks:",b.map(function(a){return a.type}));if("IHDR"!==b[0].type)throw Error("Image does not start with an IHDR");var d=b[0].data;a=(d[0]<<24|d[1]<<16|d[2]<<8|d[3])>>>0;var c=(d[4]<<24|d[5]<<16|d[6]<<8|d[7])>>>0,e=d[8],f=d[9],g=0===(f&2),h=0!==(f&4),l=d[10],m=d[11],d=d[12];if(0!==l)throw Error("Unsupported PNG compression method: "+l);if(0!==m)throw Error("Unsupported PNG filter method: "+
m);if(0!==d)return{error:"Interlaced image not supported"};if(0!==(f&1))return{error:"Indexed PNG image not supported"};m=null;f=g?1:3;l=b.filter(function(a){return"IDAT"===a.type}).map(function(a){return a.data});if(h){h=window.pako;m=new h.Inflate;for(b=0;b<l.length;++b)m.push(l[b],b+1===l.length);if(m.err)throw Error(m.err);m=m.result;d=e>>>3;if(m.length!==c*(a*(f+1)*d+1))throw Error("Data length mismatch");for(var n=f*d,l=new Uint8Array(c*(a*n+1)),p=new Uint8Array(c*(a*d+1)),q=0,r=0,t=0,u=0;u<
c;++u){l[r++]=p[t++]=m[q++];for(var w=0;w<a;++w){for(b=0;b<n;++b)l[r++]=m[q++];for(b=0;b<d;++b)p[t++]=m[q++]}}if(q!==m.length||r!==l.length||t!==p.length)throw Error("Seems we garbled our index computation somehow");p=h.deflate(p);m=this._strm({Type:"/XObject",Subtype:"/Image",Width:a,Height:c,ColorSpace:"/DeviceGray",BitsPerComponent:e,Filter:"/FlateDecode",DecodeParms:this._dict({Predictor:15,Colors:1,BitsPerComponent:e,Columns:a})},p).ref;l=[h.deflate(l)]}var x=0;l.forEach(function(a){x+=a.length});
return this._obj([this._dict({Type:"/XObject",Subtype:"/Image",Name:"/img"+this._imgcache.length,Width:a,Height:c,ColorSpace:g?"/DeviceGray":"/DeviceRGB",SMask:m,BitsPerComponent:e,Length:x,Filter:"/FlateDecode",DecodeParms:this._dict({Predictor:15,Colors:f,BitsPerComponent:e,Columns:a})}),"\nstream\n"].concat(l,["\nendstream"]))},drawImage:function(a,b,d){if(3!==arguments.length)throw Error("PdfWriterContext only supports 3-argument version of drawImage");var c=this._imgcache.indexOf(a);if(-1===
c){c=this._imgcache.length;this._imgcache.push(a);var e=this._png(a.cachedDataURL||"");e.hasOwnProperty("error")&&(e=this._png(Cc(a)));if(e.hasOwnProperty("error"))throw Error(e.error);this._xobjects["img"+c]=e.ref}this._cmd("q");this._setAlpha(1,"Af","ca");this._cmd(a.width,0,0,a.height,b,-d-a.height,"cm");this._cmd("/img"+c,"Do");this._cmd("Q")},_dict:function(a){var b="<<",d;for(d in a)b+=" /"+d+" "+a[d];return b+" >>"},_obj:function(a,b){b||(b=this._nextIndex++);Array.isArray(a)||(a=[this._dict(a)]);
a.index=b;a.ref=b+" 0 R";a.offset=this._offset;var d=0;a.unshift(b+" 0 obj\n");a.push("\nendobj\n");for(var c=0;c<a.length;++c)d+=a[c].length;this._offset+=d;this._objects.push(a);return a},_strm:function(a,b,d){a.Length=b.length;return this._obj([this._dict(a),"\nstream\n",b,"\nendstream"],d)},toBlob:function(){var a;a="["+[0,-this.height,this.width,0].join(" ")+"]";this._obj({Type:"/Catalog",Pages:"2 0 R"},1);this._obj({Type:"/Pages",Kids:"[3 0 R]",Count:1},2);this._obj({Type:"/Page",Parent:"2 0 R",
MediaBox:a,Contents:"4 0 R",Resources:this._dict({ProcSet:"[/PDF /Text /ImageB /ImageC /ImageI]",XObject:this._dict(this._xobjects),ExtGState:this._dict(this._extGState)})},3);var b=this._body.join("\n"),d=new Uint8Array(b.length);for(a=0;a<b.length;++a)d[a]=b.charCodeAt(a)&255;b=window.pako.deflate(d);this._strm({Filter:"/FlateDecode"},b,4);var b=this._objects,c=[];for(a=1;a<b.length;++a)c[b[a].index]=b[a];d="xref\n0 "+c.length+"\n";for(a=0;a<c.length;++a)d=c[a]?d+(Za(String(c[a].offset),10)+" 00000 n \n"):
d+"0000000000 65535 f \n";a="trailer\n"+this._dict({Size:c.length,Root:"1 0 R"})+"\nstartxref\n"+this._offset+"\n%%EOF\n";b=Array.prototype.concat.apply([],b);b.push(d,a);return new Blob(b,{type:"application/pdf"})}};var jb=null;Wa.push(Dc);ka.exportSVG=function(){Ec(Ac)};ka.exportPDF=function(){ta.loadScript("pako","pako.min.js",function(){Ec(Bc)})};var Ia={},x={drawingstate:{}};x.drawingstate.linecolor="rgb(0,0,255)";x.drawingstate.linecolorraw=[0,0,1];x.drawingstate.pointcolor="rgb(255,200,0)";
x.drawingstate.pointcolorraw=[1,.78,0];x.drawingstate.textcolor="rgb(0,0,0)";x.drawingstate.textcolorraw=[0,0,0];x.drawingstate.alpha=1;x.drawingstate.pointsize=4;x.drawingstate.linesize=1;x.drawingstate.textsize=20;x.drawingstate.matrix={};x.drawingstate.matrix.a=25;x.drawingstate.matrix.b=0;x.drawingstate.matrix.c=0;x.drawingstate.matrix.d=25;x.drawingstate.matrix.tx=250.5;x.drawingstate.matrix.ty=250.5;x.drawingstate.matrix.det=x.drawingstate.matrix.a*x.drawingstate.matrix.d-x.drawingstate.matrix.b*
x.drawingstate.matrix.c;x.drawingstate.matrix.sdet=Math.sqrt(x.drawingstate.matrix.det);x.drawingstate.initialmatrix={};x.drawingstate.initialmatrix.a=x.drawingstate.matrix.a;x.drawingstate.initialmatrix.b=x.drawingstate.matrix.b;x.drawingstate.initialmatrix.c=x.drawingstate.matrix.c;x.drawingstate.initialmatrix.d=x.drawingstate.matrix.d;x.drawingstate.initialmatrix.tx=x.drawingstate.matrix.tx;x.drawingstate.initialmatrix.ty=x.drawingstate.matrix.ty;x.drawingstate.initialmatrix.det=x.drawingstate.matrix.det;
x.drawingstate.initialmatrix.sdet=x.drawingstate.matrix.sdet;x.clone=function(a){if(null===a||"object"!==typeof a)return a;var b=a.constructor(),d;for(d in a)b[d]=x.clone(a[d]);return b};Ia.backup=x.clone(x.drawingstate);Ia.stack=[];x.clone(x.drawingstate);x.reset=function(){x.drawingstate.matrix.a=x.drawingstate.initialmatrix.a;x.drawingstate.matrix.b=x.drawingstate.initialmatrix.b;x.drawingstate.matrix.c=x.drawingstate.initialmatrix.c;x.drawingstate.matrix.d=x.drawingstate.initialmatrix.d;x.drawingstate.matrix.tx=
x.drawingstate.initialmatrix.tx;x.drawingstate.matrix.ty=x.drawingstate.initialmatrix.ty;x.drawingstate.matrix.det=x.drawingstate.initialmatrix.det;x.drawingstate.matrix.sdet=x.drawingstate.initialmatrix.sdet};x.from=function(a,b,d){a/=d;b/=d;d=x.drawingstate.matrix;return[a*d.a-b*d.b+d.tx,a*d.c-b*d.d-d.ty]};x.to=function(a,b){var d=x.drawingstate.matrix,c=a-d.tx,e=b+d.ty;return[(c*d.d-e*d.b)/d.det,-(-c*d.c+e*d.a)/d.det,1]};x.dumpTrafo=function(){function a(a){return Math.round(1E3*a)/1E3}var b=x.drawingstate.matrix;
console.log("a:"+a(b.a)+" b:"+a(b.b)+" c:"+a(b.c)+" d:"+a(b.d)+" tx:"+a(b.ty)+" ty:"+a(b.tx))};x.setMat=function(a,b,d,c,e,f){var g=x.drawingstate.matrix;g.a=a;g.b=b;g.c=d;g.d=c;g.tx=e;g.ty=f;g.det=a*c-b*d;g.sdet=Math.sqrt(g.det)};x.scaleAndOrigin=function(a,b,d){x.setMat(a,0,0,a,b,d)};x.visibleRect=function(a,b,d,c){var e=d-a,f=b-c,e=ea*f<Y*e?ea/e:Y/f;x.setMat(e,0,0,e,(ea-e*(a+d))/2,(Y-e*(b+c))/2)};x.applyMat=function(a,b,d,c,e,f){var g=x.drawingstate.matrix;x.setMat(g.a*a+g.c*b,g.b*a+g.d*b,g.a*
d+g.c*c,g.b*d+g.d*c,g.a*e+g.c*f+g.tx,g.b*e+g.d*f+g.ty);a=x.to(0,-Y);b=x.to(ea,0);console.log("{visibleRect: ["+a[0]+","+a[1]+","+b[0]+","+b[1]+"]}")};x.translate=function(a,b){x.applyMat(1,0,0,1,a,b)};x.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);x.applyMat(b,a,-a,b,0,0)};x.scale=function(a){x.applyMat(a,0,0,a,0,0)};x.gsave=function(){Ia.stack.push(x.clone(x.drawingstate))};x.grestore=function(){0!==Ia.stack.length&&(x.drawingstate=Ia.stack.pop())};x.greset=function(){x.drawingstate=x.clone(Ia.backup);
x.drawingstate.matrix.ty-=Y;x.drawingstate.initialmatrix.ty-=Y;Ia.stack=[]};x.createnewbackup=function(){x.drawingstate.initialmatrix.a=x.drawingstate.matrix.a;x.drawingstate.initialmatrix.b=x.drawingstate.matrix.b;x.drawingstate.initialmatrix.c=x.drawingstate.matrix.c;x.drawingstate.initialmatrix.d=x.drawingstate.matrix.d;x.drawingstate.initialmatrix.tx=x.drawingstate.matrix.tx;x.drawingstate.initialmatrix.ty=x.drawingstate.matrix.ty;x.drawingstate.initialmatrix.det=x.drawingstate.matrix.det;x.drawingstate.initialmatrix.sdet=
x.drawingstate.matrix.sdet;Ia.backup=x.clone(x.drawingstate)};x.makecolor=function(a,b,d){a=Math.floor(255*a);b=Math.floor(255*b);d=Math.floor(255*d);return 1===x.drawingstate.alpha?"rgb("+a+","+b+","+d+")":"rgba("+a+","+b+","+d+","+x.drawingstate.alpha+")"};x.setcolor=function(a){var b=a.value[0].value.real,d=a.value[1].value.real;a=a.value[2].value.real;x.drawingstate.linecolor=x.drawingstate.pointcolor=x.makecolor(b,d,a);x.drawingstate.linecolorraw=x.drawingstate.pointcolorraw=[b,d,a]};x.setlinecolor=
function(a){var b=a.value[0].value.real,d=a.value[1].value.real;a=a.value[2].value.real;x.drawingstate.linecolor=x.makecolor(b,d,a);x.drawingstate.linecolorraw=[b,d,a]};x.settextcolor=function(a){var b=a.value[0].value.real,d=a.value[1].value.real;a=a.value[2].value.real;x.drawingstate.textcolor=x.makecolor(b,d,a);x.drawingstate.textcolorraw=[b,d,a]};x.setpointcolor=function(a){var b=a.value[0].value.real,d=a.value[1].value.real;a=a.value[2].value.real;x.drawingstate.pointcolor=x.makecolor(b,d,a);
x.drawingstate.pointcolorraw=[b,d,a]};x.setalpha=function(a){x.drawingstate.alpha=a.value.real;x.drawingstate.linecolor=x.makecolor(x.drawingstate.linecolorraw[0],x.drawingstate.linecolorraw[1],x.drawingstate.linecolorraw[2]);x.drawingstate.pointcolor=x.makecolor(x.drawingstate.pointcolorraw[0],x.drawingstate.pointcolorraw[1],x.drawingstate.pointcolorraw[2]);x.drawingstate.textcolor=x.makecolor(x.drawingstate.textcolorraw[0],x.drawingstate.textcolorraw[1],x.drawingstate.textcolorraw[2])};x.setpointsize=
function(a){x.drawingstate.pointsize=a.value.real};x.setlinesize=function(a){x.drawingstate.linesize=a.value.real};x.settextsize=function(a){x.drawingstate.textsize=a.value.real};var ra={clip:"none",pointColor:[1,0,0],lineColor:[0,0,1],pointSize:5,lineSize:1,alpha:1,overhangLine:1.1,overhangSeg:1,dimDependent:.7,fontFamily:"sans-serif"};p.defaultAppearance&&od(p.defaultAppearance);var Ub={},Ic={UL:0,UR:1,LR:2,LL:3},Sb=["in","out","good","backup"],Pa=new Float64Array(0),Ma={};Sb.forEach(function(a){Ma[a]=
Pa});var ba=Pa,va=Pa,sa=Pa,ga,qa,Qa,wa,cb,Vb=!1,Kc={toString:function(){return"RefineException"}},I=null;p.enableTraceLog&&(I={logLength:Infinity,fullLog:[],currentMouseAndScripts:null,currentMover:null,currentStep:null,currentElement:null,currentParam:null,labelTracing2:w.wrap("tracing2"),labelTracing4:w.wrap("tracing4"),labelTracingSesq:w.wrap("tracingSesq"),postMouseHooks:[]},"number"===typeof p.enableTraceLog&&(I.logLength=p.enableTraceLog),ka.getTraceLog=qd,ka.formatTraceLog=rd,ka.addTraceHook=
I.postMouseHooks.push.bind(I.postMouseHooks));Ha.stateSize=12;Xb.stateSize=24;var Sa=[];Ra.P=function(a){T.forEach(function(b){b=Pc(a,b);b.holds()&&Sa.push(b)});U.forEach(function(b){b=Qc(a,b);b.holds()&&Sa.push(b)})};Ra.L=function(a){H.forEach(function(b){b=Pc(b,a);b.holds()&&Sa.push(b)})};Ra.S=Ra.L;Ra.C=function(a){H.forEach(function(b){b=Qc(b,a);b.holds()&&Sa.push(b)})};var n={_helper:{},RandomLine:{}};n.RandomLine.kind="L";n.RandomLine.signature=[];n.RandomLine.updatePosition=function(a){a.homog=
f.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);a.homog=f.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};n.FreeLine={};n.FreeLine.kind="L";n.FreeLine.signature=[];n.FreeLine.isMovable=!0;n.FreeLine.initialize=function(a){a=n._helper.initializeLine(a);S(a)};n.FreeLine.getParamForInput=function(a,b,d){"mouse"===d?(a=f.cross(b,f.ez),a=f.cross(a,b)):a="homog"===d?b:f.turnIntoCSList([l.zero,l.zero,l.zero]);return f.normalizeMax(a)};n.FreeLine.getParamFromState=function(a){return X(3)};
n.FreeLine.putParamToState=function(a,b){S(b)};n.FreeLine.updatePosition=function(a){var b=X(3);S(b);a.homog=w.withUsage(b,"Line")};n.FreeLine.stateSize=6;n.RandomPoint={};n.RandomPoint.kind="P";n.RandomPoint.signature=[];n.RandomPoint.updatePosition=function(a){a.homog=f.realVector([100*Math.random(),100*Math.random(),100*Math.random()]);a.homog=f.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};n.Join={};n.Join.kind="L";n.Join.signature=["P","P"];n.Join.updatePosition=function(a){a.homog=
f.cross(m[a.args[0]].homog,m[a.args[1]].homog);a.homog=f.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};n.Segment={};n.Segment.kind="S";n.Segment.signature=["P","P"];n.Segment.updatePosition=function(a){var b=m[a.args[0]],d=m[a.args[1]];a.homog=f.cross(b.homog,d.homog);a.homog=f.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line");a.startpos=b.homog;a.endpos=d.homog;a.farpoint=f.cross(a.homog,f.linfty)};n.Meet={};n.Meet.kind="P";n.Meet.signature=["L","L"];n.Meet.updatePosition=function(a){a.homog=
f.cross(m[a.args[0]].homog,m[a.args[1]].homog);a.homog=f.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};n.Meet.visiblecheck=function(a){var b=!0,d=m[a.args[0]],c=m[a.args[1]];"S"===d.kind&&(b=Hc(a,d));b&&"S"===c.kind&&(b=Hc(a,c));a.isshowing=b};n._helper.midpoint=function(a,b){return f.normalizeMax(f.add(f.scalmult(b.value[2],a),f.scalmult(a.value[2],b)))};n.Mid={};n.Mid.kind="P";n.Mid.signature=["P","P"];n.Mid.updatePosition=function(a){var b=n._helper.midpoint(m[a.args[0]].homog,m[a.args[1]].homog);
a.homog=w.withUsage(b,"Point")};n.Perp={};n.Perp.kind="L";n.Perp.signature=["L","P"];n.Perp.updatePosition=function(a){var b=m[a.args[0]].homog,d=m[a.args[1]].homog,b=f.turnIntoCSList([b.value[0],b.value[1],l.zero]);a.homog=f.cross(b,d);a.homog=f.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};n.Para={};n.Para.kind="L";n.Para.signature=["L","P"];n.Para.updatePosition=function(a){var b=m[a.args[1]].homog;a.homog=f.cross(f.cross(f.linfty,m[a.args[0]].homog),b);a.homog=f.normalizeMax(a.homog);
a.homog=w.withUsage(a.homog,"Line")};n.Horizontal={};n.Horizontal.kind="L";n.Horizontal.signature=["P"];n.Horizontal.updatePosition=function(a){a.homog=f.cross(f.ex,m[a.args[0]].homog);a.homog=f.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};n.HorizontalLine={};n.HorizontalLine.kind="L";n.HorizontalLine.signature=[];n.HorizontalLine.isMovable=!0;n.HorizontalLine.initialize=function(a){a=n._helper.initializeLine(a);a=f.turnIntoCSList([l.zero,a.value[1],a.value[2]]);a=f.normalizeMax(a);
S(a)};n.HorizontalLine.getParamForInput=function(a,b,d){if("mouse"===d)b=f.cross(b,f.ex);else if("homog"===d){if(0!==b.value[0].real||0!==b.value[0].imag)b=f.turnIntoCSList([l.zero,b.value[1],b.value[2]])}else b=f.turnIntoCSList([l.zero,l.zero,l.zero]);return f.normalizeMax(b)};n.HorizontalLine.getParamFromState=function(a){return X(3)};n.HorizontalLine.putParamToState=function(a,b){S(b)};n.HorizontalLine.updatePosition=function(a){var b=X(3);S(b);a.homog=w.withUsage(b,"Line")};n.HorizontalLine.stateSize=
6;n.Vertical={};n.Vertical.kind="L";n.Vertical.signature=["P"];n.Vertical.updatePosition=function(a){a.homog=f.cross(f.ey,m[a.args[0]].homog);a.homog=f.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};n.VerticalLine={};n.VerticalLine.kind="L";n.VerticalLine.signature=[];n.VerticalLine.isMovable=!0;n.VerticalLine.initialize=function(a){a=n._helper.initializeLine(a);a=f.turnIntoCSList([a.value[0],l.zero,a.value[2]]);a=f.normalizeMax(a);S(a)};n.VerticalLine.getParamForInput=function(a,b,d){if("mouse"===
d)b=f.cross(b,f.ey);else if("homog"===d){if(0!==b.value[1].real||0!==b.value[1].imag)b=f.turnIntoCSList([b.value[0],l.zero,b.value[2]])}else b=f.turnIntoCSList([l.zero,l.zero,l.zero]);return f.normalizeMax(b)};n.VerticalLine.getParamFromState=function(a){return X(3)};n.VerticalLine.putParamToState=function(a,b){S(b)};n.VerticalLine.updatePosition=function(a){var b=X(3);S(b);a.homog=w.withUsage(b,"Line")};n.VerticalLine.stateSize=6;n.LineByFixedAngle={};n.LineByFixedAngle.kind="L";n.LineByFixedAngle.signature=
["L","P"];n.LineByFixedAngle.initialize=function(a){var b=l._helper.input(a.angle),d=l.cos(b),b=l.sin(b);a.rot=f.turnIntoCSList([f.turnIntoCSList([b,d,l.zero]),f.turnIntoCSList([l.neg(d),b,l.zero]),f.turnIntoCSList([l.zero,l.zero,l.zero])])};n.LineByFixedAngle.updatePosition=function(a){var b=m[a.args[1]],d=f.productMV(a.rot,m[a.args[0]].homog);a.homog=f.cross(b.homog,d);a.homog=f.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};n.Through={};n.Through.kind="L";n.Through.signature=["P"];
n.Through.isMovable=!0;n.Through.initialize=function(a){a=a.dir?w.wrap(a.dir):f.realVector([a.pos[1],-a.pos[0],0]);S(a)};n.Through.getParamForInput=function(a,b,d){a="dir"===d||"mouse"===d?f.cross(m[a.args[0]].homog,b):"homog"===d?b:f.turnIntoCSList([l.zero,l.zero,l.zero]);a=f.cross(f.linfty,a);return f.normalizeMax(a)};n.Through.getParamFromState=function(a){return X(3)};n.Through.putParamToState=function(a,b){S(b)};n.Through.updatePosition=function(a){var b=X(3);S(b);b=f.cross(m[a.args[0]].homog,
b);b=f.normalizeMax(b);a.homog=w.withUsage(b,"Line")};n.Through.stateSize=6;n.Free={};n.Free.kind="P";n.Free.signature=[];n.Free.isMovable=!0;n.Free.initialize=function(a){a=n._helper.initializePoint(a);S(a)};n.Free.getParamForInput=function(a,b,d){if("mouse"===d&&jc&&0!==La){b=f.normalizeZ(b);a=b.value[0].value.real;d=b.value[1].value.real;var c=Math.round(a/La)*La,e=Math.round(d/La)*La;.2>Math.abs(c-a)&&.2>Math.abs(e-d)&&(b=f.realVector([c,e,1]))}return f.normalizeMax(b)};n.Free.getParamFromState=
function(a){return X(3)};n.Free.putParamToState=function(a,b){S(b)};n.Free.updatePosition=function(a){var b=X(3);S(b);a.homog=w.withUsage(b,"Point")};n.Free.stateSize=6;n._helper.projectPointToLine=function(a,b){var d=f.turnIntoCSList([b.value[0],b.value[1],l.zero]),d=f.cross(d,a);return f.normalizeMax(f.cross(d,b))};n.PointOnLine={};n.PointOnLine.kind="P";n.PointOnLine.signature=["L"];n.PointOnLine.isMovable=!0;n.PointOnLine.initialize=function(a){var b=n._helper.initializePoint(a);a=m[a.args[0]].homog;
var b=n._helper.projectPointToLine(b,a),b=f.normalizeMax(b),d=f.cross(f.linfty,b);f.normalizeMax(d);S(b);S(a);Qa=!1};n.PointOnLine.updatePosition=function(a,b){var d,c=m[a.args[0]].homog;d=X(3);X(3);if(!b){ga=a.stateIdx;var e=ba;ba=sa;var g=X(3),h=X(3);ba=e;e=f.cross(h,c);f._helper.isAlmostZero(e)&&(e=f.cross(f.linfty,c));g=n._helper.CircleMP(e,g);g=n._helper.IntersectLC(c,g);e=n._helper.pointReflection(e,d);d=Mc(g[0],g[1],d,e)[0]}d=f.normalizeMax(d);S(d);S(c);a.homog=w.withUsage(d,"Point")};n.PointOnLine.getParamForInput=
function(a,b,d){return b=n._helper.projectPointToLine(b,m[a.args[0]].homog)};n.PointOnLine.getParamFromState=function(a){return X(3)};n.PointOnLine.putParamToState=function(a,b){return S(b)};n.PointOnLine.stateSize=12;n.PointOnCircle={};n.PointOnCircle.kind="P";n.PointOnCircle.signature=["C"];n.PointOnCircle.isMovable=!0;n.PointOnCircle.initialize=function(a){var b=m[a.args[0]];a=f.normalizeZ(n._helper.initializePoint(a));var d=f.normalizeZ(n._helper.CenterOfConic(b.matrix)),c=f.sub(a,d),c=f.turnIntoCSList([c.value[1],
l.neg(c.value[0]),l.zero]),d=f.cross(a,d),b=n._helper.IntersectLC(d,b.matrix),d=f.projectiveDistMinScal(a,b[0]);f.projectiveDistMinScal(a,b[1])<d?(a=b[1],b=b[0]):(a=b[0],b=b[1]);S(c);S(a);S(b);Qa=!1};n.PointOnCircle.putParamToState=function(a,b){S(b)};n.PointOnCircle.getParamFromState=function(a){return X(3)};n.PointOnCircle.getParamForInput=function(a,b,d){d=f.normalizeZ(n._helper.CenterOfConic(m[a.args[0]].matrix));b=f.sub(b,d);ga=a.stateIdx;a=X(3);var c=f.normalizeZ(X(3));d=f.sub(c,d);0>l.sub(l.mult(a.value[0],
d.value[1]),l.mult(a.value[1],d.value[0])).value.real&&(b=f.neg(b));return f.turnIntoCSList([b.value[1],l.neg(b.value[0]),l.zero])};n.PointOnCircle.parameterPath=function(a,b,d,c,e){c=f.normalizeAbs(c);e=f.normalizeAbs(e);var g=f.scalproduct(c,e);if(0<=g.value.real)return Lc(a,b,d,c,e);a=f.turnIntoCSList([l.sub(c.value[1],e.value[1]),l.sub(e.value[0],c.value[0]),l.zero]);g=f.scalproduct(c,a);0>g.value.real&&(a=f.neg(a));0>b?(b=2*b+1,d=b*b,g=.25/(1+d),d=l.complex(2*b*g+.25,(1-d)*g)):(b=2*b-1,d=b*b,
g=.25/(1+d),d=l.complex(2*b*g+.75,(1-d)*g));var h=l.sub(l.real(1),d);b=l.mult(d,d);g=l.mult(h,h);d=l.mult(d,h);c=f.scalmult(g,c);c=f.add(c,f.scalmult(d,a));return c=f.add(c,f.scalmult(b,e))};n.PointOnCircle.updatePosition=function(a){var b=X(3);S(b);var d=m[a.args[0]],b=f.productMV(d.matrix,b),d=n._helper.IntersectLC(b,d.matrix),d=Ha(d[0],d[1]),b=f.normalizeMax(d.value[0]);a.homog=w.withUsage(b,"Point");a.antipodalPoint=d.value[1]};n.PointOnCircle.stateSize=6+Ha.stateSize;n.OtherPointOnCircle={};
n.OtherPointOnCircle.kind="P";n.OtherPointOnCircle.signature=["P"];n.OtherPointOnCircle.signatureConstraints=function(a){return"PointOnCircle"===m[a.args[0]].type};n.OtherPointOnCircle.updatePosition=function(a){var b=m[a.args[0]].antipodalPoint,b=f.normalizeMax(b);a.homog=w.withUsage(b,"Point")};n.PointOnSegment={};n.PointOnSegment.kind="P";n.PointOnSegment.signature=["S"];n.PointOnSegment.isMovable=!0;n.PointOnSegment.initialize=function(a){var b=n._helper.initializePoint(a);a=n.PointOnSegment.getParamForInput(a,
b);Ga(a)};n.PointOnSegment.getParamForInput=function(a,b){var d=m[a.args[0]],c=d.homog,c=f.turnIntoCSList([c.value[0],c.value[1],l.zero]),d=f.crossratio3(d.farpoint,d.startpos,d.endpos,b,c);0>d.value.real&&(d=l.complex(0,d.value.imag));1<d.value.real&&(d=l.complex(1,d.value.imag));return d};n.PointOnSegment.getParamFromState=function(a){return db()};n.PointOnSegment.putParamToState=function(a,b){Ga(b)};n.PointOnSegment.updatePosition=function(a){var b=db();Ga(b);var d=m[a.args[0]],c=f.scalmult(d.endpos.value[2],
d.startpos),d=f.scalmult(d.startpos.value[2],d.endpos),d=f.sub(d,c),b=f.add(c,f.scalmult(b,d)),b=f.normalizeMax(b);a.homog=w.withUsage(b,"Point")};n.PointOnSegment.stateSize=2;n._helper.CenterOfConic=function(a){return w.mult(f.adjoint3(a),f.linfty)};n.CenterOfConic={};n.CenterOfConic.kind="P";n.CenterOfConic.signature=["C"];n.CenterOfConic.updatePosition=function(a){var b=n._helper.CenterOfConic(m[a.args[0]].matrix);a.homog=b;a.homog=f.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};
n._helper.CircleMP=function(a,b){var d=a.value[0],c=a.value[1],e=l.neg(a.value[2]),g=l.zero,d=f.turnIntoCSList([f.turnIntoCSList([e,g,d]),f.turnIntoCSList([g,e,c]),f.turnIntoCSList([d,c,g])]),e=w.mult(w.mult(b,d),b),c=w.mult(w.mult(b,f.fund),b),e=w.mult(e,f.fund),d=w.mult(c,d);return f.sub(e,d)};n.CircleMP={};n.CircleMP.kind="C";n.CircleMP.signature=["P","P"];n.CircleMP.updatePosition=function(a){a.matrix=n._helper.CircleMP(m[a.args[0]].homog,m[a.args[1]].homog);a.matrix=f.normalizeMax(a.matrix);
a.matrix=w.withUsage(a.matrix,"Circle")};n.CircleMr={};n.CircleMr.kind="C";n.CircleMr.signature=["P"];n.CircleMr.isMovable=!0;n.CircleMr.initialize=function(a){Ga(l.real(a.radius))};n.CircleMr.getParamForInput=function(a,b,d){if("radius"===d)return b;a=m[a.args[0]].homog;a=f.normalizeZ(a);b=f.normalizeZ(b);b=f.sub(a,b);return b=f.abs(b)};n.CircleMr.getParamFromState=function(a){return db()};n.CircleMr.putParamToState=function(a,b){Ga(b)};n.CircleMr.updatePosition=function(a){var b=db();Ga(b);var d=
m[a.args[0]].homog,c=l.mult(d.value[2],b),c=l.mult(c,c);if(!l._helper.isFinite(c)&&!l._helper.isNaN(c))return f.fund;d=n._helper.ScaledCircleMrr(d,c);a.matrix=w.withUsage(d,"Circle");a.radius=b};n.CircleMr.stateSize=2;n._helper.ScaledCircleMrr=function(a,b){var d=a.value[0],c=a.value[1],e=l.neg(a.value[2]),e=f.scalmult(e,f.turnIntoCSList([d,c,e])).value,d=f.turnIntoCSList([d,c]),d=l.sub(f.scalproduct(d,d),b),e=n._helper.buildConicMatrix([e[2],l.zero,e[2],e[0],e[1],d]);return f.normalizeMax(e)};n.Compass=
{};n.Compass.kind="C";n.Compass.signature=["P","P","P"];n.Compass.updatePosition=function(a){var b=m[a.args[0]].homog,d=m[a.args[1]].homog,c=m[a.args[2]].homog,e=b.value[2],g=d.value[2],h=c.value[2],b=f.scalmult(l.mult(g,h),b),d=f.scalmult(l.mult(e,h),d),c=f.scalmult(l.mult(e,g),c),b=f.sub(d,b),c=n._helper.ScaledCircleMrr(c,f.scalproduct(b,b));a.matrix=w.withUsage(c,"Circle")};n._helper.getConicType=function(a){if(1E-16>l.abs(f.det(a)).value.real)return"degenerate";var b=l.mult(a.value[0].value[0],
a.value[1].value[1]),b=l.sub(b,l.pow(a.value[0].value[1],l.real(2))),b=b.value.real;return 1E-16>Math.abs(b)?"parabola":1E-16<b?"ellipsoid":"hyperbola"};n._helper.ConicBy5=function(a,b,d,c,e,g){a=f.turnIntoCSList([f.cross(d,c)]);var h=f.turnIntoCSList([f.cross(b,e)]);b=f.turnIntoCSList([f.cross(b,d)]);c=f.turnIntoCSList([f.cross(c,e)]);return n._helper.conicFromTwoDegenerates(a,h,b,c,g)};n._helper.conicFromTwoDegenerates=function(a,b,d,c,e){a=w.mult(f.transpose(b),a);d=w.mult(f.transpose(c),d);a=
f.add(a,f.transpose(a));d=f.add(d,f.transpose(d));c=w.mult(w.mult(e,a),e);e=w.mult(w.mult(e,d),e);d=w.mult(c,d);e=w.mult(e,a);return f.sub(d,e)};n.ConicBy5={};n.ConicBy5.kind="C";n.ConicBy5.signature=["P","P","P","P","P"];n.ConicBy5.updatePosition=function(a){var b=n._helper.ConicBy5(a,m[a.args[0]].homog,m[a.args[1]].homog,m[a.args[2]].homog,m[a.args[3]].homog,m[a.args[4]].homog);a.matrix=b;a.matrix=f.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};n._helper.buildConicMatrix=function(a){var b=
a[1],d=a[2],c=a[3],e=a[4],g=a[5];return f.turnIntoCSList([f.turnIntoCSList([a[0],b,c]),f.turnIntoCSList([b,d,e]),f.turnIntoCSList([c,e,g])])};n._helper.splitDegenConic=function(a){var b=f.adjoint3(a),d=0,c,e,g=l.abs2(b.value[0].value[0]).value.real;for(c=1;3>c;c++)e=l.abs2(b.value[c].value[c]).value.real,e>g&&(d=c,g=e);c=l.sqrt(l.mult(l.real(-1),b.value[d].value[d]));if(1E-16>l.abs2(c).value.real)return a=f.turnIntoCSList([l.zero,l.zero,l.zero]),[a,a];d=l.real(d+1);e=f.column(b,d);e=f.scaldiv(c,e);
c=e.value[0];g=e.value[1];e=e.value[2];c=f.turnIntoCSList([f.turnIntoCSList([l.real(0),e,l.mult(l.real(-1),g)]),f.turnIntoCSList([l.mult(l.real(-1),e),l.real(0),c]),f.turnIntoCSList([g,l.mult(l.real(-1),c),l.real(0)])]);a=f.add(a,c);var h=0;for(c=g=b=0;3>c;c++)for(d=0;3>d;d++)e=l.abs2(a.value[c].value[d]).value.real,e>g&&(h=c,b=d,g=e);c=a.value[h];a=f.transpose(a);a=a.value[b];c=f.normalizeMax(c);a=f.normalizeMax(a);c=w.withUsage(c,"Line");a=w.withUsage(a,"Line");return[c,a]};n.SelectConic={};n.SelectConic.kind=
"C";n.SelectConic.signature=["Cs"];n.SelectConic.initialize=function(a){if(void 0!==a.index)return a.index-1;var b=l._helper.input(a.pos.xx),d=l._helper.input(a.pos.yy),c=l._helper.input(a.pos.zz),e=l.realmult(.5,l._helper.input(a.pos.xy)),g=l.realmult(.5,l._helper.input(a.pos.xz)),h=l.realmult(.5,l._helper.input(a.pos.yz)),b=f.turnIntoCSList([f.turnIntoCSList([b,e,g]),f.turnIntoCSList([e,d,h]),f.turnIntoCSList([g,h,c])]);a=m[a.args[0]].results;d=f.conicDist(b,a[0]);c=0;for(e=1;e<a.length;++e)g=f.conicDist(b,
a[e]),g<d&&(d=g,c=e);return c};n.SelectConic.updatePosition=function(a){a.matrix=m[a.args[0]].results[a.param];a.matrix=f.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};n._helper.ConicBy4p1l=function(a,b,d,c,e,g){var h=f.cross(f.cross(b,c),g),m=f.cross(f.cross(d,e),g),p=f.cross(f.cross(b,d),g),q=f.cross(f.cross(c,e),g),r=f.realVector(x.to(100*Math.random(),100*Math.random()));g=l.mult(f.det3(r,m,p),f.det3(r,m,q));g=l.sqrt(g);p=l.mult(f.det3(r,h,p),f.det3(r,h,q));p=l.sqrt(p);h=f.scalmult(g,
h);p=f.scalmult(p,m);m=f.add(h,p);h=f.sub(h,p);m=n._helper.ConicBy5(a,b,d,c,e,m);a=n._helper.ConicBy5(a,b,d,c,e,h);return[m,a]};n.ConicBy4p1l={};n.ConicBy4p1l.kind="Cs";n.ConicBy4p1l.signature=["P","P","P","P","L"];n.ConicBy4p1l.updatePosition=function(a){var b=n._helper.ConicBy4p1l(a,m[a.args[0]].homog,m[a.args[1]].homog,m[a.args[2]].homog,m[a.args[3]].homog,m[a.args[4]].homog);a.results=b};n._helper.ConicBy3p2l=function(a,b,d,c,e){function g(a,b,d,c){return l.sub(l.mult(a,c),l.mult(b,d))}var h=
f.cross(a,b),m=f.cross(c,e);c=f.cross(c,h);e=f.cross(e,h);h=f.turnIntoCSList([c,e,m]);d=f.productVM(d,f.adjoint3(h));m=f.adjoint3(f.turnIntoCSList([f.scalmult(d.value[0],c),f.scalmult(d.value[1],e),f.scalmult(d.value[2],m)]));d=f.transpose(m);c=l.mult;e=f.productMV(d,a);a=e.value[0];e=e.value[1];h=f.productMV(d,b);b=h.value[0];var h=h.value[1],n=l.sqrt(c(a,e)),p=l.sqrt(c(b,h)),q,r=Array(4);for(q=0;4>q;++q){var t=(q&2)-1,u=c(l.real(((q&1)<<1)-1),n),w=c(l.real(t),p),x=g(e,u,h,w),z=g(b,w,a,u),t=g(a,
e,b,h),y=l.add(l.add(g(b,h,a,e),g(h,w,e,u)),g(w,b,u,a)),u=c(x,x),w=c(z,z),A=c(y,y),B=c(x,z),x=c(x,y),z=c(z,y),B=l.sub(B,c(l.real(.5),c(t,t))),t=f.turnIntoCSList([f.turnIntoCSList([u,B,x]),f.turnIntoCSList([B,w,z]),f.turnIntoCSList([x,z,A])]),t=f.productMM(m,f.productMM(t,d)),t=f.turnIntoCSList([t.value[0].value[0],t.value[0].value[1],t.value[0].value[2],t.value[1].value[1],t.value[1].value[2],t.value[2].value[2]]);r[q]=t}return r};n.ConicBy3p2l={};n.ConicBy3p2l.kind="Cs";n.ConicBy3p2l.signature=["P",
"P","P","L","L"];n.ConicBy3p2l.updatePosition=function(a){for(var b=n._helper.ConicBy3p2l(m[a.args[0]].homog,m[a.args[1]].homog,m[a.args[2]].homog,m[a.args[3]].homog,m[a.args[4]].homog),b=Nc(b),d=Array(4),c=0;4>c;++c){var e=b[c].value;d[c]=f.turnIntoCSList([f.turnIntoCSList([e[0],e[1],e[2]]),f.turnIntoCSList([e[1],e[3],e[4]]),f.turnIntoCSList([e[2],e[4],e[5]])])}a.results=d};n.ConicBy3p2l.stateSize=48;n.ConicBy2p3l={};n.ConicBy2p3l.kind="Cs";n.ConicBy2p3l.signature=["P","P","L","L","L"];n.ConicBy2p3l.updatePosition=
function(a){for(var b=n._helper.ConicBy3p2l(m[a.args[2]].homog,m[a.args[3]].homog,m[a.args[4]].homog,m[a.args[0]].homog,m[a.args[1]].homog),b=Nc(b),d=Array(4),c=0;4>c;++c){var e=b[c].value,e=f.turnIntoCSList([f.turnIntoCSList([e[0],e[1],e[2]]),f.turnIntoCSList([e[1],e[3],e[4]]),f.turnIntoCSList([e[2],e[4],e[5]])]);d[c]=f.normalizeMax(f.adjoint3(e))}a.results=d};n.ConicBy2p3l.stateSize=48;n.ConicBy1p4l={};n.ConicBy1p4l.kind="Cs";n.ConicBy1p4l.signature=["P","L","L","L","L"];n.ConicBy1p4l.updatePosition=
function(a){var b=n._helper.ConicBy4p1l(a,m[a.args[1]].homog,m[a.args[2]].homog,m[a.args[3]].homog,m[a.args[4]].homog,m[a.args[0]].homog),d=b[0],b=b[1],d=f.adjoint3(d),b=f.adjoint3(b),b=[d,b];a.results=b};n.ConicParabolaPL={};n.ConicParabolaPL.kind="C";n.ConicParabolaPL.signature=["P","L"];n.ConicParabolaPL.updatePosition=function(a){var b=m[a.args[0]].homog.value,d=m[a.args[1]].homog.value,c=l.mult,e=l.neg,g=l.add,h=l.sub,p=b[0],q=b[1],r=b[2],t=d[0],b=d[1],d=d[2],u=c(r,r),x=c(t,t),z=c(b,b),y=c(r,
d),A=e(r),r=g(x,z),z=c(u,z),x=c(u,x),e=c(e(u),c(t,b)),t=c(A,g(c(p,r),c(y,t))),b=c(A,g(c(q,r),c(y,b))),c=h(c(g(c(p,p),c(q,q)),r),c(u,c(d,d))),c=n._helper.buildConicMatrix([z,e,x,t,b,c]),c=f.normalizeMax(c);a.matrix=w.withUsage(c,"Conic")};n.ConicBy2Foci1P={};n.ConicBy2Foci1P.kind="Cs";n.ConicBy2Foci1P.signature=["P","P","P"];n.ConicBy2Foci1P.updatePosition=function(a){var b=m[a.args[0]].homog,d=m[a.args[1]].homog,c=m[a.args[2]].homog,e=f.ii,g=f.jj,h=f.normalizeMax(f.cross(b,c)),p=f.normalizeMax(f.cross(d,
c)),q=f.normalizeMax(f.cross(c,e)),c=f.normalizeMax(f.cross(c,g)),p=n._helper.coHarmonic(q,c,h,p),h=f.normalizeMax(p[0]),p=f.normalizeMax(p[1]),e=f.turnIntoCSList([e]),q=f.turnIntoCSList([g]),c=f.turnIntoCSList([b]),r=f.turnIntoCSList([d]),g=n._helper.conicFromTwoDegenerates(e,q,c,r,h),g=f.normalizeMax(g),e=n._helper.conicFromTwoDegenerates(e,q,c,r,p),e=f.normalizeMax(e),g=f.normalizeMax(f.adjoint3(g)),e=f.normalizeMax(f.adjoint3(e));"ellipsoid"!==n._helper.getConicType(g)&&(h=g,g=e,e=h);f.almostequals(b,
d).value&&(b=l.real(3),e=f.zeromatrix(b,b));a.results=[g,e]};n._helper.coHarmonic=function(a,b,d,c){var e=f.realVector([100*Math.random(),100*Math.random(),1]),g=f.det3(e,d,a),h=f.det3(e,d,b);d=f.det3(e,c,a);c=f.det3(e,c,b);c=l.sqrt(l.mult(c,h));g=l.sqrt(l.mult(d,g));a=w.mult(a,c);g=w.mult(b,g);b=f.add(a,g);a=f.sub(a,g);return[b,a]};n.ConicInSquare={};n.ConicInSquare.kind="C";n.ConicInSquare.signature=["P","P","P","P"];n.ConicInSquare.updatePosition=function(a){var b=D.basismap(m[a.args[0]].homog,
m[a.args[1]].homog,m[a.args[2]].homog,m[a.args[3]].homog),d=l.one,d=n._helper.buildConicMatrix([d,d,d,l.real(-3),d,d]),b=f.adjoint3(b),b=f.productMM(f.productMM(f.transpose(b),d),b),b=f.normalizeMax(b);a.matrix=w.withUsage(b,"Conic")};n.ConicBy5lines={};n.ConicBy5lines.kind="C";n.ConicBy5lines.signature=["L","L","L","L","L"];n.ConicBy5lines.updatePosition=function(a){var b=n._helper.ConicBy5(a,m[a.args[0]].homog,m[a.args[1]].homog,m[a.args[2]].homog,m[a.args[3]].homog,m[a.args[4]].homog),b=f.adjoint3(b);
a.matrix=b;a.matrix=f.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};n.ConicFromPrincipalDirections={};n.ConicFromPrincipalDirections.kind="C";n.ConicFromPrincipalDirections.signature=["P","P","P"];n.ConicFromPrincipalDirections.updatePosition=function(a){var b=m[a.args[0]].homog,d=m[a.args[1]].homog,c=m[a.args[2]].homog,e=n._helper.pointReflection(b,d),g=f.cross(d,b),b=f.turnIntoCSList([g.value[0],g.value[1],l.zero]),g=f.turnIntoCSList([g]),d=f.turnIntoCSList([f.cross(d,b)]),e=f.turnIntoCSList([f.cross(e,
b)]);a.matrix=n._helper.conicFromTwoDegenerates(g,g,d,e,c);a.matrix=f.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};n.CircleBy3={};n.CircleBy3.kind="C";n.CircleBy3.signature=["P","P","P"];n.CircleBy3.updatePosition=function(a){var b=n._helper.ConicBy5(a,m[a.args[0]].homog,m[a.args[1]].homog,f.ii,f.jj,m[a.args[2]].homog);a.matrix=f.normalizeMax(b);a.matrix=w.withUsage(a.matrix,"Circle")};n.ArcBy3={};n.ArcBy3.kind="C";n.ArcBy3.signature=["P","P","P"];n.ArcBy3.updatePosition=function(a){n.CircleBy3.updatePosition(a);
a.startPoint=m[a.args[0]].homog;a.viaPoint=m[a.args[1]].homog;a.endPoint=m[a.args[2]].homog};n.ArcBy3.initialize=function(a){a.startPoint=m[a.args[0]].homog;a.viaPoint=m[a.args[1]].homog;a.endPoint=m[a.args[2]].homog;a.isArc=!0};n.PolarOfPoint={};n.PolarOfPoint.kind="L";n.PolarOfPoint.signature=["P","C"];n.PolarOfPoint.updatePosition=function(a){var b=w.mult(m[a.args[1]].matrix,m[a.args[0]].homog),b=f.normalizeMax(b);a.homog=w.withUsage(b,"Line")};n.PolarOfLine={};n.PolarOfLine.kind="P";n.PolarOfLine.signature=
["L","C"];n.PolarOfLine.updatePosition=function(a){var b=m[a.args[0]],d=f.adjoint3(m[a.args[1]].matrix),b=w.mult(d,b.homog),b=f.normalizeMax(b);a.homog=w.withUsage(b,"Point")};n.AngleBisector={};n.AngleBisector.kind="Ls";n.AngleBisector.signature=["L","L","P"];n.AngleBisector.updatePosition=function(a){var b=m[a.args[0]].homog,d=m[a.args[1]].homog,c=m[a.args[2]].homog,e=f.add,g=f.sub,h=f.abs,l=f.cross,n=f.scalmult,p=f.normalizeMax,q=f._helper.isAlmostZero,r=f.linfty,t=n(h(l(l(r,d),r)),b),b=n(h(l(l(r,
b),r)),d),g=g(t,b),e=e(t,b);q(g)&&(g=l(l(l(r,e),r),c));q(e)&&(e=l(l(l(r,g),r),c));a.results=Ha(p(g),p(e))};n.AngleBisector.stateSize=Ha.stateSize;n._helper.IntersectLC=function(a,b){var d=l,c=f.crossOperator(a),e=f.transpose(c),e=w.mult(e,w.mult(b,c)),g=f.maxIndex(a,l.abs2),h,m,n,p;0===g?(g=e.value[1].value[1],h=e.value[1].value[2],m=e.value[2].value[1],n=e.value[2].value[2],p=a.value[0]):1===g?(g=e.value[0].value[0],h=e.value[0].value[2],m=e.value[2].value[0],n=e.value[2].value[2],p=a.value[1]):
(g=e.value[0].value[0],h=e.value[0].value[1],m=e.value[1].value[0],n=e.value[1].value[1],p=a.value[2]);d=d.div(d.sqrt(d.sub(d.mult(h,m),d.mult(g,n))),p);d=f.add(e,f.scalmult(d,c));g=f.maxIndex(d,f.abs2);c=d.value[g];c=f.normalizeMax(c);c=w.withUsage(c,"Point");d=f.transpose(d);g=f.maxIndex(d,f.abs2);d=d.value[g];d=f.normalizeMax(d);d=w.withUsage(d,"Point");return[c,d]};n.IntersectLC={};n.IntersectLC.kind="Ps";n.IntersectLC.signature=["L","C"];n.IntersectLC.updatePosition=function(a){var b=n._helper.IntersectLC(m[a.args[0]].homog,
m[a.args[1]].matrix);a.results=Ha(b[0],b[1])};n.IntersectLC.stateSize=Ha.stateSize;n.OtherIntersectionCL={};n.OtherIntersectionCL.kind="P";n.OtherIntersectionCL.signature=["C","L","P"];n.OtherIntersectionCL.updatePosition=function(a){var b=m[a.args[2]].homog,d=n._helper.IntersectLC(m[a.args[1]].homog,m[a.args[0]].matrix),c=d[0],d=d[1],e=f.projectiveDistMinScal(c,b),b=f.projectiveDistMinScal(d,b);a.homog=e<b?d:c;a.homog=f.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};n.IntersectCirCir=
{};n.IntersectCirCir.kind="Ps";n.IntersectCirCir.signature=["C","C"];n.IntersectCirCir.updatePosition=function(a){var b=m[a.args[0]].matrix,d=m[a.args[1]].matrix,c=f.scalmult(d.value[0].value[0],b.value[2]),d=f.scalmult(b.value[0].value[0],d.value[2]),c=f.sub(c,d),c=f.turnIntoCSList([c.value[0],c.value[1],l.realmult(.5,c.value[2])]),c=f.normalizeMax(c),b=n._helper.IntersectLC(c,b);a.results=Ha(b[0],b[1])};n.IntersectCirCir.stateSize=Ha.stateSize;n.OtherIntersectionCC={};n.OtherIntersectionCC.kind=
"P";n.OtherIntersectionCC.signature=["C","C","P"];n.OtherIntersectionCC.updatePosition=function(a){var b=m[a.args[0]].matrix,d=m[a.args[1]].matrix,c=m[a.args[2]].homog,e=f.scalmult(d.value[0].value[0],b.value[2]),d=f.scalmult(b.value[0].value[0],d.value[2]),e=f.sub(e,d),e=f.turnIntoCSList([e.value[0],e.value[1],l.realmult(.5,e.value[2])]),e=f.normalizeMax(e),e=n._helper.IntersectLC(e,b),b=e[0],e=e[1],d=f.projectiveDistMinScal(b,c),c=f.projectiveDistMinScal(e,c);a.homog=d<c?e:b;a.homog=f.normalizeMax(a.homog);
a.homog=w.withUsage(a.homog,"Point")};n._helper.IntersectConicConic=function(a,b){var d=a.value[0],c=a.value[1],e=a.value[2],g=b.value[0],h=b.value[1],m=b.value[2],p=f.det3(d,c,e),q=l.add(l.add(f.det3(d,c,m),f.det3(d,h,e)),f.det3(g,c,e)),d=l.add(l.add(f.det3(d,h,m),f.det3(g,c,m)),f.det3(g,h,e)),g=f.det3(g,h,m),m=l.abs2(p).value.real,h=l.abs2(g).value.real;m<h&&(m=a,a=b,b=m,m=g,g=p,p=m,m=d,d=q,q=m,m=h);1E-24>m?(p=a,d=b):(q=l.solveCubic(p,q,d,g),d=l.abs2(l.sub(q[0],q[1])).value.real,g=l.abs2(l.sub(q[0],
q[2])).value.real,h=l.abs2(l.sub(q[1],q[2])).value.real,d>g?(p=q[1],q=d>h?q[0]:q[2]):(p=q[2],q=g>h?q[0]:q[1]),p=f.add(f.scalmult(p,a),b),d=f.add(f.scalmult(q,a),b));q=n._helper.splitDegenConic(p);p=q[0];q=q[1];d=n._helper.splitDegenConic(d);h=d[0];g=d[1];d=f.cross(p,h);h=f.cross(q,h);p=f.cross(p,g);q=f.cross(q,g);d=f.normalizeMax(d);h=f.normalizeMax(h);p=f.normalizeMax(p);q=f.normalizeMax(q);d=w.withUsage(d,"Point");h=w.withUsage(h,"Point");p=w.withUsage(p,"Point");q=w.withUsage(q,"Point");return[d,
h,p,q]};n.IntersectConicConic={};n.IntersectConicConic.kind="Ps";n.IntersectConicConic.signature=["C","C"];n.IntersectConicConic.updatePosition=function(a){var b=n._helper.IntersectConicConic(m[a.args[0]].matrix,m[a.args[1]].matrix),b=Xb(b[0],b[1],b[2],b[3]);a.results=b};n.IntersectConicConic.stateSize=Xb.stateSize;n.SelectP={};n.SelectP.kind="P";n.SelectP.signature=["Ps"];n.SelectP.initialize=function(a){if(void 0!==a.index)return a.index-1;var b=m[a.args[0]].results.value;a=n._helper.initializePoint(a);
for(var d=f.projectiveDistMinScal(a,b[0]),c=0,e=1;e<b.length;++e){var g=f.projectiveDistMinScal(a,b[e]);g<d&&(d=g,c=e)}return c};n.SelectP.updatePosition=function(a){a.homog=m[a.args[0]].results.value[a.param]};n.SelectL={};n.SelectL.kind="L";n.SelectL.signature=["Ls"];n.SelectL.initialize=function(a){if(void 0!==a.index)return a.index-1;var b=m[a.args[0]].results.value;a=n._helper.initializeLine(a);for(var d=f.projectiveDistMinScal(a,b[0]),c=0,e=1;e<b.length;++e){var g=f.projectiveDistMinScal(a,
b[e]);g<d&&(d=g,c=e)}return c};n.SelectL.updatePosition=function(a){a.homog=m[a.args[0]].results.value[a.param];a.homog=w.withUsage(a.homog,"Line")};n._helper.moebiusStep=function(a,b,d){var c=l.add,e=l.sub,f=l.mult,g=a.value[0],h=a.value[1];a=a.value[2];var m=b.value[0],n=b.value[1];b=b.value[2];var p=d.value[0],q=d.value[1],r=d.value[2];d=e(f(b,p),f(m,r));var t=e(f(b,q),f(n,r)),p=e(f(g,r),f(a,p)),q=e(f(h,r),f(a,q));return[e(f(g,d),f(h,t)),c(f(h,d),f(g,t)),f(a,d),f(a,t),e(f(m,p),f(n,q)),c(f(n,p),
f(m,q)),f(b,p),f(b,q)]};n.TrMoebius={};n.TrMoebius.kind="Mt";n.TrMoebius.signature="PPPPPP".split("");n.TrMoebius.updatePosition=function(a){var b=l.neg,d=n._helper.moebiusStep(m[a.args[0]].homog,m[a.args[2]].homog,m[a.args[4]].homog),c=n._helper.moebiusStep(m[a.args[1]].homog,m[a.args[3]].homog,m[a.args[5]].homog),c=f.normalizeMax(f.matrix([[c[0],b(c[1]),c[4],b(c[5])],[c[1],c[0],c[5],c[4]],[c[2],b(c[3]),c[6],b(c[7])],[c[3],c[2],c[7],c[6]]])),d=f.normalizeMax(f.matrix([[d[6],b(d[4])],[d[7],b(d[5])],
[b(d[2]),d[0]],[b(d[3]),d[1]]])),e=f.productMM(c,d),d=e.value[0].value[0],c=e.value[1].value[0],g=e.value[0].value[1],h=e.value[1].value[1],p=e.value[2].value[0],q=e.value[3].value[0],r=e.value[2].value[1],e=e.value[3].value[1];a.mat1=f.normalizeMax(f.matrix([[b(p),q,b(r)],[q,p,e],[d,b(c),g]]));a.mat2=f.normalizeMax(f.matrix([[b(q),b(p),b(e)],[b(p),q,b(r)],[c,d,h]]))};n.TrMoebiusP={};n.TrMoebiusP.kind="P";n.TrMoebiusP.signature=["Mt","P"];n.TrMoebiusP.updatePosition=function(a){var b=m[a.args[0]],
d=m[a.args[1]].homog,c=f.productMV(b.mat1,d),b=f.productMV(b.mat2,d);a.homog=f.normalizeMax(f.cross(c,b));a.homog=w.withUsage(a.homog,"Point")};n._helper.TrMoebiusP=function(a,b){var d=f.productMV(b.mat1,a),c=f.productMV(b.mat2,a);return f.normalizeMax(f.cross(d,c))};n.TrMoebiusL={};n.TrMoebiusL.kind="C";n.TrMoebiusL.signature=["Mt","L"];n.TrMoebiusL.updatePosition=function(a){var b=m[a.args[0]],d=m[a.args[1]].homog,c=function(){var a=f.realVector([Math.random()-.5,Math.random()-.5,Math.random()-
.5]);return f.normalizeMax(a)},e=f.cross(c(),d),g=f.cross(c(),d),d=f.cross(c(),d),e=n._helper.TrMoebiusP(e,b),g=n._helper.TrMoebiusP(g,b),b=n._helper.TrMoebiusP(d,b);a.matrix=f.normalizeMax(n._helper.ConicBy5(null,e,g,b,f.ii,f.jj));a.matrix=w.withUsage(a.matrix,"Circle")};n.TrMoebiusC={};n.TrMoebiusC.kind="C";n.TrMoebiusC.signature=["Mt","C"];n.TrMoebiusC.updatePosition=function(a){var b=m[a.args[0]],d=m[a.args[1]].matrix;if("Circle"!==d.usage)console.log("applying Moebius transform to conics is not implemented yet"),
b=l.real(3),a.matrix=f.zeromatrix(b,b);else{var c=function(){var a=f.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);return f.normalizeMax(a)},e=n._helper.IntersectLC(c(),d),c=n._helper.IntersectLC(c(),d),d=e[1],c=c[1],e=n._helper.TrMoebiusP(e[0],b),d=n._helper.TrMoebiusP(d,b),b=n._helper.TrMoebiusP(c,b);a.matrix=f.normalizeMax(n._helper.ConicBy5(null,e,d,b,f.ii,f.jj))}a.matrix=w.withUsage(a.matrix,"Circle")};n.TrMoebiusArc={};n.TrMoebiusArc.kind="C";n.TrMoebiusArc.signature=["Mt",
"C"];n.TrMoebiusArc.updatePosition=function(a){var b=m[a.args[0]],d=m[a.args[1]],c=d.viaPoint,e=d.endPoint,d=n._helper.TrMoebiusP(d.startPoint,b),c=n._helper.TrMoebiusP(c,b),b=n._helper.TrMoebiusP(e,b);a.startPoint=d;a.viaPoint=c;a.endPoint=b;a.isArc=!0;a.matrix=f.normalizeMax(n._helper.ConicBy5(null,d,c,b,f.ii,f.jj));a.matrix=w.withUsage(a.matrix,"Circle")};n._helper.trBuildMatrix=function(a,b){var d=b(0),c=b(1),e=f.productMM(c,f.adjoint3(d));a.matrix=f.normalizeMax(e);e=f.transpose(f.productMM(d,
f.adjoint3(c)));a.dualMatrix=f.normalizeMax(e)};n.TrProjection={};n.TrProjection.kind="Tr";n.TrProjection.signature="PPPPPPPP".split("");n.TrProjection.updatePosition=function(a){n._helper.trBuildMatrix(a,function(b){return D.basismap(m[a.args[0+b]].homog,m[a.args[2+b]].homog,m[a.args[4+b]].homog,m[a.args[6+b]].homog)})};n.TrAffine={};n.TrAffine.kind="Tr";n.TrAffine.signature="PPPPPP".split("");n.TrAffine.updatePosition=function(a){var b=l.mult,d=f.scalmult,c=f.turnIntoCSList,e=f.transpose,g=f.normalizeMax,
h=f.productMM,n=f.adjoint3,p=c([m[a.args[0]].homog,m[a.args[2]].homog,m[a.args[4]].homog]),q=c([m[a.args[1]].homog,m[a.args[3]].homog,m[a.args[5]].homog]),r=e(p),e=e(q),t=r.value[2].value,u=e.value[2].value,w=[b(t[0],u[2]),b(t[1],u[0]),b(t[2],u[1])],r=n(r).value;a.matrix=g(h(e,c([d(b(w[0],u[1]),r[0]),d(b(w[1],u[2]),r[1]),d(b(w[2],u[0]),r[2])])));r=p.value;a.dualMatrix=g(h(n(q),c([d(b(t[2],w[1]),r[0]),d(b(t[0],w[2]),r[1]),d(b(t[1],w[0]),r[2])])))};n.TrSimilarity={};n.TrSimilarity.kind="Tr";n.TrSimilarity.signature=
["P","P","P","P"];n.TrSimilarity.updatePosition=function(a){n._helper.trBuildMatrix(a,function(b){return D.basismap(m[a.args[0+b]].homog,m[a.args[2+b]].homog,f.ii,f.jj)})};n.TrTranslation={};n.TrTranslation.kind="Tr";n.TrTranslation.signature=["P","P"];n.TrTranslation.updatePosition=function(a){var b=m[a.args[0]].homog,d=m[a.args[1]].homog,c=f.cross(b,d).value,b=l.mult(b.value[2],d.value[2]),d=f.turnIntoCSList,e=l.neg,g=l.zero,c=d([d([b,g,c[1]]),d([g,b,e(c[0])]),d([g,g,b])]),c=f.normalizeMax(c);a.matrix=
c;b=e(c.value[0].value[0]);c=d([d([b,g,g]),d([g,b,g]),d([c.value[0].value[2],c.value[1].value[2],b])]);a.dualMatrix=c};n.TrReflectionP={};n.TrReflectionP.kind="Tr";n.TrReflectionP.signature=["P"];n.TrReflectionP.updatePosition=function(a){var b=m[a.args[0]].homog.value,d=l.realmult(-.5,b[2]),c=l.zero,b=f.turnIntoCSList([f.turnIntoCSList([d,c,b[0]]),f.turnIntoCSList([c,d,b[1]]),f.turnIntoCSList([c,c,l.neg(d)])]),b=f.normalizeMax(b);a.matrix=b;a.dualMatrix=f.transpose(b)};n.TrReflectionL={};n.TrReflectionL.kind=
"Tr";n.TrReflectionL.signature=["L"];n.TrReflectionL.updatePosition=function(a){var b=l.mult,d=l.realmult,c=l.zero,e=m[a.args[0]].homog.value,g=e[0],h=e[1],e=e[2],n=b(g,g),p=b(h,h),q=d(-.5,l.sub(n,p)),r=b(g,h),b=f.turnIntoCSList([f.turnIntoCSList([l.neg(q),r,b(g,e)]),f.turnIntoCSList([r,q,b(h,e)]),f.turnIntoCSList([c,c,d(-.5,l.add(n,p))])]),b=f.normalizeMax(b);a.matrix=b;a.dualMatrix=f.transpose(b)};n.TrReflectionS={};n.TrReflectionS.kind="Tr";n.TrReflectionS.signature=["S"];n.TrReflectionS.updatePosition=
n.TrReflectionL.updatePosition;n.TrReflectionC={};n.TrReflectionC.kind="Rc";n.TrReflectionC.signature=["C"];n.TrReflectionC.updatePosition=function(a){var b=m[a.args[0]].matrix;if("Circle"!==b.usage)console.log("reflection in general conics is not defined"),a.sclRsq=l.zero,a.matrix=f.fund;else{var d=l.add,c=l.mult,e=b.value[2].value,g=e[0],h=e[1],e=e[2],n=b.value[0].value[0];a.sclRsq=l.sub(d(c(g,g),c(h,h)),c(n,e))}a.dualMatrix=a.matrix=b};n._helper.ReflectC=function(a,b){var d=l.add,c=l.sub,e=l.mult,
g=f.scalmult,h=a.matrix,m=h.value[0].value[0],n=h.value[2].value,p=n[1],q=n[2],r=b.value[0].value[0],t=b.value[2].value,u=t[1],x=t[2],d=c(l.realmult(2,d(e(n[0],t[0]),e(p,u))),d(e(m,x),e(r,q)));return w.withUsage(f.normalizeMax(f.sub(g(d,h),g(a.sclRsq,b))),"Circle")};n.ReflectCC={};n.ReflectCC.kind="C";n.ReflectCC.signature=["Rc","C"];n.ReflectCC.updatePosition=function(a){var b=m[a.args[1]];"Circle"!==b.matrix.usage?(console.log("reflecting general conics in circles is not defined"),a.matrix=w.withUsage(f.fund,
"Circle")):a.matrix=n._helper.ReflectC(m[a.args[0]],b.matrix)};n.ReflectCL={};n.ReflectCL.kind="C";n.ReflectCL.signature=["Rc","L"];n.ReflectCL.updatePosition=function(a){var b=l.zero,d=m[a.args[1]].homog.value,b=n._helper.buildConicMatrix([b,b,b,d[0],d[1],l.realmult(2,d[2])]);a.matrix=n._helper.ReflectC(m[a.args[0]],b)};n._helper.ReflectCP=function(a,b){var d=b.matrix,c=d.value[2].value,c=f.turnIntoCSList([c[0],c[1],l.neg(d.value[0].value[0])]),e=f.cross;return f.normalizeMax(e(f.productMV(d,a),
e(c,a)))};n.ReflectCP={};n.ReflectCP.kind="P";n.ReflectCP.signature=["Rc","P"];n.ReflectCP.updatePosition=function(a){a.homog=w.withUsage(n._helper.ReflectCP(m[a.args[1]].homog,m[a.args[0]]),"Point")};n.ReflectCArc={};n.ReflectCArc.kind="C";n.ReflectCArc.signature=["Rc","C"];n.ReflectCArc.updatePosition=function(a){var b=m[a.args[0]],d=m[a.args[1]],c=d.viaPoint,e=d.endPoint,f=n._helper.ReflectCP(d.startPoint,b),c=n._helper.ReflectCP(c,b),e=n._helper.ReflectCP(e,b);a.startPoint=f;a.viaPoint=c;a.endPoint=
e;a.isArc=!0;a.matrix=n._helper.ReflectC(b,d.matrix)};n.ReflectCS={};n.ReflectCS.kind="C";n.ReflectCS.signature=["Rc","S"];n.ReflectCS.updatePosition=function(a){var b=m[a.args[0]],d=m[a.args[1]],c=d.startpos,e=d.endpos,f=n._helper.midpoint(c,e),c=n._helper.ReflectCP(c,b),f=n._helper.ReflectCP(f,b),e=n._helper.ReflectCP(e,b);a.startPoint=c;a.viaPoint=f;a.endPoint=e;a.isArc=!0;e=l.zero;d=d.homog.value;d=n._helper.buildConicMatrix([e,e,e,d[0],d[1],l.realmult(2,d[2])]);a.matrix=n._helper.ReflectC(b,
d)};n.TrInverse={};n.TrInverse.kind="Tr";n.TrInverse.signature=["Tr"];n.TrInverse.updatePosition=function(a){var b=m[a.args[0]];a.dualMatrix=f.transpose(b.matrix);a.matrix=f.transpose(b.dualMatrix)};n.TransformC={};n.TransformC.kind="C";n.TransformC.signature=["Tr","C"];n.TransformC.updatePosition=function(a){var b=m[a.args[0]].dualMatrix,b=f.productMM(f.productMM(b,m[a.args[1]].matrix),f.transpose(b)),b=f.normalizeMax(b);a.matrix=w.withUsage(b,"Conic")};n.TransformArc={};n.TransformArc.kind="C";
n.TransformArc.signature=["Tr","C"];n.TransformArc.updatePosition=function(a){var b=m[a.args[0]].matrix,d=m[a.args[1]],c=d.viaPoint,e=d.endPoint,d=f.normalizeMax(f.productMV(b,d.startPoint)),c=f.normalizeMax(f.productMV(b,c)),b=f.normalizeMax(f.productMV(b,e));a.startPoint=d;a.viaPoint=c;a.endPoint=b;a.isArc=!0;a.matrix=f.normalizeMax(n._helper.ConicBy5(null,d,c,b,f.ii,f.jj));a.matrix=w.withUsage(a.matrix,"Circle")};n.TransformP={};n.TransformP.kind="P";n.TransformP.signature=["Tr","P"];n.TransformP.updatePosition=
function(a){a.homog=f.normalizeMax(f.productMV(m[a.args[0]].matrix,m[a.args[1]].homog));a.homog=w.withUsage(a.homog,"Point")};n.TransformL={};n.TransformL.kind="L";n.TransformL.signature=["Tr","L"];n.TransformL.updatePosition=function(a){a.homog=f.normalizeMax(f.productMV(m[a.args[0]].dualMatrix,m[a.args[1]].homog));a.homog=w.withUsage(a.homog,"Line")};n.TransformS={};n.TransformS.kind="S";n.TransformS.signature=["Tr","S"];n.TransformS.updatePosition=function(a){var b=m[a.args[0]],d=m[a.args[1]];
a.homog=f.normalizeMax(f.productMV(b.dualMatrix,d.homog));a.homog=w.withUsage(a.homog,"Line");a.startpos=f.normalizeMax(f.productMV(b.matrix,d.startpos));a.endpos=f.normalizeMax(f.productMV(b.matrix,d.endpos));a.farpoint=f.normalizeMax(f.productMV(b.matrix,d.farpoint))};n._helper.pointReflection=function(a,b){return f.normalizeMax(f.sub(f.scalmult(l.realmult(2,b.value[2]),a),f.scalmult(a.value[2],b)))};n._helper.conicOtherIntersection=function(a,b,d){var c=f.productMV(a,d);a=f.scalproduct(d,c);c=
f.scalproduct(b,c);c=l.realmult(-2,c);b=f.scalmult(a,b);d=f.scalmult(c,d);d=f.add(b,d);return d=f.normalizeMax(d)};n.Dist={};n.Dist.kind="V";n.Dist.signature=["P","P"];n.Dist.updatePosition=function(a){var b=m[a.args[1]].homog;a.value=f.abs(f.sub(f.normalizeZ(m[a.args[0]].homog),f.normalizeZ(b)))};n.Angle={};n.Angle.kind="V";n.Angle.signature=["L","L","P"];n.Angle.initialize=function(a){void 0===a.angle&&(a.angle=.5*Math.PI);Ga(l._helper.input(a.angle))};n.Angle.updatePosition=function(a){var b=m[a.args[1]].homog,
d=m[a.args[2]].homog,c=f.cross(m[a.args[0]].homog,f.linfty),b=f.cross(b,f.linfty),d=f.crossratio3(c,b,f.ii,f.jj,d),d=l.mult(l.complex(0,.5),l.log(d)),c=(db().value.real-d.value.real)/Math.PI,b=Math.round(c);!Qa&&.01<Math.abs(b-c)&&zb();d=l.complex(b*Math.PI+d.value.real,d.value.imag);Ga(d);a.value=w.withUsage(d,"Angle")};n.Angle.stateSize=2;n.TextImpl={};n.TextImpl.kind="Text";n.TextImpl.signature=[];n.TextImpl.updatePosition=function(){};n.TextImpl.initialize=function(a){a.text=String(a.text);a.size=
l.real(a.size?+a.size:ra.textsize);a.pos&&(a.pos=n._helper.initializePoint(a));a.dock&&(a.dock.offset=a.dock.offset&&2===a.dock.offset.length?f.realVector([+a.dock.offset[0],+a.dock.offset[1]]):f.realVector([0,0]))};n._helper.initializePoint=function(a){var b=0,d=0,c=0;if(a.pos){if("list"===a.pos.ctype&&f.isNumberVector(a.pos))return a.pos;2===a.pos.length&&(b=a.pos[0],d=a.pos[1],c=1);3===a.pos.length&&(b=a.pos[0],d=a.pos[1],c=a.pos[2])}a=f.turnIntoCSList([l._helper.input(b),l._helper.input(d),l._helper.input(c)]);
return a=f.normalizeMax(a)};n._helper.initializeLine=function(a){var b=0,d=0,c=0;if(a.pos){if("list"===a.pos.ctype&&f.isNumberVector(a.pos))return a.pos;3===a.pos.length&&(b=a.pos[0],d=a.pos[1],c=a.pos[2])}a=f.turnIntoCSList([l._helper.input(b),l._helper.input(d),l._helper.input(c)]);return a=f.normalizeMax(a)};var pd={CircleMFixedr:function(a){a.pinned=!0;a.type="CircleMr";return[a]},CircleByRadius:function(a){a.type="CircleMr";return[a]},IntersectionConicLine:function(a){a.args=[a.args[1],a.args[0]];
a.type="IntersectLC";return[a]},IntersectionCircleCircle:function(a){a.type="IntersectCirCir";return[a]},IntersectionConicConic:function(a){a.type="IntersectConicConic";return[a]},FreePoint:function(a){a.type="Free";return[a]},Orthogonal:function(a){a.type="Perp";return[a]},Parallel:function(a){a.type="Para";return[a]},Pole:function(a){a.type="PolarOfLine";return[a]},Polar:function(a){a.type="PolarOfPoint";return[a]},Calculation:function(a){console.log("Calculation stripped from construction");return[]},
Arc:function(a){a.type="ArcBy3";return[a]},EuclideanMid:function(a){a.type="Mid";return[a]},AngularBisector:function(a){a.type="AngleBisector";return[a]},angleBisector:function(a){var b={name:a.name+"_Intersection",type:"Meet",args:a.args,visible:!1};a.type="AngleBisector";a.args=[a.args[0],a.args[1],b.name];return[b,a]},Transform:function(a){var b=m[a.args[1]],b={Tr:"Transform",Mt:"TrMoebius",Rc:"ReflectC"}[m[a.args[0]].kind]+(b.isArc?"Arc":b.kind);if(n.hasOwnProperty(b))return a.type=b,[a];console.log(b+
" not implemented yet");return[]},TrReflection:function(a){var b="TrReflection"+m[a.args[0]].kind;if(n.hasOwnProperty(b))return a.type=b,[a];console.log(b+" not implemented yet");return[]},Text:function(a){a.type="TextImpl";a.args=[];return[a]}},wd="alpha angle args arrow arrowposition arrowshape arrowsides arrowsize clip color dashtype drawtrace filled labeled labelpos name overhang pinned printname radius size text_fontfamily textbold textitalics textsize tracedim tracelength traceskip tracing type visible".split(" ");
ka.saveState=function(){return{geometry:xd()}};var la={},Wc,kb,Xc,Yc;Wc=[[],[.2],[.075,.225],[44/45,-56/15,32/9],[19372/6561,-25360/2187,64448/6561,-212/729],[9017/3168,-355/33,46732/5247,49/176,-5103/18656],[35/384,0,500/1113,125/192,-2187/6784,11/84]];kb=[0,.2,.3,.8,8/9,1,1];Xc=[35/384,0,500/1113,125/192,-2187/6784,11/84,0];Yc=[5179/57600,0,7571/16695,.6140625,-92097/339200,187/2100,.025];var pa,Z=[],Yb=[],Gb=!1;la.tick=function(){for(var a=0;a<J.env.accuracy;a++)la.tick1(J.env.deltat/J.env.accuracy),
A(da.simulationstep)};la.tick1=function(a){for(var b=a,d=0;0<a&&d<.999*a||0>a&&d>.999*a;)b=la.oneRKStep(b),d+=b,b=Math.min(2*b,a-d),b=Math.max(b,1E-16),la.restorePosition(),la.doCollisions(),la.calculateForces(),la.moveToFinalPos();return!0};la.restorePosition=function(){pa.forEach(function(a){a=a.behavior;J[a.type].restorePos(a,9)})};la.doCollisions=function(){pa.forEach(function(a){a=a.behavior;J[a.type].doCollisions(a)})};la.calculateForces=function(){pa.forEach(function(a){a=a.behavior;J[a.type].calculateForces(a)})};
la.moveToFinalPos=function(){pa.forEach(function(a){a=a.behavior;J[a.type].move(a)})};la.oneRKStep=function(a){for(var b=function(a){pa.forEach(function(b){b=b.behavior;J[b.type].initRK(b,a);J[b.type].storePosition(b)})},d=function(a){pa.forEach(function(b){b=b.behavior;J[b.type].setToTimestep(b,kb[a])})},c=function(a){pa.forEach(function(b){b=b.behavior;J[b.type].proceedMotion(b,kb[a],a,Wc[a])})},e=function(){pa.forEach(function(a){a=a.behavior;J[a.type].resetForces(a)})},f=function(a){pa.forEach(function(b){b=
b.behavior;J[b.type].calculateDelta(b,a)})},g=function(b){var d=0;pa.forEach(function(a){a=a.behavior;J[a.type].proceedMotion(a,kb[6],7,Xc);J[a.type].savePos(a,8);J[a.type].proceedMotion(a,kb[6],7,Yc);J[a.type].savePos(a,9);d+=J[a.type].sqDist(a,8,9)});return d=Math.sqrt(d)/a},h=function(a){pa.forEach(function(a){a=a.behavior;J[a.type].recallPosition(a)})},l=!1;!l;){b(a);for(var m=0;7>m;m++)d(m),c(m),e(),la.calculateForces(),f(m);g(a)>J.env.errorbound&&a>J.env.lowestdeltat?(a/=J.env.slowdownfactor,
h()):l=!0}return a};var J={Mass:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.mass&&(a.mass=1);"undefined"===typeof a.charge&&(a.charge=0);"undefined"===typeof a.friction&&(a.friction=0);a.lnfrict=0;"undefined"===typeof a.limitspeed&&(a.limitspeed=!1);"undefined"===typeof a.fixed&&(a.fixed=!1);"undefined"===typeof a.radius&&(a.radius=1);a.internalmove=!1;a.fx=0;a.fy=0;a.fz=0;a.vx=a.vx||0;a.vy=a.vy||0;a.vz=a.vz||0;a.mtype=0;a.env=J.env;a.deltat=0;a.mx=0;a.my=0;a.mz=
0;a.mvx=0;a.mvy=0;a.mvz=0;a.dx=[0,0,0,0,0,0,0,0,0,0];a.dy=[0,0,0,0,0,0,0,0,0,0];a.dz=[0,0,0,0,0,0,0,0,0,0];a.dvx=[0,0,0,0,0,0,0,0,0,0];a.dvy=[0,0,0,0,0,0,0,0,0,0];a.dvz=[0,0,0,0,0,0,0,0,0,0];a.midx=0;a.midy=0;a.midz=0;a.lx=0;a.ly=0;a.lz=0},resetForces:function(a){a.fx=0;a.fy=0;a.fz=0},getBlock:!1,setToTimestep:function(a,b,d){},initRK:function(a,b){var d=D.extractPoint(a.el.homog);a.x=d.x;a.y=d.y;a.z=0;a.xo=a.x;a.yo=a.y;a.zo=a.z;a.vxo=a.vx;a.vyo=a.vy;a.vzo=a.vz;a.deltat=b;a.fx=0;a.fy=0;a.fz=0},setVelocity:function(a,
b,d,c){c||(c=0);a.vx=b;a.vy=d;a.vz=c},move:function(a){a.pos=[a.x,a.y,1];a.internalmove=!0;ca&&W.down&&a.el===ca.mover||Ea(a.el,f.realVector(a.pos),"homog");a.el.sx=a.x;a.el.sy=a.y;a.internalmove=!1},proceedMotion:function(a,b,d,c){if(!a.fixed)for(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz,b=0;b<d;b++)a.x+=c[b]*a.dx[b]*a.deltat,a.y+=c[b]*a.dy[b]*a.deltat,a.z+=c[b]*a.dz[b]*a.deltat,a.vx+=c[b]*a.dvx[b]*a.deltat,a.vy+=c[b]*a.dvy[b]*a.deltat,a.vz+=c[b]*a.dvz[b]*a.deltat},calculateForces:function(a){var b=
Math.sqrt(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz);a.lnfrict=-Math.log((1-a.friction)*(1-a.env.friction)*(.1<b&&a.limitSpeed?.1/b:1));a.fx+=-a.vx*a.lnfrict*a.mass;a.fy+=-a.vy*a.lnfrict*a.mass;a.fz+=-a.vz*a.lnfrict*a.mass},calculateDelta:function(a,b){a.dx[b]=a.vx;a.dy[b]=a.vy;a.dz[b]=a.vz;a.dvx[b]=a.fx/a.mass;a.dvy[b]=a.fy/a.mass;a.dvz[b]=a.fz/a.mass},savePos:function(a,b){a.dx[b]=a.x;a.dy[b]=a.y;a.dz[b]=a.z;a.dvx[b]=a.vx;a.dvy[b]=a.vy;a.dvz[b]=a.vz},restorePos:function(a,b){a.fixed||(a.x=a.dx[b],a.y=a.dy[b],
a.z=a.dz[b],a.vx=a.dvx[b],a.vy=a.dvy[b],a.vz=a.dvz[b])},sqDist:function(a,b,d){var c=(a.dx[b]-a.dx[d])*(a.dx[b]-a.dx[d]),c=c+(a.dy[b]-a.dy[d])*(a.dy[b]-a.dy[d]),c=c+(a.dz[b]-a.dz[d])*(a.dz[b]-a.dz[d]),c=c+(a.dvx[b]-a.dvx[d])*(a.dvx[b]-a.dvx[d]),c=c+(a.dvy[b]-a.dvy[d])*(a.dvy[b]-a.dvy[d]);return c+=(a.dvz[b]-a.dvz[d])*(a.dvz[b]-a.dvz[d])},kineticEnergy:function(a){return.5*a.mass*(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz)},storePosition:function(a){a.mx=a.x;a.my=a.y;a.mz=a.z;a.mvx=a.vx;a.mvy=a.vy;a.mvz=a.vz},
recallPosition:function(a){a.fixed||(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz)},doCollisions:function(a){}},Sun:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.mass&&(a.mass=10);"undefined"===typeof a.friction&&(a.friction=0);a.charge=0;a.x=0;a.y=0;a.z=0},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,d){},initRK:function(a,b){var d=D.extractPoint(a.el.homog);a.x=d.x;a.y=d.y;a.z=0},setVelocity:function(a,b,d,c){},move:function(a){},
proceedMotion:function(a,b,d,c){},calculateDelta:function(a,b){},calculateForces:function(a){for(var b=a.x,d=a.y,c=a.z,e=0;e<Z.length;e++){var f=Z[e],g=f.behavior.x,h=f.behavior.y,l=f.behavior.z,m=Math.sqrt((b-g)*(b-g)+(d-h)*(d-h)+(c-l)*(c-l)),h=(d-h)*a.mass*f.behavior.mass/(m*m*m),l=(c-l)*a.mass*f.behavior.mass/(m*m*m);f.behavior.fx+=(b-g)*a.mass*f.behavior.mass/(m*m*m)*f.behavior.mass;f.behavior.fy+=h*f.behavior.mass;f.behavior.fz+=l*f.behavior.mass}},savePos:function(a,b){},restorePos:function(a,
b){},sqDist:function(a,b,d){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},Gravity:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.strength&&(a.strength=1);a.namea=b.args[0];a.nameb=b.args[1];a.ma=m[a.namea];a.mb=m[a.nameb]},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,d){},initRK:function(a,b){},setVelocity:function(a,b,d,c){},move:function(a){},proceedMotion:function(a,
b,d,c){},calculateDelta:function(a,b){},calculateForces:function(a){var b=D.extractPoint(a.ma.homog),d=D.extractPoint(a.mb.homog),c=(d.x-b.x)*a.strength;a=(d.y-b.y)*a.strength;for(b=0;b<Z.length;b++)d=Z[b],d.behavior.fx+=c*d.behavior.mass,d.behavior.fy+=a*d.behavior.mass,d.behavior.fz+=0*d.behavior.mass},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,d){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},
Spring:{init:function(a,b){a.el=b;"undefined"===typeof a.strength&&(a.strength=1);"undefined"===typeof a.amplitude&&(a.amplitude=0);"undefined"===typeof a.phase&&(a.phase=0);"undefined"===typeof a.speed&&(a.speed=1);"undefined"===typeof a.l0&&(a.l0=0);"undefined"===typeof a.stype&&(a.stype=1);"undefined"===typeof a.readOnInit&&(a.readOnInit=!1);a.namea=b.args[0];a.nameb=b.args[1];a.ma=m[a.namea];a.mb=m[a.nameb];var d=D.extractPoint(a.ma.homog),c=D.extractPoint(a.mb.homog);a.l0=Math.sqrt((d.x-c.x)*
(d.x-c.x)+(d.y-c.y)*(d.y-c.y));a.env=J.env},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,d){},initRK:function(a,b){},setVelocity:function(a,b,d,c){},move:function(a){},proceedMotion:function(a,b,d,c){},calculateForces:function(a){var b,d,c,e;!a.ma.behavior||ca&&W.down&&a.ma===ca.mover?(d=D.extractPoint(a.ma.homog),b=d.x,c=d.y):(b=a.ma.behavior.x,c=a.ma.behavior.y);!a.mb.behavior||ca&&W.down&&a.mb===ca.mover?(e=D.extractPoint(a.mb.homog),d=e.x,e=e.y):(d=a.mb.behavior.x,e=a.mb.behavior.y);
var f=Math.sqrt((b-d)*(b-d)+(c-e)*(c-e)),g=a.l0,h=a.stype;1===h&&(g=0);var l=0;if(2===h||3===h)l=a.ma.behavior.mass*a.mb.behavior.mass*a.strength;2===h&&(l=-l);var m,n;if(0===f||0!==h&&1!==h)if(a.ma.behavior&&a.mb.behavior&&0!==f){if(f*=f*f,2===h||3===h)m=(b-d)*l/f,n=(c-e)*l/f}else m=n=0;else m=-(b-d)*a.strength*(f-g)/f*a.env.springstrength,n=-(c-e)*a.strength*(f-g)/f*a.env.springstrength;a.ma.behavior&&(a.ma.behavior.fx+=m,a.ma.behavior.fy+=n);a.mb.behavior&&(a.mb.behavior.fx-=m,a.mb.behavior.fy-=
n)},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,d){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},det:function(a,b,d,c,e,f){return d*f-e*c+e*b-a*f+a*c-d*b},Bouncer:{init:function(a,b){a.el=b;"undefined"===typeof a.xdamp&&(a.xdamp=0);"undefined"===typeof a.ydamp&&(a.ydamp=0);"undefined"===typeof a.motorchanger&&(a.motorchanger=!0);a.namea=b.args[0];a.nameb=b.args[1];
a.ma=m[a.namea];a.mb=m[a.nameb];var d=D.extractPoint(a.ma.homog),c=D.extractPoint(a.mb.homog);a.x1o=1.01*d.x-.01*c.x;a.y1o=1.01*d.y-.01*c.y;a.x2o=1.01*c.x-.01*d.x;a.y2o=1.01*c.y-.01*d.y;a.env=J.env},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,d){},initRK:function(a,b){a.deltat=b},setVelocity:function(a,b,d,c){},move:function(a){},proceedMotion:function(a,b,c,e){},calculateForces:function(a){},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,
b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){for(var b=D.extractPoint(a.ma.homog),c=D.extractPoint(a.mb.homog),e=b.x,b=b.y,f=c.x,c=c.y,g=a.x1o,h=a.y1o,m=a.x2o,n=a.y2o,p=Math.sqrt((e-f)*(e-f)+(b-c)*(b-c)),q=(e-f)/p,p=(b-c)/p,r=0;r<Z.length;r++){var t=Z[r],u=t.behavior.xo,w=t.behavior.yo,x=t.behavior.x,z=t.behavior.y,y=l.mult(l.complex(g,h),l.complex(f,c)),A=l.mult(l.complex(m,n),l.complex(e,b)),y=l.sub(y,A),A=l.mult(l.complex(u,
w),l.complex(e,b)),y=l.add(y,A),A=l.mult(l.complex(u,w),l.complex(f,c)),y=l.sub(y,A),A=l.sub(l.complex(g,h),l.complex(m,n)),y=l.div(y,A);0>J.det(e,b,f,c,x,z)*J.det(e,b,f,c,y.value.real,y.value.imag)&&0>J.det(e,b,x,z,y.value.real,y.value.imag)*J.det(f,c,x,z,y.value.real,y.value.imag)&&(w=t.behavior.mvx+a.deltat*(-y.value.real+t.behavior.xo),x=t.behavior.mvy+a.deltat*(-y.value.imag+t.behavior.yo),u=q*w+p*x,w=p*w-q*x,t.behavior.x=y.value.real,t.behavior.y=y.value.imag,t.behavior.vx=q*u*(1-a.xdamp),t.behavior.vy=
p*u*(1-a.xdamp),t.behavior.vx+=-p*w*(1-a.ydamp),t.behavior.vy+=q*w*(1-a.ydamp))}a.x1o=e;a.y1o=b;a.x2o=f;a.y2o=c}},Environment:{init:function(a){"undefined"===typeof a.gravity&&(a.gravity=0);"undefined"===typeof a.friction&&(a.friction=0);"undefined"===typeof a.springstrength&&(a.springstrength=1);"undefined"===typeof a.accuracy&&(a.accuracy=10);"undefined"===typeof a.deltat&&(a.deltat=.3);"undefined"===typeof a.charges&&(a.charges=!1);"undefined"===typeof a.balls&&(a.balls=!1);"undefined"===typeof a.newton&&
(a.newton=!1);"undefined"===typeof a.ballInteractionBoosting&&(a.ballInteractionBoosting=1);J.env=a;a.errorbound=.001;a.lowestdeltat=1E-7;a.slowdownfactor=2},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,e){},move:function(a){},proceedMotion:function(a,b,c,e){},calculateForces:function(a){var b,c,e,f,g,h,l,m,n,p;if(a.newton)for(b=0;b<Z.length-1;b++)for(c=Z[b],e=c.behavior.x,f=c.behavior.y,g=b+1;g<Z.length;g++)h=Z[g],l=h.behavior.x,
m=h.behavior.y,p=Math.sqrt((e-l)*(e-l)+(f-m)*(f-m)),l=(e-l)*c.behavior.mass*h.behavior.mass/(p*p*p),m=(f-m)*c.behavior.mass*h.behavior.mass/(p*p*p),c.behavior.fx-=l,c.behavior.fy-=m,h.behavior.fx+=l,h.behavior.fy+=m;if(a.charges)for(b=0;b<Z.length-1;b++)for(c=Z[b],e=c.behavior.x,f=c.behavior.y,g=b+1;g<Z.length;g++)h=Z[g],l=h.behavior.x,m=h.behavior.y,p=Math.sqrt((e-l)*(e-l)+(f-m)*(f-m)),l=(e-l)*c.behavior.charge*h.behavior.charge/(p*p*p),m=(f-m)*c.behavior.charge*h.behavior.charge/(p*p*p),c.behavior.fx+=
l,c.behavior.fy+=m,h.behavior.fx-=l,h.behavior.fy-=m;if(a.balls)for(b=0;b<Z.length-1;b++)if(c=Z[b],0!==c.behavior.radius)for(e=c.behavior.x,f=c.behavior.y,g=b+1;g<Z.length;g++)h=Z[g],0!==h.behavior.radius&&(l=h.behavior.x,m=h.behavior.y,n=c.behavior.radius+h.behavior.radius,p=Math.sqrt((e-l)*(e-l)+(f-m)*(f-m)),0===a.ballInteractionBoosting?(l=(e-l)/(p*p*p)*(p>n?0:(p-n)*(p-n)),m=(f-m)/(p*p*p)*(p>n?0:(p-n)*(p-n))):1===a.ballInteractionBoosting?(l=(e-l)/(p*p*p*p)*(p>n?0:(p-n)*(p-n)),m=(f-m)/(p*p*p*p)*
(p>n?0:(p-n)*(p-n))):(l=(e-l)/(p*p*p*p*p)*(p>n?0:(p-n)*(p-n)),m=(f-m)/(p*p*p*p*p)*(p>n?0:(p-n)*(p-n))),c.behavior.fx+=l,c.behavior.fy+=m,h.behavior.fx-=l,h.behavior.fy-=m);for(b=0;b<Z.length;b++)c=Z[b],c.behavior.fx+=0,c.behavior.fy+=a.gravity,c.behavior.fz+=0},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}}};return ka};
return E}();"undefined"!==typeof process&&"undefined"!==typeof module&&"undefined"!==typeof module.exports&&"undefined"===typeof window&&(module.exports=createCindy);
//# sourceMappingURL=Cindy.js.map

