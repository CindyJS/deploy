/* CindyJS - (C) 2014-2016  The CindyJS Project
 * Mostly licensed under the Apache License 2.0, but subprojects may use different licensing.
 * See https://github.com/CindyJS/CindyJS/tree/606d872832fa4b71037741098be2de30f21e7a06
 * for corresponding sources and their respective licensing conditions.
 */
var enableInlineVideo=function(){function q(g,k,q,F){function E(q){ia=k(E,F);g(q-(M||q));M=q}var ia,M;return{start:function(){ia||E(0)},stop:function(){q(ia);ia=null;M=0}}}function E(g,k,q,F){function E(k){!!g[q]===!!F&&k.stopImmediatePropagation();delete g[q]}return g.addEventListener(k,E,!1),E}function ha(g,k,q,F){function E(g){q[k]=g}F&&E(g[k]);Object.defineProperty(g,k,{get:function(){return q[k]},set:E})}function Ga(g,k,q){q.addEventListener(k,function(){return g.dispatchEvent(new Event(k))})}
function oa(g,k){Promise.resolve().then(function(){g.dispatchEvent(new Event(k))})}function Ha(g){var k=new Audio;return Ga(g,"play",k),Ga(g,"playing",k),Ga(g,"pause",k),k.crossOrigin=g.crossOrigin,k.src=g.src||g.currentSrc||"data:",k}function ea(k,q,F){(M||0)+200<Date.now()&&(k[fa]=!0,M=Date.now());F||(k.currentTime=q);g[++tb%3]=100*q|0}function k(g){this.video.readyState>=this.video.HAVE_FUTURE_DATA?(this.hasAudio||(this.driver.currentTime=this.video.currentTime+g*this.video.playbackRate/1E3,this.video.loop&&
this.driver.currentTime>=this.video.duration&&(this.driver.currentTime=0)),ea(this.video,this.driver.currentTime)):this.video.networkState===this.video.NETWORK_IDLE&&0===this.video.buffered.length&&this.video.load();this.video.ended&&(delete this.video[fa],this.video.pause(!0))}function Pa(){var g=this[S];return this.webkitDisplayingFullscreen?void this[ub]():("data:"!==g.driver.src&&g.driver.src!==this.src&&(ea(this,0,!0),g.driver.src=this.src),void(this.paused&&(g.paused=!1,0===this.buffered.length&&
this.load(),g.driver.play(),g.updater.start(),g.hasAudio||(oa(this,"play"),g.video.readyState>=g.video.HAVE_ENOUGH_DATA&&oa(this,"playing")))))}function F(g){var k=this[S];k.driver.pause();k.updater.stop();this.webkitDisplayingFullscreen&&this[bb]();k.paused&&!g||(k.paused=!0,k.hasAudio||oa(this,"pause"),this.ended&&(this[fa]=!0,oa(this,"ended")))}function ia(F,E){var L=F[S]={};L.paused=!0;L.hasAudio=E;L.video=F;L.updater=q(k.bind(L),requestAnimationFrame,cancelAnimationFrame);E?L.driver=Ha(F):(F.addEventListener("canplay",
function(){F.paused||oa(F,"playing")}),L.driver={src:F.src||F.currentSrc||"data:",muted:!0,paused:!0,pause:function(){L.driver.paused=!0},play:function(){L.driver.paused=!1;L.driver.currentTime>=L.video.duration&&ea(F,0)},get ended(){return L.driver.currentTime>=L.video.duration}});F.addEventListener("emptied",function(){var g=!L.driver.src||"data:"===L.driver.src;L.driver.src&&L.driver.src!==F.src&&(ea(F,0,!0),L.driver.src=F.src,g?L.driver.play():L.updater.stop())},!1);F.addEventListener("webkitbeginfullscreen",
function(){F.paused?E&&0===L.driver.buffered.length&&L.driver.load():(F.pause(),F[ub]())});E&&(F.addEventListener("webkitendfullscreen",function(){L.driver.currentTime=F.currentTime}),F.addEventListener("seeking",function(){0>g.indexOf(100*F.currentTime|0)&&(L.driver.currentTime=F.currentTime)}))}var M,V="object"==typeof document&&"object-fit"in document.head.style&&!matchMedia("(-webkit-video-playable-inline)").matches,S="bfred-it:iphone-inline-video",fa="bfred-it:iphone-inline-video:event",ub="bfred-it:iphone-inline-video:nativeplay",
bb="bfred-it:iphone-inline-video:nativepause",g=[],tb=0;return function(g,k){if(void 0===k&&(k={}),!g[S])if(k.everywhere||V&&(k.iPad||k.ipad?/iPhone|iPod|iPad/:/iPhone|iPod/).test(navigator.userAgent)){!g.paused&&g.webkitDisplayingFullscreen&&g.pause();ia(g,!g.muted);var q=g[S];g[ub]=g.play;g[bb]=g.pause;g.play=Pa;g.pause=F;ha(g,"paused",q.driver);ha(g,"muted",q.driver,!0);ha(g,"playbackRate",q.driver,!0);ha(g,"ended",q.driver);ha(g,"loop",q.driver,!0);E(g,"seeking");E(g,"seeked");E(g,"timeupdate",
fa,!1);E(g,"ended",fa,!1);g.classList.add("IIV");g.muted&&g.autoplay&&g.play();/iPhone|iPod|iPad/.test(navigator.platform)||console.warn("iphone-inline-video is not guaranteed to work in emulated environments")}}}();
(function(){function q(b,d,e){g.biginteger_used=1;null!=b&&("number"==typeof b&&"undefined"==typeof d?this.fromInt(b):"number"==typeof b?this.fromNumber(b,d,e):null==d&&"string"!=typeof b?this.fromString(b,256):this.fromString(b,d))}function E(){return new q(null,void 0,void 0)}function ha(b,d,e,r,g,k){for(;0<=--k;){var v=d*this[b++]+e[r]+g;g=Math.floor(v/67108864);e[r++]=v&67108863}return g}function Ga(b,d,e,r,g,k){var v=d&32767;for(d>>=15;0<=--k;){var C=this[b]&32767,q=this[b++]>>15,F=d*C+q*v,C=
v*C+((F&32767)<<15)+e[r]+(g&1073741823);g=(C>>>30)+(F>>>15)+d*q+(g>>>30);e[r++]=C&1073741823}return g}function oa(b,d,e,r,g,k){var v=d&16383;for(d>>=14;0<=--k;){var C=this[b]&16383,q=this[b++]>>14,F=d*C+q*v,C=v*C+((F&16383)<<14)+e[r]+g;g=(C>>28)+(F>>14)+d*q;e[r++]=C&268435455}return g}function Ha(b,d){var e=ib[b.charCodeAt(d)];return null==e?-1:e}function ea(b){var d=E();d.fromInt(b);return d}function k(b){var d=1,e;0!=(e=b>>>16)&&(b=e,d+=16);0!=(e=b>>8)&&(b=e,d+=8);0!=(e=b>>4)&&(b=e,d+=4);0!=(e=
b>>2)&&(b=e,d+=2);0!=b>>1&&(d+=1);return d}function Pa(b){this.m=b}function F(b){this.m=b;this.mp=b.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<b.DB-15)-1;this.mt2=2*b.t}function ia(b,d){return b&d}function M(b,d){return b|d}function V(b,d){return b^d}function S(b,d){return b&~d}function fa(){}function ub(b){return b}function bb(b){this.r2=E();this.q3=E();q.ONE.dlShiftTo(2*b.t,this.r2);this.mu=this.r2.divide(b);this.m=b}var g={use_lines:!0,use_xyz:!1},tb=!1;"undefined"!==typeof module&&
module.exports?(module.exports=g,tb=!0):"undefined"!==typeof document?window.ClipperLib=g:self.ClipperLib=g;var X;if(tb)aa="chrome",X="Netscape";else{var aa=navigator.userAgent.toString().toLowerCase();X=navigator.appName}var L,ic,Ub,Ua,hb,Eb;L=-1!=aa.indexOf("chrome")&&-1==aa.indexOf("chromium")?1:0;tb=-1!=aa.indexOf("chromium")?1:0;ic=-1!=aa.indexOf("safari")&&-1==aa.indexOf("chrome")&&-1==aa.indexOf("chromium")?1:0;Ub=-1!=aa.indexOf("firefox")?1:0;aa.indexOf("firefox/17");aa.indexOf("firefox/15");
aa.indexOf("firefox/3");Ua=-1!=aa.indexOf("opera")?1:0;aa.indexOf("msie 10");aa.indexOf("msie 9");hb=-1!=aa.indexOf("msie 8")?1:0;Eb=-1!=aa.indexOf("msie 7")?1:0;aa=-1!=aa.indexOf("msie ")?1:0;g.biginteger_used=null;"Microsoft Internet Explorer"==X?(q.prototype.am=Ga,X=30):"Netscape"!=X?(q.prototype.am=ha,X=26):(q.prototype.am=oa,X=28);q.prototype.DB=X;q.prototype.DM=(1<<X)-1;q.prototype.DV=1<<X;q.prototype.FV=Math.pow(2,52);q.prototype.F1=52-X;q.prototype.F2=2*X-52;var ib=[],ua;X=48;for(ua=0;9>=
ua;++ua)ib[X++]=ua;X=97;for(ua=10;36>ua;++ua)ib[X++]=ua;X=65;for(ua=10;36>ua;++ua)ib[X++]=ua;Pa.prototype.convert=function(b){return 0>b.s||0<=b.compareTo(this.m)?b.mod(this.m):b};Pa.prototype.revert=function(b){return b};Pa.prototype.reduce=function(b){b.divRemTo(this.m,null,b)};Pa.prototype.mulTo=function(b,d,e){b.multiplyTo(d,e);this.reduce(e)};Pa.prototype.sqrTo=function(b,d){b.squareTo(d);this.reduce(d)};F.prototype.convert=function(b){var d=E();b.abs().dlShiftTo(this.m.t,d);d.divRemTo(this.m,
null,d);0>b.s&&0<d.compareTo(q.ZERO)&&this.m.subTo(d,d);return d};F.prototype.revert=function(b){var d=E();b.copyTo(d);this.reduce(d);return d};F.prototype.reduce=function(b){for(;b.t<=this.mt2;)b[b.t++]=0;for(var d=0;d<this.m.t;++d){var e=b[d]&32767,r=e*this.mpl+((e*this.mph+(b[d]>>15)*this.mpl&this.um)<<15)&b.DM,e=d+this.m.t;for(b[e]+=this.m.am(0,r,b,d,0,this.m.t);b[e]>=b.DV;)b[e]-=b.DV,b[++e]++}b.clamp();b.drShiftTo(this.m.t,b);0<=b.compareTo(this.m)&&b.subTo(this.m,b)};F.prototype.mulTo=function(b,
d,e){b.multiplyTo(d,e);this.reduce(e)};F.prototype.sqrTo=function(b,d){b.squareTo(d);this.reduce(d)};q.prototype.copyTo=function(b){for(var d=this.t-1;0<=d;--d)b[d]=this[d];b.t=this.t;b.s=this.s};q.prototype.fromInt=function(b){this.t=1;this.s=0>b?-1:0;0<b?this[0]=b:-1>b?this[0]=b+this.DV:this.t=0};q.prototype.fromString=function(b,d){var e;if(16==d)e=4;else if(8==d)e=3;else if(256==d)e=8;else if(2==d)e=1;else if(32==d)e=5;else if(4==d)e=2;else{this.fromRadix(b,d);return}this.s=this.t=0;for(var r=
b.length,g=!1,k=0;0<=--r;){var v=8==e?b[r]&255:Ha(b,r);0>v?"-"==b.charAt(r)&&(g=!0):(g=!1,0==k?this[this.t++]=v:k+e>this.DB?(this[this.t-1]|=(v&(1<<this.DB-k)-1)<<k,this[this.t++]=v>>this.DB-k):this[this.t-1]|=v<<k,k+=e,k>=this.DB&&(k-=this.DB))}8==e&&0!=(b[0]&128)&&(this.s=-1,0<k&&(this[this.t-1]|=(1<<this.DB-k)-1<<k));this.clamp();g&&q.ZERO.subTo(this,this)};q.prototype.clamp=function(){for(var b=this.s&this.DM;0<this.t&&this[this.t-1]==b;)--this.t};q.prototype.dlShiftTo=function(b,d){var e;for(e=
this.t-1;0<=e;--e)d[e+b]=this[e];for(e=b-1;0<=e;--e)d[e]=0;d.t=this.t+b;d.s=this.s};q.prototype.drShiftTo=function(b,d){for(var e=b;e<this.t;++e)d[e-b]=this[e];d.t=Math.max(this.t-b,0);d.s=this.s};q.prototype.lShiftTo=function(b,d){var e=b%this.DB,r=this.DB-e,g=(1<<r)-1,k=Math.floor(b/this.DB),v=this.s<<e&this.DM,C;for(C=this.t-1;0<=C;--C)d[C+k+1]=this[C]>>r|v,v=(this[C]&g)<<e;for(C=k-1;0<=C;--C)d[C]=0;d[k]=v;d.t=this.t+k+1;d.s=this.s;d.clamp()};q.prototype.rShiftTo=function(b,d){d.s=this.s;var e=
Math.floor(b/this.DB);if(e>=this.t)d.t=0;else{var r=b%this.DB,g=this.DB-r,k=(1<<r)-1;d[0]=this[e]>>r;for(var v=e+1;v<this.t;++v)d[v-e-1]|=(this[v]&k)<<g,d[v-e]=this[v]>>r;0<r&&(d[this.t-e-1]|=(this.s&k)<<g);d.t=this.t-e;d.clamp()}};q.prototype.subTo=function(b,d){for(var e=0,g=0,n=Math.min(b.t,this.t);e<n;)g+=this[e]-b[e],d[e++]=g&this.DM,g>>=this.DB;if(b.t<this.t){for(g-=b.s;e<this.t;)g+=this[e],d[e++]=g&this.DM,g>>=this.DB;g+=this.s}else{for(g+=this.s;e<b.t;)g-=b[e],d[e++]=g&this.DM,g>>=this.DB;
g-=b.s}d.s=0>g?-1:0;-1>g?d[e++]=this.DV+g:0<g&&(d[e++]=g);d.t=e;d.clamp()};q.prototype.multiplyTo=function(b,d){var e=this.abs(),g=b.abs(),n=e.t;for(d.t=n+g.t;0<=--n;)d[n]=0;for(n=0;n<g.t;++n)d[n+e.t]=e.am(0,g[n],d,n,0,e.t);d.s=0;d.clamp();this.s!=b.s&&q.ZERO.subTo(d,d)};q.prototype.squareTo=function(b){for(var d=this.abs(),e=b.t=2*d.t;0<=--e;)b[e]=0;for(e=0;e<d.t-1;++e){var g=d.am(e,d[e],b,2*e,0,1);(b[e+d.t]+=d.am(e+1,2*d[e],b,2*e+1,g,d.t-e-1))>=d.DV&&(b[e+d.t]-=d.DV,b[e+d.t+1]=1)}0<b.t&&(b[b.t-
1]+=d.am(e,d[e],b,2*e,0,1));b.s=0;b.clamp()};q.prototype.divRemTo=function(b,d,e){var g=b.abs();if(!(0>=g.t)){var n=this.abs();if(n.t<g.t)null!=d&&d.fromInt(0),null!=e&&this.copyTo(e);else{null==e&&(e=E());var J=E(),v=this.s;b=b.s;var C=this.DB-k(g[g.t-1]);0<C?(g.lShiftTo(C,J),n.lShiftTo(C,e)):(g.copyTo(J),n.copyTo(e));g=J.t;n=J[g-1];if(0!=n){var F=n*(1<<this.F1)+(1<g?J[g-2]>>this.F2:0),cb=this.FV/F,F=(1<<this.F1)/F,vb=1<<this.F2,H=e.t,ia=H-g,M=null==d?E():d;J.dlShiftTo(ia,M);0<=e.compareTo(M)&&(e[e.t++]=
1,e.subTo(M,e));q.ONE.dlShiftTo(g,M);for(M.subTo(J,J);J.t<g;)J[J.t++]=0;for(;0<=--ia;){var L=e[--H]==n?this.DM:Math.floor(e[H]*cb+(e[H-1]+vb)*F);if((e[H]+=J.am(0,L,e,ia,0,g))<L)for(J.dlShiftTo(ia,M),e.subTo(M,e);e[H]<--L;)e.subTo(M,e)}null!=d&&(e.drShiftTo(g,d),v!=b&&q.ZERO.subTo(d,d));e.t=g;e.clamp();0<C&&e.rShiftTo(C,e);0>v&&q.ZERO.subTo(e,e)}}}};q.prototype.invDigit=function(){if(1>this.t)return 0;var b=this[0];if(0==(b&1))return 0;var d=b&3,d=d*(2-(b&15)*d)&15,d=d*(2-(b&255)*d)&255,d=d*(2-((b&
65535)*d&65535))&65535,d=d*(2-b*d%this.DV)%this.DV;return 0<d?this.DV-d:-d};q.prototype.isEven=function(){return 0==(0<this.t?this[0]&1:this.s)};q.prototype.exp=function(b,d){if(4294967295<b||1>b)return q.ONE;var e=E(),g=E(),n=d.convert(this),J=k(b)-1;for(n.copyTo(e);0<=--J;)if(d.sqrTo(e,g),0<(b&1<<J))d.mulTo(g,n,e);else var v=e,e=g,g=v;return d.revert(e)};q.prototype.toString=function(b){if(0>this.s)return"-"+this.negate().toString(b);if(16==b)b=4;else if(8==b)b=3;else if(2==b)b=1;else if(32==b)b=
5;else if(4==b)b=2;else return this.toRadix(b);var d=(1<<b)-1,e,g=!1,n="",k=this.t,v=this.DB-k*this.DB%b;if(0<k--)for(v<this.DB&&0<(e=this[k]>>v)&&(g=!0,n="0123456789abcdefghijklmnopqrstuvwxyz".charAt(e));0<=k;)v<b?(e=(this[k]&(1<<v)-1)<<b-v,e|=this[--k]>>(v+=this.DB-b)):(e=this[k]>>(v-=b)&d,0>=v&&(v+=this.DB,--k)),0<e&&(g=!0),g&&(n+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(e));return g?n:"0"};q.prototype.negate=function(){var b=E();q.ZERO.subTo(this,b);return b};q.prototype.abs=function(){return 0>
this.s?this.negate():this};q.prototype.compareTo=function(b){var d=this.s-b.s;if(0!=d)return d;var e=this.t,d=e-b.t;if(0!=d)return 0>this.s?-d:d;for(;0<=--e;)if(0!=(d=this[e]-b[e]))return d;return 0};q.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+k(this[this.t-1]^this.s&this.DM)};q.prototype.mod=function(b){var d=E();this.abs().divRemTo(b,null,d);0>this.s&&0<d.compareTo(q.ZERO)&&b.subTo(d,d);return d};q.prototype.modPowInt=function(b,d){var e;e=256>b||d.isEven()?new Pa(d):
new F(d);return this.exp(b,e)};q.ZERO=ea(0);q.ONE=ea(1);fa.prototype.convert=ub;fa.prototype.revert=ub;fa.prototype.mulTo=function(b,d,e){b.multiplyTo(d,e)};fa.prototype.sqrTo=function(b,d){b.squareTo(d)};bb.prototype.convert=function(b){if(0>b.s||b.t>2*this.m.t)return b.mod(this.m);if(0>b.compareTo(this.m))return b;var d=E();b.copyTo(d);this.reduce(d);return d};bb.prototype.revert=function(b){return b};bb.prototype.reduce=function(b){b.drShiftTo(this.m.t-1,this.r2);b.t>this.m.t+1&&(b.t=this.m.t+
1,b.clamp());this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);for(this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);0>b.compareTo(this.r2);)b.dAddOffset(1,this.m.t+1);for(b.subTo(this.r2,b);0<=b.compareTo(this.m);)b.subTo(this.m,b)};bb.prototype.mulTo=function(b,d,e){b.multiplyTo(d,e);this.reduce(e)};bb.prototype.sqrTo=function(b,d){b.squareTo(d);this.reduce(d)};var H=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,
173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,
983,991,997],kc=67108864/H[H.length-1];q.prototype.chunkSize=function(b){return Math.floor(Math.LN2*this.DB/Math.log(b))};q.prototype.toRadix=function(b){null==b&&(b=10);if(0==this.signum()||2>b||36<b)return"0";var d=this.chunkSize(b),d=Math.pow(b,d),e=ea(d),g=E(),n=E(),k="";for(this.divRemTo(e,g,n);0<g.signum();)k=(d+n.intValue()).toString(b).substr(1)+k,g.divRemTo(e,g,n);return n.intValue().toString(b)+k};q.prototype.fromRadix=function(b,d){this.fromInt(0);null==d&&(d=10);for(var e=this.chunkSize(d),
g=Math.pow(d,e),n=!1,k=0,v=0,C=0;C<b.length;++C){var F=Ha(b,C);0>F?"-"==b.charAt(C)&&0==this.signum()&&(n=!0):(v=d*v+F,++k>=e&&(this.dMultiply(g),this.dAddOffset(v,0),v=k=0))}0<k&&(this.dMultiply(Math.pow(d,k)),this.dAddOffset(v,0));n&&q.ZERO.subTo(this,this)};q.prototype.fromNumber=function(b,d,e){if("number"==typeof d)if(2>b)this.fromInt(1);else for(this.fromNumber(b,e),this.testBit(b-1)||this.bitwiseTo(q.ONE.shiftLeft(b-1),M,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(d);)this.dAddOffset(2,
0),this.bitLength()>b&&this.subTo(q.ONE.shiftLeft(b-1),this);else{e=[];var g=b&7;e.length=(b>>3)+1;d.nextBytes(e);e[0]=0<g?e[0]&(1<<g)-1:0;this.fromString(e,256)}};q.prototype.bitwiseTo=function(b,d,e){var g,n,k=Math.min(b.t,this.t);for(g=0;g<k;++g)e[g]=d(this[g],b[g]);if(b.t<this.t){n=b.s&this.DM;for(g=k;g<this.t;++g)e[g]=d(this[g],n);e.t=this.t}else{n=this.s&this.DM;for(g=k;g<b.t;++g)e[g]=d(n,b[g]);e.t=b.t}e.s=d(this.s,b.s);e.clamp()};q.prototype.changeBit=function(b,d){var e=q.ONE.shiftLeft(b);
this.bitwiseTo(e,d,e);return e};q.prototype.addTo=function(b,d){for(var e=0,g=0,n=Math.min(b.t,this.t);e<n;)g+=this[e]+b[e],d[e++]=g&this.DM,g>>=this.DB;if(b.t<this.t){for(g+=b.s;e<this.t;)g+=this[e],d[e++]=g&this.DM,g>>=this.DB;g+=this.s}else{for(g+=this.s;e<b.t;)g+=b[e],d[e++]=g&this.DM,g>>=this.DB;g+=b.s}d.s=0>g?-1:0;0<g?d[e++]=g:-1>g&&(d[e++]=this.DV+g);d.t=e;d.clamp()};q.prototype.dMultiply=function(b){this[this.t]=this.am(0,b-1,this,0,0,this.t);++this.t;this.clamp()};q.prototype.dAddOffset=
function(b,d){if(0!=b){for(;this.t<=d;)this[this.t++]=0;for(this[d]+=b;this[d]>=this.DV;)this[d]-=this.DV,++d>=this.t&&(this[this.t++]=0),++this[d]}};q.prototype.multiplyLowerTo=function(b,d,e){var g=Math.min(this.t+b.t,d);e.s=0;for(e.t=g;0<g;)e[--g]=0;var n;for(n=e.t-this.t;g<n;++g)e[g+this.t]=this.am(0,b[g],e,g,0,this.t);for(n=Math.min(b.t,d);g<n;++g)this.am(0,b[g],e,g,0,d-g);e.clamp()};q.prototype.multiplyUpperTo=function(b,d,e){--d;var g=e.t=this.t+b.t-d;for(e.s=0;0<=--g;)e[g]=0;for(g=Math.max(d-
this.t,0);g<b.t;++g)e[this.t+g-d]=this.am(d-g,b[g],e,0,0,this.t+g-d);e.clamp();e.drShiftTo(1,e)};q.prototype.modInt=function(b){if(0>=b)return 0;var d=this.DV%b,e=0>this.s?b-1:0;if(0<this.t)if(0==d)e=this[0]%b;else for(var g=this.t-1;0<=g;--g)e=(d*e+this[g])%b;return e};q.prototype.millerRabin=function(b){var d=this.subtract(q.ONE),e=d.getLowestSetBit();if(0>=e)return!1;var g=d.shiftRight(e);b=b+1>>1;b>H.length&&(b=H.length);for(var n=E(),k=0;k<b;++k){n.fromInt(H[Math.floor(Math.random()*H.length)]);
var v=n.modPow(g,this);if(0!=v.compareTo(q.ONE)&&0!=v.compareTo(d)){for(var C=1;C++<e&&0!=v.compareTo(d);)if(v=v.modPowInt(2,this),0==v.compareTo(q.ONE))return!1;if(0!=v.compareTo(d))return!1}}return!0};q.prototype.clone=function(){var b=E();this.copyTo(b);return b};q.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]};q.prototype.byteValue=function(){return 0==
this.t?this.s:this[0]<<24>>24};q.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16};q.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this[0]?0:1};q.prototype.toByteArray=function(){var b=this.t,d=[];d[0]=this.s;var e=this.DB-b*this.DB%8,g,n=0;if(0<b--)for(e<this.DB&&(g=this[b]>>e)!=(this.s&this.DM)>>e&&(d[n++]=g|this.s<<this.DB-e);0<=b;)if(8>e?(g=(this[b]&(1<<e)-1)<<8-e,g|=this[--b]>>(e+=this.DB-8)):(g=this[b]>>(e-=8)&255,0>=e&&(e+=this.DB,--b)),0!=(g&
128)&&(g|=-256),0==n&&(this.s&128)!=(g&128)&&++n,0<n||g!=this.s)d[n++]=g;return d};q.prototype.equals=function(b){return 0==this.compareTo(b)};q.prototype.min=function(b){return 0>this.compareTo(b)?this:b};q.prototype.max=function(b){return 0<this.compareTo(b)?this:b};q.prototype.and=function(b){var d=E();this.bitwiseTo(b,ia,d);return d};q.prototype.or=function(b){var d=E();this.bitwiseTo(b,M,d);return d};q.prototype.xor=function(b){var d=E();this.bitwiseTo(b,V,d);return d};q.prototype.andNot=function(b){var d=
E();this.bitwiseTo(b,S,d);return d};q.prototype.not=function(){for(var b=E(),d=0;d<this.t;++d)b[d]=this.DM&~this[d];b.t=this.t;b.s=~this.s;return b};q.prototype.shiftLeft=function(b){var d=E();0>b?this.rShiftTo(-b,d):this.lShiftTo(b,d);return d};q.prototype.shiftRight=function(b){var d=E();0>b?this.lShiftTo(-b,d):this.rShiftTo(b,d);return d};q.prototype.getLowestSetBit=function(){for(var b=0;b<this.t;++b)if(0!=this[b]){var d=b*this.DB,b=this[b];if(0==b)b=-1;else{var e=0;0==(b&65535)&&(b>>=16,e+=16);
0==(b&255)&&(b>>=8,e+=8);0==(b&15)&&(b>>=4,e+=4);0==(b&3)&&(b>>=2,e+=2);0==(b&1)&&++e;b=e}return d+b}return 0>this.s?this.t*this.DB:-1};q.prototype.bitCount=function(){for(var b=0,d=this.s&this.DM,e=0;e<this.t;++e){for(var g=this[e]^d,n=0;0!=g;)g&=g-1,++n;b+=n}return b};q.prototype.testBit=function(b){var d=Math.floor(b/this.DB);return d>=this.t?0!=this.s:0!=(this[d]&1<<b%this.DB)};q.prototype.setBit=function(b){return this.changeBit(b,M)};q.prototype.clearBit=function(b){return this.changeBit(b,
S)};q.prototype.flipBit=function(b){return this.changeBit(b,V)};q.prototype.add=function(b){var d=E();this.addTo(b,d);return d};q.prototype.subtract=function(b){var d=E();this.subTo(b,d);return d};q.prototype.multiply=function(b){var d=E();this.multiplyTo(b,d);return d};q.prototype.divide=function(b){var d=E();this.divRemTo(b,d,null);return d};q.prototype.remainder=function(b){var d=E();this.divRemTo(b,null,d);return d};q.prototype.divideAndRemainder=function(b){var d=E(),e=E();this.divRemTo(b,d,
e);return[d,e]};q.prototype.modPow=function(b,d){var e=b.bitLength(),g,n=ea(1),J;if(0>=e)return n;g=18>e?1:48>e?3:144>e?4:768>e?5:6;J=8>e?new Pa(d):d.isEven()?new bb(d):new F(d);var v=[],C=3,q=g-1,cb=(1<<g)-1;v[1]=J.convert(this);if(1<g)for(e=E(),J.sqrTo(v[1],e);C<=cb;)v[C]=E(),J.mulTo(e,v[C-2],v[C]),C+=2;for(var H=b.t-1,M,ia=!0,L=E(),e=k(b[H])-1;0<=H;){e>=q?M=b[H]>>e-q&cb:(M=(b[H]&(1<<e+1)-1)<<q-e,0<H&&(M|=b[H-1]>>this.DB+e-q));for(C=g;0==(M&1);)M>>=1,--C;0>(e-=C)&&(e+=this.DB,--H);if(ia)v[M].copyTo(n),
ia=!1;else{for(;1<C;)J.sqrTo(n,L),J.sqrTo(L,n),C-=2;0<C?J.sqrTo(n,L):(C=n,n=L,L=C);J.mulTo(L,v[M],n)}for(;0<=H&&0==(b[H]&1<<e);)J.sqrTo(n,L),C=n,n=L,L=C,0>--e&&(e=this.DB-1,--H)}return J.revert(n)};q.prototype.modInverse=function(b){var d=b.isEven();if(this.isEven()&&d||0==b.signum())return q.ZERO;for(var e=b.clone(),g=this.clone(),n=ea(1),k=ea(0),v=ea(0),C=ea(1);0!=e.signum();){for(;e.isEven();)e.rShiftTo(1,e),d?(n.isEven()&&k.isEven()||(n.addTo(this,n),k.subTo(b,k)),n.rShiftTo(1,n)):k.isEven()||
k.subTo(b,k),k.rShiftTo(1,k);for(;g.isEven();)g.rShiftTo(1,g),d?(v.isEven()&&C.isEven()||(v.addTo(this,v),C.subTo(b,C)),v.rShiftTo(1,v)):C.isEven()||C.subTo(b,C),C.rShiftTo(1,C);0<=e.compareTo(g)?(e.subTo(g,e),d&&n.subTo(v,n),k.subTo(C,k)):(g.subTo(e,g),d&&v.subTo(n,v),C.subTo(k,C))}if(0!=g.compareTo(q.ONE))return q.ZERO;if(0<=C.compareTo(b))return C.subtract(b);if(0>C.signum())C.addTo(b,C);else return C;return 0>C.signum()?C.add(b):C};q.prototype.pow=function(b){return this.exp(b,new fa)};q.prototype.gcd=
function(b){var d=0>this.s?this.negate():this.clone();b=0>b.s?b.negate():b.clone();if(0>d.compareTo(b)){var e=d,d=b;b=e}var e=d.getLowestSetBit(),g=b.getLowestSetBit();if(0>g)return d;e<g&&(g=e);for(0<g&&(d.rShiftTo(g,d),b.rShiftTo(g,b));0<d.signum();)0<(e=d.getLowestSetBit())&&d.rShiftTo(e,d),0<(e=b.getLowestSetBit())&&b.rShiftTo(e,b),0<=d.compareTo(b)?(d.subTo(b,d),d.rShiftTo(1,d)):(b.subTo(d,b),b.rShiftTo(1,b));0<g&&b.lShiftTo(g,b);return b};q.prototype.isProbablePrime=function(b){var d,e=this.abs();
if(1==e.t&&e[0]<=H[H.length-1]){for(d=0;d<H.length;++d)if(e[0]==H[d])return!0;return!1}if(e.isEven())return!1;for(d=1;d<H.length;){for(var g=H[d],n=d+1;n<H.length&&g<kc;)g*=H[n++];for(g=e.modInt(g);d<n;)if(0==g%H[d++])return!1}return e.millerRabin(b)};q.prototype.square=function(){var b=E();this.squareTo(b);return b};q.prototype.IsNegative=function(){return-1==this.compareTo(q.ZERO)?!0:!1};q.op_Equality=function(b,d){return 0==b.compareTo(d)?!0:!1};q.op_Inequality=function(b,d){return 0!=b.compareTo(d)?
!0:!1};q.op_GreaterThan=function(b,d){return 0<b.compareTo(d)?!0:!1};q.op_LessThan=function(b,d){return 0>b.compareTo(d)?!0:!1};q.op_Addition=function(b,d){return(new q(b)).add(new q(d))};q.op_Subtraction=function(b,d){return(new q(b)).subtract(new q(d))};q.Int128Mul=function(b,d){return(new q(b)).multiply(new q(d))};q.op_Division=function(b,d){return b.divide(d)};q.prototype.ToDouble=function(){return parseFloat(this.toString())};X=function(b,d){var e;if("undefined"==typeof Object.getOwnPropertyNames)for(e in d.prototype){if("undefined"==
typeof b.prototype[e]||b.prototype[e]==Object.prototype[e])b.prototype[e]=d.prototype[e]}else for(var g=Object.getOwnPropertyNames(d.prototype),n=0;n<g.length;n++)"undefined"==typeof Object.getOwnPropertyDescriptor(b.prototype,g[n])&&Object.defineProperty(b.prototype,g[n],Object.getOwnPropertyDescriptor(d.prototype,g[n]));for(e in d)"undefined"==typeof b[e]&&(b[e]=d[e]);b.$baseCtor=d};g.Path=function(){return[]};g.Paths=function(){return[]};g.DoublePoint=function(){var b=arguments;this.Y=this.X=0;
1==b.length?(this.X=b[0].X,this.Y=b[0].Y):2==b.length&&(this.X=b[0],this.Y=b[1])};g.DoublePoint0=function(){this.Y=this.X=0};g.DoublePoint1=function(b){this.X=b.X;this.Y=b.Y};g.DoublePoint2=function(b,d){this.X=b;this.Y=d};g.PolyNode=function(){this.m_Parent=null;this.m_polygon=new g.Path;this.m_endtype=this.m_jointype=this.m_Index=0;this.m_Childs=[];this.IsOpen=!1};g.PolyNode.prototype.IsHoleNode=function(){for(var b=!0,d=this.m_Parent;null!==d;)b=!b,d=d.m_Parent;return b};g.PolyNode.prototype.ChildCount=
function(){return this.m_Childs.length};g.PolyNode.prototype.Contour=function(){return this.m_polygon};g.PolyNode.prototype.AddChild=function(b){var d=this.m_Childs.length;this.m_Childs.push(b);b.m_Parent=this;b.m_Index=d};g.PolyNode.prototype.GetNext=function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()};g.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+
1]};g.PolyNode.prototype.Childs=function(){return this.m_Childs};g.PolyNode.prototype.Parent=function(){return this.m_Parent};g.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()};g.PolyTree=function(){this.m_AllPolys=[];g.PolyNode.call(this)};g.PolyTree.prototype.Clear=function(){for(var b=0,d=this.m_AllPolys.length;b<d;b++)this.m_AllPolys[b]=null;this.m_AllPolys.length=0;this.m_Childs.length=0};g.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null};
g.PolyTree.prototype.Total=function(){var b=this.m_AllPolys.length;0<b&&this.m_Childs[0]!=this.m_AllPolys[0]&&b--;return b};X(g.PolyTree,g.PolyNode);g.Math_Abs_Int64=g.Math_Abs_Int32=g.Math_Abs_Double=function(b){return Math.abs(b)};g.Math_Max_Int32_Int32=function(b,d){return Math.max(b,d)};g.Cast_Int32=aa||Ua||ic?function(b){return b|0}:function(b){return~~b};g.Cast_Int64=L?function(b){return-2147483648>b||2147483647<b?0>b?Math.ceil(b):Math.floor(b):~~b}:Ub&&"function"==typeof Number.toInteger?function(b){return Number.toInteger(b)}:
Eb||hb?function(b){return parseInt(b,10)}:aa?function(b){return-2147483648>b||2147483647<b?0>b?Math.ceil(b):Math.floor(b):b|0}:function(b){return 0>b?Math.ceil(b):Math.floor(b)};g.Clear=function(b){b.length=0};g.PI=3.141592653589793;g.PI2=6.283185307179586;g.IntPoint=function(){var b=arguments,d=b.length;this.Y=this.X=0;g.use_xyz?(this.Z=0,3==d?(this.X=b[0],this.Y=b[1],this.Z=b[2]):2==d?(this.X=b[0],this.Y=b[1],this.Z=0):1==d?b[0]instanceof g.DoublePoint?(b=b[0],this.X=g.Clipper.Round(b.X),this.Y=
g.Clipper.Round(b.Y),this.Z=0):(b=b[0],"undefined"==typeof b.Z&&(b.Z=0),this.X=b.X,this.Y=b.Y,this.Z=b.Z):this.Z=this.Y=this.X=0):2==d?(this.X=b[0],this.Y=b[1]):1==d?b[0]instanceof g.DoublePoint?(b=b[0],this.X=g.Clipper.Round(b.X),this.Y=g.Clipper.Round(b.Y)):(b=b[0],this.X=b.X,this.Y=b.Y):this.Y=this.X=0};g.IntPoint.op_Equality=function(b,d){return b.X==d.X&&b.Y==d.Y};g.IntPoint.op_Inequality=function(b,d){return b.X!=d.X||b.Y!=d.Y};g.use_xyz?(g.IntPoint0=function(){this.Z=this.Y=this.X=0},g.IntPoint1=
function(b){this.X=b.X;this.Y=b.Y;this.Z=b.Z},g.IntPoint1dp=function(b){this.X=g.Clipper.Round(b.X);this.Y=g.Clipper.Round(b.Y);this.Z=0},g.IntPoint2=function(b,d){this.X=b;this.Y=d;this.Z=0},g.IntPoint3=function(b,d,e){this.X=b;this.Y=d;this.Z=e}):(g.IntPoint0=function(){this.Y=this.X=0},g.IntPoint1=function(b){this.X=b.X;this.Y=b.Y},g.IntPoint1dp=function(b){this.X=g.Clipper.Round(b.X);this.Y=g.Clipper.Round(b.Y)},g.IntPoint2=function(b,d){this.X=b;this.Y=d});g.IntRect=function(){var b=arguments,
d=b.length;4==d?(this.left=b[0],this.top=b[1],this.right=b[2],this.bottom=b[3]):1==d?(this.left=b[0].left,this.top=b[0].top,this.right=b[0].right,this.bottom=b[0].bottom):this.bottom=this.right=this.top=this.left=0};g.IntRect0=function(){this.bottom=this.right=this.top=this.left=0};g.IntRect1=function(b){this.left=b.left;this.top=b.top;this.right=b.right;this.bottom=b.bottom};g.IntRect4=function(b,d,e,g){this.left=b;this.top=d;this.right=e;this.bottom=g};g.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,
ctXor:3};g.PolyType={ptSubject:0,ptClip:1};g.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3};g.JoinType={jtSquare:0,jtRound:1,jtMiter:2};g.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4};g.EdgeSide={esLeft:0,esRight:1};g.Direction={dRightToLeft:0,dLeftToRight:1};g.TEdge=function(){this.Bot=new g.IntPoint;this.Curr=new g.IntPoint;this.Top=new g.IntPoint;this.Delta=new g.IntPoint;this.Dx=0;this.PolyTyp=g.PolyType.ptSubject;this.Side=g.EdgeSide.esLeft;
this.OutIdx=this.WindCnt2=this.WindCnt=this.WindDelta=0;this.PrevInSEL=this.NextInSEL=this.PrevInAEL=this.NextInAEL=this.NextInLML=this.Prev=this.Next=null};g.IntersectNode=function(){this.Edge2=this.Edge1=null;this.Pt=new g.IntPoint};g.MyIntersectNodeSort=function(){};g.MyIntersectNodeSort.Compare=function(b,d){var e=d.Pt.Y-b.Pt.Y;return 0<e?1:0>e?-1:0};g.LocalMinima=function(){this.Y=0;this.Next=this.RightBound=this.LeftBound=null};g.Scanbeam=function(){this.Y=0;this.Next=null};g.OutRec=function(){this.Idx=
0;this.IsOpen=this.IsHole=!1;this.PolyNode=this.BottomPt=this.Pts=this.FirstLeft=null};g.OutPt=function(){this.Idx=0;this.Pt=new g.IntPoint;this.Prev=this.Next=null};g.Join=function(){this.OutPt2=this.OutPt1=null;this.OffPt=new g.IntPoint};g.ClipperBase=function(){this.m_CurrentLM=this.m_MinimaList=null;this.m_edges=[];this.PreserveCollinear=this.m_HasOpenPaths=this.m_UseFullRange=!1;this.m_CurrentLM=this.m_MinimaList=null;this.m_HasOpenPaths=this.m_UseFullRange=!1};g.ClipperBase.horizontal=-9007199254740992;
g.ClipperBase.Skip=-2;g.ClipperBase.Unassigned=-1;g.ClipperBase.tolerance=1E-20;g.ClipperBase.loRange=47453132;g.ClipperBase.hiRange=0xfffffffffffff;g.ClipperBase.near_zero=function(b){return b>-g.ClipperBase.tolerance&&b<g.ClipperBase.tolerance};g.ClipperBase.IsHorizontal=function(b){return 0===b.Delta.Y};g.ClipperBase.prototype.PointIsVertex=function(b,d){var e=d;do{if(g.IntPoint.op_Equality(e.Pt,b))return!0;e=e.Next}while(e!=d);return!1};g.ClipperBase.prototype.PointOnLineSegment=function(b,d,
e,g){return g?b.X==d.X&&b.Y==d.Y||b.X==e.X&&b.Y==e.Y||b.X>d.X==b.X<e.X&&b.Y>d.Y==b.Y<e.Y&&q.op_Equality(q.Int128Mul(b.X-d.X,e.Y-d.Y),q.Int128Mul(e.X-d.X,b.Y-d.Y)):b.X==d.X&&b.Y==d.Y||b.X==e.X&&b.Y==e.Y||b.X>d.X==b.X<e.X&&b.Y>d.Y==b.Y<e.Y&&(b.X-d.X)*(e.Y-d.Y)==(e.X-d.X)*(b.Y-d.Y)};g.ClipperBase.prototype.PointOnPolygon=function(b,d,e){for(var g=d;;){if(this.PointOnLineSegment(b,g.Pt,g.Next.Pt,e))return!0;g=g.Next;if(g==d)break}return!1};g.ClipperBase.prototype.SlopesEqual=g.ClipperBase.SlopesEqual=
function(){var b=arguments,d=b.length,e,r,n;if(3==d)return d=b[0],e=b[1],b[2]?q.op_Equality(q.Int128Mul(d.Delta.Y,e.Delta.X),q.Int128Mul(d.Delta.X,e.Delta.Y)):g.Cast_Int64(d.Delta.Y*e.Delta.X)==g.Cast_Int64(d.Delta.X*e.Delta.Y);if(4==d)return d=b[0],e=b[1],r=b[2],b[3]?q.op_Equality(q.Int128Mul(d.Y-e.Y,e.X-r.X),q.Int128Mul(d.X-e.X,e.Y-r.Y)):0===g.Cast_Int64((d.Y-e.Y)*(e.X-r.X))-g.Cast_Int64((d.X-e.X)*(e.Y-r.Y));d=b[0];e=b[1];r=b[2];n=b[3];return b[4]?q.op_Equality(q.Int128Mul(d.Y-e.Y,r.X-n.X),q.Int128Mul(d.X-
e.X,r.Y-n.Y)):0===g.Cast_Int64((d.Y-e.Y)*(r.X-n.X))-g.Cast_Int64((d.X-e.X)*(r.Y-n.Y))};g.ClipperBase.SlopesEqual3=function(b,d,e){return e?q.op_Equality(q.Int128Mul(b.Delta.Y,d.Delta.X),q.Int128Mul(b.Delta.X,d.Delta.Y)):g.Cast_Int64(b.Delta.Y*d.Delta.X)==g.Cast_Int64(b.Delta.X*d.Delta.Y)};g.ClipperBase.SlopesEqual4=function(b,d,e,r){return r?q.op_Equality(q.Int128Mul(b.Y-d.Y,d.X-e.X),q.Int128Mul(b.X-d.X,d.Y-e.Y)):0===g.Cast_Int64((b.Y-d.Y)*(d.X-e.X))-g.Cast_Int64((b.X-d.X)*(d.Y-e.Y))};g.ClipperBase.SlopesEqual5=
function(b,d,e,r,n){return n?q.op_Equality(q.Int128Mul(b.Y-d.Y,e.X-r.X),q.Int128Mul(b.X-d.X,e.Y-r.Y)):0===g.Cast_Int64((b.Y-d.Y)*(e.X-r.X))-g.Cast_Int64((b.X-d.X)*(e.Y-r.Y))};g.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var b=0,d=this.m_edges.length;b<d;++b){for(var e=0,r=this.m_edges[b].length;e<r;++e)this.m_edges[b][e]=null;g.Clear(this.m_edges[b])}g.Clear(this.m_edges);this.m_HasOpenPaths=this.m_UseFullRange=!1};g.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==
this.m_MinimaList;){var b=this.m_MinimaList.Next;this.m_MinimaList=null;this.m_MinimaList=b}this.m_CurrentLM=null};g.ClipperBase.prototype.RangeTest=function(b,d){if(d.Value)(b.X>g.ClipperBase.hiRange||b.Y>g.ClipperBase.hiRange||-b.X>g.ClipperBase.hiRange||-b.Y>g.ClipperBase.hiRange)&&g.Error("Coordinate outside allowed range in RangeTest().");else if(b.X>g.ClipperBase.loRange||b.Y>g.ClipperBase.loRange||-b.X>g.ClipperBase.loRange||-b.Y>g.ClipperBase.loRange)d.Value=!0,this.RangeTest(b,d)};g.ClipperBase.prototype.InitEdge=
function(b,d,e,r){b.Next=d;b.Prev=e;b.Curr.X=r.X;b.Curr.Y=r.Y;g.use_xyz&&(b.Curr.Z=r.Z);b.OutIdx=-1};g.ClipperBase.prototype.InitEdge2=function(b,d){b.Curr.Y>=b.Next.Curr.Y?(b.Bot.X=b.Curr.X,b.Bot.Y=b.Curr.Y,g.use_xyz&&(b.Bot.Z=b.Curr.Z),b.Top.X=b.Next.Curr.X,b.Top.Y=b.Next.Curr.Y,g.use_xyz&&(b.Top.Z=b.Next.Curr.Z)):(b.Top.X=b.Curr.X,b.Top.Y=b.Curr.Y,g.use_xyz&&(b.Top.Z=b.Curr.Z),b.Bot.X=b.Next.Curr.X,b.Bot.Y=b.Next.Curr.Y,g.use_xyz&&(b.Bot.Z=b.Next.Curr.Z));this.SetDx(b);b.PolyTyp=d};g.ClipperBase.prototype.FindNextLocMin=
function(b){for(var d;;){for(;g.IntPoint.op_Inequality(b.Bot,b.Prev.Bot)||g.IntPoint.op_Equality(b.Curr,b.Top);)b=b.Next;if(b.Dx!=g.ClipperBase.horizontal&&b.Prev.Dx!=g.ClipperBase.horizontal)break;for(;b.Prev.Dx==g.ClipperBase.horizontal;)b=b.Prev;for(d=b;b.Dx==g.ClipperBase.horizontal;)b=b.Next;if(b.Top.Y!=b.Prev.Bot.Y){d.Prev.Bot.X<b.Bot.X&&(b=d);break}}return b};g.ClipperBase.prototype.ProcessBound=function(b,d){var e,r=b,n;if(r.OutIdx==g.ClipperBase.Skip){b=r;if(d){for(;b.Top.Y==b.Next.Bot.Y;)b=
b.Next;for(;b!=r&&b.Dx==g.ClipperBase.horizontal;)b=b.Prev}else{for(;b.Top.Y==b.Prev.Bot.Y;)b=b.Prev;for(;b!=r&&b.Dx==g.ClipperBase.horizontal;)b=b.Next}b==r?r=d?b.Next:b.Prev:(b=d?r.Next:r.Prev,e=new g.LocalMinima,e.Next=null,e.Y=b.Bot.Y,e.LeftBound=null,e.RightBound=b,b.WindDelta=0,r=this.ProcessBound(b,d),this.InsertLocalMinima(e));return r}b.Dx==g.ClipperBase.horizontal&&(e=d?b.Prev:b.Next,e.OutIdx!=g.ClipperBase.Skip&&(e.Dx==g.ClipperBase.horizontal?e.Bot.X!=b.Bot.X&&e.Top.X!=b.Bot.X&&this.ReverseHorizontal(b):
e.Bot.X!=b.Bot.X&&this.ReverseHorizontal(b)));e=b;if(d){for(;r.Top.Y==r.Next.Bot.Y&&r.Next.OutIdx!=g.ClipperBase.Skip;)r=r.Next;if(r.Dx==g.ClipperBase.horizontal&&r.Next.OutIdx!=g.ClipperBase.Skip){for(n=r;n.Prev.Dx==g.ClipperBase.horizontal;)n=n.Prev;n.Prev.Top.X==r.Next.Top.X?d||(r=n.Prev):n.Prev.Top.X>r.Next.Top.X&&(r=n.Prev)}for(;b!=r;)b.NextInLML=b.Next,b.Dx==g.ClipperBase.horizontal&&b!=e&&b.Bot.X!=b.Prev.Top.X&&this.ReverseHorizontal(b),b=b.Next;b.Dx==g.ClipperBase.horizontal&&b!=e&&b.Bot.X!=
b.Prev.Top.X&&this.ReverseHorizontal(b);r=r.Next}else{for(;r.Top.Y==r.Prev.Bot.Y&&r.Prev.OutIdx!=g.ClipperBase.Skip;)r=r.Prev;if(r.Dx==g.ClipperBase.horizontal&&r.Prev.OutIdx!=g.ClipperBase.Skip){for(n=r;n.Next.Dx==g.ClipperBase.horizontal;)n=n.Next;n.Next.Top.X==r.Prev.Top.X?d||(r=n.Next):n.Next.Top.X>r.Prev.Top.X&&(r=n.Next)}for(;b!=r;)b.NextInLML=b.Prev,b.Dx==g.ClipperBase.horizontal&&b!=e&&b.Bot.X!=b.Next.Top.X&&this.ReverseHorizontal(b),b=b.Prev;b.Dx==g.ClipperBase.horizontal&&b!=e&&b.Bot.X!=
b.Next.Top.X&&this.ReverseHorizontal(b);r=r.Prev}return r};g.ClipperBase.prototype.AddPath=function(b,d,e){g.use_lines?e||d!=g.PolyType.ptClip||g.Error("AddPath: Open paths must be subject."):e||g.Error("AddPath: Open paths have been disabled.");var r=b.length-1;if(e)for(;0<r&&g.IntPoint.op_Equality(b[r],b[0]);)--r;for(;0<r&&g.IntPoint.op_Equality(b[r],b[r-1]);)--r;if(e&&2>r||!e&&1>r)return!1;for(var n=[],k=0;k<=r;k++)n.push(new g.TEdge);var v=!0;n[1].Curr.X=b[1].X;n[1].Curr.Y=b[1].Y;g.use_xyz&&(n[1].Curr.Z=
b[1].Z);var C={Value:this.m_UseFullRange};this.RangeTest(b[0],C);this.m_UseFullRange=C.Value;C.Value=this.m_UseFullRange;this.RangeTest(b[r],C);this.m_UseFullRange=C.Value;this.InitEdge(n[0],n[1],n[r],b[0]);this.InitEdge(n[r],n[0],n[r-1],b[r]);for(k=r-1;1<=k;--k)C.Value=this.m_UseFullRange,this.RangeTest(b[k],C),this.m_UseFullRange=C.Value,this.InitEdge(n[k],n[k+1],n[k-1],b[k]);for(k=b=r=n[0];;)if(b.Curr!=b.Next.Curr||!e&&b.Next==r){if(b.Prev==b.Next)break;else if(e&&g.ClipperBase.SlopesEqual(b.Prev.Curr,
b.Curr,b.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(b.Prev.Curr,b.Curr,b.Next.Curr))){b==r&&(r=b.Next);b=this.RemoveEdge(b);k=b=b.Prev;continue}b=b.Next;if(b==k||!e&&b.Next==r)break}else{if(b==b.Next)break;b==r&&(r=b.Next);k=b=this.RemoveEdge(b)}if(!e&&b==b.Next||e&&b.Prev==b.Next)return!1;e||(this.m_HasOpenPaths=!0,r.Prev.OutIdx=g.ClipperBase.Skip);b=r;do this.InitEdge2(b,d),b=b.Next,v&&b.Curr.Y!=r.Curr.Y&&(v=!1);while(b!=r);if(v){if(e)return!1;b.Prev.OutIdx=
g.ClipperBase.Skip;b.Prev.Bot.X<b.Prev.Top.X&&this.ReverseHorizontal(b.Prev);d=new g.LocalMinima;d.Next=null;d.Y=b.Bot.Y;d.LeftBound=null;d.RightBound=b;d.RightBound.Side=g.EdgeSide.esRight;for(d.RightBound.WindDelta=0;b.Next.OutIdx!=g.ClipperBase.Skip;)b.NextInLML=b.Next,b.Bot.X!=b.Prev.Top.X&&this.ReverseHorizontal(b),b=b.Next;this.InsertLocalMinima(d);this.m_edges.push(n);return!0}this.m_edges.push(n);v=null;for(g.IntPoint.op_Equality(b.Prev.Bot,b.Prev.Top)&&(b=b.Next);;){b=this.FindNextLocMin(b);
if(b==v)break;else null==v&&(v=b);d=new g.LocalMinima;d.Next=null;d.Y=b.Bot.Y;b.Dx<b.Prev.Dx?(d.LeftBound=b.Prev,d.RightBound=b,n=!1):(d.LeftBound=b,d.RightBound=b.Prev,n=!0);d.LeftBound.Side=g.EdgeSide.esLeft;d.RightBound.Side=g.EdgeSide.esRight;d.LeftBound.WindDelta=e?d.LeftBound.Next==d.RightBound?-1:1:0;d.RightBound.WindDelta=-d.LeftBound.WindDelta;b=this.ProcessBound(d.LeftBound,n);b.OutIdx==g.ClipperBase.Skip&&(b=this.ProcessBound(b,n));r=this.ProcessBound(d.RightBound,!n);r.OutIdx==g.ClipperBase.Skip&&
(r=this.ProcessBound(r,!n));d.LeftBound.OutIdx==g.ClipperBase.Skip?d.LeftBound=null:d.RightBound.OutIdx==g.ClipperBase.Skip&&(d.RightBound=null);this.InsertLocalMinima(d);n||(b=r)}return!0};g.ClipperBase.prototype.AddPaths=function(b,d,e){for(var g=!1,n=0,k=b.length;n<k;++n)this.AddPath(b[n],d,e)&&(g=!0);return g};g.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(b,d,e){return g.IntPoint.op_Equality(b,e)||g.IntPoint.op_Equality(b,d)||g.IntPoint.op_Equality(e,d)?!1:b.X!=e.X?d.X>b.X==d.X<e.X:d.Y>
b.Y==d.Y<e.Y};g.ClipperBase.prototype.RemoveEdge=function(b){b.Prev.Next=b.Next;b.Next.Prev=b.Prev;var d=b.Next;b.Prev=null;return d};g.ClipperBase.prototype.SetDx=function(b){b.Delta.X=b.Top.X-b.Bot.X;b.Delta.Y=b.Top.Y-b.Bot.Y;b.Dx=0===b.Delta.Y?g.ClipperBase.horizontal:b.Delta.X/b.Delta.Y};g.ClipperBase.prototype.InsertLocalMinima=function(b){if(null===this.m_MinimaList)this.m_MinimaList=b;else if(b.Y>=this.m_MinimaList.Y)b.Next=this.m_MinimaList,this.m_MinimaList=b;else{for(var d=this.m_MinimaList;null!==
d.Next&&b.Y<d.Next.Y;)d=d.Next;b.Next=d.Next;d.Next=b}};g.ClipperBase.prototype.PopLocalMinima=function(){null!==this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.Next)};g.ClipperBase.prototype.ReverseHorizontal=function(b){var d=b.Top.X;b.Top.X=b.Bot.X;b.Bot.X=d;g.use_xyz&&(d=b.Top.Z,b.Top.Z=b.Bot.Z,b.Bot.Z=d)};g.ClipperBase.prototype.Reset=function(){this.m_CurrentLM=this.m_MinimaList;if(null!=this.m_CurrentLM)for(var b=this.m_MinimaList;null!=b;){var d=b.LeftBound;null!=d&&(d.Curr.X=d.Bot.X,
d.Curr.Y=d.Bot.Y,g.use_xyz&&(d.Curr.Z=d.Bot.Z),d.Side=g.EdgeSide.esLeft,d.OutIdx=g.ClipperBase.Unassigned);d=b.RightBound;null!=d&&(d.Curr.X=d.Bot.X,d.Curr.Y=d.Bot.Y,g.use_xyz&&(d.Curr.Z=d.Bot.Z),d.Side=g.EdgeSide.esRight,d.OutIdx=g.ClipperBase.Unassigned);b=b.Next}};g.Clipper=function(b){"undefined"==typeof b&&(b=0);this.m_PolyOuts=null;this.m_ClipType=g.ClipType.ctIntersection;this.m_IntersectNodeComparer=this.m_IntersectList=this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_ExecuteLocked=
!1;this.m_SubjFillType=this.m_ClipFillType=g.PolyFillType.pftEvenOdd;this.m_GhostJoins=this.m_Joins=null;this.StrictlySimple=this.ReverseSolution=this.m_UsingPolyTree=!1;g.ClipperBase.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_IntersectList=[];this.m_IntersectNodeComparer=g.MyIntersectNodeSort.Compare;this.m_UsingPolyTree=this.m_ExecuteLocked=!1;this.m_PolyOuts=[];this.m_Joins=[];this.m_GhostJoins=[];this.ReverseSolution=0!==(1&b);this.StrictlySimple=0!==(2&b);this.PreserveCollinear=
0!==(4&b);g.use_xyz&&(this.ZFillFunction=null)};g.Clipper.ioReverseSolution=1;g.Clipper.ioStrictlySimple=2;g.Clipper.ioPreserveCollinear=4;g.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),g.ClipperBase.prototype.Clear.call(this))};g.Clipper.prototype.DisposeScanbeamList=function(){for(;null!==this.m_Scanbeam;){var b=this.m_Scanbeam.Next;this.m_Scanbeam=null;this.m_Scanbeam=b}};g.Clipper.prototype.Reset=function(){g.ClipperBase.prototype.Reset.call(this);this.m_SortedEdges=
this.m_ActiveEdges=this.m_Scanbeam=null;for(var b=this.m_MinimaList;null!==b;)this.InsertScanbeam(b.Y),b=b.Next};g.Clipper.prototype.InsertScanbeam=function(b){if(null===this.m_Scanbeam)this.m_Scanbeam=new g.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=b;else if(b>this.m_Scanbeam.Y){var d=new g.Scanbeam;d.Y=b;d.Next=this.m_Scanbeam;this.m_Scanbeam=d}else{for(var e=this.m_Scanbeam;null!==e.Next&&b<=e.Next.Y;)e=e.Next;b!=e.Y&&(d=new g.Scanbeam,d.Y=b,d.Next=e.Next,e.Next=d)}};g.Clipper.prototype.Execute=
function(){var b=arguments,d=b.length,e=b[1]instanceof g.PolyTree;if(4!=d||e){if(4==d&&e){var d=b[0],r=b[1],e=b[2],b=b[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;this.m_SubjFillType=e;this.m_ClipFillType=b;this.m_ClipType=d;this.m_UsingPolyTree=!0;try{(n=this.ExecuteInternal())&&this.BuildResult2(r)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return n}if(2==d&&!e||2==d&&e)return d=b[0],r=b[1],this.Execute(d,r,g.PolyFillType.pftEvenOdd,g.PolyFillType.pftEvenOdd)}else{d=
b[0];r=b[1];e=b[2];b=b[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&g.Error("Error: PolyTree struct is need for open path clipping.");this.m_ExecuteLocked=!0;g.Clear(r);this.m_SubjFillType=e;this.m_ClipFillType=b;this.m_ClipType=d;this.m_UsingPolyTree=!1;try{var n=this.ExecuteInternal();n&&this.BuildResult(r)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return n}};g.Clipper.prototype.FixHoleLinkage=function(b){if(null!==b.FirstLeft&&(b.IsHole==b.FirstLeft.IsHole||null===b.FirstLeft.Pts)){for(var d=
b.FirstLeft;null!==d&&(d.IsHole==b.IsHole||null===d.Pts);)d=d.FirstLeft;b.FirstLeft=d}};g.Clipper.prototype.ExecuteInternal=function(){try{this.Reset();if(null===this.m_CurrentLM)return!1;var b=this.PopScanbeam();do{this.InsertLocalMinimaIntoAEL(b);g.Clear(this.m_GhostJoins);this.ProcessHorizontals(!1);if(null===this.m_Scanbeam)break;var d=this.PopScanbeam();if(!this.ProcessIntersections(d))return!1;this.ProcessEdgesAtTopOfScanbeam(d);b=d}while(null!==this.m_Scanbeam||null!==this.m_CurrentLM);for(var b=
0,e=this.m_PolyOuts.length;b<e;b++){var r=this.m_PolyOuts[b];null===r.Pts||r.IsOpen||(r.IsHole^this.ReverseSolution)==0<this.Area(r)&&this.ReversePolyPtLinks(r.Pts)}this.JoinCommonEdges();b=0;for(e=this.m_PolyOuts.length;b<e;b++)r=this.m_PolyOuts[b],null===r.Pts||r.IsOpen||this.FixupOutPolygon(r);this.StrictlySimple&&this.DoSimplePolygons();return!0}finally{g.Clear(this.m_Joins),g.Clear(this.m_GhostJoins)}};g.Clipper.prototype.PopScanbeam=function(){var b=this.m_Scanbeam.Y;this.m_Scanbeam=this.m_Scanbeam.Next;
return b};g.Clipper.prototype.DisposeAllPolyPts=function(){for(var b=0,d=this.m_PolyOuts.length;b<d;++b)this.DisposeOutRec(b);g.Clear(this.m_PolyOuts)};g.Clipper.prototype.DisposeOutRec=function(b){this.m_PolyOuts[b].Pts=null;this.m_PolyOuts[b]=null};g.Clipper.prototype.AddJoin=function(b,d,e){var r=new g.Join;r.OutPt1=b;r.OutPt2=d;r.OffPt.X=e.X;r.OffPt.Y=e.Y;g.use_xyz&&(r.OffPt.Z=e.Z);this.m_Joins.push(r)};g.Clipper.prototype.AddGhostJoin=function(b,d){var e=new g.Join;e.OutPt1=b;e.OffPt.X=d.X;e.OffPt.Y=
d.Y;g.use_xyz&&(e.OffPt.Z=d.Z);this.m_GhostJoins.push(e)};g.Clipper.prototype.SetZ=function(b,d,e){null!==this.ZFillFunction&&0==b.Z&&null!==this.ZFillFunction&&(g.IntPoint.op_Equality(b,d.Bot)?b.Z=d.Bot.Z:g.IntPoint.op_Equality(b,d.Top)?b.Z=d.Top.Z:g.IntPoint.op_Equality(b,e.Bot)?b.Z=e.Bot.Z:g.IntPoint.op_Equality(b,e.Top)?b.Z=e.Top.Z:this.ZFillFunction(d.Bot,d.Top,e.Bot,e.Top,b))};g.Clipper.prototype.InsertLocalMinimaIntoAEL=function(b){for(;null!==this.m_CurrentLM&&this.m_CurrentLM.Y==b;){var d=
this.m_CurrentLM.LeftBound,e=this.m_CurrentLM.RightBound;this.PopLocalMinima();var r=null;null===d?(this.InsertEdgeIntoAEL(e,null),this.SetWindingCount(e),this.IsContributing(e)&&(r=this.AddOutPt(e,e.Bot))):(null==e?(this.InsertEdgeIntoAEL(d,null),this.SetWindingCount(d),this.IsContributing(d)&&(r=this.AddOutPt(d,d.Bot))):(this.InsertEdgeIntoAEL(d,null),this.InsertEdgeIntoAEL(e,d),this.SetWindingCount(d),e.WindCnt=d.WindCnt,e.WindCnt2=d.WindCnt2,this.IsContributing(d)&&(r=this.AddLocalMinPoly(d,e,
d.Bot))),this.InsertScanbeam(d.Top.Y));null!=e&&(g.ClipperBase.IsHorizontal(e)?this.AddEdgeToSEL(e):this.InsertScanbeam(e.Top.Y));if(null!=d&&null!=e){if(null!==r&&g.ClipperBase.IsHorizontal(e)&&0<this.m_GhostJoins.length&&0!==e.WindDelta)for(var n=0,k=this.m_GhostJoins.length;n<k;n++){var v=this.m_GhostJoins[n];this.HorzSegmentsOverlap(v.OutPt1.Pt.X,v.OffPt.X,e.Bot.X,e.Top.X)&&this.AddJoin(v.OutPt1,r,v.OffPt)}0<=d.OutIdx&&null!==d.PrevInAEL&&d.PrevInAEL.Curr.X==d.Bot.X&&0<=d.PrevInAEL.OutIdx&&g.ClipperBase.SlopesEqual(d.PrevInAEL,
d,this.m_UseFullRange)&&0!==d.WindDelta&&0!==d.PrevInAEL.WindDelta&&(n=this.AddOutPt(d.PrevInAEL,d.Bot),this.AddJoin(r,n,d.Top));if(d.NextInAEL!=e&&(0<=e.OutIdx&&0<=e.PrevInAEL.OutIdx&&g.ClipperBase.SlopesEqual(e.PrevInAEL,e,this.m_UseFullRange)&&0!==e.WindDelta&&0!==e.PrevInAEL.WindDelta&&(n=this.AddOutPt(e.PrevInAEL,e.Bot),this.AddJoin(r,n,e.Top)),r=d.NextInAEL,null!==r))for(;r!=e;)this.IntersectEdges(e,r,d.Curr,!1),r=r.NextInAEL}}};g.Clipper.prototype.InsertEdgeIntoAEL=function(b,d){if(null===
this.m_ActiveEdges)b.PrevInAEL=null,b.NextInAEL=null,this.m_ActiveEdges=b;else if(null===d&&this.E2InsertsBeforeE1(this.m_ActiveEdges,b))b.PrevInAEL=null,b.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges=this.m_ActiveEdges.PrevInAEL=b;else{for(null===d&&(d=this.m_ActiveEdges);null!==d.NextInAEL&&!this.E2InsertsBeforeE1(d.NextInAEL,b);)d=d.NextInAEL;b.NextInAEL=d.NextInAEL;null!==d.NextInAEL&&(d.NextInAEL.PrevInAEL=b);b.PrevInAEL=d;d.NextInAEL=b}};g.Clipper.prototype.E2InsertsBeforeE1=function(b,d){return d.Curr.X==
b.Curr.X?d.Top.Y>b.Top.Y?d.Top.X<g.Clipper.TopX(b,d.Top.Y):b.Top.X>g.Clipper.TopX(d,b.Top.Y):d.Curr.X<b.Curr.X};g.Clipper.prototype.IsEvenOddFillType=function(b){return b.PolyTyp==g.PolyType.ptSubject?this.m_SubjFillType==g.PolyFillType.pftEvenOdd:this.m_ClipFillType==g.PolyFillType.pftEvenOdd};g.Clipper.prototype.IsEvenOddAltFillType=function(b){return b.PolyTyp==g.PolyType.ptSubject?this.m_ClipFillType==g.PolyFillType.pftEvenOdd:this.m_SubjFillType==g.PolyFillType.pftEvenOdd};g.Clipper.prototype.IsContributing=
function(b){var d,e;b.PolyTyp==g.PolyType.ptSubject?(d=this.m_SubjFillType,e=this.m_ClipFillType):(d=this.m_ClipFillType,e=this.m_SubjFillType);switch(d){case g.PolyFillType.pftEvenOdd:if(0===b.WindDelta&&1!=b.WindCnt)return!1;break;case g.PolyFillType.pftNonZero:if(1!=Math.abs(b.WindCnt))return!1;break;case g.PolyFillType.pftPositive:if(1!=b.WindCnt)return!1;break;default:if(-1!=b.WindCnt)return!1}switch(this.m_ClipType){case g.ClipType.ctIntersection:switch(e){case g.PolyFillType.pftEvenOdd:case g.PolyFillType.pftNonZero:return 0!==
b.WindCnt2;case g.PolyFillType.pftPositive:return 0<b.WindCnt2;default:return 0>b.WindCnt2}case g.ClipType.ctUnion:switch(e){case g.PolyFillType.pftEvenOdd:case g.PolyFillType.pftNonZero:return 0===b.WindCnt2;case g.PolyFillType.pftPositive:return 0>=b.WindCnt2;default:return 0<=b.WindCnt2}case g.ClipType.ctDifference:if(b.PolyTyp==g.PolyType.ptSubject)switch(e){case g.PolyFillType.pftEvenOdd:case g.PolyFillType.pftNonZero:return 0===b.WindCnt2;case g.PolyFillType.pftPositive:return 0>=b.WindCnt2;
default:return 0<=b.WindCnt2}else switch(e){case g.PolyFillType.pftEvenOdd:case g.PolyFillType.pftNonZero:return 0!==b.WindCnt2;case g.PolyFillType.pftPositive:return 0<b.WindCnt2;default:return 0>b.WindCnt2}case g.ClipType.ctXor:if(0===b.WindDelta)switch(e){case g.PolyFillType.pftEvenOdd:case g.PolyFillType.pftNonZero:return 0===b.WindCnt2;case g.PolyFillType.pftPositive:return 0>=b.WindCnt2;default:return 0<=b.WindCnt2}}return!0};g.Clipper.prototype.SetWindingCount=function(b){for(var d=b.PrevInAEL;null!==
d&&(d.PolyTyp!=b.PolyTyp||0===d.WindDelta);)d=d.PrevInAEL;if(null===d)b.WindCnt=0===b.WindDelta?1:b.WindDelta,b.WindCnt2=0,d=this.m_ActiveEdges;else{if(0===b.WindDelta&&this.m_ClipType!=g.ClipType.ctUnion)b.WindCnt=1;else if(this.IsEvenOddFillType(b))if(0===b.WindDelta){for(var e=!0,r=d.PrevInAEL;null!==r;)r.PolyTyp==d.PolyTyp&&0!==r.WindDelta&&(e=!e),r=r.PrevInAEL;b.WindCnt=e?0:1}else b.WindCnt=b.WindDelta;else b.WindCnt=0>d.WindCnt*d.WindDelta?1<Math.abs(d.WindCnt)?0>d.WindDelta*b.WindDelta?d.WindCnt:
d.WindCnt+b.WindDelta:0===b.WindDelta?1:b.WindDelta:0===b.WindDelta?0>d.WindCnt?d.WindCnt-1:d.WindCnt+1:0>d.WindDelta*b.WindDelta?d.WindCnt:d.WindCnt+b.WindDelta;b.WindCnt2=d.WindCnt2;d=d.NextInAEL}if(this.IsEvenOddAltFillType(b))for(;d!=b;)0!==d.WindDelta&&(b.WindCnt2=0===b.WindCnt2?1:0),d=d.NextInAEL;else for(;d!=b;)b.WindCnt2+=d.WindDelta,d=d.NextInAEL};g.Clipper.prototype.AddEdgeToSEL=function(b){null===this.m_SortedEdges?(this.m_SortedEdges=b,b.PrevInSEL=null,b.NextInSEL=null):(b.NextInSEL=this.m_SortedEdges,
b.PrevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.PrevInSEL=b)};g.Clipper.prototype.CopyAELToSEL=function(){var b=this.m_ActiveEdges;for(this.m_SortedEdges=b;null!==b;)b.PrevInSEL=b.PrevInAEL,b=b.NextInSEL=b.NextInAEL};g.Clipper.prototype.SwapPositionsInAEL=function(b,d){if(b.NextInAEL!=b.PrevInAEL&&d.NextInAEL!=d.PrevInAEL){if(b.NextInAEL==d){var e=d.NextInAEL;null!==e&&(e.PrevInAEL=b);var g=b.PrevInAEL;null!==g&&(g.NextInAEL=d);d.PrevInAEL=g;d.NextInAEL=b;b.PrevInAEL=d;b.NextInAEL=e}else d.NextInAEL==
b?(e=b.NextInAEL,null!==e&&(e.PrevInAEL=d),g=d.PrevInAEL,null!==g&&(g.NextInAEL=b),b.PrevInAEL=g,b.NextInAEL=d,d.PrevInAEL=b,d.NextInAEL=e):(e=b.NextInAEL,g=b.PrevInAEL,b.NextInAEL=d.NextInAEL,null!==b.NextInAEL&&(b.NextInAEL.PrevInAEL=b),b.PrevInAEL=d.PrevInAEL,null!==b.PrevInAEL&&(b.PrevInAEL.NextInAEL=b),d.NextInAEL=e,null!==d.NextInAEL&&(d.NextInAEL.PrevInAEL=d),d.PrevInAEL=g,null!==d.PrevInAEL&&(d.PrevInAEL.NextInAEL=d));null===b.PrevInAEL?this.m_ActiveEdges=b:null===d.PrevInAEL&&(this.m_ActiveEdges=
d)}};g.Clipper.prototype.SwapPositionsInSEL=function(b,d){if(null!==b.NextInSEL||null!==b.PrevInSEL)if(null!==d.NextInSEL||null!==d.PrevInSEL){if(b.NextInSEL==d){var e=d.NextInSEL;null!==e&&(e.PrevInSEL=b);var g=b.PrevInSEL;null!==g&&(g.NextInSEL=d);d.PrevInSEL=g;d.NextInSEL=b;b.PrevInSEL=d;b.NextInSEL=e}else d.NextInSEL==b?(e=b.NextInSEL,null!==e&&(e.PrevInSEL=d),g=d.PrevInSEL,null!==g&&(g.NextInSEL=b),b.PrevInSEL=g,b.NextInSEL=d,d.PrevInSEL=b,d.NextInSEL=e):(e=b.NextInSEL,g=b.PrevInSEL,b.NextInSEL=
d.NextInSEL,null!==b.NextInSEL&&(b.NextInSEL.PrevInSEL=b),b.PrevInSEL=d.PrevInSEL,null!==b.PrevInSEL&&(b.PrevInSEL.NextInSEL=b),d.NextInSEL=e,null!==d.NextInSEL&&(d.NextInSEL.PrevInSEL=d),d.PrevInSEL=g,null!==d.PrevInSEL&&(d.PrevInSEL.NextInSEL=d));null===b.PrevInSEL?this.m_SortedEdges=b:null===d.PrevInSEL&&(this.m_SortedEdges=d)}};g.Clipper.prototype.AddLocalMaxPoly=function(b,d,e){this.AddOutPt(b,e);0==d.WindDelta&&this.AddOutPt(d,e);b.OutIdx==d.OutIdx?(b.OutIdx=-1,d.OutIdx=-1):b.OutIdx<d.OutIdx?
this.AppendPolygon(b,d):this.AppendPolygon(d,b)};g.Clipper.prototype.AddLocalMinPoly=function(b,d,e){var r,n;g.ClipperBase.IsHorizontal(d)||b.Dx>d.Dx?(r=this.AddOutPt(b,e),d.OutIdx=b.OutIdx,b.Side=g.EdgeSide.esLeft,d.Side=g.EdgeSide.esRight,n=b,b=n.PrevInAEL==d?d.PrevInAEL:n.PrevInAEL):(r=this.AddOutPt(d,e),b.OutIdx=d.OutIdx,b.Side=g.EdgeSide.esRight,d.Side=g.EdgeSide.esLeft,n=d,b=n.PrevInAEL==b?b.PrevInAEL:n.PrevInAEL);null!==b&&0<=b.OutIdx&&g.Clipper.TopX(b,e.Y)==g.Clipper.TopX(n,e.Y)&&g.ClipperBase.SlopesEqual(n,
b,this.m_UseFullRange)&&0!==n.WindDelta&&0!==b.WindDelta&&(e=this.AddOutPt(b,e),this.AddJoin(r,e,n.Top));return r};g.Clipper.prototype.CreateOutRec=function(){var b=new g.OutRec;b.Idx=-1;b.IsHole=!1;b.IsOpen=!1;b.FirstLeft=null;b.Pts=null;b.BottomPt=null;b.PolyNode=null;this.m_PolyOuts.push(b);b.Idx=this.m_PolyOuts.length-1;return b};g.Clipper.prototype.AddOutPt=function(b,d){var e=b.Side==g.EdgeSide.esLeft;if(0>b.OutIdx){var r=this.CreateOutRec();r.IsOpen=0===b.WindDelta;var n=new g.OutPt;r.Pts=
n;n.Idx=r.Idx;n.Pt.X=d.X;n.Pt.Y=d.Y;g.use_xyz&&(n.Pt.Z=d.Z);n.Next=n;n.Prev=n;r.IsOpen||this.SetHoleState(b,r);b.OutIdx=r.Idx}else{var r=this.m_PolyOuts[b.OutIdx],k=r.Pts;if(e&&g.IntPoint.op_Equality(d,k.Pt))return k;if(!e&&g.IntPoint.op_Equality(d,k.Prev.Pt))return k.Prev;n=new g.OutPt;n.Idx=r.Idx;n.Pt.X=d.X;n.Pt.Y=d.Y;g.use_xyz&&(n.Pt.Z=d.Z);n.Next=k;n.Prev=k.Prev;n.Prev.Next=n;k.Prev=n;e&&(r.Pts=n)}return n};g.Clipper.prototype.SwapPoints=function(b,d){var e=new g.IntPoint(b.Value);b.Value.X=d.Value.X;
b.Value.Y=d.Value.Y;g.use_xyz&&(b.Value.Z=d.Value.Z);d.Value.X=e.X;d.Value.Y=e.Y;g.use_xyz&&(d.Value.Z=e.Z)};g.Clipper.prototype.HorzSegmentsOverlap=function(b,d,e,g){var n;b>d&&(n=b,b=d,d=n);e>g&&(n=e,e=g,g=n);return b<g&&e<d};g.Clipper.prototype.SetHoleState=function(b,d){for(var e=!1,g=b.PrevInAEL;null!==g;)0<=g.OutIdx&&0!=g.WindDelta&&(e=!e,null===d.FirstLeft&&(d.FirstLeft=this.m_PolyOuts[g.OutIdx])),g=g.PrevInAEL;e&&(d.IsHole=!0)};g.Clipper.prototype.GetDx=function(b,d){return b.Y==d.Y?g.ClipperBase.horizontal:
(d.X-b.X)/(d.Y-b.Y)};g.Clipper.prototype.FirstIsBottomPt=function(b,d){for(var e=b.Prev;g.IntPoint.op_Equality(e.Pt,b.Pt)&&e!=b;)e=e.Prev;for(var r=Math.abs(this.GetDx(b.Pt,e.Pt)),e=b.Next;g.IntPoint.op_Equality(e.Pt,b.Pt)&&e!=b;)e=e.Next;for(var n=Math.abs(this.GetDx(b.Pt,e.Pt)),e=d.Prev;g.IntPoint.op_Equality(e.Pt,d.Pt)&&e!=d;)e=e.Prev;for(var k=Math.abs(this.GetDx(d.Pt,e.Pt)),e=d.Next;g.IntPoint.op_Equality(e.Pt,d.Pt)&&e!=d;)e=e.Next;e=Math.abs(this.GetDx(d.Pt,e.Pt));return r>=k&&r>=e||n>=k&&n>=
e};g.Clipper.prototype.GetBottomPt=function(b){for(var d=null,e=b.Next;e!=b;)e.Pt.Y>b.Pt.Y?(b=e,d=null):e.Pt.Y==b.Pt.Y&&e.Pt.X<=b.Pt.X&&(e.Pt.X<b.Pt.X?(d=null,b=e):e.Next!=b&&e.Prev!=b&&(d=e)),e=e.Next;if(null!==d)for(;d!=e;)for(this.FirstIsBottomPt(e,d)||(b=d),d=d.Next;g.IntPoint.op_Inequality(d.Pt,b.Pt);)d=d.Next;return b};g.Clipper.prototype.GetLowermostRec=function(b,d){null===b.BottomPt&&(b.BottomPt=this.GetBottomPt(b.Pts));null===d.BottomPt&&(d.BottomPt=this.GetBottomPt(d.Pts));var e=b.BottomPt,
g=d.BottomPt;return e.Pt.Y>g.Pt.Y?b:e.Pt.Y<g.Pt.Y?d:e.Pt.X<g.Pt.X?b:e.Pt.X>g.Pt.X?d:e.Next==e?d:g.Next==g?b:this.FirstIsBottomPt(e,g)?b:d};g.Clipper.prototype.Param1RightOfParam2=function(b,d){do if(b=b.FirstLeft,b==d)return!0;while(null!==b);return!1};g.Clipper.prototype.GetOutRec=function(b){for(b=this.m_PolyOuts[b];b!=this.m_PolyOuts[b.Idx];)b=this.m_PolyOuts[b.Idx];return b};g.Clipper.prototype.AppendPolygon=function(b,d){var e=this.m_PolyOuts[b.OutIdx],r=this.m_PolyOuts[d.OutIdx],n;n=this.Param1RightOfParam2(e,
r)?r:this.Param1RightOfParam2(r,e)?e:this.GetLowermostRec(e,r);var k=e.Pts,v=k.Prev,C=r.Pts,q=C.Prev;b.Side==g.EdgeSide.esLeft?(d.Side==g.EdgeSide.esLeft?(this.ReversePolyPtLinks(C),C.Next=k,k.Prev=C,v.Next=q,q.Prev=v,e.Pts=q):(q.Next=k,k.Prev=q,C.Prev=v,v.Next=C,e.Pts=C),k=g.EdgeSide.esLeft):(d.Side==g.EdgeSide.esRight?(this.ReversePolyPtLinks(C),v.Next=q,q.Prev=v,C.Next=k,k.Prev=C):(v.Next=C,C.Prev=v,k.Prev=q,q.Next=k),k=g.EdgeSide.esRight);e.BottomPt=null;n==r&&(r.FirstLeft!=e&&(e.FirstLeft=r.FirstLeft),
e.IsHole=r.IsHole);r.Pts=null;r.BottomPt=null;r.FirstLeft=e;n=b.OutIdx;v=d.OutIdx;b.OutIdx=-1;d.OutIdx=-1;for(C=this.m_ActiveEdges;null!==C;){if(C.OutIdx==v){C.OutIdx=n;C.Side=k;break}C=C.NextInAEL}r.Idx=e.Idx};g.Clipper.prototype.ReversePolyPtLinks=function(b){if(null!==b){var d,e;d=b;do e=d.Next,d.Next=d.Prev,d=d.Prev=e;while(d!=b)}};g.Clipper.SwapSides=function(b,d){var e=b.Side;b.Side=d.Side;d.Side=e};g.Clipper.SwapPolyIndexes=function(b,d){var e=b.OutIdx;b.OutIdx=d.OutIdx;d.OutIdx=e};g.Clipper.prototype.IntersectEdges=
function(b,d,e){var r=0<=b.OutIdx,n=0<=d.OutIdx;g.use_xyz&&this.SetZ(e,b,d);if(!g.use_lines||0!==b.WindDelta&&0!==d.WindDelta){if(b.PolyTyp==d.PolyTyp)if(this.IsEvenOddFillType(b)){var k=b.WindCnt;b.WindCnt=d.WindCnt;d.WindCnt=k}else b.WindCnt=0===b.WindCnt+d.WindDelta?-b.WindCnt:b.WindCnt+d.WindDelta,d.WindCnt=0===d.WindCnt-b.WindDelta?-d.WindCnt:d.WindCnt-b.WindDelta;else this.IsEvenOddFillType(d)?b.WindCnt2=0===b.WindCnt2?1:0:b.WindCnt2+=d.WindDelta,this.IsEvenOddFillType(b)?d.WindCnt2=0===d.WindCnt2?
1:0:d.WindCnt2-=b.WindDelta;var v,C,q;b.PolyTyp==g.PolyType.ptSubject?(v=this.m_SubjFillType,q=this.m_ClipFillType):(v=this.m_ClipFillType,q=this.m_SubjFillType);d.PolyTyp==g.PolyType.ptSubject?(C=this.m_SubjFillType,k=this.m_ClipFillType):(C=this.m_ClipFillType,k=this.m_SubjFillType);switch(v){case g.PolyFillType.pftPositive:v=b.WindCnt;break;case g.PolyFillType.pftNegative:v=-b.WindCnt;break;default:v=Math.abs(b.WindCnt)}switch(C){case g.PolyFillType.pftPositive:C=d.WindCnt;break;case g.PolyFillType.pftNegative:C=
-d.WindCnt;break;default:C=Math.abs(d.WindCnt)}if(r&&n)0!=v&&1!=v||0!=C&&1!=C||b.PolyTyp!=d.PolyTyp&&this.m_ClipType!=g.ClipType.ctXor?this.AddLocalMaxPoly(b,d,e):(this.AddOutPt(b,e),this.AddOutPt(d,e),g.Clipper.SwapSides(b,d),g.Clipper.SwapPolyIndexes(b,d));else if(r){if(0===C||1==C)this.AddOutPt(b,e),g.Clipper.SwapSides(b,d),g.Clipper.SwapPolyIndexes(b,d)}else if(n){if(0===v||1==v)this.AddOutPt(d,e),g.Clipper.SwapSides(b,d),g.Clipper.SwapPolyIndexes(b,d)}else if(!(0!=v&&1!=v||0!=C&&1!=C)){switch(q){case g.PolyFillType.pftPositive:r=
b.WindCnt2;break;case g.PolyFillType.pftNegative:r=-b.WindCnt2;break;default:r=Math.abs(b.WindCnt2)}switch(k){case g.PolyFillType.pftPositive:n=d.WindCnt2;break;case g.PolyFillType.pftNegative:n=-d.WindCnt2;break;default:n=Math.abs(d.WindCnt2)}if(b.PolyTyp!=d.PolyTyp)this.AddLocalMinPoly(b,d,e);else if(1==v&&1==C)switch(this.m_ClipType){case g.ClipType.ctIntersection:0<r&&0<n&&this.AddLocalMinPoly(b,d,e);break;case g.ClipType.ctUnion:0>=r&&0>=n&&this.AddLocalMinPoly(b,d,e);break;case g.ClipType.ctDifference:(b.PolyTyp==
g.PolyType.ptClip&&0<r&&0<n||b.PolyTyp==g.PolyType.ptSubject&&0>=r&&0>=n)&&this.AddLocalMinPoly(b,d,e);break;case g.ClipType.ctXor:this.AddLocalMinPoly(b,d,e)}else g.Clipper.SwapSides(b,d)}}else if(0!=b.WindDelta||0!=d.WindDelta)b.PolyTyp==d.PolyTyp&&b.WindDelta!=d.WindDelta&&this.m_ClipType==g.ClipType.ctUnion?0===b.WindDelta?n&&(this.AddOutPt(b,e),r&&(b.OutIdx=-1)):r&&(this.AddOutPt(d,e),n&&(d.OutIdx=-1)):b.PolyTyp!=d.PolyTyp&&(0!==b.WindDelta||1!=Math.abs(d.WindCnt)||this.m_ClipType==g.ClipType.ctUnion&&
0!==d.WindCnt2?0!==d.WindDelta||1!=Math.abs(b.WindCnt)||this.m_ClipType==g.ClipType.ctUnion&&0!==b.WindCnt2||(this.AddOutPt(d,e),n&&(d.OutIdx=-1)):(this.AddOutPt(b,e),r&&(b.OutIdx=-1)))};g.Clipper.prototype.DeleteFromAEL=function(b){var d=b.PrevInAEL,e=b.NextInAEL;if(null!==d||null!==e||b==this.m_ActiveEdges)null!==d?d.NextInAEL=e:this.m_ActiveEdges=e,null!==e&&(e.PrevInAEL=d),b.NextInAEL=null,b.PrevInAEL=null};g.Clipper.prototype.DeleteFromSEL=function(b){var d=b.PrevInSEL,e=b.NextInSEL;if(null!==
d||null!==e||b==this.m_SortedEdges)null!==d?d.NextInSEL=e:this.m_SortedEdges=e,null!==e&&(e.PrevInSEL=d),b.NextInSEL=null,b.PrevInSEL=null};g.Clipper.prototype.UpdateEdgeIntoAEL=function(b){null===b.NextInLML&&g.Error("UpdateEdgeIntoAEL: invalid call");var d=b.PrevInAEL,e=b.NextInAEL;b.NextInLML.OutIdx=b.OutIdx;null!==d?d.NextInAEL=b.NextInLML:this.m_ActiveEdges=b.NextInLML;null!==e&&(e.PrevInAEL=b.NextInLML);b.NextInLML.Side=b.Side;b.NextInLML.WindDelta=b.WindDelta;b.NextInLML.WindCnt=b.WindCnt;
b.NextInLML.WindCnt2=b.WindCnt2;b=b.NextInLML;b.Curr.X=b.Bot.X;b.Curr.Y=b.Bot.Y;g.use_xyz&&(b.Curr.Z=b.Bot.Z);b.PrevInAEL=d;b.NextInAEL=e;g.ClipperBase.IsHorizontal(b)||this.InsertScanbeam(b.Top.Y);return b};g.Clipper.prototype.ProcessHorizontals=function(b){for(var d=this.m_SortedEdges;null!==d;)this.DeleteFromSEL(d),this.ProcessHorizontal(d,b),d=this.m_SortedEdges};g.Clipper.prototype.GetHorzDirection=function(b,d){b.Bot.X<b.Top.X?(d.Left=b.Bot.X,d.Right=b.Top.X,d.Dir=g.Direction.dLeftToRight):
(d.Left=b.Top.X,d.Right=b.Bot.X,d.Dir=g.Direction.dRightToLeft)};g.Clipper.prototype.ProcessHorizontal=function(b,d){var e={Dir:null,Left:null,Right:null};this.GetHorzDirection(b,e);for(var r=e.Dir,n=e.Left,k=e.Right,v=b,C=null;null!==v.NextInLML&&g.ClipperBase.IsHorizontal(v.NextInLML);)v=v.NextInLML;for(null===v.NextInLML&&(C=this.GetMaximaPair(v));;){for(var q=b==v,F=this.GetNextInAEL(b,r);null!==F&&!(F.Curr.X==b.Top.X&&null!==b.NextInLML&&F.Dx<b.NextInLML.Dx);){e=this.GetNextInAEL(F,r);if(r==
g.Direction.dLeftToRight&&F.Curr.X<=k||r==g.Direction.dRightToLeft&&F.Curr.X>=n){if(F==C&&q){if(0<=b.OutIdx){r=this.AddOutPt(b,b.Top);for(e=this.m_SortedEdges;null!==e;)0<=e.OutIdx&&this.HorzSegmentsOverlap(b.Bot.X,b.Top.X,e.Bot.X,e.Top.X)&&(n=this.AddOutPt(e,e.Bot),this.AddJoin(n,r,e.Top)),e=e.NextInSEL;this.AddGhostJoin(r,b.Bot);this.AddLocalMaxPoly(b,C,b.Top)}this.DeleteFromAEL(b);this.DeleteFromAEL(C);return}if(r==g.Direction.dLeftToRight){var E=new g.IntPoint(F.Curr.X,b.Curr.Y);this.IntersectEdges(b,
F,E)}else E=new g.IntPoint(F.Curr.X,b.Curr.Y),this.IntersectEdges(F,b,E);this.SwapPositionsInAEL(b,F)}else if(r==g.Direction.dLeftToRight&&F.Curr.X>=k||r==g.Direction.dRightToLeft&&F.Curr.X<=n)break;F=e}if(null!==b.NextInLML&&g.ClipperBase.IsHorizontal(b.NextInLML))b=this.UpdateEdgeIntoAEL(b),0<=b.OutIdx&&this.AddOutPt(b,b.Bot),e={Dir:r,Left:n,Right:k},this.GetHorzDirection(b,e),r=e.Dir,n=e.Left,k=e.Right;else break}null!==b.NextInLML?0<=b.OutIdx?(r=this.AddOutPt(b,b.Top),d&&this.AddGhostJoin(r,b.Bot),
b=this.UpdateEdgeIntoAEL(b),0!==b.WindDelta&&(C=b.PrevInAEL,e=b.NextInAEL,null!==C&&C.Curr.X==b.Bot.X&&C.Curr.Y==b.Bot.Y&&0!==C.WindDelta&&0<=C.OutIdx&&C.Curr.Y>C.Top.Y&&g.ClipperBase.SlopesEqual(b,C,this.m_UseFullRange)?(n=this.AddOutPt(C,b.Bot),this.AddJoin(r,n,b.Top)):null!==e&&e.Curr.X==b.Bot.X&&e.Curr.Y==b.Bot.Y&&0!==e.WindDelta&&0<=e.OutIdx&&e.Curr.Y>e.Top.Y&&g.ClipperBase.SlopesEqual(b,e,this.m_UseFullRange)&&(n=this.AddOutPt(e,b.Bot),this.AddJoin(r,n,b.Top)))):this.UpdateEdgeIntoAEL(b):(0<=
b.OutIdx&&this.AddOutPt(b,b.Top),this.DeleteFromAEL(b))};g.Clipper.prototype.GetNextInAEL=function(b,d){return d==g.Direction.dLeftToRight?b.NextInAEL:b.PrevInAEL};g.Clipper.prototype.IsMinima=function(b){return null!==b&&b.Prev.NextInLML!=b&&b.Next.NextInLML!=b};g.Clipper.prototype.IsMaxima=function(b,d){return null!==b&&b.Top.Y==d&&null===b.NextInLML};g.Clipper.prototype.IsIntermediate=function(b,d){return b.Top.Y==d&&null!==b.NextInLML};g.Clipper.prototype.GetMaximaPair=function(b){var d=null;
g.IntPoint.op_Equality(b.Next.Top,b.Top)&&null===b.Next.NextInLML?d=b.Next:g.IntPoint.op_Equality(b.Prev.Top,b.Top)&&null===b.Prev.NextInLML&&(d=b.Prev);return null===d||-2!=d.OutIdx&&(d.NextInAEL!=d.PrevInAEL||g.ClipperBase.IsHorizontal(d))?d:null};g.Clipper.prototype.ProcessIntersections=function(b){if(null==this.m_ActiveEdges)return!0;try{this.BuildIntersectList(b);if(0==this.m_IntersectList.length)return!0;if(1==this.m_IntersectList.length||this.FixupIntersectionOrder())this.ProcessIntersectList();
else return!1}catch(d){this.m_SortedEdges=null,this.m_IntersectList.length=0,g.Error("ProcessIntersections error")}this.m_SortedEdges=null;return!0};g.Clipper.prototype.BuildIntersectList=function(b){if(null!==this.m_ActiveEdges){var d=this.m_ActiveEdges;for(this.m_SortedEdges=d;null!==d;)d.PrevInSEL=d.PrevInAEL,d.NextInSEL=d.NextInAEL,d.Curr.X=g.Clipper.TopX(d,b),d=d.NextInAEL;for(var e=!0;e&&null!==this.m_SortedEdges;){e=!1;for(d=this.m_SortedEdges;null!==d.NextInSEL;){b=d.NextInSEL;var r=new g.IntPoint;
d.Curr.X>b.Curr.X?(this.IntersectPoint(d,b,r),e=new g.IntersectNode,e.Edge1=d,e.Edge2=b,e.Pt.X=r.X,e.Pt.Y=r.Y,g.use_xyz&&(e.Pt.Z=r.Z),this.m_IntersectList.push(e),this.SwapPositionsInSEL(d,b),e=!0):d=b}if(null!==d.PrevInSEL)d.PrevInSEL.NextInSEL=null;else break}this.m_SortedEdges=null}};g.Clipper.prototype.EdgesAdjacent=function(b){return b.Edge1.NextInSEL==b.Edge2||b.Edge1.PrevInSEL==b.Edge2};g.Clipper.IntersectNodeSort=function(b,d){return d.Pt.Y-b.Pt.Y};g.Clipper.prototype.FixupIntersectionOrder=
function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer);this.CopyAELToSEL();for(var b=this.m_IntersectList.length,d=0;d<b;d++){if(!this.EdgesAdjacent(this.m_IntersectList[d])){for(var e=d+1;e<b&&!this.EdgesAdjacent(this.m_IntersectList[e]);)e++;if(e==b)return!1;var g=this.m_IntersectList[d];this.m_IntersectList[d]=this.m_IntersectList[e];this.m_IntersectList[e]=g}this.SwapPositionsInSEL(this.m_IntersectList[d].Edge1,this.m_IntersectList[d].Edge2)}return!0};g.Clipper.prototype.ProcessIntersectList=
function(){for(var b=0,d=this.m_IntersectList.length;b<d;b++){var e=this.m_IntersectList[b];this.IntersectEdges(e.Edge1,e.Edge2,e.Pt);this.SwapPositionsInAEL(e.Edge1,e.Edge2)}this.m_IntersectList.length=0};L=function(b){return 0>b?Math.ceil(b-.5):Math.round(b)};Ub=function(b){return 0>b?Math.ceil(b-.5):Math.floor(b+.5)};Ua=function(b){return 0>b?-Math.round(Math.abs(b)):Math.round(b)};hb=function(b){if(0>b)return b-=.5,-2147483648>b?Math.ceil(b):b|0;b+=.5;return 2147483647<b?Math.floor(b):b|0};g.Clipper.Round=
aa?L:tb?Ua:ic?hb:Ub;g.Clipper.TopX=function(b,d){return d==b.Top.Y?b.Top.X:b.Bot.X+g.Clipper.Round(b.Dx*(d-b.Bot.Y))};g.Clipper.prototype.IntersectPoint=function(b,d,e){e.X=0;e.Y=0;var r,n;if(b.Dx==d.Dx)e.Y=b.Curr.Y,e.X=g.Clipper.TopX(b,e.Y);else{if(0===b.Delta.X)e.X=b.Bot.X,g.ClipperBase.IsHorizontal(d)?e.Y=d.Bot.Y:(n=d.Bot.Y-d.Bot.X/d.Dx,e.Y=g.Clipper.Round(e.X/d.Dx+n));else if(0===d.Delta.X)e.X=d.Bot.X,g.ClipperBase.IsHorizontal(b)?e.Y=b.Bot.Y:(r=b.Bot.Y-b.Bot.X/b.Dx,e.Y=g.Clipper.Round(e.X/b.Dx+
r));else{r=b.Bot.X-b.Bot.Y*b.Dx;n=d.Bot.X-d.Bot.Y*d.Dx;var k=(n-r)/(b.Dx-d.Dx);e.Y=g.Clipper.Round(k);e.X=Math.abs(b.Dx)<Math.abs(d.Dx)?g.Clipper.Round(b.Dx*k+r):g.Clipper.Round(d.Dx*k+n)}if(e.Y<b.Top.Y||e.Y<d.Top.Y){if(b.Top.Y>d.Top.Y)return e.Y=b.Top.Y,e.X=g.Clipper.TopX(d,b.Top.Y),e.X<b.Top.X;e.Y=d.Top.Y;e.X=Math.abs(b.Dx)<Math.abs(d.Dx)?g.Clipper.TopX(b,e.Y):g.Clipper.TopX(d,e.Y)}e.Y>b.Curr.Y&&(e.Y=b.Curr.Y,e.X=Math.abs(b.Dx)>Math.abs(d.Dx)?g.Clipper.TopX(d,e.Y):g.Clipper.TopX(b,e.Y))}};g.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=
function(b){for(var d=this.m_ActiveEdges;null!==d;){var e=this.IsMaxima(d,b);e&&(e=this.GetMaximaPair(d),e=null===e||!g.ClipperBase.IsHorizontal(e));if(e){var r=d.PrevInAEL;this.DoMaxima(d);d=null===r?this.m_ActiveEdges:r.NextInAEL}else{this.IsIntermediate(d,b)&&g.ClipperBase.IsHorizontal(d.NextInLML)?(d=this.UpdateEdgeIntoAEL(d),0<=d.OutIdx&&this.AddOutPt(d,d.Bot),this.AddEdgeToSEL(d)):(d.Curr.X=g.Clipper.TopX(d,b),d.Curr.Y=b);if(this.StrictlySimple&&(r=d.PrevInAEL,0<=d.OutIdx&&0!==d.WindDelta&&
null!==r&&0<=r.OutIdx&&r.Curr.X==d.Curr.X&&0!==r.WindDelta)){var n=new g.IntPoint(d.Curr);g.use_xyz&&this.SetZ(n,r,d);e=this.AddOutPt(r,n);r=this.AddOutPt(d,n);this.AddJoin(e,r,n)}d=d.NextInAEL}}this.ProcessHorizontals(!0);for(d=this.m_ActiveEdges;null!==d;)this.IsIntermediate(d,b)&&(e=null,0<=d.OutIdx&&(e=this.AddOutPt(d,d.Top)),d=this.UpdateEdgeIntoAEL(d),r=d.PrevInAEL,n=d.NextInAEL,null!==r&&r.Curr.X==d.Bot.X&&r.Curr.Y==d.Bot.Y&&null!==e&&0<=r.OutIdx&&r.Curr.Y>r.Top.Y&&g.ClipperBase.SlopesEqual(d,
r,this.m_UseFullRange)&&0!==d.WindDelta&&0!==r.WindDelta?(r=this.AddOutPt(r,d.Bot),this.AddJoin(e,r,d.Top)):null!==n&&n.Curr.X==d.Bot.X&&n.Curr.Y==d.Bot.Y&&null!==e&&0<=n.OutIdx&&n.Curr.Y>n.Top.Y&&g.ClipperBase.SlopesEqual(d,n,this.m_UseFullRange)&&0!==d.WindDelta&&0!==n.WindDelta&&(r=this.AddOutPt(n,d.Bot),this.AddJoin(e,r,d.Top))),d=d.NextInAEL};g.Clipper.prototype.DoMaxima=function(b){var d=this.GetMaximaPair(b);if(null===d)0<=b.OutIdx&&this.AddOutPt(b,b.Top),this.DeleteFromAEL(b);else{for(var e=
b.NextInAEL;null!==e&&e!=d;)this.IntersectEdges(b,e,b.Top),this.SwapPositionsInAEL(b,e),e=b.NextInAEL;-1==b.OutIdx&&-1==d.OutIdx?(this.DeleteFromAEL(b),this.DeleteFromAEL(d)):0<=b.OutIdx&&0<=d.OutIdx?(0<=b.OutIdx&&this.AddLocalMaxPoly(b,d,b.Top),this.DeleteFromAEL(b),this.DeleteFromAEL(d)):g.use_lines&&0===b.WindDelta?(0<=b.OutIdx&&(this.AddOutPt(b,b.Top),b.OutIdx=-1),this.DeleteFromAEL(b),0<=d.OutIdx&&(this.AddOutPt(d,b.Top),d.OutIdx=-1),this.DeleteFromAEL(d)):g.Error("DoMaxima error")}};g.Clipper.ReversePaths=
function(b){for(var d=0,e=b.length;d<e;d++)b[d].reverse()};g.Clipper.Orientation=function(b){return 0<=g.Clipper.Area(b)};g.Clipper.prototype.PointCount=function(b){if(null===b)return 0;var d=0,e=b;do d++,e=e.Next;while(e!=b);return d};g.Clipper.prototype.BuildResult=function(b){g.Clear(b);for(var d=0,e=this.m_PolyOuts.length;d<e;d++){var r=this.m_PolyOuts[d];if(null!==r.Pts){var r=r.Pts.Prev,n=this.PointCount(r);if(!(2>n)){for(var k=Array(n),v=0;v<n;v++)k[v]=r.Pt,r=r.Prev;b.push(k)}}}};g.Clipper.prototype.BuildResult2=
function(b){b.Clear();for(var d=0,e=this.m_PolyOuts.length;d<e;d++){var r=this.m_PolyOuts[d],n=this.PointCount(r.Pts);if(!(r.IsOpen&&2>n||!r.IsOpen&&3>n)){this.FixHoleLinkage(r);var k=new g.PolyNode;b.m_AllPolys.push(k);r.PolyNode=k;k.m_polygon.length=n;for(var r=r.Pts.Prev,v=0;v<n;v++)k.m_polygon[v]=r.Pt,r=r.Prev}}d=0;for(e=this.m_PolyOuts.length;d<e;d++)r=this.m_PolyOuts[d],null!==r.PolyNode&&(r.IsOpen?(r.PolyNode.IsOpen=!0,b.AddChild(r.PolyNode)):null!==r.FirstLeft&&null!=r.FirstLeft.PolyNode?
r.FirstLeft.PolyNode.AddChild(r.PolyNode):b.AddChild(r.PolyNode))};g.Clipper.prototype.FixupOutPolygon=function(b){var d=null;b.BottomPt=null;for(var e=b.Pts;;){if(e.Prev==e||e.Prev==e.Next){b.Pts=null;return}if(g.IntPoint.op_Equality(e.Pt,e.Next.Pt)||g.IntPoint.op_Equality(e.Pt,e.Prev.Pt)||g.ClipperBase.SlopesEqual(e.Prev.Pt,e.Pt,e.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(e.Prev.Pt,e.Pt,e.Next.Pt)))d=null,e.Prev.Next=e.Next,e=e.Next.Prev=e.Prev;else if(e==
d)break;else null===d&&(d=e),e=e.Next}b.Pts=e};g.Clipper.prototype.DupOutPt=function(b,d){var e=new g.OutPt;e.Pt.X=b.Pt.X;e.Pt.Y=b.Pt.Y;g.use_xyz&&(e.Pt.Z=b.Pt.Z);e.Idx=b.Idx;d?(e.Next=b.Next,e.Prev=b,b.Next.Prev=e,b.Next=e):(e.Prev=b.Prev,e.Next=b,b.Prev.Next=e,b.Prev=e);return e};g.Clipper.prototype.GetOverlap=function(b,d,e,g,n){b<d?e<g?(n.Left=Math.max(b,e),n.Right=Math.min(d,g)):(n.Left=Math.max(b,g),n.Right=Math.min(d,e)):e<g?(n.Left=Math.max(d,e),n.Right=Math.min(b,g)):(n.Left=Math.max(d,g),
n.Right=Math.min(b,e));return n.Left<n.Right};g.Clipper.prototype.JoinHorz=function(b,d,e,r,n,k){var v=b.Pt.X>d.Pt.X?g.Direction.dRightToLeft:g.Direction.dLeftToRight;r=e.Pt.X>r.Pt.X?g.Direction.dRightToLeft:g.Direction.dLeftToRight;if(v==r)return!1;if(v==g.Direction.dLeftToRight){for(;b.Next.Pt.X<=n.X&&b.Next.Pt.X>=b.Pt.X&&b.Next.Pt.Y==n.Y;)b=b.Next;k&&b.Pt.X!=n.X&&(b=b.Next);d=this.DupOutPt(b,!k);g.IntPoint.op_Inequality(d.Pt,n)&&(b=d,b.Pt.X=n.X,b.Pt.Y=n.Y,g.use_xyz&&(b.Pt.Z=n.Z),d=this.DupOutPt(b,
!k))}else{for(;b.Next.Pt.X>=n.X&&b.Next.Pt.X<=b.Pt.X&&b.Next.Pt.Y==n.Y;)b=b.Next;k||b.Pt.X==n.X||(b=b.Next);d=this.DupOutPt(b,k);g.IntPoint.op_Inequality(d.Pt,n)&&(b=d,b.Pt.X=n.X,b.Pt.Y=n.Y,g.use_xyz&&(b.Pt.Z=n.Z),d=this.DupOutPt(b,k))}if(r==g.Direction.dLeftToRight){for(;e.Next.Pt.X<=n.X&&e.Next.Pt.X>=e.Pt.X&&e.Next.Pt.Y==n.Y;)e=e.Next;k&&e.Pt.X!=n.X&&(e=e.Next);r=this.DupOutPt(e,!k);g.IntPoint.op_Inequality(r.Pt,n)&&(e=r,e.Pt.X=n.X,e.Pt.Y=n.Y,g.use_xyz&&(e.Pt.Z=n.Z),r=this.DupOutPt(e,!k))}else{for(;e.Next.Pt.X>=
n.X&&e.Next.Pt.X<=e.Pt.X&&e.Next.Pt.Y==n.Y;)e=e.Next;k||e.Pt.X==n.X||(e=e.Next);r=this.DupOutPt(e,k);g.IntPoint.op_Inequality(r.Pt,n)&&(e=r,e.Pt.X=n.X,e.Pt.Y=n.Y,g.use_xyz&&(e.Pt.Z=n.Z),r=this.DupOutPt(e,k))}v==g.Direction.dLeftToRight==k?(b.Prev=e,e.Next=b,d.Next=r,r.Prev=d):(b.Next=e,e.Prev=b,d.Prev=r,r.Next=d);return!0};g.Clipper.prototype.JoinPoints=function(b,d,e){var r=b.OutPt1,n;new g.OutPt;var k=b.OutPt2,v;new g.OutPt;if((v=b.OutPt1.Pt.Y==b.OffPt.Y)&&g.IntPoint.op_Equality(b.OffPt,b.OutPt1.Pt)&&
g.IntPoint.op_Equality(b.OffPt,b.OutPt2.Pt)){if(d!=e)return!1;for(n=b.OutPt1.Next;n!=r&&g.IntPoint.op_Equality(n.Pt,b.OffPt);)n=n.Next;n=n.Pt.Y>b.OffPt.Y;for(v=b.OutPt2.Next;v!=k&&g.IntPoint.op_Equality(v.Pt,b.OffPt);)v=v.Next;if(n==v.Pt.Y>b.OffPt.Y)return!1;n?(n=this.DupOutPt(r,!1),v=this.DupOutPt(k,!0),r.Prev=k,k.Next=r,n.Next=v,v.Prev=n):(n=this.DupOutPt(r,!0),v=this.DupOutPt(k,!1),r.Next=k,k.Prev=r,n.Prev=v,v.Next=n);b.OutPt1=r;b.OutPt2=n;return!0}if(v){for(n=r;r.Prev.Pt.Y==r.Pt.Y&&r.Prev!=n&&
r.Prev!=k;)r=r.Prev;for(;n.Next.Pt.Y==n.Pt.Y&&n.Next!=r&&n.Next!=k;)n=n.Next;if(n.Next==r||n.Next==k)return!1;for(v=k;k.Prev.Pt.Y==k.Pt.Y&&k.Prev!=v&&k.Prev!=n;)k=k.Prev;for(;v.Next.Pt.Y==v.Pt.Y&&v.Next!=k&&v.Next!=r;)v=v.Next;if(v.Next==k||v.Next==r)return!1;e={Left:null,Right:null};if(!this.GetOverlap(r.Pt.X,n.Pt.X,k.Pt.X,v.Pt.X,e))return!1;d=e.Left;var C=e.Right;e=new g.IntPoint;r.Pt.X>=d&&r.Pt.X<=C?(e.X=r.Pt.X,e.Y=r.Pt.Y,g.use_xyz&&(e.Z=r.Pt.Z),d=r.Pt.X>n.Pt.X):k.Pt.X>=d&&k.Pt.X<=C?(e.X=k.Pt.X,
e.Y=k.Pt.Y,g.use_xyz&&(e.Z=k.Pt.Z),d=k.Pt.X>v.Pt.X):n.Pt.X>=d&&n.Pt.X<=C?(e.X=n.Pt.X,e.Y=n.Pt.Y,g.use_xyz&&(e.Z=n.Pt.Z),d=n.Pt.X>r.Pt.X):(e.X=v.Pt.X,e.Y=v.Pt.Y,g.use_xyz&&(e.Z=v.Pt.Z),d=v.Pt.X>k.Pt.X);b.OutPt1=r;b.OutPt2=k;return this.JoinHorz(r,n,k,v,e,d)}for(n=r.Next;g.IntPoint.op_Equality(n.Pt,r.Pt)&&n!=r;)n=n.Next;if(C=n.Pt.Y>r.Pt.Y||!g.ClipperBase.SlopesEqual(r.Pt,n.Pt,b.OffPt,this.m_UseFullRange)){for(n=r.Prev;g.IntPoint.op_Equality(n.Pt,r.Pt)&&n!=r;)n=n.Prev;if(n.Pt.Y>r.Pt.Y||!g.ClipperBase.SlopesEqual(r.Pt,
n.Pt,b.OffPt,this.m_UseFullRange))return!1}for(v=k.Next;g.IntPoint.op_Equality(v.Pt,k.Pt)&&v!=k;)v=v.Next;var q=v.Pt.Y>k.Pt.Y||!g.ClipperBase.SlopesEqual(k.Pt,v.Pt,b.OffPt,this.m_UseFullRange);if(q){for(v=k.Prev;g.IntPoint.op_Equality(v.Pt,k.Pt)&&v!=k;)v=v.Prev;if(v.Pt.Y>k.Pt.Y||!g.ClipperBase.SlopesEqual(k.Pt,v.Pt,b.OffPt,this.m_UseFullRange))return!1}if(n==r||v==k||n==v||d==e&&C==q)return!1;C?(n=this.DupOutPt(r,!1),v=this.DupOutPt(k,!0),r.Prev=k,k.Next=r,n.Next=v,v.Prev=n):(n=this.DupOutPt(r,!0),
v=this.DupOutPt(k,!1),r.Next=k,k.Prev=r,n.Prev=v,v.Next=n);b.OutPt1=r;b.OutPt2=n;return!0};g.Clipper.GetBounds=function(b){for(var d=0,e=b.length;d<e&&0==b[d].length;)d++;if(d==e)return new g.IntRect(0,0,0,0);var r=new g.IntRect;r.left=b[d][0].X;r.right=r.left;r.top=b[d][0].Y;for(r.bottom=r.top;d<e;d++)for(var k=0,J=b[d].length;k<J;k++)b[d][k].X<r.left?r.left=b[d][k].X:b[d][k].X>r.right&&(r.right=b[d][k].X),b[d][k].Y<r.top?r.top=b[d][k].Y:b[d][k].Y>r.bottom&&(r.bottom=b[d][k].Y);return r};g.Clipper.prototype.GetBounds2=
function(b){var d=b,e=new g.IntRect;e.left=b.Pt.X;e.right=b.Pt.X;e.top=b.Pt.Y;e.bottom=b.Pt.Y;for(b=b.Next;b!=d;)b.Pt.X<e.left&&(e.left=b.Pt.X),b.Pt.X>e.right&&(e.right=b.Pt.X),b.Pt.Y<e.top&&(e.top=b.Pt.Y),b.Pt.Y>e.bottom&&(e.bottom=b.Pt.Y),b=b.Next;return e};g.Clipper.PointInPolygon=function(b,d){var e=0,g=d.length;if(3>g)return 0;for(var k=d[0],J=1;J<=g;++J){var v=J==g?d[0]:d[J];if(v.Y==b.Y&&(v.X==b.X||k.Y==b.Y&&v.X>b.X==k.X<b.X))return-1;if(k.Y<b.Y!=v.Y<b.Y)if(k.X>=b.X)if(v.X>b.X)e=1-e;else{var C=
(k.X-b.X)*(v.Y-b.Y)-(v.X-b.X)*(k.Y-b.Y);if(0==C)return-1;0<C==v.Y>k.Y&&(e=1-e)}else if(v.X>b.X){C=(k.X-b.X)*(v.Y-b.Y)-(v.X-b.X)*(k.Y-b.Y);if(0==C)return-1;0<C==v.Y>k.Y&&(e=1-e)}k=v}return e};g.Clipper.prototype.PointInPolygon=function(b,d){var e=0,g=d,k=b.X,J=b.Y,v=d.Pt.X,C=d.Pt.Y;do{d=d.Next;var q=d.Pt.X,F=d.Pt.Y;if(F==J&&(q==k||C==J&&q>k==v<k))return-1;if(C<J!=F<J)if(v>=k)if(q>k)e=1-e;else{v=(v-k)*(F-J)-(q-k)*(C-J);if(0==v)return-1;0<v==F>C&&(e=1-e)}else if(q>k){v=(v-k)*(F-J)-(q-k)*(C-J);if(0==
v)return-1;0<v==F>C&&(e=1-e)}v=q;C=F}while(g!=d);return e};g.Clipper.prototype.Poly2ContainsPoly1=function(b,d){var e=b;do{var g=this.PointInPolygon(e.Pt,d);if(0<=g)return 0<g;e=e.Next}while(e!=b);return!0};g.Clipper.prototype.FixupFirstLefts1=function(b,d){for(var e=0,g=this.m_PolyOuts.length;e<g;e++){var k=this.m_PolyOuts[e];null!=k.Pts&&null!=k.FirstLeft&&this.ParseFirstLeft(k.FirstLeft)==b&&this.Poly2ContainsPoly1(k.Pts,d.Pts)&&(k.FirstLeft=d)}};g.Clipper.prototype.FixupFirstLefts2=function(b,
d){for(var e=0,g=this.m_PolyOuts,k=g.length,q=g[e];e<k;e++,q=g[e])q.FirstLeft==b&&(q.FirstLeft=d)};g.Clipper.ParseFirstLeft=function(b){for(;null!=b&&null==b.Pts;)b=b.FirstLeft;return b};g.Clipper.prototype.JoinCommonEdges=function(){for(var b=0,d=this.m_Joins.length;b<d;b++){var e=this.m_Joins[b],k=this.GetOutRec(e.OutPt1.Idx),n=this.GetOutRec(e.OutPt2.Idx);if(null!=k.Pts&&null!=n.Pts){var q;q=k==n?k:this.Param1RightOfParam2(k,n)?n:this.Param1RightOfParam2(n,k)?k:this.GetLowermostRec(k,n);if(this.JoinPoints(e,
k,n))if(k==n){k.Pts=e.OutPt1;k.BottomPt=null;n=this.CreateOutRec();n.Pts=e.OutPt2;this.UpdateOutPtIdxs(n);if(this.m_UsingPolyTree){q=0;for(var v=this.m_PolyOuts.length;q<v-1;q++){var C=this.m_PolyOuts[q];null!=C.Pts&&g.Clipper.ParseFirstLeft(C.FirstLeft)==k&&C.IsHole!=k.IsHole&&this.Poly2ContainsPoly1(C.Pts,e.OutPt2)&&(C.FirstLeft=n)}}this.Poly2ContainsPoly1(n.Pts,k.Pts)?(n.IsHole=!k.IsHole,n.FirstLeft=k,this.m_UsingPolyTree&&this.FixupFirstLefts2(n,k),(n.IsHole^this.ReverseSolution)==0<this.Area(n)&&
this.ReversePolyPtLinks(n.Pts)):this.Poly2ContainsPoly1(k.Pts,n.Pts)?(n.IsHole=k.IsHole,k.IsHole=!n.IsHole,n.FirstLeft=k.FirstLeft,k.FirstLeft=n,this.m_UsingPolyTree&&this.FixupFirstLefts2(k,n),(k.IsHole^this.ReverseSolution)==0<this.Area(k)&&this.ReversePolyPtLinks(k.Pts)):(n.IsHole=k.IsHole,n.FirstLeft=k.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(k,n))}else n.Pts=null,n.BottomPt=null,n.Idx=k.Idx,k.IsHole=q.IsHole,q==n&&(k.FirstLeft=n.FirstLeft),n.FirstLeft=k,this.m_UsingPolyTree&&this.FixupFirstLefts2(n,
k)}}};g.Clipper.prototype.UpdateOutPtIdxs=function(b){var d=b.Pts;do d.Idx=b.Idx,d=d.Prev;while(d!=b.Pts)};g.Clipper.prototype.DoSimplePolygons=function(){for(var b=0;b<this.m_PolyOuts.length;){var d=this.m_PolyOuts[b++],e=d.Pts;if(null!=e&&!d.IsOpen){do{for(var k=e.Next;k!=d.Pts;){if(g.IntPoint.op_Equality(e.Pt,k.Pt)&&k.Next!=e&&k.Prev!=e){var n=e.Prev,q=k.Prev;e.Prev=q;q.Next=e;k.Prev=n;n.Next=k;d.Pts=e;n=this.CreateOutRec();n.Pts=k;this.UpdateOutPtIdxs(n);this.Poly2ContainsPoly1(n.Pts,d.Pts)?(n.IsHole=
!d.IsHole,n.FirstLeft=d,this.m_UsingPolyTree&&this.FixupFirstLefts2(n,d)):this.Poly2ContainsPoly1(d.Pts,n.Pts)?(n.IsHole=d.IsHole,d.IsHole=!n.IsHole,n.FirstLeft=d.FirstLeft,d.FirstLeft=n,this.m_UsingPolyTree&&this.FixupFirstLefts2(d,n)):(n.IsHole=d.IsHole,n.FirstLeft=d.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(d,n));k=e}k=k.Next}e=e.Next}while(e!=d.Pts)}}};g.Clipper.Area=function(b){var d=b.length;if(3>d)return 0;for(var e=0,g=0,k=d-1;g<d;++g)e+=(b[k].X+b[g].X)*(b[k].Y-b[g].Y),k=g;return.5*
-e};g.Clipper.prototype.Area=function(b){var d=b.Pts;if(null==d)return 0;var e=0;do e+=(d.Prev.Pt.X+d.Pt.X)*(d.Prev.Pt.Y-d.Pt.Y),d=d.Next;while(d!=b.Pts);return.5*e};g.Clipper.SimplifyPolygon=function(b,d){var e=[],k=new g.Clipper(0);k.StrictlySimple=!0;k.AddPath(b,g.PolyType.ptSubject,!0);k.Execute(g.ClipType.ctUnion,e,d,d);return e};g.Clipper.SimplifyPolygons=function(b,d){"undefined"==typeof d&&(d=g.PolyFillType.pftEvenOdd);var e=[],k=new g.Clipper(0);k.StrictlySimple=!0;k.AddPaths(b,g.PolyType.ptSubject,
!0);k.Execute(g.ClipType.ctUnion,e,d,d);return e};g.Clipper.DistanceSqrd=function(b,d){var e=b.X-d.X,g=b.Y-d.Y;return e*e+g*g};g.Clipper.DistanceFromLineSqrd=function(b,d,e){var g=d.Y-e.Y;e=e.X-d.X;d=g*d.X+e*d.Y;d=g*b.X+e*b.Y-d;return d*d/(g*g+e*e)};g.Clipper.SlopesNearCollinear=function(b,d,e,k){return Math.abs(b.X-d.X)>Math.abs(b.Y-d.Y)?b.X>d.X==b.X<e.X?g.Clipper.DistanceFromLineSqrd(b,d,e)<k:d.X>b.X==d.X<e.X?g.Clipper.DistanceFromLineSqrd(d,b,e)<k:g.Clipper.DistanceFromLineSqrd(e,b,d)<k:b.Y>d.Y==
b.Y<e.Y?g.Clipper.DistanceFromLineSqrd(b,d,e)<k:d.Y>b.Y==d.Y<e.Y?g.Clipper.DistanceFromLineSqrd(d,b,e)<k:g.Clipper.DistanceFromLineSqrd(e,b,d)<k};g.Clipper.PointsAreClose=function(b,d,e){var g=b.X-d.X;b=b.Y-d.Y;return g*g+b*b<=e};g.Clipper.ExcludeOp=function(b){var d=b.Prev;d.Next=b.Next;b.Next.Prev=d;d.Idx=0;return d};g.Clipper.CleanPolygon=function(b,d){"undefined"==typeof d&&(d=1.415);var e=b.length;if(0==e)return[];for(var k=Array(e),n=0;n<e;++n)k[n]=new g.OutPt;for(n=0;n<e;++n)k[n].Pt=b[n],k[n].Next=
k[(n+1)%e],k[n].Next.Prev=k[n],k[n].Idx=0;n=d*d;for(k=k[0];0==k.Idx&&k.Next!=k.Prev;)g.Clipper.PointsAreClose(k.Pt,k.Prev.Pt,n)?(k=g.Clipper.ExcludeOp(k),e--):g.Clipper.PointsAreClose(k.Prev.Pt,k.Next.Pt,n)?(g.Clipper.ExcludeOp(k.Next),k=g.Clipper.ExcludeOp(k),e-=2):g.Clipper.SlopesNearCollinear(k.Prev.Pt,k.Pt,k.Next.Pt,n)?(k=g.Clipper.ExcludeOp(k),e--):(k.Idx=1,k=k.Next);3>e&&(e=0);for(var q=Array(e),n=0;n<e;++n)q[n]=new g.IntPoint(k.Pt),k=k.Next;return q};g.Clipper.CleanPolygons=function(b,d){for(var e=
Array(b.length),k=0,n=b.length;k<n;k++)e[k]=g.Clipper.CleanPolygon(b[k],d);return e};g.Clipper.Minkowski=function(b,d,e,k){k=k?1:0;var n=b.length,q=d.length,v=[];if(e)for(e=0;e<q;e++){for(var C=Array(n),F=0,E=b.length,H=b[F];F<E;F++,H=b[F])C[F]=new g.IntPoint(d[e].X+H.X,d[e].Y+H.Y);v.push(C)}else for(e=0;e<q;e++){C=Array(n);F=0;E=b.length;for(H=b[F];F<E;F++,H=b[F])C[F]=new g.IntPoint(d[e].X-H.X,d[e].Y-H.Y);v.push(C)}b=[];for(e=0;e<q-1+k;e++)for(F=0;F<n;F++)d=[],d.push(v[e%q][F%n]),d.push(v[(e+1)%
q][F%n]),d.push(v[(e+1)%q][(F+1)%n]),d.push(v[e%q][(F+1)%n]),g.Clipper.Orientation(d)||d.reverse(),b.push(d);return b};g.Clipper.MinkowskiSum=function(b,d,e){if(d[0]instanceof Array){v=d;d=new g.Paths;for(var k=new g.Clipper,n=0;n<v.length;++n){var q=g.Clipper.Minkowski(b,v[n],!0,e);k.AddPaths(q,g.PolyType.ptSubject,!0);e&&(q=g.Clipper.TranslatePath(v[n],b[0]),k.AddPath(q,g.PolyType.ptClip,!0))}k.Execute(g.ClipType.ctUnion,d,g.PolyFillType.pftNonZero,g.PolyFillType.pftNonZero);return d}var v=g.Clipper.Minkowski(b,
d,!0,e),k=new g.Clipper;k.AddPaths(v,g.PolyType.ptSubject,!0);k.Execute(g.ClipType.ctUnion,v,g.PolyFillType.pftNonZero,g.PolyFillType.pftNonZero);return v};g.Clipper.TranslatePath=function(b,d){for(var e=new g.Path,k=0;k<b.length;k++)e.push(new g.IntPoint(b[k].X+d.X,b[k].Y+d.Y));return e};g.Clipper.MinkowskiDiff=function(b,d){var e=g.Clipper.Minkowski(b,d,!1,!0),k=new g.Clipper;k.AddPaths(e,g.PolyType.ptSubject,!0);k.Execute(g.ClipType.ctUnion,e,g.PolyFillType.pftNonZero,g.PolyFillType.pftNonZero);
return e};g.Clipper.PolyTreeToPaths=function(b){var d=[];g.Clipper.AddPolyNodeToPaths(b,g.Clipper.NodeType.ntAny,d);return d};g.Clipper.AddPolyNodeToPaths=function(b,d,e){var k=!0;switch(d){case g.Clipper.NodeType.ntOpen:return;case g.Clipper.NodeType.ntClosed:k=!b.IsOpen}0<b.m_polygon.length&&k&&e.push(b.m_polygon);k=0;b=b.Childs();for(var n=b.length,q=b[k];k<n;k++,q=b[k])g.Clipper.AddPolyNodeToPaths(q,d,e)};g.Clipper.OpenPathsFromPolyTree=function(b){for(var d=new g.Paths,e=0,k=b.ChildCount();e<
k;e++)b.Childs()[e].IsOpen&&d.push(b.Childs()[e].m_polygon);return d};g.Clipper.ClosedPathsFromPolyTree=function(b){var d=new g.Paths;g.Clipper.AddPolyNodeToPaths(b,g.Clipper.NodeType.ntClosed,d);return d};X(g.Clipper,g.ClipperBase);g.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2};g.ClipperOffset=function(b,d){"undefined"==typeof b&&(b=2);"undefined"==typeof d&&(d=g.ClipperOffset.def_arc_tolerance);this.m_destPolys=new g.Paths;this.m_srcPoly=new g.Path;this.m_destPoly=new g.Path;this.m_normals=[];
this.m_StepsPerRad=this.m_miterLim=this.m_cos=this.m_sin=this.m_sinA=this.m_delta=0;this.m_lowest=new g.IntPoint;this.m_polyNodes=new g.PolyNode;this.MiterLimit=b;this.ArcTolerance=d;this.m_lowest.X=-1};g.ClipperOffset.two_pi=6.28318530717959;g.ClipperOffset.def_arc_tolerance=.25;g.ClipperOffset.prototype.Clear=function(){g.Clear(this.m_polyNodes.Childs());this.m_lowest.X=-1};g.ClipperOffset.Round=g.Clipper.Round;g.ClipperOffset.prototype.AddPath=function(b,d,e){var k=b.length-1;if(!(0>k)){var n=
new g.PolyNode;n.m_jointype=d;n.m_endtype=e;if(e==g.EndType.etClosedLine||e==g.EndType.etClosedPolygon)for(;0<k&&g.IntPoint.op_Equality(b[0],b[k]);)k--;n.m_polygon.push(b[0]);var q=0;d=0;for(var v=1;v<=k;v++)g.IntPoint.op_Inequality(n.m_polygon[q],b[v])&&(q++,n.m_polygon.push(b[v]),b[v].Y>n.m_polygon[d].Y||b[v].Y==n.m_polygon[d].Y&&b[v].X<n.m_polygon[d].X)&&(d=q);if(!(e==g.EndType.etClosedPolygon&&2>q)&&(this.m_polyNodes.AddChild(n),e==g.EndType.etClosedPolygon))if(0>this.m_lowest.X)this.m_lowest=
new g.IntPoint(this.m_polyNodes.ChildCount()-1,d);else if(b=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],n.m_polygon[d].Y>b.Y||n.m_polygon[d].Y==b.Y&&n.m_polygon[d].X<b.X)this.m_lowest=new g.IntPoint(this.m_polyNodes.ChildCount()-1,d)}};g.ClipperOffset.prototype.AddPaths=function(b,d,e){for(var g=0,k=b.length;g<k;g++)this.AddPath(b[g],d,e)};g.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!g.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var b=
0;b<this.m_polyNodes.ChildCount();b++){var d=this.m_polyNodes.Childs()[b];(d.m_endtype==g.EndType.etClosedPolygon||d.m_endtype==g.EndType.etClosedLine&&g.Clipper.Orientation(d.m_polygon))&&d.m_polygon.reverse()}else for(b=0;b<this.m_polyNodes.ChildCount();b++)d=this.m_polyNodes.Childs()[b],d.m_endtype!=g.EndType.etClosedLine||g.Clipper.Orientation(d.m_polygon)||d.m_polygon.reverse()};g.ClipperOffset.GetUnitNormal=function(b,d){var e=d.X-b.X,k=d.Y-b.Y;if(0==e&&0==k)return new g.DoublePoint(0,0);var n=
1/Math.sqrt(e*e+k*k);return new g.DoublePoint(k*n,-(e*n))};g.ClipperOffset.prototype.DoOffset=function(b){this.m_destPolys=[];this.m_delta=b;if(g.ClipperBase.near_zero(b))for(var d=0;d<this.m_polyNodes.ChildCount();d++){var e=this.m_polyNodes.Childs()[d];e.m_endtype==g.EndType.etClosedPolygon&&this.m_destPolys.push(e.m_polygon)}else{this.m_miterLim=2<this.MiterLimit?2/(this.MiterLimit*this.MiterLimit):.5;var k=3.14159265358979/Math.acos(1-(0>=this.ArcTolerance?g.ClipperOffset.def_arc_tolerance:this.ArcTolerance>
Math.abs(b)*g.ClipperOffset.def_arc_tolerance?Math.abs(b)*g.ClipperOffset.def_arc_tolerance:this.ArcTolerance)/Math.abs(b));this.m_sin=Math.sin(g.ClipperOffset.two_pi/k);this.m_cos=Math.cos(g.ClipperOffset.two_pi/k);this.m_StepsPerRad=k/g.ClipperOffset.two_pi;0>b&&(this.m_sin=-this.m_sin);for(d=0;d<this.m_polyNodes.ChildCount();d++){e=this.m_polyNodes.Childs()[d];this.m_srcPoly=e.m_polygon;var n=this.m_srcPoly.length;if(!(0==n||0>=b&&(3>n||e.m_endtype!=g.EndType.etClosedPolygon))){this.m_destPoly=
[];if(1==n)if(e.m_jointype==g.JoinType.jtRound)for(var e=1,n=0,q=1;q<=k;q++){this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[0].X+e*b),g.ClipperOffset.Round(this.m_srcPoly[0].Y+n*b)));var v=e,e=e*this.m_cos-this.m_sin*n,n=v*this.m_sin+n*this.m_cos}else for(n=e=-1,q=0;4>q;++q)this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[0].X+e*b),g.ClipperOffset.Round(this.m_srcPoly[0].Y+n*b))),0>e?e=1:0>n?n=1:e=-1;else{for(q=this.m_normals.length=0;q<n-1;q++)this.m_normals.push(g.ClipperOffset.GetUnitNormal(this.m_srcPoly[q],
this.m_srcPoly[q+1]));e.m_endtype==g.EndType.etClosedLine||e.m_endtype==g.EndType.etClosedPolygon?this.m_normals.push(g.ClipperOffset.GetUnitNormal(this.m_srcPoly[n-1],this.m_srcPoly[0])):this.m_normals.push(new g.DoublePoint(this.m_normals[n-2]));if(e.m_endtype==g.EndType.etClosedPolygon)for(v=n-1,q=0;q<n;q++)v=this.OffsetPoint(q,v,e.m_jointype);else if(e.m_endtype==g.EndType.etClosedLine){v=n-1;for(q=0;q<n;q++)v=this.OffsetPoint(q,v,e.m_jointype);this.m_destPolys.push(this.m_destPoly);this.m_destPoly=
[];v=this.m_normals[n-1];for(q=n-1;0<q;q--)this.m_normals[q]=new g.DoublePoint(-this.m_normals[q-1].X,-this.m_normals[q-1].Y);this.m_normals[0]=new g.DoublePoint(-v.X,-v.Y);v=0;for(q=n-1;0<=q;q--)v=this.OffsetPoint(q,v,e.m_jointype)}else{v=0;for(q=1;q<n-1;++q)v=this.OffsetPoint(q,v,e.m_jointype);e.m_endtype==g.EndType.etOpenButt?(q=n-1,v=new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[q].X+this.m_normals[q].X*b),g.ClipperOffset.Round(this.m_srcPoly[q].Y+this.m_normals[q].Y*b)),this.m_destPoly.push(v),
v=new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[q].X-this.m_normals[q].X*b),g.ClipperOffset.Round(this.m_srcPoly[q].Y-this.m_normals[q].Y*b)),this.m_destPoly.push(v)):(q=n-1,v=n-2,this.m_sinA=0,this.m_normals[q]=new g.DoublePoint(-this.m_normals[q].X,-this.m_normals[q].Y),e.m_endtype==g.EndType.etOpenSquare?this.DoSquare(q,v):this.DoRound(q,v));for(q=n-1;0<q;q--)this.m_normals[q]=new g.DoublePoint(-this.m_normals[q-1].X,-this.m_normals[q-1].Y);this.m_normals[0]=new g.DoublePoint(-this.m_normals[1].X,
-this.m_normals[1].Y);v=n-1;for(q=v-1;0<q;--q)v=this.OffsetPoint(q,v,e.m_jointype);e.m_endtype==g.EndType.etOpenButt?(v=new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*b),g.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*b)),this.m_destPoly.push(v),v=new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*b),g.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*b)),this.m_destPoly.push(v)):(this.m_sinA=0,e.m_endtype==g.EndType.etOpenSquare?
this.DoSquare(0,1):this.DoRound(0,1))}}this.m_destPolys.push(this.m_destPoly)}}}};g.ClipperOffset.prototype.Execute=function(){var b=arguments;if(b[0]instanceof g.PolyTree)if(d=b[0],e=b[1],d.Clear(),this.FixOrientations(),this.DoOffset(e),b=new g.Clipper(0),b.AddPaths(this.m_destPolys,g.PolyType.ptSubject,!0),0<e)b.Execute(g.ClipType.ctUnion,d,g.PolyFillType.pftPositive,g.PolyFillType.pftPositive);else if(e=g.Clipper.GetBounds(this.m_destPolys),k=new g.Path,k.push(new g.IntPoint(e.left-10,e.bottom+
10)),k.push(new g.IntPoint(e.right+10,e.bottom+10)),k.push(new g.IntPoint(e.right+10,e.top-10)),k.push(new g.IntPoint(e.left-10,e.top-10)),b.AddPath(k,g.PolyType.ptSubject,!0),b.ReverseSolution=!0,b.Execute(g.ClipType.ctUnion,d,g.PolyFillType.pftNegative,g.PolyFillType.pftNegative),1==d.ChildCount()&&0<d.Childs()[0].ChildCount())for(b=d.Childs()[0],d.Childs()[0]=b.Childs()[0],d.Childs()[0].m_Parent=d,e=1;e<b.ChildCount();e++)d.AddChild(b.Childs()[e]);else d.Clear();else{var d=b[0],e=b[1];g.Clear(d);
this.FixOrientations();this.DoOffset(e);b=new g.Clipper(0);b.AddPaths(this.m_destPolys,g.PolyType.ptSubject,!0);if(0<e)b.Execute(g.ClipType.ctUnion,d,g.PolyFillType.pftPositive,g.PolyFillType.pftPositive);else{var e=g.Clipper.GetBounds(this.m_destPolys),k=new g.Path;k.push(new g.IntPoint(e.left-10,e.bottom+10));k.push(new g.IntPoint(e.right+10,e.bottom+10));k.push(new g.IntPoint(e.right+10,e.top-10));k.push(new g.IntPoint(e.left-10,e.top-10));b.AddPath(k,g.PolyType.ptSubject,!0);b.ReverseSolution=
!0;b.Execute(g.ClipType.ctUnion,d,g.PolyFillType.pftNegative,g.PolyFillType.pftNegative);0<d.length&&d.splice(0,1)}}};g.ClipperOffset.prototype.OffsetPoint=function(b,d,e){this.m_sinA=this.m_normals[d].X*this.m_normals[b].Y-this.m_normals[b].X*this.m_normals[d].Y;if(1>Math.abs(this.m_sinA*this.m_delta)){if(0<this.m_normals[d].X*this.m_normals[b].X+this.m_normals[b].Y*this.m_normals[d].Y)return this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[d].X*this.m_delta),
g.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[d].Y*this.m_delta))),d}else 1<this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1);if(0>this.m_sinA*this.m_delta)this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[d].X*this.m_delta),g.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[d].Y*this.m_delta))),this.m_destPoly.push(new g.IntPoint(this.m_srcPoly[b])),this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[b].X*
this.m_delta),g.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[b].Y*this.m_delta)));else switch(e){case g.JoinType.jtMiter:e=1+(this.m_normals[b].X*this.m_normals[d].X+this.m_normals[b].Y*this.m_normals[d].Y);e>=this.m_miterLim?this.DoMiter(b,d,e):this.DoSquare(b,d);break;case g.JoinType.jtSquare:this.DoSquare(b,d);break;case g.JoinType.jtRound:this.DoRound(b,d)}return b};g.ClipperOffset.prototype.DoSquare=function(b,d){var e=Math.tan(Math.atan2(this.m_sinA,this.m_normals[d].X*this.m_normals[b].X+
this.m_normals[d].Y*this.m_normals[b].Y)/4);this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_delta*(this.m_normals[d].X-this.m_normals[d].Y*e)),g.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_delta*(this.m_normals[d].Y+this.m_normals[d].X*e))));this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_delta*(this.m_normals[b].X+this.m_normals[b].Y*e)),g.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_delta*(this.m_normals[b].Y-this.m_normals[b].X*
e))))};g.ClipperOffset.prototype.DoMiter=function(b,d,e){e=this.m_delta/e;this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+(this.m_normals[d].X+this.m_normals[b].X)*e),g.ClipperOffset.Round(this.m_srcPoly[b].Y+(this.m_normals[d].Y+this.m_normals[b].Y)*e)))};g.ClipperOffset.prototype.DoRound=function(b,d){for(var e=Math.max(g.Cast_Int32(g.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(Math.atan2(this.m_sinA,this.m_normals[d].X*this.m_normals[b].X+this.m_normals[d].Y*this.m_normals[b].Y)))),
1),k=this.m_normals[d].X,n=this.m_normals[d].Y,q,v=0;v<e;++v)this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+k*this.m_delta),g.ClipperOffset.Round(this.m_srcPoly[b].Y+n*this.m_delta))),q=k,k=k*this.m_cos-this.m_sin*n,n=q*this.m_sin+n*this.m_cos;this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[b].X*this.m_delta),g.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[b].Y*this.m_delta)))};g.Error=function(b){try{throw Error(b);
}catch(d){alert(d.message)}};g.JS={};g.JS.AreaOfPolygon=function(b,d){d||(d=1);return g.Clipper.Area(b)/(d*d)};g.JS.AreaOfPolygons=function(b,d){d||(d=1);for(var e=0,k=0;k<b.length;k++)e+=g.Clipper.Area(b[k]);return e/(d*d)};g.JS.BoundsOfPath=function(b,d){return g.JS.BoundsOfPaths([b],d)};g.JS.BoundsOfPaths=function(b,d){d||(d=1);var e=g.Clipper.GetBounds(b);e.left/=d;e.bottom/=d;e.right/=d;e.top/=d;return e};g.JS.Clean=function(b,d){if(!(b instanceof Array))return[];var e=b[0]instanceof Array;b=
g.JS.Clone(b);if("number"!=typeof d||null===d)return g.Error("Delta is not a number in Clean()."),b;if(0===b.length||1==b.length&&0===b[0].length||0>d)return b;e||(b=[b]);for(var k=b.length,n,q,v,F,E,H,M,L=[],ia=0;ia<k;ia++)if(q=b[ia],n=q.length,0!==n)if(3>n)v=q,L.push(v);else{v=q;F=d*d;E=q[0];for(M=H=1;M<n;M++)(q[M].X-E.X)*(q[M].X-E.X)+(q[M].Y-E.Y)*(q[M].Y-E.Y)<=F||(v[H]=q[M],E=q[M],H++);E=q[H-1];(q[0].X-E.X)*(q[0].X-E.X)+(q[0].Y-E.Y)*(q[0].Y-E.Y)<=F&&H--;H<n&&v.splice(H,n-H);v.length&&L.push(v)}!e&&
L.length?L=L[0]:e||0!==L.length?e&&0===L.length&&(L=[[]]):L=[];return L};g.JS.Clone=function(b){if(!(b instanceof Array)||0===b.length)return[];if(1==b.length&&0===b[0].length)return[[]];var d=b[0]instanceof Array;d||(b=[b]);var e=b.length,g,k,q,v,F=Array(e);for(k=0;k<e;k++){g=b[k].length;v=Array(g);for(q=0;q<g;q++)v[q]={X:b[k][q].X,Y:b[k][q].Y};F[k]=v}d||(F=F[0]);return F};g.JS.Lighten=function(b,d){if(!(b instanceof Array))return[];if("number"!=typeof d||null===d)return g.Error("Tolerance is not a number in Lighten()."),
g.JS.Clone(b);if(0===b.length||1==b.length&&0===b[0].length||0>d)return g.JS.Clone(b);b[0]instanceof Array||(b=[b]);var e,k,n,q,v,F,E,H,M,L,ia,S,V,X,aa,fa=b.length,ha=d*d,ea=[];for(e=0;e<fa;e++)if(n=b[e],F=n.length,0!=F){for(q=0;1E6>q;q++){v=[];F=n.length;n[F-1].X!=n[0].X||n[F-1].Y!=n[0].Y?(ia=1,n.push({X:n[0].X,Y:n[0].Y}),F=n.length):ia=0;L=[];for(k=0;k<F-2;k++){E=n[k];M=n[k+1];H=n[k+2];X=E.X;aa=E.Y;E=H.X-X;S=H.Y-aa;if(0!==E||0!==S)V=((M.X-X)*E+(M.Y-aa)*S)/(E*E+S*S),1<V?(X=H.X,aa=H.Y):0<V&&(X+=E*
V,aa+=S*V);E=M.X-X;S=M.Y-aa;H=E*E+S*S;H<=ha&&(L[k+1]=1,k++)}v.push({X:n[0].X,Y:n[0].Y});for(k=1;k<F-1;k++)L[k]||v.push({X:n[k].X,Y:n[k].Y});v.push({X:n[F-1].X,Y:n[F-1].Y});ia&&n.pop();if(L.length)n=v;else break}F=v.length;v[F-1].X==v[0].X&&v[F-1].Y==v[0].Y&&v.pop();2<v.length&&ea.push(v)}b[0]instanceof Array||(ea=ea[0]);"undefined"==typeof ea&&(ea=[[]]);return ea};g.JS.PerimeterOfPath=function(b,d,e){if("undefined"==typeof b)return 0;var g=Math.sqrt,k=0,q,v,F,E,H=b.length;if(2>H)return 0;for(d&&(b[H]=
b[0],H++);--H;)q=b[H],F=q.X,q=q.Y,v=b[H-1],E=v.X,v=v.Y,k+=g((F-E)*(F-E)+(q-v)*(q-v));d&&b.pop();return k/e};g.JS.PerimeterOfPaths=function(b,d,e){e||(e=1);for(var k=0,n=0;n<b.length;n++)k+=g.JS.PerimeterOfPath(b[n],d,e);return k};g.JS.ScaleDownPath=function(b,d){var e,g;d||(d=1);for(e=b.length;e--;)g=b[e],g.X/=d,g.Y/=d};g.JS.ScaleDownPaths=function(b,d){var e,g,k;d||(d=1);for(e=b.length;e--;)for(g=b[e].length;g--;)k=b[e][g],k.X/=d,k.Y/=d};g.JS.ScaleUpPath=function(b,d){var e,g,k=Math.round;d||(d=
1);for(e=b.length;e--;)g=b[e],g.X=k(g.X*d),g.Y=k(g.Y*d)};g.JS.ScaleUpPaths=function(b,d){var e,g,k,q=Math.round;d||(d=1);for(e=b.length;e--;)for(g=b[e].length;g--;)k=b[e][g],k.X=q(k.X*d),k.Y=q(k.Y*d)};g.ExPolygons=function(){return[]};g.ExPolygon=function(){this.holes=this.outer=null};g.JS.AddOuterPolyNodeToExPolygons=function(b,d){var e=new g.ExPolygon;e.outer=b.Contour();var k=b.Childs(),n=k.length;e.holes=Array(n);var q,v,F,E,H;for(v=0;v<n;v++)for(q=k[v],e.holes[v]=q.Contour(),F=0,E=q.Childs(),
H=E.length;F<H;F++)q=E[F],g.JS.AddOuterPolyNodeToExPolygons(q,d);d.push(e)};g.JS.ExPolygonsToPaths=function(b){var d,e,k,n,q=new g.Paths;d=0;for(k=b.length;d<k;d++)for(q.push(b[d].outer),e=0,n=b[d].holes.length;e<n;e++)q.push(b[d].holes[e]);return q};g.JS.PolyTreeToExPolygons=function(b){var d=new g.ExPolygons,e,k,n;e=0;k=b.Childs();for(n=k.length;e<n;e++)b=k[e],g.JS.AddOuterPolyNodeToExPolygons(b,d);return d}})();
var CindyJS=function(){function q(k){if(0===ha)return console.error("Waiting for "+k+" after we finished waiting."),function(){};0>ha&&(ha=0);++ha;return function(){--ha;0>ha&&console.error("Wait count mismatch: "+k);if(0===ha)for(var q=0,E=Ga.length;q<E;)Ga[q++].startup()}}function E(k){var q=E.newInstance(k);0>=ha?q.startup():!1!==k.autostart&&Ga.push(q);return q}var ha=-1,Ga=[];"undefined"===typeof document||"undefined"===typeof window||"undefined"===typeof document.addEventListener||"undefined"!==
typeof window.cindyDontWait&&!0===window.cindyDontWait||document.addEventListener("DOMContentLoaded",q("DOMContentLoaded"));var oa=null,Ha=null,ea={};E.getBaseDir=function(){if(null!==oa)return oa;for(var k=document.getElementsByTagName("script"),q=0;q<k.length;++q){var E=k[q],V=E.src;if(V){var S=/Cindy\.js$/.exec(V);if(S)return oa=V.substr(0,S.index),console.log("Will load extensions from "+oa),Ha=E,oa}}console.error("Could not find <script> tag for Cindy.js");return oa=Ha=!1};E.addNewScript=function(k,
q){q||console.error.bind(console);var M=E.getBaseDir();if(!1===M)return!1;var V=document.createElement("script");V.src=M+k;var M=Ha.nextSibling,S=Ha.parentElement;M?S.insertBefore(V,M):S.appendChild(V);return V};E.loadScript=function(k,q,M,V){for(var S=String(k).split("."),fa=window;S.length&&"object"===typeof fa&&null!==fa;)fa=fa[S.shift()];if(fa&&!S.length)return M(),!0;V||(V=console.error.bind(console));S=ea[k];if(!S){S=E.addNewScript(q,V);if(!1===S)return V("Can't load additional components."),
!1;ea[k]=S}S.addEventListener("load",M);S.addEventListener("error",V);return null};E._autoLoadingPlugin={};E.autoLoadPlugin=function(k,q,M){if(E._pluginRegistry[k])return M(),!0;var V=E._autoLoadingPlugin[k];if(!V){q||(q=k+"-plugin.js");V=E._autoLoadingPlugin[k]=[];k=E.addNewScript(q);if(!1===k)return!1;k.addEventListener("error",console.error.bind(console))}V.push(M);return null};var k={ctype:"undefined"};E.waitFor=q;E._pluginRegistry={};E.instances=[];E.registerPlugin=function(k,q,M){if(1!==k)return console.error("Plugin API version "+
k+" not supported"),!1;E._pluginRegistry[q]=M;(E._autoLoadingPlugin[q]||[]).forEach(function(k){k()})};var Pa=0;E.dumpState=function(k){k=E.instances[k||0].saveState();console.log(JSON.stringify(k))};E.debugState=function(k){E.instances.map(function(k){var q=k.config,q=JSON.parse(JSON.stringify(q)),F=k.saveState();console.log(JSON.stringify(F));for(var E in F)q[E]=F[E];k.shutdown();return q}).forEach(function(k){E(k)})};E.newInstance=function(q){function E(){na.width=ba=na.clientWidth;na.height=ca=
na.clientHeight;A.setTransform(1,0,0,1,0,0);y.setMat(25,0,0,25,250.5,250.5);if(Fb)for(var a=0;a<Fb.length;a++){var f=Fb[a],c=Object.keys(f)[0];"scale"===c&&(Vb=f.scale,y[c](f.scale));if("translate"===c)y[c](f.translate[0],f.translate[1]);"scaleAndOrigin"===c&&(Vb=f[c][0]/25,y[c].apply(null,f[c]));"visibleRect"===c&&(y[c].apply(null,f[c]),Vb=y.drawingstate.initialmatrix.a/25)}y.createnewbackup();y.greset();a=1;"undefined"!==typeof window&&window.devicePixelRatio&&(a=window.devicePixelRatio);f=A.webkitBackingStorePixelRatio||
A.mozBackingStorePixelRatio||A.msBackingStorePixelRatio||A.oBackingStorePixelRatio||A.backingStorePixelRatio||1;a!==f&&(a/=f,na.width=ba*a,na.height=ca*a,A.scale(a,a))}function M(a){var f;if("canvas"!==a.tagName.toLowerCase())for(f=a,na=document.createElement("canvas");f.firstChild;)f.removeChild(f.firstChild);else{na=a;f=document.createElement("div");var c=null,p=null;Array.prototype.slice.call(na.attributes).forEach(function(a){"width"===a.name?c=a.value:"height"===a.name?p=a.value:f.setAttributeNodeNS(na.removeAttributeNode(a))});
null===c||f.style.width||(f.style.width=c+"px");null===p||f.style.height||(f.style.height=p+"px");na.parentNode.replaceChild(f,na)}f.classList.add("CindyJS-widget");a=na.style;a.position="absolute";a.border="none";a.margin=a.padding=a.left=a.top="0px";a.width=a.height="100%";a="static";window.getComputedStyle&&(a=window.getComputedStyle(f).getPropertyValue("position"),a=String(a||"static"));"static"===a&&(f.style.position="relative");f.appendChild(na);return na}function V(){var a=q.cinderella;if(!a||
!a.version)return!1;for(var f=0;f<arguments.length;++f){var c=a.version[f],p=arguments[f];if(c!==p)return typeof c===typeof p&&c<p}return!1}function S(){mc=!0;if(0===Wb){if(q.exclusive)for(b=va.instances.length;0<b;)va.instances[--b].shutdown();void 0!==q.csconsole&&(wa=q.csconsole);wa=null===wa?new ua:!0===wa?new Eb:"string"===typeof wa?new ib(wa):"object"===typeof wa&&"function"===typeof wa.appendChild?new ib(wa):new ua;ra=[100,100];var a=null;Fb=q.transform;if(q.ports&&0<q.ports.length){b=q.ports[0];
(a=b.element)||(a=document.getElementById(b.id));var a=M(a),f=a.parentNode.style;"window"===b.fill?(f.width="100vw",f.height="100vh"):"parent"===b.fill?(f.width="100%",f.height="100%"):b.width&&b.height&&(f.width=b.width+"px",f.height=b.height+"px");b.background&&(a.style.backgroundColor=b.background);void 0!==b.transform&&(Fb=b.transform);Ia(b.grid)&&0<b.grid&&(ya=b.grid);Ia(b.tgrid)&&0<b.tgrid&&(nc=b.tgrid);b.snap&&(Gb=!0);b.axes&&(Hb=!0)}a||(a=q.canvas,a||"undefined"===typeof document||(a=document.getElementById(q.canvasname))&&
(a=M(a)));a&&(na=a,A=a.getContext("2d"),E(),A.setLineDash||(A.setLineDash=function(){}),(q.animation?q.animation.controls:q.animcontrols)&&ea(q),q.animation&&Ia(q.animation.speed)&&(void 0===q.animation.accuracy&&V(2,9,1875)?ha(.5*q.animation.speed):ha(q.animation.speed)),q.animation&&Ia(q.animation.accuracy)&&(Xb=q.animation.accuracy));q.statusbar&&(oc="string"===typeof q.statusbar?document.getElementById(q.statusbar):q.statusbar);var c=q.scripts,p=null;"string"===typeof c&&c.search(/\*/)&&(p=c);
"object"!==typeof c&&(c=null);"move keydown keyup keytyped keytype mousedown mouseup mousedrag mousemove mouseclick init tick draw simulationstep simulationstart simulationstop ondrop".split(" ").forEach(function(a){var f;if(null!==c&&c[a])f=c[a];else{f=a+"script";if(q[f])f=document.getElementById(q[f]);else if(p){if(f=document.getElementById(p.replace(/\*/,a)),!f)return}else return;f=f.text}f=Wa(f,!1);"error"===f.ctype?console.error("Error compiling "+a+" script: "+f.message):R[a]=Vd(f,a)});V(2,
9,1888)&&!R.keydown&&(R.keydown=R.keytyped,R.keytyped=R.keytype,R.keytype=void 0);Ia(q.grid)&&0<q.grid&&(ya=q.grid);q.snap&&(Gb=!0);u={};var b=0;db={};q.geometry||(q.geometry=[]);Wd(q.geometry);q.behavior||(q.behavior=[]);"function"===typeof pc&&pc(q.behavior);for(var d in q.images)b=fa(q.images[d],!1),b!==k&&(db[d]=b);for(var h in q.videos)d=fa(q.videos[h],!0),d!==k&&(db[h]=d);sa.canvas=a;if(q.oninit)q.oninit(sa);va.instances.push(sa);q.use&&q.use.forEach(function(a){t.use$1([w.wrap(a)],{})});jb.convexhull3d$1&&
oa("QuickHull3D","QuickHull3D.js");(jb.colorplot$1||jb.colorplot$2||jb.colorplot$3||jb.colorplot$4)&&oa("CindyGL","CindyGL.js");(jb.playtone$1||jb.playmelody$1)&&oa("midi","midi-plugin.js");X()}}function fa(a,f){var c;"string"===typeof a?(f?(c=document.createElement("video"),c.preload="auto",c.loop=!0,c.setAttribute("playsinline",""),enableInlineVideo(c)):c=new Image,c.src=a):c=a;if(!c.tagName)return console.error("Not a valid image element",c),k;var p={img:c,width:NaN,height:NaN,ready:!0,live:!1,
generation:0,whenReady:g},b=c.tagName.toLowerCase(),d=[];if("img"===b)c.complete?(p.width=c.width,p.height=c.height):(p.ready=!1,c.addEventListener("load",function(){p.width=c.width;p.height=c.height;p.ready=!0;p.whenReady=g;d.forEach(g);e()}),p.whenReady=d.push.bind(d));else if("video"===b)p.live=!0,c.readyState>=c.HAVE_METADATA?(p.width=c.videoWidth,p.height=c.videoHeight):(p.ready=!1,c.addEventListener("loadedmetadata",function(){p.width=c.videoWidth;p.height=c.videoHeight;p.ready=!0;p.whenReady=
g;d.forEach(g);e()}),p.whenReady=d.push.bind(d));else if("canvas"===b)p.width=c.width,p.height=c.height;else return console.error("Not a valid image element",b,c),k;return{ctype:"image",value:p}}function ea(a){function f(a,c){var f=document.createElement("button"),p=document.createElement("img");f.appendChild(p);l.appendChild(f);Ib(p,a);f.addEventListener("click",c);Xa[a]=function(a){a?f.classList.add("CindyJS-active"):f.classList.remove("CindyJS-active")}}function c(a){if(k){var c=e.getBoundingClientRect();
ha(h*(a.clientX-c.left-e.clientLeft+.5)/c.width+b)}}var p=document.createElement("div");p.className="CindyJS-animcontrols";na.parentNode.appendChild(p);var b=0,d=1,h=1;a.animation&&a.animation.speedRange&&Ia(a.animation.speedRange[0])&&Ia(a.animation.speedRange[1])&&(b=a.animation.speedRange[0],d=a.animation.speedRange[1],h=d-b);var e=document.createElement("div");e.className="CindyJS-animspeed";p.appendChild(e);var g=document.createElement("div");e.appendChild(g);H(e,"mousedown",function(a){k=!0;
c(a)});H(e,"mousemove",c);H(na.parentNode,"mouseup",function(a){k=!1},!0);var l=document.createElement("div");l.className="CindyJS-animbuttons";p.appendChild(l);f("play",L);f("pause",Ga);f("stop",Ha);Xa.stop(!0);qc=function(a){a=(a-b)/h;a=Math.max(0,Math.min(1,a));a=.1*Math.round(1E3*a);g.style.width=a+"%"};var k=!1}function ha(a){Yc=a;qc&&qc(a)}function g(a){return a()}function oa(a,f,c){var p=null;q.plugins&&(p=q.plugins[a]);p||(p=va._pluginRegistry[a]);p?t.use$1([w.wrap(a)],{}):(++Zc,va.autoLoadPlugin(a,
f,function(){t.use$1([w.wrap(a)],{});X(c)}))}function X(a){0===--Zc&&(a?e():(z(R.init),(q.animation||q).autoplay&&L(),sa.canvas&&kc(sa.canvas,q)))}function aa(){null!==Jb&&(ma.set(Jb.state),Object.keys(Jb.speeds).forEach(function(a){var f=u.csnames[a];"undefined"!==typeof f.behavior&&(a=Jb.speeds[a],f.behavior.vx=a[0],f.behavior.vy=a[1],f.behavior.vz=a[2],f.behavior.fx=0,f.behavior.fy=0,f.behavior.fz=0)}),$c())}function L(){if(!eb){if(Zb){var a=Ya.backup;a.set(ma);for(var f={},c=0;c<u.points.length;c++){var p=
u.points[c];"undefined"!==typeof p.behavior&&(f[p.name]=[p.behavior.vx,p.behavior.vy,p.behavior.vz])}Jb={state:a,speeds:f};Kb=0;Zb=!1;Xa.stop(!1)}else Xa.pause(!1);rc=Date.now();Xa.play(!0);"function"===typeof pc&&sc&&Xd();eb=!0;z(R.simulationstart);e()}}function Ga(){eb&&(Xa.play(!1),Xa.pause(!0),eb=!1)}function Ha(){Zb||(eb?(z(R.simulationstop),eb=!1,Xa.play(!1)):Xa.pause(!1),Xa.stop(!0),Zb=!0,aa())}function Ua(){if(!$b){$b=!0;for(var a=va.instances.length;0<a;)if(va.instances[--a]===sa){va.instances.splice(a,
1);break}for(a=kb.length;0<a;)try{kb[--a]()}catch(f){console.error(f)}}}function hb(a){this["in"]=function(a,c){console.log(a);c?this.append(this.createTextNode("span","blue",a)):this.append(this.createTextNode("p","blue",a))};this.out=function(a,c){console.log(a);c?this.append(this.createTextNode("span","red",a)):this.append(this.createTextNode("p","red",a))};this.err=function(a,c){console.log(a);c?this.append(this.createTextNode("span","red",a)):this.append(this.createTextNode("p","red",a))};this.createTextNode=
function(a,c,p){return"undefined"!==typeof document?(a=document.createElement(a),a.appendChild(document.createTextNode(p)),a.style.color=c,a):p+"\n"}}function Eb(){var a=this,f,c=document.createElement("div"),p;c.innerHTML='<div id="console" style="border-top: 1px solid #333333; bottom: 0px; position: absolute; width: 100%;"><div id="log" style="height: 150px; overflow-y: auto;"></div><input id="cmd" type="text" style="box-sizing: border-box; height: 30px; width: 100%;"></div>';document.body.appendChild(c);
f=document.getElementById("cmd");p=document.getElementById("log");f.onkeydown=function(c){13===c.keyCode&&""!==f.value&&(a["in"](f.value),c=t.parse$1([w.wrap(f.value)],[]),c=z(c),console.log(Y(c)),"undefined"!==c.ctype&&wa.out(Y(c)),f.value="",p.scrollTop=p.scrollHeight)};this.append=function(a){p.appendChild(a)};this.clear=function(){p.innerHTML=""}}function ib(a){var f=a;"string"===typeof a&&(f=document.getElementById(a));this.append=function(a){f.appendChild(a)};this.clear=function(){f.innerHTML=
""}}function ua(){this.append=function(a){};this.clear=function(){}}function H(a,f,c,p){void 0===p&&(p=!1);kb.push(function(){a.removeEventListener(f,c,p)});a.addEventListener(f,c,p)}function kc(a,f){function c(c){var f=a.getBoundingClientRect();c=y.to(c.clientX-f.left-a.clientLeft+.5,c.clientY-f.top-a.clientTop+.5);Z.prevx=Z.x;Z.prevy=Z.y;Z.x=c[0];Z.y=c[1];ra[0]=Z.x;ra[1]=Z.y;e()}function p(a){for(var c=a.changedTouches,f=!1,p=0;p<c.length;p++)c[p].identifier===qa&&(f=!0);f&&(qa=-1,Z.down=!1,ja=
void 0,z(R.mouseup),xb("mouseup"),e(),a.preventDefault())}var b=null;"undefined"!==typeof MutationObserver&&(b=MutationObserver);b||"undefined"===typeof WebKitMutationObserver||(b=WebKitMutationObserver);b?(b=new b(function(c){document.body.contains(a)||Ua()}),b.observe(document.documentElement,{childList:!0,subtree:!0}),kb.push(function(){b.disconnect()})):(H(a,"DOMNodeRemovedFromDocument",Ua),H(a,"DOMNodeRemoved",Ua));if(!0===f.keylistener)H(document,"keydown",function(a){J(a,R.keydown);return!1}),
H(document,"keyup",function(a){J(a,R.keyup);return!1}),H(document,"keypress",function(a){J(a,R.keytyped);return!1});else if(R.keydown||R.keyup||R.keytyped)a.setAttribute("tabindex","0"),H(a,"mousedown",function(){a.focus()}),H(a,"keydown",function(a){9!==a.keyCode&&(J(a,R.keydown),R.keytyped||a.preventDefault())}),H(a,"keyup",function(a){J(a,R.keyup);a.preventDefault()}),H(a,"keypress",function(a){9!==a.keyCode&&(J(a,R.keytyped),a.preventDefault())});H(a,"mousedown",function(a){Z.button=a.which;c(a);
z(R.mousedown);xb("mousedown");Z.down=!0;a.preventDefault()});H(a,"mouseup",function(a){Z.down=!1;ja=void 0;z(R.mouseup);xb("mouseup");e();a.preventDefault()});H(a,"mousemove",function(a){c(a);Z.down?z(R.mousedrag):z(R.mousemove);xb("mousemove");a.preventDefault()});H(a,"click",function(a){c(a);z(R.mouseclick);a.preventDefault()});H(a,"dragenter",function(a){a.preventDefault()});H(a,"dragover",function(a){a.preventDefault()});H(a,"drop",function(c){function f(a,c){function h(){e.readyState===XMLHttpRequest.DONE&&
(200!==e.status?(console.error("GET request for "+a+" failed: "+(e.responseText||"(no error message)")),d(c,k)):b(c,e.responseText))}var qa=a.replace(/[?#][^]*/,""),qa=qa.replace(/[^]*\/([^\/])/,"$1");g[c]={type:"",name:qa};var e=new XMLHttpRequest;e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE)if(200!==e.status)console.error("HEAD request for "+a+" failed: "+(e.responseText||"(no error message)")),d(c,k);else{var f=e.getResponseHeader("Content-Type");g[c].type=f;/^image\//.test(f)?
pa(c,a):p(f)?(e=new XMLHttpRequest,e.onreadystatechange=h,e.open("GET",a),e.send()):d(c,k)}};e.open("HEAD",a);e.send()}function p(a){a=a.replace(/;[^]*/,"");return/^text\//.test(a)?1:"application/json"===a?2:0}function b(a,c){switch(p(g[a].type)){case 1:d(a,w.string(c));break;case 2:var f,pa;try{f=JSON.parse(c),pa=w.wrapJSON(f)}catch(h){console.error(h),pa=k}d(a,pa);break;default:d(a,k)}}function pa(a,c){var f=new Image,p=!1;f.onload=function(){p||(p=!0,d(a,fa(f,!1)))};f.onerror=function(c){p||(p=
!0,console.error(c),d(a,k))};f.src=c}function d(a,c,f){l[a]=h.turnIntoCSList([c,w.string(f||c.ctype),w.string(g[a].type),w.string(g[a].name)]);0===--m&&(a=q,tc=h.turnIntoCSList(l),uc=a,z(R.ondrop),uc=tc=k,e())}c.preventDefault();var qa=c.dataTransfer,g=qa.files,l=Array(g.length),m=g.length,n=c.currentTarget.getBoundingClientRect(),q=h.realVector(y.to(c.clientX-n.left-a.clientLeft+.5,c.clientY-n.top-a.clientTop+.5));if(0<g.length)Array.prototype.forEach.call(g,function(a,c){var f=new FileReader;p(a.type)?
(f.onload=function(){b(c,f.result)},f.readAsText(a)):/^image\//.test(a.type)?(f.onload=function(){pa(c,f.result)},f.readAsDataURL(a)):(console.log("Unknown MIME type: "+a.type),d(c,k))});else if(c=qa.getData("text/uri-list"))c=c.split("\n").filter(function(a){return!/^\s*(#|$)/.test(a)}),m=c.length,l=Array(m),g=Array(m),c.forEach(f)});var qa=-1;H(a,"touchstart",function(a){if(-1===qa){var f=a.changedTouches;0!==f.length&&(qa=f[0].identifier,c(a.targetTouches[0]),z(R.mousedown),Z.down=!0,xb("mousedown"),
a.preventDefault())}},!1);H(a,"touchmove",function(a){for(var f=a.changedTouches,p=!1,b=0;b<f.length;b++)f[b].identifier===qa&&(p=!0);p&&(c(a.targetTouches[0]),Z.down?z(R.mousedrag):z(R.mousemove),xb("mousemove"),a.preventDefault())},!0);H(a,"touchend",p,!1);"undefined"!==typeof document&&document.body&&H(document.body,"touchcancel",p,!1);"undefined"!==typeof window&&H(window,"resize",function(){ac(function(){E();e()})},!1);d(a.parentNode);e()}function b(a,f){var c=document.createElement("div");c.setAttribute("style",
f);a.appendChild(c);return c}function d(a){function f(){p.scrollLeft=p.scrollTop=pa.scrollLeft=pa.scrollTop=1E5}function c(){if(d!==a.clientWidth||h!==a.clientHeight)d=a.clientWidth,h=a.clientHeight,g||(g=!0,ac(function(){g=!1;E();e()}));f()}if("undefined"!==typeof document){var p=b(a,"position: absolute; transition: 0s; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;");b(p,"position: absolute; transition: 0s; left: 0; top: 0; width: 100000px; height: 100000px");
var pa=b(a,"position: absolute; transition: 0s; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;");b(pa,"position: absolute; transition: 0s; left: 0; top: 0; width: 200%; height: 200%");f();var d=a.clientWidth,h=a.clientHeight,g=!1;p.addEventListener("scroll",c);pa.addEventListener("scroll",c)}}function e(){vc||(vc=ac(r))}function r(){vc=null;if(!$b){if(eb){var a=Date.now(),f=Math.min(50,a-rc)*Yc*Yd;rc=a;a=Kb+f;sc&&"undefined"!==typeof xa&&xa.tick(f);Kb=a;eb&&
z(R.tick)}n();eb&&e()}}function n(){y.reset();A.save();A.clearRect(0,0,ba,ca);var a=y.drawingstate.matrix,f,c,p,b,d;if(0!==ya){A.beginPath();A.strokeStyle="rgba(0,0,0,0.1)";A.lineWidth=1;A.lineCap="butt";f=ya*a.a;for(b=Math.ceil(-a.tx/f);(d=b*f+a.tx)<ba;){if(b||!Hb)A.moveTo(d,0),A.lineTo(d,ca);b++}for(b=Math.floor(a.ty/f);(d=b*f-a.ty)<ca;){if(b||!Hb)A.moveTo(0,d),A.lineTo(ba,d);b++}A.stroke()}if(0!==nc){A.beginPath();A.strokeStyle="rgba(0,0,0,0.1)";A.lineWidth=1;A.lineCap="butt";f=nc*a.a;var e=Math.sqrt(3);
c=a.ty/e;p=(ca+a.ty)/e;for(b=Math.ceil(-(a.tx+p)/f);(d=b*f+a.tx)+c<ba;)A.moveTo(d+c,0),A.lineTo(d+p,ca),b++;for(b=Math.ceil(-(a.tx-c)/f);(d=b*f+a.tx)-p<ba;)A.moveTo(d-c,0),A.lineTo(d-p,ca),b++;f*=.5*e;for(b=Math.floor(a.ty/f);(d=b*f-a.ty)<ca;){if(b||!Hb)A.moveTo(0,d),A.lineTo(ba,d);b++}A.stroke()}Hb&&(A.beginPath(),A.strokeStyle="rgba(0,0,0,0.2)",A.lineWidth=3,A.lineCap="butt",A.lineJoin="miter",A.miterLimit=10,A.beginPath(),A.moveTo(0,-a.ty),A.lineTo(ba-6,-a.ty),A.moveTo(ba-13,-5-a.ty),A.lineTo(ba-
3,-a.ty),A.lineTo(ba-13,5-a.ty),A.moveTo(a.tx,ca),A.lineTo(a.tx,6),A.moveTo(a.tx-5,13),A.lineTo(a.tx,3),A.lineTo(a.tx+5,13),A.stroke());Zd();y.greset();$d();for(a=0;a<u.polygons.length;a++)f=u.polygons[a],f.isshowing&&!1!==f.visible&&(c={color:f.color,alpha:f.alpha,fillcolor:f.fillcolor,fillalpha:f.fillalpha,size:f.size,lineJoin:w.string("miter"),fillrule:w.string(f.fillrule)},D.drawpolygon([f.vertices],c,"D",!0));for(a=0;a<u.conics.length;a++)u.conics[a].isArc?(f=u.conics[a],f.isshowing&&!1!==f.visible&&
(c={},c.color=f.color,c.alpha=f.alpha,c.size=f.size,D.drawarc(f,c,f.filled?"F":"D"))):(f=u.conics[a],f.isshowing&&!1!==f.visible&&(c={},c.color=f.color,c.alpha=f.alpha,c.size=f.size,D.drawconic(f.matrix,c)));for(a=0;a<u.lines.length;a++)a:if(f=u.lines[a],f.isshowing&&!1!==f.visible&&h._helper.isAlmostReal(f.homog))if("S"===f.kind)c={overhang:f.overhang,dashtype:f.dashtype,size:f.size,color:f.color,alpha:f.alpha,arrow:f.arrow,arrowsize:f.arrowsize,arrowposition:f.arrowposition,arrowshape:f.arrowshape,
arrowsides:f.arrowsides},0<=l.mult(f.startpos.value[2],l.conjugate(f.endpos.value[2])).value.real?(t.draw$2([f.startpos,f.endpos],c),f.labeled&&!f.tmp&&(c=f.printname||f.name||"S",p=h.scalmult(l.real(Math.sign(f.startpos.value[2].value.real)*Math.sign(f.endpos.value[2].value.real)),h.cross(f.startpos,f.endpos)),p={x:p.value[0].value.real,y:p.value[1].value.real},b=Math.sqrt(p.x*p.x+p.y*p.y),p={x:8*p.x/b-3,y:8*p.y/b-3},p=f.labelpos||p,b=x.makeColor(ga.textColor),d=m._helper.midpoint(m._helper.midpoint(f.startpos,
f.endpos),f.endpos),ad(f,c,d,p,b))):(x.handleModifs(c,x.lineModifs),x.drawRaySegment(f.startpos,f.endpos));else if("end"===f.clip.value&&"Join"===f.type)b=u.csnames[f.args[0]],c=u.csnames[f.args[1]],t.draw$2([b.homog,c.homog],{overhang:f.overhang,dashtype:f.dashtype,size:f.size,color:f.color,alpha:f.alpha});else{if("inci"===f.clip.value){b=[1E6,0];c=[-1E6,0];d=[1E6,0];p=[-1E6,0];for(e=0;e<f.incidences.length;e++){var g=u.csnames[f.incidences[e]].homog,k=g.value[0],Qa=g.value[1],n=g.value[2];l._helper.isAlmostZero(n)||
(k=l.div(k,n),Qa=l.div(Qa,n),l._helper.isAlmostReal(k)&&l._helper.isAlmostReal(Qa)&&(k.value.real<b[0]&&(b=[k.value.real,g]),k.value.real>c[0]&&(c=[k.value.real,g]),Qa.value.real<d[0]&&(d=[Qa.value.real,g]),Qa.value.real>p[0]&&(p=[Qa.value.real,g])))}c[0]-b[0]>p[0]-d[0]?(b=b[1],c=c[1]):(b=d[1],c=p[1]);if(b!==c){t.draw$2([b,c],{dashtype:f.dashtype,size:f.size,color:f.color,alpha:f.alpha,overhang:f.overhang});break a}}t.draw$1([f.homog],{dashtype:f.dashtype,size:f.size,color:f.color,alpha:f.alpha})}for(a=
0;a<u.points.length;a++)if(f=u.points[a],f.isshowing&&!1!==f.visible&&h._helper.isAlmostReal(f.homog)&&(c=f.color,f.behavior&&(c=f.color),t.draw$1([f.homog],{size:f.size,color:c,alpha:f.alpha,noborder:f.noborder,border:f.border}),f.labeled&&!f.tmp)){p=f.printname||f.name||"P";b=f.labelpos||{x:3,y:3};d=x.makeColor(ga.textColor);if(!0===f.noborder.value||!1===f.border.value)d=c;ad(f,p,f.homog,b,d)}for(a=0;a<u.texts.length;a++)ae(u.texts[a]);if(u.ifs.length){if(U.dirty||!w.deeplyEqual(U.mat,y.drawingstate.matrix))m.IFS.updateParameters(),
U.dirty=!1;U.img&&A.drawImage(U.img,0,0,ba,ca)}A.restore()}function J(a,f){var c=window.event?event:a,c=c.charCode?c.charCode:c.keyCode;bd=String.fromCharCode(c);cd=c;z(f);e()}function v(a){var f=a.value;a=f[0].value;var c=f[1].value,f=f[2].value;return h.turnIntoCSList([a[0],l.add(a[1],c[0]),l.add(a[2],f[0]),c[1],l.add(c[2],f[1]),f[2]])}function C(a){var f=!0;return function(c,p){f&&(console.error("Operator "+a+" is not supported yet."),f=!1);return k}}function Y(a){if("undefined"===typeof a)return"_??_";
if(null===a)return"_???_";if("undefined"===a.ctype)return"___";if("number"===a.ctype)return l.niceprint(a);if("string"===a.ctype||"boolean"===a.ctype)return a.value;if("list"===a.ctype){for(var f="[",c=0;c<a.value.length;c++)f+=Y(z(a.value[c])),c!==a.value.length-1&&(f+=", ");return f+"]"}return"dict"===a.ctype?Ma.niceprint(a):"function"===a.ctype?"FUNCTION":"infix"===a.ctype?"INFIX":"modifier"===a.ctype?a.key+"->"+Y(a.value):"shape"===a.ctype?a.type:"error"===a.ctype?"Error: "+a.message:"variable"===
a.ctype?Y(I.getvar(a.name)):"geo"===a.ctype?a.value.name:"image"===a.ctype?"IMAGE":"_?_"}function cb(a,f){var c="undefined"===a[0].ctype,p="undefined"===a[1].ctype,b=z(a[1]);if(c||p)return k;"variable"===a[0].ctype?I.setvar(a[0].name,b):"infix"===a[0].ctype?"_"===a[0].oper?D.assigntake(a[0],b):da("Can't use infix expression as lvalue"):"field"===a[0].ctype?D.assigndot(a[0],b):"userdata"===a[0].ctype?D.assigncolon(a[0],b):"function"===a[0].ctype&&"genList"===a[0].oper?"list"===b.ctype?D.assignlist(a[0].args,
b.value):da("Expected list in rhs of assignment"):da("Left hand side of assignment is not a recognized lvalue");return b}function vb(a,f){var c=z(a[0]),p=z(a[1]);if(c.ctype===p.ctype){if("number"===c.ctype)return w.bool(c.value.real===p.value.real&&c.value.imag===p.value.imag);if("string"===c.ctype||"boolean"===c.ctype)return w.bool(c.value===p.value);if("list"===c.ctype)return h.equals(c,p);if("geo"===c.ctype)return w.bool(c.value===p.value)}return{ctype:"boolean",value:!1}}function Rc(a,f){return w.not(vb(a,
f))}function jc(a,f){var c=B(a[0]),p=B(a[1]);return"number"===c.ctype&&"number"===p.ctype?{ctype:"boolean",value:l._helper.isAlmostEqual(c,p)}:"string"===c.ctype&&"string"===p.ctype||"boolean"===c.ctype&&"boolean"===p.ctype?{ctype:"boolean",value:c.value===p.value}:"list"===c.ctype&&"list"===p.ctype?h.almostequals(c,p):{ctype:"boolean",value:!1}}function Sc(a,f){var c=B(a[0]),p=B(a[1]);return"boolean"===c.ctype&&"boolean"===p.ctype?{ctype:"boolean",value:c.value&&p.value}:k}function Tc(a,f){var c=
B(a[0]),p=B(a[1]);return"boolean"===c.ctype&&"boolean"===p.ctype?{ctype:"boolean",value:c.value||p.value}:k}function Uc(a,f){var c=a[0];"void"!==c.ctype&&(c=B(c));var p=B(a[1]),b=w.add(c,p);"Angle"===c.usage&&"Angle"===p.usage&&(b=w.withUsage(b,"Angle"));return b}function lc(a,f){var c=a[0];"void"!==c.ctype&&(c=B(c));var p=B(a[1]),b=w.sub(c,p);"Angle"===c.usage&&"Angle"===p.usage&&(b=w.withUsage(b,"Angle"));return b}function Vc(a,f){var c=B(a[0]),p=B(a[1]),b=w.mult(c,p);"Angle"!==c.usage||p.usage?
"Angle"!==p.usage||c.usage||(b=w.withUsage(b,"Angle")):b=w.withUsage(b,"Angle");return b}function Wc(a,f){var c=B(a[0]),p=B(a[1]);"number"===p.ctype&&l._helper.isZero(p)&&da("WARNING: Division by zero!");var b=w.div(c,p);"Angle"!==c.usage||p.usage?"Angle"!==p.usage||c.usage||(b=w.withUsage(b,"Angle")):b=w.withUsage(b,"Angle");return b}function Xc(a,f){var c=B(a[0]),p=B(a[1]);return"number"===c.ctype&&"number"===p.ctype?l.pow(c,p):k}function dd(a,f){var c=K(a[0]),p=K(a[1]);if(c!==k&&p!==k){var b=h.cross(c,
p);"Point"===c.usage&&"Point"===p.usage&&(b=w.withUsage(b,"Line"));"Line"===c.usage&&"Line"===p.usage&&(b=w.withUsage(b,"Point"));return b}return k}function wc(a){var f=a.length;if(0===f)return[];if(1===f)return[0];if(2===f)return a[0][0]+a[1][1]<=a[0][1]+a[1][0]?[0,1]:[1,0];if(4<f)return be(a);for(var c=ce[f],p=Number.POSITIVE_INFINITY,b=c[0],d=0;d<c.length;++d){for(var h=c[d],e=0,g=0;g<f;++g)e+=a[g][h[g]];e<p&&(p=e,b=h)}return b}function be(a){function f(){return{matched:-1,prev:-1,start:-1,cost:0,
used:!1,leaf:!1}}function c(a){for(var f=0;f<d;++f)0<k[a][f]||l[f].used||(l[f].used=!0,c(l[f].matched))}function p(a){for(var c=0;c<d;++c)0<k[c][a]||g[c].used||(g[c].used=!0,p(g[c].matched))}var b=Math.abs,d=a.length,h,e,g=Array(d),l=Array(d),k=Array(d);for(h=0;h<d;++h)k[h]=Array(d);for(h=0;h<d;++h)for(g[h]=f(),l[h]=f(),g[h].cost=a[h][0],e=1;e<d;++e)g[h].cost>a[h][e]&&(g[h].cost=a[h][e]);for(;;){for(h=0;h<d;++h)for(e=0;e<d;++e)k[h][e]=a[h][e]-g[h].cost-l[e].cost,k[h][e]<1E-14*(b(a[h][e])+b(g[h].cost)+
b(l[e].cost))&&(k[h][e]=0);for(h=0;h<d;++h)g[h].matched=l[h].matched=-1;for(var m=0;;){for(h=0;h<d;++h)g[h].used=g[h].leaf=l[h].used=l[h].leaf=!1,-1===g[h].matched&&(g[h].start=h,g[h].used=g[h].leaf=!0,g[h].prev=-1);for(var n=!1,q=!1;!q;){for(h=0;h<d;++h)if(g[h].leaf)for(g[h].leaf=!1,e=0;e<d;++e)if(!(l[e].used||0<k[h][e])&&g[h].matched!==e&&(l[e].prev=h,l[e].start=g[h].start,l[e].used=l[e].leaf=!0,-1===l[e].matched)){g[l[e].start].prev=e;n=!0;break}if(n)break;q=!0;for(e=0;e<d;++e)l[e].leaf&&(l[e].leaf=
!1,h=l[e].matched,g[h].used||(g[h].prev=e,g[h].start=l[e].start,g[h].used=g[h].leaf=!0,q=!1))}if(!n)break;for(n=0;n<d;++n)if(-1===g[n].matched&&-1!==g[n].prev){e=g[n].prev;do h=l[e].prev,l[e].matched=h,g[h].matched=e,e=g[h].prev;while(h!==n);++m}}if(m===d)break;for(h=0;h<d;++h)g[h].used=g[h].leaf=l[h].used=l[h].leaf=!1;for(h=0;h<d;++h)-1===g[h].matched&&c(h);for(e=0;e<d;++e)-1===l[e].matched&&p(e);for(h=0;h<d;++h)-1===g[h].matched||g[h].used||l[g[h].matched].used||(g[h].used=!0);m=Number.POSITIVE_INFINITY;
for(h=0;h<d;++h)if(!g[h].used)for(e=0;e<d;++e)l[e].used||m>k[h][e]&&(m=k[h][e]);for(h=0;h<d;++h)g[h].used||(g[h].cost+=m),l[h].used&&(l[h].cost-=m)}a=Array(d);for(h=0;h<d;++h)e=g[h].matched,a[h]=e;return a}function xc(a,f){var c=z(a[0]),p=B(a[1]);"string"!==c.ctype&&(c=h.asList(c));if("number"===p.ctype){p=Math.floor(p.value.real);0>p&&(p=c.value.length+p+1);if(0<p&&p<c.value.length+1)return"list"===c.ctype?c.value[p-1]:{ctype:"string",value:c.value.charAt(p-1)};da("WARNING: Index out of range!");
return k}if("list"===p.ctype){for(var b=[],d=0;d<p.value.length;d++){var e=B(p.value[d]);b[d]=xc([c,e],[])}return h.turnIntoCSList(b)}return k}function ed(a,f){var c=z(a[0]),p=z(a[1]);if("shape"===c.ctype&&"shape"===p.ctype)return D.shapeconcat(c,p);c=h.asList(c);p=h.asList(p);return"list"===c.ctype&&"list"===p.ctype?h.concat(c,p):k}function fd(a,f){var c=z(a[0]),p=z(a[1]);return"list"===c.ctype&&"list"===p.ctype?h.set(h.common(c,p)):"shape"===c.ctype&&"shape"===p.ctype?D.shapecommon(c,p):k}function gd(a,
f){var c=z(a[0]),p=z(a[1]);return"list"===c.ctype&&"list"===p.ctype?h.remove(c,p):"shape"===c.ctype&&"shape"===p.ctype?D.shaperemove(c,p):k}function hd(a,f){var c=z(a[0]),p=z(a[1]);return"list"===c.ctype?h.append(c,p):k}function id(a,f){var c=z(a[0]),p=z(a[1]);return"list"===p.ctype?h.prepend(c,p):k}function yc(a,f){a|=0;f|=0;if(0===a&&0===f)return 0;for(;0!==f;){var c=a;a=f;f=c%f|0}return a}function de(a){return 1===a?0:1}function Lb(a,f,c){var p=f*f-4*a*c;0<=p?(p=Math.sqrt(p),0<f&&(p=-p),f=[[p-
f,2*a],[2*c,p-f]]):f=null;if(null===f)return null;a=f[0][0]/f[0][1];f=f[1][0]/f[1][1];return f<a?[f,a]:[a,f]}function jd(a,f,c,p,b,d,h){if(-1!==f.indexOf("\n")){var e=Infinity,g=-Infinity,l=Infinity,k=-Infinity;f.split("\n").forEach(function(f){f=jd(a,f,c,p,b,d);e>f.left&&(e=f.left);g<f.right&&(g=f.right);l>f.top&&(l=f.top);k<f.bottom&&(k=f.bottom);p+=h});return{left:e,right:g,top:l,bottom:k}}var m=a.measureText(f);a.fillText(f,c-m.width*b,p);return{left:c-m.width*b,right:c+m.width*(1-b),top:p-.84*
d,bottom:p+.36*d}}function Ja(a){return"image"===a.ctype?a.value:"string"===a.ctype&&db.hasOwnProperty(a.value)?db[a.value].value:null}function pb(a,f,c,p,b){var d=[];if(a.readPixels)d=a.readPixels(f,c,p,b);else{var h,e;if(a.img.getContext)e=a.img.getContext("2d"),h=e.getImageData(f,c,p,b).data;else try{Mb||(Mb=document.createElement("canvas")),Mb.width=p,Mb.height=b,e=Mb.getContext("2d"),e.drawImage(a.img,f,c,p,b,0,0,p,b),h=e.getImageData(0,0,p,b).data}catch(g){console.log(g)}for(var l in h)d.push(h[l]/
255)}return d}function kd(a){return a.replace(/[^A-Za-z0-9 \u0080-\uffff]/ig,"\\$&")}function ka(a,f,c){var p=a;f&&(p=p+" at "+f.row+":"+f.col);c&&(p=p+": \u2018"+c+"\u2019");p=Error(p);p.name="CindyScriptParseError";p.description=a;p.location=f;p.text=c;return p}function qb(a){this.input=a;this.re=new RegExp(ld,"g");for(var f=[],c=a.indexOf("\n")+1;c;)f.push(c),c=a.indexOf("\n",c)+1;f.push(a.length);this.bols=f;this.bol=this.pos=0;this.line=1}function bc(a){var f=a[a.length-2],c=a[a.length-3],p=
a[a.length-1];if(c){if(c.isSuperscript&&f.precedence<=c.precedence)throw ka("Operator not allowed after superscript",f.start,f.text);if(p){if(!f.op.infix)throw ka("Operator may not be used infix",f.start,f.text);}else if(!f.op.postfix)throw ka("Operator may not be used postfix",f.start,f.text);}else if(p){if(!f.op.prefix)throw ka("Operator may not be used prefix",f.start,f.text);}else if(!f.op.bare)throw ka("Operator without operands",f.start,f.text);f.ctype="infix";f.oper=f.op.sym;f.args=[c,p];a.splice(a.length-
3,3,f)}function md(a,f,c,p){a.length&1||a.push(null);for(c=Ca[c];3<=a.length&&a[a.length-2].precedence<=c.precedence;)bc(a);a.push({op:c,precedence:c.precedence+(c.rassoc?1:0),start:f.start,end:f.end,text:f.text,rawtext:f.rawtext});c="";for(var b=f.text,d=0;d<b.length;++d)c+="0123456789+-".charAt(p.indexOf(b.charAt(d)));f.ctype="number";f.value={real:+c,imag:0};a.push(f);bc(a)}function nd(a,f){var c=[],p;a:for(;;)switch(p=a.next(),p.toktype){case "OP":var b=Ca[p.text];"_"!==b.sym||!c.length||c.length&
1||"OP"!==c[c.length-1].toktype||":="!==c[c.length-1].op.sym||(c.pop(),b=Ca[":=_"],p.text=b.sym);p.op=b;p.precedence=b.precedence;for(c.length&1||c.push(null);3<=c.length&&c[c.length-2].precedence<=p.precedence;)bc(c);b.rassoc&&p.precedence++;c.push(p);break;case "ID":p.ctype="variable";p.name=p.text;if(c.length&1)throw ka("Missing operator",p.start,p.text);c.push(p);break;case "NUM":p.ctype="number";p.value={real:+p.text,imag:0};if(c.length&1)throw ka("Missing operator",p.start,p.text);c.push(p);
break;case "STR":p.ctype="string";p.value=p.raw.substring(1,p.raw.length-1);if(c.length&1)throw ka("Missing operator",p.start,p.text);c.push(p);break;case "SUB":md(c,p,"_","\u2080\u2081\u2082\u2083\u2084\u2085\u2086\u2087\u2088\u2089\u208a\u208b");break;case "SUP":md(c,p,"^","\u2070\u00b9\u00b2\u00b3\u2074\u2075\u2076\u2077\u2078\u2079\u207a\u207b");c[c.length-1].isSuperscript=!0;break;case "BRA":b="[](){}||".indexOf(p.text);if(p.text===f||b&1)break a;var b="[](){}||".charAt(b+1),d=nd(a,b),h=d.closedBy;
if(h.text!==b)throw ka("Opening "+p.text+" at "+p.start.row+":"+p.start.col+" closed by "+(h.text||"EOF")+" at "+h.start.row+":"+h.start.col);h=p.text+h.text;b=[];if(d=d.expr){for(;d&&"infix"===d.ctype&&","===d.oper;)b.push(d.args[0]),d=d.args[1];b.push(d)}if(c.length&1){if("{}"===h)throw ka("{\u2026} reserved for future use",p.start);d=c[c.length-1];if("variable"!==d.ctype)throw ka("Function name must be an identifier",d.start);if(2<c.length&&c[c.length-2].precedence<od)throw ka("Function call in indexing construct must be enclosed in parentheses",
p.start);d.ctype="function";p=d.args=[];for(var h=d.modifs={},e=0;e<b.length;++e){var g=b[e];if(g&&"infix"===g.ctype&&"->"===g.oper){var l=g.args[0];if("variable"!==l.ctype)throw ka("Modifier name must be an identifier",g.start);h[l.name]=g.args[1]}else p.push(g)}d.oper=d.name.toLowerCase()+"$"+d.args.length}else if("||"===h)if(1===b.length)c.push({ctype:"function",oper:"abs_infix",args:b,modifs:{}});else if(2===b.length)c.push({ctype:"function",oper:"dist_infix",args:b,modifs:{}});else throw ka("Don't support |\u2026| with "+
b.length+" arguments",p.start);else{if("{}"===h)throw ka("{\u2026} reserved for future use",p.start);"[]"!==h&&1===b.length?c.push({ctype:"paren",args:b}):0===b.length?c.push({ctype:"list",value:[]}):c.push({ctype:"function",oper:"genList",args:b,modifs:{}})}break;case "EOF":break a}for(c.length&1||c.push(null);3<=c.length;)bc(c);return{expr:c[0],closedBy:p}}function Nb(a){this.usedFunctions={};this.usedVariables={}}function z(a){if(void 0===a)return k;if("infix"===a.ctype)return a.impl(a.args,{},
a);if("variable"===a.ctype)return z(I.getvar(a.name));if("function"===a.ctype)return Ob.push(a),a=D.evaluate(a.oper,a.args,a.modifs),Ob.pop(),a;if("void"===a.ctype)return k;if("field"===a.ctype){var f=z(a.obj);return"geo"===f.ctype?ta.getField(f.value,a.key):"list"===f.ctype?h.getField(f,a.key):k}return"userdata"===a.ctype?(f=z(a.obj),a=Y(z(a.key)),"_?_"===a&&(a=void 0),"geo"===f.ctype?ta.getuserData(f.value,a):"list"===f.ctype||"string"===f.ctype?ta.getuserData(f,a):k):a}function B(a){a=z(a);if("geo"===
a.ctype){var f=a.value;if("P"===f.kind)return ta.getField(f,"xy");if("V"===f.kind)return f.value}return a}function K(a){a=z(a);if("geo"===a.ctype){var f=a.value;if("P"===f.kind||"L"===f.kind)return ta.getField(f,"homog")}return h._helper.isNumberVecN(a,3)?a:h._helper.isNumberVecN(a,2)?(f=h.turnIntoCSList([a.value[0],a.value[1],l.real(1)]),a.usage&&(f=w.withUsage(f,a.usage)),f):k}function Wa(a){var f=new Nb;f.usedFunctions=jb;f.infixmap=Q;a=f.parse(a);for(var c in f.usedVariables)I.create(c);return a}
function Vd(a,f){return{ctype:"infix",args:[],impl:function(){Ob=[{oper:f}];var c=z(a);Ob=[];return c}}}function da(a){wa.err(a+Ob.map(function(a){return"\n  at "+a.oper}).join("\n"))}function pd(){this._path=[];this._defs=["<defs>"];this._imgcache=[];this._body=[];this._saveStack=[""];this._clipIndex=0;this._stroke=this._fill="#000";this._strokeOpacity=this._fillOpacity=null;this.height=this.width=0;this.lineWidth=1;this.lineCap="butt";this.lineJoin="miter";this.miterLimit=10;this.globalAlpha=1}
function qd(){this._body=[];this._yPos=this._xPos=NaN;this._extGState={Af255:"<< /ca 1 >>",As255:"<< /CA 1 >>"};this._objects=[["%PDF-1.4\n"]];this._offset=this._objects[0][0].length;this._nextIndex=5;this._imgcache=[];this._xobjects={};this._pathUsed=-1;this._fillAlpha=this._strokeAlpha=this._globalAlpha=1;this.height=this.width=0;this.lineWidth=1;this.lineCap="butt";this.lineJoin="miter";this.miterLimit=10}function rd(a,f){var c=a.width,p=a.height,b=document.createElement("canvas");b.setAttribute("width",
c);b.setAttribute("height",p);b.setAttribute("style","display:none;");var d=sa.canvas;d.parentNode.insertBefore(b,d.nextSibling);try{return b.getContext("2d").drawImage(a,0,0,c,p),b.toDataURL(f||"image/png")}finally{b.parentNode.removeChild(b)}}function ee(a){a=a.replace(RegExp("[^ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/]+","g"),"");var f=new Uint8Array(3*a.length>>2),c,p,b,d,h,e;for(p=c=0;c+3<a.length;c+=4)b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c)),
d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c+1)),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c+2)),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c+3)),f[p++]=b<<2|d>>4,f[p++]=d<<4|h>>2,f[p++]=h<<6|e;switch(a.length-c){case 0:break;case 2:b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c));d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c+
1));f[p++]=b<<2|d>>4;break;case 3:b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c));d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c+1));h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c+2));f[p++]=b<<2|d>>4;f[p++]=d<<4|h>>2;break;default:throw Error("Malformed Base64 input: "+(a.length-c)+" chars left: "+a.substr(c));}if(p!==f.length)throw Error("Failed assertion: "+p+" should be "+
f.length);return f}function fe(a){function f(c){return(a[c]<<24|a[c+1]<<16|a[c+2]<<8|a[c+3])>>>0}if(57>a.length)throw Error("Too short to be a PNG file");if(2303741511!==f(0)||218765834!==f(4))throw Error("PNG signature missing");for(var c=[],p=8;p<a.length;){if(p+12>a.length)throw Error("Incomplete chunk at offset 0x"+p.toString(16));var b=f(p);if(2147483648<=b)throw Error("Chunk too long");var d=p+12+b;if(d>a.length)throw Error("Incomplete chunk at offset 0x"+p.toString(16));var h=a.subarray(p+
4,p+8),h=String.fromCharCode.apply(String,h);c.push({len:b,type:h,data:a.subarray(p+8,p+8+b),crc:f(p+8+b)});p=d}return c}function cc(a,f){var c;if(c=/^rgba\(([0-9.]+), *([0-9.]+), *([0-9.]+), *([0-9.]+)\)$/.exec(a))f(+c[1],+c[2],+c[3],+c[4]);else if(c=/^rgb\(([0-9.]+), *([0-9.]+), *([0-9.]+)\)$/.exec(a))f(+c[1],+c[2],+c[3],1);else throw Error("Can't handle color style "+a);}function ge(a){var f=1;Object.keys(db).forEach(function(c){var p=db[c].value.img;if(void 0===p.cachedDataURL&&p.src)if("data:"===
p.src.substr(0,5))p.cachedDataURL=p.src;else{++f;p.cachedDataURL=null;var b=new XMLHttpRequest;b.responseType="blob";b.onreadystatechange=function(){if(b.readyState===XMLHttpRequest.DONE)if(200===b.status){var c=new FileReader;c.onloadend=function(){p.cachedDataURL=c.result;console.log("Cached data for image "+p.src);0===--f&&a()};c.readAsDataURL(b.response)}else console.error("Failed to load "+p.src+": "+b.statusText),0===--f&&a()};b.open("GET",p.src,!0);b.send()}});0===--f&&a()}function rb(a,f,
c){for(c||(c="0");a.length<f;)a=c+a;return a}function sd(){null!==Pb&&(window.URL.revokeObjectURL(Pb),Pb=null)}function td(a){ge(function(){var f=A;try{A=new a;A.width=ba;A.height=ca;n();var c=A.toBlob();Pb=window.URL.createObjectURL(c);ud(Pb)}finally{A=f}})}function Qb(a){var f=null,c=1E6,p;console.log("getElementAtMouse");for(var b=0;b<u.gslp.length;b++){var d=u.gslp[b];if(!d.pinned&&!1!==d.visible&&!0!==d.tmp){var e,g,k,m=y.drawingstate.matrix.sdet;if("P"===d.kind){var n=h.normalizeZ(d.homog);
if(!h._helper.isAlmostReal(n))continue;e=n.value[0].value.real-a.x;g=n.value[1].value.real-a.y;k=Math.sqrt(e*e+g*g);d.narrow&k>20/m&&(k=1E4)}else if("C"===d.kind)g=u.csnames[d.args[0]],k=0,"undefined"!==typeof d.radius&&(k=d.radius.value.real),e=l.div(g.homog.value[0],g.homog.value[2]).value.real,g=l.div(g.homog.value[1],g.homog.value[2]).value.real,e-=a.x,g-=a.y,k=Math.sqrt(e*e+g*g)-k,g=e=0,0>k&&(k=-k),k+=30/m;else if("L"===d.kind||"S"===d.kind)e=d.homog,k=l,g=k.add(k.mult(e.value[0],k.conjugate(e.value[0])),
k.mult(e.value[1],k.conjugate(e.value[1]))),g=h.scaldiv(k.sqrt(g),e),k=g.value[0].value.real*a.x+g.value[1].value.real*a.y+g.value[2].value.real,e=g.value[0].value.real*k,g=g.value[1].value.real*k,0>k&&(k=-k),k+=1;k<c+.2/m&&(c=k,f=d,p={x:e,y:g})}}return null===f?null:{mover:f,offset:p,prev:{x:a.x,y:a.y}}}function Za(){return"P"+he++}function xb(a){var f=G[zc].actions;f[yb].event===a&&f[yb]["do"]()&&(e(),yb===f.length-1?(za=[],yb=$a=0):yb++)}function Ac(a){return a&&.5>Math.abs(a.offset.x)&&.5>Math.abs(a.offset.y)&&
!a.mover.tmp}function vd(a){return Ac(a)&&"P"===a.mover.kind}function wd(a){return Ac(a)&&("L"===a.mover.kind||"S"===a.mover.kind)}function Bc(a){ja={mover:a,offset:{x:0,y:0},prev:{x:Z.x,y:Z.y}}}function sb(){var a=Qb(Z);vd(a)?za[$a]=a.mover:(za[$a]={type:"Free",name:Za(),labeled:!0,pos:[ra[0],ra[1],1]},Ka(za[$a]));$a++}function xd(){var a=Qb(Z);return wd(a)?(za[$a]=a.mover,$a++,!0):!1}function yd(){var a=Qb(Z),f;(f=wd(a))||(f=Ac(a)&&"C"===a.mover.kind);return f?(za[$a]=a.mover,$a++,!0):!1}function zb(){var a=
Qb(Z);if(vd(a))for(Rb.args[1]=a.mover.name,a=0;a<u.gslp.length;a++){var f=u.gslp[a];!0===f.tmp&&zd(f.name)}else for(a=0;a<u.gslp.length;a++)f=u.gslp[a],!0===f.tmp&&(f.tmp=!1)}function dc(a){var f={type:"Free",name:Za(),labeled:!0,pos:[ra[0],ra[1],1],tmp:!0},f=Ka(f);Rb=Ka({type:a,name:Za(),labeled:!0,args:[za[0].name,f.name]});Bc(f)}function ie(a){for(var f in a)null!==a[f]&&(ga[f]=a[f])}function Wd(a){Object.keys(m).forEach(function(a){var c=m[a];lb(c.signature||"_helper"===a,a+" has no signature");
void 0!==c.updatePosition&&void 0===c.stateSize&&(c.stateSize=0)});u.gslp=[];u.csnames={};u.points=[];u.lines=[];u.conics=[];u.texts=[];u.free=[];u.polygons=[];u.ifs=[];a.forEach(Ad);Bd()}function Cd(a){"undefined"===typeof a.tracedim&&(a.tracedim=1);"undefined"===typeof a.tracelength&&(a.tracelength=100);"undefined"===typeof a.traceskip&&(a.traceskip=1);a._traces=Array(a.tracelength);a._traces_index=0;a._traces_tick=0}function je(a){void 0===a.size&&(a.size=ga.pointSize);a.size=l.real(a.size);!a.movable||
a.pinned?(a.color=h.realVector(a.color||ga.pointColor),a.color=h.scalmult(l.real(ga.dimDependent),a.color)):a.color=h.realVector(a.color||ga.pointColor);void 0===a.alpha&&(a.alpha=ga.alpha);a.alpha=l.real(a.alpha);"boolean"!==typeof a.noborder&&(a.noborder=ga.noborder);a.noborder=w.bool(a.noborder);"boolean"!==typeof a.border&&(a.border=!ga.noborder);a.border=w.bool(a.border);a.drawtrace&&Cd(a)}function ec(a){void 0===a.size&&(a.size=ga.lineSize);a.size=l.real(a.size);a.color=h.realVector(a.color||
ga.lineColor);void 0===a.alpha&&(a.alpha=ga.alpha);a.alpha=l.real(a.alpha);a.clip=w.string(a.clip||ga.clip);void 0===a.overhang&&(a.overhang=ga.overhangLine);a.overhang=l.real(a.overhang);a.dashtype&&(a.dashtype=w.wrap(a.dashtype))}function ke(a){void 0===a.overhang&&(a.overhang=ga.overhangSeg);a.arrow&&(a.arrow=w.bool(a.arrow));a.arrowsize&&(a.arrowsize=l.real(a.arrowsize));a.arrowposition&&(a.arrowposition=l.real(a.arrowposition));a.arrowshape&&(a.arrowshape=w.string(a.arrowshape));a.arrowsides&&
(a.arrowsides=w.string(a.arrowsides));ec(a);a.clip=w.string("end")}function le(a){a.size=void 0!==a.textsize?a.textsize:void 0!==a.size?a.size:ga.textsize;a.size=l.real(+a.size)}function me(a){a.filled=void 0!==a.filled?w.bool(a.filled):w.bool(!0);a.fillcolor=void 0===a.fillcolor?k:h.realVector(a.fillcolor);void 0===a.fillalpha&&(a.fillalpha=0);a.fillalpha=l.real(a.fillalpha);ec(a)}function Ka(a){a=Ad(a);Bd();return a}function Ad(a){var f;if(void 0!==u.csnames[a.name])return console.log("Element name '"+
a.name+"' already exists"),f=u.csnames[a.name],m[f.type].isMovable&&"P"===m[f.type].kind&&Aa(f,a.pos,"homog"),f;for(;Ab.hasOwnProperty(a.type);)a.type=Ab[a.type];if(f=Cc[a.type]){var c=f(a),p=null;for(f=0;f<c.length;++f)p=Ka(c[f]);return p}var b=m[a.type],c=!1;if(!b)return console.error(a),console.error("Operation "+a.type+" not implemented yet"),null;if("**"!==b.signature)if(!Array.isArray(b.signature)&&"*"===b.signature.charAt(1))c=!0,a.args.forEach(function(c){if(u.csnames[c].kind!==b.signature.charAt(0))return console.error("Not all elements in set are of same type: "+
a.name+" expects "+b.signature+" but "+c+" is of kind "+u.csnames[c].kind),"undefined"!==typeof window&&window.alert("Not all elements in set are of same type: "+a.name),null});else if(b.signature.length!==(a.args?a.args.length:0))return console.error("Wrong number of arguments for "+a.name+" of type "+a.type),"undefined"!==typeof window&&window.alert("Wrong number of arguments for "+a.name),null;if(a.args)for(f=0;f<a.args.length;++f){if(!u.csnames.hasOwnProperty(a.args[f]))return console.log("Dropping "+
a.name+" due to missing argument "+a.args[f]),null;if("**"!==b.signature&&!c&&(p=u.csnames[a.args[f]].kind,b.signature[f]!==p&&("S"!==p||"L"!==b.signature[f])))return window.alert("Wrong argument kind "+p+" as argument "+f+" to element "+a.name+" of type "+a.type),null}b.signatureConstraints&&!b.signatureConstraints(a)&&window.alert("signature constraints violated for element "+a.name);u.gslp.push(a);u.csnames[a.name]=a;f=Da.length;a.kind=b.kind;a.stateIdx=f;f+=b.stateSize;a.incidences=[];a.isshowing=
!0;a.movable=!1;b.isMovable&&(a.movable=!0,u.free.push(a));"P"===a.kind&&(u.points.push(a),je(a));"L"===a.kind&&(u.lines.push(a),ec(a));"C"===a.kind&&(u.conics.push(a),ec(a));"S"===a.kind&&(u.lines.push(a),ke(a));"Text"===a.kind&&(u.texts.push(a),le(a));"Poly"===a.kind&&(u.polygons.push(a),me(a));"IFS"===a.kind&&u.ifs.push(a);ne(f);ma=Na=Da;mb=!0;b.initialize&&(Ba=Ea=a.stateIdx,a.param=b.initialize(a),lb(Ea===a.stateIdx+b.stateSize,"State fully initialized"));Ba=Ea=a.stateIdx;b.updatePosition(a,!1);
lb(Ba===a.stateIdx+b.stateSize,"State fully consumed");lb(Ea===a.stateIdx+b.stateSize,"State fully updated");mb=!1;ma=Ya["in"];ma.set(Da);Na=Ya.out;Dc(a,b);fc={};nb(a);return u.csnames[a.name]}function zd(a){var f,c;console.log("Remove element "+a);delete u.csnames[a];for(f=0;f<u.gslp.length;f++)c=u.gslp[f],c.name===a&&(console.log("Removed element from gslp "+a),u.gslp.splice(f,1));for(f=0;f<u.free.length;f++)c=u.free[f],c.name===a&&(console.log("Removed element from free "+a),u.free.splice(f,1));
for(f=0;f<u.points.length;f++)c=u.points[f],c.name===a&&(console.log("Removed element from points "+a),u.points.splice(f,1));for(f=0;f<u.lines.length;f++)c=u.lines[f],c.name===a&&(console.log("Removed element from lines "+a),u.lines.splice(f,1));for(f=0;f<u.conics.length;f++)c=u.conics[f],c.name===a&&(console.log("Removed element from conics "+a),u.conics.splice(f,1));fc={}}function Dd(a,f){var c=u.csnames[f.args[0]].homog,p=u.csnames[f.args[1]].homog,b=a.homog,d=l.div(c.value[0],c.value[2]),c=l.div(c.value[1],
c.value[2]),h=l.div(p.value[0],p.value[2]),p=l.div(p.value[1],p.value[2]),e=l.div(b.value[0],b.value[2]),b=l.div(b.value[1],b.value[2]);return l._helper.isAlmostReal(d)&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(h)&&l._helper.isAlmostReal(p)&&l._helper.isAlmostReal(e)&&l._helper.isAlmostReal(b)?(d=d.value.real,c=c.value.real,h=h.value.real,p=p.value.real,e=e.value.real,b=b.value.real,d=Math.sqrt((d-h)*(d-h)+(c-p)*(c-p))-Math.sqrt((d-e)*(d-e)+(c-b)*(c-b))-Math.sqrt((h-e)*(h-e)+(p-b)*(p-b)),
1E-15>d*d):!1}function Dc(a,f){a.isshowing=!0;if(a.args)for(var c=0;c<a.args.length;c++)if(!u.csnames[a.args[c]].isshowing){a.isshowing=!1;return}f.visiblecheck&&f.visiblecheck(a)}function ad(a,f,c,p,b){var d=a.textsize||ga.textsize,h=!0===a.textbold,e=!0===a.textitalics,g=a.text_fontfamily||ga.fontFamily,k=p.x*p.x+p.y*p.y,m=1;0<k&&(m=1+a.size.value.real/Math.sqrt(k));a=a.alpha||l.real(ga.alpha);D.drawtext([c,w.wrap(f)],{x_offset:w.wrap(m*p.x),y_offset:w.wrap(m*p.y),size:w.wrap(d),bold:w.wrap(h),
italics:w.wrap(e),family:w.wrap(g),color:b,alpha:a})}function ae(a){a._bbox=null;if(a.isshowing&&!1!==a.visible){var f={size:a.size},c=a.homog,p=a.text,b=m[a.type].getText,p=b?b(a):p.replace(/@[$#]"([^"\\]|\\.)*"/g,function(a){var c,f;try{if(c=JSON.parse(a.substring(2)),f=u.csnames[c],!f)return"?"}catch(p){return"?"}switch(a.charAt(1)){case "$":return f.printname||c;case "#":return"V"!==f.kind?"?":Y(f.value)}}),b=null;if(a.html)var d=a._textCache||{text:!1},h=a.html,e=h.parentNode,g=e.parentNode,
b=function(c,f,p,b,pa){d.invisible&&g.style.removeProperty("display");if(c!==d.text||f!==d.font||p!==d.x||b!==d.y||pa!==d.align){f!==d.font&&(h.style.font=f,h.style.lineHeight=ga.lineHeight);c!==d.text&&!1!==c&&!1===Ed(h,c,f)&&(c=!1);g.style.left=p+"px";g.style.top=b+"px";if(pa||e.style.transform)e.style.transform="translateX("+-100*pa+"%)";a._textCache={text:c,font:f,x:p,y:b,align:pa}}};p=w.string(p);a.dock&&(a.dock.to?c=u.csnames[a.dock.to].homog:Fd.hasOwnProperty(a.dock.corner)&&(c=t.screenbounds$0([],
{}),c=c.value[Fd[a.dock.corner]]),f.offset=a.dock.offset);a.align&&(f.align=w.string(a.align));c&&(a._bbox=D.drawtext([c,p],f,b))}else a.html&&(a.html.parentNode.parentNode.style.display="none",a._textCache={invisible:!0})}function $d(){function a(){var a=e++/c._traces.length,f=c._traces[h];f&&(a*=p*a*a,t.draw$1([f],{size:l.real(b),color:c.color,alpha:l.real(a)}));b*=d}for(var f=0;f<u.points.length;f++){var c=u.points[f];if(c.drawtrace){c._traces_tick===c.traceskip?(c._traces[c._traces_index]=c.homog,
c._traces_index=(c._traces_index+1)%c._traces.length,c._traces_tick=0):c._traces_tick++;var p=c.alpha.value.real,b=c.size.value.real,d=1;1!==c.tracedim&&(b*=c.tracedim,d=Math.pow(c.tracedim,-1/c._traces.length));var h,e=0;for(h=c._traces_index;h<c._traces.length;++h)a();for(h=0;h<c._traces_index;++h)a()}}}function lb(a,f){var c="Assertion failed: "+f;if(!a)throw console.log(c),Ua(),"undefined"!==typeof alert&&alert(c),Error(c);}function ne(a){if(a!==Da.length){var f,c,p=Ec.length;ob.length<a*p?(f=
2*a,ob=new Float64Array(p*f)):f=ob.length/p|0;for(c=0;c<p;++c)Ya[Ec[c]]=ob.subarray(c*f,c*f+a);a=Da;ma=Ya["in"];Na=Ya.out;Da=Ya.good;Da.set(a)}}function Bb(){Da.set(ma);La=!1;Gd(!1);for(var a=Da.length,f=Math.abs,c=0;c<a;c+=2)f(Da[c])>1E12*f(Da[c+1])&&(Da[c+1]=0)}function gc(){if(Cb)La=!0;else throw Hd;}function Id(a,f,c,p,b){return w.add(p,w.mult(c,w.sub(b,p)))}function Zd(){N&&(N.currentMouseAndScripts=[]);Fc=!0;if(ja){var a=ja.mover,f=h.realVector([Z.x+ja.offset.x,Z.y+ja.offset.y,1]);Jd(a,f,"mouse");
ja.prev.x=Z.x;ja.prev.y=Z.y}z(R.move);z(R.draw);La||Bb();Fc=!1;N&&(N.fullLog.push(h.turnIntoCSList([h.turnIntoCSList(N.currentMouseAndScripts)])),N.length>N.logLength&&N.splice(0,N.length-N.logLength),N.currentMouseAndScripts=null,N.postMouseHooks.forEach(function(a){a()}))}function Aa(a,f,c){Jd(a,f,c);Fc||La||Bb()}function Jd(a,f,c){N&&N.currentMouseAndScripts&&(N.currentMover=[]);a===Kd?(ma.set(Da),La=!1):(Kd=a,Bb());Na.set(ma);var p=1E4,b;b=fc[a.name];if(!b){var d={},e=0;b=[];d[a.name]=a;for(var g=
u.gslp,k=0;k<g.length;++k){var n=g[k],Ra=n.args;if(Ra)for(var q=0;q<Ra.length;++q)d.hasOwnProperty(Ra[q])&&(d[n.name]=n,b[e++]=n)}fc[a.name]=b}var d=-1,e=.9,r,t,v,g=m[a.type],k=g.parameterPath||Id;Ba=a.stateIdx;n=g.getParamFromState(a);Ba=Ea=a.stateIdx;Ra=g.getParamForInput(a,f,c);for(q=d+e;d!==q;){var x=q*q,y=.5/(1+x),y=l.complex(2*q*y+.5,(1-x)*y);Cb=d+.5*e<=d||0===p;0===p&&console.log("tracing limit Reached");x=!1;N&&N.currentMouseAndScripts&&(N.currentStep=[]);try{Ba=Ea=a.stateIdx;var z=k(a,q,
y,n,Ra);N&&(N.currentParam=z);y=Na;Na=ma;g.putParamToState(a,z);Na=y;Ea=a.stateIdx;N&&(N.currentElement=a);g.updatePosition(a,!0);lb(Ba===a.stateIdx+g.stateSize,"State fully consumed");lb(Ea===a.stateIdx+g.stateSize,"State fully updated");for(r=0;r<b.length;++r)t=b[r],v=m[t.type],Ba=Ea=t.stateIdx,N&&(N.currentElement=t),v.updatePosition(t,!1),lb(Ba===t.stateIdx+v.stateSize,"State fully consumed"),lb(Ea===t.stateIdx+v.stateSize,"State fully updated");N&&(N.currentElement=null);d=q;e*=1.25;q+=e;1<=
q&&(q=1);Na=ma;ma=y}catch(A){if(A!==Hd)throw A;e*=.5;q=d+e;--p;x=!0}N&&N.currentMouseAndScripts&&(N.currentMover.push(h.turnIntoCSList([h.turnIntoCSList(N.currentStep),w.wrap(x),w.wrap(d),w.wrap(q),w.wrap(N.currentParam)])),N.currentStep=null,N.currentParam=null)}Gd(La);for(r=0;r<b.length;++r)t=b[r],v=m[t.type],Dc(t,v);N&&N.currentMouseAndScripts&&(N.currentMouseAndScripts.push(h.turnIntoCSList([h.turnIntoCSList(N.currentMover),w.wrap(La),w.wrap(a.name),f,w.wrap(c),n,Ra])),N.currentMover=null)}function $c(){Bb();
Cb=!0;for(var a=u.gslp,f=0;f<a.length;f++){var c=a[f],p=m[c.type];Ba=Ea=c.stateIdx;p.updatePosition(c,!1);Dc(c,p)}a=Na;Na=ma;ma=a;Bb()}function Gd(a){var f=q.tracingStateReport;"string"===typeof f&&(document.getElementById(f).textContent=a?"BAD":"GOOD")}function oe(){return h.turnIntoCSList(N.fullLog.slice())}function pe(a){var f=JSON.stringify(N.fullLog);a=new Blob([f],{type:a?"application/octet-stream":"application/json"});return window.URL.createObjectURL(a)}function Db(){var a=Ba;Ba+=2;return l.complex(ma[a],
ma[a+1])}function W(a){for(var f=Array(a),c=0;c<a;++c)f[c]=Db();return h.turnIntoCSList(f)}function ab(a){Na[Ea]=a.value.real;Na[Ea+1]=a.value.imag;Ea+=2}function T(a){for(var f=0,c=a.value.length;f<c;++f)ab(a.value[f])}function Oa(a,f){var c=W(3),p=W(3),c=Gc(a,f,c,p);T(c[0]);T(c[1]);return h.turnIntoCSList(c)}function Gc(a,f,c,p){if(mb)return[a,f];var b=h.projectiveDistMinScal(c,a),d=h.projectiveDistMinScal(c,f),e=h.projectiveDistMinScal(p,a),g=h.projectiveDistMinScal(p,f),l=h.projectiveDistMinScal(c,
p),m=h.projectiveDistMinScal(a,f),n=b+g,q=d+e,r;n>q?(r=[f,a],n=q):r=[a,f];q=function(){};if(N&&N.currentStep){var t=[N.labelTracing2,w.wrap(N.currentElement.name),h.turnIntoCSList(r),h.turnIntoCSList([c,p]),h.realMatrix([[b,d],[e,g]]),w.wrap(n),w.wrap(l),w.wrap(m),k];N.currentStep.push(h.turnIntoCSList(t));q=function(a){N.hasOwnProperty(a)||(N[a]=w.wrap(a));t[t.length-1]=N[a]}}h._helper.isNaN(a)||h._helper.isNaN(f)?(q("Tracing failed due to NaNs."),La=!0):l>3*n&&m>3*n?q("Normal case, everything all right."):
1E-5>m?1E-5>l?q("Staying inside singularity."):(q("Moved into singularity."),La=!0):1E-5>l?q("Moved out of singularity."):(Cb?q("Reached refinement limit, giving up."):q("Need to refine."),gc());return r}function Hc(a,f,c,p){var b=W(3),d=W(3),e=W(3),g=W(3);a=qe(a,f,c,p,b,d,e,g);T(a[0]);T(a[1]);T(a[2]);T(a[3]);return h.turnIntoCSList(a)}function qe(a,f,c,p,b,d,e,g){var l=function(){};b=[b,d,e,g];a=[a,f,c,p];if(mb)return a;d=0;p=Array(4);for(c=0;4>c;c++)for(p[c]=Array(4),g=0;4>g;g++)e=h.projectiveDistMinScal(b[c],
a[g]),p[c][g]=e;e=wc(p);f=Array(4);for(c=0;4>c;++c)f[c]=a[e[c]],d+=p[c][e[c]];var m=1*d,n=Infinity,q=Infinity;for(c=0;4>c;c++){if(h._helper.isNaN(a[c]))return l("Tracing failed due to NaNs."),La=!0,f;for(g=c+1;4>g;g++)e=h.projectiveDistMinScal(b[c],b[g]),n>e&&(n=e),e=h.projectiveDistMinScal(f[c],f[g]),q>e&&(q=e)}if(N&&N.currentStep){var r=[N.labelTracing4,w.wrap(N.currentElement.name),h.turnIntoCSList(f),h.turnIntoCSList(b),h.realMatrix(p),w.wrap(d),w.wrap(n),w.wrap(q),k];N.currentStep.push(h.turnIntoCSList(r));
l=function(a){N.hasOwnProperty(a)||(N[a]=w.wrap(a));r[r.length-1]=N[a]}}n>m&&q>m||(1E-5>q?1E-5>n?l("Staying inside singularity."):(l("Moved into singularity."),La=!0):1E-5>n?l("Moved out of singularity."):(Cb?l("Reached refinement limit, giving up."):l("Need to refine."),gc()));return f}function Ld(a){var f=a.length,c,p;if(mb){for(c=0;c<f;++c)Ba+=2*a[c].value.length,T(a[c]);return a}var b=Array(f),d=Array(f),e=Array(f),g=99,l=99,m=Array(f);for(c=0;c<f;++c)b[c]=W(a[c].value.length),d[c]=h.normSquared(b[c]).value.real,
e[c]=h.normSquared(a[c]).value.real,m[c]=Array(f);var n;for(c=0;c<f;++c){for(p=0;p<f;++p)n=h.sesquilinearproduct(b[c],a[p]).value,n=(n.real*n.real+n.imag*n.imag)/(d[c]*e[p]),m[c][p]=1-n;for(p=c+1;p<f;++p)n=h.sesquilinearproduct(b[c],b[p]).value,n=(n.real*n.real+n.imag*n.imag)/(d[c]*d[p]),g>1-n&&(g=1-n),n=h.sesquilinearproduct(a[c],a[p]).value,n=(n.real*n.real+n.imag*n.imag)/(e[c]*e[p]),l>1-n&&(l=1-n)}n=wc(m);p=Array(f);d=0;e=!1;for(c=0;c<f;++c){var d=d+m[c][n[c]],q=p[c]=a[n[c]];T(q);e|=h._helper.isNaN(q)}e|=
isNaN(d);a=function(){};if(N&&N.currentStep){var r=[N.labelTracingSesq,w.wrap(N.currentElement.name),h.turnIntoCSList(p),h.turnIntoCSList(b),h.realMatrix(m),w.wrap(d),w.wrap(g),w.wrap(l),k];N.currentStep.push(h.turnIntoCSList(r));a=function(a){N.hasOwnProperty(a)||(N[a]=w.wrap(a));r[r.length-1]=N[a]}}e?(a("Tracing failed due to NaNs."),La=!0):g>3*d&&l>3*d?a("Normal case, everything all right."):1E-5>l?1E-5>g?a("Staying inside singularity."):(a("Moved into singularity."),La=!0):1E-5>g?a("Moved out of singularity."):
(Cb?a("Reached refinement limit, giving up."):a("Need to refine."),gc());return p}function Sb(a,f){var c=m._helper.flattenConicMatrix(a),p=m._helper.flattenConicMatrix(f),b=W(6),d=W(6),p=Gc(c,p,b,d);T(p[0]);T(p[1]);c=m._helper.buildConicMatrix(p[0].value);p=m._helper.buildConicMatrix(p[1].value);return h.turnIntoCSList([c,p])}function nb(a){if(nb.hasOwnProperty(a.kind))nb[a.kind](a)}function Md(a,f){return function(){a.incidences.push(f.name);f.incidences.push(a.name)}}function Nd(a,f){return{getInvolved:function(){return[a,
f]},toString:function(){return"point "+a.name+" incident line "+f.name},apply:Md(a,f),holds:function(){var c=h.scaldiv(h.abs(a.homog),a.homog),p=h.scaldiv(h.abs(f.homog),f.homog);return l.abs(h.scalproduct(c,p)).value.real<l.eps}}}function Od(a,f){return{getInvolved:function(){return[a,f]},toString:function(){return"point "+a.name+" incident conic "+f.name},apply:Md(a,f),holds:function(){var c=w.mult(f.matrix,a.homog),c=w.mult(a.homog,c),c=l.abs(c);return c.value.real<l.eps}}}function Bd(){if(0!==
Sa.length){Ya.prover.set(ma);var a,f=function(){a={};Sa.forEach(function(f){var p;f.getInvolved().forEach(function(f){a[f.name]||(a[f.name]=!0,p=c(f,{}),p.forEach(function(c){a[c]=!0}))})})},c=function(a,f){a.incidences.forEach(function(a){f[a]||(f[a]=!0,c(u.csnames[a],f))});return Object.keys(f)};f();var p=function(a){return a.holds()};Object.keys(a).forEach(function(c){c=u.csnames[c].args;"undefined"!==typeof c&&c.forEach(function(c){a[c]=!0})});for(var b,d=0;3>d;d++){for(var h in a){var e=u.csnames[h];
!e.pinned&&m[e.type].isMovable&&(b=m[e.type].getRandomMove(e),Aa(e,b.value,b.type),Sa=Sa.filter(p))}f()}ma.set(Ya.prover);$c();for(f=0;f<Sa.length;++f)Sa[f].apply();Sa=[]}}function Ic(a,f,c){var p=document.createElement("div"),b=document.createElement("img");b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAPoCAQAAAC1v1zVAAAAGklEQVR42u3BMQEAAADCoPVPbQ0PoAAAgHcDC7gAAVI8ZnwAAAAASUVORK5CYII=";p.className="CindyJS-baseline";p.appendChild(b);b=document.createElement("div");b.className="CindyJS-button";
p.appendChild(b);for(var d=2;d<arguments.length;++d)b.appendChild(arguments[d]);na.parentNode.appendChild(p);a.html=arguments[arguments.length-1];Ia(a.fillalpha)||(a.fillalpha=1);a.fillcolor&&(a.html.style.backgroundColor=x.makeColor(a.fillcolor,a.fillalpha));p=e;if(a.script)var h=Wa(a.script),p=function(){z(h);e()};c.addEventListener(f,p);!q.keylistener&&(R.keydown||R.keyup||R.keytyped)&&(c.addEventListener("keydown",function(a){9!==a.keyCode&&J(a,R.keydown)}),c.addEventListener("keyup",function(a){J(a,
R.keyup)}),c.addEventListener("keypress",function(a){9!==a.keyCode&&J(a,R.keytyped)}));m.Text.initialize(a)}function Ta(){}function re(a){if(!/^Select/.test(a.type)&&!m[a.type].isMovable)return null;var f=w.unwrap,c=l.add;switch(a.kind){case "P":case "L":case "Text":return f(a.homog);case "C":return a=a.matrix.value,{xx:f(a[0].value[0]),yy:f(a[1].value[1]),zz:f(a[2].value[2]),xy:f(c(a[0].value[1],a[1].value[0])),xz:f(c(a[0].value[2],a[2].value[0])),yz:f(c(a[1].value[2],a[2].value[1]))};default:return null}}
function se(a){var f={};f.offset=w.unwrap(a.offset);a.to&&(f.to=a.to);a.corner&&(f.corner=a.corner);return f}function te(a){var f={};ue.forEach(function(c){if(a.hasOwnProperty(c)){var b=w.unwrap(a[c]);null!==b&&void 0!==b&&(f[c]=b)}});if("P"===a.kind&&(!a.movable||a.pinned)&&f.color){var c=l.real(1/ga.dimDependent);f.color=w.unwrap(h.scalmult(c,a.color))}if(c=re(a))f.pos=c;a.dock&&(f.dock=se(a.dock));return f}function ve(){var a=[];u.gslp.forEach(function(f){f.tmp||a.push(te(f))});return a}function Xd(){Fa.forEach(function(a){var f=
(a.geo||[]).map(function(a){return u.csnames[a]});O[a.type].reset(a,f[0],f)})}function pc(a){sc=0!==a.length;Fa=[];la=[];Jc=[];O.Environment.init({});a.forEach(function(a){a.behavior?(a.name&&(a.behavior.geo=[a.name]),a=a.behavior,a.gravity&&(a.gravity=-a.gravity)):c=a.geo;var c=(a.geo||[]).map(function(a){return u.csnames[a]}),p=c[0],b=O[a.type];b?(b.init&&b.init(a,p,c),p&&(p.behavior=a,"Mass"===a.type?la.push(p):"Spring"===a.type&&Jc.push(p)),Fa.push(a)):(console.error(a),console.error("Behavior "+
a.type+" not implemented yet"))})}var va=this,wa,R={},eb=!1,Zb=!0,Kb=0,Yc=.5,rc=0,Xb=10,Pd=5/360,Yd=.32/Pd/1E3*2,Vb=1,ya=0,nc=0,Gb=!1,Hb=!1,na,Fb,Ia=Number.isFinite||function(a){return"number"===typeof a&&isFinite(a)},ra,A,ba,ca,u,db,tc=k,uc=k,Xa={play:Ta,pause:Ta,stop:Ta},qc=null,Ib=function(a,f){var c=[];Ib=function(a,f){c.push({img:a,id:f})};Ib(a,f);var p=va.getBaseDir()+"images/Icons.svg",b=new XMLHttpRequest;b.onreadystatechange=function(){if(b.readyState===XMLHttpRequest.DONE)if(200!==b.status)console.error("Failed to load CindyJS Icons.svg from "+
p+": "+b.statusText);else{var a=b.responseXML,f=a.documentElement,d={},h,e;for(h=f.firstChild;h;h=e)e=h.nextSibling,h.nodeType===Node.ELEMENT_NODE&&"http://www.w3.org/2000/svg"===h.namespaceURI&&"g"===h.localName.toLowerCase()&&(f.removeChild(h),h.setAttribute("style","display:inline"),d[h.getAttribute("id")]=h);var g=new XMLSerializer;Ib=function(c,p){if(d.hasOwnProperty(p)){var b=d[p];f.appendChild(b);var h;try{h=g.serializeToString(a)}finally{f.removeChild(b)}c.src="data:image/svg+xml;charset=utf-8,"+
encodeURIComponent(h)}};c.forEach(function(a){Ib(a.img,a.id)});c=null}};b.responseType="document";b.open("GET",p);b.send()},Zc=1,Jb=null,kb=[],$b=!1,sa={config:q,startup:S,shutdown:Ua,evokeCS:function(a){a=Wa(a,!1);z(a);e()},play:L,pause:Ga,stop:Ha,evalcs:function(a){return z(Wa(a,!1))},parse:function(a){return Wa(a)},niceprint:Y,canvas:null},mc=!1,Wb=0;q.use&&q.use.forEach(function(a){var f=null;q.plugins&&(f=q.plugins[a]);f||(f=va._pluginRegistry[a]);f||(++Wb,console.log("Loading script for plugin "+
a),va.loadScript(a+"-plugin",a+"-plugin.js",function(){console.log("Successfully loaded plugin "+a);0===--Wb&&mc&&S()},function(){console.error("Failed to auto-load plugin "+a);0===--Wb&&mc&&S()}))});Eb.prototype=new hb;ib.prototype=new hb;ua.prototype=new hb;var Z={},ja,bd="",cd=0,ac;ac=q.isNode?process.nextTick:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,
0)};var vc=null,we=[0,8,7,77,"g606d872"],l={_helper:{}};l._helper.roundingfactor=1E4;l._helper.angleroundingfactor=10;l._helper.niceround=function(a,f){return Math.round(a*f)/f};l.niceprint=function(a,f){f=f||l._helper.roundingfactor;if("Angle"===a.usage)return l._helper.niceangle(a);var c=l._helper.niceround(a.value.real,f),p=l._helper.niceround(a.value.imag,f);return 0===p?""+c:0<p?""+c+" + i*"+p:""+c+" - i*"+-p};var Kc=q.angleUnit||"\u00b0",xe=Kc.replace(/\s+/g,""),Lc=2*Math.PI,ye=1/Lc,ze={rad:Lc,
"\u00b0":360,deg:360,degree:360,gra:400,grad:400,turn:1,cyc:1,rev:1,rot:1,"\u03c0":2,pi:2,quad:4};l._helper.niceangle=function(a){var f=ze[xe];if(!f)return l.niceprint(w.withUsage(a,null));if("function"===typeof f)return f(a);a=l.niceprint(l.realmult(f*ye,a),200<f?l._helper.angleroundingfactor:null);return-1===a.indexOf("i*")?a+Kc:"("+a+")"+Kc};l.complex=function(a,f){return{ctype:"number",value:{real:a,imag:f}}};l.real=function(a){return{ctype:"number",value:{real:a,imag:0}}};l.zero=l.real(0);l.one=
l.real(1);l.infinity=l.complex(Infinity,Infinity);l.nan=l.complex(NaN,NaN);l._helper.input=function(a){return"object"===typeof a?l.complex(+a.r,+a.i):l.real(+a)};l.argmax=function(a,f){return a.value.real*a.value.real+a.value.imag*a.value.imag<f.value.real*f.value.real+f.value.imag*f.value.imag?f:a};l.max=function(a,f){return{ctype:"number",value:{real:Math.max(a.value.real,f.value.real),imag:Math.max(a.value.imag,f.value.imag)}}};l.min=function(a,f){return{ctype:"number",value:{real:Math.min(a.value.real,
f.value.real),imag:Math.min(a.value.imag,f.value.imag)}}};l.add=function(a,f){return{ctype:"number",value:{real:a.value.real+f.value.real,imag:a.value.imag+f.value.imag}}};l.sub=function(a,f){return{ctype:"number",value:{real:a.value.real-f.value.real,imag:a.value.imag-f.value.imag}}};l.neg=function(a){return{ctype:"number",value:{real:-a.value.real,imag:-a.value.imag}}};l.re=function(a){return{ctype:"number",value:{real:a.value.real,imag:0}}};l.im=function(a){return{ctype:"number",value:{real:a.value.imag,
imag:0}}};l.conjugate=function(a){return{ctype:"number",value:{real:a.value.real,imag:-a.value.imag}}};l.round=function(a){return{ctype:"number",value:{real:Math.round(a.value.real),imag:Math.round(a.value.imag)}}};l.ceil=function(a){return{ctype:"number",value:{real:Math.ceil(a.value.real),imag:Math.ceil(a.value.imag)}}};l.floor=function(a){return{ctype:"number",value:{real:Math.floor(a.value.real),imag:Math.floor(a.value.imag)}}};l.mult=function(a,f){return{ctype:"number",value:{real:a.value.real*
f.value.real-a.value.imag*f.value.imag,imag:a.value.real*f.value.imag+a.value.imag*f.value.real}}};l.realmult=function(a,f){return{ctype:"number",value:{real:a*f.value.real,imag:a*f.value.imag}}};l.multiMult=function(a){var f=a[0];if("number"!==f.ctype)return k;for(var c=1;c<a.length;c++){if("number"!==a[c].ctype)return k;f=l.mult(f,a[c])}return f};l.abs2=function(a){return{ctype:"number",value:{real:a.value.real*a.value.real+a.value.imag*a.value.imag,imag:0}}};l.abs=function(a){return l.sqrt(l.abs2(a))};
l.inv=function(a){var f=a.value.real*a.value.real+a.value.imag*a.value.imag;return{ctype:"number",value:{real:a.value.real/f,imag:-a.value.imag/f}}};l.div=function(a,f){var c=a.value.real,p=a.value.imag,b=f.value.real,d=f.value.imag,h=b*b+d*d;return{ctype:"number",value:{real:(c*b+p*d)/h,imag:(p*b-c*d)/h}}};l.eps=1E-10;l.epsbig=1E-6;l.snap=function(a){var f=a.value.real;a=a.value.imag;Math.floor(f+l.eps)!==Math.floor(f-l.eps)&&(f=Math.round(f));Math.floor(a+l.eps)!==Math.floor(a-l.eps)&&(a=Math.round(a));
return{ctype:"number",value:{real:f,imag:a}}};l.exp=function(a){var f=Math.exp(a.value.real);return{ctype:"number",value:{real:f*Math.cos(a.value.imag),imag:f*Math.sin(a.value.imag)}}};l.cos=function(a){var f=a.value.real;a=a.value.imag;var c=Math.exp(a),p=c*Math.sin(-f),b=c*Math.cos(-f),c=Math.exp(-a);return{ctype:"number",value:{real:(b+c*Math.cos(f))/2,imag:(p+c*Math.sin(f))/2}}};l.sin=function(a){var f=a.value.real;a=a.value.imag;var c=Math.exp(a),p=c*Math.sin(-f),b=c*Math.cos(-f),c=Math.exp(-a);
return{ctype:"number",value:{real:-(p-c*Math.sin(f))/2,imag:(b-c*Math.cos(f))/2}}};l.tan=function(a){var f=l.sin(a);a=l.cos(a);return l.div(f,a)};l.arccos=function(a){var f=l.mult(a,l.neg(a)),f=l.sqrt(l.add(l.real(1),f));a=l.add(l.mult(a,l.complex(0,1)),f);a=l.add(l.mult(l.log(a),l.complex(0,1)),l.real(.5*Math.PI));return w.withUsage(a,"Angle")};l.arcsin=function(a){var f=l.mult(a,l.neg(a)),f=l.sqrt(l.add(l.real(1),f));a=l.add(l.mult(a,l.complex(0,1)),f);a=l.mult(l.log(a),l.complex(0,-1));return w.withUsage(a,
"Angle")};l.arctan=function(a){var f=l.log(l.add(l.mult(a,l.complex(0,-1)),l.real(1)));a=l.log(l.add(l.mult(a,l.complex(0,1)),l.real(1)));f=l.mult(l.sub(f,a),l.complex(0,.5));return w.withUsage(f,"Angle")};l.arctan2=function(a,f){var c;if(void 0===f)c=l.real(Math.atan2(a.value.imag,a.value.real));else if(l._helper.isReal(a)&&l._helper.isReal(f))c=l.real(Math.atan2(f.value.real,a.value.real));else{c=l.add(a,l.mult(l.complex(0,1),f));var p=l.sqrt(l.add(l.mult(a,a),l.mult(f,f)));c=l.mult(l.complex(0,
-1),l.log(l.div(c,p)))}return w.withUsage(c,"Angle")};l.sqrt=function(a){var f=a.value.real,c=a.value.imag;a=Math.sqrt(Math.sqrt(f*f+c*c));f=Math.atan2(c,f);return{ctype:"number",value:{real:a*Math.cos(f/2),imag:a*Math.sin(f/2)}}};l.powRealExponent=function(a,f){var c=a.value.real,p=a.value.imag,b=Math.pow(Math.sqrt(c*c+p*p),f),c=Math.atan2(p,c);return{ctype:"number",value:{real:b*Math.cos(c*f),imag:b*Math.sin(c*f)}}};l.log=function(a){var f=a.value.real;a=a.value.imag;var c=Math.sqrt(f*f+a*a),p=
Math.atan2(a,f);0>a&&(p+=2*Math.PI);0===a&&0>f&&(p=Math.PI);p>Math.PI&&(p-=2*Math.PI);return l.snap({ctype:"number",value:{real:Math.log(c),imag:p}})};l.pow=function(a,f){return l._helper.isZero(f)?l.one:l._helper.isZero(a)?l.zero:l._helper.isReal(f)?l.powRealExponent(a,f.value.real):l.exp(l.mult(l.log(a),f))};l.mod=function(a,f){var c=a.value.real,p=f.value.real,b=a.value.imag,d=f.value.imag,c=c-Math.floor(c/p)*p,b=b-Math.floor(b/d)*d;0===p&&(c=0);0===d&&(b=0);return l.snap({ctype:"number",value:{real:c,
imag:b}})};l._helper.seed="NO";l._helper.seedrandom=function(a){a-=Math.floor(a);l._helper.seed=.8*a+.1};l._helper.rand=function(){if("NO"===l._helper.seed)return Math.random();var a=l._helper.seed,a=1E3*Math.sin(1E3*a),a=a-Math.floor(a);return l._helper.seed=a};l._helper.randnormal=function(){var a=l._helper.rand(),f=l._helper.rand();return Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*f)};l._helper.isEqual=function(a,f){return a.value.real===f.value.real&&a.value.imag===f.value.imag};l._helper.isLessThan=
function(a,f){return a.value.real<f.value.real||a.value.real===f.value.real&&a.value.imag<f.value.imag};l._helper.compare=function(a,f){return l._helper.isLessThan(a,f)?-1:l._helper.isEqual(a,f)?0:1};l._helper.isAlmostEqual=function(a,f,c){var p=l.eps;"undefined"!==typeof c&&(p=c);c=a.value.real-f.value.real;a=a.value.imag-f.value.imag;return c<p&&c>-p&&a<p&&a>-p};l._helper.isZero=function(a){return 0===a.value.real&&0===a.value.imag};l._helper.isAlmostZero=function(a){var f=a.value.real;a=a.value.imag;
return f<l.eps&&f>-l.eps&&a<l.eps&&a>-l.eps};l._helper.isReal=function(a){return 0===a.value.imag};l._helper.isAlmostReal=function(a){a=a.value.imag;return a<l.epsbig&&a>-l.epsbig};l._helper.isNaN=function(a){return isNaN(a.value.real)||isNaN(a.value.imag)};l._helper.isFinite=function(a){return isFinite(a.value.real)&&isFinite(a.value.imag)};l._helper.isAlmostImag=function(a){a=a.value.real;return a<l.epsbig&&a>-l.epsbig};l._helper.z3a=l.complex(-.5,.5*Math.sqrt(3));l._helper.z3b=l.complex(-.5,-.5*
Math.sqrt(3));l._helper.cub1={ctype:"list",value:[l.one,l.one,l.one]};l._helper.cub2={ctype:"list",value:[l._helper.z3a,l.one,l._helper.z3b]};l._helper.cub3={ctype:"list",value:[l._helper.z3b,l.one,l._helper.z3a]};l.solveCubic=function(a,f,c,p){a=l._helper.solveCubicHelper(a,f,c,p);return[h.scalproduct(l._helper.cub1,a),h.scalproduct(l._helper.cub2,a),h.scalproduct(l._helper.cub3,a)]};l._helper.solveCubicHelper=function(a,f,c,p){var b=a.value.real;a=a.value.imag;var d=f.value.real;f=f.value.imag;
var e=c.value.real,g=c.value.imag,k=p.value.real,m=p.value.imag,n=b*e-a*g;c=b*g+a*e;p=4*n-(d*d-f*f);var q=4*c-2*d*f,r=b*d-a*f,t=b*f+a*d,u=p*e-q*g-18*(r*k-t*m),q=p*g+q*e-18*(r*m+t*k);p=27*(b*b-a*a);var v=54*a*b,w=p*k-v*m,x=p*m+v*k,y=d*d-f*f,z=2*d*f,A=y*d-z*f,B=y*f+z*d,C=w+4*A,v=x+4*B;p=27*(u*e-q*g+C*k-v*m);q=27*(u*g+q*e+C*m+v*k);C=Math.sqrt(Math.sqrt(p*p+q*q));v=Math.atan2(q,p);q=C*Math.sin(v/2);p=C*Math.cos(v/2);A=-2*A+9*(r*e-t*g)-w+(p*b-q*a);B=-2*B+9*(r*g+t*e)-x+(p*a+q*b);p=Math.exp(Math.log(Math.sqrt(A*
A+B*B))/3);e=Math.atan2(B,A);v=p*Math.sin(e/3);q=p*Math.cos(e/3);p*=p;e*=2;n=2*y-6*n;c=2*z-6*c;z=-1.5874010519681996*(d*q-f*v);d=-1.5874010519681996*(d*v+f*q);f=1.2599210498948732*p*Math.cos(e/3);e=1.2599210498948732*p*Math.sin(e/3);p=4.762203155904599*(q*b-v*a);q=4.762203155904599*(q*a+v*b);b=p*p+q*q;v=(-n*q+c*p)/b;n=(n*p+c*q)/b;c=v;v=(-z*q+d*p)/b;z=(z*p+d*q)/b;d=v;v=(-f*q+e*p)/b;f=(f*p+e*q)/b;e=v;return h.turnIntoCSList([l.complex(n,c),l.complex(z,d),l.complex(f,e)])};l._helper.getRangeRand=function(a,
f){return Math.random()*(f-a)+a};l.getRandReal=function(a,f){var c=l._helper.getRangeRand(a,f);return l.real(c)};l.getRandComplex=function(a,f){var c=l._helper.getRangeRand(a,f),p=l._helper.getRangeRand(a,f);return l.complex(c,p)};var h={_helper:{},turnIntoCSList:function(a){return{ctype:"list",value:a}}};h.EMPTY=h.turnIntoCSList([]);h.asList=function(a){return"list"===a.ctype?a:"number"===a.ctype||"boolean"===a.ctype||"geo"===a.ctype?h.turnIntoCSList([a]):h.EMPTY};h.realVector=function(a){for(var f=
[],c=0;c<a.length;c++)f[c]={ctype:"number",value:{real:a[c],imag:0}};return{ctype:"list",value:f}};h._helper.unitvector=function(a,f){var c=h.zerovector(a);c.value[Math.floor(f.value.real-1)]=l.real(1);return c};h.idMatrix=function(a){for(var f=h.zeromatrix(a,a),c=l.real(1),p=0;p<a.value.real;p++)f.value[p].value[p]=c;return f};h._helper.flippedidMatrix=function(a){for(var f=h.zeromatrix(a,a),c=l.real(1),p=0;p<a.value.real;p++)f.value[p].value[a.value.real-p-1]=c;return f};h.println=function(a){for(var f=
[],c=0;c<a.value.length;c++)if("number"===a.value[c].ctype)f[c]=l.niceprint(a.value[c]);else if("list"===a.value[c].ctype)h.println(a.value[c]);else return k;"number"===a.value[0].ctype&&console.log(f)};h.matrix=function(a){return h.turnIntoCSList(a.map(h.turnIntoCSList))};h.realMatrix=function(a){for(var f=a.length,c=Array(f),p=0;p<f;p++)c[p]=h.realVector(a[p]);return h.turnIntoCSList(c)};h.ex=h.realVector([1,0,0]);h.ey=h.realVector([0,1,0]);h.ez=h.realVector([0,0,1]);h.linfty=h.realVector([0,0,
1]);h.ii=h.turnIntoCSList([l.complex(1,0),l.complex(0,1),l.complex(0,0)]);h.jj=h.turnIntoCSList([l.complex(1,0),l.complex(0,-1),l.complex(0,0)]);h.fundDual=h.realMatrix([[1,0,0],[0,1,0],[0,0,0]]);h.fund=h.realMatrix([[0,0,0],[0,0,0],[0,0,1]]);h.sequence=function(a,f){for(var c=[],p=0,b=Math.round(a.value.real);b<Math.round(f.value.real)+1;b++)c[p]={ctype:"number",value:{real:b,imag:0}},p++;return{ctype:"list",value:c}};h.pairs=function(a){for(var f=[],c=0;c<a.value.length-1;c++)for(var p=c+1;p<a.value.length;p++)f.push({ctype:"list",
value:[a.value[c],a.value[p]]});return{ctype:"list",value:f}};h.triples=function(a){for(var f=[],c=0;c<a.value.length-2;c++)for(var p=c+1;p<a.value.length-1;p++)for(var b=p+1;b<a.value.length;b++)f.push({ctype:"list",value:[a.value[c],a.value[p],a.value[b]]});return{ctype:"list",value:f}};h.cycle=function(a){for(var f=[],c=0;c<a.value.length-1;c++)f[c]={ctype:"list",value:[a.value[c],a.value[c+1]]};f.push({ctype:"list",value:[a.value[a.value.length-1],a.value[0]]});return{ctype:"list",value:f}};h.consecutive=
function(a){for(var f=[],c=0;c<a.value.length-1;c++)f[c]={ctype:"list",value:[a.value[c],a.value[c+1]]};return{ctype:"list",value:f}};h.reverse=function(a){for(var f=Array(a.value.length),c=a.value.length-1,p=0;0<=c;c--,p++)f[p]=a.value[c];return{ctype:"list",value:f}};h.directproduct=function(a,f){for(var c=[],p=0;p<a.value.length;p++)for(var b=0;b<f.value.length;b++)c.push({ctype:"list",value:[a.value[p],f.value[b]]});return{ctype:"list",value:c}};h.concat=function(a,f){for(var c=[],p=0;p<a.value.length;p++)c.push(a.value[p]);
for(p=0;p<f.value.length;p++)c.push(f.value[p]);return{ctype:"list",value:c}};h.prepend=function(a,f){var c=[];c[0]=a;for(var p=0;p<f.value.length;p++)c[p+1]=f.value[p];return{ctype:"list",value:c}};h.append=function(a,f){for(var c=[],p=0;p<a.value.length;p++)c[p]=a.value[p];c.push(f);return{ctype:"list",value:c}};h.contains=function(a,f){for(var c=0;c<a.value.length;c++)if(D.equals(a.value[c],f).value)return{ctype:"boolean",value:!0};return{ctype:"boolean",value:!1}};h.common=function(a,f){for(var c=
[],p=0,b=0;b<a.value.length;b++){for(var d=!1,h=a.value[b],e=0;e<f.value.length;e++)d=d||D.equals(h,f.value[e]).value;d&&(c[p]=a.value[b],p++)}return{ctype:"list",value:c}};h.remove=function(a,f){for(var c=[],p=0,b=0;b<a.value.length;b++){for(var d=!1,h=a.value[b],e=0;e<f.value.length;e++)d=d||D.equals(h,f.value[e]).value;d||(c[p]=a.value[b],p++)}return{ctype:"list",value:c}};h.sort1=function(a){a=a.value.slice();a.sort(w.compare);return h.turnIntoCSList(a)};h._helper.isEqual=function(a,f){return h.equals(a,
f).value};h._helper.isLessThan=function(a,f){for(var c=a.value.length,p=f.value.length,b=0;!(b>=c||b>=p)&&w.isEqual(a.value[b],f.value[b]);)b++;return b===c&&b<p?!0:b===p&&b<c||b===c&&b===p?!1:w.isLessThan(a.value[b],f.value[b])};h._helper.compare=function(a,f){return h._helper.isLessThan(a,f)?-1:h._helper.isEqual(a,f)?0:1};h.equals=function(a,f){if(a.value.length!==f.value.length)return{ctype:"boolean",value:!1};for(var c=!0,p=0;p<a.value.length;p++)var b=a.value[p],d=f.value[p],c="list"===b.ctype&&
"list"===d.ctype?c&&h.equals(b,d).value:c&&vb([b,d],[]).value;return{ctype:"boolean",value:c}};h.almostequals=function(a,f){if(a.value.length!==f.value.length)return{ctype:"boolean",value:!1};for(var c=!0,p=0;p<a.value.length;p++)var b=a.value[p],d=f.value[p],c="list"===b.ctype&&"list"===d.ctype?c&&h.almostequals(b,d).value:c&&jc([b,d],[]).value;return{ctype:"boolean",value:c}};h._helper.isAlmostReal=function(a){for(var f=!0,c=0;c<a.value.length;c++)var p=a.value[c],f="list"===p.ctype?f&&h._helper.isAlmostReal(p):
f&&l._helper.isAlmostReal(p);return f};h._helper.isAlmostZero=function(a){for(var f=0;f<a.value.length;f++){var c=a.value[f];if("list"===c.ctype){if(!h._helper.isAlmostZero(c))return!1}else if(!l._helper.isAlmostZero(c))return!1}return!0};h._helper.isNaN=function(a){for(var f=!1,c=0;c<a.value.length;c++)var p=a.value[c],f="list"===p.ctype?f||h._helper.isNaN(p):f||l._helper.isNaN(p);return f};h.set=function(a){var f=[],c=0;a=a.value.slice();a.sort(w.compare);for(var p=0;p<a.length;p++)0!==p&&vb([f[f.length-
1],a[p]],[]).value||(f[c]=a[p],c++);return{ctype:"list",value:f}};h.maxval=function(a){for(var f=l.zero,c=0;c<a.value.length;c++){var p=a.value[c];"number"===p.ctype&&(f=l.argmax(f,p));"list"===p.ctype&&(f=l.argmax(f,h.maxval(p)))}return f};h.maxIndex=function(a,f,c){var p=0;void 0!==c&&(p=c);c=p;for(var b=f(a.value[p]).value.real;p<a.value.length;++p){var d=f(a.value[p]).value.real;d>b&&(c=p,b=d)}return c};h.normalizeMax=function(a){var f=l.inv(h.maxval(a));return l._helper.isFinite(f)?h.scalmult(f,
a):a};h.normalizeZ=function(a){var f=l.inv(a.value[2]);return h.scalmult(f,a)};h.dehom=function(a){a=a.value.slice();var f=a.length-1,c=l.inv(a[f]);a.length=f;for(var p=0;p<f;++p)a[p]=l.mult(c,a[p]);return h.turnIntoCSList(a)};h.normalizeAbs=function(a){var f=l.inv(h.abs(a));return h.scalmult(f,a)};h.max=function(a,f){if(a.value.length!==f.value.length)return k;for(var c=[],p=0;p<a.value.length;p++)c[p]=w.max(a.value[p],f.value[p]);return{ctype:"list",value:c}};h.min=function(a,f){if(a.value.length!==
f.value.length)return k;for(var c=[],p=0;p<a.value.length;p++)c[p]=w.min(a.value[p],f.value[p]);return{ctype:"list",value:c}};h.scaldiv=function(a,f){if("number"!==a.ctype)return k;for(var c=[],p=0;p<f.value.length;p++){var b=f.value[p];c[p]="number"===b.ctype?w.div(b,a):"list"===b.ctype?h.scaldiv(a,b):k}return{ctype:"list",value:c}};h.scalmult=function(a,f){if("number"!==a.ctype)return k;for(var c=[],p=0;p<f.value.length;p++){var b=f.value[p];c[p]="number"===b.ctype?w.mult(b,a):"list"===b.ctype?
h.scalmult(a,b):k}return{ctype:"list",value:c}};h.add=function(a,f){if(a.value.length!==f.value.length)return k;for(var c=[],p=0;p<a.value.length;p++){var b=a.value[p],d=f.value[p];c[p]="number"===b.ctype&&"number"===d.ctype?w.add(b,d):"list"===b.ctype&&"list"===d.ctype?h.add(b,d):k}return{ctype:"list",value:c}};h.sub=function(a,f){if(a.value.length!==f.value.length)return k;for(var c=[],p=0;p<a.value.length;p++){var b=a.value[p],d=f.value[p];c[p]="number"===b.ctype&&"number"===d.ctype?l.sub(b,d):
"list"===b.ctype&&"list"===d.ctype?h.sub(b,d):k}return{ctype:"list",value:c}};h.abs2=function(a){for(var f=0,c=0;c<a.value.length;c++){var p=a.value[c];if("number"===p.ctype)f+=l.abs2(p).value.real;else if("list"===p.ctype)f+=h.abs2(p).value.real;else return k}return{ctype:"number",value:{real:f,imag:0}}};h.abs=function(a){return l.sqrt(h.abs2(a))};h.normalizeMaxXX=function(a){for(var f=-1E4,c=l.real(1),p=0;p<a.value.length;p++){var b=l.abs(a.value[p]);b.value.real>f&&(c=a.value[p],f=b.value.real)}return h.scaldiv(c,
a)};h.recursive=function(a,f){for(var c=[],p=0;p<a.value.length;p++){var b=B(a.value[p]);c[p]="number"===b.ctype?l[f](b):"list"===b.ctype?h[f](b):k}return{ctype:"list",value:c}};h.re=function(a){return h.recursive(a,"re")};h.neg=function(a){return h.recursive(a,"neg")};h.im=function(a){return h.recursive(a,"im")};h.conjugate=function(a){return h.recursive(a,"conjugate")};h.transjugate=function(a){return h.transpose(h.conjugate(a))};h.round=function(a){return h.recursive(a,"round")};h.ceil=function(a){return h.recursive(a,
"ceil")};h.floor=function(a){return h.recursive(a,"floor")};h._helper.colNumb=function(a){if("list"!==a.ctype)return-1;for(var f=-1,c=0;c<a.value.length;c++){if("list"!==a.value[c].ctype)return-1;if(0===c)f=a.value[c].value.length;else if(f!==a.value[c].value.length)return-1}return f};h._helper.isNumberVecN=function(a,f){if("list"!==a.ctype||a.value.length!==f)return!1;for(var c=0;c<a.value.length;c++)if("number"!==a.value[c].ctype)return!1;return!0};h.isNumberVector=function(a){if("list"!==a.ctype)return{ctype:"boolean",
value:!1};for(var f=0;f<a.value.length;f++)if("number"!==a.value[f].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};h.isNumberVectorN=function(a,f){if("list"!==a.ctype)return{ctype:"boolean",value:!1};if(a.value)for(var c=0;c<a.value.length;c++)if("number"!==a.value[c].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};h.isNumberMatrix=function(a){if(-1===h._helper.colNumb(a))return{ctype:"boolean",value:!1};for(var f=0;f<a.value.length;f++)if(!h.isNumberVector(a.value[f]).value)return{ctype:"boolean",
value:!1};return{ctype:"boolean",value:!0}};h._helper.isNumberMatrixMN=function(a,f,c){return h.isNumberMatrix(a).value&&a.value.length===f&&a.value[0].value.length===c};h.scalproduct=function(a,f){if(a.value.length!==f.value.length)return k;for(var c={ctype:"number",value:{real:0,imag:0}},p=0;p<f.value.length;p++){var b=a.value[p],d=f.value[p];if("number"===b.ctype&&"number"===d.ctype)c=l.add(l.mult(b,d),c);else return k}return c};h.sesquilinearproduct=function(a,f){if(a.value.length!==f.value.length)return k;
for(var c=0,p=0,b=0;b<f.value.length;b++)var d=a.value[b].value,h=f.value[b].value,c=c+(d.real*h.real+d.imag*h.imag),p=p+(d.real*h.imag-d.imag*h.real);return l.complex(c,p)};h.normSquared=function(a){for(var f=0,c=0;c<a.value.length;c++)var p=a.value[c].value,f=f+(p.real*p.real+p.imag*p.imag);return l.real(f)};h.productMV=function(a,f){if(a.value[0].value.length!==f.value.length)return k;for(var c=[],p=0;p<a.value.length;p++){for(var b={ctype:"number",value:{real:0,imag:0}},d=a.value[p],e=0;e<f.value.length;e++){var g=
d.value[e],m=f.value[e];if("number"===g.ctype&&"number"===m.ctype)b=l.add(l.mult(g,m),b);else return k}c[p]=b}return h.turnIntoCSList(c)};h.productVM=function(a,f){if(a.value.length!==f.value.length)return k;for(var c=[],p=0;p<f.value[0].value.length;p++){for(var b={ctype:"number",value:{real:0,imag:0}},d=0;d<a.value.length;d++){var e=a.value[d],g=f.value[d].value[p];if("number"===e.ctype&&"number"===g.ctype)b=l.add(l.mult(e,g),b);else return k}c[p]=b}return h.turnIntoCSList(c)};h.productMM=function(a,
f){if(a.value[0].value.length!==f.value.length)return k;for(var c=[],p=0;p<a.value.length;p++){var b=h.productVM(a.value[p],f);c[p]=b}return h.turnIntoCSList(c)};h.mult=function(a,f){return a.value.length===f.value.length&&h.isNumberVector(a).value&&h.isNumberVector(f).value?h.scalproduct(a,f):h.isNumberMatrix(a).value&&f.value.length===a.value[0].value.length&&h.isNumberVector(f).value?h.productMV(a,f):h.isNumberMatrix(f).value&&a.value.length===f.value.length&&h.isNumberVector(a).value?h.productVM(a,
f):h.isNumberMatrix(a).value&&h.isNumberMatrix(f).value&&f.value.length===a.value[0].value.length?h.productMM(a,f):k};h.projectiveDistMinScal=function(a,f){var c=h.abs(a),p=h.abs(f);if(0===c.value.real||0===p.value.real)return 0;var b=h.conjugate(f),b=h.scalproduct(a,b),b=l._helper.isAlmostZero(b)?l.real(1):l.div(b,l.abs(b)),c=h.scaldiv(c,a),p=h.scaldiv(p,f),p=h.scalmult(b,p),b=h.abs(h.add(c,p)),p=h.abs(h.sub(c,p));return Math.min(b.value.real,p.value.real)};h.conicDist=function(a,f){var c=v(a),p=
v(f);console.log(Y(c),Y(p));return h.projectiveDistMinScal(c,p)};h.crossOperator=function(a){var f=a.value[0],c=a.value[1];a=a.value[2];return h.turnIntoCSList([h.turnIntoCSList([l.zero,l.neg(a),c]),h.turnIntoCSList([a,l.zero,l.neg(f)]),h.turnIntoCSList([l.neg(c),f,l.zero])])};h.cross=function(a,f){var c=l.sub(l.mult(a.value[1],f.value[2]),l.mult(a.value[2],f.value[1])),p=l.sub(l.mult(a.value[2],f.value[0]),l.mult(a.value[0],f.value[2])),b=l.sub(l.mult(a.value[0],f.value[1]),l.mult(a.value[1],f.value[0]));
return h.turnIntoCSList([c,p,b])};h.crossratio3harm=function(a,f,c,p,b){var d=h.det3(a,c,b),e=h.det3(f,p,b);a=h.det3(a,p,b);f=h.det3(f,c,b);d=l.mult(d,e);e=l.mult(a,f);return h.turnIntoCSList([d,e])};h.crossratio3=function(a,f,c,p,b){a=h.crossratio3harm(a,f,c,p,b);return l.div(a.value[0],a.value[1])};h.veronese=function(a){var f=l.mult(a.value[0],a.value[0]),c=l.mult(a.value[1],a.value[1]),p=l.mult(a.value[2],a.value[2]),b=l.mult(a.value[0],a.value[1]),d=l.mult(a.value[0],a.value[2]);a=l.mult(a.value[1],
a.value[2]);return h.turnIntoSCList([f,c,p,b,d,a])};h.matrixFromVeronese=function(a){var f=a.value[0],c=a.value[1],p=a.value[2],b=l.realmult(.5,a.value[3]),d=l.realmult(.5,a.value[4]);a=l.realmult(.5,a.value[5]);return h.turnIntoCSList([h.turnIntoCSList([f,b,d]),h.turnIntoCSList([b,c,a]),h.turnIntoCSList([d,a,p])])};h.det2=function(a,f){var c=l.mult(a.value[0],f.value[1]);return c=l.sub(c,l.mult(a.value[1],f.value[0]))};h.det3=function(a,f,c){return l.complex(a.value[0].value.real*f.value[1].value.real*
c.value[2].value.real-a.value[0].value.imag*f.value[1].value.imag*c.value[2].value.real-a.value[0].value.imag*f.value[1].value.real*c.value[2].value.imag-a.value[0].value.real*f.value[1].value.imag*c.value[2].value.imag+a.value[2].value.real*f.value[0].value.real*c.value[1].value.real-a.value[2].value.imag*f.value[0].value.imag*c.value[1].value.real-a.value[2].value.imag*f.value[0].value.real*c.value[1].value.imag-a.value[2].value.real*f.value[0].value.imag*c.value[1].value.imag+a.value[1].value.real*
f.value[2].value.real*c.value[0].value.real-a.value[1].value.imag*f.value[2].value.imag*c.value[0].value.real-a.value[1].value.imag*f.value[2].value.real*c.value[0].value.imag-a.value[1].value.real*f.value[2].value.imag*c.value[0].value.imag-a.value[0].value.real*f.value[2].value.real*c.value[1].value.real+a.value[0].value.imag*f.value[2].value.imag*c.value[1].value.real+a.value[0].value.imag*f.value[2].value.real*c.value[1].value.imag+a.value[0].value.real*f.value[2].value.imag*c.value[1].value.imag-
a.value[2].value.real*f.value[1].value.real*c.value[0].value.real+a.value[2].value.imag*f.value[1].value.imag*c.value[0].value.real+a.value[2].value.imag*f.value[1].value.real*c.value[0].value.imag+a.value[2].value.real*f.value[1].value.imag*c.value[0].value.imag-a.value[1].value.real*f.value[0].value.real*c.value[2].value.real+a.value[1].value.imag*f.value[0].value.imag*c.value[2].value.real+a.value[1].value.imag*f.value[0].value.real*c.value[2].value.imag+a.value[1].value.real*f.value[0].value.imag*
c.value[2].value.imag,-a.value[0].value.imag*f.value[1].value.imag*c.value[2].value.imag+a.value[0].value.imag*f.value[1].value.real*c.value[2].value.real+a.value[0].value.real*f.value[1].value.real*c.value[2].value.imag+a.value[0].value.real*f.value[1].value.imag*c.value[2].value.real-a.value[2].value.imag*f.value[0].value.imag*c.value[1].value.imag+a.value[2].value.imag*f.value[0].value.real*c.value[1].value.real+a.value[2].value.real*f.value[0].value.real*c.value[1].value.imag+a.value[2].value.real*
f.value[0].value.imag*c.value[1].value.real-a.value[1].value.imag*f.value[2].value.imag*c.value[0].value.imag+a.value[1].value.imag*f.value[2].value.real*c.value[0].value.real+a.value[1].value.real*f.value[2].value.real*c.value[0].value.imag+a.value[1].value.real*f.value[2].value.imag*c.value[0].value.real+a.value[0].value.imag*f.value[2].value.imag*c.value[1].value.imag-a.value[0].value.imag*f.value[2].value.real*c.value[1].value.real-a.value[0].value.real*f.value[2].value.real*c.value[1].value.imag-
a.value[0].value.real*f.value[2].value.imag*c.value[1].value.real+a.value[2].value.imag*f.value[1].value.imag*c.value[0].value.imag-a.value[2].value.imag*f.value[1].value.real*c.value[0].value.real-a.value[2].value.real*f.value[1].value.real*c.value[0].value.imag-a.value[2].value.real*f.value[1].value.imag*c.value[0].value.real+a.value[1].value.imag*f.value[0].value.imag*c.value[2].value.imag-a.value[1].value.imag*f.value[0].value.real*c.value[2].value.real-a.value[1].value.real*f.value[0].value.real*
c.value[2].value.imag-a.value[1].value.real*f.value[0].value.imag*c.value[2].value.real)};h.det4m=function(a){var f=a.value,c=f[0].value,p=c[0].value,b=+p.real,d=+p.imag,p=c[1].value,h=+p.real,e=+p.imag,p=c[2].value,g=+p.real,k=+p.imag,p=c[3].value,m=+p.real,n=+p.imag,c=f[1].value,p=c[0].value,q=+p.real,r=+p.imag,p=c[1].value,t=+p.real,u=+p.imag,p=c[2].value,v=+p.real,w=+p.imag,p=c[3].value,c=+p.real,p=+p.imag;a=b*t-d*u-h*q+e*r;var x=b*u+d*t-h*r-e*q,y=b*v-d*w-g*q+k*r,z=b*w+d*v-g*r-k*q,A=b*c-d*p-m*
q+n*r,B=b*p+d*c-m*r-n*q,C=h*v-e*w-g*t+k*u,D=h*w+e*v-g*u-k*t,E=h*c-e*p-m*t+n*u,F=h*p+e*c-m*u-n*t,G=g*c-k*p-m*v+n*w,H=g*p+k*c-m*w-n*v,c=f[2].value,p=c[0].value,b=+p.real,d=+p.imag,p=c[1].value,h=+p.real,e=+p.imag,p=c[2].value,g=+p.real,k=+p.imag,p=c[3].value,m=+p.real,n=+p.imag,c=f[3].value,p=c[0].value,q=+p.real,r=+p.imag,p=c[1].value,t=+p.real,u=+p.imag,p=c[2].value,v=+p.real,w=+p.imag,p=c[3].value,c=+p.real,p=+p.imag,f=b*t-d*u-h*q+e*r,N=b*u+d*t-h*r-e*q,I=b*v-d*w-g*q+k*r,L=b*w+d*v-g*r-k*q,M=b*c-d*
p-m*q+n*r,b=b*p+d*c-m*r-n*q,d=h*v-e*w-g*t+k*u,q=h*w+e*v-g*u-k*t,r=h*c-e*p-m*t+n*u,h=h*p+e*c-m*u-n*t,e=g*c-k*p-m*v+n*w,g=g*p+k*c-m*w-n*v;return l.complex(a*e-x*g-y*r+z*h+A*d-B*q+C*M-D*b-E*I+F*L+G*f-H*N,a*g+x*e-y*h-z*r+A*q+B*d+C*b+D*M-E*L-F*I+G*N+H*f)};h.eucangle=function(a,f){var c=h.cross(a,h.linfty),p=h.cross(f,h.linfty),b=h.det3(h.ez,c,h.ii),c=h.det3(h.ez,c,h.jj),d=h.det3(h.ez,p,h.ii),p=h.det3(h.ez,p,h.jj),b=l.div(l.mult(b,p),l.mult(d,c)),b=l.log(b);return b=l.mult(b,l.complex(0,.5))};h.zerovector=
function(a){a=Math.floor(a.value.real);for(var f=Array(a),c=0;c<a;c++)f[c]=0;return h.realVector(f)};h.zeromatrix=function(a,f){for(var c=Math.floor(a.value.real),p=Array(c),b=0;b<c;b++)p[b]=h.zerovector(f);return h.turnIntoCSList(p)};h.vandermonde=function(a){for(var f=a.value.length,c=h.zeromatrix(f,f),p=0;p<f;p++)for(var b=0;b<f;b++)c.value[p].value[b]=l.pow(a.value[p],l.real(b-1));return c};h.transpose=function(a){for(var f=[],c=a.value[0].value.length,p=a.value.length,b=0;b<c;b++){for(var d=
[],e=0;e<p;e++)d[e]=a.value[e].value[b];f[b]=h.turnIntoCSList(d)}return h.turnIntoCSList(f)};h.column=function(a,f){for(var c=[],p=a.value.length,b=Math.floor(f.value.real-1),d=0;d<p;d++)c[d]=a.value[d].value[b];return h.turnIntoCSList(c)};h.row=function(a,f){for(var c=[],p=a.value[0].value.length,b=Math.floor(f.value.real-1),d=0;d<p;d++)c[d]=a.value[b].value[d];return h.turnIntoCSList(c)};h.adjoint2=function(a){var f=a.value[0].value[0],c=a.value[1].value[0],p=Array(2);p[0]=h.turnIntoCSList([a.value[1].value[1],
l.neg(a.value[0].value[1])]);p[1]=h.turnIntoCSList([l.neg(c),f]);return p=h.turnIntoCSList(p)};h.adjoint3=function(a){var f,c,p,b,d,h,e,g,l,k,m,n,q,r,t,u,v;f=a.value[0].value;c=f[0].value;p=c.real;b=c.imag;c=f[1].value;d=c.real;h=c.imag;c=f[2].value;e=c.real;g=c.imag;f=a.value[1].value;c=f[0].value;l=c.real;k=c.imag;c=f[1].value;m=c.real;n=c.imag;c=f[2].value;q=c.real;r=c.imag;f=a.value[2].value;c=f[0].value;a=c.real;t=c.imag;c=f[1].value;u=c.real;v=c.imag;c=f[2].value;f=c.real;c=c.imag;return{ctype:"list",
value:[{ctype:"list",value:[{ctype:"number",value:{real:m*f-q*u-n*c+r*v,imag:m*c-q*v-u*r+f*n}},{ctype:"number",value:{real:-d*f+e*u+h*c-g*v,imag:-d*c+e*v+u*g-f*h}},{ctype:"number",value:{real:d*q-e*m-h*r+g*n,imag:d*r-e*n-m*g+q*h}}]},{ctype:"list",value:[{ctype:"number",value:{real:-l*f+q*a+k*c-r*t,imag:-l*c+q*t+a*r-f*k}},{ctype:"number",value:{real:p*f-e*a-b*c+g*t,imag:p*c-e*t-a*g+f*b}},{ctype:"number",value:{real:-p*q+e*l+b*r-g*k,imag:-p*r+e*k+l*g-q*b}}]},{ctype:"list",value:[{ctype:"number",value:{real:l*
u-m*a-k*v+n*t,imag:l*v-m*t-a*n+u*k}},{ctype:"number",value:{real:-p*u+d*a+b*v-h*t,imag:-p*v+d*t+a*h-u*b}},{ctype:"number",value:{real:p*m-d*l-b*n+h*k,imag:p*n-d*k-l*h+m*b}}]}]}};h.inverse=function(a){var f=a.value.length;if(f!==a.value[0].value.length)return console.log("Inverse works only for square matrices"),k;if(2===f)return h.scaldiv(h.det(a),h.adjoint2(a));if(3===f)return h.scaldiv(h.det(a),h.adjoint3(a));f=h.LUdecomp(a);a=a.value.length;var c=l.real(0),p=l.real(1),b=h.zerovector(l.real(a));
b.value[0]=p;for(var d=Array(a),e=0;e<a;e++)d[e]=h._helper.LUsolve(f,b),b.value[e]=c,b.value[e+1]=p;d=h.turnIntoCSList(d);return d=h.transpose(d)};h.linearsolve=function(a,f){return 2===a.value.length?h.linearsolveCramer2(a,f):3===a.value.length?h.linearsolveCramer3(a,f):h.LUsolve(a,f)};h.getDiag=function(a){if(a.value.length!==a.value[0].value.length)return k;for(var f=Array(a.value.length),c=0;c<a.value.length;c++)f[c]=a.value[c].value[c];return h.turnIntoCSList(f)};h.getSubDiag=function(a){if(a.value.length!==
a.value[0].value.length)return k;for(var f=Array(a.value.length-1),c=0;c<a.value.length-1;c++)f[c]=a.value[c+1].value[c];return h.turnIntoCSList(f)};h.eig2=function(a){var f=l.add(a.value[0].value[0],a.value[1].value[1]);a=h.det2(a.value[0],a.value[1]);var c=l.mult(f,f),p=f=l.mult(f,l.real(.5));a=l.sqrt(l.sub(l.div(c,l.real(4)),a));f=l.add(f,a);p=l.sub(p,a);return h.turnIntoCSList([f,p])};h.eig=function(a,f){var c=f||!0,p=a,b=l.real(p.value.length),d=b.value.real;l.real(0);var p=h._helper.QRIteration(p)[0],
p=h.getDiag(p),p=h.sort1(p),b=h.idMatrix(b,b),e=Array(d),e=h.turnIntoCSList(e);if(c){for(var g,k,m,n=0,q=!1,c=0;c<d;c++)q?k=g.value[n]:(g=p.value[c],g=h.sub(a,h.scalmult(g,b)),g=h.nullSpace(g),k=g.value[0],void 0!==k&&(m=k)),void 0===k&&(k=m),1E-8>h.abs(k).value.real&&0===n&&(k=h._helper.inverseIteration(a,p.value[c])),e.value[c]=h._helper.isAlmostZeroVec(k)?k:h.scaldiv(h.abs(k),k),c<d-1&&((q=1E-6>l.abs(l.sub(p.value[c],p.value[c+1])).value.real)?n++:n=0);e=h.transpose(e)}return h.turnIntoCSList([p,
e])};h._helper.isNormalMatrix=function(a){return 1E-10>h.abs(h.sub(a,h.transjugate(a))).value.real};h._helper.QRIteration=function(a,f){var c,p=a;c=l.real(p.value.length);var b=c.value.real,d=c.value.real;l.real(0);var e;h.idMatrix(c,c);var g=h.zeromatrix(c,c),k=h.idMatrix(c,c),m=f?f:2500,n,q,r,t=0,u=Array(d);for(c=0;c<m;c++){e=h._helper.getBlock(p,[d-2,d-1],[d-2,d-1]);n=h.eig2(e);e=n.value[0];n=n.value[1];h.abs(e);h.abs(n);q=p.value[d-1].value[d-1];r=l.abs(l.sub(q,e)).value.real;q=l.abs(l.sub(q,
n)).value.real;n=r<q?e:n;e=h.idMatrix(l.real(d),l.real(d));n=h.scalmult(n,e);e=h.QRdecomp(h.sub(p,n));p=w.mult(e.R,e.Q);p=h.add(p,n);e.Q=h._helper.buildBlockMatrix(e.Q,h.idMatrix(l.real(t),l.real(t)));k=w.mult(k,e.Q);if(1E-48>l.abs2(p.value[p.value.length-1].value[p.value[0].value.length-2]).value.real&&1<d){u[b-t-1]=p.value[d-1].value[d-1];for(c=0;c<d;c++)g.value[d-1].value[c]=p.value[d-1].value[c],g.value[c].value[d-1]=p.value[c].value[d-1];p=h._helper.getBlock(p,[0,d-2],[0,d-2]);t++;d--}if(1===
d){g.value[0].value[0]=p.value[0].value[0];break}if(h._helper.isUpperTriangular(p)){for(c=0;c<d;c++)g.value[c].value[c]=p.value[c].value[c];break}}return[g,k]};h.rank=function(a,f){return h.RRQRdecomp(a,f).rank};h._helper.isAlmostZeroVec=function(a){for(var f=a.value.length,c=0;c<f;c++)if(!l._helper.isAlmostZero(a.value[c]))return!1;return!0};h._helper.isLowerTriangular=function(a){for(var f=a.value.length,c=a.value[0].value.length,p=0;p<f;p++)for(var b=p+1;b<c;b++)if(!l._helper.isAlmostZero(a.value[p].value[b]))return!1;
return!0};h._helper.isUpperTriangular=function(a){return h._helper.isLowerTriangular(h.transpose(a))};h._helper.isAlmostId=function(a){var f=a.value.length,c=l.real(f);if(f!==a.value[0].value.length)return!1;a=h.sub(a,h.idMatrix(c),c);for(c=0;c<f;c++)for(var p=0;p<f;p++)if(1E-16<l.abs(a.value[c].value[p]).value.real)return!1;return!0};h.nullSpace=function(a,f){var c=a.value.length,p=h.RRQRdecomp(h.transjugate(a),f),b=h.transpose(p.Q),p=c-p.rank.value.real,d=Array(p);b.value.reverse();for(var e,g=
0;g<p;g++)e=b.value[g],d[g]=h.scaldiv(h.abs(e),e);d=h.turnIntoCSList(d);return 0<d.value.length?d:h.turnIntoCSList([h.zerovector(l.real(c))])};h._helper.isAlmostDiagonal=function(a){var f=a.value.length;l.real(f);l.real(0);if(f!==a.value[0].value.length)return!1;for(var c=0;c<f;c++)for(var p=0;p<f;p++)if(c!==p&&1E-16<l.abs(a.value[c].value[p]).value.real)return!1;return!0};h._helper.inverseIteration=function(a,f){console.log("warning: code untested");for(var c=a.value.length,p=Array(c),b=0;b<c;b++)p[b]=
2*Math.random()-.5;for(var p=h.realVector(p),c=h.idMatrix(l.real(c),l.real(c)),b=l.add(f,l.real(.1*Math.random()-.5)),d=0;100>d;d++)p=h.scaldiv(h.abs(p),p),p=h.LUsolve(h.sub(a,h.scalmult(b,c)),JSON.parse(JSON.stringify(p)));return h.scaldiv(h.abs(p),p)};h._helper.toHessenberg=function(a){var f=JSON.parse(JSON.stringify(a)),c=f.value.length,b=l.real(c-1),d=l.real(c);l.real(1);if(h._helper.isUpperTriangular(f))return[h.idMatrix(b,b),a];var e;a=h.idMatrix(d,d);for(var g,d=1;d<c-1;d++)e=h.column(f,l.real(d)),
e.value=e.value.splice(d),g=h.abs2(e).value.real,1E-16<g&&(e=h._helper.getHouseHolder(e),a=w.mult(a,e),f=w.mult(w.mult(e,f),e)),b.value.real--;return[a,f]};h._helper.swapEl=function(a,f,c){var b;"[object Array]"===Object.prototype.toString.call(a)?(b=a[f],a[f]=a[c],a[c]=b):"list"===a.ctype&&(b=a.value[f],a.value[f]=a.value[c],a.value[c]=b)};h.RRQRdecomp=function(a,f){var c=Math.sqrt(l.eps);void 0!==f&&(c=.1*f.value.real);var c=c*c,b,d=a.value.length,e=l.real(d),g=l.real(1),k=h._helper.unitvector(l.real(a.value.length),
g),m=h.idMatrix(e,e),n=JSON.parse(JSON.stringify(a)),q=h.transpose(a),r=Array(d);for(b=0;b<d;b++)r[b]=h.abs2(q.value[b]);r=h.turnIntoCSList(r);q=Array(d);for(b=0;b<d;b++)q[b]=b;b=h.maxIndex(r,l.abs);for(var t=r.value[b],u=0,v=0;1E-16<l.abs2(t).value.real;v++){u++;h._helper.swapColumn(n,v,b);h._helper.swapEl(r,v,b);h._helper.swapEl(q,v,b);b=h._helper.getBlock(n,[v],[v]);b=h.column(b,g);t=h.abs2(b).value.real;1E-8<t&&(b=h._helper.getHouseHolder(b),b=h._helper.buildBlockMatrix(h.idMatrix(l.real(v),l.real(v)),
b),m=w.mult(m,h.transjugate(b)),n=w.mult(b,n));for(b=v+1;b<d;b++)r.value[b]=l.sub(r.value[b],l.mult(n.value[v].value[b],l.conjugate(n.value[v].value[b])));b=h.maxIndex(r,l.abs2,v+1);t=r.value[b];if(v+2===d){l.abs(t).value.real>c&&u++;break}e=l.sub(e,g);k.value=k.value.splice(0,k.value.length-1)}return{Q:m,R:n,P:h.turnIntoCSList(q),rank:l.real(u)}};h._helper.getHouseHolder=function(a){var f=l.real(a.value.length);if(1E-16>h.abs2(a))return h.idMatrix(f,f);var c,b=l.real(1),d=h._helper.unitvector(l.real(a.value.length),
b);c=h._helper.QRgetAlpha(a,0);c=h.sub(a,h.scalmult(c,d));c=h.scaldiv(h.abs(c),c);a=l.div(h.sesquilinearproduct(a,c),h.sesquilinearproduct(c,a));f=h.idMatrix(f,f);return f=h.sub(f,h.scalmult(l.add(b,a),h._helper.transposeMult(c,h.conjugate(c))))};h._helper.reOrderbyPivots=function(a,f){for(var c=a.value.length.length,b=h.transpose(a),c=Array(c),d=0;d<f.length;d++)c[f[d]]=b.value[d];c=h.turnIntoCSList(c);return h.transpose(c)};h.QRdecomp=function(a){var f,c=a.value.length,b=l.real(c);if(h._helper.isUpperTriangular(a))return{Q:h.idMatrix(b,
b),R:a};var d=l.real(1),e=h._helper.unitvector(l.real(a.value.length),d),g,k=h.idMatrix(b,b);a=JSON.parse(JSON.stringify(a));for(var m=0;;m++){f=h._helper.getBlock(a,[m],[m]);f=h.column(f,d);g=h.abs2(f).value.real;1E-8<g&&(f=h._helper.getHouseHolder(f),f=h._helper.buildBlockMatrix(h.idMatrix(l.real(m),l.real(m)),f),k=w.mult(k,h.transjugate(f)),a=w.mult(f,a));if(m+2===c)break;b=l.sub(b,d);e.value=e.value.splice(0,e.value.length-1)}return{Q:k,R:a}};h._helper.swapColumn=function(a,f,c){for(var b,d=0;d<
a.value.length;d++)b=a.value[d].value[f],a.value[d].value[f]=a.value[d].value[c],a.value[d].value[c]=b};h._helper.buildBlockMatrix=function(a,f){if(0===a.value.length)return f;if(0===f.value.length)return a;for(var c=a.value.length,b=a.value[0].value.length,d=b+f.value[0].value.length,d=h.zeromatrix(l.real(c+f.value.length),l.real(d)),e=0;e<a.value.length;e++)for(var g=0;g<a.value[0].value.length;g++)d.value[e].value[g]=a.value[e].value[g];for(e=0;e<f.value.length;e++)for(g=0;g<f.value[0].value.length;g++)d.value[c+
e].value[b+g]=f.value[e].value[g];return d};h._helper.getBlock=function(a,f,c){a=JSON.parse(JSON.stringify(a));var b=f[0],d=c[0];f=void 0===f[1]?a.value.length:f[1];c=void 0===c[1]?a.value[0].value.length:c[1];f++;c++;a.value=a.value.slice(b,f);for(b=0;b<a.value.length;b++)a.value[b].value=a.value[b].value.slice(d,c);return a};h._helper.setBlock=function(a,f,c){a=JSON.parse(JSON.stringify(a));var b=c[0];c=c[1];for(var d=f.value.length,h=f.value[0].value.length,e=0;e<d;e++)for(var g=0;g<h;g++)a.value[b+
e].value[c+g]=f.value[e].value[g];return a};h._helper.transposeMult=function(a,f){if(a.value.length!==f.value.length)return k;for(var c=a.value.length,b=Array(c),d=0;d<c;d++)b[d]=h.scalmult(a.value[d],f);return h.turnIntoCSList(b)};h._helper.QRgetAlpha=function(a,f){return 0>a.value[f].value.real?h.abs(a):l.neg(h.abs(a))};h.LUdecomp=function(a){a=JSON.parse(JSON.stringify(a));var f,c,b,d,h,e=0,g,k=a.value.length,m=k-1,n=Array(k);for(b=0;b<k;++b){h=b;d=a.value[b];g=l.abs(d.value[b]).value.real;for(c=
b+1;c<k;++c)f=l.abs(a.value[c].value[b]),g<f.value.real&&(g=f.value.real,h=c);g<l.eps&&console.log("Warning: singular matrix!");n[b]=h;h!==b&&(a.value[b]=a.value[h],a.value[h]=d,d=a.value[b],e++);c=d.value[b];for(f=b+1;f<k;++f)a.value[f].value[b]=l.div(a.value[f].value[b],c);for(f=b+1;f<k;++f){h=a.value[f];for(c=b+1;c<m;++c)h.value[c]=l.sub(h.value[c],l.mult(h.value[b],d.value[c])),++c,h.value[c]=l.sub(h.value[c],l.mult(h.value[b],d.value[c]));c===m&&(h.value[c]=l.sub(h.value[c],l.mult(h.value[b],
d.value[c])))}}return{LU:a,P:n,TransPos:e}};h.LUsolve=function(a,f){var c=h.LUdecomp(a);return h._helper.LUsolve(c,f)};h._helper.LUsolve=function(a,f){var c=JSON.parse(JSON.stringify(f)),b,d=a.LU,h=d.value.length,e=JSON.parse(JSON.stringify(c)),g=a.P,k;for(b=h-1;-1!==b;--b)e.value[b]=c.value[b];for(b=0;b<h;++b)for(c=g[b],g[b]!==b&&(k=e.value[b],e.value[b]=e.value[c],e.value[c]=k),k=d.value[b],c=0;c<b;++c)e.value[b]=l.sub(e.value[b],l.mult(e.value[c],k.value[c]));for(b=h-1;0<=b;--b){k=d.value[b];for(c=
b+1;c<h;++c)e.value[b]=l.sub(e.value[b],l.mult(e.value[c],k.value[c]));e.value[b]=l.div(e.value[b],k.value[b])}return e};h.linearsolveCramer2=function(a,f){var c=h.column(a,l.real(1)),b=h.column(a,l.real(2)),d=h.det2(c,b);l._helper.isZero(d)&&console.log("A is not regular!");b=h.det2(f,b);b=l.div(b,d);c=h.det2(c,f);c=l.div(c,d);return h.turnIntoCSList([b,c])};h.linearsolveCramer3=function(a,f){var c=h.column(a,l.real(1)),b=h.column(a,l.real(2)),d=h.column(a,l.real(3)),e=h.det3(c,b,d);l._helper.isZero(e)&&
console.log("A is not regular!");var g=h.det3(f,b,d),d=h.det3(c,f,d),c=h.det3(c,b,f),g=h.turnIntoCSList([g,d,c]);return g=h.scaldiv(e,g)};h.linearsolveCGNR=function(a,f){var c=h.transpose(a),b=w.mult(c,a),c=w.mult(c,f);return h.linearsolveCG(b,c)};h.linearsolveCG=function(a,f){var c,b,d,e,g,k;e=f;b=c=h.sub(f,w.mult(a,f));for(var m=Math.ceil(1.2*a.value.length),n=0;n<m;){n++;g=w.mult(a,b);k=d=h.scalproduct(c,c);d=l.div(d,h.scalproduct(b,g));e=h.add(e,w.mult(d,b));c=h.sub(c,w.mult(d,g));if(h.abs(c).value.real<
l.eps)break;d=h.scalproduct(c,c);d=l.div(d,k);b=h.add(c,w.mult(d,b))}n>=m&&console.log("CG did not converge");return e};h.det=function(a){if(1===a.value.length)return a.value[0].value[0];if(2===a.value.length)return h.det2(a.value[0],a.value[1]);if(3===a.value.length)return h.det3(a.value[0],a.value[1],a.value[2]);if(4===a.value.length)return h.det4m(a);var f=a.value.length,c=l.real(1),b,d,e=JSON.parse(JSON.stringify(a)),g,k,m,n;for(a=0;a<f-1;a++){d=a;for(b=a+1;b<f;b++)l.abs(e.value[b].value[a]).value.real>
l.abs(e.value[d].value[a]).value.real&&(d=b);d!==a&&(b=e.value[d],e.value[d]=e.value[a],e.value[a]=b,c=l.neg(c));g=e.value[a];for(b=a+1;b<f;b++){k=e.value[b];m=l.div(k.value[a],g.value[a]);for(d=a+1;d<f-1;d+=2)n=d+1,k.value[d]=l.sub(k.value[d],l.mult(g.value[d],m)),k.value[n]=l.sub(k.value[n],l.mult(g.value[n],m));d!==f&&(k.value[d]=l.sub(k.value[d],l.mult(g.value[d],m)))}if(l._helper.isZero(g.value[a]))return l.real(0);c=l.mult(c,g.value[a])}return l.mult(c,e.value[a].value[a])};h.LUdet=function(a){a=
h.LUdecomp(a);for(var f=a.LU,c=f.value.length,b=f.value[0].value[0],d=1;d<c;d++)b=l.mult(b,f.value[d].value[d]);1===a.TransPos%2&&(b=l.neg(b));return b};h.getField=function(a,f){var c;if("homog"===f){if(h._helper.isNumberVecN(a,3))return a;if(h._helper.isNumberVecN(a,2))return h.turnIntoCSList([a.value[0],a.value[1],l.real(1)])}if("xy"===f){if(h._helper.isNumberVecN(a,2))return a;if(h._helper.isNumberVecN(a,3))return h.turnIntoCSList([l.div(a.value[0],a.value[2]),l.div(a.value[1],a.value[2])])}if("x"===
f&&h.isNumberVector(a)){c=a.value.length;if(0<c&&3!==c)return a.value[0];if(3===c)return"Point"===a.usage?l.div(a.value[0],a.value[2]):a.value[0]}if("y"===f&&h.isNumberVector(a)){c=a.value.length;if(1<c&&3!==c)return a.value[1];if(3===c)return"Point"===a.usage?l.div(a.value[1],a.value[2]):a.value[1]}return"z"===f&&h.isNumberVector(a)&&(c=a.value.length,2<c)?a.value[2]:k};h.nil=h.turnIntoCSList([]);h.ofGeos=function(a){return h.turnIntoCSList(a.map(function(a){return{ctype:"geo",value:a}}))};h._helper.isAlmostFarpoint=
function(a){a=h.normalizeMax(a).value[2];return l.abs(a).value.real<l.eps};h.getRandRealVec3=function(a,f){var c=l.getRandReal;return h.turnIntoCSList([c(a,f),c(a,f),c(a,f)])};h.getRandComplexVec3=function(a,f){var c=l.getRandComplex;return h.turnIntoCSList([c(a,f),c(a,f),c(a,f)])};var Ma={key:function(a){if("string"===a.ctype)return"s"+a.value.length+":"+a.value+";";if("number"===a.ctype)return"n"+a.value.real+","+a.value.imag+";";if("list"===a.ctype)return"l"+a.value.length+":"+a.value.map(Ma.key).join(",")+
";";if("boolean"===a.ctype)return"b"+a.value+";";if("dict"===a.ctype)return a=Object.keys(a.value).sort(),"d"+a.length+":"+a.join(",")+";";"undefined"!==a.ctype&&wa.err("Bad dictionary key: "+Y(a));return"undef"},create:function(){return{ctype:"dict",value:{}}},clone:function(a){var f=Ma.create(),c;for(c in a.value)a.value.hasOwnProperty(c)&&(f.value[c]=a.value[c]);return f},put:function(a,f,c){a.value[Ma.key(f)]={key:f,value:c}},get:function(a,f,c){return(a=a.value[Ma.key(f)])?a.value:c},niceprint:function(a){return"{"+
Object.keys(a.value).sort().map(function(f){f=a.value[f];return Y(f.key)+":"+Y(f.value)}).join(", ")+"}"}},w={_helper:{},order:{undefined:0,"boolean":1,number:2,term:3,atomic:4,variable:5,geo:6,string:7,list:8},string:function(a){return{ctype:"string",value:a}},bool:function(a){return{ctype:"boolean",value:a}},not:function(a){return w.bool(!a.value)},isLessThan:function(a,f){return-1===w.compare(a,f)},isEqual:function(a,f){return 0===w.compare(a,f)},compareResults:function(a,f){return w.compare(a.result,
f.result)},compare:function(a,f){if(a.ctype!==f.ctype)return w.order[a.ctype]-w.order[f.ctype];if("number"===a.ctype)return l._helper.compare(a,f);if("list"===a.ctype)return h._helper.compare(a,f);if("geo"===a.ctype)return a.value.name===f.value.name?0:a.value.name<f.value.name?-1:1;if("string"===a.ctype)return a.value===f.value?0:a.value<f.value?-1:1;if("boolean"===a.ctype)return a.value===f.value?0:!1===a.value?-1:1},add:function(a,f){return"void"===a.ctype&&"number"===f.ctype||"void"===a.ctype&&
"list"===f.ctype?f:"number"===a.ctype&&"number"===f.ctype?l.add(a,f):"string"===a.ctype||"string"===f.ctype?{ctype:"string",value:Y(a)+Y(f)}:"list"===a.ctype&&"list"===f.ctype?h.add(a,f):k},sub:function(a,f){return"void"===a.ctype&&"number"===f.ctype?l.neg(f):"void"===a.ctype&&"list"===f.ctype?h.neg(f):"number"===a.ctype&&"number"===f.ctype?l.sub(a,f):"list"===a.ctype&&"list"===f.ctype?h.sub(a,f):k},mult:function(a,f){return"number"===a.ctype&&"number"===f.ctype?l.mult(a,f):"number"===a.ctype&&"list"===
f.ctype?h.scalmult(a,f):"list"===a.ctype&&"number"===f.ctype?h.scalmult(f,a):"list"===a.ctype&&"list"===f.ctype?h.mult(a,f):k},div:function(a,f){return"number"===a.ctype&&"number"===f.ctype?l.div(a,f):"list"===a.ctype&&"number"===f.ctype?h.scaldiv(f,a):k},max:function(a,f){return"number"===a.ctype&&"number"===f.ctype?l.max(a,f):"list"===a.ctype&&"list"===f.ctype?h.max(a,f):k},min:function(a,f){return"number"===a.ctype&&"number"===f.ctype?l.min(a,f):"list"===a.ctype&&"list"===f.ctype?h.min(a,f):k},
wrap:function(a){if("number"===typeof a)return l.real(a);if("object"===typeof a&&void 0!==a.length){for(var f=[],c=0;c<a.length;c++)f[c]=w.wrap(a[c]);return h.turnIntoCSList(f)}return"string"===typeof a?{ctype:"string",value:a}:"boolean"===typeof a?{ctype:"boolean",value:a}:k},unwrap:function(a){if("object"!==typeof a||null===a)return a;if(Array.isArray(a))return a.map(w.unwrap);switch(a.ctype){case "string":case "boolean":return a.value;case "number":return 0===a.value.imag?a.value.real:{r:a.value.real,
i:a.value.imag};case "list":return a.value.map(w.unwrap);default:return null}},withUsage:function(a,f){return{ctype:a.ctype,value:a.value,usage:f}},wrapJSON:function(a){switch(typeof a){case "number":return l.real(a);case "string":return w.string(a);case "boolean":return w.bool(a);case "object":if(null===a)return k;if(Array.isArray(a))return h.turnIntoCSList(a.map(w.wrapJSON));var f=Ma.create(),c;for(c in a)Ma.put(f,w.string(c),w.wrapJSON(a[c]));return f;default:return console.log("Failed to convert "+
typeof a+" to CindyJS data type"),k}},identity:function(a){return a},deeplyEqual:function(a,f){if("object"!==typeof a||"object"!==typeof f||null===a||null===f)return a===f;var c=0,b;for(b in a)if(++c,!(b in f&&w.deeplyEqual(a[b],f[b])))return!1;for(b in f)--c;return 0===c},DeepCloneJSON:function(a){var f,c,b;f=Array.isArray(a)?[]:{};for(b in a)c=a[b],f[b]="object"===typeof c&&null!==c?w.DeepCloneJSON(c):c;return f}},fb={},Q={};Q[":"]=C(":");Q["\u00b0"]=function(a,f){var c=B(a[0]);return"number"===
c.ctype&&"void"===a[1].ctype?w.withUsage(l.realmult(Math.PI/180,c),"Angle"):k};Q._=xc;Q["^"]=Xc;Q["\u221a"]=function(a,f){return"void"===a[0].ctype?t.sqrt$1([a[1]],f):k};Q["*"]=Vc;Q["\u00d7"]=dd;Q["/"]=Wc;Q["+"]=Uc;Q["-"]=lc;Q["!"]=function(a,f){var c=B(a[1]);return"void"===a[0].ctype&&"boolean"===c.ctype?{ctype:"boolean",value:!c.value}:k};Q["=="]=vb;Q["~="]=jc;Q["~<"]=function(a,f){var c=B(a[0]),b=B(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?
{ctype:"boolean",value:c.value.real-b.value.real<=-l.eps}:k};Q["~>"]=function(a,f){var c=B(a[0]),b=B(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real-b.value.real>=l.eps}:k};Q["=:="]=C("=:=");Q[">="]=function(a,f){var c=B(a[0]),b=B(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real>=b.value.real}:"string"===c.ctype&&"string"===
b.ctype?{ctype:"boolean",value:c.value>=b.value}:k};Q["<="]=function(a,f){var c=B(a[0]),b=B(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real<=b.value.real}:"string"===c.ctype&&"string"===b.ctype?{ctype:"boolean",value:c.value<=b.value}:k};Q["~>="]=function(a,f){var c=B(a[0]),b=B(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real-
b.value.real>-l.eps}:k};Q["~<="]=function(a,f){var c=B(a[0]),b=B(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real-b.value.real<l.eps}:k};Q[">"]=function(a,f){var c=B(a[0]),b=B(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real>b.value.real}:"string"===c.ctype&&"string"===b.ctype?{ctype:"boolean",value:c.value>b.value}:
k};Q["<"]=function(a,f){var c=B(a[0]),b=B(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real<b.value.real}:"string"===c.ctype&&"string"===b.ctype?{ctype:"boolean",value:c.value<b.value}:k};Q["<>"]=Rc;Q["\u2208"]=function(a,f){var c=z(a[0]),b=z(a[1]);return"list"===b.ctype?h.contains(b,c):k};Q["\u2209"]=function(a,f){var c=z(a[0]),b=z(a[1]);return"list"===b.ctype?w.not(h.contains(b,c)):k};Q["&"]=Sc;Q["%"]=Tc;
Q["!="]=Rc;Q["~!="]=function(a,f){return w.not(jc(a,f))};Q[".."]=function(a,f){var c=z(a[0]),b=z(a[1]);return"number"===c.ctype&&"number"===b.ctype?h.sequence(c,b):k};Q["++"]=ed;Q["--"]=gd;Q["~~"]=fd;Q[":>"]=hd;Q["<:"]=id;Q["="]=cb;Q[":="]=function(a,f,c){f="undefined"===a[1].ctype;if("undefined"===a[0].ctype||f)return k;if("function"===a[0].ctype){f=a[0].oper;var b=a[0].args,d=a[1],h=1;if(fb.hasOwnProperty(f)){h=fb[f];if(h.definer===c)return k;h=h.generation+1}fb[f]={oper:f,body:d,arglist:b,definer:c,
generation:h}}"variable"===a[0].ctype&&I.setvar(a[0].name,a[1]);return k};Q[":=_"]=function(a,f){if("void"!==a[1].ctype)return k;"function"===a[0].ctype&&delete fb[a[0].oper];return k};Q["::="]=C("::=");Q[";"]=function(a,f){var c="void"===a[0].ctype,b="void"===a[1].ctype;if(c&&b)return k;if(!c&&b)return z(a[0]);c||b||z(a[0]);return b?k:z(a[1])};var t={},D={evaluate:function(a,f,c){if(fb.hasOwnProperty(a)){a=fb[a];if(void 0===a)f=k;else{var b=[];for(c=0;c<a.arglist.length;c++)b[c]=z(f[c]);for(c=0;c<
a.arglist.length;c++)I.newvar(a.arglist[c].name),I.setvar(a.arglist[c].name,b[c]);I.pushVstack("*");f=z(a.body);I.cleanVstack();for(c=0;c<a.arglist.length;c++)I.removevar(a.arglist[c].name)}return f}if(b=t[a])return b(f,c);var d=a.lastIndexOf("$");if(-1!==d&&(d=a.substr(0,d),b=t[d]))return b(f,c);wa.err("Called undefined function "+d+" (as "+a+")");return k},equals:function(a,f){return"number"===a.ctype&&"number"===f.ctype?{ctype:"boolean",value:a.value.real===f.value.real&&a.value.imag===f.value.imag}:
"string"===a.ctype&&"string"===f.ctype||"boolean"===a.ctype&&"boolean"===f.ctype?{ctype:"boolean",value:a.value===f.value}:"list"===a.ctype&&"list"===f.ctype?h.equals(a,f):"geo"===a.ctype&&"geo"===f.ctype?{ctype:"boolean",value:a.value===f.value}:{ctype:"boolean",value:!1}}},I={};I.vars=function(){var a={pi:l.real(Math.PI),"\u03c0":l.real(Math.PI),i:l.complex(0,1),"true":w.bool(!0),"false":w.bool(!1),"#":k,nil:h.turnIntoCSList([]),newline:w.string("\n"),tab:w.string("\t")},f=[],c;for(c in a)f[c]=
[a[c]];return f}();I.isVariable=function(a){return this.vars.hasOwnProperty(a)};I.create=function(a){if(this.vars.hasOwnProperty(a))return this.vars[a];var f=[null];return this.vars[a]=f};I.newvar=function(a){a=this.vars[a];a.push(k);return a};I.removevar=function(a){var f=this.vars[a];0===f.length&&console.error("Removing non-existing "+a);f.pop();0===f.length&&console.warn("Removing last "+a)};I.setvar=function(a,f){var c=this.vars[a];0===c.length&&console.error("Setting non-existing variable "+
a);void 0===f&&(console.error("Setting variable "+a+" to undefined value"),f=k);if("undefined"===f.ctype)c[c.length-1]=f;else{var b=f;null===b&&(b=k);c[c.length-1]=b}};I.undefinedWarning={};I.getvar=function(a){var f=this.vars[a]||[];0===f.length&&console.error("Getting non-existing variable "+a);f=f[f.length-1];if(null===f){if(u.csnames.hasOwnProperty(a))return{ctype:"geo",value:u.csnames[a]};console&&console.log&&void 0===this.undefinedWarning[a]&&(this.undefinedWarning[a]=!0,console.log("Warning: Accessing undefined variable: "+
a));return k}return f};I.dump=function(a){var f=this.vars[a];console.log("*** Dump "+a);for(a=0;a<f.length;a++)console.log(a+":> "+Y(f[a]))};I.vstack=[];I.pushVstack=function(a){this.vstack.push(a)};I.popVstack=function(){this.vstack.pop()};I.cleanVstack=function(){for(var a=this.vstack;0<a.length&&"*"!==a[a.length-1];)this.removevar(a[a.length-1]),a.pop();0<a.length&&a.pop()};var ta={generalFields:{color:"color",colorhsb:"",size:"size",alpha:"alpha",fillcolor:"fillcolor",fillalpha:"fillalpha",isshowing:"isshowing",
visible:"visible",name:"name",caption:"caption",trace:"",tracelength:"",selected:"",labeled:"labeled",labelled:"labeled"},getGeoField:function(a,f){return"undefined"!==typeof u.csnames[a]?ta.getField(u.csnames[a],f):k},setGeoField:function(a,f,c){return"undefined"!==typeof u.csnames[a]?ta.setField(u.csnames[a],f,c):k},getField:function(a,f){var c;if("P"===a.kind){if("xy"===f)return c=h.dehom(a.homog),w.withUsage(c,"Point");if("homog"===f)return w.withUsage(a.homog,"Point");if("x"===f)return l.div(a.homog.value[0],
a.homog.value[2]);if("y"===f)return l.div(a.homog.value[1],a.homog.value[2])}if("L"===a.kind||"S"===a.kind){if("homog"===f)return w.withUsage(a.homog,"Line");if("angle"===f)return c=h.eucangle(h.ey,a.homog),w.withUsage(c,"Angle");if("slope"===f)return l.neg(l.div(a.homog.value[0],a.homog.value[1]))}if("Tr"===a.kind&&"matrix"===f)return a.matrix;if("C"===a.kind){if("radius"===f){var b=a.matrix;c=b.value[0].value[0];var d=b.value[0].value[2],e=b.value[1].value[2],b=b.value[2].value[2];l.mult(c,c);d=
l.div(d,c);e=l.div(e,c);c=l.div(b,c);return c=l.sqrt(l.sub(l.add(l.mult(d,d),l.mult(e,e)),c))}if("size"===f)return a.size;if("matrix"===f)return a.matrix;if("center"===f)return c=m._helper.CenterOfConic(a.matrix),c=h.dehom(c),w.withUsage(c,"Point");if("dualMatrix"===f)return h.normalizeMax(h.adjoint3(a.matrix))}if("Text"===a.kind){if("pressed"===f)return a.checkbox?w.bool(a.checkbox.checked):w.bool(!1);if("xy"===f)return c=h.dehom(a.homog),w.withUsage(c,"Point");if("homog"===f)return w.withUsage(a.homog,
"Point");if("x"===f)return l.div(a.homog.value[0],a.homog.value[2]);if("y"===f)return l.div(a.homog.value[1],a.homog.value[2])}if("trace"===f)return w.bool(!!a.drawtrace);if(ta.generalFields[f])return(c=a[ta.generalFields[f]])&&c.ctype?c:"object"!==typeof c?w.wrap(c):k;if(a.behavior){if("mass"===f&&"Mass"===a.behavior.type)return l.real(a.behavior.mass);if("radius"===f&&"Mass"===a.behavior.type)return l.real(a.behavior.radius);if("charge"===f&&"Mass"===a.behavior.type)return l.real(a.behavior.charge);
if("friction"===f&&"Mass"===a.behavior.type)return l.real(a.behavior.friction);if("vx"===f&&"Mass"===a.behavior.type)return l.real(a.behavior.vx);if("vy"===f&&"Mass"===a.behavior.type)return l.real(a.behavior.vy);if("v"===f&&"Mass"===a.behavior.type)return h.realVector([a.behavior.vx,a.behavior.vy]);if("fx"===f&&"Mass"===a.behavior.type)return l.real(a.behavior.fx);if("fy"===f&&"Mass"===a.behavior.type)return l.real(a.behavior.fy);if("f"===f&&"Mass"===a.behavior.type)return h.realVector([a.behavior.fx,
a.behavior.fy]);if("ldiff"===f&&"Spring"===a.behavior.type)return l.real(a.behavior.ldiff)}c=m[a.type]["get_"+f];return"function"===typeof c?c(a):k},setField:function(a,f,c){"color"===f&&h._helper.isNumberVecN(c,3)&&(a.color=c);"size"===f&&"number"===c.ctype&&(a.size=c);"alpha"===f&&"number"===c.ctype&&(a.alpha=c);"fillcolor"===f&&h._helper.isNumberVecN(c,3)&&(a.fillcolor=c);"fillalpha"===f&&"number"===c.ctype&&(a.fillalpha=c);"visible"===f&&"boolean"===c.ctype&&(a.visible=c.value);"pinned"===f&&
"boolean"===c.ctype&&(a.pinned=c.value);"labeled"!==f&&"labelled"!==f||"boolean"!==c.ctype||(a.labeled=c.value);"printlabel"===f&&(a.printname=Y(c));"trace"===f&&"boolean"===c.ctype&&(c.value&&!a.drawtrace?(a.drawtrace=!0,Cd(a)):a.drawtrace=c.value);"P"===a.kind&&a.movable&&("xy"===f&&h._helper.isNumberVecN(c,2)&&Aa(a,h.turnIntoCSList([c.value[0],c.value[1],l.real(1)]),"homog"),"xy"===f&&h._helper.isNumberVecN(c,3)&&Aa(a,c,"homog"),"x"===f&&"number"===c.ctype&&Aa(a,h.turnIntoCSList([l.mult(c,a.homog.value[2]),
a.homog.value[1],a.homog.value[2]]),"homog"),"y"===f&&"number"===c.ctype&&Aa(a,h.turnIntoCSList([a.homog.value[0],l.mult(c,a.homog.value[2]),a.homog.value[2]]),"homog"),"homog"===f&&h._helper.isNumberVecN(c,3)&&Aa(a,c,"homog"));"homog"===f&&"L"===a.kind&&a.movable&&h._helper.isNumberVecN(c,3)&&Aa(a,c,"homog");"Text"===a.kind&&("pressed"===f&&"boolean"===c.ctype&&a.checkbox&&(a.checkbox.checked=c.value),a.movable&&("xy"===f?h._helper.isNumberVecN(c,2)?a.homog=h.turnIntoCSList([c.value[0],c.value[1],
l.real(1)]):h._helper.isNumberVecN(c,3)&&(a.homog=c):"homog"===f&&h._helper.isNumberVecN(c,3)?a.homog=c:"x"===f&&"number"===c.ctype?a.homog=h.turnIntoCSList([l.mult(c,a.homog.value[2]),a.homog.value[1],a.homog.value[2]]):"y"===f&&"number"===c.ctype&&(a.homog=h.turnIntoCSList([a.homog.value[0],l.mult(c,a.homog.value[2]),a.homog.value[2]]))));a.behavior&&("mass"===f&&"Mass"===a.behavior.type&&"number"===c.ctype&&(a.behavior.mass=c.value.real),"mass"===f&&"Sun"===a.behavior.type&&"number"===c.ctype&&
(a.behavior.mass=c.value.real),"friction"===f&&"Mass"===a.behavior.type&&"number"===c.ctype&&(a.behavior.friction=c.value.real),"charge"===f&&"Mass"===a.behavior.type&&"number"===c.ctype&&(a.behavior.charge=c.value.real),"radius"===f&&"Mass"===a.behavior.type&&"number"===c.ctype&&(a.behavior.radius=c.value.real),"vx"===f&&"Mass"===a.behavior.type&&"number"===c.ctype&&(a.behavior.vx=c.value.real),"vy"===f&&"Mass"===a.behavior.type&&"number"===c.ctype&&(a.behavior.vy=c.value.real),"v"===f&&"Mass"===
a.behavior.type&&h._helper.isNumberVecN(c,2)&&(a.behavior.vx=c.value[0].value.real,a.behavior.vy=c.value[1].value.real));f=m[a.type]["set_"+f];if("function"===typeof f)return f(a,c)},getuserData:function(a,f){var c;a.userData&&a.userData[f]&&(c=a.userData[f]);return c&&c.ctype?c:"object"!==typeof c?w.wrap(c):k},setuserData:function(a,f,c){a.userData||(a.userData={});a.userData[f]=c}};t.version$0=function(a,f){var c=["CindyJS"].concat(we);return h.turnIntoCSList(c.map(w.wrap))};t.clearconsole$0=function(a,
f){wa.clear()};t.err$1=function(a,f){var c="",b;"variable"===a[0].ctype?(c=a[0].name,b=I.getvar(a[0].name)):b=a[0];b=c+" ===> "+Y(z(b));da(b);return k};t.errc$1=function(a,f){var c;"variable"===a[0].ctype?(c=z(I.getvar(a[0].name)),console.log(a[0].name+" ===> "+Y(c))):(c=z(a[0]),console.log(" ===> "+Y(c)));return k};t.print$1=function(a,f){wa.out(Y(z(a[0])),!0);return k};t.println$1=function(a,f){wa.out(Y(z(a[0])));return k};t.assert$2=function(a,f){var c=z(a[0]);if("boolean"===c.ctype){if(!1===c.value)return t.println$1([a[1]],
f)}else da("Condition for assert is not boolean");return k};t.dump$1=function(a,f){console.log(JSON.stringify(a[0]));return k};t.repeat$2=function(a,f){return t.repeat$3([a[0],null,a[1]],f)};t.repeat$3=function(a,f){var c=B(a[0]),b="#";null!==a[1]&&"variable"===a[1].ctype&&(b=a[1].name);if("number"!==c.ctype)return k;var c=Math.round(c.value.real),d=1,h=1,e=c+1,g=!1,l=!1,m=!1,n;void 0!==f.start&&(n=z(f.start),"number"===n.ctype&&(g=!0,h=n.value.real));void 0!==f.step&&(n=z(f.step),"number"===n.ctype&&
(m=!0,d=n.value.real));void 0!==f.stop&&(n=z(f.stop),"number"===n.ctype&&(l=!0,e=n.value.real));!g||l||m||(e=d*c+h);g||!l||m||(h=-d*(c-1)+e,e+=d);g||l||!m||(e=d*c+h);g&&l&&!m&&(d=(e-h)/(c-1),e+=d);g&&!l&&m&&(e=d*c+h);!g&&l&&m&&(h=-d*(c-1)+e,e+=d);g&&l&&m&&(e+=d);(h<=e&&0<d||h>=e&&0>d)&&g&&l&&m&&(c=Math.floor((e-h)/d));I.newvar(b);e=k;for(g=0;g<c;g++)I.setvar(b,{ctype:"number",value:{real:g*d+h,imag:0}}),e=z(a[2]);I.removevar(b);return e};t.while$2=function(a,f){for(var c=a[1],b=a[0],d=z(b),h=k;"list"!==
d.ctype&&d.value;)h=z(c),d=z(b);return h};t.apply$2=function(a,f){return t.apply$3([a[0],null,a[1]],f)};t.apply$3=function(a,f){var c=B(a[0]);if("list"!==c.ctype)return k;var b="#";null!==a[1]&&"variable"===a[1].ctype&&(b=a[1].name);var c=c.value,d=[];I.newvar(b);for(var h=0;h<c.length;h++)I.setvar(b,c[h]),d[h]=z(a[2]);I.removevar(b);return{ctype:"list",value:d}};t.forall$2=function(a,f){return t.forall$3([a[0],null,a[1]],f)};t.forall$3=function(a,f){var c=B(a[0]);if("list"!==c.ctype)return k;var b=
"#";null!==a[1]&&"variable"===a[1].ctype&&(b=a[1].name);c=c.value;I.newvar(b);for(var d,h=0;h<c.length;h++)I.setvar(b,c[h]),d=z(a[2]);I.removevar(b);return d};t.select$2=function(a,f){return t.select$3([a[0],null,a[1]],f)};t.select$3=function(a,f){var c=B(a[0]);if("list"!==c.ctype)return k;var b="#";null!==a[1]&&"variable"===a[1].ctype&&(b=a[1].name);var c=c.value,d=[];I.newvar(b);for(var h=0,e=0;e<c.length;e++){I.setvar(b,c[e]);var g=z(a[2]);"boolean"===g.ctype&&!0===g.value&&(d[h]=c[e],h++)}I.removevar(b);
return{ctype:"list",value:d}};t.flatten$1=function(a,f){function c(a,f){return-1===f||"list"!==a.ctype?a:[].concat.apply([],a.value.map(function(a){return c(a,f-1)}))}var b=B(a[0]);if("list"!==b.ctype)return b;var d=f.levels;void 0===d?d=1:(d=z(d),d="number"===d.ctype?d.value.real:"string"===d.ctype&&"all"===d.value?-2:1);return{ctype:"list",value:c(b,d)}};t.createvar$1=function(a,f){"variable"===a[0].ctype&&I.newvar(a[0].name);return k};t.local=function(a,f){for(var c=0;c<a.length;c++)"variable"===
a[c].ctype&&I.newvar(a[c].name);return k};t.removevar$1=function(a,f){var c=z(a[0]);"variable"===a[0].ctype&&I.removevar(a[0].name);return c};t.release=function(a,f){if(0===a.length)return k;for(var c=z(a[a.length-1]),b=0;b<a.length;b++)"variable"===a[b].ctype&&I.removevar(a[b].name);return c};t.regional=function(a,f){for(var c=0;c<a.length;c++)if("variable"===a[c].ctype){var b=a[c].name;I.newvar(b);I.pushVstack(b)}return k};t.genList=function(a,f){return h.turnIntoCSList(a.map(z))};D.assigntake=
function(a,f){var c=a.args[0],b=z(c),d=B(a.args[1]),e=k;if("list"===b.ctype||"string"===b.ctype)d=Math.floor(d.value.real),0>d&&(d=b.value.length+d+1),0<d&&d<=b.value.length&&("list"===b.ctype?(e=b.value.slice(),e[d-1]=z(f),e=h.turnIntoCSList(e),b.userData&&(e.userData=b.userData)):(b=b.value,b=b.substring(0,d-1)+Y(z(f))+b.substring(d,b.length),e=w.string(b)));cb([c,e])};D.assigndot=function(a,f){var c=z(a.obj),b=a.key;"geo"===c.ctype&&b&&ta.setField(c.value,b,B(f));return k};D.assigncolon=function(a,
f){var c=a.obj,b=z(c),d=Y(z(a.key));"_?_"===d&&(d=void 0);if("geo"===b.ctype&&d)ta.setuserData(b.value,d,B(f));else if("list"===b.ctype||"string"===b.ctype&&d){var h={},e;for(e in b)h[e]=b[e];if(h.userData){var b={},g;for(g in h.userData)b[g]=h.userData[g];h.userData=b}else h.userData={};h.userData[d]=B(f);cb([c,h])}else d?console.log("User data can only be assigned to geo objects and lists."):console.log("Key is undefined");return k};D.assignlist=function(a,f){var c=a.length,b=f.length;b<c&&(c=b);
for(b=0;b<c;b++)cb([a[b],f[b]],[])};t.if$2=function(a,f){return t.if$3(a,f)};t.if$3=function(a,f){var c=B(a[0]);if("boolean"===c.ctype){if(!0===c.value)return z(a[1]);if(3===a.length)return z(a[2])}else da("Condition for if is not boolean");return k};t.and$2=Sc;t.or$2=Tc;t.xor$2=function(a,f){var c=B(a[0]),b=B(a[1]);return"boolean"===c.ctype&&"boolean"===b.ctype?{ctype:"boolean",value:c.value!==b.value}:k};t.not$1=function(a,f){var c=B(a[0]);return"boolean"===c.ctype?{ctype:"boolean",value:!c.value}:
k};D.genericListMathGen=function(a,f,c){t[a+"$1"]=function(a,b){var p=z(a[0]);if("list"!==p.ctype)return k;p=p.value;if(0===p.length)return c;for(var d=p[0],h=1;h<p.length;h++)d=f(d,p[h]);return d};var b=a+"$3";t[a+"$2"]=function(a,c){return t[b]([a[0],null,a[1]])};t[b]=function(a,b){var p=B(a[0]);if("list"!==p.ctype)return k;p=p.value;if(0===p.length)return c;var d="#";null!==a[1]&&"variable"===a[1].ctype&&(d=a[1].name);I.newvar(d);I.setvar(d,p[0]);for(var h=z(a[2]),e=1;e<p.length;e++){I.setvar(d,
p[e]);var g=z(a[2]),h=f(h,g)}I.removevar(d);return h}};D.genericListMathGen("product",w.mult,l.real(1));D.genericListMathGen("sum",w.add,l.real(0));D.genericListMathGen("max",w.max,k);D.genericListMathGen("min",w.min,k);t.max$2=function(a,f){var c=B(a[0]);if("list"===c.ctype)return t.max$3([c,null,a[1]]);var b=B(a[1]);return t.max$1([h.turnIntoCSList([c,b])])};t.min$2=function(a,f){var c=B(a[0]);if("list"===c.ctype)return t.min$3([c,null,a[1]]);var b=B(a[1]);return t.min$1([h.turnIntoCSList([c,b])])};
t.add$2=Uc;t.sub$2=lc;t.mult$2=Vc;t.div$2=Wc;t.mod$2=function(a,f){var c=B(a[0]),b=B(a[1]);return"number"===c.ctype&&"number"===b.ctype?l.mod(c,b):k};t.pow$2=Xc;t.exp$1=function(a,f){var c=B(a[0]);return"number"===c.ctype?l.exp(c):k};t.sin$1=function(a,f){var c=B(a[0]);return"number"===c.ctype?l.sin(c):k};t.sqrt$1=function(a,f){var c=B(a[0]);return"number"===c.ctype?l.sqrt(c):k};D.laguerre=function(a,f,c){if("list"!==a.ctype)return k;var b=a.value.length-1,d;for(d=0;d<=b;d++)if("number"!==a.value[d].ctype)return k;
if("number"!==f.ctype)return k;for(var h=[1,.3141,.5926,.5358,.9793,.2385,.6264,.3383,.2795,.0288],e,g,m,n=1;n<=c;n++){g=m=l.zero;e=a.value[b];for(d=b-1;0<=d;d--)m=l.add(g,l.mult(m,f)),g=l.add(e,l.mult(g,f)),e=l.add(a.value[d],l.mult(e,f));if(l._helper.isLessThan(l.abs(e),l.real(1E-14)))break;d=l.div(g,e);g=l.mult(d,d);e=l.sub(g,l.div(l.mult(l.real(2),m),e));m=l.sqrt(l.mult(l.real(b-1),l.sub(l.mult(l.real(b),e),g)));e=l.add(d,m);d=l.sub(d,m);l._helper.isLessThan(l.abs(e),l.abs(d))&&(e=d);d=l._helper.isLessThan(l.real(1E-14),
l.abs(e))?l.div(l.real(b),e):l.mult(l.add(l.abs(f),l.one),l.complex(Math.cos(n),Math.sin(n)));if(l._helper.isLessThan(l.abs(d),l.real(1E-14)))break;0===n%20&&n<c-19&&(d=l.mult(d,l.real(h[Math.floor(n/20)])));f=l.sub(f,d)}return f};D.quadratic_roots=function(a){if("list"!==a.ctype)return k;var f=a.value[2],c=a.value[1];a=a.value[0];if(l._helper.isZero(a))return[l.zero,l.neg(l.div(c,f))];var b=l.sqrt(l.sub(l.mult(c,c),l.mult(l.real(4),l.mult(f,a))));0<=l.re(c)&&(b=l.neg(b));return[l.div(l.sub(b,c),
l.mult(l.real(2),f)),l.div(l.mult(l.real(2),a),l.sub(b,c))]};D.roots=function(a){var f=[],c=a,b=a.value.length-1;if(0>=b)return h.turnIntoCSList([]);if(l._helper.isZero(a.value[b]))return f=D.roots(h.turnIntoCSList(a.value.slice(0,b))),h.append(f,l.infinity);if(1===b)f[0]=l.neg(l.div(a.value[0],a.value[1]));else if(2===b)f=D.quadratic_roots(a);else{for(var d=0;d<b-2;d++){f[d]=D.laguerre(a,l.zero,200);f[d]=D.laguerre(c,f[d],1);var e=[];e[b-d]=a.value[b-d];for(var g=b-d;0<g;g--)e[g-1]=l.add(a.value[g-
1],l.mult(e[g],f[d]));e.shift();a=h.turnIntoCSList(e)}a=D.quadratic_roots(a);f[b-2]=a[0];f[b-1]=a[1]}return h.turnIntoCSList(f)};t.roots$1=function(a,f){var c=B(a[0]);if("list"===c.ctype){for(var b=0;b<c.value.length;b++)if("number"!==c.value[b].ctype)return k;c=D.roots(c);return h.sort1(c)}return k};t.autodiff$3=function(a,f){var c="x",b;if("function"===a[0].ctype)b=fb[a[0].oper].body,c=a[0].args[0].name;else if("function"===typeof a[0].impl)b=a[0];else return da("could not parse function"),k;var d=
B(a[1]),h=B(a[2]);if(1>h.value.real)return da("grade cant be < 1"),k;h=l.add(h,l.real(1));return P.autodiff(b,c,d,h)};t.cos$1=function(a,f){var c=B(a[0]);return"number"===c.ctype?l.cos(c):k};t.tan$1=function(a,f){var c=B(a[0]);return"number"===c.ctype?l.tan(c):k};t.arccos$1=function(a,f){var c=B(a[0]);return"number"===c.ctype?l.arccos(c):k};t.arcsin$1=function(a,f){var c=B(a[0]);return"number"===c.ctype?l.arcsin(c):k};t.arctan$1=function(a,f){var c=B(a[0]);return"number"===c.ctype?l.arctan(c):k};
t.arctan2$2=function(a,f){var c=B(a[0]),b=B(a[1]);return"number"===c.ctype&&"number"===b.ctype?l.arctan2(c,b):k};t.arctan2$1=function(a,f){var c=B(a[0]);if("list"===c.ctype&&2===c.value.length){if(c=c.value,"number"===c[0].ctype&&"number"===c[1].ctype)return t.arctan2$2(c,f)}else if("number"===c.ctype)return l.arctan2(c);return k};t.log$1=function(a,f){var c=B(a[0]);return"number"===c.ctype?l.log(c):k};D.recursiveGen=function(a){var f=l[a],c=h[a];t[a+"$1"]=function(a,b){var d=B(a[0]);return"number"===
d.ctype?f(d):"list"===d.ctype?c(d):k}};D.recursiveGen("im");D.recursiveGen("re");D.recursiveGen("conjugate");D.recursiveGen("round");D.recursiveGen("ceil");D.recursiveGen("floor");D.recursiveGen("abs");t.abs_infix=t.abs$1;t.random$0=function(a,f){return l.real(l._helper.rand())};t.random$1=function(a,f){var c=B(a[0]);return"number"===c.ctype?l.complex(c.value.real*l._helper.rand(),c.value.imag*l._helper.rand()):k};t.seedrandom$1=function(a,f){var c=B(a[0]);"number"===c.ctype&&l._helper.seedrandom(c.value.real);
return k};t.randomnormal$0=function(a,f){return l.real(l._helper.randnormal())};t.randominteger$1=function(a,f){var c=B(a[0]);if("number"===c.ctype){var b=c.value.real|0,c=c.value.imag|0,b=b*l._helper.rand()|0,c=c*l._helper.rand()|0;return l.complex(b,c)}return k};t.randomint$1=t.randominteger$1;t.randombool$0=function(a,f){return.5<l._helper.rand()?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isreal$1=function(a,f){var c=z(a[0]);return"number"===c.ctype&&l._helper.isAlmostReal(c)?{ctype:"boolean",
value:!0}:{ctype:"boolean",value:!1}};t.isinteger$1=function(a,f){var c=z(a[0]);return"number"===c.ctype&&l._helper.isAlmostReal(c)&&c.value.real===Math.floor(c.value.real)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.iseven$1=function(a,f){var c=z(a[0]);return"number"===c.ctype&&l._helper.isAlmostReal(c)&&c.value.real/2===Math.floor(c.value.real/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isodd$1=function(a,f){var c=z(a[0]);return"number"===c.ctype&&l._helper.isAlmostReal(c)&&
(c.value.real-1)/2===Math.floor((c.value.real-1)/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.iscomplex$1=function(a,f){return"number"===z(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isstring$1=function(a,f){return"string"===z(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.islist$1=function(a,f){return"list"===z(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.ismatrix$1=function(a,f){var c=z(a[0]);return-1!==h._helper.colNumb(c)?
{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.iscircle$1=function(a,f){var c=z(a[0]);return"geo"===c.ctype&&"C"===c.value.kind&&"Circle"===c.value.matrix.usage?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isconic$1=function(a,f){var c=z(a[0]);return"geo"===c.ctype&&"C"===c.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isline$1=function(a,f){var c=z(a[0]);return"geo"===c.ctype&&"L"===c.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.ispoint$1=
function(a,f){var c=z(a[0]);return"geo"===c.ctype&&"P"===c.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isgeometric$1=function(a,f){return"geo"===z(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isnumbermatrix$1=function(a,f){var c=z(a[0]);return h.isNumberMatrix(c)};t.isnumbervector$1=function(a,f){var c=z(a[0]);return h.isNumberVector(c)};t.issun$1=function(a,f){var c=z(a[0]);return"geo"===c.ctype&&void 0!==c.value.behavior&&"Sun"===c.value.behavior.type?
{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.ismass$1=function(a,f){var c=z(a[0]);return"geo"===c.ctype&&void 0!==c.value.behavior&&"Mass"===c.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isspring$1=function(a,f){var c=z(a[0]);return"geo"===c.ctype&&void 0!==c.value.behavior&&"Spring"===c.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isbouncer$1=function(a,f){var c=z(a[0]);return"geo"===c.ctype&&void 0!==c.value.behavior&&
"Bouncer"===c.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};t.isundefined$1=function(a,f){return"undefined"===z(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};var Qd={ArcBy3:"Arc",CenterOfConic:"Center",ConicBy1p4l:"Conic1P4L",ConicBy4p1l:"Conic4P1L",ConicBy5lines:"Conic5L",ConicBy2Foci1P:"ConicFoci",ConicFromPrincipalDirections:"ConicPrincipleDirs",Free:"FreePoint",PolarOfLine:"PolarLine",PolarOfPoint:"PolarPoint",PointOnSegment:"PointOnLine",Button:"Text",
ToggleButton:"Text",TrReflectionL:"TrReflection",TrReflectionP:"TrReflection",TrReflectionC:"TrReflection",TrTranslation:"TrProjection",TrSimilarity:"TrProjection",TrAffine:"TrProjection",TransformP:"Transform",TransformL:"Transform",TransformSegment:"Transform",TransformS:"Transform",TransformPolygon:"Transform",TransformArc:"Transform",TransformConic:"Transform",TransformC:"Transform",TrMoebiusP:"Transform",TrMoebiusL:"Transform",TrMoebiusSegment:"Transform",TrMoebiusS:"Transform",TrMoebiusPolygon:"Transform",
TrMoebiusArc:"Transform",TrMoebiusCircle:"Transform",TrMoebiusC:"Transform",TrInverseMoebius:"TrInverse",Perp:"Orthogonal",Para:"Parallel",AngleBisector:"AngularBisector",IntersectLC:"IntersectionConicLine",IntersectCirCir:"IntersectionCircleCircle",OtherPointOnCircle:"PointOnCircle"};t.algorithm$1=function(a,f){var c=z(a[0]);if("geo"===c.ctype){var c=c.value,b=c.type,d=B(f.compatibility);"string"===d.ctype&&/^cinderella$/i.test(d.value)&&(/^Select/.test(b)&&(c=u.csnames[c.args[0]],b=c.type),Qd.hasOwnProperty(b)?
b=Qd[b]:"CircleMr"===b&&(b=c.pinned?"CircleByFixedRadius":"CircleByRadius"));return w.string(b)}return k};t.inputs$1=function(a,f){var c=z(a[0]);if("geo"===c.ctype){var c=c.value,b=c.type,d=[];c.args&&(d=c.args.map(function(a){return{ctype:"geo",value:u.csnames[a]}}));if(/^Select/.test(b)||m[b].isMovable)switch(c.kind){case "P":case "L":d.push(c.homog);break;case "C":d.push(c.matrix)}return h.turnIntoCSList(d)}return k};t.moveto$2=function(a,f){var c=z(a[0]),b=B(a[1]);"geo"===c.ctype&&(c=c.value,
h._helper.isNumberVecN(b,2)?ta.setField(c,"xy",b):h._helper.isNumberVecN(b,3)&&ta.setField(c,"homog",b));return k};t.continuefromhere$0=function(a,f){Bb();return k};t.matrixrowcolumn$1=function(a,f){var c=z(a[0]);return-1!==h._helper.colNumb(c)?h.realVector([c.value.length,c.value[0].value.length]):k};t.rowmatrix$1=function(a,f){var c=z(a[0]);return"list"===c.ctype?h.turnIntoCSList([c]):k};t.columnmatrix$1=function(a,f){var c=z(a[0]);return"list"===c.ctype?h.turnIntoCSList(c.value.map(function(a){return h.turnIntoCSList([a])})):
k};t.submatrix$3=function(a,f){var c=z(a[0]),b=z(a[1]),d=z(a[2]);if("list"===c.ctype&&"number"===b.ctype&&"number"===d.ctype){var e=Math.round(b.value.real),b=Math.round(d.value.real),c=c.value.slice();0<b&&b<=c.length&&c.splice(b-1,1);var g=!0,c=c.map(function(a){if("list"!==a.ctype)g=!1;else return a=a.value.slice(),0<e&&e<=a.length&&a.splice(e-1,1),h.turnIntoCSList(a)});return g?h.turnIntoCSList(c):k}return k};t.complex$1=function(a,f){var c,b,d;d=B(a[0]);if("list"===d.ctype&&h.isNumberVector(d)){if(2===
d.value.length)return c=d.value[0],b=d.value[1],l.complex(c.value.real-b.value.imag,b.value.real+c.value.imag);if(3===d.value.length)return c=d.value[0],b=d.value[1],d=d.value[2],c=l.div(c,d),b=l.div(b,d),l.complex(c.value.real-b.value.imag,b.value.real+c.value.imag)}return k};t.gauss$1=function(a,f){var c=B(a[0]);return"number"===c.ctype?h.realVector([c.value.real,c.value.imag]):k};t.cross$2=dd;t.crossratio$4=function(a,f){var c=z(a[0]),b=z(a[1]),d=z(a[2]),e=z(a[3]),g=K(c),m=K(b),n=K(d),q=K(e);return g!==
k&&m!==k&&n!==k&&q!==k?h.crossratio3(g,m,n,q,h.ii):"number"===c.ctype&&"number"===b.ctype&&"number"===d.ctype&&"number"===e.ctype?l.div(l.mult(l.sub(c,d),l.sub(b,e)),l.mult(l.sub(c,e),l.sub(b,d))):k};t.para$2=function(a,f){var c=B(a[0]),b=B(a[1]),d=K(c),e=K(b);if(c!==k&&b!==k){var b=b.usage,g=d,l=e;if("Line"===c.usage||"Point"===b)g=e,l=d;c=h.cross(h.cross(h.linfty,l),g);return w.withUsage(c,"Line")}return k};t.perp$2=function(a,f){var c=B(a[0]),b=B(a[1]),d=K(c),e=K(b);if(c!==k&&b!==k){var g=b.usage||
e.usage,b=d,m=e;if("Line"===(c.usage||d.usage)||"Point"===g)b=e,m=d;c=h.turnIntoCSList([m.value[0],m.value[1],l.zero]);c=h.cross(c,b);return w.withUsage(c,"Line")}return k};t.perp$1=function(a,f){var c=B(a[0]);return h._helper.isNumberVecN(c,2)?h.turnIntoCSList([l.neg(c.value[1]),c.value[0]]):k};t.parallel$2=t.para$2;t.perpendicular$2=t.perp$2;t.perpendicular$1=t.perp$1;t.meet$2=function(a,f){var c=K(a[0]),b=K(a[1]);return c!==k&&b!==k?(c=h.cross(c,b),w.withUsage(c,"Point")):k};t.join$2=function(a,
f){var c=K(a[0]),b=K(a[1]);return c!==k&&b!==k?(c=h.cross(c,b),w.withUsage(c,"Line")):k};t.dist$2=function(a,f){var c=B(a[0]),b=B(a[1]),c=lc([c,b],[]);return t.abs$1([c],[])};t.dist_infix=t.dist$2;t.point$1=function(a,f){var c=z(a[0]);return h._helper.isNumberVecN(c,3)||h._helper.isNumberVecN(c,2)?w.withUsage(c,"Point"):c};t.line$1=function(a,f){var c=z(a[0]);return h._helper.isNumberVecN(c,3)?w.withUsage(c,"Line"):c};t.det$3=function(a,f){var c=K(a[0]),b=K(a[1]),d=K(a[2]);if(c!==k&&b!==k&&d!==k)return h.det3(c,
b,d)};t.det$1=function(a,f){var c=B(a[0]);if("list"===c.ctype){var b=h._helper.colNumb(c);if(-1!==b&&b===c.value.length)return h.det(c)}return k};t.eig$1=function(a,f){var c=B(a[0]);if("list"===c.ctype){var b=h._helper.colNumb(c);if(-1!==b&&b===c.value.length)return h.eig(c)}return k};t.eigenvalues$1=function(a,f){var c=B(a[0]);if("list"===c.ctype){var b=h._helper.colNumb(c);if(-1!==b&&b===c.value.length)return h.eig(c,!1).value[0]}return k};t.rank$1=function(a,f){var c=B(a[0]);if("list"===c.ctype){var b=
h._helper.colNumb(c);if(-1!==b&&b===c.value.length)return h.rank(c,f.precision)}return k};t.kernel$1=function(a,f){var c=B(a[0]);if("list"===c.ctype){var b=h._helper.colNumb(c);if(-1!==b&&b===c.value.length)return c=h.nullSpace(c,f.precision),h.transpose(c)}return k};t.eigenvectors$1=function(a,f){var c=B(a[0]);if("list"===c.ctype){var b=h._helper.colNumb(c);if(-1!==b&&b===c.value.length)return h.eig(c).value[1]}return k};t.area$3=function(a,f){var c=K(a[0]),b=K(a[1]),d=K(a[2]);if(c!==k&&b!==k&&d!==
k){var e=c.value[2],g=b.value[2],m=d.value[2];if(!l._helper.isAlmostZero(e)&&!l._helper.isAlmostZero(g)&&!l._helper.isAlmostZero(m))return c=h.scaldiv(e,c),b=h.scaldiv(g,b),d=h.scaldiv(m,d),c=h.det3(c,b,d),l.realmult(.5,c)}return k};t.inverse$1=function(a,f){var c=B(a[0]);if("list"===c.ctype){var b=h._helper.colNumb(c);if(-1!==b&&b===c.value.length)return h.inverse(c)}return k};t.linearsolve$2=function(a,f){var c=B(a[0]),b=B(a[1]);if("list"===c.ctype){var d=h._helper.colNumb(c);if(-1!==d&&d===c.value.length&&
h._helper.isNumberVecN(b,d))return h.linearsolve(c,b)}return k};var ce=[[[]],[[0]],[[0,1],[1,0]],[[0,1,2],[0,2,1],[1,0,2],[1,2,0],[2,0,1],[2,1,0]],[[0,1,2,3],[0,1,3,2],[0,2,1,3],[0,2,3,1],[0,3,1,2],[0,3,2,1],[1,0,2,3],[1,0,3,2],[1,2,0,3],[1,2,3,0],[1,3,0,2],[1,3,2,0],[2,0,1,3],[2,0,3,1],[2,1,0,3],[2,1,3,0],[2,3,0,1],[2,3,1,0],[3,0,1,2],[3,0,2,1],[3,1,0,2],[3,1,2,0],[3,2,0,1],[3,2,1,0]]];t.mincostmatching$1=function(a,f){var c=z(a[0]);if(h.isNumberMatrix(c).value){var b=c.value.length,d=h._helper.colNumb(c),
e=b<d?d:b,g,m,n=Array(e);for(g=0;g<e;++g)for(n[g]=Array(e),m=0;m<e;++m)n[g][m]=g<b&&m<d?c.value[g].value[m].value.real:0;c=wc(n);e=Array(b);for(g=0;g<b;++g)m=c[g],e[g]=m<d?l.real(m+1):l.real(0);return h.turnIntoCSList(e)}return k};t.take$2=xc;t.length$1=function(a,f){var c=z(a[0]);return"list"===c.ctype||"string"===c.ctype?l.real(c.value.length):k};t.pairs$1=function(a,f){var c=z(a[0]);return"list"===c.ctype?h.pairs(c):k};t.triples$1=function(a,f){var c=z(a[0]);return"list"===c.ctype?h.triples(c):
k};t.cycle$1=function(a,f){var c=z(a[0]);return"list"===c.ctype?h.cycle(c):k};t.consecutive$1=function(a,f){var c=z(a[0]);return"list"===c.ctype?h.consecutive(c):k};t.reverse$1=function(a,f){var c=z(a[0]);return"list"===c.ctype?h.reverse(c):k};t.directproduct$2=function(a,f){var c=z(a[0]),b=z(a[1]);return"list"===c.ctype&&"list"===b.ctype?h.directproduct(c,b):k};t.concat$2=ed;t.common$2=fd;t.remove$2=gd;t.append$2=hd;t.prepend$2=id;t.contains$2=function(a,f){var c=z(a[0]),b=z(a[1]);return"list"===
c.ctype?h.contains(c,b):k};t.sort$2=function(a,f){return t.sort$3([a[0],null,a[1]],f)};t.sort$3=function(a,f){var c=B(a[0]);if("list"!==c.ctype)return k;var b="#";null!==a[1]&&"variable"===a[1].ctype&&(b=a[1].name);var c=c.value,d=[];I.newvar(b);var h;for(h=0;h<c.length;h++)I.setvar(b,c[h]),d[h]={val:c[h],result:z(a[2])};I.removevar(b);d.sort(w.compareResults);b=[];for(h=0;h<c.length;h++)b[h]=d[h].val;return{ctype:"list",value:b}};t.sort$1=function(a,f){var c=z(a[0]);return"list"===c.ctype?h.sort1(c):
k};t.set$1=function(a,f){var c=z(a[0]);return"list"===c.ctype?h.set(c):k};t.combinations$2=function(a,f){function c(a,f){a===g?n.push(h.turnIntoCSList(m.slice())):f<e&&(m[a]=b.value[f],c(a+1,f+1),c(a,f+1))}var b=z(a[0]),d=z(a[1]),e,g,m,n;if("number"===d.ctype){g=d.value.real|0;if("number"===b.ctype){e=b.value.real|0;e-g<g&&(g=e-g);if(0>g)return l.real(0);if(0===g)return l.real(1);if(1===g)return b;for(var q=d=1,r=1;r<=g;++r)var t=e-g+r|0,u=r|0,v=yc(t,u)|0,t=t/v|0,u=u/v|0,v=yc(d,u)|0,d=d/v|0,u=u/v|
0,v=yc(t,q)|0,t=t/v|0,q=q/v|0,d=d*t|0,q=q*u|0;return l.real(d/q)}if("list"===b.ctype){e=b.value.length;if(0>g||g>e)return h.turnIntoCSList([]);if(0===g)return h.turnIntoCSList([h.turnIntoCSList([])]);if(g===e)return h.turnIntoCSList([b]);n=[];m=Array(g);c(0,0);return h.turnIntoCSList(n)}}return k};t.zeromatrix$2=function(a,f){var c=B(a[0]),b=B(a[1]);return"number"===c.ctype&&"number"===b.ctype?h.zeromatrix(c,b):k};t.zerovector$1=function(a,f){var c=B(a[0]);return"number"===c.ctype?h.zerovector(c):
k};t.transpose$1=function(a,f){var c=B(a[0]);return"list"===c.ctype&&-1!==h._helper.colNumb(c)?h.transpose(c):k};t.row$2=function(a,f){var c=B(a[0]),b=B(a[1]);return"number"===b.ctype&&"list"===c.ctype&&-1!==h._helper.colNumb(c)?h.row(c,b):k};t.column$2=function(a,f){var c=B(a[0]),b=B(a[1]);return"number"===b.ctype&&"list"===c.ctype&&-1!==h._helper.colNumb(c)?h.column(c,b):k};t.dict$0=function(a,f){var c=Ma.create(),b;for(b in f)f.hasOwnProperty(b)&&Ma.put(c,w.string(b),z(f[b]));return c};t.put$3=
function(a,f){var c=z(a[0]),b=z(a[1]),d=z(a[2]);return"dict"===c.ctype?(c=Ma.clone(c),Ma.put(c,b,d),c):k};t.get$2=function(a,f){var c=z(a[0]),b=z(a[1]);return"dict"===c.ctype?Ma.get(c,b,k):k};t.red$1=function(a,f){var c=z(a[0]);return"number"===c.ctype?h.realVector([Math.min(1,Math.max(0,c.value.real)),0,0]):k};t.green$1=function(a,f){var c=z(a[0]);return"number"===c.ctype?h.realVector([0,Math.min(1,Math.max(0,c.value.real)),0]):k};t.blue$1=function(a,f){var c=z(a[0]);return"number"===c.ctype?h.realVector([0,
0,Math.min(1,Math.max(0,c.value.real))]):k};t.gray$1=function(a,f){var c=z(a[0]);return"number"===c.ctype?(c=Math.min(1,Math.max(0,c.value.real)),h.realVector([c,c,c])):k};t.grey$1=t.gray$1;D.HSVtoRGB=function(a,f,c){var b,d,e,g,l,k;a&&void 0===f&&void 0===c&&(f=a.s,c=a.v,a=a.h);g=Math.floor(6*a);l=6*a-g;a=c*(1-f);k=c*(1-l*f);f=c*(1-(1-l)*f);switch(g%6){case 0:b=c;d=f;e=a;break;case 1:b=k;d=c;e=a;break;case 2:b=a;d=c;e=f;break;case 3:b=a;d=k;e=c;break;case 4:b=f;d=a;e=c;break;case 5:b=c,d=a,e=k}return h.realVector([b,
d,e])};t.hue$1=function(a,f){var c=z(a[0]);return"number"===c.ctype?(c=c.value.real,c-=Math.floor(c),D.HSVtoRGB(c,1,1)):k};D.shapeconvert=function(a){var f,c;if("circle"===a.type){f=a.value.value[0];f=w.div(f,f.value[2]);var b=f.value[0].value.real,d=f.value[1].value.real;a=a.value.value[1].value.real;c=Array(125);var h=2*Math.PI/125;for(f=0;125>f;f++)c[f]={X:b+Math.cos(f*h)*a,Y:d+Math.sin(f*h)*a};return[c]}if("polygon"===a.type){b=[];for(f=0;f<a.value.length;f++){d=a.value[f];c=[];for(h=0;h<d.length;h++)c[h]=
{X:d[h].X,Y:d[h].Y};b[f]=c}return b}};D.shapeop=function(a,f,c){a=D.shapeconvert(a);var b=D.shapeconvert(f);ClipperLib.JS.ScaleUpPaths(a,1E3);ClipperLib.JS.ScaleUpPaths(b,1E3);f=new ClipperLib.Clipper;f.AddPaths(a,ClipperLib.PolyType.ptSubject,!0);f.AddPaths(b,ClipperLib.PolyType.ptClip,!0);var b=a=ClipperLib.PolyFillType.pftNonZero,d=new ClipperLib.Paths;f.Execute(c,d,a,b);ClipperLib.JS.ScaleDownPaths(d,1E3);return{ctype:"shape",type:"polygon",value:d}};D.shapecommon=function(a,f){return D.shapeop(a,
f,ClipperLib.ClipType.ctIntersection)};D.shaperemove=function(a,f){return D.shapeop(a,f,ClipperLib.ClipType.ctDifference)};D.shapeconcat=function(a,f){return D.shapeop(a,f,ClipperLib.ClipType.ctUnion)};t.key$0=function(a,f){return{ctype:"string",value:bd}};t.keycode$0=function(a,f){return l.real(cd)};t.mouse$0=function(a,f){return h.realVector([ra[0],ra[1]])};t.mover$0=function(a,f){if(ja&&ja.mover)return{ctype:"geo",value:ja.mover};console.log("Not moving anything at the moment");return k};t.translate$1=
function(a,f){var c=B(a[0]);"list"===c.ctype&&h.isNumberVector(c)&&2===c.value.length&&y.translate(c.value[0].value.real,c.value[1].value.real);return k};t.rotate$1=function(a,f){var c=B(a[0]);"number"===c.ctype&&y.rotate(c.value.real);return k};t.scale$1=function(a,f){var c=B(a[0]);"number"===c.ctype&&y.scale(c.value.real);return k};t.greset$0=function(a,f){var c=gb.stack.length;y.greset();for(var b=0;b<c;b++)A.restore();return k};t.gsave$0=function(a,f){y.gsave();A.save();return k};t.grestore$0=
function(a,f){y.grestore();A.restore();return k};t.color$1=function(a,f){var c=B(a[0]);"list"===c.ctype&&h.isNumberVector(c).value&&y.setcolor(c);return k};t.linecolor$1=function(a,f){var c=B(a[0]);"list"===c.ctype&&h.isNumberVector(c).value&&y.setlinecolor(c);return k};t.pointcolor$1=function(a,f){var c=B(a[0]);"list"===c.ctype&&h.isNumberVector(c).value&&y.setpointcolor(c);return k};t.alpha$1=function(a,f){var c=B(a[0]);"number"===c.ctype&&y.setalpha(c);return k};t.pointsize$1=function(a,f){var c=
B(a[0]);"number"===c.ctype&&y.setpointsize(c);return k};t.linesize$1=function(a,f){var c=B(a[0]);"number"===c.ctype&&y.setlinesize(c);return k};t.textsize$1=function(a,f){var c=B(a[0]);"number"===c.ctype&&y.settextsize(c);return k};t.playanimation$0=function(a,f){L();return k};t.pauseanimation$0=function(a,f){Ga();return k};t.stopanimation$0=function(a,f){Ha();return k};t.text$1=function(a,f){var c=B(a[0]);return w.string(Y(c))};t.replace$3=function(a,f){var c=z(a[0]),b=z(a[1]),d=z(a[2]);if("string"===
c.ctype&&"string"===b.ctype&&"string"===d.ctype)return c=c.value,b=b.value.replace(/[^A-Za-z0-9]/g,"\\$&"),d=d.value.replace(/\$/g,"$$$$"),c=c.replace(new RegExp(b,"g"),d),{ctype:"string",value:c}};t.replace$2=function(a,f){function c(a,c,f){var h="";d=b=-1;for(var e=0;e<c.length;e++){var g=c[e][0],l=a.indexOf(g,f);-1!==l&&(-1===b?(h=g,b=l,d=e):l<b&&(h=g,b=l,d=e))}return h}var b,d,h,e=z(a[0]);h=z(a[1]);if("string"===e.ctype&&"list"===h.ctype){for(var e=e.value,g=[],l=0;l<h.value.length;l++){var m=
h.value[l];"list"===m.ctype&&2===m.value.length&&"string"===m.value[0].ctype&&"string"===m.value[1].ctype&&(g[g.length]=[m.value[0].value,m.value[1].value])}b=-1;for(h=c(e,g,0);-1!==b;)e=e.substring(0,b)+g[d][1]+e.substring(b+h.length,e.length),h=b+g[d][1].length,h=c(e,g,h);return{ctype:"string",value:e}}return k};t.substring$3=function(a,f){var c=z(a[0]),b=B(a[1]),d=B(a[2]);return"string"===c.ctype&&"number"===b.ctype&&"number"===d.ctype?{ctype:"string",value:c.value.substring(Math.floor(b.value.real),
Math.floor(d.value.real))}:k};t.tokenize$2=function(a,f){var c=z(a[0]),b=z(a[1]);if("string"===c.ctype&&"string"===b.ctype)return t.tokenize$2([c,h.turnIntoCSList([b])],f);if("string"===c.ctype&&"list"===b.ctype){c=c.value;if(0===b.value.length){b=!0;if(void 0!==f.autoconvert){var d=z(f.autoconvert);"boolean"===d.ctype&&(b=d.value)}return b&&""!==c&&(b=Number(c),!isNaN(b))?l.real(b):w.string(c)}var d=b.value[0],e=h.turnIntoCSList(b.value.slice(1)),c=c.split(d.value);return h.turnIntoCSList(c.map(function(a){return t.tokenize$2([w.string(a),
e],f)}))}return k};t.indexof$2=function(a,f){var c=z(a[0]),b=z(a[1]);return"string"===c.ctype&&"string"===b.ctype?(c=c.value.indexOf(b.value),l.real(c+1)):k};t.indexof$3=function(a,f){var c=z(a[0]),b=z(a[1]),d=z(a[2]);return"string"===c.ctype&&"string"===b.ctype&&"number"===d.ctype?(c=c.value.indexOf(b.value,Math.round(d.value.real)-1),l.real(c+1)):k};t.parse$1=function(a,f){var c=z(a[0]);return"string"===c.ctype?(c=Wa(c.value),z(c)):k};t.unicode$1=function(a,f){var c;c=z(a[0]);var b=16;if(f.base){var d=
z(f.base);"number"===d.ctype&&(b=d.value.real)}if("string"===c.ctype)c=parseInt(c.value,b);else if("number"===c.ctype)c=c.value.real;else return k;"undefined"!==typeof String.fromCodePoint?c=String.fromCodePoint(c):65535>=c?c=String.fromCharCode(c):(c-=65536,c=String.fromCharCode((c>>10)+55296,(c&1023)+56320));return w.string(c)};t.international$1=function(a,f){return t.international$2([a[0],null],f)};t.international$2=function(a,f){var c=z(a[0]);if("string"!==c.ctype)return k;var b=(q.translations||
{})[q.language||"en"]||{};if(!b.hasOwnProperty(c.value))return c;var d=b[c.value];if("string"===typeof d)return w.string(d);if(null===a[1])return c;var h=z(a[1]),h="number"===h.ctype?h.value.real:0,b=(b._pluralFormFunction||de)(h);return b<d.length?w.string(d[b]):c};t.currentlanguage$0=function(a,f){return w.string(q.language||"en")};D.basismap=function(a,f,c,b){var d=h.turnIntoCSList([a,f,c]),d=h.adjoint3(h.transpose(d));b=w.mult(d,b);d=h.turnIntoCSList([w.mult(b.value[0],a),w.mult(b.value[1],f),
w.mult(b.value[2],c)]);return h.transpose(d)};t.map$8=function(a,f){var c=K(a[0]),b=K(a[1]),d=K(a[2]),e=K(a[3]),g=K(a[4]),l=K(a[5]),m=K(a[6]),n=K(a[7]);return g!==k&&l!==k&&m!==k&&n!==k&&c!==k&&b!==k&&d!==k&&e!==k?(g=D.basismap(g,l,m,n),c=D.basismap(c,b,d,e),c=w.mult(g,h.adjoint3(c)),h.normalizeMax(c)):k};t.map$6=function(a,f){var c=K(a[0]),b=K(a[1]),d=K(a[2]),e=h.realVector([0,0,1]),g=h.cross,l=g(g(d,g(e,g(c,b))),g(b,g(e,g(c,d)))),m=K(a[3]),n=K(a[4]),q=K(a[5]),e=g(g(q,g(e,g(m,n))),g(n,g(e,g(m,q))));
return m!==k&&n!==k&&q!==k&&e!==k&&c!==k&&b!==k&&d!==k&&l!==k?(m=D.basismap(m,n,q,e),c=D.basismap(c,b,d,l),c=w.mult(m,h.adjoint3(c)),h.normalizeMax(c)):k};t.map$4=function(a,f){var c=h.ii,b=h.jj,d=K(a[0]),e=K(a[1]),g=K(a[2]),l=K(a[3]);return g!==k&&l!==k&&d!==k&&e!==k?(g=D.basismap(g,l,c,b),c=D.basismap(d,e,c,b),c=w.mult(g,h.adjoint3(c)),h.normalizeMax(c)):k};t.map$2=function(a,f){var c=h.ii,b=h.jj,d=K(a[0]),e=w.add(h.realVector([1,0,0]),d),g=K(a[1]),l=w.add(h.realVector([1,0,0]),g);return g!==k&&
l!==k&&d!==k&&e!==k?(g=D.basismap(g,l,c,b),c=D.basismap(d,e,c,b),c=w.mult(g,h.adjoint3(c)),h.normalizeMax(c)):k};t.pointreflect$1=function(a,f){var c=h.ii,b=h.jj,d=K(a[0]),e=w.add(h.realVector([1,0,0]),d),g=w.add(h.realVector([-1,0,0]),d);return g!==k&&d!==k&&e!==k?(g=D.basismap(d,g,c,b),c=D.basismap(d,e,c,b),c=w.mult(g,h.adjoint3(c)),h.normalizeMax(c)):k};t.linereflect$1=function(a,f){var c=h.ii,b=h.jj,d=K(a[0]),e=h.realVector([Math.random(),Math.random(),Math.random()]),g=h.realVector([Math.random(),
Math.random(),Math.random()]),e=h.cross(e,d),g=h.cross(g,d);return d!==k&&e!==k?(d=D.basismap(e,g,c,b),c=D.basismap(e,g,b,c),c=w.mult(d,h.adjoint3(c)),h.normalizeMax(c)):k};D.extractPointVec=function(a){var f={ok:!1};if("geo"===a.ctype){var c=a.value;if("P"===c.kind)return f.x=ta.getField(c,"x"),f.y=ta.getField(c,"y"),f.z=l.real(1),f.ok=!0,f}if("list"!==a.ctype)return f;var b=a.value;if(2===b.length&&(a=b[0],c=b[1],"number"===a.ctype&&"number"===c.ctype))return f.x=a,f.y=c,f.z=l.real(1),f.ok=!0,f;
3===b.length&&(a=b[0],c=b[1],b=b[2],"number"===a.ctype&&"number"===c.ctype&&"number"===b.ctype&&(f.x=l.div(a,b),f.y=l.div(c,b),f.z=l.real(1),f.ok=!0));return f};t.polygon$1=function(a,f){var c=z(a[0]);if("list"===c.ctype){for(var b=[],d=0;d<c.value.length;d++){var h=D.extractPoint(c.value[d]);if(!h.ok)return k;b[d]={X:h.x,Y:h.y}}return{ctype:"shape",type:"polygon",value:[b]}}return k};t.circle$2=function(a,f){var c=B(a[0]),b=B(a[1]),c=D.extractPointVec(c);if(!c.ok||"number"!==b.ctype)return k;c=h.turnIntoCSList([c.x,
c.y,c.z]);return{ctype:"shape",type:"circle",value:h.turnIntoCSList([c,b])}};t.screen$0=function(a,f){var c=y.drawingstate.initialmatrix,b=function(a,f){var b=a-c.tx,d=f+c.ty;return{X:(b*c.d-d*c.b)/c.det,Y:-(-b*c.c+d*c.a)/c.det}};return{ctype:"shape",type:"polygon",value:[[b(0,0),b(ba,0),b(ba,ca),b(0,ca)]]}};t.halfplane$2=function(a,f){var c=B(a[0]),b=B(a[1]),d=K(c),e=K(b);if(c!==k&&b!==k){var g=b.usage,b=d,m=e;if("Line"===c.usage||"Point"===g)b=e,m=d;c=h.turnIntoCSList([m.value[0],m.value[1],l.zero]);
c=h.cross(c,b);c=h.cross(m,c);c=w.div(c,c.value[2]);b=w.div(b,b.value[2]);b=h.sub(b,c);m=h.abs(b);b=w.div(b,m);m=c.value[0].value.real;c=c.value[1].value.real;d=1E3*b.value[0].value.real;b=1E3*b.value[1].value.real;return{ctype:"shape",type:"polygon",value:[[{X:m+b/2,Y:c-d/2},{X:m+b/2+d,Y:c-d/2+b},{X:m-b/2+d,Y:c+d/2+b},{X:m-b/2,Y:c+d/2}]]}}return k};t.element$1=function(a,f){var c=z(a[0]);return"string"===c.ctype&&u.csnames.hasOwnProperty(c.value)?{ctype:"geo",value:u.csnames[c.value]}:k};D.all$1=
function(a,f){var c=z(a[0]);return"geo"===c.ctype&&c.value.incidences?h.ofGeos(c.value.incidences.map(function(a){return u.csnames[a]}).filter(f)):h.nil};t.allpoints$0=function(a,f){return h.ofGeos(u.points)};t.allpoints$1=function(a,f){return D.all$1(a,function(a){return"P"===a.kind})};t.allmasses$0=function(a,f){return h.ofGeos(la)};t.allmasses$1=function(a,f){return D.all$1(a,function(a){return"P"===a.kind&&a.behavior&&"Mass"===a.behavior.type})};t.allsprings$0=function(a,f){return h.ofGeos(Jc)};
t.allsprings$1=function(a,f){return D.all$1(a,function(a){return"S"===a.kind&&a.behavior&&"Spring"===a.behavior.type})};t.alllines$0=function(a,f){return h.ofGeos(u.lines)};t.alllines$1=function(a,f){return D.all$1(a,function(a){return"L"===a.kind||"S"===a.kind})};t.allsegments$0=function(a,f){return h.ofGeos(u.lines.filter(function(a){return"S"===a.kind}))};t.allsegments$1=function(a,f){return D.all$1(a,function(a){return"S"===a.kind})};t.allconics$0=function(a,f){return h.ofGeos(u.conics)};t.allconics$1=
function(a,f){return D.all$1(a,function(a){return"C"===a.kind})};t.allcircles$0=function(a,f){return h.ofGeos(u.conics.filter(function(a){return"Circle"===a.matrix.usage}))};t.allcircles$1=function(a,f){return D.all$1(a,function(a){return"C"===a.kind&&"Circle"===a.matrix.usage})};t.allelements$0=function(a,f){return h.ofGeos(u.gslp)};t.allelements$1=function(a,f){return D.all$1(a,function(a){return!0})};t.elementsatmouse$0=function(a,f){var c=h.realVector([ra[0],ra[1],1]),b=function(a){if(l._helper.isAlmostZero(a.value[2]))return Infinity;
a=h.normalizeZ(a);return h.abs(h.sub(a,c)).value.real},d=function(a){a=h.turnIntoCSList([a.value[0],a.value[1],l.zero]);return h.normalizeMax(h.cross(c,a))},e=function(a){var f=w.mult(a.matrix,c),f=d(f);a=m._helper.IntersectLC(f,a.matrix).map(function(a){return b(a)});return.5>Math.min(a[0],a[1])},g=u.points.filter(function(a){return.5>b(a.homog)}),k=u.lines.filter(function(a){var f;f=d(a.homog);f=h.normalizeMax(h.cross(a.homog,f));if((f=.5>b(f))&&"S"===a.kind){var e=a.homog,e=h.turnIntoCSList([e.value[0],
e.value[1],l.zero]);a=h.crossratio3(a.farpoint,a.startpos,a.endpos,c,e).value.real;if(0>a||1<a)f=!1}return f}),n=u.conics.filter(function(a){var f=e(a);if(f&&a.isArc){var b=h.crossratio3harm(a.startPoint,a.endPoint,a.viaPoint,c,h.ii);a=b.value[0];b=b.value[1];l._helper.isAlmostZero(a)?(a=l.div(a,b),b=l.real(1)):(b=l.div(b,a),a=l.real(1));var d=h.abs(h.turnIntoCSList([b,a]));a=l.div(a,d);b=l.div(b,d);b=l.mult(b,a);0>a.value.real&&(b=l.neg(b));0>b.value.real&&(f=!1)}return f}),g=g.concat(k,n);return h.ofGeos(g)};
t.incidences$1=t.allelements$1;t.createpoint$2=function(a,f){var c=z(a[0]),b=K(a[1]);return"string"!==c.ctype?(da("Name must be a string"),k):"list"!==b.ctype&&h.isNumberVector(b)?(da("Position must be a number vector"),k):{ctype:"geo",value:Ka({name:c.value,type:"Free",labeled:!0,pos:b})}};t.create$3=function(a,f){var c=z(a[0]),b=z(a[1]),d=z(a[2]),e={},g;for(g in f)e[g]=B(f[g]);var n;if("string"===c.ctype)n=c.value;else{if("list"!==c.ctype)return da("Names must be a string or a list of strings"),
k;if(1!==c.value.length){n=w.string(c.value.map(function(a){return a.value}).join("__"));var d=t.create$3([n,b,d],e),q=[];if(d!==k)for(b=w.string(d.value.kind.replace(/^(.*)s$/,"Select$1")),d=h.turnIntoCSList([w.string(d.value.name)]),g=0;g<c.value.length;++g)e.index=l.real(g+1),q.push(t.create$3([c.value[g],b,d],e));return h.turnIntoCSList(q)}if("string"!==c.value[0].ctype)return da("Element of names list must be a string"),k;n=c.value[0].value}if("string"!==b.ctype)return da("Type must be a string"),
k;if("list"!==d.ctype)return da("Arguments must be a list"),k;if(!m.hasOwnProperty(b.value)&&!Ab.hasOwnProperty(b.value)&&!Cc.hasOwnProperty(b.value))return da("Invalid geometric operation: '"+b.value+"'"),k;var c=[],r=null;for(g=0;g<d.value.length;g++){var u=d.value[g];if("string"===u.ctype)c.push(u.value);else if("geo"===u.ctype)c.push(u.value.name);else if(r=K(u),r===k)return da("Unknown argument type"),k}d={name:n,type:b.value,labeled:!0};r&&(d.pos=r);0<c.length&&(d.args=c);for(q in e)d[q]=w.unwrap(e[q]);
return{ctype:"geo",value:Ka(d)}};t.create$2=function(a,f){function c(a){function c(a){u.csnames[a]||(f=a)}var f=!1,b;if("P"===a)for(b=0;26>b&!f;b++)8!==b&&9!==b&&c(String.fromCharCode(65+b));else if("L"===a||"S"===a)for(b=0;26>b&!f;b++)8!==b&&9!==b&&c(String.fromCharCode(97+b));for(b=0;!f;b++)c(a+b);return f}var b=z(a[0]),d=z(a[1]),e={},g;for(g in f)e[g]=B(f[g]);if(!m.hasOwnProperty(b.value)&&!Ab.hasOwnProperty(b.value)&&!Cc.hasOwnProperty(b.value))return da("Invalid geometric operation: '"+b.value+
"'"),k;for(;Ab.hasOwnProperty(b.value);)b.value=Ab[b.value];var n=m[b.value];g=w.string(c(n.kind));if(d.value.length>n.signature.length){var q="Operation "+b.value+" requieres only "+n.signature.length+" argument"+(1===n.signature.length?"":"s")+" ("+d.value.length+" argument"+(1===d.value.length?"":"s")+" given) to create "+g.value+". Ignoring the last arguments.";if(!e.pos){var r=K(d.value[d.value.length-1]);r!==k&&(q+=" Use the last argument as modifier `pos`.",e.pos=r)}da(q);d=h.turnIntoCSList(d.value.slice(0,
n.signature.length))}n=t.create$3([g,b,d],e);if(n!==k&&"s"===n.value.kind[1]&&n.value.results){b=w.string("Select"+n.value.kind[0]);d=h.turnIntoCSList([w.string(n.value.name)]);if(e.pos)return g=w.string(c(n.value.kind[0])),t.create$3([g,b,d],e);q=[];for(r=0;r<n.value.results.value.length;r++)e.index=l.real(r+1),g=w.string(c(n.value.kind[0])),q.push(t.create$3([g,b,d],e));return h.turnIntoCSList(q)}return n};t.javascript$1=function(a,f){var c=z(a[0]);"string"===c.ctype&&(new Function(c.value)).call(sa);
return k};t.use$1=function(a,f){function c(a,c,f){t[a.toLowerCase()+"$"+c]=f}var b=z(a[0]);if("string"===b.ctype){var b=b.value,d;q.plugins&&(d=q.plugins[b]);d||(d=va._pluginRegistry[b]);if(d)return d({instance:sa,config:q,nada:k,evaluate:z,extractPoint:D.extractPoint,evaluateAndVal:B,defineFunction:c,addShutdownHook:kb.push.bind(kb),addAutoCleaningEventListener:H,getVariable:I.getvar.bind(I),getInitialMatrix:function(){return y.drawingstate.initialmatrix},setTextRenderer:function(a,c){Mc=a;c&&(Ed=
c)},getImage:function(a,c){"string"===typeof a&&(a=w.string(a));var f=Ja(a);if(!f)return null;!c&&f.cdyUpdate&&f.cdyUpdate();return f},getMyfunction:function(a){return fb.hasOwnProperty(a)?fb[a]:null}}),{ctype:"boolean",value:!0};da("Plugin "+b+" not found");return{ctype:"boolean",value:!1}}return k};t.format$2=function(a,f){function c(a){a=a.toFixed(e);var c;do c=a,a=a.substring(0,a.length-1);while(""!==a&&"-"!==a&&+a===+c);return""+c}function b(a){var f;return"number"===a.ctype?(f=c(a.value.real),
a=c(a.value.imag),f="0"===a?f:"-"===a.substring(0,1)?f+" - i*"+a.substring(1):f+" + i*"+a,{ctype:"string",value:f}):"list"===a.ctype?{ctype:"list",value:a.value.map(b)}:{ctype:"string",value:Y(a).toString()}}var d=B(a[0]),h=B(a[1]),e;return"number"!==d.ctype&&"list"!==d.ctype||"number"!==h.ctype?k:(e=Math.max(0,Math.min(20,Math.round(h.value.real))),b(d))};Date.now||(Date.now=function(){return(new Date).getTime()});var Rd=0;t.timestamp$0=function(a,f){return l.real(Date.now())};t.seconds$0=function(a,
f){return l.real((Date.now()-Rd)/1E3)};t.resetclock$0=function(a,f){Rd=Date.now();return k};t.time$0=function(a,f){var c=new Date;return h.realVector([c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds()])};t.date$0=function(a,f){var c=new Date;return h.realVector([c.getFullYear(),c.getMonth()+1,c.getDate()])};t.simulationtime$0=function(a,f){return l.real(Kb*Pd)};t.settimeout$2=function(a,f){function c(){z(d);e()}var b=z(a[0]),d=a[1];"number"===b.ctype&&"undefined"!==typeof window&&window.setTimeout(c,
1E3*b.value.real);return k};D.formatForWebGL=function(a){return a.toFixed(10)};t.generateWebGL$2=function(a,f){var c=D.formatForWebGL,b=a[0],d=z(a[1]);console.log(d);if("list"!==d.ctype)return k;for(var h=[],e=0;e<d.value.length;e++)"string"===d.value[e].ctype&&h.push(d.value[e].value);console.log("***********");console.log(h);d=D.plotvars(b);console.log(d);-1===d.indexOf("a")&&-1===d.indexOf("b")&&-1===d.indexOf("c")&&-1===d.indexOf("d")&&-1===d.indexOf("e")&&-1===d.indexOf("f")&&(b=B(b));if("number"===
b.ctype)return{ctype:"string",value:"vec2("+c(b.value.real)+","+c(b.value.imag)+")"};if("variable"===b.ctype)return{ctype:"string",value:b.name};if("string"===b.ctype||"void"===b.ctype)return b;if(2===b.args.length&&("infix"===b.ctype||"function"===b.ctype)){c=t.compileToWebGL$1([b.args[0]],{});d=t.compileToWebGL$1([b.args[1]],{});if("+"===b.oper||"add"===b.oper)return void 0===c.value||"void"===c.ctype?{ctype:"string",value:d.value}:{ctype:"string",value:"addc("+c.value+","+d.value+")"};if("*"===
b.oper||"mult"===b.oper)return{ctype:"string",value:"multc("+c.value+","+d.value+")"};if("/"===b.oper||"div"===b.oper)return{ctype:"string",value:"divc("+c.value+","+d.value+")"};if("-"===b.oper||"sub"===b.oper)return void 0===c.value||"void"===c.ctype?{ctype:"string",value:"negc("+d.value+")"}:{ctype:"string",value:"subc("+c.value+","+d.value+")"};if("^"===b.oper||"pow"===b.oper)return{ctype:"string",value:"powc("+c.value+","+d.value+")"}}if("function"===b.ctype&&1===b.args.length){c=t.compileToWebGL$1([b.args[0]],
{});if("sin$1"===b.oper)return{ctype:"string",value:"sinc("+c.value+")"};if("cos$1"===b.oper)return{ctype:"string",value:"cosc("+c.value+")"};if("tan$1"===b.oper)return{ctype:"string",value:"tanc("+c.value+")"};if("exp$1"===b.oper)return{ctype:"string",value:"expc("+c.value+")"};if("log$1"===b.oper)return{ctype:"string",value:"logc("+c.value+")"};if("arctan$1"===b.oper)return{ctype:"string",value:"arctanc("+c.value+")"};if("arcsin$1"===b.oper)return{ctype:"string",value:"arcsinc("+c.value+")"};if("arccos$1"===
b.oper)return{ctype:"string",value:"arccosc("+c.value+")"};if("sqrt$1"===b.oper)return{ctype:"string",value:"sqrtc("+c.value+")"}}return k};t.compileToWebGL$1=function(a,f){var c,b;c=D.formatForWebGL;var d=a[0];b=D.plotvars(d);-1===b.indexOf("a")&&-1===b.indexOf("b")&&-1===b.indexOf("c")&&-1===b.indexOf("d")&&-1===b.indexOf("e")&&-1===b.indexOf("f")&&(d=B(d));if("number"===d.ctype)return{ctype:"string",value:"vec2("+c(d.value.real)+","+c(d.value.imag)+")"};if("variable"===d.ctype)return{ctype:"string",
value:d.name};if("string"===d.ctype||"void"===d.ctype)return d;if(2===d.args.length&&("infix"===d.ctype||"function"===d.ctype)){c=t.compileToWebGL$1([d.args[0]],{});b=t.compileToWebGL$1([d.args[1]],{});if("+"===d.oper||"add"===d.oper)return void 0===c.value||"void"===c.ctype?{ctype:"string",value:b.value}:{ctype:"string",value:"addc("+c.value+","+b.value+")"};if("*"===d.oper||"mult"===d.oper)return{ctype:"string",value:"multc("+c.value+","+b.value+")"};if("/"===d.oper||"div"===d.oper)return{ctype:"string",
value:"divc("+c.value+","+b.value+")"};if("-"===d.oper||"sub"===d.oper)return void 0===c.value||"void"===c.ctype?{ctype:"string",value:"negc("+b.value+")"}:{ctype:"string",value:"subc("+c.value+","+b.value+")"};if("^"===d.oper||"pow"===d.oper)return{ctype:"string",value:"powc("+c.value+","+b.value+")"}}if("function"===d.ctype&&1===d.args.length){c=t.compileToWebGL$1([d.args[0]],{});if("sin$1"===d.oper)return{ctype:"string",value:"sinc("+c.value+")"};if("cos$1"===d.oper)return{ctype:"string",value:"cosc("+
c.value+")"};if("tan$1"===d.oper)return{ctype:"string",value:"tanc("+c.value+")"};if("exp$1"===d.oper)return{ctype:"string",value:"expc("+c.value+")"};if("log$1"===d.oper)return{ctype:"string",value:"logc("+c.value+")"};if("arctan$1"===d.oper)return{ctype:"string",value:"arctanc("+c.value+")"};if("arcsin$1"===d.oper)return{ctype:"string",value:"arcsinc("+c.value+")"};if("arccos$1"===d.oper)return{ctype:"string$1",value:"arccosc("+c.value+")"};if("sqrt$1"===d.oper)return{ctype:"string",value:"sqrtc("+
c.value+")"}}return k};t.setsimulationspeed$1=function(a,f){var c=B(a[0]);"number"===c.ctype&&ha(c.value.real);return k};t.setsimulationaccuracy$1=function(a,f){var c=B(a[0]);"number"===c.ctype&&"undefined"!==typeof O&&"undefined"!==typeof O.env&&(O.env.accuracy=Math.max(1,c.value.real|0));return k};t.setsimulationquality$1=function(a,f){var c=B(a[0]);"number"===c.ctype&&"undefined"!==typeof O&&"undefined"!==typeof O.env&&(c=c.value.real,0===c&&(O.env.errorbound=.01,O.env.lowestdeltat=1E-5,O.env.slowdownfactor=
2),1===c&&(O.env.errorbound=.001,O.env.lowestdeltat=1E-7,O.env.slowdownfactor=2),2===c&&(O.env.errorbound=1E-5,O.env.lowestdeltat=1E-10,O.env.slowdownfactor=4),3===c&&(O.env.errorbound=1E-6,O.env.lowestdeltat=1E-12,O.env.slowdownfactor=4));return k};var hc=null,oc=null;t.createtool$3=function(a,f){var c,b="left",d="top",h=null;f.space&&(c=z(f.space),"number"===c.ctype&&(h=c.value.real/2));var e=null;f.toolbar&&(c=z(f.toolbar),"string"===c.ctype&&((e=document.getElementById(c.value))||console.warn("Element #"+
c.value+" not found")));if(!e){if(f.reference){var g=z(f.reference);if("string"===g.ctype)switch(g.value){case "UR":b="right";break;case "LL":d="bottom";break;case "LR":b="right",d="bottom"}}e=document.createElement("div");e.className="CindyJS-toolbar";na.parentNode.appendChild(e);g=z(a[1]);c=z(a[2]);"number"===g.ctype&&(e.style[b]=g.value.real+"px");"number"===c.ctype&&(e.style[d]=c.value.real+"px");null!==h&&(e.style.margin=-h+"px")}g=z(a[0]);if("string"===g.ctype)g=[[g.value]];else if("list"===
g.ctype)g=g.value.map(function(a){return"string"===a.ctype?[a.value]:"list"===a.ctype?a.value.map(function(a){return"string"===a.ctype?a.value:null}):[null]});else return da("Name must be a string or a list of strings"),k;if(f.flipped&&(c=z(f.flipped),"boolean"===c.ctype&&c.value)){da("Flipping");var l=0;c=g.length;g.forEach(function(a){a.length>l&&(l=a.length)});for(var m=[],n=0;n<l;++n){m[n]=[];for(var q=0;q<c;++q)m[n][q]=g[q][n]||null}g=m}"bottom"===d&&g.reverse();g.forEach(function(a){"right"===
b&&a.reverse();var c=document.createElement("div");e.appendChild(c);a.forEach(function(a){function f(){hc&&hc.classList.remove("CindyJS-active");hc=d;d.classList.add("CindyJS-active");zc=a;var c=G[zc].actions;oc&&(oc.textContent=c[0].tooltip||"");za=[];yb=$a=0}G.hasOwnProperty(a)||(da("Tool '"+a+"' not implemented yet."),a=null);if(null===a){var b=document.createElement("span");b.className="CindyJS-spacer";c.appendChild(b)}else{var d=document.createElement("button"),b=document.createElement("img");
b.src=va.getBaseDir()+"images/"+a+".png";d.appendChild(b);d.addEventListener("click",f);hc||f();null!==h&&(d.style.margin=h+"px");c.appendChild(d)}})});return k};t.dropped$0=function(){return tc};t.droppoint$0=function(){return uc};t.parsecsv$1=function(a,f){var c=!0,b=B(f.autoconvert);"boolean"===b.ctype&&(c=b.value);var d=null,b=B(f.delimiter);"string"===b.ctype&&/^[^\"\r\n]$/.test(b.value)&&(d=b.value);b=B(a[0]);if("string"!==b.ctype)return da("CSV data is not a string"),k;var b=b.value,e='(?:"((?:[^"]+|"")*)"|([^]*?))(\r\n|(,)|[\r\n]|$)';
d&&(d=d.replace(/[^A-Za-z0-9]/g,"\\$&").replace(/\$/g,"$$$$"),e=e.replace(/,/g,d));for(var e=new RegExp(e,"g"),d=[],g=[],m=null;e.lastIndex<b.length;){var n=e.exec(b),q=n[2];"string"===typeof n[1]&&(q=n[1].replace(/""/g,'"'));q=c?/^[Tt]rue$/.test(q)?w.bool(!0):/^[Ff]alse$/.test(q)?w.bool(!1):/^[\-+]?([0-9]+(\.[0-9]*)?|\.[0-9]+|Infinity)$/.test(q)?l.real(Number(q)):w.string(q):w.string(q);d.push(q);n[4]&&e.lastIndex===b.length&&(d.push(w.string("")),n={});if(!n[4]){null===m&&(m=d.length);if(m<d.length)for(m=
d.length,n=0;n<g.length;++n)for(q=g[n].length;q<m;++q)g[n][q]=k;else if(m>d.length)for(n=d.length;n<m;++n)d[n]=k;g.push(d);d=[]}}return h.turnIntoCSList(g.map(h.turnIntoCSList))};t.load$2=function(a,f){return t.load$3([a[0],null,a[1]],f)};t.load$3=function(a,f){function c(){if(g.readyState===XMLHttpRequest.DONE){var c;200===g.status?c=w.string(String(g.responseText)):(da("Failed to load "+h+": "+g.statusText),c=k);I.newvar(b);I.setvar(b,c);z(a[2]);I.removevar(b);e()}}var b="#";null!==a[1]&&"variable"===
a[1].ctype&&(b=a[1].name);var d=B(a[0]),h=null,g=null;"string"===d.ctype&&/^https?:\/\//.test(d.value)&&(h=d.value);return null!==h?(g=new XMLHttpRequest,g.onreadystatechange=c,g.open("GET",h),g.send(),w.bool(!0)):k};D.extractPoint=function(a){var f={ok:!1};if("geo"===a.ctype){var c=a.value;if("P"===c.kind)return f.x=ta.getField(c,"x").value.real,f.y=ta.getField(c,"y").value.real,f.ok=!0,f}if("list"!==a.ctype)return f;var b=a.value;if(2===b.length&&(a=b[0],c=b[1],"number"===a.ctype&&"number"===c.ctype))return f.x=
a.value.real,f.y=c.value.real,f.ok=!0,f;3===b.length&&(a=b[0],c=b[1],b=b[2],"number"===a.ctype&&"number"===c.ctype&&"number"===b.ctype&&(a=l.div(a,b),c=l.div(c,b),f.x=a.value.real,f.y=c.value.real,f.ok=!0));return f};t.draw$1=function(a,f){var c=B(a[0]);if("shape"===c.ctype)D.drawshape(c,f);else if("Line"===c.usage)x.handleModifs(f,x.lineModifs),x.drawline(c);else{var b=D.extractPoint(c);if(!b.ok){if("undefined"!==typeof c.value&&2===c.value.length)return t.draw$2(c.value,f);return}null!==f&&x.handleModifs(f,
x.pointModifs);x.drawpoint(b)}return k};t.draw$2=function(a,f){var c=B(a[0]),b=B(a[1]),c=D.extractPoint(c),b=D.extractPoint(b);if(!c.ok||!b.ok)return k;null!==f&&x.handleModifs(f,x.lineModifs);x.drawsegcore(c,b);return k};t.drawcircle$2=function(a,f){return D.drawcircle(a,f,"D")};D.arcHelper=function(a){var f={};f.startPoint=K(a[0]);f.viaPoint=K(a[1]);f.endPoint=K(a[2]);return f};t.fillcircle$2=function(a,f){return D.drawcircle(a,f,"F")};t.drawarc$3=function(a,f){var c=D.arcHelper(a);return D.drawarc(c,
f,"D")};t.fillarc$3=function(a,f){var c=D.arcHelper(a);return D.drawarc(c,f,"F")};D.drawarc=function(a,f,c){var b=a.startPoint,d=a.viaPoint;a=a.endPoint;if(!h._helper.isAlmostReal(h.turnIntoCSList([b,d,a])))return k;x.handleModifs(f,x.conicModifs);x.preDrawCurve();f=h.det3(b,d,a);if(1E-12<Math.abs(f.value.real)){f=m._helper.ConicBy5(null,b,d,a,h.ii,h.jj);var e=m._helper.CenterOfConic(f),e=h.normalizeMax(e);f=l.real(0);var g=h.turnIntoCSList([h.turnIntoCSList([e.value[2],f,l.neg(e.value[0])]),h.turnIntoCSList([f,
e.value[2],l.neg(e.value[1])]),h.turnIntoCSList([f,f,e.value[2]])]);f=h.normalizeZ(w.mult(g,b));h.normalizeZ(w.mult(g,d));g=h.normalizeZ(w.mult(g,a));f=-Math.atan2(f.value[1].value.real,f.value[0].value.real);g=-Math.atan2(g.value[1].value.real,g.value[0].value.real);e=h.normalizeZ(e);b=h.normalizeZ(b);d=h.normalizeZ(d);a=h.normalizeZ(a);var n=h.abs(h.sub(b,e)),q=[e.value[0].value.real,e.value[1].value.real],e=y.drawingstate.matrix,r=q[0]*e.a-q[1]*e.b+e.tx,q=q[0]*e.c-q[1]*e.d-e.ty,b=0<h.det3(b,d,
a).value.real;A.save();A.beginPath();A.translate(r,q);A.arc(0,0,n.value.real*e.sdet,f,g,b);"F"===c&&(A.fillStyle=x.lineColor,A.closePath(),A.fill());"D"===c&&A.stroke();A.restore()}else{if("D"!==c)return k;c=D.extractPoint(b);f=D.extractPoint(d);g=D.extractPoint(a);if(!c.ok||!f.ok||!g.ok)return k;n=(c.x-g.x)*(c.x-g.x)+(c.y-g.y)*(c.y-g.y);e=(g.x-f.x)*(g.x-f.x)+(g.y-f.y)*(g.y-f.y);if(1E-12>(c.x-f.x)*(c.x-f.x)+(c.y-f.y)*(c.y-f.y)||1E-12>n||1E-12>e)return k;0>h.crossratio3(b,a,d,h.cross(h.cross(b,d),
h.linfty),h.ii).value.real?x.drawsegcore(c,g):x.drawRaySegment(b,a)}return k};D.drawcircle=function(a,f,c){var b=B(a[0]);a=B(a[1]);var d=D.extractPoint(b);if(!d.ok||"number"!==a.ctype||!l._helper.isAlmostReal(a))return k;var b=y.drawingstate.matrix,h=d.x*b.a-d.y*b.b+b.tx,d=d.x*b.c-d.y*b.d-b.ty;x.handleModifs(f,x.conicModifs);x.preDrawCurve();A.lineJoin="miter";A.beginPath();A.arc(h,d,Math.abs(a.value.real)*b.sdet,0,2*Math.PI);A.closePath();"D"===c&&A.stroke();"F"===c&&(A.fillStyle=x.lineColor,A.fill());
"C"===c&&A.clip();return k};t.drawconic$1=function(a,f){var c=B(a[0]);if("list"!==c.ctype||3!==c.value.length&&6!==c.value.length)return console.error("could not parse conic"),k;if(6===c.value.length){for(var b=0;6>b;b++)if("number"!==c.value[b].ctype)return console.error("could not parse conic"),k;var d=l.real(.5),b=c.value[0],e=c.value[2],e=l.mult(e,d),g=c.value[1],m=c.value[3],m=l.mult(m,d),n=c.value[4],n=l.mult(n,d),c=c.value[5],c=h.turnIntoCSList([h.turnIntoCSList([b,e,m]),h.turnIntoCSList([e,
g,n]),h.turnIntoCSList([m,n,c])])}else{if(!h.isNumberMatrix(c).value||3!==c.value.length||3!==c.value[0].value.length)return k;b=h.transpose(c);h.equals(c,b).value||(c=h.add(b,c))}return D.drawconic(c,f)};D.drawconic=function(a,f){function c(a,c){var f=(n*a+q*c+r)*a+(t*c+u)*c+v;return 0<=f?1:0>f?-1:NaN}function b(a){M.next=a;a.prev=M;return M=a}function d(a,f,b,e){return{a:a,b1:f,b2:b,vertical:!0,index:e,sign:function(f){return c(a,f)},mkp:function(c){return{x:a,y:c}},sol:Lb(t,q*a+u,(n*a+r)*a+v),
discr:function(){return Lb(E,-2*B,w)},tpt:function(a){return{x:a,y:-.5*(q*a+u)/t}}}}function e(a,f,b,d){return{a:a,b1:f,b2:b,vertical:!1,index:d,sign:function(f){return c(f,a)},mkp:function(c){return{x:c,y:a}},sol:Lb(n,q*a+r,(t*a+u)*a+v),discr:function(){return Lb(E,-2*D,C)},tpt:function(a){return{x:-.5*(q*a+r)/n,y:a}}}}function g(a){var c=Math.min(a.b1,a.b2),f=Math.max(a.b1,a.b2),d=a.sign(c),e=a.sign(f);if(!isFinite(d*e))return!1;var h=a.sol,l;if(d!==e){if(null===h)return!1;l=.5*(h[0]+h[1]);l>c&&
l<f?(c=a.sign(l),l=h[c===e?0:1]):(d=.5*(c+f),l=h[Math.abs(d-h[0])<Math.abs(d-h[1])?0:1]);L.push(b(a.mkp(l)))}else{if(null===h){if(0>=F)return!0;h=a.discr();if(null===h)return!0;a=a.tpt(h[a.index]);a.x>=G&&a.x<=N&&a.y>=H&&a.y<=I&&b(a);return!0}l=.5*(h[0]+h[1]);if(!(l>c&&l<f))return!0;c=a.sign(l);if(c===d||isNaN(c))return!0;a.b1>a.b2&&(h=[h[1],h[0]]);L.push(b(a.mkp(h[0])));L.push(b(a.mkp(h[1])))}return!0}function l(a,c,f,b,d){var h=c-b,e=f-a,p=a*b-c*f,g=B*h+D*e+E*p;if(1E-14>Math.abs(g))return A.lineTo(f,
b);var k=(w*h+z*e+B*p)/g,h=(z*h+C*e+D*p)/g;if(!isFinite(k)||!isFinite(h)||.04>Math.abs(a*h+k*b+f*c-f*h-k*c-a*b))return A.lineTo(f,b);do if(!(10<d)){var p=.5*(a+f),e=.5*(c+b),m=k-p,g=h-e;if(!(.04>m*m+g*g)){var pa=n*m*m+q*m*g+t*g*g,qa=2*n*m*p+q*(m*e+g*p)+2*t*g*e+r*m+u*g,wb=(n*p+q*e+r)*p+(t*e+u)*e+v,Va=Lb(pa,qa,wb);Va||(Va=[-.5*qa/pa,-2*wb/qa]);if(0<Va[0])Va=Va[0];else if(0<=Va[1])Va=Va[1];else break;m=p+Va*m;g=e+Va*g;p=m-.5*(k+p);e=g-.5*(h+e);if(!(.04>p*p+e*e)){l(a,c,m,g,d+1);l(m,g,f,b,d+1);return}}}while(0);
A.quadraticCurveTo(k,h,f,b)}x.handleModifs(f,x.conicModifs);if(0!==x.lsize){x.preDrawCurve();var k;k=h.normalizeMax(a);if(h._helper.isAlmostReal(k)){var m=y.toMat();k=h.mult(h.transpose(m),k);k=h.mult(k,m);k=h.normalizeMax(k);var n=k.value[0].value[0].value.real,q=2*k.value[0].value[1].value.real,r=2*k.value[0].value[2].value.real,t=k.value[1].value[1].value.real,u=2*k.value[1].value[2].value.real,v=k.value[2].value[2].value.real,w=4*v*t-u*u,z=u*r-2*v*q,B=u*q-2*t*r,C=4*v*n-r*r,D=r*q-2*u*n,E=4*t*n-
q*q,F=E;k=t*C+q*z+n*w-v*E;0>k&&(n=-n,q=-q,r=-r,t=-t,u=-u,v=-v,k=-k);k=x.lsize;var G=-k,H=-k,N=ba+k,I=ca+k,L=[],M=k={};if(g(d(G,H,I,0))&&g(e(I,G,N,1))&&g(d(N,I,H,1))&&g(e(H,N,G,0))&&M!==k){M.next=k.next;k.next.prev=M;A.beginPath();var K,J;if(0===L.length){K=M;A.moveTo(K.x,K.y);do J=K.next,l(K.x,K.y,J.x,J.y,0),K=J;while(K!==M);A.closePath()}m=1===c(G,H)?0:1;if(4===L.length){var O=0;for(k=0;2>k;++k){K=L[k];J=L[k+2];var P=J.x-K.x;K=J.y-K.y;K=(n*P+q*K)*P+t*K*K;Math.abs(K)>Math.abs(O)&&(O=K)}if(isNaN(O))return;
0<=O&&(m=1-m)}for(k=m;k<L.length;k+=2)for(K=L[k],m=L[(k+1)%L.length],A.moveTo(K.x,K.y),J=K.next;K!==m;J=(K=J).next)l(K.x,K.y,J.x,J.y,0);A.stroke()}}}};t.drawall$1=function(a,f){var c=z(a[0]);if("list"===c.ctype){x.handleModifs(f,x.pointAndLineModifs);for(var b=0;b<c.value.length;b++)t.draw$1([c.value[b]],null)}return k};t.connect$1=function(a,f){return D.drawpolygon(a,f,"D",!1)};t.drawpoly$1=function(a,f){return D.drawpolygon(a,f,"D",!0)};t.fillpoly$1=function(a,f){return D.drawpolygon(a,f,"F",!0)};
t.drawpolygon$1=function(a,f){return D.drawpolygon(a,f,"D",!0)};t.fillpolygon$1=function(a,f){return D.drawpolygon(a,f,"F",!0)};D.drawpolygon=function(a,f,c,b){function d(){for(var a=g.value,c=0;c<a.length;c++){var f=a[c],b;for(b=0;b<f.length;b++){var h=f[b],p=h.X*e.a-h.Y*e.b+e.tx,h=h.X*e.c-h.Y*e.d-e.ty;0===b?A.moveTo(p,h):A.lineTo(p,h)}A.closePath()}}function h(){var a;for(a=0;a<g.value.length;a++){var c=D.extractPoint(g.value[a]);if(!c.ok)return;var f=c.x*e.a-c.y*e.b+e.tx,c=c.x*e.c-c.y*e.d-e.ty;
0===a?A.moveTo(f,c):A.lineTo(f,c)}b&&A.closePath()}x.handleModifs(f,x.conicModifs);x.preDrawCurve();var e=y.drawingstate.matrix,g=z(a[0]);A.beginPath();"list"===g.ctype&&h();"shape"===g.ctype&&d();"D"===c&&(x.fillColor&&(A.fillStyle=x.fillColor,A.fill(x.fillrule)),A.stroke());"F"===c&&(A.fillStyle=x.lineColor,A.fill(x.fillrule));"C"===c&&A.clip();return k};var Mc=jd,Ed=function(a,f,c){if(-1!==f.indexOf("\n"))for(f=f.split("\n"),a.textContent=f[0],c=1;c<f.length;++c)a.appendChild(document.createElement("br")),
a.appendChild(document.createTextNode(f[c]));else a.textContent=f};D.drawtext=function(a,f,c){var b=B(a[0]);a=z(a[1]);var d=D.extractPoint(b);if(!d.ok)return null;x.handleModifs(f,x.textModifs);f=y.drawingstate.textsize;null===f&&(f=ga.textsize);null!==x.size&&(f=x.size);A.fillStyle=x.textColor;var h=y.drawingstate.matrix,b=d.x*h.a-d.y*h.b+h.tx+x.xOffset,d=d.x*h.c-d.y*h.d-h.ty-x.yOffset;a=Y(a);va._pluginRegistry.katex||"string"!==typeof a||3<=a.split("$").length&&oa("katex","katex-plugin.js",!0);
h=x.bold+x.italics+Math.round(10*f)/10+"px "+x.family;A.font=h;return c?c(a,h,b,d,x.align,f):Mc(A,a,b,d,x.align,f,f*ga.lineHeight)};t.drawtext$2=function(a,f){D.drawtext(a,f,null);return k};t.drawtable$2=function(a,f){var c=B(a[0]),b=B(a[1]),d=D.extractPoint(c);if(!d.ok||"list"!==b.ctype)return k;var b=b.value,c=b.length,e=-1,g;for(g=0;g<c;++g)"list"===b[g].ctype&&b[g].value.length>e&&(e=b[g].value.length);-1===e?(b=b.map(function(a){return[a]}),e=1):b=b.map(function(a){return h.asList(a).value});
var l=100,m=null,n=!0,q=y.drawingstate.textcolor;x.handleModifs(f,{size:!0,color:function(a){h._helper.isNumberVecN(a,3)&&(q=x.makeColor([a.value[0].value.real,a.value[1].value.real,a.value[2].value.real]))},alpha:!0,bold:!0,italics:!0,family:!0,align:!0,x_offset:!0,y_offset:!0,offset:!0,width:function(a){"number"===a.ctype&&(l=a.value.real)},height:function(a){"number"===a.ctype&&(m=a.value.real)},border:function(a){"boolean"===a.ctype&&(n=a.value)}});var r=y.drawingstate.textsize;null===r&&(r=ga.textsize);
null!==x.size&&(r=x.size);null===m&&(m=1.6*r);A.font=x.bold+x.italics+Math.round(10*r)/10+"px "+x.family;g=y.drawingstate.matrix;var t=e*l,u=c*m,r=d.x*g.a-d.y*g.b+g.tx+x.xOffset,v=d.x*g.c-d.y*g.d-g.ty-x.yOffset-u;if(n){x.preDrawCurve();A.strokeStyle=x.lineColor;A.beginPath();for(g=1;g<c;++g)A.moveTo(r,v+g*m),A.lineTo(r+t,v+g*m);for(d=1;d<e;++d)A.moveTo(r+d*l,v),A.lineTo(r+d*l,v+u);A.stroke();A.lineWidth=x.lsize+1;A.beginPath();A.rect(r,v,t,u);A.stroke()}r+=x.align*l+(1-2*x.align)*m*.3;v+=.7*m;A.fillStyle=
q;for(g=0;g<c;++g)for(d=0;d<e;++d)t=Y(b[g][d]),Mc(A,t,r+d*l,v+g*m,x.align);return k};D.drawshape=function(a,f){return"polygon"===a.type?D.drawpolygon([a],f,"D",1):"circle"===a.type?D.drawcircle([a.value.value[0],a.value.value[1]],f,"D"):k};D.fillshape=function(a,f){return"polygon"===a.type?D.drawpolygon([a],f,"F",1):"circle"===a.type?D.drawcircle([a.value.value[0],a.value.value[1]],f,"F"):k};D.clipshape=function(a,f){return"polygon"===a.type?D.drawpolygon([a],f,"C",1):"circle"===a.type?D.drawcircle([a.value.value[0],
a.value.value[1]],f,"C"):k};t.fill$1=function(a,f){var c=z(a[0]);return"shape"===c.ctype?D.fillshape(c,f):k};t.clip$1=function(a,f){var c=z(a[0]);return"shape"===c.ctype?D.clipshape(c,f):"list"===c.ctype?(c=t.polygon$1(a,[]),t.clip$1([c],[])):k};t.plot$1=function(a,f){return t.plot$2([a[0],null],f)};t.plot$2=function(a,f){function c(a){return"number"===a.ctype&&l._helper.isAlmostReal(a)}function b(a,c,f,d,h){m++;c=+c.value.real;h=+d.value.real;d=c*C.a-h*C.b+C.tx;c=c*C.c-h*C.d-C.ty;a=+a.value.real;
h=+f.value.real;f=a*C.a-h*C.b+C.tx;a=a*C.c-h*C.d-C.ty;n?(A.lineTo(f,a),A.lineTo(d,c)):(A.beginPath(),A.moveTo(f,a),A.lineTo(d,c),n=!0)}function d(a,f,h,k,m){var q=c(h),r=c(k);if(.001>m)!e&&n&&(A.stroke(),n=!1);else if(q||r){var t=l.real((a.value.real+f.value.real)/2);I.setvar(w,t);var u=z(v),Yb=c(u);if(q&&r&&Yb){var Ra=h.value.real,r=u.value.real,Yb=k.value.real;if(q=1>Math.abs(Ra+Yb-2*r)/g){var Qa=l.real((a.value.real+t.value.real)/2);I.setvar(w,Qa);var Qa=z(v),x=l.real((t.value.real+f.value.real)/
2);I.setvar(w,x);x=z(v);Ra=Math.abs(Ra+r-2*Qa.value.real)/g;r=Math.abs(r+Yb-2*x.value.real)/g;q=q&&1>Ra&&1>r}q?(b(a,t,h,u,m/2),b(t,f,u,k,m/2)):(d(a,t,h,u,m/2),d(t,f,u,k,m/2))}else d(a,t,h,u,m/2),d(t,f,u,k,m/2)}}var e=!1,g=.2/Vb,m=0,n=!1,q=-10,r=10,t=.1,u=1E3,v=a[0],w;if(null!==a[1]&&"variable"===a[1].ctype)w=a[1].name;else{var B=D.plotvars(v);w="#";-1!==B.indexOf("t")&&(w="t");-1!==B.indexOf("z")&&(w="z");-1!==B.indexOf("y")&&(w="y");-1!==B.indexOf("x")&&(w="x")}I.newvar(w);var C=y.drawingstate.matrix;
x.handleModifs(f,{color:!0,alpha:!0,size:!0,dashpattern:!0,dashtype:!0,dashing:!0,lineCap:!0,lineJoin:!0,miterLimit:!0,connect:function(a){"boolean"===a.ctype&&(e=a.value)},start:function(a){"number"===a.ctype&&(q=a.value.real)},stop:function(a){"number"===a.ctype&&(r=a.value.real)},steps:function(a){"number"===a.ctype&&(u=a.value.real)}});A.strokeStyle=x.lineColor;A.lineWidth=x.lsize;var E,F,G,H,n=!1,B=l.real(14.32);I.setvar(w,B);G=z(v);if("number"!==G.ctype){if(h.isNumberVector(G).value&&2===G.value.length){n=
!1;t=(r-q)/u;for(B=q;B<r;B+=t)I.setvar(w,l.real(B)),H=z(v),h.isNumberVector(H).value&&2===H.value.length&&(E=+H.value[0].value.real,F=+H.value[1].value.real,H=E*C.a-F*C.b+C.tx,E=E*C.c-F*C.d-C.ty,n?A.lineTo(H,E):(A.beginPath(),A.moveTo(H,E),n=!0));A.stroke();I.removevar(w)}return k}for(H=q;H<r+t;H+=t)B=l.real(H),I.setvar(w,B),G=z(v),B.value.real>q&&d(E,B,F,G,t),E=B,F=G;I.removevar(w);n&&A.stroke();return k};t.plotX$1=function(a,f){var c=a[0],b=D.plotvars(c),d="#";-1!==b.indexOf("t")&&(d="t");-1!==
b.indexOf("z")&&(d="z");-1!==b.indexOf("y")&&(d="y");-1!==b.indexOf("x")&&(d="x");I.newvar(d);b=y.drawingstate.matrix;A.fillStyle=y.drawingstate.linecolor;A.lineWidth=1;A.lineCap=x.lineCap;A.lineJoin=x.lineJoin;A.miterLimit=x.miterLimit;for(var h=!1,e=-10;10>e;e+=.01){I.setvar(d,l.real(e));var g=z(c);if("number"===g.ctype){var m=+g.value.real,g=e*b.a-m*b.b+b.tx,m=e*b.c-m*b.d-b.ty;h?A.lineTo(g,m):(A.beginPath(),A.moveTo(g,m),h=!0)}}A.stroke();I.removevar(d);return k};D.plotvars=function(a){function f(a,
c){var f={},b;for(b=a.length-1;0<=b;--b)f[a[b]]=a[b];for(b=c.length-1;0<=b;--b)f[c[b]]=c[b];b=[];for(var d in f)f.hasOwnProperty(d)&&b.push(f[d]);return b}function c(a,c){for(var f=0;f<a.length;f++)a[f]===c&&(a.splice(f,1),f--);return a}var b,d,h,e;if("variable"===a.ctype)return[a.name];if("infix"===a.ctype)return b=D.plotvars(a.args[0]),a=D.plotvars(a.args[1]),f(b,a);if("list"===a.ctype){h=a.value;d=[];for(e=0;e<h.length;e++)b=D.plotvars(h[e]),d=f(d,b);return d}if("function"===a.ctype){h=a.args;
d=[];for(e=0;e<h.length;e++)b=D.plotvars(h[e]),d=f(d,b);"apply"!==a.oper&&"select"!==a.oper&&"forall"!==a.oper&&"sum"!==a.oper&&"product"!==a.oper&&"repeat"!==a.oper&&"min"!==a.oper&&"max"!==a.oper&&"sort"!==a.oper||"variable"!==a.args[1].ctype||(d=c(d,a.args[1].name));return d}return[]};t.clrscr$0=function(a,f){"undefined"!==typeof ba&&"undefined"!==typeof ca&&A.clearRect(0,0,ba,ca);return k};t.repaint$0=function(a,f){e();return k};t.screenbounds$0=function(a,f){var c=w.withUsage(h.realVector(y.to(0,
0)),"Point"),b=w.withUsage(h.realVector(y.to(ba,0)),"Point"),d=w.withUsage(h.realVector(y.to(ba,ca)),"Point"),e=w.withUsage(h.realVector(y.to(0,ca)),"Point");return h.turnIntoCSList([c,b,d,e])};t.createimage$3=function(a,f){var c=z(a[0]),b=B(a[1]),d=B(a[2]);if("number"!==b.ctype||"number"!==d.ctype||"string"!==c.ctype)return k;var h=document.createElement("canvas");h.id=c.value;h.width=b.value.real;h.height=d.value.real;h.style.display="none";document.body.appendChild(h);db[c.value]=fa(h,!1);return k};
t.clearimage$1=function(a,f){var c=z(a[0]);if("string"!==c.ctype&&"image"!==c.ctype)return k;c=Ja(c);if(!c)return k;var b=c.img;if("undefined"===typeof b||null===b)return k;var d=c.width,h=c.height;b.getContext("2d").clearRect(0,0,d,h);c.generation++;return k};t.canvas$4=function(a,f){var c=B(a[0]),b=B(a[1]),d=z(a[2]),h=a[3],e=D.extractPoint(c),g=D.extractPoint(b);if(!e.ok||!g.ok||"string"!==d.ctype&&"image"!==d.ctype)return k;d=Ja(d);if(!d||!d.img.getContext)return k;var b=d.img,l=d.width,c=d.height,
m=g.x-e.x,n=g.y-e.y,q=e.x-n*c/l,r=e.y+m*c/l,n=g.x-n*c/l,m=g.y+m*c/l,g=y.from(e.x,e.y,1),q=y.from(q,r,1),n=y.from(n,m,1),e=g[0],r=g[1],m=q[0],t=q[1],u=n[0],v=n[1],q=l*(r-t)/((e-m)*(r-v)-(e-u)*(r-t)),l=l*(e-m)/((r-t)*(e-u)-(r-v)*(e-m)),n=-q*e-l*r,g=(c*(r-v)-c*(r-t))/((e-m)*(r-v)-(e-u)*(r-t)),m=(c*(e-u)-c*(e-m))/((r-t)*(e-u)-(r-v)*(e-m)),c=c-g*e-m*r,b=b.getContext("2d"),e=A;A=b;A.save();A.transform(q,g,l,m,n,c);d.generation++;z(h);A.restore();A=e};t.canvas$5=function(a,f){var c=B(a[0]),b=B(a[1]),d=B(a[2]),
e=z(a[3]),h=a[4],c=D.extractPoint(c),g=D.extractPoint(b),l=D.extractPoint(d);if(!c.ok||!g.ok||!l.ok||"string"!==e.ctype&&"image"!==e.ctype)return k;e=Ja(e);if(!e||!e.img.getContext)return k;var d=e.img,m=e.width,b=e.height,n=y.from(c.x,c.y,1),q=y.from(g.x,g.y,1),g=y.from(l.x,l.y,1),c=n[0],l=n[1],r=q[0],t=q[1],u=g[0],v=g[1],g=((0-m)*(l-v)-0*(l-t))/((c-r)*(l-v)-(c-u)*(l-t)),m=((0-m)*(c-u)-0*(c-r))/((l-t)*(c-u)-(l-v)*(c-r)),q=0-g*c-m*l,n=((b-b)*(l-v)-(b-0)*(l-t))/((c-r)*(l-v)-(c-u)*(l-t)),r=((b-b)*(c-
u)-(b-0)*(c-r))/((l-t)*(c-u)-(l-v)*(c-r)),b=b-n*c-r*l,d=d.getContext("2d"),c=A;A=d;A.save();A.transform(g,n,m,r,q,b);e.generation++;z(h);A.restore();A=c};t.screenresolution$0=function(a,f){return l.real(y.drawingstate.matrix.a)};t.layer$1=function(a,f){};t.imagesize$1=function(a,f){var c=Ja(B(a[0]));return c?h.realVector([+c.width,+c.height]):k};t.imageready$1=function(a,f){var c=Ja(B(a[0]));return w.bool(!(!c||!c.ready))};t.drawimage$2=function(a,f){function c(){var a=1,c=1,b=1,e=1,g=0,p=1,m=D.extractPoint(d);
if(!m.ok)return k;l=Ja(l);if(!l)return k;A.save();var n;void 0!==f.angle&&(n=z(f.angle),"number"===n.ctype&&(g=n.value.real));void 0!==f.rotation&&(n=z(f.rotation),"number"===n.ctype&&(g=n.value.real));void 0!==f.scale&&(n=B(f.scale),"number"===n.ctype&&(c=a=n.value.real),h.isNumberVector(n).value&&2===n.value.length&&(a=n.value[0].value.real,c=n.value[1].value.real));void 0!==f.scalex&&(n=z(f.scalex),"number"===n.ctype&&(a=n.value.real));void 0!==f.scaley&&(n=z(f.scaley),"number"===n.ctype&&(c=n.value.real));
void 0!==f.flipx&&(n=z(f.flipx),"boolean"===n.ctype&&n.value&&(b=-1));void 0!==f.flipy&&(n=z(f.flipy),"boolean"===n.ctype&&n.value&&(e=-1));void 0!==f.alpha&&(n=z(f.alpha),"number"===n.ctype&&(p=n.value.real));var q=y.drawingstate.matrix,r=y.drawingstate.initialmatrix,qa=l.width,t=l.height;n=m.x*q.a-m.y*q.b+q.tx;var u=m.x*q.c-m.y*q.d-q.ty,v=(m.x+1)*q.a-m.y*q.b+q.tx-n,q=(m.x+1)*q.c-m.y*q.d-q.ty-u,wb=(m.x+1)*r.a-m.y*r.b+r.tx-(m.x*r.a-m.y*r.b+r.tx),r=(m.x+1)*r.c-m.y*r.d-r.ty-(m.x*r.c-m.y*r.d-r.ty),m=
Math.sqrt(v*v+q*q)/Math.sqrt(wb*wb+r*r),v=-Math.atan2(v,q)+Math.atan2(wb,r),q=y.drawingstate.matrix.sdet/72,a=a*q,c=c*q;1!==p&&(A.globalAlpha=p);A.translate(n,u);A.scale(a*b*m,c*e*m);A.rotate(g+v);A.translate(-n,-u);A.translate(-qa/2,-t/2);a=l;a.drawTo?a.drawTo(A,n,u):A.drawImage(a.img,n,u);A.globalAlpha=1;A.restore()}function b(){var a=1,c=1,h=1,p=1,m=D.extractPoint(d),n=D.extractPoint(e),q;if(!m.ok||!n.ok)return k;l=Ja(l);if(!l)return k;var r=l.width,t=l.height;if(0===g)q={},q.x=m.x-(n.y-m.y),q.y=
m.y+(n.x-m.x),p=t/r;else if(q=D.extractPoint(g),!m.ok)return k;A.save();var u;void 0!==f.alpha&&(u=z(f.alpha),"number"===u.ctype&&(a=u.value.real));void 0!==f.aspect&&(u=z(f.aspect),"number"===u.ctype&&(p=u.value.real));void 0!==f.flipx&&(u=z(f.flipx),"boolean"===u.ctype&&u.value&&(c=-1));void 0!==f.flipy&&(u=z(f.flipy),"boolean"===u.ctype&&u.value&&(h=-1));u=y.drawingstate.matrix;1!==a&&(A.globalAlpha=a);a=m.x*u.a-m.y*u.b+u.tx;m=m.x*u.c-m.y*u.d-u.ty;A.transform(n.x*u.a-n.y*u.b+u.tx-a,n.x*u.c-n.y*
u.d-u.ty-m,q.x*u.a-q.y*u.b+u.tx-a,q.x*u.c-q.y*u.d-u.ty-m,a,m);A.scale(1/r,-1/t*p);A.translate(r/2,-t/2);A.scale(c,h);A.translate(-r/2,t/2);A.translate(0,-t);c=l;c.drawTo?c.drawTo(A,0,0):A.drawImage(c.img,0,0);A.globalAlpha=1;A.restore()}var d,e,g,l;return 2===a.length?(d=B(a[0]),l=B(a[1]),c()):3===a.length?(d=B(a[0]),e=B(a[1]),g=0,l=B(a[2]),b()):4===a.length?(d=B(a[0]),e=B(a[1]),g=B(a[2]),l=B(a[3]),b()):k};t.drawimage$3=t.drawimage$2;t.drawimage$4=t.drawimage$2;t.allimages$0=function(){var a=[];Object.keys(db).forEach(function(f){a.push({ctype:"string",
value:f})});return h.turnIntoCSList(a)};t.cameravideo$0=function(a,f){function c(a){return{video:{width:a,advanced:[{width:{max:a,min:a}},{width:{ideal:a}}]},audio:!1}}var b=!0,d={};if(void 0!==f.resolution){var e=z(f.resolution);"string"===e.ctype&&"maximal"===e.value?b=!0:"number"===e.ctype?(b=!1,d=c(e.value.real)):h._helper.isNumberVecN(e,2)&&(b=!1,d=c(e.value[0].value.real),e=e.value[1].value.real,10>e||!Number.isInteger(e)?(d.video.aspectRatio=e,d.video.advanced[0].aspectRatio={min:e,max:e},
d.video.advanced[1].aspectRatio={ideal:e}):(d.video.height=e,d.video.advanced[0].height={min:e,max:e},d.video.advanced[1].height={ideal:e}))}b&&(d=[320,640,1024,1280,1920,2560],d=d.map(function(a){return{width:{min:a}}}),d={video:{width:16E3,height:9E3,advanced:d},audio:!1});var b=null,g=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia;g?b=function(a,c){navigator.mediaDevices.getUserMedia(d).then(a,c)}:(g=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||
navigator.msGetUserMedia)&&(b=function(a,c){g.call(navigator,d,a,c)});if(!b)return console.warn("getUserMedia call not supported"),k;var l=document.createElement("video");l.autoplay=!0;e=fa(l,!0);console.log("Opening stream.");b(function(a){l.srcObject=a;l.setAttribute("autoplay","");l.setAttribute("muted","");l.setAttribute("playsinline","");l.play();l.addEventListener("loadeddata",L)},function(a){console.error("Could not get user video:",String(a),a)});return e};t.playvideo$1=function(a,b){var c=
Ja(B(a[0]));c.live&&c.img.play&&c.img.play();return k};t.pausevideo$1=function(a,b){var c=Ja(B(a[0]));c.live&&c.img.pause&&c.img.pause();return k};var Mb;t.imagergba$3=function(a,b){var c=Ja(B(a[0])),d=B(a[1]),e=B(a[2]);if(!c||"number"!==d.ctype||"number"!==e.ctype||!c.ready)return k;d=Math.round(d.value.real);e=Math.round(e.value.real);if(!Ia(d)||!Ia(e))return k;c=pb(c,d,e,1,1);return h.realVector([255*c[0],255*c[1],255*c[2],c[3]])};t.imagergb$3=t.imagergba$3;t.imagergba$4=function(a,b){var c=Ja(B(a[2]));
if(!c||!c.ready)return k;var d=c.width,e=c.height,g=K(a[0]),l=K(a[1]),m=K(h.realVector([0,e,1])),d=K(h.realVector([d,e,1]));if(g===k||l===k||n===k)return k;var n=h.ii,e=h.jj,m=D.basismap(m,d,n,e),g=D.basismap(g,l,e,n),n=K(a[3]);var q=D.extractPoint(w.mult(m,w.mult(h.adjoint3(g),n)));if(q.ok){var l=c.width,m=c.height,n=!0,r=!1;void 0!==b.interpolate&&(g=z(b.interpolate),"boolean"===g.ctype&&(n=g.value));void 0!==b.repeat&&(g=z(b.repeat),"boolean"===g.ctype&&(r=g.value));n&&(q.x-=.5,q.y-=.5);r&&(q.x=
(q.x%l+l)%l,q.y=(q.y%m+m)%m);d=Math.floor(q.x);e=Math.floor(q.y);if(Ia(d)&&Ia(e)){g=[0,0,0,0];if(n){var n=q.x-d,q=q.y-e,u=pb(c,d,e,2,2);if(r){if(d===l-1||e===m-1)var r=pb(c,(d+1)%l,e,1,1),t=pb(c,d,(e+1)%m,1,1),c=pb(c,(d+1)%l,(e+1)%m,1,1),u=u.slice(0,4).concat(r,t,c)}else{if(-1===d||d===l-1)n=Math.round(n);if(-1===e||e===m-1)q=Math.round(q)}for(c=0;4>c;c++)g[c]=(1-q)*((1-n)*u[c]+n*u[c+4])+q*((1-n)*u[c+8]+n*u[c+12])}else g=pb(c,d,e,1,1);c=h.realVector(g)}else c=k}else c=k;return c};t.imagergb$4=function(a,
b){var c=t.imagergba$4(a,b);return c===k?k:h.turnIntoCSList(c.value.slice(0,3))};t.readpixels$1=function(a,b){for(var c=Ja(B(a[0])),c=pb(c,0,0,c.width,c.height),d=[],e=0;e+3<c.length;e+=4)d.push(h.turnIntoCSList([l.real(c[e+0]),l.real(c[e+1]),l.real(c[e+2]),l.real(c[e+3])]));return h.turnIntoCSList(d)};"use strict";var Ae=[{key:[":"],field:["."],deg:["\u00b0"],take:["_"]},{functionCall:!0},{rassoc:!0,pow:["^"],sqrt:["\u221a"]},{mul:["*","\u2062","\u22c5","\u00b7"],cross:["\u00d7"],div:["/","\u00f7",
"\u2215","\u2236"]},{add:["+"],sub:["-","\u2212"],neg:["!","\u00ac"]},{seq:[".."]},{eq:["==","\u225f"],ne:["!=","<>","\u2260"],lt:["<"],gt:[">"],le:["<=","\u2264","\u2266"],ge:[">=","\u2265","\u2267"],aeq:["~=","\u2248"],ane:["~!=","\u2249"],alt:["~<","\u2a89"],agt:["~>","\u2a8a"],ale:["~<=","\u2a85"],age:["~>=","\u2a86"],"in":["\u2208"],nin:["\u2209"]},{and:["&","\u2227"],or:["%","\u2228"]},{rassoc:!0,prepend:["<:"]},{concat:["++","\u222a"],remove:["--","\u2216"],common:["~~","\u2229"],append:[":>"]},
{rassoc:!0,assign:["="],define:[":="],undefine:[":=_"],bdefine:["::="]},{seq:[";"]},{modif:["->","\u2192"]},{rassoc:!0,list:[","]}],Be=["+","-"],Ce=["!","\u221a"],De=["\u00b0",":=_"],Ee=[";",","],Nc=[],Ca={},od;(function(){var a=0;Ae.forEach(function(b){a+=2;var c=!!b.rassoc;b.functionCall&&(od=a);for(var d in b){var e=b[d];if("boolean"!==typeof e)for(var h={name:d,sym:e[0],symbols:e,rassoc:c,precedence:a,prefix:!1,postfix:!1,infix:!0,bare:!1},g=0;g<e.length;++g){var l=e[g];if(Ca.hasOwnProperty(l))throw Error("Duplicate operator: "+
l);Ca[l]=h;Nc.push(l)}}});Be.forEach(function(a){Ca[a].prefix=!0});Ce.forEach(function(a){Ca[a].prefix=!0;Ca[a].infix=!1});De.forEach(function(a){Ca[a].postfix=!0;Ca[a].infix=!1});Ee.forEach(function(a){Ca[a].prefix=!0;Ca[a].postfix=!0;Ca[a].infix=!0;Ca[a].bare=!0})})();Nc.sort(function(a,b){return b.length-a.length});var Fe="(?:[0-9](?: [0-9])*(?: \\.(?! \\.)(?: [0-9])*)?|\\.(?: [0-9])+)(?: [Ee](?: [+-])?(?: [0-9])+)?".replace(/ /g,"[ \t]*"),Ge="(?:[\u207a\u207b] )?[\u2070\u00b9\u00b2\u00b3\u2074\u2075\u2076\u2077\u2078\u2079](?: [\u2070\u00b9\u00b2\u00b3\u2074\u2075\u2076\u2077\u2078\u2079])*".replace(/ /g,
"[ \t]*"),He="(?:[\u208a\u208b] )?[\u2080\u2081\u2082\u2083\u2084\u2085\u2086\u2087\u2088\u2089](?: [\u2080\u2081\u2082\u2083\u2084\u2085\u2086\u2087\u2088\u2089])*".replace(/ /g,"[ \t]*"),Oc=function(a,b,c){var d,e,h=0,g="(?:[",l=b.length;for(d=0;d<l;++d)e=b.charCodeAt(d),55296<=e?(g+="]|"+b.charAt(d)+"[",h=56320):(g+=String.fromCharCode(e=h=a[e-32]+h),h+=a[b.charCodeAt(++d)-32],h!==e&&(h!==e+1&&(g+="-"),g+=String.fromCharCode(h)));return g+"]|["+c+"][\udc00-\udfff])"}([2,0,106,3,4,1,6,5,7,11,17,
8,12,21,9,22,30,10,15,24,25,16,13,42,46,14,18,19,29,37,27,28,35,26,32,36,40,43,47,53,20,48,50,56,33,34,39,51,52,55,63,64,65,68,85,23,31,38,45,49,105,59,66,69,72,88,102,114,117,128,157,191,41,44,54,60,67,70,71,73,74,75,76,80,81,82,83,84,86,87,89,93,94,98,99,107,108,116,122,130,132,134,138,160,165,185,195,196,255,268,277,310,332,339,362,365,390,449,457,470,512,513,541,568,582,619,673,726,768,820,921,991,1164,2684,6581,8453,11171,20949],"T4(4I!)!'!&/ 0 \u0096')2$+! !\u0083$ %## !(!   ! ; u \u0086.\u0088 =#!+YoA& 87C% } !5%+%) #!*! <0a,!4B1%'!&-'!1!$!33`HsG$!;!+.52'(#%#- & !$#$!*!9%  2%H''%#- & % % %B# !H *+   - & % $$!;!5%3!,(#%#- & % $$!X%  5!:! '$  #$% ! %$%$ $)W!G(   / 2$!> &%C(   / . $$!L! %5%;(   D#!*!* 4'&*$W + !#&]F %6&]% !#% !#!(# &   ! !#% # %1!#$ !/#L!S( @?$\u00817-!*''#$!$%+ ',6!:= !&!#7 \u0090 ##& ! ##D ##B ##& ! ##9 K ##^Y2*V#'$\u009d#5 4&p((+, #2*2*2,  5OC!'!Uy.D !&_)0J<#$,E'4Q/1Pv!|8:&K<9%)E>@7 )@\u0080# #$%1gT\u008e#'#=#'#( ! ! ! 0#P & !$  &$##'',&  &d!9!*,b!'!#. !$$(! ! ! # 1##&$'!G%\u00a58 8 \u0084(#$%6= !&!#Q+!*/1& & & & & & & &t!\u0097%E$&%'V(  z #&D${:Aj2\u0099\u00a6q\u00a9E\u00a4UZ#\u008d$2)%-8*0#_J+#b#M#(S1   # /0O2[R'$! !6>)/A?+8<!*$ .)$ D3  (-/$!$[ !$%#$#! !4 #1+ 6'#'#'1& & 7 .)c0\u00a86/'I\u00a7\u0093#\\N&6$&! . , $ ! % % \u007fM\u0092;R#Gh)d$ \u0085=4(4,a$'#'#'# \ud800!) 4 : % 9#6@\u0082\u0094?$IIX*5 ((=)<#@'(\ud801!f~N.Of\u008f1-)(\ud802!'#! E %$!#/)/10^: %)-)4nQ(%T!5#   AZ?$?C( >?G)-):9*\ud803!`KJ9J\ud804#PriL3>@7M$!6F2#/! !C* 3V& ! # 9 .+8N(#%#- & % $$!;!6$\ud805eF-% !\u008987#=F-!k7x4\ud806\u0087RB!\u0095K\ud808!\u00a2\ud809e\u008a\ud80d!8\ud811!\u009c\ud81a!\u009b+0c<;F*#BH&:\ud81b\u00a0U,!l,\ud82c!%\ud82f!\"&,$++.\ud835!w m %#!#%## ) ! & S ##( & > # $ !$& \u0091#3 3 0 3 0 3 0 3 0 3 (\ud83a!\u008b\ud83b\u0098# A % !#! . # ! !(!'! ! !   % !#! ! ! ! ! % !## & # # ! . 5&  $ 5\ud869!\u009f7\u008c\ud86d!\u00a1,g\ud86e!<#\u00a3\ud873!\u009e\ud87e!\u009a",
"\ud80c\ud840-\ud868\ud86a-\ud86c\ud86f-\ud872"),Ie=("#(?: [1-9])?|(?:'|"+Oc+")(?: (?:[0-9']|"+Oc+"))*").replace(/ /g,"[ \t]*"),ld=["([ \t\n]+)|(//.*)|(/\\*)","("+Fe+")","("+Nc.map(kd).join("|")+")","("+"[](){}||".split("").map(kd).join("|")+")","("+He+")","("+Ge+")","("+Ie+")",'("[^"]*")|($)'].join("|"),Je=new RegExp("[ \t]*".replace(/\*$/,"+"),"g"),Pc="ANY WS COMMENT START_COMMENT NUM OP BRA SUB SUP ID STR EOF".split(" ");(function(){var a=(new RegExp(ld,"g")).exec("");if(a.hasOwnProperty(Pc.length))throw Error("RE has more groups than expected");
if(!a.hasOwnProperty(Pc.length-1))throw Error("RE has fewer groups than expected");})();qb.prototype.advanceBy=function(a){this.advanceTo(this.pos+a)};qb.prototype.advanceTo=function(a){for(this.pos=a;this.bols[0]<=a;)this.bol=this.bols.shift(),this.line++};qb.prototype.curPos=function(){return{row:this.line,col:this.pos-this.bol,pos:this.pos}};qb.prototype.nextInternal=function(){var a=this.re.exec(this.input);if(a.index!==this.pos)throw ka("Invalid token",this.curPos(),this.input.substring(this.pos,
a.index));var b=this.curPos();this.advanceBy(a[0].length);var c=this.curPos(),d;for(d=1;null==a[d];++d);return{start:b,end:c,raw:a[0],text:a[0].replace(Je,""),toktype:Pc[d]}};qb.prototype.next=function(){var a;do if(a=this.nextInternal(),"START_COMMENT"===a.toktype){var b=/\*\/|\/\*/g;b.lastIndex=a.start.pos+2;for(var c=1,d;0<c;)if(d=b.exec(this.input))"/*"===d[0]?++c:--c;else throw ka("Unterminated comment",a.start,a.text);this.re.lastIndex=b.lastIndex;this.advanceTo(b.lastIndex);a.end=this.curPos();
a.raw=this.input.substring(a.start.pos,a.end.pos);a.text=a.raw;a.toktype="COMMENT"}while("WS"===a.toktype||"COMMENT"===a.toktype);return a};var Ke={ctype:"void"};Nb.prototype.postprocess=function(a){if(null===a)return Ke;if(a){if("infix"===a.ctype)if(":="===a.oper){var b=a.args[0];if("function"===b.ctype)b.args.forEach(function(c){if(null===c||"variable"!==c.ctype)throw ka("Function argument must be an identifier",c.start||a.start);});else if("variable"!==b.ctype)throw ka(a.oper+" can only be used to define functions or variables",
a.start);}else if(","===a.oper)throw ka("comma may only be used to delimit list elements",a.start);a.args&&(a.args=a.args.map(this.postprocess,this));if(a.modifs)for(var c in a.modifs)a.modifs[c]=this.postprocess(a.modifs[c]);if("paren"===a.ctype)return a.args[0];if("infix"===a.ctype){if("."===a.oper){if(!a.args[1]||"variable"!==a.args[1].ctype)throw ka("Field name must be identifier",a.start,a.text);a.ctype="field";a.obj=a.args[0];a.key=a.args[1].name;delete a.args}if(":"===a.oper){if(!a.args[1])throw ka("Data key undefined",
a.start,a.text);a.ctype="userdata";a.obj=a.args[0];a.key=a.args[1];delete a.args}this.infixmap&&(a.impl=this.infixmap[a.oper])}else"variable"===a.ctype?this.usedVariables[a.name]=!0:"function"===a.ctype&&(this.usedFunctions[a.oper]=!0)}if("infix"===a.ctype)return{ctype:"infix",oper:String(a.oper),args:[a.args[0],a.args[1]],impl:a.impl};if("variable"===a.ctype)return{ctype:"variable",name:String(a.name)};if("number"===a.ctype)return{ctype:"number",value:{real:+a.value.real,imag:+a.value.imag}};if("string"===
a.ctype)return{ctype:"string",value:String(a.value)};if("list"===a.ctype)return{ctype:"list",value:a.value};if("function"===a.ctype)return{ctype:"function",oper:String(a.oper),args:a.args,modifs:a.modifs};if("field"===a.ctype)return{ctype:"field",obj:a.obj,key:String(a.key)};if("userdata"===a.ctype)return{ctype:"userdata",obj:a.obj,key:a.key};throw Error("Unsupported AST node of type "+a.ctype);};Nb.prototype.parse=function(a){try{var b=nd(new qb(a));if("EOF"!==b.closedBy.toktype)throw ka("Closing bracket never opened.",
b.closedBy.start,b.closedBy.text);return this.postprocess(b.expr)}catch(c){return c.ctype="error",c}};"undefined"!==typeof process&&"undefined"!==typeof module&&"undefined"!==typeof module.exports&&"undefined"===typeof window&&(module.exports.Parser=Nb,module.exports.Tokenizer=qb,module.exports.unicodeLetters=Oc,module.exports.parse=function(a){return(new Nb).parse(a)});var jb={},Ob=[],Qc;Qc=[0,0,0,0,0,0,0,0,0,0,0,0];t.playsin$1=function(a,b){var c=B(a[0]),d=0;if("number"===c.ctype){var e;void 0!==
b.line&&(e=z(b.line),"number"===e.ctype&&(d=Math.floor(e.value.real),0>d&&(d=0),10<d&&(d=10)));c=c.value.real;0!==Qc[d]&&Qc[d].set({freq:c})}return k};var P={printArr:function(a){for(var b=a.value.length,c=[],d=[],e=!1,h=0;h<b;h++)c[h]=a.value[h].value.real,d[h]=a.value[h].value.imag,0!==d[h]&&(e=!0);console.log(c);e&&console.log(d)},zero:function(a){for(var b=[],c=l.real(0),d=0;d<a.value.real;d++)b[d]=c;return h.turnIntoCSList(b)},number:function(a,b){var c=P.zero(b);c.value[0]=a;return c},variable:function(a,
b){var c=P.zero(b);c.value[0]=a;c.value[1]=l.real(1);return c},add:function(a,b){return h.add(a,b)},sub:function(a,b){return h.sub(a,b)},mult:function(a,b){if(a.value.length!==b.value.length)return console.error("dims don't fit return nada"),k;for(var c=a.value.length,d=P.zero(l.real(c)),e=l.real(0),h=0;h<c;h++){for(var g=0;g<=h;g++)e=l.add(e,l.mult(a.value[g],b.value[h-g]));d.value[h]=e;e=l.real(0)}return d},pow:function(a,b){if(0>b.value.real||b.value.real!==Math.floor(b.value.real))return P.root(a,
b);for(var c=a,d=1;d<b.value.real;d++)c=P.mult(c,a);return c},root:function(a,b){var c=l.real(0),d=l.real(1),e=l.add(d,b),h=a.value.length,g=P.zero(l.real(h));g.value[0]=l.pow(a.value[0],b);for(var k=c,m,n,q=1;q<h;q++){n=l.real(q);for(var r=1;r<=q;r++)m=l.mult(e,l.real(r)),m=l.div(m,n),m=l.sub(m,d),m=l.mult(m,a.value[r]),m=l.mult(m,g.value[q-r]),k=l.add(k,m);k=l.div(k,a.value[0]);g.value[q]=k;k=c}return g},findFirstNoneZero:function(a,b,c){for(var d=Infinity,e=Infinity,h=c;h<a.value.length;h++)if(1E-12<
l.abs2(a.value[h]).value.real){d=h;break}for(a=c;a<b.value.length;a++)if(1E-12<l.abs2(b.value[a]).value.real){e=a;break}return[d,e]},div:function(a,b){if(a.value.length!==b.value.length)return console.log("dims don't fit - return nada"),k;for(var c=a.value.length,d=l.real(0),e=P.zero(l.real(c)),h=d,g,m=0;m<c;m++){g=P.findFirstNoneZero(a,b,m);m<g[0]&&g[0]===g[1]&&Infinity!==g[0]&&(a.value.splice(m,g[0]),b.value.splice(m,g[0]),e.value.splice(m,g[0]),c-=g[0]);g=a.value[m];for(var n=0;n<m;n++)h=l.add(h,
l.mult(e.value[n],b.value[m-n]));g=l.sub(g,h);g=l.div(g,b.value[0]);e.value[m]=g;h=d}return e},exp:function(a){var b=l.real(0),c=a.value.length,d=P.zero(l.real(c)),e=b,h;d.value[0]=l.exp(a.value[0]);for(var g=1;g<c;g++){for(var k=1;k<=g;k++)h=l.mult(l.real(k),a.value[k]),h=l.mult(h,d.value[g-k]),e=l.add(e,h);d.value[g]=l.div(e,l.real(g));e=b}return d},log:function(a){var b=l.real(0),c=a.value.length,d=P.zero(l.real(c));d.value[0]=l.log(a.value[0]);for(var e=b,h,g,k=1;k<c;k++){h=a.value[k];for(var m=
1;m<k;m++)g=l.mult(l.real(m),d.value[m]),g=l.mult(g,a.value[k-m]),e=l.add(e,g);e=l.div(e,l.real(k));h=l.sub(h,e);h=l.div(h,a.value[0]);d.value[k]=h;e=b}return d},sincos:function(a){var b=l.real(0),c=a.value.length,d=P.zero(l.real(c)),e=P.zero(l.real(c));d.value[0]=l.sin(a.value[0]);e.value[0]=l.cos(a.value[0]);for(var h=b,g=b,k,m,n,q=1;q<c;q++){n=l.real(q);for(var r=1;r<=q;r++)m=l.mult(l.real(r),a.value[r]),k=l.mult(m,e.value[q-r]),m=l.mult(m,d.value[q-r]),g=l.add(g,k),h=l.add(h,m);g=l.div(g,n);h=
l.div(h,l.neg(n));d.value[q]=g;e.value[q]=h;h=g=b}P.sinsave=d;P.cossave=e;return[d,e]},sin:function(a){return P.sincos(a)[0]},cos:function(a){return P.sincos(a)[1]},faculty:function(a){var b=[];b[0]=l.real(1);for(var c=1,d=1;d<=a.value.real;d++)c*=d,b[d]=l.real(c);return b=h.turnIntoCSList(b)},diff:function(a,b,c,d){var e;if("variable"===a.ctype)e=a.name!==b?P.number(z(a),d):P.variable(c,d);else if("number"===a.ctype)e=P.number(a,d);else{if("infix"===a.ctype){if("*"===a.oper)return P.mult(P.diff(a.args[0],
b,c,d),P.diff(a.args[1],b,c,d));if("^"===a.oper)return P.pow(P.diff(a.args[0],b,c,d),P.diff(a.args[1],b,c,d).value[0]);if("/"===a.oper)return P.div(P.diff(a.args[0],b,c,d),P.diff(a.args[1],b,c,d));if("+"===a.oper)return P.add(P.diff(a.args[0],b,c,d),P.diff(a.args[1],b,c,d));if("-"===a.oper)return P.sub(P.diff(a.args[0],b,c,d),P.diff(a.args[1],b,c,d));console.log("infix not found",a.oper);return k}if("function"===a.ctype){if("exp$1"===a.oper)return P.exp(P.diff(a.args[0],b,c,d));if("log$1"===a.oper)return P.log(P.diff(a.args[0],
b,c,d));if("sin$1"===a.oper)return P.sin(P.diff(a.args[0],b,c,d));if("cos$1"===a.oper)return P.cos(P.diff(a.args[0],b,c,d))}else return console.log("ctype not found",a.ctype),k}return e},adevaluate:function(a,b,c,d){a=P.diff(a,b,c,d);d=P.faculty(d);for(b=2;b<a.value.length;b++)a.value[b]=l.mult(a.value[b],d.value[b]);return a},autodiff:function(a,b,c,d){for(var e=[],g=c.value.length,l,k=0;k<g;k++)l=P.adevaluate(a,b,c.value[k],d),e[k]=l;return e=h.turnIntoCSList(e)}},x={handleModifs:function(a,b){x.dashing&&
x.unSetDash();x.colorraw=null;x.fillcolorraw=null;x.fillrule="nonzero";x.size=null;0>=x.psize&&(x.psize=0);0>=x.lsize&&(x.lsize=0);x.overhang=1;x.dashing=!1;x.isArrow=!1;x.arrowSides="==>";x.arrowposition=1;x.headlen=10;x.arrowShape=x.arrowShapes.line;x.alpha=y.drawingstate.alpha;x.fillalpha=0;x.bold="";x.italics="";x.family="sans-serif";x.align=0;x.xOffset=0;x.yOffset=0;x.lineCap="round";x.lineJoin="round";x.miterLimit=10;x.noborder=!1;var c,d;for(c in a){var e=a[c];e&&((d=b[c])?(!0===d&&(d=x.modifHandlers[c]),
d(z(e))):console.log("Modifier not supported: "+c))}null!==x.size?x.psize=x.lsize=x.size:(x.psize=y.drawingstate.pointsize,x.lsize=y.drawingstate.linesize);x.dashing&&x.dashing(x.lsize);null!==x.colorraw?x.pointColor=x.lineColor=x.textColor=x.makeColor(x.colorraw):1===x.alpha?(x.pointColor=y.drawingstate.pointcolor,x.lineColor=y.drawingstate.linecolor,x.textColor=y.drawingstate.textcolor):(x.pointColor=x.makeColor(y.drawingstate.pointcolorraw),x.lineColor=x.makeColor(y.drawingstate.linecolorraw),
x.textColor=x.makeColor(y.drawingstate.textcolorraw));x.black=1===x.alpha?"rgb(0,0,0)":"rgba(0,0,0,"+x.alpha+")";x.fillColor=x.fillcolorraw&&0<x.fillalpha?x.makeColor(x.fillcolorraw,x.fillalpha):null},modifHandlers:{size:function(a){"number"===a.ctype&&(x.size=a.value.real,0>x.size&&(x.size=0),1E3<x.size&&(x.size=1E3))},color:function(a){h.isNumberVector(a).value&&3===a.value.length&&(x.colorraw=[a.value[0].value.real,a.value[1].value.real,a.value[2].value.real])},fillcolor:function(a){h.isNumberVector(a).value&&
3===a.value.length&&(x.fillcolorraw=[a.value[0].value.real,a.value[1].value.real,a.value[2].value.real])},alpha:function(a){"number"===a.ctype&&(x.alpha=a.value.real)},fillalpha:function(a){"number"===a.ctype&&(x.fillalpha=a.value.real)},dashpattern:function(a){if("list"===a.ctype){for(var b=[],c=0,d=0;c<a.value.length;c++)"number"===a.value[c].ctype&&(b[d++]=a.value[c].value.real);x.dashing=x.setDash.bind(null,b)}},dashtype:function(a){if("number"===a.ctype)a=Math.floor(a.value.real);else if("string"===
a.ctype)a=a.value;else return;if(a=x.dashTypes[a])x.dashing=x.setDash.bind(null,a)},dashing:function(a){"number"===a.ctype&&(a=Math.floor(a.value.real),x.dashing=x.setDash.bind(null,[2*a,a]))},overhang:function(a){"number"===a.ctype&&(x.overhang=x.overhang*a.value.real+(1-x.overhang)*(1-a.value.real))},arrow:function(a){"boolean"===a.ctype?x.isArrow=a.value:console.error("arrow needs to be of type boolean")},arrowshape:function(a){"string"!==a.ctype?console.error("arrowshape needs to be of type string"):
x.arrowShapes.hasOwnProperty(a.value)?(x.arrowShape=x.arrowShapes[a.value],x.isArrow=!0,x.arrowShape.deprecated&&(console.log("arrowshape "+a.value+" is deprecated, use "+x.arrowShape.deprecated+" instead."),x.arrowShape.deprecated=null)):(a=Object.keys(x.arrowShapes),a.sort(),a=a.join(", "),console.error("arrowshape needs to be one of "+a))},arrowsides:function(a){"string"!==a.ctype?console.error("arrowsides is not of type string"):"==>"!==a.value&&"<==>"!==a.value&&"<=="!==a.value?console.error("arrowsides is unknows"):
(x.arrowSides=a.value,x.isArrow=!0)},arrowposition:function(a){"number"!==a.ctype?console.error("arrowposition is not of type number"):0>a.value.real?console.error("arrowposition has to be positive"):1<a.value.real?x.overhang=x.overhang*a.value.real+(1-x.overhang)*(1-a.value.real):(x.arrowposition=a.value.real,x.isArrow=!0)},arrowsize:function(a){"number"!==a.ctype?console.error("arrowsize is not of type number"):0>a.value.real?console.error("arrowsize has to be positive"):x.headlen*=a.value.real},
bold:function(a){"boolean"===a.ctype&&a.value&&(x.bold="bold ")},italics:function(a){"boolean"===a.ctype&&a.value&&(x.italics="italic ")},family:function(a){"string"===a.ctype&&(x.family=a.value)},align:function(a){"string"===a.ctype&&(a=a.value,"left"===a&&(x.align=0),"right"===a&&(x.align=1),"mid"===a||"center"===a)&&(x.align=.5)},x_offset:function(a){"number"===a.ctype&&(x.xOffset=a.value.real)},y_offset:function(a){"number"===a.ctype&&(x.yOffset=a.value.real)},offset:function(a){"list"===a.ctype&&
2===a.value.length&&"number"===a.value[0].ctype&&"number"===a.value[1].ctype&&(x.xOffset=a.value[0].value.real,x.yOffset=a.value[1].value.real)},lineCap:function(a){"string"!==a.ctype||"round"!==a.value&&"square"!==a.value&&"butt"!==a.value||(x.lineCap=a.value)},lineJoin:function(a){"string"!==a.ctype||"round"!==a.value&&"bevel"!==a.value&&"miter"!==a.value||(x.lineJoin=a.value)},fillrule:function(a){"string"!==a.ctype||"nonzero"!==a.value&&"evenodd"!==a.value||(x.fillrule=a.value)},miterLimit:function(a){"number"===
a.ctype&&0<a.value.real&&(x.miterLimit=Math.round(a.value.real))},noborder:function(a){"boolean"===a.ctype?x.noborder=a.value:console.error("noborder needs to be of type boolean")},border:function(a){"boolean"===a.ctype?x.noborder=!a.value:console.error("border needs to be of type boolean")}},lineModifs:{size:!0,color:!0,alpha:!0,dashpattern:!0,dashtype:!0,dashing:!0,overhang:!0,arrow:!0,arrowshape:!0,arrowsides:!0,arrowposition:!0,arrowsize:!0,lineCap:!0,lineJoin:!0,miterLimit:!0},pointModifs:{size:!0,
color:!0,alpha:!0,noborder:!0,border:!0}};x.pointAndLineModifs=x.lineModifs;x.conicModifs={size:!0,color:!0,alpha:!0,fillcolor:!0,fillrule:!0,fillalpha:!0,lineCap:!0,lineJoin:!0,miterLimit:!0};x.textModifs={size:!0,color:!0,alpha:!0,bold:!0,italics:!0,family:!0,align:!0,x_offset:!0,y_offset:!0,offset:!0};x.makeColor=function(a,b){void 0===b&&(b=x.alpha);return"rgba("+Math.floor(255*a[0])+","+Math.floor(255*a[1])+","+Math.floor(255*a[2])+","+b+")"};x.preDrawCurve=function(){A.lineWidth=x.lsize;A.lineCap=
x.lineCap;A.lineJoin=x.lineJoin;A.mozFillRule=x.fillrule;A.fillrule=x.fillrule;A.miterLimit=x.miterLimit;A.strokeStyle=x.lineColor};x.arrowShapes={"default":{close:!1,fill:!1,ratio:1,deprecated:"line"},line:{close:!1,fill:!1,ratio:1},empty:{close:!0,fill:!1,ratio:1},hollow:{close:!0,fill:!1,ratio:1,deprecated:"empty"},full:{close:!0,fill:!0,ratio:1},jet:{close:!0,fill:!0,ratio:1.5},delta:{close:!0,fill:!0,ratio:1.5,deprecated:"jet"}};x.clipSegment=function(a,b){var c=b.x-a.x,d=b.y-a.y,e=x.clipLineCore(-d,
c,a.x*b.y-b.x*a.y);if(2!==e.length)return[];var h=e[0],e=e[1],g=1/(c*c+d*d),l=((h.x-a.x)*c+(h.y-a.y)*d)*g,c=((e.x-a.x)*c+(e.y-a.y)*d)*g;0>l&&(h=a);1<l&&(h=b);0>c&&(e=a);1<c&&(e=b);return h===e?[]:[h,e]};x.drawsegcore=function(a,b){function c(a,c,b,f){var d=a-f*r+.5*u,e=c-f*u-.5*r,h=a-f*r-.5*u;f=c-f*u+.5*r;A.beginPath();x.arrowShape.fill&&(A.lineWidth=x.lsize/2);A.moveTo(d,e);A.lineTo(a,c);A.lineTo(h,f);x.arrowShape.close&&(A.fillStyle=x.lineColor,A.lineTo(a-b*r,c-b*u),A.closePath(),x.arrowShape.fill&&
A.fill());A.stroke()}var d=y.drawingstate.matrix,e=a.x*d.a-a.y*d.b+d.tx,h=a.x*d.c-a.y*d.d-d.ty,g=b.x*d.a-b.y*d.b+d.tx,l=b.x*d.c-b.y*d.d-d.ty,k=x.overhang,m=1-k,d=k*e+m*g,n=k*h+m*l,q=k*g+m*e,k=k*l+m*h;if(0>d||d>ba||0>n||n>ca||0>q||q>ba||0>k||k>ca){k=x.clipSegment({x:d,y:n},{x:q,y:k});if(2!==k.length||.01>x.lsize)return;d=k[0].x;n=k[0].y;q=k[1].x;k=k[1].y}x.preDrawCurve();if(!x.isArrow||e===h&&g===l).01>x.lsize||(A.beginPath(),A.moveTo(d,n),A.lineTo(q,k),A.stroke());else{var e=g-e,h=l-h,g=x.headlen/
Math.sqrt(e*e+h*h),r=e*g,u=h*g,l=x.arrowposition,m=1-l,h=l*d+m*q,e=l*n+m*k,g=l*q+m*d,l=l*k+m*n,m=x.arrowSides;A.beginPath();x.arrowShape.close?("<==>"===m||"<=="===m?(1>x.arrowposition&&(A.moveTo(d,n),A.lineTo(h,e)),A.moveTo(h+r,e+u)):A.moveTo(d,n),"==>"===m||"<==>"===m?(A.lineTo(g-r,l-u),1>x.arrowposition&&(A.moveTo(g,l),A.lineTo(q,k))):A.lineTo(q,k)):(A.moveTo(d,n),A.lineTo(q,k));A.stroke();"==>"!==m&&"<==>"!==m||c(g,l,1,x.arrowShape.ratio);"<=="!==m&&"<==>"!==m||c(h,e,-1,-x.arrowShape.ratio)}};
x.drawpoint=function(a){var b=y.drawingstate.matrix,c=a.x*b.a-a.y*b.b+b.tx;a=a.x*b.c-a.y*b.d-b.ty;A.lineWidth=.3*x.psize;A.beginPath();A.arc(c,a,x.psize,0,2*Math.PI);A.fillStyle=x.pointColor;A.fill();x.noborder||(A.beginPath(),A.arc(c,a,1.15*x.psize,0,2*Math.PI),A.fillStyle=x.black,A.strokeStyle=x.black,A.stroke())};x.clipLineCore=function(a,b,c){var d=Math.SQRT1_2*x.lsize,e=0-d,h=ba+d,g=0-d,d=ca+d,l=0>e*a+g*b+c,k=0>h*a+g*b+c,m=0>e*a+d*b+c,n=0>h*a+d*b+c,q=[];l!==k&&q.push({x:(-c-b*g)/a,y:g});k!==
n&&q.push({x:h,y:(-c-a*h)/b});m!==n&&q.push({x:(-c-b*d)/a,y:d});l!==m&&q.push({x:e,y:(-c-a*e)/b});return q};x.clipLine=function(a){a=h.normalizeMax(h.productVM(a,y.toMat()));return x.clipLineCore(a.value[0].value.real,a.value[1].value.real,a.value[2].value.real)};x.drawline=function(a){h._helper.isAlmostReal(a)&&(a=x.clipLine(a),2===a.length&&.01<=x.lsize&&(x.preDrawCurve(),A.beginPath(),A.moveTo(a[0].x,a[0].y),A.lineTo(a[1].x,a[1].y),A.stroke()))};x.drawRaySegment=function(a,b){var c=D.extractPoint(a),
d=D.extractPoint(b);if(c.ok&&d.ok){var e=c.x-d.x,h=c.y-d.y,g=25E3/y.drawingstate.matrix.sdet/Math.sqrt(e*e+h*h),e=e*g,h=h*g;x.drawsegcore(c,{x:c.x+e,y:c.y+h});x.drawsegcore(d,{x:d.x-e,y:d.y-h})}};x.dashTypes={solid:[],dashed:[10,10],tightdash:[10,4],dotted:[1,3],dashdot:[10,5,1,5],"dashvalue.solid":[],"dashvalue.dashed":[10,10],"dashvalue.tightdash":[10,4],"dashvalue.dotted":[1,3],"dashvalue.dashdot":[10,5,1,5],0:[],1:[10,10],2:[10,4],3:[1,3],4:[10,5,1,5]};x.setDash=function(a,b){var c=Math.sqrt(b);
a=a.slice();for(var d=0;d<a.length;d++)a[d]*=c;A.webkitLineDash=a;A.setLineDash(a);A.mozDash=a};x.unSetDash=function(){A.webkitLineDash=[];A.setLineDash([]);A.mozDash=[]};pd.prototype={set fillStyle(a){var b=this;cc(a,function(a,d,e,h){b._fill="#"+rb(a.toString(16),2)+rb(d.toString(16),2)+rb(e.toString(16),2);b._fillOpacity=255===h?null:h})},set strokeStyle(a){var b=this;cc(a,function(a,d,e,h){b._stroke="#"+rb(a.toString(16),2)+rb(d.toString(16),2)+rb(e.toString(16),2);b._strokeOpacity=255===h?null:
h})},clearRect:function(){},beginPath:function(){this._path=[]},_pathcmd:function(){this._path.push.apply(this._path,arguments)},closePath:function(){this._pathcmd("Z")},moveTo:function(a,b){this._pathcmd("M",a,b)},lineTo:function(a,b){this._pathcmd("L",a,b)},bezierCurveTo:function(a,b,c,d,e,h){this._pathcmd("C",a,b,c,d,e,h)},quadraticCurveTo:function(a,b,c,d){this._pathcmd("Q",a,b,c,d)},arc:function(a,b,c,d,e,h){var g=c*Math.cos(d)+a,l=c*Math.sin(d)+b,k=c*Math.cos(e)+a,m=c*Math.sin(e)+b;e=h?d-e:
e-d;e>=2*Math.PI?this._pathcmd(this._path.length?"L":"M",g,l,"A",c,c,0,0,h?1:0,a-c*Math.cos(d),b-c*Math.sin(d),"A",c,c,0,0,h?1:0,g,l):this._pathcmd(this._path.length?"L":"M",g,l,"A",c,c,0,e>Math.PI?1:0,h?1:0,k,m)},rect:function(a,b,c,d){this._pathcmd("M",a,b,"h",c,"v",d,"h",-c,"z")},_cmd:function(a){1!==this.globalAlpha?(this._body.push('<g opacity="'+this.globalAlpha+'">'),this._body.push(a),this._body.push("</g>")):this._body.push(a)},_attrs:function(a){var b="",c;for(c in a)null!==a[c]&&(b+=" "+
c+'="'+a[c]+'"');return b},fill:function(){this._cmd("<path"+this._attrs({d:this._path.join(" "),fill:this._fill,"fill-opacity":this._fillOpacity})+"/>")},stroke:function(){this._cmd("<path"+this._attrs({d:this._path.join(" "),stroke:this._stroke,"stroke-opacity":this._strokeOpacity,"stroke-width":this.lineWidth,"stroke-linecap":this.lineCap,"stroke-linejoin":this.lineJoin,"stroke-miterlimit":"miter"===this.lineJoin?this.miterLimit:null})+"/>")},clip:function(){++this._clipIndex;this._body.push('<clipPath id="clip'+
this._clipIndex+'"><path d="'+this._path.join(" ")+'"/></clipPath>','<g clip-path="url(#clip'+this._clipIndex+')">');this._saveStack[this._saveStack.length-1]+="</g>"},save:function(){this._saveStack.push("")},restore:function(){this._body.push(this._saveStack.pop());0===this._saveStack.length&&this._saveStack.push("")},_transform:function(a){this._body.push('<g transform="'+a+'">');this._saveStack[this._saveStack.length-1]+="</g>"},translate:function(a,b){this._transform("translate("+a+" "+b+")")},
rotate:function(a){this._transform("rotate("+Math.PI/180*a+")")},scale:function(a,b){this._transform("scale("+a+" "+b+")")},transform:function(a,b,c,d,e,h){this._transform("matrix("+[a,b,c,d,e,h].join(" ")+")")},drawImage:function(a,b,c){if(3!==arguments.length)throw Error("SvgWriterContext only supports 3-argument version of drawImage");var d=this._imgcache.indexOf(a);if(-1===d){var d=this._imgcache.length,e;e=a.cachedDataURL?a.cachedDataURL:rd(a);this._defs.push('<image id="img'+d+'" x="0" y="0" width="'+
a.width+'" height="'+a.height+'" xlink:href="'+e+'"/>');this._imgcache.push(a)}this._cmd('<use x="'+b+'" y="'+c+'" xlink:href="#img'+d+'"/>')},toBlob:function(){for(;1<this._saveStack.length||""!==this._saveStack[0];)this.restore();var a='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="'+this.width+'px" height="'+this.height+'px">\n'+this._defs.join("\n")+'\n</defs>\n<g stroke="none" fill="none">\n'+
this._body.join("\n")+"\n</g>\n</svg>\n";return new Blob([a],{type:"image/svg+xml"})}};qd.prototype={_cmd:function(){this._body.push(Array.prototype.join.call(arguments," "))},_setAlpha:function(a,b,c){var d=Math.round(255*a*this._globalAlpha);b+=d;this._extGState[b]="<< /"+c+" "+d/255+" >>";this._cmd("/"+b,"gs");return a},set globalAlpha(a){this._globalAlpha=a;this._setAlpha(this._strokeAlpha,"As","CA");this._setAlpha(this._fillAlpha,"Af","ca")},set fillStyle(a){var b=this;cc(a,function(a,d,e,h){b._cmd(a/
255,d/255,e/255,"rg");b._setAlpha(b._fillAlpha=h,"Af","ca")})},set strokeStyle(a){var b=this;cc(a,function(a,d,e,h){b._cmd(a/255,d/255,e/255,"RG");b._setAlpha(b._strokeAlpha=h,"As","CA")})},set lineWidth(a){this._cmd(a,"w")},set lineCap(a){this._cmd({butt:0,round:1,square:2}[a],"J")},set lineJoin(a){this._cmd({miter:0,round:1,bevel:2}[a],"j")},set miterLimit(a){this._cmd(a,"M")},clearRect:function(){},beginPath:function(){this._pathUsed=!1},closePath:function(){this._cmd("h")},moveTo:function(a,b){this._cmd(this._xPos=
a,this._yPos=-b,"m")},lineTo:function(a,b){this._cmd(this._xPos=a,this._yPos=-b,"l")},bezierCurveTo:function(a,b,c,d,e,h){this._cmd(a,-b,c,-d,this._xPos=e,this._yPos=-h,"c")},quadraticCurveTo:function(a,b,c,d){this.bezierCurveTo((2*a+this._xPos)/3,(2*b-this._yPos)/3,(c+2*a)/3,(d+2*b)/3,c,d)},_kappa:.5522847498307935,arc:function(a,b,c,d,e,h){if(0===d&&e===2*Math.PI)d=this._kappa*c,this.moveTo(a+c,b),this.bezierCurveTo(a+c,b+d,a+d,b+c,a,b+c),this.bezierCurveTo(a-d,b+c,a-c,b+d,a-c,b),this.bezierCurveTo(a-
c,b-d,a-d,b-c,a,b-c),this.bezierCurveTo(a+d,b-c,a+c,b-d,a+c,b);else throw Error("PdfWriterContext.arc only supports full circles");},rect:function(a,b,c,d){this._cmd(a,-b,c,-d,"re")},_usePath:function(a){if(this._pathUsed){var b=this._body[this._pathUsed],c={"S + f":"B","f + S":"B","W n + S":"W S","W n + f":"W f","S + W n":"W S","f + W n":"W f","B + W n":"W B","W S + f":"W B","W f + S":"W B"}[b+" + "+a];if(!c)throw Error("Don't know how to combine '"+b+"' and '"+a+"'");this._body.splice(this._pathUsed,
1);a=c}this._pathUsed=this._body.length;this._cmd(a)},fill:function(){this._usePath("f")},stroke:function(){this._usePath("S")},clip:function(){this._usePath("W n")},save:function(){this._cmd("q")},restore:function(){this._cmd("Q")},translate:function(a,b){this.transform(1,0,0,1,a,b)},rotate:function(a){var b=Math.cos(a);a=Math.sin(a);this.transform(b,a,-a,b,0,0)},scale:function(a,b){this.transform(a,0,0,b,0,0)},transform:function(a,b,c,d,e,h){this._cmd(a,-b,-c,d,e,-h,"cm")},_png:function(a){if("data:image/png;base64,"!==
a.substr(0,22))return{error:"Not a base64-encoded PNG file"};a=ee(a.substr(22));var b=fe(a);console.log("PNG chunks:",b.map(function(a){return a.type}));if("IHDR"!==b[0].type)throw Error("Image does not start with an IHDR");var c=b[0].data;a=(c[0]<<24|c[1]<<16|c[2]<<8|c[3])>>>0;var d=(c[4]<<24|c[5]<<16|c[6]<<8|c[7])>>>0,e=c[8],h=c[9],g=0===(h&2),l=0!==(h&4),k=c[10],m=c[11],c=c[12];if(0!==k)throw Error("Unsupported PNG compression method: "+k);if(0!==m)throw Error("Unsupported PNG filter method: "+
m);if(0!==c)return{error:"Interlaced image not supported"};if(0!==(h&1))return{error:"Indexed PNG image not supported"};m=null;h=g?1:3;k=b.filter(function(a){return"IDAT"===a.type}).map(function(a){return a.data});if(l){l=window.pako;m=new l.Inflate;for(b=0;b<k.length;++b)m.push(k[b],b+1===k.length);if(m.err)throw Error(m.err);m=m.result;c=e>>>3;if(m.length!==d*(a*(h+1)*c+1))throw Error("Data length mismatch");for(var n=h*c,k=new Uint8Array(d*(a*n+1)),q=new Uint8Array(d*(a*c+1)),r=0,u=0,t=0,v=0;v<
d;++v){k[u++]=q[t++]=m[r++];for(var w=0;w<a;++w){for(b=0;b<n;++b)k[u++]=m[r++];for(b=0;b<c;++b)q[t++]=m[r++]}}if(r!==m.length||u!==k.length||t!==q.length)throw Error("Seems we garbled our index computation somehow");q=l.deflate(q);m=this._strm({Type:"/XObject",Subtype:"/Image",Width:a,Height:d,ColorSpace:"/DeviceGray",BitsPerComponent:e,Filter:"/FlateDecode",DecodeParms:this._dict({Predictor:15,Colors:1,BitsPerComponent:e,Columns:a})},q).ref;k=[l.deflate(k)]}var x=0;k.forEach(function(a){x+=a.length});
return this._obj([this._dict({Type:"/XObject",Subtype:"/Image",Name:"/img"+this._imgcache.length,Width:a,Height:d,ColorSpace:g?"/DeviceGray":"/DeviceRGB",SMask:m,BitsPerComponent:e,Length:x,Filter:"/FlateDecode",DecodeParms:this._dict({Predictor:15,Colors:h,BitsPerComponent:e,Columns:a})}),"\nstream\n"].concat(k,["\nendstream"]))},drawImage:function(a,b,c){if(3!==arguments.length)throw Error("PdfWriterContext only supports 3-argument version of drawImage");var d=this._imgcache.indexOf(a);if(-1===
d){d=this._imgcache.length;this._imgcache.push(a);var e=this._png(a.cachedDataURL||"");e.hasOwnProperty("error")&&(e=this._png(rd(a)));if(e.hasOwnProperty("error"))throw Error(e.error);this._xobjects["img"+d]=e.ref}this._cmd("q");this._setAlpha(1,"Af","ca");this._cmd(a.width,0,0,a.height,b,-c-a.height,"cm");this._cmd("/img"+d,"Do");this._cmd("Q")},_dict:function(a){var b="<<",c;for(c in a)b+=" /"+c+" "+a[c];return b+" >>"},_obj:function(a,b){b||(b=this._nextIndex++);Array.isArray(a)||(a=[this._dict(a)]);
a.index=b;a.ref=b+" 0 R";a.offset=this._offset;var c=0;a.unshift(b+" 0 obj\n");a.push("\nendobj\n");for(var d=0;d<a.length;++d)c+=a[d].length;this._offset+=c;this._objects.push(a);return a},_strm:function(a,b,c){a.Length=b.length;return this._obj([this._dict(a),"\nstream\n",b,"\nendstream"],c)},toBlob:function(){var a;a="["+[0,-this.height,this.width,0].join(" ")+"]";this._obj({Type:"/Catalog",Pages:"2 0 R"},1);this._obj({Type:"/Pages",Kids:"[3 0 R]",Count:1},2);this._obj({Type:"/Page",Parent:"2 0 R",
MediaBox:a,Contents:"4 0 R",Resources:this._dict({ProcSet:"[/PDF /Text /ImageB /ImageC /ImageI]",XObject:this._dict(this._xobjects),ExtGState:this._dict(this._extGState)})},3);var b=this._body.join("\n"),c=new Uint8Array(b.length);for(a=0;a<b.length;++a)c[a]=b.charCodeAt(a)&255;b=window.pako.deflate(c);this._strm({Filter:"/FlateDecode"},b,4);var b=this._objects,d=[];for(a=1;a<b.length;++a)d[b[a].index]=b[a];c="xref\n0 "+d.length+"\n";for(a=0;a<d.length;++a)c=d[a]?c+(rb(String(d[a].offset),10)+" 00000 n \n"):
c+"0000000000 65535 f \n";a="trailer\n"+this._dict({Size:d.length,Root:"1 0 R"})+"\nstartxref\n"+this._offset+"\n%%EOF\n";b=Array.prototype.concat.apply([],b);b.push(c,a);return new Blob(b,{type:"application/pdf"})}};var Pb=null;kb.push(sd);sa.exportSVG=function(){td(pd)};sa.exportPDF=function(){va.loadScript("pako","pako.min.js",function(){td(qd)})};sa.exportPNG=function(){ud(A.canvas.toDataURL())};var ud=function(a){var b=document.createElement("a");document.body.appendChild(b);b.style="display: none";
b.href=a;b.download="CindyJSExport";b.click();setTimeout(function(){document.body.removeChild(b);sd()},100)},zc="Move",Rb,za=[],$a=0,he=0,yb=0,G={Delete:{}};G.Delete.actions=[];G.Delete.actions[0]={};G.Delete.actions[0].event="mousedown";G.Delete.actions[0].tooltip="...";G.Delete.actions[0]["do"]=function(){ja=Qb(Z);null!==ja&&zd(ja.mover.name);return!0};G.Move={};G.Move.actions=[];G.Move.actions[0]={};G.Move.actions[0].event="mousedown";G.Move.actions[0].tooltip="Move free elements by dragging the mouse";
G.Move.actions[0]["do"]=function(){for(var a=Z,b=null,c=1E6,d,e=0;e<u.free.length;e++){var g=u.free[e];if(!g.pinned&&!1!==g.visible&&!0!==g.tmp){var k,m,n,q=y.drawingstate.matrix.sdet;if("P"===g.kind){m=h.normalizeZ(g.homog);if(!h._helper.isAlmostReal(m))continue;k=m.value[0].value.real-a.x;m=m.value[1].value.real-a.y;n=Math.sqrt(k*k+m*m);if(g.narrow&&n>("number"===typeof g.narrow?g.narrow:20)/q)continue}else if("C"===g.kind){m=h.normalizeZ(u.csnames[g.args[0]].homog);k=g.radius;if(!h._helper.isAlmostReal(m)||
!l._helper.isAlmostReal(k))continue;n=m.value[0].value.real;var r=m.value[1].value.real;m=a.x-n;var t=a.y-r,v=Math.sqrt(m*m+t*t);if(0===v)continue;r+=t/v*k.value.real;k=n+m/v*k.value.real-a.x;m=r-a.y;n=Math.sqrt(k*k+m*m);n+=30/q;if(g.narrow&&n>(("number"===typeof g.narrow?g.narrow:20)+30)/q)continue}else if("L"===g.kind)k=g.homog,n=l,m=n.add(n.mult(k.value[0],n.conjugate(k.value[0])),n.mult(k.value[1],n.conjugate(k.value[1]))),m=h.scaldiv(n.sqrt(m),k),n=m.value[0].value.real*a.x+m.value[1].value.real*
a.y+m.value[2].value.real,k=-m.value[0].value.real*n,m=-m.value[1].value.real*n,0>n&&(n=-n),n+=25/q;else if("Text"===g.kind){if(!g.homog||g.dock||!g._bbox)continue;m=y.from(a.x,a.y,1);k=Math.max(0,m[0]-g._bbox.right,g._bbox.left-m[0]);m=Math.max(0,m[1]-g._bbox.bottom,g._bbox.top-m[1]);n=Math.sqrt(k*k+m*m);if(20<n)continue;n/=q;m=h.normalizeZ(g.homog);if(!h._helper.isAlmostReal(m))continue;k=m.value[0].value.real-a.x;m=m.value[1].value.real-a.y}else continue;n<c+.2/q&&(c=n,b=g,d={x:k,y:m})}}console.log("Moving "+
(b?b.name:"nothing"));ja=null===b?null:{mover:b,offset:d,prev:{x:a.x,y:a.y}};return!0};G.Point={};G.Point.actions=[];G.Point.actions[0]={};G.Point.actions[0].event="mousedown";G.Point.actions[0].tooltip="Add a single point with the mouse";G.Point.actions[0]["do"]=function(){Ka({type:"Free",name:Za(),labeled:!0,pos:[ra[0],ra[1],1]});return!0};G.Mid={};G.Mid.actions=[];G.Mid.actions[0]={};G.Mid.actions[0].event="mousedown";G.Mid.actions[0].tooltip="Construct two points and their midpoint by dragging";
G.Mid.actions[0]["do"]=function(){sb();return!0};G.Mid.actions[1]={};G.Mid.actions[1].event="mousemove";G.Mid.actions[1]["do"]=function(){dc("Mid");return!0};G.Mid.actions[2]={};G.Mid.actions[2].event="mouseup";G.Mid.actions[2]["do"]=function(){zb();return!0};G.Circle={};G.Circle.actions=[];G.Circle.actions[0]={};G.Circle.actions[0].event="mousedown";G.Circle.actions[0].tooltip="Construct two points and a circle by dragging the mouse";G.Circle.actions[0]["do"]=function(){sb();return!0};G.Circle.actions[1]=
{};G.Circle.actions[1].event="mousemove";G.Circle.actions[1]["do"]=function(){dc("CircleMP");return!0};G.Circle.actions[2]={};G.Circle.actions[2].event="mouseup";G.Circle.actions[2]["do"]=function(){zb();return!0};G.Compass={};G.Compass.actions=[];G.Compass.actions[0]={};G.Compass.actions[0].event="mousedown";G.Compass.actions[0].tooltip="...";G.Compass.actions[0]["do"]=function(){sb();return!0};G.Compass.actions[1]={};G.Compass.actions[1].event="mousedown";G.Compass.actions[1].tooltip="...";G.Compass.actions[1]["do"]=
function(){sb();return!0};G.Compass.actions[2]={};G.Compass.actions[2].event="mousedown";G.Compass.actions[2].tooltip="...";G.Compass.actions[2]["do"]=function(){sb();Ka({type:"Compass",name:Za(),labeled:!0,args:[za[0].name,za[1].name,za[2].name]});return!0};G.Line={};G.Line.actions=[];G.Line.actions[0]={};G.Line.actions[0].event="mousedown";G.Line.actions[0].tooltip="Construct two points and their connecting line by dragging the mouse";G.Line.actions[0]["do"]=function(){sb();return!0};G.Line.actions[1]=
{};G.Line.actions[1].event="mousemove";G.Line.actions[1]["do"]=function(){dc("Join");return!0};G.Line.actions[2]={};G.Line.actions[2].event="mouseup";G.Line.actions[2]["do"]=function(){zb();return!0};G.Segment={};G.Segment.actions=[];G.Segment.actions[0]={};G.Segment.actions[0].event="mousedown";G.Segment.actions[0].tooltip="Draw a segment by dragging the mouse";G.Segment.actions[0]["do"]=function(){sb();return!0};G.Segment.actions[1]={};G.Segment.actions[1].event="mousemove";G.Segment.actions[1]["do"]=
function(){dc("Segment");return!0};G.Segment.actions[2]={};G.Segment.actions[2].event="mouseup";G.Segment.actions[2]["do"]=function(){zb();return!0};G.Parallel={};G.Parallel.actions=[];G.Parallel.actions[0]={};G.Parallel.actions[0].event="mousedown";G.Parallel.actions[0].tooltip="Construct a parallel line by dragging a line";G.Parallel.actions[0]["do"]=function(){return xd()};G.Parallel.actions[1]={};G.Parallel.actions[1].event="mousemove";G.Parallel.actions[1]["do"]=function(){var a={type:"Free",
name:Za(),labeled:!0,pos:[ra[0],ra[1],1],tmp:!0},a=Ka(a);Rb=Ka({type:"Para",name:Za(),labeled:!0,args:[za[0].name,a.name]});Bc(a);return!0};G.Parallel.actions[2]={};G.Parallel.actions[2].event="mouseup";G.Parallel.actions[2]["do"]=function(){zb();return!0};G.Orthogonal={};G.Orthogonal.actions=[];G.Orthogonal.actions[0]={};G.Orthogonal.actions[0].event="mousedown";G.Orthogonal.actions[0].tooltip="Construct a orthogonal line by dragging a line";G.Orthogonal.actions[0]["do"]=function(){if(xd()){var a=
{type:"Free",name:Za(),labeled:!0,pos:[ra[0],ra[1],1],tmp:!0},a=Ka(a);Rb=Ka({type:"Perp",name:Za(),labeled:!0,args:[za[0].name,a.name]});Bc(a);return!0}return!1};G.Orthogonal.actions[1]={};G.Orthogonal.actions[1].event="mouseup";G.Orthogonal.actions[1]["do"]=function(){zb();return!0};G.Intersection={};G.Intersection.actions=[];G.Intersection.actions[0]={};G.Intersection.actions[0].event="mousedown";G.Intersection.actions[0].tooltip="Select two elements to define their intersection";G.Intersection.actions[0]["do"]=
function(){return yd()};G.Intersection.actions[1]={};G.Intersection.actions[1].event="mousedown";G.Intersection.actions[1]["do"]=function(){return yd()?(Rb=Ka({type:"Meet",name:Za(),labeled:!0,args:[za[0].name,za[1].name]}),!0):!1};var gb={},y={drawingstate:{}};y.drawingstate.linecolor="rgb(0,0,255)";y.drawingstate.linecolorraw=[0,0,1];y.drawingstate.pointcolor="rgb(0,255,0)";y.drawingstate.pointcolorraw=[0,1,0];y.drawingstate.textcolor="rgb(0,0,0)";y.drawingstate.textcolorraw=[0,0,0];y.drawingstate.alpha=
1;y.drawingstate.pointsize=4;y.drawingstate.linesize=1;y.drawingstate.textsize=null;y.drawingstate.matrix={};y.drawingstate.matrix.a=25;y.drawingstate.matrix.b=0;y.drawingstate.matrix.c=0;y.drawingstate.matrix.d=25;y.drawingstate.matrix.tx=250.5;y.drawingstate.matrix.ty=250.5;y.drawingstate.matrix.det=y.drawingstate.matrix.a*y.drawingstate.matrix.d-y.drawingstate.matrix.b*y.drawingstate.matrix.c;y.drawingstate.matrix.sdet=Math.sqrt(y.drawingstate.matrix.det);y.drawingstate.initialmatrix={};y.drawingstate.initialmatrix.a=
y.drawingstate.matrix.a;y.drawingstate.initialmatrix.b=y.drawingstate.matrix.b;y.drawingstate.initialmatrix.c=y.drawingstate.matrix.c;y.drawingstate.initialmatrix.d=y.drawingstate.matrix.d;y.drawingstate.initialmatrix.tx=y.drawingstate.matrix.tx;y.drawingstate.initialmatrix.ty=y.drawingstate.matrix.ty;y.drawingstate.initialmatrix.det=y.drawingstate.matrix.det;y.drawingstate.initialmatrix.sdet=y.drawingstate.matrix.sdet;y.clone=function(a){if(null===a||"object"!==typeof a)return a;var b=a.constructor(),
c;for(c in a)b[c]=y.clone(a[c]);return b};gb.backup=y.clone(y.drawingstate);gb.stack=[];y.clone(y.drawingstate);y.reset=function(){y.drawingstate.matrix.a=y.drawingstate.initialmatrix.a;y.drawingstate.matrix.b=y.drawingstate.initialmatrix.b;y.drawingstate.matrix.c=y.drawingstate.initialmatrix.c;y.drawingstate.matrix.d=y.drawingstate.initialmatrix.d;y.drawingstate.matrix.tx=y.drawingstate.initialmatrix.tx;y.drawingstate.matrix.ty=y.drawingstate.initialmatrix.ty;y.drawingstate.matrix.det=y.drawingstate.initialmatrix.det;
y.drawingstate.matrix.sdet=y.drawingstate.initialmatrix.sdet};y.from=function(a,b,c){a/=c;b/=c;c=y.drawingstate.matrix;return[a*c.a-b*c.b+c.tx,a*c.c-b*c.d-c.ty]};y.to=function(a,b){var c=y.drawingstate.matrix,d=a-c.tx,e=b+c.ty;return[(d*c.d-e*c.b)/c.det,-(-d*c.c+e*c.a)/c.det,1]};y.toMat=function(){var a=y.drawingstate.matrix;return h.realMatrix([[a.d,-a.b,-a.tx*a.d-a.ty*a.b],[a.c,-a.a,-a.tx*a.c-a.ty*a.a],[0,0,a.det]])};y.dumpTrafo=function(){function a(a){return Math.round(1E3*a)/1E3}var b=y.drawingstate.matrix;
console.log("a:"+a(b.a)+" b:"+a(b.b)+" c:"+a(b.c)+" d:"+a(b.d)+" tx:"+a(b.ty)+" ty:"+a(b.tx))};y.setMat=function(a,b,c,d,e,h){var g=y.drawingstate.matrix;g.a=a;g.b=b;g.c=c;g.d=d;g.tx=e;g.ty=h;g.det=a*d-b*c;g.sdet=Math.sqrt(g.det)};y.scaleAndOrigin=function(a,b,c){y.setMat(a,0,0,a,b,c)};y.visibleRect=function(a,b,c,d){var e=c-a,h=b-d,e=ba*h<ca*e?ba/e:ca/h;y.setMat(e,0,0,e,(ba-e*(a+c))/2,(ca-e*(b+d))/2)};y.applyMat=function(a,b,c,d,e,h){var g=y.drawingstate.matrix;y.setMat(g.a*a+g.c*b,g.b*a+g.d*b,g.a*
c+g.c*d,g.b*c+g.d*d,g.a*e+g.c*h+g.tx,g.b*e+g.d*h+g.ty)};y.translate=function(a,b){y.applyMat(1,0,0,1,a,b)};y.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);y.applyMat(b,a,-a,b,0,0)};y.scale=function(a){y.applyMat(a,0,0,a,0,0)};y.gsave=function(){gb.stack.push(y.clone(y.drawingstate))};y.grestore=function(){0!==gb.stack.length&&(y.drawingstate=gb.stack.pop())};y.greset=function(){y.drawingstate=y.clone(gb.backup);y.drawingstate.matrix.ty-=ca;y.drawingstate.initialmatrix.ty-=ca;gb.stack=[]};y.createnewbackup=
function(){y.drawingstate.initialmatrix.a=y.drawingstate.matrix.a;y.drawingstate.initialmatrix.b=y.drawingstate.matrix.b;y.drawingstate.initialmatrix.c=y.drawingstate.matrix.c;y.drawingstate.initialmatrix.d=y.drawingstate.matrix.d;y.drawingstate.initialmatrix.tx=y.drawingstate.matrix.tx;y.drawingstate.initialmatrix.ty=y.drawingstate.matrix.ty;y.drawingstate.initialmatrix.det=y.drawingstate.matrix.det;y.drawingstate.initialmatrix.sdet=y.drawingstate.matrix.sdet;gb.backup=y.clone(y.drawingstate)};y.makecolor=
function(a,b,c){a=Math.floor(255*a);b=Math.floor(255*b);c=Math.floor(255*c);return 1===y.drawingstate.alpha?"rgb("+a+","+b+","+c+")":"rgba("+a+","+b+","+c+","+y.drawingstate.alpha+")"};y.setcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;y.drawingstate.linecolor=y.drawingstate.pointcolor=y.makecolor(b,c,a);y.drawingstate.linecolorraw=y.drawingstate.pointcolorraw=[b,c,a]};y.setlinecolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=
a.value[2].value.real;y.drawingstate.linecolor=y.makecolor(b,c,a);y.drawingstate.linecolorraw=[b,c,a]};y.settextcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;y.drawingstate.textcolor=y.makecolor(b,c,a);y.drawingstate.textcolorraw=[b,c,a]};y.setpointcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;y.drawingstate.pointcolor=y.makecolor(b,c,a);y.drawingstate.pointcolorraw=[b,c,a]};y.setalpha=function(a){y.drawingstate.alpha=
a.value.real;y.drawingstate.linecolor=y.makecolor(y.drawingstate.linecolorraw[0],y.drawingstate.linecolorraw[1],y.drawingstate.linecolorraw[2]);y.drawingstate.pointcolor=y.makecolor(y.drawingstate.pointcolorraw[0],y.drawingstate.pointcolorraw[1],y.drawingstate.pointcolorraw[2]);y.drawingstate.textcolor=y.makecolor(y.drawingstate.textcolorraw[0],y.drawingstate.textcolorraw[1],y.drawingstate.textcolorraw[2])};y.setpointsize=function(a){y.drawingstate.pointsize=a.value.real};y.setlinesize=function(a){y.drawingstate.linesize=
a.value.real};y.settextsize=function(a){y.drawingstate.textsize=a.value.real};var ga={clip:"none",pointColor:[1,0,0],lineColor:[0,0,1],pointSize:5,lineSize:1,alpha:1,overhangLine:1,overhangSeg:1,dimDependent:.7,fontFamily:"sans-serif",textColor:[0,0,0],textsize:20,noborder:!1,lineHeight:1.45};q.defaultAppearance&&ie(q.defaultAppearance);var fc={},Fd={UL:0,UR:1,LR:2,LL:3},Ec=["in","out","good","backup","prover"],ob=new Float64Array(0),Ya={};Ec.forEach(function(a){Ya[a]=ob});var ma=ob,Na=ob,Da=ob,Ba,
Ea,mb,La,Cb,Fc=!1,Hd={toString:function(){return"RefineException"}},Kd=null,N=null;q.enableTraceLog&&(N={logLength:Infinity,fullLog:[],currentMouseAndScripts:null,currentMover:null,currentStep:null,currentElement:null,currentParam:null,labelTracing2:w.wrap("tracing2"),labelTracing4:w.wrap("tracing4"),labelTracingSesq:w.wrap("tracingSesq"),postMouseHooks:[]},"number"===typeof q.enableTraceLog&&(N.logLength=q.enableTraceLog),sa.getTraceLog=oe,sa.formatTraceLog=pe,sa.addTraceHook=N.postMouseHooks.push.bind(N.postMouseHooks));
Oa.stateSize=12;Hc.stateSize=24;Sb.stateSize=24;var Sa=[];nb.P=function(a){u.lines.forEach(function(b){b=Nd(a,b);b.holds()&&Sa.push(b)});u.conics.forEach(function(b){b=Od(a,b);b.holds()&&Sa.push(b)})};nb.L=function(a){u.points.forEach(function(b){b=Nd(b,a);b.holds()&&Sa.push(b)})};nb.S=nb.L;nb.C=function(a){u.points.forEach(function(b){b=Od(b,a);b.holds()&&Sa.push(b)})};var m={_helper:{},RandomLine:{}};m.RandomLine.kind="L";m.RandomLine.signature=[];m.RandomLine.updatePosition=function(a){a.homog=
h.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);a.homog=h.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};m._helper.getRandMove=function(a){a=a.homog;var b=h.getRandComplexVec3(-.05,.05);return{type:"homog",value:h.add(a,b)}};m._helper.getRandPointMove=function(a){a=h.normalizeMax(a.homog);var b=a.value[2],c=l.abs(b).value.real,d=l.real(0);c<l.eps&&(d=l.getRandComplex(-.05,.05),b=l.real(1));c=h.turnIntoCSList([l.getRandComplex(-.1,.1),l.getRandComplex(-.1,.1),d]);b=h.scalmult(b,
c);b=h.add(a,b);return{type:"homog",value:b}};m.FreeLine={};m.FreeLine.kind="L";m.FreeLine.signature=[];m.FreeLine.isMovable=!0;m.FreeLine.initialize=function(a){a=m._helper.initializeLine(a);T(a)};m.FreeLine.getParamForInput=function(a,b,c){"mouse"===c?(a=h.cross(b,h.ez),a=h.cross(a,b)):a="homog"===c?b:h.turnIntoCSList([l.zero,l.zero,l.zero]);return h.normalizeMax(a)};m.FreeLine.getParamFromState=function(a){return W(3)};m.FreeLine.putParamToState=function(a,b){T(b)};m.FreeLine.updatePosition=function(a){var b=
W(3);T(b);a.homog=w.withUsage(b,"Line")};m.FreeLine.getRandomMove=m._helper.getRandMove;m.FreeLine.stateSize=6;m.RandomPoint={};m.RandomPoint.kind="P";m.RandomPoint.signature=[];m.RandomPoint.updatePosition=function(a){a.homog=h.realVector([100*Math.random(),100*Math.random(),100*Math.random()]);a.homog=h.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};m.Join={};m.Join.kind="L";m.Join.signature=["P","P"];m.Join.updatePosition=function(a){a.homog=h.cross(u.csnames[a.args[0]].homog,u.csnames[a.args[1]].homog);
a.homog=h.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};m.Segment={};m.Segment.kind="S";m.Segment.signature=["P","P"];m.Segment.updatePosition=function(a){var b=u.csnames[a.args[0]],c=u.csnames[a.args[1]];m.Segment.setSegmentPos(a,h.cross(b.homog,c.homog),h.scalmult(c.homog.value[2],b.homog),h.scalmult(b.homog.value[2],c.homog))};m.Segment.setSegmentPos=function(a,b,c,d){b=h.normalizeMax(b);a.homog=w.withUsage(b,"Line");b=h.turnIntoCSList([c,d]);b=h.normalizeMax(b);a.startpos=b.value[0];
a.endpos=b.value[1]};m.Meet={};m.Meet.kind="P";m.Meet.signature=["L","L"];m.Meet.updatePosition=function(a){a.homog=h.cross(u.csnames[a.args[0]].homog,u.csnames[a.args[1]].homog);a.homog=h.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};m.Meet.visiblecheck=function(a){var b=!0,c=u.csnames[a.args[0]],d=u.csnames[a.args[1]];"S"===c.kind&&(b=Dd(a,c));b&&"S"===d.kind&&(b=Dd(a,d));a.isshowing=b};m._helper.midpoint=function(a,b){return h.normalizeMax(h.add(h.scalmult(b.value[2],a),h.scalmult(a.value[2],
b)))};m.Mid={};m.Mid.kind="P";m.Mid.signature=["P","P"];m.Mid.updatePosition=function(a){var b=m._helper.midpoint(u.csnames[a.args[0]].homog,u.csnames[a.args[1]].homog);a.homog=w.withUsage(b,"Point")};m.Perp={};m.Perp.kind="L";m.Perp.signature=["L","P"];m.Perp.updatePosition=function(a){var b=u.csnames[a.args[0]].homog,c=u.csnames[a.args[1]].homog,b=h.turnIntoCSList([b.value[0],b.value[1],l.zero]);a.homog=h.cross(b,c);a.homog=h.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};m.Para={};
m.Para.kind="L";m.Para.signature=["L","P"];m.Para.updatePosition=function(a){var b=u.csnames[a.args[1]].homog;a.homog=h.cross(h.cross(h.linfty,u.csnames[a.args[0]].homog),b);a.homog=h.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};m.Horizontal={};m.Horizontal.kind="L";m.Horizontal.signature=["P"];m.Horizontal.updatePosition=function(a){a.homog=h.cross(h.ex,u.csnames[a.args[0]].homog);a.homog=h.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};m.HorizontalLine={};m.HorizontalLine.kind=
"L";m.HorizontalLine.signature=[];m.HorizontalLine.isMovable=!0;m.HorizontalLine.initialize=function(a){a=m._helper.initializeLine(a);a=h.turnIntoCSList([l.zero,a.value[1],a.value[2]]);a=h.normalizeMax(a);T(a)};m.HorizontalLine.getParamForInput=function(a,b,c){if("mouse"===c)b=h.cross(b,h.ex);else if("homog"===c){if(0!==b.value[0].real||0!==b.value[0].imag)b=h.turnIntoCSList([l.zero,b.value[1],b.value[2]])}else b=h.turnIntoCSList([l.zero,l.zero,l.zero]);return h.normalizeMax(b)};m.HorizontalLine.getParamFromState=
function(a){return W(3)};m.HorizontalLine.putParamToState=function(a,b){T(b)};m.HorizontalLine.updatePosition=function(a){var b=W(3);T(b);a.homog=w.withUsage(b,"Line")};m.HorizontalLine.getRandomMove=m._helper.getRandMove;m.HorizontalLine.stateSize=6;m.Vertical={};m.Vertical.kind="L";m.Vertical.signature=["P"];m.Vertical.updatePosition=function(a){a.homog=h.cross(h.ey,u.csnames[a.args[0]].homog);a.homog=h.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};m.VerticalLine={};m.VerticalLine.kind=
"L";m.VerticalLine.signature=[];m.VerticalLine.isMovable=!0;m.VerticalLine.initialize=function(a){a=m._helper.initializeLine(a);a=h.turnIntoCSList([a.value[0],l.zero,a.value[2]]);a=h.normalizeMax(a);T(a)};m.VerticalLine.getParamForInput=function(a,b,c){if("mouse"===c)b=h.cross(b,h.ey);else if("homog"===c){if(0!==b.value[1].real||0!==b.value[1].imag)b=h.turnIntoCSList([b.value[0],l.zero,b.value[2]])}else b=h.turnIntoCSList([l.zero,l.zero,l.zero]);return h.normalizeMax(b)};m.VerticalLine.getParamFromState=
function(a){return W(3)};m.VerticalLine.putParamToState=function(a,b){T(b)};m.VerticalLine.updatePosition=function(a){var b=W(3);T(b);a.homog=w.withUsage(b,"Line")};m.VerticalLine.getRandomMove=m._helper.getRandMove;m.VerticalLine.stateSize=6;m.LineByFixedAngle={};m.LineByFixedAngle.kind="L";m.LineByFixedAngle.signature=["L","P"];m.LineByFixedAngle.initialize=function(a){var b=l._helper.input(a.angle),c=l.cos(b),b=l.sin(b);a.rot=h.turnIntoCSList([h.turnIntoCSList([b,c,l.zero]),h.turnIntoCSList([l.neg(c),
b,l.zero]),h.turnIntoCSList([l.zero,l.zero,l.zero])])};m.LineByFixedAngle.updatePosition=function(a){var b=u.csnames[a.args[1]],c=h.productMV(a.rot,u.csnames[a.args[0]].homog);a.homog=h.cross(b.homog,c);a.homog=h.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};m.Through={};m.Through.kind="L";m.Through.signature=["P"];m.Through.isMovable=!0;m.Through.initialize=function(a){a=a.dir?w.wrap(a.dir):h.realVector([a.pos[1],-a.pos[0],0]);T(a)};m.Through.getParamForInput=function(a,b,c){a="dir"===
c||"mouse"===c?h.cross(u.csnames[a.args[0]].homog,b):"homog"===c?b:h.turnIntoCSList([l.zero,l.zero,l.zero]);a=h.cross(h.linfty,a);return h.normalizeMax(a)};m.Through.getParamFromState=function(a){return W(3)};m.Through.putParamToState=function(a,b){T(b)};m.Through.updatePosition=function(a){var b=W(3);T(b);b=h.cross(u.csnames[a.args[0]].homog,b);b=h.normalizeMax(b);a.homog=w.withUsage(b,"Line")};m.Through.getRandomMove=m._helper.getRandMove;m.Through.stateSize=6;m.Through.set_angle=function(a,b){if("number"===
b.ctype){var c=l.cos(b),d=l.sin(b),c=h.turnIntoCSList([c,d,l.real(0)]);Aa(a,c,"dir")}};m.Through.set_slope=function(a,b){if("number"===b.ctype){var c=h.turnIntoCSList([l.real(1),b,l.real(0)]);Aa(a,c,"dir")}};m.Free={};m.Free.kind="P";m.Free.signature=[];m.Free.isMovable=!0;m.Free.initialize=function(a){a=m._helper.initializePoint(a);T(a)};m.Free.getParamForInput=function(a,b,c){if("mouse"===c&&Gb&&0!==ya){b=h.normalizeZ(b);a=b.value[0].value.real;c=b.value[1].value.real;var d=Math.round(a/ya)*ya,
e=Math.round(c/ya)*ya;.2>Math.abs(d-a)&&.2>Math.abs(e-c)&&(b=h.realVector([d,e,1]))}return h.normalizeMax(b)};m.Free.getParamFromState=function(a){return W(3)};m.Free.putParamToState=function(a,b){T(b)};m.Free.updatePosition=function(a){var b=W(3);T(b);a.homog=w.withUsage(b,"Point")};m.Free.getRandomMove=m._helper.getRandPointMove;m.Free.stateSize=6;m._helper.projectPointToLine=function(a,b){var c=h.turnIntoCSList([b.value[0],b.value[1],l.zero]),c=h.cross(c,a);return h.normalizeMax(h.cross(c,b))};
m.PointOnLine={};m.PointOnLine.kind="P";m.PointOnLine.signature=["L"];m.PointOnLine.isMovable=!0;m.PointOnLine.initialize=function(a){var b=m._helper.initializePoint(a);a=u.csnames[a.args[0]].homog;var b=m._helper.projectPointToLine(b,a),b=h.normalizeMax(b),c=h.cross(h.linfty,b);h.normalizeMax(c);T(b);T(a);mb=!1};m.PointOnLine.updatePosition=function(a,b){var c,d=u.csnames[a.args[0]].homog;c=W(3);W(3);if(!b){Ba=a.stateIdx;var e=ma;ma=Da;var g=W(3),l=W(3);ma=e;e=h.cross(l,d);h._helper.isAlmostZero(e)&&
(e=h.cross(h.linfty,d));g=m._helper.CircleMP(e,g);g=m._helper.IntersectLC(d,g);e=m._helper.pointReflection(e,c);c=Gc(g[0],g[1],c,e)[0]}c=h.normalizeMax(c);T(c);T(d);a.homog=w.withUsage(c,"Point")};m.PointOnLine.getParamForInput=function(a,b,c){a=u.csnames[a.args[0]].homog;b=m._helper.projectPointToLine(b,a);"mouse"===c&&Gb&&0!==ya&&(b=m._helper.snapPointToLine(b,a));return b};m.PointOnLine.getParamFromState=function(a){return W(3)};m.PointOnLine.putParamToState=function(a,b){return T(b)};m.PointOnLine.getRandomMove=
m._helper.getRandPointMove;m.PointOnLine.stateSize=12;m.PointOnCircle={};m.PointOnCircle.kind="P";m.PointOnCircle.signature=["C"];m.PointOnCircle.isMovable=!0;m.PointOnCircle.initialize=function(a){var b=u.csnames[a.args[0]];a=h.normalizeZ(m._helper.initializePoint(a));var c=h.normalizeZ(m._helper.CenterOfCircle(b.matrix)),d=h.sub(a,c),d=h.turnIntoCSList([d.value[1],l.neg(d.value[0]),l.zero]),c=h.cross(a,c),b=m._helper.IntersectLC(c,b.matrix),c=h.projectiveDistMinScal(a,b[0]);h.projectiveDistMinScal(a,
b[1])<c?(a=b[1],b=b[0]):(a=b[0],b=b[1]);T(d);T(a);T(b);mb=!1};m.PointOnCircle.putParamToState=function(a,b){T(b)};m.PointOnCircle.getParamFromState=function(a){return W(3)};m.PointOnCircle.getParamForInput=function(a,b,c){c=h.normalizeZ(m._helper.CenterOfCircle(u.csnames[a.args[0]].matrix));b=h.sub(b,c);Ba=a.stateIdx;a=W(3);var d=h.normalizeZ(W(3));c=h.sub(d,c);0>l.sub(l.mult(a.value[0],c.value[1]),l.mult(a.value[1],c.value[0])).value.real&&(b=h.neg(b));return h.turnIntoCSList([b.value[1],l.neg(b.value[0]),
l.zero])};m.PointOnCircle.parameterPath=function(a,b,c,d,e){d=h.normalizeAbs(d);e=h.normalizeAbs(e);var g=h.scalproduct(d,e);if(0<=g.value.real)return Id(a,b,c,d,e);a=h.turnIntoCSList([l.sub(d.value[1],e.value[1]),l.sub(e.value[0],d.value[0]),l.zero]);g=h.scalproduct(d,a);0>g.value.real&&(a=h.neg(a));0>b?(b=2*b+1,c=b*b,g=.25/(1+c),c=l.complex(2*b*g+.25,(1-c)*g)):(b=2*b-1,c=b*b,g=.25/(1+c),c=l.complex(2*b*g+.75,(1-c)*g));var k=l.sub(l.real(1),c);b=l.mult(c,c);g=l.mult(k,k);c=l.mult(c,k);d=h.scalmult(g,
d);d=h.add(d,h.scalmult(c,a));return d=h.add(d,h.scalmult(b,e))};m.PointOnCircle.updatePosition=function(a){var b=W(3);T(b);var c=u.csnames[a.args[0]],b=h.productMV(c.matrix,b),c=m._helper.IntersectLC(b,c.matrix),c=Oa(c[0],c[1]),b=h.normalizeMax(c.value[0]);a.homog=w.withUsage(b,"Point");a.antipodalPoint=c.value[1]};m.PointOnCircle.getRandomMove=m._helper.getRandPointMove;m.PointOnCircle.stateSize=6+Oa.stateSize;m.PointOnCircle.get_angle=function(a){var b=m._helper.CenterOfCircle(u.csnames[a.args[0]].matrix),
c=h._helper.isAlmostFarpoint;if(c(a.homog)||c(b))return k;a=h.normalizeZ(a.homog);b=h.normalizeZ(b);b=h.sub(a,b);b=l.arctan2(b.value[0],b.value[1]);a=l.real(Lc);b=l.mod(l.add(b,a),a);return w.withUsage(b,"Angle")};m.PointOnCircle.set_angle=function(a,b){if("number"===b.ctype){var c=u.csnames[a.args[0]],d=m._helper.CenterOfCircle(c.matrix);if(!h._helper.isAlmostFarpoint(d)){var d=h.normalizeZ(d),e=l.cos(b),g=l.sin(b),c=h.turnIntoCSList([l.mult(e,c.radius),l.mult(g,c.radius),l.real(0)]);Aa(a,h.add(d,
c),"homog")}}return k};m.OtherPointOnCircle={};m.OtherPointOnCircle.kind="P";m.OtherPointOnCircle.signature=["P"];m.OtherPointOnCircle.signatureConstraints=function(a){return"PointOnCircle"===u.csnames[a.args[0]].type};m.OtherPointOnCircle.updatePosition=function(a){var b=u.csnames[a.args[0]].antipodalPoint,b=h.normalizeMax(b);a.homog=w.withUsage(b,"Point")};m.PointOnSegment={};m.PointOnSegment.kind="P";m.PointOnSegment.signature=["S"];m.PointOnSegment.isMovable=!0;m.PointOnSegment.initialize=function(a){var b=
m._helper.initializePoint(a);a=m.PointOnSegment.getParamForInput(a,b);ab(a)};m.PointOnSegment.getParamForInput=function(a,b,c){a=u.csnames[a.args[0]];var d=a.homog;"mouse"===c&&Gb&&0!==ya&&(b=m._helper.snapPointToLine(b,d));c=h.turnIntoCSList([d.value[0],d.value[1],l.zero]);d=h.sub(a.startpos,a.endpos);b=h.crossratio3(d,a.startpos,a.endpos,b,c);0>b.value.real&&(b=l.complex(0,b.value.imag));1<b.value.real&&(b=l.complex(1,b.value.imag));return b};m.PointOnSegment.getParamFromState=function(a){return Db()};
m.PointOnSegment.putParamToState=function(a,b){ab(b)};m.PointOnSegment.updatePosition=function(a){var b=Db();ab(b);var c=u.csnames[a.args[0]],d=c.startpos,c=h.sub(c.endpos,d),b=h.add(d,h.scalmult(b,c)),b=h.normalizeMax(b);a.homog=w.withUsage(b,"Point")};m.PointOnSegment.getRandomMove=m._helper.getRandPointMove;m.PointOnSegment.stateSize=2;m._helper.projectPointToCircle=function(a,b){var c=m._helper.CenterOfCircle(a.matrix),c=h.normalizeMax(c),c=h.normalizeMax(h.cross(b,c)),c=m._helper.IntersectLC(c,
a.matrix),d=h.projectiveDistMinScal(b,c[0]),e=h.projectiveDistMinScal(b,c[1]);return d<e?c[0]:c[1]};m.PointOnArc={};m.PointOnArc.kind="P";m.PointOnArc.signature=["C"];m.PointOnArc.signatureConstraints=function(a){return u.csnames[a.args[0]].isArc};m.PointOnArc.isMovable=!0;m.PointOnArc.initialize=function(a){var b=m._helper.initializePoint(a);a=m.PointOnArc.getParamForInput(a,b);T(a)};m.PointOnArc.getParamForInput=function(a,b){var c=u.csnames[a.args[0]],d=m._helper.projectPointToCircle(c,b),c=h.normalizeMax(h.crossratio3harm(c.startPoint,
c.endPoint,c.viaPoint,d,h.ii)),d=l.div(c.value[0],c.value[1]);0>d.value.real&&(c=-1>d.value.real?h.realVector([1,0]):h.realVector([0,1]));return c};m.PointOnArc.getParamFromState=function(a){return W(2)};m.PointOnArc.putParamToState=function(a,b){T(b)};m.PointOnArc.updatePosition=function(a){var b=u.csnames[a.args[0]],c=b.startPoint,d=b.viaPoint,e=b.endPoint,g=h.ii,k=h.cross(c,g),d=h.cross(d,g),n=h.cross(e,g),n=h.turnIntoCSList([k,n]),k=h.transpose(n),n=h.conjugate(n),k=h.productMM(n,k),d=h.productMV(n,
d),k=h.productMV(h.adjoint2(k),d),d=k.value[0],k=k.value[1],n=W(2);T(n);c=h.normalizeMax(h.add(h.scalmult(l.mult(d,n.value[0]),c),h.scalmult(l.mult(k,n.value[1]),e)));b=m._helper.conicOtherIntersection(b.matrix,g,c);a.homog=w.withUsage(b,"Point")};m.PointOnArc.getRandomMove=m._helper.getRandPointMove;m.PointOnArc.stateSize=4;m._helper.CenterOfCircle=function(a){return h.turnIntoCSList([a.value[2].value[0],a.value[2].value[1],l.neg(a.value[0].value[0])])};m._helper.CenterOfConic=function(a){a=h.adjoint3(a);
return{ctype:"list",value:[a.value[2].value[0],a.value[2].value[1],a.value[2].value[2]]}};m.CenterOfConic={};m.CenterOfConic.kind="P";m.CenterOfConic.signature=["C"];m.CenterOfConic.updatePosition=function(a){var b=m._helper.CenterOfConic(u.csnames[a.args[0]].matrix);a.homog=b;a.homog=h.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};m._helper.CircleMP=function(a,b){var c=a.value[0],d=a.value[1],e=l.neg(a.value[2]),g=l.zero,c=h.turnIntoCSList([h.turnIntoCSList([e,g,c]),h.turnIntoCSList([g,
e,d]),h.turnIntoCSList([c,d,g])]),e=w.mult(w.mult(b,c),b),d=w.mult(w.mult(b,h.fund),b),e=w.mult(e,h.fund),c=w.mult(d,c);return h.sub(e,c)};m.CircleMP={};m.CircleMP.kind="C";m.CircleMP.signature=["P","P"];m.CircleMP.updatePosition=function(a){a.matrix=m._helper.CircleMP(u.csnames[a.args[0]].homog,u.csnames[a.args[1]].homog);a.matrix=h.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Circle")};m.CircleMr={};m.CircleMr.kind="C";m.CircleMr.signature=["P"];m.CircleMr.isMovable=!0;m.CircleMr.initialize=
function(a){ab(l.real(a.radius))};m.CircleMr.getParamForInput=function(a,b,c){if("radius"===c)return b;a=u.csnames[a.args[0]].homog;a=h.normalizeZ(a);b=h.normalizeZ(b);b=h.sub(a,b);return b=h.abs(b)};m.CircleMr.getParamFromState=function(a){return Db()};m.CircleMr.putParamToState=function(a,b){ab(b)};m.CircleMr.updatePosition=function(a){var b=Db();ab(b);var c=u.csnames[a.args[0]].homog,d=l.mult(c.value[2],b),d=l.mult(d,d);if(!l._helper.isFinite(d)&&!l._helper.isNaN(d))return h.fund;c=m._helper.ScaledCircleMrr(c,
d);a.matrix=w.withUsage(c,"Circle");a.radius=b};m.CircleMr.getRandomMove=function(a){a=a.radius;return{type:"radius",value:l.abs(a).value.real<l.eps?l.getRandComplex(.05,.1):l.mult(a,l.getRandReal(.95,1.05))}};m.CircleMr.stateSize=2;m.CircleMr.set_radius=function(a,b){"number"===b.ctype&&Aa(a,b,"radius")};m._helper.ScaledCircleMrr=function(a,b){var c=a.value[0],d=a.value[1],e=l.neg(a.value[2]),e=h.scalmult(e,h.turnIntoCSList([c,d,e])).value,c=h.turnIntoCSList([c,d]),c=l.sub(h.scalproduct(c,c),b),
e=m._helper.buildConicMatrix([e[2],l.zero,e[2],e[0],e[1],c]);return h.normalizeMax(e)};m.Compass={};m.Compass.kind="C";m.Compass.signature=["P","P","P"];m.Compass.updatePosition=function(a){var b=u.csnames[a.args[0]].homog,c=u.csnames[a.args[1]].homog,d=u.csnames[a.args[2]].homog,e=b.value[2],g=c.value[2],k=d.value[2],b=h.scalmult(l.mult(g,k),b),c=h.scalmult(l.mult(e,k),c),d=h.scalmult(l.mult(e,g),d),b=h.sub(c,b),d=m._helper.ScaledCircleMrr(d,h.scalproduct(b,b));a.matrix=w.withUsage(d,"Circle")};
m._helper.getConicType=function(a){if(1E-16>l.abs(h.det(a)).value.real)return"degenerate";var b=l.mult(a.value[0].value[0],a.value[1].value[1]),b=l.sub(b,l.pow(a.value[0].value[1],l.real(2))),b=b.value.real;return 1E-16>Math.abs(b)?"parabola":1E-16<b?"ellipsoid":"hyperbola"};m._helper.ConicBy5=function(a,b,c,d,e,g){a=h.turnIntoCSList([h.cross(c,d)]);var l=h.turnIntoCSList([h.cross(b,e)]);b=h.turnIntoCSList([h.cross(b,c)]);d=h.turnIntoCSList([h.cross(d,e)]);return m._helper.conicFromTwoDegenerates(a,
l,b,d,g)};m._helper.conicFromTwoDegenerates=function(a,b,c,d,e){a=w.mult(h.transpose(b),a);c=w.mult(h.transpose(d),c);a=h.add(a,h.transpose(a));c=h.add(c,h.transpose(c));d=w.mult(w.mult(e,a),e);e=w.mult(w.mult(e,c),e);c=w.mult(d,c);e=w.mult(e,a);return h.sub(c,e)};m.ConicBy5={};m.ConicBy5.kind="C";m.ConicBy5.signature=["P","P","P","P","P"];m.ConicBy5.updatePosition=function(a){var b=m._helper.ConicBy5(a,u.csnames[a.args[0]].homog,u.csnames[a.args[1]].homog,u.csnames[a.args[2]].homog,u.csnames[a.args[3]].homog,
u.csnames[a.args[4]].homog);a.matrix=b;a.matrix=h.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};m.FreeConic={};m.FreeConic.kind="C";m.FreeConic.signature=[];m.FreeConic.initialize=function(a){var b;b=a.pos?m._helper.inputConic(a.pos):h.zeromatrix(l.real(3),l.real(3));m.FreeConic.putParamToState(a,b)};m.FreeConic.getParamForInput=function(a,b,c){return h.normalizeMax(b)};m.FreeConic.getParamFromState=function(a){return m._helper.buildConicMatrix(W(6).value)};m.FreeConic.putParamToState=
function(a,b){for(var c=0;3>c;++c)for(var d=0;d<=c;++d)ab(b.value[c].value[d])};m.FreeConic.updatePosition=function(a){var b=W(6);T(b);a.matrix=m._helper.buildConicMatrix(b.value);a.matrix=h.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};m.FreeConic.set_matrix=function(a,b){h._helper.isNumberMatrixMN(b,3,3)&&Aa(a,h.add(b,h.transpose(b)),"matrix")};m.FreeConic.stateSize=12;m._helper.buildConicMatrix=function(a){var b=a[1],c=a[2],d=a[3],e=a[4],g=a[5];return h.turnIntoCSList([h.turnIntoCSList([a[0],
b,d]),h.turnIntoCSList([b,c,e]),h.turnIntoCSList([d,e,g])])};m._helper.flattenConicMatrix=function(a){return h.turnIntoCSList([a.value[0].value[0],a.value[0].value[1],a.value[1].value[1],a.value[0].value[2],a.value[1].value[2],a.value[2].value[2]])};m._helper.splitDegenConic=function(a){var b=h.adjoint3(a),c=0,d,e,g=l.abs2(b.value[0].value[0]).value.real;for(d=1;3>d;d++)e=l.abs2(b.value[d].value[d]).value.real,e>g&&(c=d,g=e);d=l.sqrt(l.mult(l.real(-1),b.value[c].value[c]));if(1E-16>l.abs2(d).value.real)return a=
h.turnIntoCSList([l.zero,l.zero,l.zero]),[a,a];c=l.real(c+1);e=h.column(b,c);e=h.scaldiv(d,e);d=e.value[0];g=e.value[1];e=e.value[2];d=h.turnIntoCSList([h.turnIntoCSList([l.real(0),e,l.mult(l.real(-1),g)]),h.turnIntoCSList([l.mult(l.real(-1),e),l.real(0),d]),h.turnIntoCSList([g,l.mult(l.real(-1),d),l.real(0)])]);a=h.add(a,d);var k=0;for(d=g=b=0;3>d;d++)for(c=0;3>c;c++)e=l.abs2(a.value[d].value[c]).value.real,e>g&&(k=d,b=c,g=e);d=a.value[k];a=h.transpose(a);a=a.value[b];d=h.normalizeMax(d);a=h.normalizeMax(a);
d=w.withUsage(d,"Line");a=w.withUsage(a,"Line");return[d,a]};m._helper.inputConic=function(a){var b="xx xy yy xz yz zz".split(" ").map(function(b){var d=l._helper.input(a[b]);b[0]!==b[1]&&(d=l.realmult(.5,d));return d});return m._helper.buildConicMatrix(b)};m.SelectConic={};m.SelectConic.kind="C";m.SelectConic.signature=["Cs"];m.SelectConic.initialize=function(a){if(void 0!==a.index)return a.index-1;var b=m._helper.inputConic(a.pos);a=u.csnames[a.args[0]].results;for(var c=h.conicDist(b,a[0]),d=0,
e=1;e<a.length;++e){var g=h.conicDist(b,a[e]);g<c&&(c=g,d=e)}return d};m.SelectConic.updatePosition=function(a){a.matrix=u.csnames[a.args[0]].results[a.param];a.matrix=h.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};m._helper.ConicBy4p1l=function(a,b,c,d,e,g){var k=h.scalproduct(b,g),n=h.scalproduct(c,g),q=h.scalproduct(d,g),r=h.scalproduct(e,g),u=h.det3(c,d,e),t=h.det3(b,c,e),v=h.det3(b,d,e),w=h.det3(b,c,d),x=l.mult,n=l.sqrt(x(x(n,r),x(u,t))),k=l.sqrt(x(x(k,q),x(v,w))),q=h.cross(h.cross(b,
d),g);g=h.cross(h.cross(c,e),g);q=h.scalmult(n,q);k=h.scalmult(k,g);g=h.normalizeMax(h.add(q,k));k=h.normalizeMax(h.sub(q,k));k=Oa(g,k);g=m._helper.ConicBy5(a,b,c,d,e,k.value[0]);a=m._helper.ConicBy5(a,b,c,d,e,k.value[1]);return[h.normalizeMax(g),h.normalizeMax(a)]};m.ConicBy4p1l={};m.ConicBy4p1l.kind="Cs";m.ConicBy4p1l.signature=["P","P","P","P","L"];m.ConicBy4p1l.updatePosition=function(a){var b=m._helper.ConicBy4p1l(a,u.csnames[a.args[0]].homog,u.csnames[a.args[1]].homog,u.csnames[a.args[2]].homog,
u.csnames[a.args[3]].homog,u.csnames[a.args[4]].homog);a.results=b};m.ConicBy4p1l.stateSize=Oa.stateSize;m._helper.ConicBy3p2l=function(a,b,c,d,e){function g(a,b,c,d){return l.sub(l.mult(a,d),l.mult(b,c))}var k=h.cross(a,b),m=h.cross(d,e);d=h.cross(d,k);e=h.cross(e,k);k=h.turnIntoCSList([d,e,m]);c=h.productVM(c,h.adjoint3(k));m=h.adjoint3(h.turnIntoCSList([h.scalmult(c.value[0],d),h.scalmult(c.value[1],e),h.scalmult(c.value[2],m)]));c=h.transpose(m);d=l.mult;e=h.productMV(c,a);a=e.value[0];e=e.value[1];
k=h.productMV(c,b);b=k.value[0];var k=k.value[1],n=l.sqrt(d(a,e)),q=l.sqrt(d(b,k)),r,u=Array(4);for(r=0;4>r;++r){var t=(r&2)-1,v=d(l.real(((r&1)<<1)-1),n),w=d(l.real(t),q),x=g(e,v,k,w),y=g(b,w,a,v),t=g(a,e,b,k),z=l.add(l.add(g(b,k,a,e),g(k,w,e,v)),g(w,b,v,a)),v=d(x,x),w=d(y,y),A=d(z,z),B=d(x,y),x=d(x,z),y=d(y,z),B=l.sub(B,d(l.real(.5),d(t,t))),t=h.turnIntoCSList([h.turnIntoCSList([v,B,x]),h.turnIntoCSList([B,w,y]),h.turnIntoCSList([x,y,A])]),t=h.productMM(m,h.productMM(t,c)),t=h.turnIntoCSList([t.value[0].value[0],
t.value[0].value[1],t.value[0].value[2],t.value[1].value[1],t.value[1].value[2],t.value[2].value[2]]);u[r]=t}return u};m.ConicBy3p2l={};m.ConicBy3p2l.kind="Cs";m.ConicBy3p2l.signature=["P","P","P","L","L"];m.ConicBy3p2l.updatePosition=function(a){for(var b=m._helper.ConicBy3p2l(u.csnames[a.args[0]].homog,u.csnames[a.args[1]].homog,u.csnames[a.args[2]].homog,u.csnames[a.args[3]].homog,u.csnames[a.args[4]].homog),b=Ld(b),c=Array(4),d=0;4>d;++d){var e=b[d].value;c[d]=h.turnIntoCSList([h.turnIntoCSList([e[0],
e[1],e[2]]),h.turnIntoCSList([e[1],e[3],e[4]]),h.turnIntoCSList([e[2],e[4],e[5]])])}a.results=c};m.ConicBy3p2l.stateSize=48;m.ConicBy2p3l={};m.ConicBy2p3l.kind="Cs";m.ConicBy2p3l.signature=["P","P","L","L","L"];m.ConicBy2p3l.updatePosition=function(a){for(var b=m._helper.ConicBy3p2l(u.csnames[a.args[2]].homog,u.csnames[a.args[3]].homog,u.csnames[a.args[4]].homog,u.csnames[a.args[0]].homog,u.csnames[a.args[1]].homog),b=Ld(b),c=Array(4),d=0;4>d;++d){var e=b[d].value,e=h.turnIntoCSList([h.turnIntoCSList([e[0],
e[1],e[2]]),h.turnIntoCSList([e[1],e[3],e[4]]),h.turnIntoCSList([e[2],e[4],e[5]])]);c[d]=h.normalizeMax(h.adjoint3(e))}a.results=c};m.ConicBy2p3l.stateSize=48;m.ConicBy1p4l={};m.ConicBy1p4l.kind="Cs";m.ConicBy1p4l.signature=["P","L","L","L","L"];m.ConicBy1p4l.updatePosition=function(a){var b=m._helper.ConicBy4p1l(a,u.csnames[a.args[1]].homog,u.csnames[a.args[2]].homog,u.csnames[a.args[3]].homog,u.csnames[a.args[4]].homog,u.csnames[a.args[0]].homog),c=b[0],b=b[1],c=h.adjoint3(c),b=h.adjoint3(b),b=
[c,b];a.results=b};m.ConicBy1p4l.stateSize=Oa.stateSize;m.ConicParabolaPL={};m.ConicParabolaPL.kind="C";m.ConicParabolaPL.signature=["P","L"];m.ConicParabolaPL.updatePosition=function(a){var b=u.csnames[a.args[0]].homog.value,c=u.csnames[a.args[1]].homog.value,d=l.mult,e=l.neg,g=l.add,k=l.sub,n=b[0],q=b[1],r=b[2],t=c[0],b=c[1],c=c[2],v=d(r,r),x=d(t,t),y=d(b,b),z=d(r,c),A=e(r),r=g(x,y),y=d(v,y),x=d(v,x),e=d(e(v),d(t,b)),t=d(A,g(d(n,r),d(z,t))),b=d(A,g(d(q,r),d(z,b))),d=k(d(g(d(n,n),d(q,q)),r),d(v,
d(c,c))),d=m._helper.buildConicMatrix([y,e,x,t,b,d]),d=h.normalizeMax(d);a.matrix=w.withUsage(d,"Conic")};m.ConicBy2Foci1P={};m.ConicBy2Foci1P.kind="Cs";m.ConicBy2Foci1P.signature=["P","P","P"];m.ConicBy2Foci1P.updatePosition=function(a){var b=u.csnames[a.args[0]].homog,c=u.csnames[a.args[1]].homog,d=u.csnames[a.args[2]].homog,e=h.ii,g=h.jj,k=h.normalizeMax(h.cross(b,d)),n=h.normalizeMax(h.cross(c,d)),q=h.normalizeMax(h.cross(d,e)),d=h.normalizeMax(h.cross(d,g)),n=m._helper.coHarmonic(q,d,k,n),k=
h.normalizeMax(n[0]),n=h.normalizeMax(n[1]),e=h.turnIntoCSList([e]),q=h.turnIntoCSList([g]),d=h.turnIntoCSList([b]),r=h.turnIntoCSList([c]),g=m._helper.conicFromTwoDegenerates(e,q,d,r,k),g=h.normalizeMax(g),e=m._helper.conicFromTwoDegenerates(e,q,d,r,n),e=h.normalizeMax(e),g=h.normalizeMax(h.adjoint3(g)),e=h.normalizeMax(h.adjoint3(e));"ellipsoid"!==m._helper.getConicType(g)&&(k=g,g=e,e=k);h.almostequals(b,c).value&&(b=l.real(3),e=h.zeromatrix(b,b));a.results=[g,e]};m.ConicBy2Pol1P={};m.ConicBy2Pol1P.kind=
"C";m.ConicBy2Pol1P.signature=["P","L","P","L","P"];m.ConicBy2Pol1P.updatePosition=function(a){var b=u.csnames[a.args[0]].homog,c=u.csnames[a.args[1]].homog,d=u.csnames[a.args[2]].homog,e=u.csnames[a.args[3]].homog,g=u.csnames[a.args[4]].homog,k=h.scalproduct,m=h.scalmult,n=h.sub,q=h.productMM,r=l.realmult,t=h.transpose,v=h.turnIntoCSList,x=n(m(k(c,b),g),m(r(2,k(c,g)),b)),y=n(m(k(e,d),g),m(r(2,k(e,g)),d)),z=v([h.cross(b,g)]),g=v([h.cross(d,g)]),y=q(t(z),v([h.cross(b,y)])),v=q(t(g),v([h.cross(d,x)])),
q=q(t(z),g),b=k(b,e),c=k(d,c),d=h.add(m(c,y),m(b,v)),d=n(d,m(r(2,l.mult(b,c)),q)),d=h.add(d,t(d)),d=h.normalizeMax(d),d=w.withUsage(d,"Conic");a.matrix=d};m.ConicBy2Pol1L={};m.ConicBy2Pol1L.kind="C";m.ConicBy2Pol1L.signature=["P","L","P","L","L"];m.ConicBy2Pol1L.updatePosition=function(a){var b=u.csnames[a.args[0]].homog,c=u.csnames[a.args[1]].homog,d=u.csnames[a.args[2]].homog,e=u.csnames[a.args[3]].homog,g=u.csnames[a.args[4]].homog,k=h.scalproduct,m=h.scalmult,n=h.productMM,q=l.mult,r=h.transpose,
t=h.turnIntoCSList,v=k(c,b),x=k(c,d),y=k(e,b),z=k(e,d),A=k(g,b),k=k(g,d),B=t([h.sub(m(q(y,k),c),m(q(x,A),e))]),b=h.add(n(r(t([m(q(y,x),g)])),t([h.sub(h.add(m(l.sub(q(v,k),q(x,A)),e),m(l.sub(q(z,A),q(y,k)),c)),m(h.det3(c,e,g),h.cross(b,d)))])),n(r(B),B)),b=h.add(b,r(b)),b=h.normalizeMax(b),b=w.withUsage(b,"Conic");a.matrix=b};m._helper.conic1Pol3Inc=function(a,b,c,d,e){var g=h.scalproduct,k=h.scalmult,m=h.productMM,n=h.cross,q=l.realmult,r=l.mult,t=h.transpose,u=h.turnIntoCSList,v=h.det3,w=v(a,c,d),
x=u([n(c,e)]),y=u([n(a,e)]),z=u([n(c,d)]),A=g(b,a),B=g(b,c);b=g(b,e);n=u([n(d,h.sub(k(A,e),k(q(2,b),a)))]);x=k(w,m(t(x),n));a=q(2,l.add(r(v(a,d,e),B),r(w,b)));a=l.sub(r(v(c,d,e),A),a);x=h.add(x,k(a,m(t(y),z)));x=h.add(x,t(x));return x=h.normalizeMax(x)};m.ConicBy1Pol3P={};m.ConicBy1Pol3P.kind="C";m.ConicBy1Pol3P.signature=["P","L","P","P","P"];m.ConicBy1Pol3P.updatePosition=function(a){var b=m._helper.conic1Pol3Inc(u.csnames[a.args[0]].homog,u.csnames[a.args[1]].homog,u.csnames[a.args[2]].homog,u.csnames[a.args[3]].homog,
u.csnames[a.args[4]].homog),b=w.withUsage(b,"Conic");a.matrix=b};m.ConicBy1Pol3L={};m.ConicBy1Pol3L.kind="C";m.ConicBy1Pol3L.signature=["P","L","L","L","L"];m.ConicBy1Pol3L.updatePosition=function(a){var b=m._helper.conic1Pol3Inc(u.csnames[a.args[1]].homog,u.csnames[a.args[0]].homog,u.csnames[a.args[2]].homog,u.csnames[a.args[3]].homog,u.csnames[a.args[4]].homog),b=h.normalizeMax(h.adjoint3(b)),b=w.withUsage(b,"Conic");a.matrix=b};m.ConicBy1Pol2P1L={};m.ConicBy1Pol2P1L.kind="Cs";m.ConicBy1Pol2P1L.signature=
["P","L","P","P","L"];m.ConicBy1Pol2P1L.updatePosition=function(a){var b=u.csnames[a.args[0]].homog,c=u.csnames[a.args[1]].homog,d=u.csnames[a.args[2]].homog,e=u.csnames[a.args[3]].homog,g=u.csnames[a.args[4]].homog,k=l.add,m=h.turnIntoCSList,n=h.cross,q=h.productMM,r=l.mult,t=l.realmult,v=h.scalmult,w=h.scalproduct,x=l.sub,y=h.transpose,z=w(c,b),A=w(c,d),B=w(c,e),c=w(g,b),C=w(g,d),w=w(g,e),g=m([n(b,d)]),b=m([n(b,e)]),d=m([n(d,e)]),e=l.sqrt(r(r(C,w),r(x(r(z,C),t(2,r(c,A))),x(r(z,w),t(2,r(c,B)))))),
m=q(y(g),b),e=v(e,h.add(m,y(m))),k=v(x(r(z,r(C,w)),k(r(c,r(A,w)),r(c,r(C,B)))),m),t=h.add(h.sub(v(B,g),v(A,b)),v(t(.5,z),d)),k=h.add(k,v(r(c,c),q(y(d),t))),k=h.add(k,y(k)),q=h.normalizeMax(h.add(e,k)),r=h.normalizeMax(h.sub(e,k));a.results=Sb(q,r).value};m.ConicBy1Pol2P1L.stateSize=Sb.stateSize;m.ConicBy1Pol1P2L={};m.ConicBy1Pol1P2L.kind="Cs";m.ConicBy1Pol1P2L.signature=["P","L","P","L","L"];m.ConicBy1Pol1P2L.updatePosition=function(a){var b=u.csnames[a.args[0]].homog,c=u.csnames[a.args[1]].homog,
d=u.csnames[a.args[2]].homog,e=u.csnames[a.args[3]].homog,g=u.csnames[a.args[4]].homog,k=l.add,m=h.turnIntoCSList,n=h.cross,q=h.productMM,r=l.mult,t=l.realmult,v=h.scalmult,w=h.scalproduct,x=l.sub,y=h.transpose,z=w(c,b),A=w(c,d),B=w(e,b),C=w(e,d),D=w(g,b),E=w(g,d),F=r(z,z),G=r(z,A),w=r(A,A),H=r(B,B),K=r(B,C),L=r(C,C),N=r(D,D),I=r(D,E),M=r(E,E),J=r(r(F,L),M),J=x(J,t(2,r(r(G,K),M))),J=x(J,t(2,r(r(G,L),I))),J=k(J,t(.5,r(r(w,H),M))),J=k(J,t(3,r(r(w,K),I))),J=k(J,t(.5,r(r(w,L),N))),I=r(r(z,C),E),I=x(I,
r(r(A,B),E)),I=x(I,r(r(A,C),D)),I=r(I,r(w,D)),M=x(r(z,C),t(2,r(A,B))),M=r(M,r(w,r(C,D))),J=q(y(m([c])),m([h.add(h.add(v(J,c),v(I,e)),v(M,g))])),I=m([e]),J=h.add(J,v(t(.5,r(r(w,w),N)),q(y(I),I))),J=h.add(J,v(w,q(y(m([g])),m([h.add(v(x(x(t(2,r(G,K)),r(F,L)),t(.5,r(w,H))),g),v(r(h.det3(c,e,g),x(r(z,C),r(A,B))),n(b,d)))])))),J=h.add(J,y(J)),b=l.sqrt(r(r(C,E),r(x(r(z,C),t(2,r(A,B))),x(r(z,E),t(2,r(A,D)))))),c=q(y(m([c])),m([h.sub(v(x(r(A,k(r(B,E),r(C,D))),r(z,r(C,E))),c),v(w,h.add(v(D,e),v(B,g))))])),
c=h.add(c,v(r(z,w),q(y(m([e])),m([g])))),c=v(b,c),c=h.add(c,y(c)),e=h.normalizeMax(h.add(J,c)),g=h.normalizeMax(h.sub(J,c));a.results=Sb(e,g).value};m.ConicBy1Pol1P2L.stateSize=Sb.stateSize;m._helper.coHarmonic=function(a,b,c,d){var e=h.realVector([100*Math.random(),100*Math.random(),1]),g=h.det3(e,c,a),k=h.det3(e,c,b);c=h.det3(e,d,a);d=h.det3(e,d,b);d=l.sqrt(l.mult(d,k));g=l.sqrt(l.mult(c,g));a=w.mult(a,d);g=w.mult(b,g);b=h.add(a,g);a=h.sub(a,g);return[b,a]};m.ConicInSquare={};m.ConicInSquare.kind=
"C";m.ConicInSquare.signature=["P","P","P","P"];m.ConicInSquare.updatePosition=function(a){var b=D.basismap(u.csnames[a.args[0]].homog,u.csnames[a.args[1]].homog,u.csnames[a.args[2]].homog,u.csnames[a.args[3]].homog),c=l.one,c=m._helper.buildConicMatrix([c,c,c,l.real(-3),c,c]),b=h.adjoint3(b),b=h.productMM(h.productMM(h.transpose(b),c),b),b=h.normalizeMax(b);a.matrix=w.withUsage(b,"Conic")};m.ConicBy5lines={};m.ConicBy5lines.kind="C";m.ConicBy5lines.signature=["L","L","L","L","L"];m.ConicBy5lines.updatePosition=
function(a){var b=m._helper.ConicBy5(a,u.csnames[a.args[0]].homog,u.csnames[a.args[1]].homog,u.csnames[a.args[2]].homog,u.csnames[a.args[3]].homog,u.csnames[a.args[4]].homog),b=h.adjoint3(b);a.matrix=b;a.matrix=h.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};m.ConicFromPrincipalDirections={};m.ConicFromPrincipalDirections.kind="C";m.ConicFromPrincipalDirections.signature=["P","P","P"];m.ConicFromPrincipalDirections.updatePosition=function(a){var b=u.csnames[a.args[0]].homog,c=u.csnames[a.args[1]].homog,
d=u.csnames[a.args[2]].homog,e=m._helper.pointReflection(b,c),g=h.cross(c,b),b=h.turnIntoCSList([g.value[0],g.value[1],l.zero]),g=h.turnIntoCSList([g]),c=h.turnIntoCSList([h.cross(c,b)]),e=h.turnIntoCSList([h.cross(e,b)]);a.matrix=m._helper.conicFromTwoDegenerates(g,g,c,e,d);a.matrix=h.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};m.CircleBy3={};m.CircleBy3.kind="C";m.CircleBy3.signature=["P","P","P"];m.CircleBy3.updatePosition=function(a){var b=m._helper.ConicBy5(a,u.csnames[a.args[0]].homog,
u.csnames[a.args[1]].homog,h.ii,h.jj,u.csnames[a.args[2]].homog);a.matrix=h.normalizeMax(b);a.matrix=w.withUsage(a.matrix,"Circle")};m.ArcBy3={};m.ArcBy3.kind="C";m.ArcBy3.signature=["P","P","P"];m.ArcBy3.updatePosition=function(a){m.CircleBy3.updatePosition(a);a.startPoint=u.csnames[a.args[0]].homog;a.viaPoint=u.csnames[a.args[1]].homog;a.endPoint=u.csnames[a.args[2]].homog};m.ArcBy3.initialize=function(a){a.startPoint=u.csnames[a.args[0]].homog;a.viaPoint=u.csnames[a.args[1]].homog;a.endPoint=u.csnames[a.args[2]].homog;
a.isArc=!0};m.PolarOfPoint={};m.PolarOfPoint.kind="L";m.PolarOfPoint.signature=["P","C"];m.PolarOfPoint.updatePosition=function(a){var b=w.mult(u.csnames[a.args[1]].matrix,u.csnames[a.args[0]].homog),b=h.normalizeMax(b);a.homog=w.withUsage(b,"Line")};m.PolarOfLine={};m.PolarOfLine.kind="P";m.PolarOfLine.signature=["L","C"];m.PolarOfLine.updatePosition=function(a){var b=u.csnames[a.args[0]],c=h.adjoint3(u.csnames[a.args[1]].matrix),b=w.mult(c,b.homog),b=h.normalizeMax(b);a.homog=w.withUsage(b,"Point")};
m.AngleBisector={};m.AngleBisector.kind="Ls";m.AngleBisector.signature=["L","L","P"];m.AngleBisector.updatePosition=function(a){var b=u.csnames[a.args[0]].homog,c=u.csnames[a.args[1]].homog,d=u.csnames[a.args[2]].homog,e=h.add,g=h.sub,k=h.abs,l=h.cross,m=h.scalmult,n=h.normalizeMax,q=h._helper.isAlmostZero,r=h.linfty,t=m(k(l(l(r,c),r)),b),b=m(k(l(l(r,b),r)),c),g=g(t,b),e=e(t,b);q(g)&&(g=l(l(l(r,e),r),d));q(e)&&(e=l(l(l(r,g),r),d));a.results=Oa(n(g),n(e))};m.AngleBisector.stateSize=Oa.stateSize;m._helper.IntersectLC=
function(a,b){var c=l,d=h.crossOperator(a),e=h.transpose(d),e=w.mult(e,w.mult(b,d)),g=h.maxIndex(a,l.abs2),k,m,n,q;0===g?(g=e.value[1].value[1],k=e.value[1].value[2],m=e.value[2].value[1],n=e.value[2].value[2],q=a.value[0]):1===g?(g=e.value[0].value[0],k=e.value[0].value[2],m=e.value[2].value[0],n=e.value[2].value[2],q=a.value[1]):(g=e.value[0].value[0],k=e.value[0].value[1],m=e.value[1].value[0],n=e.value[1].value[1],q=a.value[2]);c=c.div(c.sqrt(c.sub(c.mult(k,m),c.mult(g,n))),q);c=h.add(e,h.scalmult(c,
d));g=h.maxIndex(c,h.abs2);d=c.value[g];d=h.normalizeMax(d);d=w.withUsage(d,"Point");c=h.transpose(c);g=h.maxIndex(c,h.abs2);c=c.value[g];c=h.normalizeMax(c);c=w.withUsage(c,"Point");return[d,c]};m.IntersectLC={};m.IntersectLC.kind="Ps";m.IntersectLC.signature=["L","C"];m.IntersectLC.updatePosition=function(a){var b=m._helper.IntersectLC(u.csnames[a.args[0]].homog,u.csnames[a.args[1]].matrix);a.results=Oa(b[0],b[1])};m.IntersectLC.stateSize=Oa.stateSize;m.OtherIntersectionCL={};m.OtherIntersectionCL.kind=
"P";m.OtherIntersectionCL.signature=["C","L","P"];m.OtherIntersectionCL.updatePosition=function(a){var b=u.csnames[a.args[2]].homog,c=m._helper.IntersectLC(u.csnames[a.args[1]].homog,u.csnames[a.args[0]].matrix),d=c[0],c=c[1],e=h.projectiveDistMinScal(d,b),b=h.projectiveDistMinScal(c,b);a.homog=e<b?c:d;a.homog=h.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};m.IntersectCirCir={};m.IntersectCirCir.kind="Ps";m.IntersectCirCir.signature=["C","C"];m.IntersectCirCir.updatePosition=function(a){var b=
u.csnames[a.args[0]].matrix,c=u.csnames[a.args[1]].matrix,d=h.scalmult(c.value[0].value[0],b.value[2]),c=h.scalmult(b.value[0].value[0],c.value[2]),d=h.sub(d,c),d=h.turnIntoCSList([d.value[0],d.value[1],l.realmult(.5,d.value[2])]),d=h.normalizeMax(d),b=m._helper.IntersectLC(d,b);a.results=Oa(b[0],b[1])};m.IntersectCirCir.stateSize=Oa.stateSize;m.OtherIntersectionCC={};m.OtherIntersectionCC.kind="P";m.OtherIntersectionCC.signature=["C","C","P"];m.OtherIntersectionCC.updatePosition=function(a){var b=
u.csnames[a.args[0]].matrix,c=u.csnames[a.args[1]].matrix,d=u.csnames[a.args[2]].homog,e=h.scalmult(c.value[0].value[0],b.value[2]),c=h.scalmult(b.value[0].value[0],c.value[2]),e=h.sub(e,c),e=h.turnIntoCSList([e.value[0],e.value[1],l.realmult(.5,e.value[2])]),e=h.normalizeMax(e),e=m._helper.IntersectLC(e,b),b=e[0],e=e[1],c=h.projectiveDistMinScal(b,d),d=h.projectiveDistMinScal(e,d);a.homog=c<d?e:b;a.homog=h.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};m._helper.IntersectConicConic=
function(a,b){var c=a.value[0],d=a.value[1],e=a.value[2],g=b.value[0],k=b.value[1],n=b.value[2],q=h.det3(c,d,e),r=l.add(l.add(h.det3(c,d,n),h.det3(c,k,e)),h.det3(g,d,e)),c=l.add(l.add(h.det3(c,k,n),h.det3(g,d,n)),h.det3(g,k,e)),g=h.det3(g,k,n),n=l.abs2(q).value.real,k=l.abs2(g).value.real;n<k&&(n=a,a=b,b=n,n=g,g=q,q=n,n=c,c=r,r=n,n=k);1E-24>n?(q=a,c=b):(r=l.solveCubic(q,r,c,g),c=l.abs2(l.sub(r[0],r[1])).value.real,g=l.abs2(l.sub(r[0],r[2])).value.real,k=l.abs2(l.sub(r[1],r[2])).value.real,c>g?(q=
r[1],r=c>k?r[0]:r[2]):(q=r[2],r=g>k?r[0]:r[1]),q=h.add(h.scalmult(q,a),b),c=h.add(h.scalmult(r,a),b));r=m._helper.splitDegenConic(q);q=r[0];r=r[1];c=m._helper.splitDegenConic(c);k=c[0];g=c[1];c=h.cross(q,k);k=h.cross(r,k);q=h.cross(q,g);r=h.cross(r,g);c=h.normalizeMax(c);k=h.normalizeMax(k);q=h.normalizeMax(q);r=h.normalizeMax(r);c=w.withUsage(c,"Point");k=w.withUsage(k,"Point");q=w.withUsage(q,"Point");r=w.withUsage(r,"Point");return[c,k,q,r]};m.IntersectConicConic={};m.IntersectConicConic.kind=
"Ps";m.IntersectConicConic.signature=["C","C"];m.IntersectConicConic.updatePosition=function(a){var b=m._helper.IntersectConicConic(u.csnames[a.args[0]].matrix,u.csnames[a.args[1]].matrix),b=Hc(b[0],b[1],b[2],b[3]);a.results=b};m.IntersectConicConic.stateSize=Hc.stateSize;m.SelectP={};m.SelectP.kind="P";m.SelectP.signature=["Ps"];m.SelectP.initialize=function(a){if(void 0!==a.index)return a.index-1;var b=u.csnames[a.args[0]].results.value;a=m._helper.initializePoint(a);for(var c=h.projectiveDistMinScal(a,
b[0]),d=0,e=1;e<b.length;++e){var g=h.projectiveDistMinScal(a,b[e]);g<c&&(c=g,d=e)}return d};m.SelectP.updatePosition=function(a){a.homog=u.csnames[a.args[0]].results.value[a.param]};m.SelectL={};m.SelectL.kind="L";m.SelectL.signature=["Ls"];m.SelectL.initialize=function(a){if(void 0!==a.index)return a.index-1;var b=u.csnames[a.args[0]].results.value;a=m._helper.initializeLine(a);for(var c=h.projectiveDistMinScal(a,b[0]),d=0,e=1;e<b.length;++e){var g=h.projectiveDistMinScal(a,b[e]);g<c&&(c=g,d=e)}return d};
m.SelectL.updatePosition=function(a){a.homog=u.csnames[a.args[0]].results.value[a.param];a.homog=w.withUsage(a.homog,"Line")};m._helper.moebiusStep=function(a,b,c){var d=l.add,e=l.sub,g=l.mult,h=a.value[0],k=a.value[1];a=a.value[2];var m=b.value[0],n=b.value[1];b=b.value[2];var q=c.value[0],r=c.value[1],t=c.value[2];c=e(g(b,q),g(m,t));var u=e(g(b,r),g(n,t)),q=e(g(h,t),g(a,q)),r=e(g(k,t),g(a,r));return[e(g(h,c),g(k,u)),d(g(k,c),g(h,u)),g(a,c),g(a,u),e(g(m,q),g(n,r)),d(g(n,q),g(m,r)),g(b,q),g(b,r)]};
m.TrMoebius={};m.TrMoebius.kind="Mt";m.TrMoebius.signature="PPPPPP".split("");m.TrMoebius.updatePosition=function(a){var b=l.neg,c=m._helper.moebiusStep(u.csnames[a.args[0]].homog,u.csnames[a.args[2]].homog,u.csnames[a.args[4]].homog),d=m._helper.moebiusStep(u.csnames[a.args[1]].homog,u.csnames[a.args[3]].homog,u.csnames[a.args[5]].homog),d=h.normalizeMax(h.matrix([[d[0],b(d[1]),d[4],b(d[5])],[d[1],d[0],d[5],d[4]],[d[2],b(d[3]),d[6],b(d[7])],[d[3],d[2],d[7],d[6]]])),b=h.normalizeMax(h.matrix([[c[6],
b(c[4])],[c[7],b(c[5])],[b(c[2]),c[0]],[b(c[3]),c[1]]])),b=h.normalizeMax(h.productMM(d,b));a.moebius={anti:!1,ar:b.value[0].value[0],ai:b.value[1].value[0],br:b.value[0].value[1],bi:b.value[1].value[1],cr:b.value[2].value[0],ci:b.value[3].value[0],dr:b.value[2].value[1],di:b.value[3].value[1]};m._helper.moebiusPair(a)};m._helper.moebiusPair=function(a){var b=a.moebius,c=l.neg,d=b.anti?c:w.identity,b=h.normalizeMax(h.turnIntoCSList([h.matrix([[c(b.cr),d(b.ci),c(b.dr)],[b.ci,d(b.cr),b.di],[b.ar,c(d(b.ai)),
b.br]]),h.matrix([[c(b.ci),c(d(b.cr)),c(b.di)],[c(b.cr),d(b.ci),c(b.dr)],[b.ai,d(b.ar),b.bi]])]));a.mat1=b.value[0];a.mat2=b.value[1]};m._helper.inverseMoebius=function(a){var b=l.neg,c=a.anti?b:w.identity;return{anti:a.anti,ar:a.dr,ai:c(a.di),br:b(a.br),bi:b(c(a.bi)),cr:b(a.cr),ci:b(c(a.ci)),dr:a.ar,di:c(a.ai)}};m.TrInverseMoebius={};m.TrInverseMoebius.kind="Mt";m.TrInverseMoebius.signature=["Mt"];m.TrInverseMoebius.updatePosition=function(a){a.moebius=m._helper.inverseMoebius(u.csnames[a.args[0]].moebius);
m._helper.moebiusPair(a)};m.TrMoebiusP={};m.TrMoebiusP.kind="P";m.TrMoebiusP.signature=["Mt","P"];m.TrMoebiusP.updatePosition=function(a){var b=u.csnames[a.args[0]],c=u.csnames[a.args[1]].homog,d=h.productMV(b.mat1,c),b=h.productMV(b.mat2,c);a.homog=h.normalizeMax(h.cross(d,b));a.homog=w.withUsage(a.homog,"Point")};m._helper.TrMoebiusP=function(a,b){var c=h.productMV(b.mat1,a),d=h.productMV(b.mat2,a);return h.normalizeMax(h.cross(c,d))};m.TrMoebiusL={};m.TrMoebiusL.kind="C";m.TrMoebiusL.signature=
["Mt","L"];m.TrMoebiusL.updatePosition=function(a){var b=u.csnames[a.args[0]],c=u.csnames[a.args[1]].homog,d=function(){var a=h.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);return h.normalizeMax(a)},e=h.cross(d(),c),g=h.cross(d(),c),c=h.cross(d(),c),e=m._helper.TrMoebiusP(e,b),g=m._helper.TrMoebiusP(g,b),b=m._helper.TrMoebiusP(c,b);a.matrix=h.normalizeMax(m._helper.ConicBy5(null,e,g,b,h.ii,h.jj));a.matrix=w.withUsage(a.matrix,"Circle")};m.TrMoebiusS={};m.TrMoebiusS.kind="C";m.TrMoebiusS.signature=
["Mt","S"];m.TrMoebiusS.updatePosition=function(a){var b=u.csnames[a.args[0]],c=u.csnames[a.args[1]],d=c.startpos,c=c.endpos,e=h.add(d,c),d=m._helper.TrMoebiusP(d,b),e=m._helper.TrMoebiusP(e,b),b=m._helper.TrMoebiusP(c,b);a.startPoint=d;a.viaPoint=e;a.endPoint=b;a.isArc=!0;a.matrix=h.normalizeMax(m._helper.ConicBy5(null,d,e,b,h.ii,h.jj));a.matrix=w.withUsage(a.matrix,"Circle")};m.TrMoebiusC={};m.TrMoebiusC.kind="C";m.TrMoebiusC.signature=["Mt","C"];m.TrMoebiusC.signatureConstraints=function(a){return"Circle"===
u.csnames[a.args[1]].matrix.usage};m.TrMoebiusC.updatePosition=function(a){var b=u.csnames[a.args[0]],c=u.csnames[a.args[1]].matrix,d=function(){var a=h.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);return h.normalizeMax(a)},e=m._helper.IntersectLC(d(),c),d=m._helper.IntersectLC(d(),c),c=e[1],d=d[1],e=m._helper.TrMoebiusP(e[0],b),c=m._helper.TrMoebiusP(c,b),b=m._helper.TrMoebiusP(d,b);a.matrix=h.normalizeMax(m._helper.ConicBy5(null,e,c,b,h.ii,h.jj));a.matrix=w.withUsage(a.matrix,
"Circle")};m.TrMoebiusArc={};m.TrMoebiusArc.kind="C";m.TrMoebiusArc.signature=["Mt","C"];m.TrMoebiusArc.signatureConstraints=function(a){return u.csnames[a.args[1]].isArc};m.TrMoebiusArc.updatePosition=function(a){var b=u.csnames[a.args[0]],c=u.csnames[a.args[1]],d=c.viaPoint,e=c.endPoint,c=m._helper.TrMoebiusP(c.startPoint,b),d=m._helper.TrMoebiusP(d,b),b=m._helper.TrMoebiusP(e,b);a.startPoint=c;a.viaPoint=d;a.endPoint=b;a.isArc=!0;a.matrix=h.normalizeMax(m._helper.ConicBy5(null,c,d,b,h.ii,h.jj));
a.matrix=w.withUsage(a.matrix,"Circle")};m._helper.trBuildMatrix=function(a,b){var c=b(0),d=b(1),e=h.productMM(d,h.adjoint3(c));a.matrix=h.normalizeMax(e);e=h.transpose(h.productMM(c,h.adjoint3(d)));a.dualMatrix=h.normalizeMax(e)};m.TrProjection={};m.TrProjection.kind="Tr";m.TrProjection.signature="PPPPPPPP".split("");m.TrProjection.initialize=function(a){a.isEuclidean=0};m.TrProjection.updatePosition=function(a){m._helper.trBuildMatrix(a,function(b){return D.basismap(u.csnames[a.args[0+b]].homog,
u.csnames[a.args[2+b]].homog,u.csnames[a.args[4+b]].homog,u.csnames[a.args[6+b]].homog)})};m.TrAffine={};m.TrAffine.kind="Tr";m.TrAffine.signature="PPPPPP".split("");m.TrAffine.initialize=function(a){a.isEuclidean=0};m.TrAffine.updatePosition=function(a){var b=l.mult,c=h.scalmult,d=h.turnIntoCSList,e=h.transpose,g=h.normalizeMax,k=h.productMM,m=h.adjoint3,n=d([u.csnames[a.args[0]].homog,u.csnames[a.args[2]].homog,u.csnames[a.args[4]].homog]),q=d([u.csnames[a.args[1]].homog,u.csnames[a.args[3]].homog,
u.csnames[a.args[5]].homog]),r=e(n),e=e(q),t=r.value[2].value,v=e.value[2].value,w=[b(t[0],v[2]),b(t[1],v[0]),b(t[2],v[1])],r=m(r).value;a.matrix=g(k(e,d([c(b(w[0],v[1]),r[0]),c(b(w[1],v[2]),r[1]),c(b(w[2],v[0]),r[2])])));r=n.value;a.dualMatrix=g(k(m(q),d([c(b(t[2],w[1]),r[0]),c(b(t[0],w[2]),r[1]),c(b(t[1],w[0]),r[2])])))};m.TrSimilarity={};m.TrSimilarity.kind="Tr";m.TrSimilarity.signature=["P","P","P","P"];m.TrSimilarity.initialize=function(a){a.isEuclidean=1};m.TrSimilarity.updatePosition=function(a){m._helper.trBuildMatrix(a,
function(b){return D.basismap(u.csnames[a.args[0+b]].homog,u.csnames[a.args[2+b]].homog,h.ii,h.jj)})};m.TrTranslation={};m.TrTranslation.kind="Tr";m.TrTranslation.signature=["P","P"];m.TrTranslation.initialize=function(a){a.isEuclidean=1};m.TrTranslation.updatePosition=function(a){var b=u.csnames[a.args[0]].homog,c=u.csnames[a.args[1]].homog,d=h.cross(b,c).value,b=l.mult(b.value[2],c.value[2]),c=h.turnIntoCSList,e=l.neg,g=l.zero,d=c([c([b,g,d[1]]),c([g,b,e(d[0])]),c([g,g,b])]),d=h.normalizeMax(d);
a.matrix=d;b=e(d.value[0].value[0]);d=c([c([b,g,g]),c([g,b,g]),c([d.value[0].value[2],d.value[1].value[2],b])]);a.dualMatrix=d};m.TrReflectionP={};m.TrReflectionP.kind="Tr";m.TrReflectionP.signature=["P"];m.TrReflectionP.initialize=function(a){a.isEuclidean=1};m.TrReflectionP.updatePosition=function(a){var b=u.csnames[a.args[0]].homog.value,c=l.realmult(-.5,b[2]),d=l.zero,b=h.turnIntoCSList([h.turnIntoCSList([c,d,b[0]]),h.turnIntoCSList([d,c,b[1]]),h.turnIntoCSList([d,d,l.neg(c)])]),b=h.normalizeMax(b);
a.matrix=b;a.dualMatrix=h.transpose(b)};m.TrReflectionL={};m.TrReflectionL.kind="Tr";m.TrReflectionL.signature=["L"];m.TrReflectionL.initialize=function(a){a.isEuclidean=-1};m.TrReflectionL.updatePosition=function(a){var b=l.mult,c=l.realmult,d=l.zero,e=u.csnames[a.args[0]].homog.value,g=e[0],k=e[1],e=e[2],m=b(g,g),n=b(k,k),q=c(-.5,l.sub(m,n)),r=b(g,k),b=h.turnIntoCSList([h.turnIntoCSList([l.neg(q),r,b(g,e)]),h.turnIntoCSList([r,q,b(k,e)]),h.turnIntoCSList([d,d,c(-.5,l.add(m,n))])]),b=h.normalizeMax(b);
a.matrix=b;a.dualMatrix=h.transpose(b)};m.TrReflectionS={};m.TrReflectionS.kind="Tr";m.TrReflectionS.signature=["S"];m.TrReflectionS.updatePosition=m.TrReflectionL.updatePosition;m.TrReflectionC={};m.TrReflectionC.kind="Mt";m.TrReflectionC.signature=["C"];m.TrReflectionC.signatureConstraints=function(a){return"Circle"===u.csnames[a.args[0]].matrix.usage};m.TrReflectionC.updatePosition=function(a){var b=u.csnames[a.args[0]].matrix,c=b.value[0].value[2],d=b.value[1].value[2],e=l.neg;a.moebius={anti:!0,
ar:c,ai:d,br:b.value[2].value[2],bi:l.zero,cr:e(b.value[0].value[0]),ci:l.zero,dr:e(c),di:d};m._helper.moebiusPair(a)};m.TrInverse={};m.TrInverse.kind="Tr";m.TrInverse.signature=["Tr"];m.TrInverse.initialize=function(a){a.isEuclidean=u.csnames[a.args[0]].isEuclidean};m.TrInverse.updatePosition=function(a){var b=u.csnames[a.args[0]];a.dualMatrix=h.transpose(b.matrix);a.matrix=h.transpose(b.dualMatrix)};m.TransformC={};m.TransformC.kind="C";m.TransformC.signature=["Tr","C"];m.TransformC.updatePosition=
function(a){var b=u.csnames[a.args[0]].dualMatrix,b=h.productMM(h.productMM(b,u.csnames[a.args[1]].matrix),h.transpose(b)),b=h.normalizeMax(b);a.matrix=w.withUsage(b,"Conic")};m.TransformArc={};m.TransformArc.kind="C";m.TransformArc.signature=["Tr","C"];m.TransformArc.signatureConstraints=function(a){return u.csnames[a.args[0]].isArc};m.TransformArc.updatePosition=function(a){var b=u.csnames[a.args[0]].matrix,c=u.csnames[a.args[1]],d=c.viaPoint,e=c.endPoint,c=h.normalizeMax(h.productMV(b,c.startPoint)),
d=h.normalizeMax(h.productMV(b,d)),b=h.normalizeMax(h.productMV(b,e));a.startPoint=c;a.viaPoint=d;a.endPoint=b;a.isArc=!0;a.matrix=h.normalizeMax(m._helper.ConicBy5(null,c,d,b,h.ii,h.jj));a.matrix=w.withUsage(a.matrix,"Circle")};m.TransformP={};m.TransformP.kind="P";m.TransformP.signature=["Tr","P"];m.TransformP.updatePosition=function(a){a.homog=h.normalizeMax(h.productMV(u.csnames[a.args[0]].matrix,u.csnames[a.args[1]].homog));a.homog=w.withUsage(a.homog,"Point")};m.TransformL={};m.TransformL.kind=
"L";m.TransformL.signature=["Tr","L"];m.TransformL.updatePosition=function(a){a.homog=h.normalizeMax(h.productMV(u.csnames[a.args[0]].dualMatrix,u.csnames[a.args[1]].homog));a.homog=w.withUsage(a.homog,"Line")};m.TransformS={};m.TransformS.kind="S";m.TransformS.signature=["Tr","S"];m.TransformS.updatePosition=function(a){var b=u.csnames[a.args[0]],c=u.csnames[a.args[1]];m.Segment.setSegmentPos(a,h.productMV(b.dualMatrix,c.homog),h.productMV(b.matrix,c.startpos),h.productMV(b.matrix,c.endpos))};m.TransformPolygon=
{};m.TransformPolygon.kind="Poly";m.TransformPolygon.signature=["Tr","Poly"];m.TransformPolygon.updatePosition=function(a){var b=u.csnames[a.args[0]].matrix;a.vertices=h.turnIntoCSList(u.csnames[a.args[1]].vertices.value.map(function(a){a=h.normalizeMax(h.productMV(b,a));return a=w.withUsage(a,"Point")}))};m.TrComposeTrTr={};m.TrComposeTrTr.kind="Tr";m.TrComposeTrTr.signature=["Tr","Tr"];m.TrComposeTrTr.initialize=function(a){a.isEuclidean=u.csnames[a.args[0]].isEuclidean*u.csnames[a.args[1]].isEuclidean};
m.TrComposeTrTr.updatePosition=function(a){var b=u.csnames[a.args[0]],c=u.csnames[a.args[1]];a.matrix=h.normalizeMax(h.productMM(c.matrix,b.matrix));a.dualMatrix=h.normalizeMax(h.productMM(c.dualMatrix,b.dualMatrix))};m._helper.composeMtMt=function(a,b,c){function d(a,b,c,f){return k(q(a,b),q(c,f))}function e(a,b,c,f,g,h,l,m){return k(d(a,b,c,f),d(g,h,l,m))}function g(a,b,c,f,e,h,k,l){return n(d(a,b,c,f),d(e,h,k,l))}var k=l.add,n=l.sub,q=l.mult,r=c.anti?g:e,t=c.anti?e:g,r=h.normalizeMax(h.turnIntoCSList([t(b.ar,
c.ar,b.cr,c.br,b.ai,c.ai,b.ci,c.bi),r(b.ar,c.ai,b.cr,c.bi,b.ai,c.ar,b.ci,c.br),t(b.br,c.ar,b.dr,c.br,b.bi,c.ai,b.di,c.bi),r(b.br,c.ai,b.dr,c.bi,b.bi,c.ar,b.di,c.br),t(b.ar,c.cr,b.cr,c.dr,b.ai,c.ci,b.ci,c.di),r(b.ar,c.ci,b.cr,c.di,b.ai,c.cr,b.ci,c.dr),t(b.br,c.cr,b.dr,c.dr,b.bi,c.ci,b.di,c.di),r(b.br,c.ci,b.dr,c.di,b.bi,c.cr,b.di,c.dr)])).value;a.moebius={anti:b.anti!==c.anti,ar:r[0],ai:r[1],br:r[2],bi:r[3],cr:r[4],ci:r[5],dr:r[6],di:r[7]};m._helper.moebiusPair(a)};m._helper.euc2moeb=function(a){var b=
a.matrix.value;return{anti:0>a.isEuclidean,ar:b[0].value[0],ai:b[1].value[0],br:b[0].value[2],bi:b[1].value[2],cr:l.zero,ci:l.zero,dr:b[2].value[2],di:l.zero}};m.TrComposeMtMt={};m.TrComposeMtMt.kind="Mt";m.TrComposeMtMt.signature=["Mt","Mt"];m.TrComposeMtMt.updatePosition=function(a){m._helper.composeMtMt(a,u.csnames[a.args[0]].moebius,u.csnames[a.args[1]].moebius)};m.TrComposeTrMt={};m.TrComposeTrMt.kind="Mt";m.TrComposeTrMt.signature=["Tr","Mt"];m.TrComposeTrMt.signatureConstraints=function(a){return!!u.csnames[a.args[0]].isEuclidean};
m.TrComposeTrMt.updatePosition=function(a){m._helper.composeMtMt(a,m._helper.euc2moeb(u.csnames[a.args[0]]),u.csnames[a.args[1]].moebius)};m.TrComposeMtTr={};m.TrComposeMtTr.kind="Mt";m.TrComposeMtTr.signature=["Mt","Tr"];m.TrComposeMtTr.signatureConstraints=function(a){return!!u.csnames[a.args[1]].isEuclidean};m.TrComposeMtTr.updatePosition=function(a){m._helper.composeMtMt(a,u.csnames[a.args[0]].moebius,m._helper.euc2moeb(u.csnames[a.args[1]]))};m._helper.pointReflection=function(a,b){return h.normalizeMax(h.sub(h.scalmult(l.realmult(2,
b.value[2]),a),h.scalmult(a.value[2],b)))};m._helper.conicOtherIntersection=function(a,b,c){var d=h.productMV(a,c);a=h.scalproduct(c,d);d=h.scalproduct(b,d);d=l.realmult(-2,d);b=h.scalmult(a,b);c=h.scalmult(d,c);c=h.add(b,c);return c=h.normalizeMax(c)};m.Dist={};m.Dist.kind="V";m.Dist.signature=["P","P"];m.Dist.updatePosition=function(a){var b=u.csnames[a.args[1]].homog;a.value=h.abs(h.sub(h.normalizeZ(u.csnames[a.args[0]].homog),h.normalizeZ(b)))};m.Angle={};m.Angle.kind="V";m.Angle.signature=["L",
"L","P"];m.Angle.initialize=function(a){void 0===a.angle&&(a.angle=.5*Math.PI);ab(l._helper.input(a.angle))};m.Angle.updatePosition=function(a){var b=u.csnames[a.args[1]].homog,c=u.csnames[a.args[2]].homog,d=h.cross(u.csnames[a.args[0]].homog,h.linfty),b=h.cross(b,h.linfty),c=h.crossratio3(d,b,h.ii,h.jj,c),c=l.mult(l.complex(0,.5),l.log(c)),d=(Db().value.real-c.value.real)/Math.PI,b=Math.round(d);!mb&&.01<Math.abs(b-d)&&gc();c=l.complex(b*Math.PI+c.value.real,c.value.imag);ab(c);a.value=w.withUsage(c,
"Angle")};m.Angle.stateSize=2;m.Text={};m.Text.kind="Text";m.Text.signature="**";m.Text.isMovable=!0;m.Text.updatePosition=Ta;m.Text.initialize=function(a){a.text=String(a.text);a.pos&&(a.homog=m._helper.initializePoint(a));a.dock&&(a.dock.offset=a.dock.offset&&2===a.dock.offset.length?h.realVector([+a.dock.offset[0],+a.dock.offset[1]]):h.realVector([0,0]))};m.Text.getParamForInput=function(a,b,c){return m.Free.getParamForInput(a,b,c)};m.Text.getParamFromState=function(a){return a.homog};m.Text.putParamToState=
function(a,b){a.homog=b};m.Calculation={};m.Calculation.kind="Text";m.Calculation.signature="**";m.Calculation.isMovable=!0;m.Calculation.updatePosition=Ta;m.Calculation.initialize=function(a){m.Text.initialize(a);a.calculation=Wa(a.text)};m.Calculation.getText=function(a){return Y(z(a.calculation))};m.Calculation.getParamForInput=m.Text.getParamForInput;m.Calculation.getParamFromState=m.Text.getParamFromState;m.Calculation.putParamToState=m.Text.putParamToState;m.Equation={};m.Equation.kind="Text";
m.Equation.isMovable=!0;m.Equation.signature="**";m.Equation.updatePosition=Ta;m.Equation.initialize=function(a){m.Text.initialize(a);a.calculation=Wa(a.text)};m.Equation.getText=function(a){return a.text+" = "+Y(z(a.calculation))};m.Equation.getParamForInput=m.Text.getParamForInput;m.Equation.getParamFromState=m.Text.getParamFromState;m.Equation.putParamToState=m.Text.putParamToState;m.Evaluate={};m.Evaluate.kind="Text";m.Evaluate.isMovable=!0;m.Evaluate.signature="**";m.Evaluate.updatePosition=
Ta;m.Evaluate.initialize=function(a){m.Text.initialize(a);a.calculation=Wa(a.text)};m.Evaluate.getText=function(a){z(a.calculation);return a.text};m.Evaluate.getParamForInput=m.Text.getParamForInput;m.Evaluate.getParamFromState=m.Text.getParamFromState;m.Evaluate.putParamToState=m.Text.putParamToState;m.Plot={};m.Plot.kind="Text";m.Plot.isMovable=!0;m.Plot.signature="**";m.Plot.updatePosition=Ta;m.Plot.initialize=function(a){m.Text.initialize(a);a.calculation=Wa("plot(("+a.text+"))")};m.Plot.getText=
function(a){z(a.calculation);return a.text};m.Plot.getParamForInput=m.Text.getParamForInput;m.Plot.getParamFromState=m.Text.getParamFromState;m.Plot.putParamToState=m.Text.putParamToState;m.Button={};m.Button.kind="Text";m.Button.signature="**";m.Button.isMovable=!0;m.Button.updatePosition=Ta;m.Button.initialize=function(a){var b=document.createElement("button");Ic(a,"click",b)};m.Button.getParamForInput=m.Text.getParamForInput;m.Button.getParamFromState=m.Text.getParamFromState;m.Button.putParamToState=
m.Text.putParamToState;m.Button.set_fillcolor=function(a,b){h._helper.isNumberVecN(b,3)&&(a.fillcolor=b.value.map(function(a){return a.value.real}),a.html.style.backgroundColor=x.makeColor(a.fillcolor,a.fillalpha))};m.ToggleButton={};m.ToggleButton.kind="Text";m.ToggleButton.signature="**";m.ToggleButton.isMovable=!0;m.ToggleButton.updatePosition=Ta;m.ToggleButton.initialize=function(a){var b;b=void 0;void 0===b&&(b="CindyJSid");b+=++Pa;var c=document.createElement("input"),d=document.createElement("label");
c.setAttribute("id",b);d.setAttribute("for",b);c.setAttribute("type","checkbox");a.pressed&&(c.checked=!0);a.checkbox=c;Ic(a,"change",c,d)};m.ToggleButton.getParamForInput=m.Text.getParamForInput;m.ToggleButton.getParamFromState=m.Text.getParamFromState;m.ToggleButton.putParamToState=m.Text.putParamToState;m.ToggleButton.set_fillcolor=m.Button.set_fillcolor;m.EditableText={};m.EditableText.kind="Text";m.EditableText.isMovable=!0;m.EditableText.signature=[];m.EditableText.updatePosition=Ta;m.EditableText.initialize=
function(a){var b=document.createElement("input");b.setAttribute("type","text");b.className="CindyJS-editabletext";Ia(a.minwidth)&&(b.style.width=a.minwidth-3+"px");"string"===typeof a.text&&(b.value=a.text);b.addEventListener("keydown",function(c){13===c.keyCode&&(a.text=a.html.value,b.blur())});b.addEventListener("change",function(b){a.text=a.html.value});Ic(a,"change",b)};m.EditableText.getText=function(a){return!1};m.EditableText.getParamForInput=m.Text.getParamForInput;m.EditableText.getParamFromState=
m.Text.getParamFromState;m.EditableText.putParamToState=m.Text.putParamToState;m.EditableText.set_fillcolor=m.Button.set_fillcolor;m.EditableText.get_currenttext=function(a){return w.string(String(a.html.value))};m.EditableText.get_text=function(a){return w.string(String(a.text))};m.EditableText.set_currenttext=function(a,b){a.html.value=a.text=Y(b)};m.EditableText.get_text=m.EditableText.get_text;m.EditableText.set_text=m.EditableText.set_currenttext;m.EditableText.get_val=m.EditableText.get_text;
m.EditableText.set_val=m.EditableText.set_currenttext;m.EditableText.get_currenttext=m.EditableText.get_currenttext;m.EditableText.set_currenttext=m.EditableText.set_currenttext;m._helper.initializePoint=function(a){var b=0,c=0,d=0;if(a.pos){if("list"===a.pos.ctype&&h.isNumberVector(a.pos))return a.pos;2===a.pos.length&&(b=a.pos[0],c=a.pos[1],d=1);3===a.pos.length&&(b=a.pos[0],c=a.pos[1],d=a.pos[2])}a=h.turnIntoCSList([l._helper.input(b),l._helper.input(c),l._helper.input(d)]);return a=h.normalizeMax(a)};
m._helper.initializeLine=function(a){var b=0,c=0,d=0;if(a.pos){if("list"===a.pos.ctype&&h.isNumberVector(a.pos))return a.pos;3===a.pos.length&&(b=a.pos[0],c=a.pos[1],d=a.pos[2])}a=h.turnIntoCSList([l._helper.input(b),l._helper.input(c),l._helper.input(d)]);return a=h.normalizeMax(a)};m.Poly={};m.Poly.kind="Poly";m.Poly.signature="P*";m.Poly.updatePosition=function(a){a.vertices=h.turnIntoCSList(a.args.map(function(a){return u.csnames[a].homog}))};var U=null;m.IFS={};m.IFS.kind="IFS";m.IFS.signature=
"**";m.IFS.signatureConstraints=function(a){for(var b=0;b<a.args.length;++b){var c=u.csnames[a.args[b]].kind;if("Tr"!==c&&"Mt"!==c)return!1}return 0<a.args.length};m.IFS.initialize=function(a){if(U)U.dirty=!0;else if(a=va.getBaseDir(),!1!==a){U={dirty:!1,params:{generation:0}};var b=U.worker=new Worker(a+"ifs.js");b.onmessage=function(a){U.img&&"function"===typeof U.img.close&&U.img.close();if(!$b){a=a.data;if(a.generation===U.params.generation){if(a.buffer){U.canvas||(U.canvas=document.createElement("canvas"),
U.ctx=U.canvas.getContext("2d"));U.canvas.width=a.width;U.canvas.height=a.height;var d=new Uint8ClampedArray(a.buffer,a.imgPtr,a.width*a.height*4),d=new ImageData(d,a.width,a.height);U.ctx.putImageData(d,0,0);U.img=U.canvas}else U.img=a.img;e()}else U.img=null;a.buffer?b.postMessage({cmd:"next",buffer:a.buffer},[a.buffer]):b.postMessage({cmd:"next"})}};kb.push(b.terminate.bind(b))}};m.IFS.updatePosition=function(a){U.dirty=!0};m.IFS.updateParameters=function(){if(U.worker){var a={cmd:"init",generation:U.params.generation,
width:4*ba,height:4*ca};a.systems=u.ifs.map(function(a){var b=0,d,e=a.ifs||[],g=a.args.map(function(a,b){var c=e[b]||{};return{prob:c.prob||1,color:c.color||[0,0,0]}});for(d=0;d<g.length;++d)b+=g[d].prob;d=h.realMatrix([[1,0,0],[0,1,0],[0,0,4]]);var k=h.productMM(y.toMat(),d);for(d=0;d<a.args.length;++d){var n=u.csnames[a.args[d]],q=n.kind,r=g[d];r.kind=q;r.prob/=b;if("Tr"===q)n=h.normalizeMax(h.productMM(h.adjoint3(k),h.productMM(n.matrix,k))),h._helper.isAlmostReal(n)?r.mat=n.value.map(function(a){return a.value.map(function(a){return a.value.real})}):
r.kind="cplx";else if("Mt"===q){var q=y.drawingstate.matrix,q={anti:0<q.det,ar:l.real(q.a),ai:l.real(q.c),br:l.real(q.tx),bi:l.real(-q.ty),cr:l.zero,ci:l.zero,dr:l.real(.25),di:l.zero},t={};m._helper.composeMtMt(t,n.moebius,q);q=m._helper.inverseMoebius(q);m._helper.composeMtMt(t,q,t.moebius);q=t.moebius;q=h.turnIntoCSList([q.ar,q.ai,q.br,q.bi,q.cr,q.ci,q.dr,q.di]);h._helper.isAlmostReal(q)?(q=q.value,r.moebius={ar:q[0].value.real,ai:q[1].value.real,br:q[2].value.real,bi:q[3].value.real,cr:q[4].value.real,
ci:q[5].value.real,dr:q[6].value.real,di:q[7].value.real,sign:n.moebius.anti?-1:1}):r.kind="cplx"}}return{trafos:g}});w.deeplyEqual(a,U.params)||(++a.generation,U.img=null,U.params=a,U.mat=y.drawingstate.matrix,U.worker.postMessage(a))}};m.IFS.probSetter=function(a,b,c){"number"===c.ctype&&(b.ifs[a].prob=c.value.real,U.dirty=!0)};(function(){for(var a=0;10>a;++a)m.IFS["set_prob"+a]=m.IFS.probSetter.bind(null,a)})();m._helper.snapPointToLine=function(a,b){if(l._helper.isAlmostZero(a.value[2]))return a;
var c=m._helper.projectPointToLine(a,b),c=h.normalizeZ(c),d=c.value[0].value.real,c=c.value[1].value.real,e=Math.round(d/ya)*ya,g=Math.round(c/ya)*ya,k=h.realVector([e,g,1]);.2>Math.abs(e-d)&&.2>Math.abs(g-c)&&l._helper.isAlmostZero(h.scalproduct(b,k))&&(a=m._helper.projectPointToLine(k,b));return a};var Ab={CircleByRadius:"CircleMr",IntersectionCircleCircle:"IntersectCirCir",IntersectionConicConic:"IntersectConicConic",FreePoint:"Free",Orthogonal:"Perp",Parallel:"Para",Pole:"PolarOfLine",Polar:"PolarOfPoint",
Arc:"ArcBy3",EuclideanMid:"Mid",AngularBisector:"AngleBisector",TransformConic:"TransformC",TransformSegment:"TransformS",TrMoebiusSegment:"TrMoebiusS",ReflectCC:"TrMoebiusC",ReflectCL:"TrMoebiusL",ReflectCP:"TrMoebiusP",ReflectCArc:"TrMoebiusArc",ReflectCS:"TrMoebiusS",TrMoebiusCircle:"TrMoebiusC"},Cc={CircleMFixedr:function(a){a.pinned=!0;a.type="CircleMr";return[a]},CircleByFixedRadius:function(a){a.pinned=!0;a.type="CircleMr";return[a]},IntersectionConicLine:function(a){a.args=[a.args[1],a.args[0]];
a.type="IntersectLC";return[a]},angleBisector:function(a){var b={name:a.name+"_Intersection",type:"Meet",args:a.args,visible:!1};a.type="AngleBisector";a.args=[a.args[0],a.args[1],b.name];return[b,a]},Transform:function(a){var b=u.csnames[a.args[1]],b={Tr:"Transform",Mt:"TrMoebius"}[u.csnames[a.args[0]].kind]+(b.isArc?"Arc":b.kind);if(m.hasOwnProperty(b))return a.type=b,[a];console.log(b+" not implemented yet");return[]},TrReflection:function(a){var b="TrReflection"+u.csnames[a.args[0]].kind;if(m.hasOwnProperty(b))return a.type=
b,[a];console.log(b+" not implemented yet");return[]},TrCompose:function(a){var b="TrCompose"+a.args.map(function(a){return u.csnames[a].kind}).join("");if(m.hasOwnProperty(b))return a.type=b,[a];console.log(b+" not implemented yet");return[]}},ue="align alpha angle args arrow arrowposition arrowshape arrowsides arrowsize clip color dashtype drawtrace fillalpha fillcolor filled labeled labelpos name overhang pinned printname radius size text text_fontfamily textbold textitalics textsize tracedim tracelength traceskip tracing type visible".split(" ");
sa.saveState=function(){return{geometry:ve()}};var xa={},Sd,Tb,Td,Ud;Sd=[[],[.2],[.075,.225],[44/45,-56/15,32/9],[19372/6561,-25360/2187,64448/6561,-212/729],[9017/3168,-355/33,46732/5247,49/176,-5103/18656],[35/384,0,500/1113,125/192,-2187/6784,11/84]];Tb=[0,.2,.3,.8,8/9,1,1];Td=[35/384,0,500/1113,125/192,-2187/6784,11/84,0];Ud=[5179/57600,0,7571/16695,.6140625,-92097/339200,187/2100,.025];var Fa,la=[],Jc=[],sc=!1;xa.tick=function(a){a/=Xb;for(var b=0;b<Xb;b++)xa.tick1(a),Kb+=a,z(R.simulationstep)};
xa.tick1=function(a){for(var b=a,c=0;0<a&&c<.999*a||0>a&&c>.999*a;)b=xa.oneRKStep(b),c+=b,b=Math.min(2*b,a-c),b=Math.max(b,1E-16),xa.restorePosition(),xa.doCollisions(),xa.calculateForces(),xa.moveToFinalPos();return!0};xa.restorePosition=function(){Fa.forEach(function(a){O[a.type].restorePos(a,9)})};xa.doCollisions=function(){Fa.forEach(function(a){O[a.type].doCollisions(a)})};xa.calculateForces=function(){Fa.forEach(function(a){O[a.type].calculateForces(a)})};xa.moveToFinalPos=function(){Fa.forEach(function(a){O[a.type].move(a)})};
xa.oneRKStep=function(a){for(var b=function(a){Fa.forEach(function(b){O[b.type].initRK(b,a);O[b.type].storePosition(b)})},c=function(a){Fa.forEach(function(b){O[b.type].setToTimestep(b,Tb[a])})},d=function(a){Fa.forEach(function(b){O[b.type].proceedMotion(b,Tb[a],a,Sd[a])})},e=function(){Fa.forEach(function(a){O[a.type].resetForces(a)})},g=function(a){Fa.forEach(function(b){O[b.type].calculateDelta(b,a)})},h=function(b){var c=0;Fa.forEach(function(a){O[a.type].proceedMotion(a,Tb[6],7,Td);O[a.type].savePos(a,
8);O[a.type].proceedMotion(a,Tb[6],7,Ud);O[a.type].savePos(a,9);c+=O[a.type].sqDist(a,8,9)});return c=Math.sqrt(c)/a},k=function(a){Fa.forEach(function(a){O[a.type].recallPosition(a)})},l=!1;!l;){b(a);for(var m=0;7>m;m++)c(m),d(m),e(),xa.calculateForces(),g(m);h(a)>O.env.errorbound&&a>O.env.lowestdeltat?(a/=O.env.slowdownfactor,k()):l=!0}return a};var O={Mass:{reset:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.mass&&(a.mass=1);"undefined"===typeof a.charge&&(a.charge=
0);"undefined"===typeof a.friction&&(a.friction=0);a.lnfrict=0;"undefined"===typeof a.limitspeed&&(a.limitspeed=!1);"undefined"===typeof a.fixed&&(a.fixed=!1);"undefined"===typeof a.radius&&(a.radius=1);a.internalmove=!1;a.fx=0;a.fy=0;a.fz=0;a.vx=a.vx||0;a.vy=a.vy||0;a.vz=a.vz||0;a.mtype=0;a.env=O.env;a.deltat=0;a.mx=0;a.my=0;a.mz=0;a.mvx=0;a.mvy=0;a.mvz=0;a.dx=[0,0,0,0,0,0,0,0,0,0];a.dy=[0,0,0,0,0,0,0,0,0,0];a.dz=[0,0,0,0,0,0,0,0,0,0];a.dvx=[0,0,0,0,0,0,0,0,0,0];a.dvy=[0,0,0,0,0,0,0,0,0,0];a.dvz=
[0,0,0,0,0,0,0,0,0,0];a.midx=0;a.midy=0;a.midz=0;a.lx=0;a.ly=0;a.lz=0},resetForces:function(a){a.fx=0;a.fy=0;a.fz=0},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){var c=D.extractPoint(a.el.homog);a.x=c.x;a.y=c.y;a.z=0;a.xo=a.x;a.yo=a.y;a.zo=a.z;a.vxo=a.vx;a.vyo=a.vy;a.vzo=a.vz;a.deltat=b;a.fx=0;a.fy=0;a.fz=0},setVelocity:function(a,b,c,d){d||(d=0);a.vx=b;a.vy=c;a.vz=d},move:function(a){a.pos=[a.x,a.y,1];a.internalmove=!0;ja&&Z.down&&a.el===ja.mover||Aa(a.el,h.realVector(a.pos),
"homog");a.el.sx=a.x;a.el.sy=a.y;a.internalmove=!1},proceedMotion:function(a,b,c,d){if(!a.fixed)for(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz,b=0;b<c;b++)a.x+=d[b]*a.dx[b]*a.deltat,a.y+=d[b]*a.dy[b]*a.deltat,a.z+=d[b]*a.dz[b]*a.deltat,a.vx+=d[b]*a.dvx[b]*a.deltat,a.vy+=d[b]*a.dvy[b]*a.deltat,a.vz+=d[b]*a.dvz[b]*a.deltat},calculateForces:function(a){var b=Math.sqrt(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz);a.lnfrict=-Math.log((1-a.friction)*(1-a.env.friction)*(.1<b&&a.limitSpeed?.1/b:1));a.fx+=
-a.vx*a.lnfrict*a.mass;a.fy+=-a.vy*a.lnfrict*a.mass;a.fz+=-a.vz*a.lnfrict*a.mass},calculateDelta:function(a,b){a.dx[b]=a.vx;a.dy[b]=a.vy;a.dz[b]=a.vz;a.dvx[b]=a.fx/a.mass;a.dvy[b]=a.fy/a.mass;a.dvz[b]=a.fz/a.mass},savePos:function(a,b){a.dx[b]=a.x;a.dy[b]=a.y;a.dz[b]=a.z;a.dvx[b]=a.vx;a.dvy[b]=a.vy;a.dvz[b]=a.vz},restorePos:function(a,b){a.fixed||(a.x=a.dx[b],a.y=a.dy[b],a.z=a.dz[b],a.vx=a.dvx[b],a.vy=a.dvy[b],a.vz=a.dvz[b])},sqDist:function(a,b,c){var d=(a.dx[b]-a.dx[c])*(a.dx[b]-a.dx[c]),d=d+(a.dy[b]-
a.dy[c])*(a.dy[b]-a.dy[c]),d=d+(a.dz[b]-a.dz[c])*(a.dz[b]-a.dz[c]),d=d+(a.dvx[b]-a.dvx[c])*(a.dvx[b]-a.dvx[c]),d=d+(a.dvy[b]-a.dvy[c])*(a.dvy[b]-a.dvy[c]);return d+=(a.dvz[b]-a.dvz[c])*(a.dvz[b]-a.dvz[c])},kineticEnergy:function(a){return.5*a.mass*(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz)},storePosition:function(a){a.mx=a.x;a.my=a.y;a.mz=a.z;a.mvx=a.vx;a.mvy=a.vy;a.mvz=a.vz},recallPosition:function(a){a.fixed||(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz)},doCollisions:function(a){}},Sun:{reset:function(a,
b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.mass&&(a.mass=10);"undefined"===typeof a.friction&&(a.friction=0);a.charge=0;a.x=0;a.y=0;a.z=0},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){var c=D.extractPoint(a.el.homog);a.x=c.x;a.y=c.y;a.z=0},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateDelta:function(a,b){},calculateForces:function(a){for(var b=a.x,c=a.y,d=a.z,e=0;e<la.length;e++){var g=
la[e],h=g.behavior.x,k=g.behavior.y,l=g.behavior.z,m=Math.sqrt((b-h)*(b-h)+(c-k)*(c-k)+(d-l)*(d-l)),k=(c-k)*a.mass*g.behavior.mass/(m*m*m),l=(d-l)*a.mass*g.behavior.mass/(m*m*m);g.behavior.fx+=(b-h)*a.mass*g.behavior.mass/(m*m*m)*g.behavior.mass;g.behavior.fy+=k*g.behavior.mass;g.behavior.fz+=l*g.behavior.mass}},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},
Velocity:{reset:function(a){var b=u.csnames[a.geo[1]];console.log(b);var c=D.extractPoint(b.homog);a=D.extractPoint(u.csnames[a.geo[2]].homog);b=b.behavior;O[b.type].setVelocity(b,a.x-c.x,a.y-c.y,0)},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){var b=u.csnames[a.geo[2]];if(!ja||!Z.down||b!==ja.mover){var c=u.csnames[a.geo[1]];a=D.extractPoint(c.homog);c=c.behavior;a=h.realVector([a.x+c.vx,a.y+c.vy,1]);
Aa(b,a,"homog")}},proceedMotion:function(a,b,c,d){},calculateForces:function(a){},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},Gravity:{reset:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.strength&&(a.strength=1);a.namea=b.args[0];a.nameb=b.args[1];a.ma=u.csnames[a.namea];a.mb=u.csnames[a.nameb]},
resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateDelta:function(a,b){},calculateForces:function(a){var b=D.extractPoint(a.ma.homog),c=D.extractPoint(a.mb.homog),d=(c.x-b.x)*a.strength;a=(c.y-b.y)*a.strength;for(b=0;b<la.length;b++)c=la[b],c.behavior.fx+=d*c.behavior.mass,c.behavior.fy+=a*c.behavior.mass,c.behavior.fz+=0*c.behavior.mass},savePos:function(a,b){},
restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},Spring:{reset:function(a,b){a.el=b;"undefined"===typeof a.strength&&(a.strength=1);"undefined"===typeof a.amplitude&&(a.amplitude=0);"undefined"===typeof a.phase&&(a.phase=0);"undefined"===typeof a.speed&&(a.speed=1);"undefined"===typeof a.l0&&(a.l0=0);"undefined"===typeof a.stype&&(a.stype=1);"undefined"===typeof a.readOnInit&&
(a.readOnInit=!1);a.namea=b.args[0];a.nameb=b.args[1];a.ma=u.csnames[a.namea];a.mb=u.csnames[a.nameb];var c=D.extractPoint(a.ma.homog),d=D.extractPoint(a.mb.homog);a.l0=Math.sqrt((c.x-d.x)*(c.x-d.x)+(c.y-d.y)*(c.y-d.y));a.env=O.env;a.ldiff=0},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateForces:function(a){var b,c,d,e;!a.ma.behavior||ja&&Z.down&&a.ma===ja.mover?
(c=D.extractPoint(a.ma.homog),b=c.x,d=c.y):(b=a.ma.behavior.x,d=a.ma.behavior.y);!a.mb.behavior||ja&&Z.down&&a.mb===ja.mover?(e=D.extractPoint(a.mb.homog),c=e.x,e=e.y):(c=a.mb.behavior.x,e=a.mb.behavior.y);var g=Math.sqrt((b-c)*(b-c)+(d-e)*(d-e)),h=a.l0;a.ldiff=g-h;var k=a.stype;1===k&&(h=0);var l=0;if(2===k||3===k)l=a.ma.behavior.mass*a.mb.behavior.mass*a.strength;2===k&&(l=-l);var m,n;if(0===g||0!==k&&1!==k)if(a.ma.behavior&&a.mb.behavior&&0!==g){if(g*=g*g,2===k||3===k)m=(b-c)*l/g,n=(d-e)*l/g}else m=
n=0;else m=-(b-c)*a.strength*(g-h)/g*a.env.springstrength,n=-(d-e)*a.strength*(g-h)/g*a.env.springstrength;a.ma.behavior&&(a.ma.behavior.fx+=m,a.ma.behavior.fy+=n);a.mb.behavior&&(a.mb.behavior.fx-=m,a.mb.behavior.fy-=n)},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},det:function(a,b,c,d,e,g){return c*g-e*d+e*b-a*g+a*
d-c*b},Bouncer:{reset:function(a,b){a.el=b;"undefined"===typeof a.xdamp&&(a.xdamp=0);"undefined"===typeof a.ydamp&&(a.ydamp=0);"undefined"===typeof a.motorchanger&&(a.motorchanger=!0);a.namea=b.args[0];a.nameb=b.args[1];a.ma=u.csnames[a.namea];a.mb=u.csnames[a.nameb];var c=D.extractPoint(a.ma.homog),d=D.extractPoint(a.mb.homog);a.x1o=1.01*c.x-.01*d.x;a.y1o=1.01*c.y-.01*d.y;a.x2o=1.01*d.x-.01*c.x;a.y2o=1.01*d.y-.01*c.y;a.env=O.env},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},
initRK:function(a,b){a.deltat=b},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateForces:function(a){},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){for(var b=D.extractPoint(a.ma.homog),c=D.extractPoint(a.mb.homog),d=b.x,b=b.y,e=c.x,c=c.y,g=a.x1o,h=a.y1o,k=a.x2o,m=a.y2o,n=Math.sqrt((d-
e)*(d-e)+(b-c)*(b-c)),q=(d-e)/n,n=(b-c)/n,r=0;r<la.length;r++){var t=la[r],u=t.behavior.xo,v=t.behavior.yo,w=t.behavior.x,x=t.behavior.y,y=l.mult(l.complex(g,h),l.complex(e,c)),z=l.mult(l.complex(k,m),l.complex(d,b)),y=l.sub(y,z),z=l.mult(l.complex(u,v),l.complex(d,b)),y=l.add(y,z),z=l.mult(l.complex(u,v),l.complex(e,c)),y=l.sub(y,z),z=l.sub(l.complex(g,h),l.complex(k,m)),y=l.div(y,z);0>O.det(d,b,e,c,w,x)*O.det(d,b,e,c,y.value.real,y.value.imag)&&0>O.det(d,b,w,x,y.value.real,y.value.imag)*O.det(e,
c,w,x,y.value.real,y.value.imag)&&(v=t.behavior.mvx+a.deltat*(-y.value.real+t.behavior.xo),w=t.behavior.mvy+a.deltat*(-y.value.imag+t.behavior.yo),u=q*v+n*w,v=n*v-q*w,t.behavior.x=y.value.real,t.behavior.y=y.value.imag,t.behavior.vx=q*u*(1-a.xdamp),t.behavior.vy=n*u*(1-a.xdamp),t.behavior.vx+=-n*v*(1-a.ydamp),t.behavior.vy+=q*v*(1-a.ydamp))}a.x1o=d;a.y1o=b;a.x2o=e;a.y2o=c}},Environment:{init:function(a){"undefined"===typeof a.gravity&&(a.gravity=0);"undefined"===typeof a.friction&&(a.friction=0);
"undefined"===typeof a.springstrength&&(a.springstrength=1);"undefined"!==typeof a.accuracy&&(Xb=a.accuracy);"undefined"!==typeof a.deltat&&ha(a.deltat/.6);"undefined"===typeof a.charges&&(a.charges=!1);"undefined"===typeof a.balls&&(a.balls=!1);"undefined"===typeof a.newton&&(a.newton=!1);"undefined"===typeof a.ballInteractionBoosting&&(a.ballInteractionBoosting=1);O.env=a;a.errorbound=.001;a.lowestdeltat=1E-7;a.slowdownfactor=2},reset:function(a){},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,
b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateForces:function(a){var b,c,d,e,g,h,k,l,m,n;if(a.newton)for(b=0;b<la.length-1;b++)for(c=la[b],d=c.behavior.x,e=c.behavior.y,g=b+1;g<la.length;g++)h=la[g],k=h.behavior.x,l=h.behavior.y,n=Math.sqrt((d-k)*(d-k)+(e-l)*(e-l)),k=(d-k)*c.behavior.mass*h.behavior.mass/(n*n*n),l=(e-l)*c.behavior.mass*h.behavior.mass/(n*n*n),c.behavior.fx-=k,c.behavior.fy-=l,h.behavior.fx+=k,h.behavior.fy+=
l;if(a.charges)for(b=0;b<la.length-1;b++)for(c=la[b],d=c.behavior.x,e=c.behavior.y,g=b+1;g<la.length;g++)h=la[g],k=h.behavior.x,l=h.behavior.y,n=Math.sqrt((d-k)*(d-k)+(e-l)*(e-l)),k=(d-k)*c.behavior.charge*h.behavior.charge/(n*n*n),l=(e-l)*c.behavior.charge*h.behavior.charge/(n*n*n),c.behavior.fx+=k,c.behavior.fy+=l,h.behavior.fx-=k,h.behavior.fy-=l;if(a.balls)for(b=0;b<la.length-1;b++)if(c=la[b],0!==c.behavior.radius)for(d=c.behavior.x,e=c.behavior.y,g=b+1;g<la.length;g++)h=la[g],0!==h.behavior.radius&&
(k=h.behavior.x,l=h.behavior.y,m=c.behavior.radius+h.behavior.radius,n=Math.sqrt((d-k)*(d-k)+(e-l)*(e-l)),0===a.ballInteractionBoosting?(k=(d-k)/(n*n*n)*(n>m?0:(n-m)*(n-m)),l=(e-l)/(n*n*n)*(n>m?0:(n-m)*(n-m))):1===a.ballInteractionBoosting?(k=(d-k)/(n*n*n*n)*(n>m?0:(n-m)*(n-m)),l=(e-l)/(n*n*n*n)*(n>m?0:(n-m)*(n-m))):(k=(d-k)/(n*n*n*n*n)*(n>m?0:(n-m)*(n-m)),l=(e-l)/(n*n*n*n*n)*(n>m?0:(n-m)*(n-m))),c.behavior.fx+=k,c.behavior.fy+=l,h.behavior.fx-=k,h.behavior.fy-=l);for(b=0;b<la.length;b++)c=la[b],
c.behavior.fx+=0,c.behavior.fy+=-a.gravity*c.behavior.mass,c.behavior.fz+=0},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}}};return sa};return E}(),createCindy=CindyJS;"undefined"!==typeof process&&"undefined"!==typeof module&&"undefined"!==typeof module.exports&&"undefined"===typeof window&&(module.exports=CindyJS);
//# sourceMappingURL=Cindy.js.map

