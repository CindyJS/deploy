/* CindyJS - (C) 2014-2015  The CindyJS Project
 * Mostly licensed under the Apache License 2.0, but subprojects may use different licensing.
 * See https://github.com/CindyJS/CindyJS/tree/57a564d89124df6d86f605272bc91740fb2c2348
 * for corresponding sources and their respective licensing conditions.
 */
'use strict';(function(){function n(b,c,d){f.biginteger_used=1;null!=b&&("number"==typeof b&&"undefined"==typeof c?this.fromInt(b):"number"==typeof b?this.fromNumber(b,c,d):null==c&&"string"!=typeof b?this.fromString(b,256):this.fromString(b,c))}function F(){return new n(null)}function qa(b,c,d,g,f,l){for(;0<=--l;){var p=c*this[b++]+d[g]+f;f=Math.floor(p/67108864);d[g++]=p&67108863}return f}function wa(b,c,d,g,f,l){var p=c&32767;for(c>>=15;0<=--l;){var E=this[b]&32767,t=this[b++]>>15,n=c*E+t*p,E=
p*E+((n&32767)<<15)+d[g]+(f&1073741823);f=(E>>>30)+(n>>>15)+c*t+(f>>>30);d[g++]=E&1073741823}return f}function ra(b,c,d,g,f,l){var p=c&16383;for(c>>=14;0<=--l;){var E=this[b]&16383,t=this[b++]>>14,n=c*E+t*p,E=p*E+((n&16383)<<14)+d[g]+f;f=(E>>28)+(n>>14)+c*t;d[g++]=E&268435455}return f}function za(b,c){var d=Ua[b.charCodeAt(c)];return null==d?-1:d}function fa(b){var c=F();c.fromInt(b);return c}function G(b){var c=1,d;0!=(d=b>>>16)&&(b=d,c+=16);0!=(d=b>>8)&&(b=d,c+=8);0!=(d=b>>4)&&(b=d,c+=4);0!=(d=
b>>2)&&(b=d,c+=2);0!=b>>1&&(c+=1);return c}function P(b){this.m=b}function t(b){this.m=b;this.mp=b.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<b.DB-15)-1;this.mt2=2*b.t}function S(b,c){return b&c}function Q(b,c){return b|c}function ca(b,c){return b^c}function Lb(b,c){return b&~c}function Za(){}function Mb(b){return b}function Ha(b){this.r2=F();this.q3=F();n.ONE.dlShiftTo(2*b.t,this.r2);this.mu=this.r2.divide(b);this.m=b}var f={},db=!1;"undefined"!==typeof module&&module.exports?
(module.exports=f,db=!0):"undefined"!==typeof document?window.ClipperLib=f:self.ClipperLib=f;var T;if(db)N="chrome",T="Netscape";else{var N=navigator.userAgent.toString().toLowerCase();T=navigator.appName}var Ia,Va,Ja,Ka,Pa,X;Ia=-1!=N.indexOf("chrome")&&-1==N.indexOf("chromium")?1:0;db=-1!=N.indexOf("chromium")?1:0;Va=-1!=N.indexOf("safari")&&-1==N.indexOf("chrome")&&-1==N.indexOf("chromium")?1:0;Ja=-1!=N.indexOf("firefox")?1:0;N.indexOf("firefox/17");N.indexOf("firefox/15");N.indexOf("firefox/3");
Ka=-1!=N.indexOf("opera")?1:0;N.indexOf("msie 10");N.indexOf("msie 9");Pa=-1!=N.indexOf("msie 8")?1:0;X=-1!=N.indexOf("msie 7")?1:0;N=-1!=N.indexOf("msie ")?1:0;f.biginteger_used=null;"Microsoft Internet Explorer"==T?(n.prototype.am=wa,T=30):"Netscape"!=T?(n.prototype.am=qa,T=26):(n.prototype.am=ra,T=28);n.prototype.DB=T;n.prototype.DM=(1<<T)-1;n.prototype.DV=1<<T;n.prototype.FV=Math.pow(2,52);n.prototype.F1=52-T;n.prototype.F2=2*T-52;var Ua=[],pa;T=48;for(pa=0;9>=pa;++pa)Ua[T++]=pa;T=97;for(pa=10;36>
pa;++pa)Ua[T++]=pa;T=65;for(pa=10;36>pa;++pa)Ua[T++]=pa;P.prototype.convert=function(b){return 0>b.s||0<=b.compareTo(this.m)?b.mod(this.m):b};P.prototype.revert=function(b){return b};P.prototype.reduce=function(b){b.divRemTo(this.m,null,b)};P.prototype.mulTo=function(b,c,d){b.multiplyTo(c,d);this.reduce(d)};P.prototype.sqrTo=function(b,c){b.squareTo(c);this.reduce(c)};t.prototype.convert=function(b){var c=F();b.abs().dlShiftTo(this.m.t,c);c.divRemTo(this.m,null,c);0>b.s&&0<c.compareTo(n.ZERO)&&this.m.subTo(c,
c);return c};t.prototype.revert=function(b){var c=F();b.copyTo(c);this.reduce(c);return c};t.prototype.reduce=function(b){for(;b.t<=this.mt2;)b[b.t++]=0;for(var c=0;c<this.m.t;++c){var d=b[c]&32767,g=d*this.mpl+((d*this.mph+(b[c]>>15)*this.mpl&this.um)<<15)&b.DM,d=c+this.m.t;for(b[d]+=this.m.am(0,g,b,c,0,this.m.t);b[d]>=b.DV;)b[d]-=b.DV,b[++d]++}b.clamp();b.drShiftTo(this.m.t,b);0<=b.compareTo(this.m)&&b.subTo(this.m,b)};t.prototype.mulTo=function(b,c,d){b.multiplyTo(c,d);this.reduce(d)};t.prototype.sqrTo=
function(b,c){b.squareTo(c);this.reduce(c)};n.prototype.copyTo=function(b){for(var c=this.t-1;0<=c;--c)b[c]=this[c];b.t=this.t;b.s=this.s};n.prototype.fromInt=function(b){this.t=1;this.s=0>b?-1:0;0<b?this[0]=b:-1>b?this[0]=b+this.DV:this.t=0};n.prototype.fromString=function(b,c){var d;if(16==c)d=4;else if(8==c)d=3;else if(256==c)d=8;else if(2==c)d=1;else if(32==c)d=5;else if(4==c)d=2;else{this.fromRadix(b,c);return}this.s=this.t=0;for(var g=b.length,f=!1,l=0;0<=--g;){var p=8==d?b[g]&255:za(b,g);0>
p?"-"==b.charAt(g)&&(f=!0):(f=!1,0==l?this[this.t++]=p:l+d>this.DB?(this[this.t-1]|=(p&(1<<this.DB-l)-1)<<l,this[this.t++]=p>>this.DB-l):this[this.t-1]|=p<<l,l+=d,l>=this.DB&&(l-=this.DB))}8==d&&0!=(b[0]&128)&&(this.s=-1,0<l&&(this[this.t-1]|=(1<<this.DB-l)-1<<l));this.clamp();f&&n.ZERO.subTo(this,this)};n.prototype.clamp=function(){for(var b=this.s&this.DM;0<this.t&&this[this.t-1]==b;)--this.t};n.prototype.dlShiftTo=function(b,c){var d;for(d=this.t-1;0<=d;--d)c[d+b]=this[d];for(d=b-1;0<=d;--d)c[d]=
0;c.t=this.t+b;c.s=this.s};n.prototype.drShiftTo=function(b,c){for(var d=b;d<this.t;++d)c[d-b]=this[d];c.t=Math.max(this.t-b,0);c.s=this.s};n.prototype.lShiftTo=function(b,c){var d=b%this.DB,g=this.DB-d,f=(1<<g)-1,l=Math.floor(b/this.DB),p=this.s<<d&this.DM,E;for(E=this.t-1;0<=E;--E)c[E+l+1]=this[E]>>g|p,p=(this[E]&f)<<d;for(E=l-1;0<=E;--E)c[E]=0;c[l]=p;c.t=this.t+l+1;c.s=this.s;c.clamp()};n.prototype.rShiftTo=function(b,c){c.s=this.s;var d=Math.floor(b/this.DB);if(d>=this.t)c.t=0;else{var g=b%this.DB,
f=this.DB-g,l=(1<<g)-1;c[0]=this[d]>>g;for(var p=d+1;p<this.t;++p)c[p-d-1]|=(this[p]&l)<<f,c[p-d]=this[p]>>g;0<g&&(c[this.t-d-1]|=(this.s&l)<<f);c.t=this.t-d;c.clamp()}};n.prototype.subTo=function(b,c){for(var d=0,g=0,f=Math.min(b.t,this.t);d<f;)g+=this[d]-b[d],c[d++]=g&this.DM,g>>=this.DB;if(b.t<this.t){for(g-=b.s;d<this.t;)g+=this[d],c[d++]=g&this.DM,g>>=this.DB;g+=this.s}else{for(g+=this.s;d<b.t;)g-=b[d],c[d++]=g&this.DM,g>>=this.DB;g-=b.s}c.s=0>g?-1:0;-1>g?c[d++]=this.DV+g:0<g&&(c[d++]=g);c.t=
d;c.clamp()};n.prototype.multiplyTo=function(b,c){var d=this.abs(),g=b.abs(),f=d.t;for(c.t=f+g.t;0<=--f;)c[f]=0;for(f=0;f<g.t;++f)c[f+d.t]=d.am(0,g[f],c,f,0,d.t);c.s=0;c.clamp();this.s!=b.s&&n.ZERO.subTo(c,c)};n.prototype.squareTo=function(b){for(var c=this.abs(),d=b.t=2*c.t;0<=--d;)b[d]=0;for(d=0;d<c.t-1;++d){var g=c.am(d,c[d],b,2*d,0,1);(b[d+c.t]+=c.am(d+1,2*c[d],b,2*d+1,g,c.t-d-1))>=c.DV&&(b[d+c.t]-=c.DV,b[d+c.t+1]=1)}0<b.t&&(b[b.t-1]+=c.am(d,c[d],b,2*d,0,1));b.s=0;b.clamp()};n.prototype.divRemTo=
function(b,c,d){var g=b.abs();if(!(0>=g.t)){var f=this.abs();if(f.t<g.t)null!=c&&c.fromInt(0),null!=d&&this.copyTo(d);else{null==d&&(d=F());var l=F(),p=this.s;b=b.s;var E=this.DB-G(g[g.t-1]);0<E?(g.lShiftTo(E,l),f.lShiftTo(E,d)):(g.copyTo(l),f.copyTo(d));g=l.t;f=l[g-1];if(0!=f){var t=f*(1<<this.F1)+(1<g?l[g-2]>>this.F2:0),Ga=this.FV/t,t=(1<<this.F1)/t,M=1<<this.F2,Z=d.t,P=Z-g,R=null==c?F():c;l.dlShiftTo(P,R);0<=d.compareTo(R)&&(d[d.t++]=1,d.subTo(R,d));n.ONE.dlShiftTo(g,R);for(R.subTo(l,l);l.t<g;)l[l.t++]=
0;for(;0<=--P;){var N=d[--Z]==f?this.DM:Math.floor(d[Z]*Ga+(d[Z-1]+M)*t);if((d[Z]+=l.am(0,N,d,P,0,g))<N)for(l.dlShiftTo(P,R),d.subTo(R,d);d[Z]<--N;)d.subTo(R,d)}null!=c&&(d.drShiftTo(g,c),p!=b&&n.ZERO.subTo(c,c));d.t=g;d.clamp();0<E&&d.rShiftTo(E,d);0>p&&n.ZERO.subTo(d,d)}}}};n.prototype.invDigit=function(){if(1>this.t)return 0;var b=this[0];if(0==(b&1))return 0;var c=b&3,c=c*(2-(b&15)*c)&15,c=c*(2-(b&255)*c)&255,c=c*(2-((b&65535)*c&65535))&65535,c=c*(2-b*c%this.DV)%this.DV;return 0<c?this.DV-c:-c};
n.prototype.isEven=function(){return 0==(0<this.t?this[0]&1:this.s)};n.prototype.exp=function(b,c){if(4294967295<b||1>b)return n.ONE;var d=F(),g=F(),f=c.convert(this),l=G(b)-1;for(f.copyTo(d);0<=--l;)if(c.sqrTo(d,g),0<(b&1<<l))c.mulTo(g,f,d);else var p=d,d=g,g=p;return c.revert(d)};n.prototype.toString=function(b){if(0>this.s)return"-"+this.negate().toString(b);if(16==b)b=4;else if(8==b)b=3;else if(2==b)b=1;else if(32==b)b=5;else if(4==b)b=2;else return this.toRadix(b);var c=(1<<b)-1,d,g=!1,f="",
l=this.t,p=this.DB-l*this.DB%b;if(0<l--)for(p<this.DB&&0<(d=this[l]>>p)&&(g=!0,f="0123456789abcdefghijklmnopqrstuvwxyz".charAt(d));0<=l;)p<b?(d=(this[l]&(1<<p)-1)<<b-p,d|=this[--l]>>(p+=this.DB-b)):(d=this[l]>>(p-=b)&c,0>=p&&(p+=this.DB,--l)),0<d&&(g=!0),g&&(f+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(d));return g?f:"0"};n.prototype.negate=function(){var b=F();n.ZERO.subTo(this,b);return b};n.prototype.abs=function(){return 0>this.s?this.negate():this};n.prototype.compareTo=function(b){var c=
this.s-b.s;if(0!=c)return c;var d=this.t,c=d-b.t;if(0!=c)return 0>this.s?-c:c;for(;0<=--d;)if(0!=(c=this[d]-b[d]))return c;return 0};n.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+G(this[this.t-1]^this.s&this.DM)};n.prototype.mod=function(b){var c=F();this.abs().divRemTo(b,null,c);0>this.s&&0<c.compareTo(n.ZERO)&&b.subTo(c,c);return c};n.prototype.modPowInt=function(b,c){var d;d=256>b||c.isEven()?new P(c):new t(c);return this.exp(b,d)};n.ZERO=fa(0);n.ONE=fa(1);Za.prototype.convert=
Mb;Za.prototype.revert=Mb;Za.prototype.mulTo=function(b,c,d){b.multiplyTo(c,d)};Za.prototype.sqrTo=function(b,c){b.squareTo(c)};Ha.prototype.convert=function(b){if(0>b.s||b.t>2*this.m.t)return b.mod(this.m);if(0>b.compareTo(this.m))return b;var c=F();b.copyTo(c);this.reduce(c);return c};Ha.prototype.revert=function(b){return b};Ha.prototype.reduce=function(b){b.drShiftTo(this.m.t-1,this.r2);b.t>this.m.t+1&&(b.t=this.m.t+1,b.clamp());this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);for(this.m.multiplyLowerTo(this.q3,
this.m.t+1,this.r2);0>b.compareTo(this.r2);)b.dAddOffset(1,this.m.t+1);for(b.subTo(this.r2,b);0<=b.compareTo(this.m);)b.subTo(this.m,b)};Ha.prototype.mulTo=function(b,c,d){b.multiplyTo(c,d);this.reduce(d)};Ha.prototype.sqrTo=function(b,c){b.squareTo(c);this.reduce(c)};var aa=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,
313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],xa=67108864/aa[aa.length-1];n.prototype.chunkSize=function(b){return Math.floor(Math.LN2*
this.DB/Math.log(b))};n.prototype.toRadix=function(b){null==b&&(b=10);if(0==this.signum()||2>b||36<b)return"0";var c=this.chunkSize(b),c=Math.pow(b,c),d=fa(c),g=F(),f=F(),l="";for(this.divRemTo(d,g,f);0<g.signum();)l=(c+f.intValue()).toString(b).substr(1)+l,g.divRemTo(d,g,f);return f.intValue().toString(b)+l};n.prototype.fromRadix=function(b,c){this.fromInt(0);null==c&&(c=10);for(var d=this.chunkSize(c),g=Math.pow(c,d),f=!1,l=0,p=0,E=0;E<b.length;++E){var t=za(b,E);0>t?"-"==b.charAt(E)&&0==this.signum()&&
(f=!0):(p=c*p+t,++l>=d&&(this.dMultiply(g),this.dAddOffset(p,0),p=l=0))}0<l&&(this.dMultiply(Math.pow(c,l)),this.dAddOffset(p,0));f&&n.ZERO.subTo(this,this)};n.prototype.fromNumber=function(b,c,d){if("number"==typeof c)if(2>b)this.fromInt(1);else for(this.fromNumber(b,d),this.testBit(b-1)||this.bitwiseTo(n.ONE.shiftLeft(b-1),Q,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(c);)this.dAddOffset(2,0),this.bitLength()>b&&this.subTo(n.ONE.shiftLeft(b-1),this);else{d=[];var g=b&7;d.length=
(b>>3)+1;c.nextBytes(d);d[0]=0<g?d[0]&(1<<g)-1:0;this.fromString(d,256)}};n.prototype.bitwiseTo=function(b,c,d){var g,f,l=Math.min(b.t,this.t);for(g=0;g<l;++g)d[g]=c(this[g],b[g]);if(b.t<this.t){f=b.s&this.DM;for(g=l;g<this.t;++g)d[g]=c(this[g],f);d.t=this.t}else{f=this.s&this.DM;for(g=l;g<b.t;++g)d[g]=c(f,b[g]);d.t=b.t}d.s=c(this.s,b.s);d.clamp()};n.prototype.changeBit=function(b,c){var d=n.ONE.shiftLeft(b);this.bitwiseTo(d,c,d);return d};n.prototype.addTo=function(b,c){for(var d=0,g=0,f=Math.min(b.t,
this.t);d<f;)g+=this[d]+b[d],c[d++]=g&this.DM,g>>=this.DB;if(b.t<this.t){for(g+=b.s;d<this.t;)g+=this[d],c[d++]=g&this.DM,g>>=this.DB;g+=this.s}else{for(g+=this.s;d<b.t;)g+=b[d],c[d++]=g&this.DM,g>>=this.DB;g+=b.s}c.s=0>g?-1:0;0<g?c[d++]=g:-1>g&&(c[d++]=this.DV+g);c.t=d;c.clamp()};n.prototype.dMultiply=function(b){this[this.t]=this.am(0,b-1,this,0,0,this.t);++this.t;this.clamp()};n.prototype.dAddOffset=function(b,c){if(0!=b){for(;this.t<=c;)this[this.t++]=0;for(this[c]+=b;this[c]>=this.DV;)this[c]-=
this.DV,++c>=this.t&&(this[this.t++]=0),++this[c]}};n.prototype.multiplyLowerTo=function(b,c,d){var g=Math.min(this.t+b.t,c);d.s=0;for(d.t=g;0<g;)d[--g]=0;var f;for(f=d.t-this.t;g<f;++g)d[g+this.t]=this.am(0,b[g],d,g,0,this.t);for(f=Math.min(b.t,c);g<f;++g)this.am(0,b[g],d,g,0,c-g);d.clamp()};n.prototype.multiplyUpperTo=function(b,c,d){--c;var g=d.t=this.t+b.t-c;for(d.s=0;0<=--g;)d[g]=0;for(g=Math.max(c-this.t,0);g<b.t;++g)d[this.t+g-c]=this.am(c-g,b[g],d,0,0,this.t+g-c);d.clamp();d.drShiftTo(1,d)};
n.prototype.modInt=function(b){if(0>=b)return 0;var c=this.DV%b,d=0>this.s?b-1:0;if(0<this.t)if(0==c)d=this[0]%b;else for(var g=this.t-1;0<=g;--g)d=(c*d+this[g])%b;return d};n.prototype.millerRabin=function(b){var c=this.subtract(n.ONE),d=c.getLowestSetBit();if(0>=d)return!1;var g=c.shiftRight(d);b=b+1>>1;b>aa.length&&(b=aa.length);for(var f=F(),l=0;l<b;++l){f.fromInt(aa[Math.floor(Math.random()*aa.length)]);var p=f.modPow(g,this);if(0!=p.compareTo(n.ONE)&&0!=p.compareTo(c)){for(var E=1;E++<d&&0!=
p.compareTo(c);)if(p=p.modPowInt(2,this),0==p.compareTo(n.ONE))return!1;if(0!=p.compareTo(c))return!1}}return!0};n.prototype.clone=function(){var b=F();this.copyTo(b);return b};n.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]};n.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24};n.prototype.shortValue=function(){return 0==
this.t?this.s:this[0]<<16>>16};n.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this[0]?0:1};n.prototype.toByteArray=function(){var b=this.t,c=[];c[0]=this.s;var d=this.DB-b*this.DB%8,g,f=0;if(0<b--)for(d<this.DB&&(g=this[b]>>d)!=(this.s&this.DM)>>d&&(c[f++]=g|this.s<<this.DB-d);0<=b;)if(8>d?(g=(this[b]&(1<<d)-1)<<8-d,g|=this[--b]>>(d+=this.DB-8)):(g=this[b]>>(d-=8)&255,0>=d&&(d+=this.DB,--b)),0!=(g&128)&&(g|=-256),0==f&&(this.s&128)!=(g&128)&&++f,0<f||g!=this.s)c[f++]=g;
return c};n.prototype.equals=function(b){return 0==this.compareTo(b)};n.prototype.min=function(b){return 0>this.compareTo(b)?this:b};n.prototype.max=function(b){return 0<this.compareTo(b)?this:b};n.prototype.and=function(b){var c=F();this.bitwiseTo(b,S,c);return c};n.prototype.or=function(b){var c=F();this.bitwiseTo(b,Q,c);return c};n.prototype.xor=function(b){var c=F();this.bitwiseTo(b,ca,c);return c};n.prototype.andNot=function(b){var c=F();this.bitwiseTo(b,Lb,c);return c};n.prototype.not=function(){for(var b=
F(),c=0;c<this.t;++c)b[c]=this.DM&~this[c];b.t=this.t;b.s=~this.s;return b};n.prototype.shiftLeft=function(b){var c=F();0>b?this.rShiftTo(-b,c):this.lShiftTo(b,c);return c};n.prototype.shiftRight=function(b){var c=F();0>b?this.lShiftTo(-b,c):this.rShiftTo(b,c);return c};n.prototype.getLowestSetBit=function(){for(var b=0;b<this.t;++b)if(0!=this[b]){var c=b*this.DB,b=this[b];if(0==b)b=-1;else{var d=0;0==(b&65535)&&(b>>=16,d+=16);0==(b&255)&&(b>>=8,d+=8);0==(b&15)&&(b>>=4,d+=4);0==(b&3)&&(b>>=2,d+=2);
0==(b&1)&&++d;b=d}return c+b}return 0>this.s?this.t*this.DB:-1};n.prototype.bitCount=function(){for(var b=0,c=this.s&this.DM,d=0;d<this.t;++d){for(var g=this[d]^c,f=0;0!=g;)g&=g-1,++f;b+=f}return b};n.prototype.testBit=function(b){var c=Math.floor(b/this.DB);return c>=this.t?0!=this.s:0!=(this[c]&1<<b%this.DB)};n.prototype.setBit=function(b){return this.changeBit(b,Q)};n.prototype.clearBit=function(b){return this.changeBit(b,Lb)};n.prototype.flipBit=function(b){return this.changeBit(b,ca)};n.prototype.add=
function(b){var c=F();this.addTo(b,c);return c};n.prototype.subtract=function(b){var c=F();this.subTo(b,c);return c};n.prototype.multiply=function(b){var c=F();this.multiplyTo(b,c);return c};n.prototype.divide=function(b){var c=F();this.divRemTo(b,c,null);return c};n.prototype.remainder=function(b){var c=F();this.divRemTo(b,null,c);return c};n.prototype.divideAndRemainder=function(b){var c=F(),d=F();this.divRemTo(b,c,d);return[c,d]};n.prototype.modPow=function(b,c){var d=b.bitLength(),g,f=fa(1),l;
if(0>=d)return f;g=18>d?1:48>d?3:144>d?4:768>d?5:6;l=8>d?new P(c):c.isEven()?new Ha(c):new t(c);var p=[],E=3,n=g-1,Ga=(1<<g)-1;p[1]=l.convert(this);if(1<g)for(d=F(),l.sqrTo(p[1],d);E<=Ga;)p[E]=F(),l.mulTo(d,p[E-2],p[E]),E+=2;for(var M=b.t-1,Z,N=!0,R=F(),d=G(b[M])-1;0<=M;){d>=n?Z=b[M]>>d-n&Ga:(Z=(b[M]&(1<<d+1)-1)<<n-d,0<M&&(Z|=b[M-1]>>this.DB+d-n));for(E=g;0==(Z&1);)Z>>=1,--E;0>(d-=E)&&(d+=this.DB,--M);if(N)p[Z].copyTo(f),N=!1;else{for(;1<E;)l.sqrTo(f,R),l.sqrTo(R,f),E-=2;0<E?l.sqrTo(f,R):(E=f,f=R,
R=E);l.mulTo(R,p[Z],f)}for(;0<=M&&0==(b[M]&1<<d);)l.sqrTo(f,R),E=f,f=R,R=E,0>--d&&(d=this.DB-1,--M)}return l.revert(f)};n.prototype.modInverse=function(b){var c=b.isEven();if(this.isEven()&&c||0==b.signum())return n.ZERO;for(var d=b.clone(),g=this.clone(),f=fa(1),l=fa(0),p=fa(0),E=fa(1);0!=d.signum();){for(;d.isEven();)d.rShiftTo(1,d),c?(f.isEven()&&l.isEven()||(f.addTo(this,f),l.subTo(b,l)),f.rShiftTo(1,f)):l.isEven()||l.subTo(b,l),l.rShiftTo(1,l);for(;g.isEven();)g.rShiftTo(1,g),c?(p.isEven()&&
E.isEven()||(p.addTo(this,p),E.subTo(b,E)),p.rShiftTo(1,p)):E.isEven()||E.subTo(b,E),E.rShiftTo(1,E);0<=d.compareTo(g)?(d.subTo(g,d),c&&f.subTo(p,f),l.subTo(E,l)):(g.subTo(d,g),c&&p.subTo(f,p),E.subTo(l,E))}if(0!=g.compareTo(n.ONE))return n.ZERO;if(0<=E.compareTo(b))return E.subtract(b);if(0>E.signum())E.addTo(b,E);else return E;return 0>E.signum()?E.add(b):E};n.prototype.pow=function(b){return this.exp(b,new Za)};n.prototype.gcd=function(b){var c=0>this.s?this.negate():this.clone();b=0>b.s?b.negate():
b.clone();if(0>c.compareTo(b)){var d=c,c=b;b=d}var d=c.getLowestSetBit(),g=b.getLowestSetBit();if(0>g)return c;d<g&&(g=d);for(0<g&&(c.rShiftTo(g,c),b.rShiftTo(g,b));0<c.signum();)0<(d=c.getLowestSetBit())&&c.rShiftTo(d,c),0<(d=b.getLowestSetBit())&&b.rShiftTo(d,b),0<=c.compareTo(b)?(c.subTo(b,c),c.rShiftTo(1,c)):(b.subTo(c,b),b.rShiftTo(1,b));0<g&&b.lShiftTo(g,b);return b};n.prototype.isProbablePrime=function(b){var c,d=this.abs();if(1==d.t&&d[0]<=aa[aa.length-1]){for(c=0;c<aa.length;++c)if(d[0]==
aa[c])return!0;return!1}if(d.isEven())return!1;for(c=1;c<aa.length;){for(var g=aa[c],f=c+1;f<aa.length&&g<xa;)g*=aa[f++];for(g=d.modInt(g);c<f;)if(0==g%aa[c++])return!1}return d.millerRabin(b)};n.prototype.square=function(){var b=F();this.squareTo(b);return b};n.prototype.IsNegative=function(){return-1==this.compareTo(n.ZERO)?!0:!1};n.op_Equality=function(b,c){return 0==b.compareTo(c)?!0:!1};n.op_Inequality=function(b,c){return 0!=b.compareTo(c)?!0:!1};n.op_GreaterThan=function(b,c){return 0<b.compareTo(c)?
!0:!1};n.op_LessThan=function(b,c){return 0>b.compareTo(c)?!0:!1};n.op_Addition=function(b,c){return(new n(b)).add(new n(c))};n.op_Subtraction=function(b,c){return(new n(b)).subtract(new n(c))};n.Int128Mul=function(b,c){return(new n(b)).multiply(new n(c))};n.op_Division=function(b,c){return b.divide(c)};n.prototype.ToDouble=function(){return parseFloat(this.toString())};if("undefined"==typeof Wa)var Wa=function(b,c){var d;if("undefined"==typeof Object.getOwnPropertyNames)for(d in c.prototype){if("undefined"==
typeof b.prototype[d]||b.prototype[d]==Object.prototype[d])b.prototype[d]=c.prototype[d]}else for(var g=Object.getOwnPropertyNames(c.prototype),f=0;f<g.length;f++)"undefined"==typeof Object.getOwnPropertyDescriptor(b.prototype,g[f])&&Object.defineProperty(b.prototype,g[f],Object.getOwnPropertyDescriptor(c.prototype,g[f]));for(d in c)"undefined"==typeof b[d]&&(b[d]=c[d]);b.$baseCtor=c};f.Path=function(){return[]};f.Paths=function(){return[]};f.DoublePoint=function(){var b=arguments;this.Y=this.X=0;
1==b.length?(this.X=b[0].X,this.Y=b[0].Y):2==b.length&&(this.X=b[0],this.Y=b[1])};f.DoublePoint0=function(){this.Y=this.X=0};f.DoublePoint1=function(b){this.X=b.X;this.Y=b.Y};f.DoublePoint2=function(b,c){this.X=b;this.Y=c};f.PolyNode=function(){this.m_Parent=null;this.m_polygon=new f.Path;this.m_endtype=this.m_jointype=this.m_Index=0;this.m_Childs=[];this.IsOpen=!1};f.PolyNode.prototype.IsHoleNode=function(){for(var b=!0,c=this.m_Parent;null!==c;)b=!b,c=c.m_Parent;return b};f.PolyNode.prototype.ChildCount=
function(){return this.m_Childs.length};f.PolyNode.prototype.Contour=function(){return this.m_polygon};f.PolyNode.prototype.AddChild=function(b){var c=this.m_Childs.length;this.m_Childs.push(b);b.m_Parent=this;b.m_Index=c};f.PolyNode.prototype.GetNext=function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()};f.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+
1]};f.PolyNode.prototype.Childs=function(){return this.m_Childs};f.PolyNode.prototype.Parent=function(){return this.m_Parent};f.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()};f.PolyTree=function(){this.m_AllPolys=[];f.PolyNode.call(this)};f.PolyTree.prototype.Clear=function(){for(var b=0,c=this.m_AllPolys.length;b<c;b++)this.m_AllPolys[b]=null;this.m_AllPolys.length=0;this.m_Childs.length=0};f.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null};
f.PolyTree.prototype.Total=function(){return this.m_AllPolys.length};Wa(f.PolyTree,f.PolyNode);f.Math_Abs_Int64=f.Math_Abs_Int32=f.Math_Abs_Double=function(b){return Math.abs(b)};f.Math_Max_Int32_Int32=function(b,c){return Math.max(b,c)};f.Cast_Int32=N||Ka||Va?function(b){return b|0}:function(b){return~~b};f.Cast_Int64=Ia?function(b){return-2147483648>b||2147483647<b?0>b?Math.ceil(b):Math.floor(b):~~b}:Ja&&"function"==typeof Number.toInteger?function(b){return Number.toInteger(b)}:X||Pa?function(b){return parseInt(b,
10)}:N?function(b){return-2147483648>b||2147483647<b?0>b?Math.ceil(b):Math.floor(b):b|0}:function(b){return 0>b?Math.ceil(b):Math.floor(b)};f.Clear=function(b){b.length=0};f.PI=3.141592653589793;f.PI2=6.283185307179586;f.IntPoint=function(){var b;b=arguments;var c=b.length;this.Y=this.X=0;2==c?(this.X=b[0],this.Y=b[1]):1==c?b[0]instanceof f.DoublePoint?(b=b[0],this.X=f.Clipper.Round(b.X),this.Y=f.Clipper.Round(b.Y)):(b=b[0],this.X=b.X,this.Y=b.Y):this.Y=this.X=0};f.IntPoint.op_Equality=function(b,
c){return b.X==c.X&&b.Y==c.Y};f.IntPoint.op_Inequality=function(b,c){return b.X!=c.X||b.Y!=c.Y};f.IntPoint0=function(){this.Y=this.X=0};f.IntPoint1=function(b){this.X=b.X;this.Y=b.Y};f.IntPoint1dp=function(b){this.X=f.Clipper.Round(b.X);this.Y=f.Clipper.Round(b.Y)};f.IntPoint2=function(b,c){this.X=b;this.Y=c};f.IntRect=function(){var b=arguments,c=b.length;4==c?(this.left=b[0],this.top=b[1],this.right=b[2],this.bottom=b[3]):1==c?(this.left=b[0].left,this.top=b[0].top,this.right=b[0].right,this.bottom=
b[0].bottom):this.bottom=this.right=this.top=this.left=0};f.IntRect0=function(){this.bottom=this.right=this.top=this.left=0};f.IntRect1=function(b){this.left=b.left;this.top=b.top;this.right=b.right;this.bottom=b.bottom};f.IntRect4=function(b,c,d,g){this.left=b;this.top=c;this.right=d;this.bottom=g};f.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3};f.PolyType={ptSubject:0,ptClip:1};f.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3};f.JoinType={jtSquare:0,jtRound:1,
jtMiter:2};f.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4};f.EdgeSide={esLeft:0,esRight:1};f.Direction={dRightToLeft:0,dLeftToRight:1};f.TEdge=function(){this.Bot=new f.IntPoint;this.Curr=new f.IntPoint;this.Top=new f.IntPoint;this.Delta=new f.IntPoint;this.Dx=0;this.PolyTyp=f.PolyType.ptSubject;this.Side=f.EdgeSide.esLeft;this.OutIdx=this.WindCnt2=this.WindCnt=this.WindDelta=0;this.PrevInSEL=this.NextInSEL=this.PrevInAEL=this.NextInAEL=this.NextInLML=this.Prev=
this.Next=null};f.IntersectNode=function(){this.Edge2=this.Edge1=null;this.Pt=new f.IntPoint};f.MyIntersectNodeSort=function(){};f.MyIntersectNodeSort.Compare=function(b,c){return c.Pt.Y-b.Pt.Y};f.LocalMinima=function(){this.Y=0;this.Next=this.RightBound=this.LeftBound=null};f.Scanbeam=function(){this.Y=0;this.Next=null};f.OutRec=function(){this.Idx=0;this.IsOpen=this.IsHole=!1;this.PolyNode=this.BottomPt=this.Pts=this.FirstLeft=null};f.OutPt=function(){this.Idx=0;this.Pt=new f.IntPoint;this.Prev=
this.Next=null};f.Join=function(){this.OutPt2=this.OutPt1=null;this.OffPt=new f.IntPoint};f.ClipperBase=function(){this.m_CurrentLM=this.m_MinimaList=null;this.m_edges=[];this.PreserveCollinear=this.m_HasOpenPaths=this.m_UseFullRange=!1;this.m_CurrentLM=this.m_MinimaList=null;this.m_HasOpenPaths=this.m_UseFullRange=!1};f.ClipperBase.horizontal=-9007199254740992;f.ClipperBase.Skip=-2;f.ClipperBase.Unassigned=-1;f.ClipperBase.tolerance=1E-20;f.ClipperBase.loRange=47453132;f.ClipperBase.hiRange=0xfffffffffffff;
f.ClipperBase.near_zero=function(b){return b>-f.ClipperBase.tolerance&&b<f.ClipperBase.tolerance};f.ClipperBase.IsHorizontal=function(b){return 0===b.Delta.Y};f.ClipperBase.prototype.PointIsVertex=function(b,c){var d=c;do{if(f.IntPoint.op_Equality(d.Pt,b))return!0;d=d.Next}while(d!=c);return!1};f.ClipperBase.prototype.PointOnLineSegment=function(b,c,d,g){return g?b.X==c.X&&b.Y==c.Y||b.X==d.X&&b.Y==d.Y||b.X>c.X==b.X<d.X&&b.Y>c.Y==b.Y<d.Y&&n.op_Equality(n.Int128Mul(b.X-c.X,d.Y-c.Y),n.Int128Mul(d.X-
c.X,b.Y-c.Y)):b.X==c.X&&b.Y==c.Y||b.X==d.X&&b.Y==d.Y||b.X>c.X==b.X<d.X&&b.Y>c.Y==b.Y<d.Y&&(b.X-c.X)*(d.Y-c.Y)==(d.X-c.X)*(b.Y-c.Y)};f.ClipperBase.prototype.PointOnPolygon=function(b,c,d){for(var g=c;;){if(this.PointOnLineSegment(b,g.Pt,g.Next.Pt,d))return!0;g=g.Next;if(g==c)break}return!1};f.ClipperBase.prototype.SlopesEqual=f.ClipperBase.SlopesEqual=function(){var b=arguments,c=b.length,d,g,m;if(3==c)return c=b[0],d=b[1],b[2]?n.op_Equality(n.Int128Mul(c.Delta.Y,d.Delta.X),n.Int128Mul(c.Delta.X,d.Delta.Y)):
f.Cast_Int64(c.Delta.Y*d.Delta.X)==f.Cast_Int64(c.Delta.X*d.Delta.Y);if(4==c)return c=b[0],d=b[1],g=b[2],b[3]?n.op_Equality(n.Int128Mul(c.Y-d.Y,d.X-g.X),n.Int128Mul(c.X-d.X,d.Y-g.Y)):0===f.Cast_Int64((c.Y-d.Y)*(d.X-g.X))-f.Cast_Int64((c.X-d.X)*(d.Y-g.Y));c=b[0];d=b[1];g=b[2];m=b[3];return b[4]?n.op_Equality(n.Int128Mul(c.Y-d.Y,g.X-m.X),n.Int128Mul(c.X-d.X,g.Y-m.Y)):0===f.Cast_Int64((c.Y-d.Y)*(g.X-m.X))-f.Cast_Int64((c.X-d.X)*(g.Y-m.Y))};f.ClipperBase.SlopesEqual3=function(b,c,d){return d?n.op_Equality(n.Int128Mul(b.Delta.Y,
c.Delta.X),n.Int128Mul(b.Delta.X,c.Delta.Y)):f.Cast_Int64(b.Delta.Y*c.Delta.X)==f.Cast_Int64(b.Delta.X*c.Delta.Y)};f.ClipperBase.SlopesEqual4=function(b,c,d,g){return g?n.op_Equality(n.Int128Mul(b.Y-c.Y,c.X-d.X),n.Int128Mul(b.X-c.X,c.Y-d.Y)):0===f.Cast_Int64((b.Y-c.Y)*(c.X-d.X))-f.Cast_Int64((b.X-c.X)*(c.Y-d.Y))};f.ClipperBase.SlopesEqual5=function(b,c,d,g,m){return m?n.op_Equality(n.Int128Mul(b.Y-c.Y,d.X-g.X),n.Int128Mul(b.X-c.X,d.Y-g.Y)):0===f.Cast_Int64((b.Y-c.Y)*(d.X-g.X))-f.Cast_Int64((b.X-c.X)*
(d.Y-g.Y))};f.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var b=0,c=this.m_edges.length;b<c;++b){for(var d=0,g=this.m_edges[b].length;d<g;++d)this.m_edges[b][d]=null;f.Clear(this.m_edges[b])}f.Clear(this.m_edges);this.m_HasOpenPaths=this.m_UseFullRange=!1};f.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var b=this.m_MinimaList.Next;this.m_MinimaList=null;this.m_MinimaList=b}this.m_CurrentLM=null};f.ClipperBase.prototype.RangeTest=
function(b,c){if(c.Value)(b.X>f.ClipperBase.hiRange||b.Y>f.ClipperBase.hiRange||-b.X>f.ClipperBase.hiRange||-b.Y>f.ClipperBase.hiRange)&&f.Error("Coordinate outside allowed range in RangeTest().");else if(b.X>f.ClipperBase.loRange||b.Y>f.ClipperBase.loRange||-b.X>f.ClipperBase.loRange||-b.Y>f.ClipperBase.loRange)c.Value=!0,this.RangeTest(b,c)};f.ClipperBase.prototype.InitEdge=function(b,c,d,g){b.Next=c;b.Prev=d;b.Curr.X=g.X;b.Curr.Y=g.Y;b.OutIdx=-1};f.ClipperBase.prototype.InitEdge2=function(b,c){b.Curr.Y>=
b.Next.Curr.Y?(b.Bot.X=b.Curr.X,b.Bot.Y=b.Curr.Y,b.Top.X=b.Next.Curr.X,b.Top.Y=b.Next.Curr.Y):(b.Top.X=b.Curr.X,b.Top.Y=b.Curr.Y,b.Bot.X=b.Next.Curr.X,b.Bot.Y=b.Next.Curr.Y);this.SetDx(b);b.PolyTyp=c};f.ClipperBase.prototype.FindNextLocMin=function(b){for(var c;;){for(;f.IntPoint.op_Inequality(b.Bot,b.Prev.Bot)||f.IntPoint.op_Equality(b.Curr,b.Top);)b=b.Next;if(b.Dx!=f.ClipperBase.horizontal&&b.Prev.Dx!=f.ClipperBase.horizontal)break;for(;b.Prev.Dx==f.ClipperBase.horizontal;)b=b.Prev;for(c=b;b.Dx==
f.ClipperBase.horizontal;)b=b.Next;if(b.Top.Y!=b.Prev.Bot.Y){c.Prev.Bot.X<b.Bot.X&&(b=c);break}}return b};f.ClipperBase.prototype.ProcessBound=function(b,c){var d=b,g=b,m;b.Dx==f.ClipperBase.horizontal&&(m=c?b.Prev.Bot.X:b.Next.Bot.X,b.Bot.X!=m&&this.ReverseHorizontal(b));if(g.OutIdx!=f.ClipperBase.Skip)if(c){for(;g.Top.Y==g.Next.Bot.Y&&g.Next.OutIdx!=f.ClipperBase.Skip;)g=g.Next;if(g.Dx==f.ClipperBase.horizontal&&g.Next.OutIdx!=f.ClipperBase.Skip){for(m=g;m.Prev.Dx==f.ClipperBase.horizontal;)m=m.Prev;
m.Prev.Top.X==g.Next.Top.X?c||(g=m.Prev):m.Prev.Top.X>g.Next.Top.X&&(g=m.Prev)}for(;b!=g;)b.NextInLML=b.Next,b.Dx==f.ClipperBase.horizontal&&b!=d&&b.Bot.X!=b.Prev.Top.X&&this.ReverseHorizontal(b),b=b.Next;b.Dx==f.ClipperBase.horizontal&&b!=d&&b.Bot.X!=b.Prev.Top.X&&this.ReverseHorizontal(b);g=g.Next}else{for(;g.Top.Y==g.Prev.Bot.Y&&g.Prev.OutIdx!=f.ClipperBase.Skip;)g=g.Prev;if(g.Dx==f.ClipperBase.horizontal&&g.Prev.OutIdx!=f.ClipperBase.Skip){for(m=g;m.Next.Dx==f.ClipperBase.horizontal;)m=m.Next;
m.Next.Top.X==g.Prev.Top.X?c||(g=m.Next):m.Next.Top.X>g.Prev.Top.X&&(g=m.Next)}for(;b!=g;)b.NextInLML=b.Prev,b.Dx==f.ClipperBase.horizontal&&b!=d&&b.Bot.X!=b.Next.Top.X&&this.ReverseHorizontal(b),b=b.Prev;b.Dx==f.ClipperBase.horizontal&&b!=d&&b.Bot.X!=b.Next.Top.X&&this.ReverseHorizontal(b);g=g.Prev}if(g.OutIdx==f.ClipperBase.Skip){b=g;if(c){for(;b.Top.Y==b.Next.Bot.Y;)b=b.Next;for(;b!=g&&b.Dx==f.ClipperBase.horizontal;)b=b.Prev}else{for(;b.Top.Y==b.Prev.Bot.Y;)b=b.Prev;for(;b!=g&&b.Dx==f.ClipperBase.horizontal;)b=
b.Next}b==g?g=c?b.Next:b.Prev:(b=c?g.Next:g.Prev,d=new f.LocalMinima,d.Next=null,d.Y=b.Bot.Y,d.LeftBound=null,d.RightBound=b,d.RightBound.WindDelta=0,g=this.ProcessBound(d.RightBound,c),this.InsertLocalMinima(d))}return g};f.ClipperBase.prototype.AddPath=function(b,c,d){d||c!=f.PolyType.ptClip||f.Error("AddPath: Open paths must be subject.");var g=b.length-1;if(d)for(;0<g&&f.IntPoint.op_Equality(b[g],b[0]);)--g;for(;0<g&&f.IntPoint.op_Equality(b[g],b[g-1]);)--g;if(d&&2>g||!d&&1>g)return!1;for(var m=
[],l=0;l<=g;l++)m.push(new f.TEdge);var p=!0;try{for(m[1].Curr.X=b[1].X,m[1].Curr.Y=b[1].Y,function(){var c={Value:this.m_UseFullRange},d=this.RangeTest(b[0],c);this.m_UseFullRange=c.Value;return d}.call(this),function(){var c={Value:this.m_UseFullRange},d=this.RangeTest(b[g],c);this.m_UseFullRange=c.Value;return d}.call(this),this.InitEdge(m[0],m[1],m[g],b[0]),this.InitEdge(m[g],m[0],m[g-1],b[g]),l=g-1;1<=l;--l)(function(){var c={Value:this.m_UseFullRange},d=this.RangeTest(b[l],c);this.m_UseFullRange=
c.Value;return d}).call(this),this.InitEdge(m[l],m[l+1],m[l-1],b[l])}catch(E){return!1}var t=m[0];d||(t.Prev.OutIdx=f.ClipperBase.Skip);for(var n=t,G=t;;)if(f.IntPoint.op_Equality(n.Curr,n.Next.Curr)){if(n==n.Next)break;n==t&&(t=n.Next);G=n=this.RemoveEdge(n)}else{if(n.Prev==n.Next)break;else if(d&&f.ClipperBase.SlopesEqual(n.Prev.Curr,n.Curr,n.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(n.Prev.Curr,n.Curr,n.Next.Curr))){n==t&&(t=n.Next);n=this.RemoveEdge(n);
G=n=n.Prev;continue}n=n.Next;if(n==G)break}if(!d&&n==n.Next||d&&n.Prev==n.Next)return!1;d||(this.m_HasOpenPaths=!0);n=t;do this.InitEdge2(n,c),n=n.Next,p&&n.Curr.Y!=t.Curr.Y&&(p=!1);while(n!=t);if(p){if(d)return!1;n.Prev.OutIdx=f.ClipperBase.Skip;n.Prev.Bot.X<n.Prev.Top.X&&this.ReverseHorizontal(n.Prev);c=new f.LocalMinima;c.Next=null;c.Y=n.Bot.Y;c.LeftBound=null;c.RightBound=n;c.RightBound.Side=f.EdgeSide.esRight;for(c.RightBound.WindDelta=0;n.Next.OutIdx!=f.ClipperBase.Skip;)n.NextInLML=n.Next,
n.Bot.X!=n.Prev.Top.X&&this.ReverseHorizontal(n),n=n.Next;this.InsertLocalMinima(c);this.m_edges.push(m);return!0}this.m_edges.push(m);for(p=null;;){n=this.FindNextLocMin(n);if(n==p)break;else null==p&&(p=n);c=new f.LocalMinima;c.Next=null;c.Y=n.Bot.Y;n.Dx<n.Prev.Dx?(c.LeftBound=n.Prev,c.RightBound=n,m=!1):(c.LeftBound=n,c.RightBound=n.Prev,m=!0);c.LeftBound.Side=f.EdgeSide.esLeft;c.RightBound.Side=f.EdgeSide.esRight;c.LeftBound.WindDelta=d?c.LeftBound.Next==c.RightBound?-1:1:0;c.RightBound.WindDelta=
-c.LeftBound.WindDelta;n=this.ProcessBound(c.LeftBound,m);t=this.ProcessBound(c.RightBound,!m);c.LeftBound.OutIdx==f.ClipperBase.Skip?c.LeftBound=null:c.RightBound.OutIdx==f.ClipperBase.Skip&&(c.RightBound=null);this.InsertLocalMinima(c);m||(n=t)}return!0};f.ClipperBase.prototype.AddPaths=function(b,c,d){for(var g=!1,f=0,l=b.length;f<l;++f)this.AddPath(b[f],c,d)&&(g=!0);return g};f.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(b,c,d){return f.IntPoint.op_Equality(b,d)||f.IntPoint.op_Equality(b,
c)||f.IntPoint.op_Equality(d,c)?!1:b.X!=d.X?c.X>b.X==c.X<d.X:c.Y>b.Y==c.Y<d.Y};f.ClipperBase.prototype.RemoveEdge=function(b){b.Prev.Next=b.Next;b.Next.Prev=b.Prev;var c=b.Next;b.Prev=null;return c};f.ClipperBase.prototype.SetDx=function(b){b.Delta.X=b.Top.X-b.Bot.X;b.Delta.Y=b.Top.Y-b.Bot.Y;b.Dx=0===b.Delta.Y?f.ClipperBase.horizontal:b.Delta.X/b.Delta.Y};f.ClipperBase.prototype.InsertLocalMinima=function(b){if(null===this.m_MinimaList)this.m_MinimaList=b;else if(b.Y>=this.m_MinimaList.Y)b.Next=this.m_MinimaList,
this.m_MinimaList=b;else{for(var c=this.m_MinimaList;null!==c.Next&&b.Y<c.Next.Y;)c=c.Next;b.Next=c.Next;c.Next=b}};f.ClipperBase.prototype.PopLocalMinima=function(){null!==this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.Next)};f.ClipperBase.prototype.ReverseHorizontal=function(b){var c=b.Top.X;b.Top.X=b.Bot.X;b.Bot.X=c};f.ClipperBase.prototype.Reset=function(){this.m_CurrentLM=this.m_MinimaList;if(null!=this.m_CurrentLM)for(var b=this.m_MinimaList;null!=b;){var c=b.LeftBound;null!=c&&(c.Curr.X=
c.Bot.X,c.Curr.Y=c.Bot.Y,c.Side=f.EdgeSide.esLeft,c.OutIdx=f.ClipperBase.Unassigned);c=b.RightBound;null!=c&&(c.Curr.X=c.Bot.X,c.Curr.Y=c.Bot.Y,c.Side=f.EdgeSide.esRight,c.OutIdx=f.ClipperBase.Unassigned);b=b.Next}};f.Clipper=function(b){"undefined"==typeof b&&(b=0);this.m_PolyOuts=null;this.m_ClipType=f.ClipType.ctIntersection;this.m_IntersectNodeComparer=this.m_IntersectList=this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_ExecuteLocked=!1;this.m_SubjFillType=this.m_ClipFillType=
f.PolyFillType.pftEvenOdd;this.m_GhostJoins=this.m_Joins=null;this.StrictlySimple=this.ReverseSolution=this.m_UsingPolyTree=!1;f.ClipperBase.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_IntersectList=[];this.m_IntersectNodeComparer=f.MyIntersectNodeSort.Compare;this.m_UsingPolyTree=this.m_ExecuteLocked=!1;this.m_PolyOuts=[];this.m_Joins=[];this.m_GhostJoins=[];this.ReverseSolution=0!==(1&b);this.StrictlySimple=0!==(2&b);this.PreserveCollinear=0!==(4&b)};f.Clipper.ioReverseSolution=
1;f.Clipper.ioStrictlySimple=2;f.Clipper.ioPreserveCollinear=4;f.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),f.ClipperBase.prototype.Clear.call(this))};f.Clipper.prototype.DisposeScanbeamList=function(){for(;null!==this.m_Scanbeam;){var b=this.m_Scanbeam.Next;this.m_Scanbeam=null;this.m_Scanbeam=b}};f.Clipper.prototype.Reset=function(){f.ClipperBase.prototype.Reset.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.DisposeAllPolyPts();
for(var b=this.m_MinimaList;null!==b;)this.InsertScanbeam(b.Y),b=b.Next};f.Clipper.prototype.InsertScanbeam=function(b){if(null===this.m_Scanbeam)this.m_Scanbeam=new f.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=b;else if(b>this.m_Scanbeam.Y){var c=new f.Scanbeam;c.Y=b;c.Next=this.m_Scanbeam;this.m_Scanbeam=c}else{for(var d=this.m_Scanbeam;null!==d.Next&&b<=d.Next.Y;)d=d.Next;b!=d.Y&&(c=new f.Scanbeam,c.Y=b,c.Next=d.Next,d.Next=c)}};f.Clipper.prototype.Execute=function(){var b=arguments,
c=b.length,d=b[1]instanceof f.PolyTree;if(4!=c||d){if(4==c&&d){d=b[0];c=b[1];g=b[2];b=b[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;this.m_SubjFillType=g;this.m_ClipFillType=b;this.m_ClipType=d;this.m_UsingPolyTree=!0;(b=this.ExecuteInternal())&&this.BuildResult2(c);this.m_ExecuteLocked=!1;return b}if(2==c&&!d||2==c&&d)return d=b[0],c=b[1],this.Execute(d,c,f.PolyFillType.pftEvenOdd,f.PolyFillType.pftEvenOdd)}else{var d=b[0],c=b[1],g=b[2],b=b[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&
f.Error("Error: PolyTree struct is need for open path clipping.");this.m_ExecuteLocked=!0;f.Clear(c);this.m_SubjFillType=g;this.m_ClipFillType=b;this.m_ClipType=d;this.m_UsingPolyTree=!1;(b=this.ExecuteInternal())&&this.BuildResult(c);this.m_ExecuteLocked=!1;return b}};f.Clipper.prototype.FixHoleLinkage=function(b){if(null!==b.FirstLeft&&(b.IsHole==b.FirstLeft.IsHole||null===b.FirstLeft.Pts)){for(var c=b.FirstLeft;null!==c&&(c.IsHole==b.IsHole||null===c.Pts);)c=c.FirstLeft;b.FirstLeft=c}};f.Clipper.prototype.ExecuteInternal=
function(){try{this.Reset();if(null===this.m_CurrentLM)return!1;var b=this.PopScanbeam();do{this.InsertLocalMinimaIntoAEL(b);f.Clear(this.m_GhostJoins);this.ProcessHorizontals(!1);if(null===this.m_Scanbeam)break;var c=this.PopScanbeam();if(!this.ProcessIntersections(b,c))return!1;this.ProcessEdgesAtTopOfScanbeam(c);b=c}while(null!==this.m_Scanbeam||null!==this.m_CurrentLM);for(var b=0,d=this.m_PolyOuts.length;b<d;b++){var g=this.m_PolyOuts[b];null===g.Pts||g.IsOpen||(g.IsHole^this.ReverseSolution)==
0<this.Area(g)&&this.ReversePolyPtLinks(g.Pts)}this.JoinCommonEdges();b=0;for(d=this.m_PolyOuts.length;b<d;b++)g=this.m_PolyOuts[b],null===g.Pts||g.IsOpen||this.FixupOutPolygon(g);this.StrictlySimple&&this.DoSimplePolygons();return!0}finally{f.Clear(this.m_Joins),f.Clear(this.m_GhostJoins)}};f.Clipper.prototype.PopScanbeam=function(){var b=this.m_Scanbeam.Y;this.m_Scanbeam=this.m_Scanbeam.Next;return b};f.Clipper.prototype.DisposeAllPolyPts=function(){for(var b=0,c=this.m_PolyOuts.length;b<c;++b)this.DisposeOutRec(b);
f.Clear(this.m_PolyOuts)};f.Clipper.prototype.DisposeOutRec=function(b){var c=this.m_PolyOuts[b];null!==c.Pts&&this.DisposeOutPts(c.Pts);this.m_PolyOuts[b]=null};f.Clipper.prototype.DisposeOutPts=function(b){if(null!==b)for(b.Prev.Next=null;null!==b;)b=b.Next};f.Clipper.prototype.AddJoin=function(b,c,d){var g=new f.Join;g.OutPt1=b;g.OutPt2=c;g.OffPt.X=d.X;g.OffPt.Y=d.Y;this.m_Joins.push(g)};f.Clipper.prototype.AddGhostJoin=function(b,c){var d=new f.Join;d.OutPt1=b;d.OffPt.X=c.X;d.OffPt.Y=c.Y;this.m_GhostJoins.push(d)};
f.Clipper.prototype.InsertLocalMinimaIntoAEL=function(b){for(;null!==this.m_CurrentLM&&this.m_CurrentLM.Y==b;){var c=this.m_CurrentLM.LeftBound,d=this.m_CurrentLM.RightBound;this.PopLocalMinima();var g=null;null===c?(this.InsertEdgeIntoAEL(d,null),this.SetWindingCount(d),this.IsContributing(d)&&(g=this.AddOutPt(d,d.Bot))):(null==d?(this.InsertEdgeIntoAEL(c,null),this.SetWindingCount(c),this.IsContributing(c)&&(g=this.AddOutPt(c,c.Bot))):(this.InsertEdgeIntoAEL(c,null),this.InsertEdgeIntoAEL(d,c),
this.SetWindingCount(c),d.WindCnt=c.WindCnt,d.WindCnt2=c.WindCnt2,this.IsContributing(c)&&(g=this.AddLocalMinPoly(c,d,c.Bot))),this.InsertScanbeam(c.Top.Y));null!=d&&(f.ClipperBase.IsHorizontal(d)?this.AddEdgeToSEL(d):this.InsertScanbeam(d.Top.Y));if(null!=c&&null!=d){if(null!==g&&f.ClipperBase.IsHorizontal(d)&&0<this.m_GhostJoins.length&&0!==d.WindDelta)for(var m=0,l=this.m_GhostJoins.length;m<l;m++){var p=this.m_GhostJoins[m];this.HorzSegmentsOverlap(p.OutPt1.Pt,p.OffPt,d.Bot,d.Top)&&this.AddJoin(p.OutPt1,
g,p.OffPt)}0<=c.OutIdx&&null!==c.PrevInAEL&&c.PrevInAEL.Curr.X==c.Bot.X&&0<=c.PrevInAEL.OutIdx&&f.ClipperBase.SlopesEqual(c.PrevInAEL,c,this.m_UseFullRange)&&0!==c.WindDelta&&0!==c.PrevInAEL.WindDelta&&(m=this.AddOutPt(c.PrevInAEL,c.Bot),this.AddJoin(g,m,c.Top));if(c.NextInAEL!=d&&(0<=d.OutIdx&&0<=d.PrevInAEL.OutIdx&&f.ClipperBase.SlopesEqual(d.PrevInAEL,d,this.m_UseFullRange)&&0!==d.WindDelta&&0!==d.PrevInAEL.WindDelta&&(m=this.AddOutPt(d.PrevInAEL,d.Bot),this.AddJoin(g,m,d.Top)),g=c.NextInAEL,null!==
g))for(;g!=d;)this.IntersectEdges(d,g,c.Curr,!1),g=g.NextInAEL}}};f.Clipper.prototype.InsertEdgeIntoAEL=function(b,c){if(null===this.m_ActiveEdges)b.PrevInAEL=null,b.NextInAEL=null,this.m_ActiveEdges=b;else if(null===c&&this.E2InsertsBeforeE1(this.m_ActiveEdges,b))b.PrevInAEL=null,b.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges=this.m_ActiveEdges.PrevInAEL=b;else{for(null===c&&(c=this.m_ActiveEdges);null!==c.NextInAEL&&!this.E2InsertsBeforeE1(c.NextInAEL,b);)c=c.NextInAEL;b.NextInAEL=c.NextInAEL;
null!==c.NextInAEL&&(c.NextInAEL.PrevInAEL=b);b.PrevInAEL=c;c.NextInAEL=b}};f.Clipper.prototype.E2InsertsBeforeE1=function(b,c){return c.Curr.X==b.Curr.X?c.Top.Y>b.Top.Y?c.Top.X<f.Clipper.TopX(b,c.Top.Y):b.Top.X>f.Clipper.TopX(c,b.Top.Y):c.Curr.X<b.Curr.X};f.Clipper.prototype.IsEvenOddFillType=function(b){return b.PolyTyp==f.PolyType.ptSubject?this.m_SubjFillType==f.PolyFillType.pftEvenOdd:this.m_ClipFillType==f.PolyFillType.pftEvenOdd};f.Clipper.prototype.IsEvenOddAltFillType=function(b){return b.PolyTyp==
f.PolyType.ptSubject?this.m_ClipFillType==f.PolyFillType.pftEvenOdd:this.m_SubjFillType==f.PolyFillType.pftEvenOdd};f.Clipper.prototype.IsContributing=function(b){var c,d;b.PolyTyp==f.PolyType.ptSubject?(c=this.m_SubjFillType,d=this.m_ClipFillType):(c=this.m_ClipFillType,d=this.m_SubjFillType);switch(c){case f.PolyFillType.pftEvenOdd:if(0===b.WindDelta&&1!=b.WindCnt)return!1;break;case f.PolyFillType.pftNonZero:if(1!=Math.abs(b.WindCnt))return!1;break;case f.PolyFillType.pftPositive:if(1!=b.WindCnt)return!1;
break;default:if(-1!=b.WindCnt)return!1}switch(this.m_ClipType){case f.ClipType.ctIntersection:switch(d){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0!==b.WindCnt2;case f.PolyFillType.pftPositive:return 0<b.WindCnt2;default:return 0>b.WindCnt2}case f.ClipType.ctUnion:switch(d){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0===b.WindCnt2;case f.PolyFillType.pftPositive:return 0>=b.WindCnt2;default:return 0<=b.WindCnt2}case f.ClipType.ctDifference:if(b.PolyTyp==
f.PolyType.ptSubject)switch(d){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0===b.WindCnt2;case f.PolyFillType.pftPositive:return 0>=b.WindCnt2;default:return 0<=b.WindCnt2}else switch(d){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0!==b.WindCnt2;case f.PolyFillType.pftPositive:return 0<b.WindCnt2;default:return 0>b.WindCnt2}case f.ClipType.ctXor:if(0===b.WindDelta)switch(d){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0===b.WindCnt2;
case f.PolyFillType.pftPositive:return 0>=b.WindCnt2;default:return 0<=b.WindCnt2}}return!0};f.Clipper.prototype.SetWindingCount=function(b){for(var c=b.PrevInAEL;null!==c&&(c.PolyTyp!=b.PolyTyp||0===c.WindDelta);)c=c.PrevInAEL;if(null===c)b.WindCnt=0===b.WindDelta?1:b.WindDelta,b.WindCnt2=0,c=this.m_ActiveEdges;else{if(0===b.WindDelta&&this.m_ClipType!=f.ClipType.ctUnion)b.WindCnt=1;else if(this.IsEvenOddFillType(b))if(0===b.WindDelta){for(var d=!0,g=c.PrevInAEL;null!==g;)g.PolyTyp==c.PolyTyp&&0!==
g.WindDelta&&(d=!d),g=g.PrevInAEL;b.WindCnt=d?0:1}else b.WindCnt=b.WindDelta;else 0>c.WindCnt*c.WindDelta?1<Math.abs(c.WindCnt)?b.WindCnt=0>c.WindDelta*b.WindDelta?c.WindCnt:c.WindCnt+b.WindDelta:b.WindCnt=0===b.WindDelta?1:b.WindDelta:b.WindCnt=0===b.WindDelta?0>c.WindCnt?c.WindCnt-1:c.WindCnt+1:0>c.WindDelta*b.WindDelta?c.WindCnt:c.WindCnt+b.WindDelta;b.WindCnt2=c.WindCnt2;c=c.NextInAEL}if(this.IsEvenOddAltFillType(b))for(;c!=b;)0!==c.WindDelta&&(b.WindCnt2=0===b.WindCnt2?1:0),c=c.NextInAEL;else for(;c!=
b;)b.WindCnt2+=c.WindDelta,c=c.NextInAEL};f.Clipper.prototype.AddEdgeToSEL=function(b){null===this.m_SortedEdges?(this.m_SortedEdges=b,b.PrevInSEL=null,b.NextInSEL=null):(b.NextInSEL=this.m_SortedEdges,b.PrevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.PrevInSEL=b)};f.Clipper.prototype.CopyAELToSEL=function(){var b=this.m_ActiveEdges;for(this.m_SortedEdges=b;null!==b;)b.PrevInSEL=b.PrevInAEL,b=b.NextInSEL=b.NextInAEL};f.Clipper.prototype.SwapPositionsInAEL=function(b,c){if(b.NextInAEL!=b.PrevInAEL&&
c.NextInAEL!=c.PrevInAEL){if(b.NextInAEL==c){var d=c.NextInAEL;null!==d&&(d.PrevInAEL=b);var g=b.PrevInAEL;null!==g&&(g.NextInAEL=c);c.PrevInAEL=g;c.NextInAEL=b;b.PrevInAEL=c;b.NextInAEL=d}else c.NextInAEL==b?(d=b.NextInAEL,null!==d&&(d.PrevInAEL=c),g=c.PrevInAEL,null!==g&&(g.NextInAEL=b),b.PrevInAEL=g,b.NextInAEL=c,c.PrevInAEL=b,c.NextInAEL=d):(d=b.NextInAEL,g=b.PrevInAEL,b.NextInAEL=c.NextInAEL,null!==b.NextInAEL&&(b.NextInAEL.PrevInAEL=b),b.PrevInAEL=c.PrevInAEL,null!==b.PrevInAEL&&(b.PrevInAEL.NextInAEL=
b),c.NextInAEL=d,null!==c.NextInAEL&&(c.NextInAEL.PrevInAEL=c),c.PrevInAEL=g,null!==c.PrevInAEL&&(c.PrevInAEL.NextInAEL=c));null===b.PrevInAEL?this.m_ActiveEdges=b:null===c.PrevInAEL&&(this.m_ActiveEdges=c)}};f.Clipper.prototype.SwapPositionsInSEL=function(b,c){if(null!==b.NextInSEL||null!==b.PrevInSEL)if(null!==c.NextInSEL||null!==c.PrevInSEL){if(b.NextInSEL==c){var d=c.NextInSEL;null!==d&&(d.PrevInSEL=b);var g=b.PrevInSEL;null!==g&&(g.NextInSEL=c);c.PrevInSEL=g;c.NextInSEL=b;b.PrevInSEL=c;b.NextInSEL=
d}else c.NextInSEL==b?(d=b.NextInSEL,null!==d&&(d.PrevInSEL=c),g=c.PrevInSEL,null!==g&&(g.NextInSEL=b),b.PrevInSEL=g,b.NextInSEL=c,c.PrevInSEL=b,c.NextInSEL=d):(d=b.NextInSEL,g=b.PrevInSEL,b.NextInSEL=c.NextInSEL,null!==b.NextInSEL&&(b.NextInSEL.PrevInSEL=b),b.PrevInSEL=c.PrevInSEL,null!==b.PrevInSEL&&(b.PrevInSEL.NextInSEL=b),c.NextInSEL=d,null!==c.NextInSEL&&(c.NextInSEL.PrevInSEL=c),c.PrevInSEL=g,null!==c.PrevInSEL&&(c.PrevInSEL.NextInSEL=c));null===b.PrevInSEL?this.m_SortedEdges=b:null===c.PrevInSEL&&
(this.m_SortedEdges=c)}};f.Clipper.prototype.AddLocalMaxPoly=function(b,c,d){this.AddOutPt(b,d);0==c.WindDelta&&this.AddOutPt(c,d);b.OutIdx==c.OutIdx?(b.OutIdx=-1,c.OutIdx=-1):b.OutIdx<c.OutIdx?this.AppendPolygon(b,c):this.AppendPolygon(c,b)};f.Clipper.prototype.AddLocalMinPoly=function(b,c,d){var g,m;f.ClipperBase.IsHorizontal(c)||b.Dx>c.Dx?(g=this.AddOutPt(b,d),c.OutIdx=b.OutIdx,b.Side=f.EdgeSide.esLeft,c.Side=f.EdgeSide.esRight,m=b,b=m.PrevInAEL==c?c.PrevInAEL:m.PrevInAEL):(g=this.AddOutPt(c,d),
b.OutIdx=c.OutIdx,b.Side=f.EdgeSide.esRight,c.Side=f.EdgeSide.esLeft,m=c,b=m.PrevInAEL==b?b.PrevInAEL:m.PrevInAEL);null!==b&&0<=b.OutIdx&&f.Clipper.TopX(b,d.Y)==f.Clipper.TopX(m,d.Y)&&f.ClipperBase.SlopesEqual(m,b,this.m_UseFullRange)&&0!==m.WindDelta&&0!==b.WindDelta&&(d=this.AddOutPt(b,d),this.AddJoin(g,d,m.Top));return g};f.Clipper.prototype.CreateOutRec=function(){var b=new f.OutRec;b.Idx=-1;b.IsHole=!1;b.IsOpen=!1;b.FirstLeft=null;b.Pts=null;b.BottomPt=null;b.PolyNode=null;this.m_PolyOuts.push(b);
b.Idx=this.m_PolyOuts.length-1;return b};f.Clipper.prototype.AddOutPt=function(b,c){var d=b.Side==f.EdgeSide.esLeft;if(0>b.OutIdx){var g=this.CreateOutRec();g.IsOpen=0===b.WindDelta;var m=new f.OutPt;g.Pts=m;m.Idx=g.Idx;m.Pt.X=c.X;m.Pt.Y=c.Y;m.Next=m;m.Prev=m;g.IsOpen||this.SetHoleState(b,g);b.OutIdx=g.Idx}else{var g=this.m_PolyOuts[b.OutIdx],l=g.Pts;if(d&&f.IntPoint.op_Equality(c,l.Pt))return l;if(!d&&f.IntPoint.op_Equality(c,l.Prev.Pt))return l.Prev;m=new f.OutPt;m.Idx=g.Idx;m.Pt.X=c.X;m.Pt.Y=c.Y;
m.Next=l;m.Prev=l.Prev;m.Prev.Next=m;l.Prev=m;d&&(g.Pts=m)}return m};f.Clipper.prototype.SwapPoints=function(b,c){var d=new f.IntPoint(b.Value);b.Value.X=c.Value.X;b.Value.Y=c.Value.Y;c.Value.X=d.X;c.Value.Y=d.Y};f.Clipper.prototype.HorzSegmentsOverlap=function(b,c,d,g){return b.X>d.X==b.X<g.X?!0:c.X>d.X==c.X<g.X?!0:d.X>b.X==d.X<c.X?!0:g.X>b.X==g.X<c.X?!0:b.X==d.X&&c.X==g.X?!0:b.X==g.X&&c.X==d.X?!0:!1};f.Clipper.prototype.InsertPolyPtBetween=function(b,c,d){var g=new f.OutPt;g.Pt.X=d.X;g.Pt.Y=d.Y;
c==b.Next?(b.Next=g,c.Prev=g,g.Next=c,g.Prev=b):(c.Next=g,b.Prev=g,g.Next=b,g.Prev=c);return g};f.Clipper.prototype.SetHoleState=function(b,c){for(var d=!1,g=b.PrevInAEL;null!==g;)0<=g.OutIdx&&0!=g.WindDelta&&(d=!d,null===c.FirstLeft&&(c.FirstLeft=this.m_PolyOuts[g.OutIdx])),g=g.PrevInAEL;d&&(c.IsHole=!0)};f.Clipper.prototype.GetDx=function(b,c){return b.Y==c.Y?f.ClipperBase.horizontal:(c.X-b.X)/(c.Y-b.Y)};f.Clipper.prototype.FirstIsBottomPt=function(b,c){for(var d=b.Prev;f.IntPoint.op_Equality(d.Pt,
b.Pt)&&d!=b;)d=d.Prev;for(var g=Math.abs(this.GetDx(b.Pt,d.Pt)),d=b.Next;f.IntPoint.op_Equality(d.Pt,b.Pt)&&d!=b;)d=d.Next;for(var m=Math.abs(this.GetDx(b.Pt,d.Pt)),d=c.Prev;f.IntPoint.op_Equality(d.Pt,c.Pt)&&d!=c;)d=d.Prev;for(var l=Math.abs(this.GetDx(c.Pt,d.Pt)),d=c.Next;f.IntPoint.op_Equality(d.Pt,c.Pt)&&d!=c;)d=d.Next;d=Math.abs(this.GetDx(c.Pt,d.Pt));return g>=l&&g>=d||m>=l&&m>=d};f.Clipper.prototype.GetBottomPt=function(b){for(var c=null,d=b.Next;d!=b;)d.Pt.Y>b.Pt.Y?(b=d,c=null):d.Pt.Y==b.Pt.Y&&
d.Pt.X<=b.Pt.X&&(d.Pt.X<b.Pt.X?(c=null,b=d):d.Next!=b&&d.Prev!=b&&(c=d)),d=d.Next;if(null!==c)for(;c!=d;)for(this.FirstIsBottomPt(d,c)||(b=c),c=c.Next;f.IntPoint.op_Inequality(c.Pt,b.Pt);)c=c.Next;return b};f.Clipper.prototype.GetLowermostRec=function(b,c){null===b.BottomPt&&(b.BottomPt=this.GetBottomPt(b.Pts));null===c.BottomPt&&(c.BottomPt=this.GetBottomPt(c.Pts));var d=b.BottomPt,g=c.BottomPt;return d.Pt.Y>g.Pt.Y?b:d.Pt.Y<g.Pt.Y?c:d.Pt.X<g.Pt.X?b:d.Pt.X>g.Pt.X?c:d.Next==d?c:g.Next==g?b:this.FirstIsBottomPt(d,
g)?b:c};f.Clipper.prototype.Param1RightOfParam2=function(b,c){do if(b=b.FirstLeft,b==c)return!0;while(null!==b);return!1};f.Clipper.prototype.GetOutRec=function(b){for(b=this.m_PolyOuts[b];b!=this.m_PolyOuts[b.Idx];)b=this.m_PolyOuts[b.Idx];return b};f.Clipper.prototype.AppendPolygon=function(b,c){var d=this.m_PolyOuts[b.OutIdx],g=this.m_PolyOuts[c.OutIdx],m;m=this.Param1RightOfParam2(d,g)?g:this.Param1RightOfParam2(g,d)?d:this.GetLowermostRec(d,g);var l=d.Pts,p=l.Prev,n=g.Pts,t=n.Prev;b.Side==f.EdgeSide.esLeft?
(c.Side==f.EdgeSide.esLeft?(this.ReversePolyPtLinks(n),n.Next=l,l.Prev=n,p.Next=t,t.Prev=p,d.Pts=t):(t.Next=l,l.Prev=t,n.Prev=p,p.Next=n,d.Pts=n),l=f.EdgeSide.esLeft):(c.Side==f.EdgeSide.esRight?(this.ReversePolyPtLinks(n),p.Next=t,t.Prev=p,n.Next=l,l.Prev=n):(p.Next=n,n.Prev=p,l.Prev=t,t.Next=l),l=f.EdgeSide.esRight);d.BottomPt=null;m==g&&(g.FirstLeft!=d&&(d.FirstLeft=g.FirstLeft),d.IsHole=g.IsHole);g.Pts=null;g.BottomPt=null;g.FirstLeft=d;m=b.OutIdx;p=c.OutIdx;b.OutIdx=-1;c.OutIdx=-1;for(n=this.m_ActiveEdges;null!==
n;){if(n.OutIdx==p){n.OutIdx=m;n.Side=l;break}n=n.NextInAEL}g.Idx=d.Idx};f.Clipper.prototype.ReversePolyPtLinks=function(b){if(null!==b){var c,d;c=b;do d=c.Next,c.Next=c.Prev,c=c.Prev=d;while(c!=b)}};f.Clipper.SwapSides=function(b,c){var d=b.Side;b.Side=c.Side;c.Side=d};f.Clipper.SwapPolyIndexes=function(b,c){var d=b.OutIdx;b.OutIdx=c.OutIdx;c.OutIdx=d};f.Clipper.prototype.IntersectEdges=function(b,c,d,g){var m=!g&&null===b.NextInLML&&b.Top.X==d.X&&b.Top.Y==d.Y;g=!g&&null===c.NextInLML&&c.Top.X==
d.X&&c.Top.Y==d.Y;var l=0<=b.OutIdx,p=0<=c.OutIdx;if(0===b.WindDelta||0===c.WindDelta)0===b.WindDelta&&0===c.WindDelta?(m||g)&&l&&p&&this.AddLocalMaxPoly(b,c,d):b.PolyTyp==c.PolyTyp&&b.WindDelta!=c.WindDelta&&this.m_ClipType==f.ClipType.ctUnion?0===b.WindDelta?p&&(this.AddOutPt(b,d),l&&(b.OutIdx=-1)):l&&(this.AddOutPt(c,d),p&&(c.OutIdx=-1)):b.PolyTyp!=c.PolyTyp&&(0!==b.WindDelta||1!=Math.abs(c.WindCnt)||this.m_ClipType==f.ClipType.ctUnion&&0!==c.WindCnt2?0!==c.WindDelta||1!=Math.abs(b.WindCnt)||this.m_ClipType==
f.ClipType.ctUnion&&0!==b.WindCnt2||(this.AddOutPt(c,d),p&&(c.OutIdx=-1)):(this.AddOutPt(b,d),l&&(b.OutIdx=-1))),m&&(0>b.OutIdx?this.DeleteFromAEL(b):f.Error("Error intersecting polylines")),g&&(0>c.OutIdx?this.DeleteFromAEL(c):f.Error("Error intersecting polylines"));else{if(b.PolyTyp==c.PolyTyp)if(this.IsEvenOddFillType(b)){var n=b.WindCnt;b.WindCnt=c.WindCnt;c.WindCnt=n}else b.WindCnt=0===b.WindCnt+c.WindDelta?-b.WindCnt:b.WindCnt+c.WindDelta,c.WindCnt=0===c.WindCnt-b.WindDelta?-c.WindCnt:c.WindCnt-
b.WindDelta;else this.IsEvenOddFillType(c)?b.WindCnt2=0===b.WindCnt2?1:0:b.WindCnt2+=c.WindDelta,this.IsEvenOddFillType(b)?c.WindCnt2=0===c.WindCnt2?1:0:c.WindCnt2-=b.WindDelta;var t,G,M;b.PolyTyp==f.PolyType.ptSubject?(t=this.m_SubjFillType,M=this.m_ClipFillType):(t=this.m_ClipFillType,M=this.m_SubjFillType);c.PolyTyp==f.PolyType.ptSubject?(G=this.m_SubjFillType,n=this.m_ClipFillType):(G=this.m_ClipFillType,n=this.m_SubjFillType);switch(t){case f.PolyFillType.pftPositive:t=b.WindCnt;break;case f.PolyFillType.pftNegative:t=
-b.WindCnt;break;default:t=Math.abs(b.WindCnt)}switch(G){case f.PolyFillType.pftPositive:G=c.WindCnt;break;case f.PolyFillType.pftNegative:G=-c.WindCnt;break;default:G=Math.abs(c.WindCnt)}if(l&&p)m||g||0!==t&&1!=t||0!==G&&1!=G||b.PolyTyp!=c.PolyTyp&&this.m_ClipType!=f.ClipType.ctXor?this.AddLocalMaxPoly(b,c,d):(this.AddOutPt(b,d),this.AddOutPt(c,d),f.Clipper.SwapSides(b,c),f.Clipper.SwapPolyIndexes(b,c));else if(l){if(0===G||1==G)this.AddOutPt(b,d),f.Clipper.SwapSides(b,c),f.Clipper.SwapPolyIndexes(b,
c)}else if(p){if(0===t||1==t)this.AddOutPt(c,d),f.Clipper.SwapSides(b,c),f.Clipper.SwapPolyIndexes(b,c)}else if(!(0!==t&&1!=t||0!==G&&1!=G||m||g)){switch(M){case f.PolyFillType.pftPositive:l=b.WindCnt2;break;case f.PolyFillType.pftNegative:l=-b.WindCnt2;break;default:l=Math.abs(b.WindCnt2)}switch(n){case f.PolyFillType.pftPositive:p=c.WindCnt2;break;case f.PolyFillType.pftNegative:p=-c.WindCnt2;break;default:p=Math.abs(c.WindCnt2)}if(b.PolyTyp!=c.PolyTyp)this.AddLocalMinPoly(b,c,d);else if(1==t&&
1==G)switch(this.m_ClipType){case f.ClipType.ctIntersection:0<l&&0<p&&this.AddLocalMinPoly(b,c,d);break;case f.ClipType.ctUnion:0>=l&&0>=p&&this.AddLocalMinPoly(b,c,d);break;case f.ClipType.ctDifference:(b.PolyTyp==f.PolyType.ptClip&&0<l&&0<p||b.PolyTyp==f.PolyType.ptSubject&&0>=l&&0>=p)&&this.AddLocalMinPoly(b,c,d);break;case f.ClipType.ctXor:this.AddLocalMinPoly(b,c,d)}else f.Clipper.SwapSides(b,c)}m!=g&&(m&&0<=b.OutIdx||g&&0<=c.OutIdx)&&(f.Clipper.SwapSides(b,c),f.Clipper.SwapPolyIndexes(b,c));
m&&this.DeleteFromAEL(b);g&&this.DeleteFromAEL(c)}};f.Clipper.prototype.DeleteFromAEL=function(b){var c=b.PrevInAEL,d=b.NextInAEL;if(null!==c||null!==d||b==this.m_ActiveEdges)null!==c?c.NextInAEL=d:this.m_ActiveEdges=d,null!==d&&(d.PrevInAEL=c),b.NextInAEL=null,b.PrevInAEL=null};f.Clipper.prototype.DeleteFromSEL=function(b){var c=b.PrevInSEL,d=b.NextInSEL;if(null!==c||null!==d||b==this.m_SortedEdges)null!==c?c.NextInSEL=d:this.m_SortedEdges=d,null!==d&&(d.PrevInSEL=c),b.NextInSEL=null,b.PrevInSEL=
null};f.Clipper.prototype.UpdateEdgeIntoAEL=function(b){null===b.Value.NextInLML&&f.Error("UpdateEdgeIntoAEL: invalid call");var c=b.Value.PrevInAEL,d=b.Value.NextInAEL;b.Value.NextInLML.OutIdx=b.Value.OutIdx;null!==c?c.NextInAEL=b.Value.NextInLML:this.m_ActiveEdges=b.Value.NextInLML;null!==d&&(d.PrevInAEL=b.Value.NextInLML);b.Value.NextInLML.Side=b.Value.Side;b.Value.NextInLML.WindDelta=b.Value.WindDelta;b.Value.NextInLML.WindCnt=b.Value.WindCnt;b.Value.NextInLML.WindCnt2=b.Value.WindCnt2;b.Value=
b.Value.NextInLML;b.Value.Curr.X=b.Value.Bot.X;b.Value.Curr.Y=b.Value.Bot.Y;b.Value.PrevInAEL=c;b.Value.NextInAEL=d;f.ClipperBase.IsHorizontal(b.Value)||this.InsertScanbeam(b.Value.Top.Y)};f.Clipper.prototype.ProcessHorizontals=function(b){for(var c=this.m_SortedEdges;null!==c;)this.DeleteFromSEL(c),this.ProcessHorizontal(c,b),c=this.m_SortedEdges};f.Clipper.prototype.GetHorzDirection=function(b,c,d,g){b.Bot.X<b.Top.X?(d.Value=b.Bot.X,g.Value=b.Top.X,c.Value=f.Direction.dLeftToRight):(d.Value=b.Top.X,
g.Value=b.Bot.X,c.Value=f.Direction.dRightToLeft)};f.Clipper.prototype.PrepareHorzJoins=function(b,c){var d=this.m_PolyOuts[b.OutIdx].Pts;b.Side!=f.EdgeSide.esLeft&&(d=d.Prev);for(var g=0,m=this.m_GhostJoins.length;g<m;++g){var l=this.m_GhostJoins[g];this.HorzSegmentsOverlap(l.OutPt1.Pt,l.OffPt,b.Bot,b.Top)&&this.AddJoin(l.OutPt1,d,l.OffPt)}c&&(f.IntPoint.op_Equality(d.Pt,b.Top)?this.AddGhostJoin(d,b.Bot):this.AddGhostJoin(d,b.Top))};f.Clipper.prototype.ProcessHorizontal=function(b,c){var d,g,m;(function(){d=
{Value:d};g={Value:g};m={Value:m};var c=this.GetHorzDirection(b,d,g,m);d=d.Value;g=g.Value;m=m.Value;return c}).call(this);for(var l=b,p=null;null!==l.NextInLML&&f.ClipperBase.IsHorizontal(l.NextInLML);)l=l.NextInLML;for(null===l.NextInLML&&(p=this.GetMaximaPair(l));;){for(var n=b==l,t=this.GetNextInAEL(b,d);null!==t&&!(t.Curr.X==b.Top.X&&null!==b.NextInLML&&t.Dx<b.NextInLML.Dx);){var G=this.GetNextInAEL(t,d);if(d==f.Direction.dLeftToRight&&t.Curr.X<=m||d==f.Direction.dRightToLeft&&t.Curr.X>=g){0<=
b.OutIdx&&0!=b.WindDelta&&this.PrepareHorzJoins(b,c);if(t==p&&n){d==f.Direction.dLeftToRight?this.IntersectEdges(b,t,t.Top,!1):this.IntersectEdges(t,b,t.Top,!1);0<=p.OutIdx&&f.Error("ProcessHorizontal error");return}if(d==f.Direction.dLeftToRight){var M=new f.IntPoint(t.Curr.X,b.Curr.Y);this.IntersectEdges(b,t,M,!0)}else M=new f.IntPoint(t.Curr.X,b.Curr.Y),this.IntersectEdges(t,b,M,!0);this.SwapPositionsInAEL(b,t)}else if(d==f.Direction.dLeftToRight&&t.Curr.X>=m||d==f.Direction.dRightToLeft&&t.Curr.X<=
g)break;t=G}0<=b.OutIdx&&0!==b.WindDelta&&this.PrepareHorzJoins(b,c);if(null!==b.NextInLML&&f.ClipperBase.IsHorizontal(b.NextInLML))(function(){b={Value:b};var c=this.UpdateEdgeIntoAEL(b);b=b.Value;return c}).call(this),0<=b.OutIdx&&this.AddOutPt(b,b.Bot),function(){d={Value:d};g={Value:g};m={Value:m};var c=this.GetHorzDirection(b,d,g,m);d=d.Value;g=g.Value;m=m.Value;return c}.call(this);else break}null!==b.NextInLML?0<=b.OutIdx?(l=this.AddOutPt(b,b.Top),function(){b={Value:b};var c=this.UpdateEdgeIntoAEL(b);
b=b.Value;return c}.call(this),0!==b.WindDelta&&(p=b.PrevInAEL,G=b.NextInAEL,null!==p&&p.Curr.X==b.Bot.X&&p.Curr.Y==b.Bot.Y&&0!==p.WindDelta&&0<=p.OutIdx&&p.Curr.Y>p.Top.Y&&f.ClipperBase.SlopesEqual(b,p,this.m_UseFullRange)?(G=this.AddOutPt(p,b.Bot),this.AddJoin(l,G,b.Top)):null!==G&&G.Curr.X==b.Bot.X&&G.Curr.Y==b.Bot.Y&&0!==G.WindDelta&&0<=G.OutIdx&&G.Curr.Y>G.Top.Y&&f.ClipperBase.SlopesEqual(b,G,this.m_UseFullRange)&&(G=this.AddOutPt(G,b.Bot),this.AddJoin(l,G,b.Top)))):function(){b={Value:b};var c=
this.UpdateEdgeIntoAEL(b);b=b.Value;return c}.call(this):null!==p?0<=p.OutIdx?(d==f.Direction.dLeftToRight?this.IntersectEdges(b,p,b.Top,!1):this.IntersectEdges(p,b,b.Top,!1),0<=p.OutIdx&&f.Error("ProcessHorizontal error")):(this.DeleteFromAEL(b),this.DeleteFromAEL(p)):(0<=b.OutIdx&&this.AddOutPt(b,b.Top),this.DeleteFromAEL(b))};f.Clipper.prototype.GetNextInAEL=function(b,c){return c==f.Direction.dLeftToRight?b.NextInAEL:b.PrevInAEL};f.Clipper.prototype.IsMinima=function(b){return null!==b&&b.Prev.NextInLML!=
b&&b.Next.NextInLML!=b};f.Clipper.prototype.IsMaxima=function(b,c){return null!==b&&b.Top.Y==c&&null===b.NextInLML};f.Clipper.prototype.IsIntermediate=function(b,c){return b.Top.Y==c&&null!==b.NextInLML};f.Clipper.prototype.GetMaximaPair=function(b){var c=null;f.IntPoint.op_Equality(b.Next.Top,b.Top)&&null===b.Next.NextInLML?c=b.Next:f.IntPoint.op_Equality(b.Prev.Top,b.Top)&&null===b.Prev.NextInLML&&(c=b.Prev);return null===c||-2!=c.OutIdx&&(c.NextInAEL!=c.PrevInAEL||f.ClipperBase.IsHorizontal(c))?
c:null};f.Clipper.prototype.ProcessIntersections=function(b,c){if(null==this.m_ActiveEdges)return!0;try{this.BuildIntersectList(b,c);if(0==this.m_IntersectList.length)return!0;if(1==this.m_IntersectList.length||this.FixupIntersectionOrder())this.ProcessIntersectList();else return!1}catch(d){this.m_SortedEdges=null,this.m_IntersectList.length=0,f.Error("ProcessIntersections error")}this.m_SortedEdges=null;return!0};f.Clipper.prototype.BuildIntersectList=function(b,c){if(null!==this.m_ActiveEdges){var d=
this.m_ActiveEdges;for(this.m_SortedEdges=d;null!==d;)d.PrevInSEL=d.PrevInAEL,d.NextInSEL=d.NextInAEL,d.Curr.X=f.Clipper.TopX(d,c),d=d.NextInAEL;for(var g=!0;g&&null!==this.m_SortedEdges;){g=!1;for(d=this.m_SortedEdges;null!==d.NextInSEL;){var m=d.NextInSEL,l=new f.IntPoint;d.Curr.X>m.Curr.X?(l={Value:l},g=this.IntersectPoint(d,m,l),l=l.Value,!g&&d.Curr.X>m.Curr.X+1&&f.Error("Intersection error"),l.Y>b&&(l.Y=b,Math.abs(d.Dx)>Math.abs(m.Dx)?l.X=f.Clipper.TopX(m,b):l.X=f.Clipper.TopX(d,b)),g=new f.IntersectNode,
g.Edge1=d,g.Edge2=m,g.Pt.X=l.X,g.Pt.Y=l.Y,this.m_IntersectList.push(g),this.SwapPositionsInSEL(d,m),g=!0):d=m}if(null!==d.PrevInSEL)d.PrevInSEL.NextInSEL=null;else break}this.m_SortedEdges=null}};f.Clipper.prototype.EdgesAdjacent=function(b){return b.Edge1.NextInSEL==b.Edge2||b.Edge1.PrevInSEL==b.Edge2};f.Clipper.IntersectNodeSort=function(b,c){return c.Pt.Y-b.Pt.Y};f.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer);this.CopyAELToSEL();for(var b=
this.m_IntersectList.length,c=0;c<b;c++){if(!this.EdgesAdjacent(this.m_IntersectList[c])){for(var d=c+1;d<b&&!this.EdgesAdjacent(this.m_IntersectList[d]);)d++;if(d==b)return!1;var g=this.m_IntersectList[c];this.m_IntersectList[c]=this.m_IntersectList[d];this.m_IntersectList[d]=g}this.SwapPositionsInSEL(this.m_IntersectList[c].Edge1,this.m_IntersectList[c].Edge2)}return!0};f.Clipper.prototype.ProcessIntersectList=function(){for(var b=0,c=this.m_IntersectList.length;b<c;b++){var d=this.m_IntersectList[b];
this.IntersectEdges(d.Edge1,d.Edge2,d.Pt,!0);this.SwapPositionsInAEL(d.Edge1,d.Edge2)}this.m_IntersectList.length=0};Ia=function(b){return 0>b?Math.ceil(b-.5):Math.round(b)};Ja=function(b){return 0>b?Math.ceil(b-.5):Math.floor(b+.5)};Ka=function(b){return 0>b?-Math.round(Math.abs(b)):Math.round(b)};Pa=function(b){if(0>b)return b-=.5,-2147483648>b?Math.ceil(b):b|0;b+=.5;return 2147483647<b?Math.floor(b):b|0};f.Clipper.Round=N?Ia:db?Ka:Va?Pa:Ja;f.Clipper.TopX=function(b,c){return c==b.Top.Y?b.Top.X:
b.Bot.X+f.Clipper.Round(b.Dx*(c-b.Bot.Y))};f.Clipper.prototype.IntersectPoint=function(b,c,d){d.Value=new f.IntPoint;var g,m;if(f.ClipperBase.SlopesEqual(b,c,this.m_UseFullRange)||b.Dx==c.Dx)return c.Bot.Y>b.Bot.Y?(d.Value.X=c.Bot.X,d.Value.Y=c.Bot.Y):(d.Value.X=b.Bot.X,d.Value.Y=b.Bot.Y),!1;if(0===b.Delta.X)d.Value.X=b.Bot.X,f.ClipperBase.IsHorizontal(c)?d.Value.Y=c.Bot.Y:(m=c.Bot.Y-c.Bot.X/c.Dx,d.Value.Y=f.Clipper.Round(d.Value.X/c.Dx+m));else if(0===c.Delta.X)d.Value.X=c.Bot.X,f.ClipperBase.IsHorizontal(b)?
d.Value.Y=b.Bot.Y:(g=b.Bot.Y-b.Bot.X/b.Dx,d.Value.Y=f.Clipper.Round(d.Value.X/b.Dx+g));else{g=b.Bot.X-b.Bot.Y*b.Dx;m=c.Bot.X-c.Bot.Y*c.Dx;var l=(m-g)/(b.Dx-c.Dx);d.Value.Y=f.Clipper.Round(l);Math.abs(b.Dx)<Math.abs(c.Dx)?d.Value.X=f.Clipper.Round(b.Dx*l+g):d.Value.X=f.Clipper.Round(c.Dx*l+m)}if(d.Value.Y<b.Top.Y||d.Value.Y<c.Top.Y){if(b.Top.Y>c.Top.Y)return d.Value.Y=b.Top.Y,d.Value.X=f.Clipper.TopX(c,b.Top.Y),d.Value.X<b.Top.X;d.Value.Y=c.Top.Y;Math.abs(b.Dx)<Math.abs(c.Dx)?d.Value.X=f.Clipper.TopX(b,
d.Value.Y):d.Value.X=f.Clipper.TopX(c,d.Value.Y)}return!0};f.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(b){for(var c=this.m_ActiveEdges;null!==c;){var d=this.IsMaxima(c,b);d&&(d=this.GetMaximaPair(c),d=null===d||!f.ClipperBase.IsHorizontal(d));if(d){var g=c.PrevInAEL;this.DoMaxima(c);c=null===g?this.m_ActiveEdges:g.NextInAEL}else this.IsIntermediate(c,b)&&f.ClipperBase.IsHorizontal(c.NextInLML)?(function(){c={Value:c};var b=this.UpdateEdgeIntoAEL(c);c=c.Value;return b}.call(this),0<=c.OutIdx&&
this.AddOutPt(c,c.Bot),this.AddEdgeToSEL(c)):(c.Curr.X=f.Clipper.TopX(c,b),c.Curr.Y=b),this.StrictlySimple&&(g=c.PrevInAEL,0<=c.OutIdx&&0!==c.WindDelta&&null!==g&&0<=g.OutIdx&&g.Curr.X==c.Curr.X&&0!==g.WindDelta&&(d=this.AddOutPt(g,c.Curr),g=this.AddOutPt(c,c.Curr),this.AddJoin(d,g,c.Curr))),c=c.NextInAEL}this.ProcessHorizontals(!0);for(c=this.m_ActiveEdges;null!==c;){if(this.IsIntermediate(c,b)){d=null;0<=c.OutIdx&&(d=this.AddOutPt(c,c.Top));(function(){c={Value:c};var b=this.UpdateEdgeIntoAEL(c);
c=c.Value;return b}).call(this);var g=c.PrevInAEL,m=c.NextInAEL;null!==g&&g.Curr.X==c.Bot.X&&g.Curr.Y==c.Bot.Y&&null!==d&&0<=g.OutIdx&&g.Curr.Y>g.Top.Y&&f.ClipperBase.SlopesEqual(c,g,this.m_UseFullRange)&&0!==c.WindDelta&&0!==g.WindDelta?(g=this.AddOutPt(g,c.Bot),this.AddJoin(d,g,c.Top)):null!==m&&m.Curr.X==c.Bot.X&&m.Curr.Y==c.Bot.Y&&null!==d&&0<=m.OutIdx&&m.Curr.Y>m.Top.Y&&f.ClipperBase.SlopesEqual(c,m,this.m_UseFullRange)&&0!==c.WindDelta&&0!==m.WindDelta&&(g=this.AddOutPt(m,c.Bot),this.AddJoin(d,
g,c.Top))}c=c.NextInAEL}};f.Clipper.prototype.DoMaxima=function(b){var c=this.GetMaximaPair(b);if(null===c)0<=b.OutIdx&&this.AddOutPt(b,b.Top),this.DeleteFromAEL(b);else{for(var d=b.NextInAEL;null!==d&&d!=c;)this.IntersectEdges(b,d,b.Top,!0),this.SwapPositionsInAEL(b,d),d=b.NextInAEL;-1==b.OutIdx&&-1==c.OutIdx?(this.DeleteFromAEL(b),this.DeleteFromAEL(c)):0<=b.OutIdx&&0<=c.OutIdx?this.IntersectEdges(b,c,b.Top,!1):0===b.WindDelta?(0<=b.OutIdx&&(this.AddOutPt(b,b.Top),b.OutIdx=-1),this.DeleteFromAEL(b),
0<=c.OutIdx&&(this.AddOutPt(c,b.Top),c.OutIdx=-1),this.DeleteFromAEL(c)):f.Error("DoMaxima error")}};f.Clipper.ReversePaths=function(b){for(var c=0,d=b.length;c<d;c++)b[c].reverse()};f.Clipper.Orientation=function(b){return 0<=f.Clipper.Area(b)};f.Clipper.prototype.PointCount=function(b){if(null===b)return 0;var c=0,d=b;do c++,d=d.Next;while(d!=b);return c};f.Clipper.prototype.BuildResult=function(b){f.Clear(b);for(var c=0,d=this.m_PolyOuts.length;c<d;c++){var g=this.m_PolyOuts[c];if(null!==g.Pts){var g=
g.Pts.Prev,m=this.PointCount(g);if(!(2>m)){for(var l=Array(m),p=0;p<m;p++)l[p]=g.Pt,g=g.Prev;b.push(l)}}}};f.Clipper.prototype.BuildResult2=function(b){b.Clear();for(var c=0,d=this.m_PolyOuts.length;c<d;c++){var g=this.m_PolyOuts[c],m=this.PointCount(g.Pts);if(!(g.IsOpen&&2>m||!g.IsOpen&&3>m)){this.FixHoleLinkage(g);var l=new f.PolyNode;b.m_AllPolys.push(l);g.PolyNode=l;l.m_polygon.length=m;for(var g=g.Pts.Prev,p=0;p<m;p++)l.m_polygon[p]=g.Pt,g=g.Prev}}c=0;for(d=this.m_PolyOuts.length;c<d;c++)g=this.m_PolyOuts[c],
null!==g.PolyNode&&(g.IsOpen?(g.PolyNode.IsOpen=!0,b.AddChild(g.PolyNode)):null!==g.FirstLeft&&null!=g.FirstLeft.PolyNode?g.FirstLeft.PolyNode.AddChild(g.PolyNode):b.AddChild(g.PolyNode))};f.Clipper.prototype.FixupOutPolygon=function(b){var c=null;b.BottomPt=null;for(var d=b.Pts;;){if(d.Prev==d||d.Prev==d.Next){this.DisposeOutPts(d);b.Pts=null;return}if(f.IntPoint.op_Equality(d.Pt,d.Next.Pt)||f.IntPoint.op_Equality(d.Pt,d.Prev.Pt)||f.ClipperBase.SlopesEqual(d.Prev.Pt,d.Pt,d.Next.Pt,this.m_UseFullRange)&&
(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(d.Prev.Pt,d.Pt,d.Next.Pt)))c=null,d.Prev.Next=d.Next,d=d.Next.Prev=d.Prev;else if(d==c)break;else null===c&&(c=d),d=d.Next}b.Pts=d};f.Clipper.prototype.DupOutPt=function(b,c){var d=new f.OutPt;d.Pt.X=b.Pt.X;d.Pt.Y=b.Pt.Y;d.Idx=b.Idx;c?(d.Next=b.Next,d.Prev=b,b.Next.Prev=d,b.Next=d):(d.Prev=b.Prev,d.Next=b,b.Prev.Next=d,b.Prev=d);return d};f.Clipper.prototype.GetOverlap=function(b,c,d,g,f,l){b<c?d<g?(f.Value=Math.max(b,d),l.Value=Math.min(c,g)):
(f.Value=Math.max(b,g),l.Value=Math.min(c,d)):d<g?(f.Value=Math.max(c,d),l.Value=Math.min(b,g)):(f.Value=Math.max(c,g),l.Value=Math.min(b,d));return f.Value<l.Value};f.Clipper.prototype.JoinHorz=function(b,c,d,g,m,l){var p=b.Pt.X>c.Pt.X?f.Direction.dRightToLeft:f.Direction.dLeftToRight;g=d.Pt.X>g.Pt.X?f.Direction.dRightToLeft:f.Direction.dLeftToRight;if(p==g)return!1;if(p==f.Direction.dLeftToRight){for(;b.Next.Pt.X<=m.X&&b.Next.Pt.X>=b.Pt.X&&b.Next.Pt.Y==m.Y;)b=b.Next;l&&b.Pt.X!=m.X&&(b=b.Next);c=
this.DupOutPt(b,!l);f.IntPoint.op_Inequality(c.Pt,m)&&(b=c,b.Pt.X=m.X,b.Pt.Y=m.Y,c=this.DupOutPt(b,!l))}else{for(;b.Next.Pt.X>=m.X&&b.Next.Pt.X<=b.Pt.X&&b.Next.Pt.Y==m.Y;)b=b.Next;l||b.Pt.X==m.X||(b=b.Next);c=this.DupOutPt(b,l);f.IntPoint.op_Inequality(c.Pt,m)&&(b=c,b.Pt.X=m.X,b.Pt.Y=m.Y,c=this.DupOutPt(b,l))}if(g==f.Direction.dLeftToRight){for(;d.Next.Pt.X<=m.X&&d.Next.Pt.X>=d.Pt.X&&d.Next.Pt.Y==m.Y;)d=d.Next;l&&d.Pt.X!=m.X&&(d=d.Next);g=this.DupOutPt(d,!l);f.IntPoint.op_Inequality(g.Pt,m)&&(d=g,
d.Pt.X=m.X,d.Pt.Y=m.Y,g=this.DupOutPt(d,!l))}else{for(;d.Next.Pt.X>=m.X&&d.Next.Pt.X<=d.Pt.X&&d.Next.Pt.Y==m.Y;)d=d.Next;l||d.Pt.X==m.X||(d=d.Next);g=this.DupOutPt(d,l);f.IntPoint.op_Inequality(g.Pt,m)&&(d=g,d.Pt.X=m.X,d.Pt.Y=m.Y,g=this.DupOutPt(d,l))}p==f.Direction.dLeftToRight==l?(b.Prev=d,d.Next=b,c.Next=g,g.Prev=c):(b.Next=d,d.Prev=b,c.Prev=g,g.Next=c);return!0};f.Clipper.prototype.JoinPoints=function(b,c,d){var g=b.OutPt1,m=new f.OutPt,l=b.OutPt2,p=new f.OutPt;if((p=b.OutPt1.Pt.Y==b.OffPt.Y)&&
f.IntPoint.op_Equality(b.OffPt,b.OutPt1.Pt)&&f.IntPoint.op_Equality(b.OffPt,b.OutPt2.Pt)){for(m=b.OutPt1.Next;m!=g&&f.IntPoint.op_Equality(m.Pt,b.OffPt);)m=m.Next;m=m.Pt.Y>b.OffPt.Y;for(p=b.OutPt2.Next;p!=l&&f.IntPoint.op_Equality(p.Pt,b.OffPt);)p=p.Next;if(m==p.Pt.Y>b.OffPt.Y)return!1;m?(m=this.DupOutPt(g,!1),p=this.DupOutPt(l,!0),g.Prev=l,l.Next=g,m.Next=p,p.Prev=m):(m=this.DupOutPt(g,!0),p=this.DupOutPt(l,!1),g.Next=l,l.Prev=g,m.Prev=p,p.Next=m);b.OutPt1=g;b.OutPt2=m;return!0}if(p){for(m=g;g.Prev.Pt.Y==
g.Pt.Y&&g.Prev!=m&&g.Prev!=l;)g=g.Prev;for(;m.Next.Pt.Y==m.Pt.Y&&m.Next!=g&&m.Next!=l;)m=m.Next;if(m.Next==g||m.Next==l)return!1;for(p=l;l.Prev.Pt.Y==l.Pt.Y&&l.Prev!=p&&l.Prev!=m;)l=l.Prev;for(;p.Next.Pt.Y==p.Pt.Y&&p.Next!=l&&p.Next!=g;)p=p.Next;if(p.Next==l||p.Next==g)return!1;var n,t;n={Value:n};t={Value:t};c=this.GetOverlap(g.Pt.X,m.Pt.X,l.Pt.X,p.Pt.X,n,t);n=n.Value;t=t.Value;if(!c)return!1;c=new f.IntPoint;g.Pt.X>=n&&g.Pt.X<=t?(c.X=g.Pt.X,c.Y=g.Pt.Y,d=g.Pt.X>m.Pt.X):l.Pt.X>=n&&l.Pt.X<=t?(c.X=
l.Pt.X,c.Y=l.Pt.Y,d=l.Pt.X>p.Pt.X):m.Pt.X>=n&&m.Pt.X<=t?(c.X=m.Pt.X,c.Y=m.Pt.Y,d=m.Pt.X>g.Pt.X):(c.X=p.Pt.X,c.Y=p.Pt.Y,d=p.Pt.X>l.Pt.X);b.OutPt1=g;b.OutPt2=l;return this.JoinHorz(g,m,l,p,c,d)}for(m=g.Next;f.IntPoint.op_Equality(m.Pt,g.Pt)&&m!=g;)m=m.Next;if(n=m.Pt.Y>g.Pt.Y||!f.ClipperBase.SlopesEqual(g.Pt,m.Pt,b.OffPt,this.m_UseFullRange)){for(m=g.Prev;f.IntPoint.op_Equality(m.Pt,g.Pt)&&m!=g;)m=m.Prev;if(m.Pt.Y>g.Pt.Y||!f.ClipperBase.SlopesEqual(g.Pt,m.Pt,b.OffPt,this.m_UseFullRange))return!1}for(p=
l.Next;f.IntPoint.op_Equality(p.Pt,l.Pt)&&p!=l;)p=p.Next;if(t=p.Pt.Y>l.Pt.Y||!f.ClipperBase.SlopesEqual(l.Pt,p.Pt,b.OffPt,this.m_UseFullRange)){for(p=l.Prev;f.IntPoint.op_Equality(p.Pt,l.Pt)&&p!=l;)p=p.Prev;if(p.Pt.Y>l.Pt.Y||!f.ClipperBase.SlopesEqual(l.Pt,p.Pt,b.OffPt,this.m_UseFullRange))return!1}if(m==g||p==l||m==p||c==d&&n==t)return!1;n?(m=this.DupOutPt(g,!1),p=this.DupOutPt(l,!0),g.Prev=l,l.Next=g,m.Next=p,p.Prev=m):(m=this.DupOutPt(g,!0),p=this.DupOutPt(l,!1),g.Next=l,l.Prev=g,m.Prev=p,p.Next=
m);b.OutPt1=g;b.OutPt2=m;return!0};f.Clipper.GetBounds=function(b){for(var c=0,d=b.length;c<d&&0==b[c].length;)c++;if(c==d)return new f.IntRect(0,0,0,0);var g=new f.IntRect;g.left=b[c][0].X;g.right=g.left;g.top=b[c][0].Y;for(g.bottom=g.top;c<d;c++)for(var m=0,l=b[c].length;m<l;m++)b[c][m].X<g.left?g.left=b[c][m].X:b[c][m].X>g.right&&(g.right=b[c][m].X),b[c][m].Y<g.top?g.top=b[c][m].Y:b[c][m].Y>g.bottom&&(g.bottom=b[c][m].Y);return g};f.Clipper.prototype.GetBounds2=function(b){var c=b,d=new f.IntRect;
d.left=b.Pt.X;d.right=b.Pt.X;d.top=b.Pt.Y;d.bottom=b.Pt.Y;for(b=b.Next;b!=c;)b.Pt.X<d.left&&(d.left=b.Pt.X),b.Pt.X>d.right&&(d.right=b.Pt.X),b.Pt.Y<d.top&&(d.top=b.Pt.Y),b.Pt.Y>d.bottom&&(d.bottom=b.Pt.Y),b=b.Next;return d};f.ClipperBase.prototype.PointInPolygon=f.Clipper.prototype.PointInPolygon=function(){var b=arguments,c=b.length;if(2==c){for(var c=b[0],d=b[1],b=0,g=d;;){var f=d.Pt.X,l=d.Pt.Y,p=d.Next.Pt.X,t=d.Next.Pt.Y;if(t==c.Y&&(p==c.X||l==c.Y&&p>c.X==f<c.X))return-1;if(l<c.Y!=t<c.Y)if(f>=
c.X)if(p>c.X)b=1-b;else{f=(f-c.X)*(t-c.Y)-(p-c.X)*(l-c.Y);if(0==f)return-1;0<f==t>l&&(b=1-b)}else if(p>c.X){f=(f-c.X)*(t-c.Y)-(p-c.X)*(l-c.Y);if(0==f)return-1;0<f==t>l&&(b=1-b)}d=d.Next;if(g==d)break}return b}if(3==c){c=b[0];d=b[1];g=b[2];l=d;b=!1;if(g){do l.Pt.Y>c.Y!=l.Prev.Pt.Y>c.Y&&n.op_LessThan(new n(c.X-l.Pt.X),n.op_Division(n.Int128Mul(l.Prev.Pt.X-l.Pt.X,c.Y-l.Pt.Y),new n(l.Prev.Pt.Y-l.Pt.Y)))&&(b=!b),l=l.Next;while(l!=d)}else{do l.Pt.Y>c.Y!=l.Prev.Pt.Y>c.Y&&c.X-l.Pt.X<(l.Prev.Pt.X-l.Pt.X)*
(c.Y-l.Pt.Y)/(l.Prev.Pt.Y-l.Pt.Y)&&(b=!b),l=l.Next;while(l!=d)}return b}};f.Clipper.prototype.Poly2ContainsPoly1=function(b,c){var d=b;do{var g=this.PointInPolygon(d.Pt,c);if(0<=g)return 0!=g;d=d.Next}while(d!=b);return!0};f.Clipper.prototype.FixupFirstLefts1=function(b,c){for(var d=0,g=this.m_PolyOuts.length;d<g;d++){var f=this.m_PolyOuts[d];null!==f.Pts&&f.FirstLeft==b&&this.Poly2ContainsPoly1(f.Pts,c.Pts)&&(f.FirstLeft=c)}};f.Clipper.prototype.FixupFirstLefts2=function(b,c){for(var d=0,g=this.m_PolyOuts,
f=g.length,l=g[d];d<f;d++,l=g[d])l.FirstLeft==b&&(l.FirstLeft=c)};f.Clipper.ParseFirstLeft=function(b){for(;null!=b&&null==b.Pts;)b=b.FirstLeft;return b};f.Clipper.prototype.JoinCommonEdges=function(){for(var b=0,c=this.m_Joins.length;b<c;b++){var d=this.m_Joins[b],g=this.GetOutRec(d.OutPt1.Idx),m=this.GetOutRec(d.OutPt2.Idx);if(null!=g.Pts&&null!=m.Pts){var l;l=g==m?g:this.Param1RightOfParam2(g,m)?m:this.Param1RightOfParam2(m,g)?g:this.GetLowermostRec(g,m);if(this.JoinPoints(d,g,m))if(g==m){g.Pts=
d.OutPt1;g.BottomPt=null;m=this.CreateOutRec();m.Pts=d.OutPt2;this.UpdateOutPtIdxs(m);if(this.m_UsingPolyTree){l=0;for(var p=this.m_PolyOuts.length;l<p-1;l++){var n=this.m_PolyOuts[l];null!=n.Pts&&f.Clipper.ParseFirstLeft(n.FirstLeft)==g&&n.IsHole!=g.IsHole&&this.Poly2ContainsPoly1(n.Pts,d.OutPt2)&&(n.FirstLeft=m)}}this.Poly2ContainsPoly1(m.Pts,g.Pts)?(m.IsHole=!g.IsHole,m.FirstLeft=g,this.m_UsingPolyTree&&this.FixupFirstLefts2(m,g),(m.IsHole^this.ReverseSolution)==0<this.Area(m)&&this.ReversePolyPtLinks(m.Pts)):
this.Poly2ContainsPoly1(g.Pts,m.Pts)?(m.IsHole=g.IsHole,g.IsHole=!m.IsHole,m.FirstLeft=g.FirstLeft,g.FirstLeft=m,this.m_UsingPolyTree&&this.FixupFirstLefts2(g,m),(g.IsHole^this.ReverseSolution)==0<this.Area(g)&&this.ReversePolyPtLinks(g.Pts)):(m.IsHole=g.IsHole,m.FirstLeft=g.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(g,m))}else m.Pts=null,m.BottomPt=null,m.Idx=g.Idx,g.IsHole=l.IsHole,l==m&&(g.FirstLeft=m.FirstLeft),m.FirstLeft=g,this.m_UsingPolyTree&&this.FixupFirstLefts2(m,g)}}};f.Clipper.prototype.UpdateOutPtIdxs=
function(b){var c=b.Pts;do c.Idx=b.Idx,c=c.Prev;while(c!=b.Pts)};f.Clipper.prototype.DoSimplePolygons=function(){for(var b=0;b<this.m_PolyOuts.length;){var c=this.m_PolyOuts[b++],d=c.Pts;if(null!==d){do{for(var g=d.Next;g!=c.Pts;){if(f.IntPoint.op_Equality(d.Pt,g.Pt)&&g.Next!=d&&g.Prev!=d){var m=d.Prev,l=g.Prev;d.Prev=l;l.Next=d;g.Prev=m;m.Next=g;c.Pts=d;m=this.CreateOutRec();m.Pts=g;this.UpdateOutPtIdxs(m);this.Poly2ContainsPoly1(m.Pts,c.Pts)?(m.IsHole=!c.IsHole,m.FirstLeft=c):this.Poly2ContainsPoly1(c.Pts,
m.Pts)?(m.IsHole=c.IsHole,c.IsHole=!m.IsHole,m.FirstLeft=c.FirstLeft,c.FirstLeft=m):(m.IsHole=c.IsHole,m.FirstLeft=c.FirstLeft);g=d}g=g.Next}d=d.Next}while(d!=c.Pts)}}};f.Clipper.Area=function(b){var c=b.length;if(3>c)return 0;for(var d=0,g=0,f=c-1;g<c;++g)d+=(b[f].X+b[g].X)*(b[f].Y-b[g].Y),f=g;return.5*-d};f.Clipper.prototype.Area=function(b){var c=b.Pts;if(null==c)return 0;var d=0;do d+=(c.Prev.Pt.X+c.Pt.X)*(c.Prev.Pt.Y-c.Pt.Y),c=c.Next;while(c!=b.Pts);return.5*d};f.Clipper.SimplifyPolygon=function(b,
c){var d=[],g=new f.Clipper(0);g.StrictlySimple=!0;g.AddPath(b,f.PolyType.ptSubject,!0);g.Execute(f.ClipType.ctUnion,d,c,c);return d};f.Clipper.SimplifyPolygons=function(b,c){"undefined"==typeof c&&(c=f.PolyFillType.pftEvenOdd);var d=[],g=new f.Clipper(0);g.StrictlySimple=!0;g.AddPaths(b,f.PolyType.ptSubject,!0);g.Execute(f.ClipType.ctUnion,d,c,c);return d};f.Clipper.DistanceSqrd=function(b,c){var d=b.X-c.X,g=b.Y-c.Y;return d*d+g*g};f.Clipper.DistanceFromLineSqrd=function(b,c,d){var g=c.Y-d.Y;d=d.X-
c.X;c=g*c.X+d*c.Y;c=g*b.X+d*b.Y-c;return c*c/(g*g+d*d)};f.Clipper.SlopesNearCollinear=function(b,c,d,g){return f.Clipper.DistanceFromLineSqrd(c,b,d)<g};f.Clipper.PointsAreClose=function(b,c,d){var g=b.X-c.X;b=b.Y-c.Y;return g*g+b*b<=d};f.Clipper.ExcludeOp=function(b){var c=b.Prev;c.Next=b.Next;b.Next.Prev=c;c.Idx=0;return c};f.Clipper.CleanPolygon=function(b,c){"undefined"==typeof c&&(c=1.415);var d=b.length;if(0==d)return[];for(var g=Array(d),m=0;m<d;++m)g[m]=new f.OutPt;for(m=0;m<d;++m)g[m].Pt=
b[m],g[m].Next=g[(m+1)%d],g[m].Next.Prev=g[m],g[m].Idx=0;m=c*c;for(g=g[0];0==g.Idx&&g.Next!=g.Prev;)f.Clipper.PointsAreClose(g.Pt,g.Prev.Pt,m)?(g=f.Clipper.ExcludeOp(g),d--):f.Clipper.PointsAreClose(g.Prev.Pt,g.Next.Pt,m)?(f.Clipper.ExcludeOp(g.Next),g=f.Clipper.ExcludeOp(g),d-=2):f.Clipper.SlopesNearCollinear(g.Prev.Pt,g.Pt,g.Next.Pt,m)?(g=f.Clipper.ExcludeOp(g),d--):(g.Idx=1,g=g.Next);3>d&&(d=0);for(var l=Array(d),m=0;m<d;++m)l[m]=new f.IntPoint(g.Pt),g=g.Next;return l};f.Clipper.CleanPolygons=
function(b,c){for(var d=Array(b.length),g=0,m=b.length;g<m;g++)d[g]=f.Clipper.CleanPolygon(b[g],c);return d};f.Clipper.Minkowski=function(b,c,d,g){var m=g?1:0,l=b.length,p=c.length;g=[];if(d)for(d=0;d<p;d++){for(var n=Array(l),t=0,G=b.length,M=b[t];t<G;t++,M=b[t])n[t]=new f.IntPoint(c[d].X+M.X,c[d].Y+M.Y);g.push(n)}else for(d=0;d<p;d++){n=Array(l);t=0;G=b.length;for(M=b[t];t<G;t++,M=b[t])n[t]=new f.IntPoint(c[d].X-M.X,c[d].Y-M.Y);g.push(n)}b=[];for(d=0;d<=p-2+m;d++)for(t=0;t<=l-1;t++)c=[],c.push(g[d%
p][t%l]),c.push(g[(d+1)%p][t%l]),c.push(g[(d+1)%p][(t+1)%l]),c.push(g[d%p][(t+1)%l]),f.Clipper.Orientation(c)||c.reverse(),b.push(c);m=new f.Clipper(0);m.AddPaths(b,f.PolyType.ptSubject,!0);m.Execute(f.ClipType.ctUnion,g,f.PolyFillType.pftNonZero,f.PolyFillType.pftNonZero);return g};f.Clipper.MinkowskiSum=function(b,c,d){return f.Clipper.Minkowski(b,c,!0,d)};f.Clipper.MinkowskiDiff=function(b,c,d){return f.Clipper.Minkowski(b,c,!1,d)};f.Clipper.PolyTreeToPaths=function(b){var c=[];f.Clipper.AddPolyNodeToPaths(b,
f.Clipper.NodeType.ntAny,c);return c};f.Clipper.AddPolyNodeToPaths=function(b,c,d){var g=!0;switch(c){case f.Clipper.NodeType.ntOpen:return;case f.Clipper.NodeType.ntClosed:g=!b.IsOpen}0<b.m_polygon.length&&g&&d.push(b.m_polygon);g=0;b=b.Childs();for(var m=b.length,l=b[g];g<m;g++,l=b[g])f.Clipper.AddPolyNodeToPaths(l,c,d)};f.Clipper.OpenPathsFromPolyTree=function(b){for(var c=new f.Paths,d=0,g=b.ChildCount();d<g;d++)b.Childs()[d].IsOpen&&c.push(b.Childs()[d].m_polygon);return c};f.Clipper.ClosedPathsFromPolyTree=
function(b){var c=new f.Paths;f.Clipper.AddPolyNodeToPaths(b,f.Clipper.NodeType.ntClosed,c);return c};Wa(f.Clipper,f.ClipperBase);f.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2};f.ClipperOffset=function(b,c){"undefined"==typeof b&&(b=2);"undefined"==typeof c&&(c=f.ClipperOffset.def_arc_tolerance);this.m_destPolys=new f.Paths;this.m_srcPoly=new f.Path;this.m_destPoly=new f.Path;this.m_normals=[];this.m_StepsPerRad=this.m_miterLim=this.m_cos=this.m_sin=this.m_sinA=this.m_delta=0;this.m_lowest=new f.IntPoint;
this.m_polyNodes=new f.PolyNode;this.MiterLimit=b;this.ArcTolerance=c;this.m_lowest.X=-1};f.ClipperOffset.two_pi=6.28318530717959;f.ClipperOffset.def_arc_tolerance=.25;f.ClipperOffset.prototype.Clear=function(){f.Clear(this.m_polyNodes.Childs());this.m_lowest.X=-1};f.ClipperOffset.Round=f.Clipper.Round;f.ClipperOffset.prototype.AddPath=function(b,c,d){var g=b.length-1;if(!(0>g)){var m=new f.PolyNode;m.m_jointype=c;m.m_endtype=d;if(d==f.EndType.etClosedLine||d==f.EndType.etClosedPolygon)for(;0<g&&
f.IntPoint.op_Equality(b[0],b[g]);)g--;m.m_polygon.push(b[0]);var l=0;c=0;for(var p=1;p<=g;p++)f.IntPoint.op_Inequality(m.m_polygon[l],b[p])&&(l++,m.m_polygon.push(b[p]),b[p].Y>m.m_polygon[c].Y||b[p].Y==m.m_polygon[c].Y&&b[p].X<m.m_polygon[c].X)&&(c=l);if(!(d==f.EndType.etClosedPolygon&&2>l||d!=f.EndType.etClosedPolygon&&0>l)&&(this.m_polyNodes.AddChild(m),d==f.EndType.etClosedPolygon))if(0>this.m_lowest.X)this.m_lowest=new f.IntPoint(0,c);else if(b=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],
m.m_polygon[c].Y>b.Y||m.m_polygon[c].Y==b.Y&&m.m_polygon[c].X<b.X)this.m_lowest=new f.IntPoint(this.m_polyNodes.ChildCount()-1,c)}};f.ClipperOffset.prototype.AddPaths=function(b,c,d){for(var g=0,f=b.length;g<f;g++)this.AddPath(b[g],c,d)};f.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!f.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var b=0;b<this.m_polyNodes.ChildCount();b++){var c=this.m_polyNodes.Childs()[b];(c.m_endtype==f.EndType.etClosedPolygon||
c.m_endtype==f.EndType.etClosedLine&&f.Clipper.Orientation(c.m_polygon))&&c.m_polygon.reverse()}else for(b=0;b<this.m_polyNodes.ChildCount();b++)c=this.m_polyNodes.Childs()[b],c.m_endtype!=f.EndType.etClosedLine||f.Clipper.Orientation(c.m_polygon)||c.m_polygon.reverse()};f.ClipperOffset.GetUnitNormal=function(b,c){var d=c.X-b.X,g=c.Y-b.Y;if(0==d&&0==g)return new f.DoublePoint(0,0);var m=1/Math.sqrt(d*d+g*g);return new f.DoublePoint(g*m,-(d*m))};f.ClipperOffset.prototype.DoOffset=function(b){this.m_destPolys=
[];this.m_delta=b;if(f.ClipperBase.near_zero(b))for(var c=0;c<this.m_polyNodes.ChildCount();c++){var d=this.m_polyNodes.Childs()[c];d.m_endtype==f.EndType.etClosedPolygon&&this.m_destPolys.push(d.m_polygon)}else{this.m_miterLim=2<this.MiterLimit?2/(this.MiterLimit*this.MiterLimit):.5;var c=0>=this.ArcTolerance?f.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(b)*f.ClipperOffset.def_arc_tolerance?Math.abs(b)*f.ClipperOffset.def_arc_tolerance:this.ArcTolerance,g=3.14159265358979/Math.acos(1-
c/Math.abs(b));this.m_sin=Math.sin(f.ClipperOffset.two_pi/g);this.m_cos=Math.cos(f.ClipperOffset.two_pi/g);this.m_StepsPerRad=g/f.ClipperOffset.two_pi;0>b&&(this.m_sin=-this.m_sin);for(c=0;c<this.m_polyNodes.ChildCount();c++){d=this.m_polyNodes.Childs()[c];this.m_srcPoly=d.m_polygon;var m=this.m_srcPoly.length;if(!(0==m||0>=b&&(3>m||d.m_endtype!=f.EndType.etClosedPolygon))){this.m_destPoly=[];if(1==m)if(d.m_jointype==f.JoinType.jtRound)for(var d=1,m=0,l=1;l<=g;l++){this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[0].X+
d*b),f.ClipperOffset.Round(this.m_srcPoly[0].Y+m*b)));var p=d,d=d*this.m_cos-this.m_sin*m,m=p*this.m_sin+m*this.m_cos}else for(m=d=-1,l=0;4>l;++l)this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[0].X+d*b),f.ClipperOffset.Round(this.m_srcPoly[0].Y+m*b))),0>d?d=1:0>m?m=1:d=-1;else{for(l=this.m_normals.length=0;l<m-1;l++)this.m_normals.push(f.ClipperOffset.GetUnitNormal(this.m_srcPoly[l],this.m_srcPoly[l+1]));d.m_endtype==f.EndType.etClosedLine||d.m_endtype==f.EndType.etClosedPolygon?
this.m_normals.push(f.ClipperOffset.GetUnitNormal(this.m_srcPoly[m-1],this.m_srcPoly[0])):this.m_normals.push(new f.DoublePoint(this.m_normals[m-2]));if(d.m_endtype==f.EndType.etClosedPolygon)for(p=m-1,l=0;l<m;l++)p=this.OffsetPoint(l,p,d.m_jointype);else if(d.m_endtype==f.EndType.etClosedLine){p=m-1;for(l=0;l<m;l++)p=this.OffsetPoint(l,p,d.m_jointype);this.m_destPolys.push(this.m_destPoly);this.m_destPoly=[];p=this.m_normals[m-1];for(l=m-1;0<l;l--)this.m_normals[l]=new f.DoublePoint(-this.m_normals[l-
1].X,-this.m_normals[l-1].Y);this.m_normals[0]=new f.DoublePoint(-p.X,-p.Y);p=0;for(l=m-1;0<=l;l--)p=this.OffsetPoint(l,p,d.m_jointype)}else{p=0;for(l=1;l<m-1;++l)p=this.OffsetPoint(l,p,d.m_jointype);d.m_endtype==f.EndType.etOpenButt?(l=m-1,p=new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[l].X+this.m_normals[l].X*b),f.ClipperOffset.Round(this.m_srcPoly[l].Y+this.m_normals[l].Y*b)),this.m_destPoly.push(p),p=new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[l].X-this.m_normals[l].X*b),f.ClipperOffset.Round(this.m_srcPoly[l].Y-
this.m_normals[l].Y*b)),this.m_destPoly.push(p)):(l=m-1,p=m-2,this.m_sinA=0,this.m_normals[l]=new f.DoublePoint(-this.m_normals[l].X,-this.m_normals[l].Y),d.m_endtype==f.EndType.etOpenSquare?this.DoSquare(l,p):this.DoRound(l,p));for(l=m-1;0<l;l--)this.m_normals[l]=new f.DoublePoint(-this.m_normals[l-1].X,-this.m_normals[l-1].Y);this.m_normals[0]=new f.DoublePoint(-this.m_normals[1].X,-this.m_normals[1].Y);p=m-1;for(l=p-1;0<l;--l)p=this.OffsetPoint(l,p,d.m_jointype);d.m_endtype==f.EndType.etOpenButt?
(p=new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*b),f.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*b)),this.m_destPoly.push(p),p=new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*b),f.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*b)),this.m_destPoly.push(p)):(this.m_sinA=0,d.m_endtype==f.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1))}}this.m_destPolys.push(this.m_destPoly)}}}};f.ClipperOffset.prototype.Execute=
function(){var b=arguments;if(b[0]instanceof f.PolyTree)if(c=b[0],d=b[1],c.Clear(),this.FixOrientations(),this.DoOffset(d),b=new f.Clipper(0),b.AddPaths(this.m_destPolys,f.PolyType.ptSubject,!0),0<d)b.Execute(f.ClipType.ctUnion,c,f.PolyFillType.pftPositive,f.PolyFillType.pftPositive);else if(d=f.Clipper.GetBounds(this.m_destPolys),g=new f.Path,g.push(new f.IntPoint(d.left-10,d.bottom+10)),g.push(new f.IntPoint(d.right+10,d.bottom+10)),g.push(new f.IntPoint(d.right+10,d.top-10)),g.push(new f.IntPoint(d.left-
10,d.top-10)),b.AddPath(g,f.PolyType.ptSubject,!0),b.ReverseSolution=!0,b.Execute(f.ClipType.ctUnion,c,f.PolyFillType.pftNegative,f.PolyFillType.pftNegative),1==c.ChildCount()&&0<c.Childs()[0].ChildCount())for(b=c.Childs()[0],c.Childs()[0]=b.Childs()[0],d=1;d<b.ChildCount();d++)c.AddChild(b.Childs()[d]);else c.Clear();else{var c=b[0],d=b[1];f.Clear(c);this.FixOrientations();this.DoOffset(d);b=new f.Clipper(0);b.AddPaths(this.m_destPolys,f.PolyType.ptSubject,!0);if(0<d)b.Execute(f.ClipType.ctUnion,
c,f.PolyFillType.pftPositive,f.PolyFillType.pftPositive);else{var d=f.Clipper.GetBounds(this.m_destPolys),g=new f.Path;g.push(new f.IntPoint(d.left-10,d.bottom+10));g.push(new f.IntPoint(d.right+10,d.bottom+10));g.push(new f.IntPoint(d.right+10,d.top-10));g.push(new f.IntPoint(d.left-10,d.top-10));b.AddPath(g,f.PolyType.ptSubject,!0);b.ReverseSolution=!0;b.Execute(f.ClipType.ctUnion,c,f.PolyFillType.pftNegative,f.PolyFillType.pftNegative);0<c.length&&c.splice(0,1)}}};f.ClipperOffset.prototype.OffsetPoint=
function(b,c,d){this.m_sinA=this.m_normals[c].X*this.m_normals[b].Y-this.m_normals[b].X*this.m_normals[c].Y;if(5E-5>this.m_sinA&&-5E-5<this.m_sinA)return c;1<this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1);if(0>this.m_sinA*this.m_delta)this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[c].X*this.m_delta),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[c].Y*this.m_delta))),this.m_destPoly.push(new f.IntPoint(this.m_srcPoly[b])),this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+
this.m_normals[b].X*this.m_delta),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[b].Y*this.m_delta)));else switch(d){case f.JoinType.jtMiter:d=1+(this.m_normals[b].X*this.m_normals[c].X+this.m_normals[b].Y*this.m_normals[c].Y);d>=this.m_miterLim?this.DoMiter(b,c,d):this.DoSquare(b,c);break;case f.JoinType.jtSquare:this.DoSquare(b,c);break;case f.JoinType.jtRound:this.DoRound(b,c)}return b};f.ClipperOffset.prototype.DoSquare=function(b,c){var d=Math.tan(Math.atan2(this.m_sinA,this.m_normals[c].X*
this.m_normals[b].X+this.m_normals[c].Y*this.m_normals[b].Y)/4);this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_delta*(this.m_normals[c].X-this.m_normals[c].Y*d)),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_delta*(this.m_normals[c].Y+this.m_normals[c].X*d))));this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_delta*(this.m_normals[b].X+this.m_normals[b].Y*d)),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_delta*(this.m_normals[b].Y-
this.m_normals[b].X*d))))};f.ClipperOffset.prototype.DoMiter=function(b,c,d){d=this.m_delta/d;this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+(this.m_normals[c].X+this.m_normals[b].X)*d),f.ClipperOffset.Round(this.m_srcPoly[b].Y+(this.m_normals[c].Y+this.m_normals[b].Y)*d)))};f.ClipperOffset.prototype.DoRound=function(b,c){for(var d=Math.atan2(this.m_sinA,this.m_normals[c].X*this.m_normals[b].X+this.m_normals[c].Y*this.m_normals[b].Y),d=f.Cast_Int32(f.ClipperOffset.Round(this.m_StepsPerRad*
Math.abs(d))),g=this.m_normals[c].X,m=this.m_normals[c].Y,l,p=0;p<d;++p)this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+g*this.m_delta),f.ClipperOffset.Round(this.m_srcPoly[b].Y+m*this.m_delta))),l=g,g=g*this.m_cos-this.m_sin*m,m=l*this.m_sin+m*this.m_cos;this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[b].X*this.m_delta),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[b].Y*this.m_delta)))};f.Error=function(b){try{throw Error(b);
}catch(c){alert(c.message)}};f.JS={};f.JS.AreaOfPolygon=function(b,c){c||(c=1);return f.Clipper.Area(b)/(c*c)};f.JS.AreaOfPolygons=function(b,c){c||(c=1);for(var d=0,g=0;g<b.length;g++)d+=f.Clipper.Area(b[g]);return d/(c*c)};f.JS.BoundsOfPath=function(b,c){return f.JS.BoundsOfPaths([b],c)};f.JS.BoundsOfPaths=function(b,c){c||(c=1);var d=f.Clipper.GetBounds(b);d.left/=c;d.bottom/=c;d.right/=c;d.top/=c;return d};f.JS.Clean=function(b,c){if(!(b instanceof Array))return[];var d=b[0]instanceof Array;b=
f.JS.Clone(b);if("number"!=typeof c||null===c)return f.Error("Delta is not a number in Clean()."),b;if(0===b.length||1==b.length&&0===b[0].length||0>c)return b;d||(b=[b]);for(var g=b.length,m,l,p,n,t,G,M,F=[],P=0;P<g;P++)if(l=b[P],m=l.length,0!==m)if(3>m)p=l,F.push(p);else{p=l;n=c*c;t=l[0];for(M=G=1;M<m;M++)(l[M].X-t.X)*(l[M].X-t.X)+(l[M].Y-t.Y)*(l[M].Y-t.Y)<=n||(p[G]=l[M],t=l[M],G++);t=l[G-1];(l[0].X-t.X)*(l[0].X-t.X)+(l[0].Y-t.Y)*(l[0].Y-t.Y)<=n&&G--;G<m&&p.splice(G,m-G);p.length&&F.push(p)}!d&&
F.length?F=F[0]:d||0!==F.length?d&&0===F.length&&(F=[[]]):F=[];return F};f.JS.Clone=function(b){if(!(b instanceof Array)||0===b.length)return[];if(1==b.length&&0===b[0].length)return[[]];var c=b[0]instanceof Array;c||(b=[b]);var d=b.length,g,f,l,p,n=Array(d);for(f=0;f<d;f++){g=b[f].length;p=Array(g);for(l=0;l<g;l++)p[l]={X:b[f][l].X,Y:b[f][l].Y};n[f]=p}c||(n=n[0]);return n};f.JS.Lighten=function(b,c){if(!(b instanceof Array))return[];if("number"!=typeof c||null===c)return f.Error("Tolerance is not a number in Lighten()."),
f.JS.Clone(b);if(0===b.length||1==b.length&&0===b[0].length||0>c)return f.JS.Clone(b);b[0]instanceof Array||(b=[b]);var d,g,m,l,p,n,t,G,F,P,N,R,S,Q,T,aa=b.length,ca=c*c,X=[];for(d=0;d<aa;d++)if(m=b[d],n=m.length,0!=n){for(l=0;1E6>l;l++){p=[];n=m.length;m[n-1].X!=m[0].X||m[n-1].Y!=m[0].Y?(N=1,m.push({X:m[0].X,Y:m[0].Y}),n=m.length):N=0;P=[];for(g=0;g<n-2;g++){t=m[g];F=m[g+1];G=m[g+2];Q=t.X;T=t.Y;t=G.X-Q;R=G.Y-T;if(0!==t||0!==R)S=((F.X-Q)*t+(F.Y-T)*R)/(t*t+R*R),1<S?(Q=G.X,T=G.Y):0<S&&(Q+=t*S,T+=R*S);
t=F.X-Q;R=F.Y-T;G=t*t+R*R;G<=ca&&(P[g+1]=1,g++)}p.push({X:m[0].X,Y:m[0].Y});for(g=1;g<n-1;g++)P[g]||p.push({X:m[g].X,Y:m[g].Y});p.push({X:m[n-1].X,Y:m[n-1].Y});N&&m.pop();if(P.length)m=p;else break}n=p.length;p[n-1].X==p[0].X&&p[n-1].Y==p[0].Y&&p.pop();2<p.length&&X.push(p)}b[0]instanceof Array||(X=X[0]);"undefined"==typeof X&&(X=[[]]);return X};f.JS.PerimeterOfPath=function(b,c,d){if("undefined"==typeof b)return 0;var g=Math.sqrt,f=0,l,p,n=0,t=0,G=b.length;if(2>G)return 0;for(c&&(b[G]=b[0],G++);--G;)l=
b[G],n=l.X,l=l.Y,p=b[G-1],t=p.X,p=p.Y,f+=g((n-t)*(n-t)+(l-p)*(l-p));c&&b.pop();return f/d};f.JS.PerimeterOfPaths=function(b,c,d){d||(d=1);for(var g=0,m=0;m<b.length;m++)g+=f.JS.PerimeterOfPath(b[m],c,d);return g};f.JS.ScaleDownPath=function(b,c){var d,g;c||(c=1);for(d=b.length;d--;)g=b[d],g.X/=c,g.Y/=c};f.JS.ScaleDownPaths=function(b,c){var d,g,f;c||(c=1);for(d=b.length;d--;)for(g=b[d].length;g--;)f=b[d][g],f.X/=c,f.Y/=c};f.JS.ScaleUpPath=function(b,c){var d,f,m=Math.round;c||(c=1);for(d=b.length;d--;)f=
b[d],f.X=m(f.X*c),f.Y=m(f.Y*c)};f.JS.ScaleUpPaths=function(b,c){var d,f,m,l=Math.round;c||(c=1);for(d=b.length;d--;)for(f=b[d].length;f--;)m=b[d][f],m.X=l(m.X*c),m.Y=l(m.Y*c)};f.ExPolygons=function(){return[]};f.ExPolygon=function(){this.holes=this.outer=null};f.JS.AddOuterPolyNodeToExPolygons=function(b,c){var d=new f.ExPolygon;d.outer=b.Contour();var g=b.Childs(),m=g.length;d.holes=Array(m);var l,p,n,t,G;for(p=0;p<m;p++)for(l=g[p],d.holes[p]=l.Contour(),n=0,t=l.Childs(),G=t.length;n<G;n++)l=t[n],
f.JS.AddOuterPolyNodeToExPolygons(l,c);c.push(d)};f.JS.ExPolygonsToPaths=function(b){var c,d,g,m,l=new f.Paths;c=0;for(g=b.length;c<g;c++)for(l.push(b[c].outer),d=0,m=b[c].holes.length;d<m;d++)l.push(b[c].holes[d]);return l};f.JS.PolyTreeToExPolygons=function(b){var c=new f.ExPolygons,d,g,m;d=0;g=b.Childs();for(m=g.length;d<m;d++)b=g[d],f.JS.AddOuterPolyNodeToExPolygons(b,c);return c}})();
var createCindy=function(){function n(n){if(0===qa)return console.error("Waiting for "+n+" after we finished waiting."),function(){};0>qa&&(qa=0);++qa;return function(){--qa;0>qa&&console.error("Wait count mismatch: "+n);if(0===qa)for(var F=0,t=wa.length;F<t;)wa[F++].startup()}}function F(n){var P=F.newInstance(n);0>=qa?P.startup():!1!==n.autostart&&wa.push(P);return P}var qa=-1,wa=[];"undefined"===typeof document||"undefined"===typeof window||"undefined"===typeof document.addEventListener||"undefined"!==
typeof window.cindyDontWait&&!0===window.cindyDontWait||document.addEventListener("DOMContentLoaded",n("DOMContentLoaded"));"undefined"!==typeof window&&"undefined"!==typeof window.__gwt_activeModules&&(Object.keys(window.__gwt_activeModules).forEach(function(G){G=window.__gwt_activeModules[G];G.cindyDoneWaiting=n(G.moduleName)}),window.__gwtStatsEvent=function(n){"moduleStartup"===n.evtGroup&&"end"===n.type&&window.__gwt_activeModules[n.moduleName].cindyDoneWaiting()});var ra=null,za=null,fa={};
F.getBaseDir=function(){if(null!==ra)return ra;for(var n=document.getElementsByTagName("script"),F=0;F<n.length;++F){var t=n[F],S=t.src;if(S){var Q=/Cindy\.js$/.exec(S);if(Q)return ra=S.substr(0,Q.index),console.log("Will load extensions from "+ra),za=t,ra}}console.error("Could not find <script> tag for Cindy.js");return ra=za=!1};F.loadScript=function(n,P,t,S){if(window[n])return t(),!0;S||(S=console.error.bind(console));var Q=F.getBaseDir();if(!1===Q)return S("Can't load additional components."),
!1;var ca=fa[n];ca||(ca=document.createElement("script"),ca.src=Q+P,P=za.nextSibling,Q=za.parentElement,P?Q.insertBefore(ca,P):Q.appendChild(ca),fa[n]=ca);ca.addEventListener("load",t);ca.addEventListener("error",S);return null};F.waitFor=n;F._pluginRegistry={};F.instances=[];F.registerPlugin=function(n,P,t){if(1!==n)return console.error("Plugin API version "+n+" not supported"),!1;F._pluginRegistry[P]=t};F.newInstance=function(n){var F,t,S,Q,ca,fa;function qa(a){if(a){for(var r=0;r<a.length;r++){var e=
a[r],q=Object.keys(e)[0];"scale"===q&&(eb=e.scale,x[q](e.scale));if("translate"===q)x[q](e.translate[0],e.translate[1]);"scaleAndOrigin"===q&&(eb=e[q][0]/25,x[q].apply(null,e[q]));"visibleRect"===q&&(x[q].apply(null,e[q]),eb=x.drawingstate.initialmatrix.a/25)}x.createnewbackup()}}function ra(){rb=!0;if(0===fb){void 0!==n.csconsole&&(la=n.csconsole);la=null===la?new Ka:!0===la?new Va:"string"===typeof la?new Ja(la):"object"===typeof la&&"function"===typeof la.appendChild?new Ja(la):new Ka;$a=[100,
100];var a,r=null,e=n.transform;n.ports&&0<n.ports.length&&(a=n.ports[0],(r=a.element)||(r=document.getElementById(a.id)),"window"===a.fill?(r.setAttribute("width",window.innerWidth),r.setAttribute("height",window.innerHeight)):a.width&&a.height&&(r.setAttribute("width",a.width),r.setAttribute("height",a.height)),a.background&&(r.style.backgroundColor=a.background),void 0!==a.transform&&(e=a.transform));r||(r=n.canvas)||"undefined"===typeof document||(r=document.getElementById(n.canvasname));r&&(C=
r.getContext("2d"),C.setLineDash||(C.setLineDash=function(){}));a=ab(sc);a=ma(a,!1);A(a);var q=n.scripts,b=null;"string"===typeof q&&q.search(/\*/)&&(b=q);"object"!==typeof q&&(q=null);"move keydown mousedown mouseup mousedrag init tick draw simulationstep cssimulationstart cssimulationstop".split(" ").forEach(function(a){var e;if(null!==q&&q[a])e=q[a];else{e=a+"script";if(n[e])e=document.getElementById(n[e]);else if(b){if(e=document.getElementById(b.replace(/\*/,a)),!e)return}else return;e=e.text}e=
ab(e);ja[a]=ma(e,!1)});n.grid&&0!==n.grid&&(La=n.grid,Sb=ma("#drawgrid("+La+")",!1));n.snap&&(Tb=n.snap);r&&(ga=r.width,Y=r.height,qa(e),x.drawingstate.matrix.ty-=Y,x.drawingstate.initialmatrix.ty-=Y,e=1,"undefined"!==typeof window&&window.devicePixelRatio&&(e=window.devicePixelRatio),a=C.webkitBackingStorePixelRatio||C.mozBackingStorePixelRatio||C.msBackingStorePixelRatio||C.oBackingStorePixelRatio||C.backingStorePixelRatio||1,e!==a&&(e/=a,r.width=ga*e,r.height=Y*e,r.style.width||(r.style.width=
ga+"px"),r.style.height||(r.style.height=Y+"px"),C.scale(e,e)));fa=ca=Q=S=t=F=void 0;e=0;ea={};n.geometry||(n.geometry=[]);tc(n.geometry);n.behavior||(n.behavior=[]);"function"===typeof tb&&tb(n.behavior);for(var c in n.images)e=n.images[c],ea[c]=new Image,ea[c].ready=!1,ea[c].onload=function(){ea[c].ready=!0;xa()},ea[c].src=e;Aa.canvas=r;if(n.oninit)n.oninit(Aa);if(n.exclusive)for(e=Ca.instances.length;0<e;)Ca.instances[--e].shutdown();Ca.instances.push(Aa);n.use&&n.use.forEach(function(a){v.use$1([y.wrap(a)],
{})});A(ja.init);n.autoplay&&f();r&&Ua(r,n)}}function Ha(){null!==Qa&&(ha.set(Qa.state),Object.keys(Qa.speeds).forEach(function(a){var r=t[a];"undefined"!==typeof r.behavior&&(a=Qa.speeds[a],r.behavior.vx=a[0],r.behavior.vy=a[1],r.behavior.vz=a[2],r.behavior.fx=0,r.behavior.fy=0,r.behavior.fz=0)}),uc())}function f(){if(!Ma){if(hb){var a=Qa?Qa.state:new Float64Array(ha.length);a.set(ha);for(var r={},e=0;e<S.length;e++){var q=S[e];"undefined"!==typeof q.behavior&&(r[q.name]=[q.behavior.vx,q.behavior.vy,
q.behavior.vz])}Qa={state:a,speeds:r};hb=!1}"function"===typeof tb&&ub&&vc(na);Ma=!0;aa()}}function za(){Ma&&(Ma=!1)}function T(){hb||(Ma=!1,hb=!0,Ha())}function N(){if(!vb){vb=!0;for(var a=Ca.instances.length;0<a;)if(Ca.instances[--a]===Aa){Ca.instances.splice(a,1);break}for(a=Xa.length;0<a;)try{Xa[--a]()}catch(r){console.error(r)}}}function Ia(a){this.in=function(a,e){console.log(a);e?this.append(this.createTextNode("span","blue",a)):this.append(this.createTextNode("p","blue",a))};this.out=function(a,
e){console.log(a);e?this.append(this.createTextNode("span","red",a)):this.append(this.createTextNode("p","red",a))};this.err=function(a,e){console.log(a);e?this.append(this.createTextNode("span","red",a)):this.append(this.createTextNode("p","red",a))};this.createTextNode=function(a,e,q){return"undefined"!==typeof document?(a=document.createElement(a),a.appendChild(document.createTextNode(q)),a.style.color=e,a):q+"\n"}}function Va(){var a=this,r,e=document.createElement("div"),q;e.innerHTML='<div id="console" style="border-top: 1px solid #333333; bottom: 0px; position: absolute; width: 100%;"><div id="log" style="height: 150px; overflow-y: auto;"></div><input id="cmd" type="text" style="box-sizing: border-box; height: 30px; width: 100%;"></div>';
document.body.appendChild(e);r=document.getElementById("cmd");q=document.getElementById("log");r.onkeydown=function(e){13===e.keyCode&&""!==r.value&&(a.in(r.value),e=v.parse$1([y.wrap(r.value)],[]),e=A(e),console.log(E(e)),"undefined"!==e.ctype&&la.out(E(e)),r.value="",q.scrollTop=q.scrollHeight)};this.append=function(a){q.appendChild(a)};this.clear=function(){q.innerHTML=""}}function Ja(a){var r=a;"string"===typeof a&&(r=document.getElementById(a));this.append=function(a){r.appendChild(a)};this.clear=
function(){r.innerHTML=""}}function Ka(){this.append=function(a){};this.clear=function(){}}function Pa(a){for(var r=null,e=1E6,q,b=0;b<fa.length;b++){var c=fa[b];if(!c.pinned&&!1!==c.visible){var d,f,g,m=x.drawingstate.matrix.sdet;if("P"===c.kind){var l=h.normalizeZ(c.homog);if(!h._helper.isAlmostReal(l))continue;d=l.value[0].value.real-a.x;f=l.value[1].value.real-a.y;g=Math.sqrt(d*d+f*f);c.narrow&g>20/m&&(g=1E4)}else"C"===c.kind?(f=t[c.args[0]],g=c.radius,d=k.div(f.homog.value[0],f.homog.value[2]).value.real,
f=k.div(f.homog.value[1],f.homog.value[2]).value.real,d-=a.x,f-=a.y,g=Math.sqrt(d*d+f*f)-g.value.real,f=d=0,0>g&&(g=-g),g+=30/m):"L"===c.kind&&(d=c.homog,g=k,f=g.add(g.mult(d.value[0],g.conjugate(d.value[0])),g.mult(d.value[1],g.conjugate(d.value[1]))),f=h.scaldiv(g.sqrt(f),d),g=f.value[0].value.real*a.x+f.value[1].value.real*a.y+f.value[2].value.real,d=f.value[0].value.real*g,f=f.value[1].value.real*g,0>g&&(g=-g),g+=1);g<e+.2/m&&(e=g,r=c,q={x:d,y:f})}}console.log("Moving "+(r?r.name:"nothing"));
return null===r?null:{mover:r,offset:q,prev:{x:a.x,y:a.y}}}function X(a,r,e,q){void 0===q&&(q=!1);Xa.push(function(){a.removeEventListener(r,e,q)});a.addEventListener(r,e,q)}function Ua(a,r){function e(e){var r=a.getBoundingClientRect();e=x.to(e.clientX-r.left-a.clientLeft,e.clientY-r.top-a.clientTop);U.prevx=U.x;U.prevy=U.y;U.x=e[0];U.y=e[1];$a[0]=U.x;$a[1]=U.y}function q(a){U.down=!1;da=void 0;Na();xa();A(ja.mouseup);a.preventDefault()}var b=null;"undefined"!==typeof MutationObserver&&(b=MutationObserver);
b||"undefined"===typeof WebKitMutationObserver||(b=WebKitMutationObserver);b?(b=new b(function(e){document.body.contains(a)||N()}),b.observe(document.documentElement,{childList:!0,subtree:!0}),Xa.push(function(){b.disconnect()})):(X(a,"DOMNodeRemovedFromDocument",N),X(a,"DOMNodeRemoved",N));!0===r.keylistener?X(document,"keydown",function(a){Wa(a);return!1}):ja.keydown&&(a.setAttribute("tabindex","0"),X(a,"mousedown",function(){a.focus()}),X(a,"keydown",function(a){9!==a.keyCode&&(Wa(a),a.preventDefault())}));
X(a,"mousedown",function(a){U.button=a.which;e(a);A(ja.mousedown);da=Pa(U);aa();U.down=!0;a.preventDefault()});X(a,"mouseup",function(a){U.down=!1;da=void 0;Na();A(ja.mouseup);xa();a.preventDefault()});X(a,"mousemove",function(a){e(a);U.down?A(ja.mousedrag):A(ja.mousemove);a.preventDefault()});X(a,"touchstart",function(a){e(a.targetTouches[0]);A(ja.mousedown);U.down=!0;da=Pa(U);aa();a.preventDefault()},!1);X(a,"touchmove",function(a){e(a.targetTouches[0]);U.down?A(ja.mousedrag):A(ja.mousemove);a.preventDefault()},
!0);X(a,"touchend",q,!1);"undefined"!==typeof document&&document.body&&X(document.body,"touchcancel",q,!1);xa()}function pa(){if(vb)return!0;Ma&&(ub&&"undefined"!==typeof ka&&ka.tick(),Ma&&A(ja.tick));xa();ib=Ma||U.down;return!ib}function aa(){ib||(ib=!0,wb.timer(pa))}function xa(){x.reset();C.save();C.clearRect(0,0,ga,Y);0!==La&&A(Sb);wc();x.greset();for(var a=0;a<S.length;a++){var r=S[a];if(r.trace){0===r._traces_tick%r.traceskip&&r._traces.push(r.homog);r._traces_tick++;r._traces.length>r.tracelength&&
r._traces.shift();for(var e=r.alpha.value.real*Math.pow(1.03,-r._traces.length),q=0;q<r._traces.length;q++)v.draw$1([r._traces[q]],{size:r.size,color:r.color,alpha:k.real(e)}),e*=1.03}}xc();C.restore()}function Wa(a){a=window.event?event:a;a=a.charCode?a.charCode:a.keyCode;Ub=String.fromCharCode(a);Vb=a;A(ja.keydown);xa()}function b(a,r){if(r in a)return r;r=r.charAt(0).toUpperCase()+r.substring(1);for(var e=0,q=Wb.length;e<q;++e){var b=Wb[e]+r;if(b in a)return b}}function c(){var a=d(),a=g()-a;24<
a?(isFinite(a)&&(clearTimeout(jb),jb=setTimeout(c,a)),kb=0):(kb=1,Xb(c))}function d(){var a=Date.now();for(Oa=lb;Oa;)a>=Oa.t&&(Oa.f=Oa.c(a-Oa.t)),Oa=Oa.n;return a}function g(){for(var a,r=lb,e=Infinity;r;)r.f?r=a?a.n=r.n:lb=r.n:(r.t<e&&(e=r.t),r=(a=r).n);mb=a;return e}function m(){this.ctype="undefined"}function l(){this.ctype="void"}function p(a){this.ctype="error";this.message=a}function E(a){if("undefined"===typeof a)return"_??_";if("undefined"===a.ctype)return"_?_";if("number"===a.ctype)return k.niceprint(a);
if("string"===a.ctype||"boolean"===a.ctype)return a.value;if("list"===a.ctype){for(var r="[",e=0;e<a.value.length;e++)r+=E(A(a.value[e])),e!==a.value.length-1&&(r+=", ");return r+"]"}return"function"===a.ctype?"FUNCTION":"infix"===a.ctype?"INFIX":"modifier"===a.ctype?a.key+"->"+E(a.value):"shape"===a.ctype?a.type:"error"===a.ctype?"Error: "+a.message:"variable"===a.ctype?(console.log("HALLO"),E(a.stack[length.stack])):"geo"===a.ctype?a.value.name:"__"}function wa(a,r,e){a=wa[a];if(void 0===a)return u;
var q=[];for(e=0;e<a.arglist.length;e++)q[e]=A(r[e]);for(e=0;e<a.arglist.length;e++)J.newvar(a.arglist[e].name),J.setvar(a.arglist[e].name,q[e]);J.pushVstack("*");r=A(a.body);J.cleanVstack();for(e=0;e<a.arglist.length;e++)J.removevar(a.arglist[e].name);return r}function Ga(a,r){var e="undefined"===a[0].ctype,q="undefined"===a[1].ctype,b=A(a[1]);if(e||q)return u;"variable"===a[0].ctype?J.setvar(a[0].name,b):"infix"===a[0].ctype?"_"===a[0].oper?D.assigntake(a[0],b):console.error("Can't use infix expression as lvalue"):
"field"===a[0].ctype?D.assigndot(a[0],b):"function"===a[0].ctype&&"genList"===a[0].oper?"list"===b.ctype?D.assignlist(a[0].args,b.value):console.error("Expected list in rhs of assignment"):console.error("Left hand side of assignment is not a recognized lvalue");return b}function M(a,r){var e=B(a[0]),q=B(a[1]);return"number"===e.ctype&&"number"===q.ctype?{ctype:"boolean",value:e.value.real===q.value.real&&e.value.imag===q.value.imag}:"string"===e.ctype&&"string"===q.ctype||"boolean"===e.ctype&&"boolean"===
q.ctype?{ctype:"boolean",value:e.value===q.value}:"list"===e.ctype&&"list"===q.ctype?h.equals(e,q):{ctype:"boolean",value:!1}}function Z(a,r){var e=B(a[0]),q=B(a[1]);return"number"===e.ctype&&"number"===q.ctype?{ctype:"boolean",value:k._helper.isAlmostEqual(e,q)}:"string"===e.ctype&&"string"===q.ctype||"boolean"===e.ctype&&"boolean"===q.ctype?{ctype:"boolean",value:e.value===q.value}:"list"===e.ctype&&"list"===q.ctype?h.almostequals(e,q):{ctype:"boolean",value:!1}}function Nb(a,r){var e=B(a[0]),q=
B(a[1]);return"boolean"===e.ctype&&"boolean"===q.ctype?{ctype:"boolean",value:e.value&&q.value}:u}function R(a,r){var e=B(a[0]),q=B(a[1]);return"boolean"===e.ctype&&"boolean"===q.ctype?{ctype:"boolean",value:e.value||q.value}:u}function Ob(a,r){var e=B(a[0]),q=B(a[1]);return y.add(e,q)}function pb(a,r){var e=B(a[0]),q=B(a[1]);return y.sub(e,q)}function Pb(a,r){var e=B(a[0]),q=B(a[1]);return y.mult(e,q)}function Qb(a,r){var e=B(a[0]),q=B(a[1]);return y.div(e,q)}function Rb(a,r){var e=B(a[0]),q=B(a[1]);
return"number"===e.ctype&&"number"===q.ctype?k.pow(e,q):u}function qb(a){var r=a.length;if(0===r)return[];if(1===r)return[0];if(2===r)return a[0][0]+a[1][1]<=a[0][1]+a[1][0]?[0,1]:[1,0];if(4<r)return yc(a);for(var e=zc[r],q=Number.POSITIVE_INFINITY,b=e[0],c=0;c<e.length;++c){for(var d=e[c],h=0,f=0;f<r;++f)h+=a[f][d[f]];h<q&&(q=h,b=d)}return b}function yc(a){function r(){return{matched:-1,prev:-1,start:-1,cost:0,used:!1,leaf:!1}}function e(a){for(var r=0;r<c;++r)0<k[a][r]||g[r].used||(g[r].used=!0,
e(g[r].matched))}function q(a){for(var e=0;e<c;++e)0<k[e][a]||f[e].used||(f[e].used=!0,q(f[e].matched))}var b=Math.abs,c=a.length,d,h,f=Array(c),g=Array(c),k=Array(c);for(d=0;d<c;++d)k[d]=Array(c);for(d=0;d<c;++d)for(f[d]=r(),g[d]=r(),f[d].cost=a[d][0],h=1;h<c;++h)f[d].cost>a[d][h]&&(f[d].cost=a[d][h]);for(;;){for(d=0;d<c;++d)for(h=0;h<c;++h)k[d][h]=a[d][h]-f[d].cost-g[h].cost,k[d][h]<1E-14*(b(a[d][h])+b(f[d].cost)+b(g[h].cost))&&(k[d][h]=0);for(d=0;d<c;++d)f[d].matched=g[d].matched=-1;for(var m=
0;;){for(d=0;d<c;++d)f[d].used=f[d].leaf=g[d].used=g[d].leaf=!1,-1===f[d].matched&&(f[d].start=d,f[d].used=f[d].leaf=!0,f[d].prev=-1);for(var l=!1,n=!1;!n;){for(d=0;d<c;++d)if(f[d].leaf)for(f[d].leaf=!1,h=0;h<c;++h)if(!(g[h].used||0<k[d][h])&&f[d].matched!==h&&(g[h].prev=d,g[h].start=f[d].start,g[h].used=g[h].leaf=!0,-1===g[h].matched)){f[g[h].start].prev=h;l=!0;break}if(l)break;n=!0;for(h=0;h<c;++h)g[h].leaf&&(g[h].leaf=!1,d=g[h].matched,f[d].used||(f[d].prev=h,f[d].start=g[h].start,f[d].used=f[d].leaf=
!0,n=!1))}if(!l)break;for(l=0;l<c;++l)if(-1===f[l].matched&&-1!==f[l].prev){h=f[l].prev;do d=g[h].prev,g[h].matched=d,f[d].matched=h,h=f[d].prev;while(d!==l);++m}}if(m===c)break;for(d=0;d<c;++d)f[d].used=f[d].leaf=g[d].used=g[d].leaf=!1;for(d=0;d<c;++d)-1===f[d].matched&&e(d);for(h=0;h<c;++h)-1===g[h].matched&&q(h);for(d=0;d<c;++d)-1===f[d].matched||f[d].used||g[f[d].matched].used||(f[d].used=!0);m=Number.POSITIVE_INFINITY;for(d=0;d<c;++d)if(!f[d].used)for(h=0;h<c;++h)g[h].used||m>k[d][h]&&(m=k[d][h]);
for(d=0;d<c;++d)f[d].used||(f[d].cost+=m),g[d].used&&(g[d].cost-=m)}a=Array(c);for(d=0;d<c;++d)h=f[d].matched,a[d]=h;return a}function Yb(a,r){var e=A(a[0]),q=B(a[1]);if("number"===q.ctype){var b=Math.floor(q.value.real);if("list"===e.ctype||"string"===e.ctype)return 0>b&&(b=e.value.length+b+1),0<b&&b<e.value.length+1?"list"===e.ctype?e.value[b-1]:{ctype:"string",value:e.value.charAt(b-1)}:u}if("list"===q.ctype){for(var b=[],c=0;c<q.value.length;c++){var d=B(q.value[c]);b[c]=Yb([e,d],[])}return h.turnIntoCSList(b)}return u}
function Zb(a,r){var e=A(a[0]),q=A(a[1]);return"list"===e.ctype&&"list"===q.ctype?h.concat(e,q):"shape"===e.ctype&&"shape"===q.ctype?D.shapeconcat(e,q):u}function $b(a,r){var e=A(a[0]),q=A(a[1]);return"list"===e.ctype&&"list"===q.ctype?h.set(h.common(e,q)):"shape"===e.ctype&&"shape"===q.ctype?D.shapecommon(e,q):u}function ac(a,r){var e=A(a[0]),q=A(a[1]);return"list"===e.ctype&&"list"===q.ctype?h.remove(e,q):"shape"===e.ctype&&"shape"===q.ctype?D.shaperemove(e,q):u}function bc(a,r){var e=A(a[0]),q=
A(a[1]);return"list"===e.ctype?h.append(e,q):u}function cc(a,r){var e=A(a[0]),q=A(a[1]);return"list"===q.ctype?h.prepend(e,q):u}function xb(a,r){a|=0;r|=0;if(0===a&&0===r)return 0;for(;0!==r;){var e=a;a=r;r=e%r|0}return a}function Ac(a){return 1===a?0:1}function A(a){if("undefined"===typeof a)return u;if("infix"===a.ctype)return a.impl(a.args,{});if("variable"===a.ctype)return J.getvar(a.name);if("void"===a.ctype||"geo"===a.ctype||"number"===a.ctype||"boolean"===a.ctype||"string"===a.ctype||"list"===
a.ctype||"undefined"===a.ctype||"shape"===a.ctype)return a;if("field"===a.ctype){var r=A(a.obj);return"geo"===r.ctype?sa.getField(r.value,a.key):"list"===r.ctype?h.getField(r,a.key):u}return"function"===a.ctype?D.evaluate(a.oper,a.args,a.modifs):u}function B(a){a=A(a);if("geo"===a.ctype){var r=a.value;if("P"===r.kind)return sa.getField(r,"xy")}return a}function K(a){a=A(a);if("geo"===a.ctype){var r=a.value;if("P"===r.kind||"L"===r.kind)return sa.getField(r,"homog")}return h._helper.isNumberVecN(a,
3)?a:h._helper.isNumberVecN(a,2)?(r=h.turnIntoCSList([a.value[0],a.value[1],k.real(1)]),a.usage&&(r=y.withUsage(r,a.usage)),r):u}function ab(a){for(var r=!1,e=!1,q="",b=0;b<a.length;b++){var c=a[b];'"'!==c||e||(r=!r);"/"===c&&b!==a.length-1&&"/"===a[b+1]&&(e=!0);"\n"===c&&(e=!1);if(" "!==c&&"\t"!==c&&"\n"!==c&&"\f"!==c&&"\r"!==c&&!e||r)q+=c}return q}function dc(a,r,e){var q={ctype:"infix"};q.oper=a;q.impl=O[a];q.args=[r,e];return q}function Bc(a){var r,e;if("function"!==a.ctype)return console.log("Invalid function name."),
!1;for(r=0;r<a.args.length;r++)if("variable"!==a.args[r].ctype)return console.log("Argument is not a variable."),!1;for(r=0;r<a.args.length-1;r++)for(e=r+1;e<a.args.length;e++)if(a.args[r].name===a.args[e].name)return console.log("Variable name used twice."),!1;return!0}function nb(a){return""!==a&&!isNaN(a)}function yb(a){return"["===a||"("===a||"{"===a||"|"===a}function zb(a){return"]"===a||")"===a||"}"===a||"|"===a}function Ab(a){var r,e=[],q=[],b=[];r=a+",";var c=r.length,d=0,h=0,f=!1,g=!1;for(a=
h;a<c;a++){var k;k=r[a];'"'===k&&(g=!g);!g&&(!yb(k)||"|"===k&&f?zb(k)&&("|"!==k||f)&&(d--,"|"===k&&(f=!1)):(d++,"|"===k&&(f=!0)),","===k&&0===d||-1===d)&&(k=r.substring(h,a),e.push(k),q.push(h),h=a+1)}for(a=0;a<e.length;a++)if(q=e[a],""===q)b.push("nil");else{q=ma(q,!1);if("error"===q.ctype)return q;b.push(q)}e={ctype:"function",oper:"genList"};e.args=b;e.modifs={};return e}function Cc(a){var r;return"|"===a[0]?(a=Ab(a.substring(1,a.length-1)),r=a.args.length,1===r?(a.oper="abs_infix",a):2===r?(a.oper=
"dist_infix",a):u):"()"===a||"[]"===a?r={ctype:"list",value:[]}:"["===a[0]?Ab(a.substring(1,a.length-1)):"("===a[0]&&(r=Ab(a.substring(1,a.length-1)),1<r.args.length)?r:r=ma(a.substring(1,a.length-1),!1)}function ma(a,r){for(var e=!1,q="",b=-1,c=-1,d="",h=0,f=0,g=" ",k=" ",m=0,n=!1,t=a.length,v=0;v<t;v++){var w,x=" ",y=" ";0<m&&m--;w=a[v];v+1<t&&(x=a[v+1]);v+2<t&&(y=a[v+2]);'"'===w&&(e=!e);if(!e){if(yb(w)&&("|"!==w||!n))"|"===w&&(n=!0),q+=w,h++,1===h&&f++," "===g&&(g=w);else if(zb(w)&&("|"!==w||n)){"|"===
w&&(n=!1);if(0===h)return new p("close without open");k=q[q.length-1]+w;if("[]"===k||"()"===k||"{}"===k||"||"===k)h--,q=q.substring(0,q.length-1),k=w;else return new p("unmatched brackets")}if(0===q.length){var z=-1,A="";"undefined"!==typeof ob[w+x+y]&&0===m?(A=w+x+y,m=3):"undefined"!==typeof ob[w+x]&&0===m?(A=""+w+x,m=2):"undefined"!==typeof ob[w]&&0===m&&(A=""+w,m=1);""!==A&&(z=ob[A]);z>=c&&(c=z,b=v,d=A,0<=z&&(v+=A.length-1))}}}if(0!==h)return new p("open without close");e=a.indexOf(g);q=a.lastIndexOf(k);
if(0===h&&-1<c){if("->"===d)return c=d,d=a.substring(0,b),b=ma(a.substring(b+c.length),!1),d="error"===b.ctype?b:{ctype:"modifier",key:d,value:b},d;if("."===d)return c=a.indexOf("."),h=a.lastIndexOf("."),(c!==h?0:-1===c?nb(a):nb(a.substring(0,c))||nb(a.substring(c+1)))?(d={},d.value={real:parseFloat(a),imag:0},d.ctype="number"):(c=ma(a.substring(0,b),!1),d=a.substring(b+d.length),d={ctype:"field",obj:c,key:d}),d;if(":="===d)return c=a.substring(0,b),c=ma(c,!0),"error"===c.ctype?d=c:"variable"===c.cstring||
Bc(c)?(b=a.substring(b+d.length),b=ma(b,!1),d="error"===b.ctype?b:dc(d,c,b)):(console.log(["Function not definable",c]),d=new p("Function not definable")),d;c=ma(a.substring(0,b),!1);b=ma(a.substring(b+d.length),!1);d="error"===c.ctype?c:"error"===b.ctype?b:dc(d,c,b);return d}if(0===h&&1===f&&q===a.length-1){if(0===e)return Cc(a);a:{h=[];f=[];d=[];b={};c=a.substring(0,e);q=a.length;g=0;k=e+1;n=m=!1;for(e=k;e<q;e++)if(t=a[e],'"'===t&&(m=!m),!m)if(!yb(t)||"|"===t&&n?zb(t)&&("|"!==t||n)&&(g--,"|"===
t&&(n=!1)):(g++,"|"===t&&(n=!0)),","===t&&0===g||-1===g)t=a.substring(k,e),h.push(t),f.push(k),1!==h.length||-1!==g||h[0].length||(h=[],f=[]),k=e+1;for(e=0;e<h.length;e++){f=ma(h[e],!1);if("error"===f.ctype){d=f;break a}"modifier"===f.ctype?b[f.key]=f.value:d.push(f)}h={ctype:"function"};h.oper=c+"$"+d.length;h.args=d;h.modifs=b;d=h}return d}return""===a?new l:'"'===a.charAt(0)&&'"'===a.charAt(a.length-1)?{ctype:"string",value:a.substring(1,a.length-1)}:nb(a)?{ctype:"number",value:{real:parseInt(a),
imag:0}}:J.isVariable(a)?J.vars[a]:J.isVariableName(a)?J.create(a):u}function Dc(a){for(var r in a)null!==a[r]&&(ua[r]=a[r])}function tc(a){Object.keys(w).forEach(function(a){a=w[a];void 0!==a.updatePosition&&void 0===a.stateSize&&(a.stateSize=0)});F=a;t={};var r,e,b,c,d=0;S=[];Q=[];ca=[];fa=[];var h=0,f=0,g=0,k=0,m={};for(r=0;r<a.length;r++)if(b=a[r],e=Ec[b.type])b=e(b).slice(),b.splice(0,0,r,1),a.splice.apply(a,b),--r;else if(t[b.name]=b,c=w[b.type]){if(b.args){for(e=0;e<b.args.length&&!m.hasOwnProperty(b.args[e]);++e);
if(e<b.args.length){console.log("Dropping "+b.name+" due to dropped argument "+b.args[e]);m[b.name]=!0;a.splice(r,1);r--;continue}}b.kind=c.kind;b.stateIdx=d;d+=c.stateSize;b.incidences=[];b.isshowing=!0;b.movable=!1;c.isMovable&&(b.movable=!0,fa[f++]=b);"P"===b.kind&&(S[h]=b,Fc(b),h+=1);"L"===b.kind&&(Q[g]=b,Bb(b),g+=1);"C"===b.kind&&(ca[k]=b,Bb(b),k+=1);"S"===b.kind&&(Q[g]=b,Gc(b),g+=1)}else console.error(b),console.error("Operation "+b.type+" not implemented yet"),m[b.name]=!0,a.splice(r,1),r--;
Da=ha=ya=new Float64Array(d);for(r=0;r<a.length;r++)b=a[r],c=w[b.type],Ra=!0,c.initialize&&(ia=oa=b.stateIdx,b.param=c.initialize(b),Sa(oa===b.stateIdx+c.stateSize,"State fully initialized")),ia=oa=b.stateIdx,c.updatePosition(b,!1),Sa(ia===b.stateIdx+c.stateSize,"State fully consumed"),Sa(oa===b.stateIdx+c.stateSize,"State fully updated"),Cb(b,c);Da=new Float64Array(d);ya=new Float64Array(d);Na();Ra=!1;Hc()}function Fc(a){void 0===a.size&&(a.size=ua.pointSize);a.size=k.real(a.size);"Free"!==a.type?
(a.color=h.realVector(a.color||ua.pointColor),a.color=h.scalmult(k.real(ua.dimDependent),a.color)):a.color=h.realVector(a.color||ua.pointColor);void 0===a.alpha&&(a.alpha=ua.alpha);a.alpha=k.real(a.alpha);a.trace&&(a._traces=[],a._traces_tick=0,"undefined"===typeof a.tracedim&&(a.tracedim=1),"undefined"===typeof a.tracelength&&(a.tracelength=100),"undefined"===typeof a.traceskip&&(a.traceskip=1))}function Bb(a){void 0===a.size&&(a.size=ua.lineSize);a.size=k.real(a.size);a.color=h.realVector(a.color||
ua.lineColor);void 0===a.alpha&&(a.alpha=ua.alpha);a.alpha=k.real(a.alpha);a.clip=y.string(a.clip||ua.clip);void 0===a.overhang&&(a.overhang=ua.overhangLine);a.overhang=k.real(a.overhang)}function Gc(a){Bb(a);a.clip=y.string("end");void 0===a.overhang&&(a.overhang=ua.overhangSeg);a.overhang=k.real(a.overhang)}function ec(a,r){var e=t[r.args[0]].homog,b=t[r.args[1]].homog,c=a.homog,d=k.div(e.value[0],e.value[2]),h=k.div(e.value[1],e.value[2]),e=k.div(b.value[0],b.value[2]),b=k.div(b.value[1],b.value[2]),
f=k.div(c.value[0],c.value[2]),g=k.div(c.value[1],c.value[2]);return k._helper.isAlmostReal(d)&&k._helper.isAlmostReal(h)&&k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(b)&&k._helper.isAlmostReal(f)&&k._helper.isAlmostReal(g)?(d=d.value.real,h=h.value.real,e=e.value.real,b=b.value.real,f=f.value.real,g=g.value.real,c=Math.sqrt((d-e)*(d-e)+(h-b)*(h-b)),d=Math.sqrt((d-f)*(d-f)+(h-g)*(h-g)),e=Math.sqrt((e-f)*(e-f)+(b-g)*(b-g)),d=c-d-e,1E-15>d*d):!1}function Cb(a,r){a.isshowing=!0;if(a.args)for(var e=
0;e<a.args.length;e++)if(!t[a.args[e]].isshowing){a.isshowing=!1;return}r.visiblecheck&&r.visiblecheck(a)}function Hc(){for(var a=0;a<Q.length;a++)for(var r=Q[a],e=0;e<S.length;e++){var b=S[e],c=h.scaldiv(h.abs(b.homog),b.homog),d=h.scaldiv(h.abs(r.homog),r.homog);1E-13>k.abs(h.scalproduct(c,d)).value.real&&(b.incidences.push(r.name),r.incidences.push(b.name))}}function xc(){function a(a){if(a.isshowing&&!1!==a.visible&&h._helper.isAlmostReal(a.homog)){var e=a.color;a.behavior&&(e=a.color);v.draw$1([a.homog],
{size:a.size,color:e,alpha:a.alpha});if(a.labeled){var e=a.printname||a.name||"P",r=a.labelpos||{x:3,y:3},b=a.textsize||12,q=!0===a.textbold,c=!0===a.textitalics,d=a.text_fontfamily||"Sans Serif",f=r.x*r.x+r.y*r.y,g=1;0<f&&(g=1+a.size.value.real/Math.sqrt(f));v.drawtext$2([a.homog,y.wrap(e)],{x_offset:y.wrap(g*r.x),y_offset:y.wrap(g*r.y),size:y.wrap(b),bold:y.wrap(q),italics:y.wrap(c),family:y.wrap(d)})}}}function r(a){if(a.isshowing&&!1!==a.visible){var e={};e.color=a.color;e.alpha=a.alpha;e.size=
a.size;D.drawconic(a,e)}}function e(a){var e,r;if(a.isshowing&&!1!==a.visible&&h._helper.isAlmostReal(a.homog))if("none"===a.clip.value)v.draw$1([a.homog],{size:a.size,color:a.color,alpha:a.alpha});else if("end"===a.clip.value)v.draw$2([a.startpos,a.endpos],{size:a.size,color:a.color,alpha:a.alpha});else if("inci"===a.clip.value){e=[1E6,0];r=[-1E6,0];for(var b=[1E6,0],q=[-1E6,0],c=0;c<a.incidences.length;c++){var d=t[a.incidences[c]].homog,f=d.value[0],g=d.value[1],m=d.value[2];k._helper.isAlmostZero(m)||
(f=k.div(f,m),g=k.div(g,m),k._helper.isAlmostReal(f)&&k._helper.isAlmostReal(g)&&(f.value.real<e[0]&&(e=[f.value.real,d]),f.value.real>r[0]&&(r=[f.value.real,d]),g.value.real<b[0]&&(b=[g.value.real,d]),g.value.real>q[0]&&(q=[g.value.real,d])))}r[0]-e[0]>q[0]-b[0]?(e=e[1],r=r[1]):(e=b[1],r=q[1]);e!==r?v.draw$2([e,r],{size:a.size,color:a.color,alpha:a.alpha,overhang:a.overhang}):v.draw$1([a.homog],{size:a.size,color:a.color,alpha:a.alpha})}else console.error(["Bad clip: ",a.clip])}var b;for(b=0;b<ca.length;b++)r(ca[b]);
for(b=0;b<Q.length;b++)e(Q[b]);for(b=0;b<S.length;b++)a(S[b])}function Sa(a,r){var e="Assertion failed: "+r;if(!a)throw console.log(e),N(),"undefined"!==typeof alert&&alert(e),Error(e);}function Na(){Da.set(ha);fc(!1);for(var a=Da.length,r=Math.abs,e=0;e<a;e+=2)r(Da[e])>1E12*r(Da[e+1])&&(Da[e+1]=0)}function Db(){if(Ya)va=!0;else throw gc;}function hc(a,r,e,b,c){return y.add(b,y.mult(e,y.sub(c,b)))}function wc(){H&&(H.currentMouseAndScripts=[]);Eb=!0;va=!1;ha.set(Da);if(da){var a=da.mover,r=h.realVector([U.x+
da.offset.x,U.y+da.offset.y,1]);Fb(a,r,"mouse");da.prev.x=U.x;da.prev.y=U.y}A(ja.move);A(ja.draw);va||Na();Eb=!1;H&&(H.fullLog.push(h.turnIntoCSList([h.turnIntoCSList(H.currentMouseAndScripts)])),H.length>H.logLength&&H.splice(0,H.length-H.logLength),H.currentMouseAndScripts=null,H.postMouseHooks.forEach(function(a){a()}))}function Gb(a,r,e){Eb?Fb(a,r,e):(Na(),va=!1,Fb(a,r,e),Na())}function Fb(a,r,e){H&&H.currentMouseAndScripts&&(H.currentMover=[]);ya.set(ha);var b=1E4,c;c=ic[a.name];if(!c){var d=
{},f=0;c=[];d[a.name]=a;for(var g=F,m=0;m<g.length;++m){var l=g[m],n=l.args;if(n)for(var u=0;u<n.length;++u)d.hasOwnProperty(n[u])&&(d[l.name]=l,c[f++]=l)}ic[a.name]=c}var d=-1,f=.9,t,p,v,g=w[a.type],m=g.parameterPath||hc;ia=a.stateIdx;l=g.getParamFromState(a);ia=oa=a.stateIdx;n=g.getParamForInput(a,r,e);for(u=d+f;d!==u;){var x=u*u,z=.5/(1+x),z=k.complex(2*u*z+.5,(1-x)*z);Ya=d+.5*f<=d||0===b;0===b&&console.log("tracing limit Reached");x=!1;H&&H.currentMouseAndScripts&&(H.currentStep=[]);try{ia=oa=
a.stateIdx;var A=m(a,u,z,l,n);H&&(H.currentParam=A);z=ya;ya=ha;g.putParamToState(p,A);ya=z;oa=a.stateIdx;H&&(H.currentElement=a);g.updatePosition(a,!0);Sa(ia===a.stateIdx+g.stateSize,"State fully consumed");Sa(oa===a.stateIdx+g.stateSize,"State fully updated");for(t=0;t<c.length;++t)p=c[t],v=w[p.type],ia=oa=p.stateIdx,H&&(H.currentElement=p),v.updatePosition(p,!1),Sa(ia===p.stateIdx+v.stateSize,"State fully consumed"),Sa(oa===p.stateIdx+v.stateSize,"State fully updated");H&&(H.currentElement=null);
d=u;f*=1.25;u+=f;1<=u&&(u=1);ya=ha;ha=z}catch(C){if(C!==gc)throw C;f*=.5;u=d+f;--b;x=!0}H&&H.currentMouseAndScripts&&(H.currentMover.push(h.turnIntoCSList([h.turnIntoCSList(H.currentStep),y.wrap(x),y.wrap(d),y.wrap(u),y.wrap(H.currentParam)])),H.currentStep=null,H.currentParam=null)}fc(va);for(t=0;t<c.length;++t)p=c[t],v=w[p.type],Cb(p,v);H&&H.currentMouseAndScripts&&(H.currentMouseAndScripts.push(h.turnIntoCSList([h.turnIntoCSList(H.currentMover),y.wrap(va),y.wrap(a.name),r,y.wrap(e),l,n])),H.currentMover=
null)}function uc(){Na();Ya=!0;for(var a=F,r=0;r<a.length;r++){var e=a[r],b=w[e.type];ia=oa=e.stateIdx;b.updatePosition(e,!1);Cb(e,b)}a=ya;ya=ha;ha=a;Na()}function fc(a){var r=n.tracingStateReport;"string"===typeof r&&(document.getElementById(r).textContent=a?"BAD":"GOOD")}function Ic(){return h.turnIntoCSList(H.fullLog.slice())}function Jc(a){var r=JSON.stringify(H.fullLog);a=new Blob([r],{type:a?"application/octet-stream":"application/json"});return window.URL.createObjectURL(a)}function bb(){var a=
ia;ia+=2;return k.complex(ha[a],ha[a+1])}function ba(a){for(var r=Array(a),e=0;e<a;++e)r[e]=bb();return h.turnIntoCSList(r)}function Ta(a){ya[oa]=a.value.real;ya[oa+1]=a.value.imag;oa+=2}function V(a){for(var r=0,e=a.value.length;r<e;++r)Ta(a.value[r])}function Ea(a,r){var e=ba(3),b=ba(3),e=jc(a,r,e,b);V(e[0]);V(e[1]);return h.turnIntoCSList(e)}function jc(a,r,e,b){if(Ra)return[a,r];var c=h.projectiveDistMinScal(e,a),d=h.projectiveDistMinScal(e,r),f=h.projectiveDistMinScal(b,a),g=h.projectiveDistMinScal(b,
r),k=h.projectiveDistMinScal(e,b),m=h.projectiveDistMinScal(a,r),l=c+g,n=d+f,p;l>n?(p=[r,a],l=n):p=[a,r];n=function(){};if(H&&H.currentStep){var t=[H.labelTracing2,y.wrap(H.currentElement.name),h.turnIntoCSList(p),h.turnIntoCSList([e,b]),h.realMatrix([[c,d],[f,g]]),y.wrap(l),y.wrap(k),y.wrap(m),u];H.currentStep.push(h.turnIntoCSList(t));n=function(a){H.hasOwnProperty(a)||(H[a]=y.wrap(a));t[t.length-1]=H[a]}}h._helper.isNaN(a)||h._helper.isNaN(r)?(n("Tracing failed due to NaNs."),va=!0):k>3*l&&m>3*
l?n("Normal case, everything all right."):1E-5>m?1E-5>k?n("Staying inside singularity."):(n("Moved into singularity."),va=!0):1E-5>k?n("Moved out of singularity."):(Ya?n("Reached refinement limit, giving up."):n("Need to refine."),Db());return p}function Hb(a,r,e,b){var c=ba(3),d=ba(3),f=ba(3),g=ba(3);a=Kc(a,r,e,b,c,d,f,g);V(a[0]);V(a[1]);V(a[2]);V(a[3]);return h.turnIntoCSList(a)}function Kc(a,r,e,b,c,d,f,g){var k=function(){};c=[c,d,f,g];a=[a,r,e,b];if(Ra)return a;d=0;b=Array(4);for(e=0;4>e;e++)for(b[e]=
Array(4),g=0;4>g;g++)f=h.projectiveDistMinScal(c[e],a[g]),b[e][g]=f;f=qb(b);r=Array(4);for(e=0;4>e;++e)r[e]=a[f[e]],d+=b[e][f[e]];var m=1*d,l=Infinity,n=Infinity;for(e=0;4>e;e++){if(h._helper.isNaN(a[e]))return k("Tracing failed due to NaNs."),va=!0,r;for(g=e+1;4>g;g++)f=h.projectiveDistMinScal(c[e],c[g]),l>f&&(l=f),f=h.projectiveDistMinScal(r[e],r[g]),n>f&&(n=f)}if(H&&H.currentStep){var p=[H.labelTracing4,y.wrap(H.currentElement.name),h.turnIntoCSList(r),h.turnIntoCSList(c),h.realMatrix(b),y.wrap(d),
y.wrap(l),y.wrap(n),u];H.currentStep.push(h.turnIntoCSList(p));k=function(a){H.hasOwnProperty(a)||(H[a]=y.wrap(a));p[p.length-1]=H[a]}}l>m&&n>m||(1E-5>n?1E-5>l?k("Staying inside singularity."):(k("Moved into singularity."),va=!0):1E-5>l?k("Moved out of singularity."):(Ya?k("Reached refinement limit, giving up."):k("Need to refine."),Db()));return r}function kc(a){var r=a.length,e,b;if(Ra){for(e=0;e<r;++e)ia+=2*a[e].value.length,V(a[e]);return a}var c=Array(r),d=Array(r),f=Array(r),g=99,k=99,m=Array(r);
for(e=0;e<r;++e)c[e]=ba(a[e].value.length),d[e]=h.normSquared(c[e]).value.real,f[e]=h.normSquared(a[e]).value.real,m[e]=Array(r);var l;for(e=0;e<r;++e){for(b=0;b<r;++b)l=h.sesquilinearproduct(c[e],a[b]).value,l=(l.real*l.real+l.imag*l.imag)/(d[e]*f[b]),m[e][b]=1-l;for(b=e+1;b<r;++b)l=h.sesquilinearproduct(c[e],c[b]).value,l=(l.real*l.real+l.imag*l.imag)/(d[e]*d[b]),g>1-l&&(g=1-l),l=h.sesquilinearproduct(a[e],a[b]).value,l=(l.real*l.real+l.imag*l.imag)/(f[e]*f[b]),k>1-l&&(k=1-l)}l=qb(m);b=Array(r);
d=0;f=!1;for(e=0;e<r;++e){var d=d+m[e][l[e]],n=b[e]=a[l[e]];V(n);f|=h._helper.isNaN(n)}f|=isNaN(d);a=function(){};if(H&&H.currentStep){var p=[H.labelTracingSesq,y.wrap(H.currentElement.name),h.turnIntoCSList(b),h.turnIntoCSList(c),h.realMatrix(m),y.wrap(d),y.wrap(g),y.wrap(k),u];H.currentStep.push(h.turnIntoCSList(p));a=function(a){H.hasOwnProperty(a)||(H[a]=y.wrap(a));p[p.length-1]=H[a]}}f?(a("Tracing failed due to NaNs."),va=!0):g>3*d&&k>3*d?a("Normal case, everything all right."):1E-5>k?1E-5>g?
a("Staying inside singularity."):(a("Moved into singularity."),va=!0):1E-5>g?a("Moved out of singularity."):(Ya?a("Reached refinement limit, giving up."):a("Need to refine."),Db());return b}function vc(a){na.forEach(function(a){I[a.behavior.type].init(a.behavior,t[a.name])})}function tb(a){ub=0!==a.length;na=a;W=[];na.forEach(function(a){if(a.name){var e=a.name;t[e]&&(t[e].behavior=a.behavior,I[a.behavior.type].init(a.behavior,t[e]),"Mass"===a.behavior.type&&W.push(t[e]))}else I[a.behavior.type].init(a.behavior)})}
var Ca=this,la,ja={},Ma=!1,hb=!0,ib=!1,eb=1,La=0,Sb,Tb=!1,$a,C,ga,Y,ea,Qa=null,sc="           #drawgrid(s):=(              regional(b,xmin,xmax,ymin,ymax,nx,ny);              b=screenbounds();              xmin=b_4_1-s;              xmax=b_2_1+s;              ymin=b_4_2-s;              ymax=b_2_2+s;              nx=round((xmax-xmin)/s);              ny=round((ymax-ymin)/s);              xmin=floor(xmin/s)*s;              ymin=floor(ymin/s)*s;              repeat(nx,x,                 draw((xmin+x*s,ymin),(xmin+x*s,ymax),color->(1,1,1)*.9,size->1);              );              repeat(ny,y,                 draw((xmin,ymin+y*s),(xmax,ymin+y*s),color->(1,1,1)*.9,size->1);              )            );",
Xa=[],vb=!1,Aa={config:n,startup:ra,shutdown:N,evokeCS:function(a){a=ab(a);a=ma(a,!1);console.log(a);A(a);xa()},play:f,pause:za,stop:T,evalcs:function(a){return A(ma(ab(a),!1))},niceprint:E,canvas:null},rb=!1,fb=0;n.use&&n.use.forEach(function(a){var r=null;n.plugins&&(r=n.plugins[a]);r||(r=Ca._pluginRegistry[a]);r||(++fb,console.log("Loading script for plugin "+a),Ca.loadScript(a+"-plugin",a+"-plugin.js",function(){console.log("Successfully loaded plugin "+a);0===--fb&&rb&&ra()},function(){console.error("Failed to auto-load plugin "+
a);0===--fb&&rb&&ra()}))});Va.prototype=new Ia;Ja.prototype=new Ia;Ka.prototype=new Ia;var U={},da,Ub="",Vb=0,Lc=[].slice,Ib,lc=function(a){return Lc.call(a)};if(!n.isNode){var Mc=document.documentElement;Ib=window;try{lc(Mc.childNodes)[0].nodeType}catch(Nc){lc=function(a){for(var r=a.length,e=Array(r);r--;)e[r]=a[r];return e}}}var Wb="webkit ms moz Moz o O".split(" "),wb={},lb,mb,kb,jb,Oa,Xb=!n.isNode&&Ib[b(Ib,"requestAnimationFrame")]||function(a){setTimeout(a,17)};wb.timer=function(a,r,e){var b=
arguments.length;2>b&&(r=0);3>b&&(e=Date.now());b={c:a,t:e+r,f:!1,n:null};mb?mb.n=b:lb=b;mb=b;kb||(jb=clearTimeout(jb),kb=1,Xb(c))};wb.timer.flush=function(){d();g()};var u=new m,Jb=new m,J=new function(){this.vars={pi:{ctype:"variable",stack:[{ctype:"number",value:{real:Math.PI,imag:0}}],name:"pi"},i:{ctype:"variable",stack:[{ctype:"number",value:{real:0,imag:1}}],name:"i"},"true":{ctype:"variable",stack:[{ctype:"boolean",value:!0}],name:"true"},"false":{ctype:"variable",stack:[{ctype:"boolean",
value:!1}],name:"false"},"#":{ctype:"variable",stack:[u],name:"#"}};this.isVariable=function(a){return void 0!==this.vars[a]};this.isVariableName=function(a){if("#"===a||"#1"===a||"#2"===a)return!0;var r=/^[a-z,A-Z]+$/.test(a[0]);a=/^[0-9,a-z,A-Z]+$/.test(a);return r&&a};this.create=function(a){var r={ctype:"variable",stack:[Jb],name:a};return this.vars[a]=r};this.newvar=function(a){a=this.vars[a];a.stack.push(u);return a};this.removevar=function(a){var r=this.vars[a].stack;0===r.length&&console.error("Removing non-existing "+
a);r.pop();0===r.length&&console.warn("Removing last "+a)};this.setvar=function(a,r){var e=this.vars[a].stack;0===e.length&&console.error("Setting non-existing variable "+a);void 0===r&&(console.error("Setting variable "+a+" to undefined value"),r=u);if("undefined"===r.ctype)e[e.length-1]=r;else{var b=r;b===Jb&&(b=u);e[e.length-1]=b}};this.undefinedWarning={};this.getvar=function(a){var r=this.vars[a].stack;0===r.length&&console.error("Getting non-existing variable "+a);r=r[r.length-1];if(r===Jb){if(void 0!==
t[a])return{ctype:"geo",value:t[a]};console&&console.log&&void 0===this.undefinedWarning[a]&&(this.undefinedWarning[a]=!0,console.log("Warning: Accessing undefined variable: "+a));return u}return r};this.dump=function(a){var r=this.vars[a].stack;console.log("*** Dump "+a);for(a=0;a<r.length;a++)console.log(a+":> "+E(r[a]))};this.vstack=[];this.pushVstack=function(a){this.vstack.push(a)};this.popVstack=function(){this.vstack.pop()};this.cleanVstack=function(){for(var a=this.vstack;0<a.length&&"*"!==
a[a.length-1];)this.removevar(a[a.length-1]),a.pop();0<a.length&&a.pop()}},sa={generalFields:{color:"color",colorhsb:"",size:"size",alpha:"alpha",isshowing:"isshowing",visible:"visible",name:"name",caption:"caption",trace:"trace",tracelength:"",selected:""},getGeoField:function(a,r){return"undefined"!==typeof t[a]?sa.getField(t[a],r):u},setGeoField:function(a,r,e){return"undefined"!==typeof t[a]?sa.setField(t[a],r,e):u},getField:function(a,r){var e;if("P"===a.kind){if("xy"===r){e=k.div(a.homog.value[0],
a.homog.value[2]);var b=k.div(a.homog.value[1],a.homog.value[2]);e=h.turnIntoCSList([e,b]);return y.withUsage(e,"Point")}if("homog"===r)return y.withUsage(a.homog,"Point");if("x"===r)return k.div(a.homog.value[0],a.homog.value[2]);if("y"===r)return k.div(a.homog.value[1],a.homog.value[2])}if("L"===a.kind){if("homog"===r)return y.withUsage(a.homog,"Line");if("angle"===r)return e=h.eucangle(h.ey,a.homog),y.withUsage(e,"Angle")}if("Tr"===a.kind&&"matrix"===r)return a.matrix;if("C"===a.kind&&"radius"===
r){var c=a.matrix;e=c.value[0].value[0];var d=c.value[0].value[2],b=c.value[1].value[2],c=c.value[2].value[2];k.mult(e,e);d=k.div(d,e);b=k.div(b,e);e=k.div(c,e);return e=k.sqrt(k.sub(k.add(k.mult(d,d),k.mult(b,b)),e))}if(sa.generalFields[r])return(e=a[sa.generalFields[r]])?e:u;if(a.behavior){if("mass"===r&&"Mass"===a.behavior.type)return k.real(a.behavior.mass);if("radius"===r&&"Mass"===a.behavior.type)return k.real(a.behavior.radius);if("charge"===r&&"Mass"===a.behavior.type)return k.real(a.behavior.charge);
if("friction"===r&&"Mass"===a.behavior.type)return k.real(a.behavior.friction);if("vx"===r&&"Mass"===a.behavior.type)return k.real(a.behavior.vx);if("vy"===r&&"Mass"===a.behavior.type)return k.real(a.behavior.vy);if("v"===r&&"Mass"===a.behavior.type)return h.realVector([a.behavior.vx,a.behavior.vy]);if("fx"===r&&"Mass"===a.behavior.type)return k.real(a.behavior.fx);if("fy"===r&&"Mass"===a.behavior.type)return k.real(a.behavior.fy);if("f"===r&&"Mass"===a.behavior.type)return h.realVector([a.behavior.fx,
a.behavior.fy])}return u},setField:function(a,r,e){"color"===r&&(a.color=e);"size"===r&&(a.size=e);"alpha"===r&&(a.alpha=e);"visible"===r&&"boolean"===e.ctype&&(a.visible=e.value);"pinned"===r&&"boolean"===e.ctype&&(a.pinned=e.value);"printlabel"===r&&(a.printname=E(e));"xy"===r&&"P"===a.kind&&a.movable&&h._helper.isNumberVecN(e,2)&&Gb(a,h.turnIntoCSList([e.value[0],e.value[1],k.real(1)]),"homog");"homog"===r&&"P"===a.kind&&a.movable&&h._helper.isNumberVecN(e,3)&&Gb(a,e,"homog");if("angle"===r&&"Through"===
a.type){var b=k.cos(e),c=k.sin(e),b=h.turnIntoCSList([b,c,k.real(0)]);Gb(a,b,"dir")}a.behavior&&("mass"===r&&"Mass"===a.behavior.type&&"number"===e.ctype&&(a.behavior.mass=e.value.real),"mass"===r&&"Sun"===a.behavior.type&&"number"===e.ctype&&(a.behavior.mass=e.value.real),"friction"===r&&"Mass"===a.behavior.type&&"number"===e.ctype&&(a.behavior.friction=e.value.real),"charge"===r&&"Mass"===a.behavior.type&&"number"===e.ctype&&(a.behavior.charge=e.value.real),"radius"===r&&"Mass"===a.behavior.type&&
"number"===e.ctype&&(a.behavior.radius=e.value.real),"vx"===r&&"Mass"===a.behavior.type&&"number"===e.ctype&&(a.behavior.vx=e.value.real),"vy"===r&&"Mass"===a.behavior.type&&"number"===e.ctype&&(a.behavior.vy=e.value.real),"v"===r&&"Mass"===a.behavior.type&&h._helper.isNumberVecN(e,2)&&(a.behavior.vx=e.value[0].value.real,a.behavior.vy=e.value[1].value.real))}},k={_helper:{}};k._helper.roundingfactor=1E4;k._helper.niceround=function(a){return Math.round(a*k._helper.roundingfactor)/k._helper.roundingfactor};
k.niceprint=function(a){var r=k._helper.niceround(a.value.real);a=k._helper.niceround(a.value.imag);return 0===a?""+r:0<a?""+r+" + i*"+a:""+r+" - i*"+-a};k.complex=function(a,r){return{ctype:"number",value:{real:a,imag:r}}};k.real=function(a){return{ctype:"number",value:{real:a,imag:0}}};k.zero=k.real(0);k.one=k.real(1);k.argmax=function(a,r){return a.value.real*a.value.real+a.value.imag*a.value.imag<r.value.real*r.value.real+r.value.imag*r.value.imag?r:a};k.max=function(a,r){return{ctype:"number",
value:{real:Math.max(a.value.real,r.value.real),imag:Math.max(a.value.imag,r.value.imag)}}};k.min=function(a,r){return{ctype:"number",value:{real:Math.min(a.value.real,r.value.real),imag:Math.min(a.value.imag,r.value.imag)}}};k.add=function(a,r){return{ctype:"number",value:{real:a.value.real+r.value.real,imag:a.value.imag+r.value.imag}}};k.sub=function(a,r){return{ctype:"number",value:{real:a.value.real-r.value.real,imag:a.value.imag-r.value.imag}}};k.neg=function(a){return{ctype:"number",value:{real:-a.value.real,
imag:-a.value.imag}}};k.re=function(a){return{ctype:"number",value:{real:a.value.real,imag:0}}};k.im=function(a){return{ctype:"number",value:{real:a.value.imag,imag:0}}};k.conjugate=function(a){return{ctype:"number",value:{real:a.value.real,imag:-a.value.imag}}};k.round=function(a){return{ctype:"number",value:{real:Math.round(a.value.real),imag:Math.round(a.value.imag)}}};k.ceil=function(a){return{ctype:"number",value:{real:Math.ceil(a.value.real),imag:Math.ceil(a.value.imag)}}};k.floor=function(a){return{ctype:"number",
value:{real:Math.floor(a.value.real),imag:Math.floor(a.value.imag)}}};k.mult=function(a,r){return{ctype:"number",value:{real:a.value.real*r.value.real-a.value.imag*r.value.imag,imag:a.value.real*r.value.imag+a.value.imag*r.value.real}}};k.realmult=function(a,r){return{ctype:"number",value:{real:a*r.value.real,imag:a*r.value.imag}}};k.multiMult=function(a){var r=a[0];if("number"!==r.ctype)return u;for(var e=1;e<a.length;e++){if("number"!==a[e].ctype)return u;r=k.mult(r,a[e])}return r};k.abs2=function(a,
r){return{ctype:"number",value:{real:a.value.real*a.value.real+a.value.imag*a.value.imag,imag:0}}};k.abs=function(a){return k.sqrt(k.abs2(a))};k.inv=function(a){var r=a.value.real*a.value.real+a.value.imag*a.value.imag;0===r&&console.error("DIVISION BY ZERO");return{ctype:"number",value:{real:a.value.real/r,imag:-a.value.imag/r}}};k.div=function(a,r){return k.mult(a,k.inv(r))};k.eps=1E-7;k.snap=function(a){var r=a.value.real;a=a.value.imag;Math.floor(r+k.eps)!==Math.floor(r-k.eps)&&(r=Math.round(r));
Math.floor(a+k.eps)!==Math.floor(a-k.eps)&&(a=Math.round(a));return{ctype:"number",value:{real:r,imag:a}}};k.exp=function(a){var r=Math.exp(a.value.real),e=r*Math.cos(a.value.imag);a=r*Math.sin(a.value.imag);return{ctype:"number",value:{real:e,imag:a}}};k.cos=function(a){var r=a.value.real,e=a.value.imag,b=Math.exp(e);a=b*Math.sin(-r);var c=b*Math.cos(-r),b=Math.exp(-e),e=b*Math.sin(r),r=b*Math.cos(r);return{ctype:"number",value:{real:(c+r)/2,imag:(a+e)/2}}};k.sin=function(a){var r=a.value.real,e=
a.value.imag,b=Math.exp(e);a=b*Math.sin(-r);var c=b*Math.cos(-r),b=Math.exp(-e),e=b*Math.sin(r),r=b*Math.cos(r);return{ctype:"number",value:{real:-(a-e)/2,imag:(c-r)/2}}};k.tan=function(a){var r=k.sin(a);a=k.cos(a);return k.div(r,a)};k.arccos=function(a){var r=k.mult(a,k.neg(a)),r=k.sqrt(k.add(k.real(1),r));a=k.add(k.mult(a,k.complex(0,1)),r);a=k.add(k.mult(k.log(a),k.complex(0,1)),k.real(.5*Math.PI));return y.withUsage(a,"Angle")};k.arcsin=function(a){var r=k.mult(a,k.neg(a)),r=k.sqrt(k.add(k.real(1),
r));a=k.add(k.mult(a,k.complex(0,1)),r);a=k.mult(k.log(a),k.complex(0,-1));return y.withUsage(a,"Angle")};k.arctan=function(a){var r=k.log(k.add(k.mult(a,k.complex(0,-1)),k.real(1)));a=k.log(k.add(k.mult(a,k.complex(0,1)),k.real(1)));r=k.mult(k.sub(r,a),k.complex(0,.5));return y.withUsage(r,"Angle")};k.arctan2=function(a,r){var e=k.real(Math.atan2(r.value.real,a.value.real));return y.withUsage(e,"Angle")};k.sqrt=function(a){var r=a.value.real,e=a.value.imag;a=Math.sqrt(Math.sqrt(r*r+e*e));r=Math.atan2(e,
r);e=a*Math.sin(r/2);return{ctype:"number",value:{real:a*Math.cos(r/2),imag:e}}};k.pow2=function(a,r){var e=a.value.real,b=a.value.imag,c=Math.pow(Math.sqrt(e*e+b*b),r),e=Math.atan2(b,e),b=c*Math.sin(e*r);return{ctype:"number",value:{real:c*Math.cos(e*r),imag:b}}};k.log=function(a){var b=a.value.real,e=a.value.imag,q=Math.sqrt(b*b+e*e);a=Math.atan2(e,b);0>e&&(a+=2*Math.PI);0===e&&0>b&&(a=Math.PI);a>Math.PI&&(a-=2*Math.PI);b=Math.log(q);return k.snap({ctype:"number",value:{real:b,imag:a}})};k.pow=
function(a,b){if(b.value.real===Math.round(b.value.real)&&0===b.value.imag){for(var e={ctype:"number",value:{real:1,imag:0}},q=0;q<Math.abs(b.value.real);q++)e=k.mult(e,a);return 0>b.value.real?k.inv(e):e}return k.exp(k.mult(k.log(a),b))};k.mod=function(a,b){var e=a.value.real,q=b.value.real,c=a.value.imag,d=b.value.imag,e=e-Math.floor(e/q)*q,c=c-Math.floor(c/d)*d;0===q&&(e=0);0===d&&(c=0);return k.snap({ctype:"number",value:{real:e,imag:c}})};k._helper.seed="NO";k.eps=1E-10;k.epsbig=1E-6;k._helper.seedrandom=
function(a){a-=Math.floor(a);k._helper.seed=.8*a+.1};k._helper.rand=function(){if("NO"===k._helper.seed)return Math.random();var a=k._helper.seed,a=1E3*Math.sin(1E3*a),a=a-Math.floor(a);return k._helper.seed=a};k._helper.randnormal=function(){var a=k._helper.rand(),b=k._helper.rand();return Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*b)};k._helper.isEqual=function(a,b){return a.value.real===b.value.real&&a.value.imag===b.value.imag};k._helper.isLessThan=function(a,b){return a.value.real<b.value.real||
a.value.real===b.value.real&&a.value.imag<b.value.imag};k._helper.compare=function(a,b){return k._helper.isLessThan(a,b)?-1:k._helper.isEqual(a,b)?0:1};k._helper.isAlmostEqual=function(a,b,e){var q=k.eps;"undefined"!==typeof e&&(q=e);e=a.value.real-b.value.real;a=a.value.imag-b.value.imag;return e<q&&e>-q&&a<q&&a>-q};k._helper.isZero=function(a){return 0===a.value.real&&0===a.value.imag};k._helper.isAlmostZero=function(a){var b=a.value.real;a=a.value.imag;return b<k.eps&&b>-k.eps&&a<k.eps&&a>-k.eps};
k._helper.isReal=function(a){return 0===a.value.imag};k._helper.isAlmostReal=function(a){a=a.value.imag;return a<k.epsbig&&a>-k.epsbig};k._helper.isNaN=function(a){return isNaN(a.value.real)||isNaN(a.value.imag)};k._helper.isAlmostImag=function(a){a=a.value.real;return a<k.epsbig&&a>-k.epsbig};k._helper.z3a=k.complex(-.5,.5*Math.sqrt(3));k._helper.z3b=k.complex(-.5,-.5*Math.sqrt(3));k._helper.cub1={ctype:"list",value:[k.one,k.one,k.one]};k._helper.cub2={ctype:"list",value:[k._helper.z3a,k.one,k._helper.z3b]};
k._helper.cub3={ctype:"list",value:[k._helper.z3b,k.one,k._helper.z3a]};k.solveCubic=function(a,b,e,q){a=k._helper.solveCubicHelper(a,b,e,q);return[h.scalproduct(k._helper.cub1,a),h.scalproduct(k._helper.cub2,a),h.scalproduct(k._helper.cub3,a)]};k._helper.solveCubicHelper=function(a,b,e,q){var c=a.value.real;a=a.value.imag;var d=b.value.real;b=b.value.imag;var f=e.value.real,g=e.value.imag,l=q.value.real,m=q.value.imag;e=c*f-a*g;q=c*g+a*f;var n=4*e-(d*d-b*b),u=4*q-2*d*b,p=c*d-a*b,t=c*b+a*d,v=n*f-
u*g-18*(p*l-t*m),u=n*g+u*f-18*(p*m+t*l),w=27*(c*c-a*a),x=54*a*c,n=w*l-x*m,y=w*m+x*l,z=d*d-b*b,w=2*d*b,A=z*d-w*b,C=z*b+w*d,x=n+4*A,B=y+4*C,A=-2*A+9*(p*f-t*g),C=-2*C+9*(p*g+t*f),A=A-n,C=C-y,n=27*(v*f-u*g+x*l-B*m),u=27*(v*g+u*f+x*m+B*l),x=Math.sqrt(Math.sqrt(n*n+u*u)),B=Math.atan2(u,n),u=x*Math.sin(B/2),n=x*Math.cos(B/2),A=A+(n*c-u*a),C=C+(n*a+u*c),f=Math.exp(Math.log(Math.sqrt(A*A+C*C))/3),u=Math.atan2(C,A),x=f*Math.sin(u/3),B=f*Math.cos(u/3),f=f*f,u=2*u,n=f*Math.sin(u/3),f=f*Math.cos(u/3);e=2*z-6*
e;q=2*w-6*q;w=-1.5874010519681996*(d*B-b*x);d=-1.5874010519681996*(d*x+b*B);b=1.2599210498948732*f;z=1.2599210498948732*n;n=4.762203155904599*(B*c-x*a);u=4.762203155904599*(B*a+x*c);c=n*n+u*u;x=(e*n+q*u)/c;B=(-e*u+q*n)/c;e=x;q=B;x=(w*n+d*u)/c;B=(-w*u+d*n)/c;w=x;d=B;x=(b*n+z*u)/c;B=(-b*u+z*n)/c;b=x;z=B;return h.turnIntoCSList([k.complex(e,q),k.complex(w,d),k.complex(b,z)])};var h={_helper:{},turnIntoCSList:function(a){return{ctype:"list",value:a}},realVector:function(a){for(var b=[],e=0;e<a.length;e++)b[e]=
{ctype:"number",value:{real:a[e],imag:0}};return{ctype:"list",value:b}}};h._helper.unitvector=function(a,b){var e=h.zerovector(a);e.value[Math.floor(b.value.real-1)]=k.real(1);return e};h.idMatrix=function(a){for(var b=h.zeromatrix(a,a),e=k.real(1),q=0;q<a.value.real;q++)b.value[q].value[q]=e;return b};h._helper.flippedidMatrix=function(a){for(var b=h.zeromatrix(a,a),e=k.real(1),q=0;q<a.value.real;q++)b.value[q].value[a.value.real-q-1]=e;return b};h.println=function(a){for(var b=[],e=0;e<a.value.length;e++)if("number"===
a.value[e].ctype)b[e]=k.niceprint(a.value[e]);else if("list"===a.value[e].ctype)h.println(a.value[e]);else return u;"number"===a.value[0].ctype&&console.log(b)};h.realMatrix=function(a){for(var b=a.length,e=Array(b),q=0;q<b;q++)e[q]=h.realVector(a[q]);return h.turnIntoCSList(e)};h.ex=h.realVector([1,0,0]);h.ey=h.realVector([0,1,0]);h.ez=h.realVector([0,0,1]);h.linfty=h.realVector([0,0,1]);h.ii=h.turnIntoCSList([k.complex(1,0),k.complex(0,1),k.complex(0,0)]);h.jj=h.turnIntoCSList([k.complex(1,0),k.complex(0,
-1),k.complex(0,0)]);h.fundDual=h.realMatrix([[1,0,0],[0,1,0],[0,0,0]]);h.fund=h.realMatrix([[0,0,0],[0,0,0],[0,0,1]]);h.sequence=function(a,b){for(var e=[],q=0,c=Math.round(a.value.real);c<Math.round(b.value.real)+1;c++)e[q]={ctype:"number",value:{real:c,imag:0}},q++;return{ctype:"list",value:e}};h.pairs=function(a){for(var b=[],e=0;e<a.value.length-1;e++)for(var q=e+1;q<a.value.length;q++)b.push({ctype:"list",value:[a.value[e],a.value[q]]});return{ctype:"list",value:b}};h.triples=function(a){for(var b=
[],e=0;e<a.value.length-2;e++)for(var q=e+1;q<a.value.length-1;q++)for(var c=q+1;c<a.value.length;c++)b.push({ctype:"list",value:[a.value[e],a.value[q],a.value[c]]});return{ctype:"list",value:b}};h.triples=function(a){for(var b=[],e=0;e<a.value.length-2;e++)for(var q=e+1;q<a.value.length-1;q++)for(var c=q+1;c<a.value.length;c++)b.push({ctype:"list",value:[a.value[e],a.value[q],a.value[c]]});return{ctype:"list",value:b}};h.cycle=function(a){for(var b=[],e=0;e<a.value.length-1;e++)b[e]={ctype:"list",
value:[a.value[e],a.value[e+1]]};b.push({ctype:"list",value:[a.value[a.value.length-1],a.value[0]]});return{ctype:"list",value:b}};h.consecutive=function(a){for(var b=[],e=0;e<a.value.length-1;e++)b[e]={ctype:"list",value:[a.value[e],a.value[e+1]]};return{ctype:"list",value:b}};h.reverse=function(a){for(var b=[],e=a.value.length-1;0<=e;e--)b.push(a.value[e]);return{ctype:"list",value:b}};h.directproduct=function(a,b){for(var e=[],q=0;q<a.value.length;q++)for(var c=0;c<b.value.length;c++)e.push({ctype:"list",
value:[a.value[q],b.value[c]]});return{ctype:"list",value:e}};h.concat=function(a,b){for(var e=[],q=0;q<a.value.length;q++)e.push(a.value[q]);for(q=0;q<b.value.length;q++)e.push(b.value[q]);return{ctype:"list",value:e}};h.prepend=function(a,b){var e=[];e[0]=a;for(var q=0;q<b.value.length;q++)e[q+1]=b.value[q];return{ctype:"list",value:e}};h.append=function(a,b){for(var e=[],q=0;q<a.value.length;q++)e[q]=a.value[q];e.push(b);return{ctype:"list",value:e}};h.contains=function(a,b){for(var e=0;e<a.value.length;e++)if(D.equals(a.value[e],
b).value)return{ctype:"boolean",value:!0};return{ctype:"boolean",value:!1}};h.common=function(a,b){for(var e=[],q=0,c=0;c<a.value.length;c++){for(var d=!1,h=a.value[c],f=0;f<b.value.length;f++)d=d||D.equals(h,b.value[f]).value;d&&(e[q]=a.value[c],q++)}return{ctype:"list",value:e}};h.remove=function(a,b){for(var e=[],q=0,c=0;c<a.value.length;c++){for(var d=!1,h=a.value[c],f=0;f<b.value.length;f++)d=d||D.equals(h,b.value[f]).value;d||(e[q]=a.value[c],q++)}return{ctype:"list",value:e}};h._helper.compare=
function(a,b){return"number"===a.ctype&&"number"===b.ctype?a.value.real-b.value.real:-1};h.sort1=function(a){a=a.value.slice();a.sort(y.compare);return h.turnIntoCSList(a)};h._helper.isEqual=function(a,b){return h.equals(a,b).value};h._helper.isLessThan=function(a,b){for(var e=a.value.length,q=b.value.length,c=0;!(c>=e||c>=q)&&y.isEqual(a.value[c],b.value[c]);)c++;return c===e&&c<q?!0:c===q&&c<e||c===e&&c===q?!1:y.isLessThan(a.value[c],b.value[c])};h._helper.compare=function(a,b){return h._helper.isLessThan(a,
b)?-1:h._helper.isEqual(a,b)?0:1};h.equals=function(a,b){if(a.value.length!==b.value.length)return{ctype:"boolean",value:!1};for(var e=!0,q=0;q<a.value.length;q++)var c=a.value[q],d=b.value[q],e="list"===c.ctype&&"list"===d.ctype?e&&h.equals(c,d).value:e&&M([c,d],[]).value;return{ctype:"boolean",value:e}};h.almostequals=function(a,b){if(a.value.length!==b.value.length)return{ctype:"boolean",value:!1};for(var e=!0,q=0;q<a.value.length;q++)var c=a.value[q],d=b.value[q],e="list"===c.ctype&&"list"===
d.ctype?e&&h.comp_almostequals(c,d).value:e&&Z([c,d],[]).value;return{ctype:"boolean",value:e}};h._helper.isAlmostReal=function(a){for(var b=!0,e=0;e<a.value.length;e++)var q=a.value[e],b="list"===q.ctype?b&&h._helper.isAlmostReal(q):b&&k._helper.isAlmostReal(q);return b};h._helper.isAlmostZero=function(a){for(var b=0;b<a.value.length;b++){var e=a.value[b];if("list"===e.ctype){if(!h._helper.isAlmostZero(e))return!1}else if(!k._helper.isAlmostZero(e))return!1}return!0};h._helper.isNaN=function(a){for(var b=
!1,e=0;e<a.value.length;e++)var q=a.value[e],b="list"===q.ctype?b||h._helper.isNaN(q):b||k._helper.isNaN(q);return b};h.set=function(a){var b=[],e=0;a=a.value.slice();a.sort(y.compare);for(var q=0;q<a.length;q++)0!==q&&M([b[b.length-1],a[q]],[]).value||(b[e]=a[q],e++);return{ctype:"list",value:b}};h.maxval=function(a){for(var b=k.zero,e=0;e<a.value.length;e++){var q=a.value[e];"number"===q.ctype&&(b=k.argmax(b,q));"list"===q.ctype&&(b=k.argmax(b,h.maxval(q)))}return b};h.maxIndex=function(a,b,e){var q=
0;void 0!==e&&(q=e);e=q;for(var c=b(a.value[q]).value.real;q<a.value.length;++q){var d=b(a.value[q]).value.real;d>c&&(e=q,c=d)}return e};h.normalizeMax=function(a){var b=k.inv(h.maxval(a));return h.scalmult(b,a)};h.normalizeZ=function(a){var b=k.inv(a.value[2]);return h.scalmult(b,a)};h.normalizeAbs=function(a){var b=k.inv(h.abs(a));return h.scalmult(b,a)};h.max=function(a,b){if(a.value.length!==b.value.length)return u;for(var e=[],q=0;q<a.value.length;q++)e[q]=y.max(a.value[q],b.value[q]);return{ctype:"list",
value:e}};h.min=function(a,b){if(a.value.length!==b.value.length)return u;for(var e=[],q=0;q<a.value.length;q++)e[q]=y.min(a.value[q],b.value[q]);return{ctype:"list",value:e}};h.scaldiv=function(a,b){if("number"!==a.ctype)return u;for(var e=[],q=0;q<b.value.length;q++){var c=b.value[q];e[q]="number"===c.ctype?y.div(c,a):"list"===c.ctype?h.scaldiv(a,c):u}return{ctype:"list",value:e}};h.scalmult=function(a,b){if("number"!==a.ctype)return u;for(var e=[],q=0;q<b.value.length;q++){var c=b.value[q];e[q]=
"number"===c.ctype?y.mult(c,a):"list"===c.ctype?h.scalmult(a,c):u}return{ctype:"list",value:e}};h.add=function(a,b){if(a.value.length!==b.value.length)return u;for(var e=[],q=0;q<a.value.length;q++){var c=a.value[q],d=b.value[q];e[q]="number"===c.ctype&&"number"===d.ctype?y.add(c,d):"list"===c.ctype&&"list"===d.ctype?h.add(c,d):u}return{ctype:"list",value:e}};h.sub=function(a,b){if(a.value.length!==b.value.length)return u;for(var e=[],q=0;q<a.value.length;q++){var c=a.value[q],d=b.value[q];e[q]="number"===
c.ctype&&"number"===d.ctype?k.sub(c,d):"list"===c.ctype&&"list"===d.ctype?h.sub(c,d):u}return{ctype:"list",value:e}};h.abs2=function(a){for(var b=0,e=0;e<a.value.length;e++){var q=a.value[e];if("number"===q.ctype)b+=k.abs2(q).value.real;else if("list"===q.ctype)b+=h.abs2(q).value.real;else return u}return{ctype:"number",value:{real:b,imag:0}}};h.abs=function(a){return k.sqrt(h.abs2(a))};h.normalizeMaxXX=function(a){for(var b=-1E4,e=k.real(1),q=0;q<a.value.length;q++){var c=k.abs(a.value[q]);c.value.real>
b&&(e=a.value[q],b=c.value.real)}return h.scaldiv(e,a)};h.recursive=function(a,b){for(var e=[],q=0;q<a.value.length;q++){var c=B(a.value[q]);e[q]="number"===c.ctype?k[b](c):"list"===c.ctype?h[b](c):u}return{ctype:"list",value:e}};h.re=function(a){return h.recursive(a,"re")};h.neg=function(a){return h.recursive(a,"neg")};h.im=function(a){return h.recursive(a,"im")};h.conjugate=function(a){return h.recursive(a,"conjugate")};h.transjugate=function(a){return h.transpose(h.conjugate(a))};h.round=function(a){return h.recursive(a,
"round")};h.ceil=function(a){return h.recursive(a,"ceil")};h.floor=function(a){return h.recursive(a,"floor")};h._helper.colNumb=function(a){if("list"!==a.ctype)return-1;for(var b=-1,e=0;e<a.value.length;e++){if("list"!==a.value[e].ctype)return-1;if(0===e)b=a.value[e].value.length;else if(b!==a.value[e].value.length)return-1}return b};h._helper.isNumberVecN=function(a,b){if("list"!==a.ctype||a.value.length!==b)return!1;for(var e=0;e<a.value.length;e++)if("number"!==a.value[e].ctype)return!1;return!0};
h.isNumberVector=function(a){if("list"!==a.ctype)return{ctype:"boolean",value:!1};for(var b=0;b<a.value.length;b++)if("number"!==a.value[b].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};h.isNumberVectorN=function(a,b){if("list"!==a.ctype)return{ctype:"boolean",value:!1};if(a.value)for(var e=0;e<a.value.length;e++)if("number"!==a.value[e].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};h.isNumberMatrix=function(a){if(-1===h._helper.colNumb(a))return{ctype:"boolean",
value:!1};for(var b=0;b<a.value.length;b++)if(!h.isNumberVector(a.value[b]).value)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};h.scalproduct=function(a,b){if(a.value.length!==b.value.length)return u;for(var e={ctype:"number",value:{real:0,imag:0}},q=0;q<b.value.length;q++){var c=a.value[q],d=b.value[q];if("number"===c.ctype&&"number"===d.ctype)e=k.add(k.mult(c,d),e);else return u}return e};h.sesquilinearproduct=function(a,b){if(a.value.length!==b.value.length)return u;for(var e=
0,q=0,c=0;c<b.value.length;c++)var d=a.value[c].value,h=b.value[c].value,e=e+(d.real*h.real+d.imag*h.imag),q=q+(d.real*h.imag-d.imag*h.real);return k.complex(e,q)};h.normSquared=function(a){for(var b=0,e=0;e<a.value.length;e++)var q=a.value[e].value,b=b+(q.real*q.real+q.imag*q.imag);return k.real(b)};h.productMV=function(a,b){if(a.value[0].value.length!==b.value.length)return u;for(var e=[],q=0;q<a.value.length;q++){for(var c={ctype:"number",value:{real:0,imag:0}},d=a.value[q],f=0;f<b.value.length;f++){var g=
d.value[f],l=b.value[f];if("number"===g.ctype&&"number"===l.ctype)c=k.add(k.mult(g,l),c);else return u}e[q]=c}return h.turnIntoCSList(e)};h.productVM=function(a,b){if(a.value.length!==b.value.length)return u;for(var e=[],q=0;q<b.value[0].value.length;q++){for(var c={ctype:"number",value:{real:0,imag:0}},d=0;d<a.value.length;d++){var f=a.value[d],g=b.value[d].value[q];if("number"===f.ctype&&"number"===g.ctype)c=k.add(k.mult(f,g),c);else return u}e[q]=c}return h.turnIntoCSList(e)};h.productMM=function(a,
b){if(a.value[0].value.length!==b.value.length)return u;for(var e=[],q=0;q<a.value.length;q++){var c=h.productVM(a.value[q],b);e[q]=c}return h.turnIntoCSList(e)};h.mult=function(a,b){return a.value.length===b.value.length&&h.isNumberVector(a).value&&h.isNumberVector(b).value?h.scalproduct(a,b):h.isNumberMatrix(a).value&&b.value.length===a.value[0].value.length&&h.isNumberVector(b).value?h.productMV(a,b):h.isNumberMatrix(b).value&&a.value.length===b.value.length&&h.isNumberVector(a).value?h.productVM(a,
b):h.isNumberMatrix(a).value&&h.isNumberMatrix(b)&&b.value.length===a.value[0].value.length?h.productMM(a,b):u};h.projectiveDistMinScal=function(a,b){var e=h.abs(a),q=h.abs(b);if(0===e.value.real||0===q.value.real)return 0;var c=h.conjugate(b),c=h.scalproduct(a,c),c=k._helper.isAlmostZero(c)?k.real(1):k.div(c,k.abs(c)),e=h.scaldiv(e,a),q=h.scaldiv(q,b),q=h.scalmult(c,q),c=h.abs(h.add(e,q)),q=h.abs(h.sub(e,q));return Math.min(c.value.real,q.value.real)};h.crossOperator=function(a){var b=a.value[0],
e=a.value[1];a=a.value[2];return h.turnIntoCSList([h.turnIntoCSList([k.zero,k.neg(a),e]),h.turnIntoCSList([a,k.zero,k.neg(b)]),h.turnIntoCSList([k.neg(e),b,k.zero])])};h.cross=function(a,b){var e=k.sub(k.mult(a.value[1],b.value[2]),k.mult(a.value[2],b.value[1])),q=k.sub(k.mult(a.value[2],b.value[0]),k.mult(a.value[0],b.value[2])),c=k.sub(k.mult(a.value[0],b.value[1]),k.mult(a.value[1],b.value[0]));return h.turnIntoCSList([e,q,c])};h.crossratio3harm=function(a,b,e,q,c){var d=h.det3(a,e,c),f=h.det3(b,
q,c);a=h.det3(a,q,c);b=h.det3(b,e,c);d=k.mult(d,f);f=k.mult(a,b);return h.turnIntoCSList([d,f])};h.crossratio3=function(a,b,e,q,c){a=h.crossratio3harm(a,b,e,q,c);return k.div(a.value[0],a.value[1])};h.veronese=function(a){var b=k.mult(a.value[0],a.value[0]),e=k.mult(a.value[1],a.value[1]),q=k.mult(a.value[2],a.value[2]),c=k.mult(a.value[0],a.value[1]),d=k.mult(a.value[0],a.value[2]);a=k.mult(a.value[1],a.value[2]);return h.turnIntoSCList([b,e,q,c,d,a])};h.matrixFromVeronese=function(a){var b=a.value[0],
e=a.value[1],q=a.value[2],c=k.realmult(.5,a.value[3]),d=k.realmult(.5,a.value[4]);a=k.realmult(.5,a.value[5]);return h.turnIntoCSList([h.turnIntoCSList([b,c,d]),h.turnIntoCSList([c,e,a]),h.turnIntoCSList([d,a,q])])};h.det2=function(a,b){var e=k.mult(a.value[0],b.value[1]);return e=k.sub(e,k.mult(a.value[1],b.value[0]))};h.det3=function(a,b,e){return k.complex(a.value[0].value.real*b.value[1].value.real*e.value[2].value.real-a.value[0].value.imag*b.value[1].value.imag*e.value[2].value.real-a.value[0].value.imag*
b.value[1].value.real*e.value[2].value.imag-a.value[0].value.real*b.value[1].value.imag*e.value[2].value.imag+a.value[2].value.real*b.value[0].value.real*e.value[1].value.real-a.value[2].value.imag*b.value[0].value.imag*e.value[1].value.real-a.value[2].value.imag*b.value[0].value.real*e.value[1].value.imag-a.value[2].value.real*b.value[0].value.imag*e.value[1].value.imag+a.value[1].value.real*b.value[2].value.real*e.value[0].value.real-a.value[1].value.imag*b.value[2].value.imag*e.value[0].value.real-
a.value[1].value.imag*b.value[2].value.real*e.value[0].value.imag-a.value[1].value.real*b.value[2].value.imag*e.value[0].value.imag-a.value[0].value.real*b.value[2].value.real*e.value[1].value.real+a.value[0].value.imag*b.value[2].value.imag*e.value[1].value.real+a.value[0].value.imag*b.value[2].value.real*e.value[1].value.imag+a.value[0].value.real*b.value[2].value.imag*e.value[1].value.imag-a.value[2].value.real*b.value[1].value.real*e.value[0].value.real+a.value[2].value.imag*b.value[1].value.imag*
e.value[0].value.real+a.value[2].value.imag*b.value[1].value.real*e.value[0].value.imag+a.value[2].value.real*b.value[1].value.imag*e.value[0].value.imag-a.value[1].value.real*b.value[0].value.real*e.value[2].value.real+a.value[1].value.imag*b.value[0].value.imag*e.value[2].value.real+a.value[1].value.imag*b.value[0].value.real*e.value[2].value.imag+a.value[1].value.real*b.value[0].value.imag*e.value[2].value.imag,-a.value[0].value.imag*b.value[1].value.imag*e.value[2].value.imag+a.value[0].value.imag*
b.value[1].value.real*e.value[2].value.real+a.value[0].value.real*b.value[1].value.real*e.value[2].value.imag+a.value[0].value.real*b.value[1].value.imag*e.value[2].value.real-a.value[2].value.imag*b.value[0].value.imag*e.value[1].value.imag+a.value[2].value.imag*b.value[0].value.real*e.value[1].value.real+a.value[2].value.real*b.value[0].value.real*e.value[1].value.imag+a.value[2].value.real*b.value[0].value.imag*e.value[1].value.real-a.value[1].value.imag*b.value[2].value.imag*e.value[0].value.imag+
a.value[1].value.imag*b.value[2].value.real*e.value[0].value.real+a.value[1].value.real*b.value[2].value.real*e.value[0].value.imag+a.value[1].value.real*b.value[2].value.imag*e.value[0].value.real+a.value[0].value.imag*b.value[2].value.imag*e.value[1].value.imag-a.value[0].value.imag*b.value[2].value.real*e.value[1].value.real-a.value[0].value.real*b.value[2].value.real*e.value[1].value.imag-a.value[0].value.real*b.value[2].value.imag*e.value[1].value.real+a.value[2].value.imag*b.value[1].value.imag*
e.value[0].value.imag-a.value[2].value.imag*b.value[1].value.real*e.value[0].value.real-a.value[2].value.real*b.value[1].value.real*e.value[0].value.imag-a.value[2].value.real*b.value[1].value.imag*e.value[0].value.real+a.value[1].value.imag*b.value[0].value.imag*e.value[2].value.imag-a.value[1].value.imag*b.value[0].value.real*e.value[2].value.real-a.value[1].value.real*b.value[0].value.real*e.value[2].value.imag-a.value[1].value.real*b.value[0].value.imag*e.value[2].value.real)};h.det4m=function(a){var b=
a.value,e=b[0].value,q=e[0].value,c=+q.real,d=+q.imag,q=e[1].value,h=+q.real,f=+q.imag,q=e[2].value,g=+q.real,l=+q.imag,q=e[3].value,m=+q.real,n=+q.imag,e=b[1].value,q=e[0].value,u=+q.real,p=+q.imag,q=e[1].value,t=+q.real,v=+q.imag,q=e[2].value,w=+q.real,x=+q.imag,q=e[3].value,e=+q.real,q=+q.imag;a=c*t-d*v-h*u+f*p;var y=c*v+d*t-h*p-f*u,z=c*w-d*x-g*u+l*p,A=c*x+d*w-g*p-l*u,C=c*e-d*q-m*u+n*p,B=c*q+d*e-m*p-n*u,D=h*w-f*x-g*t+l*v,E=h*x+f*w-g*v-l*t,F=h*e-f*q-m*t+n*v,G=h*q+f*e-m*v-n*t,H=g*e-l*q-m*w+n*x,I=
g*q+l*e-m*x-n*w,e=b[2].value,q=e[0].value,c=+q.real,d=+q.imag,q=e[1].value,h=+q.real,f=+q.imag,q=e[2].value,g=+q.real,l=+q.imag,q=e[3].value,m=+q.real,n=+q.imag,e=b[3].value,q=e[0].value,u=+q.real,p=+q.imag,q=e[1].value,t=+q.real,v=+q.imag,q=e[2].value,w=+q.real,x=+q.imag,q=e[3].value,e=+q.real,q=+q.imag,b=c*t-d*v-h*u+f*p,J=c*v+d*t-h*p-f*u,mc=c*w-d*x-g*u+l*p,K=c*x+d*w-g*p-l*u,L=c*e-d*q-m*u+n*p,c=c*q+d*e-m*p-n*u,d=h*w-f*x-g*t+l*v,u=h*x+f*w-g*v-l*t,p=h*e-f*q-m*t+n*v,h=h*q+f*e-m*v-n*t,f=g*e-l*q-m*w+
n*x,g=g*q+l*e-m*x-n*w;return k.complex(a*f-y*g-z*p+A*h+C*d-B*u+D*L-E*c-F*mc+G*K+H*b-I*J,a*g+y*f-z*h-A*p+C*u+B*d+D*c+E*L-F*K-G*mc+H*J+I*b)};h.eucangle=function(a,b){var e=h.cross(a,h.linfty),q=h.cross(b,h.linfty),c=h.det3(h.ez,e,h.ii),e=h.det3(h.ez,e,h.jj),d=h.det3(h.ez,q,h.ii),q=h.det3(h.ez,q,h.jj),c=k.div(k.mult(c,q),k.mult(d,e)),c=k.log(c);return c=k.mult(c,k.complex(0,.5))};h.zerovector=function(a){a=Math.floor(a.value.real);for(var b=Array(a),e=0;e<a;e++)b[e]=0;return h.realVector(b)};h.zeromatrix=
function(a,b){for(var e=Math.floor(a.value.real),q=Array(e),c=0;c<e;c++)q[c]=h.zerovector(b);return h.turnIntoCSList(q)};h.vandermonde=function(a){for(var b=a.value.length,e=h.zeromatrix(b,b),q=0;q<b;q++)for(var c=0;c<b;c++)e.value[q].value[c]=k.pow(a.value[q],k.real(c-1));return e};h.transpose=function(a){for(var b=[],e=a.value[0].value.length,q=a.value.length,c=0;c<e;c++){for(var d=[],f=0;f<q;f++)d[f]=a.value[f].value[c];b[c]=h.turnIntoCSList(d)}return h.turnIntoCSList(b)};h.column=function(a,b){for(var e=
[],q=a.value.length,c=Math.floor(b.value.real-1),d=0;d<q;d++)e[d]=a.value[d].value[c];return h.turnIntoCSList(e)};h.row=function(a,b){for(var e=[],q=a.value[0].value.length,c=Math.floor(b.value.real-1),d=0;d<q;d++)e[d]=a.value[c].value[d];return h.turnIntoCSList(e)};h.adjoint2=function(a){var b=a.value[0].value[0],e=a.value[1].value[0],q=Array(2);q[0]=h.turnIntoCSList([a.value[1].value[1],k.neg(a.value[0].value[1])]);q[1]=h.turnIntoCSList([k.neg(e),b]);return q=h.turnIntoCSList(q)};h.adjoint3=function(a){var b,
e,q,c,d,h,f,g,k,l,m,n,u,p,t,v,w;b=a.value[0].value;e=b[0].value;q=e.real;c=e.imag;e=b[1].value;d=e.real;h=e.imag;e=b[2].value;f=e.real;g=e.imag;b=a.value[1].value;e=b[0].value;k=e.real;l=e.imag;e=b[1].value;m=e.real;n=e.imag;e=b[2].value;u=e.real;p=e.imag;b=a.value[2].value;e=b[0].value;a=e.real;t=e.imag;e=b[1].value;v=e.real;w=e.imag;e=b[2].value;b=e.real;e=e.imag;return{ctype:"list",value:[{ctype:"list",value:[{ctype:"number",value:{real:m*b-u*v-n*e+p*w,imag:m*e-u*w-v*p+b*n}},{ctype:"number",value:{real:-d*
b+f*v+h*e-g*w,imag:-d*e+f*w+v*g-b*h}},{ctype:"number",value:{real:d*u-f*m-h*p+g*n,imag:d*p-f*n-m*g+u*h}}]},{ctype:"list",value:[{ctype:"number",value:{real:-k*b+u*a+l*e-p*t,imag:-k*e+u*t+a*p-b*l}},{ctype:"number",value:{real:q*b-f*a-c*e+g*t,imag:q*e-f*t-a*g+b*c}},{ctype:"number",value:{real:-q*u+f*k+c*p-g*l,imag:-q*p+f*l+k*g-u*c}}]},{ctype:"list",value:[{ctype:"number",value:{real:k*v-m*a-l*w+n*t,imag:k*w-m*t-a*n+v*l}},{ctype:"number",value:{real:-q*v+d*a+c*w-h*t,imag:-q*w+d*t+a*h-v*c}},{ctype:"number",
value:{real:q*m-d*k-c*n+h*l,imag:q*n-d*l-k*h+m*c}}]}]}};h.inverse=function(a){var b=a.value.length;if(b!==a.value[0].value.length)return console.log("Inverse works only for square matrices"),u;if(2===b)return h.scaldiv(h.det(a),h.adjoint2(a));if(3===b)return h.scaldiv(h.det(a),h.adjoint3(a));b=h.LUdecomp(a);a=a.value.length;var e=k.real(0),q=k.real(1),c=h.zerovector(k.real(a));c.value[0]=q;for(var d=Array(a),f=0;f<a;f++)d[f]=h._helper.LUsolve(b,c),c.value[f]=e,c.value[f+1]=q;d=h.turnIntoCSList(d);
return d=h.transpose(d)};h.linearsolve=function(a,b){return 2===a.value.length?h.linearsolveCramer2(a,b):3===a.value.length?h.linearsolveCramer3(a,b):h.LUsolve(a,b)};h.getDiag=function(a){if(a.value.length!==a.value[0].value.length)return u;for(var b=Array(a.value.length),e=0;e<a.value.length;e++)b[e]=a.value[e].value[e];return h.turnIntoCSList(b)};h.getSubDiag=function(a){if(a.value.length!==a.value[0].value.length)return u;for(var b=Array(a.value.length-1),e=0;e<a.value.length-1;e++)b[e]=a.value[e+
1].value[e];return h.turnIntoCSList(b)};h.eig2=function(a){var b=k.add(a.value[0].value[0],a.value[1].value[1]);a=h.det2(a.value[0],a.value[1]);var e=k.mult(b,b),c=b=k.mult(b,k.real(.5));a=k.sqrt(k.sub(k.div(e,k.real(4)),a));b=k.add(b,a);c=k.sub(c,a);return h.turnIntoCSList([b,c])};h.eig=function(a,b){var e=b||!0,c=a,d=k.real(c.value.length),f=d.value.real;k.real(0);var c=h._helper.QRIteration(c)[0],c=h.getDiag(c),c=h.sort1(c),d=h.idMatrix(d,d),g=Array(f),g=h.turnIntoCSList(g);if(e){for(var l,m,n,
u=0,p=!1,e=0;e<f;e++)p?m=l.value[u]:(l=c.value[e],l=h.sub(a,h.scalmult(l,d)),l=h.nullSpace(l),m=l.value[0],void 0!==m&&(n=m)),void 0===m&&(m=n),1E-8>h.abs(m).value.real&&0===u&&(m=h._helper.inverseIteration(a,c.value[e])),g.value[e]=h._helper.isAlmostZeroVec(m)?m:h.scaldiv(h.abs(m),m),e<f-1&&((p=1E-6>k.abs(k.sub(c.value[e],c.value[e+1])).value.real)?u++:u=0);g=h.transpose(g)}return h.turnIntoCSList([c,g])};h._helper.isNormalMatrix=function(a){return 1E-10>h.abs(h.sub(a,h.transjugate(a))).value.real};
h._helper.QRIteration=function(a,b){var e,c=a;e=k.real(c.value.length);var d=e.value.real,f=e.value.real;k.real(0);var g=h.idMatrix(e,e),l=h.zeromatrix(e,e),m=h.idMatrix(e,e),n=b?b:2500,u,p,t,v=0,w=Array(f);for(e=0;e<n;e++){g=h._helper.getBlock(c,[f-2,f-1],[f-2,f-1]);u=h.eig2(g);g=u.value[0];u=u.value[1];h.abs(g);h.abs(u);p=c.value[f-1].value[f-1];t=k.abs(k.sub(p,g)).value.real;p=k.abs(k.sub(p,u)).value.real;u=t<p?g:u;g=h.idMatrix(k.real(f),k.real(f));u=h.scalmult(u,g);g=h.QRdecomp(h.sub(c,u));c=
y.mult(g.R,g.Q);c=h.add(c,u);g.Q=h._helper.buildBlockMatrix(g.Q,h.idMatrix(k.real(v),k.real(v)));m=y.mult(m,g.Q);if(1E-48>k.abs2(c.value[c.value.length-1].value[c.value[0].value.length-2]).value.real&&1<f){w[d-v-1]=c.value[f-1].value[f-1];for(e=0;e<f;e++)l.value[f-1].value[e]=c.value[f-1].value[e],l.value[e].value[f-1]=c.value[e].value[f-1];c=h._helper.getBlock(c,[0,f-2],[0,f-2]);v++;f--}if(1===f){l.value[0].value[0]=c.value[0].value[0];break}if(h._helper.isUpperTriangular(c)){for(e=0;e<f;e++)l.value[e].value[e]=
c.value[e].value[e];break}}return[l,m]};h.rank=function(a,b){return h.RRQRdecomp(a,b).rank};h._helper.isAlmostZeroVec=function(a){for(var b=a.value.length,e=0;e<b;e++)if(!k._helper.isAlmostZero(a.value[e]))return!1;return!0};h._helper.isLowerTriangular=function(a){for(var b=a.value.length,e=a.value[0].value.length,c=0;c<b;c++)for(var d=c+1;d<e;d++)if(!k._helper.isAlmostZero(a.value[c].value[d]))return!1;return!0};h._helper.isUpperTriangular=function(a){return h._helper.isLowerTriangular(h.transpose(a))};
h._helper.isAlmostId=function(a){var b=a.value.length,e=k.real(b);if(b!==a.value[0].value.length)return!1;a=h.sub(a,h.idMatrix(e),e);for(e=0;e<b;e++)for(var c=0;c<b;c++)if(1E-16<k.abs(a.value[e].value[c]).value.real)return!1;return!0};h.nullSpace=function(a,b){var e=a.value.length,c=h.RRQRdecomp(h.transjugate(a),b),d=h.transpose(c.Q),c=e-c.rank.value.real,f=Array(c);d.value.reverse();for(var g,l=0;l<c;l++)g=d.value[l],f[l]=h.scaldiv(h.abs(g),g);f=h.turnIntoCSList(f);return 0<f.value.length?f:h.turnIntoCSList([h.zerovector(k.real(e))])};
h._helper.isAlmostDiagonal=function(a){var b=a.value.length;k.real(b);k.real(0);if(b!==a.value[0].value.length)return!1;for(var e=0;e<b;e++)for(var c=0;c<b;c++)if(e!==c&&1E-16<k.abs(a.value[e].value[c]).value.real)return!1;return!0};h._helper.inverseIteration=function(a,b){console.log("warning: code untested");for(var e=a.value.length,c=Array(e),d=0;d<e;d++)c[d]=2*Math.random()-.5;var d=c=h.realVector(c),e=h.idMatrix(k.real(e),k.real(e)),f;f=k.add(b,k.real(.1*Math.random()-.5));for(var g=0;100>g;g++)d=
h.scaldiv(h.abs(c),c),c=h.LUsolve(h.sub(a,h.scalmult(f,e)),JSON.parse(JSON.stringify(d)));return h.scaldiv(h.abs(c),c)};h._helper.toHessenberg=function(a){var b=JSON.parse(JSON.stringify(a)),e=b.value.length,c=k.real(e-1),d=k.real(e);k.real(1);if(h._helper.isUpperTriangular(b))return[h.idMatrix(c,c),a];var f;a=h.idMatrix(d,d);for(var g,d=1;d<e-1;d++)f=h.column(b,k.real(d)),f.value=f.value.splice(d),g=h.abs2(f).value.real,1E-16<g&&(f=h._helper.getHouseHolder(f),a=y.mult(a,f),b=y.mult(y.mult(f,b),f)),
c.value.real--;return[a,b]};h._helper.swapEl=function(a,b,e){var c;"[object Array]"===Object.prototype.toString.call(a)?(c=a[b],a[b]=a[e],a[e]=c):"list"===a.ctype&&(c=a.value[b],a.value[b]=a.value[e],a.value[e]=c)};h.RRQRdecomp=function(a,b){var e=Math.sqrt(k.eps);void 0!==b&&(e=.1*b.value.real);var e=e*e,c,d=a.value.length,f=k.real(d),g=k.real(1),l=h._helper.unitvector(k.real(a.value.length),g),m=h.idMatrix(f,f),n=JSON.parse(JSON.stringify(a)),u=h.transpose(a),p=Array(d);for(c=0;c<d;c++)p[c]=h.abs2(u.value[c]);
p=h.turnIntoCSList(p);u=Array(d);for(c=0;c<d;c++)u[c]=c;c=h.maxIndex(p,k.abs);for(var t=p.value[c],v=0,w=0;1E-16<k.abs2(t).value.real;w++){v++;h._helper.swapColumn(n,w,c);h._helper.swapEl(p,w,c);h._helper.swapEl(u,w,c);c=h._helper.getBlock(n,[w],[w]);c=h.column(c,g);t=h.abs2(c).value.real;1E-8<t&&(c=h._helper.getHouseHolder(c),c=h._helper.buildBlockMatrix(h.idMatrix(k.real(w),k.real(w)),c),m=y.mult(m,h.transjugate(c)),n=y.mult(c,n));for(c=w+1;c<d;c++)p.value[c]=k.sub(p.value[c],k.mult(n.value[w].value[c],
k.conjugate(n.value[w].value[c])));c=h.maxIndex(p,k.abs2,w+1);t=p.value[c];if(w+2===d){k.abs(t).value.real>e&&v++;break}f=k.sub(f,g);l.value=l.value.splice(0,l.value.length-1)}return{Q:m,R:n,P:h.turnIntoCSList(u),rank:k.real(v)}};h._helper.getHouseHolder=function(a){var b=k.real(a.value.length);if(1E-16>h.abs2(a))return h.idMatrix(b,b);var e,c=k.real(1),d=h._helper.unitvector(k.real(a.value.length),c);e=h._helper.QRgetAlpha(a,0);e=h.sub(a,h.scalmult(e,d));e=h.scaldiv(h.abs(e),e);a=k.div(h.sesquilinearproduct(a,
e),h.sesquilinearproduct(e,a));b=h.idMatrix(b,b);return b=h.sub(b,h.scalmult(k.add(c,a),h._helper.transposeMult(e,h.conjugate(e))))};h._helper.reOrderbyPivots=function(a,b){for(var e=a.value.length.length,c=h.transpose(a),e=Array(e),d=0;d<b.length;d++)e[b[d]]=c.value[d];e=h.turnIntoCSList(e);return h.transpose(e)};h.QRdecomp=function(a){var b,e=a.value.length,c=k.real(e);if(h._helper.isUpperTriangular(a))return{Q:h.idMatrix(c,c),R:a};var d=k.real(1),f=h._helper.unitvector(k.real(a.value.length),d),
g,l=h.idMatrix(c,c);a=JSON.parse(JSON.stringify(a));for(var m=0;;m++){b=h._helper.getBlock(a,[m],[m]);b=h.column(b,d);g=h.abs2(b).value.real;1E-8<g&&(b=h._helper.getHouseHolder(b),b=h._helper.buildBlockMatrix(h.idMatrix(k.real(m),k.real(m)),b),l=y.mult(l,h.transjugate(b)),a=y.mult(b,a));if(m+2===e)break;c=k.sub(c,d);f.value=f.value.splice(0,f.value.length-1)}return{Q:l,R:a}};h._helper.swapColumn=function(a,b,e){for(var c,d=0;d<a.value.length;d++)c=a.value[d].value[b],a.value[d].value[b]=a.value[d].value[e],
a.value[d].value[e]=c};h._helper.buildBlockMatrix=function(a,b){if(0===a.value.length)return b;if(0===b.value.length)return a;for(var e=a.value.length,c=a.value[0].value.length,d=c+b.value[0].value.length,d=h.zeromatrix(k.real(e+b.value.length),k.real(d)),f=0;f<a.value.length;f++)for(var g=0;g<a.value[0].value.length;g++)d.value[f].value[g]=a.value[f].value[g];for(f=0;f<b.value.length;f++)for(g=0;g<b.value[0].value.length;g++)d.value[e+f].value[c+g]=b.value[f].value[g];return d};h._helper.getBlock=
function(a,b,e){a=JSON.parse(JSON.stringify(a));var c=b[0],d=e[0];b=void 0===b[1]?a.value.length:b[1];e=void 0===e[1]?a.value[0].value.length:e[1];b++;e++;a.value=a.value.slice(c,b);for(c=0;c<a.value.length;c++)a.value[c].value=a.value[c].value.slice(d,e);return a};h._helper.setBlock=function(a,b,e){a=JSON.parse(JSON.stringify(a));var c=e[0];e=e[1];for(var d=b.value.length,h=b.value[0].value.length,f=0;f<d;f++)for(var g=0;g<h;g++)a.value[c+f].value[e+g]=b.value[f].value[g];return a};h._helper.transposeMult=
function(a,b){if(a.value.length!==b.value.length)return u;for(var e=a.value.length,c=Array(e),d=0;d<e;d++)c[d]=h.scalmult(a.value[d],b);return h.turnIntoCSList(c)};h._helper.QRgetAlpha=function(a,b){return 0>a.value[b].value.real?h.abs(a):k.neg(h.abs(a))};h.LUdecomp=function(a){a=JSON.parse(JSON.stringify(a));var b,e,c,d,h,f=0,g,l=a.value.length,m=l-1,n=Array(l);for(c=0;c<l;++c){h=c;d=a.value[c];g=k.abs(d.value[c]).value.real;for(e=c+1;e<l;++e)b=k.abs(a.value[e].value[c]),g<b.value.real&&(g=b.value.real,
h=e);g<k.eps&&console.log("Warning: singular matrix!");n[c]=h;h!==c&&(a.value[c]=a.value[h],a.value[h]=d,d=a.value[c],f++);e=d.value[c];for(b=c+1;b<l;++b)a.value[b].value[c]=k.div(a.value[b].value[c],e);for(b=c+1;b<l;++b){h=a.value[b];for(e=c+1;e<m;++e)h.value[e]=k.sub(h.value[e],k.mult(h.value[c],d.value[e])),++e,h.value[e]=k.sub(h.value[e],k.mult(h.value[c],d.value[e]));e===m&&(h.value[e]=k.sub(h.value[e],k.mult(h.value[c],d.value[e])))}}return{LU:a,P:n,TransPos:f}};h.LUsolve=function(a,b){var e=
h.LUdecomp(a);return h._helper.LUsolve(e,b)};h._helper.LUsolve=function(a,b){var e=JSON.parse(JSON.stringify(b)),c,d=a.LU,h=d.value.length,f=JSON.parse(JSON.stringify(e)),g=a.P,l;for(c=h-1;-1!==c;--c)f.value[c]=e.value[c];for(c=0;c<h;++c)for(e=g[c],g[c]!==c&&(l=f.value[c],f.value[c]=f.value[e],f.value[e]=l),l=d.value[c],e=0;e<c;++e)f.value[c]=k.sub(f.value[c],k.mult(f.value[e],l.value[e]));for(c=h-1;0<=c;--c){l=d.value[c];for(e=c+1;e<h;++e)f.value[c]=k.sub(f.value[c],k.mult(f.value[e],l.value[e]));
f.value[c]=k.div(f.value[c],l.value[c])}return f};h.linearsolveCramer2=function(a,b){var e=h.column(a,k.real(1)),c=h.column(a,k.real(2)),d=h.det2(e,c);k._helper.isZero(d)&&console.log("A is not regular!");c=h.det2(b,c);c=k.div(c,d);e=h.det2(e,b);e=k.div(e,d);return h.turnIntoCSList([c,e])};h.linearsolveCramer3=function(a,b){var e=h.column(a,k.real(1)),c=h.column(a,k.real(2)),d=h.column(a,k.real(3)),f=h.det3(e,c,d);k._helper.isZero(f)&&console.log("A is not regular!");var g=h.det3(b,c,d),d=h.det3(e,
b,d),e=h.det3(e,c,b),g=h.turnIntoCSList([g,d,e]);return g=h.scaldiv(f,g)};h.linearsolveCGNR=function(a,b){var e=h.transpose(a),c=y.mult(e,a),e=y.mult(e,b);return h.linearsolveCG(c,e)};h.linearsolveCG=function(a,b){var e,c,d,f,g,l;f=b;c=e=h.sub(b,y.mult(a,b));for(var m=Math.ceil(1.2*a.value.length),n=0;n<m;){n++;g=y.mult(a,c);l=d=h.scalproduct(e,e);d=k.div(d,h.scalproduct(c,g));f=h.add(f,y.mult(d,c));e=h.sub(e,y.mult(d,g));if(h.abs(e).value.real<k.eps)break;d=h.scalproduct(e,e);d=k.div(d,l);c=h.add(e,
y.mult(d,c))}n>=m&&console.log("CG did not converge");return f};h.det=function(a){if(1===a.value.length)return a.value[0].value[0];if(2===a.value.length)return h.det2(a.value[0],a.value[1]);if(3===a.value.length)return h.det3(a.value[0],a.value[1],a.value[2]);if(4===a.value.length)return h.det4m(a);var b=a.value.length,e=k.real(1),c,d,f=JSON.parse(JSON.stringify(a)),g,l,m,n;for(a=0;a<b-1;a++){d=a;for(c=a+1;c<b;c++)k.abs(f.value[c].value[a]).value.real>k.abs(f.value[d].value[a]).value.real&&(d=c);
d!==a&&(c=f.value[d],f.value[d]=f.value[a],f.value[a]=c,e=k.neg(e));g=f.value[a];for(c=a+1;c<b;c++){l=f.value[c];m=k.div(l.value[a],g.value[a]);for(d=a+1;d<b-1;d+=2)n=d+1,l.value[d]=k.sub(l.value[d],k.mult(g.value[d],m)),l.value[n]=k.sub(l.value[n],k.mult(g.value[n],m));d!==b&&(l.value[d]=k.sub(l.value[d],k.mult(g.value[d],m)))}if(k._helper.isZero(g.value[a]))return k.real(0);e=k.mult(e,g.value[a])}return k.mult(e,f.value[a].value[a])};h.LUdet=function(a){a=h.LUdecomp(a);for(var b=a.LU,e=b.value.length,
c=b.value[0].value[0],d=1;d<e;d++)c=k.mult(c,b.value[d].value[d]);1===a.TransPos%2&&(c=k.neg(c));return c};h.getField=function(a,b){var e;if("homog"===b){if(h._helper.isNumberVecN(a,3))return a;if(h._helper.isNumberVecN(a,2))return h.turnIntoCSList([a.value[0],a.value[1],k.real(1)])}if("xy"===b){if(h._helper.isNumberVecN(a,2))return a;if(h._helper.isNumberVecN(a,3))return h.turnIntoCSList([k.div(a.value[0],a.value[2]),k.div(a.value[1],a.value[2])])}if("x"===b&&h.isNumberVector(a)){e=a.value.length;
if(0<e&&3!==e)return a.value[0];if(3===e)return"Point"===a.usage?k.div(a.value[0],a.value[2]):a.value[0]}if("y"===b&&h.isNumberVector(a)){e=a.value.length;if(1<e&&3!==e)return a.value[1];if(3===e)return"Point"===a.usage?k.div(a.value[1],a.value[2]):a.value[1]}return"z"===b&&h.isNumberVector(a)&&(e=a.value.length,2<e)?a.value[2]:u};var ob={":":20,".":25,"\u00b0":25,_:50,"^":50,"*":100,"/":100,"+":200,"-":200,"!":200,"==":300,"~=":300,"~<":300,"~>":300,"=:=":300,">=":300,"<=":300,"~>=":300,"~<=":300,
">":300,"<":300,"<>":300,"&":350,"%":350,"!=":350,"~!=":350,"..":350,"++":370,"--":370,"~~":370,":>":370,"<:":370,"=":400,":=":400,":=_":400,"::=":400,"->":400,",":500,";":500},O={};O["+"]=Ob;O["-"]=pb;O["*"]=Pb;O["/"]=Qb;O["^"]=Rb;O["\u00b0"]=function(a,b){var e=B(a[0]),c=B(a[1]);return"number"===e.ctype&&"void"===c.ctype?k.mult(e,k.real(Math.PI/180)):u};O[";"]=function(a,b){var e="void"===a[0].ctype,c="void"===a[1].ctype;if(e&&c)return u;if(!e&&c)return A(a[0]);e||c||A(a[0]);return c?u:A(a[1])};
O["="]=Ga;O[".."]=function(a,b){var e=A(a[0]),c=A(a[1]);return"number"===e.ctype&&"number"===c.ctype?h.sequence(e,c):u};O[":="]=function(a,b){var e="undefined"===a[1].ctype;if("undefined"===a[0].ctype||e)return u;"function"===a[0].ctype&&(e=a[0].oper,wa[e]={oper:e,body:a[1],arglist:a[0].args});return u};O["=="]=M;O["!="]=function(a,b){return y.not(M(a,b))};O["~="]=Z;O["~!="]=function(a,b){return y.not(Z(a,b))};O[">"]=function(a,b){var e=B(a[0]),c=B(a[1]);return"number"===e.ctype&&"number"===c.ctype&&
k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:e.value.real>c.value.real}:"string"===e.ctype&&"string"===c.ctype?{ctype:"boolean",value:e.value>c.value}:u};O["<"]=function(a,b){var e=B(a[0]),c=B(a[1]);return"number"===e.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:e.value.real<c.value.real}:"string"===e.ctype&&"string"===c.ctype?{ctype:"boolean",value:e.value<c.value}:u};O[">="]=function(a,b){var e=B(a[0]),c=B(a[1]);
return"number"===e.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:e.value.real>=c.value.real}:"string"===e.ctype&&"string"===c.ctype?{ctype:"boolean",value:e.value>=c.value}:u};O["<="]=function(a,b){var e=B(a[0]),c=B(a[1]);return"number"===e.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:e.value.real<=c.value.real}:"string"===e.ctype&&"string"===c.ctype?{ctype:"boolean",value:e.value<=c.value}:
u};O["~>"]=function(a,b){var e=B(a[0]),c=B(a[1]);return"number"===e.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:e.value.real>c.value.real+k.eps}:u};O["~<"]=function(a,b){var e=B(a[0]),c=B(a[1]);return"number"===e.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:e.value.real<c.value.real-k.eps}:u};O["~>="]=function(a,b){var e=B(a[0]),c=B(a[1]);return"number"===e.ctype&&"number"===c.ctype&&
k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:e.value.real>c.value.real-k.eps}:u};O["~<="]=function(a,b){var e=B(a[0]),c=B(a[1]);return"number"===e.ctype&&"number"===c.ctype&&k._helper.isAlmostReal(e)&&k._helper.isAlmostReal(c)?{ctype:"boolean",value:e.value.real<c.value.real+k.eps}:u};O["&"]=Nb;O["%"]=R;O["!"]=function(a,b){var e=B(a[0]),c=B(a[1]);return"void"===e.ctype&&"boolean"===c.ctype?{ctype:"boolean",value:!c.value}:u};O._=Yb;O["++"]=Zb;O["~~"]=$b;O["--"]=ac;
O[":>"]=bc;O["<:"]=cc;var v={},D={evaluate:function(a,b,e){if(wa.hasOwnProperty(a))return wa(a,b,e);var c=v[a];if(c)return c(b,e);var d=a.lastIndexOf("$");if(-1!==d&&(d=a.substr(0,d),c=v[d]))return c(b,e);la.err("Called undefined function "+d+" (as "+a+")");return u},equals:function(a,b){return"number"===a.ctype&&"number"===b.ctype?{ctype:"boolean",value:a.value.real===b.value.real&&a.value.imag===b.value.imag}:"string"===a.ctype&&"string"===b.ctype||"boolean"===a.ctype&&"boolean"===b.ctype?{ctype:"boolean",
value:a.value===b.value}:"list"===a.ctype&&"list"===b.ctype?h.equals(a,b):{ctype:"boolean",value:!1}}},y={_helper:{},order:{undefined:0,boolean:1,number:2,term:3,atomic:4,variable:5,geo:6,string:7,list:8},string:function(a){return{ctype:"string",value:a}},bool:function(a){return{ctype:"boolean",value:a}},not:function(a){return y.bool(!a.value)},isLessThan:function(a,b){return-1===y.compare(a,b)},isEqual:function(a,b){return 0===y.compare(a,b)},compareResults:function(a,b){return y.compare(a.result,
b.result)},compare:function(a,b){if(a.ctype!==b.ctype)return y.order[a.ctype]-y.order[b.ctype];if("number"===a.ctype)return k._helper.compare(a,b);if("list"===a.ctype)return h._helper.compare(a,b);if("string"===a.ctype)return a.value===b.value?0:a.value<b.value?-1:1;if("boolean"===a.ctype)return a.value===b.value?0:!1===a.value?-1:1},add:function(a,b){return"void"===a.ctype&&"number"===b.ctype?b:"number"===a.ctype&&"number"===b.ctype?k.add(a,b):"string"===a.ctype||"string"===b.ctype?{ctype:"string",
value:E(a)+E(b)}:"list"===a.ctype&&"list"===b.ctype?h.add(a,b):u},sub:function(a,b){return"void"===a.ctype&&"number"===b.ctype?k.neg(b):"void"===a.ctype&&"list"===b.ctype?h.neg(b):"number"===a.ctype&&"number"===b.ctype?k.sub(a,b):"list"===a.ctype&&"list"===b.ctype?h.sub(a,b):u},mult:function(a,b){return"number"===a.ctype&&"number"===b.ctype?k.mult(a,b):"number"===a.ctype&&"list"===b.ctype?h.scalmult(a,b):"list"===a.ctype&&"number"===b.ctype?h.scalmult(b,a):"list"===a.ctype&&"list"===b.ctype?h.mult(a,
b):u},div:function(a,b){return"number"===a.ctype&&"number"===b.ctype?k.div(a,b):"list"===a.ctype&&"number"===b.ctype?h.scaldiv(b,a):u},max:function(a,b){return"number"===a.ctype&&"number"===b.ctype?k.max(a,b):"list"===a.ctype&&"list"===b.ctype?h.max(a,b):u},min:function(a,b){return"number"===a.ctype&&"number"===b.ctype?k.min(a,b):"list"===a.ctype&&"list"===b.ctype?h.min(a,b):u},wrap:function(a){if("number"===typeof a)return k.real(a);if("object"===typeof a&&void 0!==a.length){for(var b=[],e=0;e<a.length;e++)b[e]=
y.wrap(a[e]);return h.turnIntoCSList(b)}return"string"===typeof a?{ctype:"string",value:a}:"boolean"===typeof a?{ctype:"boolean",value:a}:u},withUsage:function(a,b){return{ctype:a.ctype,value:a.value,usage:b}}};v.timestamp$0=function(a,b){return{ctype:"number",value:{real:(new Date).getTime(),imag:0}}};v.seconds$0=function(a,b){return{ctype:"number",value:{real:(new Date).getTime()/1E3,imag:0}}};v.clearconsole$0=function(a,b){la.clear()};v.err$1=function(a,b){var e="",c;"variable"===a[0].ctype?(e=
a[0].name,c=J.getvar(a[0].name)):c=a[0];c=e+" ===> "+E(A(c));la.err(c);return u};v.errc$1=function(a,b){var e;"variable"===a[0].ctype?(e=A(J.getvar(a[0].name)),console.log(a[0].name+" ===> "+E(e))):(e=A(a[0]),console.log(" ===> "+E(e)));return u};v.print$1=function(a,b){la.out(E(A(a[0])),!0)};v.println$1=function(a,b){la.out(E(A(a[0])))};v.dump$1=function(a,b){console.log(JSON.stringify(a[0]));return u};v.repeat$2=function(a,b){return v.repeat$3([a[0],null,a[1]],b)};v.repeat$3=function(a,b){var e=
B(a[0]),c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);if("number"!==e.ctype)return u;var e=Math.round(e.value.real),d=1,h=1,f=e+1,g=!1,k=!1,l=!1,m;void 0!==b.start&&(m=A(b.start),"number"===m.ctype&&(g=!0,h=m.value.real));void 0!==b.step&&(m=A(b.step),"number"===m.ctype&&(l=!0,d=m.value.real));void 0!==b.stop&&(m=A(b.stop),"number"===m.ctype&&(k=!0,f=m.value.real));!g||k||l||(f=d*e+h);g||!k||l||(h=-d*(e-1)+f,f+=d);g||k||!l||(f=d*e+h);g&&k&&!l&&(d=(f-h)/(e-1),f+=d);g&&!k&&l&&(f=d*e+h);
!g&&k&&l&&(h=-d*(e-1)+f,f+=d);g&&k&&l&&(f+=d);(h<=f&&0<d||h>=f&&0>d)&&g&&k&&l&&(e=Math.floor((f-h)/d));J.newvar(c);f=u;for(g=0;g<e;g++)J.setvar(c,{ctype:"number",value:{real:g*d+h,imag:0}}),f=A(a[2]);J.removevar(c);return f};v.while$2=function(a,b){for(var e=a[1],c=a[0],d=A(c),h=u;"list"!==d.ctype&&d.value;)h=A(e),d=A(c);return h};v.apply$2=function(a,b){return v.apply$3([a[0],null,a[1]],b)};v.apply$3=function(a,b){var e=B(a[0]);if("list"!==e.ctype)return u;var c="#";null!==a[1]&&"variable"===a[1].ctype&&
(c=a[1].name);var e=e.value,d=[];J.newvar(c);for(var h=0;h<e.length;h++)J.setvar(c,e[h]),d[h]=A(a[2]);J.removevar(c);return{ctype:"list",value:d}};v.forall$2=function(a,b){return v.forall$3([a[0],null,a[1]],b)};v.forall$3=function(a,b){var e=B(a[0]);if("list"!==e.ctype)return u;var c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);e=e.value;J.newvar(c);for(var d,h=0;h<e.length;h++)J.setvar(c,e[h]),d=A(a[2]);J.removevar(c);return d};v.select$2=function(a,b){return v.select$3([a[0],null,a[1]],
b)};v.select$3=function(a,b){var e=B(a[0]);if("list"!==e.ctype)return u;var c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);var e=e.value,d=[];J.newvar(c);for(var h=0,f=0;f<e.length;f++){J.setvar(c,e[f]);var g=A(a[2]);"boolean"===g.ctype&&!0===g.value&&(d[h]=e[f],h++)}J.removevar(c);return{ctype:"list",value:d}};v.flatten$1=function(a,b){function e(a,b){return-1===b||"list"!==a.ctype?a:[].concat.apply([],a.value.map(function(a){return e(a,b-1)}))}var c=B(a[0]);if("list"!==c.ctype)return c;
var d=b.levels;void 0===d?d=1:(d=A(d),d="number"===d.ctype?d.value.real:"string"===d.ctype&&"all"===d.value?-2:1);return{ctype:"list",value:e(c,d)}};v.createvar$1=function(a,b){"variable"===a[0].ctype&&J.newvar(a[0].name);return u};v.local=function(a,b){for(var e=0;e<a.length;e++)"variable"===a[e].ctype&&J.newvar(a[e].name);return u};v.removevar$1=function(a,b){var e=A(a[0]);"variable"===a[0].ctype&&J.removevar(a[0].name);return e};v.release=function(a,b){if(0===a.length)return u;for(var e=A(a[a.length-
1]),c=0;c<a.length;c++)"variable"===a[c].ctype&&J.removevar(a[c].name);return e};v.regional=function(a,b){for(var e=0;e<a.length;e++)if("variable"===a[e].ctype){var c=a[e].name;J.newvar(c);J.pushVstack(c)}return u};v.genList=function(a,b){for(var e=[],c=0;c<a.length;c++)e[c]=A(a[c]);return{ctype:"list",value:e}};D.assigntake=function(a,b){var e=a.args[0],c=A(e),d=B(a.args[1]),f=u;if("list"===c.ctype||"string"===c.ctype)d=Math.floor(d.value.real),0>d&&(d=c.value.length+d+1),0<d&&d<=c.value.length&&
("list"===c.ctype?(c=c.value.slice(),c[d-1]=A(b),f=h.turnIntoCSList(c)):(c=c.value,c=c.substring(0,d-1)+E(A(b))+c.substring(d,c.length),f=y.string(c)));Ga([e,f])};D.assigndot=function(a,b){var e=A(a.obj),c=a.key;"geo"===e.ctype&&c&&sa.setField(e.value,c,b);return u};D.assignlist=function(a,b){var e=a.length,c=b.length;c<e&&(e=c);for(c=0;c<e;c++)Ga([a[c],b[c]],[])};v.if$2=function(a,b){return v.if$3(a,b)};v.if$3=function(a,b){var e=B(a[0]);if("boolean"===e.ctype){if(!0===e.value)return A(a[1]);if(3===
a.length)return A(a[2])}return u};v.and$2=Nb;v.or$2=R;v.xor$2=function(a,b){var e=B(a[0]),c=B(a[1]);return"boolean"===e.ctype&&"boolean"===c.ctype?{ctype:"boolean",value:e.value!==c.value}:u};v.not$1=function(a,b){var e=B(a[0]);return"boolean"===e.ctype?{ctype:"boolean",value:!e.value}:u};D.genericListMathGen=function(a,b,e){v[a+"$1"]=function(a,c){var d=A(a[0]);if("list"!==d.ctype)return u;d=d.value;if(0===d.length)return e;for(var q=d[0],h=1;h<d.length;h++)q=b(q,d[h]);return q};var c=a+"$3";v[a+
"$2"]=function(a,b){return v[c]([a[0],null,a[1]])};v[c]=function(a,c){var d=B(a[0]);if("list"!==d.ctype)return u;d=d.value;if(0===d.length)return e;var q="#";null!==a[1]&&"variable"===a[1].ctype&&(q=a[1].name);J.newvar(q);J.setvar(q,d[0]);for(var h=A(a[2]),f=1;f<d.length;f++){J.setvar(q,d[f]);var g=A(a[2]),h=b(h,g)}J.removevar(q);return h}};D.genericListMathGen("product",y.mult,k.real(1));D.genericListMathGen("sum",y.add,k.real(0));D.genericListMathGen("max",y.max,u);D.genericListMathGen("min",y.min,
u);v.max$2=function(a,b){var e=B(a[0]);if("list"===e.ctype)return v.max$3([e,null,a[1]]);var c=B(a[1]);return v.max$1([h.turnIntoCSList([e,c])])};v.min$2=function(a,b){var e=B(a[0]);if("list"===e.ctype)return v.min$3([e,null,a[1]]);var c=B(a[1]);return v.min$1([h.turnIntoCSList([e,c])])};v.add$2=Ob;v.sub$2=pb;v.mult$2=Pb;v.div$2=Qb;v.mod$2=function(a,b){var e=B(a[0]),c=B(a[1]);return"number"===e.ctype&&"number"===c.ctype?k.mod(e,c):u};v.pow$2=Rb;v.exp$1=function(a,b){var e=B(a[0]);return"number"===
e.ctype?k.exp(e):u};v.sin$1=function(a,b){var e=B(a[0]);return"number"===e.ctype?k.sin(e):u};v.sqrt$1=function(a,b){var e=B(a[0]);return"number"===e.ctype?k.sqrt(e):u};D.laguerre=function(a,b,e){if("list"!==a.ctype)return u;var c=a.value.length-1,d;for(d=0;d<=c;d++)if("number"!==a.value[d].ctype)return u;if("number"!==b.ctype)return u;for(var h=[1,.3141,.5926,.5358,.9793,.2385,.6264,.3383,.2795,.0288],f,g,l,m=1;m<=e;m++){l=k.real(0);g=k.real(0);f=a.value[c];for(d=c-1;0<=d;d--)l=k.add(g,k.mult(l,b)),
g=k.add(f,k.mult(g,b)),f=k.add(a.value[d],k.mult(f,b));if(k._helper.isLessThan(k.abs(f),k.real(1E-14)))break;d=k.div(g,f);g=k.mult(d,d);f=k.sub(g,k.div(k.mult(k.real(2),l),f));l=k.sqrt(k.mult(k.real(c-1),k.sub(k.mult(k.real(c),f),g)));f=k.add(d,l);d=k.sub(d,l);k._helper.isLessThan(k.abs(f),k.abs(d))&&(f=d);d=k._helper.isLessThan(k.real(1E-14),k.abs(f))?k.div(k.real(c),f):k.mult(k.add(k.abs(b),k.real(1)),k.complex(Math.cos(m),Math.sin(m)));if(k._helper.isLessThan(k.abs(d),k.real(1E-14)))break;0===
m%20&&(d=k.mult(d,k.real(h[m/20])));b=k.sub(b,d)}return b};v.roots$1=function(a,b){var e=B(a[0]);if("list"===e.ctype){var c;for(c=0;c<e.value.length;c++)if("number"!==e.value[c].ctype)return u;var d=[],f=e,g=e.value.length-1;for(c=0;c<g;c++){d[c]=D.laguerre(e,k.zero,200);d[c]=D.laguerre(f,d[c],1);var l=[];l[g-c]=e.value[g-c];for(var m=g-c;0<m;m--)l[m-1]=k.add(e.value[m-1],k.mult(l[m],d[c]));l.shift();e=h.turnIntoCSList(l)}return h.sort1(h.turnIntoCSList(d))}return u};v.autodiff$3=function(a,b){var e=
"x",c;if("function"===a[0].ctype)c=wa[a[0].oper].body,e=a[0].args[0].name;else if("function"===typeof a[0].impl)c=a[0];else return console.log("could not parse function"),u;var d=B(a[1]),h=B(a[2]);if(1>h.value.real)return console.log("grade cant be < 1"),u;h=k.add(h,k.real(1));return L.autodiff(c,e,d,h)};v.cos$1=function(a,b){var e=B(a[0]);return"number"===e.ctype?k.cos(e):u};v.tan$1=function(a,b){var e=B(a[0]);return"number"===e.ctype?k.tan(e):u};v.arccos$1=function(a,b){var e=B(a[0]);return"number"===
e.ctype?k.arccos(e):u};v.arcsin$1=function(a,b){var e=B(a[0]);return"number"===e.ctype?k.arcsin(e):u};v.arctan$1=function(a,b){var e=B(a[0]);return"number"===e.ctype?k.arctan(e):u};v.arctan2$2=function(a,b){var e=B(a[0]),c=B(a[1]);return"number"===e.ctype&&"number"===c.ctype?k.arctan2(e,c):u};v.arctan2$1=function(a,b){var e=B(a[0]);return"list"===e.ctype&&2===e.value.length&&(e=e.value,"number"===e[0].ctype&&"number"===e[1].ctype)?v.arctan2$2(e,b):u};v.log$1=function(a,b){var e=B(a[0]);return"number"===
e.ctype?k.log(e):u};D.recursiveGen=function(a){var b=k[a],e=h[a];v[a+"$1"]=function(a,c){var d=B(a[0]);return"number"===d.ctype?b(d):"list"===d.ctype?e(d):u}};D.recursiveGen("im");D.recursiveGen("re");D.recursiveGen("conjugate");D.recursiveGen("round");D.recursiveGen("ceil");D.recursiveGen("floor");D.recursiveGen("abs");v.abs_infix=v.abs$1;v.random$0=function(a,b){return k.real(k._helper.rand())};v.random$1=function(a,b){var e=B(a[0]);return"number"===e.ctype?k.complex(e.value.real*k._helper.rand(),
e.value.imag*k._helper.rand()):u};v.seedrandom$1=function(a,b){var e=B(a[0]);"number"===e.ctype&&k._helper.seedrandom(e.value.real);return u};v.randomnormal$0=function(a,b){return k.real(k._helper.randnormal())};v.randominteger$1=function(a,b){var e=B(a[0]);if("number"===e.ctype){var c=e.value.real|0,e=e.value.imag|0,c=c*k._helper.rand()|0,e=e*k._helper.rand()|0;return k.complex(c,e)}return u};v.randomint$1=v.randominteger$1;v.randombool$0=function(a,b){return.5<k._helper.rand()?{ctype:"boolean",
value:!0}:{ctype:"boolean",value:!1}};v.isreal$1=function(a,b){var e=A(a[0]);return"number"===e.ctype&&k._helper.isAlmostReal(e)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};v.isinteger$1=function(a,b){var e=A(a[0]);return"number"===e.ctype&&k._helper.isAlmostReal(e)&&e.value.real===Math.floor(e.value.real)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};v.iseven$1=function(a,b){var e=A(a[0]);return"number"===e.ctype&&k._helper.isAlmostReal(e)&&e.value.real/2===Math.floor(e.value.real/
2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};v.isodd$1=function(a,b){var e=A(a[0]);return"number"===e.ctype&&k._helper.isAlmostReal(e)&&(e.value.real-1)/2===Math.floor((e.value.real-1)/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};v.iscomplex$1=function(a,b){return"number"===A(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};v.isstring$1=function(a,b){return"string"===A(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};v.islist$1=function(a,
b){return"list"===A(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};v.ismatrix$1=function(a,b){var e=A(a[0]);return-1!==h._helper.colNumb(e)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};v.iscircle$1=function(a,b){var e=A(a[0]);return"geo"===e.ctype&&"C"===e.value.kind&&"Circle"===e.value.matrix.usage?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};v.isconic$1=function(a,b){var e=A(a[0]);return"geo"===e.ctype&&"C"===e.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",
value:!1}};v.isline$1=function(a,b){var e=A(a[0]);return"geo"===e.ctype&&"L"===e.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};v.ispoint$1=function(a,b){var e=A(a[0]);return"geo"===e.ctype&&"P"===e.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};v.isgeometric$1=function(a,b){return"geo"===A(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};v.isnumbermatrix$1=function(a,b){var e=A(a[0]);return h.isNumberMatrix(e).value?{ctype:"boolean",value:!0}:
{ctype:"boolean",value:!1}};v.isnumbervector$1=function(a,b){var e=A(a[0]);return h.isNumberVector(e).value?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};v.issun$1=function(a,b){var e=A(a[0]);return"geo"===e.ctype&&void 0!==e.value.behavior&&"Sun"===e.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};v.ismass$1=function(a,b){var e=A(a[0]);return"geo"===e.ctype&&void 0!==e.value.behavior&&"Mass"===e.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};
v.isspring$1=function(a,b){var e=A(a[0]);return"geo"===e.ctype&&void 0!==e.value.behavior&&"Spring"===e.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};v.isbouncer$1=function(a,b){var e=A(a[0]);return"geo"===e.ctype&&void 0!==e.value.behavior&&"Bouncer"===e.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};v.isundefined$1=function(a,b){return"undefined"===A(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};v.matrixrowcolumn$1=function(a,
b){var e=A(a[0]);return-1!==h._helper.colNumb(e)?h.realVector([e.value.length,e.value[0].value.length]):u};v.rowmatrix$1=function(a,b){var e=A(a[0]);return"list"===e.ctype?h.turnIntoCSList([e]):u};v.columnmatrix$1=function(a,b){var e=A(a[0]);return"list"===e.ctype?h.turnIntoCSList(e.value.map(function(a){return h.turnIntoCSList([a])})):u};v.submatrix$3=function(a,b){var e=A(a[0]),c=A(a[1]),d=A(a[2]);if("list"===e.ctype&&"number"===c.ctype&&"number"===d.ctype){var f=Math.round(c.value.real),c=Math.round(d.value.real),
e=e.value.slice();0<c&&c<=e.length&&e.splice(c-1,1);var g=!0,e=e.map(function(a){if("list"!==a.ctype)g=!1;else return a=a.value.slice(),0<f&&f<=a.length&&a.splice(f-1,1),h.turnIntoCSList(a)});return g?h.turnIntoCSList(e):u}return u};v.complex$1=function(a,b){var e,c,d;d=B(a[0]);if("list"===d.ctype&&h.isNumberVector(d)){if(2===d.value.length)return e=d.value[0],c=d.value[1],k.complex(e.value.real-c.value.imag,c.value.real+e.value.imag);if(3===d.value.length)return e=d.value[0],c=d.value[1],d=d.value[2],
e=k.div(e,d),c=k.div(c,d),k.complex(e.value.real-c.value.imag,c.value.real+e.value.imag)}return u};v.gauss$1=function(a,b){var e=B(a[0]);return"number"===e.ctype?h.realVector([e.value.real,e.value.imag]):u};v.cross$2=function(a,b){var e=K(a[0]),c=K(a[1]);if(e!==u&&c!==u){var d=h.cross(e,c);"Point"===e.usage&&"Point"===c.usage&&(d=y.withUsage(d,"Line"));"Line"===e.usage&&"Line"===c.usage&&(d=y.withUsage(d,"Point"));return d}return u};v.crossratio$4=function(a,b){var e=A(a[0]),c=A(a[1]),d=A(a[2]),f=
A(a[3]),g=K(e),l=K(c),m=K(d),n=K(f);return g!==u&&l!==u&&m!==u&&n!==u?h.crossratio3(g,l,m,n,h.ii):"number"===e.ctype&&"number"===c.ctype&&"number"===d.ctype&&"number"===f.ctype?k.div(k.mult(k.sub(e,d),k.sub(c,f)),k.mult(k.sub(e,f),k.sub(c,d))):u};v.para$2=function(a,b){var e=B(a[0]),c=B(a[1]),d=K(e),f=K(c);if(e!==u&&c!==u){var c=c.usage,g=d,k=f;if("Line"===e.usage||"Point"===c)g=f,k=d;e=h.cross(h.cross(h.linfty,k),g);return y.withUsage(e,"Line")}return u};v.perp$2=function(a,b){var e=B(a[0]),c=B(a[1]),
d=K(e),f=K(c);if(e!==u&&c!==u){var g=c.usage||f.usage,c=d,l=f;if("Line"===(e.usage||d.usage)||"Point"===g)c=f,l=d;e=h.turnIntoCSList([l.value[0],l.value[1],k.zero]);e=h.cross(e,c);return y.withUsage(e,"Line")}return u};v.perp$1=function(a,b){var e=B(a[0]);return h._helper.isNumberVecN(e,2)?h.turnIntoCSList([k.neg(e.value[1]),e.value[0]]):u};v.parallel$2=v.para$2;v.perpendicular$2=v.perp$2;v.perpendicular$1=v.perp$1;v.meet$2=function(a,b){var e=K(a[0]),c=K(a[1]);return e!==u&&c!==u?(e=h.cross(e,c),
y.withUsage(e,"Point")):u};v.join$2=function(a,b){var e=K(a[0]),c=K(a[1]);return e!==u&&c!==u?(e=h.cross(e,c),y.withUsage(e,"Line")):u};v.dist$2=function(a,b){var e=B(a[0]),c=B(a[1]),e=pb([e,c],[]);return v.abs$1([e],[])};v.dist_infix=v.dist$2;v.point$1=function(a,b){var e=A(a[0]);return h._helper.isNumberVecN(e,3)||h._helper.isNumberVecN(e,2)?y.withUsage(e,"Point"):e};v.line$1=function(a,b){var e=A(a[0]);return h._helper.isNumberVecN(e,3)?y.withUsage(e,"Line"):e};v.det$3=function(a,b){var e=K(a[0]),
c=K(a[1]),d=K(a[2]);if(e!==u&&c!==u&&d!==u)return h.det3(e,c,d)};v.det$1=function(a,b){var e=B(a[0]);if("list"===e.ctype){var c=h._helper.colNumb(e);if(-1!==c&&c===e.value.length)return h.det(e)}return u};v.eig$1=function(a,b){var e=B(a[0]);if("list"===e.ctype){var c=h._helper.colNumb(e);if(-1!==c&&c===e.value.length)return h.eig(e)}return u};v.eigenvalues$1=function(a,b){var e=B(a[0]);if("list"===e.ctype){var c=h._helper.colNumb(e);if(-1!==c&&c===e.value.length)return h.eig(e,!1).value[0]}return u};
v.rank$1=function(a,b){var e=B(a[0]);if("list"===e.ctype){var c=h._helper.colNumb(e);if(-1!==c&&c===e.value.length)return h.rank(e,b.precision)}return u};v.kernel$1=function(a,b){var e=B(a[0]);if("list"===e.ctype){var c=h._helper.colNumb(e);if(-1!==c&&c===e.value.length)return e=h.nullSpace(e,b.precision),h.transpose(e)}return u};v.eigenvectors$1=function(a,b){var e=B(a[0]);if("list"===e.ctype){var c=h._helper.colNumb(e);if(-1!==c&&c===e.value.length)return h.eig(e).value[1]}return u};v.area$3=function(a,
b){var e=K(a[0]),c=K(a[1]),d=K(a[2]);if(e!==u&&c!==u&&d!==u){var f=e.value[2],g=c.value[2],l=d.value[2];if(!k._helper.isAlmostZero(f)&&!k._helper.isAlmostZero(g)&&!k._helper.isAlmostZero(l))return e=h.scaldiv(f,e),c=h.scaldiv(g,c),d=h.scaldiv(l,d),e=h.det3(e,c,d),k.realmult(.5,e)}return u};v.inverse$1=function(a,b){var e=B(a[0]);if("list"===e.ctype){var c=h._helper.colNumb(e);if(-1!==c&&c===e.value.length)return h.inverse(e)}return u};v.linearsolve$2=function(a,b){var e=B(a[0]),c=B(a[1]);if("list"===
e.ctype){var d=h._helper.colNumb(e);if(-1!==d&&d===e.value.length&&h._helper.isNumberVecN(c,d))return h.linearsolve(e,c)}return u};var zc=[[[]],[[0]],[[0,1],[1,0]],[[0,1,2],[0,2,1],[1,0,2],[1,2,0],[2,0,1],[2,1,0]],[[0,1,2,3],[0,1,3,2],[0,2,1,3],[0,2,3,1],[0,3,1,2],[0,3,2,1],[1,0,2,3],[1,0,3,2],[1,2,0,3],[1,2,3,0],[1,3,0,2],[1,3,2,0],[2,0,1,3],[2,0,3,1],[2,1,0,3],[2,1,3,0],[2,3,0,1],[2,3,1,0],[3,0,1,2],[3,0,2,1],[3,1,0,2],[3,1,2,0],[3,2,0,1],[3,2,1,0]]];v.mincostmatching$1=function(a,b){var e=A(a[0]);
if(h.isNumberMatrix(e)){var c=e.value.length,d=h._helper.colNumb(e),f=c<d?d:c,g,l,m=Array(f);for(g=0;g<f;++g)for(m[g]=Array(f),l=0;l<f;++l)m[g][l]=g<c&&l<d?e.value[g].value[l].value.real:0;e=qb(m);f=Array(c);for(g=0;g<c;++g)l=e[g],f[g]=l<d?k.real(l+1):k.real(0);return h.turnIntoCSList(f)}return u};v.length$1=function(a,b){var e=A(a[0]);return"list"===e.ctype||"string"===e.ctype?k.real(e.value.length):u};v.pairs$1=function(a,b){var e=A(a[0]);return"list"===e.ctype?h.pairs(e):u};v.triples$1=function(a,
b){var e=A(a[0]);return"list"===e.ctype?h.triples(e):u};v.cycle$1=function(a,b){var e=A(a[0]);return"list"===e.ctype?h.cycle(e):u};v.consecutive$1=function(a,b){var e=A(a[0]);return"list"===e.ctype?h.consecutive(e):u};v.reverse$1=function(a,b){var e=A(a[0]);return"list"===e.ctype?h.reverse(e):u};v.directproduct$2=function(a,b){var e=A(a[0]),c=A(a[1]);return"list"===e.ctype&&"list"===c.ctype?h.directproduct(e,c):u};v.concat$2=Zb;v.common$2=$b;v.remove$2=ac;v.append$2=bc;v.prepend$2=cc;v.contains$2=
function(a,b){var e=A(a[0]),c=A(a[1]);return"list"===e.ctype?h.contains(e,c):u};v.sort$2=function(a,b){return v.sort$3([a[0],null,a[1]],b)};v.sort$3=function(a,b){var e=B(a[0]);if("list"!==e.ctype)return u;var c="#";null!==a[1]&&"variable"===a[1].ctype&&(c=a[1].name);var e=e.value,d=[];J.newvar(c);var f;for(f=0;f<e.length;f++)J.setvar(c,e[f]),d[f]={val:e[f],result:A(a[2])};J.removevar(c);d.sort(y.compareResults);c=[];for(f=0;f<e.length;f++)c[f]=d[f].val;return{ctype:"list",value:c}};v.sort$1=function(a,
b){var e=A(a[0]);return"list"===e.ctype?h.sort1(e):u};v.set$1=function(a,b){var e=A(a[0]);return"list"===e.ctype?h.set(e):u};v.combinations$2=function(a,b){function e(a,b){a===g?m.push(h.turnIntoCSList(l.slice())):b<f&&(l[a]=c.value[b],e(a+1,b+1),e(a,b+1))}var c=A(a[0]),d=A(a[1]),f,g,l,m;if("number"===d.ctype){g=d.value.real|0;if("number"===c.ctype){f=c.value.real|0;f-g<g&&(g=f-g);if(0>g)return k.real(0);if(0===g)return k.real(1);if(1===g)return c;for(var n=d=1,p=1;p<=g;++p)var t=f-g+p|0,v=p|0,w=
xb(t,v)|0,t=t/w|0,v=v/w|0,w=xb(d,v)|0,d=d/w|0,v=v/w|0,w=xb(t,n)|0,t=t/w|0,n=n/w|0,d=d*t|0,n=n*v|0;return k.real(d/n)}if("list"===c.ctype){f=c.value.length;if(0>g||g>f)return h.turnIntoCSList([]);if(0===g)return h.turnIntoCSList([h.turnIntoCSList([])]);if(g===f)return h.turnIntoCSList([c]);m=[];l=Array(g);e(0,0);return h.turnIntoCSList(m)}}return u};v.zeromatrix$2=function(a,b){var e=B(a[0]),c=B(a[1]);return"number"===e.ctype&&"number"===c.ctype?h.zeromatrix(e,c):u};v.zerovector$1=function(a,b){var e=
B(a[0]);return"number"===e.ctype?h.zerovector(e):u};v.transpose$1=function(a,b){var e=B(a[0]);return"list"===e.ctype&&-1!==h._helper.colNumb(e)?h.transpose(e):u};v.row$2=function(a,b){var e=B(a[0]),c=B(a[1]);return"number"===c.ctype&&"list"===e.ctype&&-1!==h._helper.colNumb(e)?h.row(e,c):u};v.column$2=function(a,b){var e=B(a[0]),c=B(a[1]);return"number"===c.ctype&&"list"===e.ctype&&-1!==h._helper.colNumb(e)?h.column(e,c):u};v.red$1=function(a,b){var e=A(a[0]);return"number"===e.ctype?(e=Math.min(1,
Math.max(0,e.value.real)),h.realVector([e,0,0])):u};v.green$1=function(a,b){var e=A(a[0]);return"number"===e.ctype?(e=Math.min(1,Math.max(0,e.value.real)),h.realVector([0,e,0])):u};v.blue$1=function(a,b){var e=A(a[0]);return"number"===e.ctype?(e=Math.min(1,Math.max(0,e.value.real)),h.realVector([0,0,e])):u};v.gray$1=function(a,b){var e=A(a[0]);return"number"===e.ctype?(e=Math.min(1,Math.max(0,e.value.real)),h.realVector([e,e,e])):u};v.grey$1=v.gray$1;D.HSVtoRGB=function(a,b,e){var c,d,f,g,k,l;a&&
void 0===b&&void 0===e&&(b=a.s,e=a.v,a=a.h);g=Math.floor(6*a);k=6*a-g;a=e*(1-b);l=e*(1-k*b);b=e*(1-(1-k)*b);switch(g%6){case 0:c=e;d=b;f=a;break;case 1:c=l;d=e;f=a;break;case 2:c=a;d=e;f=b;break;case 3:c=a;d=l;f=e;break;case 4:c=b;d=a;f=e;break;case 5:c=e,d=a,f=l}return h.realVector([c,d,f])};v.hue$1=function(a,b){var e=A(a[0]);return"number"===e.ctype?(e=e.value.real,e-=Math.floor(e),D.HSVtoRGB(e,1,1)):u};D.shapeconvert=function(a){var b,e;if("circle"===a.type){b=a.value.value[0];b=y.div(b,b.value[2]);
var c=b.value[0].value.real,d=b.value[1].value.real;a=a.value.value[1].value.real;e=[];var f=2*Math.PI/36;for(b=0;36>b;b++)e[b]={X:c+Math.cos(b*f)*a,Y:d+Math.sin(b*f)*a};return[e]}if("polygon"===a.type){c=[];for(b=0;b<a.value.length;b++){d=a.value[b];e=[];for(f=0;f<d.length;f++)e[f]={X:d[f].X,Y:d[f].Y};c[b]=e}return c}};D.shapeop=function(a,b,e){a=D.shapeconvert(a);var c=D.shapeconvert(b);ClipperLib.JS.ScaleUpPaths(a,1E3);ClipperLib.JS.ScaleUpPaths(c,1E3);b=new ClipperLib.Clipper;b.AddPaths(a,ClipperLib.PolyType.ptSubject,
!0);b.AddPaths(c,ClipperLib.PolyType.ptClip,!0);var c=a=ClipperLib.PolyFillType.pftNonZero,d=new ClipperLib.Paths;b.Execute(e,d,a,c);ClipperLib.JS.ScaleDownPaths(d,1E3);return{ctype:"shape",type:"polygon",value:d}};D.shapecommon=function(a,b){return D.shapeop(a,b,ClipperLib.ClipType.ctIntersection)};D.shaperemove=function(a,b){return D.shapeop(a,b,ClipperLib.ClipType.ctDifference)};D.shapeconcat=function(a,b){return D.shapeop(a,b,ClipperLib.ClipType.ctUnion)};v.key$0=function(a,b){return{ctype:"string",
value:Ub}};v.keycode$0=function(a,b){return k.real(Vb)};v.mouse$0=function(a,b){return h.realVector([$a[0],$a[1]])};v.mover$0=function(a,b){if(da&&da.mover)return{ctype:"geo",value:da.mover,type:"P"};console.log("Not moving anything at the moment");return u};v.translate$1=function(a,b){var e=B(a[0]);"list"===e.ctype&&h.isNumberVector(e)&&2===e.value.length&&x.translate(e.value[0].value.real,e.value[1].value.real);return u};v.rotate$1=function(a,b){var e=B(a[0]);"number"===e.ctype&&x.rotate(e.value.real);
return u};v.scale$1=function(a,b){var e=B(a[0]);"number"===e.ctype&&x.scale(e.value.real);return u};v.greset$0=function(a,b){var e=Fa.stack.length;x.greset();for(var c=0;c<e;c++)C.restore();return u};v.gsave$0=function(a,b){x.gsave();C.save();return u};v.grestore$0=function(a,b){x.grestore();C.restore();return u};v.color$1=function(a,b){var e=B(a[0]);"list"===e.ctype&&h.isNumberVector(e).value&&x.setcolor(e);return u};v.linecolor$1=function(a,b){var e=B(a[0]);"list"===e.ctype&&h.isNumberVector(e).value&&
x.setlinecolor(e);return u};v.pointcolor$1=function(a,b){var e=B(a[0]);"list"===e.ctype&&h.isNumberVector(e).value&&x.setpointcolor(e);return u};v.alpha$1=function(a,b){var e=B(a[0]);"number"===e.ctype&&x.setalpha(e);return u};v.pointsize$1=function(a,b){var e=B(a[0]);"number"===e.ctype&&x.setpointsize(e);return u};v.linesize$1=function(a,b){var e=B(a[0]);"number"===e.ctype&&x.setlinesize(e);return u};v.textsize$1=function(a,b){var e=B(a[0]);"number"===e.ctype&&x.settextsize(e);return u};v.playanimation$0=
function(a,b){f();return u};v.pauseanimation$0=function(a,b){za();return u};v.stopanimation$0=function(a,b){T();return u};v.replace$3=function(a,b){var e=A(a[0]),c=A(a[1]),d=A(a[2]);if("string"===e.ctype&&"string"===c.ctype&&"string"===d.ctype)return e=e.value,e=e.replace(new RegExp(c.value,"g"),d.value),{ctype:"string",value:e}};v.replace$2=function(a,b){function e(a,b,e){var f="";d=c=-1;for(var r=0;r<b.length;r++){var h=b[r][0],g=a.indexOf(h,e);-1!==g&&(-1===c?(f=h,c=g,d=r):g<c&&(f=h,c=g,d=r))}return f}
var c,d,f,h=A(a[0]);f=A(a[1]);if("string"===h.ctype&&"list"===f.ctype){for(var h=h.value,g=[],k=0;k<f.value.length;k++){var l=f.value[k];"list"===l.ctype&&2===l.value.length&&"string"===l.value[0].ctype&&"string"===l.value[1].ctype&&(g[g.length]=[l.value[0].value,l.value[1].value])}c=-1;for(f=e(h,g,0);-1!==c;)h=h.substring(0,c)+g[d][1]+h.substring(c+f.length,h.length),f=c+g[d][1].length,f=e(h,g,f);return{ctype:"string",value:h}}return u};v.substring$3=function(a,b){var e=A(a[0]),c=B(a[1]),d=B(a[2]);
return"string"===e.ctype&&"number"===c.ctype&&"number"===d.ctype?{ctype:"string",value:e.value.substring(Math.floor(c.value.real),Math.floor(d.value.real))}:u};v.tokenize$2=function(a,b){var e,c;e=A(a[0]);var d=A(a[1]);if("string"===e.ctype&&"string"===d.ctype){var f=!0;void 0!==b.autoconvert&&(c=A(b.autoconvert),"boolean"===c.ctype&&(f=c.value));d=e.value.split(d.value);e=[];for(c=0;c<d.length;c++){var g=d[c];if(f){var k=parseFloat(g);isNaN(k)||(g=k)}e[c]={ctype:"string",value:g}}return h.turnIntoCSList(e)}if("string"===
e.ctype&&"list"===d.ctype){if(0===d.value.length)return e;e=d.value[0];f=h.turnIntoCSList(f);g=v.tokenize$2([a[0],e],b).value;e=[];for(c=0;c<g.length;c++){f=[];for(k=1;k<d.value.length;k++)f[k-1]=d.value[k];f=h.turnIntoCSList(f);e[c]=v.tokenize$2([g[c],f],b)}return h.turnIntoCSList(e)}return u};v.indexof$2=function(a,b){var e=A(a[0]),c=A(a[1]);return"string"===e.ctype&&"string"===c.ctype?(e=e.value.indexOf(c.value),k.real(e+1)):u};v.indexof$3=function(a,b){var e=A(a[0]),c=A(a[1]),d=A(a[2]);return"string"===
e.ctype&&"string"===c.ctype&&"number"===d.ctype?(e=e.value,c=c.value,d=Math.round(d.value.real),d=e.indexOf(c,d-1),k.real(d+1)):u};v.parse$1=function(a,b){var e=A(a[0]);return"string"===e.ctype?(e=ab(e.value),e=ma(e),A(e)):u};v.unicode$1=function(a,b){var e;e=A(a[0]);var c=16;if(b.base){var d=A(b.base);"number"===d.ctype&&(c=d.value.real)}if("string"===e.ctype)e=parseInt(e.value,c);else if("number"===e.ctype)e=e.value.real;else return u;"undefined"!==typeof String.fromCodePoint?e=String.fromCodePoint(e):
65535>=e?e=String.fromCharCode(e):(e-=65536,e=String.fromCharCode((e>>10)+55296,(e&1023)+56320));return y.string(e)};v.international$1=function(a,b){return v.international$2([a[0],null],b)};v.international$2=function(a,b){var e=A(a[0]);if("string"!==e.ctype)return u;var c=(n.translations||{})[n.language||"en"]||{};if(!c.hasOwnProperty(e.value))return e;var d=c[e.value];if("string"===typeof d)return y.string(d);if(null===a[1])return e;var f=A(a[1]),f="number"===f.ctype?f.value.real:0,c=(c._pluralFormFunction||
Ac)(f);return c<d.length?y.string(d[c]):e};v.currentlanguage$0=function(a,b){return y.string(n.language||"en")};D.basismap=function(a,b,e,c){var d=h.turnIntoCSList([a,b,e]),d=h.inverse(h.transpose(d));c=y.mult(d,c);d=h.turnIntoCSList([y.mult(c.value[0],a),y.mult(c.value[1],b),y.mult(c.value[2],e)]);return h.transpose(d)};v.map$8=function(a,b){var e=K(a[0]),c=K(a[1]),d=K(a[2]),f=K(a[3]),g=K(a[4]),k=K(a[5]),l=K(a[6]),m=K(a[7]);return g!==u&&k!==u&&l!==u&&m!==u&&e!==u&&c!==u&&d!==u&&f!==u?(g=D.basismap(g,
k,l,m),e=D.basismap(e,c,d,f),e=y.mult(g,h.inverse(e)),h.normalizeMax(e)):u};v.map$6=function(a,b){var e=K(a[0]),c=K(a[1]),d=K(a[2]),f=h.realVector([0,0,1]),g=h.cross,k=g(g(d,g(f,g(e,c))),g(c,g(f,g(e,d)))),l=K(a[3]),m=K(a[4]),n=K(a[5]),f=g(g(n,g(f,g(l,m))),g(m,g(f,g(l,n))));return l!==u&&m!==u&&n!==u&&f!==u&&e!==u&&c!==u&&d!==u&&k!==u?(l=D.basismap(l,m,n,f),e=D.basismap(e,c,d,k),e=y.mult(l,h.inverse(e)),h.normalizeMax(e)):u};v.map$4=function(a,b){var e=h.ii,c=h.jj,d=K(a[0]),f=K(a[1]),g=K(a[2]),k=K(a[3]);
return g!==u&&k!==u&&d!==u&&f!==u?(g=D.basismap(g,k,e,c),e=D.basismap(d,f,e,c),e=y.mult(g,h.inverse(e)),h.normalizeMax(e)):u};v.map$2=function(a,b){var e=h.ii,c=h.jj,d=K(a[0]),f=y.add(h.realVector([1,0,0]),d),g=K(a[1]),k=y.add(h.realVector([1,0,0]),g);return g!==u&&k!==u&&d!==u&&f!==u?(g=D.basismap(g,k,e,c),e=D.basismap(d,f,e,c),e=y.mult(g,h.inverse(e)),h.normalizeMax(e)):u};v.pointreflect$1=function(a,b){var e=h.ii,c=h.jj,d=K(a[0]),f=y.add(h.realVector([1,0,0]),d),g=y.add(h.realVector([-1,0,0]),
d);return g!==u&&d!==u&&f!==u?(g=D.basismap(d,g,e,c),e=D.basismap(d,f,e,c),e=y.mult(g,h.inverse(e)),h.normalizeMax(e)):u};v.linereflect$1=function(a,b){var e=h.ii,c=h.jj,d=K(a[0]),f=h.realVector([Math.random(),Math.random(),Math.random()]),g=h.realVector([Math.random(),Math.random(),Math.random()]),f=h.cross(f,d),g=h.cross(g,d);return d!==u&&f!==u?(d=D.basismap(f,g,e,c),e=D.basismap(f,g,c,e),e=y.mult(d,h.inverse(e)),h.normalizeMax(e)):u};D.extractPointVec=function(a){var b={ok:!1};if("geo"===a.ctype){var e=
a.value;if("P"===e.kind)return b.x=sa.getField(e,"x"),b.y=sa.getField(e,"y"),b.z=k.real(1),b.ok=!0,b}if("list"!==a.ctype)return b;var c=a.value;if(2===c.length&&(a=c[0],e=c[1],"number"===a.ctype&&"number"===e.ctype))return b.x=a,b.y=e,b.z=k.real(1),b.ok=!0,b;3===c.length&&(a=c[0],e=c[1],c=c[2],"number"===a.ctype&&"number"===e.ctype&&"number"===c.ctype&&(b.x=k.div(a,c),b.y=k.div(e,c),b.z=k.real(1),b.ok=!0));return b};v.polygon$1=function(a,b){var e=A(a[0]);if("list"===e.ctype){for(var c=[],d=0;d<e.value.length;d++){var f=
D.extractPoint(e.value[d]);if(!f.ok)return u;c[d]={X:f.x,Y:f.y}}return{ctype:"shape",type:"polygon",value:[c]}}return u};v.circle$2=function(a,b){var e=B(a[0]),c=B(a[1]),e=D.extractPointVec(e);if(!e.ok||"number"!==c.ctype)return u;e=h.turnIntoCSList([e.x,e.y,e.z]);return{ctype:"shape",type:"circle",value:h.turnIntoCSList([e,c])}};v.screen$0=function(a,b){var e=x.drawingstate.initialmatrix,c=function(a,b){var c=a-e.tx,d=b+e.ty;return{X:(c*e.d-d*e.b)/e.det,Y:-(-c*e.c+d*e.a)/e.det}};return{ctype:"shape",
type:"polygon",value:[[c(0,0),c(ga,0),c(ga,Y),c(0,Y)]]}};v.allpoints$0=function(a,b){for(var e=[],c=0;c<S.length;c++)e[c]={ctype:"geo",value:S[c],type:"P"};return{ctype:"list",value:e}};v.allmasses$0=function(a,b){for(var e=[],c=0;c<W.length;c++)e[c]={ctype:"geo",value:W[c],type:"P"};return{ctype:"list",value:e}};v.alllines$0=function(a,b){for(var e=[],c=0;c<Q.length;c++)e[c]={ctype:"geo",value:Q[c],type:"L"};return{ctype:"list",value:e}};v.halfplane$2=function(a,b){var e=B(a[0]),c=B(a[1]),d=K(e),
f=K(c);if(e!==u&&c!==u){var g=c.usage,c=f;if("Line"===e.usage||"Point"===g)d=f,c=e;e=h.turnIntoCSList([c.value[0],c.value[1],k.zero]);e=h.cross(e,d);f=h.cross(c,e);f=y.div(f,f.value[2]);d=y.div(d,d.value[2]);d=h.sub(d,f);e=h.abs(d);d=y.div(d,e);e=f.value[0].value.real;f=f.value[1].value.real;c=1E3*d.value[0].value.real;d=1E3*d.value[1].value.real;return{ctype:"shape",type:"polygon",value:[[{X:e+d/2,Y:f-c/2},{X:e+d/2+c,Y:f-c/2+d},{X:e-d/2+c,Y:f+c/2+d},{X:e-d/2,Y:f+c/2}]]}}return u};v.convexhull3d$1=
function(a,b){var e=A(a[0]);if("list"===e.ctype){var c=e.value;if(4>c.length)return console.error("Less than four input points specified"),u;for(var d=[],f,e=0;e<c.length;e++)if(h._helper.isNumberVecN(c[e],3))for(f=0;3>f;f++)d.push(c[e].value[f].value.real);f=convexhull(d);c=f[0];d=[];for(e=0;e<c.length;e+=3)d.push(h.realVector([c[e],c[e+1],c[e+2]]));for(var c=h.turnIntoCSList(d),d=f[1],g=[],e=0;e<d.length;e++){for(f=0;f<d[e].length;f++)d[e][f]++;g.push(h.realVector(d[e]))}e=h.turnIntoCSList(g);return h.turnIntoCSList([c,
e])}return u};v.javascript$1=function(a,b){var e=A(a[0]);"string"===e.ctype&&(new Function(e.value)).call(Aa);return u};v.use$1=function(a,b){function e(a,b,e){var c=v[a];v[a]=function(d,f){if(d.length===b)return e(d,f);if(c)return c(d,f);throw"No implementation for "+a+"("+b+")";}}var c=A(a[0]);if("string"===c.ctype){var c=c.value,d;n.plugins&&(d=n.plugins[c]);d||(d=Ca._pluginRegistry[c]);if(d)return d({instance:Aa,config:n,nada:u,evaluate:A,evaluateAndVal:B,defineFunction:e,addShutdownHook:Xa.push.bind(Xa),
addAutoCleaningEventListener:X,getVariable:J.getvar.bind(J),getInitialMatrix:function(){return x.drawingstate.initialmatrix},setTextRenderer:function(a){nc=a}}),{ctype:"boolean",value:!0};console.log("Plugin "+c+" not found");return{ctype:"boolean",value:!1}}return u};v.format$2=function(a,b){function e(a){a=a.toFixed(h);var b;do b=a,a=a.substring(0,a.length-1);while(""!==a&&"-"!==a&&+a===+b);return""+b}function c(a){var b;return"number"===a.ctype?(b=e(a.value.real),a=e(a.value.imag),b="0"===a?b:
"-"===a.substring(0,1)?b+" - i*"+a.substring(1):b+" + i*"+a,{ctype:"string",value:b}):"list"===a.ctype?{ctype:"list",value:a.value.map(c)}:{ctype:"string",value:E(a).toString()}}var d=B(a[0]),f=B(a[1]),h;return"number"!==d.ctype&&"list"!==d.ctype||"number"!==f.ctype?u:(h=Math.round(f.value.real),c(d))};Date.now||(Date.now=function(){return(new Date).getTime()});var oc=0;v.seconds$0=function(a,b){return{ctype:"number",value:{real:(Date.now()-oc)/1E3,imag:0}}};v.resetclock$0=function(a,b){oc=Date.now();
return u};v.time$0=function(a,b){var e=new Date;return h.realVector([e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()])};v.date$0=function(a,b){var e=new Date;return h.realVector([e.getFullYear(),e.getMonth(),e.getDay()])};v.setTimeout$2=function(a,b){function e(){A(d);xa()}var c=A(a[0]),d=a[1];"number"===c.ctype&&"undefined"!==typeof window&&window.setTimeout(e,1E3*c.value.real);return u};D.formatForWebGL=function(a){return a.toFixed(10)};v.generateWebGL$2=function(a,b){var e=D.formatForWebGL,
c=a[0],d=A(a[1]);console.log(d);if("list"!==d.ctype)return u;for(var f=[],h=0;h<d.value.length;h++)"string"===d.value[h].ctype&&f.push(d.value[h].value);console.log("***********");console.log(f);d=D.plotvars(c);console.log(d);-1===d.indexOf("a")&&-1===d.indexOf("b")&&-1===d.indexOf("c")&&-1===d.indexOf("d")&&-1===d.indexOf("e")&&-1===d.indexOf("f")&&(c=B(c));if("number"===c.ctype)return{ctype:"string",value:"vec2("+e(c.value.real)+","+e(c.value.imag)+")"};if("variable"===c.ctype)return{ctype:"string",
value:c.name};if("string"===c.ctype||"void"===c.ctype)return c;if(2===c.args.length&&("infix"===c.ctype||"function"===c.ctype)){e=v.compileToWebGL$1([c.args[0]],{});d=v.compileToWebGL$1([c.args[1]],{});if("+"===c.oper||"add"===c.oper)return void 0===e.value||"void"===e.ctype?{ctype:"string",value:d.value}:{ctype:"string",value:"addc("+e.value+","+d.value+")"};if("*"===c.oper||"mult"===c.oper)return{ctype:"string",value:"multc("+e.value+","+d.value+")"};if("/"===c.oper||"div"===c.oper)return{ctype:"string",
value:"divc("+e.value+","+d.value+")"};if("-"===c.oper||"sub"===c.oper)return void 0===e.value||"void"===e.ctype?{ctype:"string",value:"negc("+d.value+")"}:{ctype:"string",value:"subc("+e.value+","+d.value+")"};if("^"===c.oper||"pow"===c.oper)return{ctype:"string",value:"powc("+e.value+","+d.value+")"}}if("function"===c.ctype&&1===c.args.length){e=v.compileToWebGL$1([c.args[0]],{});if("sin$1"===c.oper)return{ctype:"string",value:"sinc("+e.value+")"};if("cos$1"===c.oper)return{ctype:"string",value:"cosc("+
e.value+")"};if("tan$1"===c.oper)return{ctype:"string",value:"tanc("+e.value+")"};if("exp$1"===c.oper)return{ctype:"string",value:"expc("+e.value+")"};if("log$1"===c.oper)return{ctype:"string",value:"logc("+e.value+")"};if("arctan$1"===c.oper)return{ctype:"string",value:"arctanc("+e.value+")"};if("arcsin$1"===c.oper)return{ctype:"string",value:"arcsinc("+e.value+")"};if("arccos$1"===c.oper)return{ctype:"string",value:"arccosc("+e.value+")"};if("sqrt$1"===c.oper)return{ctype:"string",value:"sqrtc("+
e.value+")"}}return u};v.compileToWebGL$1=function(a,b){var e,c;e=D.formatForWebGL;var d=a[0];c=D.plotvars(d);-1===c.indexOf("a")&&-1===c.indexOf("b")&&-1===c.indexOf("c")&&-1===c.indexOf("d")&&-1===c.indexOf("e")&&-1===c.indexOf("f")&&(d=B(d));if("number"===d.ctype)return{ctype:"string",value:"vec2("+e(d.value.real)+","+e(d.value.imag)+")"};if("variable"===d.ctype)return{ctype:"string",value:d.name};if("string"===d.ctype||"void"===d.ctype)return d;if(2===d.args.length&&("infix"===d.ctype||"function"===
d.ctype)){e=v.compileToWebGL$1([d.args[0]],{});c=v.compileToWebGL$1([d.args[1]],{});if("+"===d.oper||"add"===d.oper)return void 0===e.value||"void"===e.ctype?{ctype:"string",value:c.value}:{ctype:"string",value:"addc("+e.value+","+c.value+")"};if("*"===d.oper||"mult"===d.oper)return{ctype:"string",value:"multc("+e.value+","+c.value+")"};if("/"===d.oper||"div"===d.oper)return{ctype:"string",value:"divc("+e.value+","+c.value+")"};if("-"===d.oper||"sub"===d.oper)return void 0===e.value||"void"===e.ctype?
{ctype:"string",value:"negc("+c.value+")"}:{ctype:"string",value:"subc("+e.value+","+c.value+")"};if("^"===d.oper||"pow"===d.oper)return{ctype:"string",value:"powc("+e.value+","+c.value+")"}}if("function"===d.ctype&&1===d.args.length){e=v.compileToWebGL$1([d.args[0]],{});if("sin$1"===d.oper)return{ctype:"string",value:"sinc("+e.value+")"};if("cos$1"===d.oper)return{ctype:"string",value:"cosc("+e.value+")"};if("tan$1"===d.oper)return{ctype:"string",value:"tanc("+e.value+")"};if("exp$1"===d.oper)return{ctype:"string",
value:"expc("+e.value+")"};if("log$1"===d.oper)return{ctype:"string",value:"logc("+e.value+")"};if("arctan$1"===d.oper)return{ctype:"string",value:"arctanc("+e.value+")"};if("arcsin$1"===d.oper)return{ctype:"string",value:"arcsinc("+e.value+")"};if("arccos$1"===d.oper)return{ctype:"string$1",value:"arccosc("+e.value+")"};if("sqrt$1"===d.oper)return{ctype:"string",value:"sqrtc("+e.value+")"}}return u};v.setsimulationspeed$1=function(a,b){var e=B(a[0]);"number"===e.ctype&&"undefined"!==typeof I&&"undefined"!==
typeof I.env&&(I.env.deltat=e.value.real);return u};v.setsimulationaccuracy$1=function(a,b){var e=B(a[0]);"number"===e.ctype&&"undefined"!==typeof I&&"undefined"!==typeof I.env&&(I.env.accuracy=e.value.real);return u};v.setsimulationquality$1=function(a,b){var e=B(a[0]);"number"===e.ctype&&"undefined"!==typeof I&&"undefined"!==typeof I.env&&(e=e.value.real,0===e&&(I.env.errorbound=.01,I.env.lowestdeltat=1E-5,I.env.slowdownfactor=2),1===e&&(I.env.errorbound=.001,I.env.lowestdeltat=1E-7,I.env.slowdownfactor=
2),2===e&&(I.env.errorbound=1E-5,I.env.lowestdeltat=1E-10,I.env.slowdownfactor=4),3===e&&(I.env.errorbound=1E-6,I.env.lowestdeltat=1E-12,I.env.slowdownfactor=4));return u};D.extractPoint=function(a){var b={ok:!1};if("geo"===a.ctype){var e=a.value;if("P"===e.kind)return b.x=sa.getField(e,"x").value.real,b.y=sa.getField(e,"y").value.real,b.ok=!0,b}if("list"!==a.ctype)return b;var c=a.value;if(2===c.length&&(a=c[0],e=c[1],"number"===a.ctype&&"number"===e.ctype))return b.x=a.value.real,b.y=e.value.real,
b.ok=!0,b;3===c.length&&(a=c[0],e=c[1],c=c[2],"number"===a.ctype&&"number"===e.ctype&&"number"===c.ctype&&(a=k.div(a,c),e=k.div(e,c),b.x=a.value.real,b.y=e.value.real,b.ok=!0));return b};v.draw$1=function(a,b){var e=B(a[0]);if("shape"===e.ctype)D.drawshape(e,b);else if("Line"===e.usage)z.handleModifs(b,z.lineModifs),z.drawline(e);else{var c=D.extractPoint(e);if(!c.ok){if("undefined"!==typeof e.value&&2===e.value.length)return v.draw$2(e.value,b);return}null!==b&&z.handleModifs(b,z.pointModifs);z.drawpoint(c)}return u};
v.draw$2=function(a,b){var e=B(a[0]),c=B(a[1]),e=D.extractPoint(e),c=D.extractPoint(c);if(!e.ok||!c.ok)return u;null!==b&&z.handleModifs(b,z.lineModifs);z.drawsegcore(e,c);return u};v.drawcircle$2=function(a,b){return D.drawcircle(a,b,"D")};v.fillcircle$2=function(a,b){return D.drawcircle(a,b,"F")};v.drawarc$3=function(a,b){return D.drawarc(a,b,"D")};v.fillarc$3=function(a,b){return D.drawarc(a,b,"F")};D.drawarc=function(a,b,e){var c=K(a[0]),d=K(a[1]);a=K(a[2]);if(!h._helper.isAlmostReal(h.turnIntoCSList([c,
d,a])))return u;var f=h.det3(c,d,a);if(1E-12<Math.abs(f.value.real)){var f=w._helper.ConicBy5(null,c,d,a,h.ii,h.jj),g=w._helper.CenterOfConic(f),g=h.normalizeMax(g),f=k.real(0),l=h.turnIntoCSList([h.turnIntoCSList([g.value[2],f,k.neg(g.value[0])]),h.turnIntoCSList([f,g.value[2],k.neg(g.value[1])]),h.turnIntoCSList([f,f,g.value[2]])]),f=h.normalizeZ(y.mult(l,c));h.normalizeZ(y.mult(l,d));l=h.normalizeZ(y.mult(l,a));f=-Math.atan2(f.value[1].value.real,f.value[0].value.real);l=-Math.atan2(l.value[1].value.real,
l.value[0].value.real);g=h.normalizeZ(g);c=h.normalizeZ(c);d=h.normalizeZ(d);a=h.normalizeZ(a);var m=h.abs(h.sub(c,g)),n=[g.value[0].value.real,g.value[1].value.real],p=x.drawingstate.matrix,g=n[0]*p.a-n[1]*p.b+p.tx,n=n[0]*p.c-n[1]*p.d-p.ty,c=0<h.det3(c,d,a).value.real;z.handleModifs(b,z.conicModifs);b=1.6;null!==z.size&&(b=z.size);C.save();C.lineWidth=b;C.strokeStyle=z.lineColor;b=m.value.real*p.sdet;C.beginPath();C.translate(g,n);f>l&&(l+=2*Math.PI);c=c?-(2*Math.PI-l+f)/500:(l-f)/500;C.moveTo(b*
Math.cos(f),b*Math.sin(f));for(a=0;500>=a;a++)d=f+a*c,C.lineTo(b*Math.cos(d),b*Math.sin(d));"F"===e&&(C.fillStyle=z.lineColor,C.closePath(),C.fill());"D"===e&&C.stroke();C.restore()}else{if("D"!==e)return u;e=D.extractPoint(c);l=D.extractPoint(d);f=D.extractPoint(a);if(!e.ok||!l.ok||!f.ok)return u;m=(e.x-l.x)*(e.x-l.x)+(e.y-l.y)*(e.y-l.y);p=(e.x-f.x)*(e.x-f.x)+(e.y-f.y)*(e.y-f.y);g=(f.x-l.x)*(f.x-l.x)+(f.y-l.y)*(f.y-l.y);if(1E-12>m||1E-12>p||1E-12>g)return u;c=0>h.crossratio3(c,a,d,h.cross(h.cross(c,
d),h.linfty),h.ii).value.real;null!==b&&(null===b.size&&(b.size=k.real(1.6)),z.handleModifs(b,z.conicModifs));c?z.drawsegcore(e,f):(c=m>g?1:-1,b=c*(e.x-l.x),c*=e.y-l.y,d=Math.sqrt(b*b+c*c),d=25E3/x.drawingstate.matrix.sdet/d,b*=d,c*=d,z.drawsegcore(e,{x:e.x+b,y:e.y+c}),z.drawsegcore(f,{x:f.x-b,y:f.y-c}))}return u};D.drawcircle=function(a,b,e){var c=B(a[0]);a=B(a[1]);var d=D.extractPoint(c);if(!d.ok||"number"!==a.ctype)return u;var c=x.drawingstate.matrix,f=d.x*c.a-d.y*c.b+c.tx,d=d.x*c.c-d.y*c.d-c.ty;
z.handleModifs(b,z.conicModifs);b=1.6;null!==z.size&&(b=z.size);C.lineWidth=b;C.beginPath();C.arc(f,d,a.value.real*c.sdet,0,2*Math.PI);"D"===e&&(C.strokeStyle=z.lineColor,C.stroke());"F"===e&&(C.fillStyle=z.lineColor,C.fill());"C"===e&&C.clip();return u};v.drawconic$1=function(a,b){var e={usage:"conic"},c=B(a[0]);if("list"!==c.ctype||3!==c.value.length&&6!==c.value.length)return console.error("could not parse conic"),u;if(6===c.value.length){for(var d=0;6>d;d++)if("number"!==c.value[d].ctype)return console.error("could not parse conic"),
u;var f=k.real(.5),d=c.value[0],g=c.value[2],g=k.mult(g,f),l=c.value[1],m=c.value[3],m=k.mult(m,f),n=c.value[4],n=k.mult(n,f),c=c.value[5],c=h.turnIntoCSList([h.turnIntoCSList([d,g,m]),h.turnIntoCSList([g,l,n]),h.turnIntoCSList([m,n,c])])}else{for(d=0;3>d;d++)for(g=0;3>g;g++)if("number"!==c.value[d].value[g].ctype)return console.error("could not parse conic"),u;h.equals(c,h.transpose(c)).value||(d=y.mult(c,k.real(.5)),c=y.mult(h.transpose(c),k.real(.5)),c=h.add(d,c))}e.matrix=c;return D.drawconic(e,
b)};D.drawconic=function(a,b){z.handleModifs(b,z.conicModifs);var e=1.6;null!==z.size&&(e=z.size);if(0!==e){C.lineWidth=e;for(var c=a.matrix,d=a.matrix,f=0;2>f;f++)for(var g=0;2>g;g++)if(1E-14<Math.abs(c.value[f].value[g].value.imag))return;f=h.turnIntoCSList([h.realVector([-1,-1,1]),h.realVector([1,0,0]),h.realVector([0,1,0])]);g=x.from(0,0,1);g[2]=1;var k=x.from(1,0,1);k[2]=1;var l=x.from(0,1,1);l[2]=1;var g=h.turnIntoCSList([h.realVector(g),h.realVector(k),h.realVector(l)]),g=h.transpose(g),f=
y.mult(g,f),f=h.inverse(f),c=y.mult(h.transpose(f),c),c=y.mult(c,f),f=c.value[0].value[0].value.real,g=c.value[1].value[0].value.real,k=c.value[1].value[1].value.real,l=c.value[2].value[0].value.real,m=c.value[2].value[1].value.real,n=c.value[2].value[2].value.real,c=[[f,g,l],[g,k,m],[l,m,n]],p=1E-14>Math.abs(f*k*n-f*m*m-g*g*n+2*g*l*m-k*l*l),t=ga>Y?ga:Y,A=-1.5*t,B=1.5*t,D=-1.5*t,E=1.5*t,ta=1;p&&(ta=0);if(ta)var l=0,l=1E-14<Math.abs(f-g)?Math.atan(g/f-k)/2:Math.PI/4,F=function(a){var b=Math.cos(a);
a=Math.sin(a);return[[b,-a,0],[a,b,0],[0,0,1]]}(l),F=h.realMatrix(F),f=h.transpose(F),c=y.mult(h.realMatrix(c),F),c=y.mult(f,c),f=c.value[0].value[0].value.real,g=c.value[1].value[0].value.real,k=c.value[1].value[1].value.real,l=c.value[2].value[0].value.real,m=c.value[2].value[1].value.real,n=c.value[2].value[2].value.real;var c=[f,g,k,l,m,n],f=function(){var a=w._helper.splitDegenConic(d);if(a!==u){var c=a[1],a=[a[0]];v.draw$1(a,b);a[0]=c;v.draw$1(a,b)}},G=function(a){"undefined"!==a&&6===a.length||
console.error("this does not define a Conic");if(p)return"degenerate";a=a[0]*a[2]-a[1]*a[1];return 1E-14>Math.abs(a)?"parabola":1E-14<a?"ellipsoid":"hyperbola"};G(c);var H=function(a,b){return 0<a&&a<ga&&0<b&&b<Y},I=[],J=[],K=[],L=[],M=[],N=[],P=function(){I=[];J=[];K=[];L=[];M=[];N=[]},O=function(a,b){C.strokeStyle=z.lineColor;C.lineWidth=e;C.beginPath();C.moveTo(a[0],b[0]);for(var c=1;c<a.length;c++)C.lineTo(a[c],b[c]);C.stroke()},Q=function(a,b,c){var e,d,f=G(a);if(6!==a.length)console.error("Conic needs 6 Parameters");
else{var g=a[0],r=a[1],q=a[2],k=a[3],l=a[4];a=a[5];var m;e=c-b;for(var n=.05*e+b,u=c-.05*e,p=b;p<=c;p+=m){m=p<n||p>u||100>Math.abs(c-b)?.5:0>p||p>Y?10:3;d=-g*q*Math.pow(p,2)-2*g*l*p-g*a+Math.pow(r,2)*Math.pow(p,2)+2*r*k*p+Math.pow(k,2);d=Math.sqrt(d);e=1/g*(-r*p-k+d);d=-1/g*(r*p+k+d);var Ba,t;ta?(Ba=[e,p,1],t=[d,p,1],Ba=y.mult(F,h.realVector(Ba)),t=y.mult(F,h.realVector(t)),e=Ba.value[0].value.real,d=t.value[0].value.real,Ba=Ba.value[1].value.real,t=t.value[1].value.real):t=Ba=p;isNaN(e)||"ellipsoid"!==
f?!isNaN(e)&&e>=A&&e<=B&&(I.push(e),K.push(Ba)):(I.push(e),K.push(Ba));isNaN(d)||"ellipsoid"!==f?!isNaN(d)&&d>=A&&d<=B&&(J.push(d),L.push(t)):(J.push(d),L.push(t))}}},g=function(a){var b,c,e;G(a);if(6!==a.length)console.error("Conic needs 6 Parameters");else{e=a[0];var d=a[1],f=a[2],g=a[3],h=a[4],r=a[5];b=-e*h+d*g;c=Math.sqrt(e*(-e*f*r+e*Math.pow(h,2)+Math.pow(d,2)*r-2*d*g*h+f*Math.pow(g,2)));f=e*f-Math.pow(d,2);0!==f?(e=(b-c)/f,c=(b+c)/f):c=e=(-e*r+g*g)/(2*e*h-2*d*g);!isNaN(e)&&e>D&&e<E||(e=D);!isNaN(c)&&
c>D&&c<E||(c=D);b=e<c?e:c;c=e>c?e:c;Q(a,D,b);M=I.concat(J.reverse());N=K.concat(L.reverse());O(M,N);P();Q(a,c,E);O(I,K);if(H(I[0],K[1])||H(J[0],L[0]))C.beginPath(),C.moveTo(I[0],K[0]),C.lineTo(J[0],L[0]),C.stroke();O(J,L);P();Q(a,b,c);O(I,K);C.beginPath();C.moveTo(I[0],K[0]);C.lineTo(J[0],L[0]);C.stroke();C.beginPath();C.moveTo(I[I.length-1],K[K.length-1]);C.lineTo(J[J.length-1],L[L.length-1]);C.stroke();O(J,L);P()}};p?f():g(c)}};v.drawall$1=function(a,b){var c=A(a[0]);if("list"===c.ctype){z.handleModifs(b,
z.pointAndLineModifs);for(var d=0;d<c.value.length;d++)v.draw$1([c.value[d]],null)}return u};v.connect$1=function(a,b){return D.drawpolygon(a,b,"D",!1)};v.drawpoly$1=function(a,b){return D.drawpolygon(a,b,"D",!0)};v.fillpoly$1=function(a,b){return D.drawpolygon(a,b,"F",!0)};v.drawpolygon$1=function(a,b){return D.drawpolygon(a,b,"D",!0)};v.fillpolygon$1=function(a,b){return D.drawpolygon(a,b,"F",!0)};D.drawpolygon=function(a,b,c,d){function f(){for(var a=k.value,b=0;b<a.length;b++){var c=a[b],e;for(e=
0;e<c.length;e++){var d=c[e],g=d.X*h.a-d.Y*h.b+h.tx,d=d.X*h.c-d.Y*h.d-h.ty;0===e?C.moveTo(g,d):C.lineTo(g,d)}C.closePath()}}function g(){var a;for(a=0;a<k.value.length;a++){var b=D.extractPoint(k.value[a]);if(!b.ok)return;var c=b.x*h.a-b.y*h.b+h.tx,b=b.x*h.c-b.y*h.d-h.ty;0===a?C.moveTo(c,b):C.lineTo(c,b)}d&&C.closePath()}z.handleModifs(b,z.conicModifs);b=1.6;null!==z.size&&(b=z.size);C.lineWidth=b;C.mozFillRule="evenodd";C.lineJoin="round";var h=x.drawingstate.matrix,k=A(a[0]);C.beginPath();"list"===
k.ctype&&g();"shape"===k.ctype&&f();"D"===c&&(C.strokeStyle=z.lineColor,C.stroke());"F"===c&&(C.fillStyle=z.lineColor,C.fill());"C"===c&&C.clip();return u};var nc=function(a,b,c,d,f){var g=a.measureText(b).width;a.fillText(b,c-g*f,d)};v.drawtext$2=function(a,b){var c=B(a[0]),d=A(a[1]),f=D.extractPoint(c);if(!f.ok)return u;var g=x.drawingstate.matrix,c=f.x*g.a-f.y*g.b+g.tx,f=f.x*g.c-f.y*g.d-g.ty;z.handleModifs(b,z.textModifs);g=x.drawingstate.textsize;null!==z.size&&(g=z.size);C.fillStyle=z.textColor;
C.font=z.bold+z.italics+Math.round(10*g)/10+"px "+z.family;d=E(d);nc(C,d,c+z.xOffset,f-z.yOffset,z.align);return u};D.drawshape=function(a,b){return"polygon"===a.type?D.drawpolygon([a],b,"D",1):"circle"===a.type?D.drawcircle([a.value.value[0],a.value.value[1]],b,"D"):u};D.fillshape=function(a,b){return"polygon"===a.type?D.drawpolygon([a],b,"F",1):"circle"===a.type?D.drawcircle([a.value.value[0],a.value.value[1]],b,"F"):u};D.clipshape=function(a,b){return"polygon"===a.type?D.drawpolygon([a],b,"C",
1):"circle"===a.type?D.drawcircle([a.value.value[0],a.value.value[1]],b,"C"):u};v.fill$1=function(a,b){var c=A(a[0]);return"shape"===c.ctype?D.fillshape(c,b):u};v.clip$1=function(a,b){var c=A(a[0]);return"shape"===c.ctype?D.clipshape(c,b):"list"===c.ctype?(c=v.polygon$1(a,[]),v.clip$1([c],[])):u};v.plot$1=function(a,b){return v.plot$2([a[0],null],b)};v.plot$2=function(a,b){function c(a){return"number"===a.ctype&&k._helper.isAlmostReal(a)}function d(a,b,c,e,f){m++;b=+b.value.real;f=+e.value.real;e=
b*F.a-f*F.b+F.tx;b=b*F.c-f*F.d-F.ty;a=+a.value.real;f=+c.value.real;c=a*F.a-f*F.b+F.tx;a=a*F.c-f*F.d-F.ty;n?(C.lineTo(c,a),C.lineTo(e,b)):(C.beginPath(),C.moveTo(c,a),C.lineTo(e,b),n=!0)}function f(a,b,h,r,m){var p=c(h),u=c(r);if(.001>m)!g&&n&&(C.stroke(),n=!1);else if(p||u){var t=k.real((a.value.real+b.value.real)/2);J.setvar(B,t);var v=A(y),w=c(v);if(p&&u&&w){var x=h.value.real,u=v.value.real,w=r.value.real;if(p=1>Math.abs(x+w-2*u)/l){var z=k.real((a.value.real+t.value.real)/2);J.setvar(B,z);var z=
A(y),sb=k.real((t.value.real+b.value.real)/2);J.setvar(B,sb);sb=A(y).value.real;x=Math.abs(x+u-2*z.value.real)/l;u=Math.abs(u+w-2*sb)/l;p=p&&1>x&&1>u}p?(d(a,t,h,v,m/2),d(t,b,v,r,m/2)):(f(a,t,h,v,m/2),f(t,b,v,r,m/2))}else f(a,t,h,v,m/2),f(t,b,v,r,m/2)}}var g=!1,l=.2/eb,m=0,n=!1,p=-10,t=10,v=1,w=1E3,y=a[0],B;if(null!==a[1]&&"variable"===a[1].ctype)B=a[1].name;else{var E=D.plotvars(y);B="#";-1!==E.indexOf("t")&&(B="t");-1!==E.indexOf("z")&&(B="z");-1!==E.indexOf("y")&&(B="y");-1!==E.indexOf("x")&&(B=
"x")}J.newvar(B);var F=x.drawingstate.matrix;z.handleModifs(b,{color:!0,alpha:!0,size:!0,dashpattern:!0,dashtype:!0,dashing:!0,connect:function(a){"boolean"===a.ctype&&(g=a.value)},start:function(a){"number"===a.ctype&&(p=a.value.real)},stop:function(a){"number"===a.ctype&&(t=a.value.real)},steps:function(a){"number"===a.ctype&&(w=a.value.real)}});C.strokeStyle=z.lineColor;C.lineWidth=z.lsize;C.lineCap="round";C.lineJoin="round";var ta,G,H,I,n=!1,E=k.real(14.32);J.setvar(B,E);H=A(y);if("number"!==
H.ctype){if(h.isNumberVector(H).value&&2===H.value.length){n=!1;v=(t-p)/w;for(E=p;E<t;E+=v)J.setvar(B,k.real(E)),I=A(y),h.isNumberVector(I).value&&2===I.value.length&&(ta=+I.value[0].value.real,G=+I.value[1].value.real,I=ta*F.a-G*F.b+F.tx,ta=ta*F.c-G*F.d-F.ty,n?C.lineTo(I,ta):(C.beginPath(),C.moveTo(I,ta),n=!0));C.stroke();J.removevar(B)}return u}for(I=p;I<t+v;I+=v)E=k.real(I),J.setvar(B,E),H=A(y),E.value.real>p&&f(ta,E,G,H,v),ta=E,G=H;J.removevar(B);n&&C.stroke();return u};v.plotX$1=function(a,b){var c=
a[0],d=D.plotvars(c),f="#";-1!==d.indexOf("t")&&(f="t");-1!==d.indexOf("z")&&(f="z");-1!==d.indexOf("y")&&(f="y");-1!==d.indexOf("x")&&(f="x");J.newvar(f);d=x.drawingstate.matrix;C.fillStyle=x.drawingstate.linecolor;C.lineWidth=1;C.lineCap="round";for(var g=!1,h=-10;10>h;h+=.01){J.setvar(f,k.real(h));var l=A(c);if("number"===l.ctype){var m=+l.value.real,l=h*d.a-m*d.b+d.tx,m=h*d.c-m*d.d-d.ty;g?C.lineTo(l,m):(C.beginPath(),C.moveTo(l,m),g=!0)}}C.stroke();J.removevar(f);return u};D.plotvars=function(a){function b(a,
c){var e={},d;for(d=a.length-1;0<=d;--d)e[a[d]]=a[d];for(d=c.length-1;0<=d;--d)e[c[d]]=c[d];d=[];for(var f in e)e.hasOwnProperty(f)&&d.push(e[f]);return d}function c(a,b){for(var e=0;e<a.length;e++)a[e]===b&&(a.splice(e,1),e--);return a}var d,f,g,h;if("variable"===a.ctype)return[a.name];if("infix"===a.ctype)return d=D.plotvars(a.args[0]),a=D.plotvars(a.args[1]),b(d,a);if("list"===a.ctype){g=a.value;f=[];for(h=0;h<g.length;h++)d=D.plotvars(g[h]),f=b(f,d);return f}if("function"===a.ctype){g=a.args;
f=[];for(h=0;h<g.length;h++)d=D.plotvars(g[h]),f=b(f,d);"apply"!==a.oper&&"select"!==a.oper&&"forall"!==a.oper&&"sum"!==a.oper&&"product"!==a.oper&&"repeat"!==a.oper&&"min"!==a.oper&&"max"!==a.oper&&"sort"!==a.oper||"variable"!==a.args[1].ctype||(f=c(f,a.args[1].name));return f}return[]};v.clrscr$0=function(a,b){"undefined"!==typeof ga&&"undefined"!==typeof Y&&C.clearRect(0,0,ga,Y);return u};v.repaint$0=function(a,b){xa();return u};v.screenbounds$0=function(a,b){var c=y.withUsage(h.realVector(x.to(0,
0)),"Point"),d=y.withUsage(h.realVector(x.to(ga,0)),"Point"),f=y.withUsage(h.realVector(x.to(ga,Y)),"Point"),g=y.withUsage(h.realVector(x.to(0,Y)),"Point");return h.turnIntoCSList([c,d,f,g])};v.createimage$3=function(a,b){var c=A(a[0]),d=B(a[1]),f=B(a[2]);if("number"!==d.ctype||"number"!==f.ctype||"string"!==c.ctype)return u;var g=document.createElement("canvas");g.id=c.value;g.width=d.value.real;g.height=f.value.real;g.style.display="none";document.body.appendChild(g);ea[c.value]=g;return u};v.clearimage$1=
function(a,b){var c=A(a[0]);if("string"!==c.ctype)return u;c=document.getElementById(c.value);if("undefined"===typeof c||null===c)return u;var d=c.width,f=c.height;c.getContext("2d").clearRect(0,0,d,f);return u};v.canvas$4=function(a,b){var c=B(a[0]),d=B(a[1]),f=A(a[2]),g=a[3],h=D.extractPoint(c),k=D.extractPoint(d);if(!h.ok||!k.ok||"string"!==f.ctype)return u;f=document.getElementById(f.value);if("undefined"===typeof f||null===f)return u;var c=f.width,d=f.height,l=k.x-h.x,m=k.y-h.y,n=h.x-m*d/c,p=
h.y+l*d/c,m=k.x-m*d/c,l=k.y+l*d/c,k=x.from(h.x,h.y,1),n=x.from(n,p,1),m=x.from(m,l,1),h=k[0],p=k[1],l=n[0],t=n[1],v=m[0],w=m[1],n=c*(p-t)/((h-l)*(p-w)-(h-v)*(p-t)),c=c*(h-l)/((p-t)*(h-v)-(p-w)*(h-l)),m=-n*h-c*p,k=(d*(p-w)-d*(p-t))/((h-l)*(p-w)-(h-v)*(p-t)),l=(d*(h-v)-d*(h-l))/((p-t)*(h-v)-(p-w)*(h-l)),d=d-k*h-l*p,f=f.getContext("2d"),h=C;C=f;C.save();C.transform(n,k,c,l,m,d);A(g);C.restore();C=h};v.canvas$5=function(a,b){var c=B(a[0]),d=B(a[1]),f=B(a[2]),g=A(a[3]),h=a[4],c=D.extractPoint(c),d=D.extractPoint(d),
k=D.extractPoint(f);if(!c.ok||!d.ok||!k.ok||"string"!==g.ctype)return u;g=document.getElementById(g.value);if("undefined"===typeof g||null===g)return u;var l=g.width,f=g.height,m=x.from(c.x,c.y,1),n=x.from(d.x,d.y,1),d=x.from(k.x,k.y,1),c=m[0],k=m[1],p=n[0],t=n[1],v=d[0],w=d[1],d=((0-l)*(k-w)-0*(k-t))/((c-p)*(k-w)-(c-v)*(k-t)),l=((0-l)*(c-v)-0*(c-p))/((k-t)*(c-v)-(k-w)*(c-p)),n=0-d*c-l*k,m=((f-f)*(k-w)-(f-0)*(k-t))/((c-p)*(k-w)-(c-v)*(k-t)),p=((f-f)*(c-v)-(f-0)*(c-p))/((k-t)*(c-v)-(k-w)*(c-p)),f=
f-m*c-p*k,g=g.getContext("2d"),c=C;C=g;C.save();C.transform(d,m,l,p,n,f);A(h);C.restore();C=c};v.screenresolution$0=function(a,b){return k.real(x.drawingstate.matrix.a)};v.layer$1=function(a,b){};D.extractReferenceX=function(a,b){};v.imagesize$1=function(a,b){var c=B(a[0]);return"string"===c.ctype&&ea[c.value]?h.realVector([ea[c.value].width,ea[c.value].height]):u};v.drawimage$2=function(a,b){function c(){var a=1,e=1,d=1,g=1,k=0,q=1,m=D.extractPoint(f);if(!m.ok||"string"!==l.ctype)return u;C.save();
var n;void 0!==b.angle&&(n=A(b.angle),"number"===n.ctype&&(k=n.value.real));void 0!==b.rotation&&(n=A(b.rotation),"number"===n.ctype&&(k=n.value.real));void 0!==b.scale&&(n=B(b.scale),"number"===n.ctype&&(e=a=n.value.real),h.isNumberVector(n).value&&2===n.value.length&&(a=n.value[0].value.real,e=n.value[1].value.real));void 0!==b.scalex&&(n=A(b.scalex),"number"===n.ctype&&(a=n.value.real));void 0!==b.scaley&&(n=A(b.scaley),"number"===n.ctype&&(e=n.value.real));void 0!==b.flipx&&(n=A(b.flipx),"boolean"===
n.ctype&&n.value&&(d=-1));void 0!==b.flipy&&(n=A(b.flipy),"boolean"===n.ctype&&n.value&&(g=-1));void 0!==b.alpha&&(n=A(b.alpha),"number"===n.ctype&&(q=n.value.real));var p=x.drawingstate.matrix,t=x.drawingstate.initialmatrix;n=ea[l.value].width;var v=ea[l.value].height,w=m.x*p.a-m.y*p.b+p.tx,gb=m.x*p.c-m.y*p.d-p.ty,y=(m.x+1)*p.a-m.y*p.b+p.tx-w,p=(m.x+1)*p.c-m.y*p.d-p.ty-gb,z=(m.x+1)*t.a-m.y*t.b+t.tx-(m.x*t.a-m.y*t.b+t.tx),t=(m.x+1)*t.c-m.y*t.d-t.ty-(m.x*t.c-m.y*t.d-t.ty),m=Math.sqrt(y*y+p*p)/Math.sqrt(z*
z+t*t),y=-Math.atan2(y,p)+Math.atan2(z,t);1!==q&&(C.globalAlpha=q);C.translate(w,gb);C.scale(a*d*m,e*g*m);C.rotate(k+y);C.translate(-w,-gb);C.translate(-n/2,-v/2);C.drawImage(ea[l.value],w,gb);C.globalAlpha=1;C.restore()}function d(){var a=1,c=1,e=1,h=1,q=D.extractPoint(f),m=D.extractPoint(g),n;if(!q.ok||!m.ok||"string"!==l.ctype)return u;if(void 0!==ea&&void 0!==ea[l.value]){var p=ea[l.value].width,t=ea[l.value].height;if(0===k)n={},n.x=q.x-(m.y-q.y),n.y=q.y+(m.x-q.x),h=t/p;else if(n=D.extractPoint(k),
!q.ok)return u;C.save();var v;void 0!==b.alpha&&(v=A(b.alpha),"number"===v.ctype&&(a=v.value.real));void 0!==b.aspect&&(v=A(b.aspect),"number"===v.ctype&&(h=v.value.real));void 0!==b.flipx&&(v=A(b.flipx),"boolean"===v.ctype&&v.value&&(c=-1));void 0!==b.flipy&&(v=A(b.flipy),"boolean"===v.ctype&&v.value&&(e=-1));v=x.drawingstate.matrix;1!==a&&(C.globalAlpha=a);a=q.x*v.a-q.y*v.b+v.tx;q=q.x*v.c-q.y*v.d-v.ty;C.transform(m.x*v.a-m.y*v.b+v.tx-a,m.x*v.c-m.y*v.d-v.ty-q,n.x*v.a-n.y*v.b+v.tx-a,n.x*v.c-n.y*v.d-
v.ty-q,a,q);C.scale(1/p,-1/t*h);C.translate(p/2,-t/2);C.scale(c,e);C.translate(-p/2,t/2);C.translate(0,-t);C.drawImage(ea[l.value],0,0);C.globalAlpha=1;C.restore()}}var f,g,k,l;return 2===a.length?(f=B(a[0]),l=B(a[1]),c()):3===a.length?(f=B(a[0]),g=B(a[1]),k=0,l=B(a[2]),d()):4===a.length?(f=B(a[0]),g=B(a[1]),k=B(a[2]),l=B(a[3]),d()):u};v.drawimage$3=v.drawimage$2;v.drawimage$4=v.drawimage$2;var Kb;Kb=[0,0,0,0,0,0,0,0,0,0,0,0];v.playsin$1=function(a,b){var c=B(a[0]),d=0;if("number"===c.ctype){var f;
void 0!==b.line&&(f=A(b.line),"number"===f.ctype&&(d=Math.floor(f.value.real),0>d&&(d=0),10<d&&(d=10)));c=c.value.real;0!==Kb[d]&&Kb[d].set({freq:c})}return u};var L={printArr:function(a){for(var b=a.value.length,c=[],d=[],f=!1,g=0;g<b;g++)c[g]=a.value[g].value.real,d[g]=a.value[g].value.imag,0!==d[g]&&(f=!0);console.log(c);f&&console.log(d)},zero:function(a){for(var b=[],c=k.real(0),d=0;d<a.value.real;d++)b[d]=c;return h.turnIntoCSList(b)},number:function(a,b){var c=L.zero(b);c.value[0]=a;return c},
variable:function(a,b){var c=L.zero(b);c.value[0]=a;c.value[1]=k.real(1);return c},add:function(a,b){return h.add(a,b)},sub:function(a,b){return h.sub(a,b)},mult:function(a,b){if(a.value.length!==b.value.length)return console.error("dims don't fit return nada"),u;for(var c=a.value.length,d=L.zero(k.real(c)),f=k.real(0),g=0;g<c;g++){for(var h=0;h<=g;h++)f=k.add(f,k.mult(a.value[h],b.value[g-h]));d.value[g]=f;f=k.real(0)}return d},pow:function(a,b){if(0>b.value.real||b.value.real!==Math.floor(b.value.real))return L.root(a,
b);for(var c=a,d=1;d<b.value.real;d++)c=L.mult(c,a);return c},root:function(a,b){var c=k.real(0),d=k.real(1),f=k.add(d,b),g=a.value.length,h=L.zero(k.real(g));h.value[0]=k.pow(a.value[0],b);for(var l=c,m,n,p=1;p<g;p++){n=k.real(p);for(var t=1;t<=p;t++)m=k.mult(f,k.real(t)),m=k.div(m,n),m=k.sub(m,d),m=k.mult(m,a.value[t]),m=k.mult(m,h.value[p-t]),l=k.add(l,m);l=k.div(l,a.value[0]);h.value[p]=l;l=c}return h},findFirstNoneZero:function(a,b,c){for(var d=Infinity,f=Infinity,g=c;g<a.value.length;g++)if(1E-12<
k.abs2(a.value[g]).value.real){d=g;break}for(a=c;a<b.value.length;a++)if(1E-12<k.abs2(b.value[a]).value.real){f=a;break}return[d,f]},div:function(a,b){if(a.value.length!==b.value.length)return console.log("dims don't fit - return nada"),u;for(var c=a.value.length,d=k.real(0),f=L.zero(k.real(c)),g=d,h=d,l=0;l<c;l++){h=L.findFirstNoneZero(a,b,l);l<h[0]&&h[0]===h[1]&&Infinity!==h[0]&&(a.value.splice(l,h[0]),b.value.splice(l,h[0]),f.value.splice(l,h[0]),c-=h[0]);for(var h=a.value[l],m=0;m<l;m++)g=k.add(g,
k.mult(f.value[m],b.value[l-m]));h=k.sub(h,g);h=k.div(h,b.value[0]);f.value[l]=h;g=d}return f},exp:function(a){var b=k.real(0),c=a.value.length,d=L.zero(k.real(c)),f=b,g;d.value[0]=k.exp(a.value[0]);for(var h=1;h<c;h++){for(var l=1;l<=h;l++)g=k.mult(k.real(l),a.value[l]),g=k.mult(g,d.value[h-l]),f=k.add(f,g);d.value[h]=k.div(f,k.real(h));f=b}return d},log:function(a){var b=k.real(0),c=a.value.length,d=L.zero(k.real(c));d.value[0]=k.log(a.value[0]);for(var f=b,g,h,l=1;l<c;l++){g=a.value[l];for(var m=
1;m<l;m++)h=k.mult(k.real(m),d.value[m]),h=k.mult(h,a.value[l-m]),f=k.add(f,h);f=k.div(f,k.real(l));g=k.sub(g,f);g=k.div(g,a.value[0]);d.value[l]=g;f=b}return d},sincos:function(a){var b=k.real(0),c=a.value.length,d=L.zero(k.real(c)),f=L.zero(k.real(c));d.value[0]=k.sin(a.value[0]);f.value[0]=k.cos(a.value[0]);for(var g=b,h=b,l,m,n,p=1;p<c;p++){n=k.real(p);for(var t=1;t<=p;t++)m=k.mult(k.real(t),a.value[t]),l=k.mult(m,f.value[p-t]),m=k.mult(m,d.value[p-t]),h=k.add(h,l),g=k.add(g,m);h=k.div(h,n);g=
k.div(g,k.neg(n));d.value[p]=h;f.value[p]=g;g=h=b}L.sinsave=d;L.cossave=f;return[d,f]},sin:function(a){return L.sincos(a)[0]},cos:function(a){return L.sincos(a)[1]},faculty:function(a){var b=[];b[0]=k.real(1);for(var c=1,d=1;d<=a.value.real;d++)c*=d,b[d]=k.real(c);return b=h.turnIntoCSList(b)},diff:function(a,b,c,d){var f;if("variable"===a.ctype)f=a.name!==b?L.number(A(a),d):L.variable(c,d);else if("number"===a.ctype)f=L.number(a,d);else{if("infix"===a.ctype){if("*"===a.oper)return L.mult(L.diff(a.args[0],
b,c,d),L.diff(a.args[1],b,c,d));if("^"===a.oper)return L.pow(L.diff(a.args[0],b,c,d),L.diff(a.args[1],b,c,d).value[0]);if("/"===a.oper)return L.div(L.diff(a.args[0],b,c,d),L.diff(a.args[1],b,c,d));if("+"===a.oper)return L.add(L.diff(a.args[0],b,c,d),L.diff(a.args[1],b,c,d));if("-"===a.oper)return L.sub(L.diff(a.args[0],b,c,d),L.diff(a.args[1],b,c,d));console.log("infix not found",a.oper);return u}if("function"===a.ctype){if("exp$1"===a.oper)return L.exp(L.diff(a.args[0],b,c,d));if("log$1"===a.oper)return L.log(L.diff(a.args[0],
b,c,d));if("sin$1"===a.oper)return L.sin(L.diff(a.args[0],b,c,d));if("cos$1"===a.oper)return L.cos(L.diff(a.args[0],b,c,d))}else return console.log("ctype not found",a.ctype),u}return f},adevaluate:function(a,b,c,d){a=L.diff(a,b,c,d);d=L.faculty(d);for(b=2;b<a.value.length;b++)a.value[b]=k.mult(a.value[b],d.value[b]);return a},autodiff:function(a,b,c,d){for(var f=[],g=c.value.length,k,l=0;l<g;l++)k=L.adevaluate(a,b,c.value[l],d),f[l]=k;return f=h.turnIntoCSList(f)}},z={handleModifs:function(a,b){z.dashing&&
z.unSetDash();z.colorraw=null;z.size=null;0>=z.psize&&(z.psize=0);0>=z.lsize&&(z.lsize=0);z.overhang=1;z.dashing=!1;z.isArrow=!1;z.arrowSides="==>";z.arrowposition=1;z.headlen=10;z.arrowShape="default";z.alpha=x.drawingstate.alpha;z.bold="";z.italics="";z.family="Arial";z.align=0;z.xOffset=0;z.yOffset=0;var c,d;for(c in a)(d=b[c])?(!0===d&&(d=z.modifHandlers[c]),d(A(a[c]))):console.log("Modifier not supported: "+c);null!==z.size?z.psize=z.lsize=z.size:(z.psize=x.drawingstate.pointsize,z.lsize=x.drawingstate.linesize);
z.dashing&&z.dashing(z.lsize);null!==z.colorraw?z.pointColor=z.lineColor=z.textColor=z.makeColor(z.colorraw):1===z.alpha?(z.pointColor=x.drawingstate.pointcolor,z.lineColor=x.drawingstate.linecolor,z.textColor=x.drawingstate.textcolor):(z.pointColor=z.makeColor(x.drawingstate.pointcolorraw),z.lineColor=z.makeColor(x.drawingstate.linecolorraw),z.textColor=z.makeColor(x.drawingstate.textcolorraw));z.black=1===z.alpha?"rgb(0,0,0)":"rgba(0,0,0,"+z.alpha+")"},sin30deg:.5};z.cos30deg=Math.sqrt(.75);z.modifHandlers=
{size:function(a){"number"===a.ctype&&(z.size=a.value.real,0>z.size&&(z.size=0),1E3<z.size&&(z.size=1E3))},color:function(a){h.isNumberVector(a).value&&3===a.value.length&&(z.colorraw=[a.value[0].value.real,a.value[1].value.real,a.value[2].value.real])},alpha:function(a){"number"===a.ctype&&(z.alpha=a.value.real)},dashpattern:function(a){if("list"===a.ctype){for(var b=[],c=0,d=0;c<a.value.length;c++)"number"===a.value[c].ctype&&(b[d++]=a.value[c].value.real);z.dashing=z.setDash.bind(null,b)}},dashtype:function(a){"number"===
a.ctype&&(z.dashing=z.setDashType.bind(null,Math.floor(a.value.real)))},dashing:function(a){"number"===a.ctype&&(a=Math.floor(a.value.real),z.dashing=z.setDash.bind(null,[2*a,a]))},overhang:function(a){"number"===a.ctype&&(z.overhang=z.overhang*a.value.real+(1-z.overhang)*(1-a.value.real))},arrow:function(a){"boolean"===a.ctype?z.isArrow=a.value:console.error("arrow needs to be of type boolean")},arrowshape:function(a){"string"===a.ctype?(z.arrowShape=a.value,z.isArrow=!0):console.error("arrowshape needs to be of type string")},
arrowsides:function(a){"string"!==a.ctype?console.error("arrowsides is not of type string"):"==>"!==a.value&&"<==>"!==a.value&&"<=="!==a.value?console.error("arrowsides is unknows"):(z.arrowSides=a.value,z.isArrow=!0)},arrowposition:function(a){"number"!==a.ctype?console.error("arrowposition is not of type number"):0>a.value.real?console.error("arrowposition has to be positive"):1<a.value.real?z.overhang=z.overhang*a.value.real+(1-z.overhang)*(1-a.value.real):(z.arrowposition=a.value.real,z.isArrow=
!0)},arrowsize:function(a){"number"!==a.ctype?console.error("arrowsize is not of type number"):0>a.value.real?console.error("arrowsize has to be positive"):z.headlen*=a.value.real},bold:function(a){"boolean"===a.ctype&&a.value&&(z.bold="bold ")},italics:function(a){"boolean"===a.ctype&&a.value&&(z.italics="italic ")},family:function(a){"string"===a.ctype&&(z.family=a.value)},align:function(a){"string"===a.ctype&&(a=a.value,"left"===a&&(z.align=0),"right"===a&&(z.align=1),"mid"===a&&(z.align=.5))},
x_offset:function(a){"number"===a.ctype&&(z.xOffset=a.value.real)},y_offset:function(a){"number"===a.ctype&&(z.yOffset=a.value.real)},offset:function(a){"list"===a.ctype&&2===a.value.length&&"number"===a.value[0].ctype&&"number"===a.value[1].ctype&&(z.xOffset=a.value[0].value.real,z.yOffset=a.value[1].value.real)}};z.lineModifs={size:!0,color:!0,alpha:!0,dashpattern:!0,dashtype:!0,dashing:!0,overhang:!0,arrow:!0,arrowshape:!0,arrowsides:!0,arrowposition:!0,arrowsize:!0};z.pointModifs={size:!0,color:!0,
alpha:!0};z.pointAndLineModifs=z.lineModifs;z.conicModifs=z.pointModifs;z.textModifs={size:!0,color:!0,alpha:!0,bold:!0,italics:!0,family:!0,align:!0,x_offset:!0,y_offset:!0,offset:!0};z.makeColor=function(a){return"rgba("+Math.floor(255*a[0])+","+Math.floor(255*a[1])+","+Math.floor(255*a[2])+","+z.alpha+")"};z.drawsegcore=function(a,b){function c(a,b,e){var d=a-e*y,f=b-e*B;C.beginPath();"full"===z.arrowShape&&(C.lineWidth=z.lsize/2);var g=a-e*A;e=b-e*D;C.moveTo(d,f);C.lineTo(a,b);C.lineTo(g,e);"full"===
z.arrowShape?(C.fillStyle=z.lineColor,C.closePath(),C.fill()):"default"!==z.arrowShape&&console.error("arrowshape is unknown");C.stroke()}var d=x.drawingstate.matrix,f=a.x*d.a-a.y*d.b+d.tx,g=a.x*d.c-a.y*d.d-d.ty,h=b.x*d.a-b.y*d.b+d.tx,k=b.x*d.c-b.y*d.d-d.ty,l=z.overhang,m=1-l,d=l*f+m*h,n=l*g+m*k,p=l*h+m*f,l=l*k+m*g;C.lineWidth=z.lsize;C.lineCap="round";C.lineJoin="miter";C.strokeStyle=z.lineColor;if(!z.isArrow||f===g&&h===k).01>z.lsize||(C.beginPath(),C.moveTo(d,n),C.lineTo(p,l),C.stroke());else{var f=
h-f,g=k-g,h=Math.sqrt(f*f+g*g),m=f/h,t=g/h,k=z.arrowposition,u=1-k,g=k*d+u*p,f=k*n+u*l,h=k*p+u*d,k=k*l+u*n,u=z.headlen,v=z.sin30deg,w=z.cos30deg,y=u*(m*w+t*v),A=u*(m*w-t*v),B=u*(t*w-m*v),D=u*(t*w+m*v),m=z.arrowSides;C.beginPath();"full"===z.arrowShape?("<==>"===m||"<=="===m?(t=g+y,u=f+B,v=g+A,w=f+D,1>z.arrowposition&&(C.moveTo(d,n),C.lineTo(g,f)),C.moveTo((t+v)/2,(u+w)/2)):C.moveTo(d,n),"==>"===m||"<==>"===m?(C.lineTo((h-y+(h-A))/2,(k-B+(k-D))/2),1>z.arrowposition&&(C.moveTo(h,k),C.lineTo(p,l))):
C.lineTo(p,l)):(C.moveTo(d,n),C.lineTo(p,l));C.stroke();"==>"!==m&&"<==>"!==m||c(h,k,1);"<=="!==m&&"<==>"!==m||c(g,f,-1)}};z.drawpoint=function(a){var b=x.drawingstate.matrix,c=a.x*b.a-a.y*b.b+b.tx;a=a.x*b.c-a.y*b.d-b.ty;C.lineWidth=.3*z.psize;C.beginPath();C.arc(c,a,z.psize,0,2*Math.PI);C.fillStyle=z.pointColor;C.fill();C.beginPath();C.arc(c,a,1.15*z.psize,0,2*Math.PI);C.fillStyle=z.black;C.strokeStyle=z.black;C.stroke()};z.drawline=function(a){var b=k.abs(a.value[0]).value.real,c=k.abs(a.value[1]).value.real,
d=k.abs(a.value[2]).value.real,f;b>=c&&b>=d&&(f=a.value[0]);c>=b&&c>=d&&(f=a.value[1]);d>=c&&d>=b&&(f=a.value[2]);b=k.div(a.value[0],f);c=k.div(a.value[1],f);a=k.div(a.value[2],f);a=[b.value.real,c.value.real,a.value.real];Math.abs(a[0])<Math.abs(a[1])?(b=[1,0,30],f=[-1,0,30]):(b=[0,1,30],f=[0,-1,30]);b=[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]];a=[a[1]*f[2]-a[2]*f[1],a[2]*f[0]-a[0]*f[2],a[0]*f[1]-a[1]*f[0]];z.drawsegcore({x:b[0]/b[2],y:b[1]/b[2]},{x:a[0]/a[2],y:a[1]/a[2]})};z.setDash=
function(a,b){for(var c=Math.sqrt(b),d=0;d<a.length;d++)a[d]*=c;C.webkitLineDash=a;C.setLineDash(a);C.mozDash=a};z.unSetDash=function(){C.webkitLineDash=[];C.setLineDash([]);C.mozDash=[]};z.setDashType=function(a,b){0===a&&z.setDash([]);1===a&&z.setDash([10,10],b);2===a&&z.setDash([10,4],b);3===a&&z.setDash([1,3],b);4===a&&z.setDash([10,5,1,5],b)};var Fa={},x={drawingstate:{}};x.drawingstate.linecolor="rgb(0,0,255)";x.drawingstate.linecolorraw=[0,0,1];x.drawingstate.pointcolor="rgb(255,200,0)";x.drawingstate.pointcolorraw=
[1,.78,0];x.drawingstate.textcolor="rgb(0,0,0)";x.drawingstate.textcolorraw=[0,0,0];x.drawingstate.alpha=1;x.drawingstate.pointsize=4;x.drawingstate.linesize=1;x.drawingstate.textsize=20;x.drawingstate.matrix={};x.drawingstate.matrix.a=25;x.drawingstate.matrix.b=0;x.drawingstate.matrix.c=0;x.drawingstate.matrix.d=25;x.drawingstate.matrix.tx=250;x.drawingstate.matrix.ty=250;x.drawingstate.matrix.det=x.drawingstate.matrix.a*x.drawingstate.matrix.d-x.drawingstate.matrix.b*x.drawingstate.matrix.c;x.drawingstate.matrix.sdet=
Math.sqrt(x.drawingstate.matrix.det);x.drawingstate.initialmatrix={};x.drawingstate.initialmatrix.a=x.drawingstate.matrix.a;x.drawingstate.initialmatrix.b=x.drawingstate.matrix.b;x.drawingstate.initialmatrix.c=x.drawingstate.matrix.c;x.drawingstate.initialmatrix.d=x.drawingstate.matrix.d;x.drawingstate.initialmatrix.tx=x.drawingstate.matrix.tx;x.drawingstate.initialmatrix.ty=x.drawingstate.matrix.ty;x.drawingstate.initialmatrix.det=x.drawingstate.matrix.det;x.drawingstate.initialmatrix.sdet=x.drawingstate.matrix.sdet;
x.clone=function(a){if(null===a||"object"!==typeof a)return a;var b=a.constructor(),c;for(c in a)b[c]=x.clone(a[c]);return b};Fa.backup=x.clone(x.drawingstate);Fa.stack=[];x.clone(x.drawingstate);x.reset=function(){x.drawingstate.matrix.a=x.drawingstate.initialmatrix.a;x.drawingstate.matrix.b=x.drawingstate.initialmatrix.b;x.drawingstate.matrix.c=x.drawingstate.initialmatrix.c;x.drawingstate.matrix.d=x.drawingstate.initialmatrix.d;x.drawingstate.matrix.tx=x.drawingstate.initialmatrix.tx;x.drawingstate.matrix.ty=
x.drawingstate.initialmatrix.ty;x.drawingstate.matrix.det=x.drawingstate.initialmatrix.det;x.drawingstate.matrix.sdet=x.drawingstate.initialmatrix.sdet};x.from=function(a,b,c){a/=c;b/=c;c=x.drawingstate.matrix;return[a*c.a-b*c.b+c.tx,a*c.c-b*c.d-c.ty]};x.to=function(a,b){var c=x.drawingstate.matrix,d=a-c.tx,f=b+c.ty;return[(d*c.d-f*c.b)/c.det,-(-d*c.c+f*c.a)/c.det,1]};x.dumpTrafo=function(){function a(a){return Math.round(1E3*a)/1E3}var b=x.drawingstate.matrix;console.log("a:"+a(b.a)+" b:"+a(b.b)+
" c:"+a(b.c)+" d:"+a(b.d)+" tx:"+a(b.ty)+" ty:"+a(b.tx))};x.setMat=function(a,b,c,d,f,g){var h=x.drawingstate.matrix;h.a=a;h.b=b;h.c=c;h.d=d;h.tx=f;h.ty=g;h.det=a*d-b*c;h.sdet=Math.sqrt(h.det)};x.scaleAndOrigin=function(a,b,c){x.setMat(a,0,0,a,b,c)};x.visibleRect=function(a,b,c,d){var f=c-a,g=b-d,f=ga*g<Y*f?ga/f:Y/g;x.setMat(f,0,0,f,(ga-f*(a+c))/2,(Y-f*(b+d))/2)};x.applyMat=function(a,b,c,d,f,g){var h=x.drawingstate.matrix;x.setMat(h.a*a+h.c*b,h.b*a+h.d*b,h.a*c+h.c*d,h.b*c+h.d*d,h.a*f+h.c*g+h.tx,
h.b*f+h.d*g+h.ty);a=x.to(0,-Y);b=x.to(ga,0);console.log("{visibleRect: ["+a[0]+","+a[1]+","+b[0]+","+b[1]+"]}")};x.translate=function(a,b){x.applyMat(1,0,0,1,a,b)};x.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);x.applyMat(b,a,-a,b,0,0)};x.scale=function(a){x.applyMat(a,0,0,a,0,0)};x.gsave=function(){Fa.stack.push(x.clone(x.drawingstate))};x.grestore=function(){0!==Fa.stack.length&&(x.drawingstate=Fa.stack.pop())};x.greset=function(){x.drawingstate=x.clone(Fa.backup);x.drawingstate.matrix.ty-=
Y;x.drawingstate.initialmatrix.ty-=Y;Fa.stack=[]};x.createnewbackup=function(){x.drawingstate.initialmatrix.a=x.drawingstate.matrix.a;x.drawingstate.initialmatrix.b=x.drawingstate.matrix.b;x.drawingstate.initialmatrix.c=x.drawingstate.matrix.c;x.drawingstate.initialmatrix.d=x.drawingstate.matrix.d;x.drawingstate.initialmatrix.tx=x.drawingstate.matrix.tx;x.drawingstate.initialmatrix.ty=x.drawingstate.matrix.ty;x.drawingstate.initialmatrix.det=x.drawingstate.matrix.det;x.drawingstate.initialmatrix.sdet=
x.drawingstate.matrix.sdet;Fa.backup=x.clone(x.drawingstate)};x.makecolor=function(a,b,c){a=Math.floor(255*a);b=Math.floor(255*b);c=Math.floor(255*c);return 1===x.drawingstate.alpha?"rgb("+a+","+b+","+c+")":"rgba("+a+","+b+","+c+","+x.drawingstate.alpha+")"};x.setcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;x.drawingstate.linecolor=x.drawingstate.pointcolor=x.makecolor(b,c,a);x.drawingstate.linecolorraw=x.drawingstate.pointcolorraw=[b,c,a]};x.setlinecolor=
function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;x.drawingstate.linecolor=x.makecolor(b,c,a);x.drawingstate.linecolorraw=[b,c,a]};x.settextcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;x.drawingstate.textcolor=x.makecolor(b,c,a);x.drawingstate.textcolorraw=[b,c,a]};x.setpointcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;x.drawingstate.pointcolor=x.makecolor(b,c,a);
x.drawingstate.pointcolorraw=[b,c,a]};x.setalpha=function(a){x.drawingstate.alpha=a.value.real;x.drawingstate.linecolor=x.makecolor(x.drawingstate.linecolorraw[0],x.drawingstate.linecolorraw[1],x.drawingstate.linecolorraw[2]);x.drawingstate.pointcolor=x.makecolor(x.drawingstate.pointcolorraw[0],x.drawingstate.pointcolorraw[1],x.drawingstate.pointcolorraw[2]);x.drawingstate.textcolor=x.makecolor(x.drawingstate.textcolorraw[0],x.drawingstate.textcolorraw[1],x.drawingstate.textcolorraw[2])};x.setpointsize=
function(a){x.drawingstate.pointsize=a.value.real};x.setlinesize=function(a){x.drawingstate.linesize=a.value.real};x.settextsize=function(a){x.drawingstate.textsize=a.value.real};var ua={clip:"none",pointColor:[1,0,0],lineColor:[0,0,1],pointSize:5,lineSize:2,alpha:1,overhangLine:1.1,overhangSeg:1,dimDependent:1};n.defaultAppearance&&Dc(n.defaultAppearance);var ic={},ha,ya,Da,ia,oa,Ra,va,Ya,Eb=!1,gc={toString:function(){return"RefineException"}},H=null;n.enableTraceLog&&(H={logLength:Infinity,fullLog:[],
currentMouseAndScripts:null,currentMover:null,currentStep:null,currentElement:null,currentParam:null,labelTracing2:y.wrap("tracing2"),labelTracing4:y.wrap("tracing4"),labelTracingSesq:y.wrap("tracingSesq"),postMouseHooks:[]},"number"===typeof n.enableTraceLog&&(H.logLength=n.enableTraceLog),Aa.getTraceLog=Ic,Aa.formatTraceLog=Jc,Aa.addTraceHook=H.postMouseHooks.push.bind(H.postMouseHooks));Ea.stateSize=12;Hb.stateSize=24;var w={_helper:{},RandomLine:{}};w.RandomLine.kind="L";w.RandomLine.updatePosition=
function(a){a.homog=h.realVector([100*Math.random(),100*Math.random(),100*Math.random()]);a.homog=h.normalizeMax(a.homog);a.homog=y.withUsage(a.homog,"Line")};w.FreeLine={};w.FreeLine.kind="L";w.FreeLine.updatePosition=function(a){a.homog=h.realVector([100*Math.random(),100*Math.random(),100*Math.random()]);a.homog=h.normalizeMax(a.homog);a.homog=y.withUsage(a.homog,"Line")};w.RandomPoint={};w.RandomPoint.kind="P";w.RandomPoint.updatePosition=function(a){a.homog=h.realVector([100*Math.random(),100*
Math.random(),100*Math.random()]);a.homog=h.normalizeMax(a.homog);a.homog=y.withUsage(a.homog,"Point")};w.Join={};w.Join.kind="L";w.Join.updatePosition=function(a){a.homog=h.cross(t[a.args[0]].homog,t[a.args[1]].homog);a.homog=h.normalizeMax(a.homog);a.homog=y.withUsage(a.homog,"Line")};w.Segment={};w.Segment.kind="S";w.Segment.updatePosition=function(a){var b=t[a.args[0]],c=t[a.args[1]];a.homog=h.cross(b.homog,c.homog);a.homog=h.normalizeMax(a.homog);a.homog=y.withUsage(a.homog,"Line");a.startpos=
b.homog;a.endpos=c.homog;a.farpoint=h.cross(a.homog,h.linfty)};w.Meet={};w.Meet.kind="P";w.Meet.updatePosition=function(a){a.homog=h.cross(t[a.args[0]].homog,t[a.args[1]].homog);a.homog=h.normalizeMax(a.homog);a.homog=y.withUsage(a.homog,"Point")};w.Meet.visiblecheck=function(a){var b=!0,c=t[a.args[0]],d=t[a.args[1]];"Segment"===c.type&&(b=ec(a,c));b&&"Segment"===c.type&&(b=ec(a,d));a.isshowing=b};w.Mid={};w.Mid.kind="P";w.Mid.updatePosition=function(a){var b=t[a.args[0]].homog,c=t[a.args[1]].homog,
d=h.cross(b,c),f=h.cross(d,h.linfty),g=h.det3(b,f,d),d=h.det3(c,f,d),b=h.scalmult(d,b),c=h.scalmult(g,c);a.homog=h.add(b,c);a.homog=h.normalizeMax(a.homog);a.homog=y.withUsage(a.homog,"Point")};w.Perp={};w.Perp.kind="L";w.Perp.updatePosition=function(a){var b=t[a.args[0]].homog,c=t[a.args[1]].homog,b=h.turnIntoCSList([b.value[0],b.value[1],k.zero]);a.homog=h.cross(b,c);a.homog=h.normalizeMax(a.homog);a.homog=y.withUsage(a.homog,"Line")};w.Para={};w.Para.kind="L";w.Para.updatePosition=function(a){var b=
t[a.args[1]].homog;a.homog=h.cross(h.cross(h.linfty,t[a.args[0]].homog),b);a.homog=h.normalizeMax(a.homog);a.homog=y.withUsage(a.homog,"Line")};w.Horizontal={};w.Horizontal.kind="L";w.Horizontal.updatePosition=function(a){a.homog=h.cross(h.ex,t[a.args[0]].homog);a.homog=h.normalizeMax(a.homog);a.homog=y.withUsage(a.homog,"Line")};w.Vertical={};w.Vertical.kind="L";w.Vertical.updatePosition=function(a){a.homog=h.cross(h.ey,t[a.args[0]].homog);a.homog=h.normalizeMax(a.homog);a.homog=y.withUsage(a.homog,
"Line")};w.Through={};w.Through.kind="L";w.Through.isMovable=!0;w.Through.initialize=function(a){a=a.dir?y.wrap(a.dir):h.realVector([a.pos[1],-a.pos[0],0]);V(a)};w.Through.getParamForInput=function(a,b,c){a="mouse"===c?h.cross(t[a.args[0]].homog,b):"homog"===c?b:h.turnIntoCSList([k.zero,k.zero,k.zero]);a=h.cross(h.linfty,a);return h.normalizeMax(a)};w.Through.getParamFromState=function(a){return ba(3)};w.Through.putParamToState=function(a,b){V(b)};w.Through.updatePosition=function(a){var b=ba(3);
V(b);b=h.cross(t[a.args[0]].homog,b);b=h.normalizeMax(b);a.homog=y.withUsage(b,"Line")};w.Through.stateSize=6;w.Free={};w.Free.kind="P";w.Free.isMovable=!0;w.Free.initialize=function(a){a=w._helper.initializePoint(a);V(a)};w.Free.getParamForInput=function(a,b,c){if("mouse"===c&&Tb&&0!==La){b=h.normalizeZ(b);a=b.value[0].value.real;c=b.value[1].value.real;var d=Math.round(a/La)*La,f=Math.round(c/La)*La;.2>Math.abs(d-a)&&.2>Math.abs(f-c)&&(b=h.realVector([d,f,1]))}return h.normalizeMax(b)};w.Free.getParamFromState=
function(a){return ba(3)};w.Free.putParamToState=function(a,b){V(b)};w.Free.updatePosition=function(a){var b=ba(3);V(b);a.homog=y.withUsage(b,"Point")};w.Free.stateSize=6;w._helper.projectPointToLine=function(a,b){var c=h.turnIntoCSList([b.value[0],b.value[1],k.zero]),c=h.cross(c,a);return h.normalizeMax(h.cross(c,b))};w.PointOnLine={};w.PointOnLine.kind="P";w.PointOnLine.isMovable=!0;w.PointOnLine.initialize=function(a){var b=w._helper.initializePoint(a);a=t[a.args[0]].homog;var b=w._helper.projectPointToLine(b,
a),b=h.normalizeMax(b),c=h.cross(h.linfty,b);h.normalizeMax(c);V(b);V(a);Ra=!1};w.PointOnLine.updatePosition=function(a,b){var c,d=t[a.args[0]].homog;c=ba(3);ba(3);if(!b){ia=a.stateIdx;var f=ha;ha=Da;var g=ba(3),k=ba(3);ha=f;f=h.cross(k,d);h._helper.isAlmostZero(f)&&(f=h.cross(h.linfty,d));g=w._helper.CircleMP(f,g);g=w._helper.IntersectLC(d,g);f=w._helper.pointReflection(f,c);c=jc(g[0],g[1],c,f)[0]}c=h.normalizeMax(c);V(c);V(d);a.homog=y.withUsage(c,"Point")};w.PointOnLine.getParamForInput=function(a,
b,c){return b=w._helper.projectPointToLine(b,t[a.args[0]].homog)};w.PointOnLine.getParamFromState=function(a){return ba(3)};w.PointOnLine.putParamToState=function(a,b){return V(b)};w.PointOnLine.stateSize=12;w.PointOnCircle={};w.PointOnCircle.kind="P";w.PointOnCircle.isMovable=!0;w.PointOnCircle.initialize=function(a){var b=t[a.args[0]];a=h.normalizeZ(w._helper.initializePoint(a));var c=h.normalizeZ(w._helper.CenterOfConic(b.matrix)),d=h.sub(a,c),d=h.turnIntoCSList([d.value[1],k.neg(d.value[0]),k.zero]),
c=h.cross(a,c),b=w._helper.IntersectLC(c,b.matrix),c=h.projectiveDistMinScal(a,b[0]);h.projectiveDistMinScal(a,b[1])<c?(a=b[1],b=b[0]):(a=b[0],b=b[1]);V(d);V(a);V(b);Ra=!1};w.PointOnCircle.putParamToState=function(a,b){V(b)};w.PointOnCircle.getParamFromState=function(a){return ba(3)};w.PointOnCircle.getParamForInput=function(a,b,c){c=h.normalizeZ(w._helper.CenterOfConic(t[a.args[0]].matrix));b=h.sub(b,c);ia=a.stateIdx;a=ba(3);var d=h.normalizeZ(ba(3));c=h.sub(d,c);0>k.sub(k.mult(a.value[0],c.value[1]),
k.mult(a.value[1],c.value[0])).value.real&&(b=h.neg(b));return h.turnIntoCSList([b.value[1],k.neg(b.value[0]),k.zero])};w.PointOnCircle.parameterPath=function(a,b,c,d,f){d=h.normalizeAbs(d);f=h.normalizeAbs(f);var g=h.scalproduct(d,f);if(0<=g.value.real)return hc(a,b,c,d,f);a=h.turnIntoCSList([k.sub(d.value[1],f.value[1]),k.sub(f.value[0],d.value[0]),k.zero]);g=h.scalproduct(d,a);0>g.value.real&&(a=h.neg(a));0>b?(b=2*b+1,c=b*b,g=.25/(1+c),c=k.complex(2*b*g+.25,(1-c)*g)):(b=2*b-1,c=b*b,g=.25/(1+c),
c=k.complex(2*b*g+.75,(1-c)*g));var l=k.sub(k.real(1),c);b=k.mult(c,c);g=k.mult(l,l);c=k.mult(c,l);d=h.scalmult(g,d);d=h.add(d,h.scalmult(c,a));return d=h.add(d,h.scalmult(b,f))};w.PointOnCircle.updatePosition=function(a){var b=ba(3);V(b);var c=t[a.args[0]],b=h.productMV(c.matrix,b),c=w._helper.IntersectLC(b,c.matrix),c=Ea(c[0],c[1]),b=h.normalizeMax(c.value[0]);a.homog=y.withUsage(b,"Point");a.antipodalPoint=c.value[1]};w.PointOnCircle.stateSize=6+Ea.stateSize;w.OtherPointOnCircle={};w.OtherPointOnCircle.kind=
"P";w.OtherPointOnCircle.updatePosition=function(a){var b=t[a.args[0]].antipodalPoint,b=h.normalizeMax(b);a.homog=y.withUsage(b,"Point")};w.PointOnSegment={};w.PointOnSegment.kind="P";w.PointOnSegment.isMovable=!0;w.PointOnSegment.initialize=function(a){var b=w._helper.initializePoint(a);a=w.PointOnSegment.getParamForInput(a,b);Ta(a)};w.PointOnSegment.getParamForInput=function(a,b){var c=t[a.args[0]],d=c.homog,d=h.turnIntoCSList([d.value[0],d.value[1],k.zero]),c=h.crossratio3(c.farpoint,c.startpos,
c.endpos,b,d);0>c.value.real&&(c=k.complex(0,c.value.imag));1<c.value.real&&(c=k.complex(1,c.value.imag));return c};w.PointOnSegment.getParamFromState=function(a){return bb()};w.PointOnSegment.putParamToState=function(a,b){Ta(b)};w.PointOnSegment.updatePosition=function(a){var b=bb();Ta(b);var c=t[a.args[0]],d=h.scalmult(c.endpos.value[2],c.startpos),c=h.scalmult(c.startpos.value[2],c.endpos),c=h.sub(c,d),b=h.add(d,h.scalmult(b,c)),b=h.normalizeMax(b);a.homog=y.withUsage(b,"Point")};w.PointOnSegment.stateSize=
2;w._helper.CenterOfConic=function(a){var b=w._helper.IntersectLC(h.linfty,a),c=y.mult(a,b[0]);a=y.mult(a,b[1]);return h.cross(c,a)};w.CenterOfConic={};w.CenterOfConic.kind="P";w.CenterOfConic.updatePosition=function(a){var b=w._helper.CenterOfConic(t[a.args[0]].matrix);a.homog=b;a.homog=h.normalizeMax(a.homog);a.homog=y.withUsage(a.homog,"Point")};w._helper.CircleMP=function(a,b){var c=a.value[0],d=a.value[1],f=k.neg(a.value[2]),g=k.zero,c=h.turnIntoCSList([h.turnIntoCSList([f,g,c]),h.turnIntoCSList([g,
f,d]),h.turnIntoCSList([c,d,g])]),f=y.mult(y.mult(b,c),b),d=y.mult(y.mult(b,h.fund),b),f=y.mult(f,h.fund),c=y.mult(d,c);return h.sub(f,c)};w.CircleMP={};w.CircleMP.kind="C";w.CircleMP.updatePosition=function(a){a.matrix=w._helper.CircleMP(t[a.args[0]].homog,t[a.args[1]].homog);a.matrix=h.normalizeMax(a.matrix);a.matrix=y.withUsage(a.matrix,"Circle")};w.CircleMr={};w.CircleMr.kind="C";w.CircleMr.isMovable=!0;w.CircleMr.initialize=function(a){Ta(k.real(a.radius))};w.CircleMr.getParamForInput=function(a,
b){var c=t[a.args[0]].homog,c=h.normalizeZ(c);b=h.normalizeZ(b);c=h.sub(c,b);return c=h.abs(c)};w.CircleMr.getParamFromState=function(a){return bb()};w.CircleMr.putParamToState=function(a,b){Ta(b)};w.CircleMr.updatePosition=function(a){var b=bb();Ta(b);var c=t[a.args[0]].homog,c=h.normalizeZ(c),d=h.turnIntoCSList([b,k.zero,k.zero]),d=h.add(d,c),c=w._helper.CircleMP(c,d),c=h.normalizeMax(c);a.matrix=y.withUsage(c,"Circle");a.radius=b};w.CircleMr.stateSize=2;w.Compass={};w.Compass.kind="C";w.Compass.updatePosition=
function(a){var b=t[a.args[2]].homog,c=t[a.args[1]].homog,d=t[a.args[0]].homog,b=h.normalizeZ(b),c=h.normalizeZ(c),d=h.normalizeZ(d),c=h.sub(c,d),c=h.add(c,b),c=h.normalizeZ(c),b=w._helper.CircleMP(b,c),b=h.normalizeMax(b);a.matrix=y.withUsage(b,"Circle")};w._helper.getConicType=function(a){if(1E-16>k.abs(h.det(a)).value.real)return"degenerate";var b=k.mult(a.value[0].value[0],a.value[1].value[1]),b=k.sub(b,k.pow(a.value[0].value[1],k.real(2))),b=b.value.real;return 1E-16>Math.abs(b)?"parabola":1E-16<
b?"ellipsoid":"hyperbola"};w._helper.ConicBy5=function(a,b,c,d,f,g){a=h.turnIntoCSList([h.cross(c,d)]);var k=h.turnIntoCSList([h.cross(b,f)]);b=h.turnIntoCSList([h.cross(b,c)]);d=h.turnIntoCSList([h.cross(d,f)]);y.mult(h.transpose(k),a);return w._helper.conicFromTwoDegenerates(a,k,b,d,g)};w._helper.conicFromTwoDegenerates=function(a,b,c,d,f){a=y.mult(h.transpose(b),a);c=y.mult(h.transpose(d),c);a=h.add(a,h.transpose(a));c=h.add(c,h.transpose(c));d=y.mult(y.mult(f,a),f);f=y.mult(y.mult(f,c),f);c=y.mult(d,
c);f=y.mult(f,a);return h.sub(c,f)};w.ConicBy5={};w.ConicBy5.kind="C";w.ConicBy5.updatePosition=function(a){var b=w._helper.ConicBy5(a,t[a.args[0]].homog,t[a.args[1]].homog,t[a.args[2]].homog,t[a.args[3]].homog,t[a.args[4]].homog);a.matrix=b;a.matrix=h.normalizeMax(a.matrix);a.matrix=y.withUsage(a.matrix,"Conic")};w._helper.buildConicMatrix=function(a){var b=a[1],c=a[2],d=a[3],f=a[4],g=a[5];return h.turnIntoCSList([h.turnIntoCSList([a[0],b,d]),h.turnIntoCSList([b,c,f]),h.turnIntoCSList([d,f,g])])};
w._helper.splitDegenConic=function(a){var b=h.adjoint3(a),c=0,d,f,g=k.abs2(b.value[0].value[0]).value.real;for(d=1;3>d;d++)f=k.abs2(b.value[d].value[d]).value.real,f>g&&(c=d,g=f);d=k.sqrt(k.mult(k.real(-1),b.value[c].value[c]));c=k.real(c+1);f=h.column(b,c);if(1E-16>k.abs2(d).value.real)return u;f=h.scaldiv(d,f);d=f.value[0];g=f.value[1];f=f.value[2];d=h.turnIntoCSList([h.turnIntoCSList([k.real(0),f,k.mult(k.real(-1),g)]),h.turnIntoCSList([k.mult(k.real(-1),f),k.real(0),d]),h.turnIntoCSList([g,k.mult(k.real(-1),
d),k.real(0)])]);a=h.add(a,d);var l=0;for(d=g=b=0;3>d;d++)for(c=0;3>c;c++)f=k.abs2(a.value[d].value[c]).value.real,f>g&&(l=d,b=c,g=f);d=a.value[l];a=h.transpose(a);a=a.value[b];d=h.normalizeMax(d);a=h.normalizeMax(a);d=y.withUsage(d,"Line");a=y.withUsage(a,"Line");return[d,a]};w.SelectConic={};w.SelectConic.kind="C";w.SelectConic.updatePosition=function(a){a.matrix=t[a.args[0]].results[a.index-1];a.matrix=h.normalizeMax(a.matrix);a.matrix=y.withUsage(a.matrix,"Conic")};w._helper.ConicBy4p1l=function(a,
b,c,d,f,g){var l=h.cross(h.cross(b,d),g),m=h.cross(h.cross(c,f),g),n=h.cross(h.cross(b,c),g),p=h.cross(h.cross(d,f),g),t=h.realVector(x.to(100*Math.random(),100*Math.random()));g=k.mult(h.det3(t,m,n),h.det3(t,m,p));g=k.sqrt(g);n=k.mult(h.det3(t,l,n),h.det3(t,l,p));n=k.sqrt(n);l=h.scalmult(g,l);n=h.scalmult(n,m);m=h.add(l,n);l=h.sub(l,n);m=w._helper.ConicBy5(a,b,c,d,f,m);a=w._helper.ConicBy5(a,b,c,d,f,l);return[m,a]};w.ConicBy4p1l={};w.ConicBy4p1l.kind="Cs";w.ConicBy4p1l.updatePosition=function(a){var b=
w._helper.ConicBy4p1l(a,t[a.args[0]].homog,t[a.args[1]].homog,t[a.args[2]].homog,t[a.args[3]].homog,t[a.args[4]].homog);a.results=b};w._helper.ConicBy3p2l=function(a,b,c,d,f){function g(a,b,c,d){return k.sub(k.mult(a,d),k.mult(b,c))}var l=h.cross(a,b),m=h.cross(d,f);d=h.cross(d,l);f=h.cross(f,l);l=h.turnIntoCSList([d,f,m]);c=h.productVM(c,h.adjoint3(l));m=h.adjoint3(h.turnIntoCSList([h.scalmult(c.value[0],d),h.scalmult(c.value[1],f),h.scalmult(c.value[2],m)]));c=h.transpose(m);d=k.mult;f=h.productMV(c,
a);a=f.value[0];f=f.value[1];l=h.productMV(c,b);b=l.value[0];var l=l.value[1],n=k.sqrt(d(a,f)),p=k.sqrt(d(b,l)),t,u=Array(4);for(t=0;4>t;++t){var v=(t&2)-1,w=d(k.real(((t&1)<<1)-1),n),x=d(k.real(v),p),y=g(f,w,l,x),z=g(b,x,a,w),v=g(a,f,b,l),A=k.add(k.add(g(b,l,a,f),g(l,x,f,w)),g(x,b,w,a)),w=d(y,y),x=d(z,z),B=d(A,A),C=d(y,z),y=d(y,A),z=d(z,A),C=k.sub(C,d(k.real(.5),d(v,v))),v=h.turnIntoCSList([h.turnIntoCSList([w,C,y]),h.turnIntoCSList([C,x,z]),h.turnIntoCSList([y,z,B])]),v=h.productMM(m,h.productMM(v,
c)),v=h.turnIntoCSList([v.value[0].value[0],v.value[0].value[1],v.value[0].value[2],v.value[1].value[1],v.value[1].value[2],v.value[2].value[2]]);u[t]=v}return u};w.ConicBy3p2l={};w.ConicBy3p2l.kind="Cs";w.ConicBy3p2l.updatePosition=function(a){for(var b=w._helper.ConicBy3p2l(t[a.args[0]].homog,t[a.args[1]].homog,t[a.args[2]].homog,t[a.args[3]].homog,t[a.args[4]].homog),b=kc(b),c=Array(4),d=0;4>d;++d){var f=b[d].value;c[d]=h.turnIntoCSList([h.turnIntoCSList([f[0],f[1],f[2]]),h.turnIntoCSList([f[1],
f[3],f[4]]),h.turnIntoCSList([f[2],f[4],f[5]])])}a.results=c};w.ConicBy3p2l.stateSize=48;w.ConicBy2p3l={};w.ConicBy2p3l.kind="Cs";w.ConicBy2p3l.updatePosition=function(a){for(var b=w._helper.ConicBy3p2l(t[a.args[2]].homog,t[a.args[3]].homog,t[a.args[4]].homog,t[a.args[0]].homog,t[a.args[1]].homog),b=kc(b),c=Array(4),d=0;4>d;++d){var f=b[d].value,f=h.turnIntoCSList([h.turnIntoCSList([f[0],f[1],f[2]]),h.turnIntoCSList([f[1],f[3],f[4]]),h.turnIntoCSList([f[2],f[4],f[5]])]);c[d]=h.normalizeMax(h.adjoint3(f))}a.results=
c};w.ConicBy2p3l.stateSize=48;w.ConicBy1p4l={};w.ConicBy1p4l.kind="Cs";w.ConicBy1p4l.updatePosition=function(a){var b=w._helper.ConicBy4p1l(a,t[a.args[0]].homog,t[a.args[1]].homog,t[a.args[2]].homog,t[a.args[3]].homog,t[a.args[4]].homog),c=b[0],b=b[1],c=h.adjoint3(c),b=h.adjoint3(b),b=[c,b];a.results=b};w.ConicBy2Foci1P={};w.ConicBy2Foci1P.kind="Cs";w.ConicBy2Foci1P.updatePosition=function(a){var b=t[a.args[0]].homog,c=t[a.args[1]].homog,d=t[a.args[2]].homog,f=h.ii,g=h.jj,l=h.normalizeMax(h.cross(b,
d)),m=h.normalizeMax(h.cross(c,d)),n=h.normalizeMax(h.cross(d,f)),d=h.normalizeMax(h.cross(d,g)),m=w._helper.coHarmonic(n,d,l,m),l=h.normalizeMax(m[0]),m=h.normalizeMax(m[1]),f=h.turnIntoCSList([f]),n=h.turnIntoCSList([g]),d=h.turnIntoCSList([b]),p=h.turnIntoCSList([c]),g=w._helper.conicFromTwoDegenerates(f,n,d,p,l),g=h.normalizeMax(g),f=w._helper.conicFromTwoDegenerates(f,n,d,p,m),f=h.normalizeMax(f),g=h.normalizeMax(h.adjoint3(g)),f=h.normalizeMax(h.adjoint3(f));"ellipsoid"!==w._helper.getConicType(g)&&
(l=g,g=f,f=l);h.almostequals(b,c).value&&(b=k.real(3),f=h.zeromatrix(b,b));a.results=[g,f]};w._helper.coHarmonic=function(a,b,c,d){var f=h.realVector([100*Math.random(),100*Math.random(),1]),g=h.det3(f,c,a),l=h.det3(f,c,b);c=h.det3(f,d,a);d=h.det3(f,d,b);d=k.sqrt(k.mult(d,l));g=k.sqrt(k.mult(c,g));a=y.mult(a,d);g=y.mult(b,g);b=h.add(a,g);a=h.sub(a,g);return[b,a]};w.ConicBy5lines={};w.ConicBy5lines.kind="C";w.ConicBy5lines.updatePosition=function(a){var b=w._helper.ConicBy5(a,t[a.args[0]].homog,t[a.args[1]].homog,
t[a.args[2]].homog,t[a.args[3]].homog,t[a.args[4]].homog),b=h.adjoint3(b);a.matrix=b;a.matrix=h.normalizeMax(a.matrix);a.matrix=y.withUsage(a.matrix,"Conic")};w.CircleBy3={};w.CircleBy3.kind="C";w.CircleBy3.updatePosition=function(a){var b=w._helper.ConicBy5(a,t[a.args[0]].homog,t[a.args[1]].homog,h.ii,h.jj,t[a.args[2]].homog);a.matrix=h.normalizeMax(b);a.matrix=y.withUsage(a.matrix,"Circle")};w.Polar={};w.Polar.kind="L";w.Polar.updatePosition=function(a){var b=t[a.args[1]],c=h.inverse(t[a.args[0]].matrix);
a.homog=y.mult(c,b.homog);a.homog=h.normalizeMax(a.homog);a.homog=y.withUsage(a.homog,"Point")};w.PolarPoint={};w.PolarPoint.kind="P";w.PolarPoint.updatePosition=function(a){a.homog=y.mult(t[a.args[1]].matrix,t[a.args[0]].homog);a.homog=h.normalizeMax(a.homog);a.homog=y.withUsage(a.homog,"Line")};w.angleBisector={};w.angleBisector.kind="Ls";w.angleBisector.updatePosition=function(a){var b=t[a.args[0]],c=t[a.args[1]],d=h.normalizeMax(h.cross(b.homog,c.homog)),f=h.normalizeMax(h.cross(h.ii,d)),g=h.normalizeMax(h.cross(h.jj,
d)),l=k.sqrt(k.mult(h.det3(d,c.homog,f),h.det3(d,b.homog,f))),m=k.sqrt(k.mult(h.det3(d,c.homog,g),h.det3(d,b.homog,g))),f=y.mult(f,m),l=y.mult(g,l),g=h.add(f,l),l=h.sub(f,l),f=h.abs(g).value.real<k.eps,m=h.abs(l).value.real<k.eps;f||m?f?l=h.normalizeMax(l):m&&(g=h.normalizeMax(g)):(g=h.normalizeMax(g),l=h.normalizeMax(l));if(h.almostequals(g,h.linfty).value&&m||h.almostequals(l,h.linfty).value&&f)h.abs(g).value.real<h.abs(l).value.real?(f=h.det3(d,c.homog,l),d=h.det3(d,b.homog,l),b=y.mult(b.homog,
f),c=y.mult(c.homog,d),g=h.add(b,c)):(f=h.det3(d,c.homog,g),d=h.det3(d,b.homog,g),b=y.mult(b.homog,f),c=y.mult(c.homog,d),l=h.add(b,c));g=h.normalizeMax(g);l=h.normalizeMax(l);a.results=Ea(g,l)};w.angleBisector.stateSize=Ea.stateSize;w._helper.IntersectLC=function(a,b){var c=k,d=h.crossOperator(a),f=h.transpose(d),f=y.mult(f,y.mult(b,d)),g=h.maxIndex(a,k.abs2),l,m,n,p;0===g?(g=f.value[1].value[1],l=f.value[1].value[2],m=f.value[2].value[1],n=f.value[2].value[2],p=a.value[0]):1===g?(g=f.value[0].value[0],
l=f.value[0].value[2],m=f.value[2].value[0],n=f.value[2].value[2],p=a.value[1]):(g=f.value[0].value[0],l=f.value[0].value[1],m=f.value[1].value[0],n=f.value[1].value[1],p=a.value[2]);c=c.div(c.sqrt(c.sub(c.mult(l,m),c.mult(g,n))),p);c=h.add(f,h.scalmult(c,d));g=h.maxIndex(c,h.abs2);d=c.value[g];d=h.normalizeMax(d);d=y.withUsage(d,"Point");c=h.transpose(c);g=h.maxIndex(c,h.abs2);c=c.value[g];c=h.normalizeMax(c);c=y.withUsage(c,"Point");return[d,c]};w.IntersectLC={};w.IntersectLC.kind="Ps";w.IntersectLC.updatePosition=
function(a){var b=w._helper.IntersectLC(t[a.args[0]].homog,t[a.args[1]].matrix);a.results=Ea(b[0],b[1])};w.IntersectLC.stateSize=Ea.stateSize;w.OtherIntersectionCL={};w.OtherIntersectionCL.kind="P";w.OtherIntersectionCL.updatePosition=function(a){var b=t[a.args[2]].homog,c=w._helper.IntersectLC(t[a.args[1]].homog,t[a.args[0]].matrix),d=c[0],c=c[1],f=h.projectiveDistMinScal(d,b),b=h.projectiveDistMinScal(c,b);a.homog=f<b?c:d;a.homog=h.normalizeMax(a.homog);a.homog=y.withUsage(a.homog,"Point")};w.IntersectCirCir=
{};w.IntersectCirCir.kind="Ps";w.IntersectCirCir.updatePosition=function(a){var b=t[a.args[0]].matrix,c=t[a.args[1]].matrix,d=h.scalmult(c.value[0].value[0],b.value[2]),c=h.scalmult(b.value[0].value[0],c.value[2]),d=h.sub(d,c),d=h.turnIntoCSList([d.value[0],d.value[1],k.realmult(.5,d.value[2])]),d=h.normalizeMax(d),b=w._helper.IntersectLC(d,b);a.results=Ea(b[0],b[1])};w.IntersectCirCir.stateSize=Ea.stateSize;w.OtherIntersectionCC={};w.OtherIntersectionCC.kind="P";w.OtherIntersectionCC.updatePosition=
function(a){var b=t[a.args[0]].matrix,c=t[a.args[1]].matrix,d=t[a.args[2]].homog,f=h.scalmult(c.value[0].value[0],b.value[2]),c=h.scalmult(b.value[0].value[0],c.value[2]),f=h.sub(f,c),f=h.turnIntoCSList([f.value[0],f.value[1],k.realmult(.5,f.value[2])]),f=h.normalizeMax(f),f=w._helper.IntersectLC(f,b),b=f[0],f=f[1],c=h.projectiveDistMinScal(b,d),d=h.projectiveDistMinScal(f,d);a.homog=c<d?f:b;a.homog=h.normalizeMax(a.homog);a.homog=y.withUsage(a.homog,"Point")};w._helper.IntersectConicConic=function(a,
b){var c=a.value[0],d=a.value[1],f=a.value[2],g=b.value[0],l=b.value[1],m=b.value[2],n=h.det3(c,d,f),p=k.add(k.add(h.det3(c,d,m),h.det3(c,l,f)),h.det3(g,d,f)),c=k.add(k.add(h.det3(c,l,m),h.det3(g,d,m)),h.det3(g,l,f)),g=h.det3(g,l,m),m=k.abs2(n).value.real,l=k.abs2(g).value.real;m<l&&(m=a,a=b,b=m,m=g,g=n,n=m,m=c,c=p,p=m,m=l);1E-24>m?(n=a,c=b):(p=k.solveCubic(n,p,c,g),c=k.abs2(k.sub(p[0],p[1])).value.real,g=k.abs2(k.sub(p[0],p[2])).value.real,l=k.abs2(k.sub(p[1],p[2])).value.real,c>g?(n=p[1],p=c>l?
p[0]:p[2]):(n=p[2],p=g>l?p[0]:p[1]),n=h.add(h.scalmult(n,a),b),c=h.add(h.scalmult(p,a),b));p=w._helper.splitDegenConic(n);n=p[0];p=p[1];c=w._helper.splitDegenConic(c);l=c[0];g=c[1];c=h.cross(n,l);l=h.cross(p,l);n=h.cross(n,g);p=h.cross(p,g);c=h.normalizeMax(c);l=h.normalizeMax(l);n=h.normalizeMax(n);p=h.normalizeMax(p);c=y.withUsage(c,"Point");l=y.withUsage(l,"Point");n=y.withUsage(n,"Point");p=y.withUsage(p,"Point");return[c,l,n,p]};w.IntersectConicConic={};w.IntersectConicConic.kind="Ps";w.IntersectConicConic.updatePosition=
function(a){var b=w._helper.IntersectConicConic(t[a.args[0]].matrix,t[a.args[1]].matrix),b=Hb(b[0],b[1],b[2],b[3]);a.results=b};w.IntersectConicConic.stateSize=Hb.stateSize;w.SelectP={};w.SelectP.kind="P";w.SelectP.initialize=function(a){if(void 0!==a.index)return a.index-1;var b=t[a.args[0]].results.value;a=w._helper.initializePoint(a);for(var c=h.projectiveDistMinScal(a,b[0]),d=0,f=1;f<b.length;++f){var g=h.projectiveDistMinScal(a,b[f]);g<c&&(c=g,d=f)}return d};w.SelectP.updatePosition=function(a){a.homog=
t[a.args[0]].results.value[a.param]};w.SelectL={};w.SelectL.kind="L";w.SelectL.updatePosition=function(a){a.homog=t[a.args[0]].results.value[a.index-1];a.homog=y.withUsage(a.homog,"Line")};w.TrProjection={};w.TrProjection.kind="Tr";w.TrProjection.updatePosition=function(a){function b(c){var d=t[a.args[0+c]].homog,e=t[a.args[2+c]].homog,f=t[a.args[4+c]].homog,g=t[a.args[6+c]].homog;c=h.adjoint3(h.turnIntoCSList([d,e,f]));c=h.productVM(g,c).value;return c=h.transpose(h.turnIntoCSList([h.scalmult(c[0],
d),h.scalmult(c[1],e),h.scalmult(c[2],f)]))}var c=h.productMM(b(1),h.adjoint3(b(0))),c=h.normalizeMax(c);a.matrix=c;c=h.transpose(h.adjoint3(c));c=h.normalizeMax(c);a.dualMatrix=c};w.TrInverse={};w.TrInverse.kind="Tr";w.TrInverse.updatePosition=function(a){var b=t[a.args[0]];a.dualMatrix=h.transpose(b.matrix);a.matrix=h.transpose(b.dualMatrix)};w.TransformP={};w.TransformP.kind="P";w.TransformP.updatePosition=function(a){a.homog=h.normalizeMax(h.productMV(t[a.args[0]].matrix,t[a.args[1]].homog));
a.homog=y.withUsage(a.homog,"Point")};w.TransformL={};w.TransformL.kind="L";w.TransformL.updatePosition=function(a){a.homog=h.normalizeMax(h.productMV(t[a.args[0]].dualMatrix,t[a.args[1]].homog));a.homog=y.withUsage(a.homog,"Line")};w.TransformS={};w.TransformS.kind="S";w.TransformS.updatePosition=function(a){var b=t[a.args[0]],c=t[a.args[1]];a.homog=h.normalizeMax(h.productMV(b.dualMatrix,c.homog));a.homog=y.withUsage(a.homog,"Line");a.startpos=h.normalizeMax(h.productMV(b.matrix,c.startpos));a.endpos=
h.normalizeMax(h.productMV(b.matrix,c.endpos));a.farpoint=h.normalizeMax(h.productMV(b.matrix,c.farpoint))};w._helper.pointReflection=function(a,b){var c=w._helper.CircleMP(a,b);return w._helper.conicOtherIntersection(c,b,a)};w._helper.conicOtherIntersection=function(a,b,c){var d=h.productMV(a,c);a=h.scalproduct(c,d);d=h.scalproduct(b,d);d=k.realmult(-2,d);b=h.scalmult(a,b);c=h.scalmult(d,c);c=h.add(b,c);return c=h.normalizeMax(c)};w._helper.initializePoint=function(a){var b=0,c=0,d=0;a.pos&&(2===
a.pos.length&&(b=a.pos[0],c=a.pos[1],d=1),3===a.pos.length&&(b=a.pos[0],c=a.pos[1],d=a.pos[2]));a=h.realVector([b,c,d]);return a=h.normalizeMax(a)};var Ec={CircleMFixedr:function(a){a.pinned=!0;a.type="CircleMr";return[a]},CircleByRadius:function(a){a.type="CircleMr";return[a]},IntersectionConicLine:function(a){a.args=[a.args[1],a.args[0]];a.type="IntersectLC";return[a]},IntersectionCircleCircle:function(a){a.type="IntersectCirCir";return[a]},PolarLine:function(a){a.args=[a.args[1],a.args[0]];a.type=
"Polar";return[a]},Parallel:function(a){a.type="Para";return[a]},Calculation:function(a){console.log("Calculation stripped from construction");return[]},Transform:function(a){var b="Transform"+w[t[a.args[1]].type].kind;if(w.hasOwnProperty(b))return a.type=b,[a];console.log(b+" not implemented yet");return[]}},ka={},pc,cb,qc,rc;pc=[[],[.2],[.075,.225],[44/45,-56/15,32/9],[19372/6561,-25360/2187,64448/6561,-212/729],[9017/3168,-355/33,46732/5247,49/176,-5103/18656],[35/384,0,500/1113,125/192,-2187/
6784,11/84]];cb=[0,.2,.3,.8,8/9,1,1];qc=[35/384,0,500/1113,125/192,-2187/6784,11/84,0];rc=[5179/57600,0,7571/16695,.6140625,-92097/339200,187/2100,.025];var na,W=[],ub=!1;ka.tick=function(){for(var a=0;a<I.env.accuracy;a++)ka.tick1(I.env.deltat/I.env.accuracy),A(ja.simulationstep)};ka.tick1=function(a){for(var b=a,c=0;0<a&&c<.999*a||0>a&&c>.999*a;)b=ka.oneRKStep(b),c+=b,b=Math.min(2*b,a-c),b=Math.max(b,1E-16),ka.restorePosition(),ka.doCollisions(),ka.calculateForces(),ka.moveToFinalPos();return!0};
ka.restorePosition=function(){na.forEach(function(a){a=a.behavior;I[a.type].restorePos(a,9)})};ka.doCollisions=function(){na.forEach(function(a){a=a.behavior;I[a.type].doCollisions(a)})};ka.calculateForces=function(){na.forEach(function(a){a=a.behavior;I[a.type].calculateForces(a)})};ka.moveToFinalPos=function(){na.forEach(function(a){a=a.behavior;I[a.type].move(a)})};ka.oneRKStep=function(a){for(var b=function(a){na.forEach(function(b){b=b.behavior;I[b.type].initRK(b,a);I[b.type].storePosition(b)})},
c=function(a){na.forEach(function(b){b=b.behavior;I[b.type].setToTimestep(b,cb[a])})},d=function(a){na.forEach(function(b){b=b.behavior;I[b.type].proceedMotion(b,cb[a],a,pc[a])})},f=function(){na.forEach(function(a){a=a.behavior;I[a.type].resetForces(a)})},g=function(a){na.forEach(function(b){b=b.behavior;I[b.type].calculateDelta(b,a)})},h=function(b){var c=0;na.forEach(function(a){a=a.behavior;I[a.type].proceedMotion(a,cb[6],7,qc);I[a.type].savePos(a,8);I[a.type].proceedMotion(a,cb[6],7,rc);I[a.type].savePos(a,
9);c+=I[a.type].sqDist(a,8,9)});return c=Math.sqrt(c)/a},k=function(a){na.forEach(function(a){a=a.behavior;I[a.type].recallPosition(a)})},l=!1;!l;){b(a);for(var m=0;7>m;m++)c(m),d(m),f(),ka.calculateForces(),g(m);h(a)>I.env.errorbound&&a>I.env.lowestdeltat?(a/=I.env.slowdownfactor,k()):l=!0}return a};var I={Mass:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.mass&&(a.mass=1);"undefined"===typeof a.charge&&(a.charge=0);"undefined"===typeof a.friction&&(a.friction=0);
a.lnfrict=0;"undefined"===typeof a.limitspeed&&(a.limitspeed=!1);"undefined"===typeof a.fixed&&(a.fixed=!1);"undefined"===typeof a.radius&&(a.radius=1);a.internalmove=!1;a.fx=0;a.fy=0;a.fz=0;a.vx=a.vx||0;a.vy=a.vy||0;a.vz=a.vz||0;a.mtype=0;a.env=I.env;a.deltat=0;a.mx=0;a.my=0;a.mz=0;a.mvx=0;a.mvy=0;a.mvz=0;a.dx=[0,0,0,0,0,0,0,0,0,0];a.dy=[0,0,0,0,0,0,0,0,0,0];a.dz=[0,0,0,0,0,0,0,0,0,0];a.dvx=[0,0,0,0,0,0,0,0,0,0];a.dvy=[0,0,0,0,0,0,0,0,0,0];a.dvz=[0,0,0,0,0,0,0,0,0,0];a.midx=0;a.midy=0;a.midz=0;a.lx=
0;a.ly=0;a.lz=0},resetForces:function(a){a.fx=0;a.fy=0;a.fz=0},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){var c=D.extractPoint(a.el.homog);a.x=c.x;a.y=c.y;a.z=0;a.xo=a.x;a.yo=a.y;a.zo=a.z;a.vxo=a.vx;a.vyo=a.vy;a.vzo=a.vz;a.deltat=b;a.fx=0;a.fy=0;a.fz=0},setVelocity:function(a,b,c,d){d||(d=0);a.vx=b;a.vy=c;a.vz=d},move:function(a){a.pos=[a.x,a.y,1];a.internalmove=!0;da&&U.down&&a.el===da.mover||(a.el.homog=h.realVector(a.pos));a.el.sx=a.x;a.el.sy=a.y;a.internalmove=!1},proceedMotion:function(a,
b,c,d){if(!a.fixed)for(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz,b=0;b<c;b++)a.x+=d[b]*a.dx[b]*a.deltat,a.y+=d[b]*a.dy[b]*a.deltat,a.z+=d[b]*a.dz[b]*a.deltat,a.vx+=d[b]*a.dvx[b]*a.deltat,a.vy+=d[b]*a.dvy[b]*a.deltat,a.vz+=d[b]*a.dvz[b]*a.deltat},calculateForces:function(a){var b=Math.sqrt(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz);a.lnfrict=-Math.log((1-a.friction)*(1-a.env.friction)*(.1<b&&a.limitSpeed?.1/b:1));a.fx+=-a.vx*a.lnfrict*a.mass;a.fy+=-a.vy*a.lnfrict*a.mass;a.fz+=-a.vz*a.lnfrict*
a.mass},calculateDelta:function(a,b){a.dx[b]=a.vx;a.dy[b]=a.vy;a.dz[b]=a.vz;a.dvx[b]=a.fx/a.mass;a.dvy[b]=a.fy/a.mass;a.dvz[b]=a.fz/a.mass},savePos:function(a,b){a.dx[b]=a.x;a.dy[b]=a.y;a.dz[b]=a.z;a.dvx[b]=a.vx;a.dvy[b]=a.vy;a.dvz[b]=a.vz},restorePos:function(a,b){a.fixed||(a.x=a.dx[b],a.y=a.dy[b],a.z=a.dz[b],a.vx=a.dvx[b],a.vy=a.dvy[b],a.vz=a.dvz[b])},sqDist:function(a,b,c){var d=(a.dx[b]-a.dx[c])*(a.dx[b]-a.dx[c]),d=d+(a.dy[b]-a.dy[c])*(a.dy[b]-a.dy[c]),d=d+(a.dz[b]-a.dz[c])*(a.dz[b]-a.dz[c]),
d=d+(a.dvx[b]-a.dvx[c])*(a.dvx[b]-a.dvx[c]),d=d+(a.dvy[b]-a.dvy[c])*(a.dvy[b]-a.dvy[c]);return d+=(a.dvz[b]-a.dvz[c])*(a.dvz[b]-a.dvz[c])},kineticEnergy:function(a){return.5*a.mass*(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz)},storePosition:function(a){a.mx=a.x;a.my=a.y;a.mz=a.z;a.mvx=a.vx;a.mvy=a.vy;a.mvz=a.vz},recallPosition:function(a){a.fixed||(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz)},doCollisions:function(a){}},Sun:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===
typeof a.mass&&(a.mass=10);"undefined"===typeof a.friction&&(a.friction=0);a.charge=0;a.x=0;a.y=0;a.z=0},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){var c=D.extractPoint(a.el.homog);a.x=c.x;a.y=c.y;a.z=0},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateDelta:function(a,b){},calculateForces:function(a){for(var b=a.x,c=a.y,d=a.z,f=0;f<W.length;f++){var g=W[f],h=g.behavior.x,k=g.behavior.y,l=g.behavior.z,m=Math.sqrt((b-
h)*(b-h)+(c-k)*(c-k)+(d-l)*(d-l)),k=(c-k)*a.mass*g.behavior.mass/(m*m*m),l=(d-l)*a.mass*g.behavior.mass/(m*m*m);g.behavior.fx+=(b-h)*a.mass*g.behavior.mass/(m*m*m)*g.behavior.mass;g.behavior.fy+=k*g.behavior.mass;g.behavior.fz+=l*g.behavior.mass}},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},Gravity:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];
a.el=b;"undefined"===typeof a.strength&&(a.strength=1);a.namea=b.args[0];a.nameb=b.args[1];a.ma=t[a.namea];a.mb=t[a.nameb]},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateDelta:function(a,b){},calculateForces:function(a){var b=D.extractPoint(a.ma.homog),c=D.extractPoint(a.mb.homog),d=(c.x-b.x)*a.strength;a=(c.y-b.y)*a.strength;for(b=0;b<W.length;b++)c=W[b],c.behavior.fx+=
d*c.behavior.mass,c.behavior.fy+=a*c.behavior.mass,c.behavior.fz+=0*c.behavior.mass},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},Spring:{init:function(a,b){a.el=b;"undefined"===typeof a.strength&&(a.strength=1);"undefined"===typeof a.amplitude&&(a.amplitude=0);"undefined"===typeof a.phase&&(a.phase=0);"undefined"===typeof a.speed&&(a.speed=1);"undefined"===
typeof a.l0&&(a.l0=0);"undefined"===typeof a.stype&&(a.stype=1);"undefined"===typeof a.readOnInit&&(a.readOnInit=!1);a.namea=b.args[0];a.nameb=b.args[1];a.ma=t[a.namea];a.mb=t[a.nameb];var c=D.extractPoint(a.ma.homog),d=D.extractPoint(a.mb.homog);a.l0=Math.sqrt((c.x-d.x)*(c.x-d.x)+(c.y-d.y)*(c.y-d.y));a.env=I.env},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateForces:function(a){var b,
c,d,f;!a.ma.behavior||da&&U.down&&a.ma===da.mover?(c=D.extractPoint(a.ma.homog),b=c.x,d=c.y):(b=a.ma.behavior.x,d=a.ma.behavior.y);!a.mb.behavior||da&&U.down&&a.mb===da.mover?(f=D.extractPoint(a.mb.homog),c=f.x,f=f.y):(c=a.mb.behavior.x,f=a.mb.behavior.y);var g=Math.sqrt((b-c)*(b-c)+(d-f)*(d-f)),h=a.l0,k=a.stype;1===k&&(h=0);var l=0;if(2===k||3===k)l=a.ma.behavior.mass*a.mb.behavior.mass*a.strength;2===k&&(l=-l);var m,n;if(0===g||0!==k&&1!==k)if(a.ma.behavior&&a.mb.behavior&&0!==g){if(g*=g*g,2===
k||3===k)m=(b-c)*l/g,n=(d-f)*l/g}else m=n=0;else m=-(b-c)*a.strength*(g-h)/g*a.env.springstrength,n=-(d-f)*a.strength*(g-h)/g*a.env.springstrength;a.ma.behavior&&(a.ma.behavior.fx+=m,a.ma.behavior.fy+=n);a.mb.behavior&&(a.mb.behavior.fx-=m,a.mb.behavior.fy-=n)},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},det:function(a,
b,c,d,f,g){return c*g-f*d+f*b-a*g+a*d-c*b},Bouncer:{init:function(a,b){a.el=b;"undefined"===typeof a.xdamp&&(a.xdamp=0);"undefined"===typeof a.ydamp&&(a.ydamp=0);"undefined"===typeof a.motorchanger&&(a.motorchanger=!0);a.namea=b.args[0];a.nameb=b.args[1];a.ma=t[a.namea];a.mb=t[a.nameb];var c=D.extractPoint(a.ma.homog),d=D.extractPoint(a.mb.homog);a.x1o=1.01*c.x-.01*d.x;a.y1o=1.01*c.y-.01*d.y;a.x2o=1.01*d.x-.01*c.x;a.y2o=1.01*d.y-.01*c.y;a.env=I.env},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,
b,c){},initRK:function(a,b){a.deltat=b},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateForces:function(a){},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){for(var b=D.extractPoint(a.ma.homog),c=D.extractPoint(a.mb.homog),d=b.x,b=b.y,f=c.x,c=c.y,g=a.x1o,h=a.y1o,l=a.x2o,m=a.y2o,
n=Math.sqrt((d-f)*(d-f)+(b-c)*(b-c)),p=(d-f)/n,n=(b-c)/n,t=0;t<W.length;t++){var u=W[t],v=u.behavior.xo,w=u.behavior.yo,x=u.behavior.x,y=u.behavior.y,z=k.mult(k.complex(g,h),k.complex(f,c)),A=k.mult(k.complex(l,m),k.complex(d,b)),z=k.sub(z,A),A=k.mult(k.complex(v,w),k.complex(d,b)),z=k.add(z,A),A=k.mult(k.complex(v,w),k.complex(f,c)),z=k.sub(z,A),A=k.sub(k.complex(g,h),k.complex(l,m)),z=k.div(z,A);0>I.det(d,b,f,c,x,y)*I.det(d,b,f,c,z.value.real,z.value.imag)&&0>I.det(d,b,x,y,z.value.real,z.value.imag)*
I.det(f,c,x,y,z.value.real,z.value.imag)&&(w=u.behavior.mvx+a.deltat*(-z.value.real+u.behavior.xo),x=u.behavior.mvy+a.deltat*(-z.value.imag+u.behavior.yo),v=p*w+n*x,w=n*w-p*x,u.behavior.x=z.value.real,u.behavior.y=z.value.imag,u.behavior.vx=p*v*(1-a.xdamp),u.behavior.vy=n*v*(1-a.xdamp),u.behavior.vx+=-n*w*(1-a.ydamp),u.behavior.vy+=p*w*(1-a.ydamp))}a.x1o=d;a.y1o=b;a.x2o=f;a.y2o=c}},Environment:{init:function(a){"undefined"===typeof a.gravity&&(a.gravity=0);"undefined"===typeof a.friction&&(a.friction=
0);"undefined"===typeof a.springstrength&&(a.springstrength=1);"undefined"===typeof a.accuracy&&(a.accuracy=10);"undefined"===typeof a.deltat&&(a.deltat=.3);"undefined"===typeof a.charges&&(a.charges=!1);"undefined"===typeof a.balls&&(a.balls=!1);"undefined"===typeof a.newton&&(a.newton=!1);"undefined"===typeof a.ballInteractionBoosting&&(a.ballInteractionBoosting=1);I.env=a;a.errorbound=.001;a.lowestdeltat=1E-7;a.slowdownfactor=2},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,
c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateForces:function(a){var b,c,d,f,g,h,k,l,m,n;if(a.newton)for(b=0;b<W.length-1;b++)for(c=W[b],d=c.behavior.x,f=c.behavior.y,g=b+1;g<W.length;g++)h=W[g],k=h.behavior.x,l=h.behavior.y,n=Math.sqrt((d-k)*(d-k)+(f-l)*(f-l)),k=(d-k)*c.behavior.mass*h.behavior.mass/(n*n*n),l=(f-l)*c.behavior.mass*h.behavior.mass/(n*n*n),c.behavior.fx-=k,c.behavior.fy-=l,h.behavior.fx+=k,h.behavior.fy+=l;
if(a.charges)for(b=0;b<W.length-1;b++)for(c=W[b],d=c.behavior.x,f=c.behavior.y,g=b+1;g<W.length;g++)h=W[g],k=h.behavior.x,l=h.behavior.y,n=Math.sqrt((d-k)*(d-k)+(f-l)*(f-l)),k=(d-k)*c.behavior.charge*h.behavior.charge/(n*n*n),l=(f-l)*c.behavior.charge*h.behavior.charge/(n*n*n),c.behavior.fx+=k,c.behavior.fy+=l,h.behavior.fx-=k,h.behavior.fy-=l;if(a.balls)for(b=0;b<W.length-1;b++)if(c=W[b],0!==c.behavior.radius)for(d=c.behavior.x,f=c.behavior.y,g=b+1;g<W.length;g++)h=W[g],0!==h.behavior.radius&&(k=
h.behavior.x,l=h.behavior.y,m=c.behavior.radius+h.behavior.radius,n=Math.sqrt((d-k)*(d-k)+(f-l)*(f-l)),0===a.ballInteractionBoosting?(k=(d-k)/(n*n*n)*(n>m?0:(n-m)*(n-m)),l=(f-l)/(n*n*n)*(n>m?0:(n-m)*(n-m))):1===a.ballInteractionBoosting?(k=(d-k)/(n*n*n*n)*(n>m?0:(n-m)*(n-m)),l=(f-l)/(n*n*n*n)*(n>m?0:(n-m)*(n-m))):(k=(d-k)/(n*n*n*n*n)*(n>m?0:(n-m)*(n-m)),l=(f-l)/(n*n*n*n*n)*(n>m?0:(n-m)*(n-m))),c.behavior.fx+=k,c.behavior.fy+=l,h.behavior.fx-=k,h.behavior.fy-=l);for(b=0;b<W.length;b++)c=W[b],c.behavior.fx+=
0,c.behavior.fy+=a.gravity,c.behavior.fz+=0},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}}};return Aa};return F}();"undefined"!==typeof process&&"undefined"!==typeof module&&"undefined"!==typeof module.exports&&"undefined"===typeof window&&(module.exports=createCindy);
//# sourceMappingURL=Cindy.js.map

