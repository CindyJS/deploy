/* CindyJS - (C) 2014-2016  The CindyJS Project
 * Mostly licensed under the Apache License 2.0, but subprojects may use different licensing.
 * See https://github.com/CindyJS/CindyJS/tree/260045bf22e92f1ab784917bb0ab568b94d0d8ed
 * for corresponding sources and their respective licensing conditions.
 */
(function(){function t(b,d,e){f.biginteger_used=1;null!=b&&("number"==typeof b&&"undefined"==typeof d?this.fromInt(b):"number"==typeof b?this.fromNumber(b,d,e):null==d&&"string"!=typeof b?this.fromString(b,256):this.fromString(b,d))}function G(){return new t(null,void 0,void 0)}function Ea(b,d,e,m,f,C){for(;0<=--C;){var k=d*this[b++]+e[m]+f;f=Math.floor(k/67108864);e[m++]=k&67108863}return f}function Ya(b,d,e,m,f,k){var u=d&32767;for(d>>=15;0<=--k;){var B=this[b]&32767,t=this[b++]>>15,I=d*B+t*u,B=
u*B+((I&32767)<<15)+e[m]+(f&1073741823);f=(B>>>30)+(I>>>15)+d*t+(f>>>30);e[m++]=B&1073741823}return f}function Ka(b,d,e,m,f,k){var u=d&16383;for(d>>=14;0<=--k;){var B=this[b]&16383,t=this[b++]>>14,I=d*B+t*u,B=u*B+((I&16383)<<14)+e[m]+f;f=(B>>28)+(I>>14)+d*t;e[m++]=B&268435455}return f}function Ia(b,d){var e=Za[b.charCodeAt(d)];return null==e?-1:e}function pa(b){var d=G();d.fromInt(b);return d}function k(b){var d=1,e;0!=(e=b>>>16)&&(b=e,d+=16);0!=(e=b>>8)&&(b=e,d+=8);0!=(e=b>>4)&&(b=e,d+=4);0!=(e=
b>>2)&&(b=e,d+=2);0!=b>>1&&(d+=1);return d}function Ta(b){this.m=b}function I(b){this.m=b;this.mp=b.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<b.DB-15)-1;this.mt2=2*b.t}function X(b,d){return b&d}function S(b,d){return b|d}function Y(b,d){return b^d}function ga(b,d){return b&~d}function wb(){}function Gc(b){return b}function ka(b){this.r2=G();this.q3=G();t.ONE.dlShiftTo(2*b.t,this.r2);this.mu=this.r2.divide(b);this.m=b}var f={use_lines:!0,use_xyz:!1},Ib=!1;"undefined"!==typeof module&&
module.exports?(module.exports=f,Ib=!0):"undefined"!==typeof document?window.ClipperLib=f:self.ClipperLib=f;var U;if(Ib)Z="chrome",U="Netscape";else{var Z=navigator.userAgent.toString().toLowerCase();U=navigator.appName}var La,Wb,$a,Ma,ab,Hc;La=-1!=Z.indexOf("chrome")&&-1==Z.indexOf("chromium")?1:0;Ib=-1!=Z.indexOf("chromium")?1:0;Wb=-1!=Z.indexOf("safari")&&-1==Z.indexOf("chrome")&&-1==Z.indexOf("chromium")?1:0;$a=-1!=Z.indexOf("firefox")?1:0;Z.indexOf("firefox/17");Z.indexOf("firefox/15");Z.indexOf("firefox/3");
Ma=-1!=Z.indexOf("opera")?1:0;Z.indexOf("msie 10");Z.indexOf("msie 9");ab=-1!=Z.indexOf("msie 8")?1:0;Hc=-1!=Z.indexOf("msie 7")?1:0;Z=-1!=Z.indexOf("msie ")?1:0;f.biginteger_used=null;"Microsoft Internet Explorer"==U?(t.prototype.am=Ya,U=30):"Netscape"!=U?(t.prototype.am=Ea,U=26):(t.prototype.am=Ka,U=28);t.prototype.DB=U;t.prototype.DM=(1<<U)-1;t.prototype.DV=1<<U;t.prototype.FV=Math.pow(2,52);t.prototype.F1=52-U;t.prototype.F2=2*U-52;var Za=[],ma;U=48;for(ma=0;9>=ma;++ma)Za[U++]=ma;U=97;for(ma=
10;36>ma;++ma)Za[U++]=ma;U=65;for(ma=10;36>ma;++ma)Za[U++]=ma;Ta.prototype.convert=function(b){return 0>b.s||0<=b.compareTo(this.m)?b.mod(this.m):b};Ta.prototype.revert=function(b){return b};Ta.prototype.reduce=function(b){b.divRemTo(this.m,null,b)};Ta.prototype.mulTo=function(b,d,e){b.multiplyTo(d,e);this.reduce(e)};Ta.prototype.sqrTo=function(b,d){b.squareTo(d);this.reduce(d)};I.prototype.convert=function(b){var d=G();b.abs().dlShiftTo(this.m.t,d);d.divRemTo(this.m,null,d);0>b.s&&0<d.compareTo(t.ZERO)&&
this.m.subTo(d,d);return d};I.prototype.revert=function(b){var d=G();b.copyTo(d);this.reduce(d);return d};I.prototype.reduce=function(b){for(;b.t<=this.mt2;)b[b.t++]=0;for(var d=0;d<this.m.t;++d){var e=b[d]&32767,m=e*this.mpl+((e*this.mph+(b[d]>>15)*this.mpl&this.um)<<15)&b.DM,e=d+this.m.t;for(b[e]+=this.m.am(0,m,b,d,0,this.m.t);b[e]>=b.DV;)b[e]-=b.DV,b[++e]++}b.clamp();b.drShiftTo(this.m.t,b);0<=b.compareTo(this.m)&&b.subTo(this.m,b)};I.prototype.mulTo=function(b,d,e){b.multiplyTo(d,e);this.reduce(e)};
I.prototype.sqrTo=function(b,d){b.squareTo(d);this.reduce(d)};t.prototype.copyTo=function(b){for(var d=this.t-1;0<=d;--d)b[d]=this[d];b.t=this.t;b.s=this.s};t.prototype.fromInt=function(b){this.t=1;this.s=0>b?-1:0;0<b?this[0]=b:-1>b?this[0]=b+this.DV:this.t=0};t.prototype.fromString=function(b,d){var e;if(16==d)e=4;else if(8==d)e=3;else if(256==d)e=8;else if(2==d)e=1;else if(32==d)e=5;else if(4==d)e=2;else{this.fromRadix(b,d);return}this.s=this.t=0;for(var m=b.length,f=!1,k=0;0<=--m;){var u=8==e?
b[m]&255:Ia(b,m);0>u?"-"==b.charAt(m)&&(f=!0):(f=!1,0==k?this[this.t++]=u:k+e>this.DB?(this[this.t-1]|=(u&(1<<this.DB-k)-1)<<k,this[this.t++]=u>>this.DB-k):this[this.t-1]|=u<<k,k+=e,k>=this.DB&&(k-=this.DB))}8==e&&0!=(b[0]&128)&&(this.s=-1,0<k&&(this[this.t-1]|=(1<<this.DB-k)-1<<k));this.clamp();f&&t.ZERO.subTo(this,this)};t.prototype.clamp=function(){for(var b=this.s&this.DM;0<this.t&&this[this.t-1]==b;)--this.t};t.prototype.dlShiftTo=function(b,d){var e;for(e=this.t-1;0<=e;--e)d[e+b]=this[e];for(e=
b-1;0<=e;--e)d[e]=0;d.t=this.t+b;d.s=this.s};t.prototype.drShiftTo=function(b,d){for(var e=b;e<this.t;++e)d[e-b]=this[e];d.t=Math.max(this.t-b,0);d.s=this.s};t.prototype.lShiftTo=function(b,d){var e=b%this.DB,m=this.DB-e,f=(1<<m)-1,k=Math.floor(b/this.DB),u=this.s<<e&this.DM,B;for(B=this.t-1;0<=B;--B)d[B+k+1]=this[B]>>m|u,u=(this[B]&f)<<e;for(B=k-1;0<=B;--B)d[B]=0;d[k]=u;d.t=this.t+k+1;d.s=this.s;d.clamp()};t.prototype.rShiftTo=function(b,d){d.s=this.s;var e=Math.floor(b/this.DB);if(e>=this.t)d.t=
0;else{var m=b%this.DB,f=this.DB-m,k=(1<<m)-1;d[0]=this[e]>>m;for(var u=e+1;u<this.t;++u)d[u-e-1]|=(this[u]&k)<<f,d[u-e]=this[u]>>m;0<m&&(d[this.t-e-1]|=(this.s&k)<<f);d.t=this.t-e;d.clamp()}};t.prototype.subTo=function(b,d){for(var e=0,m=0,f=Math.min(b.t,this.t);e<f;)m+=this[e]-b[e],d[e++]=m&this.DM,m>>=this.DB;if(b.t<this.t){for(m-=b.s;e<this.t;)m+=this[e],d[e++]=m&this.DM,m>>=this.DB;m+=this.s}else{for(m+=this.s;e<b.t;)m-=b[e],d[e++]=m&this.DM,m>>=this.DB;m-=b.s}d.s=0>m?-1:0;-1>m?d[e++]=this.DV+
m:0<m&&(d[e++]=m);d.t=e;d.clamp()};t.prototype.multiplyTo=function(b,d){var e=this.abs(),m=b.abs(),f=e.t;for(d.t=f+m.t;0<=--f;)d[f]=0;for(f=0;f<m.t;++f)d[f+e.t]=e.am(0,m[f],d,f,0,e.t);d.s=0;d.clamp();this.s!=b.s&&t.ZERO.subTo(d,d)};t.prototype.squareTo=function(b){for(var d=this.abs(),e=b.t=2*d.t;0<=--e;)b[e]=0;for(e=0;e<d.t-1;++e){var m=d.am(e,d[e],b,2*e,0,1);(b[e+d.t]+=d.am(e+1,2*d[e],b,2*e+1,m,d.t-e-1))>=d.DV&&(b[e+d.t]-=d.DV,b[e+d.t+1]=1)}0<b.t&&(b[b.t-1]+=d.am(e,d[e],b,2*e,0,1));b.s=0;b.clamp()};
t.prototype.divRemTo=function(b,d,e){var m=b.abs();if(!(0>=m.t)){var f=this.abs();if(f.t<m.t)null!=d&&d.fromInt(0),null!=e&&this.copyTo(e);else{null==e&&(e=G());var C=G(),u=this.s;b=b.s;var B=this.DB-k(m[m.t-1]);0<B?(m.lShiftTo(B,C),f.lShiftTo(B,e)):(m.copyTo(C),f.copyTo(e));m=C.t;f=C[m-1];if(0!=f){var Q=f*(1<<this.F1)+(1<m?C[m-2]>>this.F2:0),I=this.FV/Q,Q=(1<<this.F1)/Q,nb=1<<this.F2,J=e.t,X=J-m,V=null==d?G():d;C.dlShiftTo(X,V);0<=e.compareTo(V)&&(e[e.t++]=1,e.subTo(V,e));t.ONE.dlShiftTo(m,V);for(V.subTo(C,
C);C.t<m;)C[C.t++]=0;for(;0<=--X;){var S=e[--J]==f?this.DM:Math.floor(e[J]*I+(e[J-1]+nb)*Q);if((e[J]+=C.am(0,S,e,X,0,m))<S)for(C.dlShiftTo(X,V),e.subTo(V,e);e[J]<--S;)e.subTo(V,e)}null!=d&&(e.drShiftTo(m,d),u!=b&&t.ZERO.subTo(d,d));e.t=m;e.clamp();0<B&&e.rShiftTo(B,e);0>u&&t.ZERO.subTo(e,e)}}}};t.prototype.invDigit=function(){if(1>this.t)return 0;var b=this[0];if(0==(b&1))return 0;var d=b&3,d=d*(2-(b&15)*d)&15,d=d*(2-(b&255)*d)&255,d=d*(2-((b&65535)*d&65535))&65535,d=d*(2-b*d%this.DV)%this.DV;return 0<
d?this.DV-d:-d};t.prototype.isEven=function(){return 0==(0<this.t?this[0]&1:this.s)};t.prototype.exp=function(b,d){if(4294967295<b||1>b)return t.ONE;var e=G(),m=G(),f=d.convert(this),C=k(b)-1;for(f.copyTo(e);0<=--C;)if(d.sqrTo(e,m),0<(b&1<<C))d.mulTo(m,f,e);else var u=e,e=m,m=u;return d.revert(e)};t.prototype.toString=function(b){if(0>this.s)return"-"+this.negate().toString(b);if(16==b)b=4;else if(8==b)b=3;else if(2==b)b=1;else if(32==b)b=5;else if(4==b)b=2;else return this.toRadix(b);var d=(1<<b)-
1,e,m=!1,f="",k=this.t,u=this.DB-k*this.DB%b;if(0<k--)for(u<this.DB&&0<(e=this[k]>>u)&&(m=!0,f="0123456789abcdefghijklmnopqrstuvwxyz".charAt(e));0<=k;)u<b?(e=(this[k]&(1<<u)-1)<<b-u,e|=this[--k]>>(u+=this.DB-b)):(e=this[k]>>(u-=b)&d,0>=u&&(u+=this.DB,--k)),0<e&&(m=!0),m&&(f+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(e));return m?f:"0"};t.prototype.negate=function(){var b=G();t.ZERO.subTo(this,b);return b};t.prototype.abs=function(){return 0>this.s?this.negate():this};t.prototype.compareTo=function(b){var d=
this.s-b.s;if(0!=d)return d;var e=this.t,d=e-b.t;if(0!=d)return 0>this.s?-d:d;for(;0<=--e;)if(0!=(d=this[e]-b[e]))return d;return 0};t.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+k(this[this.t-1]^this.s&this.DM)};t.prototype.mod=function(b){var d=G();this.abs().divRemTo(b,null,d);0>this.s&&0<d.compareTo(t.ZERO)&&b.subTo(d,d);return d};t.prototype.modPowInt=function(b,d){var e;e=256>b||d.isEven()?new Ta(d):new I(d);return this.exp(b,e)};t.ZERO=pa(0);t.ONE=pa(1);wb.prototype.convert=
Gc;wb.prototype.revert=Gc;wb.prototype.mulTo=function(b,d,e){b.multiplyTo(d,e)};wb.prototype.sqrTo=function(b,d){b.squareTo(d)};ka.prototype.convert=function(b){if(0>b.s||b.t>2*this.m.t)return b.mod(this.m);if(0>b.compareTo(this.m))return b;var d=G();b.copyTo(d);this.reduce(d);return d};ka.prototype.revert=function(b){return b};ka.prototype.reduce=function(b){b.drShiftTo(this.m.t-1,this.r2);b.t>this.m.t+1&&(b.t=this.m.t+1,b.clamp());this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);for(this.m.multiplyLowerTo(this.q3,
this.m.t+1,this.r2);0>b.compareTo(this.r2);)b.dAddOffset(1,this.m.t+1);for(b.subTo(this.r2,b);0<=b.compareTo(this.m);)b.subTo(this.m,b)};ka.prototype.mulTo=function(b,d,e){b.multiplyTo(d,e);this.reduce(e)};ka.prototype.sqrTo=function(b,d){b.squareTo(d);this.reduce(d)};var J=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,
313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Yb=67108864/J[J.length-1];t.prototype.chunkSize=function(b){return Math.floor(Math.LN2*
this.DB/Math.log(b))};t.prototype.toRadix=function(b){null==b&&(b=10);if(0==this.signum()||2>b||36<b)return"0";var d=this.chunkSize(b),d=Math.pow(b,d),e=pa(d),m=G(),f=G(),k="";for(this.divRemTo(e,m,f);0<m.signum();)k=(d+f.intValue()).toString(b).substr(1)+k,m.divRemTo(e,m,f);return f.intValue().toString(b)+k};t.prototype.fromRadix=function(b,d){this.fromInt(0);null==d&&(d=10);for(var e=this.chunkSize(d),m=Math.pow(d,e),f=!1,k=0,u=0,B=0;B<b.length;++B){var Q=Ia(b,B);0>Q?"-"==b.charAt(B)&&0==this.signum()&&
(f=!0):(u=d*u+Q,++k>=e&&(this.dMultiply(m),this.dAddOffset(u,0),u=k=0))}0<k&&(this.dMultiply(Math.pow(d,k)),this.dAddOffset(u,0));f&&t.ZERO.subTo(this,this)};t.prototype.fromNumber=function(b,d,e){if("number"==typeof d)if(2>b)this.fromInt(1);else for(this.fromNumber(b,e),this.testBit(b-1)||this.bitwiseTo(t.ONE.shiftLeft(b-1),S,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(d);)this.dAddOffset(2,0),this.bitLength()>b&&this.subTo(t.ONE.shiftLeft(b-1),this);else{e=[];var m=b&7;e.length=
(b>>3)+1;d.nextBytes(e);e[0]=0<m?e[0]&(1<<m)-1:0;this.fromString(e,256)}};t.prototype.bitwiseTo=function(b,d,e){var m,f,k=Math.min(b.t,this.t);for(m=0;m<k;++m)e[m]=d(this[m],b[m]);if(b.t<this.t){f=b.s&this.DM;for(m=k;m<this.t;++m)e[m]=d(this[m],f);e.t=this.t}else{f=this.s&this.DM;for(m=k;m<b.t;++m)e[m]=d(f,b[m]);e.t=b.t}e.s=d(this.s,b.s);e.clamp()};t.prototype.changeBit=function(b,d){var e=t.ONE.shiftLeft(b);this.bitwiseTo(e,d,e);return e};t.prototype.addTo=function(b,d){for(var e=0,m=0,f=Math.min(b.t,
this.t);e<f;)m+=this[e]+b[e],d[e++]=m&this.DM,m>>=this.DB;if(b.t<this.t){for(m+=b.s;e<this.t;)m+=this[e],d[e++]=m&this.DM,m>>=this.DB;m+=this.s}else{for(m+=this.s;e<b.t;)m+=b[e],d[e++]=m&this.DM,m>>=this.DB;m+=b.s}d.s=0>m?-1:0;0<m?d[e++]=m:-1>m&&(d[e++]=this.DV+m);d.t=e;d.clamp()};t.prototype.dMultiply=function(b){this[this.t]=this.am(0,b-1,this,0,0,this.t);++this.t;this.clamp()};t.prototype.dAddOffset=function(b,d){if(0!=b){for(;this.t<=d;)this[this.t++]=0;for(this[d]+=b;this[d]>=this.DV;)this[d]-=
this.DV,++d>=this.t&&(this[this.t++]=0),++this[d]}};t.prototype.multiplyLowerTo=function(b,d,e){var m=Math.min(this.t+b.t,d);e.s=0;for(e.t=m;0<m;)e[--m]=0;var f;for(f=e.t-this.t;m<f;++m)e[m+this.t]=this.am(0,b[m],e,m,0,this.t);for(f=Math.min(b.t,d);m<f;++m)this.am(0,b[m],e,m,0,d-m);e.clamp()};t.prototype.multiplyUpperTo=function(b,d,e){--d;var m=e.t=this.t+b.t-d;for(e.s=0;0<=--m;)e[m]=0;for(m=Math.max(d-this.t,0);m<b.t;++m)e[this.t+m-d]=this.am(d-m,b[m],e,0,0,this.t+m-d);e.clamp();e.drShiftTo(1,e)};
t.prototype.modInt=function(b){if(0>=b)return 0;var d=this.DV%b,e=0>this.s?b-1:0;if(0<this.t)if(0==d)e=this[0]%b;else for(var m=this.t-1;0<=m;--m)e=(d*e+this[m])%b;return e};t.prototype.millerRabin=function(b){var d=this.subtract(t.ONE),e=d.getLowestSetBit();if(0>=e)return!1;var m=d.shiftRight(e);b=b+1>>1;b>J.length&&(b=J.length);for(var f=G(),k=0;k<b;++k){f.fromInt(J[Math.floor(Math.random()*J.length)]);var u=f.modPow(m,this);if(0!=u.compareTo(t.ONE)&&0!=u.compareTo(d)){for(var B=1;B++<e&&0!=u.compareTo(d);)if(u=
u.modPowInt(2,this),0==u.compareTo(t.ONE))return!1;if(0!=u.compareTo(d))return!1}}return!0};t.prototype.clone=function(){var b=G();this.copyTo(b);return b};t.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]};t.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24};t.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<
16>>16};t.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this[0]?0:1};t.prototype.toByteArray=function(){var b=this.t,d=[];d[0]=this.s;var e=this.DB-b*this.DB%8,m,f=0;if(0<b--)for(e<this.DB&&(m=this[b]>>e)!=(this.s&this.DM)>>e&&(d[f++]=m|this.s<<this.DB-e);0<=b;)if(8>e?(m=(this[b]&(1<<e)-1)<<8-e,m|=this[--b]>>(e+=this.DB-8)):(m=this[b]>>(e-=8)&255,0>=e&&(e+=this.DB,--b)),0!=(m&128)&&(m|=-256),0==f&&(this.s&128)!=(m&128)&&++f,0<f||m!=this.s)d[f++]=m;return d};t.prototype.equals=
function(b){return 0==this.compareTo(b)};t.prototype.min=function(b){return 0>this.compareTo(b)?this:b};t.prototype.max=function(b){return 0<this.compareTo(b)?this:b};t.prototype.and=function(b){var d=G();this.bitwiseTo(b,X,d);return d};t.prototype.or=function(b){var d=G();this.bitwiseTo(b,S,d);return d};t.prototype.xor=function(b){var d=G();this.bitwiseTo(b,Y,d);return d};t.prototype.andNot=function(b){var d=G();this.bitwiseTo(b,ga,d);return d};t.prototype.not=function(){for(var b=G(),d=0;d<this.t;++d)b[d]=
this.DM&~this[d];b.t=this.t;b.s=~this.s;return b};t.prototype.shiftLeft=function(b){var d=G();0>b?this.rShiftTo(-b,d):this.lShiftTo(b,d);return d};t.prototype.shiftRight=function(b){var d=G();0>b?this.lShiftTo(-b,d):this.rShiftTo(b,d);return d};t.prototype.getLowestSetBit=function(){for(var b=0;b<this.t;++b)if(0!=this[b]){var d=b*this.DB,b=this[b];if(0==b)b=-1;else{var e=0;0==(b&65535)&&(b>>=16,e+=16);0==(b&255)&&(b>>=8,e+=8);0==(b&15)&&(b>>=4,e+=4);0==(b&3)&&(b>>=2,e+=2);0==(b&1)&&++e;b=e}return d+
b}return 0>this.s?this.t*this.DB:-1};t.prototype.bitCount=function(){for(var b=0,d=this.s&this.DM,e=0;e<this.t;++e){for(var m=this[e]^d,f=0;0!=m;)m&=m-1,++f;b+=f}return b};t.prototype.testBit=function(b){var d=Math.floor(b/this.DB);return d>=this.t?0!=this.s:0!=(this[d]&1<<b%this.DB)};t.prototype.setBit=function(b){return this.changeBit(b,S)};t.prototype.clearBit=function(b){return this.changeBit(b,ga)};t.prototype.flipBit=function(b){return this.changeBit(b,Y)};t.prototype.add=function(b){var d=
G();this.addTo(b,d);return d};t.prototype.subtract=function(b){var d=G();this.subTo(b,d);return d};t.prototype.multiply=function(b){var d=G();this.multiplyTo(b,d);return d};t.prototype.divide=function(b){var d=G();this.divRemTo(b,d,null);return d};t.prototype.remainder=function(b){var d=G();this.divRemTo(b,null,d);return d};t.prototype.divideAndRemainder=function(b){var d=G(),e=G();this.divRemTo(b,d,e);return[d,e]};t.prototype.modPow=function(b,d){var e=b.bitLength(),m,f=pa(1),C;if(0>=e)return f;
m=18>e?1:48>e?3:144>e?4:768>e?5:6;C=8>e?new Ta(d):d.isEven()?new ka(d):new I(d);var u=[],B=3,t=m-1,mb=(1<<m)-1;u[1]=C.convert(this);if(1<m)for(e=G(),C.sqrTo(u[1],e);B<=mb;)u[B]=G(),C.mulTo(e,u[B-2],u[B]),B+=2;for(var J=b.t-1,X,S=!0,V=G(),e=k(b[J])-1;0<=J;){e>=t?X=b[J]>>e-t&mb:(X=(b[J]&(1<<e+1)-1)<<t-e,0<J&&(X|=b[J-1]>>this.DB+e-t));for(B=m;0==(X&1);)X>>=1,--B;0>(e-=B)&&(e+=this.DB,--J);if(S)u[X].copyTo(f),S=!1;else{for(;1<B;)C.sqrTo(f,V),C.sqrTo(V,f),B-=2;0<B?C.sqrTo(f,V):(B=f,f=V,V=B);C.mulTo(V,
u[X],f)}for(;0<=J&&0==(b[J]&1<<e);)C.sqrTo(f,V),B=f,f=V,V=B,0>--e&&(e=this.DB-1,--J)}return C.revert(f)};t.prototype.modInverse=function(b){var d=b.isEven();if(this.isEven()&&d||0==b.signum())return t.ZERO;for(var e=b.clone(),f=this.clone(),p=pa(1),k=pa(0),u=pa(0),B=pa(1);0!=e.signum();){for(;e.isEven();)e.rShiftTo(1,e),d?(p.isEven()&&k.isEven()||(p.addTo(this,p),k.subTo(b,k)),p.rShiftTo(1,p)):k.isEven()||k.subTo(b,k),k.rShiftTo(1,k);for(;f.isEven();)f.rShiftTo(1,f),d?(u.isEven()&&B.isEven()||(u.addTo(this,
u),B.subTo(b,B)),u.rShiftTo(1,u)):B.isEven()||B.subTo(b,B),B.rShiftTo(1,B);0<=e.compareTo(f)?(e.subTo(f,e),d&&p.subTo(u,p),k.subTo(B,k)):(f.subTo(e,f),d&&u.subTo(p,u),B.subTo(k,B))}if(0!=f.compareTo(t.ONE))return t.ZERO;if(0<=B.compareTo(b))return B.subtract(b);if(0>B.signum())B.addTo(b,B);else return B;return 0>B.signum()?B.add(b):B};t.prototype.pow=function(b){return this.exp(b,new wb)};t.prototype.gcd=function(b){var d=0>this.s?this.negate():this.clone();b=0>b.s?b.negate():b.clone();if(0>d.compareTo(b)){var e=
d,d=b;b=e}var e=d.getLowestSetBit(),f=b.getLowestSetBit();if(0>f)return d;e<f&&(f=e);for(0<f&&(d.rShiftTo(f,d),b.rShiftTo(f,b));0<d.signum();)0<(e=d.getLowestSetBit())&&d.rShiftTo(e,d),0<(e=b.getLowestSetBit())&&b.rShiftTo(e,b),0<=d.compareTo(b)?(d.subTo(b,d),d.rShiftTo(1,d)):(b.subTo(d,b),b.rShiftTo(1,b));0<f&&b.lShiftTo(f,b);return b};t.prototype.isProbablePrime=function(b){var d,e=this.abs();if(1==e.t&&e[0]<=J[J.length-1]){for(d=0;d<J.length;++d)if(e[0]==J[d])return!0;return!1}if(e.isEven())return!1;
for(d=1;d<J.length;){for(var f=J[d],p=d+1;p<J.length&&f<Yb;)f*=J[p++];for(f=e.modInt(f);d<p;)if(0==f%J[d++])return!1}return e.millerRabin(b)};t.prototype.square=function(){var b=G();this.squareTo(b);return b};t.prototype.IsNegative=function(){return-1==this.compareTo(t.ZERO)?!0:!1};t.op_Equality=function(b,d){return 0==b.compareTo(d)?!0:!1};t.op_Inequality=function(b,d){return 0!=b.compareTo(d)?!0:!1};t.op_GreaterThan=function(b,d){return 0<b.compareTo(d)?!0:!1};t.op_LessThan=function(b,d){return 0>
b.compareTo(d)?!0:!1};t.op_Addition=function(b,d){return(new t(b)).add(new t(d))};t.op_Subtraction=function(b,d){return(new t(b)).subtract(new t(d))};t.Int128Mul=function(b,d){return(new t(b)).multiply(new t(d))};t.op_Division=function(b,d){return b.divide(d)};t.prototype.ToDouble=function(){return parseFloat(this.toString())};U=function(b,d){var e;if("undefined"==typeof Object.getOwnPropertyNames)for(e in d.prototype){if("undefined"==typeof b.prototype[e]||b.prototype[e]==Object.prototype[e])b.prototype[e]=
d.prototype[e]}else for(var f=Object.getOwnPropertyNames(d.prototype),p=0;p<f.length;p++)"undefined"==typeof Object.getOwnPropertyDescriptor(b.prototype,f[p])&&Object.defineProperty(b.prototype,f[p],Object.getOwnPropertyDescriptor(d.prototype,f[p]));for(e in d)"undefined"==typeof b[e]&&(b[e]=d[e]);b.$baseCtor=d};f.Path=function(){return[]};f.Paths=function(){return[]};f.DoublePoint=function(){var b=arguments;this.Y=this.X=0;1==b.length?(this.X=b[0].X,this.Y=b[0].Y):2==b.length&&(this.X=b[0],this.Y=
b[1])};f.DoublePoint0=function(){this.Y=this.X=0};f.DoublePoint1=function(b){this.X=b.X;this.Y=b.Y};f.DoublePoint2=function(b,d){this.X=b;this.Y=d};f.PolyNode=function(){this.m_Parent=null;this.m_polygon=new f.Path;this.m_endtype=this.m_jointype=this.m_Index=0;this.m_Childs=[];this.IsOpen=!1};f.PolyNode.prototype.IsHoleNode=function(){for(var b=!0,d=this.m_Parent;null!==d;)b=!b,d=d.m_Parent;return b};f.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length};f.PolyNode.prototype.Contour=
function(){return this.m_polygon};f.PolyNode.prototype.AddChild=function(b){var d=this.m_Childs.length;this.m_Childs.push(b);b.m_Parent=this;b.m_Index=d};f.PolyNode.prototype.GetNext=function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()};f.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]};f.PolyNode.prototype.Childs=function(){return this.m_Childs};
f.PolyNode.prototype.Parent=function(){return this.m_Parent};f.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()};f.PolyTree=function(){this.m_AllPolys=[];f.PolyNode.call(this)};f.PolyTree.prototype.Clear=function(){for(var b=0,d=this.m_AllPolys.length;b<d;b++)this.m_AllPolys[b]=null;this.m_AllPolys.length=0;this.m_Childs.length=0};f.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null};f.PolyTree.prototype.Total=function(){var b=this.m_AllPolys.length;
0<b&&this.m_Childs[0]!=this.m_AllPolys[0]&&b--;return b};U(f.PolyTree,f.PolyNode);f.Math_Abs_Int64=f.Math_Abs_Int32=f.Math_Abs_Double=function(b){return Math.abs(b)};f.Math_Max_Int32_Int32=function(b,d){return Math.max(b,d)};f.Cast_Int32=Z||Ma||Wb?function(b){return b|0}:function(b){return~~b};f.Cast_Int64=La?function(b){return-2147483648>b||2147483647<b?0>b?Math.ceil(b):Math.floor(b):~~b}:$a&&"function"==typeof Number.toInteger?function(b){return Number.toInteger(b)}:Hc||ab?function(b){return parseInt(b,
10)}:Z?function(b){return-2147483648>b||2147483647<b?0>b?Math.ceil(b):Math.floor(b):b|0}:function(b){return 0>b?Math.ceil(b):Math.floor(b)};f.Clear=function(b){b.length=0};f.PI=3.141592653589793;f.PI2=6.283185307179586;f.IntPoint=function(){var b=arguments,d=b.length;this.Y=this.X=0;f.use_xyz?(this.Z=0,3==d?(this.X=b[0],this.Y=b[1],this.Z=b[2]):2==d?(this.X=b[0],this.Y=b[1],this.Z=0):1==d?b[0]instanceof f.DoublePoint?(b=b[0],this.X=f.Clipper.Round(b.X),this.Y=f.Clipper.Round(b.Y),this.Z=0):(b=b[0],
"undefined"==typeof b.Z&&(b.Z=0),this.X=b.X,this.Y=b.Y,this.Z=b.Z):this.Z=this.Y=this.X=0):2==d?(this.X=b[0],this.Y=b[1]):1==d?b[0]instanceof f.DoublePoint?(b=b[0],this.X=f.Clipper.Round(b.X),this.Y=f.Clipper.Round(b.Y)):(b=b[0],this.X=b.X,this.Y=b.Y):this.Y=this.X=0};f.IntPoint.op_Equality=function(b,d){return b.X==d.X&&b.Y==d.Y};f.IntPoint.op_Inequality=function(b,d){return b.X!=d.X||b.Y!=d.Y};f.use_xyz?(f.IntPoint0=function(){this.Z=this.Y=this.X=0},f.IntPoint1=function(b){this.X=b.X;this.Y=b.Y;
this.Z=b.Z},f.IntPoint1dp=function(b){this.X=f.Clipper.Round(b.X);this.Y=f.Clipper.Round(b.Y);this.Z=0},f.IntPoint2=function(b,d){this.X=b;this.Y=d;this.Z=0},f.IntPoint3=function(b,d,e){this.X=b;this.Y=d;this.Z=e}):(f.IntPoint0=function(){this.Y=this.X=0},f.IntPoint1=function(b){this.X=b.X;this.Y=b.Y},f.IntPoint1dp=function(b){this.X=f.Clipper.Round(b.X);this.Y=f.Clipper.Round(b.Y)},f.IntPoint2=function(b,d){this.X=b;this.Y=d});f.IntRect=function(){var b=arguments,d=b.length;4==d?(this.left=b[0],
this.top=b[1],this.right=b[2],this.bottom=b[3]):1==d?(this.left=b[0].left,this.top=b[0].top,this.right=b[0].right,this.bottom=b[0].bottom):this.bottom=this.right=this.top=this.left=0};f.IntRect0=function(){this.bottom=this.right=this.top=this.left=0};f.IntRect1=function(b){this.left=b.left;this.top=b.top;this.right=b.right;this.bottom=b.bottom};f.IntRect4=function(b,d,e,f){this.left=b;this.top=d;this.right=e;this.bottom=f};f.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3};f.PolyType=
{ptSubject:0,ptClip:1};f.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3};f.JoinType={jtSquare:0,jtRound:1,jtMiter:2};f.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4};f.EdgeSide={esLeft:0,esRight:1};f.Direction={dRightToLeft:0,dLeftToRight:1};f.TEdge=function(){this.Bot=new f.IntPoint;this.Curr=new f.IntPoint;this.Top=new f.IntPoint;this.Delta=new f.IntPoint;this.Dx=0;this.PolyTyp=f.PolyType.ptSubject;this.Side=f.EdgeSide.esLeft;this.OutIdx=
this.WindCnt2=this.WindCnt=this.WindDelta=0;this.PrevInSEL=this.NextInSEL=this.PrevInAEL=this.NextInAEL=this.NextInLML=this.Prev=this.Next=null};f.IntersectNode=function(){this.Edge2=this.Edge1=null;this.Pt=new f.IntPoint};f.MyIntersectNodeSort=function(){};f.MyIntersectNodeSort.Compare=function(b,d){var e=d.Pt.Y-b.Pt.Y;return 0<e?1:0>e?-1:0};f.LocalMinima=function(){this.Y=0;this.Next=this.RightBound=this.LeftBound=null};f.Scanbeam=function(){this.Y=0;this.Next=null};f.OutRec=function(){this.Idx=
0;this.IsOpen=this.IsHole=!1;this.PolyNode=this.BottomPt=this.Pts=this.FirstLeft=null};f.OutPt=function(){this.Idx=0;this.Pt=new f.IntPoint;this.Prev=this.Next=null};f.Join=function(){this.OutPt2=this.OutPt1=null;this.OffPt=new f.IntPoint};f.ClipperBase=function(){this.m_CurrentLM=this.m_MinimaList=null;this.m_edges=[];this.PreserveCollinear=this.m_HasOpenPaths=this.m_UseFullRange=!1;this.m_CurrentLM=this.m_MinimaList=null;this.m_HasOpenPaths=this.m_UseFullRange=!1};f.ClipperBase.horizontal=-9007199254740992;
f.ClipperBase.Skip=-2;f.ClipperBase.Unassigned=-1;f.ClipperBase.tolerance=1E-20;f.ClipperBase.loRange=47453132;f.ClipperBase.hiRange=0xfffffffffffff;f.ClipperBase.near_zero=function(b){return b>-f.ClipperBase.tolerance&&b<f.ClipperBase.tolerance};f.ClipperBase.IsHorizontal=function(b){return 0===b.Delta.Y};f.ClipperBase.prototype.PointIsVertex=function(b,d){var e=d;do{if(f.IntPoint.op_Equality(e.Pt,b))return!0;e=e.Next}while(e!=d);return!1};f.ClipperBase.prototype.PointOnLineSegment=function(b,d,
e,f){return f?b.X==d.X&&b.Y==d.Y||b.X==e.X&&b.Y==e.Y||b.X>d.X==b.X<e.X&&b.Y>d.Y==b.Y<e.Y&&t.op_Equality(t.Int128Mul(b.X-d.X,e.Y-d.Y),t.Int128Mul(e.X-d.X,b.Y-d.Y)):b.X==d.X&&b.Y==d.Y||b.X==e.X&&b.Y==e.Y||b.X>d.X==b.X<e.X&&b.Y>d.Y==b.Y<e.Y&&(b.X-d.X)*(e.Y-d.Y)==(e.X-d.X)*(b.Y-d.Y)};f.ClipperBase.prototype.PointOnPolygon=function(b,d,e){for(var f=d;;){if(this.PointOnLineSegment(b,f.Pt,f.Next.Pt,e))return!0;f=f.Next;if(f==d)break}return!1};f.ClipperBase.prototype.SlopesEqual=f.ClipperBase.SlopesEqual=
function(){var b=arguments,d=b.length,e,m,p;if(3==d)return d=b[0],e=b[1],b[2]?t.op_Equality(t.Int128Mul(d.Delta.Y,e.Delta.X),t.Int128Mul(d.Delta.X,e.Delta.Y)):f.Cast_Int64(d.Delta.Y*e.Delta.X)==f.Cast_Int64(d.Delta.X*e.Delta.Y);if(4==d)return d=b[0],e=b[1],m=b[2],b[3]?t.op_Equality(t.Int128Mul(d.Y-e.Y,e.X-m.X),t.Int128Mul(d.X-e.X,e.Y-m.Y)):0===f.Cast_Int64((d.Y-e.Y)*(e.X-m.X))-f.Cast_Int64((d.X-e.X)*(e.Y-m.Y));d=b[0];e=b[1];m=b[2];p=b[3];return b[4]?t.op_Equality(t.Int128Mul(d.Y-e.Y,m.X-p.X),t.Int128Mul(d.X-
e.X,m.Y-p.Y)):0===f.Cast_Int64((d.Y-e.Y)*(m.X-p.X))-f.Cast_Int64((d.X-e.X)*(m.Y-p.Y))};f.ClipperBase.SlopesEqual3=function(b,d,e){return e?t.op_Equality(t.Int128Mul(b.Delta.Y,d.Delta.X),t.Int128Mul(b.Delta.X,d.Delta.Y)):f.Cast_Int64(b.Delta.Y*d.Delta.X)==f.Cast_Int64(b.Delta.X*d.Delta.Y)};f.ClipperBase.SlopesEqual4=function(b,d,e,m){return m?t.op_Equality(t.Int128Mul(b.Y-d.Y,d.X-e.X),t.Int128Mul(b.X-d.X,d.Y-e.Y)):0===f.Cast_Int64((b.Y-d.Y)*(d.X-e.X))-f.Cast_Int64((b.X-d.X)*(d.Y-e.Y))};f.ClipperBase.SlopesEqual5=
function(b,d,e,m,p){return p?t.op_Equality(t.Int128Mul(b.Y-d.Y,e.X-m.X),t.Int128Mul(b.X-d.X,e.Y-m.Y)):0===f.Cast_Int64((b.Y-d.Y)*(e.X-m.X))-f.Cast_Int64((b.X-d.X)*(e.Y-m.Y))};f.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var b=0,d=this.m_edges.length;b<d;++b){for(var e=0,m=this.m_edges[b].length;e<m;++e)this.m_edges[b][e]=null;f.Clear(this.m_edges[b])}f.Clear(this.m_edges);this.m_HasOpenPaths=this.m_UseFullRange=!1};f.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==
this.m_MinimaList;){var b=this.m_MinimaList.Next;this.m_MinimaList=null;this.m_MinimaList=b}this.m_CurrentLM=null};f.ClipperBase.prototype.RangeTest=function(b,d){if(d.Value)(b.X>f.ClipperBase.hiRange||b.Y>f.ClipperBase.hiRange||-b.X>f.ClipperBase.hiRange||-b.Y>f.ClipperBase.hiRange)&&f.Error("Coordinate outside allowed range in RangeTest().");else if(b.X>f.ClipperBase.loRange||b.Y>f.ClipperBase.loRange||-b.X>f.ClipperBase.loRange||-b.Y>f.ClipperBase.loRange)d.Value=!0,this.RangeTest(b,d)};f.ClipperBase.prototype.InitEdge=
function(b,d,e,m){b.Next=d;b.Prev=e;b.Curr.X=m.X;b.Curr.Y=m.Y;f.use_xyz&&(b.Curr.Z=m.Z);b.OutIdx=-1};f.ClipperBase.prototype.InitEdge2=function(b,d){b.Curr.Y>=b.Next.Curr.Y?(b.Bot.X=b.Curr.X,b.Bot.Y=b.Curr.Y,f.use_xyz&&(b.Bot.Z=b.Curr.Z),b.Top.X=b.Next.Curr.X,b.Top.Y=b.Next.Curr.Y,f.use_xyz&&(b.Top.Z=b.Next.Curr.Z)):(b.Top.X=b.Curr.X,b.Top.Y=b.Curr.Y,f.use_xyz&&(b.Top.Z=b.Curr.Z),b.Bot.X=b.Next.Curr.X,b.Bot.Y=b.Next.Curr.Y,f.use_xyz&&(b.Bot.Z=b.Next.Curr.Z));this.SetDx(b);b.PolyTyp=d};f.ClipperBase.prototype.FindNextLocMin=
function(b){for(var d;;){for(;f.IntPoint.op_Inequality(b.Bot,b.Prev.Bot)||f.IntPoint.op_Equality(b.Curr,b.Top);)b=b.Next;if(b.Dx!=f.ClipperBase.horizontal&&b.Prev.Dx!=f.ClipperBase.horizontal)break;for(;b.Prev.Dx==f.ClipperBase.horizontal;)b=b.Prev;for(d=b;b.Dx==f.ClipperBase.horizontal;)b=b.Next;if(b.Top.Y!=b.Prev.Bot.Y){d.Prev.Bot.X<b.Bot.X&&(b=d);break}}return b};f.ClipperBase.prototype.ProcessBound=function(b,d){var e,m=b,p;if(m.OutIdx==f.ClipperBase.Skip){b=m;if(d){for(;b.Top.Y==b.Next.Bot.Y;)b=
b.Next;for(;b!=m&&b.Dx==f.ClipperBase.horizontal;)b=b.Prev}else{for(;b.Top.Y==b.Prev.Bot.Y;)b=b.Prev;for(;b!=m&&b.Dx==f.ClipperBase.horizontal;)b=b.Next}b==m?m=d?b.Next:b.Prev:(b=d?m.Next:m.Prev,e=new f.LocalMinima,e.Next=null,e.Y=b.Bot.Y,e.LeftBound=null,e.RightBound=b,b.WindDelta=0,m=this.ProcessBound(b,d),this.InsertLocalMinima(e));return m}b.Dx==f.ClipperBase.horizontal&&(e=d?b.Prev:b.Next,e.OutIdx!=f.ClipperBase.Skip&&(e.Dx==f.ClipperBase.horizontal?e.Bot.X!=b.Bot.X&&e.Top.X!=b.Bot.X&&this.ReverseHorizontal(b):
e.Bot.X!=b.Bot.X&&this.ReverseHorizontal(b)));e=b;if(d){for(;m.Top.Y==m.Next.Bot.Y&&m.Next.OutIdx!=f.ClipperBase.Skip;)m=m.Next;if(m.Dx==f.ClipperBase.horizontal&&m.Next.OutIdx!=f.ClipperBase.Skip){for(p=m;p.Prev.Dx==f.ClipperBase.horizontal;)p=p.Prev;p.Prev.Top.X==m.Next.Top.X?d||(m=p.Prev):p.Prev.Top.X>m.Next.Top.X&&(m=p.Prev)}for(;b!=m;)b.NextInLML=b.Next,b.Dx==f.ClipperBase.horizontal&&b!=e&&b.Bot.X!=b.Prev.Top.X&&this.ReverseHorizontal(b),b=b.Next;b.Dx==f.ClipperBase.horizontal&&b!=e&&b.Bot.X!=
b.Prev.Top.X&&this.ReverseHorizontal(b);m=m.Next}else{for(;m.Top.Y==m.Prev.Bot.Y&&m.Prev.OutIdx!=f.ClipperBase.Skip;)m=m.Prev;if(m.Dx==f.ClipperBase.horizontal&&m.Prev.OutIdx!=f.ClipperBase.Skip){for(p=m;p.Next.Dx==f.ClipperBase.horizontal;)p=p.Next;p.Next.Top.X==m.Prev.Top.X?d||(m=p.Next):p.Next.Top.X>m.Prev.Top.X&&(m=p.Next)}for(;b!=m;)b.NextInLML=b.Prev,b.Dx==f.ClipperBase.horizontal&&b!=e&&b.Bot.X!=b.Next.Top.X&&this.ReverseHorizontal(b),b=b.Prev;b.Dx==f.ClipperBase.horizontal&&b!=e&&b.Bot.X!=
b.Next.Top.X&&this.ReverseHorizontal(b);m=m.Prev}return m};f.ClipperBase.prototype.AddPath=function(b,d,e){f.use_lines?e||d!=f.PolyType.ptClip||f.Error("AddPath: Open paths must be subject."):e||f.Error("AddPath: Open paths have been disabled.");var m=b.length-1;if(e)for(;0<m&&f.IntPoint.op_Equality(b[m],b[0]);)--m;for(;0<m&&f.IntPoint.op_Equality(b[m],b[m-1]);)--m;if(e&&2>m||!e&&1>m)return!1;for(var p=[],k=0;k<=m;k++)p.push(new f.TEdge);var u=!0;p[1].Curr.X=b[1].X;p[1].Curr.Y=b[1].Y;f.use_xyz&&(p[1].Curr.Z=
b[1].Z);var B={Value:this.m_UseFullRange};this.RangeTest(b[0],B);this.m_UseFullRange=B.Value;B.Value=this.m_UseFullRange;this.RangeTest(b[m],B);this.m_UseFullRange=B.Value;this.InitEdge(p[0],p[1],p[m],b[0]);this.InitEdge(p[m],p[0],p[m-1],b[m]);for(k=m-1;1<=k;--k)B.Value=this.m_UseFullRange,this.RangeTest(b[k],B),this.m_UseFullRange=B.Value,this.InitEdge(p[k],p[k+1],p[k-1],b[k]);for(k=b=m=p[0];;)if(b.Curr!=b.Next.Curr||!e&&b.Next==m){if(b.Prev==b.Next)break;else if(e&&f.ClipperBase.SlopesEqual(b.Prev.Curr,
b.Curr,b.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(b.Prev.Curr,b.Curr,b.Next.Curr))){b==m&&(m=b.Next);b=this.RemoveEdge(b);k=b=b.Prev;continue}b=b.Next;if(b==k||!e&&b.Next==m)break}else{if(b==b.Next)break;b==m&&(m=b.Next);k=b=this.RemoveEdge(b)}if(!e&&b==b.Next||e&&b.Prev==b.Next)return!1;e||(this.m_HasOpenPaths=!0,m.Prev.OutIdx=f.ClipperBase.Skip);b=m;do this.InitEdge2(b,d),b=b.Next,u&&b.Curr.Y!=m.Curr.Y&&(u=!1);while(b!=m);if(u){if(e)return!1;b.Prev.OutIdx=
f.ClipperBase.Skip;b.Prev.Bot.X<b.Prev.Top.X&&this.ReverseHorizontal(b.Prev);d=new f.LocalMinima;d.Next=null;d.Y=b.Bot.Y;d.LeftBound=null;d.RightBound=b;d.RightBound.Side=f.EdgeSide.esRight;for(d.RightBound.WindDelta=0;b.Next.OutIdx!=f.ClipperBase.Skip;)b.NextInLML=b.Next,b.Bot.X!=b.Prev.Top.X&&this.ReverseHorizontal(b),b=b.Next;this.InsertLocalMinima(d);this.m_edges.push(p);return!0}this.m_edges.push(p);u=null;for(f.IntPoint.op_Equality(b.Prev.Bot,b.Prev.Top)&&(b=b.Next);;){b=this.FindNextLocMin(b);
if(b==u)break;else null==u&&(u=b);d=new f.LocalMinima;d.Next=null;d.Y=b.Bot.Y;b.Dx<b.Prev.Dx?(d.LeftBound=b.Prev,d.RightBound=b,p=!1):(d.LeftBound=b,d.RightBound=b.Prev,p=!0);d.LeftBound.Side=f.EdgeSide.esLeft;d.RightBound.Side=f.EdgeSide.esRight;d.LeftBound.WindDelta=e?d.LeftBound.Next==d.RightBound?-1:1:0;d.RightBound.WindDelta=-d.LeftBound.WindDelta;b=this.ProcessBound(d.LeftBound,p);b.OutIdx==f.ClipperBase.Skip&&(b=this.ProcessBound(b,p));m=this.ProcessBound(d.RightBound,!p);m.OutIdx==f.ClipperBase.Skip&&
(m=this.ProcessBound(m,!p));d.LeftBound.OutIdx==f.ClipperBase.Skip?d.LeftBound=null:d.RightBound.OutIdx==f.ClipperBase.Skip&&(d.RightBound=null);this.InsertLocalMinima(d);p||(b=m)}return!0};f.ClipperBase.prototype.AddPaths=function(b,d,e){for(var f=!1,p=0,k=b.length;p<k;++p)this.AddPath(b[p],d,e)&&(f=!0);return f};f.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(b,d,e){return f.IntPoint.op_Equality(b,e)||f.IntPoint.op_Equality(b,d)||f.IntPoint.op_Equality(e,d)?!1:b.X!=e.X?d.X>b.X==d.X<e.X:d.Y>
b.Y==d.Y<e.Y};f.ClipperBase.prototype.RemoveEdge=function(b){b.Prev.Next=b.Next;b.Next.Prev=b.Prev;var d=b.Next;b.Prev=null;return d};f.ClipperBase.prototype.SetDx=function(b){b.Delta.X=b.Top.X-b.Bot.X;b.Delta.Y=b.Top.Y-b.Bot.Y;b.Dx=0===b.Delta.Y?f.ClipperBase.horizontal:b.Delta.X/b.Delta.Y};f.ClipperBase.prototype.InsertLocalMinima=function(b){if(null===this.m_MinimaList)this.m_MinimaList=b;else if(b.Y>=this.m_MinimaList.Y)b.Next=this.m_MinimaList,this.m_MinimaList=b;else{for(var d=this.m_MinimaList;null!==
d.Next&&b.Y<d.Next.Y;)d=d.Next;b.Next=d.Next;d.Next=b}};f.ClipperBase.prototype.PopLocalMinima=function(){null!==this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.Next)};f.ClipperBase.prototype.ReverseHorizontal=function(b){var d=b.Top.X;b.Top.X=b.Bot.X;b.Bot.X=d;f.use_xyz&&(d=b.Top.Z,b.Top.Z=b.Bot.Z,b.Bot.Z=d)};f.ClipperBase.prototype.Reset=function(){this.m_CurrentLM=this.m_MinimaList;if(null!=this.m_CurrentLM)for(var b=this.m_MinimaList;null!=b;){var d=b.LeftBound;null!=d&&(d.Curr.X=d.Bot.X,
d.Curr.Y=d.Bot.Y,f.use_xyz&&(d.Curr.Z=d.Bot.Z),d.Side=f.EdgeSide.esLeft,d.OutIdx=f.ClipperBase.Unassigned);d=b.RightBound;null!=d&&(d.Curr.X=d.Bot.X,d.Curr.Y=d.Bot.Y,f.use_xyz&&(d.Curr.Z=d.Bot.Z),d.Side=f.EdgeSide.esRight,d.OutIdx=f.ClipperBase.Unassigned);b=b.Next}};f.Clipper=function(b){"undefined"==typeof b&&(b=0);this.m_PolyOuts=null;this.m_ClipType=f.ClipType.ctIntersection;this.m_IntersectNodeComparer=this.m_IntersectList=this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_ExecuteLocked=
!1;this.m_SubjFillType=this.m_ClipFillType=f.PolyFillType.pftEvenOdd;this.m_GhostJoins=this.m_Joins=null;this.StrictlySimple=this.ReverseSolution=this.m_UsingPolyTree=!1;f.ClipperBase.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_IntersectList=[];this.m_IntersectNodeComparer=f.MyIntersectNodeSort.Compare;this.m_UsingPolyTree=this.m_ExecuteLocked=!1;this.m_PolyOuts=[];this.m_Joins=[];this.m_GhostJoins=[];this.ReverseSolution=0!==(1&b);this.StrictlySimple=0!==(2&b);this.PreserveCollinear=
0!==(4&b);f.use_xyz&&(this.ZFillFunction=null)};f.Clipper.ioReverseSolution=1;f.Clipper.ioStrictlySimple=2;f.Clipper.ioPreserveCollinear=4;f.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),f.ClipperBase.prototype.Clear.call(this))};f.Clipper.prototype.DisposeScanbeamList=function(){for(;null!==this.m_Scanbeam;){var b=this.m_Scanbeam.Next;this.m_Scanbeam=null;this.m_Scanbeam=b}};f.Clipper.prototype.Reset=function(){f.ClipperBase.prototype.Reset.call(this);this.m_SortedEdges=
this.m_ActiveEdges=this.m_Scanbeam=null;for(var b=this.m_MinimaList;null!==b;)this.InsertScanbeam(b.Y),b=b.Next};f.Clipper.prototype.InsertScanbeam=function(b){if(null===this.m_Scanbeam)this.m_Scanbeam=new f.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=b;else if(b>this.m_Scanbeam.Y){var d=new f.Scanbeam;d.Y=b;d.Next=this.m_Scanbeam;this.m_Scanbeam=d}else{for(var e=this.m_Scanbeam;null!==e.Next&&b<=e.Next.Y;)e=e.Next;b!=e.Y&&(d=new f.Scanbeam,d.Y=b,d.Next=e.Next,e.Next=d)}};f.Clipper.prototype.Execute=
function(){var b=arguments,d=b.length,e=b[1]instanceof f.PolyTree;if(4!=d||e){if(4==d&&e){var d=b[0],m=b[1],e=b[2],b=b[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;this.m_SubjFillType=e;this.m_ClipFillType=b;this.m_ClipType=d;this.m_UsingPolyTree=!0;try{(p=this.ExecuteInternal())&&this.BuildResult2(m)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return p}if(2==d&&!e||2==d&&e)return d=b[0],m=b[1],this.Execute(d,m,f.PolyFillType.pftEvenOdd,f.PolyFillType.pftEvenOdd)}else{d=
b[0];m=b[1];e=b[2];b=b[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&f.Error("Error: PolyTree struct is need for open path clipping.");this.m_ExecuteLocked=!0;f.Clear(m);this.m_SubjFillType=e;this.m_ClipFillType=b;this.m_ClipType=d;this.m_UsingPolyTree=!1;try{var p=this.ExecuteInternal();p&&this.BuildResult(m)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return p}};f.Clipper.prototype.FixHoleLinkage=function(b){if(null!==b.FirstLeft&&(b.IsHole==b.FirstLeft.IsHole||null===b.FirstLeft.Pts)){for(var d=
b.FirstLeft;null!==d&&(d.IsHole==b.IsHole||null===d.Pts);)d=d.FirstLeft;b.FirstLeft=d}};f.Clipper.prototype.ExecuteInternal=function(){try{this.Reset();if(null===this.m_CurrentLM)return!1;var b=this.PopScanbeam();do{this.InsertLocalMinimaIntoAEL(b);f.Clear(this.m_GhostJoins);this.ProcessHorizontals(!1);if(null===this.m_Scanbeam)break;var d=this.PopScanbeam();if(!this.ProcessIntersections(d))return!1;this.ProcessEdgesAtTopOfScanbeam(d);b=d}while(null!==this.m_Scanbeam||null!==this.m_CurrentLM);for(var b=
0,e=this.m_PolyOuts.length;b<e;b++){var m=this.m_PolyOuts[b];null===m.Pts||m.IsOpen||(m.IsHole^this.ReverseSolution)==0<this.Area(m)&&this.ReversePolyPtLinks(m.Pts)}this.JoinCommonEdges();b=0;for(e=this.m_PolyOuts.length;b<e;b++)m=this.m_PolyOuts[b],null===m.Pts||m.IsOpen||this.FixupOutPolygon(m);this.StrictlySimple&&this.DoSimplePolygons();return!0}finally{f.Clear(this.m_Joins),f.Clear(this.m_GhostJoins)}};f.Clipper.prototype.PopScanbeam=function(){var b=this.m_Scanbeam.Y;this.m_Scanbeam=this.m_Scanbeam.Next;
return b};f.Clipper.prototype.DisposeAllPolyPts=function(){for(var b=0,d=this.m_PolyOuts.length;b<d;++b)this.DisposeOutRec(b);f.Clear(this.m_PolyOuts)};f.Clipper.prototype.DisposeOutRec=function(b){this.m_PolyOuts[b].Pts=null;this.m_PolyOuts[b]=null};f.Clipper.prototype.AddJoin=function(b,d,e){var m=new f.Join;m.OutPt1=b;m.OutPt2=d;m.OffPt.X=e.X;m.OffPt.Y=e.Y;f.use_xyz&&(m.OffPt.Z=e.Z);this.m_Joins.push(m)};f.Clipper.prototype.AddGhostJoin=function(b,d){var e=new f.Join;e.OutPt1=b;e.OffPt.X=d.X;e.OffPt.Y=
d.Y;f.use_xyz&&(e.OffPt.Z=d.Z);this.m_GhostJoins.push(e)};f.Clipper.prototype.SetZ=function(b,d,e){null!==this.ZFillFunction&&0==b.Z&&null!==this.ZFillFunction&&(f.IntPoint.op_Equality(b,d.Bot)?b.Z=d.Bot.Z:f.IntPoint.op_Equality(b,d.Top)?b.Z=d.Top.Z:f.IntPoint.op_Equality(b,e.Bot)?b.Z=e.Bot.Z:f.IntPoint.op_Equality(b,e.Top)?b.Z=e.Top.Z:this.ZFillFunction(d.Bot,d.Top,e.Bot,e.Top,b))};f.Clipper.prototype.InsertLocalMinimaIntoAEL=function(b){for(;null!==this.m_CurrentLM&&this.m_CurrentLM.Y==b;){var d=
this.m_CurrentLM.LeftBound,e=this.m_CurrentLM.RightBound;this.PopLocalMinima();var m=null;null===d?(this.InsertEdgeIntoAEL(e,null),this.SetWindingCount(e),this.IsContributing(e)&&(m=this.AddOutPt(e,e.Bot))):(null==e?(this.InsertEdgeIntoAEL(d,null),this.SetWindingCount(d),this.IsContributing(d)&&(m=this.AddOutPt(d,d.Bot))):(this.InsertEdgeIntoAEL(d,null),this.InsertEdgeIntoAEL(e,d),this.SetWindingCount(d),e.WindCnt=d.WindCnt,e.WindCnt2=d.WindCnt2,this.IsContributing(d)&&(m=this.AddLocalMinPoly(d,e,
d.Bot))),this.InsertScanbeam(d.Top.Y));null!=e&&(f.ClipperBase.IsHorizontal(e)?this.AddEdgeToSEL(e):this.InsertScanbeam(e.Top.Y));if(null!=d&&null!=e){if(null!==m&&f.ClipperBase.IsHorizontal(e)&&0<this.m_GhostJoins.length&&0!==e.WindDelta)for(var p=0,k=this.m_GhostJoins.length;p<k;p++){var u=this.m_GhostJoins[p];this.HorzSegmentsOverlap(u.OutPt1.Pt.X,u.OffPt.X,e.Bot.X,e.Top.X)&&this.AddJoin(u.OutPt1,m,u.OffPt)}0<=d.OutIdx&&null!==d.PrevInAEL&&d.PrevInAEL.Curr.X==d.Bot.X&&0<=d.PrevInAEL.OutIdx&&f.ClipperBase.SlopesEqual(d.PrevInAEL,
d,this.m_UseFullRange)&&0!==d.WindDelta&&0!==d.PrevInAEL.WindDelta&&(p=this.AddOutPt(d.PrevInAEL,d.Bot),this.AddJoin(m,p,d.Top));if(d.NextInAEL!=e&&(0<=e.OutIdx&&0<=e.PrevInAEL.OutIdx&&f.ClipperBase.SlopesEqual(e.PrevInAEL,e,this.m_UseFullRange)&&0!==e.WindDelta&&0!==e.PrevInAEL.WindDelta&&(p=this.AddOutPt(e.PrevInAEL,e.Bot),this.AddJoin(m,p,e.Top)),m=d.NextInAEL,null!==m))for(;m!=e;)this.IntersectEdges(e,m,d.Curr,!1),m=m.NextInAEL}}};f.Clipper.prototype.InsertEdgeIntoAEL=function(b,d){if(null===
this.m_ActiveEdges)b.PrevInAEL=null,b.NextInAEL=null,this.m_ActiveEdges=b;else if(null===d&&this.E2InsertsBeforeE1(this.m_ActiveEdges,b))b.PrevInAEL=null,b.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges=this.m_ActiveEdges.PrevInAEL=b;else{for(null===d&&(d=this.m_ActiveEdges);null!==d.NextInAEL&&!this.E2InsertsBeforeE1(d.NextInAEL,b);)d=d.NextInAEL;b.NextInAEL=d.NextInAEL;null!==d.NextInAEL&&(d.NextInAEL.PrevInAEL=b);b.PrevInAEL=d;d.NextInAEL=b}};f.Clipper.prototype.E2InsertsBeforeE1=function(b,d){return d.Curr.X==
b.Curr.X?d.Top.Y>b.Top.Y?d.Top.X<f.Clipper.TopX(b,d.Top.Y):b.Top.X>f.Clipper.TopX(d,b.Top.Y):d.Curr.X<b.Curr.X};f.Clipper.prototype.IsEvenOddFillType=function(b){return b.PolyTyp==f.PolyType.ptSubject?this.m_SubjFillType==f.PolyFillType.pftEvenOdd:this.m_ClipFillType==f.PolyFillType.pftEvenOdd};f.Clipper.prototype.IsEvenOddAltFillType=function(b){return b.PolyTyp==f.PolyType.ptSubject?this.m_ClipFillType==f.PolyFillType.pftEvenOdd:this.m_SubjFillType==f.PolyFillType.pftEvenOdd};f.Clipper.prototype.IsContributing=
function(b){var d,e;b.PolyTyp==f.PolyType.ptSubject?(d=this.m_SubjFillType,e=this.m_ClipFillType):(d=this.m_ClipFillType,e=this.m_SubjFillType);switch(d){case f.PolyFillType.pftEvenOdd:if(0===b.WindDelta&&1!=b.WindCnt)return!1;break;case f.PolyFillType.pftNonZero:if(1!=Math.abs(b.WindCnt))return!1;break;case f.PolyFillType.pftPositive:if(1!=b.WindCnt)return!1;break;default:if(-1!=b.WindCnt)return!1}switch(this.m_ClipType){case f.ClipType.ctIntersection:switch(e){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0!==
b.WindCnt2;case f.PolyFillType.pftPositive:return 0<b.WindCnt2;default:return 0>b.WindCnt2}case f.ClipType.ctUnion:switch(e){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0===b.WindCnt2;case f.PolyFillType.pftPositive:return 0>=b.WindCnt2;default:return 0<=b.WindCnt2}case f.ClipType.ctDifference:if(b.PolyTyp==f.PolyType.ptSubject)switch(e){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0===b.WindCnt2;case f.PolyFillType.pftPositive:return 0>=b.WindCnt2;
default:return 0<=b.WindCnt2}else switch(e){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0!==b.WindCnt2;case f.PolyFillType.pftPositive:return 0<b.WindCnt2;default:return 0>b.WindCnt2}case f.ClipType.ctXor:if(0===b.WindDelta)switch(e){case f.PolyFillType.pftEvenOdd:case f.PolyFillType.pftNonZero:return 0===b.WindCnt2;case f.PolyFillType.pftPositive:return 0>=b.WindCnt2;default:return 0<=b.WindCnt2}}return!0};f.Clipper.prototype.SetWindingCount=function(b){for(var d=b.PrevInAEL;null!==
d&&(d.PolyTyp!=b.PolyTyp||0===d.WindDelta);)d=d.PrevInAEL;if(null===d)b.WindCnt=0===b.WindDelta?1:b.WindDelta,b.WindCnt2=0,d=this.m_ActiveEdges;else{if(0===b.WindDelta&&this.m_ClipType!=f.ClipType.ctUnion)b.WindCnt=1;else if(this.IsEvenOddFillType(b))if(0===b.WindDelta){for(var e=!0,m=d.PrevInAEL;null!==m;)m.PolyTyp==d.PolyTyp&&0!==m.WindDelta&&(e=!e),m=m.PrevInAEL;b.WindCnt=e?0:1}else b.WindCnt=b.WindDelta;else b.WindCnt=0>d.WindCnt*d.WindDelta?1<Math.abs(d.WindCnt)?0>d.WindDelta*b.WindDelta?d.WindCnt:
d.WindCnt+b.WindDelta:0===b.WindDelta?1:b.WindDelta:0===b.WindDelta?0>d.WindCnt?d.WindCnt-1:d.WindCnt+1:0>d.WindDelta*b.WindDelta?d.WindCnt:d.WindCnt+b.WindDelta;b.WindCnt2=d.WindCnt2;d=d.NextInAEL}if(this.IsEvenOddAltFillType(b))for(;d!=b;)0!==d.WindDelta&&(b.WindCnt2=0===b.WindCnt2?1:0),d=d.NextInAEL;else for(;d!=b;)b.WindCnt2+=d.WindDelta,d=d.NextInAEL};f.Clipper.prototype.AddEdgeToSEL=function(b){null===this.m_SortedEdges?(this.m_SortedEdges=b,b.PrevInSEL=null,b.NextInSEL=null):(b.NextInSEL=this.m_SortedEdges,
b.PrevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.PrevInSEL=b)};f.Clipper.prototype.CopyAELToSEL=function(){var b=this.m_ActiveEdges;for(this.m_SortedEdges=b;null!==b;)b.PrevInSEL=b.PrevInAEL,b=b.NextInSEL=b.NextInAEL};f.Clipper.prototype.SwapPositionsInAEL=function(b,d){if(b.NextInAEL!=b.PrevInAEL&&d.NextInAEL!=d.PrevInAEL){if(b.NextInAEL==d){var e=d.NextInAEL;null!==e&&(e.PrevInAEL=b);var f=b.PrevInAEL;null!==f&&(f.NextInAEL=d);d.PrevInAEL=f;d.NextInAEL=b;b.PrevInAEL=d;b.NextInAEL=e}else d.NextInAEL==
b?(e=b.NextInAEL,null!==e&&(e.PrevInAEL=d),f=d.PrevInAEL,null!==f&&(f.NextInAEL=b),b.PrevInAEL=f,b.NextInAEL=d,d.PrevInAEL=b,d.NextInAEL=e):(e=b.NextInAEL,f=b.PrevInAEL,b.NextInAEL=d.NextInAEL,null!==b.NextInAEL&&(b.NextInAEL.PrevInAEL=b),b.PrevInAEL=d.PrevInAEL,null!==b.PrevInAEL&&(b.PrevInAEL.NextInAEL=b),d.NextInAEL=e,null!==d.NextInAEL&&(d.NextInAEL.PrevInAEL=d),d.PrevInAEL=f,null!==d.PrevInAEL&&(d.PrevInAEL.NextInAEL=d));null===b.PrevInAEL?this.m_ActiveEdges=b:null===d.PrevInAEL&&(this.m_ActiveEdges=
d)}};f.Clipper.prototype.SwapPositionsInSEL=function(b,d){if(null!==b.NextInSEL||null!==b.PrevInSEL)if(null!==d.NextInSEL||null!==d.PrevInSEL){if(b.NextInSEL==d){var e=d.NextInSEL;null!==e&&(e.PrevInSEL=b);var f=b.PrevInSEL;null!==f&&(f.NextInSEL=d);d.PrevInSEL=f;d.NextInSEL=b;b.PrevInSEL=d;b.NextInSEL=e}else d.NextInSEL==b?(e=b.NextInSEL,null!==e&&(e.PrevInSEL=d),f=d.PrevInSEL,null!==f&&(f.NextInSEL=b),b.PrevInSEL=f,b.NextInSEL=d,d.PrevInSEL=b,d.NextInSEL=e):(e=b.NextInSEL,f=b.PrevInSEL,b.NextInSEL=
d.NextInSEL,null!==b.NextInSEL&&(b.NextInSEL.PrevInSEL=b),b.PrevInSEL=d.PrevInSEL,null!==b.PrevInSEL&&(b.PrevInSEL.NextInSEL=b),d.NextInSEL=e,null!==d.NextInSEL&&(d.NextInSEL.PrevInSEL=d),d.PrevInSEL=f,null!==d.PrevInSEL&&(d.PrevInSEL.NextInSEL=d));null===b.PrevInSEL?this.m_SortedEdges=b:null===d.PrevInSEL&&(this.m_SortedEdges=d)}};f.Clipper.prototype.AddLocalMaxPoly=function(b,d,e){this.AddOutPt(b,e);0==d.WindDelta&&this.AddOutPt(d,e);b.OutIdx==d.OutIdx?(b.OutIdx=-1,d.OutIdx=-1):b.OutIdx<d.OutIdx?
this.AppendPolygon(b,d):this.AppendPolygon(d,b)};f.Clipper.prototype.AddLocalMinPoly=function(b,d,e){var m,p;f.ClipperBase.IsHorizontal(d)||b.Dx>d.Dx?(m=this.AddOutPt(b,e),d.OutIdx=b.OutIdx,b.Side=f.EdgeSide.esLeft,d.Side=f.EdgeSide.esRight,p=b,b=p.PrevInAEL==d?d.PrevInAEL:p.PrevInAEL):(m=this.AddOutPt(d,e),b.OutIdx=d.OutIdx,b.Side=f.EdgeSide.esRight,d.Side=f.EdgeSide.esLeft,p=d,b=p.PrevInAEL==b?b.PrevInAEL:p.PrevInAEL);null!==b&&0<=b.OutIdx&&f.Clipper.TopX(b,e.Y)==f.Clipper.TopX(p,e.Y)&&f.ClipperBase.SlopesEqual(p,
b,this.m_UseFullRange)&&0!==p.WindDelta&&0!==b.WindDelta&&(e=this.AddOutPt(b,e),this.AddJoin(m,e,p.Top));return m};f.Clipper.prototype.CreateOutRec=function(){var b=new f.OutRec;b.Idx=-1;b.IsHole=!1;b.IsOpen=!1;b.FirstLeft=null;b.Pts=null;b.BottomPt=null;b.PolyNode=null;this.m_PolyOuts.push(b);b.Idx=this.m_PolyOuts.length-1;return b};f.Clipper.prototype.AddOutPt=function(b,d){var e=b.Side==f.EdgeSide.esLeft;if(0>b.OutIdx){var m=this.CreateOutRec();m.IsOpen=0===b.WindDelta;var p=new f.OutPt;m.Pts=
p;p.Idx=m.Idx;p.Pt.X=d.X;p.Pt.Y=d.Y;f.use_xyz&&(p.Pt.Z=d.Z);p.Next=p;p.Prev=p;m.IsOpen||this.SetHoleState(b,m);b.OutIdx=m.Idx}else{var m=this.m_PolyOuts[b.OutIdx],k=m.Pts;if(e&&f.IntPoint.op_Equality(d,k.Pt))return k;if(!e&&f.IntPoint.op_Equality(d,k.Prev.Pt))return k.Prev;p=new f.OutPt;p.Idx=m.Idx;p.Pt.X=d.X;p.Pt.Y=d.Y;f.use_xyz&&(p.Pt.Z=d.Z);p.Next=k;p.Prev=k.Prev;p.Prev.Next=p;k.Prev=p;e&&(m.Pts=p)}return p};f.Clipper.prototype.SwapPoints=function(b,d){var e=new f.IntPoint(b.Value);b.Value.X=d.Value.X;
b.Value.Y=d.Value.Y;f.use_xyz&&(b.Value.Z=d.Value.Z);d.Value.X=e.X;d.Value.Y=e.Y;f.use_xyz&&(d.Value.Z=e.Z)};f.Clipper.prototype.HorzSegmentsOverlap=function(b,d,e,f){var p;b>d&&(p=b,b=d,d=p);e>f&&(p=e,e=f,f=p);return b<f&&e<d};f.Clipper.prototype.SetHoleState=function(b,d){for(var e=!1,f=b.PrevInAEL;null!==f;)0<=f.OutIdx&&0!=f.WindDelta&&(e=!e,null===d.FirstLeft&&(d.FirstLeft=this.m_PolyOuts[f.OutIdx])),f=f.PrevInAEL;e&&(d.IsHole=!0)};f.Clipper.prototype.GetDx=function(b,d){return b.Y==d.Y?f.ClipperBase.horizontal:
(d.X-b.X)/(d.Y-b.Y)};f.Clipper.prototype.FirstIsBottomPt=function(b,d){for(var e=b.Prev;f.IntPoint.op_Equality(e.Pt,b.Pt)&&e!=b;)e=e.Prev;for(var m=Math.abs(this.GetDx(b.Pt,e.Pt)),e=b.Next;f.IntPoint.op_Equality(e.Pt,b.Pt)&&e!=b;)e=e.Next;for(var p=Math.abs(this.GetDx(b.Pt,e.Pt)),e=d.Prev;f.IntPoint.op_Equality(e.Pt,d.Pt)&&e!=d;)e=e.Prev;for(var k=Math.abs(this.GetDx(d.Pt,e.Pt)),e=d.Next;f.IntPoint.op_Equality(e.Pt,d.Pt)&&e!=d;)e=e.Next;e=Math.abs(this.GetDx(d.Pt,e.Pt));return m>=k&&m>=e||p>=k&&p>=
e};f.Clipper.prototype.GetBottomPt=function(b){for(var d=null,e=b.Next;e!=b;)e.Pt.Y>b.Pt.Y?(b=e,d=null):e.Pt.Y==b.Pt.Y&&e.Pt.X<=b.Pt.X&&(e.Pt.X<b.Pt.X?(d=null,b=e):e.Next!=b&&e.Prev!=b&&(d=e)),e=e.Next;if(null!==d)for(;d!=e;)for(this.FirstIsBottomPt(e,d)||(b=d),d=d.Next;f.IntPoint.op_Inequality(d.Pt,b.Pt);)d=d.Next;return b};f.Clipper.prototype.GetLowermostRec=function(b,d){null===b.BottomPt&&(b.BottomPt=this.GetBottomPt(b.Pts));null===d.BottomPt&&(d.BottomPt=this.GetBottomPt(d.Pts));var e=b.BottomPt,
f=d.BottomPt;return e.Pt.Y>f.Pt.Y?b:e.Pt.Y<f.Pt.Y?d:e.Pt.X<f.Pt.X?b:e.Pt.X>f.Pt.X?d:e.Next==e?d:f.Next==f?b:this.FirstIsBottomPt(e,f)?b:d};f.Clipper.prototype.Param1RightOfParam2=function(b,d){do if(b=b.FirstLeft,b==d)return!0;while(null!==b);return!1};f.Clipper.prototype.GetOutRec=function(b){for(b=this.m_PolyOuts[b];b!=this.m_PolyOuts[b.Idx];)b=this.m_PolyOuts[b.Idx];return b};f.Clipper.prototype.AppendPolygon=function(b,d){var e=this.m_PolyOuts[b.OutIdx],m=this.m_PolyOuts[d.OutIdx],p;p=this.Param1RightOfParam2(e,
m)?m:this.Param1RightOfParam2(m,e)?e:this.GetLowermostRec(e,m);var k=e.Pts,u=k.Prev,B=m.Pts,t=B.Prev;b.Side==f.EdgeSide.esLeft?(d.Side==f.EdgeSide.esLeft?(this.ReversePolyPtLinks(B),B.Next=k,k.Prev=B,u.Next=t,t.Prev=u,e.Pts=t):(t.Next=k,k.Prev=t,B.Prev=u,u.Next=B,e.Pts=B),k=f.EdgeSide.esLeft):(d.Side==f.EdgeSide.esRight?(this.ReversePolyPtLinks(B),u.Next=t,t.Prev=u,B.Next=k,k.Prev=B):(u.Next=B,B.Prev=u,k.Prev=t,t.Next=k),k=f.EdgeSide.esRight);e.BottomPt=null;p==m&&(m.FirstLeft!=e&&(e.FirstLeft=m.FirstLeft),
e.IsHole=m.IsHole);m.Pts=null;m.BottomPt=null;m.FirstLeft=e;p=b.OutIdx;u=d.OutIdx;b.OutIdx=-1;d.OutIdx=-1;for(B=this.m_ActiveEdges;null!==B;){if(B.OutIdx==u){B.OutIdx=p;B.Side=k;break}B=B.NextInAEL}m.Idx=e.Idx};f.Clipper.prototype.ReversePolyPtLinks=function(b){if(null!==b){var d,e;d=b;do e=d.Next,d.Next=d.Prev,d=d.Prev=e;while(d!=b)}};f.Clipper.SwapSides=function(b,d){var e=b.Side;b.Side=d.Side;d.Side=e};f.Clipper.SwapPolyIndexes=function(b,d){var e=b.OutIdx;b.OutIdx=d.OutIdx;d.OutIdx=e};f.Clipper.prototype.IntersectEdges=
function(b,d,e){var m=0<=b.OutIdx,p=0<=d.OutIdx;f.use_xyz&&this.SetZ(e,b,d);if(!f.use_lines||0!==b.WindDelta&&0!==d.WindDelta){if(b.PolyTyp==d.PolyTyp)if(this.IsEvenOddFillType(b)){var k=b.WindCnt;b.WindCnt=d.WindCnt;d.WindCnt=k}else b.WindCnt=0===b.WindCnt+d.WindDelta?-b.WindCnt:b.WindCnt+d.WindDelta,d.WindCnt=0===d.WindCnt-b.WindDelta?-d.WindCnt:d.WindCnt-b.WindDelta;else this.IsEvenOddFillType(d)?b.WindCnt2=0===b.WindCnt2?1:0:b.WindCnt2+=d.WindDelta,this.IsEvenOddFillType(b)?d.WindCnt2=0===d.WindCnt2?
1:0:d.WindCnt2-=b.WindDelta;var u,B,t;b.PolyTyp==f.PolyType.ptSubject?(u=this.m_SubjFillType,t=this.m_ClipFillType):(u=this.m_ClipFillType,t=this.m_SubjFillType);d.PolyTyp==f.PolyType.ptSubject?(B=this.m_SubjFillType,k=this.m_ClipFillType):(B=this.m_ClipFillType,k=this.m_SubjFillType);switch(u){case f.PolyFillType.pftPositive:u=b.WindCnt;break;case f.PolyFillType.pftNegative:u=-b.WindCnt;break;default:u=Math.abs(b.WindCnt)}switch(B){case f.PolyFillType.pftPositive:B=d.WindCnt;break;case f.PolyFillType.pftNegative:B=
-d.WindCnt;break;default:B=Math.abs(d.WindCnt)}if(m&&p)0!=u&&1!=u||0!=B&&1!=B||b.PolyTyp!=d.PolyTyp&&this.m_ClipType!=f.ClipType.ctXor?this.AddLocalMaxPoly(b,d,e):(this.AddOutPt(b,e),this.AddOutPt(d,e),f.Clipper.SwapSides(b,d),f.Clipper.SwapPolyIndexes(b,d));else if(m){if(0===B||1==B)this.AddOutPt(b,e),f.Clipper.SwapSides(b,d),f.Clipper.SwapPolyIndexes(b,d)}else if(p){if(0===u||1==u)this.AddOutPt(d,e),f.Clipper.SwapSides(b,d),f.Clipper.SwapPolyIndexes(b,d)}else if(!(0!=u&&1!=u||0!=B&&1!=B)){switch(t){case f.PolyFillType.pftPositive:m=
b.WindCnt2;break;case f.PolyFillType.pftNegative:m=-b.WindCnt2;break;default:m=Math.abs(b.WindCnt2)}switch(k){case f.PolyFillType.pftPositive:p=d.WindCnt2;break;case f.PolyFillType.pftNegative:p=-d.WindCnt2;break;default:p=Math.abs(d.WindCnt2)}if(b.PolyTyp!=d.PolyTyp)this.AddLocalMinPoly(b,d,e);else if(1==u&&1==B)switch(this.m_ClipType){case f.ClipType.ctIntersection:0<m&&0<p&&this.AddLocalMinPoly(b,d,e);break;case f.ClipType.ctUnion:0>=m&&0>=p&&this.AddLocalMinPoly(b,d,e);break;case f.ClipType.ctDifference:(b.PolyTyp==
f.PolyType.ptClip&&0<m&&0<p||b.PolyTyp==f.PolyType.ptSubject&&0>=m&&0>=p)&&this.AddLocalMinPoly(b,d,e);break;case f.ClipType.ctXor:this.AddLocalMinPoly(b,d,e)}else f.Clipper.SwapSides(b,d)}}else if(0!=b.WindDelta||0!=d.WindDelta)b.PolyTyp==d.PolyTyp&&b.WindDelta!=d.WindDelta&&this.m_ClipType==f.ClipType.ctUnion?0===b.WindDelta?p&&(this.AddOutPt(b,e),m&&(b.OutIdx=-1)):m&&(this.AddOutPt(d,e),p&&(d.OutIdx=-1)):b.PolyTyp!=d.PolyTyp&&(0!==b.WindDelta||1!=Math.abs(d.WindCnt)||this.m_ClipType==f.ClipType.ctUnion&&
0!==d.WindCnt2?0!==d.WindDelta||1!=Math.abs(b.WindCnt)||this.m_ClipType==f.ClipType.ctUnion&&0!==b.WindCnt2||(this.AddOutPt(d,e),p&&(d.OutIdx=-1)):(this.AddOutPt(b,e),m&&(b.OutIdx=-1)))};f.Clipper.prototype.DeleteFromAEL=function(b){var d=b.PrevInAEL,e=b.NextInAEL;if(null!==d||null!==e||b==this.m_ActiveEdges)null!==d?d.NextInAEL=e:this.m_ActiveEdges=e,null!==e&&(e.PrevInAEL=d),b.NextInAEL=null,b.PrevInAEL=null};f.Clipper.prototype.DeleteFromSEL=function(b){var d=b.PrevInSEL,e=b.NextInSEL;if(null!==
d||null!==e||b==this.m_SortedEdges)null!==d?d.NextInSEL=e:this.m_SortedEdges=e,null!==e&&(e.PrevInSEL=d),b.NextInSEL=null,b.PrevInSEL=null};f.Clipper.prototype.UpdateEdgeIntoAEL=function(b){null===b.NextInLML&&f.Error("UpdateEdgeIntoAEL: invalid call");var d=b.PrevInAEL,e=b.NextInAEL;b.NextInLML.OutIdx=b.OutIdx;null!==d?d.NextInAEL=b.NextInLML:this.m_ActiveEdges=b.NextInLML;null!==e&&(e.PrevInAEL=b.NextInLML);b.NextInLML.Side=b.Side;b.NextInLML.WindDelta=b.WindDelta;b.NextInLML.WindCnt=b.WindCnt;
b.NextInLML.WindCnt2=b.WindCnt2;b=b.NextInLML;b.Curr.X=b.Bot.X;b.Curr.Y=b.Bot.Y;f.use_xyz&&(b.Curr.Z=b.Bot.Z);b.PrevInAEL=d;b.NextInAEL=e;f.ClipperBase.IsHorizontal(b)||this.InsertScanbeam(b.Top.Y);return b};f.Clipper.prototype.ProcessHorizontals=function(b){for(var d=this.m_SortedEdges;null!==d;)this.DeleteFromSEL(d),this.ProcessHorizontal(d,b),d=this.m_SortedEdges};f.Clipper.prototype.GetHorzDirection=function(b,d){b.Bot.X<b.Top.X?(d.Left=b.Bot.X,d.Right=b.Top.X,d.Dir=f.Direction.dLeftToRight):
(d.Left=b.Top.X,d.Right=b.Bot.X,d.Dir=f.Direction.dRightToLeft)};f.Clipper.prototype.ProcessHorizontal=function(b,d){var e={Dir:null,Left:null,Right:null};this.GetHorzDirection(b,e);for(var m=e.Dir,p=e.Left,k=e.Right,u=b,B=null;null!==u.NextInLML&&f.ClipperBase.IsHorizontal(u.NextInLML);)u=u.NextInLML;for(null===u.NextInLML&&(B=this.GetMaximaPair(u));;){for(var t=b==u,I=this.GetNextInAEL(b,m);null!==I&&!(I.Curr.X==b.Top.X&&null!==b.NextInLML&&I.Dx<b.NextInLML.Dx);){e=this.GetNextInAEL(I,m);if(m==
f.Direction.dLeftToRight&&I.Curr.X<=k||m==f.Direction.dRightToLeft&&I.Curr.X>=p){if(I==B&&t){if(0<=b.OutIdx){m=this.AddOutPt(b,b.Top);for(e=this.m_SortedEdges;null!==e;)0<=e.OutIdx&&this.HorzSegmentsOverlap(b.Bot.X,b.Top.X,e.Bot.X,e.Top.X)&&(p=this.AddOutPt(e,e.Bot),this.AddJoin(p,m,e.Top)),e=e.NextInSEL;this.AddGhostJoin(m,b.Bot);this.AddLocalMaxPoly(b,B,b.Top)}this.DeleteFromAEL(b);this.DeleteFromAEL(B);return}if(m==f.Direction.dLeftToRight){var G=new f.IntPoint(I.Curr.X,b.Curr.Y);this.IntersectEdges(b,
I,G)}else G=new f.IntPoint(I.Curr.X,b.Curr.Y),this.IntersectEdges(I,b,G);this.SwapPositionsInAEL(b,I)}else if(m==f.Direction.dLeftToRight&&I.Curr.X>=k||m==f.Direction.dRightToLeft&&I.Curr.X<=p)break;I=e}if(null!==b.NextInLML&&f.ClipperBase.IsHorizontal(b.NextInLML))b=this.UpdateEdgeIntoAEL(b),0<=b.OutIdx&&this.AddOutPt(b,b.Bot),e={Dir:m,Left:p,Right:k},this.GetHorzDirection(b,e),m=e.Dir,p=e.Left,k=e.Right;else break}null!==b.NextInLML?0<=b.OutIdx?(m=this.AddOutPt(b,b.Top),d&&this.AddGhostJoin(m,b.Bot),
b=this.UpdateEdgeIntoAEL(b),0!==b.WindDelta&&(B=b.PrevInAEL,e=b.NextInAEL,null!==B&&B.Curr.X==b.Bot.X&&B.Curr.Y==b.Bot.Y&&0!==B.WindDelta&&0<=B.OutIdx&&B.Curr.Y>B.Top.Y&&f.ClipperBase.SlopesEqual(b,B,this.m_UseFullRange)?(p=this.AddOutPt(B,b.Bot),this.AddJoin(m,p,b.Top)):null!==e&&e.Curr.X==b.Bot.X&&e.Curr.Y==b.Bot.Y&&0!==e.WindDelta&&0<=e.OutIdx&&e.Curr.Y>e.Top.Y&&f.ClipperBase.SlopesEqual(b,e,this.m_UseFullRange)&&(p=this.AddOutPt(e,b.Bot),this.AddJoin(m,p,b.Top)))):this.UpdateEdgeIntoAEL(b):(0<=
b.OutIdx&&this.AddOutPt(b,b.Top),this.DeleteFromAEL(b))};f.Clipper.prototype.GetNextInAEL=function(b,d){return d==f.Direction.dLeftToRight?b.NextInAEL:b.PrevInAEL};f.Clipper.prototype.IsMinima=function(b){return null!==b&&b.Prev.NextInLML!=b&&b.Next.NextInLML!=b};f.Clipper.prototype.IsMaxima=function(b,d){return null!==b&&b.Top.Y==d&&null===b.NextInLML};f.Clipper.prototype.IsIntermediate=function(b,d){return b.Top.Y==d&&null!==b.NextInLML};f.Clipper.prototype.GetMaximaPair=function(b){var d=null;
f.IntPoint.op_Equality(b.Next.Top,b.Top)&&null===b.Next.NextInLML?d=b.Next:f.IntPoint.op_Equality(b.Prev.Top,b.Top)&&null===b.Prev.NextInLML&&(d=b.Prev);return null===d||-2!=d.OutIdx&&(d.NextInAEL!=d.PrevInAEL||f.ClipperBase.IsHorizontal(d))?d:null};f.Clipper.prototype.ProcessIntersections=function(b){if(null==this.m_ActiveEdges)return!0;try{this.BuildIntersectList(b);if(0==this.m_IntersectList.length)return!0;if(1==this.m_IntersectList.length||this.FixupIntersectionOrder())this.ProcessIntersectList();
else return!1}catch(d){this.m_SortedEdges=null,this.m_IntersectList.length=0,f.Error("ProcessIntersections error")}this.m_SortedEdges=null;return!0};f.Clipper.prototype.BuildIntersectList=function(b){if(null!==this.m_ActiveEdges){var d=this.m_ActiveEdges;for(this.m_SortedEdges=d;null!==d;)d.PrevInSEL=d.PrevInAEL,d.NextInSEL=d.NextInAEL,d.Curr.X=f.Clipper.TopX(d,b),d=d.NextInAEL;for(var e=!0;e&&null!==this.m_SortedEdges;){e=!1;for(d=this.m_SortedEdges;null!==d.NextInSEL;){b=d.NextInSEL;var m=new f.IntPoint;
d.Curr.X>b.Curr.X?(this.IntersectPoint(d,b,m),e=new f.IntersectNode,e.Edge1=d,e.Edge2=b,e.Pt.X=m.X,e.Pt.Y=m.Y,f.use_xyz&&(e.Pt.Z=m.Z),this.m_IntersectList.push(e),this.SwapPositionsInSEL(d,b),e=!0):d=b}if(null!==d.PrevInSEL)d.PrevInSEL.NextInSEL=null;else break}this.m_SortedEdges=null}};f.Clipper.prototype.EdgesAdjacent=function(b){return b.Edge1.NextInSEL==b.Edge2||b.Edge1.PrevInSEL==b.Edge2};f.Clipper.IntersectNodeSort=function(b,d){return d.Pt.Y-b.Pt.Y};f.Clipper.prototype.FixupIntersectionOrder=
function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer);this.CopyAELToSEL();for(var b=this.m_IntersectList.length,d=0;d<b;d++){if(!this.EdgesAdjacent(this.m_IntersectList[d])){for(var e=d+1;e<b&&!this.EdgesAdjacent(this.m_IntersectList[e]);)e++;if(e==b)return!1;var f=this.m_IntersectList[d];this.m_IntersectList[d]=this.m_IntersectList[e];this.m_IntersectList[e]=f}this.SwapPositionsInSEL(this.m_IntersectList[d].Edge1,this.m_IntersectList[d].Edge2)}return!0};f.Clipper.prototype.ProcessIntersectList=
function(){for(var b=0,d=this.m_IntersectList.length;b<d;b++){var e=this.m_IntersectList[b];this.IntersectEdges(e.Edge1,e.Edge2,e.Pt);this.SwapPositionsInAEL(e.Edge1,e.Edge2)}this.m_IntersectList.length=0};La=function(b){return 0>b?Math.ceil(b-.5):Math.round(b)};$a=function(b){return 0>b?Math.ceil(b-.5):Math.floor(b+.5)};Ma=function(b){return 0>b?-Math.round(Math.abs(b)):Math.round(b)};ab=function(b){if(0>b)return b-=.5,-2147483648>b?Math.ceil(b):b|0;b+=.5;return 2147483647<b?Math.floor(b):b|0};f.Clipper.Round=
Z?La:Ib?Ma:Wb?ab:$a;f.Clipper.TopX=function(b,d){return d==b.Top.Y?b.Top.X:b.Bot.X+f.Clipper.Round(b.Dx*(d-b.Bot.Y))};f.Clipper.prototype.IntersectPoint=function(b,d,e){e.X=0;e.Y=0;var m,p;if(b.Dx==d.Dx)e.Y=b.Curr.Y,e.X=f.Clipper.TopX(b,e.Y);else{if(0===b.Delta.X)e.X=b.Bot.X,f.ClipperBase.IsHorizontal(d)?e.Y=d.Bot.Y:(p=d.Bot.Y-d.Bot.X/d.Dx,e.Y=f.Clipper.Round(e.X/d.Dx+p));else if(0===d.Delta.X)e.X=d.Bot.X,f.ClipperBase.IsHorizontal(b)?e.Y=b.Bot.Y:(m=b.Bot.Y-b.Bot.X/b.Dx,e.Y=f.Clipper.Round(e.X/b.Dx+
m));else{m=b.Bot.X-b.Bot.Y*b.Dx;p=d.Bot.X-d.Bot.Y*d.Dx;var k=(p-m)/(b.Dx-d.Dx);e.Y=f.Clipper.Round(k);e.X=Math.abs(b.Dx)<Math.abs(d.Dx)?f.Clipper.Round(b.Dx*k+m):f.Clipper.Round(d.Dx*k+p)}if(e.Y<b.Top.Y||e.Y<d.Top.Y){if(b.Top.Y>d.Top.Y)return e.Y=b.Top.Y,e.X=f.Clipper.TopX(d,b.Top.Y),e.X<b.Top.X;e.Y=d.Top.Y;e.X=Math.abs(b.Dx)<Math.abs(d.Dx)?f.Clipper.TopX(b,e.Y):f.Clipper.TopX(d,e.Y)}e.Y>b.Curr.Y&&(e.Y=b.Curr.Y,e.X=Math.abs(b.Dx)>Math.abs(d.Dx)?f.Clipper.TopX(d,e.Y):f.Clipper.TopX(b,e.Y))}};f.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=
function(b){for(var d=this.m_ActiveEdges;null!==d;){var e=this.IsMaxima(d,b);e&&(e=this.GetMaximaPair(d),e=null===e||!f.ClipperBase.IsHorizontal(e));if(e){var m=d.PrevInAEL;this.DoMaxima(d);d=null===m?this.m_ActiveEdges:m.NextInAEL}else{this.IsIntermediate(d,b)&&f.ClipperBase.IsHorizontal(d.NextInLML)?(d=this.UpdateEdgeIntoAEL(d),0<=d.OutIdx&&this.AddOutPt(d,d.Bot),this.AddEdgeToSEL(d)):(d.Curr.X=f.Clipper.TopX(d,b),d.Curr.Y=b);if(this.StrictlySimple&&(m=d.PrevInAEL,0<=d.OutIdx&&0!==d.WindDelta&&
null!==m&&0<=m.OutIdx&&m.Curr.X==d.Curr.X&&0!==m.WindDelta)){var p=new f.IntPoint(d.Curr);f.use_xyz&&this.SetZ(p,m,d);e=this.AddOutPt(m,p);m=this.AddOutPt(d,p);this.AddJoin(e,m,p)}d=d.NextInAEL}}this.ProcessHorizontals(!0);for(d=this.m_ActiveEdges;null!==d;)this.IsIntermediate(d,b)&&(e=null,0<=d.OutIdx&&(e=this.AddOutPt(d,d.Top)),d=this.UpdateEdgeIntoAEL(d),m=d.PrevInAEL,p=d.NextInAEL,null!==m&&m.Curr.X==d.Bot.X&&m.Curr.Y==d.Bot.Y&&null!==e&&0<=m.OutIdx&&m.Curr.Y>m.Top.Y&&f.ClipperBase.SlopesEqual(d,
m,this.m_UseFullRange)&&0!==d.WindDelta&&0!==m.WindDelta?(m=this.AddOutPt(m,d.Bot),this.AddJoin(e,m,d.Top)):null!==p&&p.Curr.X==d.Bot.X&&p.Curr.Y==d.Bot.Y&&null!==e&&0<=p.OutIdx&&p.Curr.Y>p.Top.Y&&f.ClipperBase.SlopesEqual(d,p,this.m_UseFullRange)&&0!==d.WindDelta&&0!==p.WindDelta&&(m=this.AddOutPt(p,d.Bot),this.AddJoin(e,m,d.Top))),d=d.NextInAEL};f.Clipper.prototype.DoMaxima=function(b){var d=this.GetMaximaPair(b);if(null===d)0<=b.OutIdx&&this.AddOutPt(b,b.Top),this.DeleteFromAEL(b);else{for(var e=
b.NextInAEL;null!==e&&e!=d;)this.IntersectEdges(b,e,b.Top),this.SwapPositionsInAEL(b,e),e=b.NextInAEL;-1==b.OutIdx&&-1==d.OutIdx?(this.DeleteFromAEL(b),this.DeleteFromAEL(d)):0<=b.OutIdx&&0<=d.OutIdx?(0<=b.OutIdx&&this.AddLocalMaxPoly(b,d,b.Top),this.DeleteFromAEL(b),this.DeleteFromAEL(d)):f.use_lines&&0===b.WindDelta?(0<=b.OutIdx&&(this.AddOutPt(b,b.Top),b.OutIdx=-1),this.DeleteFromAEL(b),0<=d.OutIdx&&(this.AddOutPt(d,b.Top),d.OutIdx=-1),this.DeleteFromAEL(d)):f.Error("DoMaxima error")}};f.Clipper.ReversePaths=
function(b){for(var d=0,e=b.length;d<e;d++)b[d].reverse()};f.Clipper.Orientation=function(b){return 0<=f.Clipper.Area(b)};f.Clipper.prototype.PointCount=function(b){if(null===b)return 0;var d=0,e=b;do d++,e=e.Next;while(e!=b);return d};f.Clipper.prototype.BuildResult=function(b){f.Clear(b);for(var d=0,e=this.m_PolyOuts.length;d<e;d++){var m=this.m_PolyOuts[d];if(null!==m.Pts){var m=m.Pts.Prev,p=this.PointCount(m);if(!(2>p)){for(var k=Array(p),u=0;u<p;u++)k[u]=m.Pt,m=m.Prev;b.push(k)}}}};f.Clipper.prototype.BuildResult2=
function(b){b.Clear();for(var d=0,e=this.m_PolyOuts.length;d<e;d++){var m=this.m_PolyOuts[d],p=this.PointCount(m.Pts);if(!(m.IsOpen&&2>p||!m.IsOpen&&3>p)){this.FixHoleLinkage(m);var k=new f.PolyNode;b.m_AllPolys.push(k);m.PolyNode=k;k.m_polygon.length=p;for(var m=m.Pts.Prev,u=0;u<p;u++)k.m_polygon[u]=m.Pt,m=m.Prev}}d=0;for(e=this.m_PolyOuts.length;d<e;d++)m=this.m_PolyOuts[d],null!==m.PolyNode&&(m.IsOpen?(m.PolyNode.IsOpen=!0,b.AddChild(m.PolyNode)):null!==m.FirstLeft&&null!=m.FirstLeft.PolyNode?
m.FirstLeft.PolyNode.AddChild(m.PolyNode):b.AddChild(m.PolyNode))};f.Clipper.prototype.FixupOutPolygon=function(b){var d=null;b.BottomPt=null;for(var e=b.Pts;;){if(e.Prev==e||e.Prev==e.Next){b.Pts=null;return}if(f.IntPoint.op_Equality(e.Pt,e.Next.Pt)||f.IntPoint.op_Equality(e.Pt,e.Prev.Pt)||f.ClipperBase.SlopesEqual(e.Prev.Pt,e.Pt,e.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(e.Prev.Pt,e.Pt,e.Next.Pt)))d=null,e.Prev.Next=e.Next,e=e.Next.Prev=e.Prev;else if(e==
d)break;else null===d&&(d=e),e=e.Next}b.Pts=e};f.Clipper.prototype.DupOutPt=function(b,d){var e=new f.OutPt;e.Pt.X=b.Pt.X;e.Pt.Y=b.Pt.Y;f.use_xyz&&(e.Pt.Z=b.Pt.Z);e.Idx=b.Idx;d?(e.Next=b.Next,e.Prev=b,b.Next.Prev=e,b.Next=e):(e.Prev=b.Prev,e.Next=b,b.Prev.Next=e,b.Prev=e);return e};f.Clipper.prototype.GetOverlap=function(b,d,e,f,p){b<d?e<f?(p.Left=Math.max(b,e),p.Right=Math.min(d,f)):(p.Left=Math.max(b,f),p.Right=Math.min(d,e)):e<f?(p.Left=Math.max(d,e),p.Right=Math.min(b,f)):(p.Left=Math.max(d,f),
p.Right=Math.min(b,e));return p.Left<p.Right};f.Clipper.prototype.JoinHorz=function(b,d,e,m,p,k){var u=b.Pt.X>d.Pt.X?f.Direction.dRightToLeft:f.Direction.dLeftToRight;m=e.Pt.X>m.Pt.X?f.Direction.dRightToLeft:f.Direction.dLeftToRight;if(u==m)return!1;if(u==f.Direction.dLeftToRight){for(;b.Next.Pt.X<=p.X&&b.Next.Pt.X>=b.Pt.X&&b.Next.Pt.Y==p.Y;)b=b.Next;k&&b.Pt.X!=p.X&&(b=b.Next);d=this.DupOutPt(b,!k);f.IntPoint.op_Inequality(d.Pt,p)&&(b=d,b.Pt.X=p.X,b.Pt.Y=p.Y,f.use_xyz&&(b.Pt.Z=p.Z),d=this.DupOutPt(b,
!k))}else{for(;b.Next.Pt.X>=p.X&&b.Next.Pt.X<=b.Pt.X&&b.Next.Pt.Y==p.Y;)b=b.Next;k||b.Pt.X==p.X||(b=b.Next);d=this.DupOutPt(b,k);f.IntPoint.op_Inequality(d.Pt,p)&&(b=d,b.Pt.X=p.X,b.Pt.Y=p.Y,f.use_xyz&&(b.Pt.Z=p.Z),d=this.DupOutPt(b,k))}if(m==f.Direction.dLeftToRight){for(;e.Next.Pt.X<=p.X&&e.Next.Pt.X>=e.Pt.X&&e.Next.Pt.Y==p.Y;)e=e.Next;k&&e.Pt.X!=p.X&&(e=e.Next);m=this.DupOutPt(e,!k);f.IntPoint.op_Inequality(m.Pt,p)&&(e=m,e.Pt.X=p.X,e.Pt.Y=p.Y,f.use_xyz&&(e.Pt.Z=p.Z),m=this.DupOutPt(e,!k))}else{for(;e.Next.Pt.X>=
p.X&&e.Next.Pt.X<=e.Pt.X&&e.Next.Pt.Y==p.Y;)e=e.Next;k||e.Pt.X==p.X||(e=e.Next);m=this.DupOutPt(e,k);f.IntPoint.op_Inequality(m.Pt,p)&&(e=m,e.Pt.X=p.X,e.Pt.Y=p.Y,f.use_xyz&&(e.Pt.Z=p.Z),m=this.DupOutPt(e,k))}u==f.Direction.dLeftToRight==k?(b.Prev=e,e.Next=b,d.Next=m,m.Prev=d):(b.Next=e,e.Prev=b,d.Prev=m,m.Next=d);return!0};f.Clipper.prototype.JoinPoints=function(b,d,e){var m=b.OutPt1,p;new f.OutPt;var k=b.OutPt2,u;new f.OutPt;if((u=b.OutPt1.Pt.Y==b.OffPt.Y)&&f.IntPoint.op_Equality(b.OffPt,b.OutPt1.Pt)&&
f.IntPoint.op_Equality(b.OffPt,b.OutPt2.Pt)){if(d!=e)return!1;for(p=b.OutPt1.Next;p!=m&&f.IntPoint.op_Equality(p.Pt,b.OffPt);)p=p.Next;p=p.Pt.Y>b.OffPt.Y;for(u=b.OutPt2.Next;u!=k&&f.IntPoint.op_Equality(u.Pt,b.OffPt);)u=u.Next;if(p==u.Pt.Y>b.OffPt.Y)return!1;p?(p=this.DupOutPt(m,!1),u=this.DupOutPt(k,!0),m.Prev=k,k.Next=m,p.Next=u,u.Prev=p):(p=this.DupOutPt(m,!0),u=this.DupOutPt(k,!1),m.Next=k,k.Prev=m,p.Prev=u,u.Next=p);b.OutPt1=m;b.OutPt2=p;return!0}if(u){for(p=m;m.Prev.Pt.Y==m.Pt.Y&&m.Prev!=p&&
m.Prev!=k;)m=m.Prev;for(;p.Next.Pt.Y==p.Pt.Y&&p.Next!=m&&p.Next!=k;)p=p.Next;if(p.Next==m||p.Next==k)return!1;for(u=k;k.Prev.Pt.Y==k.Pt.Y&&k.Prev!=u&&k.Prev!=p;)k=k.Prev;for(;u.Next.Pt.Y==u.Pt.Y&&u.Next!=k&&u.Next!=m;)u=u.Next;if(u.Next==k||u.Next==m)return!1;e={Left:null,Right:null};if(!this.GetOverlap(m.Pt.X,p.Pt.X,k.Pt.X,u.Pt.X,e))return!1;d=e.Left;var B=e.Right;e=new f.IntPoint;m.Pt.X>=d&&m.Pt.X<=B?(e.X=m.Pt.X,e.Y=m.Pt.Y,f.use_xyz&&(e.Z=m.Pt.Z),d=m.Pt.X>p.Pt.X):k.Pt.X>=d&&k.Pt.X<=B?(e.X=k.Pt.X,
e.Y=k.Pt.Y,f.use_xyz&&(e.Z=k.Pt.Z),d=k.Pt.X>u.Pt.X):p.Pt.X>=d&&p.Pt.X<=B?(e.X=p.Pt.X,e.Y=p.Pt.Y,f.use_xyz&&(e.Z=p.Pt.Z),d=p.Pt.X>m.Pt.X):(e.X=u.Pt.X,e.Y=u.Pt.Y,f.use_xyz&&(e.Z=u.Pt.Z),d=u.Pt.X>k.Pt.X);b.OutPt1=m;b.OutPt2=k;return this.JoinHorz(m,p,k,u,e,d)}for(p=m.Next;f.IntPoint.op_Equality(p.Pt,m.Pt)&&p!=m;)p=p.Next;if(B=p.Pt.Y>m.Pt.Y||!f.ClipperBase.SlopesEqual(m.Pt,p.Pt,b.OffPt,this.m_UseFullRange)){for(p=m.Prev;f.IntPoint.op_Equality(p.Pt,m.Pt)&&p!=m;)p=p.Prev;if(p.Pt.Y>m.Pt.Y||!f.ClipperBase.SlopesEqual(m.Pt,
p.Pt,b.OffPt,this.m_UseFullRange))return!1}for(u=k.Next;f.IntPoint.op_Equality(u.Pt,k.Pt)&&u!=k;)u=u.Next;var t=u.Pt.Y>k.Pt.Y||!f.ClipperBase.SlopesEqual(k.Pt,u.Pt,b.OffPt,this.m_UseFullRange);if(t){for(u=k.Prev;f.IntPoint.op_Equality(u.Pt,k.Pt)&&u!=k;)u=u.Prev;if(u.Pt.Y>k.Pt.Y||!f.ClipperBase.SlopesEqual(k.Pt,u.Pt,b.OffPt,this.m_UseFullRange))return!1}if(p==m||u==k||p==u||d==e&&B==t)return!1;B?(p=this.DupOutPt(m,!1),u=this.DupOutPt(k,!0),m.Prev=k,k.Next=m,p.Next=u,u.Prev=p):(p=this.DupOutPt(m,!0),
u=this.DupOutPt(k,!1),m.Next=k,k.Prev=m,p.Prev=u,u.Next=p);b.OutPt1=m;b.OutPt2=p;return!0};f.Clipper.GetBounds=function(b){for(var d=0,e=b.length;d<e&&0==b[d].length;)d++;if(d==e)return new f.IntRect(0,0,0,0);var m=new f.IntRect;m.left=b[d][0].X;m.right=m.left;m.top=b[d][0].Y;for(m.bottom=m.top;d<e;d++)for(var k=0,C=b[d].length;k<C;k++)b[d][k].X<m.left?m.left=b[d][k].X:b[d][k].X>m.right&&(m.right=b[d][k].X),b[d][k].Y<m.top?m.top=b[d][k].Y:b[d][k].Y>m.bottom&&(m.bottom=b[d][k].Y);return m};f.Clipper.prototype.GetBounds2=
function(b){var d=b,e=new f.IntRect;e.left=b.Pt.X;e.right=b.Pt.X;e.top=b.Pt.Y;e.bottom=b.Pt.Y;for(b=b.Next;b!=d;)b.Pt.X<e.left&&(e.left=b.Pt.X),b.Pt.X>e.right&&(e.right=b.Pt.X),b.Pt.Y<e.top&&(e.top=b.Pt.Y),b.Pt.Y>e.bottom&&(e.bottom=b.Pt.Y),b=b.Next;return e};f.Clipper.PointInPolygon=function(b,d){var e=0,f=d.length;if(3>f)return 0;for(var k=d[0],C=1;C<=f;++C){var u=C==f?d[0]:d[C];if(u.Y==b.Y&&(u.X==b.X||k.Y==b.Y&&u.X>b.X==k.X<b.X))return-1;if(k.Y<b.Y!=u.Y<b.Y)if(k.X>=b.X)if(u.X>b.X)e=1-e;else{var B=
(k.X-b.X)*(u.Y-b.Y)-(u.X-b.X)*(k.Y-b.Y);if(0==B)return-1;0<B==u.Y>k.Y&&(e=1-e)}else if(u.X>b.X){B=(k.X-b.X)*(u.Y-b.Y)-(u.X-b.X)*(k.Y-b.Y);if(0==B)return-1;0<B==u.Y>k.Y&&(e=1-e)}k=u}return e};f.Clipper.prototype.PointInPolygon=function(b,d){var e=0,f=d,k=b.X,C=b.Y,u=d.Pt.X,B=d.Pt.Y;do{d=d.Next;var t=d.Pt.X,I=d.Pt.Y;if(I==C&&(t==k||B==C&&t>k==u<k))return-1;if(B<C!=I<C)if(u>=k)if(t>k)e=1-e;else{u=(u-k)*(I-C)-(t-k)*(B-C);if(0==u)return-1;0<u==I>B&&(e=1-e)}else if(t>k){u=(u-k)*(I-C)-(t-k)*(B-C);if(0==
u)return-1;0<u==I>B&&(e=1-e)}u=t;B=I}while(f!=d);return e};f.Clipper.prototype.Poly2ContainsPoly1=function(b,d){var e=b;do{var f=this.PointInPolygon(e.Pt,d);if(0<=f)return 0<f;e=e.Next}while(e!=b);return!0};f.Clipper.prototype.FixupFirstLefts1=function(b,d){for(var e=0,f=this.m_PolyOuts.length;e<f;e++){var k=this.m_PolyOuts[e];null!=k.Pts&&null!=k.FirstLeft&&this.ParseFirstLeft(k.FirstLeft)==b&&this.Poly2ContainsPoly1(k.Pts,d.Pts)&&(k.FirstLeft=d)}};f.Clipper.prototype.FixupFirstLefts2=function(b,
d){for(var e=0,f=this.m_PolyOuts,k=f.length,C=f[e];e<k;e++,C=f[e])C.FirstLeft==b&&(C.FirstLeft=d)};f.Clipper.ParseFirstLeft=function(b){for(;null!=b&&null==b.Pts;)b=b.FirstLeft;return b};f.Clipper.prototype.JoinCommonEdges=function(){for(var b=0,d=this.m_Joins.length;b<d;b++){var e=this.m_Joins[b],m=this.GetOutRec(e.OutPt1.Idx),k=this.GetOutRec(e.OutPt2.Idx);if(null!=m.Pts&&null!=k.Pts){var C;C=m==k?m:this.Param1RightOfParam2(m,k)?k:this.Param1RightOfParam2(k,m)?m:this.GetLowermostRec(m,k);if(this.JoinPoints(e,
m,k))if(m==k){m.Pts=e.OutPt1;m.BottomPt=null;k=this.CreateOutRec();k.Pts=e.OutPt2;this.UpdateOutPtIdxs(k);if(this.m_UsingPolyTree){C=0;for(var u=this.m_PolyOuts.length;C<u-1;C++){var B=this.m_PolyOuts[C];null!=B.Pts&&f.Clipper.ParseFirstLeft(B.FirstLeft)==m&&B.IsHole!=m.IsHole&&this.Poly2ContainsPoly1(B.Pts,e.OutPt2)&&(B.FirstLeft=k)}}this.Poly2ContainsPoly1(k.Pts,m.Pts)?(k.IsHole=!m.IsHole,k.FirstLeft=m,this.m_UsingPolyTree&&this.FixupFirstLefts2(k,m),(k.IsHole^this.ReverseSolution)==0<this.Area(k)&&
this.ReversePolyPtLinks(k.Pts)):this.Poly2ContainsPoly1(m.Pts,k.Pts)?(k.IsHole=m.IsHole,m.IsHole=!k.IsHole,k.FirstLeft=m.FirstLeft,m.FirstLeft=k,this.m_UsingPolyTree&&this.FixupFirstLefts2(m,k),(m.IsHole^this.ReverseSolution)==0<this.Area(m)&&this.ReversePolyPtLinks(m.Pts)):(k.IsHole=m.IsHole,k.FirstLeft=m.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(m,k))}else k.Pts=null,k.BottomPt=null,k.Idx=m.Idx,m.IsHole=C.IsHole,C==k&&(m.FirstLeft=k.FirstLeft),k.FirstLeft=m,this.m_UsingPolyTree&&this.FixupFirstLefts2(k,
m)}}};f.Clipper.prototype.UpdateOutPtIdxs=function(b){var d=b.Pts;do d.Idx=b.Idx,d=d.Prev;while(d!=b.Pts)};f.Clipper.prototype.DoSimplePolygons=function(){for(var b=0;b<this.m_PolyOuts.length;){var d=this.m_PolyOuts[b++],e=d.Pts;if(null!=e&&!d.IsOpen){do{for(var m=e.Next;m!=d.Pts;){if(f.IntPoint.op_Equality(e.Pt,m.Pt)&&m.Next!=e&&m.Prev!=e){var k=e.Prev,C=m.Prev;e.Prev=C;C.Next=e;m.Prev=k;k.Next=m;d.Pts=e;k=this.CreateOutRec();k.Pts=m;this.UpdateOutPtIdxs(k);this.Poly2ContainsPoly1(k.Pts,d.Pts)?(k.IsHole=
!d.IsHole,k.FirstLeft=d,this.m_UsingPolyTree&&this.FixupFirstLefts2(k,d)):this.Poly2ContainsPoly1(d.Pts,k.Pts)?(k.IsHole=d.IsHole,d.IsHole=!k.IsHole,k.FirstLeft=d.FirstLeft,d.FirstLeft=k,this.m_UsingPolyTree&&this.FixupFirstLefts2(d,k)):(k.IsHole=d.IsHole,k.FirstLeft=d.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(d,k));m=e}m=m.Next}e=e.Next}while(e!=d.Pts)}}};f.Clipper.Area=function(b){var d=b.length;if(3>d)return 0;for(var e=0,f=0,k=d-1;f<d;++f)e+=(b[k].X+b[f].X)*(b[k].Y-b[f].Y),k=f;return.5*
-e};f.Clipper.prototype.Area=function(b){var d=b.Pts;if(null==d)return 0;var e=0;do e+=(d.Prev.Pt.X+d.Pt.X)*(d.Prev.Pt.Y-d.Pt.Y),d=d.Next;while(d!=b.Pts);return.5*e};f.Clipper.SimplifyPolygon=function(b,d){var e=[],m=new f.Clipper(0);m.StrictlySimple=!0;m.AddPath(b,f.PolyType.ptSubject,!0);m.Execute(f.ClipType.ctUnion,e,d,d);return e};f.Clipper.SimplifyPolygons=function(b,d){"undefined"==typeof d&&(d=f.PolyFillType.pftEvenOdd);var e=[],m=new f.Clipper(0);m.StrictlySimple=!0;m.AddPaths(b,f.PolyType.ptSubject,
!0);m.Execute(f.ClipType.ctUnion,e,d,d);return e};f.Clipper.DistanceSqrd=function(b,d){var e=b.X-d.X,f=b.Y-d.Y;return e*e+f*f};f.Clipper.DistanceFromLineSqrd=function(b,d,e){var f=d.Y-e.Y;e=e.X-d.X;d=f*d.X+e*d.Y;d=f*b.X+e*b.Y-d;return d*d/(f*f+e*e)};f.Clipper.SlopesNearCollinear=function(b,d,e,m){return Math.abs(b.X-d.X)>Math.abs(b.Y-d.Y)?b.X>d.X==b.X<e.X?f.Clipper.DistanceFromLineSqrd(b,d,e)<m:d.X>b.X==d.X<e.X?f.Clipper.DistanceFromLineSqrd(d,b,e)<m:f.Clipper.DistanceFromLineSqrd(e,b,d)<m:b.Y>d.Y==
b.Y<e.Y?f.Clipper.DistanceFromLineSqrd(b,d,e)<m:d.Y>b.Y==d.Y<e.Y?f.Clipper.DistanceFromLineSqrd(d,b,e)<m:f.Clipper.DistanceFromLineSqrd(e,b,d)<m};f.Clipper.PointsAreClose=function(b,d,e){var f=b.X-d.X;b=b.Y-d.Y;return f*f+b*b<=e};f.Clipper.ExcludeOp=function(b){var d=b.Prev;d.Next=b.Next;b.Next.Prev=d;d.Idx=0;return d};f.Clipper.CleanPolygon=function(b,d){"undefined"==typeof d&&(d=1.415);var e=b.length;if(0==e)return[];for(var m=Array(e),k=0;k<e;++k)m[k]=new f.OutPt;for(k=0;k<e;++k)m[k].Pt=b[k],m[k].Next=
m[(k+1)%e],m[k].Next.Prev=m[k],m[k].Idx=0;k=d*d;for(m=m[0];0==m.Idx&&m.Next!=m.Prev;)f.Clipper.PointsAreClose(m.Pt,m.Prev.Pt,k)?(m=f.Clipper.ExcludeOp(m),e--):f.Clipper.PointsAreClose(m.Prev.Pt,m.Next.Pt,k)?(f.Clipper.ExcludeOp(m.Next),m=f.Clipper.ExcludeOp(m),e-=2):f.Clipper.SlopesNearCollinear(m.Prev.Pt,m.Pt,m.Next.Pt,k)?(m=f.Clipper.ExcludeOp(m),e--):(m.Idx=1,m=m.Next);3>e&&(e=0);for(var C=Array(e),k=0;k<e;++k)C[k]=new f.IntPoint(m.Pt),m=m.Next;return C};f.Clipper.CleanPolygons=function(b,d){for(var e=
Array(b.length),m=0,k=b.length;m<k;m++)e[m]=f.Clipper.CleanPolygon(b[m],d);return e};f.Clipper.Minkowski=function(b,d,e,m){m=m?1:0;var k=b.length,C=d.length,u=[];if(e)for(e=0;e<C;e++){for(var B=Array(k),t=0,I=b.length,G=b[t];t<I;t++,G=b[t])B[t]=new f.IntPoint(d[e].X+G.X,d[e].Y+G.Y);u.push(B)}else for(e=0;e<C;e++){B=Array(k);t=0;I=b.length;for(G=b[t];t<I;t++,G=b[t])B[t]=new f.IntPoint(d[e].X-G.X,d[e].Y-G.Y);u.push(B)}b=[];for(e=0;e<C-1+m;e++)for(t=0;t<k;t++)d=[],d.push(u[e%C][t%k]),d.push(u[(e+1)%
C][t%k]),d.push(u[(e+1)%C][(t+1)%k]),d.push(u[e%C][(t+1)%k]),f.Clipper.Orientation(d)||d.reverse(),b.push(d);return b};f.Clipper.MinkowskiSum=function(b,d,e){if(d[0]instanceof Array){u=d;d=new f.Paths;for(var m=new f.Clipper,k=0;k<u.length;++k){var C=f.Clipper.Minkowski(b,u[k],!0,e);m.AddPaths(C,f.PolyType.ptSubject,!0);e&&(C=f.Clipper.TranslatePath(u[k],b[0]),m.AddPath(C,f.PolyType.ptClip,!0))}m.Execute(f.ClipType.ctUnion,d,f.PolyFillType.pftNonZero,f.PolyFillType.pftNonZero);return d}var u=f.Clipper.Minkowski(b,
d,!0,e),m=new f.Clipper;m.AddPaths(u,f.PolyType.ptSubject,!0);m.Execute(f.ClipType.ctUnion,u,f.PolyFillType.pftNonZero,f.PolyFillType.pftNonZero);return u};f.Clipper.TranslatePath=function(b,d){for(var e=new f.Path,m=0;m<b.length;m++)e.push(new f.IntPoint(b[m].X+d.X,b[m].Y+d.Y));return e};f.Clipper.MinkowskiDiff=function(b,d){var e=f.Clipper.Minkowski(b,d,!1,!0),m=new f.Clipper;m.AddPaths(e,f.PolyType.ptSubject,!0);m.Execute(f.ClipType.ctUnion,e,f.PolyFillType.pftNonZero,f.PolyFillType.pftNonZero);
return e};f.Clipper.PolyTreeToPaths=function(b){var d=[];f.Clipper.AddPolyNodeToPaths(b,f.Clipper.NodeType.ntAny,d);return d};f.Clipper.AddPolyNodeToPaths=function(b,d,e){var m=!0;switch(d){case f.Clipper.NodeType.ntOpen:return;case f.Clipper.NodeType.ntClosed:m=!b.IsOpen}0<b.m_polygon.length&&m&&e.push(b.m_polygon);m=0;b=b.Childs();for(var k=b.length,C=b[m];m<k;m++,C=b[m])f.Clipper.AddPolyNodeToPaths(C,d,e)};f.Clipper.OpenPathsFromPolyTree=function(b){for(var d=new f.Paths,e=0,m=b.ChildCount();e<
m;e++)b.Childs()[e].IsOpen&&d.push(b.Childs()[e].m_polygon);return d};f.Clipper.ClosedPathsFromPolyTree=function(b){var d=new f.Paths;f.Clipper.AddPolyNodeToPaths(b,f.Clipper.NodeType.ntClosed,d);return d};U(f.Clipper,f.ClipperBase);f.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2};f.ClipperOffset=function(b,d){"undefined"==typeof b&&(b=2);"undefined"==typeof d&&(d=f.ClipperOffset.def_arc_tolerance);this.m_destPolys=new f.Paths;this.m_srcPoly=new f.Path;this.m_destPoly=new f.Path;this.m_normals=[];
this.m_StepsPerRad=this.m_miterLim=this.m_cos=this.m_sin=this.m_sinA=this.m_delta=0;this.m_lowest=new f.IntPoint;this.m_polyNodes=new f.PolyNode;this.MiterLimit=b;this.ArcTolerance=d;this.m_lowest.X=-1};f.ClipperOffset.two_pi=6.28318530717959;f.ClipperOffset.def_arc_tolerance=.25;f.ClipperOffset.prototype.Clear=function(){f.Clear(this.m_polyNodes.Childs());this.m_lowest.X=-1};f.ClipperOffset.Round=f.Clipper.Round;f.ClipperOffset.prototype.AddPath=function(b,d,e){var m=b.length-1;if(!(0>m)){var k=
new f.PolyNode;k.m_jointype=d;k.m_endtype=e;if(e==f.EndType.etClosedLine||e==f.EndType.etClosedPolygon)for(;0<m&&f.IntPoint.op_Equality(b[0],b[m]);)m--;k.m_polygon.push(b[0]);var C=0;d=0;for(var u=1;u<=m;u++)f.IntPoint.op_Inequality(k.m_polygon[C],b[u])&&(C++,k.m_polygon.push(b[u]),b[u].Y>k.m_polygon[d].Y||b[u].Y==k.m_polygon[d].Y&&b[u].X<k.m_polygon[d].X)&&(d=C);if(!(e==f.EndType.etClosedPolygon&&2>C)&&(this.m_polyNodes.AddChild(k),e==f.EndType.etClosedPolygon))if(0>this.m_lowest.X)this.m_lowest=
new f.IntPoint(this.m_polyNodes.ChildCount()-1,d);else if(b=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],k.m_polygon[d].Y>b.Y||k.m_polygon[d].Y==b.Y&&k.m_polygon[d].X<b.X)this.m_lowest=new f.IntPoint(this.m_polyNodes.ChildCount()-1,d)}};f.ClipperOffset.prototype.AddPaths=function(b,d,e){for(var f=0,k=b.length;f<k;f++)this.AddPath(b[f],d,e)};f.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!f.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var b=
0;b<this.m_polyNodes.ChildCount();b++){var d=this.m_polyNodes.Childs()[b];(d.m_endtype==f.EndType.etClosedPolygon||d.m_endtype==f.EndType.etClosedLine&&f.Clipper.Orientation(d.m_polygon))&&d.m_polygon.reverse()}else for(b=0;b<this.m_polyNodes.ChildCount();b++)d=this.m_polyNodes.Childs()[b],d.m_endtype!=f.EndType.etClosedLine||f.Clipper.Orientation(d.m_polygon)||d.m_polygon.reverse()};f.ClipperOffset.GetUnitNormal=function(b,d){var e=d.X-b.X,m=d.Y-b.Y;if(0==e&&0==m)return new f.DoublePoint(0,0);var k=
1/Math.sqrt(e*e+m*m);return new f.DoublePoint(m*k,-(e*k))};f.ClipperOffset.prototype.DoOffset=function(b){this.m_destPolys=[];this.m_delta=b;if(f.ClipperBase.near_zero(b))for(var d=0;d<this.m_polyNodes.ChildCount();d++){var e=this.m_polyNodes.Childs()[d];e.m_endtype==f.EndType.etClosedPolygon&&this.m_destPolys.push(e.m_polygon)}else{this.m_miterLim=2<this.MiterLimit?2/(this.MiterLimit*this.MiterLimit):.5;var m=3.14159265358979/Math.acos(1-(0>=this.ArcTolerance?f.ClipperOffset.def_arc_tolerance:this.ArcTolerance>
Math.abs(b)*f.ClipperOffset.def_arc_tolerance?Math.abs(b)*f.ClipperOffset.def_arc_tolerance:this.ArcTolerance)/Math.abs(b));this.m_sin=Math.sin(f.ClipperOffset.two_pi/m);this.m_cos=Math.cos(f.ClipperOffset.two_pi/m);this.m_StepsPerRad=m/f.ClipperOffset.two_pi;0>b&&(this.m_sin=-this.m_sin);for(d=0;d<this.m_polyNodes.ChildCount();d++){e=this.m_polyNodes.Childs()[d];this.m_srcPoly=e.m_polygon;var k=this.m_srcPoly.length;if(!(0==k||0>=b&&(3>k||e.m_endtype!=f.EndType.etClosedPolygon))){this.m_destPoly=
[];if(1==k)if(e.m_jointype==f.JoinType.jtRound)for(var e=1,k=0,C=1;C<=m;C++){this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[0].X+e*b),f.ClipperOffset.Round(this.m_srcPoly[0].Y+k*b)));var u=e,e=e*this.m_cos-this.m_sin*k,k=u*this.m_sin+k*this.m_cos}else for(k=e=-1,C=0;4>C;++C)this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[0].X+e*b),f.ClipperOffset.Round(this.m_srcPoly[0].Y+k*b))),0>e?e=1:0>k?k=1:e=-1;else{for(C=this.m_normals.length=0;C<k-1;C++)this.m_normals.push(f.ClipperOffset.GetUnitNormal(this.m_srcPoly[C],
this.m_srcPoly[C+1]));e.m_endtype==f.EndType.etClosedLine||e.m_endtype==f.EndType.etClosedPolygon?this.m_normals.push(f.ClipperOffset.GetUnitNormal(this.m_srcPoly[k-1],this.m_srcPoly[0])):this.m_normals.push(new f.DoublePoint(this.m_normals[k-2]));if(e.m_endtype==f.EndType.etClosedPolygon)for(u=k-1,C=0;C<k;C++)u=this.OffsetPoint(C,u,e.m_jointype);else if(e.m_endtype==f.EndType.etClosedLine){u=k-1;for(C=0;C<k;C++)u=this.OffsetPoint(C,u,e.m_jointype);this.m_destPolys.push(this.m_destPoly);this.m_destPoly=
[];u=this.m_normals[k-1];for(C=k-1;0<C;C--)this.m_normals[C]=new f.DoublePoint(-this.m_normals[C-1].X,-this.m_normals[C-1].Y);this.m_normals[0]=new f.DoublePoint(-u.X,-u.Y);u=0;for(C=k-1;0<=C;C--)u=this.OffsetPoint(C,u,e.m_jointype)}else{u=0;for(C=1;C<k-1;++C)u=this.OffsetPoint(C,u,e.m_jointype);e.m_endtype==f.EndType.etOpenButt?(C=k-1,u=new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[C].X+this.m_normals[C].X*b),f.ClipperOffset.Round(this.m_srcPoly[C].Y+this.m_normals[C].Y*b)),this.m_destPoly.push(u),
u=new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[C].X-this.m_normals[C].X*b),f.ClipperOffset.Round(this.m_srcPoly[C].Y-this.m_normals[C].Y*b)),this.m_destPoly.push(u)):(C=k-1,u=k-2,this.m_sinA=0,this.m_normals[C]=new f.DoublePoint(-this.m_normals[C].X,-this.m_normals[C].Y),e.m_endtype==f.EndType.etOpenSquare?this.DoSquare(C,u):this.DoRound(C,u));for(C=k-1;0<C;C--)this.m_normals[C]=new f.DoublePoint(-this.m_normals[C-1].X,-this.m_normals[C-1].Y);this.m_normals[0]=new f.DoublePoint(-this.m_normals[1].X,
-this.m_normals[1].Y);u=k-1;for(C=u-1;0<C;--C)u=this.OffsetPoint(C,u,e.m_jointype);e.m_endtype==f.EndType.etOpenButt?(u=new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*b),f.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*b)),this.m_destPoly.push(u),u=new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*b),f.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*b)),this.m_destPoly.push(u)):(this.m_sinA=0,e.m_endtype==f.EndType.etOpenSquare?
this.DoSquare(0,1):this.DoRound(0,1))}}this.m_destPolys.push(this.m_destPoly)}}}};f.ClipperOffset.prototype.Execute=function(){var b=arguments;if(b[0]instanceof f.PolyTree)if(d=b[0],e=b[1],d.Clear(),this.FixOrientations(),this.DoOffset(e),b=new f.Clipper(0),b.AddPaths(this.m_destPolys,f.PolyType.ptSubject,!0),0<e)b.Execute(f.ClipType.ctUnion,d,f.PolyFillType.pftPositive,f.PolyFillType.pftPositive);else if(e=f.Clipper.GetBounds(this.m_destPolys),k=new f.Path,k.push(new f.IntPoint(e.left-10,e.bottom+
10)),k.push(new f.IntPoint(e.right+10,e.bottom+10)),k.push(new f.IntPoint(e.right+10,e.top-10)),k.push(new f.IntPoint(e.left-10,e.top-10)),b.AddPath(k,f.PolyType.ptSubject,!0),b.ReverseSolution=!0,b.Execute(f.ClipType.ctUnion,d,f.PolyFillType.pftNegative,f.PolyFillType.pftNegative),1==d.ChildCount()&&0<d.Childs()[0].ChildCount())for(b=d.Childs()[0],d.Childs()[0]=b.Childs()[0],d.Childs()[0].m_Parent=d,e=1;e<b.ChildCount();e++)d.AddChild(b.Childs()[e]);else d.Clear();else{var d=b[0],e=b[1];f.Clear(d);
this.FixOrientations();this.DoOffset(e);b=new f.Clipper(0);b.AddPaths(this.m_destPolys,f.PolyType.ptSubject,!0);if(0<e)b.Execute(f.ClipType.ctUnion,d,f.PolyFillType.pftPositive,f.PolyFillType.pftPositive);else{var e=f.Clipper.GetBounds(this.m_destPolys),k=new f.Path;k.push(new f.IntPoint(e.left-10,e.bottom+10));k.push(new f.IntPoint(e.right+10,e.bottom+10));k.push(new f.IntPoint(e.right+10,e.top-10));k.push(new f.IntPoint(e.left-10,e.top-10));b.AddPath(k,f.PolyType.ptSubject,!0);b.ReverseSolution=
!0;b.Execute(f.ClipType.ctUnion,d,f.PolyFillType.pftNegative,f.PolyFillType.pftNegative);0<d.length&&d.splice(0,1)}}};f.ClipperOffset.prototype.OffsetPoint=function(b,d,e){this.m_sinA=this.m_normals[d].X*this.m_normals[b].Y-this.m_normals[b].X*this.m_normals[d].Y;if(1>Math.abs(this.m_sinA*this.m_delta)){if(0<this.m_normals[d].X*this.m_normals[b].X+this.m_normals[b].Y*this.m_normals[d].Y)return this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[d].X*this.m_delta),
f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[d].Y*this.m_delta))),d}else 1<this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1);if(0>this.m_sinA*this.m_delta)this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[d].X*this.m_delta),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[d].Y*this.m_delta))),this.m_destPoly.push(new f.IntPoint(this.m_srcPoly[b])),this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[b].X*
this.m_delta),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[b].Y*this.m_delta)));else switch(e){case f.JoinType.jtMiter:e=1+(this.m_normals[b].X*this.m_normals[d].X+this.m_normals[b].Y*this.m_normals[d].Y);e>=this.m_miterLim?this.DoMiter(b,d,e):this.DoSquare(b,d);break;case f.JoinType.jtSquare:this.DoSquare(b,d);break;case f.JoinType.jtRound:this.DoRound(b,d)}return b};f.ClipperOffset.prototype.DoSquare=function(b,d){var e=Math.tan(Math.atan2(this.m_sinA,this.m_normals[d].X*this.m_normals[b].X+
this.m_normals[d].Y*this.m_normals[b].Y)/4);this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_delta*(this.m_normals[d].X-this.m_normals[d].Y*e)),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_delta*(this.m_normals[d].Y+this.m_normals[d].X*e))));this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_delta*(this.m_normals[b].X+this.m_normals[b].Y*e)),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_delta*(this.m_normals[b].Y-this.m_normals[b].X*
e))))};f.ClipperOffset.prototype.DoMiter=function(b,d,e){e=this.m_delta/e;this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+(this.m_normals[d].X+this.m_normals[b].X)*e),f.ClipperOffset.Round(this.m_srcPoly[b].Y+(this.m_normals[d].Y+this.m_normals[b].Y)*e)))};f.ClipperOffset.prototype.DoRound=function(b,d){for(var e=Math.max(f.Cast_Int32(f.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(Math.atan2(this.m_sinA,this.m_normals[d].X*this.m_normals[b].X+this.m_normals[d].Y*this.m_normals[b].Y)))),
1),k=this.m_normals[d].X,p=this.m_normals[d].Y,C,u=0;u<e;++u)this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+k*this.m_delta),f.ClipperOffset.Round(this.m_srcPoly[b].Y+p*this.m_delta))),C=k,k=k*this.m_cos-this.m_sin*p,p=C*this.m_sin+p*this.m_cos;this.m_destPoly.push(new f.IntPoint(f.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[b].X*this.m_delta),f.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[b].Y*this.m_delta)))};f.Error=function(b){try{throw Error(b);
}catch(d){alert(d.message)}};f.JS={};f.JS.AreaOfPolygon=function(b,d){d||(d=1);return f.Clipper.Area(b)/(d*d)};f.JS.AreaOfPolygons=function(b,d){d||(d=1);for(var e=0,k=0;k<b.length;k++)e+=f.Clipper.Area(b[k]);return e/(d*d)};f.JS.BoundsOfPath=function(b,d){return f.JS.BoundsOfPaths([b],d)};f.JS.BoundsOfPaths=function(b,d){d||(d=1);var e=f.Clipper.GetBounds(b);e.left/=d;e.bottom/=d;e.right/=d;e.top/=d;return e};f.JS.Clean=function(b,d){if(!(b instanceof Array))return[];var e=b[0]instanceof Array;b=
f.JS.Clone(b);if("number"!=typeof d||null===d)return f.Error("Delta is not a number in Clean()."),b;if(0===b.length||1==b.length&&0===b[0].length||0>d)return b;e||(b=[b]);for(var k=b.length,p,C,u,t,I,G,J,X=[],S=0;S<k;S++)if(C=b[S],p=C.length,0!==p)if(3>p)u=C,X.push(u);else{u=C;t=d*d;I=C[0];for(J=G=1;J<p;J++)(C[J].X-I.X)*(C[J].X-I.X)+(C[J].Y-I.Y)*(C[J].Y-I.Y)<=t||(u[G]=C[J],I=C[J],G++);I=C[G-1];(C[0].X-I.X)*(C[0].X-I.X)+(C[0].Y-I.Y)*(C[0].Y-I.Y)<=t&&G--;G<p&&u.splice(G,p-G);u.length&&X.push(u)}!e&&
X.length?X=X[0]:e||0!==X.length?e&&0===X.length&&(X=[[]]):X=[];return X};f.JS.Clone=function(b){if(!(b instanceof Array)||0===b.length)return[];if(1==b.length&&0===b[0].length)return[[]];var d=b[0]instanceof Array;d||(b=[b]);var e=b.length,f,k,t,u,B=Array(e);for(k=0;k<e;k++){f=b[k].length;u=Array(f);for(t=0;t<f;t++)u[t]={X:b[k][t].X,Y:b[k][t].Y};B[k]=u}d||(B=B[0]);return B};f.JS.Lighten=function(b,d){if(!(b instanceof Array))return[];if("number"!=typeof d||null===d)return f.Error("Tolerance is not a number in Lighten()."),
f.JS.Clone(b);if(0===b.length||1==b.length&&0===b[0].length||0>d)return f.JS.Clone(b);b[0]instanceof Array||(b=[b]);var e,k,p,t,u,B,I,G,J,X,S,V,Y,U,Z,ga=b.length,ma=d*d,ka=[];for(e=0;e<ga;e++)if(p=b[e],B=p.length,0!=B){for(t=0;1E6>t;t++){u=[];B=p.length;p[B-1].X!=p[0].X||p[B-1].Y!=p[0].Y?(S=1,p.push({X:p[0].X,Y:p[0].Y}),B=p.length):S=0;X=[];for(k=0;k<B-2;k++){I=p[k];J=p[k+1];G=p[k+2];U=I.X;Z=I.Y;I=G.X-U;V=G.Y-Z;if(0!==I||0!==V)Y=((J.X-U)*I+(J.Y-Z)*V)/(I*I+V*V),1<Y?(U=G.X,Z=G.Y):0<Y&&(U+=I*Y,Z+=V*
Y);I=J.X-U;V=J.Y-Z;G=I*I+V*V;G<=ma&&(X[k+1]=1,k++)}u.push({X:p[0].X,Y:p[0].Y});for(k=1;k<B-1;k++)X[k]||u.push({X:p[k].X,Y:p[k].Y});u.push({X:p[B-1].X,Y:p[B-1].Y});S&&p.pop();if(X.length)p=u;else break}B=u.length;u[B-1].X==u[0].X&&u[B-1].Y==u[0].Y&&u.pop();2<u.length&&ka.push(u)}b[0]instanceof Array||(ka=ka[0]);"undefined"==typeof ka&&(ka=[[]]);return ka};f.JS.PerimeterOfPath=function(b,d,e){if("undefined"==typeof b)return 0;var f=Math.sqrt,k=0,t,u,B,I,G=b.length;if(2>G)return 0;for(d&&(b[G]=b[0],
G++);--G;)t=b[G],B=t.X,t=t.Y,u=b[G-1],I=u.X,u=u.Y,k+=f((B-I)*(B-I)+(t-u)*(t-u));d&&b.pop();return k/e};f.JS.PerimeterOfPaths=function(b,d,e){e||(e=1);for(var k=0,p=0;p<b.length;p++)k+=f.JS.PerimeterOfPath(b[p],d,e);return k};f.JS.ScaleDownPath=function(b,d){var e,f;d||(d=1);for(e=b.length;e--;)f=b[e],f.X/=d,f.Y/=d};f.JS.ScaleDownPaths=function(b,d){var e,f,k;d||(d=1);for(e=b.length;e--;)for(f=b[e].length;f--;)k=b[e][f],k.X/=d,k.Y/=d};f.JS.ScaleUpPath=function(b,d){var e,f,k=Math.round;d||(d=1);for(e=
b.length;e--;)f=b[e],f.X=k(f.X*d),f.Y=k(f.Y*d)};f.JS.ScaleUpPaths=function(b,d){var e,f,k,t=Math.round;d||(d=1);for(e=b.length;e--;)for(f=b[e].length;f--;)k=b[e][f],k.X=t(k.X*d),k.Y=t(k.Y*d)};f.ExPolygons=function(){return[]};f.ExPolygon=function(){this.holes=this.outer=null};f.JS.AddOuterPolyNodeToExPolygons=function(b,d){var e=new f.ExPolygon;e.outer=b.Contour();var k=b.Childs(),p=k.length;e.holes=Array(p);var t,u,B,I,G;for(u=0;u<p;u++)for(t=k[u],e.holes[u]=t.Contour(),B=0,I=t.Childs(),G=I.length;B<
G;B++)t=I[B],f.JS.AddOuterPolyNodeToExPolygons(t,d);d.push(e)};f.JS.ExPolygonsToPaths=function(b){var d,e,k,p,t=new f.Paths;d=0;for(k=b.length;d<k;d++)for(t.push(b[d].outer),e=0,p=b[d].holes.length;e<p;e++)t.push(b[d].holes[e]);return t};f.JS.PolyTreeToExPolygons=function(b){var d=new f.ExPolygons,e,k,p;e=0;k=b.Childs();for(p=k.length;e<p;e++)b=k[e],f.JS.AddOuterPolyNodeToExPolygons(b,d);return d}})();
var CindyJS=function(){function t(k){if(0===Ea)return console.error("Waiting for "+k+" after we finished waiting."),function(){};0>Ea&&(Ea=0);++Ea;return function(){--Ea;0>Ea&&console.error("Wait count mismatch: "+k);if(0===Ea)for(var t=0,G=Ya.length;t<G;)Ya[t++].startup()}}function G(k){var t=G.newInstance(k);0>=Ea?t.startup():!1!==k.autostart&&Ya.push(t);return t}var Ea=-1,Ya=[];"undefined"===typeof document||"undefined"===typeof window||"undefined"===typeof document.addEventListener||"undefined"!==
typeof window.cindyDontWait&&!0===window.cindyDontWait||document.addEventListener("DOMContentLoaded",t("DOMContentLoaded"));var Ka=null,Ia=null,pa={};G.getBaseDir=function(){if(null!==Ka)return Ka;for(var k=document.getElementsByTagName("script"),t=0;t<k.length;++t){var G=k[t],Y=G.src;if(Y){var ga=/Cindy\.js$/.exec(Y);if(ga)return Ka=Y.substr(0,ga.index),console.log("Will load extensions from "+Ka),Ia=G,Ka}}console.error("Could not find <script> tag for Cindy.js");return Ka=Ia=!1};G.addNewScript=
function(k,t){t||console.error.bind(console);var S=G.getBaseDir();if(!1===S)return!1;var Y=document.createElement("script");Y.src=S+k;var S=Ia.nextSibling,ga=Ia.parentElement;S?ga.insertBefore(Y,S):ga.appendChild(Y);return Y};G.loadScript=function(k,t,S,Y){if(window[k])return S(),!0;Y||(Y=console.error.bind(console));var ga=pa[k];if(!ga){ga=G.addNewScript(t,Y);if(!1===ga)return Y("Can't load additional components."),!1;pa[k]=ga}ga.addEventListener("load",S);ga.addEventListener("error",Y);return null};
G._autoLoadingPlugin={};G.autoLoadPlugin=function(k,t,S){if(G._pluginRegistry[k])return S(),!0;var Y=G._autoLoadingPlugin[k];if(!Y){t||(t=k+"-plugin.js");Y=G._autoLoadingPlugin[k]=[];k=G.addNewScript(t);if(!1===k)return!1;k.addEventListener("error",console.error.bind(console))}Y.push(S);return null};var k={ctype:"undefined"};G.waitFor=t;G._pluginRegistry={};G.instances=[];G.registerPlugin=function(k,t,S){if(1!==k)return console.error("Plugin API version "+k+" not supported"),!1;G._pluginRegistry[t]=
S;(G._autoLoadingPlugin[t]||[]).forEach(function(k){k()})};var Ta=0;G.dumpState=function(k){k=G.instances[k||0].saveState();console.log(JSON.stringify(k))};G.debugState=function(k){G.instances.map(function(k){var t=k.config,t=JSON.parse(JSON.stringify(t)),I=k.saveState();console.log(JSON.stringify(I));for(var G in I)t[G]=I[G];k.shutdown();return t}).forEach(function(k){G(k)})};G.newInstance=function(t){function G(){ia.width=ca=ia.clientWidth;ia.height=ba=ia.clientHeight;y.setTransform(1,0,0,1,0,0);
z.setMat(25,0,0,25,250.5,250.5);if(xb)for(var a=0;a<xb.length;a++){var h=xb[a],c=Object.keys(h)[0];"scale"===c&&(Jb=h.scale,z[c](h.scale));if("translate"===c)z[c](h.translate[0],h.translate[1]);"scaleAndOrigin"===c&&(Jb=h[c][0]/25,z[c].apply(null,h[c]));"visibleRect"===c&&(z[c].apply(null,h[c]),Jb=z.drawingstate.initialmatrix.a/25)}z.createnewbackup();z.greset();a=1;"undefined"!==typeof window&&window.devicePixelRatio&&(a=window.devicePixelRatio);h=y.webkitBackingStorePixelRatio||y.mozBackingStorePixelRatio||
y.msBackingStorePixelRatio||y.oBackingStorePixelRatio||y.backingStorePixelRatio||1;a!==h&&(a/=h,ia.width=ca*a,ia.height=ba*a,y.scale(a,a))}function S(a){var h;if("canvas"!==a.tagName.toLowerCase())for(h=a,ia=document.createElement("canvas");h.firstChild;)h.removeChild(h.firstChild);else{ia=a;h=document.createElement("div");var c=null,q=null;Array.prototype.slice.call(ia.attributes).forEach(function(a){"width"===a.name?c=a.value:"height"===a.name?q=a.value:h.setAttributeNodeNS(ia.removeAttributeNode(a))});
null===c||h.style.width||(h.style.width=c+"px");null===q||h.style.height||(h.style.height=q+"px");ia.parentNode.replaceChild(h,ia)}h.classList.add("CindyJS-widget");a=ia.style;a.position="absolute";a.border="none";a.margin=a.padding=a.left=a.top="0px";a.width=a.height="100%";a="static";window.getComputedStyle&&(a=window.getComputedStyle(h).getPropertyValue("position"),a=String(a||"static"));"static"===a&&(h.style.position="relative");h.appendChild(ia);return ia}function Y(){var a=t.cinderella;if(!a||
!a.version)return!1;for(var h=0;h<arguments.length;++h){var c=a.version[h],q=arguments[h];if(c!==q)return typeof c===typeof q&&c<q}return!1}function ga(){$b=!0;if(0===Kb){if(t.exclusive)for(b=ua.instances.length;0<b;)ua.instances[--b].shutdown();void 0!==t.csconsole&&(ha=t.csconsole);ha=null===ha?new ma:!0===ha?new Ya:"string"===typeof ha?new Za(ha):"object"===typeof ha&&"function"===typeof ha.appendChild?new Za(ha):new ma;ra=[100,100];var a=null;xb=t.transform;if(t.ports&&0<t.ports.length){b=t.ports[0];
(a=b.element)||(a=document.getElementById(b.id));var a=S(a),h=a.parentNode.style;"window"===b.fill?(h.width="100vw",h.height="100vh"):"parent"===b.fill?(h.width="100%",h.height="100%"):b.width&&b.height&&(h.width=b.width+"px",h.height=b.height+"px");b.background&&(a.style.backgroundColor=b.background);void 0!==b.transform&&(xb=b.transform);Aa(b.grid)&&0<b.grid&&(Ua=b.grid);Aa(b.tgrid)&&0<b.tgrid&&(ac=b.tgrid);b.snap&&(bc=!0);b.axes&&(yb=!0)}a||(a=t.canvas,a||"undefined"===typeof document||(a=document.getElementById(t.canvasname))&&
(a=S(a)));a&&(ia=a,y=a.getContext("2d"),G(),y.setLineDash||(y.setLineDash=function(){}),(t.animation?t.animation.controls:t.animcontrols)&&Ea(t),t.animation&&Aa(t.animation.speed)&&(void 0===t.animation.accuracy&&Y(2,9,1875)?ka(.5*t.animation.speed):ka(t.animation.speed)),t.animation&&Aa(t.animation.accuracy)&&(Lb=t.animation.accuracy));t.statusbar&&(cc="string"===typeof t.statusbar?document.getElementById(t.statusbar):t.statusbar);var c=t.scripts,q=null;"string"===typeof c&&c.search(/\*/)&&(q=c);
"object"!==typeof c&&(c=null);"move keydown keyup keytyped keytype mousedown mouseup mousedrag mousemove mouseclick init tick draw simulationstep simulationstart simulationstop ondrop".split(" ").forEach(function(a){var h;if(null!==c&&c[a])h=c[a];else{h=a+"script";if(t[h])h=document.getElementById(t[h]);else if(q){if(h=document.getElementById(q.replace(/\*/,a)),!h)return}else return;h=h.text}h=Na(h,!1);"error"===h.ctype?console.error("Error compiling "+a+" script: "+h.message):P[a]=h});Y(2,9,1888)&&
!P.keydown&&(P.keydown=P.keytyped,P.keytyped=P.keytype,P.keytype=void 0);Aa(t.grid)&&0<t.grid&&(Ua=t.grid);t.snap&&(bc=!0);v={};var b=0;bb={};t.geometry||(t.geometry=[]);Nd(t.geometry);t.behavior||(t.behavior=[]);"function"===typeof ec&&ec(t.behavior);for(var d in t.images)b=pa(t.images[d]),b!==k&&(bb[d]=b);oa.canvas=a;if(t.oninit)t.oninit(oa);ua.instances.push(oa);t.use&&t.use.forEach(function(a){r.use$1([w.wrap(a)],{})});Oc.convexhull3d$1&&Ka("quickhull3d","quickhull3d/quickhull3d.nocache.js");
U()}}function pa(a){var h;"string"===typeof a?(h=new Image,h.src=a):h=a;if(!h.tagName)return console.error("Not a valid image element",h),k;var c={img:h,width:NaN,height:NaN,ready:!0,live:!1,generation:0,whenReady:f};a=h.tagName.toLowerCase();var q=[];if("img"===a)h.complete?(c.width=h.width,c.height=h.height):(c.ready=!1,h.addEventListener("load",function(){c.width=h.width;c.height=h.height;c.ready=!0;c.whenReady=f;q.forEach(f);e()}),c.whenReady=q.push.bind(q));else if("video"===a)c.live=!0,h.readyState>=
h.HAVE_METADATA?(c.width=h.videoWidth,c.height=h.videoHeight):(c.ready=!1,h.addEventListener("loadedmetadata",function(){c.width=h.videoWidth;c.height=h.videoHeight;c.ready=!0;c.whenReady=f;q.forEach(f);e()}),c.whenReady=q.push.bind(q));else if("canvas"===a)c.width=h.width,c.height=h.height;else return console.error("Not a valid image element",a,h),k;return{ctype:"image",value:c}}function Ea(a){function h(a,c){var h=document.createElement("button"),q=document.createElement("img");h.appendChild(q);
l.appendChild(h);zb(q,a);h.addEventListener("click",c);Oa[a]=function(a){a?h.classList.add("CindyJS-active"):h.classList.remove("CindyJS-active")}}function c(a){if(k){var c=e.getBoundingClientRect();ka(g*(a.clientX-c.left-e.clientLeft+.5)/c.width+b)}}var q=document.createElement("div");q.className="CindyJS-animcontrols";ia.parentNode.appendChild(q);var b=0,d=1,g=1;a.animation&&a.animation.speedRange&&Aa(a.animation.speedRange[0])&&Aa(a.animation.speedRange[1])&&(b=a.animation.speedRange[0],d=a.animation.speedRange[1],
g=d-b);var e=document.createElement("div");e.className="CindyJS-animspeed";q.appendChild(e);var f=document.createElement("div");e.appendChild(f);J(e,"mousedown",function(a){k=!0;c(a)});J(e,"mousemove",c);J(ia.parentNode,"mouseup",function(a){k=!1},!0);var l=document.createElement("div");l.className="CindyJS-animbuttons";q.appendChild(l);h("play",La);h("pause",Ia);h("stop",$a);Oa.stop(!0);gc=function(a){a=(a-b)/g;a=Math.max(0,Math.min(1,a));a=.1*Math.round(1E3*a);f.style.width=a+"%"};var k=!1}function ka(a){Pc=
a;gc&&gc(a)}function f(a){return a()}function Ka(a,h){var c=null;t.plugins&&(c=t.plugins[a]);c||(c=ua._pluginRegistry[a]);c?r.use$1([w.wrap(a)],{}):(++Qc,ua.autoLoadPlugin(a,h,function(){r.use$1([w.wrap(a)],{});U()}))}function U(){0===--Qc&&(A(P.init),(t.animation||t).autoplay&&La(),oa.canvas&&Yb(oa.canvas,t))}function Z(){null!==Ab&&(la.set(Ab.state),Object.keys(Ab.speeds).forEach(function(a){var h=v.csnames[a];"undefined"!==typeof h.behavior&&(a=Ab.speeds[a],h.behavior.vx=a[0],h.behavior.vy=a[1],
h.behavior.vz=a[2],h.behavior.fx=0,h.behavior.fy=0,h.behavior.fz=0)}),Od())}function La(){if(!Va){if(Nb){var a=cb.backup;a.set(la);for(var h={},c=0;c<v.points.length;c++){var q=v.points[c];"undefined"!==typeof q.behavior&&(h[q.name]=[q.behavior.vx,q.behavior.vy,q.behavior.vz])}Ab={state:a,speeds:h};Bb=0;Nb=!1;Oa.stop(!1)}else Oa.pause(!1);hc=Date.now();Oa.play(!0);"function"===typeof ec&&ic&&Pd();Va=!0;A(P.simulationstart);e()}}function Ia(){Va&&(Oa.play(!1),Oa.pause(!0),Va=!1)}function $a(){Nb||
(Va?(A(P.simulationstop),Va=!1,Oa.play(!1)):Oa.pause(!1),Oa.stop(!0),Nb=!0,Z())}function Ma(){if(!jc){jc=!0;for(var a=ua.instances.length;0<a;)if(ua.instances[--a]===oa){ua.instances.splice(a,1);break}for(a=ib.length;0<a;)try{ib[--a]()}catch(h){console.error(h)}}}function ab(a){this["in"]=function(a,c){console.log(a);c?this.append(this.createTextNode("span","blue",a)):this.append(this.createTextNode("p","blue",a))};this.out=function(a,c){console.log(a);c?this.append(this.createTextNode("span","red",
a)):this.append(this.createTextNode("p","red",a))};this.err=function(a,c){console.log(a);c?this.append(this.createTextNode("span","red",a)):this.append(this.createTextNode("p","red",a))};this.createTextNode=function(a,c,q){return"undefined"!==typeof document?(a=document.createElement(a),a.appendChild(document.createTextNode(q)),a.style.color=c,a):q+"\n"}}function Ya(){var a=this,h,c=document.createElement("div"),q;c.innerHTML='<div id="console" style="border-top: 1px solid #333333; bottom: 0px; position: absolute; width: 100%;"><div id="log" style="height: 150px; overflow-y: auto;"></div><input id="cmd" type="text" style="box-sizing: border-box; height: 30px; width: 100%;"></div>';
document.body.appendChild(c);h=document.getElementById("cmd");q=document.getElementById("log");h.onkeydown=function(c){13===c.keyCode&&""!==h.value&&(a["in"](h.value),c=r.parse$1([w.wrap(h.value)],[]),c=A(c),console.log(Q(c)),"undefined"!==c.ctype&&ha.out(Q(c)),h.value="",q.scrollTop=q.scrollHeight)};this.append=function(a){q.appendChild(a)};this.clear=function(){q.innerHTML=""}}function Za(a){var h=a;"string"===typeof a&&(h=document.getElementById(a));this.append=function(a){h.appendChild(a)};this.clear=
function(){h.innerHTML=""}}function ma(){this.append=function(a){};this.clear=function(){}}function J(a,h,c,q){void 0===q&&(q=!1);ib.push(function(){a.removeEventListener(h,c,q)});a.addEventListener(h,c,q)}function Yb(a,h){function c(c){var h=a.getBoundingClientRect();c=z.to(c.clientX-h.left-a.clientLeft+.5,c.clientY-h.top-a.clientTop+.5);W.prevx=W.x;W.prevy=W.y;W.x=c[0];W.y=c[1];ra[0]=W.x;ra[1]=W.y;e()}function q(a){for(var c=a.changedTouches,h=!1,q=0;q<c.length;q++)c[q].identifier===T&&(h=!0);h&&
(T=-1,W.down=!1,da=void 0,A(P.mouseup),pb("mouseup"),e(),a.preventDefault())}var b=null;"undefined"!==typeof MutationObserver&&(b=MutationObserver);b||"undefined"===typeof WebKitMutationObserver||(b=WebKitMutationObserver);b?(b=new b(function(c){document.body.contains(a)||Ma()}),b.observe(document.documentElement,{childList:!0,subtree:!0}),ib.push(function(){b.disconnect()})):(J(a,"DOMNodeRemovedFromDocument",Ma),J(a,"DOMNodeRemoved",Ma));if(!0===h.keylistener)J(document,"keydown",function(a){C(a,
P.keydown);return!1}),J(document,"keyup",function(a){C(a,P.keyup);return!1}),J(document,"keypress",function(a){C(a,P.keytyped);return!1});else if(P.keydown||P.keyup||P.keytyped)a.setAttribute("tabindex","0"),J(a,"mousedown",function(){a.focus()}),J(a,"keydown",function(a){9!==a.keyCode&&(C(a,P.keydown),P.keytyped||a.preventDefault())}),J(a,"keyup",function(a){C(a,P.keyup);a.preventDefault()}),J(a,"keypress",function(a){9!==a.keyCode&&(C(a,P.keytyped),a.preventDefault())});J(a,"mousedown",function(a){W.button=
a.which;c(a);A(P.mousedown);pb("mousedown");W.down=!0;a.preventDefault()});J(a,"mouseup",function(a){W.down=!1;da=void 0;A(P.mouseup);pb("mouseup");e();a.preventDefault()});J(a,"mousemove",function(a){c(a);W.down?A(P.mousedrag):A(P.mousemove);pb("mousemove");a.preventDefault()});J(a,"click",function(a){c(a);A(P.mouseclick);a.preventDefault()});J(a,"dragenter",function(a){a.preventDefault()});J(a,"dragover",function(a){a.preventDefault()});J(a,"drop",function(c){function h(a,c){function g(){e.readyState===
XMLHttpRequest.DONE&&(200!==e.status?(console.error("GET request for "+a+" failed: "+(e.responseText||"(no error message)")),d(c,k)):b(c,e.responseText))}var T=a.replace(/[?#][^]*/,""),T=T.replace(/[^]*\/([^\/])/,"$1");f[c]={type:"",name:T};var e=new XMLHttpRequest;e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE)if(200!==e.status)console.error("HEAD request for "+a+" failed: "+(e.responseText||"(no error message)")),d(c,k);else{var h=e.getResponseHeader("Content-Type");f[c].type=
h;/^image\//.test(h)?na(c,a):q(h)?(e=new XMLHttpRequest,e.onreadystatechange=g,e.open("GET",a),e.send()):d(c,k)}};e.open("HEAD",a);e.send()}function q(a){a=a.replace(/;[^]*/,"");return/^text\//.test(a)?1:"application/json"===a?2:0}function b(a,c){switch(q(f[a].type)){case 1:d(a,w.string(c));break;case 2:var h,na;try{h=JSON.parse(c),na=w.wrapJSON(h)}catch(g){console.error(g),na=k}d(a,na);break;default:d(a,k)}}function na(a,c){var h=new Image,q=!1;h.onload=function(){q||(q=!0,d(a,pa(h)))};h.onerror=
function(c){q||(q=!0,console.error(c),d(a,k))};h.src=c}function d(a,c,h){l[a]=g.turnIntoCSList([c,w.string(h||c.ctype),w.string(f[a].type),w.string(f[a].name)]);0===--m&&(a=p,kc=g.turnIntoCSList(l),lc=a,A(P.ondrop),lc=kc=k,e())}c.preventDefault();var T=c.dataTransfer,f=T.files,l=Array(f.length),m=f.length,n=c.currentTarget.getBoundingClientRect(),p=g.realVector(z.to(c.clientX-n.left-a.clientLeft+.5,c.clientY-n.top-a.clientTop+.5));if(0<f.length)Array.prototype.forEach.call(f,function(a,c){var h=new FileReader;
q(a.type)?(h.onload=function(){b(c,h.result)},h.readAsText(a)):/^image\//.test(a.type)?(h.onload=function(){na(h.result)},h.readAsDataURL(a)):(console.log("Unknown MIME type: "+a.type),d(c,k))});else if(c=T.getData("text/uri-list"))c=c.split("\n").filter(function(a){return!/^\s*(#|$)/.test(a)}),m=c.length,l=Array(m),f=Array(m),c.forEach(h)});var T=-1;J(a,"touchstart",function(a){if(-1===T){var h=a.changedTouches;0!==h.length&&(T=h[0].identifier,c(a.targetTouches[0]),A(P.mousedown),W.down=!0,pb("mousedown"),
a.preventDefault())}},!1);J(a,"touchmove",function(a){for(var h=a.changedTouches,q=!1,b=0;b<h.length;b++)h[b].identifier===T&&(q=!0);q&&(c(a.targetTouches[0]),W.down?A(P.mousedrag):A(P.mousemove),pb("mousemove"),a.preventDefault())},!0);J(a,"touchend",q,!1);"undefined"!==typeof document&&document.body&&J(document.body,"touchcancel",q,!1);"undefined"!==typeof window&&J(window,"resize",function(){Ob(function(){G();e()})},!1);d(a.parentNode);e()}function b(a,h){var c=document.createElement("div");c.setAttribute("style",
h);a.appendChild(c);return c}function d(a){function h(){q.scrollLeft=q.scrollTop=na.scrollLeft=na.scrollTop=1E5}function c(){if(d!==a.clientWidth||g!==a.clientHeight)d=a.clientWidth,g=a.clientHeight,f||(f=!0,Ob(function(){f=!1;G();e()}));h()}if("undefined"!==typeof document){var q=b(a,"position: absolute; transition: 0s; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;");b(q,"position: absolute; transition: 0s; left: 0; top: 0; width: 100000px; height: 100000px");
var na=b(a,"position: absolute; transition: 0s; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;");b(na,"position: absolute; transition: 0s; left: 0; top: 0; width: 200%; height: 200%");h();var d=a.clientWidth,g=a.clientHeight,f=!1;q.addEventListener("scroll",c);na.addEventListener("scroll",c)}}function e(){mc||(mc=Ob(m))}function m(){mc=null;if(!jc){if(Va){var a=Date.now(),h=Math.min(50,a-hc)*Pc*Qd;hc=a;a=Bb+h;ic&&"undefined"!==typeof qa&&qa.tick(h);Bb=a;Va&&
A(P.tick)}p();Va&&e()}}function p(){z.reset();y.save();y.clearRect(0,0,ca,ba);var a=z.drawingstate.matrix,h,c,q,b,d;if(0!==Ua){y.beginPath();y.strokeStyle="rgba(0,0,0,0.1)";y.lineWidth=1;y.lineCap="butt";h=Ua*a.a;for(b=Math.ceil(-a.tx/h);(d=b*h+a.tx)<ca;){if(b||!yb)y.moveTo(d,0),y.lineTo(d,ba);b++}for(b=Math.floor(a.ty/h);(d=b*h-a.ty)<ba;){if(b||!yb)y.moveTo(0,d),y.lineTo(ca,d);b++}y.stroke()}if(0!==ac){y.beginPath();y.strokeStyle="rgba(0,0,0,0.1)";y.lineWidth=1;y.lineCap="butt";h=ac*a.a;var e=Math.sqrt(3);
c=a.ty/e;q=(ba+a.ty)/e;for(b=Math.ceil(-(a.tx+q)/h);(d=b*h+a.tx)+c<ca;)y.moveTo(d+c,0),y.lineTo(d+q,ba),b++;for(b=Math.ceil(-(a.tx-c)/h);(d=b*h+a.tx)-q<ca;)y.moveTo(d-c,0),y.lineTo(d-q,ba),b++;h*=.5*e;for(b=Math.floor(a.ty/h);(d=b*h-a.ty)<ba;){if(b||!yb)y.moveTo(0,d),y.lineTo(ca,d);b++}y.stroke()}yb&&(y.beginPath(),y.strokeStyle="rgba(0,0,0,0.2)",y.lineWidth=3,y.lineCap="butt",y.lineJoin="miter",y.miterLimit=10,y.beginPath(),y.moveTo(0,-a.ty),y.lineTo(ca-6,-a.ty),y.moveTo(ca-13,-5-a.ty),y.lineTo(ca-
3,-a.ty),y.lineTo(ca-13,5-a.ty),y.moveTo(a.tx,ba),y.lineTo(a.tx,6),y.moveTo(a.tx-5,13),y.lineTo(a.tx,3),y.lineTo(a.tx+5,13),y.stroke());Rd();z.greset();Sd();for(a=0;a<v.polygons.length;a++)h=v.polygons[a],h.isshowing&&!1!==h.visible&&(c={color:h.color,alpha:h.alpha,fillcolor:h.fillcolor,fillalpha:h.fillalpha,size:h.size,lineJoin:w.string("miter"),fillrule:w.string(h.fillrule)},E.drawpolygon([h.vertices],c,"D",!0));for(a=0;a<v.conics.length;a++)v.conics[a].isArc?(h=v.conics[a],h.isshowing&&!1!==h.visible&&
(c={},c.color=h.color,c.alpha=h.alpha,c.size=h.size,E.drawarc(h,c,h.filled?"F":"D"))):(h=v.conics[a],h.isshowing&&!1!==h.visible&&(c={},c.color=h.color,c.alpha=h.alpha,c.size=h.size,E.drawconic(h.matrix,c)));for(a=0;a<v.lines.length;a++)a:if(h=v.lines[a],h.isshowing&&!1!==h.visible&&g._helper.isAlmostReal(h.homog))if("S"===h.kind)c={overhang:h.overhang,dashtype:h.dashtype,size:h.size,color:h.color,alpha:h.alpha,arrow:h.arrow,arrowsize:h.arrowsize,arrowposition:h.arrowposition,arrowshape:h.arrowshape,
arrowsides:h.arrowsides},0<=l.mult(h.startpos.value[2],l.conjugate(h.endpos.value[2])).value.real?r.draw$2([h.startpos,h.endpos],c):(x.handleModifs(c,x.lineModifs),x.drawRaySegment(h.startpos,h.endpos));else if("end"===h.clip.value&&"Join"===h.type)b=v.csnames[h.args[0]],c=v.csnames[h.args[1]],r.draw$2([b.homog,c.homog],{overhang:h.overhang,dashtype:h.dashtype,size:h.size,color:h.color,alpha:h.alpha});else{if("inci"===h.clip.value){b=[1E6,0];c=[-1E6,0];d=[1E6,0];q=[-1E6,0];for(e=0;e<h.incidences.length;e++){var f=
v.csnames[h.incidences[e]].homog,k=f.value[0],m=f.value[1],n=f.value[2];l._helper.isAlmostZero(n)||(k=l.div(k,n),m=l.div(m,n),l._helper.isAlmostReal(k)&&l._helper.isAlmostReal(m)&&(k.value.real<b[0]&&(b=[k.value.real,f]),k.value.real>c[0]&&(c=[k.value.real,f]),m.value.real<d[0]&&(d=[m.value.real,f]),m.value.real>q[0]&&(q=[m.value.real,f])))}c[0]-b[0]>q[0]-d[0]?(b=b[1],c=c[1]):(b=d[1],c=q[1]);if(b!==c){r.draw$2([b,c],{dashtype:h.dashtype,size:h.size,color:h.color,alpha:h.alpha,overhang:h.overhang});
break a}}r.draw$1([h.homog],{dashtype:h.dashtype,size:h.size,color:h.color,alpha:h.alpha})}for(a=0;a<v.points.length;a++)h=v.points[a],h.isshowing&&!1!==h.visible&&g._helper.isAlmostReal(h.homog)&&(c=h.color,h.behavior&&(c=h.color),r.draw$1([h.homog],{size:h.size,color:c,alpha:h.alpha}),h.labeled&&!h.tmp&&(c=h.printname||h.name||"P",q=h.labelpos||{x:3,y:3},b=h.textsize||ja.textsize,d=!0===h.textbold,e=!0===h.textitalics,f=h.text_fontfamily||ja.fontFamily,k=q.x*q.x+q.y*q.y,m=1,0<k&&(m=1+h.size.value.real/
Math.sqrt(k)),E.drawtext([h.homog,w.wrap(c)],{x_offset:w.wrap(m*q.x),y_offset:w.wrap(m*q.y),size:w.wrap(b),bold:w.wrap(d),italics:w.wrap(e),family:w.wrap(f)})));for(a=0;a<v.texts.length;a++)Td(v.texts[a]);y.restore()}function C(a,h){var c=window.event?event:a,c=c.charCode?c.charCode:c.keyCode;Rc=String.fromCharCode(c);Sc=c;A(h);e()}function u(a){var h=a.value;a=h[0].value;var c=h[1].value,h=h[2].value;return g.turnIntoCSList([a[0],l.add(a[1],c[0]),l.add(a[2],h[0]),c[1],l.add(c[2],h[1]),h[2]])}function B(a){var h=
!0;return function(c,q){h&&(console.error("Operator "+a+" is not supported yet."),h=!1);return k}}function Q(a){if("undefined"===typeof a)return"_??_";if(null===a)return"_???_";if("undefined"===a.ctype)return"___";if("number"===a.ctype)return l.niceprint(a);if("string"===a.ctype||"boolean"===a.ctype)return a.value;if("list"===a.ctype){for(var h="[",c=0;c<a.value.length;c++)h+=Q(A(a.value[c])),c!==a.value.length-1&&(h+=", ");return h+"]"}return"dict"===a.ctype?Fa.niceprint(a):"function"===a.ctype?
"FUNCTION":"infix"===a.ctype?"INFIX":"modifier"===a.ctype?a.key+"->"+Q(a.value):"shape"===a.ctype?a.type:"error"===a.ctype?"Error: "+a.message:"variable"===a.ctype?Q(K.getvar(a.name)):"geo"===a.ctype?a.value.name:"image"===a.ctype?"IMAGE":"_?_"}function mb(a,h){var c="undefined"===a[0].ctype,q="undefined"===a[1].ctype,b=A(a[1]);if(c||q)return k;"variable"===a[0].ctype?K.setvar(a[0].name,b):"infix"===a[0].ctype?"_"===a[0].oper?E.assigntake(a[0],b):console.error("Can't use infix expression as lvalue"):
"field"===a[0].ctype?E.assigndot(a[0],b):"function"===a[0].ctype&&"genList"===a[0].oper?"list"===b.ctype?E.assignlist(a[0].args,b.value):console.error("Expected list in rhs of assignment"):console.error("Left hand side of assignment is not a recognized lvalue");return b}function nb(a,h){var c=A(a[0]),q=A(a[1]);if(c.ctype===q.ctype){if("number"===c.ctype)return w.bool(c.value.real===q.value.real&&c.value.imag===q.value.imag);if("string"===c.ctype||"boolean"===c.ctype)return w.bool(c.value===q.value);
if("list"===c.ctype)return g.equals(c,q);if("geo"===c.ctype)return w.bool(c.value===q.value)}return{ctype:"boolean",value:!1}}function Ic(a,h){return w.not(nb(a,h))}function Xb(a,h){var c=D(a[0]),q=D(a[1]);return"number"===c.ctype&&"number"===q.ctype?{ctype:"boolean",value:l._helper.isAlmostEqual(c,q)}:"string"===c.ctype&&"string"===q.ctype||"boolean"===c.ctype&&"boolean"===q.ctype?{ctype:"boolean",value:c.value===q.value}:"list"===c.ctype&&"list"===q.ctype?g.almostequals(c,q):{ctype:"boolean",value:!1}}
function V(a,h){var c=D(a[0]),q=D(a[1]);return"boolean"===c.ctype&&"boolean"===q.ctype?{ctype:"boolean",value:c.value&&q.value}:k}function Jc(a,h){var c=D(a[0]),q=D(a[1]);return"boolean"===c.ctype&&"boolean"===q.ctype?{ctype:"boolean",value:c.value||q.value}:k}function Kc(a,h){var c=a[0];"void"!==c.ctype&&(c=D(c));var q=D(a[1]),b=w.add(c,q);"Angle"===c.usage&&"Angle"===q.usage&&(b=w.withUsage(b,"Angle"));return b}function Zb(a,h){var c=a[0];"void"!==c.ctype&&(c=D(c));var q=D(a[1]),b=w.sub(c,q);"Angle"===
c.usage&&"Angle"===q.usage&&(b=w.withUsage(b,"Angle"));return b}function Lc(a,h){var c=D(a[0]),q=D(a[1]),b=w.mult(c,q);"Angle"!==c.usage||q.usage?"Angle"!==q.usage||c.usage||(b=w.withUsage(b,"Angle")):b=w.withUsage(b,"Angle");return b}function Mc(a,h){var c=D(a[0]),q=D(a[1]);"number"===q.ctype&&l._helper.isZero(q)&&ha.err("WARNING: Division by zero!");var b=w.div(c,q);"Angle"!==c.usage||q.usage?"Angle"!==q.usage||c.usage||(b=w.withUsage(b,"Angle")):b=w.withUsage(b,"Angle");return b}function Nc(a,
h){var c=D(a[0]),q=D(a[1]);return"number"===c.ctype&&"number"===q.ctype?l.pow(c,q):k}function Tc(a,h){var c=L(a[0]),q=L(a[1]);if(c!==k&&q!==k){var b=g.cross(c,q);"Point"===c.usage&&"Point"===q.usage&&(b=w.withUsage(b,"Line"));"Line"===c.usage&&"Line"===q.usage&&(b=w.withUsage(b,"Point"));return b}return k}function nc(a){var h=a.length;if(0===h)return[];if(1===h)return[0];if(2===h)return a[0][0]+a[1][1]<=a[0][1]+a[1][0]?[0,1]:[1,0];if(4<h)return Ud(a);for(var c=Vd[h],q=Number.POSITIVE_INFINITY,b=c[0],
d=0;d<c.length;++d){for(var g=c[d],e=0,f=0;f<h;++f)e+=a[f][g[f]];e<q&&(q=e,b=g)}return b}function Ud(a){function h(){return{matched:-1,prev:-1,start:-1,cost:0,used:!1,leaf:!1}}function c(a){for(var h=0;h<d;++h)0<k[a][h]||l[h].used||(l[h].used=!0,c(l[h].matched))}function q(a){for(var c=0;c<d;++c)0<k[c][a]||f[c].used||(f[c].used=!0,q(f[c].matched))}var b=Math.abs,d=a.length,g,e,f=Array(d),l=Array(d),k=Array(d);for(g=0;g<d;++g)k[g]=Array(d);for(g=0;g<d;++g)for(f[g]=h(),l[g]=h(),f[g].cost=a[g][0],e=
1;e<d;++e)f[g].cost>a[g][e]&&(f[g].cost=a[g][e]);for(;;){for(g=0;g<d;++g)for(e=0;e<d;++e)k[g][e]=a[g][e]-f[g].cost-l[e].cost,k[g][e]<1E-14*(b(a[g][e])+b(f[g].cost)+b(l[e].cost))&&(k[g][e]=0);for(g=0;g<d;++g)f[g].matched=l[g].matched=-1;for(var m=0;;){for(g=0;g<d;++g)f[g].used=f[g].leaf=l[g].used=l[g].leaf=!1,-1===f[g].matched&&(f[g].start=g,f[g].used=f[g].leaf=!0,f[g].prev=-1);for(var n=!1,p=!1;!p;){for(g=0;g<d;++g)if(f[g].leaf)for(f[g].leaf=!1,e=0;e<d;++e)if(!(l[e].used||0<k[g][e])&&f[g].matched!==
e&&(l[e].prev=g,l[e].start=f[g].start,l[e].used=l[e].leaf=!0,-1===l[e].matched)){f[l[e].start].prev=e;n=!0;break}if(n)break;p=!0;for(e=0;e<d;++e)l[e].leaf&&(l[e].leaf=!1,g=l[e].matched,f[g].used||(f[g].prev=e,f[g].start=l[e].start,f[g].used=f[g].leaf=!0,p=!1))}if(!n)break;for(n=0;n<d;++n)if(-1===f[n].matched&&-1!==f[n].prev){e=f[n].prev;do g=l[e].prev,l[e].matched=g,f[g].matched=e,e=f[g].prev;while(g!==n);++m}}if(m===d)break;for(g=0;g<d;++g)f[g].used=f[g].leaf=l[g].used=l[g].leaf=!1;for(g=0;g<d;++g)-1===
f[g].matched&&c(g);for(e=0;e<d;++e)-1===l[e].matched&&q(e);for(g=0;g<d;++g)-1===f[g].matched||f[g].used||l[f[g].matched].used||(f[g].used=!0);m=Number.POSITIVE_INFINITY;for(g=0;g<d;++g)if(!f[g].used)for(e=0;e<d;++e)l[e].used||m>k[g][e]&&(m=k[g][e]);for(g=0;g<d;++g)f[g].used||(f[g].cost+=m),l[g].used&&(l[g].cost-=m)}a=Array(d);for(g=0;g<d;++g)e=f[g].matched,a[g]=e;return a}function oc(a,h){var c=A(a[0]),q=D(a[1]);"string"!==c.ctype&&(c=g.asList(c));if("number"===q.ctype){q=Math.floor(q.value.real);
0>q&&(q=c.value.length+q+1);if(0<q&&q<c.value.length+1)return"list"===c.ctype?c.value[q-1]:{ctype:"string",value:c.value.charAt(q-1)};ha.err("WARNING: Index out of range!");return k}if("list"===q.ctype){for(var b=[],d=0;d<q.value.length;d++){var e=D(q.value[d]);b[d]=oc([c,e],[])}return g.turnIntoCSList(b)}return k}function Uc(a,h){var c=A(a[0]),q=A(a[1]);if("shape"===c.ctype&&"shape"===q.ctype)return E.shapeconcat(c,q);c=g.asList(c);q=g.asList(q);return"list"===c.ctype&&"list"===q.ctype?g.concat(c,
q):k}function Vc(a,h){var c=A(a[0]),q=A(a[1]);return"list"===c.ctype&&"list"===q.ctype?g.set(g.common(c,q)):"shape"===c.ctype&&"shape"===q.ctype?E.shapecommon(c,q):k}function Wc(a,h){var c=A(a[0]),q=A(a[1]);return"list"===c.ctype&&"list"===q.ctype?g.remove(c,q):"shape"===c.ctype&&"shape"===q.ctype?E.shaperemove(c,q):k}function Xc(a,h){var c=A(a[0]),q=A(a[1]);return"list"===c.ctype?g.append(c,q):k}function Yc(a,h){var c=A(a[0]),q=A(a[1]);return"list"===q.ctype?g.prepend(c,q):k}function pc(a,h){a|=
0;h|=0;if(0===a&&0===h)return 0;for(;0!==h;){var c=a;a=h;h=c%h|0}return a}function Wd(a){return 1===a?0:1}function Zc(a,h,c,q,b,d,g){if(-1!==h.indexOf("\n")){var e=Infinity,f=-Infinity,l=Infinity,k=-Infinity;h.split("\n").forEach(function(h){h=Zc(a,h,c,q,b,d);e>h.left&&(e=h.left);f<h.right&&(f=h.right);l>h.top&&(l=h.top);k<h.bottom&&(k=h.bottom);q+=g});return{left:e,right:f,top:l,bottom:k}}var m=a.measureText(h);a.fillText(h,c-m.width*b,q);return{left:c-m.width*b,right:c+m.width*(1-b),top:q-.84*d,
bottom:q+.36*d}}function Pa(a){return"image"===a.ctype?a.value:"string"===a.ctype&&bb.hasOwnProperty(a.value)?bb[a.value].value:null}function qb(a,h,c,q,b){var d=[];if(a.readPixels)d=a.readPixels(h,c,q,b);else{var g,e;if(a.img.getContext)e=a.img.getContext("2d"),g=e.getImageData(h,c,q,b).data;else try{Cb||(Cb=document.createElement("canvas")),Cb.width=q,Cb.height=b,e=Cb.getContext("2d"),e.drawImage(a.img,h,c,q,b,0,0,q,b),g=e.getImageData(0,0,q,b).data}catch(f){console.log(f)}for(var l in g)d.push(g[l]/
255)}return d}function $c(a){return a.replace(/[^A-Za-z0-9 \u0080-\uffff]/ig,"\\$&")}function fa(a,h,c){var q=a;h&&(q=q+" at "+h.row+":"+h.col);c&&(q=q+": \u2018"+c+"\u2019");q=Error(q);q.name="CindyScriptParseError";q.description=a;q.location=h;q.text=c;return q}function jb(a){this.input=a;this.re=new RegExp(ad,"g");for(var h=[],c=a.indexOf("\n")+1;c;)h.push(c),c=a.indexOf("\n",c)+1;h.push(a.length);this.bols=h;this.bol=this.pos=0;this.line=1}function Pb(a){var h=a[a.length-2],c=a[a.length-3],q=
a[a.length-1];if(c){if(c.isSuperscript&&h.precedence<=c.precedence)throw fa("Operator not allowed after superscript",h.start,h.text);if(q){if(!h.op.infix)throw fa("Operator may not be used infix",h.start,h.text);}else if(!h.op.postfix)throw fa("Operator may not be used postfix",h.start,h.text);}else if(q){if(!h.op.prefix)throw fa("Operator may not be used prefix",h.start,h.text);}else if(!h.op.bare)throw fa("Operator without operands",h.start,h.text);h.ctype="infix";h.oper=h.op.sym;h.args=[c,q];a.splice(a.length-
3,3,h)}function bd(a,h,c,q){a.length&1||a.push(null);for(c=va[c];3<=a.length&&a[a.length-2].precedence<=c.precedence;)Pb(a);a.push({op:c,precedence:c.precedence+(c.rassoc?1:0),start:h.start,end:h.end,text:h.text,rawtext:h.rawtext});c="";for(var b=h.text,d=0;d<b.length;++d)c+="0123456789+-".charAt(q.indexOf(b.charAt(d)));h.ctype="number";h.value={real:+c,imag:0};a.push(h);Pb(a)}function cd(a,h){var c=[],q;a:for(;;)switch(q=a.next(),q.toktype){case "OP":var b=va[q.text];"_"!==b.sym||!c.length||c.length&
1||"OP"!==c[c.length-1].toktype||":="!==c[c.length-1].op.sym||(c.pop(),b=va[":=_"],q.text=b.sym);q.op=b;q.precedence=b.precedence;for(c.length&1||c.push(null);3<=c.length&&c[c.length-2].precedence<=q.precedence;)Pb(c);b.rassoc&&q.precedence++;c.push(q);break;case "ID":q.ctype="variable";q.name=q.text;if(c.length&1)throw fa("Missing operator",q.start,q.text);c.push(q);break;case "NUM":q.ctype="number";q.value={real:+q.text,imag:0};if(c.length&1)throw fa("Missing operator",q.start,q.text);c.push(q);
break;case "STR":q.ctype="string";q.value=q.raw.substring(1,q.raw.length-1);if(c.length&1)throw fa("Missing operator",q.start,q.text);c.push(q);break;case "SUB":bd(c,q,"_","\u2080\u2081\u2082\u2083\u2084\u2085\u2086\u2087\u2088\u2089\u208a\u208b");break;case "SUP":bd(c,q,"^","\u2070\u00b9\u00b2\u00b3\u2074\u2075\u2076\u2077\u2078\u2079\u207a\u207b");c[c.length-1].isSuperscript=!0;break;case "BRA":b="[](){}||".indexOf(q.text);if(q.text===h||b&1)break a;var b="[](){}||".charAt(b+1),d=cd(a,b),g=d.closedBy;
if(g.text!==b)throw fa("Opening "+q.text+" at "+q.start.row+":"+q.start.col+" closed by "+(g.text||"EOF")+" at "+g.start.row+":"+g.start.col);g=q.text+g.text;b=[];if(d=d.expr){for(;d&&"infix"===d.ctype&&","===d.oper;)b.push(d.args[0]),d=d.args[1];b.push(d)}if(c.length&1){if("{}"===g)throw fa("{\u2026} reserved for future use",q.start);d=c[c.length-1];if("variable"!==d.ctype)throw fa("Function name must be an identifier",d.start);if(2<c.length&&c[c.length-2].precedence<dd)throw fa("Function call in indexing construct must be enclosed in parentheses",
q.start);d.ctype="function";q=d.args=[];for(var g=d.modifs={},e=0;e<b.length;++e){var f=b[e];if(f&&"infix"===f.ctype&&"->"===f.oper){var l=f.args[0];if("variable"!==l.ctype)throw fa("Modifier name must be an identifier",f.start);g[l.name]=f.args[1]}else q.push(f)}d.oper=d.name.toLowerCase()+"$"+d.args.length}else if("||"===g)if(1===b.length)c.push({ctype:"function",oper:"abs_infix",args:b,modifs:{}});else if(2===b.length)c.push({ctype:"function",oper:"dist_infix",args:b,modifs:{}});else throw fa("Don't support |\u2026| with "+
b.length+" arguments",q.start);else{if("{}"===g)throw fa("{\u2026} reserved for future use",q.start);"[]"!==g&&1===b.length?c.push({ctype:"paren",args:b}):0===b.length?c.push({ctype:"list",value:[]}):c.push({ctype:"function",oper:"genList",args:b,modifs:{}})}break;case "EOF":break a}for(c.length&1||c.push(null);3<=c.length;)Pb(c);return{expr:c[0],closedBy:q}}function Db(a){this.usedFunctions={};this.usedVariables={}}function A(a){if(void 0===a)return k;if("infix"===a.ctype)return a.impl(a.args,{},
a);if("variable"===a.ctype)return A(K.getvar(a.name));if("function"===a.ctype)return E.evaluate(a.oper,a.args,a.modifs);if("void"===a.ctype)return k;if("field"===a.ctype){var h=A(a.obj);return"geo"===h.ctype?wa.getField(h.value,a.key):"list"===h.ctype?g.getField(h,a.key):k}return a}function D(a){a=A(a);if("geo"===a.ctype){var h=a.value;if("P"===h.kind)return wa.getField(h,"xy");if("V"===h.kind)return h.value}return a}function L(a){a=A(a);if("geo"===a.ctype){var h=a.value;if("P"===h.kind||"L"===h.kind)return wa.getField(h,
"homog")}return g._helper.isNumberVecN(a,3)?a:g._helper.isNumberVecN(a,2)?(h=g.turnIntoCSList([a.value[0],a.value[1],l.real(1)]),a.usage&&(h=w.withUsage(h,a.usage)),h):k}function Na(a){var h=new Db;h.usedFunctions=Oc;h.infixmap=O;a=h.parse(a);for(var c in h.usedVariables)K.create(c);return a}function ed(){this._path=[];this._defs=["<defs>"];this._imgcache=[];this._body=[];this._saveStack=[""];this._clipIndex=0;this._stroke=this._fill="#000";this._strokeOpacity=this._fillOpacity=null;this.height=this.width=
0;this.lineWidth=1;this.lineCap="butt";this.lineJoin="miter";this.miterLimit=10;this.globalAlpha=1}function fd(){this._body=[];this._yPos=this._xPos=NaN;this._extGState={Af255:"<< /ca 1 >>",As255:"<< /CA 1 >>"};this._objects=[["%PDF-1.4\n"]];this._offset=this._objects[0][0].length;this._nextIndex=5;this._imgcache=[];this._xobjects={};this._pathUsed=-1;this._fillAlpha=this._strokeAlpha=this._globalAlpha=1;this.height=this.width=0;this.lineWidth=1;this.lineCap="butt";this.lineJoin="miter";this.miterLimit=
10}function gd(a,h){var c=a.width,q=a.height,b=document.createElement("canvas");b.setAttribute("width",c);b.setAttribute("height",q);b.setAttribute("style","display:none;");var d=oa.canvas;d.parentNode.insertBefore(b,d.nextSibling);try{return b.getContext("2d").drawImage(a,0,0,c,q),b.toDataURL(h||"image/png")}finally{b.parentNode.removeChild(b)}}function Xd(a){a=a.replace(RegExp("[^ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/]+","g"),"");var h=new Uint8Array(3*a.length>>2),c,q,
b,d,g,e;for(q=c=0;c+3<a.length;c+=4)b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c)),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c+1)),g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c+2)),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c+3)),h[q++]=b<<2|d>>4,h[q++]=d<<4|g>>2,h[q++]=g<<6|e;switch(a.length-c){case 0:break;case 2:b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c));
d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c+1));h[q++]=b<<2|d>>4;break;case 3:b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c));d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c+1));g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c+2));h[q++]=b<<2|d>>4;h[q++]=d<<4|g>>2;break;default:throw Error("Malformed Base64 input: "+(a.length-c)+" chars left: "+
a.substr(c));}if(q!==h.length)throw Error("Failed assertion: "+q+" should be "+h.length);return h}function Yd(a){function h(c){return(a[c]<<24|a[c+1]<<16|a[c+2]<<8|a[c+3])>>>0}if(57>a.length)throw Error("Too short to be a PNG file");if(2303741511!==h(0)||218765834!==h(4))throw Error("PNG signature missing");for(var c=[],q=8;q<a.length;){if(q+12>a.length)throw Error("Incomplete chunk at offset 0x"+q.toString(16));var b=h(q);if(2147483648<=b)throw Error("Chunk too long");var d=q+12+b;if(d>a.length)throw Error("Incomplete chunk at offset 0x"+
q.toString(16));var g=a.subarray(q+4,q+8),g=String.fromCharCode.apply(String,g);c.push({len:b,type:g,data:a.subarray(q+8,q+8+b),crc:h(q+8+b)});q=d}return c}function Qb(a,h){var c;if(c=/^rgba\(([0-9]+), *([0-9]+), *([0-9]+), *([0-9]+)\)$/.exec(a))h(+c[1],+c[2],+c[3],+c[4]);else if(c=/^rgb\(([0-9]+), *([0-9]+), *([0-9]+)\)$/.exec(a))h(+c[1],+c[2],+c[3],1);else throw Error("Can't handle color style "+a);}function Zd(a){var h=1;Object.keys(bb).forEach(function(c){var q=bb[c].value.img;if(void 0===q.cachedDataURL&&
q.src)if("data:"===q.src.substr(0,5))q.cachedDataURL=q.src;else{++h;q.cachedDataURL=null;var b=new XMLHttpRequest;b.responseType="blob";b.onreadystatechange=function(){if(b.readyState===XMLHttpRequest.DONE)if(200===b.status){var c=new FileReader;c.onloadend=function(){q.cachedDataURL=c.result;console.log("Cached data for image "+q.src);0===--h&&a()};c.readAsDataURL(b.response)}else console.error("Failed to load "+q.src+": "+b.statusText),0===--h&&a()};b.open("GET",q.src,!0);b.send()}});0===--h&&a()}
function kb(a,h,c){for(c||(c="0");a.length<h;)a=c+a;return a}function hd(){null!==Eb&&(window.URL.revokeObjectURL(Eb),Eb=null)}function id(a){Zd(function(){var h=y;try{y=new a;y.width=ca;y.height=ba;p();var c=y.toBlob();Eb=window.URL.createObjectURL(c);jd(Eb)}finally{y=h}})}function Fb(a){var h=null,c=1E6,q;console.log("getElementAtMouse");for(var b=0;b<v.gslp.length;b++){var d=v.gslp[b];if(!d.pinned&&!1!==d.visible&&!0!==d.tmp){var e,f,k,m=z.drawingstate.matrix.sdet;if("P"===d.kind){var n=g.normalizeZ(d.homog);
if(!g._helper.isAlmostReal(n))continue;e=n.value[0].value.real-a.x;f=n.value[1].value.real-a.y;k=Math.sqrt(e*e+f*f);d.narrow&k>20/m&&(k=1E4)}else if("C"===d.kind)f=v.csnames[d.args[0]],k=0,"undefined"!==typeof d.radius&&(k=d.radius.value.real),e=l.div(f.homog.value[0],f.homog.value[2]).value.real,f=l.div(f.homog.value[1],f.homog.value[2]).value.real,e-=a.x,f-=a.y,k=Math.sqrt(e*e+f*f)-k,f=e=0,0>k&&(k=-k),k+=30/m;else if("L"===d.kind||"S"===d.kind)e=d.homog,k=l,f=k.add(k.mult(e.value[0],k.conjugate(e.value[0])),
k.mult(e.value[1],k.conjugate(e.value[1]))),f=g.scaldiv(k.sqrt(f),e),k=f.value[0].value.real*a.x+f.value[1].value.real*a.y+f.value[2].value.real,e=f.value[0].value.real*k,f=f.value[1].value.real*k,0>k&&(k=-k),k+=1;k<c+.2/m&&(c=k,h=d,q={x:e,y:f})}}return null===h?null:{mover:h,offset:q,prev:{x:a.x,y:a.y}}}function Qa(){return"P"+$d++}function pb(a){var h=F[qc].actions;h[rb].event===a&&h[rb]["do"]()&&(e(),rb===h.length-1?(sa=[],rb=Ra=0):rb++)}function rc(a){return a&&.5>Math.abs(a.offset.x)&&.5>Math.abs(a.offset.y)&&
!a.mover.tmp}function kd(a){return rc(a)&&"P"===a.mover.kind}function ld(a){return rc(a)&&("L"===a.mover.kind||"S"===a.mover.kind)}function sc(a){da={mover:a,offset:{x:0,y:0},prev:{x:W.x,y:W.y}}}function lb(){var a=Fb(W);kd(a)?sa[Ra]=a.mover:(sa[Ra]={type:"Free",name:Qa(),labeled:!0,pos:[ra[0],ra[1],1]},Ba(sa[Ra]));Ra++}function md(){var a=Fb(W);return ld(a)?(sa[Ra]=a.mover,Ra++,!0):!1}function nd(){var a=Fb(W),h;(h=ld(a))||(h=rc(a)&&"C"===a.mover.kind);return h?(sa[Ra]=a.mover,Ra++,!0):!1}function sb(){var a=
Fb(W);if(kd(a))for(Gb.args[1]=a.mover.name,a=0;a<v.gslp.length;a++){var h=v.gslp[a];!0===h.tmp&&od(h.name)}else for(a=0;a<v.gslp.length;a++)h=v.gslp[a],!0===h.tmp&&(h.tmp=!1)}function Rb(a){var h={type:"Free",name:Qa(),labeled:!0,pos:[ra[0],ra[1],1],tmp:!0},h=Ba(h);Gb=Ba({type:a,name:Qa(),labeled:!0,args:[sa[0].name,h.name]});sc(h)}function ae(a){for(var h in a)null!==a[h]&&(ja[h]=a[h])}function Nd(a){Object.keys(n).forEach(function(a){var c=n[a];db(c.signature||"_helper"===a,a+" has no signature");
void 0!==c.updatePosition&&void 0===c.stateSize&&(c.stateSize=0)});v.gslp=[];v.csnames={};v.points=[];v.lines=[];v.conics=[];v.texts=[];v.free=[];v.polygons=[];a.forEach(pd);qd()}function rd(a){"undefined"===typeof a.tracedim&&(a.tracedim=1);"undefined"===typeof a.tracelength&&(a.tracelength=100);"undefined"===typeof a.traceskip&&(a.traceskip=1);a._traces=Array(a.tracelength);a._traces_index=0;a._traces_tick=0}function be(a){void 0===a.size&&(a.size=ja.pointSize);a.size=l.real(a.size);!a.movable||
a.pinned?(a.color=g.realVector(a.color||ja.pointColor),a.color=g.scalmult(l.real(ja.dimDependent),a.color)):a.color=g.realVector(a.color||ja.pointColor);void 0===a.alpha&&(a.alpha=ja.alpha);a.alpha=l.real(a.alpha);a.drawtrace&&rd(a)}function Sb(a){void 0===a.size&&(a.size=ja.lineSize);a.size=l.real(a.size);a.color=g.realVector(a.color||ja.lineColor);void 0===a.alpha&&(a.alpha=ja.alpha);a.alpha=l.real(a.alpha);a.clip=w.string(a.clip||ja.clip);void 0===a.overhang&&(a.overhang=ja.overhangLine);a.overhang=
l.real(a.overhang);a.dashtype&&(a.dashtype=w.wrap(a.dashtype))}function ce(a){void 0===a.overhang&&(a.overhang=ja.overhangSeg);a.arrow&&(a.arrow=w.bool(a.arrow));a.arrowsize&&(a.arrowsize=l.real(a.arrowsize));a.arrowposition&&(a.arrowposition=l.real(a.arrowposition));a.arrowshape&&(a.arrowshape=w.string(a.arrowshape));a.arrowsides&&(a.arrowsides=w.string(a.arrowsides));Sb(a);a.clip=w.string("end")}function de(a){a.size=void 0!==a.textsize?a.textsize:void 0!==a.size?a.size:ja.textsize;a.size=l.real(+a.size)}
function ee(a){a.filled=void 0!==a.filled?w.bool(a.filled):w.bool(!0);a.fillcolor=void 0===a.fillcolor?k:g.realVector(a.fillcolor);void 0===a.fillalpha&&(a.fillalpha=0);a.fillalpha=l.real(a.fillalpha);Sb(a)}function Ba(a){a=pd(a);qd();return a}function pd(a){var h;if(void 0!==v.csnames[a.name])return console.log("Element name '"+a.name+"' already exists"),h=v.csnames[a.name],n[h.type].isMovable&&"P"===n[h.type].kind&&Ca(h,a.pos,"homog"),{ctype:"geo",value:h};for(;tc.hasOwnProperty(a.type);)a.type=
tc[a.type];if(h=sd[a.type]){var c=h(a),q=null;for(h=0;h<c.length;++h)q=Ba(c[h]);return q}var b=n[a.type],c=!1;if(!b)return console.error(a),console.error("Operation "+a.type+" not implemented yet"),null;if("**"!==b.signature)if(!Array.isArray(b.signature)&&"*"===b.signature.charAt(1))c=!0,a.args.forEach(function(c){if(v.csnames[c].kind!==b.signature.charAt(0))return console.error("Not all elements in set are of same type: "+a.name+" expects "+b.signature+" but "+c+" is of kind "+v.csnames[c].kind),
"undefined"!==typeof window&&window.alert("Not all elements in set are of same type: "+a.name),null});else if(b.signature.length!==(a.args?a.args.length:0))return console.error("Wrong number of arguments for "+a.name+" of type "+a.type),"undefined"!==typeof window&&window.alert("Wrong number of arguments for "+a.name),null;if(a.args)for(h=0;h<a.args.length;++h){if(!v.csnames.hasOwnProperty(a.args[h]))return console.log("Dropping "+a.name+" due to missing argument "+a.args[h]),null;if("**"!==b.signature&&
!c&&(q=v.csnames[a.args[h]].kind,b.signature[h]!==q&&("S"!==q||"L"!==b.signature[h])))return window.alert("Wrong argument kind "+q+" as argument "+h+" to element "+a.name+" of type "+a.type),null}b.signatureConstraints&&!b.signatureConstraints(a)&&window.alert("signature constraints violated for element "+a.name);v.gslp.push(a);v.csnames[a.name]=a;h=xa.length;a.kind=b.kind;a.stateIdx=h;h+=b.stateSize;a.incidences=[];a.isshowing=!0;a.movable=!1;b.isMovable&&(a.movable=!0,v.free.push(a));"P"===a.kind&&
(v.points.push(a),be(a));"L"===a.kind&&(v.lines.push(a),Sb(a));"C"===a.kind&&(v.conics.push(a),Sb(a));"S"===a.kind&&(v.lines.push(a),ce(a));"Text"===a.kind&&(v.texts.push(a),de(a));"Poly"===a.kind&&(v.polygons.push(a),ee(a));fe(h);la=Ga=xa;eb=!0;b.initialize&&(ta=ya=a.stateIdx,a.param=b.initialize(a),db(ya===a.stateIdx+b.stateSize,"State fully initialized"));ta=ya=a.stateIdx;b.updatePosition(a,!1);db(ta===a.stateIdx+b.stateSize,"State fully consumed");db(ya===a.stateIdx+b.stateSize,"State fully updated");
eb=!1;la=cb["in"];la.set(xa);Ga=cb.out;uc(a,b);Tb={};fb(a);return v.csnames[a.name]}function od(a){var h,c;console.log("Remove element "+a);delete v.csnames[a];for(h=0;h<v.gslp.length;h++)c=v.gslp[h],c.name===a&&(console.log("Removed element from gslp "+a),v.gslp.splice(h,1));for(h=0;h<v.free.length;h++)c=v.free[h],c.name===a&&(console.log("Removed element from free "+a),v.free.splice(h,1));for(h=0;h<v.points.length;h++)c=v.points[h],c.name===a&&(console.log("Removed element from points "+a),v.points.splice(h,
1));for(h=0;h<v.lines.length;h++)c=v.lines[h],c.name===a&&(console.log("Removed element from lines "+a),v.lines.splice(h,1));for(h=0;h<v.conics.length;h++)c=v.conics[h],c.name===a&&(console.log("Removed element from conics "+a),v.conics.splice(h,1));Tb={}}function td(a,h){var c=v.csnames[h.args[0]].homog,q=v.csnames[h.args[1]].homog,b=a.homog,d=l.div(c.value[0],c.value[2]),c=l.div(c.value[1],c.value[2]),g=l.div(q.value[0],q.value[2]),q=l.div(q.value[1],q.value[2]),e=l.div(b.value[0],b.value[2]),b=
l.div(b.value[1],b.value[2]);return l._helper.isAlmostReal(d)&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(g)&&l._helper.isAlmostReal(q)&&l._helper.isAlmostReal(e)&&l._helper.isAlmostReal(b)?(d=d.value.real,c=c.value.real,g=g.value.real,q=q.value.real,e=e.value.real,b=b.value.real,d=Math.sqrt((d-g)*(d-g)+(c-q)*(c-q))-Math.sqrt((d-e)*(d-e)+(c-b)*(c-b))-Math.sqrt((g-e)*(g-e)+(q-b)*(q-b)),1E-15>d*d):!1}function uc(a,h){a.isshowing=!0;if(a.args)for(var c=0;c<a.args.length;c++)if(!v.csnames[a.args[c]].isshowing){a.isshowing=
!1;return}h.visiblecheck&&h.visiblecheck(a)}function Td(a){a._bbox=null;if(a.isshowing&&!1!==a.visible){var h={size:a.size},c=a.homog,q=a.text,b=n[a.type].getText,q=b?b(a):q.replace(/@[$#]"([^"\\]|\\.)*"/g,function(a){var c,h;try{if(c=JSON.parse(a.substring(2)),h=v.csnames[c],!h)return"?"}catch(q){return"?"}switch(a.charAt(1)){case "$":return h.printname||c;case "#":return"V"!==h.kind?"?":Q(h.value)}}),b=null;if(a.html)var d=a._textCache||{text:!1},g=a.html,e=g.parentNode,f=e.parentNode,b=function(c,
h,q,b,na){d.invisible&&f.style.removeProperty("display");if(c!==d.text||h!==d.font||q!==d.x||b!==d.y||na!==d.align){h!==d.font&&(g.style.font=h,g.style.lineHeight=ja.lineHeight);c!==d.text&&!1!==c&&!1===ud(g,c,h)&&(c=!1);f.style.left=q+"px";f.style.top=b+"px";if(na||e.style.transform)e.style.transform="translateX("+-100*na+"%)";a._textCache={text:c,font:h,x:q,y:b,align:na}}};q=w.string(q);a.dock&&(a.dock.to?c=v.csnames[a.dock.to].homog:vd.hasOwnProperty(a.dock.corner)&&(c=r.screenbounds$0([],{}),
c=c.value[vd[a.dock.corner]]),h.offset=a.dock.offset);a.align&&(h.align=w.string(a.align));c&&(a._bbox=E.drawtext([c,q],h,b))}else a.html&&(a.html.parentNode.parentNode.style.display="none",a._textCache={invisible:!0})}function Sd(){function a(){var a=e++/c._traces.length,h=c._traces[g];h&&(a*=q*a*a,r.draw$1([h],{size:l.real(b),color:c.color,alpha:l.real(a)}));b*=d}for(var h=0;h<v.points.length;h++){var c=v.points[h];if(c.drawtrace){c._traces_tick===c.traceskip?(c._traces[c._traces_index]=c.homog,
c._traces_index=(c._traces_index+1)%c._traces.length,c._traces_tick=0):c._traces_tick++;var q=c.alpha.value.real,b=c.size.value.real,d=1;1!==c.tracedim&&(b*=c.tracedim,d=Math.pow(c.tracedim,-1/c._traces.length));var g,e=0;for(g=c._traces_index;g<c._traces.length;++g)a();for(g=0;g<c._traces_index;++g)a()}}}function db(a,h){var c="Assertion failed: "+h;if(!a)throw console.log(c),Ma(),"undefined"!==typeof alert&&alert(c),Error(c);}function fe(a){if(a!==xa.length){var h,c,q=vc.length;gb.length<a*q?(h=
2*a,gb=new Float64Array(q*h)):h=gb.length/q|0;for(c=0;c<q;++c)cb[vc[c]]=gb.subarray(c*h,c*h+a);a=xa;la=cb["in"];Ga=cb.out;xa=cb.good;xa.set(a)}}function tb(){xa.set(la);Da=!1;wd(!1);for(var a=xa.length,h=Math.abs,c=0;c<a;c+=2)h(xa[c])>1E12*h(xa[c+1])&&(xa[c+1]=0)}function Ub(){if(ub)Da=!0;else throw xd;}function yd(a,h,c,q,b){return w.add(q,w.mult(c,w.sub(b,q)))}function Rd(){H&&(H.currentMouseAndScripts=[]);wc=!0;if(da){var a=da.mover,h=g.realVector([W.x+da.offset.x,W.y+da.offset.y,1]);zd(a,h,"mouse");
da.prev.x=W.x;da.prev.y=W.y}A(P.move);A(P.draw);Da||tb();wc=!1;H&&(H.fullLog.push(g.turnIntoCSList([g.turnIntoCSList(H.currentMouseAndScripts)])),H.length>H.logLength&&H.splice(0,H.length-H.logLength),H.currentMouseAndScripts=null,H.postMouseHooks.forEach(function(a){a()}))}function Ca(a,h,c){zd(a,h,c);wc||Da||tb()}function zd(a,h,c){H&&H.currentMouseAndScripts&&(H.currentMover=[]);a===Ad?(la.set(xa),Da=!1):(Ad=a,tb());Ga.set(la);var q=1E4,b;b=Tb[a.name];if(!b){var d={},e=0;b=[];d[a.name]=a;for(var f=
v.gslp,k=0;k<f.length;++k){var m=f[k],ob=m.args;if(ob)for(var p=0;p<ob.length;++p)d.hasOwnProperty(ob[p])&&(d[m.name]=m,b[e++]=m)}Tb[a.name]=b}var d=-1,e=.9,r,t,u,f=n[a.type],k=f.parameterPath||yd;ta=a.stateIdx;m=f.getParamFromState(a);ta=ya=a.stateIdx;ob=f.getParamForInput(a,h,c);for(p=d+e;d!==p;){var x=p*p,y=.5/(1+x),y=l.complex(2*p*y+.5,(1-x)*y);ub=d+.5*e<=d||0===q;0===q&&console.log("tracing limit Reached");x=!1;H&&H.currentMouseAndScripts&&(H.currentStep=[]);try{ta=ya=a.stateIdx;var z=k(a,p,
y,m,ob);H&&(H.currentParam=z);y=Ga;Ga=la;f.putParamToState(a,z);Ga=y;ya=a.stateIdx;H&&(H.currentElement=a);f.updatePosition(a,!0);db(ta===a.stateIdx+f.stateSize,"State fully consumed");db(ya===a.stateIdx+f.stateSize,"State fully updated");for(r=0;r<b.length;++r)t=b[r],u=n[t.type],ta=ya=t.stateIdx,H&&(H.currentElement=t),u.updatePosition(t,!1),db(ta===t.stateIdx+u.stateSize,"State fully consumed"),db(ya===t.stateIdx+u.stateSize,"State fully updated");H&&(H.currentElement=null);d=p;e*=1.25;p+=e;1<=
p&&(p=1);Ga=la;la=y}catch(A){if(A!==xd)throw A;e*=.5;p=d+e;--q;x=!0}H&&H.currentMouseAndScripts&&(H.currentMover.push(g.turnIntoCSList([g.turnIntoCSList(H.currentStep),w.wrap(x),w.wrap(d),w.wrap(p),w.wrap(H.currentParam)])),H.currentStep=null,H.currentParam=null)}wd(Da);for(r=0;r<b.length;++r)t=b[r],u=n[t.type],uc(t,u);H&&H.currentMouseAndScripts&&(H.currentMouseAndScripts.push(g.turnIntoCSList([g.turnIntoCSList(H.currentMover),w.wrap(Da),w.wrap(a.name),h,w.wrap(c),m,ob])),H.currentMover=null)}function Od(){tb();
ub=!0;for(var a=v.gslp,h=0;h<a.length;h++){var c=a[h],q=n[c.type];ta=ya=c.stateIdx;q.updatePosition(c,!1);uc(c,q)}a=Ga;Ga=la;la=a;tb()}function wd(a){var h=t.tracingStateReport;"string"===typeof h&&(document.getElementById(h).textContent=a?"BAD":"GOOD")}function ge(){return g.turnIntoCSList(H.fullLog.slice())}function he(a){var h=JSON.stringify(H.fullLog);a=new Blob([h],{type:a?"application/octet-stream":"application/json"});return window.URL.createObjectURL(a)}function vb(){var a=ta;ta+=2;return l.complex(la[a],
la[a+1])}function aa(a){for(var h=Array(a),c=0;c<a;++c)h[c]=vb();return g.turnIntoCSList(h)}function Sa(a){Ga[ya]=a.value.real;Ga[ya+1]=a.value.imag;ya+=2}function R(a){for(var h=0,c=a.value.length;h<c;++h)Sa(a.value[h])}function Ha(a,h){var c=aa(3),q=aa(3),c=Bd(a,h,c,q);R(c[0]);R(c[1]);return g.turnIntoCSList(c)}function Bd(a,h,c,q){if(eb)return[a,h];var b=g.projectiveDistMinScal(c,a),d=g.projectiveDistMinScal(c,h),e=g.projectiveDistMinScal(q,a),f=g.projectiveDistMinScal(q,h),l=g.projectiveDistMinScal(c,
q),m=g.projectiveDistMinScal(a,h),n=b+f,p=d+e,r;n>p?(r=[h,a],n=p):r=[a,h];p=function(){};if(H&&H.currentStep){var t=[H.labelTracing2,w.wrap(H.currentElement.name),g.turnIntoCSList(r),g.turnIntoCSList([c,q]),g.realMatrix([[b,d],[e,f]]),w.wrap(n),w.wrap(l),w.wrap(m),k];H.currentStep.push(g.turnIntoCSList(t));p=function(a){H.hasOwnProperty(a)||(H[a]=w.wrap(a));t[t.length-1]=H[a]}}g._helper.isNaN(a)||g._helper.isNaN(h)?(p("Tracing failed due to NaNs."),Da=!0):l>3*n&&m>3*n?p("Normal case, everything all right."):
1E-5>m?1E-5>l?p("Staying inside singularity."):(p("Moved into singularity."),Da=!0):1E-5>l?p("Moved out of singularity."):(ub?p("Reached refinement limit, giving up."):p("Need to refine."),Ub());return r}function xc(a,h,c,q){var b=aa(3),d=aa(3),e=aa(3),f=aa(3);a=ie(a,h,c,q,b,d,e,f);R(a[0]);R(a[1]);R(a[2]);R(a[3]);return g.turnIntoCSList(a)}function ie(a,h,c,q,b,d,e,f){var l=function(){};b=[b,d,e,f];a=[a,h,c,q];if(eb)return a;d=0;q=Array(4);for(c=0;4>c;c++)for(q[c]=Array(4),f=0;4>f;f++)e=g.projectiveDistMinScal(b[c],
a[f]),q[c][f]=e;e=nc(q);h=Array(4);for(c=0;4>c;++c)h[c]=a[e[c]],d+=q[c][e[c]];var m=1*d,n=Infinity,p=Infinity;for(c=0;4>c;c++){if(g._helper.isNaN(a[c]))return l("Tracing failed due to NaNs."),Da=!0,h;for(f=c+1;4>f;f++)e=g.projectiveDistMinScal(b[c],b[f]),n>e&&(n=e),e=g.projectiveDistMinScal(h[c],h[f]),p>e&&(p=e)}if(H&&H.currentStep){var r=[H.labelTracing4,w.wrap(H.currentElement.name),g.turnIntoCSList(h),g.turnIntoCSList(b),g.realMatrix(q),w.wrap(d),w.wrap(n),w.wrap(p),k];H.currentStep.push(g.turnIntoCSList(r));
l=function(a){H.hasOwnProperty(a)||(H[a]=w.wrap(a));r[r.length-1]=H[a]}}n>m&&p>m||(1E-5>p?1E-5>n?l("Staying inside singularity."):(l("Moved into singularity."),Da=!0):1E-5>n?l("Moved out of singularity."):(ub?l("Reached refinement limit, giving up."):l("Need to refine."),Ub()));return h}function Cd(a){var h=a.length,c,q;if(eb){for(c=0;c<h;++c)ta+=2*a[c].value.length,R(a[c]);return a}var b=Array(h),d=Array(h),e=Array(h),f=99,l=99,m=Array(h);for(c=0;c<h;++c)b[c]=aa(a[c].value.length),d[c]=g.normSquared(b[c]).value.real,
e[c]=g.normSquared(a[c]).value.real,m[c]=Array(h);var n;for(c=0;c<h;++c){for(q=0;q<h;++q)n=g.sesquilinearproduct(b[c],a[q]).value,n=(n.real*n.real+n.imag*n.imag)/(d[c]*e[q]),m[c][q]=1-n;for(q=c+1;q<h;++q)n=g.sesquilinearproduct(b[c],b[q]).value,n=(n.real*n.real+n.imag*n.imag)/(d[c]*d[q]),f>1-n&&(f=1-n),n=g.sesquilinearproduct(a[c],a[q]).value,n=(n.real*n.real+n.imag*n.imag)/(e[c]*e[q]),l>1-n&&(l=1-n)}n=nc(m);q=Array(h);d=0;e=!1;for(c=0;c<h;++c){var d=d+m[c][n[c]],p=q[c]=a[n[c]];R(p);e|=g._helper.isNaN(p)}e|=
isNaN(d);a=function(){};if(H&&H.currentStep){var r=[H.labelTracingSesq,w.wrap(H.currentElement.name),g.turnIntoCSList(q),g.turnIntoCSList(b),g.realMatrix(m),w.wrap(d),w.wrap(f),w.wrap(l),k];H.currentStep.push(g.turnIntoCSList(r));a=function(a){H.hasOwnProperty(a)||(H[a]=w.wrap(a));r[r.length-1]=H[a]}}e?(a("Tracing failed due to NaNs."),Da=!0):f>3*d&&l>3*d?a("Normal case, everything all right."):1E-5>l?1E-5>f?a("Staying inside singularity."):(a("Moved into singularity."),Da=!0):1E-5>f?a("Moved out of singularity."):
(ub?a("Reached refinement limit, giving up."):a("Need to refine."),Ub());return q}function fb(a){if(fb.hasOwnProperty(a.kind))fb[a.kind](a)}function Dd(a,h){return function(){a.incidences.push(h.name);h.incidences.push(a.name)}}function Ed(a,h){return{toString:function(){return"point "+a.name+" incident line "+h.name},apply:Dd(a,h),holds:function(){var c=g.scaldiv(g.abs(a.homog),a.homog),q=g.scaldiv(g.abs(h.homog),h.homog);return 1E-13>l.abs(g.scalproduct(c,q)).value.real}}}function Fd(a,h){return{toString:function(){return"point "+
a.name+" incident conic "+h.name},apply:Dd(a,h),holds:function(){var c=w.mult(h.matrix,a.homog),c=w.mult(a.homog,c),c=l.abs(c);1E-13>c.value.real&&(a.incidences.push(h.name),h.incidences.push(a.name))}}}function qd(){if(0!==hb.length){for(var a=0;a<hb.length;++a)hb[a].apply();hb=[]}}function yc(a,h,c){var q=document.createElement("div"),b=document.createElement("img");b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAPoCAQAAAC1v1zVAAAAGklEQVR42u3BMQEAAADCoPVPbQ0PoAAAgHcDC7gAAVI8ZnwAAAAASUVORK5CYII=";
q.className="CindyJS-baseline";q.appendChild(b);b=document.createElement("div");b.className="CindyJS-button";q.appendChild(b);for(var d=2;d<arguments.length;++d)b.appendChild(arguments[d]);ia.parentNode.appendChild(q);a.html=arguments[arguments.length-1];Aa(a.fillalpha)||(a.fillalpha=1);a.fillcolor&&(a.html.style.backgroundColor=x.makeColor(a.fillcolor,a.fillalpha));q=e;if(a.script)var g=Na(a.script),q=function(){A(g);e()};c.addEventListener(h,q);!t.keylistener&&(P.keydown||P.keyup||P.keytyped)&&
(c.addEventListener("keydown",function(a){9!==a.keyCode&&C(a,P.keydown)}),c.addEventListener("keyup",function(a){C(a,P.keyup)}),c.addEventListener("keypress",function(a){9!==a.keyCode&&C(a,P.keytyped)}));n.Text.initialize(a)}function Ja(){}function je(a){if(!/^Select/.test(a.type)&&!n[a.type].isMovable)return null;var h=w.unwrap,c=l.add;switch(a.kind){case "P":case "L":case "Text":return h(a.homog);case "C":return a=a.matrix.value,{xx:h(a[0].value[0]),yy:h(a[1].value[1]),zz:h(a[2].value[2]),xy:h(c(a[0].value[1],
a[1].value[0])),xz:h(c(a[0].value[2],a[2].value[0])),yz:h(c(a[1].value[2],a[2].value[1]))};default:return null}}function ke(a){var h={};h.offset=w.unwrap(a.offset);a.to&&(h.to=a.to);a.corner&&(h.corner=a.corner);return h}function le(a){var h={};me.forEach(function(c){if(a.hasOwnProperty(c)){var b=w.unwrap(a[c]);null!==b&&void 0!==b&&(h[c]=b)}});if("P"===a.kind&&(!a.movable||a.pinned)&&h.color){var c=l.real(1/ja.dimDependent);h.color=w.unwrap(g.scalmult(c,a.color))}if(c=je(a))h.pos=c;a.dock&&(h.dock=
ke(a.dock));return h}function ne(){var a=[];v.gslp.forEach(function(h){h.tmp||a.push(le(h))});return a}function Pd(){za.forEach(function(a){var h=(a.geo||[]).map(function(a){return v.csnames[a]});M[a.type].reset(a,h[0],h)})}function ec(a){ic=0!==a.length;za=[];ea=[];zc=[];M.Environment.init({});a.forEach(function(a){a.behavior?(a.name&&(a.behavior.geo=[a.name]),a=a.behavior,a.gravity&&(a.gravity=-a.gravity)):c=a.geo;var c=(a.geo||[]).map(function(a){return v.csnames[a]}),q=c[0],b=M[a.type];b?(b.init&&
b.init(a,q,c),q&&(q.behavior=a,"Mass"===a.type?ea.push(q):"Spring"===a.type&&zc.push(q)),za.push(a)):(console.error(a),console.error("Behavior "+a.type+" not implemented yet"))})}var ua=this,ha,P={},Va=!1,Nb=!0,Bb=0,Pc=.5,hc=0,Lb=10,Gd=5/360,Qd=.32/Gd/1E3*2,Jb=1,Ua=0,ac=0,bc=!1,yb=!1,ia,xb,Aa=Number.isFinite||function(a){return"number"===typeof a&&isFinite(a)},ra,y,ca,ba,v,bb,kc=k,lc=k,Oa={play:Ja,pause:Ja,stop:Ja},gc=null,zb=function(a,h){var c=[];zb=function(a,h){c.push({img:a,id:h})};zb(a,h);var q=
ua.getBaseDir()+"images/Icons.svg",b=new XMLHttpRequest;b.onreadystatechange=function(){if(b.readyState===XMLHttpRequest.DONE)if(200!==b.status)console.error("Failed to load CindyJS Icons.svg from "+q+": "+b.statusText);else{var a=b.responseXML,h=a.documentElement,d={},g,e;for(g=h.firstChild;g;g=e)e=g.nextSibling,g.nodeType===Node.ELEMENT_NODE&&"http://www.w3.org/2000/svg"===g.namespaceURI&&"g"===g.localName.toLowerCase()&&(h.removeChild(g),g.setAttribute("style","display:inline"),d[g.getAttribute("id")]=
g);var f=new XMLSerializer;zb=function(c,q){if(d.hasOwnProperty(q)){var b=d[q];h.appendChild(b);var g;try{g=f.serializeToString(a)}finally{h.removeChild(b)}c.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(g)}};c.forEach(function(a){zb(a.img,a.id)});c=null}};b.responseType="document";b.open("GET",q);b.send()},Qc=1,Ab=null,ib=[],jc=!1,oa={config:t,startup:ga,shutdown:Ma,evokeCS:function(a){a=Na(a,!1);console.log(a);A(a);e()},play:La,pause:Ia,stop:$a,evalcs:function(a){return A(Na(a,!1))},
parse:function(a){return Na(a)},niceprint:Q,canvas:null},$b=!1,Kb=0;t.use&&t.use.forEach(function(a){var h=null;t.plugins&&(h=t.plugins[a]);h||(h=ua._pluginRegistry[a]);h||(++Kb,console.log("Loading script for plugin "+a),ua.loadScript(a+"-plugin",a+"-plugin.js",function(){console.log("Successfully loaded plugin "+a);0===--Kb&&$b&&ga()},function(){console.error("Failed to auto-load plugin "+a);0===--Kb&&$b&&ga()}))});Ya.prototype=new ab;Za.prototype=new ab;ma.prototype=new ab;var W={},da,Rc="",Sc=
0,Ob;Ob=t.isNode?process.nextTick:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,0)};var mc=null,oe=[0,8,3,50,"g260045b"],l={_helper:{}};l._helper.roundingfactor=1E4;l._helper.angleroundingfactor=10;l._helper.niceround=function(a,h){return Math.round(a*h)/h};l.niceprint=function(a,h){h=h||l._helper.roundingfactor;if("Angle"===a.usage)return l._helper.niceangle(a);
var c=l._helper.niceround(a.value.real,h),q=l._helper.niceround(a.value.imag,h);return 0===q?""+c:0<q?""+c+" + i*"+q:""+c+" - i*"+-q};var Ac=t.angleUnit||"\u00b0",pe=Ac.replace(/\s+/g,""),Hd=2*Math.PI,qe=1/Hd,re={rad:Hd,"\u00b0":360,deg:360,degree:360,gra:400,grad:400,turn:1,cyc:1,rev:1,rot:1,"\u03c0":2,pi:2,quad:4};l._helper.niceangle=function(a){var h=re[pe];if(!h)return l.niceprint(w.withUsage(a,null));if("function"===typeof h)return h(a);a=l.niceprint(l.realmult(h*qe,a),200<h?l._helper.angleroundingfactor:
null);return-1===a.indexOf("i*")?a+Ac:"("+a+")"+Ac};l.complex=function(a,h){return{ctype:"number",value:{real:a,imag:h}}};l.real=function(a){return{ctype:"number",value:{real:a,imag:0}}};l.zero=l.real(0);l.one=l.real(1);l.infinity=l.complex(Infinity,Infinity);l.nan=l.complex(NaN,NaN);l._helper.input=function(a){return"object"===typeof a?l.complex(+a.r,+a.i):l.real(+a)};l.argmax=function(a,h){return a.value.real*a.value.real+a.value.imag*a.value.imag<h.value.real*h.value.real+h.value.imag*h.value.imag?
h:a};l.max=function(a,h){return{ctype:"number",value:{real:Math.max(a.value.real,h.value.real),imag:Math.max(a.value.imag,h.value.imag)}}};l.min=function(a,h){return{ctype:"number",value:{real:Math.min(a.value.real,h.value.real),imag:Math.min(a.value.imag,h.value.imag)}}};l.add=function(a,h){return{ctype:"number",value:{real:a.value.real+h.value.real,imag:a.value.imag+h.value.imag}}};l.sub=function(a,h){return{ctype:"number",value:{real:a.value.real-h.value.real,imag:a.value.imag-h.value.imag}}};
l.neg=function(a){return{ctype:"number",value:{real:-a.value.real,imag:-a.value.imag}}};l.re=function(a){return{ctype:"number",value:{real:a.value.real,imag:0}}};l.im=function(a){return{ctype:"number",value:{real:a.value.imag,imag:0}}};l.conjugate=function(a){return{ctype:"number",value:{real:a.value.real,imag:-a.value.imag}}};l.round=function(a){return{ctype:"number",value:{real:Math.round(a.value.real),imag:Math.round(a.value.imag)}}};l.ceil=function(a){return{ctype:"number",value:{real:Math.ceil(a.value.real),
imag:Math.ceil(a.value.imag)}}};l.floor=function(a){return{ctype:"number",value:{real:Math.floor(a.value.real),imag:Math.floor(a.value.imag)}}};l.mult=function(a,h){return{ctype:"number",value:{real:a.value.real*h.value.real-a.value.imag*h.value.imag,imag:a.value.real*h.value.imag+a.value.imag*h.value.real}}};l.realmult=function(a,h){return{ctype:"number",value:{real:a*h.value.real,imag:a*h.value.imag}}};l.multiMult=function(a){var h=a[0];if("number"!==h.ctype)return k;for(var c=1;c<a.length;c++){if("number"!==
a[c].ctype)return k;h=l.mult(h,a[c])}return h};l.abs2=function(a,h){return{ctype:"number",value:{real:a.value.real*a.value.real+a.value.imag*a.value.imag,imag:0}}};l.abs=function(a){return l.sqrt(l.abs2(a))};l.inv=function(a){var h=a.value.real*a.value.real+a.value.imag*a.value.imag;return{ctype:"number",value:{real:a.value.real/h,imag:-a.value.imag/h}}};l.div=function(a,h){var c=a.value.real,q=a.value.imag,b=h.value.real,d=h.value.imag,g=b*b+d*d;return{ctype:"number",value:{real:(c*b+q*d)/g,imag:(q*
b-c*d)/g}}};l.eps=1E-10;l.epsbig=1E-6;l.snap=function(a){var h=a.value.real;a=a.value.imag;Math.floor(h+l.eps)!==Math.floor(h-l.eps)&&(h=Math.round(h));Math.floor(a+l.eps)!==Math.floor(a-l.eps)&&(a=Math.round(a));return{ctype:"number",value:{real:h,imag:a}}};l.exp=function(a){var h=Math.exp(a.value.real);return{ctype:"number",value:{real:h*Math.cos(a.value.imag),imag:h*Math.sin(a.value.imag)}}};l.cos=function(a){var h=a.value.real;a=a.value.imag;var c=Math.exp(a),q=c*Math.sin(-h),b=c*Math.cos(-h),
c=Math.exp(-a);return{ctype:"number",value:{real:(b+c*Math.cos(h))/2,imag:(q+c*Math.sin(h))/2}}};l.sin=function(a){var h=a.value.real;a=a.value.imag;var c=Math.exp(a),q=c*Math.sin(-h),b=c*Math.cos(-h),c=Math.exp(-a);return{ctype:"number",value:{real:-(q-c*Math.sin(h))/2,imag:(b-c*Math.cos(h))/2}}};l.tan=function(a){var h=l.sin(a);a=l.cos(a);return l.div(h,a)};l.arccos=function(a){var h=l.mult(a,l.neg(a)),h=l.sqrt(l.add(l.real(1),h));a=l.add(l.mult(a,l.complex(0,1)),h);a=l.add(l.mult(l.log(a),l.complex(0,
1)),l.real(.5*Math.PI));return w.withUsage(a,"Angle")};l.arcsin=function(a){var h=l.mult(a,l.neg(a)),h=l.sqrt(l.add(l.real(1),h));a=l.add(l.mult(a,l.complex(0,1)),h);a=l.mult(l.log(a),l.complex(0,-1));return w.withUsage(a,"Angle")};l.arctan=function(a){var h=l.log(l.add(l.mult(a,l.complex(0,-1)),l.real(1)));a=l.log(l.add(l.mult(a,l.complex(0,1)),l.real(1)));h=l.mult(l.sub(h,a),l.complex(0,.5));return w.withUsage(h,"Angle")};l.arctan2=function(a,h){var c;if(void 0===h)c=l.real(Math.atan2(a.value.imag,
a.value.real));else if(l._helper.isReal(a)&&l._helper.isReal(h))c=l.real(Math.atan2(h.value.real,a.value.real));else{c=l.add(a,l.mult(l.complex(0,1),h));var q=l.sqrt(l.add(l.mult(a,a),l.mult(h,h)));c=l.mult(l.complex(0,-1),l.log(l.div(c,q)))}return w.withUsage(c,"Angle")};l.sqrt=function(a){var h=a.value.real,c=a.value.imag;a=Math.sqrt(Math.sqrt(h*h+c*c));h=Math.atan2(c,h);return{ctype:"number",value:{real:a*Math.cos(h/2),imag:a*Math.sin(h/2)}}};l.powRealExponent=function(a,h){var c=a.value.real,
q=a.value.imag,b=Math.pow(Math.sqrt(c*c+q*q),h),c=Math.atan2(q,c);return{ctype:"number",value:{real:b*Math.cos(c*h),imag:b*Math.sin(c*h)}}};l.log=function(a){var h=a.value.real;a=a.value.imag;var c=Math.sqrt(h*h+a*a),q=Math.atan2(a,h);0>a&&(q+=2*Math.PI);0===a&&0>h&&(q=Math.PI);q>Math.PI&&(q-=2*Math.PI);return l.snap({ctype:"number",value:{real:Math.log(c),imag:q}})};l.pow=function(a,h){return l._helper.isZero(h)?l.one:l._helper.isZero(a)?l.zero:l._helper.isReal(h)?l.powRealExponent(a,h.value.real):
l.exp(l.mult(l.log(a),h))};l.mod=function(a,h){var c=a.value.real,q=h.value.real,b=a.value.imag,d=h.value.imag,c=c-Math.floor(c/q)*q,b=b-Math.floor(b/d)*d;0===q&&(c=0);0===d&&(b=0);return l.snap({ctype:"number",value:{real:c,imag:b}})};l._helper.seed="NO";l._helper.seedrandom=function(a){a-=Math.floor(a);l._helper.seed=.8*a+.1};l._helper.rand=function(){if("NO"===l._helper.seed)return Math.random();var a=l._helper.seed,a=1E3*Math.sin(1E3*a),a=a-Math.floor(a);return l._helper.seed=a};l._helper.randnormal=
function(){var a=l._helper.rand(),h=l._helper.rand();return Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*h)};l._helper.isEqual=function(a,h){return a.value.real===h.value.real&&a.value.imag===h.value.imag};l._helper.isLessThan=function(a,h){return a.value.real<h.value.real||a.value.real===h.value.real&&a.value.imag<h.value.imag};l._helper.compare=function(a,h){return l._helper.isLessThan(a,h)?-1:l._helper.isEqual(a,h)?0:1};l._helper.isAlmostEqual=function(a,h,c){var q=l.eps;"undefined"!==typeof c&&
(q=c);c=a.value.real-h.value.real;a=a.value.imag-h.value.imag;return c<q&&c>-q&&a<q&&a>-q};l._helper.isZero=function(a){return 0===a.value.real&&0===a.value.imag};l._helper.isAlmostZero=function(a){var h=a.value.real;a=a.value.imag;return h<l.eps&&h>-l.eps&&a<l.eps&&a>-l.eps};l._helper.isReal=function(a){return 0===a.value.imag};l._helper.isAlmostReal=function(a){a=a.value.imag;return a<l.epsbig&&a>-l.epsbig};l._helper.isNaN=function(a){return isNaN(a.value.real)||isNaN(a.value.imag)};l._helper.isFinite=
function(a){return isFinite(a.value.real)&&isFinite(a.value.imag)};l._helper.isAlmostImag=function(a){a=a.value.real;return a<l.epsbig&&a>-l.epsbig};l._helper.z3a=l.complex(-.5,.5*Math.sqrt(3));l._helper.z3b=l.complex(-.5,-.5*Math.sqrt(3));l._helper.cub1={ctype:"list",value:[l.one,l.one,l.one]};l._helper.cub2={ctype:"list",value:[l._helper.z3a,l.one,l._helper.z3b]};l._helper.cub3={ctype:"list",value:[l._helper.z3b,l.one,l._helper.z3a]};l.solveCubic=function(a,h,c,q){a=l._helper.solveCubicHelper(a,
h,c,q);return[g.scalproduct(l._helper.cub1,a),g.scalproduct(l._helper.cub2,a),g.scalproduct(l._helper.cub3,a)]};l._helper.solveCubicHelper=function(a,h,c,q){var b=a.value.real;a=a.value.imag;var d=h.value.real;h=h.value.imag;var e=c.value.real,f=c.value.imag,k=q.value.real,m=q.value.imag,n=b*e-a*f;c=b*f+a*e;q=4*n-(d*d-h*h);var p=4*c-2*d*h,r=b*d-a*h,t=b*h+a*d,u=q*e-p*f-18*(r*k-t*m),p=q*f+p*e-18*(r*m+t*k);q=27*(b*b-a*a);var v=54*a*b,w=q*k-v*m,x=q*m+v*k,y=d*d-h*h,z=2*d*h,A=y*d-z*h,B=y*h+z*d,C=w+4*A,
v=x+4*B;q=27*(u*e-p*f+C*k-v*m);p=27*(u*f+p*e+C*m+v*k);C=Math.sqrt(Math.sqrt(q*q+p*p));v=Math.atan2(p,q);p=C*Math.sin(v/2);q=C*Math.cos(v/2);A=-2*A+9*(r*e-t*f)-w+(q*b-p*a);B=-2*B+9*(r*f+t*e)-x+(q*a+p*b);q=Math.exp(Math.log(Math.sqrt(A*A+B*B))/3);e=Math.atan2(B,A);v=q*Math.sin(e/3);p=q*Math.cos(e/3);q*=q;e*=2;n=2*y-6*n;c=2*z-6*c;z=-1.5874010519681996*(d*p-h*v);d=-1.5874010519681996*(d*v+h*p);h=1.2599210498948732*q*Math.cos(e/3);e=1.2599210498948732*q*Math.sin(e/3);q=4.762203155904599*(p*b-v*a);p=4.762203155904599*
(p*a+v*b);b=q*q+p*p;v=(-n*p+c*q)/b;n=(n*q+c*p)/b;c=v;v=(-z*p+d*q)/b;z=(z*q+d*p)/b;d=v;v=(-h*p+e*q)/b;h=(h*q+e*p)/b;e=v;return g.turnIntoCSList([l.complex(n,c),l.complex(z,d),l.complex(h,e)])};var g={_helper:{},turnIntoCSList:function(a){return{ctype:"list",value:a}}};g.EMPTY=g.turnIntoCSList([]);g.asList=function(a){return"list"===a.ctype?a:"number"===a.ctype||"boolean"===a.ctype||"geo"===a.ctype?g.turnIntoCSList([a]):g.EMPTY};g.realVector=function(a){for(var h=[],c=0;c<a.length;c++)h[c]={ctype:"number",
value:{real:a[c],imag:0}};return{ctype:"list",value:h}};g._helper.unitvector=function(a,h){var c=g.zerovector(a);c.value[Math.floor(h.value.real-1)]=l.real(1);return c};g.idMatrix=function(a){for(var h=g.zeromatrix(a,a),c=l.real(1),q=0;q<a.value.real;q++)h.value[q].value[q]=c;return h};g._helper.flippedidMatrix=function(a){for(var h=g.zeromatrix(a,a),c=l.real(1),q=0;q<a.value.real;q++)h.value[q].value[a.value.real-q-1]=c;return h};g.println=function(a){for(var h=[],c=0;c<a.value.length;c++)if("number"===
a.value[c].ctype)h[c]=l.niceprint(a.value[c]);else if("list"===a.value[c].ctype)g.println(a.value[c]);else return k;"number"===a.value[0].ctype&&console.log(h)};g.matrix=function(a){return g.turnIntoCSList(a.map(g.turnIntoCSList))};g.realMatrix=function(a){for(var h=a.length,c=Array(h),q=0;q<h;q++)c[q]=g.realVector(a[q]);return g.turnIntoCSList(c)};g.ex=g.realVector([1,0,0]);g.ey=g.realVector([0,1,0]);g.ez=g.realVector([0,0,1]);g.linfty=g.realVector([0,0,1]);g.ii=g.turnIntoCSList([l.complex(1,0),
l.complex(0,1),l.complex(0,0)]);g.jj=g.turnIntoCSList([l.complex(1,0),l.complex(0,-1),l.complex(0,0)]);g.fundDual=g.realMatrix([[1,0,0],[0,1,0],[0,0,0]]);g.fund=g.realMatrix([[0,0,0],[0,0,0],[0,0,1]]);g.sequence=function(a,h){for(var c=[],q=0,b=Math.round(a.value.real);b<Math.round(h.value.real)+1;b++)c[q]={ctype:"number",value:{real:b,imag:0}},q++;return{ctype:"list",value:c}};g.pairs=function(a){for(var h=[],c=0;c<a.value.length-1;c++)for(var q=c+1;q<a.value.length;q++)h.push({ctype:"list",value:[a.value[c],
a.value[q]]});return{ctype:"list",value:h}};g.triples=function(a){for(var h=[],c=0;c<a.value.length-2;c++)for(var q=c+1;q<a.value.length-1;q++)for(var b=q+1;b<a.value.length;b++)h.push({ctype:"list",value:[a.value[c],a.value[q],a.value[b]]});return{ctype:"list",value:h}};g.cycle=function(a){for(var h=[],c=0;c<a.value.length-1;c++)h[c]={ctype:"list",value:[a.value[c],a.value[c+1]]};h.push({ctype:"list",value:[a.value[a.value.length-1],a.value[0]]});return{ctype:"list",value:h}};g.consecutive=function(a){for(var h=
[],c=0;c<a.value.length-1;c++)h[c]={ctype:"list",value:[a.value[c],a.value[c+1]]};return{ctype:"list",value:h}};g.reverse=function(a){for(var h=Array(a.value.length),c=a.value.length-1,q=0;0<=c;c--,q++)h[q]=a.value[c];return{ctype:"list",value:h}};g.directproduct=function(a,h){for(var c=[],q=0;q<a.value.length;q++)for(var b=0;b<h.value.length;b++)c.push({ctype:"list",value:[a.value[q],h.value[b]]});return{ctype:"list",value:c}};g.concat=function(a,h){for(var c=[],q=0;q<a.value.length;q++)c.push(a.value[q]);
for(q=0;q<h.value.length;q++)c.push(h.value[q]);return{ctype:"list",value:c}};g.prepend=function(a,h){var c=[];c[0]=a;for(var q=0;q<h.value.length;q++)c[q+1]=h.value[q];return{ctype:"list",value:c}};g.append=function(a,h){for(var c=[],q=0;q<a.value.length;q++)c[q]=a.value[q];c.push(h);return{ctype:"list",value:c}};g.contains=function(a,h){for(var c=0;c<a.value.length;c++)if(E.equals(a.value[c],h).value)return{ctype:"boolean",value:!0};return{ctype:"boolean",value:!1}};g.common=function(a,h){for(var c=
[],q=0,b=0;b<a.value.length;b++){for(var d=!1,g=a.value[b],e=0;e<h.value.length;e++)d=d||E.equals(g,h.value[e]).value;d&&(c[q]=a.value[b],q++)}return{ctype:"list",value:c}};g.remove=function(a,h){for(var c=[],q=0,b=0;b<a.value.length;b++){for(var d=!1,g=a.value[b],e=0;e<h.value.length;e++)d=d||E.equals(g,h.value[e]).value;d||(c[q]=a.value[b],q++)}return{ctype:"list",value:c}};g.sort1=function(a){a=a.value.slice();a.sort(w.compare);return g.turnIntoCSList(a)};g._helper.isEqual=function(a,h){return g.equals(a,
h).value};g._helper.isLessThan=function(a,h){for(var c=a.value.length,q=h.value.length,b=0;!(b>=c||b>=q)&&w.isEqual(a.value[b],h.value[b]);)b++;return b===c&&b<q?!0:b===q&&b<c||b===c&&b===q?!1:w.isLessThan(a.value[b],h.value[b])};g._helper.compare=function(a,h){return g._helper.isLessThan(a,h)?-1:g._helper.isEqual(a,h)?0:1};g.equals=function(a,h){if(a.value.length!==h.value.length)return{ctype:"boolean",value:!1};for(var c=!0,q=0;q<a.value.length;q++)var b=a.value[q],d=h.value[q],c="list"===b.ctype&&
"list"===d.ctype?c&&g.equals(b,d).value:c&&nb([b,d],[]).value;return{ctype:"boolean",value:c}};g.almostequals=function(a,h){if(a.value.length!==h.value.length)return{ctype:"boolean",value:!1};for(var c=!0,q=0;q<a.value.length;q++)var b=a.value[q],d=h.value[q],c="list"===b.ctype&&"list"===d.ctype?c&&g.almostequals(b,d).value:c&&Xb([b,d],[]).value;return{ctype:"boolean",value:c}};g._helper.isAlmostReal=function(a){for(var h=!0,c=0;c<a.value.length;c++)var q=a.value[c],h="list"===q.ctype?h&&g._helper.isAlmostReal(q):
h&&l._helper.isAlmostReal(q);return h};g._helper.isAlmostZero=function(a){for(var h=0;h<a.value.length;h++){var c=a.value[h];if("list"===c.ctype){if(!g._helper.isAlmostZero(c))return!1}else if(!l._helper.isAlmostZero(c))return!1}return!0};g._helper.isNaN=function(a){for(var h=!1,c=0;c<a.value.length;c++)var q=a.value[c],h="list"===q.ctype?h||g._helper.isNaN(q):h||l._helper.isNaN(q);return h};g.set=function(a){var h=[],c=0;a=a.value.slice();a.sort(w.compare);for(var q=0;q<a.length;q++)0!==q&&nb([h[h.length-
1],a[q]],[]).value||(h[c]=a[q],c++);return{ctype:"list",value:h}};g.maxval=function(a){for(var h=l.zero,c=0;c<a.value.length;c++){var q=a.value[c];"number"===q.ctype&&(h=l.argmax(h,q));"list"===q.ctype&&(h=l.argmax(h,g.maxval(q)))}return h};g.maxIndex=function(a,h,c){var q=0;void 0!==c&&(q=c);c=q;for(var b=h(a.value[q]).value.real;q<a.value.length;++q){var d=h(a.value[q]).value.real;d>b&&(c=q,b=d)}return c};g.normalizeMax=function(a){var h=l.inv(g.maxval(a));return l._helper.isFinite(h)?g.scalmult(h,
a):a};g.normalizeZ=function(a){var h=l.inv(a.value[2]);return g.scalmult(h,a)};g.dehom=function(a){a=a.value.slice();var h=a.length-1,c=l.inv(a[h]);a.length=h;for(var q=0;q<h;++q)a[q]=l.mult(c,a[q]);return g.turnIntoCSList(a)};g.normalizeAbs=function(a){var h=l.inv(g.abs(a));return g.scalmult(h,a)};g.max=function(a,h){if(a.value.length!==h.value.length)return k;for(var c=[],q=0;q<a.value.length;q++)c[q]=w.max(a.value[q],h.value[q]);return{ctype:"list",value:c}};g.min=function(a,h){if(a.value.length!==
h.value.length)return k;for(var c=[],q=0;q<a.value.length;q++)c[q]=w.min(a.value[q],h.value[q]);return{ctype:"list",value:c}};g.scaldiv=function(a,h){if("number"!==a.ctype)return k;for(var c=[],q=0;q<h.value.length;q++){var b=h.value[q];c[q]="number"===b.ctype?w.div(b,a):"list"===b.ctype?g.scaldiv(a,b):k}return{ctype:"list",value:c}};g.scalmult=function(a,h){if("number"!==a.ctype)return k;for(var c=[],q=0;q<h.value.length;q++){var b=h.value[q];c[q]="number"===b.ctype?w.mult(b,a):"list"===b.ctype?
g.scalmult(a,b):k}return{ctype:"list",value:c}};g.add=function(a,h){if(a.value.length!==h.value.length)return k;for(var c=[],q=0;q<a.value.length;q++){var b=a.value[q],d=h.value[q];c[q]="number"===b.ctype&&"number"===d.ctype?w.add(b,d):"list"===b.ctype&&"list"===d.ctype?g.add(b,d):k}return{ctype:"list",value:c}};g.sub=function(a,h){if(a.value.length!==h.value.length)return k;for(var c=[],q=0;q<a.value.length;q++){var b=a.value[q],d=h.value[q];c[q]="number"===b.ctype&&"number"===d.ctype?l.sub(b,d):
"list"===b.ctype&&"list"===d.ctype?g.sub(b,d):k}return{ctype:"list",value:c}};g.abs2=function(a){for(var h=0,c=0;c<a.value.length;c++){var q=a.value[c];if("number"===q.ctype)h+=l.abs2(q).value.real;else if("list"===q.ctype)h+=g.abs2(q).value.real;else return k}return{ctype:"number",value:{real:h,imag:0}}};g.abs=function(a){return l.sqrt(g.abs2(a))};g.normalizeMaxXX=function(a){for(var h=-1E4,c=l.real(1),q=0;q<a.value.length;q++){var b=l.abs(a.value[q]);b.value.real>h&&(c=a.value[q],h=b.value.real)}return g.scaldiv(c,
a)};g.recursive=function(a,h){for(var c=[],b=0;b<a.value.length;b++){var d=D(a.value[b]);c[b]="number"===d.ctype?l[h](d):"list"===d.ctype?g[h](d):k}return{ctype:"list",value:c}};g.re=function(a){return g.recursive(a,"re")};g.neg=function(a){return g.recursive(a,"neg")};g.im=function(a){return g.recursive(a,"im")};g.conjugate=function(a){return g.recursive(a,"conjugate")};g.transjugate=function(a){return g.transpose(g.conjugate(a))};g.round=function(a){return g.recursive(a,"round")};g.ceil=function(a){return g.recursive(a,
"ceil")};g.floor=function(a){return g.recursive(a,"floor")};g._helper.colNumb=function(a){if("list"!==a.ctype)return-1;for(var h=-1,c=0;c<a.value.length;c++){if("list"!==a.value[c].ctype)return-1;if(0===c)h=a.value[c].value.length;else if(h!==a.value[c].value.length)return-1}return h};g._helper.isNumberVecN=function(a,h){if("list"!==a.ctype||a.value.length!==h)return!1;for(var c=0;c<a.value.length;c++)if("number"!==a.value[c].ctype)return!1;return!0};g.isNumberVector=function(a){if("list"!==a.ctype)return{ctype:"boolean",
value:!1};for(var h=0;h<a.value.length;h++)if("number"!==a.value[h].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};g.isNumberVectorN=function(a,h){if("list"!==a.ctype)return{ctype:"boolean",value:!1};if(a.value)for(var c=0;c<a.value.length;c++)if("number"!==a.value[c].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};g.isNumberMatrix=function(a){if(-1===g._helper.colNumb(a))return{ctype:"boolean",value:!1};for(var h=0;h<a.value.length;h++)if(!g.isNumberVector(a.value[h]).value)return{ctype:"boolean",
value:!1};return{ctype:"boolean",value:!0}};g._helper.isNumberMatrixMN=function(a,h,c){return g.isNumberMatrix(a).value&&a.value.length===h&&a.value[0].value.length===c};g.scalproduct=function(a,h){if(a.value.length!==h.value.length)return k;for(var c={ctype:"number",value:{real:0,imag:0}},b=0;b<h.value.length;b++){var d=a.value[b],g=h.value[b];if("number"===d.ctype&&"number"===g.ctype)c=l.add(l.mult(d,g),c);else return k}return c};g.sesquilinearproduct=function(a,h){if(a.value.length!==h.value.length)return k;
for(var c=0,b=0,d=0;d<h.value.length;d++)var g=a.value[d].value,e=h.value[d].value,c=c+(g.real*e.real+g.imag*e.imag),b=b+(g.real*e.imag-g.imag*e.real);return l.complex(c,b)};g.normSquared=function(a){for(var h=0,c=0;c<a.value.length;c++)var b=a.value[c].value,h=h+(b.real*b.real+b.imag*b.imag);return l.real(h)};g.productMV=function(a,h){if(a.value[0].value.length!==h.value.length)return k;for(var c=[],b=0;b<a.value.length;b++){for(var d={ctype:"number",value:{real:0,imag:0}},e=a.value[b],f=0;f<h.value.length;f++){var m=
e.value[f],n=h.value[f];if("number"===m.ctype&&"number"===n.ctype)d=l.add(l.mult(m,n),d);else return k}c[b]=d}return g.turnIntoCSList(c)};g.productVM=function(a,h){if(a.value.length!==h.value.length)return k;for(var c=[],b=0;b<h.value[0].value.length;b++){for(var d={ctype:"number",value:{real:0,imag:0}},e=0;e<a.value.length;e++){var f=a.value[e],m=h.value[e].value[b];if("number"===f.ctype&&"number"===m.ctype)d=l.add(l.mult(f,m),d);else return k}c[b]=d}return g.turnIntoCSList(c)};g.productMM=function(a,
h){if(a.value[0].value.length!==h.value.length)return k;for(var c=[],b=0;b<a.value.length;b++){var d=g.productVM(a.value[b],h);c[b]=d}return g.turnIntoCSList(c)};g.mult=function(a,h){return a.value.length===h.value.length&&g.isNumberVector(a).value&&g.isNumberVector(h).value?g.scalproduct(a,h):g.isNumberMatrix(a).value&&h.value.length===a.value[0].value.length&&g.isNumberVector(h).value?g.productMV(a,h):g.isNumberMatrix(h).value&&a.value.length===h.value.length&&g.isNumberVector(a).value?g.productVM(a,
h):g.isNumberMatrix(a).value&&g.isNumberMatrix(h).value&&h.value.length===a.value[0].value.length?g.productMM(a,h):k};g.projectiveDistMinScal=function(a,h){var c=g.abs(a),b=g.abs(h);if(0===c.value.real||0===b.value.real)return 0;var d=g.conjugate(h),d=g.scalproduct(a,d),d=l._helper.isAlmostZero(d)?l.real(1):l.div(d,l.abs(d)),c=g.scaldiv(c,a),b=g.scaldiv(b,h),b=g.scalmult(d,b),d=g.abs(g.add(c,b)),b=g.abs(g.sub(c,b));return Math.min(d.value.real,b.value.real)};g.conicDist=function(a,h){var c=u(a),b=
u(h);console.log(Q(c),Q(b));return g.projectiveDistMinScal(c,b)};g.crossOperator=function(a){var h=a.value[0],c=a.value[1];a=a.value[2];return g.turnIntoCSList([g.turnIntoCSList([l.zero,l.neg(a),c]),g.turnIntoCSList([a,l.zero,l.neg(h)]),g.turnIntoCSList([l.neg(c),h,l.zero])])};g.cross=function(a,h){var c=l.sub(l.mult(a.value[1],h.value[2]),l.mult(a.value[2],h.value[1])),b=l.sub(l.mult(a.value[2],h.value[0]),l.mult(a.value[0],h.value[2])),d=l.sub(l.mult(a.value[0],h.value[1]),l.mult(a.value[1],h.value[0]));
return g.turnIntoCSList([c,b,d])};g.crossratio3harm=function(a,h,c,b,d){var e=g.det3(a,c,d),f=g.det3(h,b,d);a=g.det3(a,b,d);h=g.det3(h,c,d);e=l.mult(e,f);f=l.mult(a,h);return g.turnIntoCSList([e,f])};g.crossratio3=function(a,h,c,b,d){a=g.crossratio3harm(a,h,c,b,d);return l.div(a.value[0],a.value[1])};g.veronese=function(a){var h=l.mult(a.value[0],a.value[0]),c=l.mult(a.value[1],a.value[1]),b=l.mult(a.value[2],a.value[2]),d=l.mult(a.value[0],a.value[1]),e=l.mult(a.value[0],a.value[2]);a=l.mult(a.value[1],
a.value[2]);return g.turnIntoSCList([h,c,b,d,e,a])};g.matrixFromVeronese=function(a){var h=a.value[0],c=a.value[1],b=a.value[2],d=l.realmult(.5,a.value[3]),e=l.realmult(.5,a.value[4]);a=l.realmult(.5,a.value[5]);return g.turnIntoCSList([g.turnIntoCSList([h,d,e]),g.turnIntoCSList([d,c,a]),g.turnIntoCSList([e,a,b])])};g.det2=function(a,h){var c=l.mult(a.value[0],h.value[1]);return c=l.sub(c,l.mult(a.value[1],h.value[0]))};g.det3=function(a,h,c){return l.complex(a.value[0].value.real*h.value[1].value.real*
c.value[2].value.real-a.value[0].value.imag*h.value[1].value.imag*c.value[2].value.real-a.value[0].value.imag*h.value[1].value.real*c.value[2].value.imag-a.value[0].value.real*h.value[1].value.imag*c.value[2].value.imag+a.value[2].value.real*h.value[0].value.real*c.value[1].value.real-a.value[2].value.imag*h.value[0].value.imag*c.value[1].value.real-a.value[2].value.imag*h.value[0].value.real*c.value[1].value.imag-a.value[2].value.real*h.value[0].value.imag*c.value[1].value.imag+a.value[1].value.real*
h.value[2].value.real*c.value[0].value.real-a.value[1].value.imag*h.value[2].value.imag*c.value[0].value.real-a.value[1].value.imag*h.value[2].value.real*c.value[0].value.imag-a.value[1].value.real*h.value[2].value.imag*c.value[0].value.imag-a.value[0].value.real*h.value[2].value.real*c.value[1].value.real+a.value[0].value.imag*h.value[2].value.imag*c.value[1].value.real+a.value[0].value.imag*h.value[2].value.real*c.value[1].value.imag+a.value[0].value.real*h.value[2].value.imag*c.value[1].value.imag-
a.value[2].value.real*h.value[1].value.real*c.value[0].value.real+a.value[2].value.imag*h.value[1].value.imag*c.value[0].value.real+a.value[2].value.imag*h.value[1].value.real*c.value[0].value.imag+a.value[2].value.real*h.value[1].value.imag*c.value[0].value.imag-a.value[1].value.real*h.value[0].value.real*c.value[2].value.real+a.value[1].value.imag*h.value[0].value.imag*c.value[2].value.real+a.value[1].value.imag*h.value[0].value.real*c.value[2].value.imag+a.value[1].value.real*h.value[0].value.imag*
c.value[2].value.imag,-a.value[0].value.imag*h.value[1].value.imag*c.value[2].value.imag+a.value[0].value.imag*h.value[1].value.real*c.value[2].value.real+a.value[0].value.real*h.value[1].value.real*c.value[2].value.imag+a.value[0].value.real*h.value[1].value.imag*c.value[2].value.real-a.value[2].value.imag*h.value[0].value.imag*c.value[1].value.imag+a.value[2].value.imag*h.value[0].value.real*c.value[1].value.real+a.value[2].value.real*h.value[0].value.real*c.value[1].value.imag+a.value[2].value.real*
h.value[0].value.imag*c.value[1].value.real-a.value[1].value.imag*h.value[2].value.imag*c.value[0].value.imag+a.value[1].value.imag*h.value[2].value.real*c.value[0].value.real+a.value[1].value.real*h.value[2].value.real*c.value[0].value.imag+a.value[1].value.real*h.value[2].value.imag*c.value[0].value.real+a.value[0].value.imag*h.value[2].value.imag*c.value[1].value.imag-a.value[0].value.imag*h.value[2].value.real*c.value[1].value.real-a.value[0].value.real*h.value[2].value.real*c.value[1].value.imag-
a.value[0].value.real*h.value[2].value.imag*c.value[1].value.real+a.value[2].value.imag*h.value[1].value.imag*c.value[0].value.imag-a.value[2].value.imag*h.value[1].value.real*c.value[0].value.real-a.value[2].value.real*h.value[1].value.real*c.value[0].value.imag-a.value[2].value.real*h.value[1].value.imag*c.value[0].value.real+a.value[1].value.imag*h.value[0].value.imag*c.value[2].value.imag-a.value[1].value.imag*h.value[0].value.real*c.value[2].value.real-a.value[1].value.real*h.value[0].value.real*
c.value[2].value.imag-a.value[1].value.real*h.value[0].value.imag*c.value[2].value.real)};g.det4m=function(a){var h=a.value,c=h[0].value,b=c[0].value,d=+b.real,g=+b.imag,b=c[1].value,e=+b.real,f=+b.imag,b=c[2].value,k=+b.real,m=+b.imag,b=c[3].value,n=+b.real,p=+b.imag,c=h[1].value,b=c[0].value,r=+b.real,t=+b.imag,b=c[1].value,v=+b.real,u=+b.imag,b=c[2].value,w=+b.real,x=+b.imag,b=c[3].value,c=+b.real,b=+b.imag;a=d*v-g*u-e*r+f*t;var y=d*u+g*v-e*t-f*r,z=d*w-g*x-k*r+m*t,A=d*x+g*w-k*t-m*r,B=d*c-g*b-n*
r+p*t,C=d*b+g*c-n*t-p*r,D=e*w-f*x-k*v+m*u,E=e*x+f*w-k*u-m*v,G=e*c-f*b-n*v+p*u,F=e*b+f*c-n*u-p*v,I=k*c-m*b-n*w+p*x,J=k*b+m*c-n*x-p*w,c=h[2].value,b=c[0].value,d=+b.real,g=+b.imag,b=c[1].value,e=+b.real,f=+b.imag,b=c[2].value,k=+b.real,m=+b.imag,b=c[3].value,n=+b.real,p=+b.imag,c=h[3].value,b=c[0].value,r=+b.real,t=+b.imag,b=c[1].value,v=+b.real,u=+b.imag,b=c[2].value,w=+b.real,x=+b.imag,b=c[3].value,c=+b.real,b=+b.imag,h=d*v-g*u-e*r+f*t,H=d*u+g*v-e*t-f*r,K=d*w-g*x-k*r+m*t,L=d*x+g*w-k*t-m*r,M=d*c-g*
b-n*r+p*t,d=d*b+g*c-n*t-p*r,g=e*w-f*x-k*v+m*u,r=e*x+f*w-k*u-m*v,t=e*c-f*b-n*v+p*u,e=e*b+f*c-n*u-p*v,f=k*c-m*b-n*w+p*x,k=k*b+m*c-n*x-p*w;return l.complex(a*f-y*k-z*t+A*e+B*g-C*r+D*M-E*d-G*K+F*L+I*h-J*H,a*k+y*f-z*e-A*t+B*r+C*g+D*d+E*M-G*L-F*K+I*H+J*h)};g.eucangle=function(a,h){var c=g.cross(a,g.linfty),b=g.cross(h,g.linfty),d=g.det3(g.ez,c,g.ii),c=g.det3(g.ez,c,g.jj),e=g.det3(g.ez,b,g.ii),b=g.det3(g.ez,b,g.jj),d=l.div(l.mult(d,b),l.mult(e,c)),d=l.log(d);return d=l.mult(d,l.complex(0,.5))};g.zerovector=
function(a){a=Math.floor(a.value.real);for(var h=Array(a),c=0;c<a;c++)h[c]=0;return g.realVector(h)};g.zeromatrix=function(a,h){for(var c=Math.floor(a.value.real),b=Array(c),d=0;d<c;d++)b[d]=g.zerovector(h);return g.turnIntoCSList(b)};g.vandermonde=function(a){for(var h=a.value.length,c=g.zeromatrix(h,h),b=0;b<h;b++)for(var d=0;d<h;d++)c.value[b].value[d]=l.pow(a.value[b],l.real(d-1));return c};g.transpose=function(a){for(var h=[],c=a.value[0].value.length,b=a.value.length,d=0;d<c;d++){for(var e=
[],f=0;f<b;f++)e[f]=a.value[f].value[d];h[d]=g.turnIntoCSList(e)}return g.turnIntoCSList(h)};g.column=function(a,h){for(var c=[],b=a.value.length,d=Math.floor(h.value.real-1),e=0;e<b;e++)c[e]=a.value[e].value[d];return g.turnIntoCSList(c)};g.row=function(a,h){for(var c=[],b=a.value[0].value.length,d=Math.floor(h.value.real-1),e=0;e<b;e++)c[e]=a.value[d].value[e];return g.turnIntoCSList(c)};g.adjoint2=function(a){var h=a.value[0].value[0],c=a.value[1].value[0],b=Array(2);b[0]=g.turnIntoCSList([a.value[1].value[1],
l.neg(a.value[0].value[1])]);b[1]=g.turnIntoCSList([l.neg(c),h]);return b=g.turnIntoCSList(b)};g.adjoint3=function(a){var h,c,b,d,g,e,f,l,k,m,n,p,r,t,v,u,w;h=a.value[0].value;c=h[0].value;b=c.real;d=c.imag;c=h[1].value;g=c.real;e=c.imag;c=h[2].value;f=c.real;l=c.imag;h=a.value[1].value;c=h[0].value;k=c.real;m=c.imag;c=h[1].value;n=c.real;p=c.imag;c=h[2].value;r=c.real;t=c.imag;h=a.value[2].value;c=h[0].value;a=c.real;v=c.imag;c=h[1].value;u=c.real;w=c.imag;c=h[2].value;h=c.real;c=c.imag;return{ctype:"list",
value:[{ctype:"list",value:[{ctype:"number",value:{real:n*h-r*u-p*c+t*w,imag:n*c-r*w-u*t+h*p}},{ctype:"number",value:{real:-g*h+f*u+e*c-l*w,imag:-g*c+f*w+u*l-h*e}},{ctype:"number",value:{real:g*r-f*n-e*t+l*p,imag:g*t-f*p-n*l+r*e}}]},{ctype:"list",value:[{ctype:"number",value:{real:-k*h+r*a+m*c-t*v,imag:-k*c+r*v+a*t-h*m}},{ctype:"number",value:{real:b*h-f*a-d*c+l*v,imag:b*c-f*v-a*l+h*d}},{ctype:"number",value:{real:-b*r+f*k+d*t-l*m,imag:-b*t+f*m+k*l-r*d}}]},{ctype:"list",value:[{ctype:"number",value:{real:k*
u-n*a-m*w+p*v,imag:k*w-n*v-a*p+u*m}},{ctype:"number",value:{real:-b*u+g*a+d*w-e*v,imag:-b*w+g*v+a*e-u*d}},{ctype:"number",value:{real:b*n-g*k-d*p+e*m,imag:b*p-g*m-k*e+n*d}}]}]}};g.inverse=function(a){var h=a.value.length;if(h!==a.value[0].value.length)return console.log("Inverse works only for square matrices"),k;if(2===h)return g.scaldiv(g.det(a),g.adjoint2(a));if(3===h)return g.scaldiv(g.det(a),g.adjoint3(a));h=g.LUdecomp(a);a=a.value.length;var c=l.real(0),b=l.real(1),d=g.zerovector(l.real(a));
d.value[0]=b;for(var e=Array(a),f=0;f<a;f++)e[f]=g._helper.LUsolve(h,d),d.value[f]=c,d.value[f+1]=b;e=g.turnIntoCSList(e);return e=g.transpose(e)};g.linearsolve=function(a,h){return 2===a.value.length?g.linearsolveCramer2(a,h):3===a.value.length?g.linearsolveCramer3(a,h):g.LUsolve(a,h)};g.getDiag=function(a){if(a.value.length!==a.value[0].value.length)return k;for(var h=Array(a.value.length),c=0;c<a.value.length;c++)h[c]=a.value[c].value[c];return g.turnIntoCSList(h)};g.getSubDiag=function(a){if(a.value.length!==
a.value[0].value.length)return k;for(var h=Array(a.value.length-1),c=0;c<a.value.length-1;c++)h[c]=a.value[c+1].value[c];return g.turnIntoCSList(h)};g.eig2=function(a){var h=l.add(a.value[0].value[0],a.value[1].value[1]);a=g.det2(a.value[0],a.value[1]);var c=l.mult(h,h),b=h=l.mult(h,l.real(.5));a=l.sqrt(l.sub(l.div(c,l.real(4)),a));h=l.add(h,a);b=l.sub(b,a);return g.turnIntoCSList([h,b])};g.eig=function(a,h){var c=h||!0,b=a,d=l.real(b.value.length),e=d.value.real;l.real(0);var b=g._helper.QRIteration(b)[0],
b=g.getDiag(b),b=g.sort1(b),d=g.idMatrix(d,d),f=Array(e),f=g.turnIntoCSList(f);if(c){for(var k,m,n,p=0,r=!1,c=0;c<e;c++)r?m=k.value[p]:(k=b.value[c],k=g.sub(a,g.scalmult(k,d)),k=g.nullSpace(k),m=k.value[0],void 0!==m&&(n=m)),void 0===m&&(m=n),1E-8>g.abs(m).value.real&&0===p&&(m=g._helper.inverseIteration(a,b.value[c])),f.value[c]=g._helper.isAlmostZeroVec(m)?m:g.scaldiv(g.abs(m),m),c<e-1&&((r=1E-6>l.abs(l.sub(b.value[c],b.value[c+1])).value.real)?p++:p=0);f=g.transpose(f)}return g.turnIntoCSList([b,
f])};g._helper.isNormalMatrix=function(a){return 1E-10>g.abs(g.sub(a,g.transjugate(a))).value.real};g._helper.QRIteration=function(a,h){var c,b=a;c=l.real(b.value.length);var d=c.value.real,e=c.value.real;l.real(0);var f;g.idMatrix(c,c);var k=g.zeromatrix(c,c),m=g.idMatrix(c,c),n=h?h:2500,p,r,t,v=0,u=Array(e);for(c=0;c<n;c++){f=g._helper.getBlock(b,[e-2,e-1],[e-2,e-1]);p=g.eig2(f);f=p.value[0];p=p.value[1];g.abs(f);g.abs(p);r=b.value[e-1].value[e-1];t=l.abs(l.sub(r,f)).value.real;r=l.abs(l.sub(r,
p)).value.real;p=t<r?f:p;f=g.idMatrix(l.real(e),l.real(e));p=g.scalmult(p,f);f=g.QRdecomp(g.sub(b,p));b=w.mult(f.R,f.Q);b=g.add(b,p);f.Q=g._helper.buildBlockMatrix(f.Q,g.idMatrix(l.real(v),l.real(v)));m=w.mult(m,f.Q);if(1E-48>l.abs2(b.value[b.value.length-1].value[b.value[0].value.length-2]).value.real&&1<e){u[d-v-1]=b.value[e-1].value[e-1];for(c=0;c<e;c++)k.value[e-1].value[c]=b.value[e-1].value[c],k.value[c].value[e-1]=b.value[c].value[e-1];b=g._helper.getBlock(b,[0,e-2],[0,e-2]);v++;e--}if(1===
e){k.value[0].value[0]=b.value[0].value[0];break}if(g._helper.isUpperTriangular(b)){for(c=0;c<e;c++)k.value[c].value[c]=b.value[c].value[c];break}}return[k,m]};g.rank=function(a,h){return g.RRQRdecomp(a,h).rank};g._helper.isAlmostZeroVec=function(a){for(var h=a.value.length,c=0;c<h;c++)if(!l._helper.isAlmostZero(a.value[c]))return!1;return!0};g._helper.isLowerTriangular=function(a){for(var h=a.value.length,c=a.value[0].value.length,b=0;b<h;b++)for(var d=b+1;d<c;d++)if(!l._helper.isAlmostZero(a.value[b].value[d]))return!1;
return!0};g._helper.isUpperTriangular=function(a){return g._helper.isLowerTriangular(g.transpose(a))};g._helper.isAlmostId=function(a){var h=a.value.length,c=l.real(h);if(h!==a.value[0].value.length)return!1;a=g.sub(a,g.idMatrix(c),c);for(c=0;c<h;c++)for(var b=0;b<h;b++)if(1E-16<l.abs(a.value[c].value[b]).value.real)return!1;return!0};g.nullSpace=function(a,h){var c=a.value.length,b=g.RRQRdecomp(g.transjugate(a),h),d=g.transpose(b.Q),b=c-b.rank.value.real,e=Array(b);d.value.reverse();for(var f,k=
0;k<b;k++)f=d.value[k],e[k]=g.scaldiv(g.abs(f),f);e=g.turnIntoCSList(e);return 0<e.value.length?e:g.turnIntoCSList([g.zerovector(l.real(c))])};g._helper.isAlmostDiagonal=function(a){var h=a.value.length;l.real(h);l.real(0);if(h!==a.value[0].value.length)return!1;for(var c=0;c<h;c++)for(var b=0;b<h;b++)if(c!==b&&1E-16<l.abs(a.value[c].value[b]).value.real)return!1;return!0};g._helper.inverseIteration=function(a,h){console.log("warning: code untested");for(var c=a.value.length,b=Array(c),d=0;d<c;d++)b[d]=
2*Math.random()-.5;for(var b=g.realVector(b),c=g.idMatrix(l.real(c),l.real(c)),d=l.add(h,l.real(.1*Math.random()-.5)),e=0;100>e;e++)b=g.scaldiv(g.abs(b),b),b=g.LUsolve(g.sub(a,g.scalmult(d,c)),JSON.parse(JSON.stringify(b)));return g.scaldiv(g.abs(b),b)};g._helper.toHessenberg=function(a){var h=JSON.parse(JSON.stringify(a)),c=h.value.length,b=l.real(c-1),d=l.real(c);l.real(1);if(g._helper.isUpperTriangular(h))return[g.idMatrix(b,b),a];var e;a=g.idMatrix(d,d);for(var f,d=1;d<c-1;d++)e=g.column(h,l.real(d)),
e.value=e.value.splice(d),f=g.abs2(e).value.real,1E-16<f&&(e=g._helper.getHouseHolder(e),a=w.mult(a,e),h=w.mult(w.mult(e,h),e)),b.value.real--;return[a,h]};g._helper.swapEl=function(a,h,c){var b;"[object Array]"===Object.prototype.toString.call(a)?(b=a[h],a[h]=a[c],a[c]=b):"list"===a.ctype&&(b=a.value[h],a.value[h]=a.value[c],a.value[c]=b)};g.RRQRdecomp=function(a,h){var c=Math.sqrt(l.eps);void 0!==h&&(c=.1*h.value.real);var c=c*c,b,d=a.value.length,e=l.real(d),f=l.real(1),k=g._helper.unitvector(l.real(a.value.length),
f),m=g.idMatrix(e,e),n=JSON.parse(JSON.stringify(a)),p=g.transpose(a),r=Array(d);for(b=0;b<d;b++)r[b]=g.abs2(p.value[b]);r=g.turnIntoCSList(r);p=Array(d);for(b=0;b<d;b++)p[b]=b;b=g.maxIndex(r,l.abs);for(var t=r.value[b],v=0,u=0;1E-16<l.abs2(t).value.real;u++){v++;g._helper.swapColumn(n,u,b);g._helper.swapEl(r,u,b);g._helper.swapEl(p,u,b);b=g._helper.getBlock(n,[u],[u]);b=g.column(b,f);t=g.abs2(b).value.real;1E-8<t&&(b=g._helper.getHouseHolder(b),b=g._helper.buildBlockMatrix(g.idMatrix(l.real(u),l.real(u)),
b),m=w.mult(m,g.transjugate(b)),n=w.mult(b,n));for(b=u+1;b<d;b++)r.value[b]=l.sub(r.value[b],l.mult(n.value[u].value[b],l.conjugate(n.value[u].value[b])));b=g.maxIndex(r,l.abs2,u+1);t=r.value[b];if(u+2===d){l.abs(t).value.real>c&&v++;break}e=l.sub(e,f);k.value=k.value.splice(0,k.value.length-1)}return{Q:m,R:n,P:g.turnIntoCSList(p),rank:l.real(v)}};g._helper.getHouseHolder=function(a){var h=l.real(a.value.length);if(1E-16>g.abs2(a))return g.idMatrix(h,h);var c,b=l.real(1),d=g._helper.unitvector(l.real(a.value.length),
b);c=g._helper.QRgetAlpha(a,0);c=g.sub(a,g.scalmult(c,d));c=g.scaldiv(g.abs(c),c);a=l.div(g.sesquilinearproduct(a,c),g.sesquilinearproduct(c,a));h=g.idMatrix(h,h);return h=g.sub(h,g.scalmult(l.add(b,a),g._helper.transposeMult(c,g.conjugate(c))))};g._helper.reOrderbyPivots=function(a,h){for(var c=a.value.length.length,b=g.transpose(a),c=Array(c),d=0;d<h.length;d++)c[h[d]]=b.value[d];c=g.turnIntoCSList(c);return g.transpose(c)};g.QRdecomp=function(a){var h,c=a.value.length,b=l.real(c);if(g._helper.isUpperTriangular(a))return{Q:g.idMatrix(b,
b),R:a};var d=l.real(1),e=g._helper.unitvector(l.real(a.value.length),d),f,k=g.idMatrix(b,b);a=JSON.parse(JSON.stringify(a));for(var m=0;;m++){h=g._helper.getBlock(a,[m],[m]);h=g.column(h,d);f=g.abs2(h).value.real;1E-8<f&&(h=g._helper.getHouseHolder(h),h=g._helper.buildBlockMatrix(g.idMatrix(l.real(m),l.real(m)),h),k=w.mult(k,g.transjugate(h)),a=w.mult(h,a));if(m+2===c)break;b=l.sub(b,d);e.value=e.value.splice(0,e.value.length-1)}return{Q:k,R:a}};g._helper.swapColumn=function(a,h,c){for(var b,d=0;d<
a.value.length;d++)b=a.value[d].value[h],a.value[d].value[h]=a.value[d].value[c],a.value[d].value[c]=b};g._helper.buildBlockMatrix=function(a,h){if(0===a.value.length)return h;if(0===h.value.length)return a;for(var c=a.value.length,b=a.value[0].value.length,d=b+h.value[0].value.length,d=g.zeromatrix(l.real(c+h.value.length),l.real(d)),e=0;e<a.value.length;e++)for(var f=0;f<a.value[0].value.length;f++)d.value[e].value[f]=a.value[e].value[f];for(e=0;e<h.value.length;e++)for(f=0;f<h.value[0].value.length;f++)d.value[c+
e].value[b+f]=h.value[e].value[f];return d};g._helper.getBlock=function(a,h,c){a=JSON.parse(JSON.stringify(a));var b=h[0],d=c[0];h=void 0===h[1]?a.value.length:h[1];c=void 0===c[1]?a.value[0].value.length:c[1];h++;c++;a.value=a.value.slice(b,h);for(b=0;b<a.value.length;b++)a.value[b].value=a.value[b].value.slice(d,c);return a};g._helper.setBlock=function(a,h,c){a=JSON.parse(JSON.stringify(a));var b=c[0];c=c[1];for(var d=h.value.length,g=h.value[0].value.length,e=0;e<d;e++)for(var f=0;f<g;f++)a.value[b+
e].value[c+f]=h.value[e].value[f];return a};g._helper.transposeMult=function(a,h){if(a.value.length!==h.value.length)return k;for(var c=a.value.length,b=Array(c),d=0;d<c;d++)b[d]=g.scalmult(a.value[d],h);return g.turnIntoCSList(b)};g._helper.QRgetAlpha=function(a,h){return 0>a.value[h].value.real?g.abs(a):l.neg(g.abs(a))};g.LUdecomp=function(a){a=JSON.parse(JSON.stringify(a));var h,c,b,d,g,e=0,f,k=a.value.length,m=k-1,n=Array(k);for(b=0;b<k;++b){g=b;d=a.value[b];f=l.abs(d.value[b]).value.real;for(c=
b+1;c<k;++c)h=l.abs(a.value[c].value[b]),f<h.value.real&&(f=h.value.real,g=c);f<l.eps&&console.log("Warning: singular matrix!");n[b]=g;g!==b&&(a.value[b]=a.value[g],a.value[g]=d,d=a.value[b],e++);c=d.value[b];for(h=b+1;h<k;++h)a.value[h].value[b]=l.div(a.value[h].value[b],c);for(h=b+1;h<k;++h){g=a.value[h];for(c=b+1;c<m;++c)g.value[c]=l.sub(g.value[c],l.mult(g.value[b],d.value[c])),++c,g.value[c]=l.sub(g.value[c],l.mult(g.value[b],d.value[c]));c===m&&(g.value[c]=l.sub(g.value[c],l.mult(g.value[b],
d.value[c])))}}return{LU:a,P:n,TransPos:e}};g.LUsolve=function(a,h){var c=g.LUdecomp(a);return g._helper.LUsolve(c,h)};g._helper.LUsolve=function(a,h){var c=JSON.parse(JSON.stringify(h)),b,d=a.LU,g=d.value.length,e=JSON.parse(JSON.stringify(c)),f=a.P,k;for(b=g-1;-1!==b;--b)e.value[b]=c.value[b];for(b=0;b<g;++b)for(c=f[b],f[b]!==b&&(k=e.value[b],e.value[b]=e.value[c],e.value[c]=k),k=d.value[b],c=0;c<b;++c)e.value[b]=l.sub(e.value[b],l.mult(e.value[c],k.value[c]));for(b=g-1;0<=b;--b){k=d.value[b];for(c=
b+1;c<g;++c)e.value[b]=l.sub(e.value[b],l.mult(e.value[c],k.value[c]));e.value[b]=l.div(e.value[b],k.value[b])}return e};g.linearsolveCramer2=function(a,h){var c=g.column(a,l.real(1)),b=g.column(a,l.real(2)),d=g.det2(c,b);l._helper.isZero(d)&&console.log("A is not regular!");b=g.det2(h,b);b=l.div(b,d);c=g.det2(c,h);c=l.div(c,d);return g.turnIntoCSList([b,c])};g.linearsolveCramer3=function(a,h){var c=g.column(a,l.real(1)),b=g.column(a,l.real(2)),d=g.column(a,l.real(3)),e=g.det3(c,b,d);l._helper.isZero(e)&&
console.log("A is not regular!");var f=g.det3(h,b,d),d=g.det3(c,h,d),c=g.det3(c,b,h),f=g.turnIntoCSList([f,d,c]);return f=g.scaldiv(e,f)};g.linearsolveCGNR=function(a,h){var c=g.transpose(a),b=w.mult(c,a),c=w.mult(c,h);return g.linearsolveCG(b,c)};g.linearsolveCG=function(a,h){var c,b,d,e,f,k;e=h;b=c=g.sub(h,w.mult(a,h));for(var m=Math.ceil(1.2*a.value.length),n=0;n<m;){n++;f=w.mult(a,b);k=d=g.scalproduct(c,c);d=l.div(d,g.scalproduct(b,f));e=g.add(e,w.mult(d,b));c=g.sub(c,w.mult(d,f));if(g.abs(c).value.real<
l.eps)break;d=g.scalproduct(c,c);d=l.div(d,k);b=g.add(c,w.mult(d,b))}n>=m&&console.log("CG did not converge");return e};g.det=function(a){if(1===a.value.length)return a.value[0].value[0];if(2===a.value.length)return g.det2(a.value[0],a.value[1]);if(3===a.value.length)return g.det3(a.value[0],a.value[1],a.value[2]);if(4===a.value.length)return g.det4m(a);var h=a.value.length,c=l.real(1),b,d,e=JSON.parse(JSON.stringify(a)),f,k,m,n;for(a=0;a<h-1;a++){d=a;for(b=a+1;b<h;b++)l.abs(e.value[b].value[a]).value.real>
l.abs(e.value[d].value[a]).value.real&&(d=b);d!==a&&(b=e.value[d],e.value[d]=e.value[a],e.value[a]=b,c=l.neg(c));f=e.value[a];for(b=a+1;b<h;b++){k=e.value[b];m=l.div(k.value[a],f.value[a]);for(d=a+1;d<h-1;d+=2)n=d+1,k.value[d]=l.sub(k.value[d],l.mult(f.value[d],m)),k.value[n]=l.sub(k.value[n],l.mult(f.value[n],m));d!==h&&(k.value[d]=l.sub(k.value[d],l.mult(f.value[d],m)))}if(l._helper.isZero(f.value[a]))return l.real(0);c=l.mult(c,f.value[a])}return l.mult(c,e.value[a].value[a])};g.LUdet=function(a){a=
g.LUdecomp(a);for(var h=a.LU,c=h.value.length,b=h.value[0].value[0],d=1;d<c;d++)b=l.mult(b,h.value[d].value[d]);1===a.TransPos%2&&(b=l.neg(b));return b};g.getField=function(a,h){var c;if("homog"===h){if(g._helper.isNumberVecN(a,3))return a;if(g._helper.isNumberVecN(a,2))return g.turnIntoCSList([a.value[0],a.value[1],l.real(1)])}if("xy"===h){if(g._helper.isNumberVecN(a,2))return a;if(g._helper.isNumberVecN(a,3))return g.turnIntoCSList([l.div(a.value[0],a.value[2]),l.div(a.value[1],a.value[2])])}if("x"===
h&&g.isNumberVector(a)){c=a.value.length;if(0<c&&3!==c)return a.value[0];if(3===c)return"Point"===a.usage?l.div(a.value[0],a.value[2]):a.value[0]}if("y"===h&&g.isNumberVector(a)){c=a.value.length;if(1<c&&3!==c)return a.value[1];if(3===c)return"Point"===a.usage?l.div(a.value[1],a.value[2]):a.value[1]}return"z"===h&&g.isNumberVector(a)&&(c=a.value.length,2<c)?a.value[2]:k};g.nil=g.turnIntoCSList([]);g.ofGeos=function(a){return g.turnIntoCSList(a.map(function(a){return{ctype:"geo",value:a}}))};var Fa=
{key:function(a){if("string"===a.ctype)return"s"+a.value.length+":"+a.value+";";if("number"===a.ctype)return"n"+a.value.real+","+a.value.imag+";";if("list"===a.ctype)return"l"+a.value.length+":"+a.value.map(Fa.key).join(",")+";";if("boolean"===a.ctype)return"b"+a.value+";";if("dict"===a.ctype)return a=Object.keys(a.value).sort(),"d"+a.length+":"+a.join(",")+";";"undefined"!==a.ctype&&ha.err("Bad dictionary key: "+Q(a));return"undef"},create:function(){return{ctype:"dict",value:{}}},clone:function(a){var h=
Fa.create(),c;for(c in a.value)a.value.hasOwnProperty(c)&&(h.value[c]=a.value[c]);return h},put:function(a,h,c){a.value[Fa.key(h)]={key:h,value:c}},get:function(a,h,c){return(a=a.value[Fa.key(h)])?a.value:c},niceprint:function(a){return"{"+Object.keys(a.value).sort().map(function(h){h=a.value[h];return Q(h.key)+":"+Q(h.value)}).join(", ")+"}"}},w={_helper:{},order:{undefined:0,"boolean":1,number:2,term:3,atomic:4,variable:5,geo:6,string:7,list:8},string:function(a){return{ctype:"string",value:a}},
bool:function(a){return{ctype:"boolean",value:a}},not:function(a){return w.bool(!a.value)},isLessThan:function(a,h){return-1===w.compare(a,h)},isEqual:function(a,h){return 0===w.compare(a,h)},compareResults:function(a,h){return w.compare(a.result,h.result)},compare:function(a,h){if(a.ctype!==h.ctype)return w.order[a.ctype]-w.order[h.ctype];if("number"===a.ctype)return l._helper.compare(a,h);if("list"===a.ctype)return g._helper.compare(a,h);if("geo"===a.ctype)return a.value.name===h.value.name?0:a.value.name<
h.value.name?-1:1;if("string"===a.ctype)return a.value===h.value?0:a.value<h.value?-1:1;if("boolean"===a.ctype)return a.value===h.value?0:!1===a.value?-1:1},add:function(a,h){return"void"===a.ctype&&"number"===h.ctype||"void"===a.ctype&&"list"===h.ctype?h:"number"===a.ctype&&"number"===h.ctype?l.add(a,h):"string"===a.ctype||"string"===h.ctype?{ctype:"string",value:Q(a)+Q(h)}:"list"===a.ctype&&"list"===h.ctype?g.add(a,h):k},sub:function(a,h){return"void"===a.ctype&&"number"===h.ctype?l.neg(h):"void"===
a.ctype&&"list"===h.ctype?g.neg(h):"number"===a.ctype&&"number"===h.ctype?l.sub(a,h):"list"===a.ctype&&"list"===h.ctype?g.sub(a,h):k},mult:function(a,h){return"number"===a.ctype&&"number"===h.ctype?l.mult(a,h):"number"===a.ctype&&"list"===h.ctype?g.scalmult(a,h):"list"===a.ctype&&"number"===h.ctype?g.scalmult(h,a):"list"===a.ctype&&"list"===h.ctype?g.mult(a,h):k},div:function(a,h){return"number"===a.ctype&&"number"===h.ctype?l.div(a,h):"list"===a.ctype&&"number"===h.ctype?g.scaldiv(h,a):k},max:function(a,
h){return"number"===a.ctype&&"number"===h.ctype?l.max(a,h):"list"===a.ctype&&"list"===h.ctype?g.max(a,h):k},min:function(a,h){return"number"===a.ctype&&"number"===h.ctype?l.min(a,h):"list"===a.ctype&&"list"===h.ctype?g.min(a,h):k},wrap:function(a){if("number"===typeof a)return l.real(a);if("object"===typeof a&&void 0!==a.length){for(var h=[],c=0;c<a.length;c++)h[c]=w.wrap(a[c]);return g.turnIntoCSList(h)}return"string"===typeof a?{ctype:"string",value:a}:"boolean"===typeof a?{ctype:"boolean",value:a}:
k},unwrap:function(a){if("object"!==typeof a||null===a)return a;if(Array.isArray(a))return a.map(w.unwrap);switch(a.ctype){case "string":case "boolean":return a.value;case "number":return 0===a.value.imag?a.value.real:{r:a.value.real,i:a.value.imag};case "list":return a.value.map(w.unwrap);default:return null}},withUsage:function(a,h){return{ctype:a.ctype,value:a.value,usage:h}},wrapJSON:function(a){switch(typeof a){case "number":return l.real(a);case "string":return w.string(a);case "boolean":return w.bool(a);
case "object":if(null===a)return k;if(Array.isArray(a))return g.turnIntoCSList(a.map(w.wrapJSON));var h=Fa.create(),c;for(c in a)Fa.put(h,w.string(c),w.wrapJSON(a[c]));return h;default:return console.log("Failed to convert "+typeof a+" to CindyJS data type"),k}},identity:function(a){return a}},Wa={},O={};O[":"]=B(":");O["\u00b0"]=function(a,h){var c=D(a[0]);return"number"===c.ctype&&"void"===a[1].ctype?w.withUsage(l.realmult(Math.PI/180,c),"Angle"):k};O._=oc;O["^"]=Nc;O["\u221a"]=function(a,h){return"void"===
a[0].ctype?r.sqrt$1([a[1]],h):k};O["*"]=Lc;O["\u00d7"]=Tc;O["/"]=Mc;O["+"]=Kc;O["-"]=Zb;O["!"]=function(a,h){var c=D(a[1]);return"void"===a[0].ctype&&"boolean"===c.ctype?{ctype:"boolean",value:!c.value}:k};O["=="]=nb;O["~="]=Xb;O["~<"]=function(a,h){var c=D(a[0]),b=D(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real-b.value.real<=-l.eps}:k};O["~>"]=function(a,h){var c=D(a[0]),b=D(a[1]);return"number"===c.ctype&&
"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real-b.value.real>=l.eps}:k};O["=:="]=B("=:=");O[">="]=function(a,h){var c=D(a[0]),b=D(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real>=b.value.real}:"string"===c.ctype&&"string"===b.ctype?{ctype:"boolean",value:c.value>=b.value}:k};O["<="]=function(a,h){var c=D(a[0]),b=D(a[1]);return"number"===c.ctype&&
"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real<=b.value.real}:"string"===c.ctype&&"string"===b.ctype?{ctype:"boolean",value:c.value<=b.value}:k};O["~>="]=function(a,h){var c=D(a[0]),b=D(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real-b.value.real>-l.eps}:k};O["~<="]=function(a,h){var c=D(a[0]),b=D(a[1]);return"number"===c.ctype&&"number"===b.ctype&&
l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real-b.value.real<l.eps}:k};O[">"]=function(a,h){var c=D(a[0]),b=D(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real>b.value.real}:"string"===c.ctype&&"string"===b.ctype?{ctype:"boolean",value:c.value>b.value}:k};O["<"]=function(a,h){var c=D(a[0]),b=D(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&
l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real<b.value.real}:"string"===c.ctype&&"string"===b.ctype?{ctype:"boolean",value:c.value<b.value}:k};O["<>"]=Ic;O["\u2208"]=function(a,h){var c=A(a[0]),b=A(a[1]);return"list"===b.ctype?g.contains(b,c):k};O["\u2209"]=function(a,h){var c=A(a[0]),b=A(a[1]);return"list"===b.ctype?w.not(g.contains(b,c)):k};O["&"]=V;O["%"]=Jc;O["!="]=Ic;O["~!="]=function(a,h){return w.not(Xb(a,h))};O[".."]=function(a,h){var c=A(a[0]),b=A(a[1]);return"number"===c.ctype&&
"number"===b.ctype?g.sequence(c,b):k};O["++"]=Uc;O["--"]=Wc;O["~~"]=Vc;O[":>"]=Xc;O["<:"]=Yc;O["="]=mb;O[":="]=function(a,h,c){h="undefined"===a[1].ctype;if("undefined"===a[0].ctype||h)return k;if("function"===a[0].ctype){h=a[0].oper;var b=a[0].args,d=a[1],g=1;if(Wa.hasOwnProperty(h)){g=Wa[h];if(g.definer===c)return k;g=g.generation+1}Wa[h]={oper:h,body:d,arglist:b,definer:c,generation:g}}"variable"===a[0].ctype&&K.setvar(a[0].name,a[1]);return k};O[":=_"]=function(a,h){if("void"!==a[1].ctype)return k;
"function"===a[0].ctype&&delete Wa[a[0].oper];return k};O["::="]=B("::=");O[";"]=function(a,h){var c="void"===a[0].ctype,b="void"===a[1].ctype;if(c&&b)return k;if(!c&&b)return A(a[0]);c||b||A(a[0]);return b?k:A(a[1])};var r={},E={evaluate:function(a,h,c){if(Wa.hasOwnProperty(a)){a=Wa[a];if(void 0===a)h=k;else{var b=[];for(c=0;c<a.arglist.length;c++)b[c]=A(h[c]);for(c=0;c<a.arglist.length;c++)K.newvar(a.arglist[c].name),K.setvar(a.arglist[c].name,b[c]);K.pushVstack("*");h=A(a.body);K.cleanVstack();
for(c=0;c<a.arglist.length;c++)K.removevar(a.arglist[c].name)}return h}if(b=r[a])return b(h,c);var d=a.lastIndexOf("$");if(-1!==d&&(d=a.substr(0,d),b=r[d]))return b(h,c);ha.err("Called undefined function "+d+" (as "+a+")");return k},equals:function(a,h){return"number"===a.ctype&&"number"===h.ctype?{ctype:"boolean",value:a.value.real===h.value.real&&a.value.imag===h.value.imag}:"string"===a.ctype&&"string"===h.ctype||"boolean"===a.ctype&&"boolean"===h.ctype?{ctype:"boolean",value:a.value===h.value}:
"list"===a.ctype&&"list"===h.ctype?g.equals(a,h):"geo"===a.ctype&&"geo"===h.ctype?{ctype:"boolean",value:a.value===h.value}:{ctype:"boolean",value:!1}}},K={};K.vars=function(){var a={pi:l.real(Math.PI),"\u03c0":l.real(Math.PI),i:l.complex(0,1),"true":w.bool(!0),"false":w.bool(!1),"#":k,nil:g.turnIntoCSList([]),newline:w.string("\n"),tab:w.string("\t")},h=[],c;for(c in a)h[c]=[a[c]];return h}();K.isVariable=function(a){return this.vars.hasOwnProperty(a)};K.create=function(a){if(this.vars.hasOwnProperty(a))return this.vars[a];
var h=[null];return this.vars[a]=h};K.newvar=function(a){a=this.vars[a];a.push(k);return a};K.removevar=function(a){var h=this.vars[a];0===h.length&&console.error("Removing non-existing "+a);h.pop();0===h.length&&console.warn("Removing last "+a)};K.setvar=function(a,h){var c=this.vars[a];0===c.length&&console.error("Setting non-existing variable "+a);void 0===h&&(console.error("Setting variable "+a+" to undefined value"),h=k);if("undefined"===h.ctype)c[c.length-1]=h;else{var b=h;null===b&&(b=k);c[c.length-
1]=b}};K.undefinedWarning={};K.getvar=function(a){var h=this.vars[a];0===h.length&&console.error("Getting non-existing variable "+a);h=h[h.length-1];if(null===h){if(v.csnames.hasOwnProperty(a))return{ctype:"geo",value:v.csnames[a]};console&&console.log&&void 0===this.undefinedWarning[a]&&(this.undefinedWarning[a]=!0,console.log("Warning: Accessing undefined variable: "+a));return k}return h};K.dump=function(a){var h=this.vars[a];console.log("*** Dump "+a);for(a=0;a<h.length;a++)console.log(a+":> "+
Q(h[a]))};K.vstack=[];K.pushVstack=function(a){this.vstack.push(a)};K.popVstack=function(){this.vstack.pop()};K.cleanVstack=function(){for(var a=this.vstack;0<a.length&&"*"!==a[a.length-1];)this.removevar(a[a.length-1]),a.pop();0<a.length&&a.pop()};var wa={generalFields:{color:"color",colorhsb:"",size:"size",alpha:"alpha",fillcolor:"fillcolor",fillalpha:"fillalpha",isshowing:"isshowing",visible:"visible",name:"name",caption:"caption",trace:"",tracelength:"",selected:"",labeled:"labeled",labelled:"labeled"},
getGeoField:function(a,h){return"undefined"!==typeof v.csnames[a]?wa.getField(v.csnames[a],h):k},setGeoField:function(a,h,c){return"undefined"!==typeof v.csnames[a]?wa.setField(v.csnames[a],h,c):k},getField:function(a,h){var c;if("P"===a.kind){if("xy"===h)return c=g.dehom(a.homog),w.withUsage(c,"Point");if("homog"===h)return w.withUsage(a.homog,"Point");if("x"===h)return l.div(a.homog.value[0],a.homog.value[2]);if("y"===h)return l.div(a.homog.value[1],a.homog.value[2])}if("L"===a.kind||"S"===a.kind){if("homog"===
h)return w.withUsage(a.homog,"Line");if("angle"===h)return c=g.eucangle(g.ey,a.homog),w.withUsage(c,"Angle");if("slope"===h)return l.neg(l.div(a.homog.value[0],a.homog.value[1]))}if("Tr"===a.kind&&"matrix"===h)return a.matrix;if("C"===a.kind){if("radius"===h){var b=a.matrix;c=b.value[0].value[0];var d=b.value[0].value[2],e=b.value[1].value[2],b=b.value[2].value[2];l.mult(c,c);d=l.div(d,c);e=l.div(e,c);c=l.div(b,c);return c=l.sqrt(l.sub(l.add(l.mult(d,d),l.mult(e,e)),c))}if("size"===h)return a.size;
if("matrix"===h)return a.matrix;if("center"===h)return c=n._helper.CenterOfConic(a.matrix),c=g.dehom(c),w.withUsage(c,"Point");if("dualMatrix"===h)return g.normalizeMax(g.adjoint3(a.matrix))}if("Text"===a.kind){if("pressed"===h)return a.checkbox?w.bool(a.checkbox.checked):w.bool(!1);if("xy"===h)return c=g.dehom(a.homog),w.withUsage(c,"Point");if("homog"===h)return w.withUsage(a.homog,"Point");if("x"===h)return l.div(a.homog.value[0],a.homog.value[2]);if("y"===h)return l.div(a.homog.value[1],a.homog.value[2])}if("trace"===
h)return w.bool(!!a.drawtrace);if(wa.generalFields[h])return(c=a[wa.generalFields[h]])&&c.ctype?c:"object"!==typeof c?w.wrap(c):k;if(a.behavior){if("mass"===h&&"Mass"===a.behavior.type)return l.real(a.behavior.mass);if("radius"===h&&"Mass"===a.behavior.type)return l.real(a.behavior.radius);if("charge"===h&&"Mass"===a.behavior.type)return l.real(a.behavior.charge);if("friction"===h&&"Mass"===a.behavior.type)return l.real(a.behavior.friction);if("vx"===h&&"Mass"===a.behavior.type)return l.real(a.behavior.vx);
if("vy"===h&&"Mass"===a.behavior.type)return l.real(a.behavior.vy);if("v"===h&&"Mass"===a.behavior.type)return g.realVector([a.behavior.vx,a.behavior.vy]);if("fx"===h&&"Mass"===a.behavior.type)return l.real(a.behavior.fx);if("fy"===h&&"Mass"===a.behavior.type)return l.real(a.behavior.fy);if("f"===h&&"Mass"===a.behavior.type)return g.realVector([a.behavior.fx,a.behavior.fy])}c=n[a.type]["get_"+h];return"function"===typeof c?c(a):k},setField:function(a,h,c){"color"===h&&g._helper.isNumberVecN(c,3)&&
(a.color=c);"size"===h&&"number"===c.ctype&&(a.size=c);"alpha"===h&&"number"===c.ctype&&(a.alpha=c);"fillcolor"===h&&g._helper.isNumberVecN(c,3)&&(a.fillcolor=c);"fillalpha"===h&&"number"===c.ctype&&(a.fillalpha=c);"visible"===h&&"boolean"===c.ctype&&(a.visible=c.value);"pinned"===h&&"boolean"===c.ctype&&(a.pinned=c.value);"labeled"!==h&&"labelled"!==h||"boolean"!==c.ctype||(a.labeled=c.value);"printlabel"===h&&(a.printname=Q(c));"trace"===h&&"boolean"===c.ctype&&(c.value&&!a.drawtrace?(a.drawtrace=
!0,rd(a)):a.drawtrace=c.value);"P"===a.kind&&a.movable&&("xy"===h&&g._helper.isNumberVecN(c,2)&&Ca(a,g.turnIntoCSList([c.value[0],c.value[1],l.real(1)]),"homog"),"xy"===h&&g._helper.isNumberVecN(c,3)&&Ca(a,c,"homog"),"x"===h&&"number"===c.ctype&&Ca(a,g.turnIntoCSList([l.mult(c,a.homog.value[2]),a.homog.value[1],a.homog.value[2]]),"homog"),"y"===h&&"number"===c.ctype&&Ca(a,g.turnIntoCSList([a.homog.value[0],l.mult(c,a.homog.value[2]),a.homog.value[2]]),"homog"),"homog"===h&&g._helper.isNumberVecN(c,
3)&&Ca(a,c,"homog"));"homog"===h&&"L"===a.kind&&a.movable&&g._helper.isNumberVecN(c,3)&&Ca(a,c,"homog");"Text"===a.kind&&("pressed"===h&&"boolean"===c.ctype&&a.checkbox&&(a.checkbox.checked=c.value),a.movable&&("xy"===h?g._helper.isNumberVecN(c,2)?a.homog=g.turnIntoCSList([c.value[0],c.value[1],l.real(1)]):g._helper.isNumberVecN(c,3)&&(a.homog=c):"homog"===h&&g._helper.isNumberVecN(c,3)?a.homog=c:"x"===h&&"number"===c.ctype?a.homog=g.turnIntoCSList([l.mult(c,a.homog.value[2]),a.homog.value[1],a.homog.value[2]]):
"y"===h&&"number"===c.ctype&&(a.homog=g.turnIntoCSList([a.homog.value[0],l.mult(c,a.homog.value[2]),a.homog.value[2]]))));a.behavior&&("mass"===h&&"Mass"===a.behavior.type&&"number"===c.ctype&&(a.behavior.mass=c.value.real),"mass"===h&&"Sun"===a.behavior.type&&"number"===c.ctype&&(a.behavior.mass=c.value.real),"friction"===h&&"Mass"===a.behavior.type&&"number"===c.ctype&&(a.behavior.friction=c.value.real),"charge"===h&&"Mass"===a.behavior.type&&"number"===c.ctype&&(a.behavior.charge=c.value.real),
"radius"===h&&"Mass"===a.behavior.type&&"number"===c.ctype&&(a.behavior.radius=c.value.real),"vx"===h&&"Mass"===a.behavior.type&&"number"===c.ctype&&(a.behavior.vx=c.value.real),"vy"===h&&"Mass"===a.behavior.type&&"number"===c.ctype&&(a.behavior.vy=c.value.real),"v"===h&&"Mass"===a.behavior.type&&g._helper.isNumberVecN(c,2)&&(a.behavior.vx=c.value[0].value.real,a.behavior.vy=c.value[1].value.real));h=n[a.type]["set_"+h];if("function"===typeof h)return h(a,c)}};r.version$0=function(a,h){var c=["CindyJS"].concat(oe);
return g.turnIntoCSList(c.map(w.wrap))};r.clearconsole$0=function(a,h){ha.clear()};r.err$1=function(a,h){var c="",b;"variable"===a[0].ctype?(c=a[0].name,b=K.getvar(a[0].name)):b=a[0];b=c+" ===> "+Q(A(b));ha.err(b);return k};r.errc$1=function(a,h){var c;"variable"===a[0].ctype?(c=A(K.getvar(a[0].name)),console.log(a[0].name+" ===> "+Q(c))):(c=A(a[0]),console.log(" ===> "+Q(c)));return k};r.print$1=function(a,h){ha.out(Q(A(a[0])),!0);return k};r.println$1=function(a,h){ha.out(Q(A(a[0])));return k};
r.assert$2=function(a,h){var c=A(a[0]);if("boolean"===c.ctype){if(!1===c.value)return r.println$1([a[1]],h)}else ha.err("Condition for assert is not boolean");return k};r.dump$1=function(a,h){console.log(JSON.stringify(a[0]));return k};r.repeat$2=function(a,h){return r.repeat$3([a[0],null,a[1]],h)};r.repeat$3=function(a,h){var c=D(a[0]),b="#";null!==a[1]&&"variable"===a[1].ctype&&(b=a[1].name);if("number"!==c.ctype)return k;var c=Math.round(c.value.real),d=1,g=1,e=c+1,f=!1,l=!1,m=!1,n;void 0!==h.start&&
(n=A(h.start),"number"===n.ctype&&(f=!0,g=n.value.real));void 0!==h.step&&(n=A(h.step),"number"===n.ctype&&(m=!0,d=n.value.real));void 0!==h.stop&&(n=A(h.stop),"number"===n.ctype&&(l=!0,e=n.value.real));!f||l||m||(e=d*c+g);f||!l||m||(g=-d*(c-1)+e,e+=d);f||l||!m||(e=d*c+g);f&&l&&!m&&(d=(e-g)/(c-1),e+=d);f&&!l&&m&&(e=d*c+g);!f&&l&&m&&(g=-d*(c-1)+e,e+=d);f&&l&&m&&(e+=d);(g<=e&&0<d||g>=e&&0>d)&&f&&l&&m&&(c=Math.floor((e-g)/d));K.newvar(b);e=k;for(f=0;f<c;f++)K.setvar(b,{ctype:"number",value:{real:f*d+
g,imag:0}}),e=A(a[2]);K.removevar(b);return e};r.while$2=function(a,h){for(var c=a[1],b=a[0],d=A(b),e=k;"list"!==d.ctype&&d.value;)e=A(c),d=A(b);return e};r.apply$2=function(a,h){return r.apply$3([a[0],null,a[1]],h)};r.apply$3=function(a,h){var c=D(a[0]);if("list"!==c.ctype)return k;var b="#";null!==a[1]&&"variable"===a[1].ctype&&(b=a[1].name);var c=c.value,d=[];K.newvar(b);for(var e=0;e<c.length;e++)K.setvar(b,c[e]),d[e]=A(a[2]);K.removevar(b);return{ctype:"list",value:d}};r.forall$2=function(a,
h){return r.forall$3([a[0],null,a[1]],h)};r.forall$3=function(a,h){var c=D(a[0]);if("list"!==c.ctype)return k;var b="#";null!==a[1]&&"variable"===a[1].ctype&&(b=a[1].name);c=c.value;K.newvar(b);for(var d,e=0;e<c.length;e++)K.setvar(b,c[e]),d=A(a[2]);K.removevar(b);return d};r.select$2=function(a,h){return r.select$3([a[0],null,a[1]],h)};r.select$3=function(a,h){var c=D(a[0]);if("list"!==c.ctype)return k;var b="#";null!==a[1]&&"variable"===a[1].ctype&&(b=a[1].name);var c=c.value,d=[];K.newvar(b);for(var e=
0,g=0;g<c.length;g++){K.setvar(b,c[g]);var f=A(a[2]);"boolean"===f.ctype&&!0===f.value&&(d[e]=c[g],e++)}K.removevar(b);return{ctype:"list",value:d}};r.flatten$1=function(a,h){function c(a,h){return-1===h||"list"!==a.ctype?a:[].concat.apply([],a.value.map(function(a){return c(a,h-1)}))}var b=D(a[0]);if("list"!==b.ctype)return b;var d=h.levels;void 0===d?d=1:(d=A(d),d="number"===d.ctype?d.value.real:"string"===d.ctype&&"all"===d.value?-2:1);return{ctype:"list",value:c(b,d)}};r.createvar$1=function(a,
h){"variable"===a[0].ctype&&K.newvar(a[0].name);return k};r.local=function(a,h){for(var c=0;c<a.length;c++)"variable"===a[c].ctype&&K.newvar(a[c].name);return k};r.removevar$1=function(a,h){var c=A(a[0]);"variable"===a[0].ctype&&K.removevar(a[0].name);return c};r.release=function(a,h){if(0===a.length)return k;for(var c=A(a[a.length-1]),b=0;b<a.length;b++)"variable"===a[b].ctype&&K.removevar(a[b].name);return c};r.regional=function(a,h){for(var c=0;c<a.length;c++)if("variable"===a[c].ctype){var b=
a[c].name;K.newvar(b);K.pushVstack(b)}return k};r.genList=function(a,h){return g.turnIntoCSList(a.map(A))};E.assigntake=function(a,h){var c=a.args[0],b=A(c),d=D(a.args[1]),e=k;if("list"===b.ctype||"string"===b.ctype)d=Math.floor(d.value.real),0>d&&(d=b.value.length+d+1),0<d&&d<=b.value.length&&("list"===b.ctype?(b=b.value.slice(),b[d-1]=A(h),e=g.turnIntoCSList(b)):(b=b.value,b=b.substring(0,d-1)+Q(A(h))+b.substring(d,b.length),e=w.string(b)));mb([c,e])};E.assigndot=function(a,h){var c=A(a.obj),b=
a.key;"geo"===c.ctype&&b&&wa.setField(c.value,b,D(h));return k};E.assignlist=function(a,h){var c=a.length,b=h.length;b<c&&(c=b);for(b=0;b<c;b++)mb([a[b],h[b]],[])};r.if$2=function(a,h){return r.if$3(a,h)};r.if$3=function(a,h){var c=D(a[0]);if("boolean"===c.ctype){if(!0===c.value)return A(a[1]);if(3===a.length)return A(a[2])}else ha.err("Condition for if is not boolean");return k};r.and$2=V;r.or$2=Jc;r.xor$2=function(a,h){var c=D(a[0]),b=D(a[1]);return"boolean"===c.ctype&&"boolean"===b.ctype?{ctype:"boolean",
value:c.value!==b.value}:k};r.not$1=function(a,h){var c=D(a[0]);return"boolean"===c.ctype?{ctype:"boolean",value:!c.value}:k};E.genericListMathGen=function(a,h,c){r[a+"$1"]=function(a,b){var d=A(a[0]);if("list"!==d.ctype)return k;d=d.value;if(0===d.length)return c;for(var q=d[0],e=1;e<d.length;e++)q=h(q,d[e]);return q};var b=a+"$3";r[a+"$2"]=function(a,c){return r[b]([a[0],null,a[1]])};r[b]=function(a,b){var d=D(a[0]);if("list"!==d.ctype)return k;d=d.value;if(0===d.length)return c;var q="#";null!==
a[1]&&"variable"===a[1].ctype&&(q=a[1].name);K.newvar(q);K.setvar(q,d[0]);for(var e=A(a[2]),g=1;g<d.length;g++){K.setvar(q,d[g]);var f=A(a[2]),e=h(e,f)}K.removevar(q);return e}};E.genericListMathGen("product",w.mult,l.real(1));E.genericListMathGen("sum",w.add,l.real(0));E.genericListMathGen("max",w.max,k);E.genericListMathGen("min",w.min,k);r.max$2=function(a,h){var c=D(a[0]);if("list"===c.ctype)return r.max$3([c,null,a[1]]);var b=D(a[1]);return r.max$1([g.turnIntoCSList([c,b])])};r.min$2=function(a,
h){var c=D(a[0]);if("list"===c.ctype)return r.min$3([c,null,a[1]]);var b=D(a[1]);return r.min$1([g.turnIntoCSList([c,b])])};r.add$2=Kc;r.sub$2=Zb;r.mult$2=Lc;r.div$2=Mc;r.mod$2=function(a,h){var c=D(a[0]),b=D(a[1]);return"number"===c.ctype&&"number"===b.ctype?l.mod(c,b):k};r.pow$2=Nc;r.exp$1=function(a,h){var c=D(a[0]);return"number"===c.ctype?l.exp(c):k};r.sin$1=function(a,h){var c=D(a[0]);return"number"===c.ctype?l.sin(c):k};r.sqrt$1=function(a,h){var c=D(a[0]);return"number"===c.ctype?l.sqrt(c):
k};E.laguerre=function(a,h,c){if("list"!==a.ctype)return k;var b=a.value.length-1,d;for(d=0;d<=b;d++)if("number"!==a.value[d].ctype)return k;if("number"!==h.ctype)return k;for(var e=[1,.3141,.5926,.5358,.9793,.2385,.6264,.3383,.2795,.0288],g,f,m,n=1;n<=c;n++){f=m=l.zero;g=a.value[b];for(d=b-1;0<=d;d--)m=l.add(f,l.mult(m,h)),f=l.add(g,l.mult(f,h)),g=l.add(a.value[d],l.mult(g,h));if(l._helper.isLessThan(l.abs(g),l.real(1E-14)))break;d=l.div(f,g);f=l.mult(d,d);g=l.sub(f,l.div(l.mult(l.real(2),m),g));
m=l.sqrt(l.mult(l.real(b-1),l.sub(l.mult(l.real(b),g),f)));g=l.add(d,m);d=l.sub(d,m);l._helper.isLessThan(l.abs(g),l.abs(d))&&(g=d);d=l._helper.isLessThan(l.real(1E-14),l.abs(g))?l.div(l.real(b),g):l.mult(l.add(l.abs(h),l.one),l.complex(Math.cos(n),Math.sin(n)));if(l._helper.isLessThan(l.abs(d),l.real(1E-14)))break;0===n%20&&n<c-19&&(d=l.mult(d,l.real(e[Math.floor(n/20)])));h=l.sub(h,d)}return h};E.quadratic_roots=function(a){if("list"!==a.ctype)return k;var h=a.value[2],c=a.value[1];a=a.value[0];
if(l._helper.isZero(a))return[l.zero,l.neg(l.div(c,h))];var b=l.sqrt(l.sub(l.mult(c,c),l.mult(l.real(4),l.mult(h,a))));0<=l.re(c)&&(b=l.neg(b));return[l.div(l.sub(b,c),l.mult(l.real(2),h)),l.div(l.mult(l.real(2),a),l.sub(b,c))]};E.roots=function(a){var h=[],c=a,b=a.value.length-1;if(0>=b)return g.turnIntoCSList([]);if(l._helper.isZero(a.value[b]))return h=E.roots(g.turnIntoCSList(a.value.slice(0,b))),g.append(h,l.infinity);if(1===b)h[0]=l.neg(l.div(a.value[0],a.value[1]));else if(2===b)h=E.quadratic_roots(a);
else{for(var d=0;d<b-2;d++){h[d]=E.laguerre(a,l.zero,200);h[d]=E.laguerre(c,h[d],1);var e=[];e[b-d]=a.value[b-d];for(var f=b-d;0<f;f--)e[f-1]=l.add(a.value[f-1],l.mult(e[f],h[d]));e.shift();a=g.turnIntoCSList(e)}a=E.quadratic_roots(a);h[b-2]=a[0];h[b-1]=a[1]}return g.turnIntoCSList(h)};r.roots$1=function(a,h){var c=D(a[0]);if("list"===c.ctype){for(var b=0;b<c.value.length;b++)if("number"!==c.value[b].ctype)return k;c=E.roots(c);return g.sort1(c)}return k};r.autodiff$3=function(a,h){var c="x",b;if("function"===
a[0].ctype)b=Wa[a[0].oper].body,c=a[0].args[0].name;else if("function"===typeof a[0].impl)b=a[0];else return console.log("could not parse function"),k;var d=D(a[1]),e=D(a[2]);if(1>e.value.real)return console.log("grade cant be < 1"),k;e=l.add(e,l.real(1));return N.autodiff(b,c,d,e)};r.cos$1=function(a,h){var c=D(a[0]);return"number"===c.ctype?l.cos(c):k};r.tan$1=function(a,h){var c=D(a[0]);return"number"===c.ctype?l.tan(c):k};r.arccos$1=function(a,h){var c=D(a[0]);return"number"===c.ctype?l.arccos(c):
k};r.arcsin$1=function(a,h){var c=D(a[0]);return"number"===c.ctype?l.arcsin(c):k};r.arctan$1=function(a,h){var c=D(a[0]);return"number"===c.ctype?l.arctan(c):k};r.arctan2$2=function(a,h){var c=D(a[0]),b=D(a[1]);return"number"===c.ctype&&"number"===b.ctype?l.arctan2(c,b):k};r.arctan2$1=function(a,h){var c=D(a[0]);if("list"===c.ctype&&2===c.value.length){if(c=c.value,"number"===c[0].ctype&&"number"===c[1].ctype)return r.arctan2$2(c,h)}else if("number"===c.ctype)return l.arctan2(c);return k};r.log$1=
function(a,h){var c=D(a[0]);return"number"===c.ctype?l.log(c):k};E.recursiveGen=function(a){var h=l[a],c=g[a];r[a+"$1"]=function(a,b){var d=D(a[0]);return"number"===d.ctype?h(d):"list"===d.ctype?c(d):k}};E.recursiveGen("im");E.recursiveGen("re");E.recursiveGen("conjugate");E.recursiveGen("round");E.recursiveGen("ceil");E.recursiveGen("floor");E.recursiveGen("abs");r.abs_infix=r.abs$1;r.random$0=function(a,h){return l.real(l._helper.rand())};r.random$1=function(a,h){var c=D(a[0]);return"number"===
c.ctype?l.complex(c.value.real*l._helper.rand(),c.value.imag*l._helper.rand()):k};r.seedrandom$1=function(a,h){var c=D(a[0]);"number"===c.ctype&&l._helper.seedrandom(c.value.real);return k};r.randomnormal$0=function(a,h){return l.real(l._helper.randnormal())};r.randominteger$1=function(a,h){var c=D(a[0]);if("number"===c.ctype){var b=c.value.real|0,c=c.value.imag|0,b=b*l._helper.rand()|0,c=c*l._helper.rand()|0;return l.complex(b,c)}return k};r.randomint$1=r.randominteger$1;r.randombool$0=function(a,
h){return.5<l._helper.rand()?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isreal$1=function(a,h){var c=A(a[0]);return"number"===c.ctype&&l._helper.isAlmostReal(c)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isinteger$1=function(a,h){var c=A(a[0]);return"number"===c.ctype&&l._helper.isAlmostReal(c)&&c.value.real===Math.floor(c.value.real)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.iseven$1=function(a,h){var c=A(a[0]);return"number"===c.ctype&&l._helper.isAlmostReal(c)&&
c.value.real/2===Math.floor(c.value.real/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isodd$1=function(a,h){var c=A(a[0]);return"number"===c.ctype&&l._helper.isAlmostReal(c)&&(c.value.real-1)/2===Math.floor((c.value.real-1)/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.iscomplex$1=function(a,h){return"number"===A(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isstring$1=function(a,h){return"string"===A(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",
value:!1}};r.islist$1=function(a,h){return"list"===A(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.ismatrix$1=function(a,h){var c=A(a[0]);return-1!==g._helper.colNumb(c)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.iscircle$1=function(a,h){var c=A(a[0]);return"geo"===c.ctype&&"C"===c.value.kind&&"Circle"===c.value.matrix.usage?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isconic$1=function(a,h){var c=A(a[0]);return"geo"===c.ctype&&"C"===c.value.kind?
{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isline$1=function(a,h){var c=A(a[0]);return"geo"===c.ctype&&"L"===c.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.ispoint$1=function(a,h){var c=A(a[0]);return"geo"===c.ctype&&"P"===c.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isgeometric$1=function(a,h){return"geo"===A(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isnumbermatrix$1=function(a,h){var c=A(a[0]);return g.isNumberMatrix(c)};
r.isnumbervector$1=function(a,h){var c=A(a[0]);return g.isNumberVector(c)};r.issun$1=function(a,h){var c=A(a[0]);return"geo"===c.ctype&&void 0!==c.value.behavior&&"Sun"===c.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.ismass$1=function(a,h){var c=A(a[0]);return"geo"===c.ctype&&void 0!==c.value.behavior&&"Mass"===c.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isspring$1=function(a,h){var c=A(a[0]);return"geo"===c.ctype&&void 0!==c.value.behavior&&
"Spring"===c.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isbouncer$1=function(a,h){var c=A(a[0]);return"geo"===c.ctype&&void 0!==c.value.behavior&&"Bouncer"===c.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isundefined$1=function(a,h){return"undefined"===A(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};var Id={ArcBy3:"Arc",CenterOfConic:"Center",ConicBy1p4l:"Conic1P4L",ConicBy4p1l:"Conic4P1L",ConicBy5lines:"Conic5L",
ConicBy2Foci1P:"ConicFoci",ConicFromPrincipalDirections:"ConicPrincipleDirs",Free:"FreePoint",PolarOfLine:"PolarLine",PolarOfPoint:"PolarPoint",PointOnSegment:"PointOnLine",Button:"Text",ToggleButton:"Text",TrReflectionL:"TrReflection",TrReflectionP:"TrReflection",TrReflectionC:"TrReflection",TrTranslation:"TrProjection",TrSimilarity:"TrProjection",TrAffine:"TrProjection",TransformP:"Transform",TransformL:"Transform",TransformSegment:"Transform",TransformS:"Transform",TransformPolygon:"Transform",
TransformArc:"Transform",TransformConic:"Transform",TransformC:"Transform",TrMoebiusP:"Transform",TrMoebiusL:"Transform",TrMoebiusSegment:"Transform",TrMoebiusS:"Transform",TrMoebiusPolygon:"Transform",TrMoebiusArc:"Transform",TrMoebiusCircle:"Transform",TrMoebiusC:"Transform",TrInverseMoebius:"TrInverse",Perp:"Orthogonal",Para:"Parallel",AngleBisector:"AngularBisector",IntersectLC:"IntersectionConicLine",IntersectCirCir:"IntersectionCircleCircle",OtherPointOnCircle:"PointOnCircle"};r.algorithm$1=
function(a,h){var c=A(a[0]);if("geo"===c.ctype){var c=c.value,b=c.type,d=D(h.compatibility);"string"===d.ctype&&/^cinderella$/i.test(d.value)&&(/^Select/.test(b)&&(c=v.csnames[c.args[0]],b=c.type),Id.hasOwnProperty(b)?b=Id[b]:"CircleMr"===b&&(b=c.pinned?"CircleByFixedRadius":"CircleByRadius"));return w.string(b)}return k};r.inputs$1=function(a,h){var c=A(a[0]);if("geo"===c.ctype){var c=c.value,b=c.type,d=[];c.args&&(d=c.args.map(function(a){return{ctype:"geo",value:v.csnames[a]}}));if(/^Select/.test(b)||
n[b].isMovable)switch(c.kind){case "P":case "L":d.push(c.homog);break;case "C":d.push(c.matrix)}return g.turnIntoCSList(d)}return k};r.moveto$2=function(a,h){var c=A(a[0]),b=D(a[1]);"geo"===c.ctype&&(c=c.value,g._helper.isNumberVecN(b,2)?wa.setField(c,"xy",b):g._helper.isNumberVecN(b,3)&&wa.setField(c,"homog",b));return k};r.continuefromhere$0=function(a,h){tb();return k};r.matrixrowcolumn$1=function(a,h){var c=A(a[0]);return-1!==g._helper.colNumb(c)?g.realVector([c.value.length,c.value[0].value.length]):
k};r.rowmatrix$1=function(a,h){var c=A(a[0]);return"list"===c.ctype?g.turnIntoCSList([c]):k};r.columnmatrix$1=function(a,h){var c=A(a[0]);return"list"===c.ctype?g.turnIntoCSList(c.value.map(function(a){return g.turnIntoCSList([a])})):k};r.submatrix$3=function(a,h){var c=A(a[0]),b=A(a[1]),d=A(a[2]);if("list"===c.ctype&&"number"===b.ctype&&"number"===d.ctype){var e=Math.round(b.value.real),b=Math.round(d.value.real),c=c.value.slice();0<b&&b<=c.length&&c.splice(b-1,1);var f=!0,c=c.map(function(a){if("list"!==
a.ctype)f=!1;else return a=a.value.slice(),0<e&&e<=a.length&&a.splice(e-1,1),g.turnIntoCSList(a)});return f?g.turnIntoCSList(c):k}return k};r.complex$1=function(a,h){var c,b,d;d=D(a[0]);if("list"===d.ctype&&g.isNumberVector(d)){if(2===d.value.length)return c=d.value[0],b=d.value[1],l.complex(c.value.real-b.value.imag,b.value.real+c.value.imag);if(3===d.value.length)return c=d.value[0],b=d.value[1],d=d.value[2],c=l.div(c,d),b=l.div(b,d),l.complex(c.value.real-b.value.imag,b.value.real+c.value.imag)}return k};
r.gauss$1=function(a,h){var c=D(a[0]);return"number"===c.ctype?g.realVector([c.value.real,c.value.imag]):k};r.cross$2=Tc;r.crossratio$4=function(a,h){var c=A(a[0]),b=A(a[1]),d=A(a[2]),e=A(a[3]),f=L(c),m=L(b),n=L(d),p=L(e);return f!==k&&m!==k&&n!==k&&p!==k?g.crossratio3(f,m,n,p,g.ii):"number"===c.ctype&&"number"===b.ctype&&"number"===d.ctype&&"number"===e.ctype?l.div(l.mult(l.sub(c,d),l.sub(b,e)),l.mult(l.sub(c,e),l.sub(b,d))):k};r.para$2=function(a,h){var c=D(a[0]),b=D(a[1]),d=L(c),e=L(b);if(c!==
k&&b!==k){var b=b.usage,f=d,l=e;if("Line"===c.usage||"Point"===b)f=e,l=d;c=g.cross(g.cross(g.linfty,l),f);return w.withUsage(c,"Line")}return k};r.perp$2=function(a,h){var c=D(a[0]),b=D(a[1]),d=L(c),e=L(b);if(c!==k&&b!==k){var f=b.usage||e.usage,b=d,m=e;if("Line"===(c.usage||d.usage)||"Point"===f)b=e,m=d;c=g.turnIntoCSList([m.value[0],m.value[1],l.zero]);c=g.cross(c,b);return w.withUsage(c,"Line")}return k};r.perp$1=function(a,h){var c=D(a[0]);return g._helper.isNumberVecN(c,2)?g.turnIntoCSList([l.neg(c.value[1]),
c.value[0]]):k};r.parallel$2=r.para$2;r.perpendicular$2=r.perp$2;r.perpendicular$1=r.perp$1;r.meet$2=function(a,h){var c=L(a[0]),b=L(a[1]);return c!==k&&b!==k?(c=g.cross(c,b),w.withUsage(c,"Point")):k};r.join$2=function(a,h){var c=L(a[0]),b=L(a[1]);return c!==k&&b!==k?(c=g.cross(c,b),w.withUsage(c,"Line")):k};r.dist$2=function(a,h){var c=D(a[0]),b=D(a[1]),c=Zb([c,b],[]);return r.abs$1([c],[])};r.dist_infix=r.dist$2;r.point$1=function(a,h){var c=A(a[0]);return g._helper.isNumberVecN(c,3)||g._helper.isNumberVecN(c,
2)?w.withUsage(c,"Point"):c};r.line$1=function(a,h){var c=A(a[0]);return g._helper.isNumberVecN(c,3)?w.withUsage(c,"Line"):c};r.det$3=function(a,h){var c=L(a[0]),b=L(a[1]),d=L(a[2]);if(c!==k&&b!==k&&d!==k)return g.det3(c,b,d)};r.det$1=function(a,h){var c=D(a[0]);if("list"===c.ctype){var b=g._helper.colNumb(c);if(-1!==b&&b===c.value.length)return g.det(c)}return k};r.eig$1=function(a,h){var c=D(a[0]);if("list"===c.ctype){var b=g._helper.colNumb(c);if(-1!==b&&b===c.value.length)return g.eig(c)}return k};
r.eigenvalues$1=function(a,h){var c=D(a[0]);if("list"===c.ctype){var b=g._helper.colNumb(c);if(-1!==b&&b===c.value.length)return g.eig(c,!1).value[0]}return k};r.rank$1=function(a,h){var c=D(a[0]);if("list"===c.ctype){var b=g._helper.colNumb(c);if(-1!==b&&b===c.value.length)return g.rank(c,h.precision)}return k};r.kernel$1=function(a,h){var c=D(a[0]);if("list"===c.ctype){var b=g._helper.colNumb(c);if(-1!==b&&b===c.value.length)return c=g.nullSpace(c,h.precision),g.transpose(c)}return k};r.eigenvectors$1=
function(a,h){var c=D(a[0]);if("list"===c.ctype){var b=g._helper.colNumb(c);if(-1!==b&&b===c.value.length)return g.eig(c).value[1]}return k};r.area$3=function(a,h){var c=L(a[0]),b=L(a[1]),d=L(a[2]);if(c!==k&&b!==k&&d!==k){var e=c.value[2],f=b.value[2],m=d.value[2];if(!l._helper.isAlmostZero(e)&&!l._helper.isAlmostZero(f)&&!l._helper.isAlmostZero(m))return c=g.scaldiv(e,c),b=g.scaldiv(f,b),d=g.scaldiv(m,d),c=g.det3(c,b,d),l.realmult(.5,c)}return k};r.inverse$1=function(a,h){var c=D(a[0]);if("list"===
c.ctype){var b=g._helper.colNumb(c);if(-1!==b&&b===c.value.length)return g.inverse(c)}return k};r.linearsolve$2=function(a,h){var c=D(a[0]),b=D(a[1]);if("list"===c.ctype){var d=g._helper.colNumb(c);if(-1!==d&&d===c.value.length&&g._helper.isNumberVecN(b,d))return g.linearsolve(c,b)}return k};var Vd=[[[]],[[0]],[[0,1],[1,0]],[[0,1,2],[0,2,1],[1,0,2],[1,2,0],[2,0,1],[2,1,0]],[[0,1,2,3],[0,1,3,2],[0,2,1,3],[0,2,3,1],[0,3,1,2],[0,3,2,1],[1,0,2,3],[1,0,3,2],[1,2,0,3],[1,2,3,0],[1,3,0,2],[1,3,2,0],[2,0,
1,3],[2,0,3,1],[2,1,0,3],[2,1,3,0],[2,3,0,1],[2,3,1,0],[3,0,1,2],[3,0,2,1],[3,1,0,2],[3,1,2,0],[3,2,0,1],[3,2,1,0]]];r.mincostmatching$1=function(a,h){var c=A(a[0]);if(g.isNumberMatrix(c).value){var b=c.value.length,d=g._helper.colNumb(c),e=b<d?d:b,f,m,n=Array(e);for(f=0;f<e;++f)for(n[f]=Array(e),m=0;m<e;++m)n[f][m]=f<b&&m<d?c.value[f].value[m].value.real:0;c=nc(n);e=Array(b);for(f=0;f<b;++f)m=c[f],e[f]=m<d?l.real(m+1):l.real(0);return g.turnIntoCSList(e)}return k};r.take$2=oc;r.length$1=function(a,
h){var c=A(a[0]);return"list"===c.ctype||"string"===c.ctype?l.real(c.value.length):k};r.pairs$1=function(a,h){var c=A(a[0]);return"list"===c.ctype?g.pairs(c):k};r.triples$1=function(a,h){var c=A(a[0]);return"list"===c.ctype?g.triples(c):k};r.cycle$1=function(a,h){var c=A(a[0]);return"list"===c.ctype?g.cycle(c):k};r.consecutive$1=function(a,h){var c=A(a[0]);return"list"===c.ctype?g.consecutive(c):k};r.reverse$1=function(a,h){var c=A(a[0]);return"list"===c.ctype?g.reverse(c):k};r.directproduct$2=function(a,
h){var c=A(a[0]),b=A(a[1]);return"list"===c.ctype&&"list"===b.ctype?g.directproduct(c,b):k};r.concat$2=Uc;r.common$2=Vc;r.remove$2=Wc;r.append$2=Xc;r.prepend$2=Yc;r.contains$2=function(a,h){var c=A(a[0]),b=A(a[1]);return"list"===c.ctype?g.contains(c,b):k};r.sort$2=function(a,h){return r.sort$3([a[0],null,a[1]],h)};r.sort$3=function(a,h){var c=D(a[0]);if("list"!==c.ctype)return k;var b="#";null!==a[1]&&"variable"===a[1].ctype&&(b=a[1].name);var c=c.value,d=[];K.newvar(b);var e;for(e=0;e<c.length;e++)K.setvar(b,
c[e]),d[e]={val:c[e],result:A(a[2])};K.removevar(b);d.sort(w.compareResults);b=[];for(e=0;e<c.length;e++)b[e]=d[e].val;return{ctype:"list",value:b}};r.sort$1=function(a,h){var c=A(a[0]);return"list"===c.ctype?g.sort1(c):k};r.set$1=function(a,h){var c=A(a[0]);return"list"===c.ctype?g.set(c):k};r.combinations$2=function(a,h){function c(a,h){a===f?n.push(g.turnIntoCSList(m.slice())):h<e&&(m[a]=b.value[h],c(a+1,h+1),c(a,h+1))}var b=A(a[0]),d=A(a[1]),e,f,m,n;if("number"===d.ctype){f=d.value.real|0;if("number"===
b.ctype){e=b.value.real|0;e-f<f&&(f=e-f);if(0>f)return l.real(0);if(0===f)return l.real(1);if(1===f)return b;for(var p=d=1,r=1;r<=f;++r)var t=e-f+r|0,v=r|0,u=pc(t,v)|0,t=t/u|0,v=v/u|0,u=pc(d,v)|0,d=d/u|0,v=v/u|0,u=pc(t,p)|0,t=t/u|0,p=p/u|0,d=d*t|0,p=p*v|0;return l.real(d/p)}if("list"===b.ctype){e=b.value.length;if(0>f||f>e)return g.turnIntoCSList([]);if(0===f)return g.turnIntoCSList([g.turnIntoCSList([])]);if(f===e)return g.turnIntoCSList([b]);n=[];m=Array(f);c(0,0);return g.turnIntoCSList(n)}}return k};
r.zeromatrix$2=function(a,h){var c=D(a[0]),b=D(a[1]);return"number"===c.ctype&&"number"===b.ctype?g.zeromatrix(c,b):k};r.zerovector$1=function(a,h){var c=D(a[0]);return"number"===c.ctype?g.zerovector(c):k};r.transpose$1=function(a,h){var c=D(a[0]);return"list"===c.ctype&&-1!==g._helper.colNumb(c)?g.transpose(c):k};r.row$2=function(a,h){var c=D(a[0]),b=D(a[1]);return"number"===b.ctype&&"list"===c.ctype&&-1!==g._helper.colNumb(c)?g.row(c,b):k};r.column$2=function(a,h){var c=D(a[0]),b=D(a[1]);return"number"===
b.ctype&&"list"===c.ctype&&-1!==g._helper.colNumb(c)?g.column(c,b):k};r.dict$0=function(a,h){var c=Fa.create(),b;for(b in h)h.hasOwnProperty(b)&&Fa.put(c,w.string(b),A(h[b]));return c};r.put$3=function(a,h){var c=A(a[0]),b=A(a[1]),d=A(a[2]);return"dict"===c.ctype?(c=Fa.clone(c),Fa.put(c,b,d),c):k};r.get$2=function(a,h){var c=A(a[0]),b=A(a[1]);return"dict"===c.ctype?Fa.get(c,b,k):k};r.red$1=function(a,h){var c=A(a[0]);return"number"===c.ctype?g.realVector([Math.min(1,Math.max(0,c.value.real)),0,0]):
k};r.green$1=function(a,h){var c=A(a[0]);return"number"===c.ctype?g.realVector([0,Math.min(1,Math.max(0,c.value.real)),0]):k};r.blue$1=function(a,h){var c=A(a[0]);return"number"===c.ctype?g.realVector([0,0,Math.min(1,Math.max(0,c.value.real))]):k};r.gray$1=function(a,h){var c=A(a[0]);return"number"===c.ctype?(c=Math.min(1,Math.max(0,c.value.real)),g.realVector([c,c,c])):k};r.grey$1=r.gray$1;E.HSVtoRGB=function(a,h,c){var b,d,e,f,l,k;a&&void 0===h&&void 0===c&&(h=a.s,c=a.v,a=a.h);f=Math.floor(6*a);
l=6*a-f;a=c*(1-h);k=c*(1-l*h);h=c*(1-(1-l)*h);switch(f%6){case 0:b=c;d=h;e=a;break;case 1:b=k;d=c;e=a;break;case 2:b=a;d=c;e=h;break;case 3:b=a;d=k;e=c;break;case 4:b=h;d=a;e=c;break;case 5:b=c,d=a,e=k}return g.realVector([b,d,e])};r.hue$1=function(a,h){var c=A(a[0]);return"number"===c.ctype?(c=c.value.real,c-=Math.floor(c),E.HSVtoRGB(c,1,1)):k};E.shapeconvert=function(a){var h,c;if("circle"===a.type){h=a.value.value[0];h=w.div(h,h.value[2]);var b=h.value[0].value.real,d=h.value[1].value.real;a=a.value.value[1].value.real;
c=Array(125);var e=2*Math.PI/125;for(h=0;125>h;h++)c[h]={X:b+Math.cos(h*e)*a,Y:d+Math.sin(h*e)*a};return[c]}if("polygon"===a.type){b=[];for(h=0;h<a.value.length;h++){d=a.value[h];c=[];for(e=0;e<d.length;e++)c[e]={X:d[e].X,Y:d[e].Y};b[h]=c}return b}};E.shapeop=function(a,h,c){a=E.shapeconvert(a);var b=E.shapeconvert(h);ClipperLib.JS.ScaleUpPaths(a,1E3);ClipperLib.JS.ScaleUpPaths(b,1E3);h=new ClipperLib.Clipper;h.AddPaths(a,ClipperLib.PolyType.ptSubject,!0);h.AddPaths(b,ClipperLib.PolyType.ptClip,!0);
var b=a=ClipperLib.PolyFillType.pftNonZero,d=new ClipperLib.Paths;h.Execute(c,d,a,b);ClipperLib.JS.ScaleDownPaths(d,1E3);return{ctype:"shape",type:"polygon",value:d}};E.shapecommon=function(a,h){return E.shapeop(a,h,ClipperLib.ClipType.ctIntersection)};E.shaperemove=function(a,h){return E.shapeop(a,h,ClipperLib.ClipType.ctDifference)};E.shapeconcat=function(a,h){return E.shapeop(a,h,ClipperLib.ClipType.ctUnion)};r.key$0=function(a,h){return{ctype:"string",value:Rc}};r.keycode$0=function(a,h){return l.real(Sc)};
r.mouse$0=function(a,h){return g.realVector([ra[0],ra[1]])};r.mover$0=function(a,h){if(da&&da.mover)return{ctype:"geo",value:da.mover};console.log("Not moving anything at the moment");return k};r.translate$1=function(a,h){var c=D(a[0]);"list"===c.ctype&&g.isNumberVector(c)&&2===c.value.length&&z.translate(c.value[0].value.real,c.value[1].value.real);return k};r.rotate$1=function(a,h){var c=D(a[0]);"number"===c.ctype&&z.rotate(c.value.real);return k};r.scale$1=function(a,h){var c=D(a[0]);"number"===
c.ctype&&z.scale(c.value.real);return k};r.greset$0=function(a,h){var c=Xa.stack.length;z.greset();for(var b=0;b<c;b++)y.restore();return k};r.gsave$0=function(a,h){z.gsave();y.save();return k};r.grestore$0=function(a,h){z.grestore();y.restore();return k};r.color$1=function(a,h){var c=D(a[0]);"list"===c.ctype&&g.isNumberVector(c).value&&z.setcolor(c);return k};r.linecolor$1=function(a,h){var c=D(a[0]);"list"===c.ctype&&g.isNumberVector(c).value&&z.setlinecolor(c);return k};r.pointcolor$1=function(a,
h){var c=D(a[0]);"list"===c.ctype&&g.isNumberVector(c).value&&z.setpointcolor(c);return k};r.alpha$1=function(a,h){var c=D(a[0]);"number"===c.ctype&&z.setalpha(c);return k};r.pointsize$1=function(a,h){var c=D(a[0]);"number"===c.ctype&&z.setpointsize(c);return k};r.linesize$1=function(a,h){var c=D(a[0]);"number"===c.ctype&&z.setlinesize(c);return k};r.textsize$1=function(a,h){var c=D(a[0]);"number"===c.ctype&&z.settextsize(c);return k};r.playanimation$0=function(a,h){La();return k};r.pauseanimation$0=
function(a,h){Ia();return k};r.stopanimation$0=function(a,h){$a();return k};r.text$1=function(a,h){var c=D(a[0]);return w.string(Q(c))};r.replace$3=function(a,h){var c=A(a[0]),b=A(a[1]),d=A(a[2]);if("string"===c.ctype&&"string"===b.ctype&&"string"===d.ctype)return c=c.value,b=b.value.replace(/[^A-Za-z0-9]/g,"\\$&"),d=d.value.replace(/\$/g,"$$$$"),c=c.replace(new RegExp(b,"g"),d),{ctype:"string",value:c}};r.replace$2=function(a,h){function c(a,c,h){var e="";d=b=-1;for(var g=0;g<c.length;g++){var f=
c[g][0],l=a.indexOf(f,h);-1!==l&&(-1===b?(e=f,b=l,d=g):l<b&&(e=f,b=l,d=g))}return e}var b,d,e,g=A(a[0]);e=A(a[1]);if("string"===g.ctype&&"list"===e.ctype){for(var g=g.value,f=[],l=0;l<e.value.length;l++){var m=e.value[l];"list"===m.ctype&&2===m.value.length&&"string"===m.value[0].ctype&&"string"===m.value[1].ctype&&(f[f.length]=[m.value[0].value,m.value[1].value])}b=-1;for(e=c(g,f,0);-1!==b;)g=g.substring(0,b)+f[d][1]+g.substring(b+e.length,g.length),e=b+f[d][1].length,e=c(g,f,e);return{ctype:"string",
value:g}}return k};r.substring$3=function(a,h){var c=A(a[0]),b=D(a[1]),d=D(a[2]);return"string"===c.ctype&&"number"===b.ctype&&"number"===d.ctype?{ctype:"string",value:c.value.substring(Math.floor(b.value.real),Math.floor(d.value.real))}:k};r.tokenize$2=function(a,h){var c=A(a[0]),b=A(a[1]);if("string"===c.ctype&&"string"===b.ctype)return r.tokenize$2([c,g.turnIntoCSList([b])],h);if("string"===c.ctype&&"list"===b.ctype){c=c.value;if(0===b.value.length){b=!0;if(void 0!==h.autoconvert){var d=A(h.autoconvert);
"boolean"===d.ctype&&(b=d.value)}return b&&""!==c&&(b=Number(c),!isNaN(b))?l.real(b):w.string(c)}var d=b.value[0],e=g.turnIntoCSList(b.value.slice(1)),c=c.split(d.value);return g.turnIntoCSList(c.map(function(a){return r.tokenize$2([w.string(a),e],h)}))}return k};r.indexof$2=function(a,h){var c=A(a[0]),b=A(a[1]);return"string"===c.ctype&&"string"===b.ctype?(c=c.value.indexOf(b.value),l.real(c+1)):k};r.indexof$3=function(a,h){var c=A(a[0]),b=A(a[1]),d=A(a[2]);return"string"===c.ctype&&"string"===b.ctype&&
"number"===d.ctype?(c=c.value.indexOf(b.value,Math.round(d.value.real)-1),l.real(c+1)):k};r.parse$1=function(a,h){var c=A(a[0]);return"string"===c.ctype?(c=Na(c.value),A(c)):k};r.unicode$1=function(a,h){var c;c=A(a[0]);var b=16;if(h.base){var d=A(h.base);"number"===d.ctype&&(b=d.value.real)}if("string"===c.ctype)c=parseInt(c.value,b);else if("number"===c.ctype)c=c.value.real;else return k;"undefined"!==typeof String.fromCodePoint?c=String.fromCodePoint(c):65535>=c?c=String.fromCharCode(c):(c-=65536,
c=String.fromCharCode((c>>10)+55296,(c&1023)+56320));return w.string(c)};r.international$1=function(a,h){return r.international$2([a[0],null],h)};r.international$2=function(a,h){var c=A(a[0]);if("string"!==c.ctype)return k;var b=(t.translations||{})[t.language||"en"]||{};if(!b.hasOwnProperty(c.value))return c;var d=b[c.value];if("string"===typeof d)return w.string(d);if(null===a[1])return c;var e=A(a[1]),e="number"===e.ctype?e.value.real:0,b=(b._pluralFormFunction||Wd)(e);return b<d.length?w.string(d[b]):
c};r.currentlanguage$0=function(a,h){return w.string(t.language||"en")};E.basismap=function(a,h,c,b){var d=g.turnIntoCSList([a,h,c]),d=g.adjoint3(g.transpose(d));b=w.mult(d,b);d=g.turnIntoCSList([w.mult(b.value[0],a),w.mult(b.value[1],h),w.mult(b.value[2],c)]);return g.transpose(d)};r.map$8=function(a,h){var c=L(a[0]),b=L(a[1]),d=L(a[2]),e=L(a[3]),f=L(a[4]),l=L(a[5]),m=L(a[6]),n=L(a[7]);return f!==k&&l!==k&&m!==k&&n!==k&&c!==k&&b!==k&&d!==k&&e!==k?(f=E.basismap(f,l,m,n),c=E.basismap(c,b,d,e),c=w.mult(f,
g.adjoint3(c)),g.normalizeMax(c)):k};r.map$6=function(a,h){var c=L(a[0]),b=L(a[1]),d=L(a[2]),e=g.realVector([0,0,1]),f=g.cross,l=f(f(d,f(e,f(c,b))),f(b,f(e,f(c,d)))),m=L(a[3]),n=L(a[4]),p=L(a[5]),e=f(f(p,f(e,f(m,n))),f(n,f(e,f(m,p))));return m!==k&&n!==k&&p!==k&&e!==k&&c!==k&&b!==k&&d!==k&&l!==k?(m=E.basismap(m,n,p,e),c=E.basismap(c,b,d,l),c=w.mult(m,g.adjoint3(c)),g.normalizeMax(c)):k};r.map$4=function(a,h){var c=g.ii,b=g.jj,d=L(a[0]),e=L(a[1]),f=L(a[2]),l=L(a[3]);return f!==k&&l!==k&&d!==k&&e!==
k?(f=E.basismap(f,l,c,b),c=E.basismap(d,e,c,b),c=w.mult(f,g.adjoint3(c)),g.normalizeMax(c)):k};r.map$2=function(a,h){var c=g.ii,b=g.jj,d=L(a[0]),e=w.add(g.realVector([1,0,0]),d),f=L(a[1]),l=w.add(g.realVector([1,0,0]),f);return f!==k&&l!==k&&d!==k&&e!==k?(f=E.basismap(f,l,c,b),c=E.basismap(d,e,c,b),c=w.mult(f,g.adjoint3(c)),g.normalizeMax(c)):k};r.pointreflect$1=function(a,h){var c=g.ii,b=g.jj,d=L(a[0]),e=w.add(g.realVector([1,0,0]),d),f=w.add(g.realVector([-1,0,0]),d);return f!==k&&d!==k&&e!==k?
(f=E.basismap(d,f,c,b),c=E.basismap(d,e,c,b),c=w.mult(f,g.adjoint3(c)),g.normalizeMax(c)):k};r.linereflect$1=function(a,h){var c=g.ii,b=g.jj,d=L(a[0]),e=g.realVector([Math.random(),Math.random(),Math.random()]),f=g.realVector([Math.random(),Math.random(),Math.random()]),e=g.cross(e,d),f=g.cross(f,d);return d!==k&&e!==k?(d=E.basismap(e,f,c,b),c=E.basismap(e,f,b,c),c=w.mult(d,g.adjoint3(c)),g.normalizeMax(c)):k};E.extractPointVec=function(a){var h={ok:!1};if("geo"===a.ctype){var c=a.value;if("P"===
c.kind)return h.x=wa.getField(c,"x"),h.y=wa.getField(c,"y"),h.z=l.real(1),h.ok=!0,h}if("list"!==a.ctype)return h;var b=a.value;if(2===b.length&&(a=b[0],c=b[1],"number"===a.ctype&&"number"===c.ctype))return h.x=a,h.y=c,h.z=l.real(1),h.ok=!0,h;3===b.length&&(a=b[0],c=b[1],b=b[2],"number"===a.ctype&&"number"===c.ctype&&"number"===b.ctype&&(h.x=l.div(a,b),h.y=l.div(c,b),h.z=l.real(1),h.ok=!0));return h};r.polygon$1=function(a,h){var c=A(a[0]);if("list"===c.ctype){for(var b=[],d=0;d<c.value.length;d++){var e=
E.extractPoint(c.value[d]);if(!e.ok)return k;b[d]={X:e.x,Y:e.y}}return{ctype:"shape",type:"polygon",value:[b]}}return k};r.circle$2=function(a,h){var c=D(a[0]),b=D(a[1]),c=E.extractPointVec(c);if(!c.ok||"number"!==b.ctype)return k;c=g.turnIntoCSList([c.x,c.y,c.z]);return{ctype:"shape",type:"circle",value:g.turnIntoCSList([c,b])}};r.screen$0=function(a,h){var c=z.drawingstate.initialmatrix,b=function(a,h){var b=a-c.tx,d=h+c.ty;return{X:(b*c.d-d*c.b)/c.det,Y:-(-b*c.c+d*c.a)/c.det}};return{ctype:"shape",
type:"polygon",value:[[b(0,0),b(ca,0),b(ca,ba),b(0,ba)]]}};r.halfplane$2=function(a,h){var c=D(a[0]),b=D(a[1]),d=L(c),e=L(b);if(c!==k&&b!==k){var f=b.usage,b=e;if("Line"===c.usage||"Point"===f)d=e,b=c;c=g.turnIntoCSList([b.value[0],b.value[1],l.zero]);c=g.cross(c,d);e=g.cross(b,c);e=w.div(e,e.value[2]);d=w.div(d,d.value[2]);d=g.sub(d,e);c=g.abs(d);d=w.div(d,c);c=e.value[0].value.real;e=e.value[1].value.real;b=1E3*d.value[0].value.real;d=1E3*d.value[1].value.real;return{ctype:"shape",type:"polygon",
value:[[{X:c+d/2,Y:e-b/2},{X:c+d/2+b,Y:e-b/2+d},{X:c-d/2+b,Y:e+b/2+d},{X:c-d/2,Y:e+b/2}]]}}return k};r.element$1=function(a,b){var c=A(a[0]);return"string"===c.ctype&&v.csnames.hasOwnProperty(c.value)?{ctype:"geo",value:v.csnames[c.value]}:k};E.all$1=function(a,b){var c=A(a[0]);return"geo"===c.ctype&&c.value.incidences?g.ofGeos(c.value.incidences.map(function(a){return v.csnames[a]}).filter(b)):g.nil};r.allpoints$0=function(a,b){return g.ofGeos(v.points)};r.allpoints$1=function(a,b){return E.all$1(a,
function(a){return"P"===a.kind})};r.allmasses$0=function(a,b){return g.ofGeos(ea)};r.allmasses$1=function(a,b){return E.all$1(a,function(a){return"P"===a.kind&&a.behavior&&"Mass"===a.behavior.type})};r.allsprings$0=function(a,b){return g.ofGeos(zc)};r.allsprings$1=function(a,b){return E.all$1(a,function(a){return"S"===a.kind&&a.behavior&&"Spring"===a.behavior.type})};r.alllines$0=function(a,b){return g.ofGeos(v.lines)};r.alllines$1=function(a,b){return E.all$1(a,function(a){return"L"===a.kind||"S"===
a.kind})};r.allsegments$0=function(a,b){return g.ofGeos(v.lines.filter(function(a){return"S"===a.kind}))};r.allsegments$1=function(a,b){return E.all$1(a,function(a){return"S"===a.kind})};r.allconics$0=function(a,b){return g.ofGeos(v.conics)};r.allconics$1=function(a,b){return E.all$1(a,function(a){return"C"===a.kind})};r.allcircles$0=function(a,b){return g.ofGeos(v.conics.filter(function(a){return"Circle"===a.matrix.usage}))};r.allcircles$1=function(a,b){return E.all$1(a,function(a){return"C"===a.kind&&
"Circle"===a.matrix.usage})};r.allelements$0=function(a,b){return g.ofGeos(v.gslp)};r.allelements$1=function(a,b){return E.all$1(a,function(a){return!0})};r.incidences$1=r.allelements$1;r.createpoint$2=function(a,b){var c=A(a[0]),d=L(a[1]);return"string"!==c.ctype?(console.log("Name must be a string"),k):"list"!==d.ctype&&g.isNumberVector(d)?(console.log("Position must be a number vector"),k):Ba({name:c.value,type:"Free",labeled:!0,pos:d})};r.create$3=function(a,b){var c=A(a[0]),d=A(a[1]),e=A(a[2]),
f,m;if("string"===c.ctype)f=c.value;else{if("list"!==c.ctype)return console.log("Names must be a string or a list of strings"),k;if(1!==c.value.length){f=w.string(c.value.map(function(a){return a.value}).join("__"));f=r.create$3([f,d,e],b);if(f!==k)for(d=w.string(f.kind.replace(/^(.*)s$/,"Select$1")),e=g.turnIntoCSList([w.string(f.name)]),m=0;m<c.value.length;++m)r.create$3([c.value[m],d,e],{index:l.real(m+1)});return f}if("string"!==c.value[0].ctype)return console.log("Element of names list must be a string"),
k;f=c.value[0].value}if("string"!==d.ctype)return console.log("Type must be a string"),k;if("list"!==e.ctype)return console.log("Arguments must be a list"),k;if(!n.hasOwnProperty(d.value)&&!tc.hasOwnProperty(d.value)&&!sd.hasOwnProperty(d.value))return console.log("Invalid geometric operation: '"+d.value+"'"),k;var c=[],p=null;for(m=0;m<e.value.length;m++){var t=e.value[m];if("string"===t.ctype)c.push(t.value);else if("geo"===t.ctype)c.push(t.value.name);else if(p=L(t),p===k)return console.log("Unknown argument type"),
k}f={name:f,type:d.value,labeled:!0};p&&(f.pos=p);0<c.length&&(f.args=c);d=D(b.index);"number"===d.ctype&&(f.index=d.value.real|0);return Ba(f)};r.javascript$1=function(a,b){var c=A(a[0]);"string"===c.ctype&&(new Function(c.value)).call(oa);return k};r.use$1=function(a,b){function c(a,c,b){r[a.toLowerCase()+"$"+c]=b}var d=A(a[0]);if("string"===d.ctype){var d=d.value,e;t.plugins&&(e=t.plugins[d]);e||(e=ua._pluginRegistry[d]);if(e)return e({instance:oa,config:t,nada:k,evaluate:A,extractPoint:E.extractPoint,
evaluateAndVal:D,defineFunction:c,addShutdownHook:ib.push.bind(ib),addAutoCleaningEventListener:J,getVariable:K.getvar.bind(K),getInitialMatrix:function(){return z.drawingstate.initialmatrix},setTextRenderer:function(a,c){Bc=a;c&&(ud=c)},getImage:function(a,c){"string"===typeof a&&(a=w.string(a));var b=Pa(a);if(!b)return null;!c&&b.cdyUpdate&&b.cdyUpdate();return b},getMyfunction:function(a){return Wa.hasOwnProperty(a)?Wa[a]:null}}),{ctype:"boolean",value:!0};console.log("Plugin "+d+" not found");
return{ctype:"boolean",value:!1}}return k};r.format$2=function(a,b){function c(a){a=a.toFixed(f);var c;do c=a,a=a.substring(0,a.length-1);while(""!==a&&"-"!==a&&+a===+c);return""+c}function d(a){var b;return"number"===a.ctype?(b=c(a.value.real),a=c(a.value.imag),b="0"===a?b:"-"===a.substring(0,1)?b+" - i*"+a.substring(1):b+" + i*"+a,{ctype:"string",value:b}):"list"===a.ctype?{ctype:"list",value:a.value.map(d)}:{ctype:"string",value:Q(a).toString()}}var e=D(a[0]),g=D(a[1]),f;return"number"!==e.ctype&&
"list"!==e.ctype||"number"!==g.ctype?k:(f=Math.max(0,Math.min(20,Math.round(g.value.real))),d(e))};Date.now||(Date.now=function(){return(new Date).getTime()});var Jd=0;r.timestamp$0=function(a,b){return l.real(Date.now())};r.seconds$0=function(a,b){return l.real((Date.now()-Jd)/1E3)};r.resetclock$0=function(a,b){Jd=Date.now();return k};r.time$0=function(a,b){var c=new Date;return g.realVector([c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds()])};r.date$0=function(a,b){var c=new Date;
return g.realVector([c.getFullYear(),c.getMonth()+1,c.getDate()])};r.simulationtime$0=function(a,b){return l.real(Bb*Gd)};r.settimeout$2=function(a,b){function c(){A(g);e()}var d=A(a[0]),g=a[1];"number"===d.ctype&&"undefined"!==typeof window&&window.setTimeout(c,1E3*d.value.real);return k};E.formatForWebGL=function(a){return a.toFixed(10)};r.generateWebGL$2=function(a,b){var c=E.formatForWebGL,d=a[0],e=A(a[1]);console.log(e);if("list"!==e.ctype)return k;for(var g=[],f=0;f<e.value.length;f++)"string"===
e.value[f].ctype&&g.push(e.value[f].value);console.log("***********");console.log(g);e=E.plotvars(d);console.log(e);-1===e.indexOf("a")&&-1===e.indexOf("b")&&-1===e.indexOf("c")&&-1===e.indexOf("d")&&-1===e.indexOf("e")&&-1===e.indexOf("f")&&(d=D(d));if("number"===d.ctype)return{ctype:"string",value:"vec2("+c(d.value.real)+","+c(d.value.imag)+")"};if("variable"===d.ctype)return{ctype:"string",value:d.name};if("string"===d.ctype||"void"===d.ctype)return d;if(2===d.args.length&&("infix"===d.ctype||
"function"===d.ctype)){c=r.compileToWebGL$1([d.args[0]],{});e=r.compileToWebGL$1([d.args[1]],{});if("+"===d.oper||"add"===d.oper)return void 0===c.value||"void"===c.ctype?{ctype:"string",value:e.value}:{ctype:"string",value:"addc("+c.value+","+e.value+")"};if("*"===d.oper||"mult"===d.oper)return{ctype:"string",value:"multc("+c.value+","+e.value+")"};if("/"===d.oper||"div"===d.oper)return{ctype:"string",value:"divc("+c.value+","+e.value+")"};if("-"===d.oper||"sub"===d.oper)return void 0===c.value||
"void"===c.ctype?{ctype:"string",value:"negc("+e.value+")"}:{ctype:"string",value:"subc("+c.value+","+e.value+")"};if("^"===d.oper||"pow"===d.oper)return{ctype:"string",value:"powc("+c.value+","+e.value+")"}}if("function"===d.ctype&&1===d.args.length){c=r.compileToWebGL$1([d.args[0]],{});if("sin$1"===d.oper)return{ctype:"string",value:"sinc("+c.value+")"};if("cos$1"===d.oper)return{ctype:"string",value:"cosc("+c.value+")"};if("tan$1"===d.oper)return{ctype:"string",value:"tanc("+c.value+")"};if("exp$1"===
d.oper)return{ctype:"string",value:"expc("+c.value+")"};if("log$1"===d.oper)return{ctype:"string",value:"logc("+c.value+")"};if("arctan$1"===d.oper)return{ctype:"string",value:"arctanc("+c.value+")"};if("arcsin$1"===d.oper)return{ctype:"string",value:"arcsinc("+c.value+")"};if("arccos$1"===d.oper)return{ctype:"string",value:"arccosc("+c.value+")"};if("sqrt$1"===d.oper)return{ctype:"string",value:"sqrtc("+c.value+")"}}return k};r.compileToWebGL$1=function(a,b){var c,d;c=E.formatForWebGL;var e=a[0];
d=E.plotvars(e);-1===d.indexOf("a")&&-1===d.indexOf("b")&&-1===d.indexOf("c")&&-1===d.indexOf("d")&&-1===d.indexOf("e")&&-1===d.indexOf("f")&&(e=D(e));if("number"===e.ctype)return{ctype:"string",value:"vec2("+c(e.value.real)+","+c(e.value.imag)+")"};if("variable"===e.ctype)return{ctype:"string",value:e.name};if("string"===e.ctype||"void"===e.ctype)return e;if(2===e.args.length&&("infix"===e.ctype||"function"===e.ctype)){c=r.compileToWebGL$1([e.args[0]],{});d=r.compileToWebGL$1([e.args[1]],{});if("+"===
e.oper||"add"===e.oper)return void 0===c.value||"void"===c.ctype?{ctype:"string",value:d.value}:{ctype:"string",value:"addc("+c.value+","+d.value+")"};if("*"===e.oper||"mult"===e.oper)return{ctype:"string",value:"multc("+c.value+","+d.value+")"};if("/"===e.oper||"div"===e.oper)return{ctype:"string",value:"divc("+c.value+","+d.value+")"};if("-"===e.oper||"sub"===e.oper)return void 0===c.value||"void"===c.ctype?{ctype:"string",value:"negc("+d.value+")"}:{ctype:"string",value:"subc("+c.value+","+d.value+
")"};if("^"===e.oper||"pow"===e.oper)return{ctype:"string",value:"powc("+c.value+","+d.value+")"}}if("function"===e.ctype&&1===e.args.length){c=r.compileToWebGL$1([e.args[0]],{});if("sin$1"===e.oper)return{ctype:"string",value:"sinc("+c.value+")"};if("cos$1"===e.oper)return{ctype:"string",value:"cosc("+c.value+")"};if("tan$1"===e.oper)return{ctype:"string",value:"tanc("+c.value+")"};if("exp$1"===e.oper)return{ctype:"string",value:"expc("+c.value+")"};if("log$1"===e.oper)return{ctype:"string",value:"logc("+
c.value+")"};if("arctan$1"===e.oper)return{ctype:"string",value:"arctanc("+c.value+")"};if("arcsin$1"===e.oper)return{ctype:"string",value:"arcsinc("+c.value+")"};if("arccos$1"===e.oper)return{ctype:"string$1",value:"arccosc("+c.value+")"};if("sqrt$1"===e.oper)return{ctype:"string",value:"sqrtc("+c.value+")"}}return k};r.setsimulationspeed$1=function(a,b){var c=D(a[0]);"number"===c.ctype&&ka(c.value.real);return k};r.setsimulationaccuracy$1=function(a,b){var c=D(a[0]);"number"===c.ctype&&"undefined"!==
typeof M&&"undefined"!==typeof M.env&&(M.env.accuracy=Math.max(1,c.value.real|0));return k};r.setsimulationquality$1=function(a,b){var c=D(a[0]);"number"===c.ctype&&"undefined"!==typeof M&&"undefined"!==typeof M.env&&(c=c.value.real,0===c&&(M.env.errorbound=.01,M.env.lowestdeltat=1E-5,M.env.slowdownfactor=2),1===c&&(M.env.errorbound=.001,M.env.lowestdeltat=1E-7,M.env.slowdownfactor=2),2===c&&(M.env.errorbound=1E-5,M.env.lowestdeltat=1E-10,M.env.slowdownfactor=4),3===c&&(M.env.errorbound=1E-6,M.env.lowestdeltat=
1E-12,M.env.slowdownfactor=4));return k};var Vb=null,cc=null;r.createtool$3=function(a,b){var c,d="left",e="top",g=null;b.space&&(c=A(b.space),"number"===c.ctype&&(g=c.value.real/2));var f=null;b.toolbar&&(c=A(b.toolbar),"string"===c.ctype&&((f=document.getElementById(c.value))||console.warn("Element #"+c.value+" not found")));if(!f){if(b.reference){var l=A(b.reference);if("string"===l.ctype)switch(l.value){case "UR":d="right";break;case "LL":e="bottom";break;case "LR":d="right",e="bottom"}}f=document.createElement("div");
f.className="CindyJS-toolbar";ia.parentNode.appendChild(f);l=A(a[1]);c=A(a[2]);"number"===l.ctype&&(f.style[d]=l.value.real+"px");"number"===c.ctype&&(f.style[e]=c.value.real+"px");null!==g&&(f.style.margin=-g+"px")}l=A(a[0]);if("string"===l.ctype)l=[[l.value]];else if("list"===l.ctype)l=l.value.map(function(a){return"string"===a.ctype?[a.value]:"list"===a.ctype?a.value.map(function(a){return"string"===a.ctype?a.value:null}):[null]});else return console.log("Name must be a string or a list of strings"),
k;if(b.flipped&&(c=A(b.flipped),"boolean"===c.ctype&&c.value)){console.log("Flipping");var m=0;c=l.length;l.forEach(function(a){a.length>m&&(m=a.length)});for(var n=[],p=0;p<m;++p){n[p]=[];for(var r=0;r<c;++r)n[p][r]=l[r][p]||null}l=n}"bottom"===e&&l.reverse();l.forEach(function(a){"right"===d&&a.reverse();var c=document.createElement("div");f.appendChild(c);a.forEach(function(a){function b(){Vb&&Vb.classList.remove("CindyJS-active");Vb=d;d.classList.add("CindyJS-active");qc=a;var c=F[qc].actions;
cc&&(cc.textContent=c[0].tooltip||"");sa=[];rb=Ra=0}F.hasOwnProperty(a)||(console.log("Tool '"+a+"' not implemented yet."),a=null);if(null===a){var h=document.createElement("span");h.className="CindyJS-spacer";c.appendChild(h)}else{var d=document.createElement("button"),h=document.createElement("img");h.src=ua.getBaseDir()+"images/"+a+".png";d.appendChild(h);d.addEventListener("click",b);Vb||b();null!==g&&(d.style.margin=g+"px");c.appendChild(d)}})});return k};r.dropped$0=function(){return kc};r.droppoint$0=
function(){return lc};r.parsecsv$1=function(a,b){var c=!0,d=D(b.autoconvert);"boolean"===d.ctype&&(c=d.value);var e=null,d=D(b.delimiter);"string"===d.ctype&&/^[^\"\r\n]$/.test(d.value)&&(e=d.value);d=D(a[0]);if("string"!==d.ctype)return console.log("CSV data is not a string"),k;var d=d.value,f='(?:"((?:[^"]+|"")*)"|([^]*?))(\r\n|(,)|[\r\n]|$)';e&&(e=e.replace(/[^A-Za-z0-9]/g,"\\$&").replace(/\$/g,"$$$$"),f=f.replace(/,/g,e));for(var f=new RegExp(f,"g"),e=[],m=[],n=null;f.lastIndex<d.length;){var p=
f.exec(d),r=p[2];"string"===typeof p[1]&&(r=p[1].replace(/""/g,'"'));r=c?/^[Tt]rue$/.test(r)?w.bool(!0):/^[Ff]alse$/.test(r)?w.bool(!1):/^[\-+]?([0-9]+(\.[0-9]*)?|\.[0-9]+|Infinity)$/.test(r)?l.real(Number(r)):w.string(r):w.string(r);e.push(r);p[4]&&f.lastIndex===d.length&&(e.push(w.string("")),p={});if(!p[4]){null===n&&(n=e.length);if(n<e.length)for(n=e.length,p=0;p<m.length;++p)for(r=m[p].length;r<n;++r)m[p][r]=k;else if(n>e.length)for(p=e.length;p<n;++p)e[p]=k;m.push(e);e=[]}}return g.turnIntoCSList(m.map(g.turnIntoCSList))};
r.load$2=function(a,b){return r.load$3([a[0],null,a[1]],b)};r.load$3=function(a,b){function c(){if(l.readyState===XMLHttpRequest.DONE){var c;200===l.status?c=w.string(String(l.responseText)):(ha.err("Failed to load "+f+": "+l.statusText),c=k);K.newvar(d);K.setvar(d,c);A(a[2]);K.removevar(d);e()}}var d="#";null!==a[1]&&"variable"===a[1].ctype&&(d=a[1].name);var g=D(a[0]),f=null,l=null;"string"===g.ctype&&/^https?:\/\//.test(g.value)&&(f=g.value);return null!==f?(l=new XMLHttpRequest,l.onreadystatechange=
c,l.open("GET",f),l.send(),w.bool(!0)):k};E.extractPoint=function(a){var b={ok:!1};if("geo"===a.ctype){var c=a.value;if("P"===c.kind)return b.x=wa.getField(c,"x").value.real,b.y=wa.getField(c,"y").value.real,b.ok=!0,b}if("list"!==a.ctype)return b;var d=a.value;if(2===d.length&&(a=d[0],c=d[1],"number"===a.ctype&&"number"===c.ctype))return b.x=a.value.real,b.y=c.value.real,b.ok=!0,b;3===d.length&&(a=d[0],c=d[1],d=d[2],"number"===a.ctype&&"number"===c.ctype&&"number"===d.ctype&&(a=l.div(a,d),c=l.div(c,
d),b.x=a.value.real,b.y=c.value.real,b.ok=!0));return b};r.draw$1=function(a,b){var c=D(a[0]);if("shape"===c.ctype)E.drawshape(c,b);else if("Line"===c.usage)x.handleModifs(b,x.lineModifs),x.drawline(c);else{var d=E.extractPoint(c);if(!d.ok){if("undefined"!==typeof c.value&&2===c.value.length)return r.draw$2(c.value,b);return}null!==b&&x.handleModifs(b,x.pointModifs);x.drawpoint(d)}return k};r.draw$2=function(a,b){var c=D(a[0]),d=D(a[1]),c=E.extractPoint(c),d=E.extractPoint(d);if(!c.ok||!d.ok)return k;
null!==b&&x.handleModifs(b,x.lineModifs);x.drawsegcore(c,d);return k};r.drawcircle$2=function(a,b){return E.drawcircle(a,b,"D")};E.arcHelper=function(a){var b={};b.startPoint=L(a[0]);b.viaPoint=L(a[1]);b.endPoint=L(a[2]);return b};r.fillcircle$2=function(a,b){return E.drawcircle(a,b,"F")};r.drawarc$3=function(a,b){var c=E.arcHelper(a);return E.drawarc(c,b,"D")};r.fillarc$3=function(a,b){var c=E.arcHelper(a);return E.drawarc(c,b,"F")};E.drawarc=function(a,b,c){var d=a.startPoint,e=a.viaPoint;a=a.endPoint;
if(!g._helper.isAlmostReal(g.turnIntoCSList([d,e,a])))return k;x.handleModifs(b,x.conicModifs);x.preDrawCurve();b=g.det3(d,e,a);if(1E-12<Math.abs(b.value.real)){b=n._helper.ConicBy5(null,d,e,a,g.ii,g.jj);var f=n._helper.CenterOfConic(b),f=g.normalizeMax(f);b=l.real(0);var m=g.turnIntoCSList([g.turnIntoCSList([f.value[2],b,l.neg(f.value[0])]),g.turnIntoCSList([b,f.value[2],l.neg(f.value[1])]),g.turnIntoCSList([b,b,f.value[2]])]);b=g.normalizeZ(w.mult(m,d));g.normalizeZ(w.mult(m,e));m=g.normalizeZ(w.mult(m,
a));b=-Math.atan2(b.value[1].value.real,b.value[0].value.real);m=-Math.atan2(m.value[1].value.real,m.value[0].value.real);f=g.normalizeZ(f);d=g.normalizeZ(d);e=g.normalizeZ(e);a=g.normalizeZ(a);var p=g.abs(g.sub(d,f)),r=[f.value[0].value.real,f.value[1].value.real],f=z.drawingstate.matrix,t=r[0]*f.a-r[1]*f.b+f.tx,r=r[0]*f.c-r[1]*f.d-f.ty,d=0<g.det3(d,e,a).value.real;y.save();y.beginPath();y.translate(t,r);y.arc(0,0,p.value.real*f.sdet,b,m,d);"F"===c&&(y.fillStyle=x.lineColor,y.closePath(),y.fill());
"D"===c&&y.stroke();y.restore()}else{if("D"!==c)return k;c=E.extractPoint(d);b=E.extractPoint(e);m=E.extractPoint(a);if(!c.ok||!b.ok||!m.ok)return k;p=(c.x-m.x)*(c.x-m.x)+(c.y-m.y)*(c.y-m.y);f=(m.x-b.x)*(m.x-b.x)+(m.y-b.y)*(m.y-b.y);if(1E-12>(c.x-b.x)*(c.x-b.x)+(c.y-b.y)*(c.y-b.y)||1E-12>p||1E-12>f)return k;0>g.crossratio3(d,a,e,g.cross(g.cross(d,e),g.linfty),g.ii).value.real?x.drawsegcore(c,m):x.drawRaySegment(d,a)}return k};E.drawcircle=function(a,b,c){var d=D(a[0]);a=D(a[1]);var e=E.extractPoint(d);
if(!e.ok||"number"!==a.ctype||!l._helper.isAlmostReal(a))return k;var d=z.drawingstate.matrix,g=e.x*d.a-e.y*d.b+d.tx,e=e.x*d.c-e.y*d.d-d.ty;x.handleModifs(b,x.conicModifs);x.preDrawCurve();y.lineJoin="miter";y.beginPath();y.arc(g,e,Math.abs(a.value.real)*d.sdet,0,2*Math.PI);y.closePath();"D"===c&&y.stroke();"F"===c&&(y.fillStyle=x.lineColor,y.fill());"C"===c&&y.clip();return k};r.drawconic$1=function(a,b){var c;c=D(a[0]);if("list"!==c.ctype||3!==c.value.length&&6!==c.value.length)return console.error("could not parse conic"),
k;if(6===c.value.length){for(var d=0;6>d;d++)if("number"!==c.value[d].ctype)return console.error("could not parse conic"),k;var e=l.real(.5),d=c.value[0],f=c.value[2],f=l.mult(f,e),m=c.value[1],n=c.value[3],n=l.mult(n,e),p=c.value[4],p=l.mult(p,e);c=c.value[5];c=g.turnIntoCSList([g.turnIntoCSList([d,f,n]),g.turnIntoCSList([f,m,p]),g.turnIntoCSList([n,p,c])])}else{for(d=0;3>d;d++)for(f=0;3>f;f++)if("number"!==c.value[d].value[f].ctype)return console.error("could not parse conic"),k;g.equals(c,g.transpose(c)).value||
(d=w.mult(c,l.real(.5)),c=w.mult(g.transpose(c),l.real(.5)),c=g.add(d,c))}c=g.normalizeMax(c);return E.drawconic(c,b)};E.drawconic=function(a,b){x.handleModifs(b,x.conicModifs);if(0!==x.lsize){x.preDrawCurve();for(var c=g.normalizeMax(a),d=c,e=0;2>e;e++)for(var f=0;2>f;f++)if(Math.abs(c.value[e].value[f].value.imag)>l.eps)return;e=g.turnIntoCSList([g.realVector([-1,-1,1]),g.realVector([1,0,0]),g.realVector([0,1,0])]);f=z.from(0,0,1);f[2]=1;var m=z.from(1,0,1);m[2]=1;var p=z.from(0,1,1);p[2]=1;var f=
g.turnIntoCSList([g.realVector(f),g.realVector(m),g.realVector(p)]),f=g.transpose(f),e=w.mult(f,e),e=g.inverse(e),c=w.mult(g.transpose(e),c),c=w.mult(c,e),e=c.value[0].value[0].value.real,f=c.value[1].value[0].value.real,m=c.value[1].value[1].value.real,p=c.value[2].value[0].value.real,t=c.value[2].value[1].value.real,v=c.value[2].value[2].value.real,c=[[e,f,p],[f,m,t],[p,t,v]],u=1E-14>Math.abs(e*m*v-e*t*t-f*f*v+2*f*p*t-m*p*p);if(u&&"Circle"===a.usage){var A=w.mult(g.adjoint3(d),g.linfty);l.abs(A.value[2]).value.real>
l.eps&&(u=!1)}var A=ca>ba?ca:ba,B=-1.5*A,C=1.5*A,D=-1.5*A,E=1.5*A,G=1;u&&(G=0);if(G)var p=0,p=1E-14<Math.abs(e-f)?Math.atan(f/e-m)/2:Math.PI/4,F=function(a){var c=Math.cos(a);a=Math.sin(a);return[[c,-a,0],[a,c,0],[0,0,1]]}(p),F=g.realMatrix(F),e=g.transpose(F),c=w.mult(g.realMatrix(c),F),c=w.mult(e,c),e=c.value[0].value[0].value.real,f=c.value[1].value[0].value.real,m=c.value[1].value[1].value.real,p=c.value[2].value[0].value.real,t=c.value[2].value[1].value.real,v=c.value[2].value[2].value.real;
var c=[e,f,m,p,t,v],e=function(){var a=n._helper.splitDegenConic(d);if(a!==k){var c=a[1],a=[a[0]];r.draw$1(a,b);a[0]=c;r.draw$1(a,b)}},I=function(a){"undefined"!==a&&6===a.length||console.error("this does not define a Conic");if(u)return"degenerate";a=a[0]*a[2]-a[1]*a[1];return 1E-14>Math.abs(a)?"parabola":1E-14<a?"ellipsoid":"hyperbola"};I(c);var J=function(a,c){return 0<a&&a<ca&&0<c&&c<ba},H=[],K=[],L=[],M=[],N=[],O=[],P=function(){H=[];K=[];L=[];M=[];N=[];O=[]},Q=function(a,c){y.beginPath();y.moveTo(a[0],
c[0]);for(var b=1;b<a.length;b++)y.lineTo(a[b],c[b]);y.stroke()},R=function(a,c,b){var h,d,e=I(a);if(6!==a.length)console.error("Conic needs 6 Parameters");else{var f=a[0],q=a[1],l=a[2],k=a[3],m=a[4];a=a[5];var n;h=b-c;for(var na=.1*h+c,p=b-.1*h,T=c;T<=b;T+=n){n=T<na||T>p||100>Math.abs(b-c)?.5:0>T||T>ba?10:3;d=-f*l*T*T-2*f*m*T-f*a+q*q*T*T+2*q*k*T+k*k;d=Math.sqrt(d);h=1/f*(-q*T-k+d);d=-1/f*(q*T+k+d);var r,t;G?(r=[h,T,1],t=[d,T,1],r=w.mult(F,g.realVector(r)),t=w.mult(F,g.realVector(t)),h=r.value[0].value.real,
d=t.value[0].value.real,r=r.value[1].value.real,t=t.value[1].value.real):t=r=T;isNaN(h)||"ellipsoid"!==e?!isNaN(h)&&h>=B&&h<=C&&(H.push(h),L.push(r)):(H.push(h),L.push(r));isNaN(d)||"ellipsoid"!==e?!isNaN(d)&&d>=B&&d<=C&&(K.push(d),M.push(t)):(K.push(d),M.push(t))}}},f=function(a){var c,b,h;I(a);if(6!==a.length)console.error("Conic needs 6 Parameters");else{h=a[0];var d=a[1],e=a[2],g=a[3],f=a[4],q=a[5];c=-h*f+d*g;b=Math.sqrt(h*(-h*e*q+h*Math.pow(f,2)+Math.pow(d,2)*q-2*d*g*f+e*Math.pow(g,2)));e=h*
e-Math.pow(d,2);1E-14<Math.abs(e)?(h=(c-b)/e,b=(c+b)/e):b=h=(-h*q+g*g)/(2*h*f-2*d*g);!isNaN(h)&&h>D&&h<E||(h=D);!isNaN(b)&&b>D&&b<E||(b=D);c=h<b?h:b;b=h>b?h:b;R(a,D,c);N=H.concat(K.reverse());O=L.concat(M.reverse());Q(N,O);P();R(a,b,E);Q(H,L);if(J(H[0],L[1])||J(K[0],M[0]))y.beginPath(),y.moveTo(H[0],L[0]),y.lineTo(K[0],M[0]),y.stroke();Q(K,M);P();R(a,c,b);Q(H,L);y.beginPath();y.moveTo(H[0],L[0]);y.lineTo(K[0],M[0]);y.stroke();y.beginPath();y.moveTo(H[H.length-1],L[L.length-1]);y.lineTo(K[K.length-
1],M[M.length-1]);y.stroke();Q(K,M);P()}};u?e():f(c)}};r.drawall$1=function(a,b){var c=A(a[0]);if("list"===c.ctype){x.handleModifs(b,x.pointAndLineModifs);for(var d=0;d<c.value.length;d++)r.draw$1([c.value[d]],null)}return k};r.connect$1=function(a,b){return E.drawpolygon(a,b,"D",!1)};r.drawpoly$1=function(a,b){return E.drawpolygon(a,b,"D",!0)};r.fillpoly$1=function(a,b){return E.drawpolygon(a,b,"F",!0)};r.drawpolygon$1=function(a,b){return E.drawpolygon(a,b,"D",!0)};r.fillpolygon$1=function(a,b){return E.drawpolygon(a,
b,"F",!0)};E.drawpolygon=function(a,b,c,d){function e(){for(var a=l.value,c=0;c<a.length;c++){var b=a[c],h;for(h=0;h<b.length;h++){var d=b[h],g=d.X*f.a-d.Y*f.b+f.tx,d=d.X*f.c-d.Y*f.d-f.ty;0===h?y.moveTo(g,d):y.lineTo(g,d)}y.closePath()}}function g(){var a;for(a=0;a<l.value.length;a++){var c=E.extractPoint(l.value[a]);if(!c.ok)return;var b=c.x*f.a-c.y*f.b+f.tx,c=c.x*f.c-c.y*f.d-f.ty;0===a?y.moveTo(b,c):y.lineTo(b,c)}d&&y.closePath()}x.handleModifs(b,x.conicModifs);x.preDrawCurve();var f=z.drawingstate.matrix,
l=A(a[0]);y.beginPath();"list"===l.ctype&&g();"shape"===l.ctype&&e();"D"===c&&(x.fillColor&&(y.fillStyle=x.fillColor,y.fill(x.fillrule)),y.stroke());"F"===c&&(y.fillStyle=x.lineColor,y.fill(x.fillrule));"C"===c&&y.clip();return k};var Bc=Zc,ud=function(a,b,c){if(-1!==b.indexOf("\n"))for(b=b.split("\n"),a.textContent=b[0],c=1;c<b.length;++c)a.appendChild(document.createElement("br")),a.appendChild(document.createTextNode(b[c]));else a.textContent=b};E.drawtext=function(a,b,c){var d=D(a[0]);a=A(a[1]);
var e=E.extractPoint(d);if(!e.ok)return null;x.handleModifs(b,x.textModifs);b=z.drawingstate.textsize;null===b&&(b=ja.textsize);null!==x.size&&(b=x.size);y.fillStyle=x.textColor;var g=z.drawingstate.matrix,d=e.x*g.a-e.y*g.b+g.tx+x.xOffset,e=e.x*g.c-e.y*g.d-g.ty-x.yOffset;a=Q(a);g=x.bold+x.italics+Math.round(10*b)/10+"px "+x.family;y.font=g;return c?c(a,g,d,e,x.align,b):Bc(y,a,d,e,x.align,b,b*ja.lineHeight)};r.drawtext$2=function(a,b){E.drawtext(a,b,null);return k};r.drawtable$2=function(a,b){var c=
D(a[0]),d=D(a[1]),e=E.extractPoint(c);if(!e.ok||"list"!==d.ctype)return k;var d=d.value,c=d.length,f=-1,l;for(l=0;l<c;++l)"list"===d[l].ctype&&d[l].value.length>f&&(f=d[l].value.length);-1===f?(d=d.map(function(a){return[a]}),f=1):d=d.map(function(a){return g.asList(a).value});var m=100,n=null,p=!0,r=z.drawingstate.textcolor;x.handleModifs(b,{size:!0,color:function(a){g._helper.isNumberVecN(a,3)&&(r=x.makeColor([a.value[0].value.real,a.value[1].value.real,a.value[2].value.real]))},alpha:!0,bold:!0,
italics:!0,family:!0,align:!0,x_offset:!0,y_offset:!0,offset:!0,width:function(a){"number"===a.ctype&&(m=a.value.real)},height:function(a){"number"===a.ctype&&(n=a.value.real)},border:function(a){"boolean"===a.ctype&&(p=a.value)}});var t=z.drawingstate.textsize;null===t&&(t=ja.textsize);null!==x.size&&(t=x.size);null===n&&(n=1.6*t);y.font=x.bold+x.italics+Math.round(10*t)/10+"px "+x.family;l=z.drawingstate.matrix;var v=f*m,u=c*n,t=e.x*l.a-e.y*l.b+l.tx+x.xOffset,w=e.x*l.c-e.y*l.d-l.ty-x.yOffset-u;
if(p){x.preDrawCurve();y.strokeStyle=x.lineColor;y.beginPath();for(l=1;l<c;++l)y.moveTo(t,w+l*n),y.lineTo(t+v,w+l*n);for(e=1;e<f;++e)y.moveTo(t+e*m,w),y.lineTo(t+e*m,w+u);y.stroke();y.lineWidth=x.lsize+1;y.beginPath();y.rect(t,w,v,u);y.stroke()}t+=x.align*m+(1-2*x.align)*n*.3;w+=.7*n;y.fillStyle=r;for(l=0;l<c;++l)for(e=0;e<f;++e)v=Q(d[l][e]),Bc(y,v,t+e*m,w+l*n,x.align);return k};E.drawshape=function(a,b){return"polygon"===a.type?E.drawpolygon([a],b,"D",1):"circle"===a.type?E.drawcircle([a.value.value[0],
a.value.value[1]],b,"D"):k};E.fillshape=function(a,b){return"polygon"===a.type?E.drawpolygon([a],b,"F",1):"circle"===a.type?E.drawcircle([a.value.value[0],a.value.value[1]],b,"F"):k};E.clipshape=function(a,b){return"polygon"===a.type?E.drawpolygon([a],b,"C",1):"circle"===a.type?E.drawcircle([a.value.value[0],a.value.value[1]],b,"C"):k};r.fill$1=function(a,b){var c=A(a[0]);return"shape"===c.ctype?E.fillshape(c,b):k};r.clip$1=function(a,b){var c=A(a[0]);return"shape"===c.ctype?E.clipshape(c,b):"list"===
c.ctype?(c=r.polygon$1(a,[]),r.clip$1([c],[])):k};r.plot$1=function(a,b){return r.plot$2([a[0],null],b)};r.plot$2=function(a,b){function c(a){return"number"===a.ctype&&l._helper.isAlmostReal(a)}function d(a,c,b,h,e){n++;c=+c.value.real;e=+h.value.real;h=c*D.a-e*D.b+D.tx;c=c*D.c-e*D.d-D.ty;a=+a.value.real;e=+b.value.real;b=a*D.a-e*D.b+D.tx;a=a*D.c-e*D.d-D.ty;p?(y.lineTo(b,a),y.lineTo(h,c)):(y.beginPath(),y.moveTo(b,a),y.lineTo(h,c),p=!0)}function e(a,b,h,g,k){var n=c(h),r=c(g);if(.001>k)!f&&p&&(y.stroke(),
p=!1);else if(n||r){var t=l.real((a.value.real+b.value.real)/2);K.setvar(B,t);var v=A(w),u=c(v);if(n&&r&&u){var Mb=h.value.real,r=v.value.real,u=g.value.real;if(n=1>Math.abs(Mb+u-2*r)/m){var x=l.real((a.value.real+t.value.real)/2);K.setvar(B,x);var x=A(w),fc=l.real((t.value.real+b.value.real)/2);K.setvar(B,fc);fc=A(w);Mb=Math.abs(Mb+r-2*x.value.real)/m;r=Math.abs(r+u-2*fc.value.real)/m;n=n&&1>Mb&&1>r}n?(d(a,t,h,v,k/2),d(t,b,v,g,k/2)):(e(a,t,h,v,k/2),e(t,b,v,g,k/2))}else e(a,t,h,v,k/2),e(t,b,v,g,k/
2)}}var f=!1,m=.2/Jb,n=0,p=!1,r=-10,t=10,v=.1,u=1E3,w=a[0],B;if(null!==a[1]&&"variable"===a[1].ctype)B=a[1].name;else{var C=E.plotvars(w);B="#";-1!==C.indexOf("t")&&(B="t");-1!==C.indexOf("z")&&(B="z");-1!==C.indexOf("y")&&(B="y");-1!==C.indexOf("x")&&(B="x")}K.newvar(B);var D=z.drawingstate.matrix;x.handleModifs(b,{color:!0,alpha:!0,size:!0,dashpattern:!0,dashtype:!0,dashing:!0,lineCap:!0,lineJoin:!0,miterLimit:!0,connect:function(a){"boolean"===a.ctype&&(f=a.value)},start:function(a){"number"===
a.ctype&&(r=a.value.real)},stop:function(a){"number"===a.ctype&&(t=a.value.real)},steps:function(a){"number"===a.ctype&&(u=a.value.real)}});y.strokeStyle=x.lineColor;y.lineWidth=x.lsize;var F,G,I,H,p=!1,C=l.real(14.32);K.setvar(B,C);I=A(w);if("number"!==I.ctype){if(g.isNumberVector(I).value&&2===I.value.length){p=!1;v=(t-r)/u;for(C=r;C<t;C+=v)K.setvar(B,l.real(C)),H=A(w),g.isNumberVector(H).value&&2===H.value.length&&(F=+H.value[0].value.real,G=+H.value[1].value.real,H=F*D.a-G*D.b+D.tx,F=F*D.c-G*
D.d-D.ty,p?y.lineTo(H,F):(y.beginPath(),y.moveTo(H,F),p=!0));y.stroke();K.removevar(B)}return k}for(H=r;H<t+v;H+=v)C=l.real(H),K.setvar(B,C),I=A(w),C.value.real>r&&e(F,C,G,I,v),F=C,G=I;K.removevar(B);p&&y.stroke();return k};r.plotX$1=function(a,b){var c=a[0],d=E.plotvars(c),e="#";-1!==d.indexOf("t")&&(e="t");-1!==d.indexOf("z")&&(e="z");-1!==d.indexOf("y")&&(e="y");-1!==d.indexOf("x")&&(e="x");K.newvar(e);d=z.drawingstate.matrix;y.fillStyle=z.drawingstate.linecolor;y.lineWidth=1;y.lineCap=x.lineCap;
y.lineJoin=x.lineJoin;y.miterLimit=x.miterLimit;for(var g=!1,f=-10;10>f;f+=.01){K.setvar(e,l.real(f));var m=A(c);if("number"===m.ctype){var n=+m.value.real,m=f*d.a-n*d.b+d.tx,n=f*d.c-n*d.d-d.ty;g?y.lineTo(m,n):(y.beginPath(),y.moveTo(m,n),g=!0)}}y.stroke();K.removevar(e);return k};E.plotvars=function(a){function b(a,c){var h={},d;for(d=a.length-1;0<=d;--d)h[a[d]]=a[d];for(d=c.length-1;0<=d;--d)h[c[d]]=c[d];d=[];for(var e in h)h.hasOwnProperty(e)&&d.push(h[e]);return d}function c(a,c){for(var b=0;b<
a.length;b++)a[b]===c&&(a.splice(b,1),b--);return a}var d,e,g,f;if("variable"===a.ctype)return[a.name];if("infix"===a.ctype)return d=E.plotvars(a.args[0]),a=E.plotvars(a.args[1]),b(d,a);if("list"===a.ctype){g=a.value;e=[];for(f=0;f<g.length;f++)d=E.plotvars(g[f]),e=b(e,d);return e}if("function"===a.ctype){g=a.args;e=[];for(f=0;f<g.length;f++)d=E.plotvars(g[f]),e=b(e,d);"apply"!==a.oper&&"select"!==a.oper&&"forall"!==a.oper&&"sum"!==a.oper&&"product"!==a.oper&&"repeat"!==a.oper&&"min"!==a.oper&&"max"!==
a.oper&&"sort"!==a.oper||"variable"!==a.args[1].ctype||(e=c(e,a.args[1].name));return e}return[]};r.clrscr$0=function(a,b){"undefined"!==typeof ca&&"undefined"!==typeof ba&&y.clearRect(0,0,ca,ba);return k};r.repaint$0=function(a,b){e();return k};r.screenbounds$0=function(a,b){var c=w.withUsage(g.realVector(z.to(0,0)),"Point"),d=w.withUsage(g.realVector(z.to(ca,0)),"Point"),e=w.withUsage(g.realVector(z.to(ca,ba)),"Point"),f=w.withUsage(g.realVector(z.to(0,ba)),"Point");return g.turnIntoCSList([c,d,
e,f])};r.createimage$3=function(a,b){var c=A(a[0]),d=D(a[1]),e=D(a[2]);if("number"!==d.ctype||"number"!==e.ctype||"string"!==c.ctype)return k;var g=document.createElement("canvas");g.id=c.value;g.width=d.value.real;g.height=e.value.real;g.style.display="none";document.body.appendChild(g);bb[c.value]=pa(g);return k};r.clearimage$1=function(a,b){var c=A(a[0]);if("string"!==c.ctype&&"image"!==c.ctype)return k;var c=Pa(c),d=c.img;if("undefined"===typeof d||null===d)return k;var e=c.width,g=c.height;d.getContext("2d").clearRect(0,
0,e,g);c.generation++;return k};r.canvas$4=function(a,b){var c=D(a[0]),d=D(a[1]),e=A(a[2]),g=a[3],f=E.extractPoint(c),l=E.extractPoint(d);if(!f.ok||!l.ok||"string"!==e.ctype&&"image"!==e.ctype)return k;e=Pa(e);if(!e||!e.img.getContext)return k;var d=e.img,m=e.width,c=e.height,n=l.x-f.x,p=l.y-f.y,r=f.x-p*c/m,t=f.y+n*c/m,p=l.x-p*c/m,n=l.y+n*c/m,l=z.from(f.x,f.y,1),r=z.from(r,t,1),p=z.from(p,n,1),f=l[0],t=l[1],n=r[0],v=r[1],u=p[0],w=p[1],r=m*(t-v)/((f-n)*(t-w)-(f-u)*(t-v)),m=m*(f-n)/((t-v)*(f-u)-(t-
w)*(f-n)),p=-r*f-m*t,l=(c*(t-w)-c*(t-v))/((f-n)*(t-w)-(f-u)*(t-v)),n=(c*(f-u)-c*(f-n))/((t-v)*(f-u)-(t-w)*(f-n)),c=c-l*f-n*t,d=d.getContext("2d"),f=y;y=d;y.save();y.transform(r,l,m,n,p,c);e.generation++;A(g);y.restore();y=f};r.canvas$5=function(a,b){var c=D(a[0]),d=D(a[1]),e=D(a[2]),g=A(a[3]),f=a[4],c=E.extractPoint(c),l=E.extractPoint(d),m=E.extractPoint(e);if(!c.ok||!l.ok||!m.ok||"string"!==g.ctype&&"image"!==g.ctype)return k;g=Pa(g);if(!g||!g.img.getContext)return k;var e=g.img,n=g.width,d=g.height,
p=z.from(c.x,c.y,1),r=z.from(l.x,l.y,1),l=z.from(m.x,m.y,1),c=p[0],m=p[1],t=r[0],v=r[1],u=l[0],w=l[1],l=((0-n)*(m-w)-0*(m-v))/((c-t)*(m-w)-(c-u)*(m-v)),n=((0-n)*(c-u)-0*(c-t))/((m-v)*(c-u)-(m-w)*(c-t)),r=0-l*c-n*m,p=((d-d)*(m-w)-(d-0)*(m-v))/((c-t)*(m-w)-(c-u)*(m-v)),t=((d-d)*(c-u)-(d-0)*(c-t))/((m-v)*(c-u)-(m-w)*(c-t)),d=d-p*c-t*m,e=e.getContext("2d"),c=y;y=e;y.save();y.transform(l,p,n,t,r,d);g.generation++;A(f);y.restore();y=c};r.screenresolution$0=function(a,b){return l.real(z.drawingstate.matrix.a)};
r.layer$1=function(a,b){};r.imagesize$1=function(a,b){var c=Pa(D(a[0]));return c?g.realVector([+c.width,+c.height]):k};r.imageready$1=function(a,b){var c=Pa(D(a[0]));return w.bool(!(!c||!c.ready))};r.drawimage$2=function(a,b){function c(){var a=1,c=1,d=1,f=1,q=0,l=1,n=E.extractPoint(e);if(!n.ok)return k;m=Pa(m);if(!m)return k;y.save();var p;void 0!==b.angle&&(p=A(b.angle),"number"===p.ctype&&(q=p.value.real));void 0!==b.rotation&&(p=A(b.rotation),"number"===p.ctype&&(q=p.value.real));void 0!==b.scale&&
(p=D(b.scale),"number"===p.ctype&&(c=a=p.value.real),g.isNumberVector(p).value&&2===p.value.length&&(a=p.value[0].value.real,c=p.value[1].value.real));void 0!==b.scalex&&(p=A(b.scalex),"number"===p.ctype&&(a=p.value.real));void 0!==b.scaley&&(p=A(b.scaley),"number"===p.ctype&&(c=p.value.real));void 0!==b.flipx&&(p=A(b.flipx),"boolean"===p.ctype&&p.value&&(d=-1));void 0!==b.flipy&&(p=A(b.flipy),"boolean"===p.ctype&&p.value&&(f=-1));void 0!==b.alpha&&(p=A(b.alpha),"number"===p.ctype&&(l=p.value.real));
var r=z.drawingstate.matrix,t=z.drawingstate.initialmatrix,T=m.width,v=m.height;p=n.x*r.a-n.y*r.b+r.tx;var u=n.x*r.c-n.y*r.d-r.ty,w=(n.x+1)*r.a-n.y*r.b+r.tx-p,r=(n.x+1)*r.c-n.y*r.d-r.ty-u,dc=(n.x+1)*t.a-n.y*t.b+t.tx-(n.x*t.a-n.y*t.b+t.tx),t=(n.x+1)*t.c-n.y*t.d-t.ty-(n.x*t.c-n.y*t.d-t.ty),n=Math.sqrt(w*w+r*r)/Math.sqrt(dc*dc+t*t),w=-Math.atan2(w,r)+Math.atan2(dc,t),r=z.drawingstate.matrix.sdet/72,a=a*r,c=c*r;1!==l&&(y.globalAlpha=l);y.translate(p,u);y.scale(a*d*n,c*f*n);y.rotate(q+w);y.translate(-p,
-u);y.translate(-T/2,-v/2);a=m;a.drawTo?a.drawTo(y,p,u):y.drawImage(a.img,p,u);y.globalAlpha=1;y.restore()}function d(){var a=1,c=1,g=1,q=1,n=E.extractPoint(e),p=E.extractPoint(f),r;if(!n.ok||!p.ok)return k;m=Pa(m);if(!m)return k;var t=m.width,v=m.height;if(0===l)r={},r.x=n.x-(p.y-n.y),r.y=n.y+(p.x-n.x),q=v/t;else if(r=E.extractPoint(l),!n.ok)return k;y.save();var u;void 0!==b.alpha&&(u=A(b.alpha),"number"===u.ctype&&(a=u.value.real));void 0!==b.aspect&&(u=A(b.aspect),"number"===u.ctype&&(q=u.value.real));
void 0!==b.flipx&&(u=A(b.flipx),"boolean"===u.ctype&&u.value&&(c=-1));void 0!==b.flipy&&(u=A(b.flipy),"boolean"===u.ctype&&u.value&&(g=-1));u=z.drawingstate.matrix;1!==a&&(y.globalAlpha=a);a=n.x*u.a-n.y*u.b+u.tx;n=n.x*u.c-n.y*u.d-u.ty;y.transform(p.x*u.a-p.y*u.b+u.tx-a,p.x*u.c-p.y*u.d-u.ty-n,r.x*u.a-r.y*u.b+u.tx-a,r.x*u.c-r.y*u.d-u.ty-n,a,n);y.scale(1/t,-1/v*q);y.translate(t/2,-v/2);y.scale(c,g);y.translate(-t/2,v/2);y.translate(0,-v);c=m;c.drawTo?c.drawTo(y,0,0):y.drawImage(c.img,0,0);y.globalAlpha=
1;y.restore()}var e,f,l,m;return 2===a.length?(e=D(a[0]),m=D(a[1]),c()):3===a.length?(e=D(a[0]),f=D(a[1]),l=0,m=D(a[2]),d()):4===a.length?(e=D(a[0]),f=D(a[1]),l=D(a[2]),m=D(a[3]),d()):k};r.drawimage$3=r.drawimage$2;r.drawimage$4=r.drawimage$2;r.allimages$0=function(){var a=[];Object.keys(bb).forEach(function(b){a.push({ctype:"string",value:b})});return g.turnIntoCSList(a)};r.cameravideo$0=function(a,b){function c(a){return{video:{width:a,advanced:[{width:{max:a,min:a}},{width:{ideal:a}}]},audio:!1}}
var d=!0,e={};if(void 0!==b.resolution){var f=A(b.resolution);"string"===f.ctype&&"maximal"===f.value?d=!0:"number"===f.ctype?(d=!1,e=c(f.value.real)):g._helper.isNumberVecN(f,2)&&(d=!1,e=c(f.value[0].value.real),f=f.value[1].value.real,10>f||!Number.isInteger(f)?(e.video.aspectRatio=f,e.video.advanced[0].aspectRatio={min:f,max:f},e.video.advanced[1].aspectRatio={ideal:f}):(e.video.height=f,e.video.advanced[0].height={min:f,max:f},e.video.advanced[1].height={ideal:f}))}d&&(e=[320,640,1024,1280,1920,
2560],e=e.map(function(a){return{width:{min:a}}}),e={video:{width:16E3,height:9E3,advanced:e},audio:!1});var d=null,l=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia;l?d=function(a,b){navigator.mediaDevices.getUserMedia(e).then(a,b)}:(l=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)&&(d=function(a,b){l.call(navigator,e,a,b)});if(!d)return console.warn("getUserMedia call not supported"),k;var m=document.createElement("video");
m.autoplay=!0;f=pa(m);console.log("Opening stream.");d(function(a){a=window.URL.createObjectURL(a);m.src=a;m.addEventListener("loadeddata",La)},function(a){console.error("Could not get user video:",String(a),a)});return f};var Cb;r.imagergba$3=function(a,b){var c=Pa(D(a[0])),d=D(a[1]),e=D(a[2]);if(!c||"number"!==d.ctype||"number"!==e.ctype||!c.ready)return k;d=Math.round(d.value.real);e=Math.round(e.value.real);if(!Aa(d)||!Aa(e))return k;c=qb(c,d,e,1,1);return g.realVector([255*c[0],255*c[1],255*
c[2],c[3]])};r.imagergb$3=r.imagergba$3;r.imagergba$4=function(a,b){var c=Pa(D(a[2]));if(!c||!c.ready)return k;var d=c.width,e=c.height,f=L(a[0]),l=L(a[1]),m=L(g.realVector([0,e,1])),d=L(g.realVector([d,e,1]));if(f===k||l===k||n===k)return k;var n=g.ii,e=g.jj,m=E.basismap(m,d,n,e),f=E.basismap(f,l,e,n),n=L(a[3]);var p=E.extractPoint(w.mult(m,w.mult(g.adjoint3(f),n)));if(p.ok){var l=c.width,m=c.height,n=!0,r=!1;void 0!==b.interpolate&&(f=A(b.interpolate),"boolean"===f.ctype&&(n=f.value));void 0!==
b.repeat&&(f=A(b.repeat),"boolean"===f.ctype&&(r=f.value));n&&(p.x-=.5,p.y-=.5);r&&(p.x=(p.x%l+l)%l,p.y=(p.y%m+m)%m);d=Math.floor(p.x);e=Math.floor(p.y);if(Aa(d)&&Aa(e)){f=[0,0,0,0];if(n){var n=p.x-d,p=p.y-e,t=qb(c,d,e,2,2);if(r){if(d===l-1||e===m-1)var r=qb(c,(d+1)%l,e,1,1),u=qb(c,d,(e+1)%m,1,1),c=qb(c,(d+1)%l,(e+1)%m,1,1),t=t.slice(0,4).concat(r,u,c)}else{if(-1===d||d===l-1)n=Math.round(n);if(-1===e||e===m-1)p=Math.round(p)}for(c=0;4>c;c++)f[c]=(1-p)*((1-n)*t[c]+n*t[c+4])+p*((1-n)*t[c+8]+n*t[c+
12])}else f=qb(c,d,e,1,1);c=g.realVector(f)}else c=k}else c=k;return c};r.imagergb$4=function(a,b){var c=r.imagergba$4(a,b);return c===k?k:g.turnIntoCSList(c.value.slice(0,3))};"use strict";var se=[{key:[":"],field:["."],deg:["\u00b0"],take:["_"]},{functionCall:!0},{rassoc:!0,pow:["^"],sqrt:["\u221a"]},{mul:["*","\u2062","\u22c5","\u00b7"],cross:["\u00d7"],div:["/","\u00f7","\u2215","\u2236"]},{add:["+"],sub:["-","\u2212"],neg:["!","\u00ac"]},{seq:[".."]},{eq:["==","\u225f"],ne:["!=","<>","\u2260"],
lt:["<"],gt:[">"],le:["<=","\u2264","\u2266"],ge:[">=","\u2265","\u2267"],aeq:["~=","\u2248"],ane:["~!=","\u2249"],alt:["~<","\u2a89"],agt:["~>","\u2a8a"],ale:["~<=","\u2a85"],age:["~>=","\u2a86"],"in":["\u2208"],nin:["\u2209"]},{and:["&","\u2227"],or:["%","\u2228"]},{rassoc:!0,prepend:["<:"]},{concat:["++","\u222a"],remove:["--","\u2216"],common:["~~","\u2229"],append:[":>"]},{rassoc:!0,assign:["="],define:[":="],undefine:[":=_"],bdefine:["::="]},{seq:[";"]},{modif:["->","\u2192"]},{rassoc:!0,list:[","]}],
te=["+","-"],ue=["!","\u221a"],ve=["\u00b0",":=_"],we=[";",","],Cc=[],va={},dd;(function(){var a=0;se.forEach(function(b){a+=2;var c=!!b.rassoc;b.functionCall&&(dd=a);for(var d in b){var e=b[d];if("boolean"!==typeof e)for(var g={name:d,sym:e[0],symbols:e,rassoc:c,precedence:a,prefix:!1,postfix:!1,infix:!0,bare:!1},f=0;f<e.length;++f){var l=e[f];if(va.hasOwnProperty(l))throw Error("Duplicate operator: "+l);va[l]=g;Cc.push(l)}}});te.forEach(function(a){va[a].prefix=!0});ue.forEach(function(a){va[a].prefix=
!0;va[a].infix=!1});ve.forEach(function(a){va[a].postfix=!0;va[a].infix=!1});we.forEach(function(a){va[a].prefix=!0;va[a].postfix=!0;va[a].infix=!0;va[a].bare=!0})})();Cc.sort(function(a,b){return b.length-a.length});var xe="(?:[0-9](?: [0-9])*(?: \\.(?! \\.)(?: [0-9])*)?|\\.(?: [0-9])+)(?: [Ee](?: [+-])?(?: [0-9])+)?".replace(/ /g,"[ \t]*"),ye="(?:[\u207a\u207b] )?[\u2070\u00b9\u00b2\u00b3\u2074\u2075\u2076\u2077\u2078\u2079](?: [\u2070\u00b9\u00b2\u00b3\u2074\u2075\u2076\u2077\u2078\u2079])*".replace(/ /g,
"[ \t]*"),ze="(?:[\u208a\u208b] )?[\u2080\u2081\u2082\u2083\u2084\u2085\u2086\u2087\u2088\u2089](?: [\u2080\u2081\u2082\u2083\u2084\u2085\u2086\u2087\u2088\u2089])*".replace(/ /g,"[ \t]*"),Dc=function(a,b,c){var d,e,g=0,f="(?:[",l=b.length;for(d=0;d<l;++d)e=b.charCodeAt(d),55296<=e?(f+="]|"+b.charAt(d)+"[",g=56320):(f+=String.fromCharCode(e=g=a[e-32]+g),g+=a[b.charCodeAt(++d)-32],g!==e&&(g!==e+1&&(f+="-"),f+=String.fromCharCode(g)));return f+"]|["+c+"][\udc00-\udfff])"}([2,0,106,3,4,1,6,5,7,11,17,
8,12,21,9,22,30,10,15,24,25,16,13,42,46,14,18,19,29,37,27,28,35,26,32,36,40,43,47,53,20,48,50,56,33,34,39,51,52,55,63,64,65,68,85,23,31,38,45,49,105,59,66,69,72,88,102,114,117,128,157,191,41,44,54,60,67,70,71,73,74,75,76,80,81,82,83,84,86,87,89,93,94,98,99,107,108,116,122,130,132,134,138,160,165,185,195,196,255,268,277,310,332,339,362,365,390,449,457,470,512,513,541,568,582,619,673,726,768,820,921,991,1164,2684,6581,8453,11171,20949],"T4(4I!)!'!&/ 0 \u0096')2$+! !\u0083$ %## !(!   ! ; u \u0086.\u0088 =#!+YoA& 87C% } !5%+%) #!*! <0a,!4B1%'!&-'!1!$!33`HsG$!;!+.52'(#%#- & !$#$!*!9%  2%H''%#- & % % %B# !H *+   - & % $$!;!5%3!,(#%#- & % $$!X%  5!:! '$  #$% ! %$%$ $)W!G(   / 2$!> &%C(   / . $$!L! %5%;(   D#!*!* 4'&*$W + !#&]F %6&]% !#% !#!(# &   ! !#% # %1!#$ !/#L!S( @?$\u00817-!*''#$!$%+ ',6!:= !&!#7 \u0090 ##& ! ##D ##B ##& ! ##9 K ##^Y2*V#'$\u009d#5 4&p((+, #2*2*2,  5OC!'!Uy.D !&_)0J<#$,E'4Q/1Pv!|8:&K<9%)E>@7 )@\u0080# #$%1gT\u008e#'#=#'#( ! ! ! 0#P & !$  &$##'',&  &d!9!*,b!'!#. !$$(! ! ! # 1##&$'!G%\u00a58 8 \u0084(#$%6= !&!#Q+!*/1& & & & & & & &t!\u0097%E$&%'V(  z #&D${:Aj2\u0099\u00a6q\u00a9E\u00a4UZ#\u008d$2)%-8*0#_J+#b#M#(S1   # /0O2[R'$! !6>)/A?+8<!*$ .)$ D3  (-/$!$[ !$%#$#! !4 #1+ 6'#'#'1& & 7 .)c0\u00a86/'I\u00a7\u0093#\\N&6$&! . , $ ! % % \u007fM\u0092;R#Gh)d$ \u0085=4(4,a$'#'#'# \ud800!) 4 : % 9#6@\u0082\u0094?$IIX*5 ((=)<#@'(\ud801!f~N.Of\u008f1-)(\ud802!'#! E %$!#/)/10^: %)-)4nQ(%T!5#   AZ?$?C( >?G)-):9*\ud803!`KJ9J\ud804#PriL3>@7M$!6F2#/! !C* 3V& ! # 9 .+8N(#%#- & % $$!;!6$\ud805eF-% !\u008987#=F-!k7x4\ud806\u0087RB!\u0095K\ud808!\u00a2\ud809e\u008a\ud80d!8\ud811!\u009c\ud81a!\u009b+0c<;F*#BH&:\ud81b\u00a0U,!l,\ud82c!%\ud82f!\"&,$++.\ud835!w m %#!#%## ) ! & S ##( & > # $ !$& \u0091#3 3 0 3 0 3 0 3 0 3 (\ud83a!\u008b\ud83b\u0098# A % !#! . # ! !(!'! ! !   % !#! ! ! ! ! % !## & # # ! . 5&  $ 5\ud869!\u009f7\u008c\ud86d!\u00a1,g\ud86e!<#\u00a3\ud873!\u009e\ud87e!\u009a",
"\ud80c\ud840-\ud868\ud86a-\ud86c\ud86f-\ud872"),Ae=("#(?: [1-9])?|(?:'|"+Dc+")(?: (?:[0-9']|"+Dc+"))*").replace(/ /g,"[ \t]*"),ad=["([ \t\n]+)|(//.*)|(/\\*)","("+xe+")","("+Cc.map($c).join("|")+")","("+"[](){}||".split("").map($c).join("|")+")","("+ze+")","("+ye+")","("+Ae+")",'("[^"]*")|($)'].join("|"),Be=new RegExp("[ \t]*".replace(/\*$/,"+"),"g"),Ec="ANY WS COMMENT START_COMMENT NUM OP BRA SUB SUP ID STR EOF".split(" ");(function(){var a=(new RegExp(ad,"g")).exec("");if(a.hasOwnProperty(Ec.length))throw Error("RE has more groups than expected");
if(!a.hasOwnProperty(Ec.length-1))throw Error("RE has fewer groups than expected");})();jb.prototype.advanceBy=function(a){this.advanceTo(this.pos+a)};jb.prototype.advanceTo=function(a){for(this.pos=a;this.bols[0]<=a;)this.bol=this.bols.shift(),this.line++};jb.prototype.curPos=function(){return{row:this.line,col:this.pos-this.bol,pos:this.pos}};jb.prototype.nextInternal=function(){var a=this.re.exec(this.input);if(a.index!==this.pos)throw fa("Invalid token",this.curPos(),this.input.substring(this.pos,
a.index));var b=this.curPos();this.advanceBy(a[0].length);var c=this.curPos(),d;for(d=1;null==a[d];++d);return{start:b,end:c,raw:a[0],text:a[0].replace(Be,""),toktype:Ec[d]}};jb.prototype.next=function(){var a;do if(a=this.nextInternal(),"START_COMMENT"===a.toktype){var b=/\*\/|\/\*/g;b.lastIndex=a.start.pos+2;for(var c=1,d;0<c;)if(d=b.exec(this.input))"/*"===d[0]?++c:--c;else throw fa("Unterminated comment",a.start,a.text);this.re.lastIndex=b.lastIndex;this.advanceTo(b.lastIndex);a.end=this.curPos();
a.raw=this.input.substring(a.start.pos,a.end.pos);a.text=a.raw;a.toktype="COMMENT"}while("WS"===a.toktype||"COMMENT"===a.toktype);return a};var Ce={ctype:"void"};Db.prototype.postprocess=function(a){if(null===a)return Ce;if(a){if("infix"===a.ctype)if(":="===a.oper){var b=a.args[0];if("function"===b.ctype)b.args.forEach(function(b){if(null===b||"variable"!==b.ctype)throw fa("Function argument must be an identifier",b.start||a.start);});else if("variable"!==b.ctype)throw fa(a.oper+" can only be used to define functions or variables",
a.start);}else if(","===a.oper)throw fa("comma may only be used to delimit list elements",a.start);a.args&&(a.args=a.args.map(this.postprocess,this));if(a.modifs)for(var c in a.modifs)a.modifs[c]=this.postprocess(a.modifs[c]);if("paren"===a.ctype)return a.args[0];if("infix"===a.ctype){if("."===a.oper){if(!a.args[1]||"variable"!==a.args[1].ctype)throw fa("Field name must be identifier",a.start,a.text);a.ctype="field";a.obj=a.args[0];a.key=a.args[1].name;delete a.args}this.infixmap&&(a.impl=this.infixmap[a.oper])}else"variable"===
a.ctype?this.usedVariables[a.name]=!0:"function"===a.ctype&&(this.usedFunctions[a.oper]=!0)}if("infix"===a.ctype)return{ctype:"infix",oper:String(a.oper),args:[a.args[0],a.args[1]],impl:a.impl};if("variable"===a.ctype)return{ctype:"variable",name:String(a.name)};if("number"===a.ctype)return{ctype:"number",value:{real:+a.value.real,imag:+a.value.imag}};if("string"===a.ctype)return{ctype:"string",value:String(a.value)};if("list"===a.ctype)return{ctype:"list",value:a.value};if("function"===a.ctype)return{ctype:"function",
oper:String(a.oper),args:a.args,modifs:a.modifs};if("field"===a.ctype)return{ctype:"field",obj:a.obj,key:String(a.key)};throw Error("Unsupported AST node of type "+a.ctype);};Db.prototype.parse=function(a){try{var b=cd(new jb(a));if("EOF"!==b.closedBy.toktype)throw fa("Closing bracket never opened.",b.closedBy.start,b.closedBy.text);return this.postprocess(b.expr)}catch(c){return c.ctype="error",c}};"undefined"!==typeof process&&"undefined"!==typeof module&&"undefined"!==typeof module.exports&&"undefined"===
typeof window&&(module.exports.Parser=Db,module.exports.Tokenizer=jb,module.exports.unicodeLetters=Dc,module.exports.parse=function(a){return(new Db).parse(a)});var Oc={},Fc;Fc=[0,0,0,0,0,0,0,0,0,0,0,0];r.playsin$1=function(a,b){var c=D(a[0]),d=0;if("number"===c.ctype){var e;void 0!==b.line&&(e=A(b.line),"number"===e.ctype&&(d=Math.floor(e.value.real),0>d&&(d=0),10<d&&(d=10)));c=c.value.real;0!==Fc[d]&&Fc[d].set({freq:c})}return k};var N={printArr:function(a){for(var b=a.value.length,c=[],d=[],e=
!1,g=0;g<b;g++)c[g]=a.value[g].value.real,d[g]=a.value[g].value.imag,0!==d[g]&&(e=!0);console.log(c);e&&console.log(d)},zero:function(a){for(var b=[],c=l.real(0),d=0;d<a.value.real;d++)b[d]=c;return g.turnIntoCSList(b)},number:function(a,b){var c=N.zero(b);c.value[0]=a;return c},variable:function(a,b){var c=N.zero(b);c.value[0]=a;c.value[1]=l.real(1);return c},add:function(a,b){return g.add(a,b)},sub:function(a,b){return g.sub(a,b)},mult:function(a,b){if(a.value.length!==b.value.length)return console.error("dims don't fit return nada"),
k;for(var c=a.value.length,d=N.zero(l.real(c)),e=l.real(0),g=0;g<c;g++){for(var f=0;f<=g;f++)e=l.add(e,l.mult(a.value[f],b.value[g-f]));d.value[g]=e;e=l.real(0)}return d},pow:function(a,b){if(0>b.value.real||b.value.real!==Math.floor(b.value.real))return N.root(a,b);for(var c=a,d=1;d<b.value.real;d++)c=N.mult(c,a);return c},root:function(a,b){var c=l.real(0),d=l.real(1),e=l.add(d,b),g=a.value.length,f=N.zero(l.real(g));f.value[0]=l.pow(a.value[0],b);for(var k=c,m,n,p=1;p<g;p++){n=l.real(p);for(var r=
1;r<=p;r++)m=l.mult(e,l.real(r)),m=l.div(m,n),m=l.sub(m,d),m=l.mult(m,a.value[r]),m=l.mult(m,f.value[p-r]),k=l.add(k,m);k=l.div(k,a.value[0]);f.value[p]=k;k=c}return f},findFirstNoneZero:function(a,b,c){for(var d=Infinity,e=Infinity,g=c;g<a.value.length;g++)if(1E-12<l.abs2(a.value[g]).value.real){d=g;break}for(a=c;a<b.value.length;a++)if(1E-12<l.abs2(b.value[a]).value.real){e=a;break}return[d,e]},div:function(a,b){if(a.value.length!==b.value.length)return console.log("dims don't fit - return nada"),
k;for(var c=a.value.length,d=l.real(0),e=N.zero(l.real(c)),g=d,f,m=0;m<c;m++){f=N.findFirstNoneZero(a,b,m);m<f[0]&&f[0]===f[1]&&Infinity!==f[0]&&(a.value.splice(m,f[0]),b.value.splice(m,f[0]),e.value.splice(m,f[0]),c-=f[0]);f=a.value[m];for(var n=0;n<m;n++)g=l.add(g,l.mult(e.value[n],b.value[m-n]));f=l.sub(f,g);f=l.div(f,b.value[0]);e.value[m]=f;g=d}return e},exp:function(a){var b=l.real(0),c=a.value.length,d=N.zero(l.real(c)),e=b,g;d.value[0]=l.exp(a.value[0]);for(var f=1;f<c;f++){for(var k=1;k<=
f;k++)g=l.mult(l.real(k),a.value[k]),g=l.mult(g,d.value[f-k]),e=l.add(e,g);d.value[f]=l.div(e,l.real(f));e=b}return d},log:function(a){var b=l.real(0),c=a.value.length,d=N.zero(l.real(c));d.value[0]=l.log(a.value[0]);for(var e=b,g,f,k=1;k<c;k++){g=a.value[k];for(var m=1;m<k;m++)f=l.mult(l.real(m),d.value[m]),f=l.mult(f,a.value[k-m]),e=l.add(e,f);e=l.div(e,l.real(k));g=l.sub(g,e);g=l.div(g,a.value[0]);d.value[k]=g;e=b}return d},sincos:function(a){var b=l.real(0),c=a.value.length,d=N.zero(l.real(c)),
e=N.zero(l.real(c));d.value[0]=l.sin(a.value[0]);e.value[0]=l.cos(a.value[0]);for(var g=b,f=b,k,m,n,p=1;p<c;p++){n=l.real(p);for(var r=1;r<=p;r++)m=l.mult(l.real(r),a.value[r]),k=l.mult(m,e.value[p-r]),m=l.mult(m,d.value[p-r]),f=l.add(f,k),g=l.add(g,m);f=l.div(f,n);g=l.div(g,l.neg(n));d.value[p]=f;e.value[p]=g;g=f=b}N.sinsave=d;N.cossave=e;return[d,e]},sin:function(a){return N.sincos(a)[0]},cos:function(a){return N.sincos(a)[1]},faculty:function(a){var b=[];b[0]=l.real(1);for(var c=1,d=1;d<=a.value.real;d++)c*=
d,b[d]=l.real(c);return b=g.turnIntoCSList(b)},diff:function(a,b,c,d){var e;if("variable"===a.ctype)e=a.name!==b?N.number(A(a),d):N.variable(c,d);else if("number"===a.ctype)e=N.number(a,d);else{if("infix"===a.ctype){if("*"===a.oper)return N.mult(N.diff(a.args[0],b,c,d),N.diff(a.args[1],b,c,d));if("^"===a.oper)return N.pow(N.diff(a.args[0],b,c,d),N.diff(a.args[1],b,c,d).value[0]);if("/"===a.oper)return N.div(N.diff(a.args[0],b,c,d),N.diff(a.args[1],b,c,d));if("+"===a.oper)return N.add(N.diff(a.args[0],
b,c,d),N.diff(a.args[1],b,c,d));if("-"===a.oper)return N.sub(N.diff(a.args[0],b,c,d),N.diff(a.args[1],b,c,d));console.log("infix not found",a.oper);return k}if("function"===a.ctype){if("exp$1"===a.oper)return N.exp(N.diff(a.args[0],b,c,d));if("log$1"===a.oper)return N.log(N.diff(a.args[0],b,c,d));if("sin$1"===a.oper)return N.sin(N.diff(a.args[0],b,c,d));if("cos$1"===a.oper)return N.cos(N.diff(a.args[0],b,c,d))}else return console.log("ctype not found",a.ctype),k}return e},adevaluate:function(a,b,
c,d){a=N.diff(a,b,c,d);d=N.faculty(d);for(b=2;b<a.value.length;b++)a.value[b]=l.mult(a.value[b],d.value[b]);return a},autodiff:function(a,b,c,d){for(var e=[],f=c.value.length,l,k=0;k<f;k++)l=N.adevaluate(a,b,c.value[k],d),e[k]=l;return e=g.turnIntoCSList(e)}},x={handleModifs:function(a,b){x.dashing&&x.unSetDash();x.colorraw=null;x.fillcolorraw=null;x.fillrule="nonzero";x.size=null;0>=x.psize&&(x.psize=0);0>=x.lsize&&(x.lsize=0);x.overhang=1;x.dashing=!1;x.isArrow=!1;x.arrowSides="==>";x.arrowposition=
1;x.headlen=10;x.arrowShape=x.arrowShapes.line;x.alpha=z.drawingstate.alpha;x.fillalpha=0;x.bold="";x.italics="";x.family="sans-serif";x.align=0;x.xOffset=0;x.yOffset=0;x.lineCap="round";x.lineJoin="round";x.miterLimit=10;var c,d;for(c in a){var e=a[c];e&&((d=b[c])?(!0===d&&(d=x.modifHandlers[c]),d(A(e))):console.log("Modifier not supported: "+c))}null!==x.size?x.psize=x.lsize=x.size:(x.psize=z.drawingstate.pointsize,x.lsize=z.drawingstate.linesize);x.dashing&&x.dashing(x.lsize);null!==x.colorraw?
x.pointColor=x.lineColor=x.textColor=x.makeColor(x.colorraw):1===x.alpha?(x.pointColor=z.drawingstate.pointcolor,x.lineColor=z.drawingstate.linecolor,x.textColor=z.drawingstate.textcolor):(x.pointColor=x.makeColor(z.drawingstate.pointcolorraw),x.lineColor=x.makeColor(z.drawingstate.linecolorraw),x.textColor=x.makeColor(z.drawingstate.textcolorraw));x.black=1===x.alpha?"rgb(0,0,0)":"rgba(0,0,0,"+x.alpha+")";x.fillColor=x.fillcolorraw&&0<x.fillalpha?x.makeColor(x.fillcolorraw,x.fillalpha):null},modifHandlers:{size:function(a){"number"===
a.ctype&&(x.size=a.value.real,0>x.size&&(x.size=0),1E3<x.size&&(x.size=1E3))},color:function(a){g.isNumberVector(a).value&&3===a.value.length&&(x.colorraw=[a.value[0].value.real,a.value[1].value.real,a.value[2].value.real])},fillcolor:function(a){g.isNumberVector(a).value&&3===a.value.length&&(x.fillcolorraw=[a.value[0].value.real,a.value[1].value.real,a.value[2].value.real])},alpha:function(a){"number"===a.ctype&&(x.alpha=a.value.real)},fillalpha:function(a){"number"===a.ctype&&(x.fillalpha=a.value.real)},
dashpattern:function(a){if("list"===a.ctype){for(var b=[],c=0,d=0;c<a.value.length;c++)"number"===a.value[c].ctype&&(b[d++]=a.value[c].value.real);x.dashing=x.setDash.bind(null,b)}},dashtype:function(a){if("number"===a.ctype)a=Math.floor(a.value.real);else if("string"===a.ctype)a=a.value;else return;if(a=x.dashTypes[a])x.dashing=x.setDash.bind(null,a)},dashing:function(a){"number"===a.ctype&&(a=Math.floor(a.value.real),x.dashing=x.setDash.bind(null,[2*a,a]))},overhang:function(a){"number"===a.ctype&&
(x.overhang=x.overhang*a.value.real+(1-x.overhang)*(1-a.value.real))},arrow:function(a){"boolean"===a.ctype?x.isArrow=a.value:console.error("arrow needs to be of type boolean")},arrowshape:function(a){"string"!==a.ctype?console.error("arrowshape needs to be of type string"):x.arrowShapes.hasOwnProperty(a.value)?(x.arrowShape=x.arrowShapes[a.value],x.isArrow=!0,x.arrowShape.deprecated&&(console.log("arrowshape "+a.value+" is deprecated, use "+x.arrowShape.deprecated+" instead."),x.arrowShape.deprecated=
null)):(a=Object.keys(x.arrowShapes),a.sort(),a=a.join(", "),console.error("arrowshape needs to be one of "+a))},arrowsides:function(a){"string"!==a.ctype?console.error("arrowsides is not of type string"):"==>"!==a.value&&"<==>"!==a.value&&"<=="!==a.value?console.error("arrowsides is unknows"):(x.arrowSides=a.value,x.isArrow=!0)},arrowposition:function(a){"number"!==a.ctype?console.error("arrowposition is not of type number"):0>a.value.real?console.error("arrowposition has to be positive"):1<a.value.real?
x.overhang=x.overhang*a.value.real+(1-x.overhang)*(1-a.value.real):(x.arrowposition=a.value.real,x.isArrow=!0)},arrowsize:function(a){"number"!==a.ctype?console.error("arrowsize is not of type number"):0>a.value.real?console.error("arrowsize has to be positive"):x.headlen*=a.value.real},bold:function(a){"boolean"===a.ctype&&a.value&&(x.bold="bold ")},italics:function(a){"boolean"===a.ctype&&a.value&&(x.italics="italic ")},family:function(a){"string"===a.ctype&&(x.family=a.value)},align:function(a){"string"===
a.ctype&&(a=a.value,"left"===a&&(x.align=0),"right"===a&&(x.align=1),"mid"===a&&(x.align=.5))},x_offset:function(a){"number"===a.ctype&&(x.xOffset=a.value.real)},y_offset:function(a){"number"===a.ctype&&(x.yOffset=a.value.real)},offset:function(a){"list"===a.ctype&&2===a.value.length&&"number"===a.value[0].ctype&&"number"===a.value[1].ctype&&(x.xOffset=a.value[0].value.real,x.yOffset=a.value[1].value.real)},lineCap:function(a){"string"!==a.ctype||"round"!==a.value&&"square"!==a.value&&"butt"!==a.value||
(x.lineCap=a.value)},lineJoin:function(a){"string"!==a.ctype||"round"!==a.value&&"bevel"!==a.value&&"miter"!==a.value||(x.lineJoin=a.value)},fillrule:function(a){"string"!==a.ctype||"nonzero"!==a.value&&"evenodd"!==a.value||(x.fillrule=a.value)},miterLimit:function(a){"number"===a.ctype&&0<a.value.real&&(x.miterLimit=Math.round(a.value.real))}},lineModifs:{size:!0,color:!0,alpha:!0,dashpattern:!0,dashtype:!0,dashing:!0,overhang:!0,arrow:!0,arrowshape:!0,arrowsides:!0,arrowposition:!0,arrowsize:!0,
lineCap:!0,lineJoin:!0,miterLimit:!0},pointModifs:{size:!0,color:!0,alpha:!0}};x.pointAndLineModifs=x.lineModifs;x.conicModifs={size:!0,color:!0,alpha:!0,fillcolor:!0,fillrule:!0,fillalpha:!0,lineCap:!0,lineJoin:!0,miterLimit:!0};x.textModifs={size:!0,color:!0,alpha:!0,bold:!0,italics:!0,family:!0,align:!0,x_offset:!0,y_offset:!0,offset:!0};x.makeColor=function(a,b){void 0===b&&(b=x.alpha);return"rgba("+Math.floor(255*a[0])+","+Math.floor(255*a[1])+","+Math.floor(255*a[2])+","+b+")"};x.preDrawCurve=
function(){y.lineWidth=x.lsize;y.lineCap=x.lineCap;y.lineJoin=x.lineJoin;y.mozFillRule=x.fillrule;y.fillrule=x.fillrule;y.miterLimit=x.miterLimit;y.strokeStyle=x.lineColor};x.arrowShapes={"default":{close:!1,fill:!1,ratio:1,deprecated:"line"},line:{close:!1,fill:!1,ratio:1},empty:{close:!0,fill:!1,ratio:1},hollow:{close:!0,fill:!1,ratio:1,deprecated:"empty"},full:{close:!0,fill:!0,ratio:1},jet:{close:!0,fill:!0,ratio:1.5},delta:{close:!0,fill:!0,ratio:1.5,deprecated:"jet"}};x.clipSegment=function(a,
b){var c=b.x-a.x,d=b.y-a.y,e=x.clipLineCore(-d,c,a.x*b.y-b.x*a.y);if(2!==e.length)return[];var g=e[0],e=e[1],f=1/(c*c+d*d),l=((g.x-a.x)*c+(g.y-a.y)*d)*f,c=((e.x-a.x)*c+(e.y-a.y)*d)*f;0>l&&(g=a);1<l&&(g=b);0>c&&(e=a);1<c&&(e=b);return g===e?[]:[g,e]};x.drawsegcore=function(a,b){function c(a,b,c,h){var d=a-h*r+.5*t,e=b-h*t-.5*r,g=a-h*r-.5*t;h=b-h*t+.5*r;y.beginPath();x.arrowShape.fill&&(y.lineWidth=x.lsize/2);y.moveTo(d,e);y.lineTo(a,b);y.lineTo(g,h);x.arrowShape.close&&(y.fillStyle=x.lineColor,y.lineTo(a-
c*r,b-c*t),y.closePath(),x.arrowShape.fill&&y.fill());y.stroke()}var d=z.drawingstate.matrix,e=a.x*d.a-a.y*d.b+d.tx,g=a.x*d.c-a.y*d.d-d.ty,f=b.x*d.a-b.y*d.b+d.tx,l=b.x*d.c-b.y*d.d-d.ty,k=x.overhang,m=1-k,d=k*e+m*f,n=k*g+m*l,p=k*f+m*e,k=k*l+m*g;if(0>d||d>ca||0>n||n>ba||0>p||p>ca||0>k||k>ba){k=x.clipSegment({x:d,y:n},{x:p,y:k});if(2!==k.length||.01>x.lsize)return;d=k[0].x;n=k[0].y;p=k[1].x;k=k[1].y}x.preDrawCurve();if(!x.isArrow||e===g&&f===l).01>x.lsize||(y.beginPath(),y.moveTo(d,n),y.lineTo(p,k),
y.stroke());else{var e=f-e,g=l-g,f=x.headlen/Math.sqrt(e*e+g*g),r=e*f,t=g*f,l=x.arrowposition,m=1-l,g=l*d+m*p,e=l*n+m*k,f=l*p+m*d,l=l*k+m*n,m=x.arrowSides;y.beginPath();x.arrowShape.close?("<==>"===m||"<=="===m?(1>x.arrowposition&&(y.moveTo(d,n),y.lineTo(g,e)),y.moveTo(g+r,e+t)):y.moveTo(d,n),"==>"===m||"<==>"===m?(y.lineTo(f-r,l-t),1>x.arrowposition&&(y.moveTo(f,l),y.lineTo(p,k))):y.lineTo(p,k)):(y.moveTo(d,n),y.lineTo(p,k));y.stroke();"==>"!==m&&"<==>"!==m||c(f,l,1,x.arrowShape.ratio);"<=="!==m&&
"<==>"!==m||c(g,e,-1,-x.arrowShape.ratio)}};x.drawpoint=function(a){var b=z.drawingstate.matrix,c=a.x*b.a-a.y*b.b+b.tx;a=a.x*b.c-a.y*b.d-b.ty;y.lineWidth=.3*x.psize;y.beginPath();y.arc(c,a,x.psize,0,2*Math.PI);y.fillStyle=x.pointColor;y.fill();y.beginPath();y.arc(c,a,1.15*x.psize,0,2*Math.PI);y.fillStyle=x.black;y.strokeStyle=x.black;y.stroke()};x.clipLineCore=function(a,b,c){var d=Math.SQRT1_2*x.lsize,e=0-d,g=ca+d,f=0-d,d=ba+d,l=0>e*a+f*b+c,k=0>g*a+f*b+c,m=0>e*a+d*b+c,n=0>g*a+d*b+c,p=[];l!==k&&p.push({x:(-c-
b*f)/a,y:f});k!==n&&p.push({x:g,y:(-c-a*g)/b});m!==n&&p.push({x:(-c-b*d)/a,y:d});l!==m&&p.push({x:e,y:(-c-a*e)/b});return p};x.clipLine=function(a){a=g.normalizeMax(g.productVM(a,z.toMat()));return x.clipLineCore(a.value[0].value.real,a.value[1].value.real,a.value[2].value.real)};x.drawline=function(a){g._helper.isAlmostReal(a)&&(a=x.clipLine(a),2===a.length&&.01<=x.lsize&&(x.preDrawCurve(),y.beginPath(),y.moveTo(a[0].x,a[0].y),y.lineTo(a[1].x,a[1].y),y.stroke()))};x.drawRaySegment=function(a,b){var c=
E.extractPoint(a),d=E.extractPoint(b);if(c.ok&&d.ok){var e=c.x-d.x,g=c.y-d.y,f=25E3/z.drawingstate.matrix.sdet/Math.sqrt(e*e+g*g),e=e*f,g=g*f;x.drawsegcore(c,{x:c.x+e,y:c.y+g});x.drawsegcore(d,{x:d.x-e,y:d.y-g})}};x.dashTypes={solid:[],dashed:[10,10],tightdash:[10,4],dotted:[1,3],dashdot:[10,5,1,5],"dashvalue.solid":[],"dashvalue.dashed":[10,10],"dashvalue.tightdash":[10,4],"dashvalue.dotted":[1,3],"dashvalue.dashdot":[10,5,1,5],0:[],1:[10,10],2:[10,4],3:[1,3],4:[10,5,1,5]};x.setDash=function(a,b){var c=
Math.sqrt(b);a=a.slice();for(var d=0;d<a.length;d++)a[d]*=c;y.webkitLineDash=a;y.setLineDash(a);y.mozDash=a};x.unSetDash=function(){y.webkitLineDash=[];y.setLineDash([]);y.mozDash=[]};ed.prototype={set fillStyle(a){var b=this;Qb(a,function(a,d,e,g){b._fill="#"+kb(a.toString(16),2)+kb(d.toString(16),2)+kb(e.toString(16),2);b._fillOpacity=255===g?null:g})},set strokeStyle(a){var b=this;Qb(a,function(a,d,e,g){b._stroke="#"+kb(a.toString(16),2)+kb(d.toString(16),2)+kb(e.toString(16),2);b._strokeOpacity=
255===g?null:g})},clearRect:function(){},beginPath:function(){this._path=[]},_pathcmd:function(){this._path.push.apply(this._path,arguments)},closePath:function(){this._pathcmd("Z")},moveTo:function(a,b){this._pathcmd("M",a,b)},lineTo:function(a,b){this._pathcmd("L",a,b)},bezierCurveTo:function(a,b,c,d,e,g){this._pathcmd("C",a,b,c,d,e,g)},quadraticCurveTo:function(a,b,c,d){this._pathcmd("Q",a,b,c,d)},arc:function(a,b,c,d,e,g){var f=c*Math.cos(d)+a,l=c*Math.sin(d)+b,k=c*Math.cos(e)+a,m=c*Math.sin(e)+
b;e=g?d-e:e-d;e>=2*Math.PI?this._pathcmd(this._path.length?"L":"M",f,l,"A",c,c,0,0,g?1:0,a-c*Math.cos(d),b-c*Math.sin(d),"A",c,c,0,0,g?1:0,f,l):this._pathcmd(this._path.length?"L":"M",f,l,"A",c,c,0,e>Math.PI?1:0,g?1:0,k,m)},rect:function(a,b,c,d){this._pathcmd("M",a,b,"h",c,"v",d,"h",-c,"z")},_cmd:function(a){1!==this.globalAlpha?(this._body.push('<g opacity="'+this.globalAlpha+'">'),this._body.push(a),this._body.push("</g>")):this._body.push(a)},_attrs:function(a){var b="",c;for(c in a)null!==a[c]&&
(b+=" "+c+'="'+a[c]+'"');return b},fill:function(){this._cmd("<path"+this._attrs({d:this._path.join(" "),fill:this._fill,"fill-opacity":this._fillOpacity})+"/>")},stroke:function(){this._cmd("<path"+this._attrs({d:this._path.join(" "),stroke:this._stroke,"stroke-opacity":this._strokeOpacity,"stroke-width":this.lineWidth,"stroke-linecap":this.lineCap,"stroke-linejoin":this.lineJoin,"stroke-miterlimit":"miter"===this.lineJoin?this.miterLimit:null})+"/>")},clip:function(){++this._clipIndex;this._body.push('<clipPath id="clip'+
this._clipIndex+'"><path d="'+this._path.join(" ")+'"/></clipPath>','<g clip-path="url(#clip'+this._clipIndex+')">');this._saveStack[this._saveStack.length-1]+="</g>"},save:function(){this._saveStack.push("")},restore:function(){this._body.push(this._saveStack.pop());0===this._saveStack.length&&this._saveStack.push("")},_transform:function(a){this._body.push('<g transform="'+a+'">');this._saveStack[this._saveStack.length-1]+="</g>"},translate:function(a,b){this._transform("translate("+a+" "+b+")")},
rotate:function(a){this._transform("rotate("+Math.PI/180*a+")")},scale:function(a,b){this._transform("scale("+a+" "+b+")")},transform:function(a,b,c,d,e,g){this._transform("matrix("+[a,b,c,d,e,g].join(" ")+")")},drawImage:function(a,b,c){if(3!==arguments.length)throw Error("SvgWriterContext only supports 3-argument version of drawImage");var d=this._imgcache.indexOf(a);if(-1===d){var d=this._imgcache.length,e;e=a.cachedDataURL?a.cachedDataURL:gd(a);this._defs.push('<image id="img'+d+'" x="0" y="0" width="'+
a.width+'" height="'+a.height+'" xlink:href="'+e+'"/>');this._imgcache.push(a)}this._cmd('<use x="'+b+'" y="'+c+'" xlink:href="#img'+d+'"/>')},toBlob:function(){for(;1<this._saveStack.length||""!==this._saveStack[0];)this.restore();var a='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="'+this.width+'px" height="'+this.height+'px">\n'+this._defs.join("\n")+'\n</defs>\n<g stroke="none" fill="none">\n'+
this._body.join("\n")+"\n</g>\n</svg>\n";return new Blob([a],{type:"image/svg+xml"})}};fd.prototype={_cmd:function(){this._body.push(Array.prototype.join.call(arguments," "))},_setAlpha:function(a,b,c){var d=Math.round(255*a*this._globalAlpha);b+=d;this._extGState[b]="<< /"+c+" "+d/255+" >>";this._cmd("/"+b,"gs");return a},set globalAlpha(a){this._globalAlpha=a;this._setAlpha(this._strokeAlpha,"As","CA");this._setAlpha(this._fillAlpha,"Af","ca")},set fillStyle(a){var b=this;Qb(a,function(a,d,e,g){b._cmd(a/
255,d/255,e/255,"rg");b._setAlpha(b._fillAlpha=g,"Af","ca")})},set strokeStyle(a){var b=this;Qb(a,function(a,d,e,g){b._cmd(a/255,d/255,e/255,"RG");b._setAlpha(b._strokeAlpha=g,"As","CA")})},set lineWidth(a){this._cmd(a,"w")},set lineCap(a){this._cmd({butt:0,round:1,square:2}[a],"J")},set lineJoin(a){this._cmd({miter:0,round:1,bevel:2}[a],"j")},set miterLimit(a){this._cmd(a,"M")},clearRect:function(){},beginPath:function(){this._pathUsed=!1},closePath:function(){this._cmd("h")},moveTo:function(a,b){this._cmd(this._xPos=
a,this._yPos=-b,"m")},lineTo:function(a,b){this._cmd(this._xPos=a,this._yPos=-b,"l")},bezierCurveTo:function(a,b,c,d,e,g){this._cmd(a,-b,c,-d,this._xPos=e,this._yPos=-g,"c")},quadraticCurveTo:function(a,b,c,d){this.bezierCurveTo((2*a+this._xPos)/3,(2*b-this._yPos)/3,(c+2*a)/3,(d+2*b)/3,c,d)},_kappa:.5522847498307935,arc:function(a,b,c,d,e,g){if(0===d&&e===2*Math.PI)d=this._kappa*c,this.moveTo(a+c,b),this.bezierCurveTo(a+c,b+d,a+d,b+c,a,b+c),this.bezierCurveTo(a-d,b+c,a-c,b+d,a-c,b),this.bezierCurveTo(a-
c,b-d,a-d,b-c,a,b-c),this.bezierCurveTo(a+d,b-c,a+c,b-d,a+c,b);else throw Error("PdfWriterContext.arc only supports full circles");},rect:function(a,b,c,d){this._cmd(a,-b,c,-d,"re")},_usePath:function(a){if(this._pathUsed){var b=this._body[this._pathUsed],c={"S + f":"B","f + S":"B","W n + S":"W S","W n + f":"W f","S + W n":"W S","f + W n":"W f","B + W n":"W B","W S + f":"W B","W f + S":"W B"}[b+" + "+a];if(!c)throw Error("Don't know how to combine '"+b+"' and '"+a+"'");this._body.splice(this._pathUsed,
1);a=c}this._pathUsed=this._body.length;this._cmd(a)},fill:function(){this._usePath("f")},stroke:function(){this._usePath("S")},clip:function(){this._usePath("W n")},save:function(){this._cmd("q")},restore:function(){this._cmd("Q")},translate:function(a,b){this.transform(1,0,0,1,a,b)},rotate:function(a){var b=Math.cos(a);a=Math.sin(a);this.transform(b,a,-a,b,0,0)},scale:function(a,b){this.transform(a,0,0,b,0,0)},transform:function(a,b,c,d,e,g){this._cmd(a,-b,-c,d,e,-g,"cm")},_png:function(a){if("data:image/png;base64,"!==
a.substr(0,22))return{error:"Not a base64-encoded PNG file"};a=Xd(a.substr(22));var b=Yd(a);console.log("PNG chunks:",b.map(function(a){return a.type}));if("IHDR"!==b[0].type)throw Error("Image does not start with an IHDR");var c=b[0].data;a=(c[0]<<24|c[1]<<16|c[2]<<8|c[3])>>>0;var d=(c[4]<<24|c[5]<<16|c[6]<<8|c[7])>>>0,e=c[8],g=c[9],f=0===(g&2),l=0!==(g&4),k=c[10],m=c[11],c=c[12];if(0!==k)throw Error("Unsupported PNG compression method: "+k);if(0!==m)throw Error("Unsupported PNG filter method: "+
m);if(0!==c)return{error:"Interlaced image not supported"};if(0!==(g&1))return{error:"Indexed PNG image not supported"};m=null;g=f?1:3;k=b.filter(function(a){return"IDAT"===a.type}).map(function(a){return a.data});if(l){l=window.pako;m=new l.Inflate;for(b=0;b<k.length;++b)m.push(k[b],b+1===k.length);if(m.err)throw Error(m.err);m=m.result;c=e>>>3;if(m.length!==d*(a*(g+1)*c+1))throw Error("Data length mismatch");for(var n=g*c,k=new Uint8Array(d*(a*n+1)),p=new Uint8Array(d*(a*c+1)),r=0,t=0,u=0,v=0;v<
d;++v){k[t++]=p[u++]=m[r++];for(var w=0;w<a;++w){for(b=0;b<n;++b)k[t++]=m[r++];for(b=0;b<c;++b)p[u++]=m[r++]}}if(r!==m.length||t!==k.length||u!==p.length)throw Error("Seems we garbled our index computation somehow");p=l.deflate(p);m=this._strm({Type:"/XObject",Subtype:"/Image",Width:a,Height:d,ColorSpace:"/DeviceGray",BitsPerComponent:e,Filter:"/FlateDecode",DecodeParms:this._dict({Predictor:15,Colors:1,BitsPerComponent:e,Columns:a})},p).ref;k=[l.deflate(k)]}var x=0;k.forEach(function(a){x+=a.length});
return this._obj([this._dict({Type:"/XObject",Subtype:"/Image",Name:"/img"+this._imgcache.length,Width:a,Height:d,ColorSpace:f?"/DeviceGray":"/DeviceRGB",SMask:m,BitsPerComponent:e,Length:x,Filter:"/FlateDecode",DecodeParms:this._dict({Predictor:15,Colors:g,BitsPerComponent:e,Columns:a})}),"\nstream\n"].concat(k,["\nendstream"]))},drawImage:function(a,b,c){if(3!==arguments.length)throw Error("PdfWriterContext only supports 3-argument version of drawImage");var d=this._imgcache.indexOf(a);if(-1===
d){d=this._imgcache.length;this._imgcache.push(a);var e=this._png(a.cachedDataURL||"");e.hasOwnProperty("error")&&(e=this._png(gd(a)));if(e.hasOwnProperty("error"))throw Error(e.error);this._xobjects["img"+d]=e.ref}this._cmd("q");this._setAlpha(1,"Af","ca");this._cmd(a.width,0,0,a.height,b,-c-a.height,"cm");this._cmd("/img"+d,"Do");this._cmd("Q")},_dict:function(a){var b="<<",c;for(c in a)b+=" /"+c+" "+a[c];return b+" >>"},_obj:function(a,b){b||(b=this._nextIndex++);Array.isArray(a)||(a=[this._dict(a)]);
a.index=b;a.ref=b+" 0 R";a.offset=this._offset;var c=0;a.unshift(b+" 0 obj\n");a.push("\nendobj\n");for(var d=0;d<a.length;++d)c+=a[d].length;this._offset+=c;this._objects.push(a);return a},_strm:function(a,b,c){a.Length=b.length;return this._obj([this._dict(a),"\nstream\n",b,"\nendstream"],c)},toBlob:function(){var a;a="["+[0,-this.height,this.width,0].join(" ")+"]";this._obj({Type:"/Catalog",Pages:"2 0 R"},1);this._obj({Type:"/Pages",Kids:"[3 0 R]",Count:1},2);this._obj({Type:"/Page",Parent:"2 0 R",
MediaBox:a,Contents:"4 0 R",Resources:this._dict({ProcSet:"[/PDF /Text /ImageB /ImageC /ImageI]",XObject:this._dict(this._xobjects),ExtGState:this._dict(this._extGState)})},3);var b=this._body.join("\n"),c=new Uint8Array(b.length);for(a=0;a<b.length;++a)c[a]=b.charCodeAt(a)&255;b=window.pako.deflate(c);this._strm({Filter:"/FlateDecode"},b,4);var b=this._objects,d=[];for(a=1;a<b.length;++a)d[b[a].index]=b[a];c="xref\n0 "+d.length+"\n";for(a=0;a<d.length;++a)c=d[a]?c+(kb(String(d[a].offset),10)+" 00000 n \n"):
c+"0000000000 65535 f \n";a="trailer\n"+this._dict({Size:d.length,Root:"1 0 R"})+"\nstartxref\n"+this._offset+"\n%%EOF\n";b=Array.prototype.concat.apply([],b);b.push(c,a);return new Blob(b,{type:"application/pdf"})}};var Eb=null;ib.push(hd);oa.exportSVG=function(){id(ed)};oa.exportPDF=function(){ua.loadScript("pako","pako.min.js",function(){id(fd)})};oa.exportPNG=function(){jd(y.canvas.toDataURL())};var jd=function(a){var b=document.createElement("a");document.body.appendChild(b);b.style="display: none";
b.href=a;b.download="CindyJSExport";b.click();setTimeout(function(){document.body.removeChild(b);hd()},100)},qc="Move",Gb,sa=[],Ra=0,$d=0,rb=0,F={Delete:{}};F.Delete.actions=[];F.Delete.actions[0]={};F.Delete.actions[0].event="mousedown";F.Delete.actions[0].tooltip="...";F.Delete.actions[0]["do"]=function(){da=Fb(W);null!==da&&od(da.mover.name);return!0};F.Move={};F.Move.actions=[];F.Move.actions[0]={};F.Move.actions[0].event="mousedown";F.Move.actions[0].tooltip="Move free elements by dragging the mouse";
F.Move.actions[0]["do"]=function(){for(var a=W,b=null,c=1E6,d,e=0;e<v.free.length;e++){var f=v.free[e];if(!f.pinned&&!1!==f.visible&&!0!==f.tmp){var k,m,n,p=z.drawingstate.matrix.sdet;if("P"===f.kind){m=g.normalizeZ(f.homog);if(!g._helper.isAlmostReal(m))continue;k=m.value[0].value.real-a.x;m=m.value[1].value.real-a.y;n=Math.sqrt(k*k+m*m);if(f.narrow&&n>("number"===typeof f.narrow?f.narrow:20)/p)continue}else if("C"===f.kind)m=v.csnames[f.args[0]],n=f.radius,k=l.div(m.homog.value[0],m.homog.value[2]).value.real,
m=l.div(m.homog.value[1],m.homog.value[2]).value.real,k-=a.x,m-=a.y,n=Math.sqrt(k*k+m*m)-n.value.real,m=k=0,0>n&&(n=-n),n+=30/p;else if("L"===f.kind)k=f.homog,n=l,m=n.add(n.mult(k.value[0],n.conjugate(k.value[0])),n.mult(k.value[1],n.conjugate(k.value[1]))),m=g.scaldiv(n.sqrt(m),k),n=m.value[0].value.real*a.x+m.value[1].value.real*a.y+m.value[2].value.real,k=-m.value[0].value.real*n,m=-m.value[1].value.real*n,0>n&&(n=-n),n+=25/p;else if("Text"===f.kind){if(!f.homog||f.dock||!f._bbox)continue;m=z.from(a.x,
a.y,1);k=Math.max(0,m[0]-f._bbox.right,f._bbox.left-m[0]);m=Math.max(0,m[1]-f._bbox.bottom,f._bbox.top-m[1]);n=Math.sqrt(k*k+m*m);if(20<n)continue;n/=p;m=g.normalizeZ(f.homog);if(!g._helper.isAlmostReal(m))continue;k=m.value[0].value.real-a.x;m=m.value[1].value.real-a.y}else continue;n<c+.2/p&&(c=n,b=f,d={x:k,y:m})}}console.log("Moving "+(b?b.name:"nothing"));da=null===b?null:{mover:b,offset:d,prev:{x:a.x,y:a.y}};return!0};F.Point={};F.Point.actions=[];F.Point.actions[0]={};F.Point.actions[0].event=
"mousedown";F.Point.actions[0].tooltip="Add a single point with the mouse";F.Point.actions[0]["do"]=function(){Ba({type:"Free",name:Qa(),labeled:!0,pos:[ra[0],ra[1],1]});return!0};F.Mid={};F.Mid.actions=[];F.Mid.actions[0]={};F.Mid.actions[0].event="mousedown";F.Mid.actions[0].tooltip="Construct two points and their midpoint by dragging";F.Mid.actions[0]["do"]=function(){lb();return!0};F.Mid.actions[1]={};F.Mid.actions[1].event="mousemove";F.Mid.actions[1]["do"]=function(){Rb("Mid");return!0};F.Mid.actions[2]=
{};F.Mid.actions[2].event="mouseup";F.Mid.actions[2]["do"]=function(){sb();return!0};F.Circle={};F.Circle.actions=[];F.Circle.actions[0]={};F.Circle.actions[0].event="mousedown";F.Circle.actions[0].tooltip="Construct two points and a circle by dragging the mouse";F.Circle.actions[0]["do"]=function(){lb();return!0};F.Circle.actions[1]={};F.Circle.actions[1].event="mousemove";F.Circle.actions[1]["do"]=function(){Rb("CircleMP");return!0};F.Circle.actions[2]={};F.Circle.actions[2].event="mouseup";F.Circle.actions[2]["do"]=
function(){sb();return!0};F.Compass={};F.Compass.actions=[];F.Compass.actions[0]={};F.Compass.actions[0].event="mousedown";F.Compass.actions[0].tooltip="...";F.Compass.actions[0]["do"]=function(){lb();return!0};F.Compass.actions[1]={};F.Compass.actions[1].event="mousedown";F.Compass.actions[1].tooltip="...";F.Compass.actions[1]["do"]=function(){lb();return!0};F.Compass.actions[2]={};F.Compass.actions[2].event="mousedown";F.Compass.actions[2].tooltip="...";F.Compass.actions[2]["do"]=function(){lb();
Ba({type:"Compass",name:Qa(),labeled:!0,args:[sa[0].name,sa[1].name,sa[2].name]});return!0};F.Line={};F.Line.actions=[];F.Line.actions[0]={};F.Line.actions[0].event="mousedown";F.Line.actions[0].tooltip="Construct two points and their connecting line by dragging the mouse";F.Line.actions[0]["do"]=function(){lb();return!0};F.Line.actions[1]={};F.Line.actions[1].event="mousemove";F.Line.actions[1]["do"]=function(){Rb("Join");return!0};F.Line.actions[2]={};F.Line.actions[2].event="mouseup";F.Line.actions[2]["do"]=
function(){sb();return!0};F.Segment={};F.Segment.actions=[];F.Segment.actions[0]={};F.Segment.actions[0].event="mousedown";F.Segment.actions[0].tooltip="Draw a segment by dragging the mouse";F.Segment.actions[0]["do"]=function(){lb();return!0};F.Segment.actions[1]={};F.Segment.actions[1].event="mousemove";F.Segment.actions[1]["do"]=function(){Rb("Segment");return!0};F.Segment.actions[2]={};F.Segment.actions[2].event="mouseup";F.Segment.actions[2]["do"]=function(){sb();return!0};F.Parallel={};F.Parallel.actions=
[];F.Parallel.actions[0]={};F.Parallel.actions[0].event="mousedown";F.Parallel.actions[0].tooltip="Construct a parallel line by dragging a line";F.Parallel.actions[0]["do"]=function(){return md()};F.Parallel.actions[1]={};F.Parallel.actions[1].event="mousemove";F.Parallel.actions[1]["do"]=function(){var a={type:"Free",name:Qa(),labeled:!0,pos:[ra[0],ra[1],1],tmp:!0},a=Ba(a);Gb=Ba({type:"Para",name:Qa(),labeled:!0,args:[sa[0].name,a.name]});sc(a);return!0};F.Parallel.actions[2]={};F.Parallel.actions[2].event=
"mouseup";F.Parallel.actions[2]["do"]=function(){sb();return!0};F.Orthogonal={};F.Orthogonal.actions=[];F.Orthogonal.actions[0]={};F.Orthogonal.actions[0].event="mousedown";F.Orthogonal.actions[0].tooltip="Construct a orthogonal line by dragging a line";F.Orthogonal.actions[0]["do"]=function(){if(md()){var a={type:"Free",name:Qa(),labeled:!0,pos:[ra[0],ra[1],1],tmp:!0},a=Ba(a);Gb=Ba({type:"Perp",name:Qa(),labeled:!0,args:[sa[0].name,a.name]});sc(a);return!0}return!1};F.Orthogonal.actions[1]={};F.Orthogonal.actions[1].event=
"mouseup";F.Orthogonal.actions[1]["do"]=function(){sb();return!0};F.Intersection={};F.Intersection.actions=[];F.Intersection.actions[0]={};F.Intersection.actions[0].event="mousedown";F.Intersection.actions[0].tooltip="Select two elements to define their intersection";F.Intersection.actions[0]["do"]=function(){return nd()};F.Intersection.actions[1]={};F.Intersection.actions[1].event="mousedown";F.Intersection.actions[1]["do"]=function(){return nd()?(Gb=Ba({type:"Meet",name:Qa(),labeled:!0,args:[sa[0].name,
sa[1].name]}),!0):!1};var Xa={},z={drawingstate:{}};z.drawingstate.linecolor="rgb(0,0,255)";z.drawingstate.linecolorraw=[0,0,1];z.drawingstate.pointcolor="rgb(0,255,0)";z.drawingstate.pointcolorraw=[0,1,0];z.drawingstate.textcolor="rgb(0,0,0)";z.drawingstate.textcolorraw=[0,0,0];z.drawingstate.alpha=1;z.drawingstate.pointsize=4;z.drawingstate.linesize=1;z.drawingstate.textsize=null;z.drawingstate.matrix={};z.drawingstate.matrix.a=25;z.drawingstate.matrix.b=0;z.drawingstate.matrix.c=0;z.drawingstate.matrix.d=
25;z.drawingstate.matrix.tx=250.5;z.drawingstate.matrix.ty=250.5;z.drawingstate.matrix.det=z.drawingstate.matrix.a*z.drawingstate.matrix.d-z.drawingstate.matrix.b*z.drawingstate.matrix.c;z.drawingstate.matrix.sdet=Math.sqrt(z.drawingstate.matrix.det);z.drawingstate.initialmatrix={};z.drawingstate.initialmatrix.a=z.drawingstate.matrix.a;z.drawingstate.initialmatrix.b=z.drawingstate.matrix.b;z.drawingstate.initialmatrix.c=z.drawingstate.matrix.c;z.drawingstate.initialmatrix.d=z.drawingstate.matrix.d;
z.drawingstate.initialmatrix.tx=z.drawingstate.matrix.tx;z.drawingstate.initialmatrix.ty=z.drawingstate.matrix.ty;z.drawingstate.initialmatrix.det=z.drawingstate.matrix.det;z.drawingstate.initialmatrix.sdet=z.drawingstate.matrix.sdet;z.clone=function(a){if(null===a||"object"!==typeof a)return a;var b=a.constructor(),c;for(c in a)b[c]=z.clone(a[c]);return b};Xa.backup=z.clone(z.drawingstate);Xa.stack=[];z.clone(z.drawingstate);z.reset=function(){z.drawingstate.matrix.a=z.drawingstate.initialmatrix.a;
z.drawingstate.matrix.b=z.drawingstate.initialmatrix.b;z.drawingstate.matrix.c=z.drawingstate.initialmatrix.c;z.drawingstate.matrix.d=z.drawingstate.initialmatrix.d;z.drawingstate.matrix.tx=z.drawingstate.initialmatrix.tx;z.drawingstate.matrix.ty=z.drawingstate.initialmatrix.ty;z.drawingstate.matrix.det=z.drawingstate.initialmatrix.det;z.drawingstate.matrix.sdet=z.drawingstate.initialmatrix.sdet};z.from=function(a,b,c){a/=c;b/=c;c=z.drawingstate.matrix;return[a*c.a-b*c.b+c.tx,a*c.c-b*c.d-c.ty]};z.to=
function(a,b){var c=z.drawingstate.matrix,d=a-c.tx,e=b+c.ty;return[(d*c.d-e*c.b)/c.det,-(-d*c.c+e*c.a)/c.det,1]};z.toMat=function(){var a=z.drawingstate.matrix;return g.realMatrix([[a.d,-a.b,-a.tx*a.d-a.ty*a.b],[a.c,-a.a,-a.tx*a.c-a.ty*a.a],[0,0,a.det]])};z.dumpTrafo=function(){function a(a){return Math.round(1E3*a)/1E3}var b=z.drawingstate.matrix;console.log("a:"+a(b.a)+" b:"+a(b.b)+" c:"+a(b.c)+" d:"+a(b.d)+" tx:"+a(b.ty)+" ty:"+a(b.tx))};z.setMat=function(a,b,c,d,e,g){var f=z.drawingstate.matrix;
f.a=a;f.b=b;f.c=c;f.d=d;f.tx=e;f.ty=g;f.det=a*d-b*c;f.sdet=Math.sqrt(f.det)};z.scaleAndOrigin=function(a,b,c){z.setMat(a,0,0,a,b,c)};z.visibleRect=function(a,b,c,d){var e=c-a,g=b-d,e=ca*g<ba*e?ca/e:ba/g;z.setMat(e,0,0,e,(ca-e*(a+c))/2,(ba-e*(b+d))/2)};z.applyMat=function(a,b,c,d,e,g){var f=z.drawingstate.matrix;z.setMat(f.a*a+f.c*b,f.b*a+f.d*b,f.a*c+f.c*d,f.b*c+f.d*d,f.a*e+f.c*g+f.tx,f.b*e+f.d*g+f.ty)};z.translate=function(a,b){z.applyMat(1,0,0,1,a,b)};z.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);
z.applyMat(b,a,-a,b,0,0)};z.scale=function(a){z.applyMat(a,0,0,a,0,0)};z.gsave=function(){Xa.stack.push(z.clone(z.drawingstate))};z.grestore=function(){0!==Xa.stack.length&&(z.drawingstate=Xa.stack.pop())};z.greset=function(){z.drawingstate=z.clone(Xa.backup);z.drawingstate.matrix.ty-=ba;z.drawingstate.initialmatrix.ty-=ba;Xa.stack=[]};z.createnewbackup=function(){z.drawingstate.initialmatrix.a=z.drawingstate.matrix.a;z.drawingstate.initialmatrix.b=z.drawingstate.matrix.b;z.drawingstate.initialmatrix.c=
z.drawingstate.matrix.c;z.drawingstate.initialmatrix.d=z.drawingstate.matrix.d;z.drawingstate.initialmatrix.tx=z.drawingstate.matrix.tx;z.drawingstate.initialmatrix.ty=z.drawingstate.matrix.ty;z.drawingstate.initialmatrix.det=z.drawingstate.matrix.det;z.drawingstate.initialmatrix.sdet=z.drawingstate.matrix.sdet;Xa.backup=z.clone(z.drawingstate)};z.makecolor=function(a,b,c){a=Math.floor(255*a);b=Math.floor(255*b);c=Math.floor(255*c);return 1===z.drawingstate.alpha?"rgb("+a+","+b+","+c+")":"rgba("+
a+","+b+","+c+","+z.drawingstate.alpha+")"};z.setcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;z.drawingstate.linecolor=z.drawingstate.pointcolor=z.makecolor(b,c,a);z.drawingstate.linecolorraw=z.drawingstate.pointcolorraw=[b,c,a]};z.setlinecolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;z.drawingstate.linecolor=z.makecolor(b,c,a);z.drawingstate.linecolorraw=[b,c,a]};z.settextcolor=function(a){var b=a.value[0].value.real,
c=a.value[1].value.real;a=a.value[2].value.real;z.drawingstate.textcolor=z.makecolor(b,c,a);z.drawingstate.textcolorraw=[b,c,a]};z.setpointcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;z.drawingstate.pointcolor=z.makecolor(b,c,a);z.drawingstate.pointcolorraw=[b,c,a]};z.setalpha=function(a){z.drawingstate.alpha=a.value.real;z.drawingstate.linecolor=z.makecolor(z.drawingstate.linecolorraw[0],z.drawingstate.linecolorraw[1],z.drawingstate.linecolorraw[2]);
z.drawingstate.pointcolor=z.makecolor(z.drawingstate.pointcolorraw[0],z.drawingstate.pointcolorraw[1],z.drawingstate.pointcolorraw[2]);z.drawingstate.textcolor=z.makecolor(z.drawingstate.textcolorraw[0],z.drawingstate.textcolorraw[1],z.drawingstate.textcolorraw[2])};z.setpointsize=function(a){z.drawingstate.pointsize=a.value.real};z.setlinesize=function(a){z.drawingstate.linesize=a.value.real};z.settextsize=function(a){z.drawingstate.textsize=a.value.real};var ja={clip:"none",pointColor:[1,0,0],lineColor:[0,
0,1],pointSize:5,lineSize:1,alpha:1,overhangLine:1,overhangSeg:1,dimDependent:.7,fontFamily:"sans-serif",textsize:20,lineHeight:1.45};t.defaultAppearance&&ae(t.defaultAppearance);var Tb={},vd={UL:0,UR:1,LR:2,LL:3},vc=["in","out","good","backup"],gb=new Float64Array(0),cb={};vc.forEach(function(a){cb[a]=gb});var la=gb,Ga=gb,xa=gb,ta,ya,eb,Da,ub,wc=!1,xd={toString:function(){return"RefineException"}},Ad=null,H=null;t.enableTraceLog&&(H={logLength:Infinity,fullLog:[],currentMouseAndScripts:null,currentMover:null,
currentStep:null,currentElement:null,currentParam:null,labelTracing2:w.wrap("tracing2"),labelTracing4:w.wrap("tracing4"),labelTracingSesq:w.wrap("tracingSesq"),postMouseHooks:[]},"number"===typeof t.enableTraceLog&&(H.logLength=t.enableTraceLog),oa.getTraceLog=ge,oa.formatTraceLog=he,oa.addTraceHook=H.postMouseHooks.push.bind(H.postMouseHooks));Ha.stateSize=12;xc.stateSize=24;var hb=[];fb.P=function(a){v.lines.forEach(function(b){b=Ed(a,b);b.holds()&&hb.push(b)});v.conics.forEach(function(b){b=Fd(a,
b);b.holds()&&hb.push(b)})};fb.L=function(a){v.points.forEach(function(b){b=Ed(b,a);b.holds()&&hb.push(b)})};fb.S=fb.L;fb.C=function(a){v.points.forEach(function(b){b=Fd(b,a);b.holds()&&hb.push(b)})};var n={_helper:{},RandomLine:{}};n.RandomLine.kind="L";n.RandomLine.signature=[];n.RandomLine.updatePosition=function(a){a.homog=g.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};n.FreeLine={};n.FreeLine.kind="L";n.FreeLine.signature=
[];n.FreeLine.isMovable=!0;n.FreeLine.initialize=function(a){a=n._helper.initializeLine(a);R(a)};n.FreeLine.getParamForInput=function(a,b,c){"mouse"===c?(a=g.cross(b,g.ez),a=g.cross(a,b)):a="homog"===c?b:g.turnIntoCSList([l.zero,l.zero,l.zero]);return g.normalizeMax(a)};n.FreeLine.getParamFromState=function(a){return aa(3)};n.FreeLine.putParamToState=function(a,b){R(b)};n.FreeLine.updatePosition=function(a){var b=aa(3);R(b);a.homog=w.withUsage(b,"Line")};n.FreeLine.stateSize=6;n.RandomPoint={};n.RandomPoint.kind=
"P";n.RandomPoint.signature=[];n.RandomPoint.updatePosition=function(a){a.homog=g.realVector([100*Math.random(),100*Math.random(),100*Math.random()]);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};n.Join={};n.Join.kind="L";n.Join.signature=["P","P"];n.Join.updatePosition=function(a){a.homog=g.cross(v.csnames[a.args[0]].homog,v.csnames[a.args[1]].homog);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};n.Segment={};n.Segment.kind="S";n.Segment.signature=["P",
"P"];n.Segment.updatePosition=function(a){var b=v.csnames[a.args[0]],c=v.csnames[a.args[1]];n.Segment.setSegmentPos(a,g.cross(b.homog,c.homog),g.scalmult(c.homog.value[2],b.homog),g.scalmult(b.homog.value[2],c.homog))};n.Segment.setSegmentPos=function(a,b,c,d){b=g.normalizeMax(b);a.homog=w.withUsage(b,"Line");b=g.turnIntoCSList([c,d]);b=g.normalizeMax(b);a.startpos=b.value[0];a.endpos=b.value[1]};n.Meet={};n.Meet.kind="P";n.Meet.signature=["L","L"];n.Meet.updatePosition=function(a){a.homog=g.cross(v.csnames[a.args[0]].homog,
v.csnames[a.args[1]].homog);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};n.Meet.visiblecheck=function(a){var b=!0,c=v.csnames[a.args[0]],d=v.csnames[a.args[1]];"S"===c.kind&&(b=td(a,c));b&&"S"===d.kind&&(b=td(a,d));a.isshowing=b};n._helper.midpoint=function(a,b){return g.normalizeMax(g.add(g.scalmult(b.value[2],a),g.scalmult(a.value[2],b)))};n.Mid={};n.Mid.kind="P";n.Mid.signature=["P","P"];n.Mid.updatePosition=function(a){var b=n._helper.midpoint(v.csnames[a.args[0]].homog,
v.csnames[a.args[1]].homog);a.homog=w.withUsage(b,"Point")};n.Perp={};n.Perp.kind="L";n.Perp.signature=["L","P"];n.Perp.updatePosition=function(a){var b=v.csnames[a.args[0]].homog,c=v.csnames[a.args[1]].homog,b=g.turnIntoCSList([b.value[0],b.value[1],l.zero]);a.homog=g.cross(b,c);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};n.Para={};n.Para.kind="L";n.Para.signature=["L","P"];n.Para.updatePosition=function(a){var b=v.csnames[a.args[1]].homog;a.homog=g.cross(g.cross(g.linfty,
v.csnames[a.args[0]].homog),b);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};n.Horizontal={};n.Horizontal.kind="L";n.Horizontal.signature=["P"];n.Horizontal.updatePosition=function(a){a.homog=g.cross(g.ex,v.csnames[a.args[0]].homog);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};n.HorizontalLine={};n.HorizontalLine.kind="L";n.HorizontalLine.signature=[];n.HorizontalLine.isMovable=!0;n.HorizontalLine.initialize=function(a){a=n._helper.initializeLine(a);
a=g.turnIntoCSList([l.zero,a.value[1],a.value[2]]);a=g.normalizeMax(a);R(a)};n.HorizontalLine.getParamForInput=function(a,b,c){if("mouse"===c)b=g.cross(b,g.ex);else if("homog"===c){if(0!==b.value[0].real||0!==b.value[0].imag)b=g.turnIntoCSList([l.zero,b.value[1],b.value[2]])}else b=g.turnIntoCSList([l.zero,l.zero,l.zero]);return g.normalizeMax(b)};n.HorizontalLine.getParamFromState=function(a){return aa(3)};n.HorizontalLine.putParamToState=function(a,b){R(b)};n.HorizontalLine.updatePosition=function(a){var b=
aa(3);R(b);a.homog=w.withUsage(b,"Line")};n.HorizontalLine.stateSize=6;n.Vertical={};n.Vertical.kind="L";n.Vertical.signature=["P"];n.Vertical.updatePosition=function(a){a.homog=g.cross(g.ey,v.csnames[a.args[0]].homog);a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Line")};n.VerticalLine={};n.VerticalLine.kind="L";n.VerticalLine.signature=[];n.VerticalLine.isMovable=!0;n.VerticalLine.initialize=function(a){a=n._helper.initializeLine(a);a=g.turnIntoCSList([a.value[0],l.zero,a.value[2]]);
a=g.normalizeMax(a);R(a)};n.VerticalLine.getParamForInput=function(a,b,c){if("mouse"===c)b=g.cross(b,g.ey);else if("homog"===c){if(0!==b.value[1].real||0!==b.value[1].imag)b=g.turnIntoCSList([b.value[0],l.zero,b.value[2]])}else b=g.turnIntoCSList([l.zero,l.zero,l.zero]);return g.normalizeMax(b)};n.VerticalLine.getParamFromState=function(a){return aa(3)};n.VerticalLine.putParamToState=function(a,b){R(b)};n.VerticalLine.updatePosition=function(a){var b=aa(3);R(b);a.homog=w.withUsage(b,"Line")};n.VerticalLine.stateSize=
6;n.LineByFixedAngle={};n.LineByFixedAngle.kind="L";n.LineByFixedAngle.signature=["L","P"];n.LineByFixedAngle.initialize=function(a){var b=l._helper.input(a.angle),c=l.cos(b),b=l.sin(b);a.rot=g.turnIntoCSList([g.turnIntoCSList([b,c,l.zero]),g.turnIntoCSList([l.neg(c),b,l.zero]),g.turnIntoCSList([l.zero,l.zero,l.zero])])};n.LineByFixedAngle.updatePosition=function(a){var b=v.csnames[a.args[1]],c=g.productMV(a.rot,v.csnames[a.args[0]].homog);a.homog=g.cross(b.homog,c);a.homog=g.normalizeMax(a.homog);
a.homog=w.withUsage(a.homog,"Line")};n.Through={};n.Through.kind="L";n.Through.signature=["P"];n.Through.isMovable=!0;n.Through.initialize=function(a){a=a.dir?w.wrap(a.dir):g.realVector([a.pos[1],-a.pos[0],0]);R(a)};n.Through.getParamForInput=function(a,b,c){a="dir"===c||"mouse"===c?g.cross(v.csnames[a.args[0]].homog,b):"homog"===c?b:g.turnIntoCSList([l.zero,l.zero,l.zero]);a=g.cross(g.linfty,a);return g.normalizeMax(a)};n.Through.getParamFromState=function(a){return aa(3)};n.Through.putParamToState=
function(a,b){R(b)};n.Through.updatePosition=function(a){var b=aa(3);R(b);b=g.cross(v.csnames[a.args[0]].homog,b);b=g.normalizeMax(b);a.homog=w.withUsage(b,"Line")};n.Through.stateSize=6;n.Through.set_angle=function(a,b){if("number"===b.ctype){var c=l.cos(b),d=l.sin(b),c=g.turnIntoCSList([c,d,l.real(0)]);Ca(a,c,"dir")}};n.Through.set_slope=function(a,b){if("number"===b.ctype){var c=g.turnIntoCSList([l.real(1),b,l.real(0)]);Ca(a,c,"dir")}};n.Free={};n.Free.kind="P";n.Free.signature=[];n.Free.isMovable=
!0;n.Free.initialize=function(a){a=n._helper.initializePoint(a);R(a)};n.Free.getParamForInput=function(a,b,c){if("mouse"===c&&bc&&0!==Ua){b=g.normalizeZ(b);a=b.value[0].value.real;c=b.value[1].value.real;var d=Math.round(a/Ua)*Ua,e=Math.round(c/Ua)*Ua;.2>Math.abs(d-a)&&.2>Math.abs(e-c)&&(b=g.realVector([d,e,1]))}return g.normalizeMax(b)};n.Free.getParamFromState=function(a){return aa(3)};n.Free.putParamToState=function(a,b){R(b)};n.Free.updatePosition=function(a){var b=aa(3);R(b);a.homog=w.withUsage(b,
"Point")};n.Free.stateSize=6;n._helper.projectPointToLine=function(a,b){var c=g.turnIntoCSList([b.value[0],b.value[1],l.zero]),c=g.cross(c,a);return g.normalizeMax(g.cross(c,b))};n.PointOnLine={};n.PointOnLine.kind="P";n.PointOnLine.signature=["L"];n.PointOnLine.isMovable=!0;n.PointOnLine.initialize=function(a){var b=n._helper.initializePoint(a);a=v.csnames[a.args[0]].homog;var b=n._helper.projectPointToLine(b,a),b=g.normalizeMax(b),c=g.cross(g.linfty,b);g.normalizeMax(c);R(b);R(a);eb=!1};n.PointOnLine.updatePosition=
function(a,b){var c,d=v.csnames[a.args[0]].homog;c=aa(3);aa(3);if(!b){ta=a.stateIdx;var e=la;la=xa;var f=aa(3),l=aa(3);la=e;e=g.cross(l,d);g._helper.isAlmostZero(e)&&(e=g.cross(g.linfty,d));f=n._helper.CircleMP(e,f);f=n._helper.IntersectLC(d,f);e=n._helper.pointReflection(e,c);c=Bd(f[0],f[1],c,e)[0]}c=g.normalizeMax(c);R(c);R(d);a.homog=w.withUsage(c,"Point")};n.PointOnLine.getParamForInput=function(a,b,c){return b=n._helper.projectPointToLine(b,v.csnames[a.args[0]].homog)};n.PointOnLine.getParamFromState=
function(a){return aa(3)};n.PointOnLine.putParamToState=function(a,b){return R(b)};n.PointOnLine.stateSize=12;n.PointOnCircle={};n.PointOnCircle.kind="P";n.PointOnCircle.signature=["C"];n.PointOnCircle.isMovable=!0;n.PointOnCircle.initialize=function(a){var b=v.csnames[a.args[0]];a=g.normalizeZ(n._helper.initializePoint(a));var c=g.normalizeZ(n._helper.CenterOfCircle(b.matrix)),d=g.sub(a,c),d=g.turnIntoCSList([d.value[1],l.neg(d.value[0]),l.zero]),c=g.cross(a,c),b=n._helper.IntersectLC(c,b.matrix),
c=g.projectiveDistMinScal(a,b[0]);g.projectiveDistMinScal(a,b[1])<c?(a=b[1],b=b[0]):(a=b[0],b=b[1]);R(d);R(a);R(b);eb=!1};n.PointOnCircle.putParamToState=function(a,b){R(b)};n.PointOnCircle.getParamFromState=function(a){return aa(3)};n.PointOnCircle.getParamForInput=function(a,b,c){c=g.normalizeZ(n._helper.CenterOfCircle(v.csnames[a.args[0]].matrix));b=g.sub(b,c);ta=a.stateIdx;a=aa(3);var d=g.normalizeZ(aa(3));c=g.sub(d,c);0>l.sub(l.mult(a.value[0],c.value[1]),l.mult(a.value[1],c.value[0])).value.real&&
(b=g.neg(b));return g.turnIntoCSList([b.value[1],l.neg(b.value[0]),l.zero])};n.PointOnCircle.parameterPath=function(a,b,c,d,e){d=g.normalizeAbs(d);e=g.normalizeAbs(e);var f=g.scalproduct(d,e);if(0<=f.value.real)return yd(a,b,c,d,e);a=g.turnIntoCSList([l.sub(d.value[1],e.value[1]),l.sub(e.value[0],d.value[0]),l.zero]);f=g.scalproduct(d,a);0>f.value.real&&(a=g.neg(a));0>b?(b=2*b+1,c=b*b,f=.25/(1+c),c=l.complex(2*b*f+.25,(1-c)*f)):(b=2*b-1,c=b*b,f=.25/(1+c),c=l.complex(2*b*f+.75,(1-c)*f));var k=l.sub(l.real(1),
c);b=l.mult(c,c);f=l.mult(k,k);c=l.mult(c,k);d=g.scalmult(f,d);d=g.add(d,g.scalmult(c,a));return d=g.add(d,g.scalmult(b,e))};n.PointOnCircle.updatePosition=function(a){var b=aa(3);R(b);var c=v.csnames[a.args[0]],b=g.productMV(c.matrix,b),c=n._helper.IntersectLC(b,c.matrix),c=Ha(c[0],c[1]),b=g.normalizeMax(c.value[0]);a.homog=w.withUsage(b,"Point");a.antipodalPoint=c.value[1]};n.PointOnCircle.stateSize=6+Ha.stateSize;n.OtherPointOnCircle={};n.OtherPointOnCircle.kind="P";n.OtherPointOnCircle.signature=
["P"];n.OtherPointOnCircle.signatureConstraints=function(a){return"PointOnCircle"===v.csnames[a.args[0]].type};n.OtherPointOnCircle.updatePosition=function(a){var b=v.csnames[a.args[0]].antipodalPoint,b=g.normalizeMax(b);a.homog=w.withUsage(b,"Point")};n.PointOnSegment={};n.PointOnSegment.kind="P";n.PointOnSegment.signature=["S"];n.PointOnSegment.isMovable=!0;n.PointOnSegment.initialize=function(a){var b=n._helper.initializePoint(a);a=n.PointOnSegment.getParamForInput(a,b);Sa(a)};n.PointOnSegment.getParamForInput=
function(a,b){var c=v.csnames[a.args[0]],d=c.homog,d=g.turnIntoCSList([d.value[0],d.value[1],l.zero]),e=g.sub(c.startpos,c.endpos),c=g.crossratio3(e,c.startpos,c.endpos,b,d);0>c.value.real&&(c=l.complex(0,c.value.imag));1<c.value.real&&(c=l.complex(1,c.value.imag));return c};n.PointOnSegment.getParamFromState=function(a){return vb()};n.PointOnSegment.putParamToState=function(a,b){Sa(b)};n.PointOnSegment.updatePosition=function(a){var b=vb();Sa(b);var c=v.csnames[a.args[0]],d=c.startpos,c=g.sub(c.endpos,
d),b=g.add(d,g.scalmult(b,c)),b=g.normalizeMax(b);a.homog=w.withUsage(b,"Point")};n.PointOnSegment.stateSize=2;n._helper.projectPointToCircle=function(a,b){var c=n._helper.CenterOfCircle(a.matrix),c=g.normalizeMax(c),c=g.normalizeMax(g.cross(b,c)),c=n._helper.IntersectLC(c,a.matrix),d=g.projectiveDistMinScal(b,c[0]),e=g.projectiveDistMinScal(b,c[1]);return d<e?c[0]:c[1]};n.PointOnArc={};n.PointOnArc.kind="P";n.PointOnArc.signature=["C"];n.PointOnArc.signatureConstraints=function(a){return v.csnames[a.args[0]].isArc};
n.PointOnArc.isMovable=!0;n.PointOnArc.initialize=function(a){var b=n._helper.initializePoint(a);a=n.PointOnArc.getParamForInput(a,b);R(a)};n.PointOnArc.getParamForInput=function(a,b){var c=v.csnames[a.args[0]],d=n._helper.projectPointToCircle(c,b),c=g.normalizeMax(g.crossratio3harm(c.startPoint,c.endPoint,c.viaPoint,d,g.ii)),d=l.div(c.value[0],c.value[1]);0>d.value.real&&(c=-1>d.value.real?g.realVector([1,0]):g.realVector([0,1]));return c};n.PointOnArc.getParamFromState=function(a){return aa(2)};
n.PointOnArc.putParamToState=function(a,b){R(b)};n.PointOnArc.updatePosition=function(a){var b=v.csnames[a.args[0]],c=b.startPoint,d=b.viaPoint,e=b.endPoint,f=g.ii,k=g.cross(c,f),d=g.cross(d,f),m=g.cross(e,f),m=g.turnIntoCSList([k,m]),k=g.transpose(m),m=g.conjugate(m),k=g.productMM(m,k),d=g.productMV(m,d),k=g.productMV(g.adjoint2(k),d),d=k.value[0],k=k.value[1],m=aa(2);R(m);c=g.normalizeMax(g.add(g.scalmult(l.mult(d,m.value[0]),c),g.scalmult(l.mult(k,m.value[1]),e)));b=n._helper.conicOtherIntersection(b.matrix,
f,c);a.homog=w.withUsage(b,"Point")};n.PointOnArc.stateSize=4;n._helper.CenterOfCircle=function(a){return g.turnIntoCSList([a.value[2].value[0],a.value[2].value[1],l.neg(a.value[0].value[0])])};n._helper.CenterOfConic=function(a){a=g.adjoint3(a);return{ctype:"list",value:[a.value[2].value[0],a.value[2].value[1],a.value[2].value[2]]}};n.CenterOfConic={};n.CenterOfConic.kind="P";n.CenterOfConic.signature=["C"];n.CenterOfConic.updatePosition=function(a){var b=n._helper.CenterOfConic(v.csnames[a.args[0]].matrix);
a.homog=b;a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};n._helper.CircleMP=function(a,b){var c=a.value[0],d=a.value[1],e=l.neg(a.value[2]),f=l.zero,c=g.turnIntoCSList([g.turnIntoCSList([e,f,c]),g.turnIntoCSList([f,e,d]),g.turnIntoCSList([c,d,f])]),e=w.mult(w.mult(b,c),b),d=w.mult(w.mult(b,g.fund),b),e=w.mult(e,g.fund),c=w.mult(d,c);return g.sub(e,c)};n.CircleMP={};n.CircleMP.kind="C";n.CircleMP.signature=["P","P"];n.CircleMP.updatePosition=function(a){a.matrix=n._helper.CircleMP(v.csnames[a.args[0]].homog,
v.csnames[a.args[1]].homog);a.matrix=g.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Circle")};n.CircleMr={};n.CircleMr.kind="C";n.CircleMr.signature=["P"];n.CircleMr.isMovable=!0;n.CircleMr.initialize=function(a){Sa(l.real(a.radius))};n.CircleMr.getParamForInput=function(a,b,c){if("radius"===c)return b;a=v.csnames[a.args[0]].homog;a=g.normalizeZ(a);b=g.normalizeZ(b);b=g.sub(a,b);return b=g.abs(b)};n.CircleMr.getParamFromState=function(a){return vb()};n.CircleMr.putParamToState=function(a,
b){Sa(b)};n.CircleMr.updatePosition=function(a){var b=vb();Sa(b);var c=v.csnames[a.args[0]].homog,d=l.mult(c.value[2],b),d=l.mult(d,d);if(!l._helper.isFinite(d)&&!l._helper.isNaN(d))return g.fund;c=n._helper.ScaledCircleMrr(c,d);a.matrix=w.withUsage(c,"Circle");a.radius=b};n.CircleMr.stateSize=2;n.CircleMr.set_radius=function(a,b){"number"===b.ctype&&Ca(a,b,"radius")};n._helper.ScaledCircleMrr=function(a,b){var c=a.value[0],d=a.value[1],e=l.neg(a.value[2]),e=g.scalmult(e,g.turnIntoCSList([c,d,e])).value,
c=g.turnIntoCSList([c,d]),c=l.sub(g.scalproduct(c,c),b),e=n._helper.buildConicMatrix([e[2],l.zero,e[2],e[0],e[1],c]);return g.normalizeMax(e)};n.Compass={};n.Compass.kind="C";n.Compass.signature=["P","P","P"];n.Compass.updatePosition=function(a){var b=v.csnames[a.args[0]].homog,c=v.csnames[a.args[1]].homog,d=v.csnames[a.args[2]].homog,e=b.value[2],f=c.value[2],k=d.value[2],b=g.scalmult(l.mult(f,k),b),c=g.scalmult(l.mult(e,k),c),d=g.scalmult(l.mult(e,f),d),b=g.sub(c,b),d=n._helper.ScaledCircleMrr(d,
g.scalproduct(b,b));a.matrix=w.withUsage(d,"Circle")};n._helper.getConicType=function(a){if(1E-16>l.abs(g.det(a)).value.real)return"degenerate";var b=l.mult(a.value[0].value[0],a.value[1].value[1]),b=l.sub(b,l.pow(a.value[0].value[1],l.real(2))),b=b.value.real;return 1E-16>Math.abs(b)?"parabola":1E-16<b?"ellipsoid":"hyperbola"};n._helper.ConicBy5=function(a,b,c,d,e,f){a=g.turnIntoCSList([g.cross(c,d)]);var l=g.turnIntoCSList([g.cross(b,e)]);b=g.turnIntoCSList([g.cross(b,c)]);d=g.turnIntoCSList([g.cross(d,
e)]);return n._helper.conicFromTwoDegenerates(a,l,b,d,f)};n._helper.conicFromTwoDegenerates=function(a,b,c,d,e){a=w.mult(g.transpose(b),a);c=w.mult(g.transpose(d),c);a=g.add(a,g.transpose(a));c=g.add(c,g.transpose(c));d=w.mult(w.mult(e,a),e);e=w.mult(w.mult(e,c),e);c=w.mult(d,c);e=w.mult(e,a);return g.sub(c,e)};n.ConicBy5={};n.ConicBy5.kind="C";n.ConicBy5.signature=["P","P","P","P","P"];n.ConicBy5.updatePosition=function(a){var b=n._helper.ConicBy5(a,v.csnames[a.args[0]].homog,v.csnames[a.args[1]].homog,
v.csnames[a.args[2]].homog,v.csnames[a.args[3]].homog,v.csnames[a.args[4]].homog);a.matrix=b;a.matrix=g.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};n.FreeConic={};n.FreeConic.kind="C";n.FreeConic.signature=[];n.FreeConic.initialize=function(a){var b;b=a.pos?n._helper.inputConic(a.pos):g.zeromatrix(l.real(3),l.real(3));n.FreeConic.putParamToState(a,b)};n.FreeConic.getParamForInput=function(a,b,c){return g.normalizeMax(b)};n.FreeConic.getParamFromState=function(a){return n._helper.buildConicMatrix(aa(6).value)};
n.FreeConic.putParamToState=function(a,b){for(var c=0;3>c;++c)for(var d=0;d<=c;++d)Sa(b.value[c].value[d])};n.FreeConic.updatePosition=function(a){var b=aa(6);R(b);a.matrix=n._helper.buildConicMatrix(b.value);a.matrix=g.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};n.FreeConic.set_matrix=function(a,b){g._helper.isNumberMatrixMN(b,3,3)&&Ca(a,g.add(b,g.transpose(b)),"matrix")};n.FreeConic.stateSize=12;n._helper.buildConicMatrix=function(a){var b=a[1],c=a[2],d=a[3],e=a[4],f=a[5];return g.turnIntoCSList([g.turnIntoCSList([a[0],
b,d]),g.turnIntoCSList([b,c,e]),g.turnIntoCSList([d,e,f])])};n._helper.splitDegenConic=function(a){var b=g.adjoint3(a),c=0,d,e,f=l.abs2(b.value[0].value[0]).value.real;for(d=1;3>d;d++)e=l.abs2(b.value[d].value[d]).value.real,e>f&&(c=d,f=e);d=l.sqrt(l.mult(l.real(-1),b.value[c].value[c]));if(1E-16>l.abs2(d).value.real)return a=g.turnIntoCSList([l.zero,l.zero,l.zero]),[a,a];c=l.real(c+1);e=g.column(b,c);e=g.scaldiv(d,e);d=e.value[0];f=e.value[1];e=e.value[2];d=g.turnIntoCSList([g.turnIntoCSList([l.real(0),
e,l.mult(l.real(-1),f)]),g.turnIntoCSList([l.mult(l.real(-1),e),l.real(0),d]),g.turnIntoCSList([f,l.mult(l.real(-1),d),l.real(0)])]);a=g.add(a,d);var k=0;for(d=f=b=0;3>d;d++)for(c=0;3>c;c++)e=l.abs2(a.value[d].value[c]).value.real,e>f&&(k=d,b=c,f=e);d=a.value[k];a=g.transpose(a);a=a.value[b];d=g.normalizeMax(d);a=g.normalizeMax(a);d=w.withUsage(d,"Line");a=w.withUsage(a,"Line");return[d,a]};n._helper.inputConic=function(a){var b="xx xy yy xz yz zz".split(" ").map(function(b){var d=l._helper.input(a[b]);
b[0]!==b[1]&&(d=l.realmult(.5,d));return d});return n._helper.buildConicMatrix(b)};n.SelectConic={};n.SelectConic.kind="C";n.SelectConic.signature=["Cs"];n.SelectConic.initialize=function(a){if(void 0!==a.index)return a.index-1;var b=n._helper.inputConic(a.pos);a=v.csnames[a.args[0]].results;for(var c=g.conicDist(b,a[0]),d=0,e=1;e<a.length;++e){var f=g.conicDist(b,a[e]);f<c&&(c=f,d=e)}return d};n.SelectConic.updatePosition=function(a){a.matrix=v.csnames[a.args[0]].results[a.param];a.matrix=g.normalizeMax(a.matrix);
a.matrix=w.withUsage(a.matrix,"Conic")};n._helper.ConicBy4p1l=function(a,b,c,d,e,f){var k=g.scalproduct(b,f),m=g.scalproduct(c,f),p=g.scalproduct(d,f),r=g.scalproduct(e,f),t=g.det3(c,d,e),u=g.det3(b,c,e),v=g.det3(b,d,e),w=g.det3(b,c,d),x=l.mult,m=l.sqrt(x(x(m,r),x(t,u))),k=l.sqrt(x(x(k,p),x(v,w))),p=g.cross(g.cross(b,d),f);f=g.cross(g.cross(c,e),f);p=g.scalmult(m,p);k=g.scalmult(k,f);f=g.normalizeMax(g.add(p,k));k=g.normalizeMax(g.sub(p,k));k=Ha(f,k);f=n._helper.ConicBy5(a,b,c,d,e,k.value[0]);a=n._helper.ConicBy5(a,
b,c,d,e,k.value[1]);return[g.normalizeMax(f),g.normalizeMax(a)]};n.ConicBy4p1l={};n.ConicBy4p1l.kind="Cs";n.ConicBy4p1l.signature=["P","P","P","P","L"];n.ConicBy4p1l.updatePosition=function(a){var b=n._helper.ConicBy4p1l(a,v.csnames[a.args[0]].homog,v.csnames[a.args[1]].homog,v.csnames[a.args[2]].homog,v.csnames[a.args[3]].homog,v.csnames[a.args[4]].homog);a.results=b};n.ConicBy4p1l.stateSize=Ha.stateSize;n._helper.ConicBy3p2l=function(a,b,c,d,e){function f(a,b,c,d){return l.sub(l.mult(a,d),l.mult(b,
c))}var k=g.cross(a,b),m=g.cross(d,e);d=g.cross(d,k);e=g.cross(e,k);k=g.turnIntoCSList([d,e,m]);c=g.productVM(c,g.adjoint3(k));m=g.adjoint3(g.turnIntoCSList([g.scalmult(c.value[0],d),g.scalmult(c.value[1],e),g.scalmult(c.value[2],m)]));c=g.transpose(m);d=l.mult;e=g.productMV(c,a);a=e.value[0];e=e.value[1];k=g.productMV(c,b);b=k.value[0];var k=k.value[1],n=l.sqrt(d(a,e)),p=l.sqrt(d(b,k)),r,t=Array(4);for(r=0;4>r;++r){var u=(r&2)-1,v=d(l.real(((r&1)<<1)-1),n),w=d(l.real(u),p),x=f(e,v,k,w),y=f(b,w,a,
v),u=f(a,e,b,k),z=l.add(l.add(f(b,k,a,e),f(k,w,e,v)),f(w,b,v,a)),v=d(x,x),w=d(y,y),A=d(z,z),B=d(x,y),x=d(x,z),y=d(y,z),B=l.sub(B,d(l.real(.5),d(u,u))),u=g.turnIntoCSList([g.turnIntoCSList([v,B,x]),g.turnIntoCSList([B,w,y]),g.turnIntoCSList([x,y,A])]),u=g.productMM(m,g.productMM(u,c)),u=g.turnIntoCSList([u.value[0].value[0],u.value[0].value[1],u.value[0].value[2],u.value[1].value[1],u.value[1].value[2],u.value[2].value[2]]);t[r]=u}return t};n.ConicBy3p2l={};n.ConicBy3p2l.kind="Cs";n.ConicBy3p2l.signature=
["P","P","P","L","L"];n.ConicBy3p2l.updatePosition=function(a){for(var b=n._helper.ConicBy3p2l(v.csnames[a.args[0]].homog,v.csnames[a.args[1]].homog,v.csnames[a.args[2]].homog,v.csnames[a.args[3]].homog,v.csnames[a.args[4]].homog),b=Cd(b),c=Array(4),d=0;4>d;++d){var e=b[d].value;c[d]=g.turnIntoCSList([g.turnIntoCSList([e[0],e[1],e[2]]),g.turnIntoCSList([e[1],e[3],e[4]]),g.turnIntoCSList([e[2],e[4],e[5]])])}a.results=c};n.ConicBy3p2l.stateSize=48;n.ConicBy2p3l={};n.ConicBy2p3l.kind="Cs";n.ConicBy2p3l.signature=
["P","P","L","L","L"];n.ConicBy2p3l.updatePosition=function(a){for(var b=n._helper.ConicBy3p2l(v.csnames[a.args[2]].homog,v.csnames[a.args[3]].homog,v.csnames[a.args[4]].homog,v.csnames[a.args[0]].homog,v.csnames[a.args[1]].homog),b=Cd(b),c=Array(4),d=0;4>d;++d){var e=b[d].value,e=g.turnIntoCSList([g.turnIntoCSList([e[0],e[1],e[2]]),g.turnIntoCSList([e[1],e[3],e[4]]),g.turnIntoCSList([e[2],e[4],e[5]])]);c[d]=g.normalizeMax(g.adjoint3(e))}a.results=c};n.ConicBy2p3l.stateSize=48;n.ConicBy1p4l={};n.ConicBy1p4l.kind=
"Cs";n.ConicBy1p4l.signature=["P","L","L","L","L"];n.ConicBy1p4l.updatePosition=function(a){var b=n._helper.ConicBy4p1l(a,v.csnames[a.args[1]].homog,v.csnames[a.args[2]].homog,v.csnames[a.args[3]].homog,v.csnames[a.args[4]].homog,v.csnames[a.args[0]].homog),c=b[0],b=b[1],c=g.adjoint3(c),b=g.adjoint3(b),b=[c,b];a.results=b};n.ConicBy1p4l.stateSize=Ha.stateSize;n.ConicParabolaPL={};n.ConicParabolaPL.kind="C";n.ConicParabolaPL.signature=["P","L"];n.ConicParabolaPL.updatePosition=function(a){var b=v.csnames[a.args[0]].homog.value,
c=v.csnames[a.args[1]].homog.value,d=l.mult,e=l.neg,f=l.add,k=l.sub,m=b[0],p=b[1],r=b[2],t=c[0],b=c[1],c=c[2],u=d(r,r),x=d(t,t),y=d(b,b),z=d(r,c),A=e(r),r=f(x,y),y=d(u,y),x=d(u,x),e=d(e(u),d(t,b)),t=d(A,f(d(m,r),d(z,t))),b=d(A,f(d(p,r),d(z,b))),d=k(d(f(d(m,m),d(p,p)),r),d(u,d(c,c))),d=n._helper.buildConicMatrix([y,e,x,t,b,d]),d=g.normalizeMax(d);a.matrix=w.withUsage(d,"Conic")};n.ConicBy2Foci1P={};n.ConicBy2Foci1P.kind="Cs";n.ConicBy2Foci1P.signature=["P","P","P"];n.ConicBy2Foci1P.updatePosition=
function(a){var b=v.csnames[a.args[0]].homog,c=v.csnames[a.args[1]].homog,d=v.csnames[a.args[2]].homog,e=g.ii,f=g.jj,k=g.normalizeMax(g.cross(b,d)),m=g.normalizeMax(g.cross(c,d)),p=g.normalizeMax(g.cross(d,e)),d=g.normalizeMax(g.cross(d,f)),m=n._helper.coHarmonic(p,d,k,m),k=g.normalizeMax(m[0]),m=g.normalizeMax(m[1]),e=g.turnIntoCSList([e]),p=g.turnIntoCSList([f]),d=g.turnIntoCSList([b]),r=g.turnIntoCSList([c]),f=n._helper.conicFromTwoDegenerates(e,p,d,r,k),f=g.normalizeMax(f),e=n._helper.conicFromTwoDegenerates(e,
p,d,r,m),e=g.normalizeMax(e),f=g.normalizeMax(g.adjoint3(f)),e=g.normalizeMax(g.adjoint3(e));"ellipsoid"!==n._helper.getConicType(f)&&(k=f,f=e,e=k);g.almostequals(b,c).value&&(b=l.real(3),e=g.zeromatrix(b,b));a.results=[f,e]};n.ConicBy2Pol1P={};n.ConicBy2Pol1P.kind="C";n.ConicBy2Pol1P.signature=["P","L","P","L","P"];n.ConicBy2Pol1P.updatePosition=function(a){var b=v.csnames[a.args[0]].homog,c=v.csnames[a.args[1]].homog,d=v.csnames[a.args[2]].homog,e=v.csnames[a.args[3]].homog,f=v.csnames[a.args[4]].homog,
k=g.scalproduct,m=g.scalmult,n=g.sub,p=g.productMM,r=l.realmult,t=g.transpose,u=g.turnIntoCSList,x=n(m(k(c,b),f),m(r(2,k(c,f)),b)),y=n(m(k(e,d),f),m(r(2,k(e,f)),d)),z=u([g.cross(b,f)]),f=u([g.cross(d,f)]),y=p(t(z),u([g.cross(b,y)])),u=p(t(f),u([g.cross(d,x)])),p=p(t(z),f),b=k(b,e),c=k(d,c),d=g.add(m(c,y),m(b,u)),d=n(d,m(r(2,l.mult(b,c)),p)),d=g.add(d,t(d)),d=g.normalizeMax(d),d=w.withUsage(d,"Conic");a.matrix=d};n.ConicBy2Pol1L={};n.ConicBy2Pol1L.kind="C";n.ConicBy2Pol1L.signature=["P","L","P","L",
"L"];n.ConicBy2Pol1L.updatePosition=function(a){var b=v.csnames[a.args[0]].homog,c=v.csnames[a.args[1]].homog,d=v.csnames[a.args[2]].homog,e=v.csnames[a.args[3]].homog,f=v.csnames[a.args[4]].homog,k=g.scalproduct,m=g.scalmult,n=g.productMM,p=l.mult,r=g.transpose,t=g.turnIntoCSList,u=k(c,b),x=k(c,d),y=k(e,b),z=k(e,d),A=k(f,b),k=k(f,d),B=t([g.sub(m(p(y,k),c),m(p(x,A),e))]),b=g.add(n(r(t([m(p(y,x),f)])),t([g.sub(g.add(m(l.sub(p(u,k),p(x,A)),e),m(l.sub(p(z,A),p(y,k)),c)),m(g.det3(c,e,f),g.cross(b,d)))])),
n(r(B),B)),b=g.add(b,r(b)),b=g.normalizeMax(b),b=w.withUsage(b,"Conic");a.matrix=b};n._helper.conic1Pol3Inc=function(a,b,c,d,e){var f=g.scalproduct,k=g.scalmult,m=g.productMM,n=g.cross,p=l.realmult,r=l.mult,t=g.transpose,u=g.turnIntoCSList,v=g.det3,w=v(a,c,d),x=u([n(c,e)]),y=u([n(a,e)]),z=u([n(c,d)]),A=f(b,a),B=f(b,c);b=f(b,e);n=u([n(d,g.sub(k(A,e),k(p(2,b),a)))]);x=k(w,m(t(x),n));a=p(2,l.add(r(v(a,d,e),B),r(w,b)));a=l.sub(r(v(c,d,e),A),a);x=g.add(x,k(a,m(t(y),z)));x=g.add(x,t(x));return x=g.normalizeMax(x)};
n.ConicBy1Pol3P={};n.ConicBy1Pol3P.kind="C";n.ConicBy1Pol3P.signature=["P","L","P","P","P"];n.ConicBy1Pol3P.updatePosition=function(a){var b=n._helper.conic1Pol3Inc(v.csnames[a.args[0]].homog,v.csnames[a.args[1]].homog,v.csnames[a.args[2]].homog,v.csnames[a.args[3]].homog,v.csnames[a.args[4]].homog),b=w.withUsage(b,"Conic");a.matrix=b};n.ConicBy1Pol3L={};n.ConicBy1Pol3L.kind="C";n.ConicBy1Pol3L.signature=["P","L","L","L","L"];n.ConicBy1Pol3L.updatePosition=function(a){var b=n._helper.conic1Pol3Inc(v.csnames[a.args[1]].homog,
v.csnames[a.args[0]].homog,v.csnames[a.args[2]].homog,v.csnames[a.args[3]].homog,v.csnames[a.args[4]].homog),b=g.normalizeMax(g.adjoint3(b)),b=w.withUsage(b,"Conic");a.matrix=b};n._helper.coHarmonic=function(a,b,c,d){var e=g.realVector([100*Math.random(),100*Math.random(),1]),f=g.det3(e,c,a),k=g.det3(e,c,b);c=g.det3(e,d,a);d=g.det3(e,d,b);d=l.sqrt(l.mult(d,k));f=l.sqrt(l.mult(c,f));a=w.mult(a,d);f=w.mult(b,f);b=g.add(a,f);a=g.sub(a,f);return[b,a]};n.ConicInSquare={};n.ConicInSquare.kind="C";n.ConicInSquare.signature=
["P","P","P","P"];n.ConicInSquare.updatePosition=function(a){var b=E.basismap(v.csnames[a.args[0]].homog,v.csnames[a.args[1]].homog,v.csnames[a.args[2]].homog,v.csnames[a.args[3]].homog),c=l.one,c=n._helper.buildConicMatrix([c,c,c,l.real(-3),c,c]),b=g.adjoint3(b),b=g.productMM(g.productMM(g.transpose(b),c),b),b=g.normalizeMax(b);a.matrix=w.withUsage(b,"Conic")};n.ConicBy5lines={};n.ConicBy5lines.kind="C";n.ConicBy5lines.signature=["L","L","L","L","L"];n.ConicBy5lines.updatePosition=function(a){var b=
n._helper.ConicBy5(a,v.csnames[a.args[0]].homog,v.csnames[a.args[1]].homog,v.csnames[a.args[2]].homog,v.csnames[a.args[3]].homog,v.csnames[a.args[4]].homog),b=g.adjoint3(b);a.matrix=b;a.matrix=g.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};n.ConicFromPrincipalDirections={};n.ConicFromPrincipalDirections.kind="C";n.ConicFromPrincipalDirections.signature=["P","P","P"];n.ConicFromPrincipalDirections.updatePosition=function(a){var b=v.csnames[a.args[0]].homog,c=v.csnames[a.args[1]].homog,
d=v.csnames[a.args[2]].homog,e=n._helper.pointReflection(b,c),f=g.cross(c,b),b=g.turnIntoCSList([f.value[0],f.value[1],l.zero]),f=g.turnIntoCSList([f]),c=g.turnIntoCSList([g.cross(c,b)]),e=g.turnIntoCSList([g.cross(e,b)]);a.matrix=n._helper.conicFromTwoDegenerates(f,f,c,e,d);a.matrix=g.normalizeMax(a.matrix);a.matrix=w.withUsage(a.matrix,"Conic")};n.CircleBy3={};n.CircleBy3.kind="C";n.CircleBy3.signature=["P","P","P"];n.CircleBy3.updatePosition=function(a){var b=n._helper.ConicBy5(a,v.csnames[a.args[0]].homog,
v.csnames[a.args[1]].homog,g.ii,g.jj,v.csnames[a.args[2]].homog);a.matrix=g.normalizeMax(b);a.matrix=w.withUsage(a.matrix,"Circle")};n.ArcBy3={};n.ArcBy3.kind="C";n.ArcBy3.signature=["P","P","P"];n.ArcBy3.updatePosition=function(a){n.CircleBy3.updatePosition(a);a.startPoint=v.csnames[a.args[0]].homog;a.viaPoint=v.csnames[a.args[1]].homog;a.endPoint=v.csnames[a.args[2]].homog};n.ArcBy3.initialize=function(a){a.startPoint=v.csnames[a.args[0]].homog;a.viaPoint=v.csnames[a.args[1]].homog;a.endPoint=v.csnames[a.args[2]].homog;
a.isArc=!0};n.PolarOfPoint={};n.PolarOfPoint.kind="L";n.PolarOfPoint.signature=["P","C"];n.PolarOfPoint.updatePosition=function(a){var b=w.mult(v.csnames[a.args[1]].matrix,v.csnames[a.args[0]].homog),b=g.normalizeMax(b);a.homog=w.withUsage(b,"Line")};n.PolarOfLine={};n.PolarOfLine.kind="P";n.PolarOfLine.signature=["L","C"];n.PolarOfLine.updatePosition=function(a){var b=v.csnames[a.args[0]],c=g.adjoint3(v.csnames[a.args[1]].matrix),b=w.mult(c,b.homog),b=g.normalizeMax(b);a.homog=w.withUsage(b,"Point")};
n.AngleBisector={};n.AngleBisector.kind="Ls";n.AngleBisector.signature=["L","L","P"];n.AngleBisector.updatePosition=function(a){var b=v.csnames[a.args[0]].homog,c=v.csnames[a.args[1]].homog,d=v.csnames[a.args[2]].homog,e=g.add,f=g.sub,k=g.abs,l=g.cross,m=g.scalmult,n=g.normalizeMax,p=g._helper.isAlmostZero,r=g.linfty,t=m(k(l(l(r,c),r)),b),b=m(k(l(l(r,b),r)),c),f=f(t,b),e=e(t,b);p(f)&&(f=l(l(l(r,e),r),d));p(e)&&(e=l(l(l(r,f),r),d));a.results=Ha(n(f),n(e))};n.AngleBisector.stateSize=Ha.stateSize;n._helper.IntersectLC=
function(a,b){var c=l,d=g.crossOperator(a),e=g.transpose(d),e=w.mult(e,w.mult(b,d)),f=g.maxIndex(a,l.abs2),k,m,n,p;0===f?(f=e.value[1].value[1],k=e.value[1].value[2],m=e.value[2].value[1],n=e.value[2].value[2],p=a.value[0]):1===f?(f=e.value[0].value[0],k=e.value[0].value[2],m=e.value[2].value[0],n=e.value[2].value[2],p=a.value[1]):(f=e.value[0].value[0],k=e.value[0].value[1],m=e.value[1].value[0],n=e.value[1].value[1],p=a.value[2]);c=c.div(c.sqrt(c.sub(c.mult(k,m),c.mult(f,n))),p);c=g.add(e,g.scalmult(c,
d));f=g.maxIndex(c,g.abs2);d=c.value[f];d=g.normalizeMax(d);d=w.withUsage(d,"Point");c=g.transpose(c);f=g.maxIndex(c,g.abs2);c=c.value[f];c=g.normalizeMax(c);c=w.withUsage(c,"Point");return[d,c]};n.IntersectLC={};n.IntersectLC.kind="Ps";n.IntersectLC.signature=["L","C"];n.IntersectLC.updatePosition=function(a){var b=n._helper.IntersectLC(v.csnames[a.args[0]].homog,v.csnames[a.args[1]].matrix);a.results=Ha(b[0],b[1])};n.IntersectLC.stateSize=Ha.stateSize;n.OtherIntersectionCL={};n.OtherIntersectionCL.kind=
"P";n.OtherIntersectionCL.signature=["C","L","P"];n.OtherIntersectionCL.updatePosition=function(a){var b=v.csnames[a.args[2]].homog,c=n._helper.IntersectLC(v.csnames[a.args[1]].homog,v.csnames[a.args[0]].matrix),d=c[0],c=c[1],e=g.projectiveDistMinScal(d,b),b=g.projectiveDistMinScal(c,b);a.homog=e<b?c:d;a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};n.IntersectCirCir={};n.IntersectCirCir.kind="Ps";n.IntersectCirCir.signature=["C","C"];n.IntersectCirCir.updatePosition=function(a){var b=
v.csnames[a.args[0]].matrix,c=v.csnames[a.args[1]].matrix,d=g.scalmult(c.value[0].value[0],b.value[2]),c=g.scalmult(b.value[0].value[0],c.value[2]),d=g.sub(d,c),d=g.turnIntoCSList([d.value[0],d.value[1],l.realmult(.5,d.value[2])]),d=g.normalizeMax(d),b=n._helper.IntersectLC(d,b);a.results=Ha(b[0],b[1])};n.IntersectCirCir.stateSize=Ha.stateSize;n.OtherIntersectionCC={};n.OtherIntersectionCC.kind="P";n.OtherIntersectionCC.signature=["C","C","P"];n.OtherIntersectionCC.updatePosition=function(a){var b=
v.csnames[a.args[0]].matrix,c=v.csnames[a.args[1]].matrix,d=v.csnames[a.args[2]].homog,e=g.scalmult(c.value[0].value[0],b.value[2]),c=g.scalmult(b.value[0].value[0],c.value[2]),e=g.sub(e,c),e=g.turnIntoCSList([e.value[0],e.value[1],l.realmult(.5,e.value[2])]),e=g.normalizeMax(e),e=n._helper.IntersectLC(e,b),b=e[0],e=e[1],c=g.projectiveDistMinScal(b,d),d=g.projectiveDistMinScal(e,d);a.homog=c<d?e:b;a.homog=g.normalizeMax(a.homog);a.homog=w.withUsage(a.homog,"Point")};n._helper.IntersectConicConic=
function(a,b){var c=a.value[0],d=a.value[1],e=a.value[2],f=b.value[0],k=b.value[1],m=b.value[2],p=g.det3(c,d,e),r=l.add(l.add(g.det3(c,d,m),g.det3(c,k,e)),g.det3(f,d,e)),c=l.add(l.add(g.det3(c,k,m),g.det3(f,d,m)),g.det3(f,k,e)),f=g.det3(f,k,m),m=l.abs2(p).value.real,k=l.abs2(f).value.real;m<k&&(m=a,a=b,b=m,m=f,f=p,p=m,m=c,c=r,r=m,m=k);1E-24>m?(p=a,c=b):(r=l.solveCubic(p,r,c,f),c=l.abs2(l.sub(r[0],r[1])).value.real,f=l.abs2(l.sub(r[0],r[2])).value.real,k=l.abs2(l.sub(r[1],r[2])).value.real,c>f?(p=
r[1],r=c>k?r[0]:r[2]):(p=r[2],r=f>k?r[0]:r[1]),p=g.add(g.scalmult(p,a),b),c=g.add(g.scalmult(r,a),b));r=n._helper.splitDegenConic(p);p=r[0];r=r[1];c=n._helper.splitDegenConic(c);k=c[0];f=c[1];c=g.cross(p,k);k=g.cross(r,k);p=g.cross(p,f);r=g.cross(r,f);c=g.normalizeMax(c);k=g.normalizeMax(k);p=g.normalizeMax(p);r=g.normalizeMax(r);c=w.withUsage(c,"Point");k=w.withUsage(k,"Point");p=w.withUsage(p,"Point");r=w.withUsage(r,"Point");return[c,k,p,r]};n.IntersectConicConic={};n.IntersectConicConic.kind=
"Ps";n.IntersectConicConic.signature=["C","C"];n.IntersectConicConic.updatePosition=function(a){var b=n._helper.IntersectConicConic(v.csnames[a.args[0]].matrix,v.csnames[a.args[1]].matrix),b=xc(b[0],b[1],b[2],b[3]);a.results=b};n.IntersectConicConic.stateSize=xc.stateSize;n.SelectP={};n.SelectP.kind="P";n.SelectP.signature=["Ps"];n.SelectP.initialize=function(a){if(void 0!==a.index)return a.index-1;var b=v.csnames[a.args[0]].results.value;a=n._helper.initializePoint(a);for(var c=g.projectiveDistMinScal(a,
b[0]),d=0,e=1;e<b.length;++e){var f=g.projectiveDistMinScal(a,b[e]);f<c&&(c=f,d=e)}return d};n.SelectP.updatePosition=function(a){a.homog=v.csnames[a.args[0]].results.value[a.param]};n.SelectL={};n.SelectL.kind="L";n.SelectL.signature=["Ls"];n.SelectL.initialize=function(a){if(void 0!==a.index)return a.index-1;var b=v.csnames[a.args[0]].results.value;a=n._helper.initializeLine(a);for(var c=g.projectiveDistMinScal(a,b[0]),d=0,e=1;e<b.length;++e){var f=g.projectiveDistMinScal(a,b[e]);f<c&&(c=f,d=e)}return d};
n.SelectL.updatePosition=function(a){a.homog=v.csnames[a.args[0]].results.value[a.param];a.homog=w.withUsage(a.homog,"Line")};n._helper.moebiusStep=function(a,b,c){var d=l.add,e=l.sub,f=l.mult,g=a.value[0],k=a.value[1];a=a.value[2];var m=b.value[0],n=b.value[1];b=b.value[2];var p=c.value[0],r=c.value[1],t=c.value[2];c=e(f(b,p),f(m,t));var u=e(f(b,r),f(n,t)),p=e(f(g,t),f(a,p)),r=e(f(k,t),f(a,r));return[e(f(g,c),f(k,u)),d(f(k,c),f(g,u)),f(a,c),f(a,u),e(f(m,p),f(n,r)),d(f(n,p),f(m,r)),f(b,p),f(b,r)]};
n.TrMoebius={};n.TrMoebius.kind="Mt";n.TrMoebius.signature="PPPPPP".split("");n.TrMoebius.updatePosition=function(a){var b=l.neg,c=n._helper.moebiusStep(v.csnames[a.args[0]].homog,v.csnames[a.args[2]].homog,v.csnames[a.args[4]].homog),d=n._helper.moebiusStep(v.csnames[a.args[1]].homog,v.csnames[a.args[3]].homog,v.csnames[a.args[5]].homog),d=g.normalizeMax(g.matrix([[d[0],b(d[1]),d[4],b(d[5])],[d[1],d[0],d[5],d[4]],[d[2],b(d[3]),d[6],b(d[7])],[d[3],d[2],d[7],d[6]]])),b=g.normalizeMax(g.matrix([[c[6],
b(c[4])],[c[7],b(c[5])],[b(c[2]),c[0]],[b(c[3]),c[1]]])),b=g.normalizeMax(g.productMM(d,b));a.moebius={anti:!1,ar:b.value[0].value[0],ai:b.value[1].value[0],br:b.value[0].value[1],bi:b.value[1].value[1],cr:b.value[2].value[0],ci:b.value[3].value[0],dr:b.value[2].value[1],di:b.value[3].value[1]};n._helper.moebiusPair(a)};n._helper.moebiusPair=function(a){var b=a.moebius,c=l.neg,d=b.anti?c:w.identity;a.mat1=g.normalizeMax(g.matrix([[c(b.cr),d(b.ci),c(b.dr)],[b.ci,d(b.cr),b.di],[b.ar,c(d(b.ai)),b.br]]));
a.mat2=g.normalizeMax(g.matrix([[c(b.ci),c(d(b.cr)),c(b.di)],[c(b.cr),d(b.ci),c(b.dr)],[b.ai,d(b.ar),b.bi]]))};n.TrInverseMoebius={};n.TrInverseMoebius.kind="Mt";n.TrInverseMoebius.signature=["Mt"];n.TrInverseMoebius.updatePosition=function(a){var b=v.csnames[a.args[0]].moebius,c=l.neg,d=b.anti?c:w.identity;a.moebius={anti:b.anti,ar:b.dr,ai:d(b.di),br:c(b.br),bi:c(d(b.bi)),cr:c(b.cr),ci:c(d(b.ci)),dr:b.ar,di:d(b.ai)};n._helper.moebiusPair(a)};n.TrMoebiusP={};n.TrMoebiusP.kind="P";n.TrMoebiusP.signature=
["Mt","P"];n.TrMoebiusP.updatePosition=function(a){var b=v.csnames[a.args[0]],c=v.csnames[a.args[1]].homog,d=g.productMV(b.mat1,c),b=g.productMV(b.mat2,c);a.homog=g.normalizeMax(g.cross(d,b));a.homog=w.withUsage(a.homog,"Point")};n._helper.TrMoebiusP=function(a,b){var c=g.productMV(b.mat1,a),d=g.productMV(b.mat2,a);return g.normalizeMax(g.cross(c,d))};n.TrMoebiusL={};n.TrMoebiusL.kind="C";n.TrMoebiusL.signature=["Mt","L"];n.TrMoebiusL.updatePosition=function(a){var b=v.csnames[a.args[0]],c=v.csnames[a.args[1]].homog,
d=function(){var a=g.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);return g.normalizeMax(a)},e=g.cross(d(),c),f=g.cross(d(),c),c=g.cross(d(),c),e=n._helper.TrMoebiusP(e,b),f=n._helper.TrMoebiusP(f,b),b=n._helper.TrMoebiusP(c,b);a.matrix=g.normalizeMax(n._helper.ConicBy5(null,e,f,b,g.ii,g.jj));a.matrix=w.withUsage(a.matrix,"Circle")};n.TrMoebiusS={};n.TrMoebiusS.kind="C";n.TrMoebiusS.signature=["Mt","S"];n.TrMoebiusS.updatePosition=function(a){var b=v.csnames[a.args[0]],c=v.csnames[a.args[1]],
d=c.startpos,c=c.endpos,e=g.add(d,c),d=n._helper.TrMoebiusP(d,b),e=n._helper.TrMoebiusP(e,b),b=n._helper.TrMoebiusP(c,b);a.startPoint=d;a.viaPoint=e;a.endPoint=b;a.isArc=!0;a.matrix=g.normalizeMax(n._helper.ConicBy5(null,d,e,b,g.ii,g.jj));a.matrix=w.withUsage(a.matrix,"Circle")};n.TrMoebiusC={};n.TrMoebiusC.kind="C";n.TrMoebiusC.signature=["Mt","C"];n.TrMoebiusC.signatureConstraints=function(a){return"Circle"===v.csnames[a.args[1]].matrix.usage};n.TrMoebiusC.updatePosition=function(a){var b=v.csnames[a.args[0]],
c=v.csnames[a.args[1]].matrix,d=function(){var a=g.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);return g.normalizeMax(a)},e=n._helper.IntersectLC(d(),c),d=n._helper.IntersectLC(d(),c),c=e[1],d=d[1],e=n._helper.TrMoebiusP(e[0],b),c=n._helper.TrMoebiusP(c,b),b=n._helper.TrMoebiusP(d,b);a.matrix=g.normalizeMax(n._helper.ConicBy5(null,e,c,b,g.ii,g.jj));a.matrix=w.withUsage(a.matrix,"Circle")};n.TrMoebiusArc={};n.TrMoebiusArc.kind="C";n.TrMoebiusArc.signature=["Mt","C"];n.TrMoebiusArc.signatureConstraints=
function(a){return v.csnames[a.args[1]].isArc};n.TrMoebiusArc.updatePosition=function(a){var b=v.csnames[a.args[0]],c=v.csnames[a.args[1]],d=c.viaPoint,e=c.endPoint,c=n._helper.TrMoebiusP(c.startPoint,b),d=n._helper.TrMoebiusP(d,b),b=n._helper.TrMoebiusP(e,b);a.startPoint=c;a.viaPoint=d;a.endPoint=b;a.isArc=!0;a.matrix=g.normalizeMax(n._helper.ConicBy5(null,c,d,b,g.ii,g.jj));a.matrix=w.withUsage(a.matrix,"Circle")};n._helper.trBuildMatrix=function(a,b){var c=b(0),d=b(1),e=g.productMM(d,g.adjoint3(c));
a.matrix=g.normalizeMax(e);e=g.transpose(g.productMM(c,g.adjoint3(d)));a.dualMatrix=g.normalizeMax(e)};n.TrProjection={};n.TrProjection.kind="Tr";n.TrProjection.signature="PPPPPPPP".split("");n.TrProjection.updatePosition=function(a){n._helper.trBuildMatrix(a,function(b){return E.basismap(v.csnames[a.args[0+b]].homog,v.csnames[a.args[2+b]].homog,v.csnames[a.args[4+b]].homog,v.csnames[a.args[6+b]].homog)})};n.TrAffine={};n.TrAffine.kind="Tr";n.TrAffine.signature="PPPPPP".split("");n.TrAffine.updatePosition=
function(a){var b=l.mult,c=g.scalmult,d=g.turnIntoCSList,e=g.transpose,f=g.normalizeMax,k=g.productMM,m=g.adjoint3,n=d([v.csnames[a.args[0]].homog,v.csnames[a.args[2]].homog,v.csnames[a.args[4]].homog]),p=d([v.csnames[a.args[1]].homog,v.csnames[a.args[3]].homog,v.csnames[a.args[5]].homog]),r=e(n),e=e(p),t=r.value[2].value,u=e.value[2].value,w=[b(t[0],u[2]),b(t[1],u[0]),b(t[2],u[1])],r=m(r).value;a.matrix=f(k(e,d([c(b(w[0],u[1]),r[0]),c(b(w[1],u[2]),r[1]),c(b(w[2],u[0]),r[2])])));r=n.value;a.dualMatrix=
f(k(m(p),d([c(b(t[2],w[1]),r[0]),c(b(t[0],w[2]),r[1]),c(b(t[1],w[0]),r[2])])))};n.TrSimilarity={};n.TrSimilarity.kind="Tr";n.TrSimilarity.signature=["P","P","P","P"];n.TrSimilarity.updatePosition=function(a){n._helper.trBuildMatrix(a,function(b){return E.basismap(v.csnames[a.args[0+b]].homog,v.csnames[a.args[2+b]].homog,g.ii,g.jj)})};n.TrTranslation={};n.TrTranslation.kind="Tr";n.TrTranslation.signature=["P","P"];n.TrTranslation.updatePosition=function(a){var b=v.csnames[a.args[0]].homog,c=v.csnames[a.args[1]].homog,
d=g.cross(b,c).value,b=l.mult(b.value[2],c.value[2]),c=g.turnIntoCSList,e=l.neg,f=l.zero,d=c([c([b,f,d[1]]),c([f,b,e(d[0])]),c([f,f,b])]),d=g.normalizeMax(d);a.matrix=d;b=e(d.value[0].value[0]);d=c([c([b,f,f]),c([f,b,f]),c([d.value[0].value[2],d.value[1].value[2],b])]);a.dualMatrix=d};n.TrReflectionP={};n.TrReflectionP.kind="Tr";n.TrReflectionP.signature=["P"];n.TrReflectionP.updatePosition=function(a){var b=v.csnames[a.args[0]].homog.value,c=l.realmult(-.5,b[2]),d=l.zero,b=g.turnIntoCSList([g.turnIntoCSList([c,
d,b[0]]),g.turnIntoCSList([d,c,b[1]]),g.turnIntoCSList([d,d,l.neg(c)])]),b=g.normalizeMax(b);a.matrix=b;a.dualMatrix=g.transpose(b)};n.TrReflectionL={};n.TrReflectionL.kind="Tr";n.TrReflectionL.signature=["L"];n.TrReflectionL.updatePosition=function(a){var b=l.mult,c=l.realmult,d=l.zero,e=v.csnames[a.args[0]].homog.value,f=e[0],k=e[1],e=e[2],m=b(f,f),n=b(k,k),p=c(-.5,l.sub(m,n)),r=b(f,k),b=g.turnIntoCSList([g.turnIntoCSList([l.neg(p),r,b(f,e)]),g.turnIntoCSList([r,p,b(k,e)]),g.turnIntoCSList([d,d,
c(-.5,l.add(m,n))])]),b=g.normalizeMax(b);a.matrix=b;a.dualMatrix=g.transpose(b)};n.TrReflectionS={};n.TrReflectionS.kind="Tr";n.TrReflectionS.signature=["S"];n.TrReflectionS.updatePosition=n.TrReflectionL.updatePosition;n.TrReflectionC={};n.TrReflectionC.kind="Mt";n.TrReflectionC.signature=["C"];n.TrReflectionC.signatureConstraints=function(a){return"Circle"===v.csnames[a.args[0]].matrix.usage};n.TrReflectionC.updatePosition=function(a){var b=v.csnames[a.args[0]].matrix,c=b.value[0].value[2],d=b.value[1].value[2],
e=l.neg;a.moebius={anti:!0,ar:c,ai:d,br:b.value[2].value[2],bi:l.zero,cr:e(b.value[0].value[0]),ci:l.zero,dr:e(c),di:d};n._helper.moebiusPair(a)};n.TrInverse={};n.TrInverse.kind="Tr";n.TrInverse.signature=["Tr"];n.TrInverse.updatePosition=function(a){var b=v.csnames[a.args[0]];a.dualMatrix=g.transpose(b.matrix);a.matrix=g.transpose(b.dualMatrix)};n.TransformC={};n.TransformC.kind="C";n.TransformC.signature=["Tr","C"];n.TransformC.updatePosition=function(a){var b=v.csnames[a.args[0]].dualMatrix,b=
g.productMM(g.productMM(b,v.csnames[a.args[1]].matrix),g.transpose(b)),b=g.normalizeMax(b);a.matrix=w.withUsage(b,"Conic")};n.TransformArc={};n.TransformArc.kind="C";n.TransformArc.signature=["Tr","C"];n.TransformArc.signatureConstraints=function(a){return v.csnames[a.args[0]].isArc};n.TransformArc.updatePosition=function(a){var b=v.csnames[a.args[0]].matrix,c=v.csnames[a.args[1]],d=c.viaPoint,e=c.endPoint,c=g.normalizeMax(g.productMV(b,c.startPoint)),d=g.normalizeMax(g.productMV(b,d)),b=g.normalizeMax(g.productMV(b,
e));a.startPoint=c;a.viaPoint=d;a.endPoint=b;a.isArc=!0;a.matrix=g.normalizeMax(n._helper.ConicBy5(null,c,d,b,g.ii,g.jj));a.matrix=w.withUsage(a.matrix,"Circle")};n.TransformP={};n.TransformP.kind="P";n.TransformP.signature=["Tr","P"];n.TransformP.updatePosition=function(a){a.homog=g.normalizeMax(g.productMV(v.csnames[a.args[0]].matrix,v.csnames[a.args[1]].homog));a.homog=w.withUsage(a.homog,"Point")};n.TransformL={};n.TransformL.kind="L";n.TransformL.signature=["Tr","L"];n.TransformL.updatePosition=
function(a){a.homog=g.normalizeMax(g.productMV(v.csnames[a.args[0]].dualMatrix,v.csnames[a.args[1]].homog));a.homog=w.withUsage(a.homog,"Line")};n.TransformS={};n.TransformS.kind="S";n.TransformS.signature=["Tr","S"];n.TransformS.updatePosition=function(a){var b=v.csnames[a.args[0]],c=v.csnames[a.args[1]];n.Segment.setSegmentPos(a,g.productMV(b.dualMatrix,c.homog),g.productMV(b.matrix,c.startpos),g.productMV(b.matrix,c.endpos))};n.TransformPolygon={};n.TransformPolygon.kind="Poly";n.TransformPolygon.signature=
["Tr","Poly"];n.TransformPolygon.updatePosition=function(a){var b=v.csnames[a.args[0]].matrix;a.vertices=g.turnIntoCSList(v.csnames[a.args[1]].vertices.value.map(function(a){a=g.normalizeMax(g.productMV(b,a));return a=w.withUsage(a,"Point")}))};n._helper.pointReflection=function(a,b){return g.normalizeMax(g.sub(g.scalmult(l.realmult(2,b.value[2]),a),g.scalmult(a.value[2],b)))};n._helper.conicOtherIntersection=function(a,b,c){var d=g.productMV(a,c);a=g.scalproduct(c,d);d=g.scalproduct(b,d);d=l.realmult(-2,
d);b=g.scalmult(a,b);c=g.scalmult(d,c);c=g.add(b,c);return c=g.normalizeMax(c)};n.Dist={};n.Dist.kind="V";n.Dist.signature=["P","P"];n.Dist.updatePosition=function(a){var b=v.csnames[a.args[1]].homog;a.value=g.abs(g.sub(g.normalizeZ(v.csnames[a.args[0]].homog),g.normalizeZ(b)))};n.Angle={};n.Angle.kind="V";n.Angle.signature=["L","L","P"];n.Angle.initialize=function(a){void 0===a.angle&&(a.angle=.5*Math.PI);Sa(l._helper.input(a.angle))};n.Angle.updatePosition=function(a){var b=v.csnames[a.args[1]].homog,
c=v.csnames[a.args[2]].homog,d=g.cross(v.csnames[a.args[0]].homog,g.linfty),b=g.cross(b,g.linfty),c=g.crossratio3(d,b,g.ii,g.jj,c),c=l.mult(l.complex(0,.5),l.log(c)),d=(vb().value.real-c.value.real)/Math.PI,b=Math.round(d);!eb&&.01<Math.abs(b-d)&&Ub();c=l.complex(b*Math.PI+c.value.real,c.value.imag);Sa(c);a.value=w.withUsage(c,"Angle")};n.Angle.stateSize=2;n.Text={};n.Text.kind="Text";n.Text.signature="**";n.Text.isMovable=!0;n.Text.updatePosition=Ja;n.Text.initialize=function(a){a.text=String(a.text);
a.pos&&(a.homog=n._helper.initializePoint(a));a.dock&&(a.dock.offset=a.dock.offset&&2===a.dock.offset.length?g.realVector([+a.dock.offset[0],+a.dock.offset[1]]):g.realVector([0,0]))};n.Text.getParamForInput=function(a,b,c){return n.Free.getParamForInput(a,b,c)};n.Text.getParamFromState=function(a){return a.homog};n.Text.putParamToState=function(a,b){a.homog=b};n.Calculation={};n.Calculation.kind="Text";n.Calculation.signature="**";n.Calculation.isMovable=!0;n.Calculation.updatePosition=Ja;n.Calculation.initialize=
function(a){n.Text.initialize(a);a.calculation=Na(a.text)};n.Calculation.getText=function(a){return Q(A(a.calculation))};n.Calculation.getParamForInput=n.Text.getParamForInput;n.Calculation.getParamFromState=n.Text.getParamFromState;n.Calculation.putParamToState=n.Text.putParamToState;n.Equation={};n.Equation.kind="Text";n.Equation.isMovable=!0;n.Equation.signature="**";n.Equation.updatePosition=Ja;n.Equation.initialize=function(a){n.Text.initialize(a);a.calculation=Na(a.text)};n.Equation.getText=
function(a){return a.text+" = "+Q(A(a.calculation))};n.Equation.getParamForInput=n.Text.getParamForInput;n.Equation.getParamFromState=n.Text.getParamFromState;n.Equation.putParamToState=n.Text.putParamToState;n.Evaluate={};n.Evaluate.kind="Text";n.Evaluate.isMovable=!0;n.Evaluate.signature="**";n.Evaluate.updatePosition=Ja;n.Evaluate.initialize=function(a){n.Text.initialize(a);a.calculation=Na(a.text)};n.Evaluate.getText=function(a){A(a.calculation);return a.text};n.Evaluate.getParamForInput=n.Text.getParamForInput;
n.Evaluate.getParamFromState=n.Text.getParamFromState;n.Evaluate.putParamToState=n.Text.putParamToState;n.Plot={};n.Plot.kind="Text";n.Plot.isMovable=!0;n.Plot.signature="**";n.Plot.updatePosition=Ja;n.Plot.initialize=function(a){n.Text.initialize(a);a.calculation=Na("plot(("+a.text+"))")};n.Plot.getText=function(a){A(a.calculation);return a.text};n.Plot.getParamForInput=n.Text.getParamForInput;n.Plot.getParamFromState=n.Text.getParamFromState;n.Plot.putParamToState=n.Text.putParamToState;n.Button=
{};n.Button.kind="Text";n.Button.signature="**";n.Button.isMovable=!0;n.Button.updatePosition=Ja;n.Button.initialize=function(a){var b=document.createElement("button");yc(a,"click",b)};n.Button.getParamForInput=n.Text.getParamForInput;n.Button.getParamFromState=n.Text.getParamFromState;n.Button.putParamToState=n.Text.putParamToState;n.Button.set_fillcolor=function(a,b){g._helper.isNumberVecN(b,3)&&(a.fillcolor=b.value.map(function(a){return a.value.real}),a.html.style.backgroundColor=x.makeColor(a.fillcolor,
a.fillalpha))};n.ToggleButton={};n.ToggleButton.kind="Text";n.ToggleButton.signature="**";n.ToggleButton.isMovable=!0;n.ToggleButton.updatePosition=Ja;n.ToggleButton.initialize=function(a){var b;b=void 0;void 0===b&&(b="CindyJSid");b+=++Ta;var c=document.createElement("input"),d=document.createElement("label");c.setAttribute("id",b);d.setAttribute("for",b);c.setAttribute("type","checkbox");a.pressed&&(c.checked=!0);a.checkbox=c;yc(a,"change",c,d)};n.ToggleButton.getParamForInput=n.Text.getParamForInput;
n.ToggleButton.getParamFromState=n.Text.getParamFromState;n.ToggleButton.putParamToState=n.Text.putParamToState;n.ToggleButton.set_fillcolor=n.Button.set_fillcolor;n.EditableText={};n.EditableText.kind="Text";n.EditableText.isMovable=!0;n.EditableText.signature=[];n.EditableText.updatePosition=Ja;n.EditableText.initialize=function(a){var b=document.createElement("input");b.setAttribute("type","text");b.className="CindyJS-editabletext";Aa(a.minwidth)&&(b.style.width=a.minwidth-3+"px");"string"===typeof a.text&&
(b.value=a.text);b.addEventListener("keydown",function(a){13===a.keyCode&&b.blur()});yc(a,"change",b)};n.EditableText.getText=function(a){return!1};n.EditableText.getParamForInput=n.Text.getParamForInput;n.EditableText.getParamFromState=n.Text.getParamFromState;n.EditableText.putParamToState=n.Text.putParamToState;n.EditableText.set_fillcolor=n.Button.set_fillcolor;n.EditableText.get_currenttext=function(a){return w.string(String(a.html.value))};n.EditableText.set_currenttext=function(a,b){a.html.value=
Q(b)};n.EditableText.get_text=n.EditableText.get_currenttext;n.EditableText.set_text=n.EditableText.set_currenttext;n._helper.initializePoint=function(a){var b=0,c=0,d=0;if(a.pos){if("list"===a.pos.ctype&&g.isNumberVector(a.pos))return a.pos;2===a.pos.length&&(b=a.pos[0],c=a.pos[1],d=1);3===a.pos.length&&(b=a.pos[0],c=a.pos[1],d=a.pos[2])}a=g.turnIntoCSList([l._helper.input(b),l._helper.input(c),l._helper.input(d)]);return a=g.normalizeMax(a)};n._helper.initializeLine=function(a){var b=0,c=0,d=0;
if(a.pos){if("list"===a.pos.ctype&&g.isNumberVector(a.pos))return a.pos;3===a.pos.length&&(b=a.pos[0],c=a.pos[1],d=a.pos[2])}a=g.turnIntoCSList([l._helper.input(b),l._helper.input(c),l._helper.input(d)]);return a=g.normalizeMax(a)};n.Poly={};n.Poly.kind="Poly";n.Poly.signature="P*";n.Poly.updatePosition=function(a){a.vertices=g.turnIntoCSList(a.args.map(function(a){return v.csnames[a].homog}))};var tc={CircleByRadius:"CircleMr",IntersectionCircleCircle:"IntersectCirCir",IntersectionConicConic:"IntersectConicConic",
FreePoint:"Free",Orthogonal:"Perp",Parallel:"Para",Pole:"PolarOfLine",Polar:"PolarOfPoint",Arc:"ArcBy3",EuclideanMid:"Mid",AngularBisector:"AngleBisector",TransformConic:"TransformC",TransformSegment:"TransformS",TrMoebiusSegment:"TrMoebiusS",ReflectCC:"TrMoebiusC",ReflectCL:"TrMoebiusL",ReflectCP:"TrMoebiusP",ReflectCArc:"TrMoebiusArc",ReflectCS:"TrMoebiusS",TrMoebiusCircle:"TrMoebiusC"},sd={CircleMFixedr:function(a){a.pinned=!0;a.type="CircleMr";return[a]},CircleByFixedRadius:function(a){a.pinned=
!0;a.type="CircleMr";return[a]},IntersectionConicLine:function(a){a.args=[a.args[1],a.args[0]];a.type="IntersectLC";return[a]},angleBisector:function(a){var b={name:a.name+"_Intersection",type:"Meet",args:a.args,visible:!1};a.type="AngleBisector";a.args=[a.args[0],a.args[1],b.name];return[b,a]},Transform:function(a){var b=v.csnames[a.args[1]],b={Tr:"Transform",Mt:"TrMoebius"}[v.csnames[a.args[0]].kind]+(b.isArc?"Arc":b.kind);if(n.hasOwnProperty(b))return a.type=b,[a];console.log(b+" not implemented yet");
return[]},TrReflection:function(a){var b="TrReflection"+v.csnames[a.args[0]].kind;if(n.hasOwnProperty(b))return a.type=b,[a];console.log(b+" not implemented yet");return[]}},me="align alpha angle args arrow arrowposition arrowshape arrowsides arrowsize clip color dashtype drawtrace fillalpha fillcolor filled labeled labelpos name overhang pinned printname radius size text text_fontfamily textbold textitalics textsize tracedim tracelength traceskip tracing type visible".split(" ");oa.saveState=function(){return{geometry:ne()}};
var qa={},Kd,Hb,Ld,Md;Kd=[[],[.2],[.075,.225],[44/45,-56/15,32/9],[19372/6561,-25360/2187,64448/6561,-212/729],[9017/3168,-355/33,46732/5247,49/176,-5103/18656],[35/384,0,500/1113,125/192,-2187/6784,11/84]];Hb=[0,.2,.3,.8,8/9,1,1];Ld=[35/384,0,500/1113,125/192,-2187/6784,11/84,0];Md=[5179/57600,0,7571/16695,.6140625,-92097/339200,187/2100,.025];var za,ea=[],zc=[],ic=!1;qa.tick=function(a){a/=Lb;for(var b=0;b<Lb;b++)qa.tick1(a),Bb+=a,A(P.simulationstep)};qa.tick1=function(a){for(var b=a,c=0;0<a&&c<
.999*a||0>a&&c>.999*a;)b=qa.oneRKStep(b),c+=b,b=Math.min(2*b,a-c),b=Math.max(b,1E-16),qa.restorePosition(),qa.doCollisions(),qa.calculateForces(),qa.moveToFinalPos();return!0};qa.restorePosition=function(){za.forEach(function(a){M[a.type].restorePos(a,9)})};qa.doCollisions=function(){za.forEach(function(a){M[a.type].doCollisions(a)})};qa.calculateForces=function(){za.forEach(function(a){M[a.type].calculateForces(a)})};qa.moveToFinalPos=function(){za.forEach(function(a){M[a.type].move(a)})};qa.oneRKStep=
function(a){for(var b=function(a){za.forEach(function(b){M[b.type].initRK(b,a);M[b.type].storePosition(b)})},c=function(a){za.forEach(function(b){M[b.type].setToTimestep(b,Hb[a])})},d=function(a){za.forEach(function(b){M[b.type].proceedMotion(b,Hb[a],a,Kd[a])})},e=function(){za.forEach(function(a){M[a.type].resetForces(a)})},f=function(a){za.forEach(function(b){M[b.type].calculateDelta(b,a)})},g=function(b){var c=0;za.forEach(function(a){M[a.type].proceedMotion(a,Hb[6],7,Ld);M[a.type].savePos(a,8);
M[a.type].proceedMotion(a,Hb[6],7,Md);M[a.type].savePos(a,9);c+=M[a.type].sqDist(a,8,9)});return c=Math.sqrt(c)/a},k=function(a){za.forEach(function(a){M[a.type].recallPosition(a)})},l=!1;!l;){b(a);for(var m=0;7>m;m++)c(m),d(m),e(),qa.calculateForces(),f(m);g(a)>M.env.errorbound&&a>M.env.lowestdeltat?(a/=M.env.slowdownfactor,k()):l=!0}return a};var M={Mass:{reset:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.mass&&(a.mass=1);"undefined"===typeof a.charge&&(a.charge=0);
"undefined"===typeof a.friction&&(a.friction=0);a.lnfrict=0;"undefined"===typeof a.limitspeed&&(a.limitspeed=!1);"undefined"===typeof a.fixed&&(a.fixed=!1);"undefined"===typeof a.radius&&(a.radius=1);a.internalmove=!1;a.fx=0;a.fy=0;a.fz=0;a.vx=a.vx||0;a.vy=a.vy||0;a.vz=a.vz||0;a.mtype=0;a.env=M.env;a.deltat=0;a.mx=0;a.my=0;a.mz=0;a.mvx=0;a.mvy=0;a.mvz=0;a.dx=[0,0,0,0,0,0,0,0,0,0];a.dy=[0,0,0,0,0,0,0,0,0,0];a.dz=[0,0,0,0,0,0,0,0,0,0];a.dvx=[0,0,0,0,0,0,0,0,0,0];a.dvy=[0,0,0,0,0,0,0,0,0,0];a.dvz=[0,
0,0,0,0,0,0,0,0,0];a.midx=0;a.midy=0;a.midz=0;a.lx=0;a.ly=0;a.lz=0},resetForces:function(a){a.fx=0;a.fy=0;a.fz=0},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){var c=E.extractPoint(a.el.homog);a.x=c.x;a.y=c.y;a.z=0;a.xo=a.x;a.yo=a.y;a.zo=a.z;a.vxo=a.vx;a.vyo=a.vy;a.vzo=a.vz;a.deltat=b;a.fx=0;a.fy=0;a.fz=0},setVelocity:function(a,b,c,d){d||(d=0);a.vx=b;a.vy=c;a.vz=d},move:function(a){a.pos=[a.x,a.y,1];a.internalmove=!0;da&&W.down&&a.el===da.mover||Ca(a.el,g.realVector(a.pos),"homog");
a.el.sx=a.x;a.el.sy=a.y;a.internalmove=!1},proceedMotion:function(a,b,c,d){if(!a.fixed)for(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz,b=0;b<c;b++)a.x+=d[b]*a.dx[b]*a.deltat,a.y+=d[b]*a.dy[b]*a.deltat,a.z+=d[b]*a.dz[b]*a.deltat,a.vx+=d[b]*a.dvx[b]*a.deltat,a.vy+=d[b]*a.dvy[b]*a.deltat,a.vz+=d[b]*a.dvz[b]*a.deltat},calculateForces:function(a){var b=Math.sqrt(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz);a.lnfrict=-Math.log((1-a.friction)*(1-a.env.friction)*(.1<b&&a.limitSpeed?.1/b:1));a.fx+=-a.vx*
a.lnfrict*a.mass;a.fy+=-a.vy*a.lnfrict*a.mass;a.fz+=-a.vz*a.lnfrict*a.mass},calculateDelta:function(a,b){a.dx[b]=a.vx;a.dy[b]=a.vy;a.dz[b]=a.vz;a.dvx[b]=a.fx/a.mass;a.dvy[b]=a.fy/a.mass;a.dvz[b]=a.fz/a.mass},savePos:function(a,b){a.dx[b]=a.x;a.dy[b]=a.y;a.dz[b]=a.z;a.dvx[b]=a.vx;a.dvy[b]=a.vy;a.dvz[b]=a.vz},restorePos:function(a,b){a.fixed||(a.x=a.dx[b],a.y=a.dy[b],a.z=a.dz[b],a.vx=a.dvx[b],a.vy=a.dvy[b],a.vz=a.dvz[b])},sqDist:function(a,b,c){var d=(a.dx[b]-a.dx[c])*(a.dx[b]-a.dx[c]),d=d+(a.dy[b]-
a.dy[c])*(a.dy[b]-a.dy[c]),d=d+(a.dz[b]-a.dz[c])*(a.dz[b]-a.dz[c]),d=d+(a.dvx[b]-a.dvx[c])*(a.dvx[b]-a.dvx[c]),d=d+(a.dvy[b]-a.dvy[c])*(a.dvy[b]-a.dvy[c]);return d+=(a.dvz[b]-a.dvz[c])*(a.dvz[b]-a.dvz[c])},kineticEnergy:function(a){return.5*a.mass*(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz)},storePosition:function(a){a.mx=a.x;a.my=a.y;a.mz=a.z;a.mvx=a.vx;a.mvy=a.vy;a.mvz=a.vz},recallPosition:function(a){a.fixed||(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz)},doCollisions:function(a){}},Sun:{reset:function(a,
b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.mass&&(a.mass=10);"undefined"===typeof a.friction&&(a.friction=0);a.charge=0;a.x=0;a.y=0;a.z=0},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){var c=E.extractPoint(a.el.homog);a.x=c.x;a.y=c.y;a.z=0},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateDelta:function(a,b){},calculateForces:function(a){for(var b=a.x,c=a.y,d=a.z,e=0;e<ea.length;e++){var f=
ea[e],g=f.behavior.x,k=f.behavior.y,l=f.behavior.z,m=Math.sqrt((b-g)*(b-g)+(c-k)*(c-k)+(d-l)*(d-l)),k=(c-k)*a.mass*f.behavior.mass/(m*m*m),l=(d-l)*a.mass*f.behavior.mass/(m*m*m);f.behavior.fx+=(b-g)*a.mass*f.behavior.mass/(m*m*m)*f.behavior.mass;f.behavior.fy+=k*f.behavior.mass;f.behavior.fz+=l*f.behavior.mass}},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},
Velocity:{reset:function(a){var b=v.csnames[a.geo[1]];console.log(b);var c=E.extractPoint(b.homog);a=E.extractPoint(v.csnames[a.geo[2]].homog);b=b.behavior;M[b.type].setVelocity(b,a.x-c.x,a.y-c.y,0)},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){var b=v.csnames[a.geo[2]];if(!da||!W.down||b!==da.mover){var c=v.csnames[a.geo[1]];a=E.extractPoint(c.homog);c=c.behavior;a=g.realVector([a.x+c.vx,a.y+c.vy,1]);
Ca(b,a,"homog")}},proceedMotion:function(a,b,c,d){},calculateForces:function(a){},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},Gravity:{reset:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.strength&&(a.strength=1);a.namea=b.args[0];a.nameb=b.args[1];a.ma=v.csnames[a.namea];a.mb=v.csnames[a.nameb]},
resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateDelta:function(a,b){},calculateForces:function(a){var b=E.extractPoint(a.ma.homog),c=E.extractPoint(a.mb.homog),d=(c.x-b.x)*a.strength;a=(c.y-b.y)*a.strength;for(b=0;b<ea.length;b++)c=ea[b],c.behavior.fx+=d*c.behavior.mass,c.behavior.fy+=a*c.behavior.mass,c.behavior.fz+=0*c.behavior.mass},savePos:function(a,b){},
restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},Spring:{reset:function(a,b){a.el=b;"undefined"===typeof a.strength&&(a.strength=1);"undefined"===typeof a.amplitude&&(a.amplitude=0);"undefined"===typeof a.phase&&(a.phase=0);"undefined"===typeof a.speed&&(a.speed=1);"undefined"===typeof a.l0&&(a.l0=0);"undefined"===typeof a.stype&&(a.stype=1);"undefined"===typeof a.readOnInit&&
(a.readOnInit=!1);a.namea=b.args[0];a.nameb=b.args[1];a.ma=v.csnames[a.namea];a.mb=v.csnames[a.nameb];var c=E.extractPoint(a.ma.homog),d=E.extractPoint(a.mb.homog);a.l0=Math.sqrt((c.x-d.x)*(c.x-d.x)+(c.y-d.y)*(c.y-d.y));a.env=M.env},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateForces:function(a){var b,c,d,e;!a.ma.behavior||da&&W.down&&a.ma===da.mover?(c=E.extractPoint(a.ma.homog),
b=c.x,d=c.y):(b=a.ma.behavior.x,d=a.ma.behavior.y);!a.mb.behavior||da&&W.down&&a.mb===da.mover?(e=E.extractPoint(a.mb.homog),c=e.x,e=e.y):(c=a.mb.behavior.x,e=a.mb.behavior.y);var f=Math.sqrt((b-c)*(b-c)+(d-e)*(d-e)),g=a.l0,k=a.stype;1===k&&(g=0);var l=0;if(2===k||3===k)l=a.ma.behavior.mass*a.mb.behavior.mass*a.strength;2===k&&(l=-l);var m,n;if(0===f||0!==k&&1!==k)if(a.ma.behavior&&a.mb.behavior&&0!==f){if(f*=f*f,2===k||3===k)m=(b-c)*l/f,n=(d-e)*l/f}else m=n=0;else m=-(b-c)*a.strength*(f-g)/f*a.env.springstrength,
n=-(d-e)*a.strength*(f-g)/f*a.env.springstrength;a.ma.behavior&&(a.ma.behavior.fx+=m,a.ma.behavior.fy+=n);a.mb.behavior&&(a.mb.behavior.fx-=m,a.mb.behavior.fy-=n)},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},det:function(a,b,c,d,e,f){return c*f-e*d+e*b-a*f+a*d-c*b},Bouncer:{reset:function(a,b){a.el=b;"undefined"===typeof a.xdamp&&
(a.xdamp=0);"undefined"===typeof a.ydamp&&(a.ydamp=0);"undefined"===typeof a.motorchanger&&(a.motorchanger=!0);a.namea=b.args[0];a.nameb=b.args[1];a.ma=v.csnames[a.namea];a.mb=v.csnames[a.nameb];var c=E.extractPoint(a.ma.homog),d=E.extractPoint(a.mb.homog);a.x1o=1.01*c.x-.01*d.x;a.y1o=1.01*c.y-.01*d.y;a.x2o=1.01*d.x-.01*c.x;a.y2o=1.01*d.y-.01*c.y;a.env=M.env},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){a.deltat=b},setVelocity:function(a,b,c,d){},move:function(a){},
proceedMotion:function(a,b,c,d){},calculateForces:function(a){},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){for(var b=E.extractPoint(a.ma.homog),c=E.extractPoint(a.mb.homog),d=b.x,b=b.y,e=c.x,c=c.y,f=a.x1o,g=a.y1o,k=a.x2o,m=a.y2o,n=Math.sqrt((d-e)*(d-e)+(b-c)*(b-c)),p=(d-e)/n,n=(b-c)/n,r=0;r<ea.length;r++){var t=ea[r],
u=t.behavior.xo,v=t.behavior.yo,w=t.behavior.x,x=t.behavior.y,y=l.mult(l.complex(f,g),l.complex(e,c)),z=l.mult(l.complex(k,m),l.complex(d,b)),y=l.sub(y,z),z=l.mult(l.complex(u,v),l.complex(d,b)),y=l.add(y,z),z=l.mult(l.complex(u,v),l.complex(e,c)),y=l.sub(y,z),z=l.sub(l.complex(f,g),l.complex(k,m)),y=l.div(y,z);0>M.det(d,b,e,c,w,x)*M.det(d,b,e,c,y.value.real,y.value.imag)&&0>M.det(d,b,w,x,y.value.real,y.value.imag)*M.det(e,c,w,x,y.value.real,y.value.imag)&&(v=t.behavior.mvx+a.deltat*(-y.value.real+
t.behavior.xo),w=t.behavior.mvy+a.deltat*(-y.value.imag+t.behavior.yo),u=p*v+n*w,v=n*v-p*w,t.behavior.x=y.value.real,t.behavior.y=y.value.imag,t.behavior.vx=p*u*(1-a.xdamp),t.behavior.vy=n*u*(1-a.xdamp),t.behavior.vx+=-n*v*(1-a.ydamp),t.behavior.vy+=p*v*(1-a.ydamp))}a.x1o=d;a.y1o=b;a.x2o=e;a.y2o=c}},Environment:{init:function(a){"undefined"===typeof a.gravity&&(a.gravity=0);"undefined"===typeof a.friction&&(a.friction=0);"undefined"===typeof a.springstrength&&(a.springstrength=1);"undefined"!==typeof a.accuracy&&
(Lb=a.accuracy);"undefined"!==typeof a.deltat&&ka(a.deltat/.6);"undefined"===typeof a.charges&&(a.charges=!1);"undefined"===typeof a.balls&&(a.balls=!1);"undefined"===typeof a.newton&&(a.newton=!1);"undefined"===typeof a.ballInteractionBoosting&&(a.ballInteractionBoosting=1);M.env=a;a.errorbound=.001;a.lowestdeltat=1E-7;a.slowdownfactor=2},reset:function(a){},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},
proceedMotion:function(a,b,c,d){},calculateForces:function(a){var b,c,d,e,f,g,k,l,m,n;if(a.newton)for(b=0;b<ea.length-1;b++)for(c=ea[b],d=c.behavior.x,e=c.behavior.y,f=b+1;f<ea.length;f++)g=ea[f],k=g.behavior.x,l=g.behavior.y,n=Math.sqrt((d-k)*(d-k)+(e-l)*(e-l)),k=(d-k)*c.behavior.mass*g.behavior.mass/(n*n*n),l=(e-l)*c.behavior.mass*g.behavior.mass/(n*n*n),c.behavior.fx-=k,c.behavior.fy-=l,g.behavior.fx+=k,g.behavior.fy+=l;if(a.charges)for(b=0;b<ea.length-1;b++)for(c=ea[b],d=c.behavior.x,e=c.behavior.y,
f=b+1;f<ea.length;f++)g=ea[f],k=g.behavior.x,l=g.behavior.y,n=Math.sqrt((d-k)*(d-k)+(e-l)*(e-l)),k=(d-k)*c.behavior.charge*g.behavior.charge/(n*n*n),l=(e-l)*c.behavior.charge*g.behavior.charge/(n*n*n),c.behavior.fx+=k,c.behavior.fy+=l,g.behavior.fx-=k,g.behavior.fy-=l;if(a.balls)for(b=0;b<ea.length-1;b++)if(c=ea[b],0!==c.behavior.radius)for(d=c.behavior.x,e=c.behavior.y,f=b+1;f<ea.length;f++)g=ea[f],0!==g.behavior.radius&&(k=g.behavior.x,l=g.behavior.y,m=c.behavior.radius+g.behavior.radius,n=Math.sqrt((d-
k)*(d-k)+(e-l)*(e-l)),0===a.ballInteractionBoosting?(k=(d-k)/(n*n*n)*(n>m?0:(n-m)*(n-m)),l=(e-l)/(n*n*n)*(n>m?0:(n-m)*(n-m))):1===a.ballInteractionBoosting?(k=(d-k)/(n*n*n*n)*(n>m?0:(n-m)*(n-m)),l=(e-l)/(n*n*n*n)*(n>m?0:(n-m)*(n-m))):(k=(d-k)/(n*n*n*n*n)*(n>m?0:(n-m)*(n-m)),l=(e-l)/(n*n*n*n*n)*(n>m?0:(n-m)*(n-m))),c.behavior.fx+=k,c.behavior.fy+=l,g.behavior.fx-=k,g.behavior.fy-=l);for(b=0;b<ea.length;b++)c=ea[b],c.behavior.fx+=0,c.behavior.fy+=-a.gravity*c.behavior.mass,c.behavior.fz+=0},calculateDelta:function(a,
b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}}};return oa};return G}(),createCindy=CindyJS;"undefined"!==typeof process&&"undefined"!==typeof module&&"undefined"!==typeof module.exports&&"undefined"===typeof window&&(module.exports=CindyJS);
//# sourceMappingURL=Cindy.js.map

