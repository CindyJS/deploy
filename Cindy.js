/* CindyJS - (C) 2014-2015  The CindyJS Project
 * Mostly licensed under the Apache License 2.0, but subprojects may use different licensing.
 * See https://github.com/CindyJS/CindyJS/tree/9ee49974a795a4aa5fa1bb9cee6895c669818e6b
 * for corresponding sources and their respective licensing conditions.
 */
(function(){function q(b,d,e){g.biginteger_used=1;null!=b&&("number"==typeof b&&"undefined"==typeof d?this.fromInt(b):"number"==typeof b?this.fromNumber(b,d,e):null==d&&"string"!=typeof b?this.fromString(b,256):this.fromString(b,d))}function E(){return new q(null)}function ja(b,d,e,h,g,u){for(;0<=--u;){var m=d*this[b++]+e[h]+g;g=Math.floor(m/67108864);e[h++]=m&67108863}return g}function Ha(b,d,e,h,g,u){var m=d&32767;for(d>>=15;0<=--u;){var n=this[b]&32767,x=this[b++]>>15,q=d*n+x*m,n=m*n+((q&32767)<<
15)+e[h]+(g&1073741823);g=(n>>>30)+(q>>>15)+d*x+(g>>>30);e[h++]=n&1073741823}return g}function za(b,d,e,h,g,u){var m=d&16383;for(d>>=14;0<=--u;){var n=this[b]&16383,x=this[b++]>>14,q=d*n+x*m,n=m*n+((q&16383)<<14)+e[h]+g;g=(n>>28)+(q>>14)+d*x;e[h++]=n&268435455}return g}function Da(b,d){var e=Ia[b.charCodeAt(d)];return null==e?-1:e}function ga(b){var d=E();d.fromInt(b);return d}function m(b){var d=1,e;0!=(e=b>>>16)&&(b=e,d+=16);0!=(e=b>>8)&&(b=e,d+=8);0!=(e=b>>4)&&(b=e,d+=4);0!=(e=b>>2)&&(b=e,d+=2);
0!=b>>1&&(d+=1);return d}function F(b){this.m=b}function Y(b){this.m=b;this.mp=b.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<b.DB-15)-1;this.mt2=2*b.t}function n(b,d){return b&d}function I(b,d){return b|d}function L(b,d){return b^d}function Z(b,d){return b&~d}function eb(){}function bc(b){return b}function ab(b){this.r2=E();this.q3=E();q.ONE.dlShiftTo(2*b.t,this.r2);this.mu=this.r2.divide(b);this.m=b}var g={},nb=!1;"undefined"!==typeof module&&module.exports?(module.exports=
g,nb=!0):"undefined"!==typeof document?window.ClipperLib=g:self.ClipperLib=g;var Q;if(nb)R="chrome",Q="Netscape";else{var R=navigator.userAgent.toString().toLowerCase();Q=navigator.appName}var Ja,bb,Ua,Aa,Ka,cc;Ja=-1!=R.indexOf("chrome")&&-1==R.indexOf("chromium")?1:0;nb=-1!=R.indexOf("chromium")?1:0;bb=-1!=R.indexOf("safari")&&-1==R.indexOf("chrome")&&-1==R.indexOf("chromium")?1:0;Ua=-1!=R.indexOf("firefox")?1:0;R.indexOf("firefox/17");R.indexOf("firefox/15");R.indexOf("firefox/3");Aa=-1!=R.indexOf("opera")?
1:0;R.indexOf("msie 10");R.indexOf("msie 9");Ka=-1!=R.indexOf("msie 8")?1:0;cc=-1!=R.indexOf("msie 7")?1:0;R=-1!=R.indexOf("msie ")?1:0;g.biginteger_used=null;"Microsoft Internet Explorer"==Q?(q.prototype.am=Ha,Q=30):"Netscape"!=Q?(q.prototype.am=ja,Q=26):(q.prototype.am=za,Q=28);q.prototype.DB=Q;q.prototype.DM=(1<<Q)-1;q.prototype.DV=1<<Q;q.prototype.FV=Math.pow(2,52);q.prototype.F1=52-Q;q.prototype.F2=2*Q-52;var Ia=[],da;Q=48;for(da=0;9>=da;++da)Ia[Q++]=da;Q=97;for(da=10;36>da;++da)Ia[Q++]=da;Q=
65;for(da=10;36>da;++da)Ia[Q++]=da;F.prototype.convert=function(b){return 0>b.s||0<=b.compareTo(this.m)?b.mod(this.m):b};F.prototype.revert=function(b){return b};F.prototype.reduce=function(b){b.divRemTo(this.m,null,b)};F.prototype.mulTo=function(b,d,e){b.multiplyTo(d,e);this.reduce(e)};F.prototype.sqrTo=function(b,d){b.squareTo(d);this.reduce(d)};Y.prototype.convert=function(b){var d=E();b.abs().dlShiftTo(this.m.t,d);d.divRemTo(this.m,null,d);0>b.s&&0<d.compareTo(q.ZERO)&&this.m.subTo(d,d);return d};
Y.prototype.revert=function(b){var d=E();b.copyTo(d);this.reduce(d);return d};Y.prototype.reduce=function(b){for(;b.t<=this.mt2;)b[b.t++]=0;for(var d=0;d<this.m.t;++d){var e=b[d]&32767,h=e*this.mpl+((e*this.mph+(b[d]>>15)*this.mpl&this.um)<<15)&b.DM,e=d+this.m.t;for(b[e]+=this.m.am(0,h,b,d,0,this.m.t);b[e]>=b.DV;)b[e]-=b.DV,b[++e]++}b.clamp();b.drShiftTo(this.m.t,b);0<=b.compareTo(this.m)&&b.subTo(this.m,b)};Y.prototype.mulTo=function(b,d,e){b.multiplyTo(d,e);this.reduce(e)};Y.prototype.sqrTo=function(b,
d){b.squareTo(d);this.reduce(d)};q.prototype.copyTo=function(b){for(var d=this.t-1;0<=d;--d)b[d]=this[d];b.t=this.t;b.s=this.s};q.prototype.fromInt=function(b){this.t=1;this.s=0>b?-1:0;0<b?this[0]=b:-1>b?this[0]=b+this.DV:this.t=0};q.prototype.fromString=function(b,d){var e;if(16==d)e=4;else if(8==d)e=3;else if(256==d)e=8;else if(2==d)e=1;else if(32==d)e=5;else if(4==d)e=2;else{this.fromRadix(b,d);return}this.s=this.t=0;for(var h=b.length,g=!1,u=0;0<=--h;){var m=8==e?b[h]&255:Da(b,h);0>m?"-"==b.charAt(h)&&
(g=!0):(g=!1,0==u?this[this.t++]=m:u+e>this.DB?(this[this.t-1]|=(m&(1<<this.DB-u)-1)<<u,this[this.t++]=m>>this.DB-u):this[this.t-1]|=m<<u,u+=e,u>=this.DB&&(u-=this.DB))}8==e&&0!=(b[0]&128)&&(this.s=-1,0<u&&(this[this.t-1]|=(1<<this.DB-u)-1<<u));this.clamp();g&&q.ZERO.subTo(this,this)};q.prototype.clamp=function(){for(var b=this.s&this.DM;0<this.t&&this[this.t-1]==b;)--this.t};q.prototype.dlShiftTo=function(b,d){var e;for(e=this.t-1;0<=e;--e)d[e+b]=this[e];for(e=b-1;0<=e;--e)d[e]=0;d.t=this.t+b;d.s=
this.s};q.prototype.drShiftTo=function(b,d){for(var e=b;e<this.t;++e)d[e-b]=this[e];d.t=Math.max(this.t-b,0);d.s=this.s};q.prototype.lShiftTo=function(b,d){var e=b%this.DB,h=this.DB-e,g=(1<<h)-1,u=Math.floor(b/this.DB),m=this.s<<e&this.DM,n;for(n=this.t-1;0<=n;--n)d[n+u+1]=this[n]>>h|m,m=(this[n]&g)<<e;for(n=u-1;0<=n;--n)d[n]=0;d[u]=m;d.t=this.t+u+1;d.s=this.s;d.clamp()};q.prototype.rShiftTo=function(b,d){d.s=this.s;var e=Math.floor(b/this.DB);if(e>=this.t)d.t=0;else{var h=b%this.DB,g=this.DB-h,u=
(1<<h)-1;d[0]=this[e]>>h;for(var m=e+1;m<this.t;++m)d[m-e-1]|=(this[m]&u)<<g,d[m-e]=this[m]>>h;0<h&&(d[this.t-e-1]|=(this.s&u)<<g);d.t=this.t-e;d.clamp()}};q.prototype.subTo=function(b,d){for(var e=0,h=0,g=Math.min(b.t,this.t);e<g;)h+=this[e]-b[e],d[e++]=h&this.DM,h>>=this.DB;if(b.t<this.t){for(h-=b.s;e<this.t;)h+=this[e],d[e++]=h&this.DM,h>>=this.DB;h+=this.s}else{for(h+=this.s;e<b.t;)h-=b[e],d[e++]=h&this.DM,h>>=this.DB;h-=b.s}d.s=0>h?-1:0;-1>h?d[e++]=this.DV+h:0<h&&(d[e++]=h);d.t=e;d.clamp()};
q.prototype.multiplyTo=function(b,d){var e=this.abs(),h=b.abs(),g=e.t;for(d.t=g+h.t;0<=--g;)d[g]=0;for(g=0;g<h.t;++g)d[g+e.t]=e.am(0,h[g],d,g,0,e.t);d.s=0;d.clamp();this.s!=b.s&&q.ZERO.subTo(d,d)};q.prototype.squareTo=function(b){for(var d=this.abs(),e=b.t=2*d.t;0<=--e;)b[e]=0;for(e=0;e<d.t-1;++e){var h=d.am(e,d[e],b,2*e,0,1);(b[e+d.t]+=d.am(e+1,2*d[e],b,2*e+1,h,d.t-e-1))>=d.DV&&(b[e+d.t]-=d.DV,b[e+d.t+1]=1)}0<b.t&&(b[b.t-1]+=d.am(e,d[e],b,2*e,0,1));b.s=0;b.clamp()};q.prototype.divRemTo=function(b,
d,e){var h=b.abs();if(!(0>=h.t)){var g=this.abs();if(g.t<h.t)null!=d&&d.fromInt(0),null!=e&&this.copyTo(e);else{null==e&&(e=E());var u=E(),Ta=this.s;b=b.s;var n=this.DB-m(h[h.t-1]);0<n?(h.lShiftTo(n,u),g.lShiftTo(n,e)):(h.copyTo(u),g.copyTo(e));h=u.t;g=u[h-1];if(0!=g){var x=g*(1<<this.F1)+(1<h?u[h-2]>>this.F2:0),F=this.FV/x,x=(1<<this.F1)/x,H=1<<this.F2,aa=e.t,Y=aa-h,I=null==d?E():d;u.dlShiftTo(Y,I);0<=e.compareTo(I)&&(e[e.t++]=1,e.subTo(I,e));q.ONE.dlShiftTo(h,I);for(I.subTo(u,u);u.t<h;)u[u.t++]=
0;for(;0<=--Y;){var L=e[--aa]==g?this.DM:Math.floor(e[aa]*F+(e[aa-1]+H)*x);if((e[aa]+=u.am(0,L,e,Y,0,h))<L)for(u.dlShiftTo(Y,I),e.subTo(I,e);e[aa]<--L;)e.subTo(I,e)}null!=d&&(e.drShiftTo(h,d),Ta!=b&&q.ZERO.subTo(d,d));e.t=h;e.clamp();0<n&&e.rShiftTo(n,e);0>Ta&&q.ZERO.subTo(e,e)}}}};q.prototype.invDigit=function(){if(1>this.t)return 0;var b=this[0];if(0==(b&1))return 0;var d=b&3,d=d*(2-(b&15)*d)&15,d=d*(2-(b&255)*d)&255,d=d*(2-((b&65535)*d&65535))&65535,d=d*(2-b*d%this.DV)%this.DV;return 0<d?this.DV-
d:-d};q.prototype.isEven=function(){return 0==(0<this.t?this[0]&1:this.s)};q.prototype.exp=function(b,d){if(4294967295<b||1>b)return q.ONE;var e=E(),h=E(),g=d.convert(this),u=m(b)-1;for(g.copyTo(e);0<=--u;)if(d.sqrTo(e,h),0<(b&1<<u))d.mulTo(h,g,e);else var Ta=e,e=h,h=Ta;return d.revert(e)};q.prototype.toString=function(b){if(0>this.s)return"-"+this.negate().toString(b);if(16==b)b=4;else if(8==b)b=3;else if(2==b)b=1;else if(32==b)b=5;else if(4==b)b=2;else return this.toRadix(b);var d=(1<<b)-1,e,h=
!1,g="",u=this.t,m=this.DB-u*this.DB%b;if(0<u--)for(m<this.DB&&0<(e=this[u]>>m)&&(h=!0,g="0123456789abcdefghijklmnopqrstuvwxyz".charAt(e));0<=u;)m<b?(e=(this[u]&(1<<m)-1)<<b-m,e|=this[--u]>>(m+=this.DB-b)):(e=this[u]>>(m-=b)&d,0>=m&&(m+=this.DB,--u)),0<e&&(h=!0),h&&(g+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(e));return h?g:"0"};q.prototype.negate=function(){var b=E();q.ZERO.subTo(this,b);return b};q.prototype.abs=function(){return 0>this.s?this.negate():this};q.prototype.compareTo=function(b){var d=
this.s-b.s;if(0!=d)return d;var e=this.t,d=e-b.t;if(0!=d)return 0>this.s?-d:d;for(;0<=--e;)if(0!=(d=this[e]-b[e]))return d;return 0};q.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+m(this[this.t-1]^this.s&this.DM)};q.prototype.mod=function(b){var d=E();this.abs().divRemTo(b,null,d);0>this.s&&0<d.compareTo(q.ZERO)&&b.subTo(d,d);return d};q.prototype.modPowInt=function(b,d){var e;e=256>b||d.isEven()?new F(d):new Y(d);return this.exp(b,e)};q.ZERO=ga(0);q.ONE=ga(1);eb.prototype.convert=
bc;eb.prototype.revert=bc;eb.prototype.mulTo=function(b,d,e){b.multiplyTo(d,e)};eb.prototype.sqrTo=function(b,d){b.squareTo(d)};ab.prototype.convert=function(b){if(0>b.s||b.t>2*this.m.t)return b.mod(this.m);if(0>b.compareTo(this.m))return b;var d=E();b.copyTo(d);this.reduce(d);return d};ab.prototype.revert=function(b){return b};ab.prototype.reduce=function(b){b.drShiftTo(this.m.t-1,this.r2);b.t>this.m.t+1&&(b.t=this.m.t+1,b.clamp());this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);for(this.m.multiplyLowerTo(this.q3,
this.m.t+1,this.r2);0>b.compareTo(this.r2);)b.dAddOffset(1,this.m.t+1);for(b.subTo(this.r2,b);0<=b.compareTo(this.m);)b.subTo(this.m,b)};ab.prototype.mulTo=function(b,d,e){b.multiplyTo(d,e);this.reduce(e)};ab.prototype.sqrTo=function(b,d){b.squareTo(d);this.reduce(d)};var T=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,
313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],ha=67108864/T[T.length-1];q.prototype.chunkSize=function(b){return Math.floor(Math.LN2*
this.DB/Math.log(b))};q.prototype.toRadix=function(b){null==b&&(b=10);if(0==this.signum()||2>b||36<b)return"0";var d=this.chunkSize(b),d=Math.pow(b,d),e=ga(d),h=E(),g=E(),u="";for(this.divRemTo(e,h,g);0<h.signum();)u=(d+g.intValue()).toString(b).substr(1)+u,h.divRemTo(e,h,g);return g.intValue().toString(b)+u};q.prototype.fromRadix=function(b,d){this.fromInt(0);null==d&&(d=10);for(var e=this.chunkSize(d),h=Math.pow(d,e),g=!1,u=0,m=0,n=0;n<b.length;++n){var x=Da(b,n);0>x?"-"==b.charAt(n)&&0==this.signum()&&
(g=!0):(m=d*m+x,++u>=e&&(this.dMultiply(h),this.dAddOffset(m,0),m=u=0))}0<u&&(this.dMultiply(Math.pow(d,u)),this.dAddOffset(m,0));g&&q.ZERO.subTo(this,this)};q.prototype.fromNumber=function(b,d,e){if("number"==typeof d)if(2>b)this.fromInt(1);else for(this.fromNumber(b,e),this.testBit(b-1)||this.bitwiseTo(q.ONE.shiftLeft(b-1),I,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(d);)this.dAddOffset(2,0),this.bitLength()>b&&this.subTo(q.ONE.shiftLeft(b-1),this);else{e=[];var h=b&7;e.length=
(b>>3)+1;d.nextBytes(e);e[0]=0<h?e[0]&(1<<h)-1:0;this.fromString(e,256)}};q.prototype.bitwiseTo=function(b,d,e){var h,g,u=Math.min(b.t,this.t);for(h=0;h<u;++h)e[h]=d(this[h],b[h]);if(b.t<this.t){g=b.s&this.DM;for(h=u;h<this.t;++h)e[h]=d(this[h],g);e.t=this.t}else{g=this.s&this.DM;for(h=u;h<b.t;++h)e[h]=d(g,b[h]);e.t=b.t}e.s=d(this.s,b.s);e.clamp()};q.prototype.changeBit=function(b,d){var e=q.ONE.shiftLeft(b);this.bitwiseTo(e,d,e);return e};q.prototype.addTo=function(b,d){for(var e=0,h=0,g=Math.min(b.t,
this.t);e<g;)h+=this[e]+b[e],d[e++]=h&this.DM,h>>=this.DB;if(b.t<this.t){for(h+=b.s;e<this.t;)h+=this[e],d[e++]=h&this.DM,h>>=this.DB;h+=this.s}else{for(h+=this.s;e<b.t;)h+=b[e],d[e++]=h&this.DM,h>>=this.DB;h+=b.s}d.s=0>h?-1:0;0<h?d[e++]=h:-1>h&&(d[e++]=this.DV+h);d.t=e;d.clamp()};q.prototype.dMultiply=function(b){this[this.t]=this.am(0,b-1,this,0,0,this.t);++this.t;this.clamp()};q.prototype.dAddOffset=function(b,d){if(0!=b){for(;this.t<=d;)this[this.t++]=0;for(this[d]+=b;this[d]>=this.DV;)this[d]-=
this.DV,++d>=this.t&&(this[this.t++]=0),++this[d]}};q.prototype.multiplyLowerTo=function(b,d,e){var h=Math.min(this.t+b.t,d);e.s=0;for(e.t=h;0<h;)e[--h]=0;var g;for(g=e.t-this.t;h<g;++h)e[h+this.t]=this.am(0,b[h],e,h,0,this.t);for(g=Math.min(b.t,d);h<g;++h)this.am(0,b[h],e,h,0,d-h);e.clamp()};q.prototype.multiplyUpperTo=function(b,d,e){--d;var h=e.t=this.t+b.t-d;for(e.s=0;0<=--h;)e[h]=0;for(h=Math.max(d-this.t,0);h<b.t;++h)e[this.t+h-d]=this.am(d-h,b[h],e,0,0,this.t+h-d);e.clamp();e.drShiftTo(1,e)};
q.prototype.modInt=function(b){if(0>=b)return 0;var d=this.DV%b,e=0>this.s?b-1:0;if(0<this.t)if(0==d)e=this[0]%b;else for(var h=this.t-1;0<=h;--h)e=(d*e+this[h])%b;return e};q.prototype.millerRabin=function(b){var d=this.subtract(q.ONE),e=d.getLowestSetBit();if(0>=e)return!1;var h=d.shiftRight(e);b=b+1>>1;b>T.length&&(b=T.length);for(var g=E(),u=0;u<b;++u){g.fromInt(T[Math.floor(Math.random()*T.length)]);var m=g.modPow(h,this);if(0!=m.compareTo(q.ONE)&&0!=m.compareTo(d)){for(var n=1;n++<e&&0!=m.compareTo(d);)if(m=
m.modPowInt(2,this),0==m.compareTo(q.ONE))return!1;if(0!=m.compareTo(d))return!1}}return!0};q.prototype.clone=function(){var b=E();this.copyTo(b);return b};q.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]};q.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24};q.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<
16>>16};q.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this[0]?0:1};q.prototype.toByteArray=function(){var b=this.t,d=[];d[0]=this.s;var e=this.DB-b*this.DB%8,h,g=0;if(0<b--)for(e<this.DB&&(h=this[b]>>e)!=(this.s&this.DM)>>e&&(d[g++]=h|this.s<<this.DB-e);0<=b;)if(8>e?(h=(this[b]&(1<<e)-1)<<8-e,h|=this[--b]>>(e+=this.DB-8)):(h=this[b]>>(e-=8)&255,0>=e&&(e+=this.DB,--b)),0!=(h&128)&&(h|=-256),0==g&&(this.s&128)!=(h&128)&&++g,0<g||h!=this.s)d[g++]=h;return d};q.prototype.equals=
function(b){return 0==this.compareTo(b)};q.prototype.min=function(b){return 0>this.compareTo(b)?this:b};q.prototype.max=function(b){return 0<this.compareTo(b)?this:b};q.prototype.and=function(b){var d=E();this.bitwiseTo(b,n,d);return d};q.prototype.or=function(b){var d=E();this.bitwiseTo(b,I,d);return d};q.prototype.xor=function(b){var d=E();this.bitwiseTo(b,L,d);return d};q.prototype.andNot=function(b){var d=E();this.bitwiseTo(b,Z,d);return d};q.prototype.not=function(){for(var b=E(),d=0;d<this.t;++d)b[d]=
this.DM&~this[d];b.t=this.t;b.s=~this.s;return b};q.prototype.shiftLeft=function(b){var d=E();0>b?this.rShiftTo(-b,d):this.lShiftTo(b,d);return d};q.prototype.shiftRight=function(b){var d=E();0>b?this.lShiftTo(-b,d):this.rShiftTo(b,d);return d};q.prototype.getLowestSetBit=function(){for(var b=0;b<this.t;++b)if(0!=this[b]){var d=b*this.DB,b=this[b];if(0==b)b=-1;else{var e=0;0==(b&65535)&&(b>>=16,e+=16);0==(b&255)&&(b>>=8,e+=8);0==(b&15)&&(b>>=4,e+=4);0==(b&3)&&(b>>=2,e+=2);0==(b&1)&&++e;b=e}return d+
b}return 0>this.s?this.t*this.DB:-1};q.prototype.bitCount=function(){for(var b=0,d=this.s&this.DM,e=0;e<this.t;++e){for(var h=this[e]^d,g=0;0!=h;)h&=h-1,++g;b+=g}return b};q.prototype.testBit=function(b){var d=Math.floor(b/this.DB);return d>=this.t?0!=this.s:0!=(this[d]&1<<b%this.DB)};q.prototype.setBit=function(b){return this.changeBit(b,I)};q.prototype.clearBit=function(b){return this.changeBit(b,Z)};q.prototype.flipBit=function(b){return this.changeBit(b,L)};q.prototype.add=function(b){var d=E();
this.addTo(b,d);return d};q.prototype.subtract=function(b){var d=E();this.subTo(b,d);return d};q.prototype.multiply=function(b){var d=E();this.multiplyTo(b,d);return d};q.prototype.divide=function(b){var d=E();this.divRemTo(b,d,null);return d};q.prototype.remainder=function(b){var d=E();this.divRemTo(b,null,d);return d};q.prototype.divideAndRemainder=function(b){var d=E(),e=E();this.divRemTo(b,d,e);return[d,e]};q.prototype.modPow=function(b,d){var e=b.bitLength(),h,g=ga(1),u;if(0>=e)return g;h=18>
e?1:48>e?3:144>e?4:768>e?5:6;u=8>e?new F(d):d.isEven()?new ab(d):new Y(d);var n=[],q=3,x=h-1,$a=(1<<h)-1;n[1]=u.convert(this);if(1<h)for(e=E(),u.sqrTo(n[1],e);q<=$a;)n[q]=E(),u.mulTo(e,n[q-2],n[q]),q+=2;for(var H=b.t-1,aa,I=!0,L=E(),e=m(b[H])-1;0<=H;){e>=x?aa=b[H]>>e-x&$a:(aa=(b[H]&(1<<e+1)-1)<<x-e,0<H&&(aa|=b[H-1]>>this.DB+e-x));for(q=h;0==(aa&1);)aa>>=1,--q;0>(e-=q)&&(e+=this.DB,--H);if(I)n[aa].copyTo(g),I=!1;else{for(;1<q;)u.sqrTo(g,L),u.sqrTo(L,g),q-=2;0<q?u.sqrTo(g,L):(q=g,g=L,L=q);u.mulTo(L,
n[aa],g)}for(;0<=H&&0==(b[H]&1<<e);)u.sqrTo(g,L),q=g,g=L,L=q,0>--e&&(e=this.DB-1,--H)}return u.revert(g)};q.prototype.modInverse=function(b){var d=b.isEven();if(this.isEven()&&d||0==b.signum())return q.ZERO;for(var e=b.clone(),h=this.clone(),g=ga(1),u=ga(0),m=ga(0),n=ga(1);0!=e.signum();){for(;e.isEven();)e.rShiftTo(1,e),d?(g.isEven()&&u.isEven()||(g.addTo(this,g),u.subTo(b,u)),g.rShiftTo(1,g)):u.isEven()||u.subTo(b,u),u.rShiftTo(1,u);for(;h.isEven();)h.rShiftTo(1,h),d?(m.isEven()&&n.isEven()||(m.addTo(this,
m),n.subTo(b,n)),m.rShiftTo(1,m)):n.isEven()||n.subTo(b,n),n.rShiftTo(1,n);0<=e.compareTo(h)?(e.subTo(h,e),d&&g.subTo(m,g),u.subTo(n,u)):(h.subTo(e,h),d&&m.subTo(g,m),n.subTo(u,n))}if(0!=h.compareTo(q.ONE))return q.ZERO;if(0<=n.compareTo(b))return n.subtract(b);if(0>n.signum())n.addTo(b,n);else return n;return 0>n.signum()?n.add(b):n};q.prototype.pow=function(b){return this.exp(b,new eb)};q.prototype.gcd=function(b){var d=0>this.s?this.negate():this.clone();b=0>b.s?b.negate():b.clone();if(0>d.compareTo(b)){var e=
d,d=b;b=e}var e=d.getLowestSetBit(),h=b.getLowestSetBit();if(0>h)return d;e<h&&(h=e);for(0<h&&(d.rShiftTo(h,d),b.rShiftTo(h,b));0<d.signum();)0<(e=d.getLowestSetBit())&&d.rShiftTo(e,d),0<(e=b.getLowestSetBit())&&b.rShiftTo(e,b),0<=d.compareTo(b)?(d.subTo(b,d),d.rShiftTo(1,d)):(b.subTo(d,b),b.rShiftTo(1,b));0<h&&b.lShiftTo(h,b);return b};q.prototype.isProbablePrime=function(b){var d,e=this.abs();if(1==e.t&&e[0]<=T[T.length-1]){for(d=0;d<T.length;++d)if(e[0]==T[d])return!0;return!1}if(e.isEven())return!1;
for(d=1;d<T.length;){for(var h=T[d],g=d+1;g<T.length&&h<ha;)h*=T[g++];for(h=e.modInt(h);d<g;)if(0==h%T[d++])return!1}return e.millerRabin(b)};q.prototype.square=function(){var b=E();this.squareTo(b);return b};q.prototype.IsNegative=function(){return-1==this.compareTo(q.ZERO)?!0:!1};q.op_Equality=function(b,d){return 0==b.compareTo(d)?!0:!1};q.op_Inequality=function(b,d){return 0!=b.compareTo(d)?!0:!1};q.op_GreaterThan=function(b,d){return 0<b.compareTo(d)?!0:!1};q.op_LessThan=function(b,d){return 0>
b.compareTo(d)?!0:!1};q.op_Addition=function(b,d){return(new q(b)).add(new q(d))};q.op_Subtraction=function(b,d){return(new q(b)).subtract(new q(d))};q.Int128Mul=function(b,d){return(new q(b)).multiply(new q(d))};q.op_Division=function(b,d){return b.divide(d)};q.prototype.ToDouble=function(){return parseFloat(this.toString())};if("undefined"==typeof fb)var fb=function(b,d){var e;if("undefined"==typeof Object.getOwnPropertyNames)for(e in d.prototype){if("undefined"==typeof b.prototype[e]||b.prototype[e]==
Object.prototype[e])b.prototype[e]=d.prototype[e]}else for(var h=Object.getOwnPropertyNames(d.prototype),g=0;g<h.length;g++)"undefined"==typeof Object.getOwnPropertyDescriptor(b.prototype,h[g])&&Object.defineProperty(b.prototype,h[g],Object.getOwnPropertyDescriptor(d.prototype,h[g]));for(e in d)"undefined"==typeof b[e]&&(b[e]=d[e]);b.$baseCtor=d};g.Path=function(){return[]};g.Paths=function(){return[]};g.DoublePoint=function(){var b=arguments;this.Y=this.X=0;1==b.length?(this.X=b[0].X,this.Y=b[0].Y):
2==b.length&&(this.X=b[0],this.Y=b[1])};g.DoublePoint0=function(){this.Y=this.X=0};g.DoublePoint1=function(b){this.X=b.X;this.Y=b.Y};g.DoublePoint2=function(b,d){this.X=b;this.Y=d};g.PolyNode=function(){this.m_Parent=null;this.m_polygon=new g.Path;this.m_endtype=this.m_jointype=this.m_Index=0;this.m_Childs=[];this.IsOpen=!1};g.PolyNode.prototype.IsHoleNode=function(){for(var b=!0,d=this.m_Parent;null!==d;)b=!b,d=d.m_Parent;return b};g.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length};
g.PolyNode.prototype.Contour=function(){return this.m_polygon};g.PolyNode.prototype.AddChild=function(b){var d=this.m_Childs.length;this.m_Childs.push(b);b.m_Parent=this;b.m_Index=d};g.PolyNode.prototype.GetNext=function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()};g.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]};g.PolyNode.prototype.Childs=
function(){return this.m_Childs};g.PolyNode.prototype.Parent=function(){return this.m_Parent};g.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()};g.PolyTree=function(){this.m_AllPolys=[];g.PolyNode.call(this)};g.PolyTree.prototype.Clear=function(){for(var b=0,d=this.m_AllPolys.length;b<d;b++)this.m_AllPolys[b]=null;this.m_AllPolys.length=0;this.m_Childs.length=0};g.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null};g.PolyTree.prototype.Total=function(){return this.m_AllPolys.length};
fb(g.PolyTree,g.PolyNode);g.Math_Abs_Int64=g.Math_Abs_Int32=g.Math_Abs_Double=function(b){return Math.abs(b)};g.Math_Max_Int32_Int32=function(b,d){return Math.max(b,d)};g.Cast_Int32=R||Aa||bb?function(b){return b|0}:function(b){return~~b};g.Cast_Int64=Ja?function(b){return-2147483648>b||2147483647<b?0>b?Math.ceil(b):Math.floor(b):~~b}:Ua&&"function"==typeof Number.toInteger?function(b){return Number.toInteger(b)}:cc||Ka?function(b){return parseInt(b,10)}:R?function(b){return-2147483648>b||2147483647<
b?0>b?Math.ceil(b):Math.floor(b):b|0}:function(b){return 0>b?Math.ceil(b):Math.floor(b)};g.Clear=function(b){b.length=0};g.PI=3.141592653589793;g.PI2=6.283185307179586;g.IntPoint=function(){var b;b=arguments;var d=b.length;this.Y=this.X=0;2==d?(this.X=b[0],this.Y=b[1]):1==d?b[0]instanceof g.DoublePoint?(b=b[0],this.X=g.Clipper.Round(b.X),this.Y=g.Clipper.Round(b.Y)):(b=b[0],this.X=b.X,this.Y=b.Y):this.Y=this.X=0};g.IntPoint.op_Equality=function(b,d){return b.X==d.X&&b.Y==d.Y};g.IntPoint.op_Inequality=
function(b,d){return b.X!=d.X||b.Y!=d.Y};g.IntPoint0=function(){this.Y=this.X=0};g.IntPoint1=function(b){this.X=b.X;this.Y=b.Y};g.IntPoint1dp=function(b){this.X=g.Clipper.Round(b.X);this.Y=g.Clipper.Round(b.Y)};g.IntPoint2=function(b,d){this.X=b;this.Y=d};g.IntRect=function(){var b=arguments,d=b.length;4==d?(this.left=b[0],this.top=b[1],this.right=b[2],this.bottom=b[3]):1==d?(this.left=b[0].left,this.top=b[0].top,this.right=b[0].right,this.bottom=b[0].bottom):this.bottom=this.right=this.top=this.left=
0};g.IntRect0=function(){this.bottom=this.right=this.top=this.left=0};g.IntRect1=function(b){this.left=b.left;this.top=b.top;this.right=b.right;this.bottom=b.bottom};g.IntRect4=function(b,d,e,h){this.left=b;this.top=d;this.right=e;this.bottom=h};g.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3};g.PolyType={ptSubject:0,ptClip:1};g.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3};g.JoinType={jtSquare:0,jtRound:1,jtMiter:2};g.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,
etClosedLine:3,etClosedPolygon:4};g.EdgeSide={esLeft:0,esRight:1};g.Direction={dRightToLeft:0,dLeftToRight:1};g.TEdge=function(){this.Bot=new g.IntPoint;this.Curr=new g.IntPoint;this.Top=new g.IntPoint;this.Delta=new g.IntPoint;this.Dx=0;this.PolyTyp=g.PolyType.ptSubject;this.Side=g.EdgeSide.esLeft;this.OutIdx=this.WindCnt2=this.WindCnt=this.WindDelta=0;this.PrevInSEL=this.NextInSEL=this.PrevInAEL=this.NextInAEL=this.NextInLML=this.Prev=this.Next=null};g.IntersectNode=function(){this.Edge2=this.Edge1=
null;this.Pt=new g.IntPoint};g.MyIntersectNodeSort=function(){};g.MyIntersectNodeSort.Compare=function(b,d){return d.Pt.Y-b.Pt.Y};g.LocalMinima=function(){this.Y=0;this.Next=this.RightBound=this.LeftBound=null};g.Scanbeam=function(){this.Y=0;this.Next=null};g.OutRec=function(){this.Idx=0;this.IsOpen=this.IsHole=!1;this.PolyNode=this.BottomPt=this.Pts=this.FirstLeft=null};g.OutPt=function(){this.Idx=0;this.Pt=new g.IntPoint;this.Prev=this.Next=null};g.Join=function(){this.OutPt2=this.OutPt1=null;this.OffPt=
new g.IntPoint};g.ClipperBase=function(){this.m_CurrentLM=this.m_MinimaList=null;this.m_edges=[];this.PreserveCollinear=this.m_HasOpenPaths=this.m_UseFullRange=!1;this.m_CurrentLM=this.m_MinimaList=null;this.m_HasOpenPaths=this.m_UseFullRange=!1};g.ClipperBase.horizontal=-9007199254740992;g.ClipperBase.Skip=-2;g.ClipperBase.Unassigned=-1;g.ClipperBase.tolerance=1E-20;g.ClipperBase.loRange=47453132;g.ClipperBase.hiRange=0xfffffffffffff;g.ClipperBase.near_zero=function(b){return b>-g.ClipperBase.tolerance&&
b<g.ClipperBase.tolerance};g.ClipperBase.IsHorizontal=function(b){return 0===b.Delta.Y};g.ClipperBase.prototype.PointIsVertex=function(b,d){var e=d;do{if(g.IntPoint.op_Equality(e.Pt,b))return!0;e=e.Next}while(e!=d);return!1};g.ClipperBase.prototype.PointOnLineSegment=function(b,d,e,h){return h?b.X==d.X&&b.Y==d.Y||b.X==e.X&&b.Y==e.Y||b.X>d.X==b.X<e.X&&b.Y>d.Y==b.Y<e.Y&&q.op_Equality(q.Int128Mul(b.X-d.X,e.Y-d.Y),q.Int128Mul(e.X-d.X,b.Y-d.Y)):b.X==d.X&&b.Y==d.Y||b.X==e.X&&b.Y==e.Y||b.X>d.X==b.X<e.X&&
b.Y>d.Y==b.Y<e.Y&&(b.X-d.X)*(e.Y-d.Y)==(e.X-d.X)*(b.Y-d.Y)};g.ClipperBase.prototype.PointOnPolygon=function(b,d,e){for(var h=d;;){if(this.PointOnLineSegment(b,h.Pt,h.Next.Pt,e))return!0;h=h.Next;if(h==d)break}return!1};g.ClipperBase.prototype.SlopesEqual=g.ClipperBase.SlopesEqual=function(){var b=arguments,d=b.length,e,h,B;if(3==d)return d=b[0],e=b[1],b[2]?q.op_Equality(q.Int128Mul(d.Delta.Y,e.Delta.X),q.Int128Mul(d.Delta.X,e.Delta.Y)):g.Cast_Int64(d.Delta.Y*e.Delta.X)==g.Cast_Int64(d.Delta.X*e.Delta.Y);
if(4==d)return d=b[0],e=b[1],h=b[2],b[3]?q.op_Equality(q.Int128Mul(d.Y-e.Y,e.X-h.X),q.Int128Mul(d.X-e.X,e.Y-h.Y)):0===g.Cast_Int64((d.Y-e.Y)*(e.X-h.X))-g.Cast_Int64((d.X-e.X)*(e.Y-h.Y));d=b[0];e=b[1];h=b[2];B=b[3];return b[4]?q.op_Equality(q.Int128Mul(d.Y-e.Y,h.X-B.X),q.Int128Mul(d.X-e.X,h.Y-B.Y)):0===g.Cast_Int64((d.Y-e.Y)*(h.X-B.X))-g.Cast_Int64((d.X-e.X)*(h.Y-B.Y))};g.ClipperBase.SlopesEqual3=function(b,d,e){return e?q.op_Equality(q.Int128Mul(b.Delta.Y,d.Delta.X),q.Int128Mul(b.Delta.X,d.Delta.Y)):
g.Cast_Int64(b.Delta.Y*d.Delta.X)==g.Cast_Int64(b.Delta.X*d.Delta.Y)};g.ClipperBase.SlopesEqual4=function(b,d,e,h){return h?q.op_Equality(q.Int128Mul(b.Y-d.Y,d.X-e.X),q.Int128Mul(b.X-d.X,d.Y-e.Y)):0===g.Cast_Int64((b.Y-d.Y)*(d.X-e.X))-g.Cast_Int64((b.X-d.X)*(d.Y-e.Y))};g.ClipperBase.SlopesEqual5=function(b,d,e,h,B){return B?q.op_Equality(q.Int128Mul(b.Y-d.Y,e.X-h.X),q.Int128Mul(b.X-d.X,e.Y-h.Y)):0===g.Cast_Int64((b.Y-d.Y)*(e.X-h.X))-g.Cast_Int64((b.X-d.X)*(e.Y-h.Y))};g.ClipperBase.prototype.Clear=
function(){this.DisposeLocalMinimaList();for(var b=0,d=this.m_edges.length;b<d;++b){for(var e=0,h=this.m_edges[b].length;e<h;++e)this.m_edges[b][e]=null;g.Clear(this.m_edges[b])}g.Clear(this.m_edges);this.m_HasOpenPaths=this.m_UseFullRange=!1};g.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var b=this.m_MinimaList.Next;this.m_MinimaList=null;this.m_MinimaList=b}this.m_CurrentLM=null};g.ClipperBase.prototype.RangeTest=function(b,d){if(d.Value)(b.X>g.ClipperBase.hiRange||
b.Y>g.ClipperBase.hiRange||-b.X>g.ClipperBase.hiRange||-b.Y>g.ClipperBase.hiRange)&&g.Error("Coordinate outside allowed range in RangeTest().");else if(b.X>g.ClipperBase.loRange||b.Y>g.ClipperBase.loRange||-b.X>g.ClipperBase.loRange||-b.Y>g.ClipperBase.loRange)d.Value=!0,this.RangeTest(b,d)};g.ClipperBase.prototype.InitEdge=function(b,d,e,h){b.Next=d;b.Prev=e;b.Curr.X=h.X;b.Curr.Y=h.Y;b.OutIdx=-1};g.ClipperBase.prototype.InitEdge2=function(b,d){b.Curr.Y>=b.Next.Curr.Y?(b.Bot.X=b.Curr.X,b.Bot.Y=b.Curr.Y,
b.Top.X=b.Next.Curr.X,b.Top.Y=b.Next.Curr.Y):(b.Top.X=b.Curr.X,b.Top.Y=b.Curr.Y,b.Bot.X=b.Next.Curr.X,b.Bot.Y=b.Next.Curr.Y);this.SetDx(b);b.PolyTyp=d};g.ClipperBase.prototype.FindNextLocMin=function(b){for(var d;;){for(;g.IntPoint.op_Inequality(b.Bot,b.Prev.Bot)||g.IntPoint.op_Equality(b.Curr,b.Top);)b=b.Next;if(b.Dx!=g.ClipperBase.horizontal&&b.Prev.Dx!=g.ClipperBase.horizontal)break;for(;b.Prev.Dx==g.ClipperBase.horizontal;)b=b.Prev;for(d=b;b.Dx==g.ClipperBase.horizontal;)b=b.Next;if(b.Top.Y!=
b.Prev.Bot.Y){d.Prev.Bot.X<b.Bot.X&&(b=d);break}}return b};g.ClipperBase.prototype.ProcessBound=function(b,d){var e=b,h=b,B;b.Dx==g.ClipperBase.horizontal&&(B=d?b.Prev.Bot.X:b.Next.Bot.X,b.Bot.X!=B&&this.ReverseHorizontal(b));if(h.OutIdx!=g.ClipperBase.Skip)if(d){for(;h.Top.Y==h.Next.Bot.Y&&h.Next.OutIdx!=g.ClipperBase.Skip;)h=h.Next;if(h.Dx==g.ClipperBase.horizontal&&h.Next.OutIdx!=g.ClipperBase.Skip){for(B=h;B.Prev.Dx==g.ClipperBase.horizontal;)B=B.Prev;B.Prev.Top.X==h.Next.Top.X?d||(h=B.Prev):
B.Prev.Top.X>h.Next.Top.X&&(h=B.Prev)}for(;b!=h;)b.NextInLML=b.Next,b.Dx==g.ClipperBase.horizontal&&b!=e&&b.Bot.X!=b.Prev.Top.X&&this.ReverseHorizontal(b),b=b.Next;b.Dx==g.ClipperBase.horizontal&&b!=e&&b.Bot.X!=b.Prev.Top.X&&this.ReverseHorizontal(b);h=h.Next}else{for(;h.Top.Y==h.Prev.Bot.Y&&h.Prev.OutIdx!=g.ClipperBase.Skip;)h=h.Prev;if(h.Dx==g.ClipperBase.horizontal&&h.Prev.OutIdx!=g.ClipperBase.Skip){for(B=h;B.Next.Dx==g.ClipperBase.horizontal;)B=B.Next;B.Next.Top.X==h.Prev.Top.X?d||(h=B.Next):
B.Next.Top.X>h.Prev.Top.X&&(h=B.Next)}for(;b!=h;)b.NextInLML=b.Prev,b.Dx==g.ClipperBase.horizontal&&b!=e&&b.Bot.X!=b.Next.Top.X&&this.ReverseHorizontal(b),b=b.Prev;b.Dx==g.ClipperBase.horizontal&&b!=e&&b.Bot.X!=b.Next.Top.X&&this.ReverseHorizontal(b);h=h.Prev}if(h.OutIdx==g.ClipperBase.Skip){b=h;if(d){for(;b.Top.Y==b.Next.Bot.Y;)b=b.Next;for(;b!=h&&b.Dx==g.ClipperBase.horizontal;)b=b.Prev}else{for(;b.Top.Y==b.Prev.Bot.Y;)b=b.Prev;for(;b!=h&&b.Dx==g.ClipperBase.horizontal;)b=b.Next}b==h?h=d?b.Next:
b.Prev:(b=d?h.Next:h.Prev,e=new g.LocalMinima,e.Next=null,e.Y=b.Bot.Y,e.LeftBound=null,e.RightBound=b,e.RightBound.WindDelta=0,h=this.ProcessBound(e.RightBound,d),this.InsertLocalMinima(e))}return h};g.ClipperBase.prototype.AddPath=function(b,d,e){e||d!=g.PolyType.ptClip||g.Error("AddPath: Open paths must be subject.");var h=b.length-1;if(e)for(;0<h&&g.IntPoint.op_Equality(b[h],b[0]);)--h;for(;0<h&&g.IntPoint.op_Equality(b[h],b[h-1]);)--h;if(e&&2>h||!e&&1>h)return!1;for(var B=[],u=0;u<=h;u++)B.push(new g.TEdge);
var m=!0;try{for(B[1].Curr.X=b[1].X,B[1].Curr.Y=b[1].Y,function(){var d={Value:this.m_UseFullRange},e=this.RangeTest(b[0],d);this.m_UseFullRange=d.Value;return e}.call(this),function(){var d={Value:this.m_UseFullRange},e=this.RangeTest(b[h],d);this.m_UseFullRange=d.Value;return e}.call(this),this.InitEdge(B[0],B[1],B[h],b[0]),this.InitEdge(B[h],B[0],B[h-1],b[h]),u=h-1;1<=u;--u)(function(){var d={Value:this.m_UseFullRange},e=this.RangeTest(b[u],d);this.m_UseFullRange=d.Value;return e}).call(this),
this.InitEdge(B[u],B[u+1],B[u-1],b[u])}catch(n){return!1}var q=B[0];e||(q.Prev.OutIdx=g.ClipperBase.Skip);for(var x=q,F=q;;)if(g.IntPoint.op_Equality(x.Curr,x.Next.Curr)){if(x==x.Next)break;x==q&&(q=x.Next);F=x=this.RemoveEdge(x)}else{if(x.Prev==x.Next)break;else if(e&&g.ClipperBase.SlopesEqual(x.Prev.Curr,x.Curr,x.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(x.Prev.Curr,x.Curr,x.Next.Curr))){x==q&&(q=x.Next);x=this.RemoveEdge(x);F=x=x.Prev;continue}x=x.Next;
if(x==F)break}if(!e&&x==x.Next||e&&x.Prev==x.Next)return!1;e||(this.m_HasOpenPaths=!0);x=q;do this.InitEdge2(x,d),x=x.Next,m&&x.Curr.Y!=q.Curr.Y&&(m=!1);while(x!=q);if(m){if(e)return!1;x.Prev.OutIdx=g.ClipperBase.Skip;x.Prev.Bot.X<x.Prev.Top.X&&this.ReverseHorizontal(x.Prev);d=new g.LocalMinima;d.Next=null;d.Y=x.Bot.Y;d.LeftBound=null;d.RightBound=x;d.RightBound.Side=g.EdgeSide.esRight;for(d.RightBound.WindDelta=0;x.Next.OutIdx!=g.ClipperBase.Skip;)x.NextInLML=x.Next,x.Bot.X!=x.Prev.Top.X&&this.ReverseHorizontal(x),
x=x.Next;this.InsertLocalMinima(d);this.m_edges.push(B);return!0}this.m_edges.push(B);for(m=null;;){x=this.FindNextLocMin(x);if(x==m)break;else null==m&&(m=x);d=new g.LocalMinima;d.Next=null;d.Y=x.Bot.Y;x.Dx<x.Prev.Dx?(d.LeftBound=x.Prev,d.RightBound=x,B=!1):(d.LeftBound=x,d.RightBound=x.Prev,B=!0);d.LeftBound.Side=g.EdgeSide.esLeft;d.RightBound.Side=g.EdgeSide.esRight;d.LeftBound.WindDelta=e?d.LeftBound.Next==d.RightBound?-1:1:0;d.RightBound.WindDelta=-d.LeftBound.WindDelta;x=this.ProcessBound(d.LeftBound,
B);q=this.ProcessBound(d.RightBound,!B);d.LeftBound.OutIdx==g.ClipperBase.Skip?d.LeftBound=null:d.RightBound.OutIdx==g.ClipperBase.Skip&&(d.RightBound=null);this.InsertLocalMinima(d);B||(x=q)}return!0};g.ClipperBase.prototype.AddPaths=function(b,d,e){for(var h=!1,g=0,u=b.length;g<u;++g)this.AddPath(b[g],d,e)&&(h=!0);return h};g.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(b,d,e){return g.IntPoint.op_Equality(b,e)||g.IntPoint.op_Equality(b,d)||g.IntPoint.op_Equality(e,d)?!1:b.X!=e.X?d.X>b.X==
d.X<e.X:d.Y>b.Y==d.Y<e.Y};g.ClipperBase.prototype.RemoveEdge=function(b){b.Prev.Next=b.Next;b.Next.Prev=b.Prev;var d=b.Next;b.Prev=null;return d};g.ClipperBase.prototype.SetDx=function(b){b.Delta.X=b.Top.X-b.Bot.X;b.Delta.Y=b.Top.Y-b.Bot.Y;b.Dx=0===b.Delta.Y?g.ClipperBase.horizontal:b.Delta.X/b.Delta.Y};g.ClipperBase.prototype.InsertLocalMinima=function(b){if(null===this.m_MinimaList)this.m_MinimaList=b;else if(b.Y>=this.m_MinimaList.Y)b.Next=this.m_MinimaList,this.m_MinimaList=b;else{for(var d=this.m_MinimaList;null!==
d.Next&&b.Y<d.Next.Y;)d=d.Next;b.Next=d.Next;d.Next=b}};g.ClipperBase.prototype.PopLocalMinima=function(){null!==this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.Next)};g.ClipperBase.prototype.ReverseHorizontal=function(b){var d=b.Top.X;b.Top.X=b.Bot.X;b.Bot.X=d};g.ClipperBase.prototype.Reset=function(){this.m_CurrentLM=this.m_MinimaList;if(null!=this.m_CurrentLM)for(var b=this.m_MinimaList;null!=b;){var d=b.LeftBound;null!=d&&(d.Curr.X=d.Bot.X,d.Curr.Y=d.Bot.Y,d.Side=g.EdgeSide.esLeft,d.OutIdx=
g.ClipperBase.Unassigned);d=b.RightBound;null!=d&&(d.Curr.X=d.Bot.X,d.Curr.Y=d.Bot.Y,d.Side=g.EdgeSide.esRight,d.OutIdx=g.ClipperBase.Unassigned);b=b.Next}};g.Clipper=function(b){"undefined"==typeof b&&(b=0);this.m_PolyOuts=null;this.m_ClipType=g.ClipType.ctIntersection;this.m_IntersectNodeComparer=this.m_IntersectList=this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_ExecuteLocked=!1;this.m_SubjFillType=this.m_ClipFillType=g.PolyFillType.pftEvenOdd;this.m_GhostJoins=this.m_Joins=
null;this.StrictlySimple=this.ReverseSolution=this.m_UsingPolyTree=!1;g.ClipperBase.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_IntersectList=[];this.m_IntersectNodeComparer=g.MyIntersectNodeSort.Compare;this.m_UsingPolyTree=this.m_ExecuteLocked=!1;this.m_PolyOuts=[];this.m_Joins=[];this.m_GhostJoins=[];this.ReverseSolution=0!==(1&b);this.StrictlySimple=0!==(2&b);this.PreserveCollinear=0!==(4&b)};g.Clipper.ioReverseSolution=1;g.Clipper.ioStrictlySimple=2;g.Clipper.ioPreserveCollinear=
4;g.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),g.ClipperBase.prototype.Clear.call(this))};g.Clipper.prototype.DisposeScanbeamList=function(){for(;null!==this.m_Scanbeam;){var b=this.m_Scanbeam.Next;this.m_Scanbeam=null;this.m_Scanbeam=b}};g.Clipper.prototype.Reset=function(){g.ClipperBase.prototype.Reset.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.DisposeAllPolyPts();for(var b=this.m_MinimaList;null!==b;)this.InsertScanbeam(b.Y),
b=b.Next};g.Clipper.prototype.InsertScanbeam=function(b){if(null===this.m_Scanbeam)this.m_Scanbeam=new g.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=b;else if(b>this.m_Scanbeam.Y){var d=new g.Scanbeam;d.Y=b;d.Next=this.m_Scanbeam;this.m_Scanbeam=d}else{for(var e=this.m_Scanbeam;null!==e.Next&&b<=e.Next.Y;)e=e.Next;b!=e.Y&&(d=new g.Scanbeam,d.Y=b,d.Next=e.Next,e.Next=d)}};g.Clipper.prototype.Execute=function(){var b=arguments,d=b.length,e=b[1]instanceof g.PolyTree;if(4!=d||e){if(4==d&&e){e=
b[0];d=b[1];h=b[2];b=b[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;this.m_SubjFillType=h;this.m_ClipFillType=b;this.m_ClipType=e;this.m_UsingPolyTree=!0;(b=this.ExecuteInternal())&&this.BuildResult2(d);this.m_ExecuteLocked=!1;return b}if(2==d&&!e||2==d&&e)return e=b[0],d=b[1],this.Execute(e,d,g.PolyFillType.pftEvenOdd,g.PolyFillType.pftEvenOdd)}else{var e=b[0],d=b[1],h=b[2],b=b[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&g.Error("Error: PolyTree struct is need for open path clipping.");
this.m_ExecuteLocked=!0;g.Clear(d);this.m_SubjFillType=h;this.m_ClipFillType=b;this.m_ClipType=e;this.m_UsingPolyTree=!1;(b=this.ExecuteInternal())&&this.BuildResult(d);this.m_ExecuteLocked=!1;return b}};g.Clipper.prototype.FixHoleLinkage=function(b){if(null!==b.FirstLeft&&(b.IsHole==b.FirstLeft.IsHole||null===b.FirstLeft.Pts)){for(var d=b.FirstLeft;null!==d&&(d.IsHole==b.IsHole||null===d.Pts);)d=d.FirstLeft;b.FirstLeft=d}};g.Clipper.prototype.ExecuteInternal=function(){try{this.Reset();if(null===
this.m_CurrentLM)return!1;var b=this.PopScanbeam();do{this.InsertLocalMinimaIntoAEL(b);g.Clear(this.m_GhostJoins);this.ProcessHorizontals(!1);if(null===this.m_Scanbeam)break;var d=this.PopScanbeam();if(!this.ProcessIntersections(b,d))return!1;this.ProcessEdgesAtTopOfScanbeam(d);b=d}while(null!==this.m_Scanbeam||null!==this.m_CurrentLM);for(var b=0,e=this.m_PolyOuts.length;b<e;b++){var h=this.m_PolyOuts[b];null===h.Pts||h.IsOpen||(h.IsHole^this.ReverseSolution)==0<this.Area(h)&&this.ReversePolyPtLinks(h.Pts)}this.JoinCommonEdges();
b=0;for(e=this.m_PolyOuts.length;b<e;b++)h=this.m_PolyOuts[b],null===h.Pts||h.IsOpen||this.FixupOutPolygon(h);this.StrictlySimple&&this.DoSimplePolygons();return!0}finally{g.Clear(this.m_Joins),g.Clear(this.m_GhostJoins)}};g.Clipper.prototype.PopScanbeam=function(){var b=this.m_Scanbeam.Y;this.m_Scanbeam=this.m_Scanbeam.Next;return b};g.Clipper.prototype.DisposeAllPolyPts=function(){for(var b=0,d=this.m_PolyOuts.length;b<d;++b)this.DisposeOutRec(b);g.Clear(this.m_PolyOuts)};g.Clipper.prototype.DisposeOutRec=
function(b){var d=this.m_PolyOuts[b];null!==d.Pts&&this.DisposeOutPts(d.Pts);this.m_PolyOuts[b]=null};g.Clipper.prototype.DisposeOutPts=function(b){if(null!==b)for(b.Prev.Next=null;null!==b;)b=b.Next};g.Clipper.prototype.AddJoin=function(b,d,e){var h=new g.Join;h.OutPt1=b;h.OutPt2=d;h.OffPt.X=e.X;h.OffPt.Y=e.Y;this.m_Joins.push(h)};g.Clipper.prototype.AddGhostJoin=function(b,d){var e=new g.Join;e.OutPt1=b;e.OffPt.X=d.X;e.OffPt.Y=d.Y;this.m_GhostJoins.push(e)};g.Clipper.prototype.InsertLocalMinimaIntoAEL=
function(b){for(;null!==this.m_CurrentLM&&this.m_CurrentLM.Y==b;){var d=this.m_CurrentLM.LeftBound,e=this.m_CurrentLM.RightBound;this.PopLocalMinima();var h=null;null===d?(this.InsertEdgeIntoAEL(e,null),this.SetWindingCount(e),this.IsContributing(e)&&(h=this.AddOutPt(e,e.Bot))):(null==e?(this.InsertEdgeIntoAEL(d,null),this.SetWindingCount(d),this.IsContributing(d)&&(h=this.AddOutPt(d,d.Bot))):(this.InsertEdgeIntoAEL(d,null),this.InsertEdgeIntoAEL(e,d),this.SetWindingCount(d),e.WindCnt=d.WindCnt,e.WindCnt2=
d.WindCnt2,this.IsContributing(d)&&(h=this.AddLocalMinPoly(d,e,d.Bot))),this.InsertScanbeam(d.Top.Y));null!=e&&(g.ClipperBase.IsHorizontal(e)?this.AddEdgeToSEL(e):this.InsertScanbeam(e.Top.Y));if(null!=d&&null!=e){if(null!==h&&g.ClipperBase.IsHorizontal(e)&&0<this.m_GhostJoins.length&&0!==e.WindDelta)for(var B=0,u=this.m_GhostJoins.length;B<u;B++){var m=this.m_GhostJoins[B];this.HorzSegmentsOverlap(m.OutPt1.Pt,m.OffPt,e.Bot,e.Top)&&this.AddJoin(m.OutPt1,h,m.OffPt)}0<=d.OutIdx&&null!==d.PrevInAEL&&
d.PrevInAEL.Curr.X==d.Bot.X&&0<=d.PrevInAEL.OutIdx&&g.ClipperBase.SlopesEqual(d.PrevInAEL,d,this.m_UseFullRange)&&0!==d.WindDelta&&0!==d.PrevInAEL.WindDelta&&(B=this.AddOutPt(d.PrevInAEL,d.Bot),this.AddJoin(h,B,d.Top));if(d.NextInAEL!=e&&(0<=e.OutIdx&&0<=e.PrevInAEL.OutIdx&&g.ClipperBase.SlopesEqual(e.PrevInAEL,e,this.m_UseFullRange)&&0!==e.WindDelta&&0!==e.PrevInAEL.WindDelta&&(B=this.AddOutPt(e.PrevInAEL,e.Bot),this.AddJoin(h,B,e.Top)),h=d.NextInAEL,null!==h))for(;h!=e;)this.IntersectEdges(e,h,
d.Curr,!1),h=h.NextInAEL}}};g.Clipper.prototype.InsertEdgeIntoAEL=function(b,d){if(null===this.m_ActiveEdges)b.PrevInAEL=null,b.NextInAEL=null,this.m_ActiveEdges=b;else if(null===d&&this.E2InsertsBeforeE1(this.m_ActiveEdges,b))b.PrevInAEL=null,b.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges=this.m_ActiveEdges.PrevInAEL=b;else{for(null===d&&(d=this.m_ActiveEdges);null!==d.NextInAEL&&!this.E2InsertsBeforeE1(d.NextInAEL,b);)d=d.NextInAEL;b.NextInAEL=d.NextInAEL;null!==d.NextInAEL&&(d.NextInAEL.PrevInAEL=
b);b.PrevInAEL=d;d.NextInAEL=b}};g.Clipper.prototype.E2InsertsBeforeE1=function(b,d){return d.Curr.X==b.Curr.X?d.Top.Y>b.Top.Y?d.Top.X<g.Clipper.TopX(b,d.Top.Y):b.Top.X>g.Clipper.TopX(d,b.Top.Y):d.Curr.X<b.Curr.X};g.Clipper.prototype.IsEvenOddFillType=function(b){return b.PolyTyp==g.PolyType.ptSubject?this.m_SubjFillType==g.PolyFillType.pftEvenOdd:this.m_ClipFillType==g.PolyFillType.pftEvenOdd};g.Clipper.prototype.IsEvenOddAltFillType=function(b){return b.PolyTyp==g.PolyType.ptSubject?this.m_ClipFillType==
g.PolyFillType.pftEvenOdd:this.m_SubjFillType==g.PolyFillType.pftEvenOdd};g.Clipper.prototype.IsContributing=function(b){var d,e;b.PolyTyp==g.PolyType.ptSubject?(d=this.m_SubjFillType,e=this.m_ClipFillType):(d=this.m_ClipFillType,e=this.m_SubjFillType);switch(d){case g.PolyFillType.pftEvenOdd:if(0===b.WindDelta&&1!=b.WindCnt)return!1;break;case g.PolyFillType.pftNonZero:if(1!=Math.abs(b.WindCnt))return!1;break;case g.PolyFillType.pftPositive:if(1!=b.WindCnt)return!1;break;default:if(-1!=b.WindCnt)return!1}switch(this.m_ClipType){case g.ClipType.ctIntersection:switch(e){case g.PolyFillType.pftEvenOdd:case g.PolyFillType.pftNonZero:return 0!==
b.WindCnt2;case g.PolyFillType.pftPositive:return 0<b.WindCnt2;default:return 0>b.WindCnt2}case g.ClipType.ctUnion:switch(e){case g.PolyFillType.pftEvenOdd:case g.PolyFillType.pftNonZero:return 0===b.WindCnt2;case g.PolyFillType.pftPositive:return 0>=b.WindCnt2;default:return 0<=b.WindCnt2}case g.ClipType.ctDifference:if(b.PolyTyp==g.PolyType.ptSubject)switch(e){case g.PolyFillType.pftEvenOdd:case g.PolyFillType.pftNonZero:return 0===b.WindCnt2;case g.PolyFillType.pftPositive:return 0>=b.WindCnt2;
default:return 0<=b.WindCnt2}else switch(e){case g.PolyFillType.pftEvenOdd:case g.PolyFillType.pftNonZero:return 0!==b.WindCnt2;case g.PolyFillType.pftPositive:return 0<b.WindCnt2;default:return 0>b.WindCnt2}case g.ClipType.ctXor:if(0===b.WindDelta)switch(e){case g.PolyFillType.pftEvenOdd:case g.PolyFillType.pftNonZero:return 0===b.WindCnt2;case g.PolyFillType.pftPositive:return 0>=b.WindCnt2;default:return 0<=b.WindCnt2}}return!0};g.Clipper.prototype.SetWindingCount=function(b){for(var d=b.PrevInAEL;null!==
d&&(d.PolyTyp!=b.PolyTyp||0===d.WindDelta);)d=d.PrevInAEL;if(null===d)b.WindCnt=0===b.WindDelta?1:b.WindDelta,b.WindCnt2=0,d=this.m_ActiveEdges;else{if(0===b.WindDelta&&this.m_ClipType!=g.ClipType.ctUnion)b.WindCnt=1;else if(this.IsEvenOddFillType(b))if(0===b.WindDelta){for(var e=!0,h=d.PrevInAEL;null!==h;)h.PolyTyp==d.PolyTyp&&0!==h.WindDelta&&(e=!e),h=h.PrevInAEL;b.WindCnt=e?0:1}else b.WindCnt=b.WindDelta;else 0>d.WindCnt*d.WindDelta?1<Math.abs(d.WindCnt)?b.WindCnt=0>d.WindDelta*b.WindDelta?d.WindCnt:
d.WindCnt+b.WindDelta:b.WindCnt=0===b.WindDelta?1:b.WindDelta:b.WindCnt=0===b.WindDelta?0>d.WindCnt?d.WindCnt-1:d.WindCnt+1:0>d.WindDelta*b.WindDelta?d.WindCnt:d.WindCnt+b.WindDelta;b.WindCnt2=d.WindCnt2;d=d.NextInAEL}if(this.IsEvenOddAltFillType(b))for(;d!=b;)0!==d.WindDelta&&(b.WindCnt2=0===b.WindCnt2?1:0),d=d.NextInAEL;else for(;d!=b;)b.WindCnt2+=d.WindDelta,d=d.NextInAEL};g.Clipper.prototype.AddEdgeToSEL=function(b){null===this.m_SortedEdges?(this.m_SortedEdges=b,b.PrevInSEL=null,b.NextInSEL=
null):(b.NextInSEL=this.m_SortedEdges,b.PrevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.PrevInSEL=b)};g.Clipper.prototype.CopyAELToSEL=function(){var b=this.m_ActiveEdges;for(this.m_SortedEdges=b;null!==b;)b.PrevInSEL=b.PrevInAEL,b=b.NextInSEL=b.NextInAEL};g.Clipper.prototype.SwapPositionsInAEL=function(b,d){if(b.NextInAEL!=b.PrevInAEL&&d.NextInAEL!=d.PrevInAEL){if(b.NextInAEL==d){var e=d.NextInAEL;null!==e&&(e.PrevInAEL=b);var h=b.PrevInAEL;null!==h&&(h.NextInAEL=d);d.PrevInAEL=h;d.NextInAEL=
b;b.PrevInAEL=d;b.NextInAEL=e}else d.NextInAEL==b?(e=b.NextInAEL,null!==e&&(e.PrevInAEL=d),h=d.PrevInAEL,null!==h&&(h.NextInAEL=b),b.PrevInAEL=h,b.NextInAEL=d,d.PrevInAEL=b,d.NextInAEL=e):(e=b.NextInAEL,h=b.PrevInAEL,b.NextInAEL=d.NextInAEL,null!==b.NextInAEL&&(b.NextInAEL.PrevInAEL=b),b.PrevInAEL=d.PrevInAEL,null!==b.PrevInAEL&&(b.PrevInAEL.NextInAEL=b),d.NextInAEL=e,null!==d.NextInAEL&&(d.NextInAEL.PrevInAEL=d),d.PrevInAEL=h,null!==d.PrevInAEL&&(d.PrevInAEL.NextInAEL=d));null===b.PrevInAEL?this.m_ActiveEdges=
b:null===d.PrevInAEL&&(this.m_ActiveEdges=d)}};g.Clipper.prototype.SwapPositionsInSEL=function(b,d){if(null!==b.NextInSEL||null!==b.PrevInSEL)if(null!==d.NextInSEL||null!==d.PrevInSEL){if(b.NextInSEL==d){var e=d.NextInSEL;null!==e&&(e.PrevInSEL=b);var h=b.PrevInSEL;null!==h&&(h.NextInSEL=d);d.PrevInSEL=h;d.NextInSEL=b;b.PrevInSEL=d;b.NextInSEL=e}else d.NextInSEL==b?(e=b.NextInSEL,null!==e&&(e.PrevInSEL=d),h=d.PrevInSEL,null!==h&&(h.NextInSEL=b),b.PrevInSEL=h,b.NextInSEL=d,d.PrevInSEL=b,d.NextInSEL=
e):(e=b.NextInSEL,h=b.PrevInSEL,b.NextInSEL=d.NextInSEL,null!==b.NextInSEL&&(b.NextInSEL.PrevInSEL=b),b.PrevInSEL=d.PrevInSEL,null!==b.PrevInSEL&&(b.PrevInSEL.NextInSEL=b),d.NextInSEL=e,null!==d.NextInSEL&&(d.NextInSEL.PrevInSEL=d),d.PrevInSEL=h,null!==d.PrevInSEL&&(d.PrevInSEL.NextInSEL=d));null===b.PrevInSEL?this.m_SortedEdges=b:null===d.PrevInSEL&&(this.m_SortedEdges=d)}};g.Clipper.prototype.AddLocalMaxPoly=function(b,d,e){this.AddOutPt(b,e);0==d.WindDelta&&this.AddOutPt(d,e);b.OutIdx==d.OutIdx?
(b.OutIdx=-1,d.OutIdx=-1):b.OutIdx<d.OutIdx?this.AppendPolygon(b,d):this.AppendPolygon(d,b)};g.Clipper.prototype.AddLocalMinPoly=function(b,d,e){var h,B;g.ClipperBase.IsHorizontal(d)||b.Dx>d.Dx?(h=this.AddOutPt(b,e),d.OutIdx=b.OutIdx,b.Side=g.EdgeSide.esLeft,d.Side=g.EdgeSide.esRight,B=b,b=B.PrevInAEL==d?d.PrevInAEL:B.PrevInAEL):(h=this.AddOutPt(d,e),b.OutIdx=d.OutIdx,b.Side=g.EdgeSide.esRight,d.Side=g.EdgeSide.esLeft,B=d,b=B.PrevInAEL==b?b.PrevInAEL:B.PrevInAEL);null!==b&&0<=b.OutIdx&&g.Clipper.TopX(b,
e.Y)==g.Clipper.TopX(B,e.Y)&&g.ClipperBase.SlopesEqual(B,b,this.m_UseFullRange)&&0!==B.WindDelta&&0!==b.WindDelta&&(e=this.AddOutPt(b,e),this.AddJoin(h,e,B.Top));return h};g.Clipper.prototype.CreateOutRec=function(){var b=new g.OutRec;b.Idx=-1;b.IsHole=!1;b.IsOpen=!1;b.FirstLeft=null;b.Pts=null;b.BottomPt=null;b.PolyNode=null;this.m_PolyOuts.push(b);b.Idx=this.m_PolyOuts.length-1;return b};g.Clipper.prototype.AddOutPt=function(b,d){var e=b.Side==g.EdgeSide.esLeft;if(0>b.OutIdx){var h=this.CreateOutRec();
h.IsOpen=0===b.WindDelta;var B=new g.OutPt;h.Pts=B;B.Idx=h.Idx;B.Pt.X=d.X;B.Pt.Y=d.Y;B.Next=B;B.Prev=B;h.IsOpen||this.SetHoleState(b,h);b.OutIdx=h.Idx}else{var h=this.m_PolyOuts[b.OutIdx],u=h.Pts;if(e&&g.IntPoint.op_Equality(d,u.Pt))return u;if(!e&&g.IntPoint.op_Equality(d,u.Prev.Pt))return u.Prev;B=new g.OutPt;B.Idx=h.Idx;B.Pt.X=d.X;B.Pt.Y=d.Y;B.Next=u;B.Prev=u.Prev;B.Prev.Next=B;u.Prev=B;e&&(h.Pts=B)}return B};g.Clipper.prototype.SwapPoints=function(b,d){var e=new g.IntPoint(b.Value);b.Value.X=
d.Value.X;b.Value.Y=d.Value.Y;d.Value.X=e.X;d.Value.Y=e.Y};g.Clipper.prototype.HorzSegmentsOverlap=function(b,d,e,h){return b.X>e.X==b.X<h.X?!0:d.X>e.X==d.X<h.X?!0:e.X>b.X==e.X<d.X?!0:h.X>b.X==h.X<d.X?!0:b.X==e.X&&d.X==h.X?!0:b.X==h.X&&d.X==e.X?!0:!1};g.Clipper.prototype.InsertPolyPtBetween=function(b,d,e){var h=new g.OutPt;h.Pt.X=e.X;h.Pt.Y=e.Y;d==b.Next?(b.Next=h,d.Prev=h,h.Next=d,h.Prev=b):(d.Next=h,b.Prev=h,h.Next=b,h.Prev=d);return h};g.Clipper.prototype.SetHoleState=function(b,d){for(var e=
!1,h=b.PrevInAEL;null!==h;)0<=h.OutIdx&&0!=h.WindDelta&&(e=!e,null===d.FirstLeft&&(d.FirstLeft=this.m_PolyOuts[h.OutIdx])),h=h.PrevInAEL;e&&(d.IsHole=!0)};g.Clipper.prototype.GetDx=function(b,d){return b.Y==d.Y?g.ClipperBase.horizontal:(d.X-b.X)/(d.Y-b.Y)};g.Clipper.prototype.FirstIsBottomPt=function(b,d){for(var e=b.Prev;g.IntPoint.op_Equality(e.Pt,b.Pt)&&e!=b;)e=e.Prev;for(var h=Math.abs(this.GetDx(b.Pt,e.Pt)),e=b.Next;g.IntPoint.op_Equality(e.Pt,b.Pt)&&e!=b;)e=e.Next;for(var B=Math.abs(this.GetDx(b.Pt,
e.Pt)),e=d.Prev;g.IntPoint.op_Equality(e.Pt,d.Pt)&&e!=d;)e=e.Prev;for(var u=Math.abs(this.GetDx(d.Pt,e.Pt)),e=d.Next;g.IntPoint.op_Equality(e.Pt,d.Pt)&&e!=d;)e=e.Next;e=Math.abs(this.GetDx(d.Pt,e.Pt));return h>=u&&h>=e||B>=u&&B>=e};g.Clipper.prototype.GetBottomPt=function(b){for(var d=null,e=b.Next;e!=b;)e.Pt.Y>b.Pt.Y?(b=e,d=null):e.Pt.Y==b.Pt.Y&&e.Pt.X<=b.Pt.X&&(e.Pt.X<b.Pt.X?(d=null,b=e):e.Next!=b&&e.Prev!=b&&(d=e)),e=e.Next;if(null!==d)for(;d!=e;)for(this.FirstIsBottomPt(e,d)||(b=d),d=d.Next;g.IntPoint.op_Inequality(d.Pt,
b.Pt);)d=d.Next;return b};g.Clipper.prototype.GetLowermostRec=function(b,d){null===b.BottomPt&&(b.BottomPt=this.GetBottomPt(b.Pts));null===d.BottomPt&&(d.BottomPt=this.GetBottomPt(d.Pts));var e=b.BottomPt,h=d.BottomPt;return e.Pt.Y>h.Pt.Y?b:e.Pt.Y<h.Pt.Y?d:e.Pt.X<h.Pt.X?b:e.Pt.X>h.Pt.X?d:e.Next==e?d:h.Next==h?b:this.FirstIsBottomPt(e,h)?b:d};g.Clipper.prototype.Param1RightOfParam2=function(b,d){do if(b=b.FirstLeft,b==d)return!0;while(null!==b);return!1};g.Clipper.prototype.GetOutRec=function(b){for(b=
this.m_PolyOuts[b];b!=this.m_PolyOuts[b.Idx];)b=this.m_PolyOuts[b.Idx];return b};g.Clipper.prototype.AppendPolygon=function(b,d){var e=this.m_PolyOuts[b.OutIdx],h=this.m_PolyOuts[d.OutIdx],B;B=this.Param1RightOfParam2(e,h)?h:this.Param1RightOfParam2(h,e)?e:this.GetLowermostRec(e,h);var u=e.Pts,m=u.Prev,n=h.Pts,x=n.Prev;b.Side==g.EdgeSide.esLeft?(d.Side==g.EdgeSide.esLeft?(this.ReversePolyPtLinks(n),n.Next=u,u.Prev=n,m.Next=x,x.Prev=m,e.Pts=x):(x.Next=u,u.Prev=x,n.Prev=m,m.Next=n,e.Pts=n),u=g.EdgeSide.esLeft):
(d.Side==g.EdgeSide.esRight?(this.ReversePolyPtLinks(n),m.Next=x,x.Prev=m,n.Next=u,u.Prev=n):(m.Next=n,n.Prev=m,u.Prev=x,x.Next=u),u=g.EdgeSide.esRight);e.BottomPt=null;B==h&&(h.FirstLeft!=e&&(e.FirstLeft=h.FirstLeft),e.IsHole=h.IsHole);h.Pts=null;h.BottomPt=null;h.FirstLeft=e;B=b.OutIdx;m=d.OutIdx;b.OutIdx=-1;d.OutIdx=-1;for(n=this.m_ActiveEdges;null!==n;){if(n.OutIdx==m){n.OutIdx=B;n.Side=u;break}n=n.NextInAEL}h.Idx=e.Idx};g.Clipper.prototype.ReversePolyPtLinks=function(b){if(null!==b){var d,e;
d=b;do e=d.Next,d.Next=d.Prev,d=d.Prev=e;while(d!=b)}};g.Clipper.SwapSides=function(b,d){var e=b.Side;b.Side=d.Side;d.Side=e};g.Clipper.SwapPolyIndexes=function(b,d){var e=b.OutIdx;b.OutIdx=d.OutIdx;d.OutIdx=e};g.Clipper.prototype.IntersectEdges=function(b,d,e,h){var B=!h&&null===b.NextInLML&&b.Top.X==e.X&&b.Top.Y==e.Y;h=!h&&null===d.NextInLML&&d.Top.X==e.X&&d.Top.Y==e.Y;var u=0<=b.OutIdx,m=0<=d.OutIdx;if(0===b.WindDelta||0===d.WindDelta)0===b.WindDelta&&0===d.WindDelta?(B||h)&&u&&m&&this.AddLocalMaxPoly(b,
d,e):b.PolyTyp==d.PolyTyp&&b.WindDelta!=d.WindDelta&&this.m_ClipType==g.ClipType.ctUnion?0===b.WindDelta?m&&(this.AddOutPt(b,e),u&&(b.OutIdx=-1)):u&&(this.AddOutPt(d,e),m&&(d.OutIdx=-1)):b.PolyTyp!=d.PolyTyp&&(0!==b.WindDelta||1!=Math.abs(d.WindCnt)||this.m_ClipType==g.ClipType.ctUnion&&0!==d.WindCnt2?0!==d.WindDelta||1!=Math.abs(b.WindCnt)||this.m_ClipType==g.ClipType.ctUnion&&0!==b.WindCnt2||(this.AddOutPt(d,e),m&&(d.OutIdx=-1)):(this.AddOutPt(b,e),u&&(b.OutIdx=-1))),B&&(0>b.OutIdx?this.DeleteFromAEL(b):
g.Error("Error intersecting polylines")),h&&(0>d.OutIdx?this.DeleteFromAEL(d):g.Error("Error intersecting polylines"));else{if(b.PolyTyp==d.PolyTyp)if(this.IsEvenOddFillType(b)){var n=b.WindCnt;b.WindCnt=d.WindCnt;d.WindCnt=n}else b.WindCnt=0===b.WindCnt+d.WindDelta?-b.WindCnt:b.WindCnt+d.WindDelta,d.WindCnt=0===d.WindCnt-b.WindDelta?-d.WindCnt:d.WindCnt-b.WindDelta;else this.IsEvenOddFillType(d)?b.WindCnt2=0===b.WindCnt2?1:0:b.WindCnt2+=d.WindDelta,this.IsEvenOddFillType(b)?d.WindCnt2=0===d.WindCnt2?
1:0:d.WindCnt2-=b.WindDelta;var x,q,F;b.PolyTyp==g.PolyType.ptSubject?(x=this.m_SubjFillType,F=this.m_ClipFillType):(x=this.m_ClipFillType,F=this.m_SubjFillType);d.PolyTyp==g.PolyType.ptSubject?(q=this.m_SubjFillType,n=this.m_ClipFillType):(q=this.m_ClipFillType,n=this.m_SubjFillType);switch(x){case g.PolyFillType.pftPositive:x=b.WindCnt;break;case g.PolyFillType.pftNegative:x=-b.WindCnt;break;default:x=Math.abs(b.WindCnt)}switch(q){case g.PolyFillType.pftPositive:q=d.WindCnt;break;case g.PolyFillType.pftNegative:q=
-d.WindCnt;break;default:q=Math.abs(d.WindCnt)}if(u&&m)B||h||0!==x&&1!=x||0!==q&&1!=q||b.PolyTyp!=d.PolyTyp&&this.m_ClipType!=g.ClipType.ctXor?this.AddLocalMaxPoly(b,d,e):(this.AddOutPt(b,e),this.AddOutPt(d,e),g.Clipper.SwapSides(b,d),g.Clipper.SwapPolyIndexes(b,d));else if(u){if(0===q||1==q)this.AddOutPt(b,e),g.Clipper.SwapSides(b,d),g.Clipper.SwapPolyIndexes(b,d)}else if(m){if(0===x||1==x)this.AddOutPt(d,e),g.Clipper.SwapSides(b,d),g.Clipper.SwapPolyIndexes(b,d)}else if(!(0!==x&&1!=x||0!==q&&1!=
q||B||h)){switch(F){case g.PolyFillType.pftPositive:u=b.WindCnt2;break;case g.PolyFillType.pftNegative:u=-b.WindCnt2;break;default:u=Math.abs(b.WindCnt2)}switch(n){case g.PolyFillType.pftPositive:m=d.WindCnt2;break;case g.PolyFillType.pftNegative:m=-d.WindCnt2;break;default:m=Math.abs(d.WindCnt2)}if(b.PolyTyp!=d.PolyTyp)this.AddLocalMinPoly(b,d,e);else if(1==x&&1==q)switch(this.m_ClipType){case g.ClipType.ctIntersection:0<u&&0<m&&this.AddLocalMinPoly(b,d,e);break;case g.ClipType.ctUnion:0>=u&&0>=
m&&this.AddLocalMinPoly(b,d,e);break;case g.ClipType.ctDifference:(b.PolyTyp==g.PolyType.ptClip&&0<u&&0<m||b.PolyTyp==g.PolyType.ptSubject&&0>=u&&0>=m)&&this.AddLocalMinPoly(b,d,e);break;case g.ClipType.ctXor:this.AddLocalMinPoly(b,d,e)}else g.Clipper.SwapSides(b,d)}B!=h&&(B&&0<=b.OutIdx||h&&0<=d.OutIdx)&&(g.Clipper.SwapSides(b,d),g.Clipper.SwapPolyIndexes(b,d));B&&this.DeleteFromAEL(b);h&&this.DeleteFromAEL(d)}};g.Clipper.prototype.DeleteFromAEL=function(b){var d=b.PrevInAEL,e=b.NextInAEL;if(null!==
d||null!==e||b==this.m_ActiveEdges)null!==d?d.NextInAEL=e:this.m_ActiveEdges=e,null!==e&&(e.PrevInAEL=d),b.NextInAEL=null,b.PrevInAEL=null};g.Clipper.prototype.DeleteFromSEL=function(b){var d=b.PrevInSEL,e=b.NextInSEL;if(null!==d||null!==e||b==this.m_SortedEdges)null!==d?d.NextInSEL=e:this.m_SortedEdges=e,null!==e&&(e.PrevInSEL=d),b.NextInSEL=null,b.PrevInSEL=null};g.Clipper.prototype.UpdateEdgeIntoAEL=function(b){null===b.Value.NextInLML&&g.Error("UpdateEdgeIntoAEL: invalid call");var d=b.Value.PrevInAEL,
e=b.Value.NextInAEL;b.Value.NextInLML.OutIdx=b.Value.OutIdx;null!==d?d.NextInAEL=b.Value.NextInLML:this.m_ActiveEdges=b.Value.NextInLML;null!==e&&(e.PrevInAEL=b.Value.NextInLML);b.Value.NextInLML.Side=b.Value.Side;b.Value.NextInLML.WindDelta=b.Value.WindDelta;b.Value.NextInLML.WindCnt=b.Value.WindCnt;b.Value.NextInLML.WindCnt2=b.Value.WindCnt2;b.Value=b.Value.NextInLML;b.Value.Curr.X=b.Value.Bot.X;b.Value.Curr.Y=b.Value.Bot.Y;b.Value.PrevInAEL=d;b.Value.NextInAEL=e;g.ClipperBase.IsHorizontal(b.Value)||
this.InsertScanbeam(b.Value.Top.Y)};g.Clipper.prototype.ProcessHorizontals=function(b){for(var d=this.m_SortedEdges;null!==d;)this.DeleteFromSEL(d),this.ProcessHorizontal(d,b),d=this.m_SortedEdges};g.Clipper.prototype.GetHorzDirection=function(b,d,e,h){b.Bot.X<b.Top.X?(e.Value=b.Bot.X,h.Value=b.Top.X,d.Value=g.Direction.dLeftToRight):(e.Value=b.Top.X,h.Value=b.Bot.X,d.Value=g.Direction.dRightToLeft)};g.Clipper.prototype.PrepareHorzJoins=function(b,d){var e=this.m_PolyOuts[b.OutIdx].Pts;b.Side!=g.EdgeSide.esLeft&&
(e=e.Prev);for(var h=0,B=this.m_GhostJoins.length;h<B;++h){var m=this.m_GhostJoins[h];this.HorzSegmentsOverlap(m.OutPt1.Pt,m.OffPt,b.Bot,b.Top)&&this.AddJoin(m.OutPt1,e,m.OffPt)}d&&(g.IntPoint.op_Equality(e.Pt,b.Top)?this.AddGhostJoin(e,b.Bot):this.AddGhostJoin(e,b.Top))};g.Clipper.prototype.ProcessHorizontal=function(b,d){var e,h,B;(function(){e={Value:e};h={Value:h};B={Value:B};var d=this.GetHorzDirection(b,e,h,B);e=e.Value;h=h.Value;B=B.Value;return d}).call(this);for(var m=b,n=null;null!==m.NextInLML&&
g.ClipperBase.IsHorizontal(m.NextInLML);)m=m.NextInLML;for(null===m.NextInLML&&(n=this.GetMaximaPair(m));;){for(var q=b==m,x=this.GetNextInAEL(b,e);null!==x&&!(x.Curr.X==b.Top.X&&null!==b.NextInLML&&x.Dx<b.NextInLML.Dx);){var F=this.GetNextInAEL(x,e);if(e==g.Direction.dLeftToRight&&x.Curr.X<=B||e==g.Direction.dRightToLeft&&x.Curr.X>=h){0<=b.OutIdx&&0!=b.WindDelta&&this.PrepareHorzJoins(b,d);if(x==n&&q){e==g.Direction.dLeftToRight?this.IntersectEdges(b,x,x.Top,!1):this.IntersectEdges(x,b,x.Top,!1);
0<=n.OutIdx&&g.Error("ProcessHorizontal error");return}if(e==g.Direction.dLeftToRight){var H=new g.IntPoint(x.Curr.X,b.Curr.Y);this.IntersectEdges(b,x,H,!0)}else H=new g.IntPoint(x.Curr.X,b.Curr.Y),this.IntersectEdges(x,b,H,!0);this.SwapPositionsInAEL(b,x)}else if(e==g.Direction.dLeftToRight&&x.Curr.X>=B||e==g.Direction.dRightToLeft&&x.Curr.X<=h)break;x=F}0<=b.OutIdx&&0!==b.WindDelta&&this.PrepareHorzJoins(b,d);if(null!==b.NextInLML&&g.ClipperBase.IsHorizontal(b.NextInLML))(function(){b={Value:b};
var d=this.UpdateEdgeIntoAEL(b);b=b.Value;return d}).call(this),0<=b.OutIdx&&this.AddOutPt(b,b.Bot),function(){e={Value:e};h={Value:h};B={Value:B};var d=this.GetHorzDirection(b,e,h,B);e=e.Value;h=h.Value;B=B.Value;return d}.call(this);else break}null!==b.NextInLML?0<=b.OutIdx?(m=this.AddOutPt(b,b.Top),function(){b={Value:b};var d=this.UpdateEdgeIntoAEL(b);b=b.Value;return d}.call(this),0!==b.WindDelta&&(n=b.PrevInAEL,F=b.NextInAEL,null!==n&&n.Curr.X==b.Bot.X&&n.Curr.Y==b.Bot.Y&&0!==n.WindDelta&&0<=
n.OutIdx&&n.Curr.Y>n.Top.Y&&g.ClipperBase.SlopesEqual(b,n,this.m_UseFullRange)?(F=this.AddOutPt(n,b.Bot),this.AddJoin(m,F,b.Top)):null!==F&&F.Curr.X==b.Bot.X&&F.Curr.Y==b.Bot.Y&&0!==F.WindDelta&&0<=F.OutIdx&&F.Curr.Y>F.Top.Y&&g.ClipperBase.SlopesEqual(b,F,this.m_UseFullRange)&&(F=this.AddOutPt(F,b.Bot),this.AddJoin(m,F,b.Top)))):function(){b={Value:b};var d=this.UpdateEdgeIntoAEL(b);b=b.Value;return d}.call(this):null!==n?0<=n.OutIdx?(e==g.Direction.dLeftToRight?this.IntersectEdges(b,n,b.Top,!1):
this.IntersectEdges(n,b,b.Top,!1),0<=n.OutIdx&&g.Error("ProcessHorizontal error")):(this.DeleteFromAEL(b),this.DeleteFromAEL(n)):(0<=b.OutIdx&&this.AddOutPt(b,b.Top),this.DeleteFromAEL(b))};g.Clipper.prototype.GetNextInAEL=function(b,d){return d==g.Direction.dLeftToRight?b.NextInAEL:b.PrevInAEL};g.Clipper.prototype.IsMinima=function(b){return null!==b&&b.Prev.NextInLML!=b&&b.Next.NextInLML!=b};g.Clipper.prototype.IsMaxima=function(b,d){return null!==b&&b.Top.Y==d&&null===b.NextInLML};g.Clipper.prototype.IsIntermediate=
function(b,d){return b.Top.Y==d&&null!==b.NextInLML};g.Clipper.prototype.GetMaximaPair=function(b){var d=null;g.IntPoint.op_Equality(b.Next.Top,b.Top)&&null===b.Next.NextInLML?d=b.Next:g.IntPoint.op_Equality(b.Prev.Top,b.Top)&&null===b.Prev.NextInLML&&(d=b.Prev);return null===d||-2!=d.OutIdx&&(d.NextInAEL!=d.PrevInAEL||g.ClipperBase.IsHorizontal(d))?d:null};g.Clipper.prototype.ProcessIntersections=function(b,d){if(null==this.m_ActiveEdges)return!0;try{this.BuildIntersectList(b,d);if(0==this.m_IntersectList.length)return!0;
if(1==this.m_IntersectList.length||this.FixupIntersectionOrder())this.ProcessIntersectList();else return!1}catch(e){this.m_SortedEdges=null,this.m_IntersectList.length=0,g.Error("ProcessIntersections error")}this.m_SortedEdges=null;return!0};g.Clipper.prototype.BuildIntersectList=function(b,d){if(null!==this.m_ActiveEdges){var e=this.m_ActiveEdges;for(this.m_SortedEdges=e;null!==e;)e.PrevInSEL=e.PrevInAEL,e.NextInSEL=e.NextInAEL,e.Curr.X=g.Clipper.TopX(e,d),e=e.NextInAEL;for(var h=!0;h&&null!==this.m_SortedEdges;){h=
!1;for(e=this.m_SortedEdges;null!==e.NextInSEL;){var B=e.NextInSEL,m=new g.IntPoint;e.Curr.X>B.Curr.X?(m={Value:m},h=this.IntersectPoint(e,B,m),m=m.Value,!h&&e.Curr.X>B.Curr.X+1&&g.Error("Intersection error"),m.Y>b&&(m.Y=b,Math.abs(e.Dx)>Math.abs(B.Dx)?m.X=g.Clipper.TopX(B,b):m.X=g.Clipper.TopX(e,b)),h=new g.IntersectNode,h.Edge1=e,h.Edge2=B,h.Pt.X=m.X,h.Pt.Y=m.Y,this.m_IntersectList.push(h),this.SwapPositionsInSEL(e,B),h=!0):e=B}if(null!==e.PrevInSEL)e.PrevInSEL.NextInSEL=null;else break}this.m_SortedEdges=
null}};g.Clipper.prototype.EdgesAdjacent=function(b){return b.Edge1.NextInSEL==b.Edge2||b.Edge1.PrevInSEL==b.Edge2};g.Clipper.IntersectNodeSort=function(b,d){return d.Pt.Y-b.Pt.Y};g.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer);this.CopyAELToSEL();for(var b=this.m_IntersectList.length,d=0;d<b;d++){if(!this.EdgesAdjacent(this.m_IntersectList[d])){for(var e=d+1;e<b&&!this.EdgesAdjacent(this.m_IntersectList[e]);)e++;if(e==b)return!1;var h=
this.m_IntersectList[d];this.m_IntersectList[d]=this.m_IntersectList[e];this.m_IntersectList[e]=h}this.SwapPositionsInSEL(this.m_IntersectList[d].Edge1,this.m_IntersectList[d].Edge2)}return!0};g.Clipper.prototype.ProcessIntersectList=function(){for(var b=0,d=this.m_IntersectList.length;b<d;b++){var e=this.m_IntersectList[b];this.IntersectEdges(e.Edge1,e.Edge2,e.Pt,!0);this.SwapPositionsInAEL(e.Edge1,e.Edge2)}this.m_IntersectList.length=0};Ja=function(b){return 0>b?Math.ceil(b-.5):Math.round(b)};Ua=
function(b){return 0>b?Math.ceil(b-.5):Math.floor(b+.5)};Aa=function(b){return 0>b?-Math.round(Math.abs(b)):Math.round(b)};Ka=function(b){if(0>b)return b-=.5,-2147483648>b?Math.ceil(b):b|0;b+=.5;return 2147483647<b?Math.floor(b):b|0};g.Clipper.Round=R?Ja:nb?Aa:bb?Ka:Ua;g.Clipper.TopX=function(b,d){return d==b.Top.Y?b.Top.X:b.Bot.X+g.Clipper.Round(b.Dx*(d-b.Bot.Y))};g.Clipper.prototype.IntersectPoint=function(b,d,e){e.Value=new g.IntPoint;var h,B;if(g.ClipperBase.SlopesEqual(b,d,this.m_UseFullRange)||
b.Dx==d.Dx)return d.Bot.Y>b.Bot.Y?(e.Value.X=d.Bot.X,e.Value.Y=d.Bot.Y):(e.Value.X=b.Bot.X,e.Value.Y=b.Bot.Y),!1;if(0===b.Delta.X)e.Value.X=b.Bot.X,g.ClipperBase.IsHorizontal(d)?e.Value.Y=d.Bot.Y:(B=d.Bot.Y-d.Bot.X/d.Dx,e.Value.Y=g.Clipper.Round(e.Value.X/d.Dx+B));else if(0===d.Delta.X)e.Value.X=d.Bot.X,g.ClipperBase.IsHorizontal(b)?e.Value.Y=b.Bot.Y:(h=b.Bot.Y-b.Bot.X/b.Dx,e.Value.Y=g.Clipper.Round(e.Value.X/b.Dx+h));else{h=b.Bot.X-b.Bot.Y*b.Dx;B=d.Bot.X-d.Bot.Y*d.Dx;var m=(B-h)/(b.Dx-d.Dx);e.Value.Y=
g.Clipper.Round(m);Math.abs(b.Dx)<Math.abs(d.Dx)?e.Value.X=g.Clipper.Round(b.Dx*m+h):e.Value.X=g.Clipper.Round(d.Dx*m+B)}if(e.Value.Y<b.Top.Y||e.Value.Y<d.Top.Y){if(b.Top.Y>d.Top.Y)return e.Value.Y=b.Top.Y,e.Value.X=g.Clipper.TopX(d,b.Top.Y),e.Value.X<b.Top.X;e.Value.Y=d.Top.Y;Math.abs(b.Dx)<Math.abs(d.Dx)?e.Value.X=g.Clipper.TopX(b,e.Value.Y):e.Value.X=g.Clipper.TopX(d,e.Value.Y)}return!0};g.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(b){for(var d=this.m_ActiveEdges;null!==d;){var e=this.IsMaxima(d,
b);e&&(e=this.GetMaximaPair(d),e=null===e||!g.ClipperBase.IsHorizontal(e));if(e){var h=d.PrevInAEL;this.DoMaxima(d);d=null===h?this.m_ActiveEdges:h.NextInAEL}else this.IsIntermediate(d,b)&&g.ClipperBase.IsHorizontal(d.NextInLML)?(function(){d={Value:d};var b=this.UpdateEdgeIntoAEL(d);d=d.Value;return b}.call(this),0<=d.OutIdx&&this.AddOutPt(d,d.Bot),this.AddEdgeToSEL(d)):(d.Curr.X=g.Clipper.TopX(d,b),d.Curr.Y=b),this.StrictlySimple&&(h=d.PrevInAEL,0<=d.OutIdx&&0!==d.WindDelta&&null!==h&&0<=h.OutIdx&&
h.Curr.X==d.Curr.X&&0!==h.WindDelta&&(e=this.AddOutPt(h,d.Curr),h=this.AddOutPt(d,d.Curr),this.AddJoin(e,h,d.Curr))),d=d.NextInAEL}this.ProcessHorizontals(!0);for(d=this.m_ActiveEdges;null!==d;){if(this.IsIntermediate(d,b)){e=null;0<=d.OutIdx&&(e=this.AddOutPt(d,d.Top));(function(){d={Value:d};var b=this.UpdateEdgeIntoAEL(d);d=d.Value;return b}).call(this);var h=d.PrevInAEL,B=d.NextInAEL;null!==h&&h.Curr.X==d.Bot.X&&h.Curr.Y==d.Bot.Y&&null!==e&&0<=h.OutIdx&&h.Curr.Y>h.Top.Y&&g.ClipperBase.SlopesEqual(d,
h,this.m_UseFullRange)&&0!==d.WindDelta&&0!==h.WindDelta?(h=this.AddOutPt(h,d.Bot),this.AddJoin(e,h,d.Top)):null!==B&&B.Curr.X==d.Bot.X&&B.Curr.Y==d.Bot.Y&&null!==e&&0<=B.OutIdx&&B.Curr.Y>B.Top.Y&&g.ClipperBase.SlopesEqual(d,B,this.m_UseFullRange)&&0!==d.WindDelta&&0!==B.WindDelta&&(h=this.AddOutPt(B,d.Bot),this.AddJoin(e,h,d.Top))}d=d.NextInAEL}};g.Clipper.prototype.DoMaxima=function(b){var d=this.GetMaximaPair(b);if(null===d)0<=b.OutIdx&&this.AddOutPt(b,b.Top),this.DeleteFromAEL(b);else{for(var e=
b.NextInAEL;null!==e&&e!=d;)this.IntersectEdges(b,e,b.Top,!0),this.SwapPositionsInAEL(b,e),e=b.NextInAEL;-1==b.OutIdx&&-1==d.OutIdx?(this.DeleteFromAEL(b),this.DeleteFromAEL(d)):0<=b.OutIdx&&0<=d.OutIdx?this.IntersectEdges(b,d,b.Top,!1):0===b.WindDelta?(0<=b.OutIdx&&(this.AddOutPt(b,b.Top),b.OutIdx=-1),this.DeleteFromAEL(b),0<=d.OutIdx&&(this.AddOutPt(d,b.Top),d.OutIdx=-1),this.DeleteFromAEL(d)):g.Error("DoMaxima error")}};g.Clipper.ReversePaths=function(b){for(var d=0,e=b.length;d<e;d++)b[d].reverse()};
g.Clipper.Orientation=function(b){return 0<=g.Clipper.Area(b)};g.Clipper.prototype.PointCount=function(b){if(null===b)return 0;var d=0,e=b;do d++,e=e.Next;while(e!=b);return d};g.Clipper.prototype.BuildResult=function(b){g.Clear(b);for(var d=0,e=this.m_PolyOuts.length;d<e;d++){var h=this.m_PolyOuts[d];if(null!==h.Pts){var h=h.Pts.Prev,B=this.PointCount(h);if(!(2>B)){for(var m=Array(B),n=0;n<B;n++)m[n]=h.Pt,h=h.Prev;b.push(m)}}}};g.Clipper.prototype.BuildResult2=function(b){b.Clear();for(var d=0,e=
this.m_PolyOuts.length;d<e;d++){var h=this.m_PolyOuts[d],B=this.PointCount(h.Pts);if(!(h.IsOpen&&2>B||!h.IsOpen&&3>B)){this.FixHoleLinkage(h);var m=new g.PolyNode;b.m_AllPolys.push(m);h.PolyNode=m;m.m_polygon.length=B;for(var h=h.Pts.Prev,n=0;n<B;n++)m.m_polygon[n]=h.Pt,h=h.Prev}}d=0;for(e=this.m_PolyOuts.length;d<e;d++)h=this.m_PolyOuts[d],null!==h.PolyNode&&(h.IsOpen?(h.PolyNode.IsOpen=!0,b.AddChild(h.PolyNode)):null!==h.FirstLeft&&null!=h.FirstLeft.PolyNode?h.FirstLeft.PolyNode.AddChild(h.PolyNode):
b.AddChild(h.PolyNode))};g.Clipper.prototype.FixupOutPolygon=function(b){var d=null;b.BottomPt=null;for(var e=b.Pts;;){if(e.Prev==e||e.Prev==e.Next){this.DisposeOutPts(e);b.Pts=null;return}if(g.IntPoint.op_Equality(e.Pt,e.Next.Pt)||g.IntPoint.op_Equality(e.Pt,e.Prev.Pt)||g.ClipperBase.SlopesEqual(e.Prev.Pt,e.Pt,e.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(e.Prev.Pt,e.Pt,e.Next.Pt)))d=null,e.Prev.Next=e.Next,e=e.Next.Prev=e.Prev;else if(e==d)break;else null===
d&&(d=e),e=e.Next}b.Pts=e};g.Clipper.prototype.DupOutPt=function(b,d){var e=new g.OutPt;e.Pt.X=b.Pt.X;e.Pt.Y=b.Pt.Y;e.Idx=b.Idx;d?(e.Next=b.Next,e.Prev=b,b.Next.Prev=e,b.Next=e):(e.Prev=b.Prev,e.Next=b,b.Prev.Next=e,b.Prev=e);return e};g.Clipper.prototype.GetOverlap=function(b,d,e,h,g,m){b<d?e<h?(g.Value=Math.max(b,e),m.Value=Math.min(d,h)):(g.Value=Math.max(b,h),m.Value=Math.min(d,e)):e<h?(g.Value=Math.max(d,e),m.Value=Math.min(b,h)):(g.Value=Math.max(d,h),m.Value=Math.min(b,e));return g.Value<m.Value};
g.Clipper.prototype.JoinHorz=function(b,d,e,h,m,u){var n=b.Pt.X>d.Pt.X?g.Direction.dRightToLeft:g.Direction.dLeftToRight;h=e.Pt.X>h.Pt.X?g.Direction.dRightToLeft:g.Direction.dLeftToRight;if(n==h)return!1;if(n==g.Direction.dLeftToRight){for(;b.Next.Pt.X<=m.X&&b.Next.Pt.X>=b.Pt.X&&b.Next.Pt.Y==m.Y;)b=b.Next;u&&b.Pt.X!=m.X&&(b=b.Next);d=this.DupOutPt(b,!u);g.IntPoint.op_Inequality(d.Pt,m)&&(b=d,b.Pt.X=m.X,b.Pt.Y=m.Y,d=this.DupOutPt(b,!u))}else{for(;b.Next.Pt.X>=m.X&&b.Next.Pt.X<=b.Pt.X&&b.Next.Pt.Y==
m.Y;)b=b.Next;u||b.Pt.X==m.X||(b=b.Next);d=this.DupOutPt(b,u);g.IntPoint.op_Inequality(d.Pt,m)&&(b=d,b.Pt.X=m.X,b.Pt.Y=m.Y,d=this.DupOutPt(b,u))}if(h==g.Direction.dLeftToRight){for(;e.Next.Pt.X<=m.X&&e.Next.Pt.X>=e.Pt.X&&e.Next.Pt.Y==m.Y;)e=e.Next;u&&e.Pt.X!=m.X&&(e=e.Next);h=this.DupOutPt(e,!u);g.IntPoint.op_Inequality(h.Pt,m)&&(e=h,e.Pt.X=m.X,e.Pt.Y=m.Y,h=this.DupOutPt(e,!u))}else{for(;e.Next.Pt.X>=m.X&&e.Next.Pt.X<=e.Pt.X&&e.Next.Pt.Y==m.Y;)e=e.Next;u||e.Pt.X==m.X||(e=e.Next);h=this.DupOutPt(e,
u);g.IntPoint.op_Inequality(h.Pt,m)&&(e=h,e.Pt.X=m.X,e.Pt.Y=m.Y,h=this.DupOutPt(e,u))}n==g.Direction.dLeftToRight==u?(b.Prev=e,e.Next=b,d.Next=h,h.Prev=d):(b.Next=e,e.Prev=b,d.Prev=h,h.Next=d);return!0};g.Clipper.prototype.JoinPoints=function(b,d,e){var h=b.OutPt1,m=new g.OutPt,u=b.OutPt2,n=new g.OutPt;if((n=b.OutPt1.Pt.Y==b.OffPt.Y)&&g.IntPoint.op_Equality(b.OffPt,b.OutPt1.Pt)&&g.IntPoint.op_Equality(b.OffPt,b.OutPt2.Pt)){for(m=b.OutPt1.Next;m!=h&&g.IntPoint.op_Equality(m.Pt,b.OffPt);)m=m.Next;m=
m.Pt.Y>b.OffPt.Y;for(n=b.OutPt2.Next;n!=u&&g.IntPoint.op_Equality(n.Pt,b.OffPt);)n=n.Next;if(m==n.Pt.Y>b.OffPt.Y)return!1;m?(m=this.DupOutPt(h,!1),n=this.DupOutPt(u,!0),h.Prev=u,u.Next=h,m.Next=n,n.Prev=m):(m=this.DupOutPt(h,!0),n=this.DupOutPt(u,!1),h.Next=u,u.Prev=h,m.Prev=n,n.Next=m);b.OutPt1=h;b.OutPt2=m;return!0}if(n){for(m=h;h.Prev.Pt.Y==h.Pt.Y&&h.Prev!=m&&h.Prev!=u;)h=h.Prev;for(;m.Next.Pt.Y==m.Pt.Y&&m.Next!=h&&m.Next!=u;)m=m.Next;if(m.Next==h||m.Next==u)return!1;for(n=u;u.Prev.Pt.Y==u.Pt.Y&&
u.Prev!=n&&u.Prev!=m;)u=u.Prev;for(;n.Next.Pt.Y==n.Pt.Y&&n.Next!=u&&n.Next!=h;)n=n.Next;if(n.Next==u||n.Next==h)return!1;var q,x;q={Value:q};x={Value:x};d=this.GetOverlap(h.Pt.X,m.Pt.X,u.Pt.X,n.Pt.X,q,x);q=q.Value;x=x.Value;if(!d)return!1;d=new g.IntPoint;h.Pt.X>=q&&h.Pt.X<=x?(d.X=h.Pt.X,d.Y=h.Pt.Y,e=h.Pt.X>m.Pt.X):u.Pt.X>=q&&u.Pt.X<=x?(d.X=u.Pt.X,d.Y=u.Pt.Y,e=u.Pt.X>n.Pt.X):m.Pt.X>=q&&m.Pt.X<=x?(d.X=m.Pt.X,d.Y=m.Pt.Y,e=m.Pt.X>h.Pt.X):(d.X=n.Pt.X,d.Y=n.Pt.Y,e=n.Pt.X>u.Pt.X);b.OutPt1=h;b.OutPt2=u;
return this.JoinHorz(h,m,u,n,d,e)}for(m=h.Next;g.IntPoint.op_Equality(m.Pt,h.Pt)&&m!=h;)m=m.Next;if(q=m.Pt.Y>h.Pt.Y||!g.ClipperBase.SlopesEqual(h.Pt,m.Pt,b.OffPt,this.m_UseFullRange)){for(m=h.Prev;g.IntPoint.op_Equality(m.Pt,h.Pt)&&m!=h;)m=m.Prev;if(m.Pt.Y>h.Pt.Y||!g.ClipperBase.SlopesEqual(h.Pt,m.Pt,b.OffPt,this.m_UseFullRange))return!1}for(n=u.Next;g.IntPoint.op_Equality(n.Pt,u.Pt)&&n!=u;)n=n.Next;if(x=n.Pt.Y>u.Pt.Y||!g.ClipperBase.SlopesEqual(u.Pt,n.Pt,b.OffPt,this.m_UseFullRange)){for(n=u.Prev;g.IntPoint.op_Equality(n.Pt,
u.Pt)&&n!=u;)n=n.Prev;if(n.Pt.Y>u.Pt.Y||!g.ClipperBase.SlopesEqual(u.Pt,n.Pt,b.OffPt,this.m_UseFullRange))return!1}if(m==h||n==u||m==n||d==e&&q==x)return!1;q?(m=this.DupOutPt(h,!1),n=this.DupOutPt(u,!0),h.Prev=u,u.Next=h,m.Next=n,n.Prev=m):(m=this.DupOutPt(h,!0),n=this.DupOutPt(u,!1),h.Next=u,u.Prev=h,m.Prev=n,n.Next=m);b.OutPt1=h;b.OutPt2=m;return!0};g.Clipper.GetBounds=function(b){for(var d=0,e=b.length;d<e&&0==b[d].length;)d++;if(d==e)return new g.IntRect(0,0,0,0);var h=new g.IntRect;h.left=b[d][0].X;
h.right=h.left;h.top=b[d][0].Y;for(h.bottom=h.top;d<e;d++)for(var m=0,n=b[d].length;m<n;m++)b[d][m].X<h.left?h.left=b[d][m].X:b[d][m].X>h.right&&(h.right=b[d][m].X),b[d][m].Y<h.top?h.top=b[d][m].Y:b[d][m].Y>h.bottom&&(h.bottom=b[d][m].Y);return h};g.Clipper.prototype.GetBounds2=function(b){var d=b,e=new g.IntRect;e.left=b.Pt.X;e.right=b.Pt.X;e.top=b.Pt.Y;e.bottom=b.Pt.Y;for(b=b.Next;b!=d;)b.Pt.X<e.left&&(e.left=b.Pt.X),b.Pt.X>e.right&&(e.right=b.Pt.X),b.Pt.Y<e.top&&(e.top=b.Pt.Y),b.Pt.Y>e.bottom&&
(e.bottom=b.Pt.Y),b=b.Next;return e};g.ClipperBase.prototype.PointInPolygon=g.Clipper.prototype.PointInPolygon=function(){var b=arguments,d=b.length;if(2==d){for(var d=b[0],e=b[1],b=0,h=e;;){var g=e.Pt.X,m=e.Pt.Y,n=e.Next.Pt.X,F=e.Next.Pt.Y;if(F==d.Y&&(n==d.X||m==d.Y&&n>d.X==g<d.X))return-1;if(m<d.Y!=F<d.Y)if(g>=d.X)if(n>d.X)b=1-b;else{g=(g-d.X)*(F-d.Y)-(n-d.X)*(m-d.Y);if(0==g)return-1;0<g==F>m&&(b=1-b)}else if(n>d.X){g=(g-d.X)*(F-d.Y)-(n-d.X)*(m-d.Y);if(0==g)return-1;0<g==F>m&&(b=1-b)}e=e.Next;if(h==
e)break}return b}if(3==d){d=b[0];e=b[1];h=b[2];m=e;b=!1;if(h){do m.Pt.Y>d.Y!=m.Prev.Pt.Y>d.Y&&q.op_LessThan(new q(d.X-m.Pt.X),q.op_Division(q.Int128Mul(m.Prev.Pt.X-m.Pt.X,d.Y-m.Pt.Y),new q(m.Prev.Pt.Y-m.Pt.Y)))&&(b=!b),m=m.Next;while(m!=e)}else{do m.Pt.Y>d.Y!=m.Prev.Pt.Y>d.Y&&d.X-m.Pt.X<(m.Prev.Pt.X-m.Pt.X)*(d.Y-m.Pt.Y)/(m.Prev.Pt.Y-m.Pt.Y)&&(b=!b),m=m.Next;while(m!=e)}return b}};g.Clipper.prototype.Poly2ContainsPoly1=function(b,d){var e=b;do{var h=this.PointInPolygon(e.Pt,d);if(0<=h)return 0!=h;
e=e.Next}while(e!=b);return!0};g.Clipper.prototype.FixupFirstLefts1=function(b,d){for(var e=0,h=this.m_PolyOuts.length;e<h;e++){var g=this.m_PolyOuts[e];null!==g.Pts&&g.FirstLeft==b&&this.Poly2ContainsPoly1(g.Pts,d.Pts)&&(g.FirstLeft=d)}};g.Clipper.prototype.FixupFirstLefts2=function(b,d){for(var e=0,h=this.m_PolyOuts,g=h.length,m=h[e];e<g;e++,m=h[e])m.FirstLeft==b&&(m.FirstLeft=d)};g.Clipper.ParseFirstLeft=function(b){for(;null!=b&&null==b.Pts;)b=b.FirstLeft;return b};g.Clipper.prototype.JoinCommonEdges=
function(){for(var b=0,d=this.m_Joins.length;b<d;b++){var e=this.m_Joins[b],h=this.GetOutRec(e.OutPt1.Idx),m=this.GetOutRec(e.OutPt2.Idx);if(null!=h.Pts&&null!=m.Pts){var n;n=h==m?h:this.Param1RightOfParam2(h,m)?m:this.Param1RightOfParam2(m,h)?h:this.GetLowermostRec(h,m);if(this.JoinPoints(e,h,m))if(h==m){h.Pts=e.OutPt1;h.BottomPt=null;m=this.CreateOutRec();m.Pts=e.OutPt2;this.UpdateOutPtIdxs(m);if(this.m_UsingPolyTree){n=0;for(var q=this.m_PolyOuts.length;n<q-1;n++){var F=this.m_PolyOuts[n];null!=
F.Pts&&g.Clipper.ParseFirstLeft(F.FirstLeft)==h&&F.IsHole!=h.IsHole&&this.Poly2ContainsPoly1(F.Pts,e.OutPt2)&&(F.FirstLeft=m)}}this.Poly2ContainsPoly1(m.Pts,h.Pts)?(m.IsHole=!h.IsHole,m.FirstLeft=h,this.m_UsingPolyTree&&this.FixupFirstLefts2(m,h),(m.IsHole^this.ReverseSolution)==0<this.Area(m)&&this.ReversePolyPtLinks(m.Pts)):this.Poly2ContainsPoly1(h.Pts,m.Pts)?(m.IsHole=h.IsHole,h.IsHole=!m.IsHole,m.FirstLeft=h.FirstLeft,h.FirstLeft=m,this.m_UsingPolyTree&&this.FixupFirstLefts2(h,m),(h.IsHole^this.ReverseSolution)==
0<this.Area(h)&&this.ReversePolyPtLinks(h.Pts)):(m.IsHole=h.IsHole,m.FirstLeft=h.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(h,m))}else m.Pts=null,m.BottomPt=null,m.Idx=h.Idx,h.IsHole=n.IsHole,n==m&&(h.FirstLeft=m.FirstLeft),m.FirstLeft=h,this.m_UsingPolyTree&&this.FixupFirstLefts2(m,h)}}};g.Clipper.prototype.UpdateOutPtIdxs=function(b){var d=b.Pts;do d.Idx=b.Idx,d=d.Prev;while(d!=b.Pts)};g.Clipper.prototype.DoSimplePolygons=function(){for(var b=0;b<this.m_PolyOuts.length;){var d=this.m_PolyOuts[b++],
e=d.Pts;if(null!==e){do{for(var h=e.Next;h!=d.Pts;){if(g.IntPoint.op_Equality(e.Pt,h.Pt)&&h.Next!=e&&h.Prev!=e){var m=e.Prev,n=h.Prev;e.Prev=n;n.Next=e;h.Prev=m;m.Next=h;d.Pts=e;m=this.CreateOutRec();m.Pts=h;this.UpdateOutPtIdxs(m);this.Poly2ContainsPoly1(m.Pts,d.Pts)?(m.IsHole=!d.IsHole,m.FirstLeft=d):this.Poly2ContainsPoly1(d.Pts,m.Pts)?(m.IsHole=d.IsHole,d.IsHole=!m.IsHole,m.FirstLeft=d.FirstLeft,d.FirstLeft=m):(m.IsHole=d.IsHole,m.FirstLeft=d.FirstLeft);h=e}h=h.Next}e=e.Next}while(e!=d.Pts)}}};
g.Clipper.Area=function(b){var d=b.length;if(3>d)return 0;for(var e=0,h=0,g=d-1;h<d;++h)e+=(b[g].X+b[h].X)*(b[g].Y-b[h].Y),g=h;return.5*-e};g.Clipper.prototype.Area=function(b){var d=b.Pts;if(null==d)return 0;var e=0;do e+=(d.Prev.Pt.X+d.Pt.X)*(d.Prev.Pt.Y-d.Pt.Y),d=d.Next;while(d!=b.Pts);return.5*e};g.Clipper.SimplifyPolygon=function(b,d){var e=[],h=new g.Clipper(0);h.StrictlySimple=!0;h.AddPath(b,g.PolyType.ptSubject,!0);h.Execute(g.ClipType.ctUnion,e,d,d);return e};g.Clipper.SimplifyPolygons=function(b,
d){"undefined"==typeof d&&(d=g.PolyFillType.pftEvenOdd);var e=[],h=new g.Clipper(0);h.StrictlySimple=!0;h.AddPaths(b,g.PolyType.ptSubject,!0);h.Execute(g.ClipType.ctUnion,e,d,d);return e};g.Clipper.DistanceSqrd=function(b,d){var e=b.X-d.X,h=b.Y-d.Y;return e*e+h*h};g.Clipper.DistanceFromLineSqrd=function(b,d,e){var h=d.Y-e.Y;e=e.X-d.X;d=h*d.X+e*d.Y;d=h*b.X+e*b.Y-d;return d*d/(h*h+e*e)};g.Clipper.SlopesNearCollinear=function(b,d,e,h){return g.Clipper.DistanceFromLineSqrd(d,b,e)<h};g.Clipper.PointsAreClose=
function(b,d,e){var h=b.X-d.X;b=b.Y-d.Y;return h*h+b*b<=e};g.Clipper.ExcludeOp=function(b){var d=b.Prev;d.Next=b.Next;b.Next.Prev=d;d.Idx=0;return d};g.Clipper.CleanPolygon=function(b,d){"undefined"==typeof d&&(d=1.415);var e=b.length;if(0==e)return[];for(var h=Array(e),m=0;m<e;++m)h[m]=new g.OutPt;for(m=0;m<e;++m)h[m].Pt=b[m],h[m].Next=h[(m+1)%e],h[m].Next.Prev=h[m],h[m].Idx=0;m=d*d;for(h=h[0];0==h.Idx&&h.Next!=h.Prev;)g.Clipper.PointsAreClose(h.Pt,h.Prev.Pt,m)?(h=g.Clipper.ExcludeOp(h),e--):g.Clipper.PointsAreClose(h.Prev.Pt,
h.Next.Pt,m)?(g.Clipper.ExcludeOp(h.Next),h=g.Clipper.ExcludeOp(h),e-=2):g.Clipper.SlopesNearCollinear(h.Prev.Pt,h.Pt,h.Next.Pt,m)?(h=g.Clipper.ExcludeOp(h),e--):(h.Idx=1,h=h.Next);3>e&&(e=0);for(var n=Array(e),m=0;m<e;++m)n[m]=new g.IntPoint(h.Pt),h=h.Next;return n};g.Clipper.CleanPolygons=function(b,d){for(var e=Array(b.length),h=0,m=b.length;h<m;h++)e[h]=g.Clipper.CleanPolygon(b[h],d);return e};g.Clipper.Minkowski=function(b,d,e,h){var m=h?1:0,n=b.length,q=d.length;h=[];if(e)for(e=0;e<q;e++){for(var F=
Array(n),x=0,E=b.length,H=b[x];x<E;x++,H=b[x])F[x]=new g.IntPoint(d[e].X+H.X,d[e].Y+H.Y);h.push(F)}else for(e=0;e<q;e++){F=Array(n);x=0;E=b.length;for(H=b[x];x<E;x++,H=b[x])F[x]=new g.IntPoint(d[e].X-H.X,d[e].Y-H.Y);h.push(F)}b=[];for(e=0;e<=q-2+m;e++)for(x=0;x<=n-1;x++)d=[],d.push(h[e%q][x%n]),d.push(h[(e+1)%q][x%n]),d.push(h[(e+1)%q][(x+1)%n]),d.push(h[e%q][(x+1)%n]),g.Clipper.Orientation(d)||d.reverse(),b.push(d);m=new g.Clipper(0);m.AddPaths(b,g.PolyType.ptSubject,!0);m.Execute(g.ClipType.ctUnion,
h,g.PolyFillType.pftNonZero,g.PolyFillType.pftNonZero);return h};g.Clipper.MinkowskiSum=function(b,d,e){return g.Clipper.Minkowski(b,d,!0,e)};g.Clipper.MinkowskiDiff=function(b,d,e){return g.Clipper.Minkowski(b,d,!1,e)};g.Clipper.PolyTreeToPaths=function(b){var d=[];g.Clipper.AddPolyNodeToPaths(b,g.Clipper.NodeType.ntAny,d);return d};g.Clipper.AddPolyNodeToPaths=function(b,d,e){var h=!0;switch(d){case g.Clipper.NodeType.ntOpen:return;case g.Clipper.NodeType.ntClosed:h=!b.IsOpen}0<b.m_polygon.length&&
h&&e.push(b.m_polygon);h=0;b=b.Childs();for(var m=b.length,n=b[h];h<m;h++,n=b[h])g.Clipper.AddPolyNodeToPaths(n,d,e)};g.Clipper.OpenPathsFromPolyTree=function(b){for(var d=new g.Paths,e=0,h=b.ChildCount();e<h;e++)b.Childs()[e].IsOpen&&d.push(b.Childs()[e].m_polygon);return d};g.Clipper.ClosedPathsFromPolyTree=function(b){var d=new g.Paths;g.Clipper.AddPolyNodeToPaths(b,g.Clipper.NodeType.ntClosed,d);return d};fb(g.Clipper,g.ClipperBase);g.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2};g.ClipperOffset=
function(b,d){"undefined"==typeof b&&(b=2);"undefined"==typeof d&&(d=g.ClipperOffset.def_arc_tolerance);this.m_destPolys=new g.Paths;this.m_srcPoly=new g.Path;this.m_destPoly=new g.Path;this.m_normals=[];this.m_StepsPerRad=this.m_miterLim=this.m_cos=this.m_sin=this.m_sinA=this.m_delta=0;this.m_lowest=new g.IntPoint;this.m_polyNodes=new g.PolyNode;this.MiterLimit=b;this.ArcTolerance=d;this.m_lowest.X=-1};g.ClipperOffset.two_pi=6.28318530717959;g.ClipperOffset.def_arc_tolerance=.25;g.ClipperOffset.prototype.Clear=
function(){g.Clear(this.m_polyNodes.Childs());this.m_lowest.X=-1};g.ClipperOffset.Round=g.Clipper.Round;g.ClipperOffset.prototype.AddPath=function(b,d,e){var h=b.length-1;if(!(0>h)){var m=new g.PolyNode;m.m_jointype=d;m.m_endtype=e;if(e==g.EndType.etClosedLine||e==g.EndType.etClosedPolygon)for(;0<h&&g.IntPoint.op_Equality(b[0],b[h]);)h--;m.m_polygon.push(b[0]);var n=0;d=0;for(var q=1;q<=h;q++)g.IntPoint.op_Inequality(m.m_polygon[n],b[q])&&(n++,m.m_polygon.push(b[q]),b[q].Y>m.m_polygon[d].Y||b[q].Y==
m.m_polygon[d].Y&&b[q].X<m.m_polygon[d].X)&&(d=n);if(!(e==g.EndType.etClosedPolygon&&2>n||e!=g.EndType.etClosedPolygon&&0>n)&&(this.m_polyNodes.AddChild(m),e==g.EndType.etClosedPolygon))if(0>this.m_lowest.X)this.m_lowest=new g.IntPoint(0,d);else if(b=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],m.m_polygon[d].Y>b.Y||m.m_polygon[d].Y==b.Y&&m.m_polygon[d].X<b.X)this.m_lowest=new g.IntPoint(this.m_polyNodes.ChildCount()-1,d)}};g.ClipperOffset.prototype.AddPaths=function(b,d,
e){for(var h=0,g=b.length;h<g;h++)this.AddPath(b[h],d,e)};g.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!g.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var b=0;b<this.m_polyNodes.ChildCount();b++){var d=this.m_polyNodes.Childs()[b];(d.m_endtype==g.EndType.etClosedPolygon||d.m_endtype==g.EndType.etClosedLine&&g.Clipper.Orientation(d.m_polygon))&&d.m_polygon.reverse()}else for(b=0;b<this.m_polyNodes.ChildCount();b++)d=this.m_polyNodes.Childs()[b],
d.m_endtype!=g.EndType.etClosedLine||g.Clipper.Orientation(d.m_polygon)||d.m_polygon.reverse()};g.ClipperOffset.GetUnitNormal=function(b,d){var e=d.X-b.X,h=d.Y-b.Y;if(0==e&&0==h)return new g.DoublePoint(0,0);var m=1/Math.sqrt(e*e+h*h);return new g.DoublePoint(h*m,-(e*m))};g.ClipperOffset.prototype.DoOffset=function(b){this.m_destPolys=[];this.m_delta=b;if(g.ClipperBase.near_zero(b))for(var d=0;d<this.m_polyNodes.ChildCount();d++){var e=this.m_polyNodes.Childs()[d];e.m_endtype==g.EndType.etClosedPolygon&&
this.m_destPolys.push(e.m_polygon)}else{this.m_miterLim=2<this.MiterLimit?2/(this.MiterLimit*this.MiterLimit):.5;var d=0>=this.ArcTolerance?g.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(b)*g.ClipperOffset.def_arc_tolerance?Math.abs(b)*g.ClipperOffset.def_arc_tolerance:this.ArcTolerance,h=3.14159265358979/Math.acos(1-d/Math.abs(b));this.m_sin=Math.sin(g.ClipperOffset.two_pi/h);this.m_cos=Math.cos(g.ClipperOffset.two_pi/h);this.m_StepsPerRad=h/g.ClipperOffset.two_pi;0>b&&(this.m_sin=
-this.m_sin);for(d=0;d<this.m_polyNodes.ChildCount();d++){e=this.m_polyNodes.Childs()[d];this.m_srcPoly=e.m_polygon;var m=this.m_srcPoly.length;if(!(0==m||0>=b&&(3>m||e.m_endtype!=g.EndType.etClosedPolygon))){this.m_destPoly=[];if(1==m)if(e.m_jointype==g.JoinType.jtRound)for(var e=1,m=0,n=1;n<=h;n++){this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[0].X+e*b),g.ClipperOffset.Round(this.m_srcPoly[0].Y+m*b)));var q=e,e=e*this.m_cos-this.m_sin*m,m=q*this.m_sin+m*this.m_cos}else for(m=
e=-1,n=0;4>n;++n)this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[0].X+e*b),g.ClipperOffset.Round(this.m_srcPoly[0].Y+m*b))),0>e?e=1:0>m?m=1:e=-1;else{for(n=this.m_normals.length=0;n<m-1;n++)this.m_normals.push(g.ClipperOffset.GetUnitNormal(this.m_srcPoly[n],this.m_srcPoly[n+1]));e.m_endtype==g.EndType.etClosedLine||e.m_endtype==g.EndType.etClosedPolygon?this.m_normals.push(g.ClipperOffset.GetUnitNormal(this.m_srcPoly[m-1],this.m_srcPoly[0])):this.m_normals.push(new g.DoublePoint(this.m_normals[m-
2]));if(e.m_endtype==g.EndType.etClosedPolygon)for(q=m-1,n=0;n<m;n++)q=this.OffsetPoint(n,q,e.m_jointype);else if(e.m_endtype==g.EndType.etClosedLine){q=m-1;for(n=0;n<m;n++)q=this.OffsetPoint(n,q,e.m_jointype);this.m_destPolys.push(this.m_destPoly);this.m_destPoly=[];q=this.m_normals[m-1];for(n=m-1;0<n;n--)this.m_normals[n]=new g.DoublePoint(-this.m_normals[n-1].X,-this.m_normals[n-1].Y);this.m_normals[0]=new g.DoublePoint(-q.X,-q.Y);q=0;for(n=m-1;0<=n;n--)q=this.OffsetPoint(n,q,e.m_jointype)}else{q=
0;for(n=1;n<m-1;++n)q=this.OffsetPoint(n,q,e.m_jointype);e.m_endtype==g.EndType.etOpenButt?(n=m-1,q=new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[n].X+this.m_normals[n].X*b),g.ClipperOffset.Round(this.m_srcPoly[n].Y+this.m_normals[n].Y*b)),this.m_destPoly.push(q),q=new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[n].X-this.m_normals[n].X*b),g.ClipperOffset.Round(this.m_srcPoly[n].Y-this.m_normals[n].Y*b)),this.m_destPoly.push(q)):(n=m-1,q=m-2,this.m_sinA=0,this.m_normals[n]=new g.DoublePoint(-this.m_normals[n].X,
-this.m_normals[n].Y),e.m_endtype==g.EndType.etOpenSquare?this.DoSquare(n,q):this.DoRound(n,q));for(n=m-1;0<n;n--)this.m_normals[n]=new g.DoublePoint(-this.m_normals[n-1].X,-this.m_normals[n-1].Y);this.m_normals[0]=new g.DoublePoint(-this.m_normals[1].X,-this.m_normals[1].Y);q=m-1;for(n=q-1;0<n;--n)q=this.OffsetPoint(n,q,e.m_jointype);e.m_endtype==g.EndType.etOpenButt?(q=new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*b),g.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*
b)),this.m_destPoly.push(q),q=new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*b),g.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*b)),this.m_destPoly.push(q)):(this.m_sinA=0,e.m_endtype==g.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1))}}this.m_destPolys.push(this.m_destPoly)}}}};g.ClipperOffset.prototype.Execute=function(){var b=arguments;if(b[0]instanceof g.PolyTree)if(d=b[0],e=b[1],d.Clear(),this.FixOrientations(),this.DoOffset(e),b=new g.Clipper(0),
b.AddPaths(this.m_destPolys,g.PolyType.ptSubject,!0),0<e)b.Execute(g.ClipType.ctUnion,d,g.PolyFillType.pftPositive,g.PolyFillType.pftPositive);else if(e=g.Clipper.GetBounds(this.m_destPolys),h=new g.Path,h.push(new g.IntPoint(e.left-10,e.bottom+10)),h.push(new g.IntPoint(e.right+10,e.bottom+10)),h.push(new g.IntPoint(e.right+10,e.top-10)),h.push(new g.IntPoint(e.left-10,e.top-10)),b.AddPath(h,g.PolyType.ptSubject,!0),b.ReverseSolution=!0,b.Execute(g.ClipType.ctUnion,d,g.PolyFillType.pftNegative,g.PolyFillType.pftNegative),
1==d.ChildCount()&&0<d.Childs()[0].ChildCount())for(b=d.Childs()[0],d.Childs()[0]=b.Childs()[0],e=1;e<b.ChildCount();e++)d.AddChild(b.Childs()[e]);else d.Clear();else{var d=b[0],e=b[1];g.Clear(d);this.FixOrientations();this.DoOffset(e);b=new g.Clipper(0);b.AddPaths(this.m_destPolys,g.PolyType.ptSubject,!0);if(0<e)b.Execute(g.ClipType.ctUnion,d,g.PolyFillType.pftPositive,g.PolyFillType.pftPositive);else{var e=g.Clipper.GetBounds(this.m_destPolys),h=new g.Path;h.push(new g.IntPoint(e.left-10,e.bottom+
10));h.push(new g.IntPoint(e.right+10,e.bottom+10));h.push(new g.IntPoint(e.right+10,e.top-10));h.push(new g.IntPoint(e.left-10,e.top-10));b.AddPath(h,g.PolyType.ptSubject,!0);b.ReverseSolution=!0;b.Execute(g.ClipType.ctUnion,d,g.PolyFillType.pftNegative,g.PolyFillType.pftNegative);0<d.length&&d.splice(0,1)}}};g.ClipperOffset.prototype.OffsetPoint=function(b,d,e){this.m_sinA=this.m_normals[d].X*this.m_normals[b].Y-this.m_normals[b].X*this.m_normals[d].Y;if(5E-5>this.m_sinA&&-5E-5<this.m_sinA)return d;
1<this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1);if(0>this.m_sinA*this.m_delta)this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[d].X*this.m_delta),g.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[d].Y*this.m_delta))),this.m_destPoly.push(new g.IntPoint(this.m_srcPoly[b])),this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[b].X*this.m_delta),g.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[b].Y*
this.m_delta)));else switch(e){case g.JoinType.jtMiter:e=1+(this.m_normals[b].X*this.m_normals[d].X+this.m_normals[b].Y*this.m_normals[d].Y);e>=this.m_miterLim?this.DoMiter(b,d,e):this.DoSquare(b,d);break;case g.JoinType.jtSquare:this.DoSquare(b,d);break;case g.JoinType.jtRound:this.DoRound(b,d)}return b};g.ClipperOffset.prototype.DoSquare=function(b,d){var e=Math.tan(Math.atan2(this.m_sinA,this.m_normals[d].X*this.m_normals[b].X+this.m_normals[d].Y*this.m_normals[b].Y)/4);this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+
this.m_delta*(this.m_normals[d].X-this.m_normals[d].Y*e)),g.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_delta*(this.m_normals[d].Y+this.m_normals[d].X*e))));this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_delta*(this.m_normals[b].X+this.m_normals[b].Y*e)),g.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_delta*(this.m_normals[b].Y-this.m_normals[b].X*e))))};g.ClipperOffset.prototype.DoMiter=function(b,d,e){e=this.m_delta/e;this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+
(this.m_normals[d].X+this.m_normals[b].X)*e),g.ClipperOffset.Round(this.m_srcPoly[b].Y+(this.m_normals[d].Y+this.m_normals[b].Y)*e)))};g.ClipperOffset.prototype.DoRound=function(b,d){for(var e=Math.atan2(this.m_sinA,this.m_normals[d].X*this.m_normals[b].X+this.m_normals[d].Y*this.m_normals[b].Y),e=g.Cast_Int32(g.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(e))),h=this.m_normals[d].X,m=this.m_normals[d].Y,n,q=0;q<e;++q)this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+
h*this.m_delta),g.ClipperOffset.Round(this.m_srcPoly[b].Y+m*this.m_delta))),n=h,h=h*this.m_cos-this.m_sin*m,m=n*this.m_sin+m*this.m_cos;this.m_destPoly.push(new g.IntPoint(g.ClipperOffset.Round(this.m_srcPoly[b].X+this.m_normals[b].X*this.m_delta),g.ClipperOffset.Round(this.m_srcPoly[b].Y+this.m_normals[b].Y*this.m_delta)))};g.Error=function(b){try{throw Error(b);}catch(d){alert(d.message)}};g.JS={};g.JS.AreaOfPolygon=function(b,d){d||(d=1);return g.Clipper.Area(b)/(d*d)};g.JS.AreaOfPolygons=function(b,
d){d||(d=1);for(var e=0,h=0;h<b.length;h++)e+=g.Clipper.Area(b[h]);return e/(d*d)};g.JS.BoundsOfPath=function(b,d){return g.JS.BoundsOfPaths([b],d)};g.JS.BoundsOfPaths=function(b,d){d||(d=1);var e=g.Clipper.GetBounds(b);e.left/=d;e.bottom/=d;e.right/=d;e.top/=d;return e};g.JS.Clean=function(b,d){if(!(b instanceof Array))return[];var e=b[0]instanceof Array;b=g.JS.Clone(b);if("number"!=typeof d||null===d)return g.Error("Delta is not a number in Clean()."),b;if(0===b.length||1==b.length&&0===b[0].length||
0>d)return b;e||(b=[b]);for(var h=b.length,m,n,q,F,x,E,H,I=[],Y=0;Y<h;Y++)if(n=b[Y],m=n.length,0!==m)if(3>m)q=n,I.push(q);else{q=n;F=d*d;x=n[0];for(H=E=1;H<m;H++)(n[H].X-x.X)*(n[H].X-x.X)+(n[H].Y-x.Y)*(n[H].Y-x.Y)<=F||(q[E]=n[H],x=n[H],E++);x=n[E-1];(n[0].X-x.X)*(n[0].X-x.X)+(n[0].Y-x.Y)*(n[0].Y-x.Y)<=F&&E--;E<m&&q.splice(E,m-E);q.length&&I.push(q)}!e&&I.length?I=I[0]:e||0!==I.length?e&&0===I.length&&(I=[[]]):I=[];return I};g.JS.Clone=function(b){if(!(b instanceof Array)||0===b.length)return[];if(1==
b.length&&0===b[0].length)return[[]];var d=b[0]instanceof Array;d||(b=[b]);var e=b.length,h,g,m,n,q=Array(e);for(g=0;g<e;g++){h=b[g].length;n=Array(h);for(m=0;m<h;m++)n[m]={X:b[g][m].X,Y:b[g][m].Y};q[g]=n}d||(q=q[0]);return q};g.JS.Lighten=function(b,d){if(!(b instanceof Array))return[];if("number"!=typeof d||null===d)return g.Error("Tolerance is not a number in Lighten()."),g.JS.Clone(b);if(0===b.length||1==b.length&&0===b[0].length||0>d)return g.JS.Clone(b);b[0]instanceof Array||(b=[b]);var e,h,
m,n,q,F,x,E,H,I,Y,L,R,Q,T,da=b.length,ha=d*d,Z=[];for(e=0;e<da;e++)if(m=b[e],F=m.length,0!=F){for(n=0;1E6>n;n++){q=[];F=m.length;m[F-1].X!=m[0].X||m[F-1].Y!=m[0].Y?(Y=1,m.push({X:m[0].X,Y:m[0].Y}),F=m.length):Y=0;I=[];for(h=0;h<F-2;h++){x=m[h];H=m[h+1];E=m[h+2];Q=x.X;T=x.Y;x=E.X-Q;L=E.Y-T;if(0!==x||0!==L)R=((H.X-Q)*x+(H.Y-T)*L)/(x*x+L*L),1<R?(Q=E.X,T=E.Y):0<R&&(Q+=x*R,T+=L*R);x=H.X-Q;L=H.Y-T;E=x*x+L*L;E<=ha&&(I[h+1]=1,h++)}q.push({X:m[0].X,Y:m[0].Y});for(h=1;h<F-1;h++)I[h]||q.push({X:m[h].X,Y:m[h].Y});
q.push({X:m[F-1].X,Y:m[F-1].Y});Y&&m.pop();if(I.length)m=q;else break}F=q.length;q[F-1].X==q[0].X&&q[F-1].Y==q[0].Y&&q.pop();2<q.length&&Z.push(q)}b[0]instanceof Array||(Z=Z[0]);"undefined"==typeof Z&&(Z=[[]]);return Z};g.JS.PerimeterOfPath=function(b,d,e){if("undefined"==typeof b)return 0;var h=Math.sqrt,g=0,m,n,q=0,x=0,F=b.length;if(2>F)return 0;for(d&&(b[F]=b[0],F++);--F;)m=b[F],q=m.X,m=m.Y,n=b[F-1],x=n.X,n=n.Y,g+=h((q-x)*(q-x)+(m-n)*(m-n));d&&b.pop();return g/e};g.JS.PerimeterOfPaths=function(b,
d,e){e||(e=1);for(var h=0,m=0;m<b.length;m++)h+=g.JS.PerimeterOfPath(b[m],d,e);return h};g.JS.ScaleDownPath=function(b,d){var e,h;d||(d=1);for(e=b.length;e--;)h=b[e],h.X/=d,h.Y/=d};g.JS.ScaleDownPaths=function(b,d){var e,h,g;d||(d=1);for(e=b.length;e--;)for(h=b[e].length;h--;)g=b[e][h],g.X/=d,g.Y/=d};g.JS.ScaleUpPath=function(b,d){var e,g,m=Math.round;d||(d=1);for(e=b.length;e--;)g=b[e],g.X=m(g.X*d),g.Y=m(g.Y*d)};g.JS.ScaleUpPaths=function(b,d){var e,g,m,n=Math.round;d||(d=1);for(e=b.length;e--;)for(g=
b[e].length;g--;)m=b[e][g],m.X=n(m.X*d),m.Y=n(m.Y*d)};g.ExPolygons=function(){return[]};g.ExPolygon=function(){this.holes=this.outer=null};g.JS.AddOuterPolyNodeToExPolygons=function(b,d){var e=new g.ExPolygon;e.outer=b.Contour();var h=b.Childs(),m=h.length;e.holes=Array(m);var n,q,F,x,E;for(q=0;q<m;q++)for(n=h[q],e.holes[q]=n.Contour(),F=0,x=n.Childs(),E=x.length;F<E;F++)n=x[F],g.JS.AddOuterPolyNodeToExPolygons(n,d);d.push(e)};g.JS.ExPolygonsToPaths=function(b){var d,e,h,m,n=new g.Paths;d=0;for(h=
b.length;d<h;d++)for(n.push(b[d].outer),e=0,m=b[d].holes.length;e<m;e++)n.push(b[d].holes[e]);return n};g.JS.PolyTreeToExPolygons=function(b){var d=new g.ExPolygons,e,h,m;e=0;h=b.Childs();for(m=h.length;e<m;e++)b=h[e],g.JS.AddOuterPolyNodeToExPolygons(b,d);return d}})();
var createCindy=function(){function q(m){if(0===ja)return console.error("Waiting for "+m+" after we finished waiting."),function(){};0>ja&&(ja=0);++ja;return function(){--ja;0>ja&&console.error("Wait count mismatch: "+m);if(0===ja)for(var q=0,n=Ha.length;q<n;)Ha[q++].startup()}}function E(m){var q=E.newInstance(m);0>=ja?q.startup():!1!==m.autostart&&Ha.push(q);return q}var ja=-1,Ha=[];"undefined"===typeof document||"undefined"===typeof window||"undefined"===typeof document.addEventListener||"undefined"!==
typeof window.cindyDontWait&&!0===window.cindyDontWait||document.addEventListener("DOMContentLoaded",q("DOMContentLoaded"));var za=null,Da=null,ga={};E.getBaseDir=function(){if(null!==za)return za;for(var m=document.getElementsByTagName("script"),q=0;q<m.length;++q){var n=m[q],E=n.src;if(E){var L=/Cindy\.js$/.exec(E);if(L)return za=E.substr(0,L.index),console.log("Will load extensions from "+za),Da=n,za}}console.error("Could not find <script> tag for Cindy.js");return za=Da=!1};E.addNewScript=function(m,
q){q||console.error.bind(console);var n=E.getBaseDir();if(!1===n)return!1;var I=document.createElement("script");I.src=n+m;var n=Da.nextSibling,L=Da.parentElement;n?L.insertBefore(I,n):L.appendChild(I);return I};E.loadScript=function(m,q,n,I){if(window[m])return n(),!0;I||(I=console.error.bind(console));var L=ga[m];if(!L){L=E.addNewScript(q,I);if(!1===L)return I("Can't load additional components."),!1;ga[m]=L}L.addEventListener("load",n);L.addEventListener("error",I);return null};E._autoLoadingPlugin=
{};E.autoLoadPlugin=function(m,q,n){if(E._pluginRegistry[m])return n(),!0;var I=E._autoLoadingPlugin[m];if(!I){q||(q=m+"-plugin.js");I=E._autoLoadingPlugin[m]=[];m=E.addNewScript(q);if(!1===m)return!1;m.addEventListener("error",console.error.bind(console))}I.push(n);return null};var m={ctype:"undefined"};E.waitFor=q;E._pluginRegistry={};E.instances=[];E.registerPlugin=function(m,q,n){if(1!==m)return console.error("Plugin API version "+m+" not supported"),!1;E._pluginRegistry[q]=n;(E._autoLoadingPlugin[q]||
[]).forEach(function(m){m()})};E.newInstance=function(q){var E,n,I,L,Z,ga,ja;function za(a){if(a){for(var k=0;k<a.length;k++){var c=a[k],t=Object.keys(c)[0];"scale"===t&&(pb=c.scale,w[t](c.scale));if("translate"===t)w[t](c.translate[0],c.translate[1]);"scaleAndOrigin"===t&&(pb=c[t][0]/25,w[t].apply(null,c[t]));"visibleRect"===t&&(w[t].apply(null,c[t]),pb=w.drawingstate.initialmatrix.a/25)}w.createnewbackup()}}function g(){Db=!0;if(0===qb){void 0!==q.csconsole&&(ka=q.csconsole);ka=null===ka?new da:
!0===ka?new Ha:"string"===typeof ka?new Ia(ka):"object"===typeof ka&&"function"===typeof ka.appendChild?new Ia(ka):new da;gb=[100,100];var a=null,k=q.transform;if(q.ports&&0<q.ports.length){var c=q.ports[0];(a=c.element)||(a=document.getElementById(c.id));"window"===c.fill?(a.setAttribute("width",window.innerWidth),a.setAttribute("height",window.innerHeight)):c.width&&c.height&&(a.setAttribute("width",c.width),a.setAttribute("height",c.height));c.background&&(a.style.backgroundColor=c.background);
void 0!==c.transform&&(k=c.transform)}a||(a=q.canvas)||"undefined"===typeof document||(a=document.getElementById(q.canvasname));a&&(A=a.getContext("2d"),A.setLineDash||(A.setLineDash=function(){}));var t=q.scripts,b=null;"string"===typeof t&&t.search(/\*/)&&(b=t);"object"!==typeof t&&(t=null);"move keydown mousedown mouseup mousedrag init tick draw simulationstep simulationstart simulationstop".split(" ").forEach(function(a){var c;if(null!==t&&t[a])c=t[a];else{c=a+"script";if(q[c])c=document.getElementById(q[c]);
else if(b){if(c=document.getElementById(b.replace(/\*/,a)),!c)return}else return;c=c.text}c=ib(c,!1);"error"===c.ctype?console.error("Error compiling "+a+" script: "+c.message):ea[a]=c});q.grid&&0!==q.grid&&(La=q.grid);q.snap&&(hc=q.snap);a&&(fa=a.width,V=a.height,za(k),w.drawingstate.matrix.ty-=V,w.drawingstate.initialmatrix.ty-=V,k=1,"undefined"!==typeof window&&window.devicePixelRatio&&(k=window.devicePixelRatio),c=A.webkitBackingStorePixelRatio||A.mozBackingStorePixelRatio||A.msBackingStorePixelRatio||
A.oBackingStorePixelRatio||A.backingStorePixelRatio||1,k!==c&&(k/=c,a.width=fa*k,a.height=V*k,a.style.width||(a.style.width=fa+"px"),a.style.height||(a.style.height=V+"px"),A.scale(k,k)));ja=ga=Z=L=I=n=E=void 0;k=0;la={};q.geometry||(q.geometry=[]);ad(q.geometry);q.behavior||(q.behavior=[]);"function"===typeof Fb&&Fb(q.behavior);for(var d in q.images)k=q.images[d],la[d]=new Image,la[d].ready=!1,la[d].onload=function(){la[d].ready=!0;e()},la[d].src=k;ma.canvas=a;if(q.oninit)q.oninit(ma);if(q.exclusive)for(k=
ua.instances.length;0<k;)ua.instances[--k].shutdown();ua.instances.push(ma);q.use&&q.use.forEach(function(a){r.use$1([v.wrap(a)],{})});ic.convexhull3d$1&&Da("quickhull3d","quickhull3d/quickhull3d.nocache.js");Q()}}function Da(a,k){var c=null;q.plugins&&(c=q.plugins[a]);c||(c=ua._pluginRegistry[a]);c?r.use$1([v.wrap(a)],{}):(++jc,ua.autoLoadPlugin(a,k,function(){r.use$1([v.wrap(a)],{});Q()}))}function Q(){0===--jc&&(z(ea.init),q.autoplay&&Ja(),ma.canvas&&fb(ma.canvas,q))}function R(){null!==jb&&(ba.set(jb.state),
Object.keys(jb.speeds).forEach(function(a){var k=n[a];"undefined"!==typeof k.behavior&&(a=jb.speeds[a],k.behavior.vx=a[0],k.behavior.vy=a[1],k.behavior.vz=a[2],k.behavior.fx=0,k.behavior.fy=0,k.behavior.fz=0)}),bd())}function Ja(){if(!Ba){if(rb){var a=Ma.backup;a.set(ba);for(var k={},c=0;c<I.length;c++){var t=I[c];"undefined"!==typeof t.behavior&&(k[t.name]=[t.behavior.vx,t.behavior.vy,t.behavior.vz])}jb={state:a,speeds:k};rb=!1}"function"===typeof Fb&&Gb&&cd(oa);Ba=!0;z(ea.simulationstart);d()}}
function bb(){Ba&&(Ba=!1)}function Ua(){rb||(Ba&&(z(ea.simulationstop),Ba=!1),rb=!0,R())}function Aa(){if(!Hb){Hb=!0;for(var a=ua.instances.length;0<a;)if(ua.instances[--a]===ma){ua.instances.splice(a,1);break}for(a=Va.length;0<a;)try{Va[--a]()}catch(k){console.error(k)}}}function Ka(a){this["in"]=function(a,c){console.log(a);c?this.append(this.createTextNode("span","blue",a)):this.append(this.createTextNode("p","blue",a))};this.out=function(a,c){console.log(a);c?this.append(this.createTextNode("span",
"red",a)):this.append(this.createTextNode("p","red",a))};this.err=function(a,c){console.log(a);c?this.append(this.createTextNode("span","red",a)):this.append(this.createTextNode("p","red",a))};this.createTextNode=function(a,c,t){return"undefined"!==typeof document?(a=document.createElement(a),a.appendChild(document.createTextNode(t)),a.style.color=c,a):t+"\n"}}function Ha(){var a=this,k,c=document.createElement("div"),t;c.innerHTML='<div id="console" style="border-top: 1px solid #333333; bottom: 0px; position: absolute; width: 100%;"><div id="log" style="height: 150px; overflow-y: auto;"></div><input id="cmd" type="text" style="box-sizing: border-box; height: 30px; width: 100%;"></div>';
document.body.appendChild(c);k=document.getElementById("cmd");t=document.getElementById("log");k.onkeydown=function(c){13===c.keyCode&&""!==k.value&&(a["in"](k.value),c=r.parse$1([v.wrap(k.value)],[]),c=z(c),console.log(H(c)),"undefined"!==c.ctype&&ka.out(H(c)),k.value="",t.scrollTop=t.scrollHeight)};this.append=function(a){t.appendChild(a)};this.clear=function(){t.innerHTML=""}}function Ia(a){var k=a;"string"===typeof a&&(k=document.getElementById(a));this.append=function(a){k.appendChild(a)};this.clear=
function(){k.innerHTML=""}}function da(){this.append=function(a){};this.clear=function(){}}function T(a){for(var k=null,c=1E6,t,b=0;b<ja.length;b++){var d=ja[b];if(!d.pinned&&!1!==d.visible){var e,g,h,m=w.drawingstate.matrix.sdet;if("P"===d.kind){var p=f.normalizeZ(d.homog);if(!f._helper.isAlmostReal(p))continue;e=p.value[0].value.real-a.x;g=p.value[1].value.real-a.y;h=Math.sqrt(e*e+g*g);if(d.narrow&&h>("number"===typeof d.narrow?d.narrow:20)/m)continue}else"C"===d.kind?(g=n[d.args[0]],h=d.radius,
e=l.div(g.homog.value[0],g.homog.value[2]).value.real,g=l.div(g.homog.value[1],g.homog.value[2]).value.real,e-=a.x,g-=a.y,h=Math.sqrt(e*e+g*g)-h.value.real,g=e=0,0>h&&(h=-h),h+=30/m):"L"===d.kind&&(e=d.homog,h=l,g=h.add(h.mult(e.value[0],h.conjugate(e.value[0])),h.mult(e.value[1],h.conjugate(e.value[1]))),g=f.scaldiv(h.sqrt(g),e),h=g.value[0].value.real*a.x+g.value[1].value.real*a.y+g.value[2].value.real,e=-g.value[0].value.real*h,g=-g.value[1].value.real*h,0>h&&(h=-h),h+=1);h<c+.2/m&&(c=h,k=d,t=
{x:e,y:g})}}console.log("Moving "+(k?k.name:"nothing"));return null===k?null:{mover:k,offset:t,prev:{x:a.x,y:a.y}}}function ha(a,k,c,t){void 0===t&&(t=!1);Va.push(function(){a.removeEventListener(k,c,t)});a.addEventListener(k,c,t)}function fb(a,k){function c(c){var k=a.getBoundingClientRect();c=w.to(c.clientX-k.left-a.clientLeft+.5,c.clientY-k.top-a.clientTop+.5);S.prevx=S.x;S.prevy=S.y;S.x=c[0];S.y=c[1];gb[0]=S.x;gb[1]=S.y;S.moved=!0}function t(a){S.down=!1;ca=void 0;Wa();e();z(ea.mouseup);a.preventDefault()}
var b=null;"undefined"!==typeof MutationObserver&&(b=MutationObserver);b||"undefined"===typeof WebKitMutationObserver||(b=WebKitMutationObserver);b?(b=new b(function(c){document.body.contains(a)||Aa()}),b.observe(document.documentElement,{childList:!0,subtree:!0}),Va.push(function(){b.disconnect()})):(ha(a,"DOMNodeRemovedFromDocument",Aa),ha(a,"DOMNodeRemoved",Aa));!0===k.keylistener?ha(document,"keydown",function(a){h(a);return!1}):ea.keydown&&(a.setAttribute("tabindex","0"),ha(a,"mousedown",function(){a.focus()}),
ha(a,"keydown",function(a){9!==a.keyCode&&(h(a),a.preventDefault())}));ha(a,"mousedown",function(a){S.button=a.which;c(a);z(ea.mousedown);ca=T(S);d();S.down=!0;a.preventDefault()});ha(a,"mouseup",function(a){S.down=!1;ca=void 0;Wa();z(ea.mouseup);e();a.preventDefault()});ha(a,"mousemove",function(a){c(a);S.down?z(ea.mousedrag):z(ea.mousemove);a.preventDefault()});ha(a,"touchstart",function(a){c(a.targetTouches[0]);z(ea.mousedown);S.down=!0;ca=T(S);d();a.preventDefault()},!1);ha(a,"touchmove",function(a){c(a.targetTouches[0]);
S.down?z(ea.mousedrag):z(ea.mousemove);a.preventDefault()},!0);ha(a,"touchend",t,!1);"undefined"!==typeof document&&document.body&&ha(document.body,"touchcancel",t,!1);e()}function b(){if(Hb)return!0;Ba&&(Gb&&"undefined"!==typeof na&&na.tick(),Ba&&z(ea.tick));if(Ba||S.moved)S.moved=!1,e();sb=Ba||S.down;return!sb}function d(){sb||(sb=!0,Ib.timer(b))}function e(){w.reset();A.save();A.clearRect(0,0,fa,V);0!==La&&dd.drawgrid(l.real(La));ed();w.greset();fd();var a;for(a=0;a<Z.length;a++)if(Z[a].isArc){var k=
Z[a];if(k.isshowing&&!1!==k.visible){var c={};c.color=k.color;c.alpha=k.alpha;c.size=k.size;D.drawarc(k,c,k.filled?"F":"D")}}else k=Z[a],k.isshowing&&!1!==k.visible&&(c={},c.color=k.color,c.alpha=k.alpha,c.size=k.size,D.drawconic(k.matrix,c));for(a=0;a<L.length;a++)a:{var k=L[a],t=void 0,c=void 0;if(k.isshowing&&!1!==k.visible&&f._helper.isAlmostReal(k.homog))if("S"===k.kind)r.draw$2([k.startpos,k.endpos],{overhang:k.overhang,dashtype:k.dashtype,size:k.size,color:k.color,alpha:k.alpha,arrow:k.arrow,
arrowsize:k.arrowsize,arrowposition:k.arrowposition,arrowshape:k.arrowshape,arrowsides:k.arrowsides});else if("end"===k.clip.value&&"Join"===k.type)t=n[k.args[0]],c=n[k.args[1]],r.draw$2([t.homog,c.homog],{overhang:k.overhang,dashtype:k.dashtype,size:k.size,color:k.color,alpha:k.alpha});else{if("inci"===k.clip.value){for(var t=[1E6,0],c=[-1E6,0],b=[1E6,0],d=[-1E6,0],e=0;e<k.incidences.length;e++){var g=n[k.incidences[e]].homog,h=g.value[0],m=g.value[1],p=g.value[2];l._helper.isAlmostZero(p)||(h=l.div(h,
p),m=l.div(m,p),l._helper.isAlmostReal(h)&&l._helper.isAlmostReal(m)&&(h.value.real<t[0]&&(t=[h.value.real,g]),h.value.real>c[0]&&(c=[h.value.real,g]),m.value.real<b[0]&&(b=[m.value.real,g]),m.value.real>d[0]&&(d=[m.value.real,g])))}c[0]-t[0]>d[0]-b[0]?(t=t[1],c=c[1]):(t=b[1],c=d[1]);if(t!==c){r.draw$2([t,c],{dashtype:k.dashtype,size:k.size,color:k.color,alpha:k.alpha,overhang:k.overhang});break a}}r.draw$1([k.homog],{dashtype:k.dashtype,size:k.size,color:k.color,alpha:k.alpha})}}for(a=0;a<I.length;a++)k=
I[a],k.isshowing&&!1!==k.visible&&f._helper.isAlmostReal(k.homog)&&(c=k.color,k.behavior&&(c=k.color),r.draw$1([k.homog],{size:k.size,color:c,alpha:k.alpha}),k.labeled&&(c=k.printname||k.name||"P",d=k.labelpos||{x:3,y:3},t=k.textsize||12,b=!0===k.textbold,e=!0===k.textitalics,g=k.text_fontfamily||ra.fontFamily,h=d.x*d.x+d.y*d.y,m=1,0<h&&(m=1+k.size.value.real/Math.sqrt(h)),r.drawtext$2([k.homog,v.wrap(c)],{x_offset:v.wrap(m*d.x),y_offset:v.wrap(m*d.y),size:v.wrap(t),bold:v.wrap(b),italics:v.wrap(e),
family:v.wrap(g)})));for(a=0;a<ga.length;a++)gd(ga[a]);A.restore()}function h(a){a=window.event?event:a;a=a.charCode?a.charCode:a.keyCode;kc=String.fromCharCode(a);lc=a;z(ea.keydown);e()}function B(a,k){if(k in a)return k;k=k.charAt(0).toUpperCase()+k.substring(1);for(var c=0,t=mc.length;c<t;++c){var b=mc[c]+k;if(b in a)return b}}function u(){var a=Ta(),a=ac()-a;24<a?(isFinite(a)&&(clearTimeout(tb),tb=setTimeout(u,a)),ub=0):(ub=1,nc(u))}function Ta(){var a=Date.now();for(Na=vb;Na;)a>=Na.t&&(Na.f=
Na.c(a-Na.t)),Na=Na.n;return a}function ac(){for(var a,k=vb,c=Infinity;k;)k.f?k=a?a.n=k.n:vb=k.n:(k.t<c&&(c=k.t),k=(a=k).n);wb=a;return c}function x(a){var k=a.value;a=k[0].value;var c=k[1].value,k=k[2].value;return f.turnIntoCSList([a[0],l.add(a[1],c[0]),l.add(a[2],k[0]),c[1],l.add(c[2],k[1]),k[2]])}function $a(a){var k=!0;return function(c,t){k&&(console.error("Operator "+a+" is not supported yet."),k=!1);return m}}function H(a){if("undefined"===typeof a)return"_??_";if(null===a)return"_???_";if("undefined"===
a.ctype)return"___";if("number"===a.ctype)return l.niceprint(a);if("string"===a.ctype||"boolean"===a.ctype)return a.value;if("list"===a.ctype){for(var k="[",c=0;c<a.value.length;c++)k+=H(z(a.value[c])),c!==a.value.length-1&&(k+=", ");return k+"]"}return"function"===a.ctype?"FUNCTION":"infix"===a.ctype?"INFIX":"modifier"===a.ctype?a.key+"->"+H(a.value):"shape"===a.ctype?a.type:"error"===a.ctype?"Error: "+a.message:"variable"===a.ctype?H(J.getvar(a.name)):"geo"===a.ctype?a.value.name:"_?_"}function aa(a){a=
a.value.slice();var k=a.length-1,c=l.inv(a[k]);a.length=k;for(var t=0;t<k;++t)a[t]=l.mult(c,a[t]);return f.turnIntoCSList(a)}function Ab(a,k){var c="undefined"===a[0].ctype,t="undefined"===a[1].ctype,b=z(a[1]);if(c||t)return m;"variable"===a[0].ctype?J.setvar(a[0].name,b):"infix"===a[0].ctype?"_"===a[0].oper?D.assigntake(a[0],b):console.error("Can't use infix expression as lvalue"):"field"===a[0].ctype?D.assigndot(a[0],b):"function"===a[0].ctype&&"genList"===a[0].oper?"list"===b.ctype?D.assignlist(a[0].args,
b.value):console.error("Expected list in rhs of assignment"):console.error("Left hand side of assignment is not a recognized lvalue");return b}function ob(a,k){var c=z(a[0]),t=z(a[1]);if(c.ctype===t.ctype){if("number"===c.ctype)return v.bool(c.value.real===t.value.real&&c.value.imag===t.value.imag);if("string"===c.ctype||"boolean"===c.ctype)return v.bool(c.value===t.value);if("list"===c.ctype)return f.equals(c,t);if("geo"===c.ctype)return v.bool(c.value===t.value)}return{ctype:"boolean",value:!1}}
function dc(a,k){return v.not(ob(a,k))}function Bb(a,k){var c=C(a[0]),t=C(a[1]);return"number"===c.ctype&&"number"===t.ctype?{ctype:"boolean",value:l._helper.isAlmostEqual(c,t)}:"string"===c.ctype&&"string"===t.ctype||"boolean"===c.ctype&&"boolean"===t.ctype?{ctype:"boolean",value:c.value===t.value}:"list"===c.ctype&&"list"===t.ctype?f.almostequals(c,t):{ctype:"boolean",value:!1}}function ec(a,k){var c=C(a[0]),t=C(a[1]);return"boolean"===c.ctype&&"boolean"===t.ctype?{ctype:"boolean",value:c.value&&
t.value}:m}function fc(a,k){var c=C(a[0]),t=C(a[1]);return"boolean"===c.ctype&&"boolean"===t.ctype?{ctype:"boolean",value:c.value||t.value}:m}function gc(a,k){var c=a[0];"void"!==c.ctype&&(c=C(c));var t=C(a[1]),b=v.add(c,t);"Angle"===c.usage&&"Angle"===t.usage&&(b=v.withUsage(b,"Angle"));return b}function Cb(a,k){var c=a[0];"void"!==c.ctype&&(c=C(c));var t=C(a[1]),b=v.sub(c,t);"Angle"===c.usage&&"Angle"===t.usage&&(b=v.withUsage(b,"Angle"));return b}function oc(a,k){var c=C(a[0]),t=C(a[1]),b=v.mult(c,
t);"Angle"!==c.usage||t.usage?"Angle"!==t.usage||c.usage||(b=v.withUsage(b,"Angle")):b=v.withUsage(b,"Angle");return b}function pc(a,k){var c=C(a[0]),t=C(a[1]);l._helper.isZero(t)&&ka.err("WARNING: Division by zero!");var b=v.div(c,t);"Angle"!==c.usage||t.usage?"Angle"!==t.usage||c.usage||(b=v.withUsage(b,"Angle")):b=v.withUsage(b,"Angle");return b}function qc(a,k){var c=C(a[0]),t=C(a[1]);return"number"===c.ctype&&"number"===t.ctype?l.pow(c,t):m}function rc(a,k){var c=M(a[0]),t=M(a[1]);if(c!==m&&
t!==m){var b=f.cross(c,t);"Point"===c.usage&&"Point"===t.usage&&(b=v.withUsage(b,"Line"));"Line"===c.usage&&"Line"===t.usage&&(b=v.withUsage(b,"Point"));return b}return m}function Jb(a){var k=a.length;if(0===k)return[];if(1===k)return[0];if(2===k)return a[0][0]+a[1][1]<=a[0][1]+a[1][0]?[0,1]:[1,0];if(4<k)return hd(a);for(var c=id[k],t=Number.POSITIVE_INFINITY,b=c[0],d=0;d<c.length;++d){for(var f=c[d],e=0,l=0;l<k;++l)e+=a[l][f[l]];e<t&&(t=e,b=f)}return b}function hd(a){function k(){return{matched:-1,
prev:-1,start:-1,cost:0,used:!1,leaf:!1}}function c(a){for(var k=0;k<d;++k)0<h[a][k]||g[k].used||(g[k].used=!0,c(g[k].matched))}function t(a){for(var c=0;c<d;++c)0<h[c][a]||l[c].used||(l[c].used=!0,t(l[c].matched))}var b=Math.abs,d=a.length,f,e,l=Array(d),g=Array(d),h=Array(d);for(f=0;f<d;++f)h[f]=Array(d);for(f=0;f<d;++f)for(l[f]=k(),g[f]=k(),l[f].cost=a[f][0],e=1;e<d;++e)l[f].cost>a[f][e]&&(l[f].cost=a[f][e]);for(;;){for(f=0;f<d;++f)for(e=0;e<d;++e)h[f][e]=a[f][e]-l[f].cost-g[e].cost,h[f][e]<1E-14*
(b(a[f][e])+b(l[f].cost)+b(g[e].cost))&&(h[f][e]=0);for(f=0;f<d;++f)l[f].matched=g[f].matched=-1;for(var m=0;;){for(f=0;f<d;++f)l[f].used=l[f].leaf=g[f].used=g[f].leaf=!1,-1===l[f].matched&&(l[f].start=f,l[f].used=l[f].leaf=!0,l[f].prev=-1);for(var n=!1,p=!1;!p;){for(f=0;f<d;++f)if(l[f].leaf)for(l[f].leaf=!1,e=0;e<d;++e)if(!(g[e].used||0<h[f][e])&&l[f].matched!==e&&(g[e].prev=f,g[e].start=l[f].start,g[e].used=g[e].leaf=!0,-1===g[e].matched)){l[g[e].start].prev=e;n=!0;break}if(n)break;p=!0;for(e=0;e<
d;++e)g[e].leaf&&(g[e].leaf=!1,f=g[e].matched,l[f].used||(l[f].prev=e,l[f].start=g[e].start,l[f].used=l[f].leaf=!0,p=!1))}if(!n)break;for(n=0;n<d;++n)if(-1===l[n].matched&&-1!==l[n].prev){e=l[n].prev;do f=g[e].prev,g[e].matched=f,l[f].matched=e,e=l[f].prev;while(f!==n);++m}}if(m===d)break;for(f=0;f<d;++f)l[f].used=l[f].leaf=g[f].used=g[f].leaf=!1;for(f=0;f<d;++f)-1===l[f].matched&&c(f);for(e=0;e<d;++e)-1===g[e].matched&&t(e);for(f=0;f<d;++f)-1===l[f].matched||l[f].used||g[l[f].matched].used||(l[f].used=
!0);m=Number.POSITIVE_INFINITY;for(f=0;f<d;++f)if(!l[f].used)for(e=0;e<d;++e)g[e].used||m>h[f][e]&&(m=h[f][e]);for(f=0;f<d;++f)l[f].used||(l[f].cost+=m),g[f].used&&(g[f].cost-=m)}a=Array(d);for(f=0;f<d;++f)e=l[f].matched,a[f]=e;return a}function Kb(a,k){var c=z(a[0]),t=C(a[1]);if("number"===t.ctype){var b=Math.floor(t.value.real);if("list"===c.ctype||"string"===c.ctype)return 0>b&&(b=c.value.length+b+1),0<b&&b<c.value.length+1?"list"===c.ctype?c.value[b-1]:{ctype:"string",value:c.value.charAt(b-1)}:
m}if("list"===t.ctype){for(var b=[],d=0;d<t.value.length;d++){var e=C(t.value[d]);b[d]=Kb([c,e],[])}return f.turnIntoCSList(b)}return m}function sc(a,k){var c=z(a[0]),t=z(a[1]);return"list"===c.ctype&&"list"===t.ctype?f.concat(c,t):"shape"===c.ctype&&"shape"===t.ctype?D.shapeconcat(c,t):m}function tc(a,k){var c=z(a[0]),t=z(a[1]);return"list"===c.ctype&&"list"===t.ctype?f.set(f.common(c,t)):"shape"===c.ctype&&"shape"===t.ctype?D.shapecommon(c,t):m}function uc(a,k){var c=z(a[0]),t=z(a[1]);return"list"===
c.ctype&&"list"===t.ctype?f.remove(c,t):"shape"===c.ctype&&"shape"===t.ctype?D.shaperemove(c,t):m}function vc(a,k){var c=z(a[0]),t=z(a[1]);return"list"===c.ctype?f.append(c,t):m}function wc(a,k){var c=z(a[0]),t=z(a[1]);return"list"===t.ctype?f.prepend(c,t):m}function Lb(a,k){a|=0;k|=0;if(0===a&&0===k)return 0;for(;0!==k;){var c=a;a=k;k=c%k|0}return a}function jd(a){return 1===a?0:1}function kd(a){return a.replace(/[^A-Za-z0-9 \u0080-\uffff]/ig,"\\$&")}function xc(a){return"("+a.map(kd).join("|")+
")"}function X(a,k,c){var t=a;k&&(t=t+" at "+k.row+":"+k.col);c&&(t=t+": \u2018"+c+"\u2019");t=Error(t);t.name="CindyScriptParseError";t.description=a;t.location=k;t.text=c;return t}function Xa(a){this.input=a;this.re=new RegExp(yc,"g");for(var k=[],c=a.indexOf("\n")+1;c;)k.push(c),c=a.indexOf("\n",c)+1;k.push(a.length);this.bols=k;this.bol=this.pos=0;this.line=1}function xb(a){var k=a[a.length-2],c=a[a.length-3],t=a[a.length-1];if(c){if(c.isSuperscript&&k.precedence<=c.precedence)throw X("Operator not allowed after superscript",
k.start,k.text);if(t){if(!k.op.infix)throw X("Operator may not be used infix",k.start,k.text);}else if(!k.op.postfix)throw X("Operator may not be used postfix",k.start,k.text);}else if(t){if(!k.op.prefix)throw X("Operator may not be used prefix",k.start,k.text);}else if(!k.op.bare)throw X("Operator without operands",k.start,k.text);k.ctype="infix";k.oper=k.op.sym;k.args=[c,t];a.splice(a.length-3,3,k)}function zc(a,k,c,t){a.length&1||a.push(null);for(c=sa[c];3<=a.length&&a[a.length-2].precedence<=
c.precedence;)xb(a);a.push({op:c,precedence:c.precedence+(c.rassoc?1:0),start:k.start,end:k.end,text:k.text,rawtext:k.rawtext});c="";for(var b=k.text,d=0;d<b.length;++d)c+="0123456789+-".charAt(t.indexOf(b.charAt(d)));k.ctype="number";k.value={real:+c,imag:0};a.push(k);xb(a)}function Ac(a,k){var c=[],t;a:for(;;)switch(t=a.next(),t.toktype){case "OP":var b=sa[t.text];"_"!==b.sym||!c.length||c.length&1||"OP"!==c[c.length-1].toktype||":="!==c[c.length-1].op.sym||(c.pop(),b=sa[":=_"],t.text=b.sym);t.op=
b;t.precedence=b.precedence;for(c.length&1||c.push(null);3<=c.length&&c[c.length-2].precedence<=t.precedence;)xb(c);b.rassoc&&t.precedence++;c.push(t);break;case "ID":t.ctype="variable";t.name=t.text;if(c.length&1)throw X("Missing operator",t.start,t.text);c.push(t);break;case "NUM":t.ctype="number";t.value={real:+t.text,imag:0};if(c.length&1)throw X("Missing operator",t.start,t.text);c.push(t);break;case "STR":t.ctype="string";t.value=t.raw.substring(1,t.raw.length-1);if(c.length&1)throw X("Missing operator",
t.start,t.text);c.push(t);break;case "SUB":zc(c,t,"_","\u2080\u2081\u2082\u2083\u2084\u2085\u2086\u2087\u2088\u2089\u208a\u208b");break;case "SUP":zc(c,t,"^","\u2070\u00b9\u00b2\u00b3\u2074\u2075\u2076\u2077\u2078\u2079\u207a\u207b");c[c.length-1].isSuperscript=!0;break;case "BRA":b="[](){}||".indexOf(t.text);if(t.text===k||b&1)break a;var b="[](){}||".charAt(b+1),d=Ac(a,b),f=d.closedBy;if(f.text!==b)throw X("Opening "+t.text+" at "+t.start.row+":"+t.start.col+" closed by "+(f.text||"EOF")+" at "+
f.start.row+":"+f.start.col);f=t.text+f.text;b=[];if(d=d.expr){for(;d&&"infix"===d.ctype&&","===d.oper;)b.push(d.args[0]),d=d.args[1];b.push(d)}if(c.length&1){if("{}"===f)throw X("{\u2026} reserved for future use",t.start);t=c[c.length-1];if("variable"!==t.ctype)throw X("Function name must be an identifier",t.start);t.ctype="function";for(var d=t.args=[],f=t.modifs={},e=0;e<b.length;++e){var l=b[e];if(l&&"infix"===l.ctype&&"->"===l.oper){var g=l.args[0];if("variable"!==g.ctype)throw X("Modifier name must be an identifier",
l.start);f[g.name]=l.args[1]}else d.push(l)}t.oper=t.name.toLowerCase()+"$"+t.args.length}else if("||"===f)if(1===b.length)c.push({ctype:"function",oper:"abs_infix",args:b,modifs:{}});else if(2===b.length)c.push({ctype:"function",oper:"dist_infix",args:b,modifs:{}});else throw X("Don't support |\u2026| with "+b.length+" arguments",t.start);else{if("{}"===f)throw X("{\u2026} reserved for future use",t.start);"[]"!==f&&1===b.length?c.push({ctype:"paren",args:b}):0===b.length?c.push({ctype:"list",value:[]}):
c.push({ctype:"function",oper:"genList",args:b,modifs:{}})}break;case "EOF":break a}for(c.length&1||c.push(null);3<=c.length;)xb(c);return{expr:c[0],closedBy:t}}function kb(a){this.usedFunctions={};this.usedVariables={}}function z(a){if("undefined"===typeof a)return m;if("infix"===a.ctype)return a.impl(a.args,{});if("variable"===a.ctype)return z(J.getvar(a.name));if("void"===a.ctype)return m;if("geo"===a.ctype||"number"===a.ctype||"boolean"===a.ctype||"string"===a.ctype||"list"===a.ctype||"undefined"===
a.ctype||"shape"===a.ctype||"error"===a.ctype)return a;if("field"===a.ctype){var k=z(a.obj);return"geo"===k.ctype?va.getField(k.value,a.key):"list"===k.ctype?f.getField(k,a.key):m}return"function"===a.ctype?D.evaluate(a.oper,a.args,a.modifs):m}function C(a){a=z(a);if("geo"===a.ctype){var k=a.value;if("P"===k.kind)return va.getField(k,"xy")}return a}function M(a){a=z(a);if("geo"===a.ctype){var k=a.value;if("P"===k.kind||"L"===k.kind)return va.getField(k,"homog")}return f._helper.isNumberVecN(a,3)?
a:f._helper.isNumberVecN(a,2)?(k=f.turnIntoCSList([a.value[0],a.value[1],l.real(1)]),a.usage&&(k=v.withUsage(k,a.usage)),k):m}function ib(a){var k=new kb;k.usedFunctions=ic;k.infixmap=O;a=k.parse(a);for(var c in k.usedVariables)J.create(c);return a}function Bc(){this._path=[];this._defs=["<defs>"];this._imgcache=[];this._body=[];this._saveStack=[""];this._clipIndex=0;this._stroke=this._fill="#000";this._strokeOpacity=this._fillOpacity=null;this.height=this.width=0;this.lineWidth=1;this.lineCap="butt";
this.lineJoin="miter";this.miterLimit=10;this.globalAlpha=1}function Cc(){this._body=[];this._yPos=this._xPos=NaN;this._extGState={Af255:"<< /ca 1 >>",As255:"<< /CA 1 >>"};this._objects=[["%PDF-1.4\n"]];this._offset=this._objects[0][0].length;this._nextIndex=5;this._imgcache=[];this._xobjects={};this._pathUsed=-1;this._fillAlpha=this._strokeAlpha=this._globalAlpha=1;this.height=this.width=0;this.lineWidth=1;this.lineCap="butt";this.lineJoin="miter";this.miterLimit=10}function Dc(a,k){var c=a.width,
t=a.height,b=document.createElement("canvas");b.setAttribute("width",c);b.setAttribute("height",t);b.setAttribute("style","display:none;");var d=ma.canvas;d.parentNode.insertBefore(b,d.nextSibling);try{return b.getContext("2d").drawImage(a,0,0,c,t),b.toDataURL(k||"image/png")}finally{b.parentNode.removeChild(b)}}function ld(a){a=a.replace(RegExp("[^ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/]+","g"),"");var k=new Uint8Array(3*a.length>>2),c,t,b,d,f,e;for(t=c=0;c+3<a.length;c+=
4)b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c)),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c+1)),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c+2)),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c+3)),k[t++]=b<<2|d>>4,k[t++]=d<<4|f>>2,k[t++]=f<<6|e;switch(a.length-c){case 0:break;case 2:b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c));
d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c+1));k[t++]=b<<2|d>>4;break;case 3:b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c));d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c+1));f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(c+2));k[t++]=b<<2|d>>4;k[t++]=d<<4|f>>2;break;default:throw Error("Malformed Base64 input: "+(a.length-c)+" chars left: "+
a.substr(c));}if(t!==k.length)throw Error("Failed assertion: "+t+" should be "+k.length);return k}function md(a){function k(c){return(a[c]<<24|a[c+1]<<16|a[c+2]<<8|a[c+3])>>>0}if(57>a.length)throw Error("Too short to be a PNG file");if(2303741511!==k(0)||218765834!==k(4))throw Error("PNG signature missing");for(var c=[],t=8;t<a.length;){if(t+12>a.length)throw Error("Incomplete chunk at offset 0x"+t.toString(16));var b=k(t);if(2147483648<=b)throw Error("Chunk too long");var d=t+12+b;if(d>a.length)throw Error("Incomplete chunk at offset 0x"+
t.toString(16));var f=a.subarray(t+4,t+8),f=String.fromCharCode.apply(String,f);c.push({len:b,type:f,data:a.subarray(t+8,t+8+b),crc:k(t+8+b)});t=d}return c}function yb(a,k){var c;if(c=/^rgba\(([0-9]+), *([0-9]+), *([0-9]+), *([0-9]+)\)$/.exec(a))k(+c[1],+c[2],+c[3],+c[4]);else if(c=/^rgb\(([0-9]+), *([0-9]+), *([0-9]+)\)$/.exec(a))k(+c[1],+c[2],+c[3],1);else throw Error("Can't handle color style "+a);}function nd(a){var k=1;Object.keys(la).forEach(function(c){var t=la[c];if(void 0===t.cachedDataURL&&
t.src)if("data:"===t.src.substr(0,5))t.cachedDataURL=t.src;else{++k;t.cachedDataURL=null;var b=new XMLHttpRequest;b.responseType="blob";b.onreadystatechange=function(){if(b.readyState===XMLHttpRequest.DONE)if(200===b.status){var c=new FileReader;c.onloadend=function(){t.cachedDataURL=c.result;console.log("Cached data for image "+t.src);0===--k&&a()};c.readAsDataURL(b.response)}else console.error("Failed to load "+t.src+": "+b.statusText),0===--k&&a()};b.open("GET",t.src,!0);b.send()}});0===--k&&a()}
function Ya(a,k,c){for(c||(c="0");a.length<k;)a=c+a;return a}function Ec(){null!==lb&&(window.URL.revokeObjectURL(lb),lb=null)}function Fc(a){nd(function(){var k=A;try{A=new a;A.width=fa;A.height=V;e();var c=A.toBlob();Ec();lb=window.URL.createObjectURL(c);window.open(lb,"_blank")}finally{A=k}})}function od(a){for(var k in a)null!==a[k]&&(ra[k]=a[k])}function ad(a){Object.keys(p).forEach(function(a){var c=p[a];Oa(c.signature||"_helper"===a,a+" has no signature");void 0!==c.updatePosition&&void 0===
c.stateSize&&(c.stateSize=0)});E=[];n={};I=[];L=[];Z=[];ga=[];ja=[];a.forEach(Gc);Hc()}function Mb(a){void 0===a.size&&(a.size=ra.lineSize);a.size=l.real(a.size);a.color=f.realVector(a.color||ra.lineColor);void 0===a.alpha&&(a.alpha=ra.alpha);a.alpha=l.real(a.alpha);a.clip=v.string(a.clip||ra.clip);void 0===a.overhang&&(a.overhang=ra.overhangLine);a.overhang=l.real(a.overhang);a.dashtype&&(a.dashtype=v.wrap(a.dashtype))}function Nb(a){a=Gc(a);Hc();return a}function Gc(a){var k;if(void 0!==n[a.name]){console.log("Element name '"+
a.name+"' already exists");var c=n[a.name];p[c.type].isMovable&&Ca(c,a.pos,"homog");return{ctype:"geo",value:c}}if(c=pd[a.type]){a=c(a);c=null;for(k=0;k<a.length;++k)c=Nb(a[k]);return c}c=p[a.type];if(!c)return console.error(a),console.error("Operation "+a.type+" not implemented yet"),null;if(c.signature.length!==(a.args?a.args.length:0))return window.alert("Wrong number of arguments for "+a.name),null;if(a.args)for(k=0;k<a.args.length;++k){if(!n.hasOwnProperty(a.args[k]))return console.log("Dropping "+
a.name+" due to missing argument "+a.args[k]),null;var t=n[a.args[k]].kind;if(c.signature[k]!==t&&("S"!==t||"L"!==c.signature[k]))return window.alert("Wrong argument kind "+t+" as argument "+k+" to element "+a.name+" of type "+a.type),null}c.signatureConstraints&&!c.signatureConstraints(a)&&window.alert("signature constraints violated for element "+a.name);E.push(a);n[a.name]=a;k=ta.length;a.kind=c.kind;a.stateIdx=k;k+=c.stateSize;a.incidences=[];a.isshowing=!0;a.movable=!1;c.isMovable&&(a.movable=
!0,ja.push(a));"P"===a.kind&&(I.push(a),void 0===a.size&&(a.size=ra.pointSize),a.size=l.real(a.size),!a.movable||a.pinned?(a.color=f.realVector(a.color||ra.pointColor),a.color=f.scalmult(l.real(ra.dimDependent),a.color)):a.color=f.realVector(a.color||ra.pointColor),void 0===a.alpha&&(a.alpha=ra.alpha),a.alpha=l.real(a.alpha),a.drawtrace&&("undefined"===typeof a.tracedim&&(a.tracedim=1),"undefined"===typeof a.tracelength&&(a.tracelength=100),"undefined"===typeof a.traceskip&&(a.traceskip=1),a._traces=
Array(a.tracelength),a._traces_index=0,a._traces_tick=0));"L"===a.kind&&(L.push(a),Mb(a));"C"===a.kind&&(Z.push(a),Mb(a));"S"===a.kind&&(L.push(a),void 0===a.overhang&&(a.overhang=ra.overhangSeg),a.arrow&&(a.arrow=v.bool(a.arrow)),a.arrowsize&&(a.arrowsize=l.real(a.arrowsize)),a.arrowposition&&(a.arrowposition=l.real(a.arrowposition)),a.arrowshape&&(a.arrowshape=v.string(a.arrowshape)),a.arrowsides&&(a.arrowsides=v.string(a.arrowsides)),Mb(a),a.clip=v.string("end"));"Text"===a.kind&&ga.push(a);if(k!==
ta.length){var b,d=Ob.length;Pa.length<k*d?(t=2*k,Pa=new Float64Array(d*t)):t=Pa.length/d|0;for(b=0;b<d;++b)Ma[Ob[b]]=Pa.subarray(b*t,b*t+k);k=ta;ba=Ma["in"];wa=Ma.out;ta=Ma.good;ta.set(k)}ba=wa=ta;Qa=!0;c.initialize&&(ia=pa=a.stateIdx,a.param=c.initialize(a),Oa(pa===a.stateIdx+c.stateSize,"State fully initialized"));ia=pa=a.stateIdx;c.updatePosition(a,!1);Oa(ia===a.stateIdx+c.stateSize,"State fully consumed");Oa(pa===a.stateIdx+c.stateSize,"State fully updated");Qa=!1;ba=Ma["in"];ba.set(ta);wa=Ma.out;
Pb(a,c);Qb={};Ra(a)}function Ic(a,k){var c=n[k.args[0]].homog,t=n[k.args[1]].homog,b=a.homog,d=l.div(c.value[0],c.value[2]),c=l.div(c.value[1],c.value[2]),f=l.div(t.value[0],t.value[2]),t=l.div(t.value[1],t.value[2]),e=l.div(b.value[0],b.value[2]),b=l.div(b.value[1],b.value[2]);return l._helper.isAlmostReal(d)&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(f)&&l._helper.isAlmostReal(t)&&l._helper.isAlmostReal(e)&&l._helper.isAlmostReal(b)?(d=d.value.real,c=c.value.real,f=f.value.real,t=t.value.real,
e=e.value.real,b=b.value.real,d=Math.sqrt((d-f)*(d-f)+(c-t)*(c-t))-Math.sqrt((d-e)*(d-e)+(c-b)*(c-b))-Math.sqrt((f-e)*(f-e)+(t-b)*(t-b)),1E-15>d*d):!1}function Pb(a,k){a.isshowing=!0;if(a.args)for(var c=0;c<a.args.length;c++)if(!n[a.args[c]].isshowing){a.isshowing=!1;return}k.visiblecheck&&k.visiblecheck(a)}function gd(a){var k={size:a.size},c=a.pos,t=a.text,t=t.replace(/@[$#]"([^"\\]|\\.)*"/g,function(a){var c,k;try{if(c=JSON.parse(a.substring(2)),k=n[c],!k)return"?"}catch(t){return"?"}switch(a.charAt(1)){case "$":return k.printname||
c;case "#":return"V"!==k.kind?"?":H(k.value)}}),t=v.string(t);a.dock&&(a.dock.to?c=n[a.dock.to].homog:Jc.hasOwnProperty(a.dock.corner)&&(c=r.screenbounds$0([],{}),c=c.value[Jc[a.dock.corner]]),k.offset=a.dock.offset);c&&r.drawtext$2([c,t],k)}function fd(){function a(){var a=e++/c._traces.length,k=c._traces[f];k&&(a*=t*a*a,r.draw$1([k],{size:l.real(b),color:c.color,alpha:l.real(a)}));b*=d}for(var k=0;k<I.length;k++){var c=I[k];if(c.drawtrace){c._traces_tick===c.traceskip?(c._traces[c._traces_index]=
c.homog,c._traces_index=(c._traces_index+1)%c._traces.length,c._traces_tick=0):c._traces_tick++;var t=c.alpha.value.real,b=c.size.value.real,d=1;1!==c.tracedim&&(b*=c.tracedim,d=Math.pow(c.tracedim,-1/c._traces.length));var f,e=0;for(f=c._traces_index;f<c._traces.length;++f)a();for(f=0;f<c._traces_index;++f)a()}}}function Oa(a,k){var c="Assertion failed: "+k;if(!a)throw console.log(c),Aa(),"undefined"!==typeof alert&&alert(c),Error(c);}function Wa(){ta.set(ba);Kc(!1);for(var a=ta.length,k=Math.abs,
c=0;c<a;c+=2)k(ta[c])>1E12*k(ta[c+1])&&(ta[c+1]=0)}function zb(){if(cb)xa=!0;else throw Lc;}function Mc(a,k,c,t,b){return v.add(t,v.mult(c,v.sub(b,t)))}function ed(){G&&(G.currentMouseAndScripts=[]);Rb=!0;xa=!1;ba.set(ta);if(ca){var a=ca.mover,k=f.realVector([S.x+ca.offset.x,S.y+ca.offset.y,1]);Sb(a,k,"mouse");ca.prev.x=S.x;ca.prev.y=S.y}z(ea.move);z(ea.draw);xa||Wa();Rb=!1;G&&(G.fullLog.push(f.turnIntoCSList([f.turnIntoCSList(G.currentMouseAndScripts)])),G.length>G.logLength&&G.splice(0,G.length-
G.logLength),G.currentMouseAndScripts=null,G.postMouseHooks.forEach(function(a){a()}))}function Ca(a,k,c){Rb?Sb(a,k,c):(Wa(),xa=!1,Sb(a,k,c),Wa())}function Sb(a,k,c){G&&G.currentMouseAndScripts&&(G.currentMover=[]);wa.set(ba);var t=1E4,b;b=Qb[a.name];if(!b){var d={},e=0;b=[];d[a.name]=a;for(var g=E,h=0;h<g.length;++h){var m=g[h],n=m.args;if(n)for(var q=0;q<n.length;++q)d.hasOwnProperty(n[q])&&(d[m.name]=m,b[e++]=m)}Qb[a.name]=b}var d=-1,e=.9,r,w,u,g=p[a.type],h=g.parameterPath||Mc;ia=a.stateIdx;m=
g.getParamFromState(a);ia=pa=a.stateIdx;n=g.getParamForInput(a,k,c);for(q=d+e;d!==q;){var y=q*q,z=.5/(1+y),z=l.complex(2*q*z+.5,(1-y)*z);cb=d+.5*e<=d||0===t;0===t&&console.log("tracing limit Reached");y=!1;G&&G.currentMouseAndScripts&&(G.currentStep=[]);try{ia=pa=a.stateIdx;var x=h(a,q,z,m,n);G&&(G.currentParam=x);z=wa;wa=ba;g.putParamToState(w,x);wa=z;pa=a.stateIdx;G&&(G.currentElement=a);g.updatePosition(a,!0);Oa(ia===a.stateIdx+g.stateSize,"State fully consumed");Oa(pa===a.stateIdx+g.stateSize,
"State fully updated");for(r=0;r<b.length;++r)w=b[r],u=p[w.type],ia=pa=w.stateIdx,G&&(G.currentElement=w),u.updatePosition(w,!1),Oa(ia===w.stateIdx+u.stateSize,"State fully consumed"),Oa(pa===w.stateIdx+u.stateSize,"State fully updated");G&&(G.currentElement=null);d=q;e*=1.25;q+=e;1<=q&&(q=1);wa=ba;ba=z}catch(A){if(A!==Lc)throw A;e*=.5;q=d+e;--t;y=!0}G&&G.currentMouseAndScripts&&(G.currentMover.push(f.turnIntoCSList([f.turnIntoCSList(G.currentStep),v.wrap(y),v.wrap(d),v.wrap(q),v.wrap(G.currentParam)])),
G.currentStep=null,G.currentParam=null)}Kc(xa);for(r=0;r<b.length;++r)w=b[r],u=p[w.type],Pb(w,u);G&&G.currentMouseAndScripts&&(G.currentMouseAndScripts.push(f.turnIntoCSList([f.turnIntoCSList(G.currentMover),v.wrap(xa),v.wrap(a.name),k,v.wrap(c),m,n])),G.currentMover=null)}function bd(){Wa();cb=!0;for(var a=E,k=0;k<a.length;k++){var c=a[k],t=p[c.type];ia=pa=c.stateIdx;t.updatePosition(c,!1);Pb(c,t)}a=wa;wa=ba;ba=a;Wa()}function Kc(a){var k=q.tracingStateReport;"string"===typeof k&&(document.getElementById(k).textContent=
a?"BAD":"GOOD")}function qd(){return f.turnIntoCSList(G.fullLog.slice())}function rd(a){var k=JSON.stringify(G.fullLog);a=new Blob([k],{type:a?"application/octet-stream":"application/json"});return window.URL.createObjectURL(a)}function db(){var a=ia;ia+=2;return l.complex(ba[a],ba[a+1])}function U(a){for(var k=Array(a),c=0;c<a;++c)k[c]=db();return f.turnIntoCSList(k)}function Ea(a){wa[pa]=a.value.real;wa[pa+1]=a.value.imag;pa+=2}function P(a){for(var k=0,c=a.value.length;k<c;++k)Ea(a.value[k])}function Fa(a,
k){var c=U(3),t=U(3),c=Nc(a,k,c,t);P(c[0]);P(c[1]);return f.turnIntoCSList(c)}function Nc(a,k,c,t){if(Qa)return[a,k];var b=f.projectiveDistMinScal(c,a),d=f.projectiveDistMinScal(c,k),e=f.projectiveDistMinScal(t,a),l=f.projectiveDistMinScal(t,k),g=f.projectiveDistMinScal(c,t),h=f.projectiveDistMinScal(a,k),n=b+l,p=d+e,q;n>p?(q=[k,a],n=p):q=[a,k];p=function(){};if(G&&G.currentStep){var r=[G.labelTracing2,v.wrap(G.currentElement.name),f.turnIntoCSList(q),f.turnIntoCSList([c,t]),f.realMatrix([[b,d],[e,
l]]),v.wrap(n),v.wrap(g),v.wrap(h),m];G.currentStep.push(f.turnIntoCSList(r));p=function(a){G.hasOwnProperty(a)||(G[a]=v.wrap(a));r[r.length-1]=G[a]}}f._helper.isNaN(a)||f._helper.isNaN(k)?(p("Tracing failed due to NaNs."),xa=!0):g>3*n&&h>3*n?p("Normal case, everything all right."):1E-5>h?1E-5>g?p("Staying inside singularity."):(p("Moved into singularity."),xa=!0):1E-5>g?p("Moved out of singularity."):(cb?p("Reached refinement limit, giving up."):p("Need to refine."),zb());return q}function Tb(a,
k,c,t){var b=U(3),d=U(3),e=U(3),l=U(3);a=sd(a,k,c,t,b,d,e,l);P(a[0]);P(a[1]);P(a[2]);P(a[3]);return f.turnIntoCSList(a)}function sd(a,k,c,t,b,d,e,l){var g=function(){};b=[b,d,e,l];a=[a,k,c,t];if(Qa)return a;d=0;t=Array(4);for(c=0;4>c;c++)for(t[c]=Array(4),l=0;4>l;l++)e=f.projectiveDistMinScal(b[c],a[l]),t[c][l]=e;e=Jb(t);k=Array(4);for(c=0;4>c;++c)k[c]=a[e[c]],d+=t[c][e[c]];var h=1*d,n=Infinity,p=Infinity;for(c=0;4>c;c++){if(f._helper.isNaN(a[c]))return g("Tracing failed due to NaNs."),xa=!0,k;for(l=
c+1;4>l;l++)e=f.projectiveDistMinScal(b[c],b[l]),n>e&&(n=e),e=f.projectiveDistMinScal(k[c],k[l]),p>e&&(p=e)}if(G&&G.currentStep){var q=[G.labelTracing4,v.wrap(G.currentElement.name),f.turnIntoCSList(k),f.turnIntoCSList(b),f.realMatrix(t),v.wrap(d),v.wrap(n),v.wrap(p),m];G.currentStep.push(f.turnIntoCSList(q));g=function(a){G.hasOwnProperty(a)||(G[a]=v.wrap(a));q[q.length-1]=G[a]}}n>h&&p>h||(1E-5>p?1E-5>n?g("Staying inside singularity."):(g("Moved into singularity."),xa=!0):1E-5>n?g("Moved out of singularity."):
(cb?g("Reached refinement limit, giving up."):g("Need to refine."),zb()));return k}function Oc(a){var k=a.length,c,t;if(Qa){for(c=0;c<k;++c)ia+=2*a[c].value.length,P(a[c]);return a}var b=Array(k),d=Array(k),e=Array(k),l=99,g=99,h=Array(k);for(c=0;c<k;++c)b[c]=U(a[c].value.length),d[c]=f.normSquared(b[c]).value.real,e[c]=f.normSquared(a[c]).value.real,h[c]=Array(k);var n;for(c=0;c<k;++c){for(t=0;t<k;++t)n=f.sesquilinearproduct(b[c],a[t]).value,n=(n.real*n.real+n.imag*n.imag)/(d[c]*e[t]),h[c][t]=1-
n;for(t=c+1;t<k;++t)n=f.sesquilinearproduct(b[c],b[t]).value,n=(n.real*n.real+n.imag*n.imag)/(d[c]*d[t]),l>1-n&&(l=1-n),n=f.sesquilinearproduct(a[c],a[t]).value,n=(n.real*n.real+n.imag*n.imag)/(e[c]*e[t]),g>1-n&&(g=1-n)}n=Jb(h);t=Array(k);d=0;e=!1;for(c=0;c<k;++c){var d=d+h[c][n[c]],p=t[c]=a[n[c]];P(p);e|=f._helper.isNaN(p)}e|=isNaN(d);a=function(){};if(G&&G.currentStep){var q=[G.labelTracingSesq,v.wrap(G.currentElement.name),f.turnIntoCSList(t),f.turnIntoCSList(b),f.realMatrix(h),v.wrap(d),v.wrap(l),
v.wrap(g),m];G.currentStep.push(f.turnIntoCSList(q));a=function(a){G.hasOwnProperty(a)||(G[a]=v.wrap(a));q[q.length-1]=G[a]}}e?(a("Tracing failed due to NaNs."),xa=!0):l>3*d&&g>3*d?a("Normal case, everything all right."):1E-5>g?1E-5>l?a("Staying inside singularity."):(a("Moved into singularity."),xa=!0):1E-5>l?a("Moved out of singularity."):(cb?a("Reached refinement limit, giving up."):a("Need to refine."),zb());return t}function Ra(a){if(Ra.hasOwnProperty(a.kind))Ra[a.kind](a)}function Pc(a,k){return function(){a.incidences.push(k.name);
k.incidences.push(a.name)}}function Qc(a,k){return{toString:function(){return"point "+a.name+" incident line "+k.name},apply:Pc(a,k),holds:function(){var c=f.scaldiv(f.abs(a.homog),a.homog),t=f.scaldiv(f.abs(k.homog),k.homog);return 1E-13>l.abs(f.scalproduct(c,t)).value.real}}}function Rc(a,k){return{toString:function(){return"point "+a.name+" incident conic "+k.name},apply:Pc(a,k),holds:function(){var c=v.mult(k.matrix,a.homog),c=v.mult(a.homog,c),c=l.abs(c);1E-13>c.value.real&&(a.incidences.push(k.name),
k.incidences.push(a.name))}}}function Hc(){if(0!==Sa.length){for(var a=0;a<Sa.length;++a)Sa[a].apply();Sa=[]}}function td(a){if(!/^Select/.test(a.type)&&!p[a.type].isMovable)return null;var k=v.unwrap,c=l.sum;switch(a.kind){case "P":case "L":return k(a.homog);case "C":return a=a.mat.value,{xx:k(a[0].value[0]),yy:k(a[1].value[1]),zz:k(a[2].value[2]),xy:k(c(a[0].value[1],a[1].value[0])),xz:k(c(a[0].value[2],a[2].value[0])),yz:k(c(a[1].value[2],a[2].value[1]))};default:return null}}function ud(a){var k=
{};k.offset=v.unwrap(a.offset);a.to&&(k.to=a.to);a.corner&&(k.corner=a.corner);return k}function vd(a){var k={};wd.forEach(function(c){if(a.hasOwnProperty(c)){var b=v.unwrap(a[c]);null!==b&&void 0!==b&&(k[c]=b)}});var c=td(a);c&&(k.pos=c);a.dock&&(k.dock=ud(a.dock));return k}function xd(){var a=[];E.forEach(function(k){k.tmp||a.push(vd(k))});return a}function cd(a){oa.forEach(function(a){K[a.behavior.type].init(a.behavior,n[a.name])})}function Fb(a){Gb=0!==a.length;oa=a;W=[];Ub=[];oa.forEach(function(a){if(a.name){var c=
a.name;n[c]&&(n[c].behavior=a.behavior,K[a.behavior.type].init(a.behavior,n[c]),"Mass"===a.behavior.type&&W.push(n[c]),"Spring"===a.behavior.type&&Ub.push(n[c]))}else K[a.behavior.type].init(a.behavior)})}var ua=this,ka,ea={},Ba=!1,rb=!0,sb=!1,pb=1,La=0,hc=!1,gb,A,fa,V,la,jc=1,jb=null,Va=[],Hb=!1,ma={config:q,startup:g,shutdown:Aa,evokeCS:function(a){a=ib(a,!1);console.log(a);z(a);e()},play:Ja,pause:bb,stop:Ua,evalcs:function(a){return z(ib(a,!1))},parse:function(a){return ib(a)},niceprint:H,canvas:null},
Db=!1,qb=0;q.use&&q.use.forEach(function(a){var k=null;q.plugins&&(k=q.plugins[a]);k||(k=ua._pluginRegistry[a]);k||(++qb,console.log("Loading script for plugin "+a),ua.loadScript(a+"-plugin",a+"-plugin.js",function(){console.log("Successfully loaded plugin "+a);0===--qb&&Db&&g()},function(){console.error("Failed to auto-load plugin "+a);0===--qb&&Db&&g()}))});Ha.prototype=new Ka;Ia.prototype=new Ka;da.prototype=new Ka;var S={},ca,kc="",lc=0,yd=[].slice,Vb,Sc=function(a){return yd.call(a)};if(!q.isNode){var zd=
document.documentElement;Vb=window;try{Sc(zd.childNodes)[0].nodeType}catch(a){Sc=function(a){for(var c=a.length,t=Array(c);c--;)t[c]=a[c];return t}}}var mc="webkit ms moz Moz o O".split(" "),Ib={},vb,wb,ub,tb,Na,nc=!q.isNode&&Vb[B(Vb,"requestAnimationFrame")]||function(a){setTimeout(a,17)};Ib.timer=function(a,k,c){var t=arguments.length;2>t&&(k=0);3>t&&(c=Date.now());t={c:a,t:c+k,f:!1,n:null};wb?wb.n=t:vb=t;wb=t;ub||(tb=clearTimeout(tb),ub=1,nc(u))};Ib.timer.flush=function(){Ta();ac()};var Ad=[0,
0,0,-1,"g9ee4997"],l={_helper:{}};l._helper.roundingfactor=1E4;l._helper.angleroundingfactor=10;l._helper.niceround=function(a,k){return Math.round(a*k)/k};l.niceprint=function(a,k){k=k||l._helper.roundingfactor;if("Angle"===a.usage)return l._helper.niceangle(a);var c=l._helper.niceround(a.value.real,k),t=l._helper.niceround(a.value.imag,k);return 0===t?""+c:0<t?""+c+" + i*"+t:""+c+" - i*"+-t};var Wb=q.angleUnit||"\u00b0",Bd=Wb.replace(/\s+/g,""),Tc=2*Math.PI,Cd=1/Tc,Dd={rad:Tc,"\u00b0":360,deg:360,
degree:360,gra:400,grad:400,turn:1,cyc:1,rev:1,rot:1,"\u03c0":2,pi:2,quad:4};l._helper.niceangle=function(a){var k=Dd[Bd];if(!k)return l.niceprint(v.withUsage(a,null));if("function"===typeof k)return k(a);a=l.niceprint(l.realmult(k*Cd,a),200<k?l._helper.angleroundingfactor:null);return-1===a.indexOf("i*")?a+Wb:"("+a+")"+Wb};l.complex=function(a,k){return{ctype:"number",value:{real:a,imag:k}}};l.real=function(a){return{ctype:"number",value:{real:a,imag:0}}};l.zero=l.real(0);l.one=l.real(1);l.infinity=
l.complex(Infinity,Infinity);l.nan=l.complex(NaN,NaN);l._helper.input=function(a){return"object"===typeof a?l.complex(+a.r,+a.i):l.real(+a)};l.argmax=function(a,k){return a.value.real*a.value.real+a.value.imag*a.value.imag<k.value.real*k.value.real+k.value.imag*k.value.imag?k:a};l.max=function(a,k){return{ctype:"number",value:{real:Math.max(a.value.real,k.value.real),imag:Math.max(a.value.imag,k.value.imag)}}};l.min=function(a,k){return{ctype:"number",value:{real:Math.min(a.value.real,k.value.real),
imag:Math.min(a.value.imag,k.value.imag)}}};l.add=function(a,k){return{ctype:"number",value:{real:a.value.real+k.value.real,imag:a.value.imag+k.value.imag}}};l.sub=function(a,k){return{ctype:"number",value:{real:a.value.real-k.value.real,imag:a.value.imag-k.value.imag}}};l.neg=function(a){return{ctype:"number",value:{real:-a.value.real,imag:-a.value.imag}}};l.re=function(a){return{ctype:"number",value:{real:a.value.real,imag:0}}};l.im=function(a){return{ctype:"number",value:{real:a.value.imag,imag:0}}};
l.conjugate=function(a){return{ctype:"number",value:{real:a.value.real,imag:-a.value.imag}}};l.round=function(a){return{ctype:"number",value:{real:Math.round(a.value.real),imag:Math.round(a.value.imag)}}};l.ceil=function(a){return{ctype:"number",value:{real:Math.ceil(a.value.real),imag:Math.ceil(a.value.imag)}}};l.floor=function(a){return{ctype:"number",value:{real:Math.floor(a.value.real),imag:Math.floor(a.value.imag)}}};l.mult=function(a,k){return{ctype:"number",value:{real:a.value.real*k.value.real-
a.value.imag*k.value.imag,imag:a.value.real*k.value.imag+a.value.imag*k.value.real}}};l.realmult=function(a,k){return{ctype:"number",value:{real:a*k.value.real,imag:a*k.value.imag}}};l.multiMult=function(a){var k=a[0];if("number"!==k.ctype)return m;for(var c=1;c<a.length;c++){if("number"!==a[c].ctype)return m;k=l.mult(k,a[c])}return k};l.abs2=function(a,k){return{ctype:"number",value:{real:a.value.real*a.value.real+a.value.imag*a.value.imag,imag:0}}};l.abs=function(a){return l.sqrt(l.abs2(a))};l.inv=
function(a){var k=a.value.real*a.value.real+a.value.imag*a.value.imag;return{ctype:"number",value:{real:a.value.real/k,imag:-a.value.imag/k}}};l.div=function(a,k){return l.mult(a,l.inv(k))};l.eps=1E-10;l.epsbig=1E-6;l.snap=function(a){var k=a.value.real;a=a.value.imag;Math.floor(k+l.eps)!==Math.floor(k-l.eps)&&(k=Math.round(k));Math.floor(a+l.eps)!==Math.floor(a-l.eps)&&(a=Math.round(a));return{ctype:"number",value:{real:k,imag:a}}};l.exp=function(a){var k=Math.exp(a.value.real);return{ctype:"number",
value:{real:k*Math.cos(a.value.imag),imag:k*Math.sin(a.value.imag)}}};l.cos=function(a){var k=a.value.real;a=a.value.imag;var c=Math.exp(a),t=c*Math.sin(-k),b=c*Math.cos(-k),c=Math.exp(-a);return{ctype:"number",value:{real:(b+c*Math.cos(k))/2,imag:(t+c*Math.sin(k))/2}}};l.sin=function(a){var k=a.value.real;a=a.value.imag;var c=Math.exp(a),t=c*Math.sin(-k),b=c*Math.cos(-k),c=Math.exp(-a);return{ctype:"number",value:{real:-(t-c*Math.sin(k))/2,imag:(b-c*Math.cos(k))/2}}};l.tan=function(a){var k=l.sin(a);
a=l.cos(a);return l.div(k,a)};l.arccos=function(a){var k=l.mult(a,l.neg(a)),k=l.sqrt(l.add(l.real(1),k));a=l.add(l.mult(a,l.complex(0,1)),k);a=l.add(l.mult(l.log(a),l.complex(0,1)),l.real(.5*Math.PI));return v.withUsage(a,"Angle")};l.arcsin=function(a){var k=l.mult(a,l.neg(a)),k=l.sqrt(l.add(l.real(1),k));a=l.add(l.mult(a,l.complex(0,1)),k);a=l.mult(l.log(a),l.complex(0,-1));return v.withUsage(a,"Angle")};l.arctan=function(a){var k=l.log(l.add(l.mult(a,l.complex(0,-1)),l.real(1)));a=l.log(l.add(l.mult(a,
l.complex(0,1)),l.real(1)));k=l.mult(l.sub(k,a),l.complex(0,.5));return v.withUsage(k,"Angle")};l.arctan2=function(a,k){var c;if(void 0===k)c=l.real(Math.atan2(a.value.imag,a.value.real));else if(l._helper.isReal(a)&&l._helper.isReal(k))c=l.real(Math.atan2(k.value.real,a.value.real));else{c=l.add(a,l.mult(l.complex(0,1),k));var t=l.sqrt(l.add(l.mult(a,a),l.mult(k,k)));c=l.mult(l.complex(0,-1),l.log(l.div(c,t)))}return v.withUsage(c,"Angle")};l.sqrt=function(a){var k=a.value.real,c=a.value.imag;a=
Math.sqrt(Math.sqrt(k*k+c*c));k=Math.atan2(c,k);return{ctype:"number",value:{real:a*Math.cos(k/2),imag:a*Math.sin(k/2)}}};l.powRealExponent=function(a,k){var c=a.value.real,t=a.value.imag,b=Math.pow(Math.sqrt(c*c+t*t),k),c=Math.atan2(t,c);return{ctype:"number",value:{real:b*Math.cos(c*k),imag:b*Math.sin(c*k)}}};l.log=function(a){var k=a.value.real;a=a.value.imag;var c=Math.sqrt(k*k+a*a),t=Math.atan2(a,k);0>a&&(t+=2*Math.PI);0===a&&0>k&&(t=Math.PI);t>Math.PI&&(t-=2*Math.PI);return l.snap({ctype:"number",
value:{real:Math.log(c),imag:t}})};l.pow=function(a,k){return l._helper.isZero(k)?l.one:l._helper.isZero(a)?l.zero:l._helper.isReal(k)?l.powRealExponent(a,k.value.real):l.exp(l.mult(l.log(a),k))};l.mod=function(a,k){var c=a.value.real,t=k.value.real,b=a.value.imag,d=k.value.imag,c=c-Math.floor(c/t)*t,b=b-Math.floor(b/d)*d;0===t&&(c=0);0===d&&(b=0);return l.snap({ctype:"number",value:{real:c,imag:b}})};l._helper.seed="NO";l._helper.seedrandom=function(a){a-=Math.floor(a);l._helper.seed=.8*a+.1};l._helper.rand=
function(){if("NO"===l._helper.seed)return Math.random();var a=l._helper.seed,a=1E3*Math.sin(1E3*a),a=a-Math.floor(a);return l._helper.seed=a};l._helper.randnormal=function(){var a=l._helper.rand(),k=l._helper.rand();return Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*k)};l._helper.isEqual=function(a,k){return a.value.real===k.value.real&&a.value.imag===k.value.imag};l._helper.isLessThan=function(a,k){return a.value.real<k.value.real||a.value.real===k.value.real&&a.value.imag<k.value.imag};l._helper.compare=
function(a,k){return l._helper.isLessThan(a,k)?-1:l._helper.isEqual(a,k)?0:1};l._helper.isAlmostEqual=function(a,k,c){var t=l.eps;"undefined"!==typeof c&&(t=c);c=a.value.real-k.value.real;a=a.value.imag-k.value.imag;return c<t&&c>-t&&a<t&&a>-t};l._helper.isZero=function(a){return 0===a.value.real&&0===a.value.imag};l._helper.isAlmostZero=function(a){var k=a.value.real;a=a.value.imag;return k<l.eps&&k>-l.eps&&a<l.eps&&a>-l.eps};l._helper.isReal=function(a){return 0===a.value.imag};l._helper.isAlmostReal=
function(a){a=a.value.imag;return a<l.epsbig&&a>-l.epsbig};l._helper.isNaN=function(a){return isNaN(a.value.real)||isNaN(a.value.imag)};l._helper.isFinite=function(a){return isFinite(a.value.real)&&isFinite(a.value.imag)};l._helper.isAlmostImag=function(a){a=a.value.real;return a<l.epsbig&&a>-l.epsbig};l._helper.z3a=l.complex(-.5,.5*Math.sqrt(3));l._helper.z3b=l.complex(-.5,-.5*Math.sqrt(3));l._helper.cub1={ctype:"list",value:[l.one,l.one,l.one]};l._helper.cub2={ctype:"list",value:[l._helper.z3a,
l.one,l._helper.z3b]};l._helper.cub3={ctype:"list",value:[l._helper.z3b,l.one,l._helper.z3a]};l.solveCubic=function(a,k,c,t){a=l._helper.solveCubicHelper(a,k,c,t);return[f.scalproduct(l._helper.cub1,a),f.scalproduct(l._helper.cub2,a),f.scalproduct(l._helper.cub3,a)]};l._helper.solveCubicHelper=function(a,k,c,t){var b=a.value.real;a=a.value.imag;var d=k.value.real;k=k.value.imag;var e=c.value.real,g=c.value.imag,h=t.value.real,m=t.value.imag,n=b*e-a*g;t=b*g+a*e;c=4*n-(d*d-k*k);var p=4*t-2*d*k,q=b*
d-a*k,r=b*k+a*d,v=c*e-p*g-18*(q*h-r*m),p=c*g+p*e-18*(q*m+r*h),w=27*(b*b-a*a),u=54*a*b;c=w*h-u*m;var z=w*m+u*h,y=d*d-k*k,x=2*d*k,A=y*d-x*k,B=y*k+x*d,w=c+4*A,u=z+4*B,A=-2*A+9*(q*e-r*g),B=-2*B+9*(q*g+r*e),A=A-c,B=B-z;c=27*(v*e-p*g+w*h-u*m);p=27*(v*g+p*e+w*m+u*h);w=Math.sqrt(Math.sqrt(c*c+p*p));u=Math.atan2(p,c);p=w*Math.sin(u/2);c=w*Math.cos(u/2);A+=c*b-p*a;B+=c*a+p*b;c=Math.exp(Math.log(Math.sqrt(A*A+B*B))/3);e=Math.atan2(B,A);w=c*Math.sin(e/3);u=c*Math.cos(e/3);c*=c;e*=2;n=2*y-6*n;t=2*x-6*t;x=-1.5874010519681996*
(d*u-k*w);d=-1.5874010519681996*(d*w+k*u);k=1.2599210498948732*c*Math.cos(e/3);e=1.2599210498948732*c*Math.sin(e/3);c=4.762203155904599*(u*b-w*a);p=4.762203155904599*(u*a+w*b);b=c*c+p*p;w=(n*c+t*p)/b;u=(-n*p+t*c)/b;n=w;t=u;w=(x*c+d*p)/b;u=(-x*p+d*c)/b;x=w;d=u;w=(k*c+e*p)/b;u=(-k*p+e*c)/b;k=w;e=u;return f.turnIntoCSList([l.complex(n,t),l.complex(x,d),l.complex(k,e)])};var f={_helper:{},turnIntoCSList:function(a){return{ctype:"list",value:a}},realVector:function(a){for(var k=[],c=0;c<a.length;c++)k[c]=
{ctype:"number",value:{real:a[c],imag:0}};return{ctype:"list",value:k}}};f._helper.unitvector=function(a,k){var c=f.zerovector(a);c.value[Math.floor(k.value.real-1)]=l.real(1);return c};f.idMatrix=function(a){for(var k=f.zeromatrix(a,a),c=l.real(1),t=0;t<a.value.real;t++)k.value[t].value[t]=c;return k};f._helper.flippedidMatrix=function(a){for(var k=f.zeromatrix(a,a),c=l.real(1),t=0;t<a.value.real;t++)k.value[t].value[a.value.real-t-1]=c;return k};f.println=function(a){for(var k=[],c=0;c<a.value.length;c++)if("number"===
a.value[c].ctype)k[c]=l.niceprint(a.value[c]);else if("list"===a.value[c].ctype)f.println(a.value[c]);else return m;"number"===a.value[0].ctype&&console.log(k)};f.matrix=function(a){return f.turnIntoCSList(a.map(f.turnIntoCSList))};f.realMatrix=function(a){for(var k=a.length,c=Array(k),t=0;t<k;t++)c[t]=f.realVector(a[t]);return f.turnIntoCSList(c)};f.ex=f.realVector([1,0,0]);f.ey=f.realVector([0,1,0]);f.ez=f.realVector([0,0,1]);f.linfty=f.realVector([0,0,1]);f.ii=f.turnIntoCSList([l.complex(1,0),
l.complex(0,1),l.complex(0,0)]);f.jj=f.turnIntoCSList([l.complex(1,0),l.complex(0,-1),l.complex(0,0)]);f.fundDual=f.realMatrix([[1,0,0],[0,1,0],[0,0,0]]);f.fund=f.realMatrix([[0,0,0],[0,0,0],[0,0,1]]);f.sequence=function(a,k){for(var c=[],t=0,b=Math.round(a.value.real);b<Math.round(k.value.real)+1;b++)c[t]={ctype:"number",value:{real:b,imag:0}},t++;return{ctype:"list",value:c}};f.pairs=function(a){for(var k=[],c=0;c<a.value.length-1;c++)for(var t=c+1;t<a.value.length;t++)k.push({ctype:"list",value:[a.value[c],
a.value[t]]});return{ctype:"list",value:k}};f.triples=function(a){for(var k=[],c=0;c<a.value.length-2;c++)for(var t=c+1;t<a.value.length-1;t++)for(var b=t+1;b<a.value.length;b++)k.push({ctype:"list",value:[a.value[c],a.value[t],a.value[b]]});return{ctype:"list",value:k}};f.cycle=function(a){for(var k=[],c=0;c<a.value.length-1;c++)k[c]={ctype:"list",value:[a.value[c],a.value[c+1]]};k.push({ctype:"list",value:[a.value[a.value.length-1],a.value[0]]});return{ctype:"list",value:k}};f.consecutive=function(a){for(var k=
[],c=0;c<a.value.length-1;c++)k[c]={ctype:"list",value:[a.value[c],a.value[c+1]]};return{ctype:"list",value:k}};f.reverse=function(a){for(var k=[],c=a.value.length-1;0<=c;c--)k.push(a.value[c]);return{ctype:"list",value:k}};f.directproduct=function(a,k){for(var c=[],t=0;t<a.value.length;t++)for(var b=0;b<k.value.length;b++)c.push({ctype:"list",value:[a.value[t],k.value[b]]});return{ctype:"list",value:c}};f.concat=function(a,k){for(var c=[],t=0;t<a.value.length;t++)c.push(a.value[t]);for(t=0;t<k.value.length;t++)c.push(k.value[t]);
return{ctype:"list",value:c}};f.prepend=function(a,k){var c=[];c[0]=a;for(var t=0;t<k.value.length;t++)c[t+1]=k.value[t];return{ctype:"list",value:c}};f.append=function(a,k){for(var c=[],t=0;t<a.value.length;t++)c[t]=a.value[t];c.push(k);return{ctype:"list",value:c}};f.contains=function(a,k){for(var c=0;c<a.value.length;c++)if(D.equals(a.value[c],k).value)return{ctype:"boolean",value:!0};return{ctype:"boolean",value:!1}};f.common=function(a,k){for(var c=[],t=0,b=0;b<a.value.length;b++){for(var d=
!1,f=a.value[b],e=0;e<k.value.length;e++)d=d||D.equals(f,k.value[e]).value;d&&(c[t]=a.value[b],t++)}return{ctype:"list",value:c}};f.remove=function(a,k){for(var c=[],t=0,b=0;b<a.value.length;b++){for(var d=!1,f=a.value[b],e=0;e<k.value.length;e++)d=d||D.equals(f,k.value[e]).value;d||(c[t]=a.value[b],t++)}return{ctype:"list",value:c}};f.sort1=function(a){a=a.value.slice();a.sort(v.compare);return f.turnIntoCSList(a)};f._helper.isEqual=function(a,k){return f.equals(a,k).value};f._helper.isLessThan=
function(a,k){for(var c=a.value.length,t=k.value.length,b=0;!(b>=c||b>=t)&&v.isEqual(a.value[b],k.value[b]);)b++;return b===c&&b<t?!0:b===t&&b<c||b===c&&b===t?!1:v.isLessThan(a.value[b],k.value[b])};f._helper.compare=function(a,k){return f._helper.isLessThan(a,k)?-1:f._helper.isEqual(a,k)?0:1};f.equals=function(a,k){if(a.value.length!==k.value.length)return{ctype:"boolean",value:!1};for(var c=!0,t=0;t<a.value.length;t++)var b=a.value[t],d=k.value[t],c="list"===b.ctype&&"list"===d.ctype?c&&f.equals(b,
d).value:c&&ob([b,d],[]).value;return{ctype:"boolean",value:c}};f.almostequals=function(a,k){if(a.value.length!==k.value.length)return{ctype:"boolean",value:!1};for(var c=!0,t=0;t<a.value.length;t++)var b=a.value[t],d=k.value[t],c="list"===b.ctype&&"list"===d.ctype?c&&f.comp_almostequals(b,d).value:c&&Bb([b,d],[]).value;return{ctype:"boolean",value:c}};f._helper.isAlmostReal=function(a){for(var k=!0,c=0;c<a.value.length;c++)var t=a.value[c],k="list"===t.ctype?k&&f._helper.isAlmostReal(t):k&&l._helper.isAlmostReal(t);
return k};f._helper.isAlmostZero=function(a){for(var k=0;k<a.value.length;k++){var c=a.value[k];if("list"===c.ctype){if(!f._helper.isAlmostZero(c))return!1}else if(!l._helper.isAlmostZero(c))return!1}return!0};f._helper.isNaN=function(a){for(var k=!1,c=0;c<a.value.length;c++)var t=a.value[c],k="list"===t.ctype?k||f._helper.isNaN(t):k||l._helper.isNaN(t);return k};f.set=function(a){var k=[],c=0;a=a.value.slice();a.sort(v.compare);for(var t=0;t<a.length;t++)0!==t&&ob([k[k.length-1],a[t]],[]).value||
(k[c]=a[t],c++);return{ctype:"list",value:k}};f.maxval=function(a){for(var k=l.zero,c=0;c<a.value.length;c++){var t=a.value[c];"number"===t.ctype&&(k=l.argmax(k,t));"list"===t.ctype&&(k=l.argmax(k,f.maxval(t)))}return k};f.maxIndex=function(a,k,c){var t=0;void 0!==c&&(t=c);c=t;for(var b=k(a.value[t]).value.real;t<a.value.length;++t){var d=k(a.value[t]).value.real;d>b&&(c=t,b=d)}return c};f.normalizeMax=function(a){var k=l.inv(f.maxval(a));return l._helper.isFinite(k)?f.scalmult(k,a):a};f.normalizeZ=
function(a){var k=l.inv(a.value[2]);return f.scalmult(k,a)};f.normalizeAbs=function(a){var k=l.inv(f.abs(a));return f.scalmult(k,a)};f.max=function(a,k){if(a.value.length!==k.value.length)return m;for(var c=[],b=0;b<a.value.length;b++)c[b]=v.max(a.value[b],k.value[b]);return{ctype:"list",value:c}};f.min=function(a,k){if(a.value.length!==k.value.length)return m;for(var c=[],b=0;b<a.value.length;b++)c[b]=v.min(a.value[b],k.value[b]);return{ctype:"list",value:c}};f.scaldiv=function(a,k){if("number"!==
a.ctype)return m;for(var c=[],b=0;b<k.value.length;b++){var d=k.value[b];c[b]="number"===d.ctype?v.div(d,a):"list"===d.ctype?f.scaldiv(a,d):m}return{ctype:"list",value:c}};f.scalmult=function(a,k){if("number"!==a.ctype)return m;for(var c=[],b=0;b<k.value.length;b++){var d=k.value[b];c[b]="number"===d.ctype?v.mult(d,a):"list"===d.ctype?f.scalmult(a,d):m}return{ctype:"list",value:c}};f.add=function(a,k){if(a.value.length!==k.value.length)return m;for(var c=[],b=0;b<a.value.length;b++){var d=a.value[b],
e=k.value[b];c[b]="number"===d.ctype&&"number"===e.ctype?v.add(d,e):"list"===d.ctype&&"list"===e.ctype?f.add(d,e):m}return{ctype:"list",value:c}};f.sub=function(a,k){if(a.value.length!==k.value.length)return m;for(var c=[],b=0;b<a.value.length;b++){var d=a.value[b],e=k.value[b];c[b]="number"===d.ctype&&"number"===e.ctype?l.sub(d,e):"list"===d.ctype&&"list"===e.ctype?f.sub(d,e):m}return{ctype:"list",value:c}};f.abs2=function(a){for(var k=0,c=0;c<a.value.length;c++){var b=a.value[c];if("number"===b.ctype)k+=
l.abs2(b).value.real;else if("list"===b.ctype)k+=f.abs2(b).value.real;else return m}return{ctype:"number",value:{real:k,imag:0}}};f.abs=function(a){return l.sqrt(f.abs2(a))};f.normalizeMaxXX=function(a){for(var k=-1E4,c=l.real(1),b=0;b<a.value.length;b++){var d=l.abs(a.value[b]);d.value.real>k&&(c=a.value[b],k=d.value.real)}return f.scaldiv(c,a)};f.recursive=function(a,k){for(var c=[],b=0;b<a.value.length;b++){var d=C(a.value[b]);c[b]="number"===d.ctype?l[k](d):"list"===d.ctype?f[k](d):m}return{ctype:"list",
value:c}};f.re=function(a){return f.recursive(a,"re")};f.neg=function(a){return f.recursive(a,"neg")};f.im=function(a){return f.recursive(a,"im")};f.conjugate=function(a){return f.recursive(a,"conjugate")};f.transjugate=function(a){return f.transpose(f.conjugate(a))};f.round=function(a){return f.recursive(a,"round")};f.ceil=function(a){return f.recursive(a,"ceil")};f.floor=function(a){return f.recursive(a,"floor")};f._helper.colNumb=function(a){if("list"!==a.ctype)return-1;for(var k=-1,c=0;c<a.value.length;c++){if("list"!==
a.value[c].ctype)return-1;if(0===c)k=a.value[c].value.length;else if(k!==a.value[c].value.length)return-1}return k};f._helper.isNumberVecN=function(a,k){if("list"!==a.ctype||a.value.length!==k)return!1;for(var c=0;c<a.value.length;c++)if("number"!==a.value[c].ctype)return!1;return!0};f.isNumberVector=function(a){if("list"!==a.ctype)return{ctype:"boolean",value:!1};for(var k=0;k<a.value.length;k++)if("number"!==a.value[k].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};f.isNumberVectorN=
function(a,k){if("list"!==a.ctype)return{ctype:"boolean",value:!1};if(a.value)for(var c=0;c<a.value.length;c++)if("number"!==a.value[c].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};f.isNumberMatrix=function(a){if(-1===f._helper.colNumb(a))return{ctype:"boolean",value:!1};for(var k=0;k<a.value.length;k++)if(!f.isNumberVector(a.value[k]).value)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};f.scalproduct=function(a,k){if(a.value.length!==k.value.length)return m;
for(var c={ctype:"number",value:{real:0,imag:0}},b=0;b<k.value.length;b++){var d=a.value[b],f=k.value[b];if("number"===d.ctype&&"number"===f.ctype)c=l.add(l.mult(d,f),c);else return m}return c};f.sesquilinearproduct=function(a,k){if(a.value.length!==k.value.length)return m;for(var c=0,b=0,d=0;d<k.value.length;d++)var f=a.value[d].value,e=k.value[d].value,c=c+(f.real*e.real+f.imag*e.imag),b=b+(f.real*e.imag-f.imag*e.real);return l.complex(c,b)};f.normSquared=function(a){for(var k=0,c=0;c<a.value.length;c++)var b=
a.value[c].value,k=k+(b.real*b.real+b.imag*b.imag);return l.real(k)};f.productMV=function(a,k){if(a.value[0].value.length!==k.value.length)return m;for(var c=[],b=0;b<a.value.length;b++){for(var d={ctype:"number",value:{real:0,imag:0}},e=a.value[b],g=0;g<k.value.length;g++){var h=e.value[g],n=k.value[g];if("number"===h.ctype&&"number"===n.ctype)d=l.add(l.mult(h,n),d);else return m}c[b]=d}return f.turnIntoCSList(c)};f.productVM=function(a,k){if(a.value.length!==k.value.length)return m;for(var c=[],
b=0;b<k.value[0].value.length;b++){for(var d={ctype:"number",value:{real:0,imag:0}},e=0;e<a.value.length;e++){var g=a.value[e],h=k.value[e].value[b];if("number"===g.ctype&&"number"===h.ctype)d=l.add(l.mult(g,h),d);else return m}c[b]=d}return f.turnIntoCSList(c)};f.productMM=function(a,k){if(a.value[0].value.length!==k.value.length)return m;for(var c=[],b=0;b<a.value.length;b++){var d=f.productVM(a.value[b],k);c[b]=d}return f.turnIntoCSList(c)};f.mult=function(a,k){return a.value.length===k.value.length&&
f.isNumberVector(a).value&&f.isNumberVector(k).value?f.scalproduct(a,k):f.isNumberMatrix(a).value&&k.value.length===a.value[0].value.length&&f.isNumberVector(k).value?f.productMV(a,k):f.isNumberMatrix(k).value&&a.value.length===k.value.length&&f.isNumberVector(a).value?f.productVM(a,k):f.isNumberMatrix(a).value&&f.isNumberMatrix(k)&&k.value.length===a.value[0].value.length?f.productMM(a,k):m};f.projectiveDistMinScal=function(a,k){var c=f.abs(a),b=f.abs(k);if(0===c.value.real||0===b.value.real)return 0;
var d=f.conjugate(k),d=f.scalproduct(a,d),d=l._helper.isAlmostZero(d)?l.real(1):l.div(d,l.abs(d)),c=f.scaldiv(c,a),b=f.scaldiv(b,k),b=f.scalmult(d,b),d=f.abs(f.add(c,b)),b=f.abs(f.sub(c,b));return Math.min(d.value.real,b.value.real)};f.conicDist=function(a,k){var c=x(a),b=x(k);console.log(H(c),H(b));return f.projectiveDistMinScal(c,b)};f.crossOperator=function(a){var k=a.value[0],c=a.value[1];a=a.value[2];return f.turnIntoCSList([f.turnIntoCSList([l.zero,l.neg(a),c]),f.turnIntoCSList([a,l.zero,l.neg(k)]),
f.turnIntoCSList([l.neg(c),k,l.zero])])};f.cross=function(a,k){var c=l.sub(l.mult(a.value[1],k.value[2]),l.mult(a.value[2],k.value[1])),b=l.sub(l.mult(a.value[2],k.value[0]),l.mult(a.value[0],k.value[2])),d=l.sub(l.mult(a.value[0],k.value[1]),l.mult(a.value[1],k.value[0]));return f.turnIntoCSList([c,b,d])};f.crossratio3harm=function(a,k,c,b,d){var e=f.det3(a,c,d),g=f.det3(k,b,d);a=f.det3(a,b,d);k=f.det3(k,c,d);e=l.mult(e,g);g=l.mult(a,k);return f.turnIntoCSList([e,g])};f.crossratio3=function(a,k,
c,b,d){a=f.crossratio3harm(a,k,c,b,d);return l.div(a.value[0],a.value[1])};f.veronese=function(a){var k=l.mult(a.value[0],a.value[0]),c=l.mult(a.value[1],a.value[1]),b=l.mult(a.value[2],a.value[2]),d=l.mult(a.value[0],a.value[1]),e=l.mult(a.value[0],a.value[2]);a=l.mult(a.value[1],a.value[2]);return f.turnIntoSCList([k,c,b,d,e,a])};f.matrixFromVeronese=function(a){var k=a.value[0],c=a.value[1],b=a.value[2],d=l.realmult(.5,a.value[3]),e=l.realmult(.5,a.value[4]);a=l.realmult(.5,a.value[5]);return f.turnIntoCSList([f.turnIntoCSList([k,
d,e]),f.turnIntoCSList([d,c,a]),f.turnIntoCSList([e,a,b])])};f.det2=function(a,k){var c=l.mult(a.value[0],k.value[1]);return c=l.sub(c,l.mult(a.value[1],k.value[0]))};f.det3=function(a,k,c){return l.complex(a.value[0].value.real*k.value[1].value.real*c.value[2].value.real-a.value[0].value.imag*k.value[1].value.imag*c.value[2].value.real-a.value[0].value.imag*k.value[1].value.real*c.value[2].value.imag-a.value[0].value.real*k.value[1].value.imag*c.value[2].value.imag+a.value[2].value.real*k.value[0].value.real*
c.value[1].value.real-a.value[2].value.imag*k.value[0].value.imag*c.value[1].value.real-a.value[2].value.imag*k.value[0].value.real*c.value[1].value.imag-a.value[2].value.real*k.value[0].value.imag*c.value[1].value.imag+a.value[1].value.real*k.value[2].value.real*c.value[0].value.real-a.value[1].value.imag*k.value[2].value.imag*c.value[0].value.real-a.value[1].value.imag*k.value[2].value.real*c.value[0].value.imag-a.value[1].value.real*k.value[2].value.imag*c.value[0].value.imag-a.value[0].value.real*
k.value[2].value.real*c.value[1].value.real+a.value[0].value.imag*k.value[2].value.imag*c.value[1].value.real+a.value[0].value.imag*k.value[2].value.real*c.value[1].value.imag+a.value[0].value.real*k.value[2].value.imag*c.value[1].value.imag-a.value[2].value.real*k.value[1].value.real*c.value[0].value.real+a.value[2].value.imag*k.value[1].value.imag*c.value[0].value.real+a.value[2].value.imag*k.value[1].value.real*c.value[0].value.imag+a.value[2].value.real*k.value[1].value.imag*c.value[0].value.imag-
a.value[1].value.real*k.value[0].value.real*c.value[2].value.real+a.value[1].value.imag*k.value[0].value.imag*c.value[2].value.real+a.value[1].value.imag*k.value[0].value.real*c.value[2].value.imag+a.value[1].value.real*k.value[0].value.imag*c.value[2].value.imag,-a.value[0].value.imag*k.value[1].value.imag*c.value[2].value.imag+a.value[0].value.imag*k.value[1].value.real*c.value[2].value.real+a.value[0].value.real*k.value[1].value.real*c.value[2].value.imag+a.value[0].value.real*k.value[1].value.imag*
c.value[2].value.real-a.value[2].value.imag*k.value[0].value.imag*c.value[1].value.imag+a.value[2].value.imag*k.value[0].value.real*c.value[1].value.real+a.value[2].value.real*k.value[0].value.real*c.value[1].value.imag+a.value[2].value.real*k.value[0].value.imag*c.value[1].value.real-a.value[1].value.imag*k.value[2].value.imag*c.value[0].value.imag+a.value[1].value.imag*k.value[2].value.real*c.value[0].value.real+a.value[1].value.real*k.value[2].value.real*c.value[0].value.imag+a.value[1].value.real*
k.value[2].value.imag*c.value[0].value.real+a.value[0].value.imag*k.value[2].value.imag*c.value[1].value.imag-a.value[0].value.imag*k.value[2].value.real*c.value[1].value.real-a.value[0].value.real*k.value[2].value.real*c.value[1].value.imag-a.value[0].value.real*k.value[2].value.imag*c.value[1].value.real+a.value[2].value.imag*k.value[1].value.imag*c.value[0].value.imag-a.value[2].value.imag*k.value[1].value.real*c.value[0].value.real-a.value[2].value.real*k.value[1].value.real*c.value[0].value.imag-
a.value[2].value.real*k.value[1].value.imag*c.value[0].value.real+a.value[1].value.imag*k.value[0].value.imag*c.value[2].value.imag-a.value[1].value.imag*k.value[0].value.real*c.value[2].value.real-a.value[1].value.real*k.value[0].value.real*c.value[2].value.imag-a.value[1].value.real*k.value[0].value.imag*c.value[2].value.real)};f.det4m=function(a){var k=a.value,c=k[0].value,b=c[0].value,d=+b.real,e=+b.imag,b=c[1].value,f=+b.real,g=+b.imag,b=c[2].value,h=+b.real,m=+b.imag,b=c[3].value,n=+b.real,
p=+b.imag,c=k[1].value,b=c[0].value,q=+b.real,r=+b.imag,b=c[1].value,v=+b.real,w=+b.imag,b=c[2].value,u=+b.real,y=+b.imag,b=c[3].value,c=+b.real,b=+b.imag;a=d*v-e*w-f*q+g*r;var z=d*w+e*v-f*r-g*q,x=d*u-e*y-h*q+m*r,A=d*y+e*u-h*r-m*q,B=d*c-e*b-n*q+p*r,D=d*b+e*c-n*r-p*q,C=f*u-g*y-h*v+m*w,E=f*y+g*u-h*w-m*v,F=f*c-g*b-n*v+p*w,G=f*b+g*c-n*w-p*v,J=h*c-m*b-n*u+p*y,H=h*b+m*c-n*y-p*u,c=k[2].value,b=c[0].value,d=+b.real,e=+b.imag,b=c[1].value,f=+b.real,g=+b.imag,b=c[2].value,h=+b.real,m=+b.imag,b=c[3].value,n=
+b.real,p=+b.imag,c=k[3].value,b=c[0].value,q=+b.real,r=+b.imag,b=c[1].value,v=+b.real,w=+b.imag,b=c[2].value,u=+b.real,y=+b.imag,b=c[3].value,c=+b.real,b=+b.imag,k=d*v-e*w-f*q+g*r,Uc=d*w+e*v-f*r-g*q,I=d*u-e*y-h*q+m*r,K=d*y+e*u-h*r-m*q,L=d*c-e*b-n*q+p*r,d=d*b+e*c-n*r-p*q,e=f*u-g*y-h*v+m*w,q=f*y+g*u-h*w-m*v,r=f*c-g*b-n*v+p*w,f=f*b+g*c-n*w-p*v,g=h*c-m*b-n*u+p*y,h=h*b+m*c-n*y-p*u;return l.complex(a*g-z*h-x*r+A*f+B*e-D*q+C*L-E*d-F*I+G*K+J*k-H*Uc,a*h+z*g-x*f-A*r+B*q+D*e+C*d+E*L-F*K-G*I+J*Uc+H*k)};f.eucangle=
function(a,k){var c=f.cross(a,f.linfty),b=f.cross(k,f.linfty),d=f.det3(f.ez,c,f.ii),c=f.det3(f.ez,c,f.jj),e=f.det3(f.ez,b,f.ii),b=f.det3(f.ez,b,f.jj),d=l.div(l.mult(d,b),l.mult(e,c)),d=l.log(d);return d=l.mult(d,l.complex(0,.5))};f.zerovector=function(a){a=Math.floor(a.value.real);for(var k=Array(a),c=0;c<a;c++)k[c]=0;return f.realVector(k)};f.zeromatrix=function(a,k){for(var c=Math.floor(a.value.real),b=Array(c),d=0;d<c;d++)b[d]=f.zerovector(k);return f.turnIntoCSList(b)};f.vandermonde=function(a){for(var k=
a.value.length,c=f.zeromatrix(k,k),b=0;b<k;b++)for(var d=0;d<k;d++)c.value[b].value[d]=l.pow(a.value[b],l.real(d-1));return c};f.transpose=function(a){for(var k=[],c=a.value[0].value.length,b=a.value.length,d=0;d<c;d++){for(var e=[],l=0;l<b;l++)e[l]=a.value[l].value[d];k[d]=f.turnIntoCSList(e)}return f.turnIntoCSList(k)};f.column=function(a,k){for(var c=[],b=a.value.length,d=Math.floor(k.value.real-1),e=0;e<b;e++)c[e]=a.value[e].value[d];return f.turnIntoCSList(c)};f.row=function(a,k){for(var c=[],
b=a.value[0].value.length,d=Math.floor(k.value.real-1),e=0;e<b;e++)c[e]=a.value[d].value[e];return f.turnIntoCSList(c)};f.adjoint2=function(a){var k=a.value[0].value[0],c=a.value[1].value[0],b=Array(2);b[0]=f.turnIntoCSList([a.value[1].value[1],l.neg(a.value[0].value[1])]);b[1]=f.turnIntoCSList([l.neg(c),k]);return b=f.turnIntoCSList(b)};f.adjoint3=function(a){var k,c,b,d,e,f,l,g,h,m,n,p,q,r,v,w,u;k=a.value[0].value;c=k[0].value;b=c.real;d=c.imag;c=k[1].value;e=c.real;f=c.imag;c=k[2].value;l=c.real;
g=c.imag;k=a.value[1].value;c=k[0].value;h=c.real;m=c.imag;c=k[1].value;n=c.real;p=c.imag;c=k[2].value;q=c.real;r=c.imag;k=a.value[2].value;c=k[0].value;a=c.real;v=c.imag;c=k[1].value;w=c.real;u=c.imag;c=k[2].value;k=c.real;c=c.imag;return{ctype:"list",value:[{ctype:"list",value:[{ctype:"number",value:{real:n*k-q*w-p*c+r*u,imag:n*c-q*u-w*r+k*p}},{ctype:"number",value:{real:-e*k+l*w+f*c-g*u,imag:-e*c+l*u+w*g-k*f}},{ctype:"number",value:{real:e*q-l*n-f*r+g*p,imag:e*r-l*p-n*g+q*f}}]},{ctype:"list",value:[{ctype:"number",
value:{real:-h*k+q*a+m*c-r*v,imag:-h*c+q*v+a*r-k*m}},{ctype:"number",value:{real:b*k-l*a-d*c+g*v,imag:b*c-l*v-a*g+k*d}},{ctype:"number",value:{real:-b*q+l*h+d*r-g*m,imag:-b*r+l*m+h*g-q*d}}]},{ctype:"list",value:[{ctype:"number",value:{real:h*w-n*a-m*u+p*v,imag:h*u-n*v-a*p+w*m}},{ctype:"number",value:{real:-b*w+e*a+d*u-f*v,imag:-b*u+e*v+a*f-w*d}},{ctype:"number",value:{real:b*n-e*h-d*p+f*m,imag:b*p-e*m-h*f+n*d}}]}]}};f.inverse=function(a){var k=a.value.length;if(k!==a.value[0].value.length)return console.log("Inverse works only for square matrices"),
m;if(2===k)return f.scaldiv(f.det(a),f.adjoint2(a));if(3===k)return f.scaldiv(f.det(a),f.adjoint3(a));k=f.LUdecomp(a);a=a.value.length;var c=l.real(0),b=l.real(1),d=f.zerovector(l.real(a));d.value[0]=b;for(var e=Array(a),g=0;g<a;g++)e[g]=f._helper.LUsolve(k,d),d.value[g]=c,d.value[g+1]=b;e=f.turnIntoCSList(e);return e=f.transpose(e)};f.linearsolve=function(a,k){return 2===a.value.length?f.linearsolveCramer2(a,k):3===a.value.length?f.linearsolveCramer3(a,k):f.LUsolve(a,k)};f.getDiag=function(a){if(a.value.length!==
a.value[0].value.length)return m;for(var k=Array(a.value.length),c=0;c<a.value.length;c++)k[c]=a.value[c].value[c];return f.turnIntoCSList(k)};f.getSubDiag=function(a){if(a.value.length!==a.value[0].value.length)return m;for(var k=Array(a.value.length-1),c=0;c<a.value.length-1;c++)k[c]=a.value[c+1].value[c];return f.turnIntoCSList(k)};f.eig2=function(a){var k=l.add(a.value[0].value[0],a.value[1].value[1]);a=f.det2(a.value[0],a.value[1]);var c=l.mult(k,k),b=k=l.mult(k,l.real(.5));a=l.sqrt(l.sub(l.div(c,
l.real(4)),a));k=l.add(k,a);b=l.sub(b,a);return f.turnIntoCSList([k,b])};f.eig=function(a,k){var c=k||!0,b=a,d=l.real(b.value.length),e=d.value.real;l.real(0);var b=f._helper.QRIteration(b)[0],b=f.getDiag(b),b=f.sort1(b),d=f.idMatrix(d,d),g=Array(e),g=f.turnIntoCSList(g);if(c){for(var h,m,n,p=0,q=!1,c=0;c<e;c++)q?m=h.value[p]:(h=b.value[c],h=f.sub(a,f.scalmult(h,d)),h=f.nullSpace(h),m=h.value[0],void 0!==m&&(n=m)),void 0===m&&(m=n),1E-8>f.abs(m).value.real&&0===p&&(m=f._helper.inverseIteration(a,
b.value[c])),g.value[c]=f._helper.isAlmostZeroVec(m)?m:f.scaldiv(f.abs(m),m),c<e-1&&((q=1E-6>l.abs(l.sub(b.value[c],b.value[c+1])).value.real)?p++:p=0);g=f.transpose(g)}return f.turnIntoCSList([b,g])};f._helper.isNormalMatrix=function(a){return 1E-10>f.abs(f.sub(a,f.transjugate(a))).value.real};f._helper.QRIteration=function(a,k){var c,b=a;c=l.real(b.value.length);var d=c.value.real,e=c.value.real;l.real(0);var g=f.idMatrix(c,c),h=f.zeromatrix(c,c),m=f.idMatrix(c,c),n=k?k:2500,p,q,r,w=0,u=Array(e);
for(c=0;c<n;c++){g=f._helper.getBlock(b,[e-2,e-1],[e-2,e-1]);p=f.eig2(g);g=p.value[0];p=p.value[1];f.abs(g);f.abs(p);q=b.value[e-1].value[e-1];r=l.abs(l.sub(q,g)).value.real;q=l.abs(l.sub(q,p)).value.real;p=r<q?g:p;g=f.idMatrix(l.real(e),l.real(e));p=f.scalmult(p,g);g=f.QRdecomp(f.sub(b,p));b=v.mult(g.R,g.Q);b=f.add(b,p);g.Q=f._helper.buildBlockMatrix(g.Q,f.idMatrix(l.real(w),l.real(w)));m=v.mult(m,g.Q);if(1E-48>l.abs2(b.value[b.value.length-1].value[b.value[0].value.length-2]).value.real&&1<e){u[d-
w-1]=b.value[e-1].value[e-1];for(c=0;c<e;c++)h.value[e-1].value[c]=b.value[e-1].value[c],h.value[c].value[e-1]=b.value[c].value[e-1];b=f._helper.getBlock(b,[0,e-2],[0,e-2]);w++;e--}if(1===e){h.value[0].value[0]=b.value[0].value[0];break}if(f._helper.isUpperTriangular(b)){for(c=0;c<e;c++)h.value[c].value[c]=b.value[c].value[c];break}}return[h,m]};f.rank=function(a,k){return f.RRQRdecomp(a,k).rank};f._helper.isAlmostZeroVec=function(a){for(var k=a.value.length,c=0;c<k;c++)if(!l._helper.isAlmostZero(a.value[c]))return!1;
return!0};f._helper.isLowerTriangular=function(a){for(var k=a.value.length,c=a.value[0].value.length,b=0;b<k;b++)for(var d=b+1;d<c;d++)if(!l._helper.isAlmostZero(a.value[b].value[d]))return!1;return!0};f._helper.isUpperTriangular=function(a){return f._helper.isLowerTriangular(f.transpose(a))};f._helper.isAlmostId=function(a){var k=a.value.length,c=l.real(k);if(k!==a.value[0].value.length)return!1;a=f.sub(a,f.idMatrix(c),c);for(c=0;c<k;c++)for(var b=0;b<k;b++)if(1E-16<l.abs(a.value[c].value[b]).value.real)return!1;
return!0};f.nullSpace=function(a,k){var c=a.value.length,b=f.RRQRdecomp(f.transjugate(a),k),d=f.transpose(b.Q),b=c-b.rank.value.real,e=Array(b);d.value.reverse();for(var g,h=0;h<b;h++)g=d.value[h],e[h]=f.scaldiv(f.abs(g),g);e=f.turnIntoCSList(e);return 0<e.value.length?e:f.turnIntoCSList([f.zerovector(l.real(c))])};f._helper.isAlmostDiagonal=function(a){var k=a.value.length;l.real(k);l.real(0);if(k!==a.value[0].value.length)return!1;for(var c=0;c<k;c++)for(var b=0;b<k;b++)if(c!==b&&1E-16<l.abs(a.value[c].value[b]).value.real)return!1;
return!0};f._helper.inverseIteration=function(a,k){console.log("warning: code untested");for(var c=a.value.length,b=Array(c),d=0;d<c;d++)b[d]=2*Math.random()-.5;var d=b=f.realVector(b),c=f.idMatrix(l.real(c),l.real(c)),e;e=l.add(k,l.real(.1*Math.random()-.5));for(var g=0;100>g;g++)d=f.scaldiv(f.abs(b),b),b=f.LUsolve(f.sub(a,f.scalmult(e,c)),JSON.parse(JSON.stringify(d)));return f.scaldiv(f.abs(b),b)};f._helper.toHessenberg=function(a){var k=JSON.parse(JSON.stringify(a)),c=k.value.length,b=l.real(c-
1),d=l.real(c);l.real(1);if(f._helper.isUpperTriangular(k))return[f.idMatrix(b,b),a];var e;a=f.idMatrix(d,d);for(var g,d=1;d<c-1;d++)e=f.column(k,l.real(d)),e.value=e.value.splice(d),g=f.abs2(e).value.real,1E-16<g&&(e=f._helper.getHouseHolder(e),a=v.mult(a,e),k=v.mult(v.mult(e,k),e)),b.value.real--;return[a,k]};f._helper.swapEl=function(a,k,c){var b;"[object Array]"===Object.prototype.toString.call(a)?(b=a[k],a[k]=a[c],a[c]=b):"list"===a.ctype&&(b=a.value[k],a.value[k]=a.value[c],a.value[c]=b)};f.RRQRdecomp=
function(a,k){var c=Math.sqrt(l.eps);void 0!==k&&(c=.1*k.value.real);var c=c*c,b,d=a.value.length,e=l.real(d),g=l.real(1),h=f._helper.unitvector(l.real(a.value.length),g),m=f.idMatrix(e,e),n=JSON.parse(JSON.stringify(a)),p=f.transpose(a),q=Array(d);for(b=0;b<d;b++)q[b]=f.abs2(p.value[b]);q=f.turnIntoCSList(q);p=Array(d);for(b=0;b<d;b++)p[b]=b;b=f.maxIndex(q,l.abs);for(var r=q.value[b],w=0,u=0;1E-16<l.abs2(r).value.real;u++){w++;f._helper.swapColumn(n,u,b);f._helper.swapEl(q,u,b);f._helper.swapEl(p,
u,b);b=f._helper.getBlock(n,[u],[u]);b=f.column(b,g);r=f.abs2(b).value.real;1E-8<r&&(b=f._helper.getHouseHolder(b),b=f._helper.buildBlockMatrix(f.idMatrix(l.real(u),l.real(u)),b),m=v.mult(m,f.transjugate(b)),n=v.mult(b,n));for(b=u+1;b<d;b++)q.value[b]=l.sub(q.value[b],l.mult(n.value[u].value[b],l.conjugate(n.value[u].value[b])));b=f.maxIndex(q,l.abs2,u+1);r=q.value[b];if(u+2===d){l.abs(r).value.real>c&&w++;break}e=l.sub(e,g);h.value=h.value.splice(0,h.value.length-1)}return{Q:m,R:n,P:f.turnIntoCSList(p),
rank:l.real(w)}};f._helper.getHouseHolder=function(a){var k=l.real(a.value.length);if(1E-16>f.abs2(a))return f.idMatrix(k,k);var c,b=l.real(1),d=f._helper.unitvector(l.real(a.value.length),b);c=f._helper.QRgetAlpha(a,0);c=f.sub(a,f.scalmult(c,d));c=f.scaldiv(f.abs(c),c);a=l.div(f.sesquilinearproduct(a,c),f.sesquilinearproduct(c,a));k=f.idMatrix(k,k);return k=f.sub(k,f.scalmult(l.add(b,a),f._helper.transposeMult(c,f.conjugate(c))))};f._helper.reOrderbyPivots=function(a,k){for(var c=a.value.length.length,
b=f.transpose(a),c=Array(c),d=0;d<k.length;d++)c[k[d]]=b.value[d];c=f.turnIntoCSList(c);return f.transpose(c)};f.QRdecomp=function(a){var k,c=a.value.length,b=l.real(c);if(f._helper.isUpperTriangular(a))return{Q:f.idMatrix(b,b),R:a};var d=l.real(1),e=f._helper.unitvector(l.real(a.value.length),d),g,h=f.idMatrix(b,b);a=JSON.parse(JSON.stringify(a));for(var m=0;;m++){k=f._helper.getBlock(a,[m],[m]);k=f.column(k,d);g=f.abs2(k).value.real;1E-8<g&&(k=f._helper.getHouseHolder(k),k=f._helper.buildBlockMatrix(f.idMatrix(l.real(m),
l.real(m)),k),h=v.mult(h,f.transjugate(k)),a=v.mult(k,a));if(m+2===c)break;b=l.sub(b,d);e.value=e.value.splice(0,e.value.length-1)}return{Q:h,R:a}};f._helper.swapColumn=function(a,k,c){for(var b,d=0;d<a.value.length;d++)b=a.value[d].value[k],a.value[d].value[k]=a.value[d].value[c],a.value[d].value[c]=b};f._helper.buildBlockMatrix=function(a,k){if(0===a.value.length)return k;if(0===k.value.length)return a;for(var c=a.value.length,b=a.value[0].value.length,d=b+k.value[0].value.length,d=f.zeromatrix(l.real(c+
k.value.length),l.real(d)),e=0;e<a.value.length;e++)for(var g=0;g<a.value[0].value.length;g++)d.value[e].value[g]=a.value[e].value[g];for(e=0;e<k.value.length;e++)for(g=0;g<k.value[0].value.length;g++)d.value[c+e].value[b+g]=k.value[e].value[g];return d};f._helper.getBlock=function(a,k,c){a=JSON.parse(JSON.stringify(a));var b=k[0],d=c[0];k=void 0===k[1]?a.value.length:k[1];c=void 0===c[1]?a.value[0].value.length:c[1];k++;c++;a.value=a.value.slice(b,k);for(b=0;b<a.value.length;b++)a.value[b].value=
a.value[b].value.slice(d,c);return a};f._helper.setBlock=function(a,k,c){a=JSON.parse(JSON.stringify(a));var b=c[0];c=c[1];for(var d=k.value.length,e=k.value[0].value.length,f=0;f<d;f++)for(var g=0;g<e;g++)a.value[b+f].value[c+g]=k.value[f].value[g];return a};f._helper.transposeMult=function(a,k){if(a.value.length!==k.value.length)return m;for(var c=a.value.length,b=Array(c),d=0;d<c;d++)b[d]=f.scalmult(a.value[d],k);return f.turnIntoCSList(b)};f._helper.QRgetAlpha=function(a,k){return 0>a.value[k].value.real?
f.abs(a):l.neg(f.abs(a))};f.LUdecomp=function(a){a=JSON.parse(JSON.stringify(a));var k,c,b,d,e,f=0,g,h=a.value.length,m=h-1,n=Array(h);for(b=0;b<h;++b){e=b;d=a.value[b];g=l.abs(d.value[b]).value.real;for(c=b+1;c<h;++c)k=l.abs(a.value[c].value[b]),g<k.value.real&&(g=k.value.real,e=c);g<l.eps&&console.log("Warning: singular matrix!");n[b]=e;e!==b&&(a.value[b]=a.value[e],a.value[e]=d,d=a.value[b],f++);c=d.value[b];for(k=b+1;k<h;++k)a.value[k].value[b]=l.div(a.value[k].value[b],c);for(k=b+1;k<h;++k){e=
a.value[k];for(c=b+1;c<m;++c)e.value[c]=l.sub(e.value[c],l.mult(e.value[b],d.value[c])),++c,e.value[c]=l.sub(e.value[c],l.mult(e.value[b],d.value[c]));c===m&&(e.value[c]=l.sub(e.value[c],l.mult(e.value[b],d.value[c])))}}return{LU:a,P:n,TransPos:f}};f.LUsolve=function(a,k){var c=f.LUdecomp(a);return f._helper.LUsolve(c,k)};f._helper.LUsolve=function(a,k){var c=JSON.parse(JSON.stringify(k)),b,d=a.LU,e=d.value.length,f=JSON.parse(JSON.stringify(c)),g=a.P,h;for(b=e-1;-1!==b;--b)f.value[b]=c.value[b];
for(b=0;b<e;++b)for(c=g[b],g[b]!==b&&(h=f.value[b],f.value[b]=f.value[c],f.value[c]=h),h=d.value[b],c=0;c<b;++c)f.value[b]=l.sub(f.value[b],l.mult(f.value[c],h.value[c]));for(b=e-1;0<=b;--b){h=d.value[b];for(c=b+1;c<e;++c)f.value[b]=l.sub(f.value[b],l.mult(f.value[c],h.value[c]));f.value[b]=l.div(f.value[b],h.value[b])}return f};f.linearsolveCramer2=function(a,k){var c=f.column(a,l.real(1)),b=f.column(a,l.real(2)),d=f.det2(c,b);l._helper.isZero(d)&&console.log("A is not regular!");b=f.det2(k,b);b=
l.div(b,d);c=f.det2(c,k);c=l.div(c,d);return f.turnIntoCSList([b,c])};f.linearsolveCramer3=function(a,k){var c=f.column(a,l.real(1)),b=f.column(a,l.real(2)),d=f.column(a,l.real(3)),e=f.det3(c,b,d);l._helper.isZero(e)&&console.log("A is not regular!");var g=f.det3(k,b,d),d=f.det3(c,k,d),c=f.det3(c,b,k),g=f.turnIntoCSList([g,d,c]);return g=f.scaldiv(e,g)};f.linearsolveCGNR=function(a,k){var c=f.transpose(a),b=v.mult(c,a),c=v.mult(c,k);return f.linearsolveCG(b,c)};f.linearsolveCG=function(a,k){var c,
b,d,e,g,h;e=k;b=c=f.sub(k,v.mult(a,k));for(var m=Math.ceil(1.2*a.value.length),n=0;n<m;){n++;g=v.mult(a,b);h=d=f.scalproduct(c,c);d=l.div(d,f.scalproduct(b,g));e=f.add(e,v.mult(d,b));c=f.sub(c,v.mult(d,g));if(f.abs(c).value.real<l.eps)break;d=f.scalproduct(c,c);d=l.div(d,h);b=f.add(c,v.mult(d,b))}n>=m&&console.log("CG did not converge");return e};f.det=function(a){if(1===a.value.length)return a.value[0].value[0];if(2===a.value.length)return f.det2(a.value[0],a.value[1]);if(3===a.value.length)return f.det3(a.value[0],
a.value[1],a.value[2]);if(4===a.value.length)return f.det4m(a);var k=a.value.length,c=l.real(1),b,d,e=JSON.parse(JSON.stringify(a)),g,h,m,n;for(a=0;a<k-1;a++){d=a;for(b=a+1;b<k;b++)l.abs(e.value[b].value[a]).value.real>l.abs(e.value[d].value[a]).value.real&&(d=b);d!==a&&(b=e.value[d],e.value[d]=e.value[a],e.value[a]=b,c=l.neg(c));g=e.value[a];for(b=a+1;b<k;b++){h=e.value[b];m=l.div(h.value[a],g.value[a]);for(d=a+1;d<k-1;d+=2)n=d+1,h.value[d]=l.sub(h.value[d],l.mult(g.value[d],m)),h.value[n]=l.sub(h.value[n],
l.mult(g.value[n],m));d!==k&&(h.value[d]=l.sub(h.value[d],l.mult(g.value[d],m)))}if(l._helper.isZero(g.value[a]))return l.real(0);c=l.mult(c,g.value[a])}return l.mult(c,e.value[a].value[a])};f.LUdet=function(a){a=f.LUdecomp(a);for(var k=a.LU,c=k.value.length,b=k.value[0].value[0],d=1;d<c;d++)b=l.mult(b,k.value[d].value[d]);1===a.TransPos%2&&(b=l.neg(b));return b};f.getField=function(a,k){var c;if("homog"===k){if(f._helper.isNumberVecN(a,3))return a;if(f._helper.isNumberVecN(a,2))return f.turnIntoCSList([a.value[0],
a.value[1],l.real(1)])}if("xy"===k){if(f._helper.isNumberVecN(a,2))return a;if(f._helper.isNumberVecN(a,3))return f.turnIntoCSList([l.div(a.value[0],a.value[2]),l.div(a.value[1],a.value[2])])}if("x"===k&&f.isNumberVector(a)){c=a.value.length;if(0<c&&3!==c)return a.value[0];if(3===c)return"Point"===a.usage?l.div(a.value[0],a.value[2]):a.value[0]}if("y"===k&&f.isNumberVector(a)){c=a.value.length;if(1<c&&3!==c)return a.value[1];if(3===c)return"Point"===a.usage?l.div(a.value[1],a.value[2]):a.value[1]}return"z"===
k&&f.isNumberVector(a)&&(c=a.value.length,2<c)?a.value[2]:m};f.nil=f.turnIntoCSList([]);f.ofGeos=function(a){return f.turnIntoCSList(a.map(function(a){return{ctype:"geo",value:a}}))};var v={_helper:{},order:{undefined:0,"boolean":1,number:2,term:3,atomic:4,variable:5,geo:6,string:7,list:8},string:function(a){return{ctype:"string",value:a}},bool:function(a){return{ctype:"boolean",value:a}},not:function(a){return v.bool(!a.value)},isLessThan:function(a,k){return-1===v.compare(a,k)},isEqual:function(a,
k){return 0===v.compare(a,k)},compareResults:function(a,k){return v.compare(a.result,k.result)},compare:function(a,k){if(a.ctype!==k.ctype)return v.order[a.ctype]-v.order[k.ctype];if("number"===a.ctype)return l._helper.compare(a,k);if("list"===a.ctype)return f._helper.compare(a,k);if("string"===a.ctype)return a.value===k.value?0:a.value<k.value?-1:1;if("boolean"===a.ctype)return a.value===k.value?0:!1===a.value?-1:1},add:function(a,k){return"void"===a.ctype&&"number"===k.ctype||"void"===a.ctype&&
"list"===k.ctype?k:"number"===a.ctype&&"number"===k.ctype?l.add(a,k):"string"===a.ctype||"string"===k.ctype?{ctype:"string",value:H(a)+H(k)}:"list"===a.ctype&&"list"===k.ctype?f.add(a,k):m},sub:function(a,k){return"void"===a.ctype&&"number"===k.ctype?l.neg(k):"void"===a.ctype&&"list"===k.ctype?f.neg(k):"number"===a.ctype&&"number"===k.ctype?l.sub(a,k):"list"===a.ctype&&"list"===k.ctype?f.sub(a,k):m},mult:function(a,k){return"number"===a.ctype&&"number"===k.ctype?l.mult(a,k):"number"===a.ctype&&"list"===
k.ctype?f.scalmult(a,k):"list"===a.ctype&&"number"===k.ctype?f.scalmult(k,a):"list"===a.ctype&&"list"===k.ctype?f.mult(a,k):m},div:function(a,k){return"number"===a.ctype&&"number"===k.ctype?l.div(a,k):"list"===a.ctype&&"number"===k.ctype?f.scaldiv(k,a):m},max:function(a,k){return"number"===a.ctype&&"number"===k.ctype?l.max(a,k):"list"===a.ctype&&"list"===k.ctype?f.max(a,k):m},min:function(a,k){return"number"===a.ctype&&"number"===k.ctype?l.min(a,k):"list"===a.ctype&&"list"===k.ctype?f.min(a,k):m},
wrap:function(a){if("number"===typeof a)return l.real(a);if("object"===typeof a&&void 0!==a.length){for(var k=[],c=0;c<a.length;c++)k[c]=v.wrap(a[c]);return f.turnIntoCSList(k)}return"string"===typeof a?{ctype:"string",value:a}:"boolean"===typeof a?{ctype:"boolean",value:a}:m},unwrap:function(a){if("object"!==typeof a||null===a)return a;if(Array.isArray(a))return a.map(v.unwrap);switch(a.ctype){case "string":case "boolean":return a.value;case "number":return 0===a.value.imag?a.value.real:{r:a.value.real,
i:a.value.imag};case "list":return a.value.map(v.unwrap);default:return null}},withUsage:function(a,k){return{ctype:a.ctype,value:a.value,usage:k}}},Za={},O={};O[":"]=$a(":");O["\u00b0"]=function(a,k){var c=C(a[0]);return"number"===c.ctype&&"void"===a[1].ctype?v.withUsage(l.realmult(Math.PI/180,c),"Angle"):m};O._=Kb;O["^"]=qc;O["\u221a"]=function(a,k){return"void"===a[0].ctype?r.sqrt$1([a[1]],k):m};O["*"]=oc;O["\u00d7"]=rc;O["/"]=pc;O["+"]=gc;O["-"]=Cb;O["!"]=function(a,k){var c=C(a[1]);return"void"===
a[0].ctype&&"boolean"===c.ctype?{ctype:"boolean",value:!c.value}:m};O["=="]=ob;O["~="]=Bb;O["~<"]=function(a,k){var c=C(a[0]),b=C(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real-b.value.real<=-l.eps}:m};O["~>"]=function(a,k){var c=C(a[0]),b=C(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real-b.value.real>=l.eps}:m};
O["=:="]=$a("=:=");O[">="]=function(a,k){var c=C(a[0]),b=C(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real>=b.value.real}:"string"===c.ctype&&"string"===b.ctype?{ctype:"boolean",value:c.value>=b.value}:m};O["<="]=function(a,k){var c=C(a[0]),b=C(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real<=b.value.real}:"string"===
c.ctype&&"string"===b.ctype?{ctype:"boolean",value:c.value<=b.value}:m};O["~>="]=function(a,k){var c=C(a[0]),b=C(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real-b.value.real>-l.eps}:m};O["~<="]=function(a,k){var c=C(a[0]),b=C(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real-b.value.real<l.eps}:m};O[">"]=function(a,
k){var c=C(a[0]),b=C(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real>b.value.real}:"string"===c.ctype&&"string"===b.ctype?{ctype:"boolean",value:c.value>b.value}:m};O["<"]=function(a,k){var c=C(a[0]),b=C(a[1]);return"number"===c.ctype&&"number"===b.ctype&&l._helper.isAlmostReal(c)&&l._helper.isAlmostReal(b)?{ctype:"boolean",value:c.value.real<b.value.real}:"string"===c.ctype&&"string"===b.ctype?{ctype:"boolean",
value:c.value<b.value}:m};O["<>"]=dc;O["\u2208"]=function(a,k){var c=z(a[0]),b=z(a[1]);return"list"===b.ctype?f.contains(b,c):m};O["\u2209"]=function(a,k){var c=z(a[0]),b=z(a[1]);return"list"===b.ctype?v.not(f.contains(b,c)):m};O["&"]=ec;O["%"]=fc;O["!="]=dc;O["~!="]=function(a,k){return v.not(Bb(a,k))};O[".."]=function(a,k){var c=z(a[0]),b=z(a[1]);return"number"===c.ctype&&"number"===b.ctype?f.sequence(c,b):m};O["++"]=sc;O["--"]=uc;O["~~"]=tc;O[":>"]=vc;O["<:"]=wc;O["="]=Ab;O[":="]=function(a,k){var c=
"undefined"===a[1].ctype;if("undefined"===a[0].ctype||c)return m;"function"===a[0].ctype&&(c=a[0].oper,Za[c]={oper:c,body:a[1],arglist:a[0].args});"variable"===a[0].ctype&&J.setvar(a[0].name,a[1]);return m};O[":=_"]=function(a,k){if("void"!==a[1].ctype)return m;"function"===a[0].ctype&&delete Za[a[0].oper];return m};O["::="]=$a("::=");O[";"]=function(a,k){var c="void"===a[0].ctype,b="void"===a[1].ctype;if(c&&b)return m;if(!c&&b)return z(a[0]);c||b||z(a[0]);return b?m:z(a[1])};var r={},D={evaluate:function(a,
k,c){if(Za.hasOwnProperty(a)){a=Za[a];if(void 0===a)k=m;else{var b=[];for(c=0;c<a.arglist.length;c++)b[c]=z(k[c]);for(c=0;c<a.arglist.length;c++)J.newvar(a.arglist[c].name),J.setvar(a.arglist[c].name,b[c]);J.pushVstack("*");k=z(a.body);J.cleanVstack();for(c=0;c<a.arglist.length;c++)J.removevar(a.arglist[c].name)}return k}if(b=r[a])return b(k,c);var d=a.lastIndexOf("$");if(-1!==d&&(d=a.substr(0,d),b=r[d]))return b(k,c);ka.err("Called undefined function "+d+" (as "+a+")");return m},equals:function(a,
k){return"number"===a.ctype&&"number"===k.ctype?{ctype:"boolean",value:a.value.real===k.value.real&&a.value.imag===k.value.imag}:"string"===a.ctype&&"string"===k.ctype||"boolean"===a.ctype&&"boolean"===k.ctype?{ctype:"boolean",value:a.value===k.value}:"list"===a.ctype&&"list"===k.ctype?f.equals(a,k):{ctype:"boolean",value:!1}}},J={};J.vars=function(){var a={pi:l.real(Math.PI),"\u03c0":l.real(Math.PI),i:l.complex(0,1),"true":v.bool(!0),"false":v.bool(!1),"#":m,nil:f.turnIntoCSList([]),newline:v.string("\n"),
tab:v.string("\t")},k=[],c;for(c in a)k[c]=[a[c]];return k}();J.isVariable=function(a){return this.vars.hasOwnProperty(a)};J.create=function(a){if(this.vars.hasOwnProperty(a))return this.vars[a];var k=[null];return this.vars[a]=k};J.newvar=function(a){a=this.vars[a];a.push(m);return a};J.removevar=function(a){var k=this.vars[a];0===k.length&&console.error("Removing non-existing "+a);k.pop();0===k.length&&console.warn("Removing last "+a)};J.setvar=function(a,k){var c=this.vars[a];0===c.length&&console.error("Setting non-existing variable "+
a);void 0===k&&(console.error("Setting variable "+a+" to undefined value"),k=m);if("undefined"===k.ctype)c[c.length-1]=k;else{var b=k;null===b&&(b=m);c[c.length-1]=b}};J.undefinedWarning={};J.getvar=function(a){var k=this.vars[a];0===k.length&&console.error("Getting non-existing variable "+a);k=k[k.length-1];if(null===k){if(n.hasOwnProperty(a))return{ctype:"geo",value:n[a]};console&&console.log&&void 0===this.undefinedWarning[a]&&(this.undefinedWarning[a]=!0,console.log("Warning: Accessing undefined variable: "+
a));return m}return k};J.dump=function(a){var k=this.vars[a];console.log("*** Dump "+a);for(a=0;a<k.length;a++)console.log(a+":> "+H(k[a]))};J.vstack=[];J.pushVstack=function(a){this.vstack.push(a)};J.popVstack=function(){this.vstack.pop()};J.cleanVstack=function(){for(var a=this.vstack;0<a.length&&"*"!==a[a.length-1];)this.removevar(a[a.length-1]),a.pop();0<a.length&&a.pop()};var dd={drawgrid:function(a){var k,c,b,d,e,g;k=r.screenbounds$0([],{});c=v.sub(r.take$2([r.take$2([k,l.complex(4,0)],{}),
l.complex(1,0)],{}),a);b=v.add(r.take$2([r.take$2([k,l.complex(2,0)],{}),l.complex(1,0)],{}),a);d=v.sub(r.take$2([r.take$2([k,l.complex(4,0)],{}),l.complex(2,0)],{}),a);e=v.add(r.take$2([r.take$2([k,l.complex(2,0)],{}),l.complex(2,0)],{}),a);g=r.round$1([v.div(v.sub(b,c),a)],{});k=r.round$1([v.div(v.sub(e,d),a)],{});c=v.mult(r.floor$1([v.div(c,a)],{}),a);d=v.mult(r.floor$1([v.div(d,a)],{}),a);for(var h=1;h<=g.value.real;++h)r.draw$2([f.turnIntoCSList([v.add(c,v.mult(l.real(h),a)),d]),f.turnIntoCSList([v.add(c,
v.mult(l.real(h),a)),e])],{color:v.mult(f.turnIntoCSList([l.complex(1,0),l.complex(1,0),l.complex(1,0)]),l.complex(.9,0)),size:l.complex(1,0)});for(e=1;e<=k.value.real;++e)r.draw$2([f.turnIntoCSList([c,v.add(d,v.mult(l.real(e),a))]),f.turnIntoCSList([b,v.add(d,v.mult(l.real(e),a))])],{color:v.mult(f.turnIntoCSList([l.complex(1,0),l.complex(1,0),l.complex(1,0)]),l.complex(.9,0)),size:l.complex(1,0)});return null}},va={generalFields:{color:"color",colorhsb:"",size:"size",alpha:"alpha",isshowing:"isshowing",
visible:"visible",name:"name",caption:"caption",trace:"trace",tracelength:"",selected:""},getGeoField:function(a,k){return"undefined"!==typeof n[a]?va.getField(n[a],k):m},setGeoField:function(a,k,c){return"undefined"!==typeof n[a]?va.setField(n[a],k,c):m},getField:function(a,k){var c;if("P"===a.kind){if("xy"===k)return c=aa(a.homog),v.withUsage(c,"Point");if("homog"===k)return v.withUsage(a.homog,"Point");if("x"===k)return l.div(a.homog.value[0],a.homog.value[2]);if("y"===k)return l.div(a.homog.value[1],
a.homog.value[2])}if("L"===a.kind||"S"===a.kind){if("homog"===k)return v.withUsage(a.homog,"Line");if("angle"===k)return c=f.eucangle(f.ey,a.homog),v.withUsage(c,"Angle")}if("Tr"===a.kind&&"matrix"===k)return a.matrix;if("C"===a.kind){if("radius"===k){var b=a.matrix;c=b.value[0].value[0];var d=b.value[0].value[2],e=b.value[1].value[2],b=b.value[2].value[2];l.mult(c,c);d=l.div(d,c);e=l.div(e,c);c=l.div(b,c);return c=l.sqrt(l.sub(l.add(l.mult(d,d),l.mult(e,e)),c))}if("size"===k)return a.size;if("matrix"===
k)return a.matrix;if("center"===k)return c=p._helper.CenterOfConic(a.matrix),c=aa(c),v.withUsage(c,"Point");if("dualMatrix"===k)return f.normalizeMax(f.adjoint3(a.matrix))}if(va.generalFields[k])return(c=a[va.generalFields[k]])&&c.ctype?c:"object"!==typeof c?v.wrap(c):m;if(a.behavior){if("mass"===k&&"Mass"===a.behavior.type)return l.real(a.behavior.mass);if("radius"===k&&"Mass"===a.behavior.type)return l.real(a.behavior.radius);if("charge"===k&&"Mass"===a.behavior.type)return l.real(a.behavior.charge);
if("friction"===k&&"Mass"===a.behavior.type)return l.real(a.behavior.friction);if("vx"===k&&"Mass"===a.behavior.type)return l.real(a.behavior.vx);if("vy"===k&&"Mass"===a.behavior.type)return l.real(a.behavior.vy);if("v"===k&&"Mass"===a.behavior.type)return f.realVector([a.behavior.vx,a.behavior.vy]);if("fx"===k&&"Mass"===a.behavior.type)return l.real(a.behavior.fx);if("fy"===k&&"Mass"===a.behavior.type)return l.real(a.behavior.fy);if("f"===k&&"Mass"===a.behavior.type)return f.realVector([a.behavior.fx,
a.behavior.fy])}return m},setField:function(a,k,c){var b;"color"===k&&(a.color=c);"size"===k&&(a.size=c);"alpha"===k&&(a.alpha=c);"visible"===k&&"boolean"===c.ctype&&(a.visible=c.value);"pinned"===k&&"boolean"===c.ctype&&(a.pinned=c.value);"printlabel"===k&&(a.printname=H(c));"xy"===k&&"P"===a.kind&&a.movable&&f._helper.isNumberVecN(c,2)&&Ca(a,f.turnIntoCSList([c.value[0],c.value[1],l.real(1)]),"homog");"xy"===k&&"P"===a.kind&&a.movable&&f._helper.isNumberVecN(c,3)&&Ca(a,c,"homog");"x"===k&&"P"===
a.kind&&a.movable&&"number"===c.ctype&&Ca(a,f.turnIntoCSList([l.mult(c,a.homog.value[2]),a.homog.value[1],a.homog.value[2]]),"homog");"y"===k&&"P"===a.kind&&a.movable&&"number"===c.ctype&&Ca(a,f.turnIntoCSList([a.homog.value[0],l.mult(c,a.homog.value[2]),a.homog.value[2]]),"homog");"homog"===k&&"P"===a.kind&&a.movable&&f._helper.isNumberVecN(c,3)&&Ca(a,c,"homog");"homog"===k&&"L"===a.kind&&a.movable&&f._helper.isNumberVecN(c,3)&&Ca(a,c,"homog");if("angle"===k&&"Through"===a.type){b=l.cos(c);var d=
l.sin(c);b=f.turnIntoCSList([b,d,l.real(0)]);Ca(a,b,"dir")}"C"===a.kind&&"radius"===k&&"CircleMr"===a.type&&"number"===c.ctype&&Ca(a,c,"radius");a.behavior&&("mass"===k&&"Mass"===a.behavior.type&&"number"===c.ctype&&(a.behavior.mass=c.value.real),"mass"===k&&"Sun"===a.behavior.type&&"number"===c.ctype&&(a.behavior.mass=c.value.real),"friction"===k&&"Mass"===a.behavior.type&&"number"===c.ctype&&(a.behavior.friction=c.value.real),"charge"===k&&"Mass"===a.behavior.type&&"number"===c.ctype&&(a.behavior.charge=
c.value.real),"radius"===k&&"Mass"===a.behavior.type&&"number"===c.ctype&&(a.behavior.radius=c.value.real),"vx"===k&&"Mass"===a.behavior.type&&"number"===c.ctype&&(a.behavior.vx=c.value.real),"vy"===k&&"Mass"===a.behavior.type&&"number"===c.ctype&&(a.behavior.vy=c.value.real),"v"===k&&"Mass"===a.behavior.type&&f._helper.isNumberVecN(c,2)&&(a.behavior.vx=c.value[0].value.real,a.behavior.vy=c.value[1].value.real))}};r.version$0=function(a,k){var c=["CindyJS"].concat(Ad);return f.turnIntoCSList(c.map(v.wrap))};
r.timestamp$0=function(a,k){return{ctype:"number",value:{real:(new Date).getTime(),imag:0}}};r.seconds$0=function(a,k){return{ctype:"number",value:{real:(new Date).getTime()/1E3,imag:0}}};r.clearconsole$0=function(a,k){ka.clear()};r.err$1=function(a,k){var c="",b;"variable"===a[0].ctype?(c=a[0].name,b=J.getvar(a[0].name)):b=a[0];b=c+" ===> "+H(z(b));ka.err(b);return m};r.errc$1=function(a,k){var c;"variable"===a[0].ctype?(c=z(J.getvar(a[0].name)),console.log(a[0].name+" ===> "+H(c))):(c=z(a[0]),console.log(" ===> "+
H(c)));return m};r.print$1=function(a,k){ka.out(H(z(a[0])),!0);return m};r.println$1=function(a,k){ka.out(H(z(a[0])));return m};r.dump$1=function(a,k){console.log(JSON.stringify(a[0]));return m};r.repeat$2=function(a,k){return r.repeat$3([a[0],null,a[1]],k)};r.repeat$3=function(a,k){var c=C(a[0]),b="#";null!==a[1]&&"variable"===a[1].ctype&&(b=a[1].name);if("number"!==c.ctype)return m;var c=Math.round(c.value.real),d=1,e=1,f=c+1,g=!1,l=!1,h=!1,n;void 0!==k.start&&(n=z(k.start),"number"===n.ctype&&
(g=!0,e=n.value.real));void 0!==k.step&&(n=z(k.step),"number"===n.ctype&&(h=!0,d=n.value.real));void 0!==k.stop&&(n=z(k.stop),"number"===n.ctype&&(l=!0,f=n.value.real));!g||l||h||(f=d*c+e);g||!l||h||(e=-d*(c-1)+f,f+=d);g||l||!h||(f=d*c+e);g&&l&&!h&&(d=(f-e)/(c-1),f+=d);g&&!l&&h&&(f=d*c+e);!g&&l&&h&&(e=-d*(c-1)+f,f+=d);g&&l&&h&&(f+=d);(e<=f&&0<d||e>=f&&0>d)&&g&&l&&h&&(c=Math.floor((f-e)/d));J.newvar(b);f=m;for(g=0;g<c;g++)J.setvar(b,{ctype:"number",value:{real:g*d+e,imag:0}}),f=z(a[2]);J.removevar(b);
return f};r.while$2=function(a,k){for(var c=a[1],b=a[0],d=z(b),e=m;"list"!==d.ctype&&d.value;)e=z(c),d=z(b);return e};r.apply$2=function(a,k){return r.apply$3([a[0],null,a[1]],k)};r.apply$3=function(a,k){var c=C(a[0]);if("list"!==c.ctype)return m;var b="#";null!==a[1]&&"variable"===a[1].ctype&&(b=a[1].name);var c=c.value,d=[];J.newvar(b);for(var e=0;e<c.length;e++)J.setvar(b,c[e]),d[e]=z(a[2]);J.removevar(b);return{ctype:"list",value:d}};r.forall$2=function(a,k){return r.forall$3([a[0],null,a[1]],
k)};r.forall$3=function(a,k){var c=C(a[0]);if("list"!==c.ctype)return m;var b="#";null!==a[1]&&"variable"===a[1].ctype&&(b=a[1].name);c=c.value;J.newvar(b);for(var d,e=0;e<c.length;e++)J.setvar(b,c[e]),d=z(a[2]);J.removevar(b);return d};r.select$2=function(a,k){return r.select$3([a[0],null,a[1]],k)};r.select$3=function(a,k){var c=C(a[0]);if("list"!==c.ctype)return m;var b="#";null!==a[1]&&"variable"===a[1].ctype&&(b=a[1].name);var c=c.value,d=[];J.newvar(b);for(var e=0,f=0;f<c.length;f++){J.setvar(b,
c[f]);var g=z(a[2]);"boolean"===g.ctype&&!0===g.value&&(d[e]=c[f],e++)}J.removevar(b);return{ctype:"list",value:d}};r.flatten$1=function(a,k){function c(a,k){return-1===k||"list"!==a.ctype?a:[].concat.apply([],a.value.map(function(a){return c(a,k-1)}))}var b=C(a[0]);if("list"!==b.ctype)return b;var d=k.levels;void 0===d?d=1:(d=z(d),d="number"===d.ctype?d.value.real:"string"===d.ctype&&"all"===d.value?-2:1);return{ctype:"list",value:c(b,d)}};r.createvar$1=function(a,k){"variable"===a[0].ctype&&J.newvar(a[0].name);
return m};r.local=function(a,k){for(var c=0;c<a.length;c++)"variable"===a[c].ctype&&J.newvar(a[c].name);return m};r.removevar$1=function(a,k){var c=z(a[0]);"variable"===a[0].ctype&&J.removevar(a[0].name);return c};r.release=function(a,k){if(0===a.length)return m;for(var c=z(a[a.length-1]),b=0;b<a.length;b++)"variable"===a[b].ctype&&J.removevar(a[b].name);return c};r.regional=function(a,k){for(var c=0;c<a.length;c++)if("variable"===a[c].ctype){var b=a[c].name;J.newvar(b);J.pushVstack(b)}return m};
r.genList=function(a,k){return f.turnIntoCSList(a.map(z))};D.assigntake=function(a,k){var c=a.args[0],b=z(c),d=C(a.args[1]),e=m;if("list"===b.ctype||"string"===b.ctype)d=Math.floor(d.value.real),0>d&&(d=b.value.length+d+1),0<d&&d<=b.value.length&&("list"===b.ctype?(b=b.value.slice(),b[d-1]=z(k),e=f.turnIntoCSList(b)):(b=b.value,b=b.substring(0,d-1)+H(z(k))+b.substring(d,b.length),e=v.string(b)));Ab([c,e])};D.assigndot=function(a,k){var c=z(a.obj),b=a.key;"geo"===c.ctype&&b&&va.setField(c.value,b,
k);return m};D.assignlist=function(a,k){var c=a.length,b=k.length;b<c&&(c=b);for(b=0;b<c;b++)Ab([a[b],k[b]],[])};r.if$2=function(a,k){return r.if$3(a,k)};r.if$3=function(a,k){var c=C(a[0]);if("boolean"===c.ctype){if(!0===c.value)return z(a[1]);if(3===a.length)return z(a[2])}return m};r.and$2=ec;r.or$2=fc;r.xor$2=function(a,k){var c=C(a[0]),b=C(a[1]);return"boolean"===c.ctype&&"boolean"===b.ctype?{ctype:"boolean",value:c.value!==b.value}:m};r.not$1=function(a,k){var c=C(a[0]);return"boolean"===c.ctype?
{ctype:"boolean",value:!c.value}:m};D.genericListMathGen=function(a,k,c){r[a+"$1"]=function(a,b){var d=z(a[0]);if("list"!==d.ctype)return m;d=d.value;if(0===d.length)return c;for(var t=d[0],e=1;e<d.length;e++)t=k(t,d[e]);return t};var b=a+"$3";r[a+"$2"]=function(a,c){return r[b]([a[0],null,a[1]])};r[b]=function(a,b){var d=C(a[0]);if("list"!==d.ctype)return m;d=d.value;if(0===d.length)return c;var t="#";null!==a[1]&&"variable"===a[1].ctype&&(t=a[1].name);J.newvar(t);J.setvar(t,d[0]);for(var e=z(a[2]),
f=1;f<d.length;f++){J.setvar(t,d[f]);var g=z(a[2]),e=k(e,g)}J.removevar(t);return e}};D.genericListMathGen("product",v.mult,l.real(1));D.genericListMathGen("sum",v.add,l.real(0));D.genericListMathGen("max",v.max,m);D.genericListMathGen("min",v.min,m);r.max$2=function(a,k){var c=C(a[0]);if("list"===c.ctype)return r.max$3([c,null,a[1]]);var b=C(a[1]);return r.max$1([f.turnIntoCSList([c,b])])};r.min$2=function(a,k){var c=C(a[0]);if("list"===c.ctype)return r.min$3([c,null,a[1]]);var b=C(a[1]);return r.min$1([f.turnIntoCSList([c,
b])])};r.add$2=gc;r.sub$2=Cb;r.mult$2=oc;r.div$2=pc;r.mod$2=function(a,k){var c=C(a[0]),b=C(a[1]);return"number"===c.ctype&&"number"===b.ctype?l.mod(c,b):m};r.pow$2=qc;r.exp$1=function(a,k){var c=C(a[0]);return"number"===c.ctype?l.exp(c):m};r.sin$1=function(a,k){var c=C(a[0]);return"number"===c.ctype?l.sin(c):m};r.sqrt$1=function(a,k){var c=C(a[0]);return"number"===c.ctype?l.sqrt(c):m};D.laguerre=function(a,k,c){if("list"!==a.ctype)return m;var b=a.value.length-1,d;for(d=0;d<=b;d++)if("number"!==
a.value[d].ctype)return m;if("number"!==k.ctype)return m;for(var e=[1,.3141,.5926,.5358,.9793,.2385,.6264,.3383,.2795,.0288],f,g,h,n=1;n<=c;n++){g=h=l.zero;f=a.value[b];for(d=b-1;0<=d;d--)h=l.add(g,l.mult(h,k)),g=l.add(f,l.mult(g,k)),f=l.add(a.value[d],l.mult(f,k));if(l._helper.isLessThan(l.abs(f),l.real(1E-14)))break;d=l.div(g,f);g=l.mult(d,d);f=l.sub(g,l.div(l.mult(l.real(2),h),f));h=l.sqrt(l.mult(l.real(b-1),l.sub(l.mult(l.real(b),f),g)));f=l.add(d,h);d=l.sub(d,h);l._helper.isLessThan(l.abs(f),
l.abs(d))&&(f=d);d=l._helper.isLessThan(l.real(1E-14),l.abs(f))?l.div(l.real(b),f):l.mult(l.add(l.abs(k),l.one),l.complex(Math.cos(n),Math.sin(n)));if(l._helper.isLessThan(l.abs(d),l.real(1E-14)))break;0===n%20&&n<c-19&&(d=l.mult(d,l.real(e[Math.floor(n/20)])));k=l.sub(k,d)}return k};D.quadratic_roots=function(a){if("list"!==a.ctype)return m;var k=a.value[2],c=a.value[1];a=a.value[0];if(l._helper.isZero(a))return[l.zero,l.neg(l.div(c,k))];var b=l.sqrt(l.sub(l.mult(c,c),l.mult(l.real(4),l.mult(k,a))));
0<=l.re(c)&&(b=l.neg(b));return[l.div(l.sub(b,c),l.mult(l.real(2),k)),l.div(l.mult(l.real(2),a),l.sub(b,c))]};D.roots=function(a){var k=[],c=a,b=a.value.length-1;if(0>=b)return f.turnIntoCSList([]);if(l._helper.isZero(a.value[b]))return k=D.roots(f.turnIntoCSList(a.value.slice(0,b))),f.append(k,l.infinity);if(1===b)k[0]=l.neg(l.div(a.value[0],a.value[1]));else if(2===b)k=D.quadratic_roots(a);else{for(var d=0;d<b-2;d++){k[d]=D.laguerre(a,l.zero,200);k[d]=D.laguerre(c,k[d],1);var e=[];e[b-d]=a.value[b-
d];for(var g=b-d;0<g;g--)e[g-1]=l.add(a.value[g-1],l.mult(e[g],k[d]));e.shift();a=f.turnIntoCSList(e)}a=D.quadratic_roots(a);k[b-2]=a[0];k[b-1]=a[1]}return f.turnIntoCSList(k)};r.roots$1=function(a,k){var c=C(a[0]);if("list"===c.ctype){for(var b=0;b<c.value.length;b++)if("number"!==c.value[b].ctype)return m;c=D.roots(c);return f.sort1(c)}return m};r.autodiff$3=function(a,k){var c="x",b;if("function"===a[0].ctype)b=Za[a[0].oper].body,c=a[0].args[0].name;else if("function"===typeof a[0].impl)b=a[0];
else return console.log("could not parse function"),m;var d=C(a[1]),e=C(a[2]);if(1>e.value.real)return console.log("grade cant be < 1"),m;e=l.add(e,l.real(1));return N.autodiff(b,c,d,e)};r.cos$1=function(a,k){var c=C(a[0]);return"number"===c.ctype?l.cos(c):m};r.tan$1=function(a,k){var c=C(a[0]);return"number"===c.ctype?l.tan(c):m};r.arccos$1=function(a,k){var c=C(a[0]);return"number"===c.ctype?l.arccos(c):m};r.arcsin$1=function(a,k){var c=C(a[0]);return"number"===c.ctype?l.arcsin(c):m};r.arctan$1=
function(a,k){var c=C(a[0]);return"number"===c.ctype?l.arctan(c):m};r.arctan2$2=function(a,k){var c=C(a[0]),b=C(a[1]);return"number"===c.ctype&&"number"===b.ctype?l.arctan2(c,b):m};r.arctan2$1=function(a,k){var c=C(a[0]);if("list"===c.ctype&&2===c.value.length){if(c=c.value,"number"===c[0].ctype&&"number"===c[1].ctype)return r.arctan2$2(c,k)}else if("number"===c.ctype)return l.arctan2(c);return m};r.log$1=function(a,k){var c=C(a[0]);return"number"===c.ctype?l.log(c):m};D.recursiveGen=function(a){var k=
l[a],c=f[a];r[a+"$1"]=function(a,b){var d=C(a[0]);return"number"===d.ctype?k(d):"list"===d.ctype?c(d):m}};D.recursiveGen("im");D.recursiveGen("re");D.recursiveGen("conjugate");D.recursiveGen("round");D.recursiveGen("ceil");D.recursiveGen("floor");D.recursiveGen("abs");r.abs_infix=r.abs$1;r.random$0=function(a,b){return l.real(l._helper.rand())};r.random$1=function(a,b){var c=C(a[0]);return"number"===c.ctype?l.complex(c.value.real*l._helper.rand(),c.value.imag*l._helper.rand()):m};r.seedrandom$1=function(a,
b){var c=C(a[0]);"number"===c.ctype&&l._helper.seedrandom(c.value.real);return m};r.randomnormal$0=function(a,b){return l.real(l._helper.randnormal())};r.randominteger$1=function(a,b){var c=C(a[0]);if("number"===c.ctype){var d=c.value.real|0,c=c.value.imag|0,d=d*l._helper.rand()|0,c=c*l._helper.rand()|0;return l.complex(d,c)}return m};r.randomint$1=r.randominteger$1;r.randombool$0=function(a,b){return.5<l._helper.rand()?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isreal$1=function(a,
b){var c=z(a[0]);return"number"===c.ctype&&l._helper.isAlmostReal(c)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isinteger$1=function(a,b){var c=z(a[0]);return"number"===c.ctype&&l._helper.isAlmostReal(c)&&c.value.real===Math.floor(c.value.real)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.iseven$1=function(a,b){var c=z(a[0]);return"number"===c.ctype&&l._helper.isAlmostReal(c)&&c.value.real/2===Math.floor(c.value.real/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};
r.isodd$1=function(a,b){var c=z(a[0]);return"number"===c.ctype&&l._helper.isAlmostReal(c)&&(c.value.real-1)/2===Math.floor((c.value.real-1)/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.iscomplex$1=function(a,b){return"number"===z(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isstring$1=function(a,b){return"string"===z(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.islist$1=function(a,b){return"list"===z(a[0]).ctype?{ctype:"boolean",value:!0}:
{ctype:"boolean",value:!1}};r.ismatrix$1=function(a,b){var c=z(a[0]);return-1!==f._helper.colNumb(c)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.iscircle$1=function(a,b){var c=z(a[0]);return"geo"===c.ctype&&"C"===c.value.kind&&"Circle"===c.value.matrix.usage?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isconic$1=function(a,b){var c=z(a[0]);return"geo"===c.ctype&&"C"===c.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isline$1=function(a,b){var c=z(a[0]);
return"geo"===c.ctype&&"L"===c.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.ispoint$1=function(a,b){var c=z(a[0]);return"geo"===c.ctype&&"P"===c.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isgeometric$1=function(a,b){return"geo"===z(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isnumbermatrix$1=function(a,b){var c=z(a[0]);return f.isNumberMatrix(c).value?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isnumbervector$1=
function(a,b){var c=z(a[0]);return f.isNumberVector(c).value?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.issun$1=function(a,b){var c=z(a[0]);return"geo"===c.ctype&&void 0!==c.value.behavior&&"Sun"===c.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.ismass$1=function(a,b){var c=z(a[0]);return"geo"===c.ctype&&void 0!==c.value.behavior&&"Mass"===c.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isspring$1=function(a,b){var c=z(a[0]);
return"geo"===c.ctype&&void 0!==c.value.behavior&&"Spring"===c.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isbouncer$1=function(a,b){var c=z(a[0]);return"geo"===c.ctype&&void 0!==c.value.behavior&&"Bouncer"===c.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.isundefined$1=function(a,b){return"undefined"===z(a[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};r.matrixrowcolumn$1=function(a,b){var c=z(a[0]);return-1!==f._helper.colNumb(c)?
f.realVector([c.value.length,c.value[0].value.length]):m};r.rowmatrix$1=function(a,b){var c=z(a[0]);return"list"===c.ctype?f.turnIntoCSList([c]):m};r.columnmatrix$1=function(a,b){var c=z(a[0]);return"list"===c.ctype?f.turnIntoCSList(c.value.map(function(a){return f.turnIntoCSList([a])})):m};r.submatrix$3=function(a,b){var c=z(a[0]),d=z(a[1]),e=z(a[2]);if("list"===c.ctype&&"number"===d.ctype&&"number"===e.ctype){var g=Math.round(d.value.real),d=Math.round(e.value.real),c=c.value.slice();0<d&&d<=c.length&&
c.splice(d-1,1);var l=!0,c=c.map(function(a){if("list"!==a.ctype)l=!1;else return a=a.value.slice(),0<g&&g<=a.length&&a.splice(g-1,1),f.turnIntoCSList(a)});return l?f.turnIntoCSList(c):m}return m};r.complex$1=function(a,b){var c,d,e;e=C(a[0]);if("list"===e.ctype&&f.isNumberVector(e)){if(2===e.value.length)return c=e.value[0],d=e.value[1],l.complex(c.value.real-d.value.imag,d.value.real+c.value.imag);if(3===e.value.length)return c=e.value[0],d=e.value[1],e=e.value[2],c=l.div(c,e),d=l.div(d,e),l.complex(c.value.real-
d.value.imag,d.value.real+c.value.imag)}return m};r.gauss$1=function(a,b){var c=C(a[0]);return"number"===c.ctype?f.realVector([c.value.real,c.value.imag]):m};r.cross$2=rc;r.crossratio$4=function(a,b){var c=z(a[0]),d=z(a[1]),e=z(a[2]),g=z(a[3]),h=M(c),n=M(d),p=M(e),q=M(g);return h!==m&&n!==m&&p!==m&&q!==m?f.crossratio3(h,n,p,q,f.ii):"number"===c.ctype&&"number"===d.ctype&&"number"===e.ctype&&"number"===g.ctype?l.div(l.mult(l.sub(c,e),l.sub(d,g)),l.mult(l.sub(c,g),l.sub(d,e))):m};r.para$2=function(a,
b){var c=C(a[0]),d=C(a[1]),e=M(c),g=M(d);if(c!==m&&d!==m){var d=d.usage,l=e,h=g;if("Line"===c.usage||"Point"===d)l=g,h=e;c=f.cross(f.cross(f.linfty,h),l);return v.withUsage(c,"Line")}return m};r.perp$2=function(a,b){var c=C(a[0]),d=C(a[1]),e=M(c),g=M(d);if(c!==m&&d!==m){var h=d.usage||g.usage,d=e,n=g;if("Line"===(c.usage||e.usage)||"Point"===h)d=g,n=e;c=f.turnIntoCSList([n.value[0],n.value[1],l.zero]);c=f.cross(c,d);return v.withUsage(c,"Line")}return m};r.perp$1=function(a,b){var c=C(a[0]);return f._helper.isNumberVecN(c,
2)?f.turnIntoCSList([l.neg(c.value[1]),c.value[0]]):m};r.parallel$2=r.para$2;r.perpendicular$2=r.perp$2;r.perpendicular$1=r.perp$1;r.meet$2=function(a,b){var c=M(a[0]),d=M(a[1]);return c!==m&&d!==m?(c=f.cross(c,d),v.withUsage(c,"Point")):m};r.join$2=function(a,b){var c=M(a[0]),d=M(a[1]);return c!==m&&d!==m?(c=f.cross(c,d),v.withUsage(c,"Line")):m};r.dist$2=function(a,b){var c=C(a[0]),d=C(a[1]),c=Cb([c,d],[]);return r.abs$1([c],[])};r.dist_infix=r.dist$2;r.point$1=function(a,b){var c=z(a[0]);return f._helper.isNumberVecN(c,
3)||f._helper.isNumberVecN(c,2)?v.withUsage(c,"Point"):c};r.line$1=function(a,b){var c=z(a[0]);return f._helper.isNumberVecN(c,3)?v.withUsage(c,"Line"):c};r.det$3=function(a,b){var c=M(a[0]),d=M(a[1]),e=M(a[2]);if(c!==m&&d!==m&&e!==m)return f.det3(c,d,e)};r.det$1=function(a,b){var c=C(a[0]);if("list"===c.ctype){var d=f._helper.colNumb(c);if(-1!==d&&d===c.value.length)return f.det(c)}return m};r.eig$1=function(a,b){var c=C(a[0]);if("list"===c.ctype){var d=f._helper.colNumb(c);if(-1!==d&&d===c.value.length)return f.eig(c)}return m};
r.eigenvalues$1=function(a,b){var c=C(a[0]);if("list"===c.ctype){var d=f._helper.colNumb(c);if(-1!==d&&d===c.value.length)return f.eig(c,!1).value[0]}return m};r.rank$1=function(a,b){var c=C(a[0]);if("list"===c.ctype){var d=f._helper.colNumb(c);if(-1!==d&&d===c.value.length)return f.rank(c,b.precision)}return m};r.kernel$1=function(a,b){var c=C(a[0]);if("list"===c.ctype){var d=f._helper.colNumb(c);if(-1!==d&&d===c.value.length)return c=f.nullSpace(c,b.precision),f.transpose(c)}return m};r.eigenvectors$1=
function(a,b){var c=C(a[0]);if("list"===c.ctype){var d=f._helper.colNumb(c);if(-1!==d&&d===c.value.length)return f.eig(c).value[1]}return m};r.area$3=function(a,b){var c=M(a[0]),d=M(a[1]),e=M(a[2]);if(c!==m&&d!==m&&e!==m){var g=c.value[2],h=d.value[2],n=e.value[2];if(!l._helper.isAlmostZero(g)&&!l._helper.isAlmostZero(h)&&!l._helper.isAlmostZero(n))return c=f.scaldiv(g,c),d=f.scaldiv(h,d),e=f.scaldiv(n,e),c=f.det3(c,d,e),l.realmult(.5,c)}return m};r.inverse$1=function(a,b){var c=C(a[0]);if("list"===
c.ctype){var d=f._helper.colNumb(c);if(-1!==d&&d===c.value.length)return f.inverse(c)}return m};r.linearsolve$2=function(a,b){var c=C(a[0]),d=C(a[1]);if("list"===c.ctype){var e=f._helper.colNumb(c);if(-1!==e&&e===c.value.length&&f._helper.isNumberVecN(d,e))return f.linearsolve(c,d)}return m};var id=[[[]],[[0]],[[0,1],[1,0]],[[0,1,2],[0,2,1],[1,0,2],[1,2,0],[2,0,1],[2,1,0]],[[0,1,2,3],[0,1,3,2],[0,2,1,3],[0,2,3,1],[0,3,1,2],[0,3,2,1],[1,0,2,3],[1,0,3,2],[1,2,0,3],[1,2,3,0],[1,3,0,2],[1,3,2,0],[2,0,
1,3],[2,0,3,1],[2,1,0,3],[2,1,3,0],[2,3,0,1],[2,3,1,0],[3,0,1,2],[3,0,2,1],[3,1,0,2],[3,1,2,0],[3,2,0,1],[3,2,1,0]]];r.mincostmatching$1=function(a,b){var c=z(a[0]);if(f.isNumberMatrix(c)){var d=c.value.length,e=f._helper.colNumb(c),g=d<e?e:d,h,n,p=Array(g);for(h=0;h<g;++h)for(p[h]=Array(g),n=0;n<g;++n)p[h][n]=h<d&&n<e?c.value[h].value[n].value.real:0;c=Jb(p);g=Array(d);for(h=0;h<d;++h)n=c[h],g[h]=n<e?l.real(n+1):l.real(0);return f.turnIntoCSList(g)}return m};r.take$2=Kb;r.length$1=function(a,b){var c=
z(a[0]);return"list"===c.ctype||"string"===c.ctype?l.real(c.value.length):m};r.pairs$1=function(a,b){var c=z(a[0]);return"list"===c.ctype?f.pairs(c):m};r.triples$1=function(a,b){var c=z(a[0]);return"list"===c.ctype?f.triples(c):m};r.cycle$1=function(a,b){var c=z(a[0]);return"list"===c.ctype?f.cycle(c):m};r.consecutive$1=function(a,b){var c=z(a[0]);return"list"===c.ctype?f.consecutive(c):m};r.reverse$1=function(a,b){var c=z(a[0]);return"list"===c.ctype?f.reverse(c):m};r.directproduct$2=function(a,
b){var c=z(a[0]),d=z(a[1]);return"list"===c.ctype&&"list"===d.ctype?f.directproduct(c,d):m};r.concat$2=sc;r.common$2=tc;r.remove$2=uc;r.append$2=vc;r.prepend$2=wc;r.contains$2=function(a,b){var c=z(a[0]),d=z(a[1]);return"list"===c.ctype?f.contains(c,d):m};r.sort$2=function(a,b){return r.sort$3([a[0],null,a[1]],b)};r.sort$3=function(a,b){var c=C(a[0]);if("list"!==c.ctype)return m;var d="#";null!==a[1]&&"variable"===a[1].ctype&&(d=a[1].name);var c=c.value,e=[];J.newvar(d);var f;for(f=0;f<c.length;f++)J.setvar(d,
c[f]),e[f]={val:c[f],result:z(a[2])};J.removevar(d);e.sort(v.compareResults);d=[];for(f=0;f<c.length;f++)d[f]=e[f].val;return{ctype:"list",value:d}};r.sort$1=function(a,b){var c=z(a[0]);return"list"===c.ctype?f.sort1(c):m};r.set$1=function(a,b){var c=z(a[0]);return"list"===c.ctype?f.set(c):m};r.combinations$2=function(a,b){function c(a,b){a===h?p.push(f.turnIntoCSList(n.slice())):b<g&&(n[a]=d.value[b],c(a+1,b+1),c(a,b+1))}var d=z(a[0]),e=z(a[1]),g,h,n,p;if("number"===e.ctype){h=e.value.real|0;if("number"===
d.ctype){g=d.value.real|0;g-h<h&&(h=g-h);if(0>h)return l.real(0);if(0===h)return l.real(1);if(1===h)return d;for(var q=e=1,r=1;r<=h;++r)var v=g-h+r|0,w=r|0,u=Lb(v,w)|0,v=v/u|0,w=w/u|0,u=Lb(e,w)|0,e=e/u|0,w=w/u|0,u=Lb(v,q)|0,v=v/u|0,q=q/u|0,e=e*v|0,q=q*w|0;return l.real(e/q)}if("list"===d.ctype){g=d.value.length;if(0>h||h>g)return f.turnIntoCSList([]);if(0===h)return f.turnIntoCSList([f.turnIntoCSList([])]);if(h===g)return f.turnIntoCSList([d]);p=[];n=Array(h);c(0,0);return f.turnIntoCSList(p)}}return m};
r.zeromatrix$2=function(a,b){var c=C(a[0]),d=C(a[1]);return"number"===c.ctype&&"number"===d.ctype?f.zeromatrix(c,d):m};r.zerovector$1=function(a,b){var c=C(a[0]);return"number"===c.ctype?f.zerovector(c):m};r.transpose$1=function(a,b){var c=C(a[0]);return"list"===c.ctype&&-1!==f._helper.colNumb(c)?f.transpose(c):m};r.row$2=function(a,b){var c=C(a[0]),d=C(a[1]);return"number"===d.ctype&&"list"===c.ctype&&-1!==f._helper.colNumb(c)?f.row(c,d):m};r.column$2=function(a,b){var c=C(a[0]),d=C(a[1]);return"number"===
d.ctype&&"list"===c.ctype&&-1!==f._helper.colNumb(c)?f.column(c,d):m};r.red$1=function(a,b){var c=z(a[0]);return"number"===c.ctype?f.realVector([Math.min(1,Math.max(0,c.value.real)),0,0]):m};r.green$1=function(a,b){var c=z(a[0]);return"number"===c.ctype?f.realVector([0,Math.min(1,Math.max(0,c.value.real)),0]):m};r.blue$1=function(a,b){var c=z(a[0]);return"number"===c.ctype?f.realVector([0,0,Math.min(1,Math.max(0,c.value.real))]):m};r.gray$1=function(a,b){var c=z(a[0]);return"number"===c.ctype?(c=
Math.min(1,Math.max(0,c.value.real)),f.realVector([c,c,c])):m};r.grey$1=r.gray$1;D.HSVtoRGB=function(a,b,c){var d,e,g,h,l,m;a&&void 0===b&&void 0===c&&(b=a.s,c=a.v,a=a.h);h=Math.floor(6*a);l=6*a-h;a=c*(1-b);m=c*(1-l*b);b=c*(1-(1-l)*b);switch(h%6){case 0:d=c;e=b;g=a;break;case 1:d=m;e=c;g=a;break;case 2:d=a;e=c;g=b;break;case 3:d=a;e=m;g=c;break;case 4:d=b;e=a;g=c;break;case 5:d=c,e=a,g=m}return f.realVector([d,e,g])};r.hue$1=function(a,b){var c=z(a[0]);return"number"===c.ctype?(c=c.value.real,c-=
Math.floor(c),D.HSVtoRGB(c,1,1)):m};D.shapeconvert=function(a){var b,c;if("circle"===a.type){b=a.value.value[0];b=v.div(b,b.value[2]);var d=b.value[0].value.real,e=b.value[1].value.real;a=a.value.value[1].value.real;c=Array(125);var f=2*Math.PI/125;for(b=0;125>b;b++)c[b]={X:d+Math.cos(b*f)*a,Y:e+Math.sin(b*f)*a};return[c]}if("polygon"===a.type){d=[];for(b=0;b<a.value.length;b++){e=a.value[b];c=[];for(f=0;f<e.length;f++)c[f]={X:e[f].X,Y:e[f].Y};d[b]=c}return d}};D.shapeop=function(a,b,c){a=D.shapeconvert(a);
var d=D.shapeconvert(b);ClipperLib.JS.ScaleUpPaths(a,1E3);ClipperLib.JS.ScaleUpPaths(d,1E3);b=new ClipperLib.Clipper;b.AddPaths(a,ClipperLib.PolyType.ptSubject,!0);b.AddPaths(d,ClipperLib.PolyType.ptClip,!0);var d=a=ClipperLib.PolyFillType.pftNonZero,e=new ClipperLib.Paths;b.Execute(c,e,a,d);ClipperLib.JS.ScaleDownPaths(e,1E3);return{ctype:"shape",type:"polygon",value:e}};D.shapecommon=function(a,b){return D.shapeop(a,b,ClipperLib.ClipType.ctIntersection)};D.shaperemove=function(a,b){return D.shapeop(a,
b,ClipperLib.ClipType.ctDifference)};D.shapeconcat=function(a,b){return D.shapeop(a,b,ClipperLib.ClipType.ctUnion)};r.key$0=function(a,b){return{ctype:"string",value:kc}};r.keycode$0=function(a,b){return l.real(lc)};r.mouse$0=function(a,b){return f.realVector([gb[0],gb[1]])};r.mover$0=function(a,b){if(ca&&ca.mover)return{ctype:"geo",value:ca.mover};console.log("Not moving anything at the moment");return m};r.translate$1=function(a,b){var c=C(a[0]);"list"===c.ctype&&f.isNumberVector(c)&&2===c.value.length&&
w.translate(c.value[0].value.real,c.value[1].value.real);return m};r.rotate$1=function(a,b){var c=C(a[0]);"number"===c.ctype&&w.rotate(c.value.real);return m};r.scale$1=function(a,b){var c=C(a[0]);"number"===c.ctype&&w.scale(c.value.real);return m};r.greset$0=function(a,b){var c=Ga.stack.length;w.greset();for(var d=0;d<c;d++)A.restore();return m};r.gsave$0=function(a,b){w.gsave();A.save();return m};r.grestore$0=function(a,b){w.grestore();A.restore();return m};r.color$1=function(a,b){var c=C(a[0]);
"list"===c.ctype&&f.isNumberVector(c).value&&w.setcolor(c);return m};r.linecolor$1=function(a,b){var c=C(a[0]);"list"===c.ctype&&f.isNumberVector(c).value&&w.setlinecolor(c);return m};r.pointcolor$1=function(a,b){var c=C(a[0]);"list"===c.ctype&&f.isNumberVector(c).value&&w.setpointcolor(c);return m};r.alpha$1=function(a,b){var c=C(a[0]);"number"===c.ctype&&w.setalpha(c);return m};r.pointsize$1=function(a,b){var c=C(a[0]);"number"===c.ctype&&w.setpointsize(c);return m};r.linesize$1=function(a,b){var c=
C(a[0]);"number"===c.ctype&&w.setlinesize(c);return m};r.textsize$1=function(a,b){var c=C(a[0]);"number"===c.ctype&&w.settextsize(c);return m};r.playanimation$0=function(a,b){Ja();return m};r.pauseanimation$0=function(a,b){bb();return m};r.stopanimation$0=function(a,b){Ua();return m};r.replace$3=function(a,b){var c=z(a[0]),d=z(a[1]),e=z(a[2]);if("string"===c.ctype&&"string"===d.ctype&&"string"===e.ctype)return c=c.value,d=d.value.replace(/[^A-Za-z0-9]/g,"\\$&"),e=e.value.replace(/\$/g,"$$$$"),c=c.replace(new RegExp(d,
"g"),e),{ctype:"string",value:c}};r.replace$2=function(a,b){function c(a,c,b){var k="";e=d=-1;for(var f=0;f<c.length;f++){var g=c[f][0],h=a.indexOf(g,b);-1!==h&&(-1===d?(k=g,d=h,e=f):h<d&&(k=g,d=h,e=f))}return k}var d,e,f,g=z(a[0]);f=z(a[1]);if("string"===g.ctype&&"list"===f.ctype){for(var g=g.value,h=[],l=0;l<f.value.length;l++){var n=f.value[l];"list"===n.ctype&&2===n.value.length&&"string"===n.value[0].ctype&&"string"===n.value[1].ctype&&(h[h.length]=[n.value[0].value,n.value[1].value])}d=-1;for(f=
c(g,h,0);-1!==d;)g=g.substring(0,d)+h[e][1]+g.substring(d+f.length,g.length),f=d+h[e][1].length,f=c(g,h,f);return{ctype:"string",value:g}}return m};r.substring$3=function(a,b){var c=z(a[0]),d=C(a[1]),e=C(a[2]);return"string"===c.ctype&&"number"===d.ctype&&"number"===e.ctype?{ctype:"string",value:c.value.substring(Math.floor(d.value.real),Math.floor(e.value.real))}:m};r.tokenize$2=function(a,b){var c=z(a[0]),d=z(a[1]);if("string"===c.ctype&&"string"===d.ctype)return r.tokenize$2([c,f.turnIntoCSList([d])],
b);if("string"===c.ctype&&"list"===d.ctype){c=c.value;if(0===d.value.length){d=!0;if(void 0!==b.autoconvert){var e=z(b.autoconvert);"boolean"===e.ctype&&(d=e.value)}return d&&(d=parseFloat(c),!isNaN(d))?l.real(d):v.string(c)}var e=d.value[0],g=f.turnIntoCSList(d.value.slice(1)),c=c.split(e.value);return f.turnIntoCSList(c.map(function(a){return r.tokenize$2([v.string(a),g],b)}))}return m};r.indexof$2=function(a,b){var c=z(a[0]),d=z(a[1]);return"string"===c.ctype&&"string"===d.ctype?(c=c.value.indexOf(d.value),
l.real(c+1)):m};r.indexof$3=function(a,b){var c=z(a[0]),d=z(a[1]),e=z(a[2]);return"string"===c.ctype&&"string"===d.ctype&&"number"===e.ctype?(c=c.value.indexOf(d.value,Math.round(e.value.real)-1),l.real(c+1)):m};r.parse$1=function(a,b){var c=z(a[0]);return"string"===c.ctype?(c=ib(c.value),z(c)):m};r.unicode$1=function(a,b){var c;c=z(a[0]);var d=16;if(b.base){var e=z(b.base);"number"===e.ctype&&(d=e.value.real)}if("string"===c.ctype)c=parseInt(c.value,d);else if("number"===c.ctype)c=c.value.real;else return m;
"undefined"!==typeof String.fromCodePoint?c=String.fromCodePoint(c):65535>=c?c=String.fromCharCode(c):(c-=65536,c=String.fromCharCode((c>>10)+55296,(c&1023)+56320));return v.string(c)};r.international$1=function(a,b){return r.international$2([a[0],null],b)};r.international$2=function(a,b){var c=z(a[0]);if("string"!==c.ctype)return m;var d=(q.translations||{})[q.language||"en"]||{};if(!d.hasOwnProperty(c.value))return c;var e=d[c.value];if("string"===typeof e)return v.string(e);if(null===a[1])return c;
var f=z(a[1]),f="number"===f.ctype?f.value.real:0,d=(d._pluralFormFunction||jd)(f);return d<e.length?v.string(e[d]):c};r.currentlanguage$0=function(a,b){return v.string(q.language||"en")};D.basismap=function(a,b,c,d){var e=f.turnIntoCSList([a,b,c]),e=f.adjoint3(f.transpose(e));d=v.mult(e,d);e=f.turnIntoCSList([v.mult(d.value[0],a),v.mult(d.value[1],b),v.mult(d.value[2],c)]);return f.transpose(e)};r.map$8=function(a,b){var c=M(a[0]),d=M(a[1]),e=M(a[2]),g=M(a[3]),h=M(a[4]),l=M(a[5]),n=M(a[6]),p=M(a[7]);
return h!==m&&l!==m&&n!==m&&p!==m&&c!==m&&d!==m&&e!==m&&g!==m?(h=D.basismap(h,l,n,p),c=D.basismap(c,d,e,g),c=v.mult(h,f.adjoint3(c)),f.normalizeMax(c)):m};r.map$6=function(a,b){var c=M(a[0]),d=M(a[1]),e=M(a[2]),g=f.realVector([0,0,1]),h=f.cross,l=h(h(e,h(g,h(c,d))),h(d,h(g,h(c,e)))),n=M(a[3]),p=M(a[4]),q=M(a[5]),g=h(h(q,h(g,h(n,p))),h(p,h(g,h(n,q))));return n!==m&&p!==m&&q!==m&&g!==m&&c!==m&&d!==m&&e!==m&&l!==m?(n=D.basismap(n,p,q,g),c=D.basismap(c,d,e,l),c=v.mult(n,f.adjoint3(c)),f.normalizeMax(c)):
m};r.map$4=function(a,b){var c=f.ii,d=f.jj,e=M(a[0]),g=M(a[1]),h=M(a[2]),l=M(a[3]);return h!==m&&l!==m&&e!==m&&g!==m?(h=D.basismap(h,l,c,d),c=D.basismap(e,g,c,d),c=v.mult(h,f.adjoint3(c)),f.normalizeMax(c)):m};r.map$2=function(a,b){var c=f.ii,d=f.jj,e=M(a[0]),g=v.add(f.realVector([1,0,0]),e),h=M(a[1]),l=v.add(f.realVector([1,0,0]),h);return h!==m&&l!==m&&e!==m&&g!==m?(h=D.basismap(h,l,c,d),c=D.basismap(e,g,c,d),c=v.mult(h,f.adjoint3(c)),f.normalizeMax(c)):m};r.pointreflect$1=function(a,b){var c=f.ii,
d=f.jj,e=M(a[0]),g=v.add(f.realVector([1,0,0]),e),h=v.add(f.realVector([-1,0,0]),e);return h!==m&&e!==m&&g!==m?(h=D.basismap(e,h,c,d),c=D.basismap(e,g,c,d),c=v.mult(h,f.adjoint3(c)),f.normalizeMax(c)):m};r.linereflect$1=function(a,b){var c=f.ii,d=f.jj,e=M(a[0]),g=f.realVector([Math.random(),Math.random(),Math.random()]),h=f.realVector([Math.random(),Math.random(),Math.random()]),g=f.cross(g,e),h=f.cross(h,e);return e!==m&&g!==m?(e=D.basismap(g,h,c,d),c=D.basismap(g,h,d,c),c=v.mult(e,f.adjoint3(c)),
f.normalizeMax(c)):m};D.extractPointVec=function(a){var b={ok:!1};if("geo"===a.ctype){var c=a.value;if("P"===c.kind)return b.x=va.getField(c,"x"),b.y=va.getField(c,"y"),b.z=l.real(1),b.ok=!0,b}if("list"!==a.ctype)return b;var d=a.value;if(2===d.length&&(a=d[0],c=d[1],"number"===a.ctype&&"number"===c.ctype))return b.x=a,b.y=c,b.z=l.real(1),b.ok=!0,b;3===d.length&&(a=d[0],c=d[1],d=d[2],"number"===a.ctype&&"number"===c.ctype&&"number"===d.ctype&&(b.x=l.div(a,d),b.y=l.div(c,d),b.z=l.real(1),b.ok=!0));
return b};r.polygon$1=function(a,b){var c=z(a[0]);if("list"===c.ctype){for(var d=[],e=0;e<c.value.length;e++){var f=D.extractPoint(c.value[e]);if(!f.ok)return m;d[e]={X:f.x,Y:f.y}}return{ctype:"shape",type:"polygon",value:[d]}}return m};r.circle$2=function(a,b){var c=C(a[0]),d=C(a[1]),c=D.extractPointVec(c);if(!c.ok||"number"!==d.ctype)return m;c=f.turnIntoCSList([c.x,c.y,c.z]);return{ctype:"shape",type:"circle",value:f.turnIntoCSList([c,d])}};r.screen$0=function(a,b){var c=w.drawingstate.initialmatrix,
d=function(a,b){var k=a-c.tx,d=b+c.ty;return{X:(k*c.d-d*c.b)/c.det,Y:-(-k*c.c+d*c.a)/c.det}};return{ctype:"shape",type:"polygon",value:[[d(0,0),d(fa,0),d(fa,V),d(0,V)]]}};r.halfplane$2=function(a,b){var c=C(a[0]),d=C(a[1]),e=M(c),g=M(d);if(c!==m&&d!==m){var h=d.usage,d=g;if("Line"===c.usage||"Point"===h)e=g,d=c;c=f.turnIntoCSList([d.value[0],d.value[1],l.zero]);c=f.cross(c,e);g=f.cross(d,c);g=v.div(g,g.value[2]);e=v.div(e,e.value[2]);e=f.sub(e,g);c=f.abs(e);e=v.div(e,c);c=g.value[0].value.real;g=
g.value[1].value.real;d=1E3*e.value[0].value.real;e=1E3*e.value[1].value.real;return{ctype:"shape",type:"polygon",value:[[{X:c+e/2,Y:g-d/2},{X:c+e/2+d,Y:g-d/2+e},{X:c-e/2+d,Y:g+d/2+e},{X:c-e/2,Y:g+d/2}]]}}return m};r.element$1=function(a,b){var c=z(a[0]);return"string"===c.ctype&&n.hasOwnProperty(c.value)?{ctype:"geo",value:n[c.value]}:m};D.all$1=function(a,b){var c=z(a[0]);return"geo"===c.ctype&&c.value.incidences?f.ofGeos(c.value.incidences.map(function(a){return n[a]}).filter(b)):f.nil};r.allpoints$0=
function(a,b){return f.ofGeos(I)};r.allpoints$1=function(a,b){return D.all$1(a,function(a){return"P"===a.kind})};r.allmasses$0=function(a,b){return f.ofGeos(W)};r.allmasses$1=function(a,b){return D.all$1(a,function(a){return"P"===a.kind&&a.behavior&&"Mass"===a.behavior.type})};r.allsprings$0=function(a,b){return f.ofGeos(Ub)};r.allsprings$1=function(a,b){return D.all$1(a,function(a){return"S"===a.kind&&a.behavior&&"Spring"===a.behavior.type})};r.alllines$0=function(a,b){return f.ofGeos(L)};r.alllines$1=
function(a,b){return D.all$1(a,function(a){return"L"===a.kind||"S"===a.kind})};r.allsegments$0=function(a,b){return f.ofGeos(L.filter(function(a){return"S"===a.kind}))};r.allsegments$1=function(a,b){return D.all$1(a,function(a){return"S"===a.kind})};r.allconics$0=function(a,b){return f.ofGeos(Z)};r.allconics$1=function(a,b){return D.all$1(a,function(a){return"C"===a.kind})};r.allcircles$0=function(a,b){return f.ofGeos(Z.filter(function(a){return"Circle"===a.matrix.usage}))};r.allcircles$1=function(a,
b){return D.all$1(a,function(a){return"C"===a.kind&&"Circle"===a.matrix.usage})};r.allelements$0=function(a,b){return f.ofGeos(E)};r.allelements$1=function(a,b){return D.all$1(a,function(a){return!0})};r.incidences$1=r.allelements$1;r.createpoint$2=function(a,b){var c=z(a[0]),d=M(a[1]);return"string"!==c.ctype?(console.log("Name must be a string"),m):"list"!==d.ctype&&f.isNumberVector(d)?(console.log("Position must be a number vector"),m):Nb({name:c.value,type:"Free",labeled:!0,pos:d})};r.create$3=
function(a,b){var c=z(a[0]),d=z(a[1]),e=z(a[2]),f;if("string"===c.ctype)f=c.value;else{if("list"!==c.ctype)return console.log("Names must be a string or a list of strings"),m;if(1!==c.value.length)return console.log("multi-result compatibility operations not supported yet"),m;if("string"!==c.value[0].ctype)return console.log("Element of names list must be a string"),m;f=c.value[0].value}if("string"!==d.ctype)return console.log("Type must be a string"),m;if("list"!==e.ctype)return console.log("Arguments must be a list"),
m;if(void 0===p[d.value])return console.log("Invalid geometric operation: '"+d.value+"'"),m;for(var c=[],g=null,h=0;h<e.value.length;h++){var l=e.value[h];if("string"===l.ctype)c.push(l.value);else if(g=M(l),g===m)return console.log("Unknown argument type"),m}d={name:f,type:d.value,labeled:!0};g&&(d.pos=g);0<c.length&&(d.args=c);return Nb(d)};r.javascript$1=function(a,b){var c=z(a[0]);"string"===c.ctype&&(new Function(c.value)).call(ma);return m};r.use$1=function(a,b){function c(a,c,b){r[a+"$"+c]=
b}var d=z(a[0]);if("string"===d.ctype){var d=d.value,e;q.plugins&&(e=q.plugins[d]);e||(e=ua._pluginRegistry[d]);if(e)return e({instance:ma,config:q,nada:m,evaluate:z,extractPoint:D.extractPoint,evaluateAndVal:C,defineFunction:c,addShutdownHook:Va.push.bind(Va),addAutoCleaningEventListener:ha,getVariable:J.getvar.bind(J),getInitialMatrix:function(){return w.drawingstate.initialmatrix},setTextRenderer:function(a){Vc=a},getImage:function(a,c){if(!la.hasOwnProperty(a))return null;var b=la[a];!c&&b.cdyUpdate()&&
b.cdyUpdate();return b},getMyfunction:function(a){return Za.hasOwnProperty(a)?Za[a]:null}}),{ctype:"boolean",value:!0};console.log("Plugin "+d+" not found");return{ctype:"boolean",value:!1}}return m};r.format$2=function(a,b){function c(a){a=a.toFixed(g);var c;do c=a,a=a.substring(0,a.length-1);while(""!==a&&"-"!==a&&+a===+c);return""+c}function d(a){var b;return"number"===a.ctype?(b=c(a.value.real),a=c(a.value.imag),b="0"===a?b:"-"===a.substring(0,1)?b+" - i*"+a.substring(1):b+" + i*"+a,{ctype:"string",
value:b}):"list"===a.ctype?{ctype:"list",value:a.value.map(d)}:{ctype:"string",value:H(a).toString()}}var e=C(a[0]),f=C(a[1]),g;return"number"!==e.ctype&&"list"!==e.ctype||"number"!==f.ctype?m:(g=Math.round(f.value.real),d(e))};Date.now||(Date.now=function(){return(new Date).getTime()});var Wc=0;r.seconds$0=function(a,b){return{ctype:"number",value:{real:(Date.now()-Wc)/1E3,imag:0}}};r.resetclock$0=function(a,b){Wc=Date.now();return m};r.time$0=function(a,b){var c=new Date;return f.realVector([c.getHours(),
c.getMinutes(),c.getSeconds(),c.getMilliseconds()])};r.date$0=function(a,b){var c=new Date;return f.realVector([c.getFullYear(),c.getMonth(),c.getDay()])};r.setTimeout$2=function(a,b){function c(){z(f);e()}var d=z(a[0]),f=a[1];"number"===d.ctype&&"undefined"!==typeof window&&window.setTimeout(c,1E3*d.value.real);return m};D.formatForWebGL=function(a){return a.toFixed(10)};r.generateWebGL$2=function(a,b){var c=D.formatForWebGL,d=a[0],e=z(a[1]);console.log(e);if("list"!==e.ctype)return m;for(var f=
[],g=0;g<e.value.length;g++)"string"===e.value[g].ctype&&f.push(e.value[g].value);console.log("***********");console.log(f);e=D.plotvars(d);console.log(e);-1===e.indexOf("a")&&-1===e.indexOf("b")&&-1===e.indexOf("c")&&-1===e.indexOf("d")&&-1===e.indexOf("e")&&-1===e.indexOf("f")&&(d=C(d));if("number"===d.ctype)return{ctype:"string",value:"vec2("+c(d.value.real)+","+c(d.value.imag)+")"};if("variable"===d.ctype)return{ctype:"string",value:d.name};if("string"===d.ctype||"void"===d.ctype)return d;if(2===
d.args.length&&("infix"===d.ctype||"function"===d.ctype)){c=r.compileToWebGL$1([d.args[0]],{});e=r.compileToWebGL$1([d.args[1]],{});if("+"===d.oper||"add"===d.oper)return void 0===c.value||"void"===c.ctype?{ctype:"string",value:e.value}:{ctype:"string",value:"addc("+c.value+","+e.value+")"};if("*"===d.oper||"mult"===d.oper)return{ctype:"string",value:"multc("+c.value+","+e.value+")"};if("/"===d.oper||"div"===d.oper)return{ctype:"string",value:"divc("+c.value+","+e.value+")"};if("-"===d.oper||"sub"===
d.oper)return void 0===c.value||"void"===c.ctype?{ctype:"string",value:"negc("+e.value+")"}:{ctype:"string",value:"subc("+c.value+","+e.value+")"};if("^"===d.oper||"pow"===d.oper)return{ctype:"string",value:"powc("+c.value+","+e.value+")"}}if("function"===d.ctype&&1===d.args.length){c=r.compileToWebGL$1([d.args[0]],{});if("sin$1"===d.oper)return{ctype:"string",value:"sinc("+c.value+")"};if("cos$1"===d.oper)return{ctype:"string",value:"cosc("+c.value+")"};if("tan$1"===d.oper)return{ctype:"string",
value:"tanc("+c.value+")"};if("exp$1"===d.oper)return{ctype:"string",value:"expc("+c.value+")"};if("log$1"===d.oper)return{ctype:"string",value:"logc("+c.value+")"};if("arctan$1"===d.oper)return{ctype:"string",value:"arctanc("+c.value+")"};if("arcsin$1"===d.oper)return{ctype:"string",value:"arcsinc("+c.value+")"};if("arccos$1"===d.oper)return{ctype:"string",value:"arccosc("+c.value+")"};if("sqrt$1"===d.oper)return{ctype:"string",value:"sqrtc("+c.value+")"}}return m};r.compileToWebGL$1=function(a,
b){var c,d;c=D.formatForWebGL;var e=a[0];d=D.plotvars(e);-1===d.indexOf("a")&&-1===d.indexOf("b")&&-1===d.indexOf("c")&&-1===d.indexOf("d")&&-1===d.indexOf("e")&&-1===d.indexOf("f")&&(e=C(e));if("number"===e.ctype)return{ctype:"string",value:"vec2("+c(e.value.real)+","+c(e.value.imag)+")"};if("variable"===e.ctype)return{ctype:"string",value:e.name};if("string"===e.ctype||"void"===e.ctype)return e;if(2===e.args.length&&("infix"===e.ctype||"function"===e.ctype)){c=r.compileToWebGL$1([e.args[0]],{});
d=r.compileToWebGL$1([e.args[1]],{});if("+"===e.oper||"add"===e.oper)return void 0===c.value||"void"===c.ctype?{ctype:"string",value:d.value}:{ctype:"string",value:"addc("+c.value+","+d.value+")"};if("*"===e.oper||"mult"===e.oper)return{ctype:"string",value:"multc("+c.value+","+d.value+")"};if("/"===e.oper||"div"===e.oper)return{ctype:"string",value:"divc("+c.value+","+d.value+")"};if("-"===e.oper||"sub"===e.oper)return void 0===c.value||"void"===c.ctype?{ctype:"string",value:"negc("+d.value+")"}:
{ctype:"string",value:"subc("+c.value+","+d.value+")"};if("^"===e.oper||"pow"===e.oper)return{ctype:"string",value:"powc("+c.value+","+d.value+")"}}if("function"===e.ctype&&1===e.args.length){c=r.compileToWebGL$1([e.args[0]],{});if("sin$1"===e.oper)return{ctype:"string",value:"sinc("+c.value+")"};if("cos$1"===e.oper)return{ctype:"string",value:"cosc("+c.value+")"};if("tan$1"===e.oper)return{ctype:"string",value:"tanc("+c.value+")"};if("exp$1"===e.oper)return{ctype:"string",value:"expc("+c.value+")"};
if("log$1"===e.oper)return{ctype:"string",value:"logc("+c.value+")"};if("arctan$1"===e.oper)return{ctype:"string",value:"arctanc("+c.value+")"};if("arcsin$1"===e.oper)return{ctype:"string",value:"arcsinc("+c.value+")"};if("arccos$1"===e.oper)return{ctype:"string$1",value:"arccosc("+c.value+")"};if("sqrt$1"===e.oper)return{ctype:"string",value:"sqrtc("+c.value+")"}}return m};r.setsimulationspeed$1=function(a,b){var c=C(a[0]);"number"===c.ctype&&"undefined"!==typeof K&&"undefined"!==typeof K.env&&(K.env.deltat=
c.value.real);return m};r.setsimulationaccuracy$1=function(a,b){var c=C(a[0]);"number"===c.ctype&&"undefined"!==typeof K&&"undefined"!==typeof K.env&&(K.env.accuracy=c.value.real);return m};r.setsimulationquality$1=function(a,b){var c=C(a[0]);"number"===c.ctype&&"undefined"!==typeof K&&"undefined"!==typeof K.env&&(c=c.value.real,0===c&&(K.env.errorbound=.01,K.env.lowestdeltat=1E-5,K.env.slowdownfactor=2),1===c&&(K.env.errorbound=.001,K.env.lowestdeltat=1E-7,K.env.slowdownfactor=2),2===c&&(K.env.errorbound=
1E-5,K.env.lowestdeltat=1E-10,K.env.slowdownfactor=4),3===c&&(K.env.errorbound=1E-6,K.env.lowestdeltat=1E-12,K.env.slowdownfactor=4));return m};D.extractPoint=function(a){var b={ok:!1};if("geo"===a.ctype){var c=a.value;if("P"===c.kind)return b.x=va.getField(c,"x").value.real,b.y=va.getField(c,"y").value.real,b.ok=!0,b}if("list"!==a.ctype)return b;var d=a.value;if(2===d.length&&(a=d[0],c=d[1],"number"===a.ctype&&"number"===c.ctype))return b.x=a.value.real,b.y=c.value.real,b.ok=!0,b;3===d.length&&(a=
d[0],c=d[1],d=d[2],"number"===a.ctype&&"number"===c.ctype&&"number"===d.ctype&&(a=l.div(a,d),c=l.div(c,d),b.x=a.value.real,b.y=c.value.real,b.ok=!0));return b};r.draw$1=function(a,b){var c=C(a[0]);if("shape"===c.ctype)D.drawshape(c,b);else if("Line"===c.usage)y.handleModifs(b,y.lineModifs),y.drawline(c);else{var d=D.extractPoint(c);if(!d.ok){if("undefined"!==typeof c.value&&2===c.value.length)return r.draw$2(c.value,b);return}null!==b&&y.handleModifs(b,y.pointModifs);y.drawpoint(d)}return m};r.draw$2=
function(a,b){var c=C(a[0]),d=C(a[1]),c=D.extractPoint(c),d=D.extractPoint(d);if(!c.ok||!d.ok)return m;null!==b&&y.handleModifs(b,y.lineModifs);y.drawsegcore(c,d);return m};r.drawcircle$2=function(a,b){return D.drawcircle(a,b,"D")};D.arcHelper=function(a){var b={};b.startPoint=M(a[0]);b.viaPoint=M(a[1]);b.endPoint=M(a[2]);return b};r.fillcircle$2=function(a,b){return D.drawcircle(a,b,"F")};r.drawarc$3=function(a,b){var c=D.arcHelper(a);return D.drawarc(c,b,"D")};r.fillarc$3=function(a,b){var c=D.arcHelper(a);
return D.drawarc(c,b,"F")};D.drawarc=function(a,b,c){var d=a.startPoint,e=a.viaPoint;a=a.endPoint;if(!f._helper.isAlmostReal(f.turnIntoCSList([d,e,a])))return m;y.handleModifs(b,y.conicModifs);y.preDrawCurve();b=f.det3(d,e,a);if(1E-12<Math.abs(b.value.real)){b=p._helper.ConicBy5(null,d,e,a,f.ii,f.jj);var g=p._helper.CenterOfConic(b),g=f.normalizeMax(g);b=l.real(0);var h=f.turnIntoCSList([f.turnIntoCSList([g.value[2],b,l.neg(g.value[0])]),f.turnIntoCSList([b,g.value[2],l.neg(g.value[1])]),f.turnIntoCSList([b,
b,g.value[2]])]);b=f.normalizeZ(v.mult(h,d));f.normalizeZ(v.mult(h,e));h=f.normalizeZ(v.mult(h,a));b=-Math.atan2(b.value[1].value.real,b.value[0].value.real);h=-Math.atan2(h.value[1].value.real,h.value[0].value.real);g=f.normalizeZ(g);d=f.normalizeZ(d);e=f.normalizeZ(e);a=f.normalizeZ(a);var n=f.abs(f.sub(d,g)),q=[g.value[0].value.real,g.value[1].value.real],r=w.drawingstate.matrix,g=q[0]*r.a-q[1]*r.b+r.tx,q=q[0]*r.c-q[1]*r.d-r.ty,e=0<f.det3(d,e,a).value.real;A.save();d=n.value.real*r.sdet;A.beginPath();
A.translate(g,q);b>h&&(h+=2*Math.PI);e=e?-(2*Math.PI-h+b)/500:(h-b)/500;A.moveTo(d*Math.cos(b),d*Math.sin(b));for(h=0;500>=h;h++)a=b+h*e,A.lineTo(d*Math.cos(a),d*Math.sin(a));"F"===c&&(A.fillStyle=y.lineColor,A.closePath(),A.fill());"D"===c&&A.stroke();A.restore()}else{if("D"!==c)return m;c=D.extractPoint(d);h=D.extractPoint(e);b=D.extractPoint(a);if(!c.ok||!h.ok||!b.ok)return m;n=(c.x-h.x)*(c.x-h.x)+(c.y-h.y)*(c.y-h.y);g=(c.x-b.x)*(c.x-b.x)+(c.y-b.y)*(c.y-b.y);r=(b.x-h.x)*(b.x-h.x)+(b.y-h.y)*(b.y-
h.y);if(1E-12>n||1E-12>g||1E-12>r)return m;0>f.crossratio3(d,a,e,f.cross(f.cross(d,e),f.linfty),f.ii).value.real?y.drawsegcore(c,b):(e=n>r?1:-1,d=e*(c.x-h.x),e*=c.y-h.y,a=25E3/w.drawingstate.matrix.sdet/Math.sqrt(d*d+e*e),d*=a,e*=a,y.drawsegcore(c,{x:c.x+d,y:c.y+e}),y.drawsegcore(b,{x:b.x-d,y:b.y-e}))}return m};D.drawcircle=function(a,b,c){var d=C(a[0]);a=C(a[1]);var e=D.extractPoint(d);if(!e.ok||"number"!==a.ctype||!l._helper.isAlmostReal(a))return m;var d=w.drawingstate.matrix,f=e.x*d.a-e.y*d.b+
d.tx,e=e.x*d.c-e.y*d.d-d.ty;y.handleModifs(b,y.conicModifs);y.preDrawCurve();A.lineJoin="miter";A.beginPath();A.arc(f,e,Math.abs(a.value.real)*d.sdet,0,2*Math.PI);A.closePath();"D"===c&&A.stroke();"F"===c&&(A.fillStyle=y.lineColor,A.fill());"C"===c&&A.clip();return m};r.drawconic$1=function(a,b){var c;c=C(a[0]);if("list"!==c.ctype||3!==c.value.length&&6!==c.value.length)return console.error("could not parse conic"),m;if(6===c.value.length){for(var d=0;6>d;d++)if("number"!==c.value[d].ctype)return console.error("could not parse conic"),
m;var e=l.real(.5),d=c.value[0],g=c.value[2],g=l.mult(g,e),h=c.value[1],n=c.value[3],n=l.mult(n,e),p=c.value[4],p=l.mult(p,e);c=c.value[5];c=f.turnIntoCSList([f.turnIntoCSList([d,g,n]),f.turnIntoCSList([g,h,p]),f.turnIntoCSList([n,p,c])])}else{for(d=0;3>d;d++)for(g=0;3>g;g++)if("number"!==c.value[d].value[g].ctype)return console.error("could not parse conic"),m;f.equals(c,f.transpose(c)).value||(d=v.mult(c,l.real(.5)),c=v.mult(f.transpose(c),l.real(.5)),c=f.add(d,c))}c=f.normalizeMax(c);return D.drawconic(c,
b)};D.drawconic=function(a,b){y.handleModifs(b,y.conicModifs);if(0!==y.lsize){y.preDrawCurve();for(var c=f.normalizeMax(a),d=c,e=0;2>e;e++)for(var g=0;2>g;g++)if(Math.abs(c.value[e].value[g].value.imag)>l.eps)return;e=f.turnIntoCSList([f.realVector([-1,-1,1]),f.realVector([1,0,0]),f.realVector([0,1,0])]);g=w.from(0,0,1);g[2]=1;var h=w.from(1,0,1);h[2]=1;var n=w.from(0,1,1);n[2]=1;var g=f.turnIntoCSList([f.realVector(g),f.realVector(h),f.realVector(n)]),g=f.transpose(g),e=v.mult(g,e),e=f.inverse(e),
c=v.mult(f.transpose(e),c),c=v.mult(c,e),e=c.value[0].value[0].value.real,g=c.value[1].value[0].value.real,h=c.value[1].value[1].value.real,n=c.value[2].value[0].value.real,q=c.value[2].value[1].value.real,u=c.value[2].value[2].value.real,c=[[e,g,n],[g,h,q],[n,q,u]],z=1E-14>Math.abs(e*h*u-e*q*q-g*g*u+2*g*n*q-h*n*n);if(z&&"Circle"===a.usage){var x=v.mult(f.adjoint3(d),f.linfty);l.abs(x.value[2]).value.real>l.eps&&(z=!1)}var x=fa>V?fa:V,B=-1.5*x,D=1.5*x,C=-1.5*x,E=1.5*x,F=1;z&&(F=0);if(F)var n=0,n=
1E-14<Math.abs(e-g)?Math.atan(g/e-h)/2:Math.PI/4,qa=function(a){var c=Math.cos(a);a=Math.sin(a);return[[c,-a,0],[a,c,0],[0,0,1]]}(n),qa=f.realMatrix(qa),e=f.transpose(qa),c=v.mult(f.realMatrix(c),qa),c=v.mult(e,c),e=c.value[0].value[0].value.real,g=c.value[1].value[0].value.real,h=c.value[1].value[1].value.real,n=c.value[2].value[0].value.real,q=c.value[2].value[1].value.real,u=c.value[2].value[2].value.real;var c=[e,g,h,n,q,u],e=function(){var a=p._helper.splitDegenConic(d);if(a!==m){var c=a[1],
a=[a[0]];r.draw$1(a,b);a[0]=c;r.draw$1(a,b)}},G=function(a){"undefined"!==a&&6===a.length||console.error("this does not define a Conic");if(z)return"degenerate";a=a[0]*a[2]-a[1]*a[1];return 1E-14>Math.abs(a)?"parabola":1E-14<a?"ellipsoid":"hyperbola"};G(c);var J=function(a,c){return 0<a&&a<fa&&0<c&&c<V},H=[],I=[],K=[],L=[],M=[],N=[],O=function(){H=[];I=[];K=[];L=[];M=[];N=[]},P=function(a,c){A.beginPath();A.moveTo(a[0],c[0]);for(var b=1;b<a.length;b++)A.lineTo(a[b],c[b]);A.stroke()},Q=function(a,
c,b){var k,d,e=G(a);if(6!==a.length)console.error("Conic needs 6 Parameters");else{var g=a[0],t=a[1],h=a[2],l=a[3],m=a[4];a=a[5];var n;k=b-c;for(var p=.1*k+c,$c=b-.1*k,q=c;q<=b;q+=n){n=q<p||q>$c||100>Math.abs(b-c)?.5:0>q||q>V?10:3;d=-g*h*q*q-2*g*m*q-g*a+t*t*q*q+2*t*l*q+l*l;d=Math.sqrt(d);k=1/g*(-t*q-l+d);d=-1/g*(t*q+l+d);var ya,r;F?(ya=[k,q,1],r=[d,q,1],ya=v.mult(qa,f.realVector(ya)),r=v.mult(qa,f.realVector(r)),k=ya.value[0].value.real,d=r.value[0].value.real,ya=ya.value[1].value.real,r=r.value[1].value.real):
r=ya=q;isNaN(k)||"ellipsoid"!==e?!isNaN(k)&&k>=B&&k<=D&&(H.push(k),K.push(ya)):(H.push(k),K.push(ya));isNaN(d)||"ellipsoid"!==e?!isNaN(d)&&d>=B&&d<=D&&(I.push(d),L.push(r)):(I.push(d),L.push(r))}}},g=function(a){var c,b,k;G(a);if(6!==a.length)console.error("Conic needs 6 Parameters");else{k=a[0];var d=a[1],e=a[2],f=a[3],g=a[4],t=a[5];c=-k*g+d*f;b=Math.sqrt(k*(-k*e*t+k*Math.pow(g,2)+Math.pow(d,2)*t-2*d*f*g+e*Math.pow(f,2)));e=k*e-Math.pow(d,2);1E-14<Math.abs(e)?(k=(c-b)/e,b=(c+b)/e):b=k=(-k*t+f*f)/
(2*k*g-2*d*f);!isNaN(k)&&k>C&&k<E||(k=C);!isNaN(b)&&b>C&&b<E||(b=C);c=k<b?k:b;b=k>b?k:b;Q(a,C,c);M=H.concat(I.reverse());N=K.concat(L.reverse());P(M,N);O();Q(a,b,E);P(H,K);if(J(H[0],K[1])||J(I[0],L[0]))A.beginPath(),A.moveTo(H[0],K[0]),A.lineTo(I[0],L[0]),A.stroke();P(I,L);O();Q(a,c,b);P(H,K);A.beginPath();A.moveTo(H[0],K[0]);A.lineTo(I[0],L[0]);A.stroke();A.beginPath();A.moveTo(H[H.length-1],K[K.length-1]);A.lineTo(I[I.length-1],L[L.length-1]);A.stroke();P(I,L);O()}};z?e():g(c)}};r.drawall$1=function(a,
b){var c=z(a[0]);if("list"===c.ctype){y.handleModifs(b,y.pointAndLineModifs);for(var d=0;d<c.value.length;d++)r.draw$1([c.value[d]],null)}return m};r.connect$1=function(a,b){return D.drawpolygon(a,b,"D",!1)};r.drawpoly$1=function(a,b){return D.drawpolygon(a,b,"D",!0)};r.fillpoly$1=function(a,b){return D.drawpolygon(a,b,"F",!0)};r.drawpolygon$1=function(a,b){return D.drawpolygon(a,b,"D",!0)};r.fillpolygon$1=function(a,b){return D.drawpolygon(a,b,"F",!0)};D.drawpolygon=function(a,b,c,d){function e(){for(var a=
h.value,c=0;c<a.length;c++){var b=a[c],k;for(k=0;k<b.length;k++){var d=b[k],f=d.X*g.a-d.Y*g.b+g.tx,d=d.X*g.c-d.Y*g.d-g.ty;0===k?A.moveTo(f,d):A.lineTo(f,d)}A.closePath()}}function f(){var a;for(a=0;a<h.value.length;a++){var c=D.extractPoint(h.value[a]);if(!c.ok)return;var b=c.x*g.a-c.y*g.b+g.tx,c=c.x*g.c-c.y*g.d-g.ty;0===a?A.moveTo(b,c):A.lineTo(b,c)}d&&A.closePath()}y.handleModifs(b,y.conicModifs);y.preDrawCurve();A.mozFillRule="evenodd";var g=w.drawingstate.matrix,h=z(a[0]);A.beginPath();"list"===
h.ctype&&f();"shape"===h.ctype&&e();"D"===c&&A.stroke();"F"===c&&(A.fillStyle=y.lineColor,A.fill());"C"===c&&A.clip();return m};var Vc=function(a,b,c,d,e){var f=a.measureText(b).width;a.fillText(b,c-f*e,d)};r.drawtext$2=function(a,b){var c=C(a[0]),d=z(a[1]),e=D.extractPoint(c);if(!e.ok)return m;var f=w.drawingstate.matrix,c=e.x*f.a-e.y*f.b+f.tx,e=e.x*f.c-e.y*f.d-f.ty;y.handleModifs(b,y.textModifs);f=w.drawingstate.textsize;null!==y.size&&(f=y.size);A.fillStyle=y.textColor;A.font=y.bold+y.italics+
Math.round(10*f)/10+"px "+y.family;d=H(d);Vc(A,d,c+y.xOffset,e-y.yOffset,y.align);return m};D.drawshape=function(a,b){return"polygon"===a.type?D.drawpolygon([a],b,"D",1):"circle"===a.type?D.drawcircle([a.value.value[0],a.value.value[1]],b,"D"):m};D.fillshape=function(a,b){return"polygon"===a.type?D.drawpolygon([a],b,"F",1):"circle"===a.type?D.drawcircle([a.value.value[0],a.value.value[1]],b,"F"):m};D.clipshape=function(a,b){return"polygon"===a.type?D.drawpolygon([a],b,"C",1):"circle"===a.type?D.drawcircle([a.value.value[0],
a.value.value[1]],b,"C"):m};r.fill$1=function(a,b){var c=z(a[0]);return"shape"===c.ctype?D.fillshape(c,b):m};r.clip$1=function(a,b){var c=z(a[0]);return"shape"===c.ctype?D.clipshape(c,b):"list"===c.ctype?(c=r.polygon$1(a,[]),r.clip$1([c],[])):m};r.plot$1=function(a,b){return r.plot$2([a[0],null],b)};r.plot$2=function(a,b){function c(a){return"number"===a.ctype&&l._helper.isAlmostReal(a)}function d(a,c,b,k,e){n++;c=+c.value.real;e=+k.value.real;k=c*E.a-e*E.b+E.tx;c=c*E.c-e*E.d-E.ty;a=+a.value.real;
e=+b.value.real;b=a*E.a-e*E.b+E.tx;a=a*E.c-e*E.d-E.ty;p?(A.lineTo(b,a),A.lineTo(k,c)):(A.beginPath(),A.moveTo(b,a),A.lineTo(k,c),p=!0)}function e(a,b,k,f,m){var n=c(k),q=c(f);if(.001>m)!g&&p&&(A.stroke(),p=!1);else if(n||q){var r=l.real((a.value.real+b.value.real)/2);J.setvar(B,r);var v=z(x),w=c(v);if(n&&q&&w){var u=k.value.real,q=v.value.real,w=f.value.real;if(n=1>Math.abs(u+w-2*q)/h){var Eb=l.real((a.value.real+r.value.real)/2);J.setvar(B,Eb);var Eb=z(x),y=l.real((r.value.real+b.value.real)/2);
J.setvar(B,y);y=z(x);u=Math.abs(u+q-2*Eb.value.real)/h;q=Math.abs(q+w-2*y.value.real)/h;n=n&&1>u&&1>q}n?(d(a,r,k,v,m/2),d(r,b,v,f,m/2)):(e(a,r,k,v,m/2),e(r,b,v,f,m/2))}else e(a,r,k,v,m/2),e(r,b,v,f,m/2)}}var g=!1,h=.2/pb,n=0,p=!1,q=-10,r=10,v=1,u=1E3,x=a[0],B;if(null!==a[1]&&"variable"===a[1].ctype)B=a[1].name;else{var C=D.plotvars(x);B="#";-1!==C.indexOf("t")&&(B="t");-1!==C.indexOf("z")&&(B="z");-1!==C.indexOf("y")&&(B="y");-1!==C.indexOf("x")&&(B="x")}J.newvar(B);var E=w.drawingstate.matrix;y.handleModifs(b,
{color:!0,alpha:!0,size:!0,dashpattern:!0,dashtype:!0,dashing:!0,lineCap:!0,lineJoin:!0,miterLimit:!0,connect:function(a){"boolean"===a.ctype&&(g=a.value)},start:function(a){"number"===a.ctype&&(q=a.value.real)},stop:function(a){"number"===a.ctype&&(r=a.value.real)},steps:function(a){"number"===a.ctype&&(u=a.value.real)}});A.strokeStyle=y.lineColor;A.lineWidth=y.lsize;var qa,F,H,G,p=!1,C=l.real(14.32);J.setvar(B,C);H=z(x);if("number"!==H.ctype){if(f.isNumberVector(H).value&&2===H.value.length){p=
!1;v=(r-q)/u;for(C=q;C<r;C+=v)J.setvar(B,l.real(C)),G=z(x),f.isNumberVector(G).value&&2===G.value.length&&(qa=+G.value[0].value.real,F=+G.value[1].value.real,G=qa*E.a-F*E.b+E.tx,qa=qa*E.c-F*E.d-E.ty,p?A.lineTo(G,qa):(A.beginPath(),A.moveTo(G,qa),p=!0));A.stroke();J.removevar(B)}return m}for(G=q;G<r+v;G+=v)C=l.real(G),J.setvar(B,C),H=z(x),C.value.real>q&&e(qa,C,F,H,v),qa=C,F=H;J.removevar(B);p&&A.stroke();return m};r.plotX$1=function(a,b){var c=a[0],d=D.plotvars(c),e="#";-1!==d.indexOf("t")&&(e="t");
-1!==d.indexOf("z")&&(e="z");-1!==d.indexOf("y")&&(e="y");-1!==d.indexOf("x")&&(e="x");J.newvar(e);d=w.drawingstate.matrix;A.fillStyle=w.drawingstate.linecolor;A.lineWidth=1;A.lineCap=y.lineCap;A.lineJoin=y.lineJoin;A.miterLimit=y.miterLimit;for(var f=!1,g=-10;10>g;g+=.01){J.setvar(e,l.real(g));var h=z(c);if("number"===h.ctype){var n=+h.value.real,h=g*d.a-n*d.b+d.tx,n=g*d.c-n*d.d-d.ty;f?A.lineTo(h,n):(A.beginPath(),A.moveTo(h,n),f=!0)}}A.stroke();J.removevar(e);return m};D.plotvars=function(a){function b(a,
c){var k={},d;for(d=a.length-1;0<=d;--d)k[a[d]]=a[d];for(d=c.length-1;0<=d;--d)k[c[d]]=c[d];d=[];for(var e in k)k.hasOwnProperty(e)&&d.push(k[e]);return d}function c(a,c){for(var b=0;b<a.length;b++)a[b]===c&&(a.splice(b,1),b--);return a}var d,e,f,g;if("variable"===a.ctype)return[a.name];if("infix"===a.ctype)return d=D.plotvars(a.args[0]),a=D.plotvars(a.args[1]),b(d,a);if("list"===a.ctype){f=a.value;e=[];for(g=0;g<f.length;g++)d=D.plotvars(f[g]),e=b(e,d);return e}if("function"===a.ctype){f=a.args;
e=[];for(g=0;g<f.length;g++)d=D.plotvars(f[g]),e=b(e,d);"apply"!==a.oper&&"select"!==a.oper&&"forall"!==a.oper&&"sum"!==a.oper&&"product"!==a.oper&&"repeat"!==a.oper&&"min"!==a.oper&&"max"!==a.oper&&"sort"!==a.oper||"variable"!==a.args[1].ctype||(e=c(e,a.args[1].name));return e}return[]};r.clrscr$0=function(a,b){"undefined"!==typeof fa&&"undefined"!==typeof V&&A.clearRect(0,0,fa,V);return m};r.repaint$0=function(a,b){e();return m};r.screenbounds$0=function(a,b){var c=v.withUsage(f.realVector(w.to(0,
0)),"Point"),d=v.withUsage(f.realVector(w.to(fa,0)),"Point"),e=v.withUsage(f.realVector(w.to(fa,V)),"Point"),g=v.withUsage(f.realVector(w.to(0,V)),"Point");return f.turnIntoCSList([c,d,e,g])};r.createimage$3=function(a,b){var c=z(a[0]),d=C(a[1]),e=C(a[2]);if("number"!==d.ctype||"number"!==e.ctype||"string"!==c.ctype)return m;var f=document.createElement("canvas");f.id=c.value;f.width=d.value.real;f.height=e.value.real;f.style.display="none";document.body.appendChild(f);la[c.value]=f;return m};r.clearimage$1=
function(a,b){var c=z(a[0]);if("string"!==c.ctype)return m;c=document.getElementById(c.value);if("undefined"===typeof c||null===c)return m;var d=c.width,e=c.height;c.getContext("2d").clearRect(0,0,d,e);return m};r.canvas$4=function(a,b){var c=C(a[0]),d=C(a[1]),e=z(a[2]),f=a[3],g=D.extractPoint(c),h=D.extractPoint(d);if(!g.ok||!h.ok||"string"!==e.ctype)return m;e=document.getElementById(e.value);if("undefined"===typeof e||null===e)return m;var c=e.width,d=e.height,l=h.x-g.x,n=h.y-g.y,p=g.x-n*d/c,q=
g.y+l*d/c,n=h.x-n*d/c,l=h.y+l*d/c,h=w.from(g.x,g.y,1),p=w.from(p,q,1),n=w.from(n,l,1),g=h[0],q=h[1],l=p[0],r=p[1],v=n[0],u=n[1],p=c*(q-r)/((g-l)*(q-u)-(g-v)*(q-r)),c=c*(g-l)/((q-r)*(g-v)-(q-u)*(g-l)),n=-p*g-c*q,h=(d*(q-u)-d*(q-r))/((g-l)*(q-u)-(g-v)*(q-r)),l=(d*(g-v)-d*(g-l))/((q-r)*(g-v)-(q-u)*(g-l)),d=d-h*g-l*q,e=e.getContext("2d"),g=A;A=e;A.save();A.transform(p,h,c,l,n,d);z(f);A.restore();A=g};r.canvas$5=function(a,b){var c=C(a[0]),d=C(a[1]),e=C(a[2]),f=z(a[3]),g=a[4],c=D.extractPoint(c),d=D.extractPoint(d),
h=D.extractPoint(e);if(!c.ok||!d.ok||!h.ok||"string"!==f.ctype)return m;f=document.getElementById(f.value);if("undefined"===typeof f||null===f)return m;var l=f.width,e=f.height,n=w.from(c.x,c.y,1),p=w.from(d.x,d.y,1),d=w.from(h.x,h.y,1),c=n[0],h=n[1],q=p[0],r=p[1],v=d[0],u=d[1],d=((0-l)*(h-u)-0*(h-r))/((c-q)*(h-u)-(c-v)*(h-r)),l=((0-l)*(c-v)-0*(c-q))/((h-r)*(c-v)-(h-u)*(c-q)),p=0-d*c-l*h,n=((e-e)*(h-u)-(e-0)*(h-r))/((c-q)*(h-u)-(c-v)*(h-r)),q=((e-e)*(c-v)-(e-0)*(c-q))/((h-r)*(c-v)-(h-u)*(c-q)),e=
e-n*c-q*h,f=f.getContext("2d"),c=A;A=f;A.save();A.transform(d,n,l,q,p,e);z(g);A.restore();A=c};r.screenresolution$0=function(a,b){return l.real(w.drawingstate.matrix.a)};r.layer$1=function(a,b){};D.extractReferenceX=function(a,b){};r.imagesize$1=function(a,b){var c=C(a[0]);return"string"===c.ctype&&la[c.value]?f.realVector([la[c.value].width,la[c.value].height]):m};r.drawimage$2=function(a,b){function c(){var a=1,c=1,d=1,g=1,h=0,t=1,n=D.extractPoint(e);if(!n.ok||"string"!==l.ctype)return m;l=la[l.value];
if(!l)return m;A.save();var p;void 0!==b.angle&&(p=z(b.angle),"number"===p.ctype&&(h=p.value.real));void 0!==b.rotation&&(p=z(b.rotation),"number"===p.ctype&&(h=p.value.real));void 0!==b.scale&&(p=C(b.scale),"number"===p.ctype&&(c=a=p.value.real),f.isNumberVector(p).value&&2===p.value.length&&(a=p.value[0].value.real,c=p.value[1].value.real));void 0!==b.scalex&&(p=z(b.scalex),"number"===p.ctype&&(a=p.value.real));void 0!==b.scaley&&(p=z(b.scaley),"number"===p.ctype&&(c=p.value.real));void 0!==b.flipx&&
(p=z(b.flipx),"boolean"===p.ctype&&p.value&&(d=-1));void 0!==b.flipy&&(p=z(b.flipy),"boolean"===p.ctype&&p.value&&(g=-1));void 0!==b.alpha&&(p=z(b.alpha),"number"===p.ctype&&(t=p.value.real));var q=w.drawingstate.matrix,r=w.drawingstate.initialmatrix,ya=l.width,v=l.height;p=n.x*q.a-n.y*q.b+q.tx;var u=n.x*q.c-n.y*q.d-q.ty,hb=(n.x+1)*q.a-n.y*q.b+q.tx-p,q=(n.x+1)*q.c-n.y*q.d-q.ty-u,y=(n.x+1)*r.a-n.y*r.b+r.tx-(n.x*r.a-n.y*r.b+r.tx),r=(n.x+1)*r.c-n.y*r.d-r.ty-(n.x*r.c-n.y*r.d-r.ty),n=Math.sqrt(hb*hb+q*
q)/Math.sqrt(y*y+r*r),hb=-Math.atan2(hb,q)+Math.atan2(y,r);1!==t&&(A.globalAlpha=t);A.translate(p,u);A.scale(a*d*n,c*g*n);A.rotate(h+hb);A.translate(-p,-u);A.translate(-ya/2,-v/2);a=l;a.drawTo?a.drawTo(A,p,u):A.drawImage(a,p,u);A.globalAlpha=1;A.restore()}function d(){var a=1,c=1,f=1,t=1,n=D.extractPoint(e),p=D.extractPoint(g),q;if(!n.ok||!p.ok||"string"!==l.ctype)return m;l=la[l.value];if(!l)return m;var r=l.width,v=l.height;if(0===h)q={},q.x=n.x-(p.y-n.y),q.y=n.y+(p.x-n.x),t=v/r;else if(q=D.extractPoint(h),
!n.ok)return m;A.save();var u;void 0!==b.alpha&&(u=z(b.alpha),"number"===u.ctype&&(a=u.value.real));void 0!==b.aspect&&(u=z(b.aspect),"number"===u.ctype&&(t=u.value.real));void 0!==b.flipx&&(u=z(b.flipx),"boolean"===u.ctype&&u.value&&(c=-1));void 0!==b.flipy&&(u=z(b.flipy),"boolean"===u.ctype&&u.value&&(f=-1));u=w.drawingstate.matrix;1!==a&&(A.globalAlpha=a);a=n.x*u.a-n.y*u.b+u.tx;n=n.x*u.c-n.y*u.d-u.ty;A.transform(p.x*u.a-p.y*u.b+u.tx-a,p.x*u.c-p.y*u.d-u.ty-n,q.x*u.a-q.y*u.b+u.tx-a,q.x*u.c-q.y*u.d-
u.ty-n,a,n);A.scale(1/r,-1/v*t);A.translate(r/2,-v/2);A.scale(c,f);A.translate(-r/2,v/2);A.translate(0,-v);c=l;c.drawTo?c.drawTo(A,0,0):A.drawImage(c,0,0);A.globalAlpha=1;A.restore()}var e,g,h,l;return 2===a.length?(e=C(a[0]),l=C(a[1]),c()):3===a.length?(e=C(a[0]),g=C(a[1]),h=0,l=C(a[2]),d()):4===a.length?(e=C(a[0]),g=C(a[1]),h=C(a[2]),l=C(a[3]),d()):m};r.drawimage$3=r.drawimage$2;r.drawimage$4=r.drawimage$2;"use strict";var Ed=[{key:[":"],field:["."],deg:["\u00b0"],take:["_"]},{rassoc:!0,pow:["^"],
sqrt:["\u221a"]},{mul:["*","\u2062","\u22c5","\u00b7"],cross:["\u00d7"],div:["/","\u00f7","\u2215","\u2236"]},{add:["+"],sub:["-","\u2212"],neg:["!","\u00ac"]},{seq:[".."]},{eq:["==","\u225f"],ne:["!=","<>","\u2260"],lt:["<"],gt:[">"],le:["<=","\u2264","\u2266"],ge:[">=","\u2265","\u2267"],aeq:["~=","\u2248"],ane:["~!=","\u2249"],alt:["~<","\u2a89"],agt:["~>","\u2a8a"],ale:["~<=","\u2a85"],age:["~>=","\u2a86"],"in":["\u2208"],nin:["\u2209"]},{and:["&","\u2227"],or:["%","\u2228"]},{rassoc:!0,prepend:["<:"]},
{concat:["++","\u222a"],remove:["--","\u2216"],common:["~~","\u2229"],append:[":>"]},{rassoc:!0,assign:["="],define:[":="],undefine:[":=_"],bdefine:["::="]},{seq:[";"]},{modif:["->","\u2192"]},{rassoc:!0,list:[","]}],Fd=["+","-"],Gd=["!","\u221a"],Hd=["\u00b0",":=_"],Id=[";",","],Xb=[],sa={};(function(){var a=0;Ed.forEach(function(b){a+=2;var c=!!b.rassoc,d;for(d in b){var e=b[d];if("boolean"!==typeof e)for(var f={name:d,sym:e[0],symbols:e,rassoc:c,precedence:a,prefix:!1,postfix:!1,infix:!0,bare:!1},
g=0;g<e.length;++g){var h=e[g];if(sa.hasOwnProperty(h))throw Error("Duplicate operator: "+h);sa[h]=f;Xb.push(h)}}});Fd.forEach(function(a){sa[a].prefix=!0});Gd.forEach(function(a){sa[a].prefix=!0;sa[a].infix=!1});Hd.forEach(function(a){sa[a].postfix=!0;sa[a].infix=!1});Id.forEach(function(a){sa[a].prefix=!0;sa[a].postfix=!0;sa[a].infix=!0;sa[a].bare=!0})})();Xb.sort(function(a,b){return b.length-a.length});var Jd="(?:[0-9](?: [0-9])*(?: \\.(?! \\.)(?: [0-9])*)?|\\.(?: [0-9])+)(?: [Ee](?: [+-])?(?: [0-9])+)?".replace(/ /g,
"[ \t]*"),Kd="(?:[\u207a\u207b] )?[\u2070\u00b9\u00b2\u00b3\u2074\u2075\u2076\u2077\u2078\u2079](?: [\u2070\u00b9\u00b2\u00b3\u2074\u2075\u2076\u2077\u2078\u2079])*".replace(/ /g,"[ \t]*"),Ld="(?:[\u208a\u208b] )?[\u2080\u2081\u2082\u2083\u2084\u2085\u2086\u2087\u2088\u2089](?: [\u2080\u2081\u2082\u2083\u2084\u2085\u2086\u2087\u2088\u2089])*".replace(/ /g,"[ \t]*"),Yb=function(a,b,c){var d,e,f=0,g="(?:[",h=b.length;for(d=0;d<h;++d)e=b.charCodeAt(d),55296<=e?(g+="]|"+b.charAt(d)+"[",f=56320):(g+=String.fromCharCode(e=
f=a[e-32]+f),f+=a[b.charCodeAt(++d)-32],f!==e&&(f!==e+1&&(g+="-"),g+=String.fromCharCode(f)));return g+"]|["+c+"][\udc00-\udfff])"}([2,0,106,3,4,1,6,5,7,11,17,8,12,21,9,22,30,10,15,24,25,16,13,42,46,14,18,19,29,37,27,28,35,26,32,36,40,43,47,53,20,48,50,56,33,34,39,51,52,55,63,64,65,68,85,23,31,38,45,49,105,59,66,69,72,88,102,114,117,128,157,191,41,44,54,60,67,70,71,73,74,75,76,80,81,82,83,84,86,87,89,93,94,98,99,107,108,116,122,130,132,134,138,160,165,185,195,196,255,268,277,310,332,339,362,365,390,
449,457,470,512,513,541,568,582,619,673,726,768,820,921,991,1164,2684,6581,8453,11171,20949],"T4(4I!)!'!&/ 0 \u0096')2$+! !\u0083$ %## !(!   ! ; u \u0086.\u0088 =#!+YoA& 87C% } !5%+%) #!*! <0a,!4B1%'!&-'!1!$!33`HsG$!;!+.52'(#%#- & !$#$!*!9%  2%H''%#- & % % %B# !H *+   - & % $$!;!5%3!,(#%#- & % $$!X%  5!:! '$  #$% ! %$%$ $)W!G(   / 2$!> &%C(   / . $$!L! %5%;(   D#!*!* 4'&*$W + !#&]F %6&]% !#% !#!(# &   ! !#% # %1!#$ !/#L!S( @?$\u00817-!*''#$!$%+ ',6!:= !&!#7 \u0090 ##& ! ##D ##B ##& ! ##9 K ##^Y2*V#'$\u009d#5 4&p((+, #2*2*2,  5OC!'!Uy.D !&_)0J<#$,E'4Q/1Pv!|8:&K<9%)E>@7 )@\u0080# #$%1gT\u008e#'#=#'#( ! ! ! 0#P & !$  &$##'',&  &d!9!*,b!'!#. !$$(! ! ! # 1##&$'!G%\u00a58 8 \u0084(#$%6= !&!#Q+!*/1& & & & & & & &t!\u0097%E$&%'V(  z #&D${:Aj2\u0099\u00a6q\u00a9E\u00a4UZ#\u008d$2)%-8*0#_J+#b#M#(S1   # /0O2[R'$! !6>)/A?+8<!*$ .)$ D3  (-/$!$[ !$%#$#! !4 #1+ 6'#'#'1& & 7 .)c0\u00a86/'I\u00a7\u0093#\\N&6$&! . , $ ! % % \u007fM\u0092;R#Gh)d$ \u0085=4(4,a$'#'#'# \ud800!) 4 : % 9#6@\u0082\u0094?$IIX*5 ((=)<#@'(\ud801!f~N.Of\u008f1-)(\ud802!'#! E %$!#/)/10^: %)-)4nQ(%T!5#   AZ?$?C( >?G)-):9*\ud803!`KJ9J\ud804#PriL3>@7M$!6F2#/! !C* 3V& ! # 9 .+8N(#%#- & % $$!;!6$\ud805eF-% !\u008987#=F-!k7x4\ud806\u0087RB!\u0095K\ud808!\u00a2\ud809e\u008a\ud80d!8\ud811!\u009c\ud81a!\u009b+0c<;F*#BH&:\ud81b\u00a0U,!l,\ud82c!%\ud82f!\"&,$++.\ud835!w m %#!#%## ) ! & S ##( & > # $ !$& \u0091#3 3 0 3 0 3 0 3 0 3 (\ud83a!\u008b\ud83b\u0098# A % !#! . # ! !(!'! ! !   % !#! ! ! ! ! % !## & # # ! . 5&  $ 5\ud869!\u009f7\u008c\ud86d!\u00a1,g\ud86e!<#\u00a3\ud873!\u009e\ud87e!\u009a",
"\ud80c\ud840-\ud868\ud86a-\ud86c\ud86f-\ud872"),Md=("#(?: [1-9])?|(?:'|"+Yb+")(?: (?:[0-9']|"+Yb+"))*").replace(/ /g,"[ \t]*"),yc=["([ \t\n]+)|(//.*)|(/\\*)","("+Jd+")",xc(Xb),xc("[](){}||".split("")),"("+Ld+")","("+Kd+")","("+Md+")",'("[^"]*")|($)'].join("|"),Nd=new RegExp("[ \t]*".replace(/\*$/,"+"),"g"),Zb="ANY WS COMMENT START_COMMENT NUM OP BRA SUB SUP ID STR EOF".split(" ");(function(){var a=(new RegExp(yc,"g")).exec("");if(a.hasOwnProperty(Zb.length))throw Error("RE has more groups than expected");
if(!a.hasOwnProperty(Zb.length-1))throw Error("RE has fewer groups than expected");})();Xa.prototype.advanceBy=function(a){this.advanceTo(this.pos+a)};Xa.prototype.advanceTo=function(a){for(this.pos=a;this.bols[0]<=a;)this.bol=this.bols.shift(),this.line++};Xa.prototype.curPos=function(){return{row:this.line,col:this.pos-this.bol,pos:this.pos}};Xa.prototype.nextInternal=function(){var a=this.re.exec(this.input);if(a.index!==this.pos)throw X("Invalid token",this.curPos(),this.input.substring(this.pos,
a.index));var b=this.curPos();this.advanceBy(a[0].length);var c=this.curPos(),d;for(d=1;null==a[d];++d);return{start:b,end:c,raw:a[0],text:a[0].replace(Nd,""),toktype:Zb[d]}};Xa.prototype.next=function(){var a;do if(a=this.nextInternal(),"START_COMMENT"===a.toktype){var b=/\*\/|\/\*/g;b.lastIndex=a.start.pos+2;for(var c=1,d;0<c;)if(d=b.exec(this.input))"/*"===d[0]?++c:--c;else throw X("Unterminated comment",a.start,a.text);this.re.lastIndex=b.lastIndex;this.advanceTo(b.lastIndex);a.end=this.curPos();
a.raw=this.input.substring(a.start.pos,a.end.pos);a.text=a.raw;a.toktype="COMMENT"}while("WS"===a.toktype||"COMMENT"===a.toktype);return a};var Od={ctype:"void"};kb.prototype.postprocess=function(a){if(null===a)return Od;if(a){if("infix"===a.ctype)if(":="===a.oper){var b=a.args[0];if("function"===b.ctype)b.args.forEach(function(b){if(null===b||"variable"!==b.ctype)throw X("Function argument must be an identifier",b.start||a.start);});else if("variable"!==b.ctype)throw X(a.oper+" can only be used to define functions or variables",
a.start);}else if(","===a.oper)throw X("comma may only be used to delimit list elements",a.start);a.args&&(a.args=a.args.map(this.postprocess,this));if(a.modifs)for(var c in a.modifs)a.modifs[c]=this.postprocess(a.modifs[c]);if("paren"===a.ctype)return a.args[0];if("infix"===a.ctype){if("."===a.oper){if(!a.args[1]||"variable"!==a.args[1].ctype)throw X("Field name must be identifier",a.start,a.text);a.ctype="field";a.obj=a.args[0];a.key=a.args[1].name;delete a.args}this.infixmap&&(a.impl=this.infixmap[a.oper])}else"variable"===
a.ctype?this.usedVariables[a.name]=!0:"function"===a.ctype&&(this.usedFunctions[a.oper]=!0)}a&&"object"===typeof a&&(delete a.start,delete a.end,delete a.toktype,delete a.op,delete a.raw,delete a.text);return a};kb.prototype.parse=function(a){try{var b=Ac(new Xa(a));if("EOF"!==b.closedBy.toktype)throw X("Closing bracket never opened.",b.closedBy.start,b.closedBy.text);return this.postprocess(b.expr)}catch(c){return c.ctype="error",c}};"undefined"!==typeof process&&"undefined"!==typeof module&&"undefined"!==
typeof module.exports&&"undefined"===typeof window&&(module.exports.Parser=kb,module.exports.Tokenizer=Xa,module.exports.unicodeLetters=Yb,module.exports.parse=function(a){return(new kb).parse(a)});var ic={},$b;$b=[0,0,0,0,0,0,0,0,0,0,0,0];r.playsin$1=function(a,b){var c=C(a[0]),d=0;if("number"===c.ctype){var e;void 0!==b.line&&(e=z(b.line),"number"===e.ctype&&(d=Math.floor(e.value.real),0>d&&(d=0),10<d&&(d=10)));c=c.value.real;0!==$b[d]&&$b[d].set({freq:c})}return m};var N={printArr:function(a){for(var b=
a.value.length,c=[],d=[],e=!1,f=0;f<b;f++)c[f]=a.value[f].value.real,d[f]=a.value[f].value.imag,0!==d[f]&&(e=!0);console.log(c);e&&console.log(d)},zero:function(a){for(var b=[],c=l.real(0),d=0;d<a.value.real;d++)b[d]=c;return f.turnIntoCSList(b)},number:function(a,b){var c=N.zero(b);c.value[0]=a;return c},variable:function(a,b){var c=N.zero(b);c.value[0]=a;c.value[1]=l.real(1);return c},add:function(a,b){return f.add(a,b)},sub:function(a,b){return f.sub(a,b)},mult:function(a,b){if(a.value.length!==
b.value.length)return console.error("dims don't fit return nada"),m;for(var c=a.value.length,d=N.zero(l.real(c)),e=l.real(0),f=0;f<c;f++){for(var g=0;g<=f;g++)e=l.add(e,l.mult(a.value[g],b.value[f-g]));d.value[f]=e;e=l.real(0)}return d},pow:function(a,b){if(0>b.value.real||b.value.real!==Math.floor(b.value.real))return N.root(a,b);for(var c=a,d=1;d<b.value.real;d++)c=N.mult(c,a);return c},root:function(a,b){var c=l.real(0),d=l.real(1),e=l.add(d,b),f=a.value.length,g=N.zero(l.real(f));g.value[0]=l.pow(a.value[0],
b);for(var h=c,m,n,p=1;p<f;p++){n=l.real(p);for(var q=1;q<=p;q++)m=l.mult(e,l.real(q)),m=l.div(m,n),m=l.sub(m,d),m=l.mult(m,a.value[q]),m=l.mult(m,g.value[p-q]),h=l.add(h,m);h=l.div(h,a.value[0]);g.value[p]=h;h=c}return g},findFirstNoneZero:function(a,b,c){for(var d=Infinity,e=Infinity,f=c;f<a.value.length;f++)if(1E-12<l.abs2(a.value[f]).value.real){d=f;break}for(a=c;a<b.value.length;a++)if(1E-12<l.abs2(b.value[a]).value.real){e=a;break}return[d,e]},div:function(a,b){if(a.value.length!==b.value.length)return console.log("dims don't fit - return nada"),
m;for(var c=a.value.length,d=l.real(0),e=N.zero(l.real(c)),f=d,g=d,h=0;h<c;h++){g=N.findFirstNoneZero(a,b,h);h<g[0]&&g[0]===g[1]&&Infinity!==g[0]&&(a.value.splice(h,g[0]),b.value.splice(h,g[0]),e.value.splice(h,g[0]),c-=g[0]);for(var g=a.value[h],n=0;n<h;n++)f=l.add(f,l.mult(e.value[n],b.value[h-n]));g=l.sub(g,f);g=l.div(g,b.value[0]);e.value[h]=g;f=d}return e},exp:function(a){var b=l.real(0),c=a.value.length,d=N.zero(l.real(c)),e=b,f;d.value[0]=l.exp(a.value[0]);for(var g=1;g<c;g++){for(var h=1;h<=
g;h++)f=l.mult(l.real(h),a.value[h]),f=l.mult(f,d.value[g-h]),e=l.add(e,f);d.value[g]=l.div(e,l.real(g));e=b}return d},log:function(a){var b=l.real(0),c=a.value.length,d=N.zero(l.real(c));d.value[0]=l.log(a.value[0]);for(var e=b,f,g,h=1;h<c;h++){f=a.value[h];for(var m=1;m<h;m++)g=l.mult(l.real(m),d.value[m]),g=l.mult(g,a.value[h-m]),e=l.add(e,g);e=l.div(e,l.real(h));f=l.sub(f,e);f=l.div(f,a.value[0]);d.value[h]=f;e=b}return d},sincos:function(a){var b=l.real(0),c=a.value.length,d=N.zero(l.real(c)),
e=N.zero(l.real(c));d.value[0]=l.sin(a.value[0]);e.value[0]=l.cos(a.value[0]);for(var f=b,g=b,h,m,n,p=1;p<c;p++){n=l.real(p);for(var q=1;q<=p;q++)m=l.mult(l.real(q),a.value[q]),h=l.mult(m,e.value[p-q]),m=l.mult(m,d.value[p-q]),g=l.add(g,h),f=l.add(f,m);g=l.div(g,n);f=l.div(f,l.neg(n));d.value[p]=g;e.value[p]=f;f=g=b}N.sinsave=d;N.cossave=e;return[d,e]},sin:function(a){return N.sincos(a)[0]},cos:function(a){return N.sincos(a)[1]},faculty:function(a){var b=[];b[0]=l.real(1);for(var c=1,d=1;d<=a.value.real;d++)c*=
d,b[d]=l.real(c);return b=f.turnIntoCSList(b)},diff:function(a,b,c,d){var e;if("variable"===a.ctype)e=a.name!==b?N.number(z(a),d):N.variable(c,d);else if("number"===a.ctype)e=N.number(a,d);else{if("infix"===a.ctype){if("*"===a.oper)return N.mult(N.diff(a.args[0],b,c,d),N.diff(a.args[1],b,c,d));if("^"===a.oper)return N.pow(N.diff(a.args[0],b,c,d),N.diff(a.args[1],b,c,d).value[0]);if("/"===a.oper)return N.div(N.diff(a.args[0],b,c,d),N.diff(a.args[1],b,c,d));if("+"===a.oper)return N.add(N.diff(a.args[0],
b,c,d),N.diff(a.args[1],b,c,d));if("-"===a.oper)return N.sub(N.diff(a.args[0],b,c,d),N.diff(a.args[1],b,c,d));console.log("infix not found",a.oper);return m}if("function"===a.ctype){if("exp$1"===a.oper)return N.exp(N.diff(a.args[0],b,c,d));if("log$1"===a.oper)return N.log(N.diff(a.args[0],b,c,d));if("sin$1"===a.oper)return N.sin(N.diff(a.args[0],b,c,d));if("cos$1"===a.oper)return N.cos(N.diff(a.args[0],b,c,d))}else return console.log("ctype not found",a.ctype),m}return e},adevaluate:function(a,b,
c,d){a=N.diff(a,b,c,d);d=N.faculty(d);for(b=2;b<a.value.length;b++)a.value[b]=l.mult(a.value[b],d.value[b]);return a},autodiff:function(a,b,c,d){for(var e=[],g=c.value.length,h,l=0;l<g;l++)h=N.adevaluate(a,b,c.value[l],d),e[l]=h;return e=f.turnIntoCSList(e)}},y={handleModifs:function(a,b){y.dashing&&y.unSetDash();y.colorraw=null;y.size=null;0>=y.psize&&(y.psize=0);0>=y.lsize&&(y.lsize=0);y.overhang=1;y.dashing=!1;y.isArrow=!1;y.arrowSides="==>";y.arrowposition=1;y.headlen=10;y.arrowShape=y.arrowShapes.line;
y.alpha=w.drawingstate.alpha;y.bold="";y.italics="";y.family="sans-serif";y.align=0;y.xOffset=0;y.yOffset=0;y.lineCap="round";y.lineJoin="round";y.miterLimit=10;var c,d;for(c in a){var e=a[c];e&&((d=b[c])?(!0===d&&(d=y.modifHandlers[c]),d(z(e))):console.log("Modifier not supported: "+c))}null!==y.size?y.psize=y.lsize=y.size:(y.psize=w.drawingstate.pointsize,y.lsize=w.drawingstate.linesize);y.dashing&&y.dashing(y.lsize);null!==y.colorraw?y.pointColor=y.lineColor=y.textColor=y.makeColor(y.colorraw):
1===y.alpha?(y.pointColor=w.drawingstate.pointcolor,y.lineColor=w.drawingstate.linecolor,y.textColor=w.drawingstate.textcolor):(y.pointColor=y.makeColor(w.drawingstate.pointcolorraw),y.lineColor=y.makeColor(w.drawingstate.linecolorraw),y.textColor=y.makeColor(w.drawingstate.textcolorraw));y.black=1===y.alpha?"rgb(0,0,0)":"rgba(0,0,0,"+y.alpha+")"},modifHandlers:{size:function(a){"number"===a.ctype&&(y.size=a.value.real,0>y.size&&(y.size=0),1E3<y.size&&(y.size=1E3))},color:function(a){f.isNumberVector(a).value&&
3===a.value.length&&(y.colorraw=[a.value[0].value.real,a.value[1].value.real,a.value[2].value.real])},alpha:function(a){"number"===a.ctype&&(y.alpha=a.value.real)},dashpattern:function(a){if("list"===a.ctype){for(var b=[],c=0,d=0;c<a.value.length;c++)"number"===a.value[c].ctype&&(b[d++]=a.value[c].value.real);y.dashing=y.setDash.bind(null,b)}},dashtype:function(a){if("number"===a.ctype)a=Math.floor(a.value.real);else if("string"===a.ctype)a=a.value;else return;if(a=y.dashTypes[a])y.dashing=y.setDash.bind(null,
a)},dashing:function(a){"number"===a.ctype&&(a=Math.floor(a.value.real),y.dashing=y.setDash.bind(null,[2*a,a]))},overhang:function(a){"number"===a.ctype&&(y.overhang=y.overhang*a.value.real+(1-y.overhang)*(1-a.value.real))},arrow:function(a){"boolean"===a.ctype?y.isArrow=a.value:console.error("arrow needs to be of type boolean")},arrowshape:function(a){"string"!==a.ctype?console.error("arrowshape needs to be of type string"):y.arrowShapes.hasOwnProperty(a.value)?(y.arrowShape=y.arrowShapes[a.value],
y.isArrow=!0,y.arrowShape.deprecated&&(console.log("arrowshape "+a.value+" is deprecated, use "+y.arrowShape.deprecated+" instead."),y.arrowShape.deprecated=null)):(a=Object.keys(y.arrowShapes),a.sort(),a=a.join(", "),console.error("arrowshape needs to be one of "+a))},arrowsides:function(a){"string"!==a.ctype?console.error("arrowsides is not of type string"):"==>"!==a.value&&"<==>"!==a.value&&"<=="!==a.value?console.error("arrowsides is unknows"):(y.arrowSides=a.value,y.isArrow=!0)},arrowposition:function(a){"number"!==
a.ctype?console.error("arrowposition is not of type number"):0>a.value.real?console.error("arrowposition has to be positive"):1<a.value.real?y.overhang=y.overhang*a.value.real+(1-y.overhang)*(1-a.value.real):(y.arrowposition=a.value.real,y.isArrow=!0)},arrowsize:function(a){"number"!==a.ctype?console.error("arrowsize is not of type number"):0>a.value.real?console.error("arrowsize has to be positive"):y.headlen*=a.value.real},bold:function(a){"boolean"===a.ctype&&a.value&&(y.bold="bold ")},italics:function(a){"boolean"===
a.ctype&&a.value&&(y.italics="italic ")},family:function(a){"string"===a.ctype&&(y.family=a.value)},align:function(a){"string"===a.ctype&&(a=a.value,"left"===a&&(y.align=0),"right"===a&&(y.align=1),"mid"===a&&(y.align=.5))},x_offset:function(a){"number"===a.ctype&&(y.xOffset=a.value.real)},y_offset:function(a){"number"===a.ctype&&(y.yOffset=a.value.real)},offset:function(a){"list"===a.ctype&&2===a.value.length&&"number"===a.value[0].ctype&&"number"===a.value[1].ctype&&(y.xOffset=a.value[0].value.real,
y.yOffset=a.value[1].value.real)},lineCap:function(a){"string"!==a.ctype||"round"!==a.value&&"square"!==a.value&&"butt"!==a.value||(y.lineCap=a.value)},lineJoin:function(a){"string"!==a.ctype||"round"!==a.value&&"bevel"!==a.value&&"miter"!==a.value||(y.lineJoin=a.value)},miterLimit:function(a){"number"===a.ctype&&0<a.value.real&&(y.miterLimit=Math.round(a.value.real))}},lineModifs:{size:!0,color:!0,alpha:!0,dashpattern:!0,dashtype:!0,dashing:!0,overhang:!0,arrow:!0,arrowshape:!0,arrowsides:!0,arrowposition:!0,
arrowsize:!0,lineCap:!0},pointModifs:{size:!0,color:!0,alpha:!0}};y.pointAndLineModifs=y.lineModifs;y.conicModifs={size:!0,color:!0,alpha:!0,lineCap:!0,lineJoin:!0,miterLimit:!0};y.textModifs={size:!0,color:!0,alpha:!0,bold:!0,italics:!0,family:!0,align:!0,x_offset:!0,y_offset:!0,offset:!0};y.makeColor=function(a){return"rgba("+Math.floor(255*a[0])+","+Math.floor(255*a[1])+","+Math.floor(255*a[2])+","+y.alpha+")"};y.preDrawCurve=function(){A.lineWidth=y.lsize;A.lineCap=y.lineCap;A.lineJoin=y.lineJoin;
A.miterLimit=y.miterLimit;A.strokeStyle=y.lineColor};y.arrowShapes={"default":{close:!1,fill:!1,ratio:1,deprecated:"line"},line:{close:!1,fill:!1,ratio:1},empty:{close:!0,fill:!1,ratio:1},hollow:{close:!0,fill:!1,ratio:1,deprecated:"empty"},full:{close:!0,fill:!0,ratio:1},jet:{close:!0,fill:!0,ratio:1.5},delta:{close:!0,fill:!0,ratio:1.5,deprecated:"jet"}};y.drawsegcore=function(a,b){function c(a,b,c,d){var k=a-d*q+.5*r,e=b-d*r-.5*q,f=a-d*q-.5*r;d=b-d*r+.5*q;A.beginPath();y.arrowShape.fill&&(A.lineWidth=
y.lsize/2);A.moveTo(k,e);A.lineTo(a,b);A.lineTo(f,d);y.arrowShape.close&&(A.fillStyle=y.lineColor,A.lineTo(a-c*q,b-c*r),A.closePath(),y.arrowShape.fill&&A.fill());A.stroke()}var d=w.drawingstate.matrix,e=a.x*d.a-a.y*d.b+d.tx,f=a.x*d.c-a.y*d.d-d.ty,g=b.x*d.a-b.y*d.b+d.tx,h=b.x*d.c-b.y*d.d-d.ty,l=y.overhang,m=1-l,d=l*e+m*g,n=l*f+m*h,p=l*g+m*e,l=l*h+m*f;A.lineWidth=y.lsize;A.lineCap=y.lineCap;A.lineJoin=y.lineJoin;A.miterLimit=y.miterLimit;A.strokeStyle=y.lineColor;if(!y.isArrow||e===f&&g===h).01>y.lsize||
(A.beginPath(),A.moveTo(d,n),A.lineTo(p,l),A.stroke());else{var e=g-e,f=h-f,g=y.headlen/Math.sqrt(e*e+f*f),q=e*g,r=f*g,h=y.arrowposition,m=1-h,f=h*d+m*p,e=h*n+m*l,g=h*p+m*d,h=h*l+m*n,m=y.arrowSides;A.beginPath();y.arrowShape.close?("<==>"===m||"<=="===m?(1>y.arrowposition&&(A.moveTo(d,n),A.lineTo(f,e)),A.moveTo(f+q,e+r)):A.moveTo(d,n),"==>"===m||"<==>"===m?(A.lineTo(g-q,h-r),1>y.arrowposition&&(A.moveTo(g,h),A.lineTo(p,l))):A.lineTo(p,l)):(A.moveTo(d,n),A.lineTo(p,l));A.stroke();"==>"!==m&&"<==>"!==
m||c(g,h,1,y.arrowShape.ratio);"<=="!==m&&"<==>"!==m||c(f,e,-1,-y.arrowShape.ratio)}};y.drawpoint=function(a){var b=w.drawingstate.matrix,c=a.x*b.a-a.y*b.b+b.tx;a=a.x*b.c-a.y*b.d-b.ty;A.lineWidth=.3*y.psize;A.beginPath();A.arc(c,a,y.psize,0,2*Math.PI);A.fillStyle=y.pointColor;A.fill();A.beginPath();A.arc(c,a,1.15*y.psize,0,2*Math.PI);A.fillStyle=y.black;A.strokeStyle=y.black;A.stroke()};y.drawline=function(a){var b=l.abs(a.value[0]).value.real,c=l.abs(a.value[1]).value.real,d=l.abs(a.value[2]).value.real,
e;b>=c&&b>=d&&(e=a.value[0]);c>=b&&c>=d&&(e=a.value[1]);d>=c&&d>=b&&(e=a.value[2]);b=l.div(a.value[0],e);c=l.div(a.value[1],e);a=l.div(a.value[2],e);a=[b.value.real,c.value.real,a.value.real];Math.abs(a[0])<Math.abs(a[1])?(b=[1,0,30],e=[-1,0,30]):(b=[0,1,30],e=[0,-1,30]);b=[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]];a=[a[1]*e[2]-a[2]*e[1],a[2]*e[0]-a[0]*e[2],a[0]*e[1]-a[1]*e[0]];y.drawsegcore({x:b[0]/b[2],y:b[1]/b[2]},{x:a[0]/a[2],y:a[1]/a[2]})};y.dashTypes={solid:[],dashed:[10,
10],tightdash:[10,4],dotted:[1,3],dashdot:[10,5,1,5],"dashvalue.solid":[],"dashvalue.dashed":[10,10],"dashvalue.tightdash":[10,4],"dashvalue.dotted":[1,3],"dashvalue.dashdot":[10,5,1,5],0:[],1:[10,10],2:[10,4],3:[1,3],4:[10,5,1,5]};y.setDash=function(a,b){var c=Math.sqrt(b);a=a.slice();for(var d=0;d<a.length;d++)a[d]*=c;A.webkitLineDash=a;A.setLineDash(a);A.mozDash=a};y.unSetDash=function(){A.webkitLineDash=[];A.setLineDash([]);A.mozDash=[]};Bc.prototype={set fillStyle(a){var b=this;yb(a,function(a,
d,e,f){b._fill="#"+Ya(a.toString(16),2)+Ya(d.toString(16),2)+Ya(e.toString(16),2);b._fillOpacity=255===f?null:f})},set strokeStyle(a){var b=this;yb(a,function(a,d,e,f){b._stroke="#"+Ya(a.toString(16),2)+Ya(d.toString(16),2)+Ya(e.toString(16),2);b._strokeOpacity=255===f?null:f})},clearRect:function(){},beginPath:function(){this._path=[]},_pathcmd:function(){this._path.push.apply(this._path,arguments)},closePath:function(){this._pathcmd("Z")},moveTo:function(a,b){this._pathcmd("M",a,b)},lineTo:function(a,
b){this._pathcmd("L",a,b)},bezierCurveTo:function(a,b,c,d,e,f){this._pathcmd("C",a,b,c,d,e,f)},quadraticCurveTo:function(a,b,c,d){this._pathcmd("Q",a,b,c,d)},arc:function(a,b,c,d,e,f){var g=c*Math.cos(d)+a,h=c*Math.sin(d)+b,l=c*Math.cos(e)+a,m=c*Math.sin(e)+b;e=f?d-e:e-d;e>=2*Math.PI?this._pathcmd(this._path.length?"L":"M",g,h,"A",c,c,0,0,f?1:0,a-c*Math.cos(d),b-c*Math.sin(d),"A",c,c,0,0,f?1:0,g,h):this._pathcmd(this._path.length?"L":"M",g,h,"A",c,c,0,e>Math.PI?1:0,f?1:0,l,m)},rect:function(a,b,c,
d){this._pathcmd("M",a,b,"h",c,"v",d,"h",-c,"z")},_cmd:function(a){1!==this.globalAlpha?(this._body.push('<g opacity="'+this.globalAlpha+'">'),this._body.push(a),this._body.push("</g>")):this._body.push(a)},_attrs:function(a){var b="",c;for(c in a)null!==a[c]&&(b+=" "+c+'="'+a[c]+'"');return b},fill:function(){this._cmd("<path"+this._attrs({d:this._path.join(" "),fill:this._fill,"fill-opacity":this._fillOpacity})+"/>")},stroke:function(){this._cmd("<path"+this._attrs({d:this._path.join(" "),stroke:this._stroke,
"stroke-opacity":this._strokeOpacity,"stroke-width":this.lineWidth,"stroke-linecap":this.lineCap,"stroke-linejoin":this.lineJoin,"stroke-miterlimit":"miter"===this.lineJoin?this.miterLimit:null})+"/>")},clip:function(){++this._clipIndex;this._body.push('<clipPath id="clip'+this._clipIndex+'"><path d="'+this._path.join(" ")+'"/></clipPath>','<g clip-path="url(#clip'+this._clipIndex+')">');this._saveStack[this._saveStack.length-1]+="</g>"},save:function(){this._saveStack.push("")},restore:function(){this._body.push(this._saveStack.pop());
0===this._saveStack.length&&this._saveStack.push("")},_transform:function(a){this._body.push('<g transform="'+a+'">');this._saveStack[this._saveStack.length-1]+="</g>"},translate:function(a,b){this._transform("translate("+a+" "+b+")")},rotate:function(a){this._transform("rotate("+Math.PI/180*a+")")},scale:function(a,b){this._transform("scale("+a+" "+b+")")},transform:function(a,b,c,d,e,f){this._transform("matrix("+[a,b,c,d,e,f].join(" ")+")")},drawImage:function(a,b,c){if(3!==arguments.length)throw Error("SvgWriterContext only supports 3-argument version of drawImage");
var d=this._imgcache.indexOf(a);if(-1===d){var d=this._imgcache.length,e;e=a.cachedDataURL?a.cachedDataURL:Dc(a);this._defs.push('<image id="img'+d+'" x="0" y="0" width="'+a.width+'" height="'+a.height+'" xlink:href="'+e+'"/>');this._imgcache.push(a)}this._cmd('<use x="'+b+'" y="'+c+'" xlink:href="#img'+d+'"/>')},toBlob:function(){for(;1<this._saveStack.length||""!==this._saveStack[0];)this.restore();var a='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="'+
this.width+'px" height="'+this.height+'px">\n'+this._defs.join("\n")+'\n</defs>\n<g stroke="none" fill="none">\n'+this._body.join("\n")+"\n</g>\n</svg>\n";return new Blob([a],{type:"image/svg+xml"})}};Cc.prototype={_cmd:function(){this._body.push(Array.prototype.join.call(arguments," "))},_setAlpha:function(a,b,c){var d=Math.round(255*a*this._globalAlpha);b+=d;this._extGState[b]="<< /"+c+" "+d/255+" >>";this._cmd("/"+b,"gs");return a},set globalAlpha(a){this._globalAlpha=a;this._setAlpha(this._strokeAlpha,
"As","CA");this._setAlpha(this._fillAlpha,"Af","ca")},set fillStyle(a){var b=this;yb(a,function(a,d,e,f){b._cmd(a/255,d/255,e/255,"rg");b._setAlpha(b._fillAlpha=f,"Af","ca")})},set strokeStyle(a){var b=this;yb(a,function(a,d,e,f){b._cmd(a/255,d/255,e/255,"RG");b._setAlpha(b._strokeAlpha=f,"As","CA")})},set lineWidth(a){this._cmd(a,"w")},set lineCap(a){this._cmd({butt:0,round:1,square:2}[a],"J")},set lineJoin(a){this._cmd({miter:0,round:1,bevel:2}[a],"j")},set miterLimit(a){this._cmd(a,"M")},clearRect:function(){},
beginPath:function(){this._pathUsed=!1},closePath:function(){this._cmd("h")},moveTo:function(a,b){this._cmd(this._xPos=a,this._yPos=-b,"m")},lineTo:function(a,b){this._cmd(this._xPos=a,this._yPos=-b,"l")},bezierCurveTo:function(a,b,c,d,e,f){this._cmd(a,-b,c,-d,this._xPos=e,this._yPos=-f,"c")},quadraticCurveTo:function(a,b,c,d){this.bezierCurveTo((2*a+this._xPos)/3,(2*b-this._yPos)/3,(c+2*a)/3,(d+2*b)/3,c,d)},_kappa:.5522847498307935,arc:function(a,b,c,d,e,f){if(0===d&&e===2*Math.PI)d=this._kappa*
c,this.moveTo(a+c,b),this.bezierCurveTo(a+c,b+d,a+d,b+c,a,b+c),this.bezierCurveTo(a-d,b+c,a-c,b+d,a-c,b),this.bezierCurveTo(a-c,b-d,a-d,b-c,a,b-c),this.bezierCurveTo(a+d,b-c,a+c,b-d,a+c,b);else throw Error("PdfWriterContext.arc only supports full circles");},rect:function(a,b,c,d){this._cmd(a,-b,c,-d,"re")},_usePath:function(a){if(this._pathUsed){var b=this._body[this._pathUsed],c={"S + f":"B","f + S":"B","W n + S":"W S","W n + f":"W f","S + W n":"W S","f + W n":"W f","B + W n":"W B","W S + f":"W B",
"W f + S":"W B"}[b+" + "+a];if(!c)throw Error("Don't know how to combine '"+b+"' and '"+a+"'");this._body.splice(this._pathUsed,1);a=c}this._pathUsed=this._body.length;this._cmd(a)},fill:function(){this._usePath("f")},stroke:function(){this._usePath("S")},clip:function(){this._usePath("W n")},save:function(){this._cmd("q")},restore:function(){this._cmd("Q")},translate:function(a,b){this.transform(1,0,0,1,a,b)},rotate:function(a){var b=Math.cos(a);a=Math.sin(a);this.transform(b,a,-a,b,0,0)},scale:function(a,
b){this.transform(a,0,0,b,0,0)},transform:function(a,b,c,d,e,f){this._cmd(a,-b,-c,d,e,-f,"cm")},_png:function(a){if("data:image/png;base64,"!==a.substr(0,22))return{error:"Not a base64-encoded PNG file"};a=ld(a.substr(22));var b=md(a);console.log("PNG chunks:",b.map(function(a){return a.type}));if("IHDR"!==b[0].type)throw Error("Image does not start with an IHDR");var c=b[0].data;a=(c[0]<<24|c[1]<<16|c[2]<<8|c[3])>>>0;var d=(c[4]<<24|c[5]<<16|c[6]<<8|c[7])>>>0,e=c[8],f=c[9],g=0===(f&2),h=0!==(f&4),
l=c[10],m=c[11],c=c[12];if(0!==l)throw Error("Unsupported PNG compression method: "+l);if(0!==m)throw Error("Unsupported PNG filter method: "+m);if(0!==c)return{error:"Interlaced image not supported"};if(0!==(f&1))return{error:"Indexed PNG image not supported"};m=null;f=g?1:3;l=b.filter(function(a){return"IDAT"===a.type}).map(function(a){return a.data});if(h){h=window.pako;m=new h.Inflate;for(b=0;b<l.length;++b)m.push(l[b],b+1===l.length);if(m.err)throw Error(m.err);m=m.result;c=e>>>3;if(m.length!==
d*(a*(f+1)*c+1))throw Error("Data length mismatch");for(var n=f*c,l=new Uint8Array(d*(a*n+1)),p=new Uint8Array(d*(a*c+1)),q=0,r=0,u=0,v=0;v<d;++v){l[r++]=p[u++]=m[q++];for(var w=0;w<a;++w){for(b=0;b<n;++b)l[r++]=m[q++];for(b=0;b<c;++b)p[u++]=m[q++]}}if(q!==m.length||r!==l.length||u!==p.length)throw Error("Seems we garbled our index computation somehow");p=h.deflate(p);m=this._strm({Type:"/XObject",Subtype:"/Image",Width:a,Height:d,ColorSpace:"/DeviceGray",BitsPerComponent:e,Filter:"/FlateDecode",
DecodeParms:this._dict({Predictor:15,Colors:1,BitsPerComponent:e,Columns:a})},p).ref;l=[h.deflate(l)]}var y=0;l.forEach(function(a){y+=a.length});return this._obj([this._dict({Type:"/XObject",Subtype:"/Image",Name:"/img"+this._imgcache.length,Width:a,Height:d,ColorSpace:g?"/DeviceGray":"/DeviceRGB",SMask:m,BitsPerComponent:e,Length:y,Filter:"/FlateDecode",DecodeParms:this._dict({Predictor:15,Colors:f,BitsPerComponent:e,Columns:a})}),"\nstream\n"].concat(l,["\nendstream"]))},drawImage:function(a,b,
c){if(3!==arguments.length)throw Error("PdfWriterContext only supports 3-argument version of drawImage");var d=this._imgcache.indexOf(a);if(-1===d){d=this._imgcache.length;this._imgcache.push(a);var e=this._png(a.cachedDataURL||"");e.hasOwnProperty("error")&&(e=this._png(Dc(a)));if(e.hasOwnProperty("error"))throw Error(e.error);this._xobjects["img"+d]=e.ref}this._cmd("q");this._setAlpha(1,"Af","ca");this._cmd(a.width,0,0,a.height,b,-c-a.height,"cm");this._cmd("/img"+d,"Do");this._cmd("Q")},_dict:function(a){var b=
"<<",c;for(c in a)b+=" /"+c+" "+a[c];return b+" >>"},_obj:function(a,b){b||(b=this._nextIndex++);Array.isArray(a)||(a=[this._dict(a)]);a.index=b;a.ref=b+" 0 R";a.offset=this._offset;var c=0;a.unshift(b+" 0 obj\n");a.push("\nendobj\n");for(var d=0;d<a.length;++d)c+=a[d].length;this._offset+=c;this._objects.push(a);return a},_strm:function(a,b,c){a.Length=b.length;return this._obj([this._dict(a),"\nstream\n",b,"\nendstream"],c)},toBlob:function(){var a;a="["+[0,-this.height,this.width,0].join(" ")+
"]";this._obj({Type:"/Catalog",Pages:"2 0 R"},1);this._obj({Type:"/Pages",Kids:"[3 0 R]",Count:1},2);this._obj({Type:"/Page",Parent:"2 0 R",MediaBox:a,Contents:"4 0 R",Resources:this._dict({ProcSet:"[/PDF /Text /ImageB /ImageC /ImageI]",XObject:this._dict(this._xobjects),ExtGState:this._dict(this._extGState)})},3);var b=this._body.join("\n"),c=new Uint8Array(b.length);for(a=0;a<b.length;++a)c[a]=b.charCodeAt(a)&255;b=window.pako.deflate(c);this._strm({Filter:"/FlateDecode"},b,4);var b=this._objects,
d=[];for(a=1;a<b.length;++a)d[b[a].index]=b[a];c="xref\n0 "+d.length+"\n";for(a=0;a<d.length;++a)c=d[a]?c+(Ya(String(d[a].offset),10)+" 00000 n \n"):c+"0000000000 65535 f \n";a="trailer\n"+this._dict({Size:d.length,Root:"1 0 R"})+"\nstartxref\n"+this._offset+"\n%%EOF\n";b=Array.prototype.concat.apply([],b);b.push(c,a);return new Blob(b,{type:"application/pdf"})}};var lb=null;Va.push(Ec);ma.exportSVG=function(){Fc(Bc)};ma.exportPDF=function(){ua.loadScript("pako","pako.min.js",function(){Fc(Cc)})};
var Ga={},w={drawingstate:{}};w.drawingstate.linecolor="rgb(0,0,255)";w.drawingstate.linecolorraw=[0,0,1];w.drawingstate.pointcolor="rgb(255,200,0)";w.drawingstate.pointcolorraw=[1,.78,0];w.drawingstate.textcolor="rgb(0,0,0)";w.drawingstate.textcolorraw=[0,0,0];w.drawingstate.alpha=1;w.drawingstate.pointsize=4;w.drawingstate.linesize=1;w.drawingstate.textsize=20;w.drawingstate.matrix={};w.drawingstate.matrix.a=25;w.drawingstate.matrix.b=0;w.drawingstate.matrix.c=0;w.drawingstate.matrix.d=25;w.drawingstate.matrix.tx=
250.5;w.drawingstate.matrix.ty=250.5;w.drawingstate.matrix.det=w.drawingstate.matrix.a*w.drawingstate.matrix.d-w.drawingstate.matrix.b*w.drawingstate.matrix.c;w.drawingstate.matrix.sdet=Math.sqrt(w.drawingstate.matrix.det);w.drawingstate.initialmatrix={};w.drawingstate.initialmatrix.a=w.drawingstate.matrix.a;w.drawingstate.initialmatrix.b=w.drawingstate.matrix.b;w.drawingstate.initialmatrix.c=w.drawingstate.matrix.c;w.drawingstate.initialmatrix.d=w.drawingstate.matrix.d;w.drawingstate.initialmatrix.tx=
w.drawingstate.matrix.tx;w.drawingstate.initialmatrix.ty=w.drawingstate.matrix.ty;w.drawingstate.initialmatrix.det=w.drawingstate.matrix.det;w.drawingstate.initialmatrix.sdet=w.drawingstate.matrix.sdet;w.clone=function(a){if(null===a||"object"!==typeof a)return a;var b=a.constructor(),c;for(c in a)b[c]=w.clone(a[c]);return b};Ga.backup=w.clone(w.drawingstate);Ga.stack=[];w.clone(w.drawingstate);w.reset=function(){w.drawingstate.matrix.a=w.drawingstate.initialmatrix.a;w.drawingstate.matrix.b=w.drawingstate.initialmatrix.b;
w.drawingstate.matrix.c=w.drawingstate.initialmatrix.c;w.drawingstate.matrix.d=w.drawingstate.initialmatrix.d;w.drawingstate.matrix.tx=w.drawingstate.initialmatrix.tx;w.drawingstate.matrix.ty=w.drawingstate.initialmatrix.ty;w.drawingstate.matrix.det=w.drawingstate.initialmatrix.det;w.drawingstate.matrix.sdet=w.drawingstate.initialmatrix.sdet};w.from=function(a,b,c){a/=c;b/=c;c=w.drawingstate.matrix;return[a*c.a-b*c.b+c.tx,a*c.c-b*c.d-c.ty]};w.to=function(a,b){var c=w.drawingstate.matrix,d=a-c.tx,
e=b+c.ty;return[(d*c.d-e*c.b)/c.det,-(-d*c.c+e*c.a)/c.det,1]};w.dumpTrafo=function(){function a(a){return Math.round(1E3*a)/1E3}var b=w.drawingstate.matrix;console.log("a:"+a(b.a)+" b:"+a(b.b)+" c:"+a(b.c)+" d:"+a(b.d)+" tx:"+a(b.ty)+" ty:"+a(b.tx))};w.setMat=function(a,b,c,d,e,f){var g=w.drawingstate.matrix;g.a=a;g.b=b;g.c=c;g.d=d;g.tx=e;g.ty=f;g.det=a*d-b*c;g.sdet=Math.sqrt(g.det)};w.scaleAndOrigin=function(a,b,c){w.setMat(a,0,0,a,b,c)};w.visibleRect=function(a,b,c,d){var e=c-a,f=b-d,e=fa*f<V*e?
fa/e:V/f;w.setMat(e,0,0,e,(fa-e*(a+c))/2,(V-e*(b+d))/2)};w.applyMat=function(a,b,c,d,e,f){var g=w.drawingstate.matrix;w.setMat(g.a*a+g.c*b,g.b*a+g.d*b,g.a*c+g.c*d,g.b*c+g.d*d,g.a*e+g.c*f+g.tx,g.b*e+g.d*f+g.ty);a=w.to(0,-V);b=w.to(fa,0);console.log("{visibleRect: ["+a[0]+","+a[1]+","+b[0]+","+b[1]+"]}")};w.translate=function(a,b){w.applyMat(1,0,0,1,a,b)};w.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);w.applyMat(b,a,-a,b,0,0)};w.scale=function(a){w.applyMat(a,0,0,a,0,0)};w.gsave=function(){Ga.stack.push(w.clone(w.drawingstate))};
w.grestore=function(){0!==Ga.stack.length&&(w.drawingstate=Ga.stack.pop())};w.greset=function(){w.drawingstate=w.clone(Ga.backup);w.drawingstate.matrix.ty-=V;w.drawingstate.initialmatrix.ty-=V;Ga.stack=[]};w.createnewbackup=function(){w.drawingstate.initialmatrix.a=w.drawingstate.matrix.a;w.drawingstate.initialmatrix.b=w.drawingstate.matrix.b;w.drawingstate.initialmatrix.c=w.drawingstate.matrix.c;w.drawingstate.initialmatrix.d=w.drawingstate.matrix.d;w.drawingstate.initialmatrix.tx=w.drawingstate.matrix.tx;
w.drawingstate.initialmatrix.ty=w.drawingstate.matrix.ty;w.drawingstate.initialmatrix.det=w.drawingstate.matrix.det;w.drawingstate.initialmatrix.sdet=w.drawingstate.matrix.sdet;Ga.backup=w.clone(w.drawingstate)};w.makecolor=function(a,b,c){a=Math.floor(255*a);b=Math.floor(255*b);c=Math.floor(255*c);return 1===w.drawingstate.alpha?"rgb("+a+","+b+","+c+")":"rgba("+a+","+b+","+c+","+w.drawingstate.alpha+")"};w.setcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;
w.drawingstate.linecolor=w.drawingstate.pointcolor=w.makecolor(b,c,a);w.drawingstate.linecolorraw=w.drawingstate.pointcolorraw=[b,c,a]};w.setlinecolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;w.drawingstate.linecolor=w.makecolor(b,c,a);w.drawingstate.linecolorraw=[b,c,a]};w.settextcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;w.drawingstate.textcolor=w.makecolor(b,c,a);w.drawingstate.textcolorraw=[b,c,a]};
w.setpointcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;w.drawingstate.pointcolor=w.makecolor(b,c,a);w.drawingstate.pointcolorraw=[b,c,a]};w.setalpha=function(a){w.drawingstate.alpha=a.value.real;w.drawingstate.linecolor=w.makecolor(w.drawingstate.linecolorraw[0],w.drawingstate.linecolorraw[1],w.drawingstate.linecolorraw[2]);w.drawingstate.pointcolor=w.makecolor(w.drawingstate.pointcolorraw[0],w.drawingstate.pointcolorraw[1],w.drawingstate.pointcolorraw[2]);
w.drawingstate.textcolor=w.makecolor(w.drawingstate.textcolorraw[0],w.drawingstate.textcolorraw[1],w.drawingstate.textcolorraw[2])};w.setpointsize=function(a){w.drawingstate.pointsize=a.value.real};w.setlinesize=function(a){w.drawingstate.linesize=a.value.real};w.settextsize=function(a){w.drawingstate.textsize=a.value.real};var ra={clip:"none",pointColor:[1,0,0],lineColor:[0,0,1],pointSize:5,lineSize:1,alpha:1,overhangLine:1.1,overhangSeg:1,dimDependent:.7,fontFamily:"sans-serif"};q.defaultAppearance&&
od(q.defaultAppearance);var Qb={},Jc={UL:0,UR:1,LR:2,LL:3},Ob=["in","out","good","backup"],Pa=new Float64Array(0),Ma={};Ob.forEach(function(a){Ma[a]=Pa});var ba=Pa,wa=Pa,ta=Pa,ia,pa,Qa,xa,cb,Rb=!1,Lc={toString:function(){return"RefineException"}},G=null;q.enableTraceLog&&(G={logLength:Infinity,fullLog:[],currentMouseAndScripts:null,currentMover:null,currentStep:null,currentElement:null,currentParam:null,labelTracing2:v.wrap("tracing2"),labelTracing4:v.wrap("tracing4"),labelTracingSesq:v.wrap("tracingSesq"),
postMouseHooks:[]},"number"===typeof q.enableTraceLog&&(G.logLength=q.enableTraceLog),ma.getTraceLog=qd,ma.formatTraceLog=rd,ma.addTraceHook=G.postMouseHooks.push.bind(G.postMouseHooks));Fa.stateSize=12;Tb.stateSize=24;var Sa=[];Ra.P=function(a){L.forEach(function(b){b=Qc(a,b);b.holds()&&Sa.push(b)});Z.forEach(function(b){b=Rc(a,b);b.holds()&&Sa.push(b)})};Ra.L=function(a){I.forEach(function(b){b=Qc(b,a);b.holds()&&Sa.push(b)})};Ra.S=Ra.L;Ra.C=function(a){I.forEach(function(b){b=Rc(b,a);b.holds()&&
Sa.push(b)})};var p={_helper:{},RandomLine:{}};p.RandomLine.kind="L";p.RandomLine.signature=[];p.RandomLine.updatePosition=function(a){a.homog=f.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);a.homog=f.normalizeMax(a.homog);a.homog=v.withUsage(a.homog,"Line")};p.FreeLine={};p.FreeLine.kind="L";p.FreeLine.signature=[];p.FreeLine.isMovable=!0;p.FreeLine.initialize=function(a){a=p._helper.initializeLine(a);P(a)};p.FreeLine.getParamForInput=function(a,b,c){"mouse"===c?(a=f.cross(b,f.ez),
a=f.cross(a,b)):a="homog"===c?b:f.turnIntoCSList([l.zero,l.zero,l.zero]);return f.normalizeMax(a)};p.FreeLine.getParamFromState=function(a){return U(3)};p.FreeLine.putParamToState=function(a,b){P(b)};p.FreeLine.updatePosition=function(a){var b=U(3);P(b);a.homog=v.withUsage(b,"Line")};p.FreeLine.stateSize=6;p.RandomPoint={};p.RandomPoint.kind="P";p.RandomPoint.signature=[];p.RandomPoint.updatePosition=function(a){a.homog=f.realVector([100*Math.random(),100*Math.random(),100*Math.random()]);a.homog=
f.normalizeMax(a.homog);a.homog=v.withUsage(a.homog,"Point")};p.Join={};p.Join.kind="L";p.Join.signature=["P","P"];p.Join.updatePosition=function(a){a.homog=f.cross(n[a.args[0]].homog,n[a.args[1]].homog);a.homog=f.normalizeMax(a.homog);a.homog=v.withUsage(a.homog,"Line")};p.Segment={};p.Segment.kind="S";p.Segment.signature=["P","P"];p.Segment.updatePosition=function(a){var b=n[a.args[0]],c=n[a.args[1]];a.homog=f.cross(b.homog,c.homog);a.homog=f.normalizeMax(a.homog);a.homog=v.withUsage(a.homog,"Line");
a.startpos=b.homog;a.endpos=c.homog;a.farpoint=f.cross(a.homog,f.linfty)};p.Meet={};p.Meet.kind="P";p.Meet.signature=["L","L"];p.Meet.updatePosition=function(a){a.homog=f.cross(n[a.args[0]].homog,n[a.args[1]].homog);a.homog=f.normalizeMax(a.homog);a.homog=v.withUsage(a.homog,"Point")};p.Meet.visiblecheck=function(a){var b=!0,c=n[a.args[0]],d=n[a.args[1]];"S"===c.kind&&(b=Ic(a,c));b&&"S"===d.kind&&(b=Ic(a,d));a.isshowing=b};p._helper.midpoint=function(a,b){return f.normalizeMax(f.add(f.scalmult(b.value[2],
a),f.scalmult(a.value[2],b)))};p.Mid={};p.Mid.kind="P";p.Mid.signature=["P","P"];p.Mid.updatePosition=function(a){var b=p._helper.midpoint(n[a.args[0]].homog,n[a.args[1]].homog);a.homog=v.withUsage(b,"Point")};p.Perp={};p.Perp.kind="L";p.Perp.signature=["L","P"];p.Perp.updatePosition=function(a){var b=n[a.args[0]].homog,c=n[a.args[1]].homog,b=f.turnIntoCSList([b.value[0],b.value[1],l.zero]);a.homog=f.cross(b,c);a.homog=f.normalizeMax(a.homog);a.homog=v.withUsage(a.homog,"Line")};p.Para={};p.Para.kind=
"L";p.Para.signature=["L","P"];p.Para.updatePosition=function(a){var b=n[a.args[1]].homog;a.homog=f.cross(f.cross(f.linfty,n[a.args[0]].homog),b);a.homog=f.normalizeMax(a.homog);a.homog=v.withUsage(a.homog,"Line")};p.Horizontal={};p.Horizontal.kind="L";p.Horizontal.signature=["P"];p.Horizontal.updatePosition=function(a){a.homog=f.cross(f.ex,n[a.args[0]].homog);a.homog=f.normalizeMax(a.homog);a.homog=v.withUsage(a.homog,"Line")};p.HorizontalLine={};p.HorizontalLine.kind="L";p.HorizontalLine.signature=
[];p.HorizontalLine.isMovable=!0;p.HorizontalLine.initialize=function(a){a=p._helper.initializeLine(a);a=f.turnIntoCSList([l.zero,a.value[1],a.value[2]]);a=f.normalizeMax(a);P(a)};p.HorizontalLine.getParamForInput=function(a,b,c){if("mouse"===c)b=f.cross(b,f.ex);else if("homog"===c){if(0!==b.value[0].real||0!==b.value[0].imag)b=f.turnIntoCSList([l.zero,b.value[1],b.value[2]])}else b=f.turnIntoCSList([l.zero,l.zero,l.zero]);return f.normalizeMax(b)};p.HorizontalLine.getParamFromState=function(a){return U(3)};
p.HorizontalLine.putParamToState=function(a,b){P(b)};p.HorizontalLine.updatePosition=function(a){var b=U(3);P(b);a.homog=v.withUsage(b,"Line")};p.HorizontalLine.stateSize=6;p.Vertical={};p.Vertical.kind="L";p.Vertical.signature=["P"];p.Vertical.updatePosition=function(a){a.homog=f.cross(f.ey,n[a.args[0]].homog);a.homog=f.normalizeMax(a.homog);a.homog=v.withUsage(a.homog,"Line")};p.VerticalLine={};p.VerticalLine.kind="L";p.VerticalLine.signature=[];p.VerticalLine.isMovable=!0;p.VerticalLine.initialize=
function(a){a=p._helper.initializeLine(a);a=f.turnIntoCSList([a.value[0],l.zero,a.value[2]]);a=f.normalizeMax(a);P(a)};p.VerticalLine.getParamForInput=function(a,b,c){if("mouse"===c)b=f.cross(b,f.ey);else if("homog"===c){if(0!==b.value[1].real||0!==b.value[1].imag)b=f.turnIntoCSList([b.value[0],l.zero,b.value[2]])}else b=f.turnIntoCSList([l.zero,l.zero,l.zero]);return f.normalizeMax(b)};p.VerticalLine.getParamFromState=function(a){return U(3)};p.VerticalLine.putParamToState=function(a,b){P(b)};p.VerticalLine.updatePosition=
function(a){var b=U(3);P(b);a.homog=v.withUsage(b,"Line")};p.VerticalLine.stateSize=6;p.LineByFixedAngle={};p.LineByFixedAngle.kind="L";p.LineByFixedAngle.signature=["L","P"];p.LineByFixedAngle.initialize=function(a){var b=l._helper.input(a.angle),c=l.cos(b),b=l.sin(b);a.rot=f.turnIntoCSList([f.turnIntoCSList([b,c,l.zero]),f.turnIntoCSList([l.neg(c),b,l.zero]),f.turnIntoCSList([l.zero,l.zero,l.zero])])};p.LineByFixedAngle.updatePosition=function(a){var b=n[a.args[1]],c=f.productMV(a.rot,n[a.args[0]].homog);
a.homog=f.cross(b.homog,c);a.homog=f.normalizeMax(a.homog);a.homog=v.withUsage(a.homog,"Line")};p.Through={};p.Through.kind="L";p.Through.signature=["P"];p.Through.isMovable=!0;p.Through.initialize=function(a){a=a.dir?v.wrap(a.dir):f.realVector([a.pos[1],-a.pos[0],0]);P(a)};p.Through.getParamForInput=function(a,b,c){a="dir"===c||"mouse"===c?f.cross(n[a.args[0]].homog,b):"homog"===c?b:f.turnIntoCSList([l.zero,l.zero,l.zero]);a=f.cross(f.linfty,a);return f.normalizeMax(a)};p.Through.getParamFromState=
function(a){return U(3)};p.Through.putParamToState=function(a,b){P(b)};p.Through.updatePosition=function(a){var b=U(3);P(b);b=f.cross(n[a.args[0]].homog,b);b=f.normalizeMax(b);a.homog=v.withUsage(b,"Line")};p.Through.stateSize=6;p.Free={};p.Free.kind="P";p.Free.signature=[];p.Free.isMovable=!0;p.Free.initialize=function(a){a=p._helper.initializePoint(a);P(a)};p.Free.getParamForInput=function(a,b,c){if("mouse"===c&&hc&&0!==La){b=f.normalizeZ(b);a=b.value[0].value.real;c=b.value[1].value.real;var d=
Math.round(a/La)*La,e=Math.round(c/La)*La;.2>Math.abs(d-a)&&.2>Math.abs(e-c)&&(b=f.realVector([d,e,1]))}return f.normalizeMax(b)};p.Free.getParamFromState=function(a){return U(3)};p.Free.putParamToState=function(a,b){P(b)};p.Free.updatePosition=function(a){var b=U(3);P(b);a.homog=v.withUsage(b,"Point")};p.Free.stateSize=6;p._helper.projectPointToLine=function(a,b){var c=f.turnIntoCSList([b.value[0],b.value[1],l.zero]),c=f.cross(c,a);return f.normalizeMax(f.cross(c,b))};p.PointOnLine={};p.PointOnLine.kind=
"P";p.PointOnLine.signature=["L"];p.PointOnLine.isMovable=!0;p.PointOnLine.initialize=function(a){var b=p._helper.initializePoint(a);a=n[a.args[0]].homog;var b=p._helper.projectPointToLine(b,a),b=f.normalizeMax(b),c=f.cross(f.linfty,b);f.normalizeMax(c);P(b);P(a);Qa=!1};p.PointOnLine.updatePosition=function(a,b){var c,d=n[a.args[0]].homog;c=U(3);U(3);if(!b){ia=a.stateIdx;var e=ba;ba=ta;var g=U(3),h=U(3);ba=e;e=f.cross(h,d);f._helper.isAlmostZero(e)&&(e=f.cross(f.linfty,d));g=p._helper.CircleMP(e,
g);g=p._helper.IntersectLC(d,g);e=p._helper.pointReflection(e,c);c=Nc(g[0],g[1],c,e)[0]}c=f.normalizeMax(c);P(c);P(d);a.homog=v.withUsage(c,"Point")};p.PointOnLine.getParamForInput=function(a,b,c){return b=p._helper.projectPointToLine(b,n[a.args[0]].homog)};p.PointOnLine.getParamFromState=function(a){return U(3)};p.PointOnLine.putParamToState=function(a,b){return P(b)};p.PointOnLine.stateSize=12;p.PointOnCircle={};p.PointOnCircle.kind="P";p.PointOnCircle.signature=["C"];p.PointOnCircle.isMovable=
!0;p.PointOnCircle.initialize=function(a){var b=n[a.args[0]];a=f.normalizeZ(p._helper.initializePoint(a));var c=f.normalizeZ(p._helper.CenterOfConic(b.matrix)),d=f.sub(a,c),d=f.turnIntoCSList([d.value[1],l.neg(d.value[0]),l.zero]),c=f.cross(a,c),b=p._helper.IntersectLC(c,b.matrix),c=f.projectiveDistMinScal(a,b[0]);f.projectiveDistMinScal(a,b[1])<c?(a=b[1],b=b[0]):(a=b[0],b=b[1]);P(d);P(a);P(b);Qa=!1};p.PointOnCircle.putParamToState=function(a,b){P(b)};p.PointOnCircle.getParamFromState=function(a){return U(3)};
p.PointOnCircle.getParamForInput=function(a,b,c){c=f.normalizeZ(p._helper.CenterOfConic(n[a.args[0]].matrix));b=f.sub(b,c);ia=a.stateIdx;a=U(3);var d=f.normalizeZ(U(3));c=f.sub(d,c);0>l.sub(l.mult(a.value[0],c.value[1]),l.mult(a.value[1],c.value[0])).value.real&&(b=f.neg(b));return f.turnIntoCSList([b.value[1],l.neg(b.value[0]),l.zero])};p.PointOnCircle.parameterPath=function(a,b,c,d,e){d=f.normalizeAbs(d);e=f.normalizeAbs(e);var g=f.scalproduct(d,e);if(0<=g.value.real)return Mc(a,b,c,d,e);a=f.turnIntoCSList([l.sub(d.value[1],
e.value[1]),l.sub(e.value[0],d.value[0]),l.zero]);g=f.scalproduct(d,a);0>g.value.real&&(a=f.neg(a));0>b?(b=2*b+1,c=b*b,g=.25/(1+c),c=l.complex(2*b*g+.25,(1-c)*g)):(b=2*b-1,c=b*b,g=.25/(1+c),c=l.complex(2*b*g+.75,(1-c)*g));var h=l.sub(l.real(1),c);b=l.mult(c,c);g=l.mult(h,h);c=l.mult(c,h);d=f.scalmult(g,d);d=f.add(d,f.scalmult(c,a));return d=f.add(d,f.scalmult(b,e))};p.PointOnCircle.updatePosition=function(a){var b=U(3);P(b);var c=n[a.args[0]],b=f.productMV(c.matrix,b),c=p._helper.IntersectLC(b,c.matrix),
c=Fa(c[0],c[1]),b=f.normalizeMax(c.value[0]);a.homog=v.withUsage(b,"Point");a.antipodalPoint=c.value[1]};p.PointOnCircle.stateSize=6+Fa.stateSize;p.OtherPointOnCircle={};p.OtherPointOnCircle.kind="P";p.OtherPointOnCircle.signature=["P"];p.OtherPointOnCircle.signatureConstraints=function(a){return"PointOnCircle"===n[a.args[0]].type};p.OtherPointOnCircle.updatePosition=function(a){var b=n[a.args[0]].antipodalPoint,b=f.normalizeMax(b);a.homog=v.withUsage(b,"Point")};p.PointOnSegment={};p.PointOnSegment.kind=
"P";p.PointOnSegment.signature=["S"];p.PointOnSegment.isMovable=!0;p.PointOnSegment.initialize=function(a){var b=p._helper.initializePoint(a);a=p.PointOnSegment.getParamForInput(a,b);Ea(a)};p.PointOnSegment.getParamForInput=function(a,b){var c=n[a.args[0]],d=c.homog,d=f.turnIntoCSList([d.value[0],d.value[1],l.zero]),c=f.crossratio3(c.farpoint,c.startpos,c.endpos,b,d);0>c.value.real&&(c=l.complex(0,c.value.imag));1<c.value.real&&(c=l.complex(1,c.value.imag));return c};p.PointOnSegment.getParamFromState=
function(a){return db()};p.PointOnSegment.putParamToState=function(a,b){Ea(b)};p.PointOnSegment.updatePosition=function(a){var b=db();Ea(b);var c=n[a.args[0]],d=f.scalmult(c.endpos.value[2],c.startpos),c=f.scalmult(c.startpos.value[2],c.endpos),c=f.sub(c,d),b=f.add(d,f.scalmult(b,c)),b=f.normalizeMax(b);a.homog=v.withUsage(b,"Point")};p.PointOnSegment.stateSize=2;p._helper.CenterOfConic=function(a){return v.mult(f.adjoint3(a),f.linfty)};p.CenterOfConic={};p.CenterOfConic.kind="P";p.CenterOfConic.signature=
["C"];p.CenterOfConic.updatePosition=function(a){var b=p._helper.CenterOfConic(n[a.args[0]].matrix);a.homog=b;a.homog=f.normalizeMax(a.homog);a.homog=v.withUsage(a.homog,"Point")};p._helper.CircleMP=function(a,b){var c=a.value[0],d=a.value[1],e=l.neg(a.value[2]),g=l.zero,c=f.turnIntoCSList([f.turnIntoCSList([e,g,c]),f.turnIntoCSList([g,e,d]),f.turnIntoCSList([c,d,g])]),e=v.mult(v.mult(b,c),b),d=v.mult(v.mult(b,f.fund),b),e=v.mult(e,f.fund),c=v.mult(d,c);return f.sub(e,c)};p.CircleMP={};p.CircleMP.kind=
"C";p.CircleMP.signature=["P","P"];p.CircleMP.updatePosition=function(a){a.matrix=p._helper.CircleMP(n[a.args[0]].homog,n[a.args[1]].homog);a.matrix=f.normalizeMax(a.matrix);a.matrix=v.withUsage(a.matrix,"Circle")};p.CircleMr={};p.CircleMr.kind="C";p.CircleMr.signature=["P"];p.CircleMr.isMovable=!0;p.CircleMr.initialize=function(a){Ea(l.real(a.radius))};p.CircleMr.getParamForInput=function(a,b,c){if("radius"===c)return b;a=n[a.args[0]].homog;a=f.normalizeZ(a);b=f.normalizeZ(b);b=f.sub(a,b);return b=
f.abs(b)};p.CircleMr.getParamFromState=function(a){return db()};p.CircleMr.putParamToState=function(a,b){Ea(b)};p.CircleMr.updatePosition=function(a){var b=db();Ea(b);var c=n[a.args[0]].homog,d=l.mult(c.value[2],b),d=l.mult(d,d);if(!l._helper.isFinite(d)&&!l._helper.isNaN(d))return f.fund;c=p._helper.ScaledCircleMrr(c,d);a.matrix=v.withUsage(c,"Circle");a.radius=b};p.CircleMr.stateSize=2;p._helper.ScaledCircleMrr=function(a,b){var c=a.value[0],d=a.value[1],e=l.neg(a.value[2]),e=f.scalmult(e,f.turnIntoCSList([c,
d,e])).value,c=f.turnIntoCSList([c,d]),c=l.sub(f.scalproduct(c,c),b),e=p._helper.buildConicMatrix([e[2],l.zero,e[2],e[0],e[1],c]);return f.normalizeMax(e)};p.Compass={};p.Compass.kind="C";p.Compass.signature=["P","P","P"];p.Compass.updatePosition=function(a){var b=n[a.args[0]].homog,c=n[a.args[1]].homog,d=n[a.args[2]].homog,e=b.value[2],g=c.value[2],h=d.value[2],b=f.scalmult(l.mult(g,h),b),c=f.scalmult(l.mult(e,h),c),d=f.scalmult(l.mult(e,g),d),b=f.sub(c,b),d=p._helper.ScaledCircleMrr(d,f.scalproduct(b,
b));a.matrix=v.withUsage(d,"Circle")};p._helper.getConicType=function(a){if(1E-16>l.abs(f.det(a)).value.real)return"degenerate";var b=l.mult(a.value[0].value[0],a.value[1].value[1]),b=l.sub(b,l.pow(a.value[0].value[1],l.real(2))),b=b.value.real;return 1E-16>Math.abs(b)?"parabola":1E-16<b?"ellipsoid":"hyperbola"};p._helper.ConicBy5=function(a,b,c,d,e,g){a=f.turnIntoCSList([f.cross(c,d)]);var h=f.turnIntoCSList([f.cross(b,e)]);b=f.turnIntoCSList([f.cross(b,c)]);d=f.turnIntoCSList([f.cross(d,e)]);return p._helper.conicFromTwoDegenerates(a,
h,b,d,g)};p._helper.conicFromTwoDegenerates=function(a,b,c,d,e){a=v.mult(f.transpose(b),a);c=v.mult(f.transpose(d),c);a=f.add(a,f.transpose(a));c=f.add(c,f.transpose(c));d=v.mult(v.mult(e,a),e);e=v.mult(v.mult(e,c),e);c=v.mult(d,c);e=v.mult(e,a);return f.sub(c,e)};p.ConicBy5={};p.ConicBy5.kind="C";p.ConicBy5.signature=["P","P","P","P","P"];p.ConicBy5.updatePosition=function(a){var b=p._helper.ConicBy5(a,n[a.args[0]].homog,n[a.args[1]].homog,n[a.args[2]].homog,n[a.args[3]].homog,n[a.args[4]].homog);
a.matrix=b;a.matrix=f.normalizeMax(a.matrix);a.matrix=v.withUsage(a.matrix,"Conic")};p._helper.buildConicMatrix=function(a){var b=a[1],c=a[2],d=a[3],e=a[4],g=a[5];return f.turnIntoCSList([f.turnIntoCSList([a[0],b,d]),f.turnIntoCSList([b,c,e]),f.turnIntoCSList([d,e,g])])};p._helper.splitDegenConic=function(a){var b=f.adjoint3(a),c=0,d,e,g=l.abs2(b.value[0].value[0]).value.real;for(d=1;3>d;d++)e=l.abs2(b.value[d].value[d]).value.real,e>g&&(c=d,g=e);d=l.sqrt(l.mult(l.real(-1),b.value[c].value[c]));if(1E-16>
l.abs2(d).value.real)return a=f.turnIntoCSList([l.zero,l.zero,l.zero]),[a,a];c=l.real(c+1);e=f.column(b,c);e=f.scaldiv(d,e);d=e.value[0];g=e.value[1];e=e.value[2];d=f.turnIntoCSList([f.turnIntoCSList([l.real(0),e,l.mult(l.real(-1),g)]),f.turnIntoCSList([l.mult(l.real(-1),e),l.real(0),d]),f.turnIntoCSList([g,l.mult(l.real(-1),d),l.real(0)])]);a=f.add(a,d);var h=0;for(d=g=b=0;3>d;d++)for(c=0;3>c;c++)e=l.abs2(a.value[d].value[c]).value.real,e>g&&(h=d,b=c,g=e);d=a.value[h];a=f.transpose(a);a=a.value[b];
d=f.normalizeMax(d);a=f.normalizeMax(a);d=v.withUsage(d,"Line");a=v.withUsage(a,"Line");return[d,a]};p.SelectConic={};p.SelectConic.kind="C";p.SelectConic.signature=["Cs"];p.SelectConic.initialize=function(a){if(void 0!==a.index)return a.index-1;var b=l._helper.input(a.pos.xx),c=l._helper.input(a.pos.yy),d=l._helper.input(a.pos.zz),e=l.realmult(.5,l._helper.input(a.pos.xy)),g=l.realmult(.5,l._helper.input(a.pos.xz)),h=l.realmult(.5,l._helper.input(a.pos.yz)),b=f.turnIntoCSList([f.turnIntoCSList([b,
e,g]),f.turnIntoCSList([e,c,h]),f.turnIntoCSList([g,h,d])]);a=n[a.args[0]].results;c=f.conicDist(b,a[0]);d=0;for(e=1;e<a.length;++e)g=f.conicDist(b,a[e]),g<c&&(c=g,d=e);return d};p.SelectConic.updatePosition=function(a){a.matrix=n[a.args[0]].results[a.param];a.matrix=f.normalizeMax(a.matrix);a.matrix=v.withUsage(a.matrix,"Conic")};p._helper.ConicBy4p1l=function(a,b,c,d,e,g){var h=f.cross(f.cross(b,d),g),m=f.cross(f.cross(c,e),g),n=f.cross(f.cross(b,c),g),q=f.cross(f.cross(d,e),g),r=f.realVector(w.to(100*
Math.random(),100*Math.random()));g=l.mult(f.det3(r,m,n),f.det3(r,m,q));g=l.sqrt(g);n=l.mult(f.det3(r,h,n),f.det3(r,h,q));n=l.sqrt(n);h=f.scalmult(g,h);n=f.scalmult(n,m);m=f.add(h,n);h=f.sub(h,n);m=p._helper.ConicBy5(a,b,c,d,e,m);a=p._helper.ConicBy5(a,b,c,d,e,h);return[m,a]};p.ConicBy4p1l={};p.ConicBy4p1l.kind="Cs";p.ConicBy4p1l.signature=["P","P","P","P","L"];p.ConicBy4p1l.updatePosition=function(a){var b=p._helper.ConicBy4p1l(a,n[a.args[0]].homog,n[a.args[1]].homog,n[a.args[2]].homog,n[a.args[3]].homog,
n[a.args[4]].homog);a.results=b};p._helper.ConicBy3p2l=function(a,b,c,d,e){function g(a,b,c,d){return l.sub(l.mult(a,d),l.mult(b,c))}var h=f.cross(a,b),m=f.cross(d,e);d=f.cross(d,h);e=f.cross(e,h);h=f.turnIntoCSList([d,e,m]);c=f.productVM(c,f.adjoint3(h));m=f.adjoint3(f.turnIntoCSList([f.scalmult(c.value[0],d),f.scalmult(c.value[1],e),f.scalmult(c.value[2],m)]));c=f.transpose(m);d=l.mult;e=f.productMV(c,a);a=e.value[0];e=e.value[1];h=f.productMV(c,b);b=h.value[0];var h=h.value[1],n=l.sqrt(d(a,e)),
p=l.sqrt(d(b,h)),q,r=Array(4);for(q=0;4>q;++q){var u=(q&2)-1,v=d(l.real(((q&1)<<1)-1),n),w=d(l.real(u),p),y=g(e,v,h,w),x=g(b,w,a,v),u=g(a,e,b,h),z=l.add(l.add(g(b,h,a,e),g(h,w,e,v)),g(w,b,v,a)),v=d(y,y),w=d(x,x),A=d(z,z),B=d(y,x),y=d(y,z),x=d(x,z),B=l.sub(B,d(l.real(.5),d(u,u))),u=f.turnIntoCSList([f.turnIntoCSList([v,B,y]),f.turnIntoCSList([B,w,x]),f.turnIntoCSList([y,x,A])]),u=f.productMM(m,f.productMM(u,c)),u=f.turnIntoCSList([u.value[0].value[0],u.value[0].value[1],u.value[0].value[2],u.value[1].value[1],
u.value[1].value[2],u.value[2].value[2]]);r[q]=u}return r};p.ConicBy3p2l={};p.ConicBy3p2l.kind="Cs";p.ConicBy3p2l.signature=["P","P","P","L","L"];p.ConicBy3p2l.updatePosition=function(a){for(var b=p._helper.ConicBy3p2l(n[a.args[0]].homog,n[a.args[1]].homog,n[a.args[2]].homog,n[a.args[3]].homog,n[a.args[4]].homog),b=Oc(b),c=Array(4),d=0;4>d;++d){var e=b[d].value;c[d]=f.turnIntoCSList([f.turnIntoCSList([e[0],e[1],e[2]]),f.turnIntoCSList([e[1],e[3],e[4]]),f.turnIntoCSList([e[2],e[4],e[5]])])}a.results=
c};p.ConicBy3p2l.stateSize=48;p.ConicBy2p3l={};p.ConicBy2p3l.kind="Cs";p.ConicBy2p3l.signature=["P","P","L","L","L"];p.ConicBy2p3l.updatePosition=function(a){for(var b=p._helper.ConicBy3p2l(n[a.args[2]].homog,n[a.args[3]].homog,n[a.args[4]].homog,n[a.args[0]].homog,n[a.args[1]].homog),b=Oc(b),c=Array(4),d=0;4>d;++d){var e=b[d].value,e=f.turnIntoCSList([f.turnIntoCSList([e[0],e[1],e[2]]),f.turnIntoCSList([e[1],e[3],e[4]]),f.turnIntoCSList([e[2],e[4],e[5]])]);c[d]=f.normalizeMax(f.adjoint3(e))}a.results=
c};p.ConicBy2p3l.stateSize=48;p.ConicBy1p4l={};p.ConicBy1p4l.kind="Cs";p.ConicBy1p4l.signature=["P","L","L","L","L"];p.ConicBy1p4l.updatePosition=function(a){var b=p._helper.ConicBy4p1l(a,n[a.args[1]].homog,n[a.args[2]].homog,n[a.args[3]].homog,n[a.args[4]].homog,n[a.args[0]].homog),c=b[0],b=b[1],c=f.adjoint3(c),b=f.adjoint3(b),b=[c,b];a.results=b};p.ConicParabolaPL={};p.ConicParabolaPL.kind="C";p.ConicParabolaPL.signature=["P","L"];p.ConicParabolaPL.updatePosition=function(a){var b=n[a.args[0]].homog.value,
c=n[a.args[1]].homog.value,d=l.mult,e=l.neg,g=l.add,h=l.sub,m=b[0],q=b[1],r=b[2],u=c[0],b=c[1],c=c[2],w=d(r,r),y=d(u,u),x=d(b,b),z=d(r,c),A=e(r),r=g(y,x),x=d(w,x),y=d(w,y),e=d(e(w),d(u,b)),u=d(A,g(d(m,r),d(z,u))),b=d(A,g(d(q,r),d(z,b))),d=h(d(g(d(m,m),d(q,q)),r),d(w,d(c,c))),d=p._helper.buildConicMatrix([x,e,y,u,b,d]),d=f.normalizeMax(d);a.matrix=v.withUsage(d,"Conic")};p.ConicBy2Foci1P={};p.ConicBy2Foci1P.kind="Cs";p.ConicBy2Foci1P.signature=["P","P","P"];p.ConicBy2Foci1P.updatePosition=function(a){var b=
n[a.args[0]].homog,c=n[a.args[1]].homog,d=n[a.args[2]].homog,e=f.ii,g=f.jj,h=f.normalizeMax(f.cross(b,d)),m=f.normalizeMax(f.cross(c,d)),q=f.normalizeMax(f.cross(d,e)),d=f.normalizeMax(f.cross(d,g)),m=p._helper.coHarmonic(q,d,h,m),h=f.normalizeMax(m[0]),m=f.normalizeMax(m[1]),e=f.turnIntoCSList([e]),q=f.turnIntoCSList([g]),d=f.turnIntoCSList([b]),r=f.turnIntoCSList([c]),g=p._helper.conicFromTwoDegenerates(e,q,d,r,h),g=f.normalizeMax(g),e=p._helper.conicFromTwoDegenerates(e,q,d,r,m),e=f.normalizeMax(e),
g=f.normalizeMax(f.adjoint3(g)),e=f.normalizeMax(f.adjoint3(e));"ellipsoid"!==p._helper.getConicType(g)&&(h=g,g=e,e=h);f.almostequals(b,c).value&&(b=l.real(3),e=f.zeromatrix(b,b));a.results=[g,e]};p._helper.coHarmonic=function(a,b,c,d){var e=f.realVector([100*Math.random(),100*Math.random(),1]),g=f.det3(e,c,a),h=f.det3(e,c,b);c=f.det3(e,d,a);d=f.det3(e,d,b);d=l.sqrt(l.mult(d,h));g=l.sqrt(l.mult(c,g));a=v.mult(a,d);g=v.mult(b,g);b=f.add(a,g);a=f.sub(a,g);return[b,a]};p.ConicInSquare={};p.ConicInSquare.kind=
"C";p.ConicInSquare.signature=["P","P","P","P"];p.ConicInSquare.updatePosition=function(a){var b=D.basismap(n[a.args[0]].homog,n[a.args[1]].homog,n[a.args[2]].homog,n[a.args[3]].homog),c=l.one,c=p._helper.buildConicMatrix([c,c,c,l.real(-3),c,c]),b=f.adjoint3(b),b=f.productMM(f.productMM(f.transpose(b),c),b),b=f.normalizeMax(b);a.matrix=v.withUsage(b,"Conic")};p.ConicBy5lines={};p.ConicBy5lines.kind="C";p.ConicBy5lines.signature=["L","L","L","L","L"];p.ConicBy5lines.updatePosition=function(a){var b=
p._helper.ConicBy5(a,n[a.args[0]].homog,n[a.args[1]].homog,n[a.args[2]].homog,n[a.args[3]].homog,n[a.args[4]].homog),b=f.adjoint3(b);a.matrix=b;a.matrix=f.normalizeMax(a.matrix);a.matrix=v.withUsage(a.matrix,"Conic")};p.ConicFromPrincipalDirections={};p.ConicFromPrincipalDirections.kind="C";p.ConicFromPrincipalDirections.signature=["P","P","P"];p.ConicFromPrincipalDirections.updatePosition=function(a){var b=n[a.args[0]].homog,c=n[a.args[1]].homog,d=n[a.args[2]].homog,e=p._helper.pointReflection(b,
c),g=f.cross(c,b),b=f.turnIntoCSList([g.value[0],g.value[1],l.zero]),g=f.turnIntoCSList([g]),c=f.turnIntoCSList([f.cross(c,b)]),e=f.turnIntoCSList([f.cross(e,b)]);a.matrix=p._helper.conicFromTwoDegenerates(g,g,c,e,d);a.matrix=f.normalizeMax(a.matrix);a.matrix=v.withUsage(a.matrix,"Conic")};p.CircleBy3={};p.CircleBy3.kind="C";p.CircleBy3.signature=["P","P","P"];p.CircleBy3.updatePosition=function(a){var b=p._helper.ConicBy5(a,n[a.args[0]].homog,n[a.args[1]].homog,f.ii,f.jj,n[a.args[2]].homog);a.matrix=
f.normalizeMax(b);a.matrix=v.withUsage(a.matrix,"Circle")};p.ArcBy3={};p.ArcBy3.kind="C";p.ArcBy3.signature=["P","P","P"];p.ArcBy3.updatePosition=function(a){p.CircleBy3.updatePosition(a);a.startPoint=n[a.args[0]].homog;a.viaPoint=n[a.args[1]].homog;a.endPoint=n[a.args[2]].homog};p.ArcBy3.initialize=function(a){a.startPoint=n[a.args[0]].homog;a.viaPoint=n[a.args[1]].homog;a.endPoint=n[a.args[2]].homog;a.isArc=!0};p.PolarOfPoint={};p.PolarOfPoint.kind="L";p.PolarOfPoint.signature=["P","C"];p.PolarOfPoint.updatePosition=
function(a){var b=v.mult(n[a.args[1]].matrix,n[a.args[0]].homog),b=f.normalizeMax(b);a.homog=v.withUsage(b,"Line")};p.PolarOfLine={};p.PolarOfLine.kind="P";p.PolarOfLine.signature=["L","C"];p.PolarOfLine.updatePosition=function(a){var b=n[a.args[0]],c=f.adjoint3(n[a.args[1]].matrix),b=v.mult(c,b.homog),b=f.normalizeMax(b);a.homog=v.withUsage(b,"Point")};p.AngleBisector={};p.AngleBisector.kind="Ls";p.AngleBisector.signature=["L","L","P"];p.AngleBisector.updatePosition=function(a){var b=n[a.args[0]].homog,
c=n[a.args[1]].homog,d=n[a.args[2]].homog,e=f.add,g=f.sub,h=f.abs,l=f.cross,m=f.scalmult,p=f.normalizeMax,q=f._helper.isAlmostZero,r=f.linfty,u=m(h(l(l(r,c),r)),b),b=m(h(l(l(r,b),r)),c),g=g(u,b),e=e(u,b);q(g)&&(g=l(l(l(r,e),r),d));q(e)&&(e=l(l(l(r,g),r),d));a.results=Fa(p(g),p(e))};p.AngleBisector.stateSize=Fa.stateSize;p._helper.IntersectLC=function(a,b){var c=l,d=f.crossOperator(a),e=f.transpose(d),e=v.mult(e,v.mult(b,d)),g=f.maxIndex(a,l.abs2),h,m,n,p;0===g?(g=e.value[1].value[1],h=e.value[1].value[2],
m=e.value[2].value[1],n=e.value[2].value[2],p=a.value[0]):1===g?(g=e.value[0].value[0],h=e.value[0].value[2],m=e.value[2].value[0],n=e.value[2].value[2],p=a.value[1]):(g=e.value[0].value[0],h=e.value[0].value[1],m=e.value[1].value[0],n=e.value[1].value[1],p=a.value[2]);c=c.div(c.sqrt(c.sub(c.mult(h,m),c.mult(g,n))),p);c=f.add(e,f.scalmult(c,d));g=f.maxIndex(c,f.abs2);d=c.value[g];d=f.normalizeMax(d);d=v.withUsage(d,"Point");c=f.transpose(c);g=f.maxIndex(c,f.abs2);c=c.value[g];c=f.normalizeMax(c);
c=v.withUsage(c,"Point");return[d,c]};p.IntersectLC={};p.IntersectLC.kind="Ps";p.IntersectLC.signature=["L","C"];p.IntersectLC.updatePosition=function(a){var b=p._helper.IntersectLC(n[a.args[0]].homog,n[a.args[1]].matrix);a.results=Fa(b[0],b[1])};p.IntersectLC.stateSize=Fa.stateSize;p.OtherIntersectionCL={};p.OtherIntersectionCL.kind="P";p.OtherIntersectionCL.signature=["C","L","P"];p.OtherIntersectionCL.updatePosition=function(a){var b=n[a.args[2]].homog,c=p._helper.IntersectLC(n[a.args[1]].homog,
n[a.args[0]].matrix),d=c[0],c=c[1],e=f.projectiveDistMinScal(d,b),b=f.projectiveDistMinScal(c,b);a.homog=e<b?c:d;a.homog=f.normalizeMax(a.homog);a.homog=v.withUsage(a.homog,"Point")};p.IntersectCirCir={};p.IntersectCirCir.kind="Ps";p.IntersectCirCir.signature=["C","C"];p.IntersectCirCir.updatePosition=function(a){var b=n[a.args[0]].matrix,c=n[a.args[1]].matrix,d=f.scalmult(c.value[0].value[0],b.value[2]),c=f.scalmult(b.value[0].value[0],c.value[2]),d=f.sub(d,c),d=f.turnIntoCSList([d.value[0],d.value[1],
l.realmult(.5,d.value[2])]),d=f.normalizeMax(d),b=p._helper.IntersectLC(d,b);a.results=Fa(b[0],b[1])};p.IntersectCirCir.stateSize=Fa.stateSize;p.OtherIntersectionCC={};p.OtherIntersectionCC.kind="P";p.OtherIntersectionCC.signature=["C","C","P"];p.OtherIntersectionCC.updatePosition=function(a){var b=n[a.args[0]].matrix,c=n[a.args[1]].matrix,d=n[a.args[2]].homog,e=f.scalmult(c.value[0].value[0],b.value[2]),c=f.scalmult(b.value[0].value[0],c.value[2]),e=f.sub(e,c),e=f.turnIntoCSList([e.value[0],e.value[1],
l.realmult(.5,e.value[2])]),e=f.normalizeMax(e),e=p._helper.IntersectLC(e,b),b=e[0],e=e[1],c=f.projectiveDistMinScal(b,d),d=f.projectiveDistMinScal(e,d);a.homog=c<d?e:b;a.homog=f.normalizeMax(a.homog);a.homog=v.withUsage(a.homog,"Point")};p._helper.IntersectConicConic=function(a,b){var c=a.value[0],d=a.value[1],e=a.value[2],g=b.value[0],h=b.value[1],m=b.value[2],n=f.det3(c,d,e),q=l.add(l.add(f.det3(c,d,m),f.det3(c,h,e)),f.det3(g,d,e)),c=l.add(l.add(f.det3(c,h,m),f.det3(g,d,m)),f.det3(g,h,e)),g=f.det3(g,
h,m),m=l.abs2(n).value.real,h=l.abs2(g).value.real;m<h&&(m=a,a=b,b=m,m=g,g=n,n=m,m=c,c=q,q=m,m=h);1E-24>m?(n=a,c=b):(q=l.solveCubic(n,q,c,g),c=l.abs2(l.sub(q[0],q[1])).value.real,g=l.abs2(l.sub(q[0],q[2])).value.real,h=l.abs2(l.sub(q[1],q[2])).value.real,c>g?(n=q[1],q=c>h?q[0]:q[2]):(n=q[2],q=g>h?q[0]:q[1]),n=f.add(f.scalmult(n,a),b),c=f.add(f.scalmult(q,a),b));q=p._helper.splitDegenConic(n);n=q[0];q=q[1];c=p._helper.splitDegenConic(c);h=c[0];g=c[1];c=f.cross(n,h);h=f.cross(q,h);n=f.cross(n,g);q=
f.cross(q,g);c=f.normalizeMax(c);h=f.normalizeMax(h);n=f.normalizeMax(n);q=f.normalizeMax(q);c=v.withUsage(c,"Point");h=v.withUsage(h,"Point");n=v.withUsage(n,"Point");q=v.withUsage(q,"Point");return[c,h,n,q]};p.IntersectConicConic={};p.IntersectConicConic.kind="Ps";p.IntersectConicConic.signature=["C","C"];p.IntersectConicConic.updatePosition=function(a){var b=p._helper.IntersectConicConic(n[a.args[0]].matrix,n[a.args[1]].matrix),b=Tb(b[0],b[1],b[2],b[3]);a.results=b};p.IntersectConicConic.stateSize=
Tb.stateSize;p.SelectP={};p.SelectP.kind="P";p.SelectP.signature=["Ps"];p.SelectP.initialize=function(a){if(void 0!==a.index)return a.index-1;var b=n[a.args[0]].results.value;a=p._helper.initializePoint(a);for(var c=f.projectiveDistMinScal(a,b[0]),d=0,e=1;e<b.length;++e){var g=f.projectiveDistMinScal(a,b[e]);g<c&&(c=g,d=e)}return d};p.SelectP.updatePosition=function(a){a.homog=n[a.args[0]].results.value[a.param]};p.SelectL={};p.SelectL.kind="L";p.SelectL.signature=["Ls"];p.SelectL.initialize=function(a){if(void 0!==
a.index)return a.index-1;var b=n[a.args[0]].results.value;a=p._helper.initializeLine(a);for(var c=f.projectiveDistMinScal(a,b[0]),d=0,e=1;e<b.length;++e){var g=f.projectiveDistMinScal(a,b[e]);g<c&&(c=g,d=e)}return d};p.SelectL.updatePosition=function(a){a.homog=n[a.args[0]].results.value[a.param];a.homog=v.withUsage(a.homog,"Line")};p._helper.moebiusStep=function(a,b,c){var d=l.add,e=l.sub,f=l.mult,g=a.value[0],h=a.value[1];a=a.value[2];var m=b.value[0],n=b.value[1];b=b.value[2];var p=c.value[0],
q=c.value[1],r=c.value[2];c=e(f(b,p),f(m,r));var u=e(f(b,q),f(n,r)),p=e(f(g,r),f(a,p)),q=e(f(h,r),f(a,q));return[e(f(g,c),f(h,u)),d(f(h,c),f(g,u)),f(a,c),f(a,u),e(f(m,p),f(n,q)),d(f(n,p),f(m,q)),f(b,p),f(b,q)]};p.TrMoebius={};p.TrMoebius.kind="Mt";p.TrMoebius.signature="PPPPPP".split("");p.TrMoebius.updatePosition=function(a){var b=l.neg,c=p._helper.moebiusStep(n[a.args[0]].homog,n[a.args[2]].homog,n[a.args[4]].homog),d=p._helper.moebiusStep(n[a.args[1]].homog,n[a.args[3]].homog,n[a.args[5]].homog),
d=f.normalizeMax(f.matrix([[d[0],b(d[1]),d[4],b(d[5])],[d[1],d[0],d[5],d[4]],[d[2],b(d[3]),d[6],b(d[7])],[d[3],d[2],d[7],d[6]]])),c=f.normalizeMax(f.matrix([[c[6],b(c[4])],[c[7],b(c[5])],[b(c[2]),c[0]],[b(c[3]),c[1]]])),e=f.productMM(d,c),c=e.value[0].value[0],d=e.value[1].value[0],g=e.value[0].value[1],h=e.value[1].value[1],m=e.value[2].value[0],q=e.value[3].value[0],r=e.value[2].value[1],e=e.value[3].value[1];a.mat1=f.normalizeMax(f.matrix([[b(m),q,b(r)],[q,m,e],[c,b(d),g]]));a.mat2=f.normalizeMax(f.matrix([[b(q),
b(m),b(e)],[b(m),q,b(r)],[d,c,h]]))};p.TrMoebiusP={};p.TrMoebiusP.kind="P";p.TrMoebiusP.signature=["Mt","P"];p.TrMoebiusP.updatePosition=function(a){var b=n[a.args[0]],c=n[a.args[1]].homog,d=f.productMV(b.mat1,c),b=f.productMV(b.mat2,c);a.homog=f.normalizeMax(f.cross(d,b));a.homog=v.withUsage(a.homog,"Point")};p._helper.TrMoebiusP=function(a,b){var c=f.productMV(b.mat1,a),d=f.productMV(b.mat2,a);return f.normalizeMax(f.cross(c,d))};p.TrMoebiusL={};p.TrMoebiusL.kind="C";p.TrMoebiusL.signature=["Mt",
"L"];p.TrMoebiusL.updatePosition=function(a){var b=n[a.args[0]],c=n[a.args[1]].homog,d=function(){var a=f.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);return f.normalizeMax(a)},e=f.cross(d(),c),g=f.cross(d(),c),c=f.cross(d(),c),e=p._helper.TrMoebiusP(e,b),g=p._helper.TrMoebiusP(g,b),b=p._helper.TrMoebiusP(c,b);a.matrix=f.normalizeMax(p._helper.ConicBy5(null,e,g,b,f.ii,f.jj));a.matrix=v.withUsage(a.matrix,"Circle")};p.TrMoebiusC={};p.TrMoebiusC.kind="C";p.TrMoebiusC.signature=["Mt",
"C"];p.TrMoebiusC.updatePosition=function(a){var b=n[a.args[0]],c=n[a.args[1]].matrix;if("Circle"!==c.usage)console.log("applying Moebius transform to conics is not implemented yet"),b=l.real(3),a.matrix=f.zeromatrix(b,b);else{var d=function(){var a=f.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);return f.normalizeMax(a)},e=p._helper.IntersectLC(d(),c),d=p._helper.IntersectLC(d(),c),c=e[1],d=d[1],e=p._helper.TrMoebiusP(e[0],b),c=p._helper.TrMoebiusP(c,b),b=p._helper.TrMoebiusP(d,
b);a.matrix=f.normalizeMax(p._helper.ConicBy5(null,e,c,b,f.ii,f.jj))}a.matrix=v.withUsage(a.matrix,"Circle")};p.TrMoebiusArc={};p.TrMoebiusArc.kind="C";p.TrMoebiusArc.signature=["Mt","C"];p.TrMoebiusArc.updatePosition=function(a){var b=n[a.args[0]],c=n[a.args[1]],d=c.viaPoint,e=c.endPoint,c=p._helper.TrMoebiusP(c.startPoint,b),d=p._helper.TrMoebiusP(d,b),b=p._helper.TrMoebiusP(e,b);a.startPoint=c;a.viaPoint=d;a.endPoint=b;a.isArc=!0;a.matrix=f.normalizeMax(p._helper.ConicBy5(null,c,d,b,f.ii,f.jj));
a.matrix=v.withUsage(a.matrix,"Circle")};p._helper.trBuildMatrix=function(a,b){var c=b(0),d=b(1),e=f.productMM(d,f.adjoint3(c));a.matrix=f.normalizeMax(e);e=f.transpose(f.productMM(c,f.adjoint3(d)));a.dualMatrix=f.normalizeMax(e)};p.TrProjection={};p.TrProjection.kind="Tr";p.TrProjection.signature="PPPPPPPP".split("");p.TrProjection.updatePosition=function(a){p._helper.trBuildMatrix(a,function(b){return D.basismap(n[a.args[0+b]].homog,n[a.args[2+b]].homog,n[a.args[4+b]].homog,n[a.args[6+b]].homog)})};
p.TrAffine={};p.TrAffine.kind="Tr";p.TrAffine.signature="PPPPPP".split("");p.TrAffine.updatePosition=function(a){var b=l.mult,c=f.scalmult,d=f.turnIntoCSList,e=f.transpose,g=f.normalizeMax,h=f.productMM,m=f.adjoint3,p=d([n[a.args[0]].homog,n[a.args[2]].homog,n[a.args[4]].homog]),q=d([n[a.args[1]].homog,n[a.args[3]].homog,n[a.args[5]].homog]),r=e(p),e=e(q),u=r.value[2].value,v=e.value[2].value,w=[b(u[0],v[2]),b(u[1],v[0]),b(u[2],v[1])],r=m(r).value;a.matrix=g(h(e,d([c(b(w[0],v[1]),r[0]),c(b(w[1],v[2]),
r[1]),c(b(w[2],v[0]),r[2])])));r=p.value;a.dualMatrix=g(h(m(q),d([c(b(u[2],w[1]),r[0]),c(b(u[0],w[2]),r[1]),c(b(u[1],w[0]),r[2])])))};p.TrSimilarity={};p.TrSimilarity.kind="Tr";p.TrSimilarity.signature=["P","P","P","P"];p.TrSimilarity.updatePosition=function(a){p._helper.trBuildMatrix(a,function(b){return D.basismap(n[a.args[0+b]].homog,n[a.args[2+b]].homog,f.ii,f.jj)})};p.TrTranslation={};p.TrTranslation.kind="Tr";p.TrTranslation.signature=["P","P"];p.TrTranslation.updatePosition=function(a){var b=
n[a.args[0]].homog,c=n[a.args[1]].homog,d=f.cross(b,c).value,b=l.mult(b.value[2],c.value[2]),c=f.turnIntoCSList,e=l.neg,g=l.zero,d=c([c([b,g,d[1]]),c([g,b,e(d[0])]),c([g,g,b])]),d=f.normalizeMax(d);a.matrix=d;b=e(d.value[0].value[0]);d=c([c([b,g,g]),c([g,b,g]),c([d.value[0].value[2],d.value[1].value[2],b])]);a.dualMatrix=d};p.TrReflectionP={};p.TrReflectionP.kind="Tr";p.TrReflectionP.signature=["P"];p.TrReflectionP.updatePosition=function(a){var b=n[a.args[0]].homog.value,c=l.realmult(-.5,b[2]),d=
l.zero,b=f.turnIntoCSList([f.turnIntoCSList([c,d,b[0]]),f.turnIntoCSList([d,c,b[1]]),f.turnIntoCSList([d,d,l.neg(c)])]),b=f.normalizeMax(b);a.matrix=b;a.dualMatrix=f.transpose(b)};p.TrReflectionL={};p.TrReflectionL.kind="Tr";p.TrReflectionL.signature=["L"];p.TrReflectionL.updatePosition=function(a){var b=l.mult,c=l.realmult,d=l.zero,e=n[a.args[0]].homog.value,g=e[0],h=e[1],e=e[2],m=b(g,g),p=b(h,h),q=c(-.5,l.sub(m,p)),r=b(g,h),b=f.turnIntoCSList([f.turnIntoCSList([l.neg(q),r,b(g,e)]),f.turnIntoCSList([r,
q,b(h,e)]),f.turnIntoCSList([d,d,c(-.5,l.add(m,p))])]),b=f.normalizeMax(b);a.matrix=b;a.dualMatrix=f.transpose(b)};p.TrReflectionS={};p.TrReflectionS.kind="Tr";p.TrReflectionS.signature=["S"];p.TrReflectionS.updatePosition=p.TrReflectionL.updatePosition;p.TrReflectionC={};p.TrReflectionC.kind="Rc";p.TrReflectionC.signature=["C"];p.TrReflectionC.updatePosition=function(a){var b=n[a.args[0]].matrix;if("Circle"!==b.usage)console.log("reflection in general conics is not defined"),a.sclRsq=l.zero,a.matrix=
f.fund;else{var c=l.add,d=l.mult,e=b.value[2].value,g=e[0],h=e[1],e=e[2],m=b.value[0].value[0];a.sclRsq=l.sub(c(d(g,g),d(h,h)),d(m,e))}a.dualMatrix=a.matrix=b};p._helper.ReflectC=function(a,b){var c=l.add,d=l.sub,e=l.mult,g=f.scalmult,h=a.matrix,m=h.value[0].value[0],n=h.value[2].value,p=n[1],q=n[2],r=b.value[0].value[0],u=b.value[2].value,w=u[1],y=u[2],c=d(l.realmult(2,c(e(n[0],u[0]),e(p,w))),c(e(m,y),e(r,q)));return v.withUsage(f.normalizeMax(f.sub(g(c,h),g(a.sclRsq,b))),"Circle")};p.ReflectCC=
{};p.ReflectCC.kind="C";p.ReflectCC.signature=["Rc","C"];p.ReflectCC.updatePosition=function(a){var b=n[a.args[1]];"Circle"!==b.matrix.usage?(console.log("reflecting general conics in circles is not defined"),a.matrix=v.withUsage(f.fund,"Circle")):a.matrix=p._helper.ReflectC(n[a.args[0]],b.matrix)};p.ReflectCL={};p.ReflectCL.kind="C";p.ReflectCL.signature=["Rc","L"];p.ReflectCL.updatePosition=function(a){var b=l.zero,c=n[a.args[1]].homog.value,b=p._helper.buildConicMatrix([b,b,b,c[0],c[1],l.realmult(2,
c[2])]);a.matrix=p._helper.ReflectC(n[a.args[0]],b)};p._helper.ReflectCP=function(a,b){var c=b.matrix,d=c.value[2].value,d=f.turnIntoCSList([d[0],d[1],l.neg(c.value[0].value[0])]),e=f.cross;return f.normalizeMax(e(f.productMV(c,a),e(d,a)))};p.ReflectCP={};p.ReflectCP.kind="P";p.ReflectCP.signature=["Rc","P"];p.ReflectCP.updatePosition=function(a){a.homog=v.withUsage(p._helper.ReflectCP(n[a.args[1]].homog,n[a.args[0]]),"Point")};p.ReflectCArc={};p.ReflectCArc.kind="C";p.ReflectCArc.signature=["Rc",
"C"];p.ReflectCArc.updatePosition=function(a){var b=n[a.args[0]],c=n[a.args[1]],d=c.viaPoint,e=c.endPoint,f=p._helper.ReflectCP(c.startPoint,b),d=p._helper.ReflectCP(d,b),e=p._helper.ReflectCP(e,b);a.startPoint=f;a.viaPoint=d;a.endPoint=e;a.isArc=!0;a.matrix=p._helper.ReflectC(b,c.matrix)};p.ReflectCS={};p.ReflectCS.kind="C";p.ReflectCS.signature=["Rc","S"];p.ReflectCS.updatePosition=function(a){var b=n[a.args[0]],c=n[a.args[1]],d=c.startpos,e=c.endpos,f=p._helper.midpoint(d,e),d=p._helper.ReflectCP(d,
b),f=p._helper.ReflectCP(f,b),e=p._helper.ReflectCP(e,b);a.startPoint=d;a.viaPoint=f;a.endPoint=e;a.isArc=!0;e=l.zero;c=c.homog.value;c=p._helper.buildConicMatrix([e,e,e,c[0],c[1],l.realmult(2,c[2])]);a.matrix=p._helper.ReflectC(b,c)};p.TrInverse={};p.TrInverse.kind="Tr";p.TrInverse.signature=["Tr"];p.TrInverse.updatePosition=function(a){var b=n[a.args[0]];a.dualMatrix=f.transpose(b.matrix);a.matrix=f.transpose(b.dualMatrix)};p.TransformC={};p.TransformC.kind="C";p.TransformC.signature=["Tr","C"];
p.TransformC.updatePosition=function(a){var b=n[a.args[0]].dualMatrix,b=f.productMM(f.productMM(b,n[a.args[1]].matrix),f.transpose(b)),b=f.normalizeMax(b);a.matrix=v.withUsage(b,"Conic")};p.TransformArc={};p.TransformArc.kind="C";p.TransformArc.signature=["Tr","C"];p.TransformArc.updatePosition=function(a){var b=n[a.args[0]].matrix,c=n[a.args[1]],d=c.viaPoint,e=c.endPoint,c=f.normalizeMax(f.productMV(b,c.startPoint)),d=f.normalizeMax(f.productMV(b,d)),b=f.normalizeMax(f.productMV(b,e));a.startPoint=
c;a.viaPoint=d;a.endPoint=b;a.isArc=!0;a.matrix=f.normalizeMax(p._helper.ConicBy5(null,c,d,b,f.ii,f.jj));a.matrix=v.withUsage(a.matrix,"Circle")};p.TransformP={};p.TransformP.kind="P";p.TransformP.signature=["Tr","P"];p.TransformP.updatePosition=function(a){a.homog=f.normalizeMax(f.productMV(n[a.args[0]].matrix,n[a.args[1]].homog));a.homog=v.withUsage(a.homog,"Point")};p.TransformL={};p.TransformL.kind="L";p.TransformL.signature=["Tr","L"];p.TransformL.updatePosition=function(a){a.homog=f.normalizeMax(f.productMV(n[a.args[0]].dualMatrix,
n[a.args[1]].homog));a.homog=v.withUsage(a.homog,"Line")};p.TransformS={};p.TransformS.kind="S";p.TransformS.signature=["Tr","S"];p.TransformS.updatePosition=function(a){var b=n[a.args[0]],c=n[a.args[1]];a.homog=f.normalizeMax(f.productMV(b.dualMatrix,c.homog));a.homog=v.withUsage(a.homog,"Line");a.startpos=f.normalizeMax(f.productMV(b.matrix,c.startpos));a.endpos=f.normalizeMax(f.productMV(b.matrix,c.endpos));a.farpoint=f.normalizeMax(f.productMV(b.matrix,c.farpoint))};p._helper.pointReflection=
function(a,b){return f.normalizeMax(f.sub(f.scalmult(l.realmult(2,b.value[2]),a),f.scalmult(a.value[2],b)))};p._helper.conicOtherIntersection=function(a,b,c){var d=f.productMV(a,c);a=f.scalproduct(c,d);d=f.scalproduct(b,d);d=l.realmult(-2,d);b=f.scalmult(a,b);c=f.scalmult(d,c);c=f.add(b,c);return c=f.normalizeMax(c)};p.Dist={};p.Dist.kind="V";p.Dist.signature=["P","P"];p.Dist.updatePosition=function(a){var b=n[a.args[1]].homog;a.value=f.abs(f.sub(f.normalizeZ(n[a.args[0]].homog),f.normalizeZ(b)))};
p.Angle={};p.Angle.kind="V";p.Angle.signature=["L","L","P"];p.Angle.initialize=function(a){void 0===a.angle&&(a.angle=.5*Math.PI);Ea(l._helper.input(a.angle))};p.Angle.updatePosition=function(a){var b=n[a.args[1]].homog,c=n[a.args[2]].homog,d=f.cross(n[a.args[0]].homog,f.linfty),b=f.cross(b,f.linfty),c=f.crossratio3(d,b,f.ii,f.jj,c),c=l.mult(l.complex(0,.5),l.log(c)),d=(db().value.real-c.value.real)/Math.PI,b=Math.round(d);!Qa&&.01<Math.abs(b-d)&&zb();c=l.complex(b*Math.PI+c.value.real,c.value.imag);
Ea(c);a.value=v.withUsage(c,"Angle")};p.Angle.stateSize=2;p.TextImpl={};p.TextImpl.kind="Text";p.TextImpl.signature=[];p.TextImpl.updatePosition=function(){};p.TextImpl.initialize=function(a){a.text=String(a.text);a.size=l.real(a.size?+a.size:ra.textsize);a.pos&&(a.pos=p._helper.initializePoint(a));a.dock&&(a.dock.offset=a.dock.offset&&2===a.dock.offset.length?f.realVector([+a.dock.offset[0],+a.dock.offset[1]]):f.realVector([0,0]))};p._helper.initializePoint=function(a){var b=0,c=0,d=0;if(a.pos){if("list"===
a.pos.ctype&&f.isNumberVector(a.pos))return a.pos;2===a.pos.length&&(b=a.pos[0],c=a.pos[1],d=1);3===a.pos.length&&(b=a.pos[0],c=a.pos[1],d=a.pos[2])}a=f.turnIntoCSList([l._helper.input(b),l._helper.input(c),l._helper.input(d)]);return a=f.normalizeMax(a)};p._helper.initializeLine=function(a){var b=0,c=0,d=0;if(a.pos){if("list"===a.pos.ctype&&f.isNumberVector(a.pos))return a.pos;3===a.pos.length&&(b=a.pos[0],c=a.pos[1],d=a.pos[2])}a=f.turnIntoCSList([l._helper.input(b),l._helper.input(c),l._helper.input(d)]);
return a=f.normalizeMax(a)};var pd={CircleMFixedr:function(a){a.pinned=!0;a.type="CircleMr";return[a]},CircleByFixedRadius:function(a){a.pinned=!0;a.type="CircleMr";return[a]},CircleByRadius:function(a){a.type="CircleMr";return[a]},IntersectionConicLine:function(a){a.args=[a.args[1],a.args[0]];a.type="IntersectLC";return[a]},IntersectionCircleCircle:function(a){a.type="IntersectCirCir";return[a]},IntersectionConicConic:function(a){a.type="IntersectConicConic";return[a]},FreePoint:function(a){a.type=
"Free";return[a]},Orthogonal:function(a){a.type="Perp";return[a]},Parallel:function(a){a.type="Para";return[a]},Pole:function(a){a.type="PolarOfLine";return[a]},Polar:function(a){a.type="PolarOfPoint";return[a]},Calculation:function(a){console.log("Calculation stripped from construction");return[]},Arc:function(a){a.type="ArcBy3";return[a]},EuclideanMid:function(a){a.type="Mid";return[a]},AngularBisector:function(a){a.type="AngleBisector";return[a]},angleBisector:function(a){var b={name:a.name+"_Intersection",
type:"Meet",args:a.args,visible:!1};a.type="AngleBisector";a.args=[a.args[0],a.args[1],b.name];return[b,a]},Transform:function(a){var b=n[a.args[1]],b={Tr:"Transform",Mt:"TrMoebius",Rc:"ReflectC"}[n[a.args[0]].kind]+(b.isArc?"Arc":b.kind);if(p.hasOwnProperty(b))return a.type=b,[a];console.log(b+" not implemented yet");return[]},TrReflection:function(a){var b="TrReflection"+n[a.args[0]].kind;if(p.hasOwnProperty(b))return a.type=b,[a];console.log(b+" not implemented yet");return[]},Text:function(a){a.type=
"TextImpl";a.args=[];return[a]}},wd="alpha angle args arrow arrowposition arrowshape arrowsides arrowsize clip color dashtype drawtrace filled labeled labelpos name overhang pinned printname radius size text_fontfamily textbold textitalics textsize tracedim tracelength traceskip tracing type visible".split(" ");ma.saveState=function(){return{geometry:xd()}};var na={},Xc,mb,Yc,Zc;Xc=[[],[.2],[.075,.225],[44/45,-56/15,32/9],[19372/6561,-25360/2187,64448/6561,-212/729],[9017/3168,-355/33,46732/5247,
49/176,-5103/18656],[35/384,0,500/1113,125/192,-2187/6784,11/84]];mb=[0,.2,.3,.8,8/9,1,1];Yc=[35/384,0,500/1113,125/192,-2187/6784,11/84,0];Zc=[5179/57600,0,7571/16695,.6140625,-92097/339200,187/2100,.025];var oa,W=[],Ub=[],Gb=!1;na.tick=function(){for(var a=0;a<K.env.accuracy;a++)na.tick1(K.env.deltat/K.env.accuracy),z(ea.simulationstep)};na.tick1=function(a){for(var b=a,c=0;0<a&&c<.999*a||0>a&&c>.999*a;)b=na.oneRKStep(b),c+=b,b=Math.min(2*b,a-c),b=Math.max(b,1E-16),na.restorePosition(),na.doCollisions(),
na.calculateForces(),na.moveToFinalPos();return!0};na.restorePosition=function(){oa.forEach(function(a){a=a.behavior;K[a.type].restorePos(a,9)})};na.doCollisions=function(){oa.forEach(function(a){a=a.behavior;K[a.type].doCollisions(a)})};na.calculateForces=function(){oa.forEach(function(a){a=a.behavior;K[a.type].calculateForces(a)})};na.moveToFinalPos=function(){oa.forEach(function(a){a=a.behavior;K[a.type].move(a)})};na.oneRKStep=function(a){for(var b=function(a){oa.forEach(function(b){b=b.behavior;
K[b.type].initRK(b,a);K[b.type].storePosition(b)})},c=function(a){oa.forEach(function(b){b=b.behavior;K[b.type].setToTimestep(b,mb[a])})},d=function(a){oa.forEach(function(b){b=b.behavior;K[b.type].proceedMotion(b,mb[a],a,Xc[a])})},e=function(){oa.forEach(function(a){a=a.behavior;K[a.type].resetForces(a)})},f=function(a){oa.forEach(function(b){b=b.behavior;K[b.type].calculateDelta(b,a)})},g=function(b){var c=0;oa.forEach(function(a){a=a.behavior;K[a.type].proceedMotion(a,mb[6],7,Yc);K[a.type].savePos(a,
8);K[a.type].proceedMotion(a,mb[6],7,Zc);K[a.type].savePos(a,9);c+=K[a.type].sqDist(a,8,9)});return c=Math.sqrt(c)/a},h=function(a){oa.forEach(function(a){a=a.behavior;K[a.type].recallPosition(a)})},l=!1;!l;){b(a);for(var m=0;7>m;m++)c(m),d(m),e(),na.calculateForces(),f(m);g(a)>K.env.errorbound&&a>K.env.lowestdeltat?(a/=K.env.slowdownfactor,h()):l=!0}return a};var K={Mass:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.mass&&(a.mass=1);"undefined"===typeof a.charge&&
(a.charge=0);"undefined"===typeof a.friction&&(a.friction=0);a.lnfrict=0;"undefined"===typeof a.limitspeed&&(a.limitspeed=!1);"undefined"===typeof a.fixed&&(a.fixed=!1);"undefined"===typeof a.radius&&(a.radius=1);a.internalmove=!1;a.fx=0;a.fy=0;a.fz=0;a.vx=a.vx||0;a.vy=a.vy||0;a.vz=a.vz||0;a.mtype=0;a.env=K.env;a.deltat=0;a.mx=0;a.my=0;a.mz=0;a.mvx=0;a.mvy=0;a.mvz=0;a.dx=[0,0,0,0,0,0,0,0,0,0];a.dy=[0,0,0,0,0,0,0,0,0,0];a.dz=[0,0,0,0,0,0,0,0,0,0];a.dvx=[0,0,0,0,0,0,0,0,0,0];a.dvy=[0,0,0,0,0,0,0,0,
0,0];a.dvz=[0,0,0,0,0,0,0,0,0,0];a.midx=0;a.midy=0;a.midz=0;a.lx=0;a.ly=0;a.lz=0},resetForces:function(a){a.fx=0;a.fy=0;a.fz=0},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){var c=D.extractPoint(a.el.homog);a.x=c.x;a.y=c.y;a.z=0;a.xo=a.x;a.yo=a.y;a.zo=a.z;a.vxo=a.vx;a.vyo=a.vy;a.vzo=a.vz;a.deltat=b;a.fx=0;a.fy=0;a.fz=0},setVelocity:function(a,b,c,d){d||(d=0);a.vx=b;a.vy=c;a.vz=d},move:function(a){a.pos=[a.x,a.y,1];a.internalmove=!0;ca&&S.down&&a.el===ca.mover||Ca(a.el,f.realVector(a.pos),
"homog");a.el.sx=a.x;a.el.sy=a.y;a.internalmove=!1},proceedMotion:function(a,b,c,d){if(!a.fixed)for(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz,b=0;b<c;b++)a.x+=d[b]*a.dx[b]*a.deltat,a.y+=d[b]*a.dy[b]*a.deltat,a.z+=d[b]*a.dz[b]*a.deltat,a.vx+=d[b]*a.dvx[b]*a.deltat,a.vy+=d[b]*a.dvy[b]*a.deltat,a.vz+=d[b]*a.dvz[b]*a.deltat},calculateForces:function(a){var b=Math.sqrt(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz);a.lnfrict=-Math.log((1-a.friction)*(1-a.env.friction)*(.1<b&&a.limitSpeed?.1/b:1));a.fx+=
-a.vx*a.lnfrict*a.mass;a.fy+=-a.vy*a.lnfrict*a.mass;a.fz+=-a.vz*a.lnfrict*a.mass},calculateDelta:function(a,b){a.dx[b]=a.vx;a.dy[b]=a.vy;a.dz[b]=a.vz;a.dvx[b]=a.fx/a.mass;a.dvy[b]=a.fy/a.mass;a.dvz[b]=a.fz/a.mass},savePos:function(a,b){a.dx[b]=a.x;a.dy[b]=a.y;a.dz[b]=a.z;a.dvx[b]=a.vx;a.dvy[b]=a.vy;a.dvz[b]=a.vz},restorePos:function(a,b){a.fixed||(a.x=a.dx[b],a.y=a.dy[b],a.z=a.dz[b],a.vx=a.dvx[b],a.vy=a.dvy[b],a.vz=a.dvz[b])},sqDist:function(a,b,c){var d=(a.dx[b]-a.dx[c])*(a.dx[b]-a.dx[c]),d=d+(a.dy[b]-
a.dy[c])*(a.dy[b]-a.dy[c]),d=d+(a.dz[b]-a.dz[c])*(a.dz[b]-a.dz[c]),d=d+(a.dvx[b]-a.dvx[c])*(a.dvx[b]-a.dvx[c]),d=d+(a.dvy[b]-a.dvy[c])*(a.dvy[b]-a.dvy[c]);return d+=(a.dvz[b]-a.dvz[c])*(a.dvz[b]-a.dvz[c])},kineticEnergy:function(a){return.5*a.mass*(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz)},storePosition:function(a){a.mx=a.x;a.my=a.y;a.mz=a.z;a.mvx=a.vx;a.mvy=a.vy;a.mvz=a.vz},recallPosition:function(a){a.fixed||(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz)},doCollisions:function(a){}},Sun:{init:function(a,
b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.mass&&(a.mass=10);"undefined"===typeof a.friction&&(a.friction=0);a.charge=0;a.x=0;a.y=0;a.z=0},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){var c=D.extractPoint(a.el.homog);a.x=c.x;a.y=c.y;a.z=0},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateDelta:function(a,b){},calculateForces:function(a){for(var b=a.x,c=a.y,d=a.z,e=0;e<W.length;e++){var f=
W[e],g=f.behavior.x,h=f.behavior.y,l=f.behavior.z,m=Math.sqrt((b-g)*(b-g)+(c-h)*(c-h)+(d-l)*(d-l)),h=(c-h)*a.mass*f.behavior.mass/(m*m*m),l=(d-l)*a.mass*f.behavior.mass/(m*m*m);f.behavior.fx+=(b-g)*a.mass*f.behavior.mass/(m*m*m)*f.behavior.mass;f.behavior.fy+=h*f.behavior.mass;f.behavior.fz+=l*f.behavior.mass}},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},
Gravity:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.strength&&(a.strength=1);a.namea=b.args[0];a.nameb=b.args[1];a.ma=n[a.namea];a.mb=n[a.nameb]},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateDelta:function(a,b){},calculateForces:function(a){var b=D.extractPoint(a.ma.homog),c=D.extractPoint(a.mb.homog),d=(c.x-b.x)*a.strength;
a=(c.y-b.y)*a.strength;for(b=0;b<W.length;b++)c=W[b],c.behavior.fx+=d*c.behavior.mass,c.behavior.fy+=a*c.behavior.mass,c.behavior.fz+=0*c.behavior.mass},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},Spring:{init:function(a,b){a.el=b;"undefined"===typeof a.strength&&(a.strength=1);"undefined"===typeof a.amplitude&&(a.amplitude=0);"undefined"===typeof a.phase&&
(a.phase=0);"undefined"===typeof a.speed&&(a.speed=1);"undefined"===typeof a.l0&&(a.l0=0);"undefined"===typeof a.stype&&(a.stype=1);"undefined"===typeof a.readOnInit&&(a.readOnInit=!1);a.namea=b.args[0];a.nameb=b.args[1];a.ma=n[a.namea];a.mb=n[a.nameb];var c=D.extractPoint(a.ma.homog),d=D.extractPoint(a.mb.homog);a.l0=Math.sqrt((c.x-d.x)*(c.x-d.x)+(c.y-d.y)*(c.y-d.y));a.env=K.env},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,
c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateForces:function(a){var b,c,d,e;!a.ma.behavior||ca&&S.down&&a.ma===ca.mover?(c=D.extractPoint(a.ma.homog),b=c.x,d=c.y):(b=a.ma.behavior.x,d=a.ma.behavior.y);!a.mb.behavior||ca&&S.down&&a.mb===ca.mover?(e=D.extractPoint(a.mb.homog),c=e.x,e=e.y):(c=a.mb.behavior.x,e=a.mb.behavior.y);var f=Math.sqrt((b-c)*(b-c)+(d-e)*(d-e)),g=a.l0,h=a.stype;1===h&&(g=0);var l=0;if(2===h||3===h)l=a.ma.behavior.mass*a.mb.behavior.mass*a.strength;2===h&&
(l=-l);var m,n;if(0===f||0!==h&&1!==h)if(a.ma.behavior&&a.mb.behavior&&0!==f){if(f*=f*f,2===h||3===h)m=(b-c)*l/f,n=(d-e)*l/f}else m=n=0;else m=-(b-c)*a.strength*(f-g)/f*a.env.springstrength,n=-(d-e)*a.strength*(f-g)/f*a.env.springstrength;a.ma.behavior&&(a.ma.behavior.fx+=m,a.ma.behavior.fy+=n);a.mb.behavior&&(a.mb.behavior.fx-=m,a.mb.behavior.fy-=n)},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},
recallPosition:function(a){},doCollisions:function(a){}},det:function(a,b,c,d,e,f){return c*f-e*d+e*b-a*f+a*d-c*b},Bouncer:{init:function(a,b){a.el=b;"undefined"===typeof a.xdamp&&(a.xdamp=0);"undefined"===typeof a.ydamp&&(a.ydamp=0);"undefined"===typeof a.motorchanger&&(a.motorchanger=!0);a.namea=b.args[0];a.nameb=b.args[1];a.ma=n[a.namea];a.mb=n[a.nameb];var c=D.extractPoint(a.ma.homog),d=D.extractPoint(a.mb.homog);a.x1o=1.01*c.x-.01*d.x;a.y1o=1.01*c.y-.01*d.y;a.x2o=1.01*d.x-.01*c.x;a.y2o=1.01*
d.y-.01*c.y;a.env=K.env},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){a.deltat=b},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateForces:function(a){},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){for(var b=D.extractPoint(a.ma.homog),
c=D.extractPoint(a.mb.homog),d=b.x,b=b.y,e=c.x,c=c.y,f=a.x1o,g=a.y1o,h=a.x2o,m=a.y2o,n=Math.sqrt((d-e)*(d-e)+(b-c)*(b-c)),p=(d-e)/n,n=(b-c)/n,q=0;q<W.length;q++){var r=W[q],u=r.behavior.xo,v=r.behavior.yo,w=r.behavior.x,y=r.behavior.y,x=l.mult(l.complex(f,g),l.complex(e,c)),z=l.mult(l.complex(h,m),l.complex(d,b)),x=l.sub(x,z),z=l.mult(l.complex(u,v),l.complex(d,b)),x=l.add(x,z),z=l.mult(l.complex(u,v),l.complex(e,c)),x=l.sub(x,z),z=l.sub(l.complex(f,g),l.complex(h,m)),x=l.div(x,z);0>K.det(d,b,e,c,
w,y)*K.det(d,b,e,c,x.value.real,x.value.imag)&&0>K.det(d,b,w,y,x.value.real,x.value.imag)*K.det(e,c,w,y,x.value.real,x.value.imag)&&(v=r.behavior.mvx+a.deltat*(-x.value.real+r.behavior.xo),w=r.behavior.mvy+a.deltat*(-x.value.imag+r.behavior.yo),u=p*v+n*w,v=n*v-p*w,r.behavior.x=x.value.real,r.behavior.y=x.value.imag,r.behavior.vx=p*u*(1-a.xdamp),r.behavior.vy=n*u*(1-a.xdamp),r.behavior.vx+=-n*v*(1-a.ydamp),r.behavior.vy+=p*v*(1-a.ydamp))}a.x1o=d;a.y1o=b;a.x2o=e;a.y2o=c}},Environment:{init:function(a){"undefined"===
typeof a.gravity&&(a.gravity=0);"undefined"===typeof a.friction&&(a.friction=0);"undefined"===typeof a.springstrength&&(a.springstrength=1);"undefined"===typeof a.accuracy&&(a.accuracy=10);"undefined"===typeof a.deltat&&(a.deltat=.3);"undefined"===typeof a.charges&&(a.charges=!1);"undefined"===typeof a.balls&&(a.balls=!1);"undefined"===typeof a.newton&&(a.newton=!1);"undefined"===typeof a.ballInteractionBoosting&&(a.ballInteractionBoosting=1);K.env=a;a.errorbound=.001;a.lowestdeltat=1E-7;a.slowdownfactor=
2},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateForces:function(a){var b,c,d,e,f,g,h,l,m,n;if(a.newton)for(b=0;b<W.length-1;b++)for(c=W[b],d=c.behavior.x,e=c.behavior.y,f=b+1;f<W.length;f++)g=W[f],h=g.behavior.x,l=g.behavior.y,n=Math.sqrt((d-h)*(d-h)+(e-l)*(e-l)),h=(d-h)*c.behavior.mass*g.behavior.mass/(n*n*n),l=(e-l)*c.behavior.mass*g.behavior.mass/(n*n*n),
c.behavior.fx-=h,c.behavior.fy-=l,g.behavior.fx+=h,g.behavior.fy+=l;if(a.charges)for(b=0;b<W.length-1;b++)for(c=W[b],d=c.behavior.x,e=c.behavior.y,f=b+1;f<W.length;f++)g=W[f],h=g.behavior.x,l=g.behavior.y,n=Math.sqrt((d-h)*(d-h)+(e-l)*(e-l)),h=(d-h)*c.behavior.charge*g.behavior.charge/(n*n*n),l=(e-l)*c.behavior.charge*g.behavior.charge/(n*n*n),c.behavior.fx+=h,c.behavior.fy+=l,g.behavior.fx-=h,g.behavior.fy-=l;if(a.balls)for(b=0;b<W.length-1;b++)if(c=W[b],0!==c.behavior.radius)for(d=c.behavior.x,
e=c.behavior.y,f=b+1;f<W.length;f++)g=W[f],0!==g.behavior.radius&&(h=g.behavior.x,l=g.behavior.y,m=c.behavior.radius+g.behavior.radius,n=Math.sqrt((d-h)*(d-h)+(e-l)*(e-l)),0===a.ballInteractionBoosting?(h=(d-h)/(n*n*n)*(n>m?0:(n-m)*(n-m)),l=(e-l)/(n*n*n)*(n>m?0:(n-m)*(n-m))):1===a.ballInteractionBoosting?(h=(d-h)/(n*n*n*n)*(n>m?0:(n-m)*(n-m)),l=(e-l)/(n*n*n*n)*(n>m?0:(n-m)*(n-m))):(h=(d-h)/(n*n*n*n*n)*(n>m?0:(n-m)*(n-m)),l=(e-l)/(n*n*n*n*n)*(n>m?0:(n-m)*(n-m))),c.behavior.fx+=h,c.behavior.fy+=l,g.behavior.fx-=
h,g.behavior.fy-=l);for(b=0;b<W.length;b++)c=W[b],c.behavior.fx+=0,c.behavior.fy+=a.gravity,c.behavior.fz+=0},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}}};return ma};return E}();
"undefined"!==typeof process&&"undefined"!==typeof module&&"undefined"!==typeof module.exports&&"undefined"===typeof window&&(module.exports=createCindy);
//# sourceMappingURL=Cindy.js.map

