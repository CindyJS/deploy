/* CindyJS - (C) 2014-2015  J. Richter-Gebert
 *
 */
'use strict';var numeric="undefined"===typeof exports?function(){}:exports;"undefined"!==typeof global&&(global.numeric=numeric);numeric.version="1.2.6";numeric.bench=function(a,b){var d,c,l;"undefined"===typeof b&&(b=15);l=.5;for(d=new Date;;){for(c=l*=2;3<c;c-=4)a(),a(),a(),a();for(;0<c;)a(),c--;c=new Date;if(c-d>b)break}for(c=l;3<c;c-=4)a(),a(),a(),a();for(;0<c;)a(),c--;c=new Date;return 1E3*(3*l-1)/(c-d)};
numeric._myIndexOf=function(a){var b=this.length,d;for(d=0;d<b;++d)if(this[d]===a)return d;return-1};numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf;numeric.Function=Function;numeric.precision=4;numeric.largeArray=50;
numeric.prettyPrint=function(a){function b(a){if(0===a)return"0";if(isNaN(a))return"NaN";if(0>a)return"-"+b(-a);if(isFinite(a)){var d=Math.floor(Math.log(a)/Math.log(10));a/=Math.pow(10,d);a=a.toPrecision(numeric.precision);10===parseFloat(a)&&(d++,a=(1).toPrecision(numeric.precision));return parseFloat(a).toString()+"e"+d.toString()}return"Infinity"}function d(a){var e;if("undefined"===typeof a)return c.push(Array(numeric.precision+8).join(" ")),!1;if("string"===typeof a)return c.push('"'+a+'"'),
!1;if("boolean"===typeof a)return c.push(a.toString()),!1;if("number"===typeof a){var h=b(a);e=a.toPrecision(numeric.precision);a=parseFloat(a.toString()).toString();a=[h,e,a,parseFloat(e).toString(),parseFloat(a).toString()];for(e=1;e<a.length;e++)a[e].length<h.length&&(h=a[e]);c.push(Array(numeric.precision+8-h.length).join(" ")+h);return!1}if(null===a)return c.push("null"),!1;if("function"===typeof a){c.push(a.toString());h=!1;for(e in a)a.hasOwnProperty(e)&&(h?c.push(",\n"):c.push("\n{"),h=!0,
c.push(e),c.push(": \n"),d(a[e]));h&&c.push("}\n");return!0}if(a instanceof Array){if(a.length>numeric.largeArray)return c.push("...Large Array..."),!0;h=!1;c.push("[");for(e=0;e<a.length;e++)0<e&&(c.push(","),h&&c.push("\n ")),h=d(a[e]);c.push("]");return!0}c.push("{");h=!1;for(e in a)a.hasOwnProperty(e)&&(h&&c.push(",\n"),h=!0,c.push(e),c.push(": \n"),d(a[e]));c.push("}");return!0}var c=[];d(a);return c.join("")};
numeric.parseDate=function(a){function b(a){if("string"===typeof a)return Date.parse(a.replace(/-/g,"/"));if(!(a instanceof Array))throw Error("parseDate: parameter must be arrays of strings");var c=[],l;for(l=0;l<a.length;l++)c[l]=b(a[l]);return c}return b(a)};numeric.parseFloat=function(a){function b(a){if("string"===typeof a)return parseFloat(a);if(!(a instanceof Array))throw Error("parseFloat: parameter must be arrays of strings");var c=[],l;for(l=0;l<a.length;l++)c[l]=b(a[l]);return c}return b(a)};
numeric.parseCSV=function(a){a=a.split("\n");var b,d,c=[],l=/(([^'",]*)|('[^']*')|("[^"]*")),/g,e=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,h=0;for(d=0;d<a.length;d++){var r=(a[d]+",").match(l),n;if(0<r.length){c[h]=[];for(b=0;b<r.length;b++)n=r[b],n=n.substr(0,n.length-1),e.test(n)?c[h][b]=parseFloat(n):c[h][b]=n;h++}}return c};
numeric.toCSV=function(a){var b,d,c,l,e;c=numeric.dim(a)[0];e=[];for(b=0;b<c;b++){l=[];for(d=0;d<c;d++)l[d]=a[b][d].toString();e[b]=l.join(", ")}return e.join("\n")+"\n"};numeric.getURL=function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.send();return b};
numeric.imageURL=function(a){function b(a,b,d){"undefined"===typeof b&&(b=0);"undefined"===typeof d&&(d=a.length);for(var c=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,
1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,
4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,
62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,
3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,
2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],e=-1,h=0;b<d;b++)h=(e^a[b])&255,e=e>>>8^c[h];return e^-1}var d=a[0].length,c=a[0][0].length,l,e,h,r,n,u,v=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,c>>
24&255,c>>16&255,c>>8&255,c&255,d>>24&255,d>>16&255,d>>8&255,d&255,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];l=b(v,12,29);v[29]=l>>24&255;v[30]=l>>16&255;v[31]=l>>8&255;v[32]=l&255;l=1;for(n=e=0;n<d;n++){n<d-1?v.push(0):v.push(1);r=3*c+1+(0===n)&255;h=3*c+1+(0===n)>>8&255;v.push(r);v.push(h);v.push(~r&255);v.push(~h&255);0===n&&v.push(0);for(u=0;u<c;u++)for(h=0;3>h;h++)r=a[h][n][u],r=255<r?255:0>r?0:Math.round(r),l=(l+r)%65521,e=(e+l)%65521,v.push(r);v.push(0)}a=(e<<16)+l;v.push(a>>24&255);
v.push(a>>16&255);v.push(a>>8&255);v.push(a&255);a=v.length-41;v[33]=a>>24&255;v[34]=a>>16&255;v[35]=a>>8&255;v[36]=a&255;l=b(v,37);v.push(l>>24&255);v.push(l>>16&255);v.push(l>>8&255);v.push(l&255);v.push(0);v.push(0);v.push(0);v.push(0);v.push(73);v.push(69);v.push(78);v.push(68);v.push(174);v.push(66);v.push(96);v.push(130);return"data:image/png;base64,"+function(a){var b=a.length,d,c,e,h,k,l="";for(d=0;d<b;d+=3)c=a[d],e=a[d+1],h=a[d+2],k=c>>2,c=((c&3)<<4)+(e>>4),e=((e&15)<<2)+(h>>6),h&=63,d+1>=
b?e=h=64:d+2>=b&&(h=64),l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h);return l}(v)};numeric._dim=function(a){for(var b=[];"object"===typeof a;)b.push(a.length),a=a[0];return b};
numeric.dim=function(a){var b,d;return"object"===typeof a?(b=a[0],"object"===typeof b?(d=b[0],"object"===typeof d?numeric._dim(a):[a.length,b.length]):[a.length]):[]};
numeric.mapreduce=function(a,b){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+b+';\nif(typeof x === "number") { var xi = x; '+a+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+a+";\n    xi = x[i-1];\n    "+
a+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+a+"\n}\nreturn accum;")};numeric.mapreduce2=function(a,b){return Function("x","var n = x.length;\nvar i,xi;\n"+b+";\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+a+";\n}\nreturn accum;")};numeric.same=function same(b,d){var c,l;if(!(b instanceof Array&&d instanceof Array))return!1;l=b.length;if(l!==d.length)return!1;for(c=0;c<l;c++)if(b[c]!==d[c])if("object"===typeof b[c]){if(!same(b[c],d[c]))return!1}else return!1;return!0};
numeric.rep=function(a,b,d){"undefined"===typeof d&&(d=0);var c=a[d],l=Array(c);if(d===a.length-1){for(c-=2;0<=c;c-=2)l[c+1]=b,l[c]=b;-1===c&&(l[0]=b);return l}for(--c;0<=c;c--)l[c]=numeric.rep(a,b,d+1);return l};numeric.dotMMsmall=function(a,b){var d,c,l,e,h,r,n,u,v,w;d=a.length;e=b.length;h=b[0].length;r=Array(d);for(--d;0<=d;d--){n=Array(h);u=a[d];for(l=h-1;0<=l;l--){v=u[e-1]*b[e-1][l];for(c=e-2;1<=c;c-=2)w=c-1,v+=u[c]*b[c][l]+u[w]*b[w][l];0===c&&(v+=u[0]*b[0][l]);n[l]=v}r[d]=n}return r};
numeric._getCol=function(a,b,d){var c;for(c=a.length-1;0<c;--c)d[c]=a[c][b],--c,d[c]=a[c][b];0===c&&(d[0]=a[0][b])};numeric.dotMMbig=function(a,b){var d=numeric._getCol,c=Array(b.length),l=a.length,e=b[0].length,h=Array(l),r=numeric.dotVV,n,u;--l;for(n=l;-1!==n;--n)h[n]=Array(e);--e;for(n=e;-1!==n;--n)for(d(b,n,c),u=l;-1!==u;--u)e=a[u],h[u][n]=r(e,c);return h};numeric.dotMV=function(a,b){for(var d=a.length,c=Array(d),l=numeric.dotVV,d=d-1;0<=d;d--)c[d]=l(a[d],b);return c};
numeric.dotVM=function(a,b){var d,c,l,e,h,r;l=a.length;d=b[0].length;e=Array(d);for(c=d-1;0<=c;c--){h=a[l-1]*b[l-1][c];for(d=l-2;1<=d;d-=2)r=d-1,h+=a[d]*b[d][c]+a[r]*b[r][c];0===d&&(h+=a[0]*b[0][c]);e[c]=h}return e};numeric.dotVV=function(a,b){var d;d=a.length;var c,l=a[d-1]*b[d-1];for(d-=2;1<=d;d-=2)c=d-1,l+=a[d]*b[d]+a[c]*b[c];0===d&&(l+=a[0]*b[0]);return l};
numeric.dot=function(a,b){var d=numeric.dim;switch(1E3*d(a).length+d(b).length){case 2002:return 10>b.length?numeric.dotMMsmall(a,b):numeric.dotMMbig(a,b);case 2001:return numeric.dotMV(a,b);case 1002:return numeric.dotVM(a,b);case 1001:return numeric.dotVV(a,b);case 1E3:return numeric.mulVS(a,b);case 1:return numeric.mulSV(a,b);case 0:return a*b;default:throw Error("numeric.dot only works on vectors and matrices");}};
numeric.diag=function(a){var b,d,c,l=a.length,e=Array(l),h;for(b=l-1;0<=b;b--){h=Array(l);d=b+2;for(c=l-1;c>=d;c-=2)h[c]=0,h[c-1]=0;c>b&&(h[c]=0);h[b]=a[b];for(c=b-1;1<=c;c-=2)h[c]=0,h[c-1]=0;0===c&&(h[0]=0);e[b]=h}return e};numeric.getDiag=function(a){for(var b=Math.min(a.length,a[0].length),d=Array(b),b=b-1;1<=b;--b)d[b]=a[b][b],--b,d[b]=a[b][b];0===b&&(d[0]=a[0][0]);return d};numeric.identity=function(a){return numeric.diag(numeric.rep([a],1))};
numeric.pointwise=function(a,b,d){"undefined"===typeof d&&(d="");var c=[],l,e=/\[i\]$/,h,r="",n=!1;for(l=0;l<a.length;l++)e.test(a[l])?r=h=a[l].substring(0,a[l].length-3):h=a[l],"ret"===h&&(n=!0),c.push(h);c[a.length]="_s";c[a.length+1]="_k";c[a.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+r+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(n?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+a.join(",")+",_s,_k+1);\n    return ret;\n}\n"+
d+"\nfor(i=_n-1;i!==-1;--i) {\n    "+b+"\n}\nreturn ret;";return Function.apply(null,c)};numeric.pointwise2=function(a,b,d){"undefined"===typeof d&&(d="");var c=[],l,e=/\[i\]$/,h,r="",n=!1;for(l=0;l<a.length;l++)e.test(a[l])?r=h=a[l].substring(0,a[l].length-3):h=a[l],"ret"===h&&(n=!0),c.push(h);c[a.length]="var _n = "+r+".length;\nvar i"+(n?"":", ret = Array(_n)")+";\n"+d+"\nfor(i=_n-1;i!==-1;--i) {\n"+b+"\n}\nreturn ret;";return Function.apply(null,c)};
numeric._biforeach=function _biforeach(b,d,c,l,e){if(l===c.length-1)e(b,d);else{var h;for(h=c[l]-1;0<=h;h--)_biforeach("object"===typeof b?b[h]:b,"object"===typeof d?d[h]:d,c,l+1,e)}};numeric._biforeach2=function _biforeach2(b,d,c,l,e){if(l===c.length-1)return e(b,d);var h;h=c[l];var r=Array(h);for(--h;0<=h;--h)r[h]=_biforeach2("object"===typeof b?b[h]:b,"object"===typeof d?d[h]:d,c,l+1,e);return r};
numeric._foreach=function _foreach(b,d,c,l){if(c===d.length-1)l(b);else{var e;for(e=d[c]-1;0<=e;e--)_foreach(b[e],d,c+1,l)}};numeric._foreach2=function _foreach2(b,d,c,l){if(c===d.length-1)return l(b);var e;e=d[c];var h=Array(e);for(--e;0<=e;e--)h[e]=_foreach2(b[e],d,c+1,l);return h};numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};
numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="};numeric.mathfuns="abs acos asin atan ceil cos exp floor log round sin sqrt tan isNaN isFinite".split(" ");numeric.mathfuns2=["atan2","pow","max","min"];numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""};
numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]};
(function(){var a,b;for(a=0;a<numeric.mathfuns2.length;++a)b=numeric.mathfuns2[a],numeric.ops2[b]=b;for(a in numeric.ops2)if(numeric.ops2.hasOwnProperty(a)){b=numeric.ops2[a];var d,c,l="";-1!==numeric.myIndexOf.call(numeric.mathfuns2,a)?(l="var "+b+" = Math."+b+";\n",d=function(a,d,c){return a+" = "+b+"("+d+","+c+")"},c=function(a,d){return a+" = "+b+"("+a+","+d+")"}):(d=function(a,d,c){return a+" = "+d+" "+b+" "+c},c=numeric.opseq.hasOwnProperty(a+"eq")?function(a,d){return a+" "+b+"= "+d}:function(a,
d){return a+" = "+a+" "+b+" "+d});numeric[a+"VV"]=numeric.pointwise2(["x[i]","y[i]"],d("ret[i]","x[i]","y[i]"),l);numeric[a+"SV"]=numeric.pointwise2(["x","y[i]"],d("ret[i]","x","y[i]"),l);numeric[a+"VS"]=numeric.pointwise2(["x[i]","y"],d("ret[i]","x[i]","y"),l);numeric[a]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+a+"VV, VS = numeric."+a+"VS, SV = numeric."+a+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+
c("x","y")+"\n}\nreturn x;\n");numeric[b]=numeric[a];numeric[a+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],c("ret[i]","x[i]"),l);numeric[a+"eqS"]=numeric.pointwise2(["ret[i]","x"],c("ret[i]","x"),l);numeric[a+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+a+"eqV, S = numeric."+a+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n')}for(a=
0;a<numeric.mathfuns2.length;++a)b=numeric.mathfuns2[a],delete numeric.ops2[b];for(a=0;a<numeric.mathfuns.length;++a)b=numeric.mathfuns[a],numeric.ops1[b]=b;for(a in numeric.ops1)numeric.ops1.hasOwnProperty(a)&&(l="",b=numeric.ops1[a],-1!==numeric.myIndexOf.call(numeric.mathfuns,a)&&Math.hasOwnProperty(b)&&(l="var "+b+" = Math."+b+";\n"),numeric[a+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+b+"(ret[i]);",l),numeric[a+"eq"]=Function("x",'if(typeof x !== "object") return '+b+"x\nvar i;\nvar V = numeric."+
a+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),numeric[a+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+b+"(x[i]);",l),numeric[a]=Function("x",'if(typeof x !== "object") return '+b+"(x)\nvar i;\nvar V = numeric."+a+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));for(a=0;a<numeric.mathfuns.length;++a)b=numeric.mathfuns[a],delete numeric.ops1[b];for(a in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(a)&&(b=numeric.mapreducers[a],numeric[a+"V"]=
numeric.mapreduce2(b[0],b[1]),numeric[a]=Function("x","s","k",b[1]+'if(typeof x !== "object") {    xi = x;\n'+b[0]+';\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+a+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+b[0]+";\n}\nreturn accum;\n"))})();numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;");
numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;");numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;");numeric.trunc=function(a,b){return"object"===typeof a?"object"===typeof b?numeric.truncVV(a,b):numeric.truncVS(a,b):"object"===typeof b?numeric.truncSV(a,b):Math.round(a/b)*b};
numeric.inv=function(a){var b=numeric.dim(a),d=Math.abs,c=b[0],b=b[1],l=numeric.clone(a),e,h,r=numeric.identity(c),n,u,v,w,y;for(w=0;w<b;++w){h=a=-1;for(v=w;v!==c;++v)y=d(l[v][w]),y>h&&(a=v,h=y);h=l[a];l[a]=l[w];l[w]=h;u=r[a];r[a]=r[w];r[w]=u;a=h[w];for(y=w;y!==b;++y)h[y]/=a;for(y=b-1;-1!==y;--y)u[y]/=a;for(v=c-1;-1!==v;--v)if(v!==w){e=l[v];n=r[v];a=e[w];for(y=w+1;y!==b;++y)e[y]-=h[y]*a;for(y=b-1;0<y;--y)n[y]-=u[y]*a,--y,n[y]-=u[y]*a;0===y&&(n[0]-=u[0]*a)}}return r};
numeric.det=function(a){var b=numeric.dim(a);if(2!==b.length||b[0]!==b[1])throw Error("numeric: det() only works on square matrices");var b=b[0],d=1,c,l,e=numeric.clone(a),h,r,n,u;for(a=0;a<b-1;a++){l=a;for(c=a+1;c<b;c++)Math.abs(e[c][a])>Math.abs(e[l][a])&&(l=c);l!==a&&(c=e[l],e[l]=e[a],e[a]=c,d*=-1);h=e[a];for(c=a+1;c<b;c++){r=e[c];n=r[a]/h[a];for(l=a+1;l<b-1;l+=2)u=l+1,r[l]-=h[l]*n,r[u]-=h[u]*n;l!==b&&(r[l]-=h[l]*n)}if(0===h[a])return 0;d*=h[a]}return d*e[a][a]};
numeric.transpose=function(a){var b,d;b=a.length;var c=a[0].length,l=Array(c),e,h,r;for(d=0;d<c;d++)l[d]=Array(b);for(--b;1<=b;b-=2){h=a[b];e=a[b-1];for(d=c-1;1<=d;--d)r=l[d],r[b]=h[d],r[b-1]=e[d],--d,r=l[d],r[b]=h[d],r[b-1]=e[d];0===d&&(r=l[0],r[b]=h[0],r[b-1]=e[0])}if(0===b){e=a[0];for(d=c-1;1<=d;--d)l[d][0]=e[d],--d,l[d][0]=e[d];0===d&&(l[0][0]=e[0])}return l};
numeric.negtranspose=function(a){var b,d;b=a.length;var c=a[0].length,l=Array(c),e,h,r;for(d=0;d<c;d++)l[d]=Array(b);for(--b;1<=b;b-=2){h=a[b];e=a[b-1];for(d=c-1;1<=d;--d)r=l[d],r[b]=-h[d],r[b-1]=-e[d],--d,r=l[d],r[b]=-h[d],r[b-1]=-e[d];0===d&&(r=l[0],r[b]=-h[0],r[b-1]=-e[0])}if(0===b){e=a[0];for(d=c-1;1<=d;--d)l[d][0]=-e[d],--d,l[d][0]=-e[d];0===d&&(l[0][0]=-e[0])}return l};
numeric._random=function _random(b,d){var c;c=b[d];var l=Array(c),e;if(d===b.length-1){e=Math.random;for(--c;1<=c;c-=2)l[c]=e(),l[c-1]=e();0===c&&(l[0]=e());return l}for(--c;0<=c;c--)l[c]=_random(b,d+1);return l};numeric.random=function(a){return numeric._random(a,0)};numeric.norm2=function(a){return Math.sqrt(numeric.norm2Squared(a))};
numeric.linspace=function(a,b,d){"undefined"===typeof d&&(d=Math.max(Math.round(b-a)+1,1));if(2>d)return 1===d?[a]:[];var c,l=Array(d);d--;for(c=d;0<=c;c--)l[c]=(c*b+(d-c)*a)/d;return l};numeric.getBlock=function(a,b,d){function c(a,h){var r,n=b[h];r=d[h]-n;var u=Array(r);if(h===l.length-1){for(;0<=r;r--)u[r]=a[r+n];return u}for(;0<=r;r--)u[r]=c(a[r+n],h+1);return u}var l=numeric.dim(a);return c(a,0)};
numeric.setBlock=function(a,b,d,c){function l(a,c,n){var u,v=b[n],w=d[n]-v;if(n===e.length-1)for(u=w;0<=u;u--)a[u+v]=c[u];for(u=w;0<=u;u--)l(a[u+v],c[u],n+1)}var e=numeric.dim(a);l(a,c,0);return a};numeric.getRange=function(a,b,d){for(var c=b.length,l=d.length,e,h=Array(c),r,n,c=c-1;-1!==c;--c)for(h[c]=Array(l),r=h[c],n=a[b[c]],e=l-1;-1!==e;--e)r[e]=n[d[e]];return h};
numeric.blockMatrix=function(a){var b=numeric.dim(a);if(4>b.length)return numeric.blockMatrix([a]);var d=b[0],b=b[1],c,l,e,h;for(e=l=c=0;e<d;++e)c+=a[e][0].length;for(h=0;h<b;++h)l+=a[0][h][0].length;var r=Array(c);for(e=0;e<c;++e)r[e]=Array(l);var n=0,u,v,w,y,E;for(e=0;e<d;++e){u=l;for(h=b-1;-1!==h;--h)for(c=a[e][h],u-=c[0].length,w=c.length-1;-1!==w;--w)for(E=c[w],v=r[n+w],y=E.length-1;-1!==y;--y)v[u+y]=E[y];n+=a[e][0].length}return r};
numeric.tensor=function(a,b){if("number"===typeof a||"number"===typeof b)return numeric.mul(a,b);var d=numeric.dim(a),c=numeric.dim(b);if(1!==d.length||1!==c.length)throw Error("numeric: tensor product is only defined for vectors");var l=d[0],c=c[0],d=Array(l),e,h,r;for(e=l-1;0<=e;e--){l=Array(c);r=a[e];for(h=c-1;3<=h;--h)l[h]=r*b[h],--h,l[h]=r*b[h],--h,l[h]=r*b[h],--h,l[h]=r*b[h];for(;0<=h;)l[h]=r*b[h],--h;d[e]=l}return d};numeric.T=function(a,b){this.x=a;this.y=b};
numeric.t=function(a,b){return new numeric.T(a,b)};
numeric.Tbinop=function(a,b,d,c,l){if("string"!==typeof l){var e;l="";for(e in numeric)numeric.hasOwnProperty(e)&&(0<=a.indexOf(e)||0<=b.indexOf(e)||0<=d.indexOf(e)||0<=c.indexOf(e))&&1<e.length&&(l+="var "+e+" = numeric."+e+";\n")}return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+l+"\nif(x.y) {  if(y.y) {    return new numeric.T("+c+");\n  }\n  return new numeric.T("+d+");\n}\nif(y.y) {\n  return new numeric.T("+b+");\n}\nreturn new numeric.T("+a+");\n")};
numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)");numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)");numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))");
numeric.T.prototype.reciprocal=function(){var a=numeric.mul,b=numeric.div;return this.y?(a=numeric.add(a(this.x,this.x),a(this.y,this.y)),new numeric.T(b(this.x,a),b(numeric.neg(this.y),a))):new numeric.T(b(1,this.x),0)};numeric.T.prototype.div=function(a){a instanceof numeric.T||(a=new numeric.T(a));if(a.y)return this.mul(a.reciprocal());var b=numeric.div;return this.y?new numeric.T(b(this.x,a.x),b(this.y,a.x)):new numeric.T(b(this.x,a.x))};
numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))");numeric.T.prototype.transpose=function(){var a=numeric.transpose,b=this.x,d=this.y;return d?new numeric.T(a(b),a(d)):new numeric.T(a(b))};numeric.T.prototype.transjugate=function(){var a=numeric.transpose,b=this.x,d=this.y;return d?new numeric.T(a(b),numeric.negtranspose(d)):new numeric.T(a(b))};
numeric.Tunop=function(a,b,d){"string"!==typeof d&&(d="");return Function("var x = this;\n"+d+"\nif(x.y) {  "+b+";\n}\n"+a+";\n")};numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;");numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));");
numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;");numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));");numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);");
numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;");numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);");numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));");
numeric.T.prototype.inv=function(){if("undefined"===typeof this.y)return new numeric.T(numeric.inv(this.x));var a=this.x.length,b,d,c,l=numeric.identity(a),e=numeric.rep([a,a],0),h=numeric.clone(this.x),r=numeric.clone(this.y),n,u,v,w,y,E,C,H,G,k,M,K;for(b=0;b<a;b++){G=h[b][b];k=r[b][b];v=G*G+k*k;c=b;for(d=b+1;d<a;d++)G=h[d][b],k=r[d][b],n=G*G+k*k,n>v&&(c=d,v=n);c!==b&&(d=h[b],h[b]=h[c],h[c]=d,d=r[b],r[b]=r[c],r[c]=d,d=l[b],l[b]=l[c],l[c]=d,d=e[b],e[b]=e[c],e[c]=d);n=h[b];u=r[b];y=l[b];E=e[b];G=n[b];
k=u[b];for(d=b+1;d<a;d++)M=n[d],K=u[d],n[d]=(M*G+K*k)/v,u[d]=(K*G-M*k)/v;for(d=0;d<a;d++)M=y[d],K=E[d],y[d]=(M*G+K*k)/v,E[d]=(K*G-M*k)/v;for(d=b+1;d<a;d++){v=h[d];w=r[d];C=l[d];H=e[d];G=v[b];k=w[b];for(c=b+1;c<a;c++)M=n[c],K=u[c],v[c]-=M*G-K*k,w[c]-=K*G+M*k;for(c=0;c<a;c++)M=y[c],K=E[c],C[c]-=M*G-K*k,H[c]-=K*G+M*k}}for(b=a-1;0<b;b--)for(y=l[b],E=e[b],d=b-1;0<=d;d--)for(C=l[d],H=e[d],G=h[d][b],k=r[d][b],c=a-1;0<=c;c--)M=y[c],K=E[c],C[c]-=G*M-k*K,H[c]-=G*K+k*M;return new numeric.T(l,e)};
numeric.T.prototype.get=function(a){var b=this.x,d=this.y,c=0,l,e=a.length;if(d){for(;c<e;)l=a[c],b=b[l],d=d[l],c++;return new numeric.T(b,d)}for(;c<e;)l=a[c],b=b[l],c++;return new numeric.T(b)};
numeric.T.prototype.set=function(a,b){var d=this.x,c=this.y,l=0,e,h=a.length,r=b.x,n=b.y;if(0===h)return n?this.y=n:c&&(this.y=void 0),this.x=d,this;if(n){c||(this.y=c=numeric.rep(numeric.dim(d),0));for(;l<h-1;)e=a[l],d=d[e],c=c[e],l++;e=a[l];d[e]=r;c[e]=n;return this}if(c){for(;l<h-1;)e=a[l],d=d[e],c=c[e],l++;e=a[l];d[e]=r;c[e]=r instanceof Array?numeric.rep(numeric.dim(r),0):0;return this}for(;l<h-1;)e=a[l],d=d[e],l++;e=a[l];d[e]=r;return this};
numeric.T.prototype.getRows=function(a,b){var d=b-a+1,c,l=Array(d),e=this.x,h=this.y;for(c=a;c<=b;c++)l[c-a]=e[c];if(h){d=Array(d);for(c=a;c<=b;c++)d[c-a]=h[c];return new numeric.T(l,d)}return new numeric.T(l)};numeric.T.prototype.setRows=function(a,b,d){var c=this.x,l=this.y,e=d.x,h=d.y;for(d=a;d<=b;d++)c[d]=e[d-a];if(h)for(l||(this.y=l=numeric.rep(numeric.dim(c),0)),d=a;d<=b;d++)l[d]=h[d-a];else if(l)for(d=a;d<=b;d++)l[d]=numeric.rep([e[d-a].length],0);return this};
numeric.T.prototype.getRow=function(a){var b=this.x,d=this.y;return d?new numeric.T(b[a],d[a]):new numeric.T(b[a])};numeric.T.prototype.setRow=function(a,b){var d=this.x,c=this.y,l=b.x,e=b.y;d[a]=l;e?(c||(this.y=c=numeric.rep(numeric.dim(d),0)),c[a]=e):c&&numeric.rep([l.length],0);return this};numeric.T.prototype.getBlock=function(a,b){var d=this.x,c=this.y,l=numeric.getBlock;return c?new numeric.T(l(d,a,b),l(c,a,b)):new numeric.T(l(d,a,b))};
numeric.T.prototype.setBlock=function(a,b,d){d instanceof numeric.T||(d=new numeric.T(d));var c=this.x,l=this.y,e=numeric.setBlock,h=d.x;if(d=d.y)return l||(l=this.y=numeric.rep(numeric.dim(this),0)),e(c,a,b,h),e(l,a,b,d),this;e(c,a,b,h);l&&e(l,a,b,numeric.rep(numeric.dim(h),0))};numeric.T.rep=function(a,b){var d=numeric.T;b instanceof d||(b=new d(b));var c=b.x,l=b.y,e=numeric.rep;return l?new d(e(a,c),e(a,l)):new d(e(a,c))};
numeric.T.diag=function(a){a instanceof numeric.T||(a=new numeric.T(a));var b=a.x;a=a.y;var d=numeric.diag;return a?new numeric.T(d(b),d(a)):new numeric.T(d(b))};numeric.T.identity=function(a){return new numeric.T(numeric.identity(a))};numeric.T.prototype.getDiag=function(){var a=numeric,b=this.x,d=this.y;return d?new a.T(a.getDiag(b),a.getDiag(d)):new a.T(a.getDiag(b))};
numeric.house=function(a){var b=numeric.clone(a);a=(0<=a[0]?1:-1)*numeric.norm2(a);b[0]+=a;a=numeric.norm2(b);if(0===a)throw Error("eig: internal error");return numeric.div(b,a)};
numeric.toUpperHessenberg=function(a){var b=numeric.dim(a);if(2!==b.length||b[0]!==b[1])throw Error("numeric: toUpperHessenberg() only works on square matrices");var b=b[0],d,c,l,e=numeric.clone(a),h,r,n,u=numeric.identity(b);for(d=0;d<b-2;d++){c=Array(b-d-1);for(a=d+1;a<b;a++)c[a-d-1]=e[a][d];if(0<numeric.norm2(c)){l=numeric.house(c);c=numeric.getBlock(e,[d+1,d],[b-1,b-1]);h=numeric.tensor(l,numeric.dot(l,c));for(a=d+1;a<b;a++)for(r=e[a],n=h[a-d-1],c=d;c<b;c++)r[c]-=2*n[c-d];c=numeric.getBlock(e,
[0,d+1],[b-1,b-1]);h=numeric.tensor(numeric.dot(c,l),l);for(a=0;a<b;a++)for(r=e[a],n=h[a],c=d+1;c<b;c++)r[c]-=2*n[c-d-1];c=Array(b-d-1);for(a=d+1;a<b;a++)c[a-d-1]=u[a];h=numeric.tensor(l,numeric.dot(l,c));for(a=d+1;a<b;a++)for(l=u[a],n=h[a-d-1],c=0;c<b;c++)l[c]-=2*n[c]}}return{H:e,Q:u}};numeric.epsilon=2.220446049250313E-16;
numeric.QRFrancis=function(a,b){"undefined"===typeof b&&(b=1E4);a=numeric.clone(a);numeric.clone(a);var d=numeric.dim(a)[0],c,l,e,h,r,n,u=numeric.identity(d),v,w,y;if(3>d)return{Q:u,B:[[0,d-1]]};var E=numeric.epsilon;for(y=0;y<b;y++){for(e=0;e<d-1;e++)if(Math.abs(a[e+1][e])<E*(Math.abs(a[e][e])+Math.abs(a[e+1][e+1]))){y=numeric.QRFrancis(numeric.getBlock(a,[0,0],[e,e]),b);E=numeric.QRFrancis(numeric.getBlock(a,[e+1,e+1],[d-1,d-1]),b);h=Array(e+1);for(n=0;n<=e;n++)h[n]=u[n];h=numeric.dot(y.Q,h);for(n=
0;n<=e;n++)u[n]=h[n];h=Array(d-e-1);for(n=e+1;n<d;n++)h[n-e-1]=u[n];h=numeric.dot(E.Q,h);for(n=e+1;n<d;n++)u[n]=h[n-e-1];return{Q:u,B:y.B.concat(numeric.add(E.B,e+1))}}e=a[d-2][d-2];c=a[d-2][d-1];h=a[d-1][d-2];r=a[d-1][d-1];n=e+r;h=e*r-c*h;e=numeric.getBlock(a,[0,0],[2,2]);n*n>=4*h?(c=.5*(n+Math.sqrt(n*n-4*h)),n=.5*(n-Math.sqrt(n*n-4*h)),e=numeric.add(numeric.sub(numeric.dot(e,e),numeric.mul(e,c+n)),numeric.diag(numeric.rep([3],c*n)))):e=numeric.add(numeric.sub(numeric.dot(e,e),numeric.mul(e,n)),
numeric.diag(numeric.rep([3],h)));c=[e[0][0],e[1][0],e[2][0]];l=numeric.house(c);h=[a[0],a[1],a[2]];h=numeric.tensor(l,numeric.dot(l,h));for(n=0;3>n;n++)for(v=a[n],w=h[n],c=0;c<d;c++)v[c]-=2*w[c];h=numeric.getBlock(a,[0,0],[d-1,2]);h=numeric.tensor(numeric.dot(h,l),l);for(n=0;n<d;n++)for(v=a[n],w=h[n],c=0;3>c;c++)v[c]-=2*w[c];h=[u[0],u[1],u[2]];h=numeric.tensor(l,numeric.dot(l,h));for(n=0;3>n;n++)for(l=u[n],w=h[n],c=0;c<d;c++)l[c]-=2*w[c];for(e=0;e<d-2;e++){for(c=e;c<=e+1;c++)if(Math.abs(a[c+1][c])<
E*(Math.abs(a[c][c])+Math.abs(a[c+1][c+1]))){y=numeric.QRFrancis(numeric.getBlock(a,[0,0],[c,c]),b);E=numeric.QRFrancis(numeric.getBlock(a,[c+1,c+1],[d-1,d-1]),b);h=Array(c+1);for(n=0;n<=c;n++)h[n]=u[n];h=numeric.dot(y.Q,h);for(n=0;n<=c;n++)u[n]=h[n];h=Array(d-c-1);for(n=c+1;n<d;n++)h[n-c-1]=u[n];h=numeric.dot(E.Q,h);for(n=c+1;n<d;n++)u[n]=h[n-c-1];return{Q:u,B:y.B.concat(numeric.add(E.B,c+1))}}r=Math.min(d-1,e+3);c=Array(r-e);for(n=e+1;n<=r;n++)c[n-e-1]=a[n][e];l=numeric.house(c);h=numeric.getBlock(a,
[e+1,e],[r,d-1]);h=numeric.tensor(l,numeric.dot(l,h));for(n=e+1;n<=r;n++)for(v=a[n],w=h[n-e-1],c=e;c<d;c++)v[c]-=2*w[c-e];h=numeric.getBlock(a,[0,e+1],[d-1,r]);h=numeric.tensor(numeric.dot(h,l),l);for(n=0;n<d;n++)for(v=a[n],w=h[n],c=e+1;c<=r;c++)v[c]-=2*w[c-e-1];h=Array(r-e);for(n=e+1;n<=r;n++)h[n-e-1]=u[n];h=numeric.tensor(l,numeric.dot(l,h));for(n=e+1;n<=r;n++)for(l=u[n],w=h[n-e-1],c=0;c<d;c++)l[c]-=2*w[c]}}throw Error("numeric: eigenvalue iteration does not converge -- increase maxiter?");};
numeric.eig=function(a,b){for(var d=numeric.toUpperHessenberg(a),c=numeric.QRFrancis(d.H,b),l=numeric.T,e=a.length,h,e=c.B,r=numeric.dot(c.Q,numeric.dot(d.H,numeric.transpose(c.Q))),c=new l(numeric.dot(c.Q,d.Q)),n,u=e.length,v,w,y,E,C,H,G,k,M=Math.sqrt,d=0;d<u;d++)if(h=e[d][0],h!==e[d][1]&&(v=h+1,w=r[h][h],y=r[h][v],E=r[v][h],C=r[v][v],0!==y||0!==E))n=-w-C,H=w*C-y*E,H=n*n-4*H,0<=H?(n=0>n?-.5*(n-M(H)):-.5*(n+M(H)),G=(w-n)*(w-n)+y*y,k=E*E+(C-n)*(C-n),G>k?(G=M(G),w=(w-n)/G,y/=G):(k=M(k),w=E/k,y=(C-n)/
k),n=new l([[y,-w],[w,y]])):(n*=-.5,H=.5*M(-H),G=(w-n)*(w-n)+y*y,k=E*E+(C-n)*(C-n),G>k?(G=M(G+H*H),w=(w-n)/G,y/=G,n=0,H/=G):(k=M(k+H*H),w=E/k,y=(C-n)/k,n=H/k,H=0),n=new l([[y,-w],[w,y]],[[n,H],[H,-n]])),c.setRows(h,v,n.dot(c.getRows(h,v)));l=c.dot(a).dot(c.transjugate());e=a.length;r=numeric.T.identity(e);for(v=0;v<e;v++)if(0<v)for(d=v-1;0<=d;d--)h=l.get([d,d]),u=l.get([v,v]),numeric.neq(h.x,u.x)||numeric.neq(h.y,u.y)?(n=l.getRow(d).getBlock([d],[v-1]),H=r.getRow(v).getBlock([d],[v-1]),r.set([v,d],
l.get([d,v]).neg().sub(n.dot(H)).div(h.sub(u)))):r.setRow(v,r.getRow(d));for(v=0;v<e;v++)n=r.getRow(v),r.setRow(v,n.div(n.norm2()));r=r.transpose();r=c.transjugate().dot(r);return{lambda:l.getDiag(),E:r}};
numeric.ccsSparse=function(a){var b=a.length,d,c,l,e=[];for(c=b-1;-1!==c;--c)for(l in d=a[c],d){for(l=parseInt(l);l>=e.length;)e[e.length]=0;0!==d[l]&&e[l]++}d=e.length;var h=Array(d+1);for(c=h[0]=0;c<d;++c)h[c+1]=h[c]+e[c];var r=Array(h[d]),n=Array(h[d]);for(c=b-1;-1!==c;--c)for(l in d=a[c],d)0!==d[l]&&(e[l]--,r[h[l]+e[l]]=c,n[h[l]+e[l]]=d[l]);return[h,r,n]};
numeric.ccsFull=function(a){var b=a[0],d=a[1],c=a[2],l=numeric.ccsDim(a);a=l[1];for(var e,h,r=numeric.rep([l[0],a],0),l=0;l<a;l++)for(e=b[l],h=b[l+1];e<h;++e)r[d[e]][l]=c[e];return r};
numeric.ccsTSolve=function(a,b,d,c,l){function e(a){var b;if(0===d[a]){d[a]=1;for(b=h[a];b<h[a+1];++b)e(r[b]);l[v]=a;++v}}var h=a[0],r=a[1];a=a[2];var n=h.length-1,u=Math.max,v=0;"undefined"===typeof c&&(d=numeric.rep([n],0));"undefined"===typeof c&&(c=numeric.linspace(0,d.length-1));"undefined"===typeof l&&(l=[]);for(var w,y,E,n=c.length-1;-1!==n;--n)e(c[n]);l.length=v;for(n=l.length-1;-1!==n;--n)d[l[n]]=0;for(n=c.length-1;-1!==n;--n)w=c[n],d[w]=b[w];for(n=l.length-1;-1!==n;--n){w=l[n];y=h[w];b=
u(h[w+1],y);for(c=y;c!==b;++c)if(r[c]===w){d[w]/=a[c];break}E=d[w];for(c=y;c!==b;++c)y=r[c],y!==w&&(d[y]-=E*a[c])}return d};numeric.ccsDFS=function(a){this.k=Array(a);this.k1=Array(a);this.j=Array(a)};numeric.ccsDFS.prototype.dfs=function(a,b,d,c,l,e){var h=0,r=l.length,n=this.k,u=this.k1,v=this.j,w,y;if(0===c[a])for(c[a]=1,v[0]=a,n[0]=w=b[a],u[0]=y=b[a+1];;)if(w>=y){l[r]=v[h];if(0===h)break;++r;--h;w=n[h];y=u[h]}else a=e[d[w]],0===c[a]?(c[a]=1,n[h]=w,++h,v[h]=a,w=b[a],u[h]=y=b[a+1]):++w};
numeric.ccsLPSolve=function(a,b,d,c,l,e,h){var r=a[0],n=a[1];a=a[2];var u=b[0],v=b[1];b=b[2];var w;w=u[l];u=u[l+1];c.length=0;for(l=w;l<u;++l)h.dfs(e[v[l]],r,n,d,c,e);for(l=c.length-1;-1!==l;--l)d[c[l]]=0;for(l=w;l!==u;++l)h=e[v[l]],d[h]=b[l];for(l=c.length-1;-1!==l;--l){h=c[l];u=r[h];v=r[h+1];for(b=u;b<v;++b)if(e[n[b]]===h){d[h]/=a[b];break}w=d[h];for(b=u;b<v;++b)u=e[n[b]],u!==h&&(d[u]-=w*a[b])}return d};
numeric.ccsLUP1=function(a,b){var d=a[0].length-1,c=[numeric.rep([d+1],0),[],[]],l=[numeric.rep([d+1],0),[],[]],e=c[0],h=c[1],r=c[2],n=l[0],u=l[1],v=l[2],w=numeric.rep([d],0),y=numeric.rep([d],0),E,C,H,G,k,M,K,R=numeric.ccsLPSolve,O=Math.abs,Y=numeric.linspace(0,d-1),ea=numeric.linspace(0,d-1),ha=new numeric.ccsDFS(d);"undefined"===typeof b&&(b=1);for(E=0;E<d;++E){R(c,a,w,y,E,ea,ha);k=G=-1;for(C=y.length-1;-1!==C;--C)H=y[C],H<=E||(M=O(w[H]),M>G&&(k=H,G=M));O(w[E])<b*G&&(C=Y[E],G=Y[k],Y[E]=G,ea[G]=
E,Y[k]=C,ea[C]=k,G=w[E],w[E]=w[k],w[k]=G);G=e[E];k=n[E];K=w[E];h[G]=Y[E];r[G]=1;++G;for(C=y.length-1;-1!==C;--C)H=y[C],M=w[H],y[C]=0,w[H]=0,H<=E?(u[k]=H,v[k]=M,++k):(h[G]=Y[H],r[G]=M/K,++G);e[E+1]=G;n[E+1]=k}for(C=h.length-1;-1!==C;--C)h[C]=ea[h[C]];return{L:c,U:l,P:Y,Pinv:ea}};numeric.ccsDFS0=function(a){this.k=Array(a);this.k1=Array(a);this.j=Array(a)};
numeric.ccsDFS0.prototype.dfs=function(a,b,d,c,l,e,h){h=0;var r=l.length,n=this.k,u=this.k1,v=this.j,w,y;if(0===c[a])for(c[a]=1,v[0]=a,n[0]=w=b[e[a]],u[0]=y=b[e[a]+1];;){if(isNaN(w))throw Error("Ow!");if(w>=y){l[r]=e[v[h]];if(0===h)break;++r;--h;w=n[h];y=u[h]}else a=d[w],0===c[a]?(c[a]=1,n[h]=w,++h,v[h]=a,a=e[a],w=b[a],u[h]=y=b[a+1]):++w}};
numeric.ccsLPSolve0=function(a,b,d,c,l,e,h,r){var n=a[0],u=a[1];a=a[2];var v=b[0],w=b[1];b=b[2];var y;y=v[l];v=v[l+1];c.length=0;for(l=y;l<v;++l)r.dfs(w[l],n,u,d,c,e,h);for(l=c.length-1;-1!==l;--l)e=c[l],d[h[e]]=0;for(l=y;l!==v;++l)e=w[l],d[e]=b[l];for(l=c.length-1;-1!==l;--l){e=c[l];w=h[e];r=n[e];e=n[e+1];for(b=r;b<e;++b)if(u[b]===w){d[w]/=a[b];break}y=d[w];for(b=r;b<e;++b)d[u[b]]-=y*a[b];d[w]=y}};
numeric.ccsLUP0=function(a,b){var d=a[0].length-1,c=[numeric.rep([d+1],0),[],[]],l=[numeric.rep([d+1],0),[],[]],e=c[0],h=c[1],r=c[2],n=l[0],u=l[1],v=l[2],w=numeric.rep([d],0),y=numeric.rep([d],0),E,C,H,G,k,M,K,R=numeric.ccsLPSolve0,O=Math.abs,Y=numeric.linspace(0,d-1),ea=numeric.linspace(0,d-1),ha=new numeric.ccsDFS0(d);"undefined"===typeof b&&(b=1);for(E=0;E<d;++E){R(c,a,w,y,E,ea,Y,ha);k=G=-1;for(C=y.length-1;-1!==C;--C)H=y[C],H<=E||(M=O(w[Y[H]]),M>G&&(k=H,G=M));O(w[Y[E]])<b*G&&(C=Y[E],G=Y[k],Y[E]=
G,ea[G]=E,Y[k]=C,ea[C]=k);G=e[E];k=n[E];K=w[Y[E]];h[G]=Y[E];r[G]=1;++G;for(C=y.length-1;-1!==C;--C)H=y[C],M=w[Y[H]],y[C]=0,w[Y[H]]=0,H<=E?(u[k]=H,v[k]=M,++k):(h[G]=Y[H],r[G]=M/K,++G);e[E+1]=G;n[E+1]=k}for(C=h.length-1;-1!==C;--C)h[C]=ea[h[C]];return{L:c,U:l,P:Y,Pinv:ea}};numeric.ccsLUP=numeric.ccsLUP0;numeric.ccsDim=function(a){return[numeric.sup(a[1])+1,a[0].length-1]};
numeric.ccsGetBlock=function(a,b,d){var c=numeric.ccsDim(a),l=c[0],e=c[1];"undefined"===typeof b?b=numeric.linspace(0,l-1):"number"===typeof b&&(b=[b]);"undefined"===typeof d?d=numeric.linspace(0,e-1):"number"===typeof d&&(d=[d]);var h,c=b.length,r=d.length,n,e=numeric.rep([e],0),u=[],v=[],w=[e,u,v],y=a[0],E=a[1];a=a[2];for(var C=numeric.rep([l],0),H=0,G=numeric.rep([l],0),l=0;l<r;++l){h=d[l];var k=y[h],M=y[h+1];for(h=k;h<M;++h)n=E[h],G[n]=1,C[n]=a[h];for(h=0;h<c;++h)n=b[h],G[n]&&(u[H]=h,v[H]=C[b[h]],
++H);for(h=k;h<M;++h)n=E[h],G[n]=0;e[l+1]=H}return w};
numeric.ccsDot=function(a,b){var d=a[0],c=a[1],l=a[2],e=b[0],h=b[1],r=b[2],n=numeric.ccsDim(a),u=numeric.ccsDim(b),v=n[0],u=u[1],n=numeric.rep([v],0),w=numeric.rep([v],0),v=Array(v),y=numeric.rep([u],0),E=[],C=[],H=[y,E,C],G,k,M,K,R,O,Y,ea;for(M=0;M!==u;++M){K=e[M];R=e[M+1];Y=0;for(k=K;k<R;++k)for(K=h[k],ea=r[k],G=d[K],K=d[K+1];G<K;++G)O=c[G],0===w[O]&&(v[Y]=O,w[O]=1,Y+=1),n[O]+=l[G]*ea;K=y[M];R=K+Y;y[M+1]=R;for(k=Y-1;-1!==k;--k)ea=K+k,G=v[k],E[ea]=G,C[ea]=n[G],w[G]=0,n[G]=0;y[M+1]=y[M]+Y}return H};
numeric.ccsLUPSolve=function(a,b){var d=a.L,c=a.U,l=b[0],e=!1;"object"!==typeof l&&(b=[[0,b.length],numeric.linspace(0,b.length-1),b],l=b[0],e=!0);var h=b[1],r=b[2],n=d[0].length-1,u=l.length-1,v=numeric.rep([n],0),w=Array(n),y=numeric.rep([n],0),n=Array(n),E=numeric.rep([u+1],0),C=[],H=[],G=numeric.ccsTSolve,k,M,K,R,O,Y=0;for(k=0;k<u;++k){R=0;M=l[k];for(K=l[k+1];M<K;++M)O=a.Pinv[h[M]],n[R]=O,y[O]=r[M],++R;n.length=R;G(d,y,v,n,w);for(M=n.length-1;-1!==M;--M)y[n[M]]=0;G(c,v,y,w,n);if(e)return y;for(M=
w.length-1;-1!==M;--M)v[w[M]]=0;for(M=n.length-1;-1!==M;--M)O=n[M],C[Y]=O,H[Y]=y[O],y[O]=0,++Y;E[k+1]=Y}return[E,C,H]};
numeric.ccsbinop=function(a,b){"undefined"===typeof b&&(b="");return Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+b+"for(i=0;i<n;++i) {\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Xj[j];\n    x[k] = 1;\n    Zj[p] = k;\n    ++p;\n  }\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Yj[j];\n    y[k] = Yv[j];\n    if(x[k] === 0) {\n      Zj[p] = k;\n      ++p;\n    }\n  }\n  Zi[i+1] = p;\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n  j0 = Zi[i]; j1 = Zi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Zj[j];\n    xk = x[k];\n    yk = y[k];\n"+a+
"\n    Zv[j] = zk;\n  }\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n}\nreturn [Zi,Zj,Zv];")};
(function(){var a,b,d,c;for(a in numeric.ops2)b=isFinite(eval("1"+numeric.ops2[a]+"0"))?"[Y[0],Y[1],numeric."+a+"(X,Y[2])]":"NaN",d=isFinite(eval("0"+numeric.ops2[a]+"1"))?"[X[0],X[1],numeric."+a+"(X[2],Y)]":"NaN",c=isFinite(eval("1"+numeric.ops2[a]+"0"))&&isFinite(eval("0"+numeric.ops2[a]+"1"))?"numeric.ccs"+a+"MM(X,Y)":"NaN",numeric["ccs"+a+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[a]+"yk;"),numeric["ccs"+a]=Function("X","Y",'if(typeof X === "number") return '+b+';\nif(typeof Y === "number") return '+
d+";\nreturn "+c+";\n")})();numeric.ccsScatter=function(a){var b=a[0],d=a[1];a=a[2];var c=numeric.sup(d)+1,l=b.length,e=numeric.rep([c],0),h=Array(l),r=Array(l),n=numeric.rep([c],0),u;for(u=0;u<l;++u)n[d[u]]++;for(u=0;u<c;++u)e[u+1]=e[u]+n[u];var c=e.slice(0),v;for(u=0;u<l;++u)v=d[u],n=c[v],h[n]=b[u],r[n]=a[u],c[v]+=1;return[e,h,r]};
numeric.ccsGather=function(a){var b=a[0],d=a[1];a=a[2];var c=b.length-1,l=d.length,e=Array(l),h=Array(l),l=Array(l),r,n,u,v;for(r=v=0;r<c;++r)for(n=b[r],u=b[r+1];n!==u;++n)h[v]=r,e[v]=d[n],l[v]=a[n],++v;return[e,h,l]};numeric.sdim=function dim(b,d,c){"undefined"===typeof d&&(d=[]);if("object"!==typeof b)return d;"undefined"===typeof c&&(c=0);c in d||(d[c]=0);b.length>d[c]&&(d[c]=b.length);for(var l in b)b.hasOwnProperty(l)&&dim(b[l],d,c+1);return d};
numeric.sclone=function clone(b,d,c){"undefined"===typeof d&&(d=0);"undefined"===typeof c&&(c=numeric.sdim(b).length);var l,e=Array(b.length);if(d===c-1){for(l in b)b.hasOwnProperty(l)&&(e[l]=b[l]);return e}for(l in b)b.hasOwnProperty(l)&&(e[l]=clone(b[l],d+1,c));return e};numeric.sdiag=function(a){for(var b=a.length,d=Array(b),c,b=b-1;1<=b;b-=2)c=b-1,d[b]=[],d[b][b]=a[b],d[c]=[],d[c][c]=a[c];0===b&&(d[0]=[],d[0][0]=a[b]);return d};
numeric.sidentity=function(a){return numeric.sdiag(numeric.rep([a],1))};numeric.stranspose=function(a){var b=[],d,c,l;for(d in a)if(a.hasOwnProperty(d))for(c in l=a[d],l)l.hasOwnProperty(c)&&("object"!==typeof b[c]&&(b[c]=[]),b[c][d]=l[c]);return b};numeric.sLUP=function(a,b){throw Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.");};
numeric.sdotMM=function(a,b){var d=a.length,c=numeric.stranspose(b),l=c.length,e,h,r,n,u,v=Array(d),w;for(h=d-1;0<=h;h--){w=[];d=a[h];for(n=l-1;0<=n;n--){u=0;e=c[n];for(r in d)d.hasOwnProperty(r)&&r in e&&(u+=d[r]*e[r]);u&&(w[n]=u)}v[h]=w}return v};numeric.sdotMV=function(a,b){var d=a.length,c,l,e=Array(d),h;for(c=d-1;0<=c;c--){d=a[c];h=0;for(l in d)d.hasOwnProperty(l)&&b[l]&&(h+=d[l]*b[l]);h&&(e[c]=h)}return e};
numeric.sdotVM=function(a,b){var d,c,l,e,h=[];for(d in a)if(a.hasOwnProperty(d))for(c in l=b[d],e=a[d],l)l.hasOwnProperty(c)&&(h[c]||(h[c]=0),h[c]+=e*l[c]);return h};numeric.sdotVV=function(a,b){var d,c=0;for(d in a)a[d]&&b[d]&&(c+=a[d]*b[d]);return c};
numeric.sdot=function(a,b){var d=numeric.sdim(a).length,c=numeric.sdim(b).length;switch(1E3*d+c){case 0:return a*b;case 1001:return numeric.sdotVV(a,b);case 2001:return numeric.sdotMV(a,b);case 1002:return numeric.sdotVM(a,b);case 2002:return numeric.sdotMM(a,b);default:throw Error("numeric.sdot not implemented for tensors of order "+d+" and "+c);}};
numeric.sscatter=function(a){var b,d,c,l=a.length,e=[],h;for(d=a[0].length-1;0<=d;--d)if(a[l-1][d]){h=e;for(c=0;c<l-2;c++)b=a[c][d],h[b]||(h[b]=[]),h=h[b];h[a[c][d]]=a[c+1][d]}return e};
numeric.sgather=function gather(b,d,c){"undefined"===typeof d&&(d=[]);"undefined"===typeof c&&(c=[]);var l,e,h;l=c.length;for(e in b)if(b.hasOwnProperty(e))if(c[l]=parseInt(e),h=b[e],"number"===typeof h){if(h){if(0===d.length)for(e=l+1;0<=e;--e)d[e]=[];for(e=l;0<=e;--e)d[e].push(c[e]);d[l+1].push(h)}}else gather(h,d,c);c.length>l&&c.pop();return d};
numeric.cLU=function(a){var b=a[0],d=a[1],c=a[2],l=b.length;a=0;var e,h,r;for(e=0;e<l;e++)b[e]>a&&(a=b[e]);a++;var n=Array(a),u=Array(a),v=numeric.rep([a],Infinity),w=numeric.rep([a],-Infinity),y,E;for(r=0;r<l;r++)e=b[r],h=d[r],h<v[e]&&(v[e]=h),h>w[e]&&(w[e]=h);for(e=0;e<a-1;e++)w[e]>w[e+1]&&(w[e+1]=w[e]);for(e=a-1;1<=e;e--)v[e]<v[e-1]&&(v[e-1]=v[e]);for(e=0;e<a;e++)u[e]=numeric.rep([w[e]-v[e]+1],0),n[e]=numeric.rep([e-v[e]],0);for(r=0;r<l;r++)e=b[r],u[e][d[r]-v[e]]=c[r];for(e=0;e<a-1;e++)for(b=e-
v[e],c=u[e],h=e+1;v[h]<=e&&h<a;h++)if(d=e-v[h],l=w[e]-e,y=u[h],E=y[d]/c[b]){for(r=1;r<=l;r++)y[r+d]-=E*c[r+b];n[h][e-v[h]]=E}c=[];y=[];r=[];E=[];var C=[],H=[],G,k;for(e=G=l=0;e<a;e++){b=v[e];d=w[e];k=u[e];for(h=e;h<=d;h++)k[h-b]&&(c[l]=e,y[l]=h,r[l]=k[h-b],l++);k=n[e];for(h=b;h<e;h++)k[h-b]&&(E[G]=e,C[G]=h,H[G]=k[h-b],G++);E[G]=e;C[G]=e;H[G]=1;G++}return{U:[c,y,r],L:[E,C,H]}};
numeric.cLUsolve=function(a,b){var d=a.L,c=a.U,l=numeric.clone(b),e=d[1],d=d[2],h=c[1],r=c[2],c=c[0].length,n=l.length,u,v;for(u=v=0;u<n;u++){for(;e[v]<u;)l[u]-=d[v]*l[e[v]],v++;v++}v=c-1;for(u=n-1;0<=u;u--){for(;h[v]>u;)l[u]-=r[v]*l[h[v]],v--;l[u]/=r[v];v--}return l};
numeric.cgrid=function(a,b){"number"===typeof a&&(a=[a,a]);var d=numeric.rep(a,-1),c,l,e;if("function"!==typeof b)switch(b){case "L":b=function(d,b){return d>=a[0]/2||b<a[1]/2};break;default:b=function(a,d){return!0}}e=0;for(c=1;c<a[0]-1;c++)for(l=1;l<a[1]-1;l++)b(c,l)&&(d[c][l]=e,e++);return d};
numeric.cdelsq=function(a){var b=[[-1,0],[0,-1],[0,1],[1,0]],d=numeric.dim(a),c=d[0],d=d[1],l,e,h,r,n,u=[],v=[],w=[];for(l=1;l<c-1;l++)for(e=1;e<d-1;e++)if(!(0>a[l][e])){for(h=0;4>h;h++)r=l+b[h][0],n=e+b[h][1],0>a[r][n]||(u.push(a[l][e]),v.push(a[r][n]),w.push(-1));u.push(a[l][e]);v.push(a[l][e]);w.push(4)}return[u,v,w]};numeric.cdotMV=function(a,b){var d,c=a[0],l=a[1],e=a[2],h,r=c.length;for(h=d=0;h<r;h++)c[h]>d&&(d=c[h]);d++;d=numeric.rep([d],0);for(h=0;h<r;h++)d[c[h]]+=e[h]*b[l[h]];return d};
numeric.Spline=function(a,b,d,c,l){this.x=a;this.yl=b;this.yr=d;this.kl=c;this.kr=l};numeric.Spline.prototype._at=function(a,b){var d=this.x,c=this.yl,l=this.yr,e=this.kr,h,r=numeric.add,n=numeric.sub,u=numeric.mul;h=n(u(this.kl[b],d[b+1]-d[b]),n(l[b+1],c[b]));e=r(u(e[b+1],d[b]-d[b+1]),n(l[b+1],c[b]));d=(a-d[b])/(d[b+1]-d[b]);n=d*(1-d);return r(r(r(u(1-d,c[b]),u(d,l[b+1])),u(h,n*(1-d))),u(e,n*d))};
numeric.Spline.prototype.at=function(a){if("number"===typeof a){var b=this.x,d=b.length,c,l,e=Math.floor;c=0;for(--d;1<d-c;)l=e((c+d)/2),b[l]<=a?c=l:d=l;return this._at(a,c)}d=a.length;b=Array(d);for(c=d-1;-1!==c;--c)b[c]=this.at(a[c]);return b};
numeric.Spline.prototype.diff=function(){for(var a=this.x,b=this.yl,d=this.yr,c=this.kl,l=this.kr,e=b.length,h,r,n=Array(e),u=Array(e),v=numeric.add,w=numeric.mul,y=numeric.div,E=numeric.sub,e=e-1;-1!==e;--e)h=a[e+1]-a[e],r=E(d[e+1],b[e]),n[e]=y(v(w(r,6),w(c[e],-4*h),w(l[e+1],-2*h)),h*h),u[e+1]=y(v(w(r,-6),w(c[e],2*h),w(l[e+1],4*h)),h*h);return new numeric.Spline(a,c,l,n,u)};
numeric.Spline.prototype.roots=function(){var a=[],b=this.x,d=this.yl,c=this.yr,l=this.kl,e=this.kr;"number"===typeof d[0]&&(d=[d],c=[c],l=[l],e=[e]);var h=d.length,r=b.length-1,n,u,v,w,y,E,C,a=Array(h),H,G,k,M,K,R,O,Y,ea=Math.sqrt;for(n=0;n!==h;++n){w=d[n];y=c[n];E=l[n];C=e[n];H=[];for(u=0;u!==r;u++){0<u&&0>y[u]*w[u]&&H.push(b[u]);K=b[u+1]-b[u];v=w[u];M=y[u+1];G=E[u]/K;k=C[u+1]/K;K=G-k+3*(v-M);R=K*K+12*k*v;K=k+3*v+2*G-3*M;v=3*(k+G+2*(v-M));0>=R?(G=K/v,M=G>b[u]&&G<b[u+1]?[b[u],G,b[u+1]]:[b[u],b[u+
1]]):(G=(K-ea(R))/v,O=(K+ea(R))/v,M=[b[u]],G>b[u]&&G<b[u+1]&&M.push(G),O>b[u]&&O<b[u+1]&&M.push(O),M.push(b[u+1]));R=M[0];G=this._at(R,u);for(v=0;v<M.length-1;v++)if(Y=M[v+1],O=this._at(Y,u),0===G)H.push(R),R=Y,G=O;else if(0===O||0<G*O)R=Y,G=O;else{for(var ha=0;;){k=(G*Y-O*R)/(G-O);if(k<=R||k>=Y)break;K=this._at(k,u);if(0<K*O)Y=k,O=K,-1===ha&&(G*=.5),ha=-1;else if(0<K*G)R=k,G=K,1===ha&&(O*=.5),ha=1;else break}H.push(k);R=M[v+1];G=this._at(R,u)}0===O&&H.push(Y)}a[n]=H}return"number"===typeof this.yl[0]?
a[0]:a};
numeric.spline=function(a,b,d,c){var l=a.length,e=[],h=[],r=[],n,u=numeric.sub,v=numeric.mul,w=numeric.add;for(n=l-2;0<=n;n--)h[n]=a[n+1]-a[n],r[n]=u(b[n+1],b[n]);if("string"===typeof d||"string"===typeof c)d=c="periodic";u=[[],[],[]];switch(typeof d){case "undefined":e[0]=v(3/(h[0]*h[0]),r[0]);u[0].push(0,0);u[1].push(0,1);u[2].push(2/h[0],1/h[0]);break;case "string":e[0]=w(v(3/(h[l-2]*h[l-2]),r[l-2]),v(3/(h[0]*h[0]),r[0]));u[0].push(0,0,0);u[1].push(l-2,0,1);u[2].push(1/h[l-2],2/h[l-2]+2/h[0],1/
h[0]);break;default:e[0]=d,u[0].push(0),u[1].push(0),u[2].push(1)}for(n=1;n<l-1;n++)e[n]=w(v(3/(h[n-1]*h[n-1]),r[n-1]),v(3/(h[n]*h[n]),r[n])),u[0].push(n,n,n),u[1].push(n-1,n,n+1),u[2].push(1/h[n-1],2/h[n-1]+2/h[n],1/h[n]);switch(typeof c){case "undefined":e[l-1]=v(3/(h[l-2]*h[l-2]),r[l-2]);u[0].push(l-1,l-1);u[1].push(l-2,l-1);u[2].push(1/h[l-2],2/h[l-2]);break;case "string":u[1][u[1].length-1]=0;break;default:e[l-1]=c,u[0].push(l-1),u[1].push(l-1),u[2].push(1)}e="number"!==typeof e[0]?numeric.transpose(e):
[e];c=Array(e.length);if("string"===typeof d)for(n=c.length-1;-1!==n;--n)c[n]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(u)),e[n]),c[n][l-1]=c[n][0];else for(n=c.length-1;-1!==n;--n)c[n]=numeric.cLUsolve(numeric.cLU(u),e[n]);c="number"===typeof b[0]?c[0]:numeric.transpose(c);return new numeric.Spline(a,b,b,c,c)};
numeric.fftpow2=function fftpow2(b,d){var c=b.length;if(1!==c){var l=Math.cos,e=Math.sin,h,r,n=Array(c/2),u=Array(c/2),v=Array(c/2),w=Array(c/2);r=c/2;for(h=c-1;-1!==h;--h)--r,v[r]=b[h],w[r]=d[h],--h,n[r]=b[h],u[r]=d[h];fftpow2(n,u);fftpow2(v,w);r=c/2;var y,E=-6.283185307179586/c,C;for(h=c-1;-1!==h;--h)--r,-1===r&&(r=c/2-1),y=E*h,C=l(y),y=e(y),b[h]=n[r]+C*v[r]-y*w[r],d[h]=u[r]+C*w[r]+y*v[r]}};
numeric._ifftpow2=function _ifftpow2(b,d){var c=b.length;if(1!==c){var l=Math.cos,e=Math.sin,h,r,n=Array(c/2),u=Array(c/2),v=Array(c/2),w=Array(c/2);r=c/2;for(h=c-1;-1!==h;--h)--r,v[r]=b[h],w[r]=d[h],--h,n[r]=b[h],u[r]=d[h];_ifftpow2(n,u);_ifftpow2(v,w);r=c/2;var y,E=6.283185307179586/c,C;for(h=c-1;-1!==h;--h)--r,-1===r&&(r=c/2-1),y=E*h,C=l(y),y=e(y),b[h]=n[r]+C*v[r]-y*w[r],d[h]=u[r]+C*w[r]+y*v[r]}};numeric.ifftpow2=function(a,b){numeric._ifftpow2(a,b);numeric.diveq(a,a.length);numeric.diveq(b,b.length)};
numeric.convpow2=function(a,b,d,c){numeric.fftpow2(a,b);numeric.fftpow2(d,c);var l,e,h,r,n;for(l=a.length-1;-1!==l;--l)e=a[l],r=b[l],h=d[l],n=c[l],a[l]=e*h-r*n,b[l]=e*n+r*h;numeric.ifftpow2(a,b)};
numeric.T.prototype.fft=function(){var a=this.x,b=this.y,d=a.length,c=Math.log,l=c(2),c=Math.ceil(c(2*d-1)/l),e=Math.pow(2,c),c=numeric.rep([e],0),l=numeric.rep([e],0),h=Math.cos,r=Math.sin,n,u=-3.141592653589793/d,v=numeric.rep([e],0),w=numeric.rep([e],0);for(n=0;n<d;n++)v[n]=a[n];if("undefined"!==typeof b)for(n=0;n<d;n++)w[n]=b[n];for(n=c[0]=1;n<=e/2;n++)a=u*n*n,c[n]=h(a),l[n]=r(a),c[e-n]=h(a),l[e-n]=r(a);a=new numeric.T(v,w);b=new numeric.T(c,l);a=a.mul(b);numeric.convpow2(a.x,a.y,numeric.clone(b.x),
numeric.neg(b.y));a=a.mul(b);a.x.length=d;a.y.length=d;return a};
numeric.T.prototype.ifft=function(){var a=this.x,b=this.y,d=a.length,c=Math.log,l=c(2),c=Math.ceil(c(2*d-1)/l),e=Math.pow(2,c),c=numeric.rep([e],0),l=numeric.rep([e],0),h=Math.cos,r=Math.sin,n,u=3.141592653589793/d,v=numeric.rep([e],0),w=numeric.rep([e],0);for(n=0;n<d;n++)v[n]=a[n];if("undefined"!==typeof b)for(n=0;n<d;n++)w[n]=b[n];for(n=c[0]=1;n<=e/2;n++)a=u*n*n,c[n]=h(a),l[n]=r(a),c[e-n]=h(a),l[e-n]=r(a);a=new numeric.T(v,w);b=new numeric.T(c,l);a=a.mul(b);numeric.convpow2(a.x,a.y,numeric.clone(b.x),
numeric.neg(b.y));a=a.mul(b);a.x.length=d;a.y.length=d;return a.div(d)};
numeric.gradient=function(a,b){var d=b.length,c=a(b);if(isNaN(c))throw Error("gradient: f(x) is a NaN!");var l=Math.max,e,h=numeric.clone(b),r,n,u=Array(d),v,l=Math.max,w=Math.abs,y=Math.min,E,C,H,G=0,k;for(e=0;e<d;e++)for(var M=l(1E-6*c,1E-8);;){++G;if(20<G)throw Error("Numerical gradient fails");h[e]=b[e]+M;r=a(h);h[e]=b[e]-M;n=a(h);h[e]=b[e];if(isNaN(r)||isNaN(n))M/=16;else if(u[e]=(r-n)/(2*M),E=b[e]-M,C=b[e],H=b[e]+M,v=(r-c)/M,k=(c-n)/M,r=l(w(u[e]),w(c),w(r),w(n),w(E),w(C),w(H),1E-8),v=y(l(w(v-
u[e]),w(k-u[e]),w(v-k))/r,M/r),.001<v)M/=16;else break}return u};
numeric.uncmin=function(a,b,d,c,l,e,h){var r=numeric.gradient;"undefined"===typeof h&&(h={});"undefined"===typeof d&&(d=1E-8);"undefined"===typeof c&&(c=function(k){return r(a,k)});"undefined"===typeof l&&(l=1E3);b=numeric.clone(b);var n=b.length,u=a(b),v,w;if(isNaN(u))throw Error("uncmin: f(x0) is a NaN!");var y=Math.max,E=numeric.norm2;d=y(d,numeric.epsilon);var C,H;h=h.Hinv||numeric.identity(n);var n=numeric.dot,y=numeric.sub,G=numeric.add,k=numeric.tensor,M=numeric.div,K=numeric.mul,R=numeric.all,
O=numeric.isFinite,Y=numeric.neg,ea=0,ha,A,P,T,W="";for(H=c(b);ea<l;){if("function"===typeof e&&e(ea,b,u,H,h)){W="Callback returned true";break}if(!R(O(H))){W="Gradient has Infinity or NaN";break}C=Y(n(h,H));if(!R(O(C))){W="Search direction has Infinity or NaN";break}T=E(C);if(T<d){W="Newton step smaller than tol";break}P=1;w=n(H,C);for(A=b;ea<l&&!(P*T<d);)if(ha=K(C,P),A=G(b,ha),v=a(A),v-u>=.1*P*w||isNaN(v))P*=.5,++ea;else break;if(P*T<d){W="Line search step size smaller than tol";break}if(ea===l){W=
"maxit reached during line search";break}w=c(A);b=y(w,H);H=n(b,ha);u=n(h,b);h=y(G(h,K((H+n(b,u))/(H*H),k(ha,ha))),M(G(k(u,ha),k(ha,u)),H));b=A;u=v;H=w;++ea}return{solution:b,f:u,gradient:H,invHessian:h,iterations:ea,message:W}};numeric.Dopri=function(a,b,d,c,l,e,h){this.x=a;this.y=b;this.f=d;this.ymid=c;this.iterations=l;this.events=h;this.message=e};
numeric.Dopri.prototype._at=function(a,b){function d(a){return a*a}var c=this.x,l=this.y,e=this.f,h=this.ymid,r,n,u,v=numeric.add,w=numeric.mul,y=numeric.sub,E;r=c[b];n=c[b+1];c=l[b];l=l[b+1];u=r+.5*(n-r);h=h[b];E=y(e[b],w(c,1/(r-u)+2/(r-n)));e=y(e[b+1],w(l,1/(n-u)+2/(n-r)));r=[d(a-n)*(a-u)/d(r-n)/(r-u),d(a-r)*d(a-n)/d(r-u)/d(n-u),d(a-r)*(a-u)/d(n-r)/(n-u),(a-r)*d(a-n)*(a-u)/d(r-n)/(r-u),(a-n)*d(a-r)*(a-u)/d(r-n)/(n-u)];return v(v(v(v(w(c,r[0]),w(h,r[1])),w(l,r[2])),w(E,r[3])),w(e,r[4]))};
numeric.Dopri.prototype.at=function(a){var b,d,c,l=Math.floor;if("number"!==typeof a){b=a.length;d=Array(b);for(--b;-1!==b;--b)d[b]=this.at(a[b]);return d}var e=this.x;b=0;for(d=e.length-1;1<d-b;)c=l(.5*(b+d)),e[c]<=a?b=c:d=c;return this._at(a,b)};
numeric.dopri=function(a,b,d,c,l,e,h){"undefined"===typeof l&&(l=1E-6);"undefined"===typeof e&&(e=1E3);var r=[a],n=[d],u=[c(a,d)],v,w,y,E,C,H,G=[],k=[.075,.225],M=[44/45,-56/15,32/9],K=[19372/6561,-25360/2187,64448/6561,-212/729],R=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],O=[35/384,0,500/1113,125/192,-2187/6784,11/84],Y=[.10013431883002395,0,.3918321794184259,-.02982460176594817,.05893268337240795,-.04497888809104361,.023904308236133973],ea=[.2,.3,.8,8/9,1,1],ha=[-71/57600,0,71/16695,-71/
1920,17253/339200,-22/525,.025],A=0,P,T=(b-a)/10,W=0,Z=numeric.add,S=numeric.mul,sa=Math.min,g=Math.abs,t=numeric.norminf,U=Math.pow,oa=numeric.any,na=numeric.lt,ja=numeric.and,aa,ia,ma=new numeric.Dopri(r,n,u,G,-1,"");for("function"===typeof h&&(aa=h(a,d));a<b&&W<e;)if(++W,a+T>b&&(T=b-a),v=c(a+ea[0]*T,Z(d,S(.2*T,u[A]))),w=c(a+ea[1]*T,Z(Z(d,S(k[0]*T,u[A])),S(k[1]*T,v))),y=c(a+ea[2]*T,Z(Z(Z(d,S(M[0]*T,u[A])),S(M[1]*T,v)),S(M[2]*T,w))),E=c(a+ea[3]*T,Z(Z(Z(Z(d,S(K[0]*T,u[A])),S(K[1]*T,v)),S(K[2]*T,w)),
S(K[3]*T,y))),C=c(a+ea[4]*T,Z(Z(Z(Z(Z(d,S(R[0]*T,u[A])),S(R[1]*T,v)),S(R[2]*T,w)),S(R[3]*T,y)),S(R[4]*T,E))),v=Z(Z(Z(Z(Z(d,S(u[A],T*O[0])),S(w,T*O[2])),S(y,T*O[3])),S(E,T*O[4])),S(C,T*O[5])),H=c(a+T,v),P=Z(Z(Z(Z(Z(S(u[A],T*ha[0]),S(w,T*ha[2])),S(y,T*ha[3])),S(E,T*ha[4])),S(C,T*ha[5])),S(H,T*ha[6])),P="number"===typeof P?g(P):t(P),P>l){if(T=.2*T*U(l/P,.25),a+T===a){ma.msg="Step size became too small";break}}else{G[A]=Z(Z(Z(Z(Z(Z(d,S(u[A],T*Y[0])),S(w,T*Y[2])),S(y,T*Y[3])),S(E,T*Y[4])),S(C,T*Y[5])),
S(H,T*Y[6]));++A;r[A]=a+T;n[A]=v;u[A]=H;if("function"===typeof h){var ka;w=a;y=a+.5*T;ia=h(y,G[A-1]);d=ja(na(aa,0),na(0,ia));oa(d)||(w=y,y=a+T,aa=ia,ia=h(y,v),d=ja(na(aa,0),na(0,ia)));if(oa(d)){l=0;for(r=e=1;;){if("number"===typeof aa)b=(r*ia*w-e*aa*y)/(r*ia-e*aa);else for(b=y,n=aa.length-1;-1!==n;--n)0>aa[n]&&0<ia[n]&&(b=sa(b,(r*ia[n]*w-e*aa[n]*y)/(r*ia[n]-e*aa[n])));if(b<=w||b>=y)break;ka=ma._at(b,A-1);u=h(b,ka);n=ja(na(aa,0),na(0,u));oa(n)?(y=b,ia=u,d=n,r=1,e=-1===l?.5*e:1,l=-1):(w=b,aa=u,e=1,
r=1===l?.5*r:1,l=1)}v=ma._at(.5*(a+b),A-1);ma.f[A]=c(b,ka);ma.x[A]=b;ma.y[A]=ka;ma.ymid[A-1]=v;ma.events=d;ma.iterations=W;return ma}}a+=T;d=v;aa=ia;T=sa(.8*T*U(l/P,.25),4*T)}ma.iterations=W;return ma};
numeric.LU=function(a,b){var d=Math.abs,c,l,e,h,r,n,u=a.length,v=u-1,w=Array(u);b||(a=numeric.clone(a));for(e=0;e<u;++e){r=e;h=a[e];n=d(h[e]);for(l=e+1;l<u;++l)c=d(a[l][e]),n<c&&(n=c,r=l);w[e]=r;r!=e&&(a[e]=a[r],a[r]=h,h=a[e]);l=h[e];for(c=e+1;c<u;++c)a[c][e]/=l;for(c=e+1;c<u;++c){r=a[c];for(l=e+1;l<v;++l)r[l]-=r[e]*h[l],++l,r[l]-=r[e]*h[l];l===v&&(r[l]-=r[e]*h[l])}}return{LU:a,P:w}};
numeric.LUsolve=function(a,b){var d,c,l=a.LU,e=l.length,h=numeric.clone(b),r=a.P,n;for(d=e-1;-1!==d;--d)h[d]=b[d];for(d=0;d<e;++d)for(c=r[d],r[d]!==d&&(n=h[d],h[d]=h[c],h[c]=n),n=l[d],c=0;c<d;++c)h[d]-=h[c]*n[c];for(d=e-1;0<=d;--d){n=l[d];for(c=d+1;c<e;++c)h[d]-=h[c]*n[c];h[d]/=n[d]}return h};numeric.solve=function(a,b,d){return numeric.LUsolve(numeric.LU(a,d),b)};
numeric.echelonize=function(a){var b=numeric.dim(a),d=b[0],b=b[1],c=numeric.identity(d),l=Array(d),e,h,r,n,u,v,w,y,E=Math.abs,C=numeric.diveq;a=numeric.clone(a);for(e=0;e<d;++e){r=0;u=a[e];v=c[e];for(h=1;h<b;++h)E(u[r])<E(u[h])&&(r=h);l[e]=r;C(v,u[r]);C(u,u[r]);for(h=0;h<d;++h)if(h!==e){w=a[h];y=w[r];for(n=b-1;-1!==n;--n)w[n]-=u[n]*y;w=c[h];for(n=d-1;-1!==n;--n)w[n]-=v[n]*y}}return{I:c,A:a,P:l}};
numeric.__solveLP=function(a,b,d,c,l,e,h){var r=numeric.sum,n=numeric.mul,u=numeric.sub,v=numeric.dot,w=numeric.div,y=numeric.add,E=a.length,C=d.length,H,G=!1,k=1;numeric.transpose(b);var M=numeric.transpose,K=Math.sqrt,R=Math.abs,O=Math.min,Y=numeric.all,ea=numeric.gt,ha=Array(E),A=Array(C);numeric.rep([C],1);var P=numeric.solve,T=u(d,v(b,e)),W,Z=v(a,a);for(W=0;W<l;++W){var S;for(S=C-1;-1!==S;--S)A[S]=w(b[S],T[S]);H=M(A);for(S=E-1;-1!==S;--S)ha[S]=r(H[S]);k=.25*R(Z/v(a,ha));S=100*K(Z/v(ha,ha));if(!isFinite(k)||
k>S)k=S;G=y(a,n(k,ha));H=v(H,A);for(S=E-1;-1!==S;--S)H[S][S]+=1;H=P(H,w(G,k),!0);var T=w(T,v(b,H)),sa=1;for(S=C-1;-1!==S;--S)0>T[S]&&(sa=O(sa,-.999*T[S]));H=u(e,n(H,sa));T=u(d,v(b,H));if(!Y(ea(T,0)))return{solution:e,message:"",iterations:W};e=H;if(k<c)return{solution:H,message:"",iterations:W};if(h)for(k=v(a,G),sa=v(b,G),G=!0,S=C-1;-1!==S;--S){if(0>k*sa[S]){G=!1;break}}else G=0<=e[E-1]?!1:!0;if(G)return{solution:H,message:"Unbounded",iterations:W}}return{solution:e,message:"maximum iteration count exceeded",
iterations:W}};
numeric._solveLP=function(a,b,d,c,l){var e=a.length,h=d.length,r=numeric.sub,n=numeric.dot,u=numeric.rep([e],0).concat([1]),h=numeric.rep([h,1],-1),v=numeric.blockMatrix([[b,h]]),h=numeric.rep([e],0).concat(Math.max(0,numeric.sup(numeric.neg(d)))+1),u=numeric.__solveLP(u,v,d,c,l,h,!1),h=numeric.clone(u.solution);h.length=e;if(0>numeric.inf(r(d,n(b,h))))return{solution:NaN,message:"Infeasible",iterations:u.iterations};a=numeric.__solveLP(a,b,d,c,l-u.iterations,h,!0);a.iterations+=u.iterations;return a};
numeric.solveLP=function(a,b,d,c,l,e,h){"undefined"===typeof h&&(h=1E3);"undefined"===typeof e&&(e=numeric.epsilon);if("undefined"===typeof c)return numeric._solveLP(a,b,d,e,h);var r=c.length,n=c[0].length,u=b.length,v=numeric.echelonize(c),w=numeric.rep([n],0),y=v.P,E=[],C;for(C=y.length-1;-1!==C;--C)w[y[C]]=1;for(C=n-1;-1!==C;--C)0===w[C]&&E.push(C);C=numeric.getRange;r=numeric.linspace(0,r-1);u=numeric.linspace(0,u-1);c=C(c,r,E);r=C(b,u,y);C=C(b,u,E);b=numeric.dot;u=numeric.sub;n=b(r,v.I);r=u(C,
b(n,c));d=u(d,b(n,l));n=Array(y.length);w=Array(E.length);for(C=y.length-1;-1!==C;--C)n[C]=a[y[C]];for(C=E.length-1;-1!==C;--C)w[C]=a[E[C]];C=u(w,b(n,b(v.I,c)));e=numeric._solveLP(C,r,d,e,h);h=e.solution;if(h!==h)return e;l=b(v.I,u(l,b(c,h)));a=Array(a.length);for(C=y.length-1;-1!==C;--C)a[y[C]]=l[C];for(C=E.length-1;-1!==C;--C)a[E[C]]=h[C];return{solution:a,message:e.message,iterations:e.iterations}};
numeric.MPStoLP=function(a){function b(k){throw Error("MPStoLP: "+k+"\nLine "+e+": "+a[e]+"\nCurrent state: "+c[d]+"\n");}a instanceof String&&a.split("\n");var d=0,c="Initial state;NAME;ROWS;COLUMNS;RHS;BOUNDS;ENDATA".split(";"),l=a.length,e,h,r,n=0,u={},v=[],w=0,y={},E=0,C,H=[],G=[],k=[];for(e=0;e<l;++e){r=a[e];var M=r.match(/\S*/g),K=[];for(h=0;h<M.length;++h)""!==M[h]&&K.push(M[h]);if(0!==K.length){for(h=0;h<c.length&&r.substr(0,c[h].length)!==c[h];++h);if(h<c.length){if(d=h,1===h&&(C=K[1]),6===
h)return{name:C,c:H,A:numeric.transpose(G),b:k,rows:u,vars:y}}else switch(d){case 0:case 1:b("Unexpected line");case 2:switch(K[0]){case "N":0===n?n=K[1]:b("Two or more N rows");break;case "L":u[K[1]]=w;v[w]=1;k[w]=0;++w;break;case "G":u[K[1]]=w;v[w]=-1;k[w]=0;++w;break;case "E":u[K[1]]=w;v[w]=0;k[w]=0;++w;break;default:b("Parse error "+numeric.prettyPrint(K))}break;case 3:y.hasOwnProperty(K[0])||(y[K[0]]=E,H[E]=0,G[E]=numeric.rep([w],0),++E);r=y[K[0]];for(h=1;h<K.length;h+=2)K[h]===n?H[r]=parseFloat(K[h+
1]):(M=u[K[h]],G[r][M]=(0>v[M]?-1:1)*parseFloat(K[h+1]));break;case 4:for(h=1;h<K.length;h+=2)k[u[K[h]]]=(0>v[u[K[h]]]?-1:1)*parseFloat(K[h+1]);break;case 6:b("Internal error")}}}b("Reached end of file without ENDATA")};numeric.seedrandom={pow:Math.pow,random:Math.random};
(function(a,b,d,c,l,e,h){function r(a){var b,c,e=this,h=a.length,l=0,n=e.i=e.j=e.m=0;e.S=[];e.c=[];for(h||(a=[h++]);l<d;)e.S[l]=l++;for(l=0;l<d;l++)b=e.S[l],n=n+b+a[l%h]&d-1,c=e.S[n],e.S[l]=c,e.S[n]=b;e.g=function(a){var b=e.S,c=e.i+1&d-1,h=b[c],l=e.j+h&d-1,n=b[l];b[c]=n;b[l]=h;for(var r=b[h+n&d-1];--a;)c=c+1&d-1,h=b[c],l=l+h&d-1,n=b[l],b[c]=n,b[l]=h,r=r*d+b[h+n&d-1];e.i=c;e.j=l;return r};e.g(d)}function n(a,b,d,c,e){d=[];e=typeof a;if(b&&"object"==e)for(c in a)if(5>c.indexOf("S"))try{d.push(n(a[c],
b-1))}catch(h){}return d.length?d:a+("string"!=e?"\x00":"")}function u(a,b,c,e){a+="";for(e=c=0;e<a.length;e++){var h=e&d-1,l=(c^=19*b[e&d-1])+a.charCodeAt(e);b[h]=l&d-1}a="";for(e in b)a+=String.fromCharCode(b[e]);return a}b.seedrandom=function(v,w){var y=[],E;v=u(n(w?[v,a]:arguments.length?v:[(new Date).getTime(),a,window],3),y);E=new r(y);u(E.S,a);b.random=function(){for(var a=E.g(c),b=h,n=0;a<l;)a=(a+n)*d,b*=d,n=E.g(1);for(;a>=e;)a/=2,b/=2,n>>>=1;return(a+n)/b};return v};h=b.pow(d,c);l=b.pow(2,
l);e=2*l;u(b.random(),a)})([],numeric.seedrandom,256,6,52);
(function(a){function b(a){if("object"!==typeof a)return a;var d=[],c,e=a.length;for(c=0;c<e;c++)d[c+1]=b(a[c]);return d}function d(a){if("object"!==typeof a)return a;var b=[],c,e=a.length;for(c=1;c<e;c++)b[c-1]=d(a[c]);return b}function c(a,b,d){var c,e,h;for(b=1;b<=d;b+=1){a[b][b]=1/a[b][b];h=-a[b][b];for(c=1;c<b;c+=1)a[c][b]*=h;c=b+1;if(d<c)break;for(e=c;e<=d;e+=1)for(h=a[b][e],a[b][e]=0,c=1;c<=b;c+=1)a[c][e]+=h*a[c][b]}}function l(a,b,d,c){var e,h,l;for(e=1;e<=d;e+=1){l=0;for(b=1;b<e;b+=1)l+=
a[b][e]*c[b];c[e]=(c[e]-l)/a[e][e]}for(h=1;h<=d;h+=1)for(e=d+1-h,c[e]/=a[e][e],l=-c[e],b=1;b<e;b+=1)c[b]+=l*a[b][e]}function e(a,b,c,d){var e,h,l,C,H;for(e=1;e<=c;e+=1){d[1]=e;H=0;h=e-1;if(!(1>h))for(l=1;l<=h;l+=1){C=a[l][e];for(b=1;b<l;b+=1)C-=a[b][e]*a[b][l];C/=a[l][l];a[l][e]=C;H+=C*C}H=a[e][e]-H;if(0>=H)break;a[e][e]=Math.sqrt(H);d[1]=0}}function h(a,b,d,h,w,y,E,C,H,G,k,M,K,R,O,Y){function ea(){for(A=1;A<=h;A+=1){aa=0;for(P=1;P<=h;P+=1)aa+=a[P][A]*E[P][na];O[A]=aa}W=sa;for(A=1;A<=h;A+=1)O[W+A]=
0;for(P=K+1;P<=h;P+=1)for(A=1;A<=h;A+=1)O[W+A]+=a[A][P]*O[P];Sa=!0;for(A=K;1<=A;--A){aa=O[A];T=t+A*(A+3)/2;W=T-A;for(P=A+1;P<=K;P+=1)aa-=O[T]*O[g+P],T+=P;aa/=O[W];O[g+A]=aa;if(M[A]<k)break;if(0>aa)break;Sa=!1;S=A}if(!Sa)for(ia=O[oa+S]/O[g+S],A=1;A<=K&&!(M[A]<k)&&!(0>O[g+A]);A+=1)ja=O[oa+A]/O[g+A],ja<ia&&(ia=ja,S=A);aa=0;for(A=sa+1;A<=sa+h;A+=1)aa+=O[A]*O[A];if(Math.abs(aa)<=Ha){if(Sa)return Y[1]=1,999;for(A=1;A<=K;A+=1)O[oa+A]-=ia*O[g+A];O[oa+K+1]+=ia;return 700}aa=0;for(A=1;A<=h;A+=1)aa+=O[sa+A]*
E[A][na];ma=-O[U+na]/aa;ab=!0;!Sa&&ia<ma&&(ma=ia,ab=!1);for(A=1;A<=h;A+=1)w[A]+=ma*O[sa+A],Math.abs(w[A])<Ha&&(w[A]=0);y[1]+=ma*aa*(ma/2+O[oa+K+1]);for(A=1;A<=K;A+=1)O[oa+A]-=ma*O[g+A];O[oa+K+1]+=ma;if(ab){K+=1;M[K]=na;T=t+(K-1)*K/2+1;for(A=1;A<=K-1;A+=1)O[T]=O[A],T+=1;if(K===h)O[T]=O[h];else{for(A=h;A>=K+1&&0!==O[A];--A){ka=Math.max(Math.abs(O[A-1]),Math.abs(O[A]));ta=Math.min(Math.abs(O[A-1]),Math.abs(O[A]));ja=0<=O[A-1]?Math.abs(ka*Math.sqrt(1+ta*ta/(ka*ka))):-Math.abs(ka*Math.sqrt(1+ta*ta/(ka*
ka)));ka=O[A-1]/ja;ta=O[A]/ja;if(1===ka)break;if(0===ka)for(O[A-1]=ta*ja,P=1;P<=h;P+=1)ja=a[P][A-1],a[P][A-1]=a[P][A],a[P][A]=ja;else for(O[A-1]=ja,Na=ta/(1+ka),P=1;P<=h;P+=1)ja=ka*a[P][A-1]+ta*a[P][A],a[P][A]=Na*(a[P][A-1]+ja)-a[P][A],a[P][A-1]=ja}O[T]=O[K]}}else{aa=-C[na];for(P=1;P<=h;P+=1)aa+=w[P]*E[P][na];if(na>k)O[U+na]=aa;else if(O[U+na]=-Math.abs(aa),0<aa){for(P=1;P<=h;P+=1)E[P][na]=-E[P][na];C[na]=-C[na]}return 700}return 0}function ha(){T=t+S*(S+1)/2+1;W=T+S;if(0===O[W])return 798;ka=Math.max(Math.abs(O[W-
1]),Math.abs(O[W]));ta=Math.min(Math.abs(O[W-1]),Math.abs(O[W]));ja=0<=O[W-1]?Math.abs(ka*Math.sqrt(1+ta*ta/(ka*ka))):-Math.abs(ka*Math.sqrt(1+ta*ta/(ka*ka)));ka=O[W-1]/ja;ta=O[W]/ja;if(1===ka)return 798;if(0===ka){for(A=S+1;A<=K;A+=1)ja=O[W-1],O[W-1]=O[W],O[W]=ja,W+=A;for(A=1;A<=h;A+=1)ja=a[A][S],a[A][S]=a[A][S+1],a[A][S+1]=ja}else{Na=ta/(1+ka);for(A=S+1;A<=K;A+=1)ja=ka*O[W-1]+ta*O[W],O[W]=Na*(O[W-1]+ja)-O[W],O[W-1]=ja,W+=A;for(A=1;A<=h;A+=1)ja=ka*a[A][S]+ta*a[A][S+1],a[A][S+1]=Na*(a[A][S]+ja)-a[A][S+
1],a[A][S]=ja}return 0}var A,P,T,W,Z,S,sa,g,t,U,oa,na,ja,aa,ia,ma,ka,ta,Na,Sa,ab,Ha,bb;H=Math.min(h,G);T=2*h+H*(H+5)/2+2*G+1;Ha=1E-60;do Ha+=Ha,Z=1+.1*Ha,bb=1+.2*Ha;while(1>=Z||1>=bb);for(A=1;A<=h;A+=1)O[A]=b[A];for(A=h+1;A<=T;A+=1)O[A]=0;for(A=1;A<=G;A+=1)M[A]=0;Z=[];if(0===Y[1]){e(a,d,h,Z);if(0!==Z[1]){Y[1]=2;return}l(a,d,h,b);c(a,d,h)}else{for(P=1;P<=h;P+=1)for(w[P]=0,A=1;A<=P;A+=1)w[P]+=a[A][P]*b[A];for(P=1;P<=h;P+=1)for(b[P]=0,A=P;A<=h;A+=1)b[P]+=a[P][A]*w[A]}y[1]=0;for(P=1;P<=h;P+=1)for(w[P]=
b[P],y[1]+=O[P]*w[P],O[P]=0,A=P+1;A<=h;A+=1)a[A][P]=0;y[1]=-y[1]/2;Y[1]=0;sa=h;g=sa+h;oa=g+H;t=oa+H+1;U=t+H*(H+1)/2;b=U+G;for(A=1;A<=G;A+=1){aa=0;for(P=1;P<=h;P+=1)aa+=E[P][A]*E[P][A];O[b+A]=Math.sqrt(aa)}K=0;R[1]=0;for(d=R[2]=0;;){R[1]+=1;T=U;for(A=1;A<=G;A+=1){T+=1;aa=-C[A];for(P=1;P<=h;P+=1)aa+=E[P][A]*w[P];Math.abs(aa)<Ha&&(aa=0);if(A>k)O[T]=aa;else if(O[T]=-Math.abs(aa),0<aa){for(P=1;P<=h;P+=1)E[P][A]=-E[P][A];C[A]=-C[A]}}for(A=1;A<=K;A+=1)O[U+M[A]]=0;ja=na=0;for(A=1;A<=G;A+=1)O[U+A]<ja*O[b+
A]&&(na=A,ja=O[U+A]/O[b+A]);d=0===na?999:0;if(999===d)break;for(;;){d=ea();if(0===d)break;if(999===d)return;if(700===d){if(S!==K)for(;;){ha();W=T-S;for(A=1;A<=S;A+=1)O[W]=O[T],T+=1,W+=1;O[oa+S]=O[oa+S+1];M[S]=M[S+1];S+=1;d=S<K?797:0;if(797!==d)break}O[oa+K]=O[oa+K+1];O[oa+K+1]=0;M[K]=0;--K;R[2]+=1}}}}a.solveQP=function(a,c,e,l,w,y){a=b(a);c=b(c);e=b(e);var E,C,H,G,k=[],M=[],K=[],R=[],O=[];w=w||0;y=y?b(y):[void 0,0];l=l?b(l):[];C=a.length-1;H=e[1].length-1;if(!l)for(E=1;E<=H;E+=1)l[E]=0;for(E=1;E<=
H;E+=1)M[E]=0;G=Math.min(C,H);for(E=1;E<=C;E+=1)K[E]=0;k[1]=0;for(E=1;E<=2*C+G*(G+5)/2+2*H+1;E+=1)R[E]=0;for(E=1;2>=E;E+=1)O[E]=0;h(a,c,C,C,K,k,e,l,C,H,w,M,0,O,R,y);a="";1===y[1]&&(a="constraints are inconsistent, no solution!");2===y[1]&&(a="matrix D in quadratic function is not positive definite!");return{solution:d(K),value:d(k),unconstrained_solution:d(c),iterations:d(O),iact:d(M),message:a}}})(numeric);
numeric.svd=function(a){function b(a,b){a=Math.abs(a);b=Math.abs(b);return a>b?a*Math.sqrt(1+b*b/a/a):0==b?a:b*Math.sqrt(1+a*a/b/b)}var d;d=numeric.epsilon;var c=1E-64/d,l=0,e=0,h=0,r=0,n=0;a=numeric.clone(a);var u=a.length,v=a[0].length;if(u<v)throw"Need more rows than columns";for(var w=Array(v),y=Array(v),e=0;e<v;e++)w[e]=y[e]=0;for(var E=numeric.rep([v,v],0),C=0,H=0,G=0,k=0,M=0,K=0,R=0,e=0;e<v;e++){w[e]=H;R=0;n=e+1;for(h=e;h<u;h++)R+=a[h][e]*a[h][e];if(R<=c)H=0;else for(C=a[e][e],H=Math.sqrt(R),
0<=C&&(H=-H),G=C*H-R,a[e][e]=C-H,h=n;h<v;h++){R=0;for(r=e;r<u;r++)R+=a[r][e]*a[r][h];C=R/G;for(r=e;r<u;r++)a[r][h]+=C*a[r][e]}y[e]=H;R=0;for(h=n;h<v;h++)R+=a[e][h]*a[e][h];if(R<=c)H=0;else{C=a[e][e+1];H=Math.sqrt(R);0<=C&&(H=-H);G=C*H-R;a[e][e+1]=C-H;for(h=n;h<v;h++)w[h]=a[e][h]/G;for(h=n;h<u;h++){R=0;for(r=n;r<v;r++)R+=a[h][r]*a[e][r];for(r=n;r<v;r++)a[h][r]+=R*w[r]}}M=Math.abs(y[e])+Math.abs(w[e]);M>k&&(k=M)}for(e=v-1;-1!=e;e+=-1){if(0!=H){G=H*a[e][e+1];for(h=n;h<v;h++)E[h][e]=a[e][h]/G;for(h=n;h<
v;h++){R=0;for(r=n;r<v;r++)R+=a[e][r]*E[r][h];for(r=n;r<v;r++)E[r][h]+=R*E[r][e]}}for(h=n;h<v;h++)E[e][h]=0,E[h][e]=0;E[e][e]=1;H=w[e];n=e}for(e=v-1;-1!=e;e+=-1){n=e+1;H=y[e];for(h=n;h<v;h++)a[e][h]=0;if(0!=H){G=a[e][e]*H;for(h=n;h<v;h++){R=0;for(r=n;r<u;r++)R+=a[r][e]*a[r][h];C=R/G;for(r=e;r<u;r++)a[r][h]+=C*a[r][e]}for(h=e;h<u;h++)a[h][e]/=H}else for(h=e;h<u;h++)a[h][e]=0;a[e][e]+=1}d*=k;for(r=v-1;-1!=r;r+=-1)for(c=0;50>c;c++){e=!1;for(n=r;-1!=n;n+=-1){if(Math.abs(w[n])<=d){e=!0;break}if(Math.abs(y[n-
1])<=d)break}if(!e)for(l=0,R=1,k=n-1,e=n;e<r+1;e++){C=R*w[e];w[e]*=l;if(Math.abs(C)<=d)break;H=y[e];G=b(C,H);y[e]=G;l=H/G;R=-C/G;for(h=0;h<u;h++)M=a[h][k],K=a[h][e],a[h][k]=M*l+K*R,a[h][e]=-M*R+K*l}K=y[r];if(n==r){if(0>K)for(y[r]=-K,h=0;h<v;h++)E[h][r]=-E[h][r];break}if(49<=c)throw"Error: no convergence.";k=y[n];M=y[r-1];H=w[r-1];G=w[r];C=((M-K)*(M+K)+(H-G)*(H+G))/(2*G*M);H=b(C,1);C=0>C?((k-K)*(k+K)+G*(M/(C-H)-G))/k:((k-K)*(k+K)+G*(M/(C+H)-G))/k;R=l=1;for(e=n+1;e<r+1;e++){H=w[e];M=y[e];G=R*H;H*=l;
K=b(C,G);w[e-1]=K;l=C/K;R=G/K;C=k*l+H*R;H=-k*R+H*l;G=M*R;M*=l;for(h=0;h<v;h++)k=E[h][e-1],K=E[h][e],E[h][e-1]=k*l+K*R,E[h][e]=-k*R+K*l;K=b(C,G);y[e-1]=K;l=C/K;R=G/K;C=l*H+R*M;k=-R*H+l*M;for(h=0;h<u;h++)M=a[h][e-1],K=a[h][e],a[h][e-1]=M*l+K*R,a[h][e]=-M*R+K*l}w[n]=0;w[r]=C;y[r]=k}for(e=0;e<y.length;e++)y[e]<d&&(y[e]=0);for(e=0;e<v;e++)for(h=e-1;0<=h;h--)if(y[h]<y[e]){l=y[h];y[h]=y[e];y[e]=l;for(r=0;r<a.length;r++)d=a[r][e],a[r][e]=a[r][h],a[r][h]=d;for(r=0;r<E.length;r++)d=E[r][e],E[r][e]=E[r][h],
E[r][h]=d;e=h}return{U:a,S:y,V:E}};
(function(){function a(g,t,a){k.biginteger_used=1;null!=g&&("number"==typeof g&&"undefined"==typeof t?this.fromInt(g):"number"==typeof g?this.fromNumber(g,t,a):null==t&&"string"!=typeof g?this.fromString(g,256):this.fromString(g,t))}function b(){return new a(null)}function d(g,t,a,b,d,c){for(;0<=--c;){var k=t*this[g++]+a[b]+d;d=Math.floor(k/67108864);a[b++]=k&67108863}return d}function c(g,t,a,b,d,c){var k=t&32767;for(t>>=15;0<=--c;){var e=this[g]&32767,h=this[g++]>>15,l=t*e+h*k,e=k*e+((l&32767)<<
15)+a[b]+(d&1073741823);d=(e>>>30)+(l>>>15)+t*h+(d>>>30);a[b++]=e&1073741823}return d}function l(g,t,a,b,d,c){var k=t&16383;for(t>>=14;0<=--c;){var e=this[g]&16383,h=this[g++]>>14,l=t*e+h*k,e=k*e+((l&16383)<<14)+a[b]+d;d=(e>>28)+(l>>14)+t*h;a[b++]=e&268435455}return d}function e(g,t){var a=T[g.charCodeAt(t)];return null==a?-1:a}function h(g){var t=b();t.fromInt(g);return t}function r(g){var t=1,a;0!=(a=g>>>16)&&(g=a,t+=16);0!=(a=g>>8)&&(g=a,t+=8);0!=(a=g>>4)&&(g=a,t+=4);0!=(a=g>>2)&&(g=a,t+=2);0!=
g>>1&&(t+=1);return t}function n(g){this.m=g}function u(g){this.m=g;this.mp=g.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<g.DB-15)-1;this.mt2=2*g.t}function v(g,t){return g&t}function w(g,t){return g|t}function y(g,t){return g^t}function E(g,t){return g&~t}function C(){}function H(g){return g}function G(g){this.r2=b();this.q3=b();a.ONE.dlShiftTo(2*g.t,this.r2);this.mu=this.r2.divide(g);this.m=g}var k={},M=!1;"undefined"!==typeof module&&module.exports?(module.exports=k,M=!0):
"undefined"!==typeof document?window.ClipperLib=k:self.ClipperLib=k;var K;if(M)R="chrome",K="Netscape";else{var R=navigator.userAgent.toString().toLowerCase();K=navigator.appName}var O,Y,ea,ha,A,P;O=-1!=R.indexOf("chrome")&&-1==R.indexOf("chromium")?1:0;M=-1!=R.indexOf("chromium")?1:0;Y=-1!=R.indexOf("safari")&&-1==R.indexOf("chrome")&&-1==R.indexOf("chromium")?1:0;ea=-1!=R.indexOf("firefox")?1:0;R.indexOf("firefox/17");R.indexOf("firefox/15");R.indexOf("firefox/3");ha=-1!=R.indexOf("opera")?1:0;
R.indexOf("msie 10");R.indexOf("msie 9");A=-1!=R.indexOf("msie 8")?1:0;P=-1!=R.indexOf("msie 7")?1:0;R=-1!=R.indexOf("msie ")?1:0;k.biginteger_used=null;"Microsoft Internet Explorer"==K?(a.prototype.am=c,K=30):"Netscape"!=K?(a.prototype.am=d,K=26):(a.prototype.am=l,K=28);a.prototype.DB=K;a.prototype.DM=(1<<K)-1;a.prototype.DV=1<<K;a.prototype.FV=Math.pow(2,52);a.prototype.F1=52-K;a.prototype.F2=2*K-52;var T=[],W;K=48;for(W=0;9>=W;++W)T[K++]=W;K=97;for(W=10;36>W;++W)T[K++]=W;K=65;for(W=10;36>W;++W)T[K++]=
W;n.prototype.convert=function(g){return 0>g.s||0<=g.compareTo(this.m)?g.mod(this.m):g};n.prototype.revert=function(g){return g};n.prototype.reduce=function(g){g.divRemTo(this.m,null,g)};n.prototype.mulTo=function(g,t,a){g.multiplyTo(t,a);this.reduce(a)};n.prototype.sqrTo=function(g,t){g.squareTo(t);this.reduce(t)};u.prototype.convert=function(g){var t=b();g.abs().dlShiftTo(this.m.t,t);t.divRemTo(this.m,null,t);0>g.s&&0<t.compareTo(a.ZERO)&&this.m.subTo(t,t);return t};u.prototype.revert=function(g){var t=
b();g.copyTo(t);this.reduce(t);return t};u.prototype.reduce=function(g){for(;g.t<=this.mt2;)g[g.t++]=0;for(var t=0;t<this.m.t;++t){var a=g[t]&32767,b=a*this.mpl+((a*this.mph+(g[t]>>15)*this.mpl&this.um)<<15)&g.DM,a=t+this.m.t;for(g[a]+=this.m.am(0,b,g,t,0,this.m.t);g[a]>=g.DV;)g[a]-=g.DV,g[++a]++}g.clamp();g.drShiftTo(this.m.t,g);0<=g.compareTo(this.m)&&g.subTo(this.m,g)};u.prototype.mulTo=function(g,t,a){g.multiplyTo(t,a);this.reduce(a)};u.prototype.sqrTo=function(g,t){g.squareTo(t);this.reduce(t)};
a.prototype.copyTo=function(g){for(var t=this.t-1;0<=t;--t)g[t]=this[t];g.t=this.t;g.s=this.s};a.prototype.fromInt=function(g){this.t=1;this.s=0>g?-1:0;0<g?this[0]=g:-1>g?this[0]=g+this.DV:this.t=0};a.prototype.fromString=function(g,t){var U;if(16==t)U=4;else if(8==t)U=3;else if(256==t)U=8;else if(2==t)U=1;else if(32==t)U=5;else if(4==t)U=2;else{this.fromRadix(g,t);return}this.s=this.t=0;for(var b=g.length,d=!1,c=0;0<=--b;){var k=8==U?g[b]&255:e(g,b);0>k?"-"==g.charAt(b)&&(d=!0):(d=!1,0==c?this[this.t++]=
k:c+U>this.DB?(this[this.t-1]|=(k&(1<<this.DB-c)-1)<<c,this[this.t++]=k>>this.DB-c):this[this.t-1]|=k<<c,c+=U,c>=this.DB&&(c-=this.DB))}8==U&&0!=(g[0]&128)&&(this.s=-1,0<c&&(this[this.t-1]|=(1<<this.DB-c)-1<<c));this.clamp();d&&a.ZERO.subTo(this,this)};a.prototype.clamp=function(){for(var g=this.s&this.DM;0<this.t&&this[this.t-1]==g;)--this.t};a.prototype.dlShiftTo=function(g,t){var a;for(a=this.t-1;0<=a;--a)t[a+g]=this[a];for(a=g-1;0<=a;--a)t[a]=0;t.t=this.t+g;t.s=this.s};a.prototype.drShiftTo=function(g,
t){for(var a=g;a<this.t;++a)t[a-g]=this[a];t.t=Math.max(this.t-g,0);t.s=this.s};a.prototype.lShiftTo=function(g,t){var a=g%this.DB,b=this.DB-a,d=(1<<b)-1,c=Math.floor(g/this.DB),k=this.s<<a&this.DM,e;for(e=this.t-1;0<=e;--e)t[e+c+1]=this[e]>>b|k,k=(this[e]&d)<<a;for(e=c-1;0<=e;--e)t[e]=0;t[c]=k;t.t=this.t+c+1;t.s=this.s;t.clamp()};a.prototype.rShiftTo=function(g,t){t.s=this.s;var a=Math.floor(g/this.DB);if(a>=this.t)t.t=0;else{var b=g%this.DB,c=this.DB-b,d=(1<<b)-1;t[0]=this[a]>>b;for(var k=a+1;k<
this.t;++k)t[k-a-1]|=(this[k]&d)<<c,t[k-a]=this[k]>>b;0<b&&(t[this.t-a-1]|=(this.s&d)<<c);t.t=this.t-a;t.clamp()}};a.prototype.subTo=function(g,t){for(var a=0,b=0,c=Math.min(g.t,this.t);a<c;)b+=this[a]-g[a],t[a++]=b&this.DM,b>>=this.DB;if(g.t<this.t){for(b-=g.s;a<this.t;)b+=this[a],t[a++]=b&this.DM,b>>=this.DB;b+=this.s}else{for(b+=this.s;a<g.t;)b-=g[a],t[a++]=b&this.DM,b>>=this.DB;b-=g.s}t.s=0>b?-1:0;-1>b?t[a++]=this.DV+b:0<b&&(t[a++]=b);t.t=a;t.clamp()};a.prototype.multiplyTo=function(g,t){var U=
this.abs(),b=g.abs(),c=U.t;for(t.t=c+b.t;0<=--c;)t[c]=0;for(c=0;c<b.t;++c)t[c+U.t]=U.am(0,b[c],t,c,0,U.t);t.s=0;t.clamp();this.s!=g.s&&a.ZERO.subTo(t,t)};a.prototype.squareTo=function(g){for(var t=this.abs(),a=g.t=2*t.t;0<=--a;)g[a]=0;for(a=0;a<t.t-1;++a){var b=t.am(a,t[a],g,2*a,0,1);(g[a+t.t]+=t.am(a+1,2*t[a],g,2*a+1,b,t.t-a-1))>=t.DV&&(g[a+t.t]-=t.DV,g[a+t.t+1]=1)}0<g.t&&(g[g.t-1]+=t.am(a,t[a],g,2*a,0,1));g.s=0;g.clamp()};a.prototype.divRemTo=function(g,t,U){var c=g.abs();if(!(0>=c.t)){var d=this.abs();
if(d.t<c.t)null!=t&&t.fromInt(0),null!=U&&this.copyTo(U);else{null==U&&(U=b());var k=b(),e=this.s;g=g.s;var h=this.DB-r(c[c.t-1]);0<h?(c.lShiftTo(h,k),d.lShiftTo(h,U)):(c.copyTo(k),d.copyTo(U));c=k.t;d=k[c-1];if(0!=d){var l=d*(1<<this.F1)+(1<c?k[c-2]>>this.F2:0),n=this.FV/l,l=(1<<this.F1)/l,u=1<<this.F2,v=U.t,w=v-c,y=null==t?b():t;k.dlShiftTo(w,y);0<=U.compareTo(y)&&(U[U.t++]=1,U.subTo(y,U));a.ONE.dlShiftTo(c,y);for(y.subTo(k,k);k.t<c;)k[k.t++]=0;for(;0<=--w;){var A=U[--v]==d?this.DM:Math.floor(U[v]*
n+(U[v-1]+u)*l);if((U[v]+=k.am(0,A,U,w,0,c))<A)for(k.dlShiftTo(w,y),U.subTo(y,U);U[v]<--A;)U.subTo(y,U)}null!=t&&(U.drShiftTo(c,t),e!=g&&a.ZERO.subTo(t,t));U.t=c;U.clamp();0<h&&U.rShiftTo(h,U);0>e&&a.ZERO.subTo(U,U)}}}};a.prototype.invDigit=function(){if(1>this.t)return 0;var g=this[0];if(0==(g&1))return 0;var t=g&3,t=t*(2-(g&15)*t)&15,t=t*(2-(g&255)*t)&255,t=t*(2-((g&65535)*t&65535))&65535,t=t*(2-g*t%this.DV)%this.DV;return 0<t?this.DV-t:-t};a.prototype.isEven=function(){return 0==(0<this.t?this[0]&
1:this.s)};a.prototype.exp=function(g,t){if(4294967295<g||1>g)return a.ONE;var U=b(),c=b(),d=t.convert(this),k=r(g)-1;for(d.copyTo(U);0<=--k;)if(t.sqrTo(U,c),0<(g&1<<k))t.mulTo(c,d,U);else var e=U,U=c,c=e;return t.revert(U)};a.prototype.toString=function(g){if(0>this.s)return"-"+this.negate().toString(g);if(16==g)g=4;else if(8==g)g=3;else if(2==g)g=1;else if(32==g)g=5;else if(4==g)g=2;else return this.toRadix(g);var t=(1<<g)-1,a,b=!1,c="",d=this.t,k=this.DB-d*this.DB%g;if(0<d--)for(k<this.DB&&0<(a=
this[d]>>k)&&(b=!0,c="0123456789abcdefghijklmnopqrstuvwxyz".charAt(a));0<=d;)k<g?(a=(this[d]&(1<<k)-1)<<g-k,a|=this[--d]>>(k+=this.DB-g)):(a=this[d]>>(k-=g)&t,0>=k&&(k+=this.DB,--d)),0<a&&(b=!0),b&&(c+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(a));return b?c:"0"};a.prototype.negate=function(){var g=b();a.ZERO.subTo(this,g);return g};a.prototype.abs=function(){return 0>this.s?this.negate():this};a.prototype.compareTo=function(g){var t=this.s-g.s;if(0!=t)return t;var a=this.t,t=a-g.t;if(0!=t)return 0>
this.s?-t:t;for(;0<=--a;)if(0!=(t=this[a]-g[a]))return t;return 0};a.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+r(this[this.t-1]^this.s&this.DM)};a.prototype.mod=function(g){var t=b();this.abs().divRemTo(g,null,t);0>this.s&&0<t.compareTo(a.ZERO)&&g.subTo(t,t);return t};a.prototype.modPowInt=function(g,t){var a;a=256>g||t.isEven()?new n(t):new u(t);return this.exp(g,a)};a.ZERO=h(0);a.ONE=h(1);C.prototype.convert=H;C.prototype.revert=H;C.prototype.mulTo=function(g,t,a){g.multiplyTo(t,
a)};C.prototype.sqrTo=function(g,t){g.squareTo(t)};G.prototype.convert=function(g){if(0>g.s||g.t>2*this.m.t)return g.mod(this.m);if(0>g.compareTo(this.m))return g;var t=b();g.copyTo(t);this.reduce(t);return t};G.prototype.revert=function(g){return g};G.prototype.reduce=function(g){g.drShiftTo(this.m.t-1,this.r2);g.t>this.m.t+1&&(g.t=this.m.t+1,g.clamp());this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);for(this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);0>g.compareTo(this.r2);)g.dAddOffset(1,
this.m.t+1);for(g.subTo(this.r2,g);0<=g.compareTo(this.m);)g.subTo(this.m,g)};G.prototype.mulTo=function(g,t,a){g.multiplyTo(t,a);this.reduce(a)};G.prototype.sqrTo=function(g,t){g.squareTo(t);this.reduce(t)};var Z=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,
409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],S=67108864/Z[Z.length-1];a.prototype.chunkSize=function(g){return Math.floor(Math.LN2*this.DB/Math.log(g))};a.prototype.toRadix=function(g){null==
g&&(g=10);if(0==this.signum()||2>g||36<g)return"0";var t=this.chunkSize(g),t=Math.pow(g,t),a=h(t),c=b(),d=b(),k="";for(this.divRemTo(a,c,d);0<c.signum();)k=(t+d.intValue()).toString(g).substr(1)+k,c.divRemTo(a,c,d);return d.intValue().toString(g)+k};a.prototype.fromRadix=function(g,t){this.fromInt(0);null==t&&(t=10);for(var U=this.chunkSize(t),b=Math.pow(t,U),c=!1,d=0,k=0,h=0;h<g.length;++h){var l=e(g,h);0>l?"-"==g.charAt(h)&&0==this.signum()&&(c=!0):(k=t*k+l,++d>=U&&(this.dMultiply(b),this.dAddOffset(k,
0),k=d=0))}0<d&&(this.dMultiply(Math.pow(t,d)),this.dAddOffset(k,0));c&&a.ZERO.subTo(this,this)};a.prototype.fromNumber=function(g,t,U){if("number"==typeof t)if(2>g)this.fromInt(1);else for(this.fromNumber(g,U),this.testBit(g-1)||this.bitwiseTo(a.ONE.shiftLeft(g-1),w,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>g&&this.subTo(a.ONE.shiftLeft(g-1),this);else{U=[];var b=g&7;U.length=(g>>3)+1;t.nextBytes(U);U[0]=0<b?U[0]&(1<<b)-1:0;this.fromString(U,
256)}};a.prototype.bitwiseTo=function(g,t,a){var b,c,d=Math.min(g.t,this.t);for(b=0;b<d;++b)a[b]=t(this[b],g[b]);if(g.t<this.t){c=g.s&this.DM;for(b=d;b<this.t;++b)a[b]=t(this[b],c);a.t=this.t}else{c=this.s&this.DM;for(b=d;b<g.t;++b)a[b]=t(c,g[b]);a.t=g.t}a.s=t(this.s,g.s);a.clamp()};a.prototype.changeBit=function(g,t){var b=a.ONE.shiftLeft(g);this.bitwiseTo(b,t,b);return b};a.prototype.addTo=function(g,t){for(var a=0,b=0,c=Math.min(g.t,this.t);a<c;)b+=this[a]+g[a],t[a++]=b&this.DM,b>>=this.DB;if(g.t<
this.t){for(b+=g.s;a<this.t;)b+=this[a],t[a++]=b&this.DM,b>>=this.DB;b+=this.s}else{for(b+=this.s;a<g.t;)b+=g[a],t[a++]=b&this.DM,b>>=this.DB;b+=g.s}t.s=0>b?-1:0;0<b?t[a++]=b:-1>b&&(t[a++]=this.DV+b);t.t=a;t.clamp()};a.prototype.dMultiply=function(g){this[this.t]=this.am(0,g-1,this,0,0,this.t);++this.t;this.clamp()};a.prototype.dAddOffset=function(g,t){if(0!=g){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=g;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}};a.prototype.multiplyLowerTo=
function(g,t,a){var b=Math.min(this.t+g.t,t);a.s=0;for(a.t=b;0<b;)a[--b]=0;var c;for(c=a.t-this.t;b<c;++b)a[b+this.t]=this.am(0,g[b],a,b,0,this.t);for(c=Math.min(g.t,t);b<c;++b)this.am(0,g[b],a,b,0,t-b);a.clamp()};a.prototype.multiplyUpperTo=function(g,t,a){--t;var b=a.t=this.t+g.t-t;for(a.s=0;0<=--b;)a[b]=0;for(b=Math.max(t-this.t,0);b<g.t;++b)a[this.t+b-t]=this.am(t-b,g[b],a,0,0,this.t+b-t);a.clamp();a.drShiftTo(1,a)};a.prototype.modInt=function(g){if(0>=g)return 0;var t=this.DV%g,a=0>this.s?g-
1:0;if(0<this.t)if(0==t)a=this[0]%g;else for(var b=this.t-1;0<=b;--b)a=(t*a+this[b])%g;return a};a.prototype.millerRabin=function(g){var t=this.subtract(a.ONE),U=t.getLowestSetBit();if(0>=U)return!1;var c=t.shiftRight(U);g=g+1>>1;g>Z.length&&(g=Z.length);for(var d=b(),k=0;k<g;++k){d.fromInt(Z[Math.floor(Math.random()*Z.length)]);var e=d.modPow(c,this);if(0!=e.compareTo(a.ONE)&&0!=e.compareTo(t)){for(var h=1;h++<U&&0!=e.compareTo(t);)if(e=e.modPowInt(2,this),0==e.compareTo(a.ONE))return!1;if(0!=e.compareTo(t))return!1}}return!0};
a.prototype.clone=function(){var g=b();this.copyTo(g);return g};a.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]};a.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24};a.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16};a.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this[0]?
0:1};a.prototype.toByteArray=function(){var g=this.t,t=[];t[0]=this.s;var a=this.DB-g*this.DB%8,b,c=0;if(0<g--)for(a<this.DB&&(b=this[g]>>a)!=(this.s&this.DM)>>a&&(t[c++]=b|this.s<<this.DB-a);0<=g;)if(8>a?(b=(this[g]&(1<<a)-1)<<8-a,b|=this[--g]>>(a+=this.DB-8)):(b=this[g]>>(a-=8)&255,0>=a&&(a+=this.DB,--g)),0!=(b&128)&&(b|=-256),0==c&&(this.s&128)!=(b&128)&&++c,0<c||b!=this.s)t[c++]=b;return t};a.prototype.equals=function(g){return 0==this.compareTo(g)};a.prototype.min=function(g){return 0>this.compareTo(g)?
this:g};a.prototype.max=function(g){return 0<this.compareTo(g)?this:g};a.prototype.and=function(g){var t=b();this.bitwiseTo(g,v,t);return t};a.prototype.or=function(g){var t=b();this.bitwiseTo(g,w,t);return t};a.prototype.xor=function(g){var t=b();this.bitwiseTo(g,y,t);return t};a.prototype.andNot=function(g){var t=b();this.bitwiseTo(g,E,t);return t};a.prototype.not=function(){for(var g=b(),t=0;t<this.t;++t)g[t]=this.DM&~this[t];g.t=this.t;g.s=~this.s;return g};a.prototype.shiftLeft=function(g){var t=
b();0>g?this.rShiftTo(-g,t):this.lShiftTo(g,t);return t};a.prototype.shiftRight=function(g){var t=b();0>g?this.lShiftTo(-g,t):this.rShiftTo(g,t);return t};a.prototype.getLowestSetBit=function(){for(var g=0;g<this.t;++g)if(0!=this[g]){var t=g*this.DB,g=this[g];if(0==g)g=-1;else{var a=0;0==(g&65535)&&(g>>=16,a+=16);0==(g&255)&&(g>>=8,a+=8);0==(g&15)&&(g>>=4,a+=4);0==(g&3)&&(g>>=2,a+=2);0==(g&1)&&++a;g=a}return t+g}return 0>this.s?this.t*this.DB:-1};a.prototype.bitCount=function(){for(var g=0,t=this.s&
this.DM,a=0;a<this.t;++a){for(var b=this[a]^t,c=0;0!=b;)b&=b-1,++c;g+=c}return g};a.prototype.testBit=function(g){var t=Math.floor(g/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<g%this.DB)};a.prototype.setBit=function(g){return this.changeBit(g,w)};a.prototype.clearBit=function(g){return this.changeBit(g,E)};a.prototype.flipBit=function(g){return this.changeBit(g,y)};a.prototype.add=function(g){var t=b();this.addTo(g,t);return t};a.prototype.subtract=function(g){var t=b();this.subTo(g,t);return t};
a.prototype.multiply=function(g){var t=b();this.multiplyTo(g,t);return t};a.prototype.divide=function(g){var t=b();this.divRemTo(g,t,null);return t};a.prototype.remainder=function(g){var t=b();this.divRemTo(g,null,t);return t};a.prototype.divideAndRemainder=function(g){var t=b(),a=b();this.divRemTo(g,t,a);return[t,a]};a.prototype.modPow=function(g,t){var a=g.bitLength(),c,d=h(1),k;if(0>=a)return d;c=18>a?1:48>a?3:144>a?4:768>a?5:6;k=8>a?new n(t):t.isEven()?new G(t):new u(t);var e=[],l=3,v=c-1,w=(1<<
c)-1;e[1]=k.convert(this);if(1<c)for(a=b(),k.sqrTo(e[1],a);l<=w;)e[l]=b(),k.mulTo(a,e[l-2],e[l]),l+=2;for(var y=g.t-1,A,E=!0,C=b(),a=r(g[y])-1;0<=y;){a>=v?A=g[y]>>a-v&w:(A=(g[y]&(1<<a+1)-1)<<v-a,0<y&&(A|=g[y-1]>>this.DB+a-v));for(l=c;0==(A&1);)A>>=1,--l;0>(a-=l)&&(a+=this.DB,--y);if(E)e[A].copyTo(d),E=!1;else{for(;1<l;)k.sqrTo(d,C),k.sqrTo(C,d),l-=2;0<l?k.sqrTo(d,C):(l=d,d=C,C=l);k.mulTo(C,e[A],d)}for(;0<=y&&0==(g[y]&1<<a);)k.sqrTo(d,C),l=d,d=C,C=l,0>--a&&(a=this.DB-1,--y)}return k.revert(d)};a.prototype.modInverse=
function(g){var t=g.isEven();if(this.isEven()&&t||0==g.signum())return a.ZERO;for(var b=g.clone(),c=this.clone(),d=h(1),k=h(0),e=h(0),l=h(1);0!=b.signum();){for(;b.isEven();)b.rShiftTo(1,b),t?(d.isEven()&&k.isEven()||(d.addTo(this,d),k.subTo(g,k)),d.rShiftTo(1,d)):k.isEven()||k.subTo(g,k),k.rShiftTo(1,k);for(;c.isEven();)c.rShiftTo(1,c),t?(e.isEven()&&l.isEven()||(e.addTo(this,e),l.subTo(g,l)),e.rShiftTo(1,e)):l.isEven()||l.subTo(g,l),l.rShiftTo(1,l);0<=b.compareTo(c)?(b.subTo(c,b),t&&d.subTo(e,d),
k.subTo(l,k)):(c.subTo(b,c),t&&e.subTo(d,e),l.subTo(k,l))}if(0!=c.compareTo(a.ONE))return a.ZERO;if(0<=l.compareTo(g))return l.subtract(g);if(0>l.signum())l.addTo(g,l);else return l;return 0>l.signum()?l.add(g):l};a.prototype.pow=function(g){return this.exp(g,new C)};a.prototype.gcd=function(g){var t=0>this.s?this.negate():this.clone();g=0>g.s?g.negate():g.clone();if(0>t.compareTo(g)){var a=t,t=g;g=a}var a=t.getLowestSetBit(),b=g.getLowestSetBit();if(0>b)return t;a<b&&(b=a);for(0<b&&(t.rShiftTo(b,
t),g.rShiftTo(b,g));0<t.signum();)0<(a=t.getLowestSetBit())&&t.rShiftTo(a,t),0<(a=g.getLowestSetBit())&&g.rShiftTo(a,g),0<=t.compareTo(g)?(t.subTo(g,t),t.rShiftTo(1,t)):(g.subTo(t,g),g.rShiftTo(1,g));0<b&&g.lShiftTo(b,g);return g};a.prototype.isProbablePrime=function(g){var t,a=this.abs();if(1==a.t&&a[0]<=Z[Z.length-1]){for(t=0;t<Z.length;++t)if(a[0]==Z[t])return!0;return!1}if(a.isEven())return!1;for(t=1;t<Z.length;){for(var b=Z[t],c=t+1;c<Z.length&&b<S;)b*=Z[c++];for(b=a.modInt(b);t<c;)if(0==b%Z[t++])return!1}return a.millerRabin(g)};
a.prototype.square=function(){var g=b();this.squareTo(g);return g};a.prototype.IsNegative=function(){return-1==this.compareTo(a.ZERO)?!0:!1};a.op_Equality=function(g,a){return 0==g.compareTo(a)?!0:!1};a.op_Inequality=function(g,a){return 0!=g.compareTo(a)?!0:!1};a.op_GreaterThan=function(g,a){return 0<g.compareTo(a)?!0:!1};a.op_LessThan=function(g,a){return 0>g.compareTo(a)?!0:!1};a.op_Addition=function(g,t){return(new a(g)).add(new a(t))};a.op_Subtraction=function(g,t){return(new a(g)).subtract(new a(t))};
a.Int128Mul=function(g,t){return(new a(g)).multiply(new a(t))};a.op_Division=function(g,a){return g.divide(a)};a.prototype.ToDouble=function(){return parseFloat(this.toString())};if("undefined"==typeof sa)var sa=function(g,a){var b;if("undefined"==typeof Object.getOwnPropertyNames)for(b in a.prototype){if("undefined"==typeof g.prototype[b]||g.prototype[b]==Object.prototype[b])g.prototype[b]=a.prototype[b]}else for(var c=Object.getOwnPropertyNames(a.prototype),d=0;d<c.length;d++)"undefined"==typeof Object.getOwnPropertyDescriptor(g.prototype,
c[d])&&Object.defineProperty(g.prototype,c[d],Object.getOwnPropertyDescriptor(a.prototype,c[d]));for(b in a)"undefined"==typeof g[b]&&(g[b]=a[b]);g.$baseCtor=a};k.Path=function(){return[]};k.Paths=function(){return[]};k.DoublePoint=function(){var g=arguments;this.Y=this.X=0;1==g.length?(this.X=g[0].X,this.Y=g[0].Y):2==g.length&&(this.X=g[0],this.Y=g[1])};k.DoublePoint0=function(){this.Y=this.X=0};k.DoublePoint1=function(g){this.X=g.X;this.Y=g.Y};k.DoublePoint2=function(g,a){this.X=g;this.Y=a};k.PolyNode=
function(){this.m_Parent=null;this.m_polygon=new k.Path;this.m_endtype=this.m_jointype=this.m_Index=0;this.m_Childs=[];this.IsOpen=!1};k.PolyNode.prototype.IsHoleNode=function(){for(var g=!0,a=this.m_Parent;null!==a;)g=!g,a=a.m_Parent;return g};k.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length};k.PolyNode.prototype.Contour=function(){return this.m_polygon};k.PolyNode.prototype.AddChild=function(g){var a=this.m_Childs.length;this.m_Childs.push(g);g.m_Parent=this;g.m_Index=a};k.PolyNode.prototype.GetNext=
function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()};k.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]};k.PolyNode.prototype.Childs=function(){return this.m_Childs};k.PolyNode.prototype.Parent=function(){return this.m_Parent};k.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()};k.PolyTree=function(){this.m_AllPolys=
[];k.PolyNode.call(this)};k.PolyTree.prototype.Clear=function(){for(var g=0,a=this.m_AllPolys.length;g<a;g++)this.m_AllPolys[g]=null;this.m_AllPolys.length=0;this.m_Childs.length=0};k.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null};k.PolyTree.prototype.Total=function(){return this.m_AllPolys.length};sa(k.PolyTree,k.PolyNode);k.Math_Abs_Int64=k.Math_Abs_Int32=k.Math_Abs_Double=function(g){return Math.abs(g)};k.Math_Max_Int32_Int32=function(g,a){return Math.max(g,
a)};k.Cast_Int32=R||ha||Y?function(g){return g|0}:function(g){return~~g};k.Cast_Int64=O?function(g){return-2147483648>g||2147483647<g?0>g?Math.ceil(g):Math.floor(g):~~g}:ea&&"function"==typeof Number.toInteger?function(g){return Number.toInteger(g)}:P||A?function(g){return parseInt(g,10)}:R?function(g){return-2147483648>g||2147483647<g?0>g?Math.ceil(g):Math.floor(g):g|0}:function(g){return 0>g?Math.ceil(g):Math.floor(g)};k.Clear=function(g){g.length=0};k.PI=3.141592653589793;k.PI2=6.283185307179586;
k.IntPoint=function(){var g;g=arguments;var a=g.length;this.Y=this.X=0;2==a?(this.X=g[0],this.Y=g[1]):1==a?g[0]instanceof k.DoublePoint?(g=g[0],this.X=k.Clipper.Round(g.X),this.Y=k.Clipper.Round(g.Y)):(g=g[0],this.X=g.X,this.Y=g.Y):this.Y=this.X=0};k.IntPoint.op_Equality=function(g,a){return g.X==a.X&&g.Y==a.Y};k.IntPoint.op_Inequality=function(g,a){return g.X!=a.X||g.Y!=a.Y};k.IntPoint0=function(){this.Y=this.X=0};k.IntPoint1=function(g){this.X=g.X;this.Y=g.Y};k.IntPoint1dp=function(g){this.X=k.Clipper.Round(g.X);
this.Y=k.Clipper.Round(g.Y)};k.IntPoint2=function(g,a){this.X=g;this.Y=a};k.IntRect=function(){var g=arguments,a=g.length;4==a?(this.left=g[0],this.top=g[1],this.right=g[2],this.bottom=g[3]):1==a?(this.left=g[0].left,this.top=g[0].top,this.right=g[0].right,this.bottom=g[0].bottom):this.bottom=this.right=this.top=this.left=0};k.IntRect0=function(){this.bottom=this.right=this.top=this.left=0};k.IntRect1=function(g){this.left=g.left;this.top=g.top;this.right=g.right;this.bottom=g.bottom};k.IntRect4=
function(g,a,b,c){this.left=g;this.top=a;this.right=b;this.bottom=c};k.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3};k.PolyType={ptSubject:0,ptClip:1};k.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3};k.JoinType={jtSquare:0,jtRound:1,jtMiter:2};k.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4};k.EdgeSide={esLeft:0,esRight:1};k.Direction={dRightToLeft:0,dLeftToRight:1};k.TEdge=function(){this.Bot=new k.IntPoint;this.Curr=new k.IntPoint;
this.Top=new k.IntPoint;this.Delta=new k.IntPoint;this.Dx=0;this.PolyTyp=k.PolyType.ptSubject;this.Side=k.EdgeSide.esLeft;this.OutIdx=this.WindCnt2=this.WindCnt=this.WindDelta=0;this.PrevInSEL=this.NextInSEL=this.PrevInAEL=this.NextInAEL=this.NextInLML=this.Prev=this.Next=null};k.IntersectNode=function(){this.Edge2=this.Edge1=null;this.Pt=new k.IntPoint};k.MyIntersectNodeSort=function(){};k.MyIntersectNodeSort.Compare=function(g,a){return a.Pt.Y-g.Pt.Y};k.LocalMinima=function(){this.Y=0;this.Next=
this.RightBound=this.LeftBound=null};k.Scanbeam=function(){this.Y=0;this.Next=null};k.OutRec=function(){this.Idx=0;this.IsOpen=this.IsHole=!1;this.PolyNode=this.BottomPt=this.Pts=this.FirstLeft=null};k.OutPt=function(){this.Idx=0;this.Pt=new k.IntPoint;this.Prev=this.Next=null};k.Join=function(){this.OutPt2=this.OutPt1=null;this.OffPt=new k.IntPoint};k.ClipperBase=function(){this.m_CurrentLM=this.m_MinimaList=null;this.m_edges=[];this.PreserveCollinear=this.m_HasOpenPaths=this.m_UseFullRange=!1;this.m_CurrentLM=
this.m_MinimaList=null;this.m_HasOpenPaths=this.m_UseFullRange=!1};k.ClipperBase.horizontal=-9007199254740992;k.ClipperBase.Skip=-2;k.ClipperBase.Unassigned=-1;k.ClipperBase.tolerance=1E-20;k.ClipperBase.loRange=47453132;k.ClipperBase.hiRange=0xfffffffffffff;k.ClipperBase.near_zero=function(g){return g>-k.ClipperBase.tolerance&&g<k.ClipperBase.tolerance};k.ClipperBase.IsHorizontal=function(g){return 0===g.Delta.Y};k.ClipperBase.prototype.PointIsVertex=function(g,a){var b=a;do{if(k.IntPoint.op_Equality(b.Pt,
g))return!0;b=b.Next}while(b!=a);return!1};k.ClipperBase.prototype.PointOnLineSegment=function(g,t,b,c){return c?g.X==t.X&&g.Y==t.Y||g.X==b.X&&g.Y==b.Y||g.X>t.X==g.X<b.X&&g.Y>t.Y==g.Y<b.Y&&a.op_Equality(a.Int128Mul(g.X-t.X,b.Y-t.Y),a.Int128Mul(b.X-t.X,g.Y-t.Y)):g.X==t.X&&g.Y==t.Y||g.X==b.X&&g.Y==b.Y||g.X>t.X==g.X<b.X&&g.Y>t.Y==g.Y<b.Y&&(g.X-t.X)*(b.Y-t.Y)==(b.X-t.X)*(g.Y-t.Y)};k.ClipperBase.prototype.PointOnPolygon=function(g,a,b){for(var c=a;;){if(this.PointOnLineSegment(g,c.Pt,c.Next.Pt,b))return!0;
c=c.Next;if(c==a)break}return!1};k.ClipperBase.prototype.SlopesEqual=k.ClipperBase.SlopesEqual=function(){var g=arguments,t=g.length,b,c,d;if(3==t)return t=g[0],b=g[1],g[2]?a.op_Equality(a.Int128Mul(t.Delta.Y,b.Delta.X),a.Int128Mul(t.Delta.X,b.Delta.Y)):k.Cast_Int64(t.Delta.Y*b.Delta.X)==k.Cast_Int64(t.Delta.X*b.Delta.Y);if(4==t)return t=g[0],b=g[1],c=g[2],g[3]?a.op_Equality(a.Int128Mul(t.Y-b.Y,b.X-c.X),a.Int128Mul(t.X-b.X,b.Y-c.Y)):0===k.Cast_Int64((t.Y-b.Y)*(b.X-c.X))-k.Cast_Int64((t.X-b.X)*(b.Y-
c.Y));t=g[0];b=g[1];c=g[2];d=g[3];return g[4]?a.op_Equality(a.Int128Mul(t.Y-b.Y,c.X-d.X),a.Int128Mul(t.X-b.X,c.Y-d.Y)):0===k.Cast_Int64((t.Y-b.Y)*(c.X-d.X))-k.Cast_Int64((t.X-b.X)*(c.Y-d.Y))};k.ClipperBase.SlopesEqual3=function(g,t,b){return b?a.op_Equality(a.Int128Mul(g.Delta.Y,t.Delta.X),a.Int128Mul(g.Delta.X,t.Delta.Y)):k.Cast_Int64(g.Delta.Y*t.Delta.X)==k.Cast_Int64(g.Delta.X*t.Delta.Y)};k.ClipperBase.SlopesEqual4=function(g,t,b,c){return c?a.op_Equality(a.Int128Mul(g.Y-t.Y,t.X-b.X),a.Int128Mul(g.X-
t.X,t.Y-b.Y)):0===k.Cast_Int64((g.Y-t.Y)*(t.X-b.X))-k.Cast_Int64((g.X-t.X)*(t.Y-b.Y))};k.ClipperBase.SlopesEqual5=function(g,t,b,c,d){return d?a.op_Equality(a.Int128Mul(g.Y-t.Y,b.X-c.X),a.Int128Mul(g.X-t.X,b.Y-c.Y)):0===k.Cast_Int64((g.Y-t.Y)*(b.X-c.X))-k.Cast_Int64((g.X-t.X)*(b.Y-c.Y))};k.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var g=0,a=this.m_edges.length;g<a;++g){for(var b=0,c=this.m_edges[g].length;b<c;++b)this.m_edges[g][b]=null;k.Clear(this.m_edges[g])}k.Clear(this.m_edges);
this.m_HasOpenPaths=this.m_UseFullRange=!1};k.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var g=this.m_MinimaList.Next;this.m_MinimaList=null;this.m_MinimaList=g}this.m_CurrentLM=null};k.ClipperBase.prototype.RangeTest=function(g,a){if(a.Value)(g.X>k.ClipperBase.hiRange||g.Y>k.ClipperBase.hiRange||-g.X>k.ClipperBase.hiRange||-g.Y>k.ClipperBase.hiRange)&&k.Error("Coordinate outside allowed range in RangeTest().");else if(g.X>k.ClipperBase.loRange||g.Y>k.ClipperBase.loRange||
-g.X>k.ClipperBase.loRange||-g.Y>k.ClipperBase.loRange)a.Value=!0,this.RangeTest(g,a)};k.ClipperBase.prototype.InitEdge=function(g,a,b,c){g.Next=a;g.Prev=b;g.Curr.X=c.X;g.Curr.Y=c.Y;g.OutIdx=-1};k.ClipperBase.prototype.InitEdge2=function(g,a){g.Curr.Y>=g.Next.Curr.Y?(g.Bot.X=g.Curr.X,g.Bot.Y=g.Curr.Y,g.Top.X=g.Next.Curr.X,g.Top.Y=g.Next.Curr.Y):(g.Top.X=g.Curr.X,g.Top.Y=g.Curr.Y,g.Bot.X=g.Next.Curr.X,g.Bot.Y=g.Next.Curr.Y);this.SetDx(g);g.PolyTyp=a};k.ClipperBase.prototype.FindNextLocMin=function(g){for(var a;;){for(;k.IntPoint.op_Inequality(g.Bot,
g.Prev.Bot)||k.IntPoint.op_Equality(g.Curr,g.Top);)g=g.Next;if(g.Dx!=k.ClipperBase.horizontal&&g.Prev.Dx!=k.ClipperBase.horizontal)break;for(;g.Prev.Dx==k.ClipperBase.horizontal;)g=g.Prev;for(a=g;g.Dx==k.ClipperBase.horizontal;)g=g.Next;if(g.Top.Y!=g.Prev.Bot.Y){a.Prev.Bot.X<g.Bot.X&&(g=a);break}}return g};k.ClipperBase.prototype.ProcessBound=function(g,a){var b=g,c=g,d;g.Dx==k.ClipperBase.horizontal&&(d=a?g.Prev.Bot.X:g.Next.Bot.X,g.Bot.X!=d&&this.ReverseHorizontal(g));if(c.OutIdx!=k.ClipperBase.Skip)if(a){for(;c.Top.Y==
c.Next.Bot.Y&&c.Next.OutIdx!=k.ClipperBase.Skip;)c=c.Next;if(c.Dx==k.ClipperBase.horizontal&&c.Next.OutIdx!=k.ClipperBase.Skip){for(d=c;d.Prev.Dx==k.ClipperBase.horizontal;)d=d.Prev;d.Prev.Top.X==c.Next.Top.X?a||(c=d.Prev):d.Prev.Top.X>c.Next.Top.X&&(c=d.Prev)}for(;g!=c;)g.NextInLML=g.Next,g.Dx==k.ClipperBase.horizontal&&g!=b&&g.Bot.X!=g.Prev.Top.X&&this.ReverseHorizontal(g),g=g.Next;g.Dx==k.ClipperBase.horizontal&&g!=b&&g.Bot.X!=g.Prev.Top.X&&this.ReverseHorizontal(g);c=c.Next}else{for(;c.Top.Y==
c.Prev.Bot.Y&&c.Prev.OutIdx!=k.ClipperBase.Skip;)c=c.Prev;if(c.Dx==k.ClipperBase.horizontal&&c.Prev.OutIdx!=k.ClipperBase.Skip){for(d=c;d.Next.Dx==k.ClipperBase.horizontal;)d=d.Next;d.Next.Top.X==c.Prev.Top.X?a||(c=d.Next):d.Next.Top.X>c.Prev.Top.X&&(c=d.Next)}for(;g!=c;)g.NextInLML=g.Prev,g.Dx==k.ClipperBase.horizontal&&g!=b&&g.Bot.X!=g.Next.Top.X&&this.ReverseHorizontal(g),g=g.Prev;g.Dx==k.ClipperBase.horizontal&&g!=b&&g.Bot.X!=g.Next.Top.X&&this.ReverseHorizontal(g);c=c.Prev}if(c.OutIdx==k.ClipperBase.Skip){g=
c;if(a){for(;g.Top.Y==g.Next.Bot.Y;)g=g.Next;for(;g!=c&&g.Dx==k.ClipperBase.horizontal;)g=g.Prev}else{for(;g.Top.Y==g.Prev.Bot.Y;)g=g.Prev;for(;g!=c&&g.Dx==k.ClipperBase.horizontal;)g=g.Next}g==c?c=a?g.Next:g.Prev:(g=a?c.Next:c.Prev,b=new k.LocalMinima,b.Next=null,b.Y=g.Bot.Y,b.LeftBound=null,b.RightBound=g,b.RightBound.WindDelta=0,c=this.ProcessBound(b.RightBound,a),this.InsertLocalMinima(b))}return c};k.ClipperBase.prototype.AddPath=function(g,a,b){b||a!=k.PolyType.ptClip||k.Error("AddPath: Open paths must be subject.");
var c=g.length-1;if(b)for(;0<c&&k.IntPoint.op_Equality(g[c],g[0]);)--c;for(;0<c&&k.IntPoint.op_Equality(g[c],g[c-1]);)--c;if(b&&2>c||!b&&1>c)return!1;for(var d=[],e=0;e<=c;e++)d.push(new k.TEdge);var h=!0;try{for(d[1].Curr.X=g[1].X,d[1].Curr.Y=g[1].Y,function(){var a={Value:this.m_UseFullRange},t=this.RangeTest(g[0],a);this.m_UseFullRange=a.Value;return t}.call(this),function(){var a={Value:this.m_UseFullRange},t=this.RangeTest(g[c],a);this.m_UseFullRange=a.Value;return t}.call(this),this.InitEdge(d[0],
d[1],d[c],g[0]),this.InitEdge(d[c],d[0],d[c-1],g[c]),e=c-1;1<=e;--e)(function(){var a={Value:this.m_UseFullRange},t=this.RangeTest(g[e],a);this.m_UseFullRange=a.Value;return t}).call(this),this.InitEdge(d[e],d[e+1],d[e-1],g[e])}catch(l){return!1}var n=d[0];b||(n.Prev.OutIdx=k.ClipperBase.Skip);for(var r=n,u=n;;)if(k.IntPoint.op_Equality(r.Curr,r.Next.Curr)){if(r==r.Next)break;r==n&&(n=r.Next);u=r=this.RemoveEdge(r)}else{if(r.Prev==r.Next)break;else if(b&&k.ClipperBase.SlopesEqual(r.Prev.Curr,r.Curr,
r.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(r.Prev.Curr,r.Curr,r.Next.Curr))){r==n&&(n=r.Next);r=this.RemoveEdge(r);u=r=r.Prev;continue}r=r.Next;if(r==u)break}if(!b&&r==r.Next||b&&r.Prev==r.Next)return!1;b||(this.m_HasOpenPaths=!0);r=n;do this.InitEdge2(r,a),r=r.Next,h&&r.Curr.Y!=n.Curr.Y&&(h=!1);while(r!=n);if(h){if(b)return!1;r.Prev.OutIdx=k.ClipperBase.Skip;r.Prev.Bot.X<r.Prev.Top.X&&this.ReverseHorizontal(r.Prev);a=new k.LocalMinima;a.Next=null;a.Y=
r.Bot.Y;a.LeftBound=null;a.RightBound=r;a.RightBound.Side=k.EdgeSide.esRight;for(a.RightBound.WindDelta=0;r.Next.OutIdx!=k.ClipperBase.Skip;)r.NextInLML=r.Next,r.Bot.X!=r.Prev.Top.X&&this.ReverseHorizontal(r),r=r.Next;this.InsertLocalMinima(a);this.m_edges.push(d);return!0}this.m_edges.push(d);for(h=null;;){r=this.FindNextLocMin(r);if(r==h)break;else null==h&&(h=r);a=new k.LocalMinima;a.Next=null;a.Y=r.Bot.Y;r.Dx<r.Prev.Dx?(a.LeftBound=r.Prev,a.RightBound=r,d=!1):(a.LeftBound=r,a.RightBound=r.Prev,
d=!0);a.LeftBound.Side=k.EdgeSide.esLeft;a.RightBound.Side=k.EdgeSide.esRight;a.LeftBound.WindDelta=b?a.LeftBound.Next==a.RightBound?-1:1:0;a.RightBound.WindDelta=-a.LeftBound.WindDelta;r=this.ProcessBound(a.LeftBound,d);n=this.ProcessBound(a.RightBound,!d);a.LeftBound.OutIdx==k.ClipperBase.Skip?a.LeftBound=null:a.RightBound.OutIdx==k.ClipperBase.Skip&&(a.RightBound=null);this.InsertLocalMinima(a);d||(r=n)}return!0};k.ClipperBase.prototype.AddPaths=function(g,a,b){for(var c=!1,d=0,k=g.length;d<k;++d)this.AddPath(g[d],
a,b)&&(c=!0);return c};k.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(g,a,b){return k.IntPoint.op_Equality(g,b)||k.IntPoint.op_Equality(g,a)||k.IntPoint.op_Equality(b,a)?!1:g.X!=b.X?a.X>g.X==a.X<b.X:a.Y>g.Y==a.Y<b.Y};k.ClipperBase.prototype.RemoveEdge=function(g){g.Prev.Next=g.Next;g.Next.Prev=g.Prev;var a=g.Next;g.Prev=null;return a};k.ClipperBase.prototype.SetDx=function(g){g.Delta.X=g.Top.X-g.Bot.X;g.Delta.Y=g.Top.Y-g.Bot.Y;g.Dx=0===g.Delta.Y?k.ClipperBase.horizontal:g.Delta.X/g.Delta.Y};
k.ClipperBase.prototype.InsertLocalMinima=function(g){if(null===this.m_MinimaList)this.m_MinimaList=g;else if(g.Y>=this.m_MinimaList.Y)g.Next=this.m_MinimaList,this.m_MinimaList=g;else{for(var a=this.m_MinimaList;null!==a.Next&&g.Y<a.Next.Y;)a=a.Next;g.Next=a.Next;a.Next=g}};k.ClipperBase.prototype.PopLocalMinima=function(){null!==this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.Next)};k.ClipperBase.prototype.ReverseHorizontal=function(g){var a=g.Top.X;g.Top.X=g.Bot.X;g.Bot.X=a};k.ClipperBase.prototype.Reset=
function(){this.m_CurrentLM=this.m_MinimaList;if(null!=this.m_CurrentLM)for(var g=this.m_MinimaList;null!=g;){var a=g.LeftBound;null!=a&&(a.Curr.X=a.Bot.X,a.Curr.Y=a.Bot.Y,a.Side=k.EdgeSide.esLeft,a.OutIdx=k.ClipperBase.Unassigned);a=g.RightBound;null!=a&&(a.Curr.X=a.Bot.X,a.Curr.Y=a.Bot.Y,a.Side=k.EdgeSide.esRight,a.OutIdx=k.ClipperBase.Unassigned);g=g.Next}};k.Clipper=function(g){"undefined"==typeof g&&(g=0);this.m_PolyOuts=null;this.m_ClipType=k.ClipType.ctIntersection;this.m_IntersectNodeComparer=
this.m_IntersectList=this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_ExecuteLocked=!1;this.m_SubjFillType=this.m_ClipFillType=k.PolyFillType.pftEvenOdd;this.m_GhostJoins=this.m_Joins=null;this.StrictlySimple=this.ReverseSolution=this.m_UsingPolyTree=!1;k.ClipperBase.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_IntersectList=[];this.m_IntersectNodeComparer=k.MyIntersectNodeSort.Compare;this.m_UsingPolyTree=this.m_ExecuteLocked=!1;this.m_PolyOuts=[];
this.m_Joins=[];this.m_GhostJoins=[];this.ReverseSolution=0!==(1&g);this.StrictlySimple=0!==(2&g);this.PreserveCollinear=0!==(4&g)};k.Clipper.ioReverseSolution=1;k.Clipper.ioStrictlySimple=2;k.Clipper.ioPreserveCollinear=4;k.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),k.ClipperBase.prototype.Clear.call(this))};k.Clipper.prototype.DisposeScanbeamList=function(){for(;null!==this.m_Scanbeam;){var g=this.m_Scanbeam.Next;this.m_Scanbeam=null;this.m_Scanbeam=g}};
k.Clipper.prototype.Reset=function(){k.ClipperBase.prototype.Reset.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.DisposeAllPolyPts();for(var g=this.m_MinimaList;null!==g;)this.InsertScanbeam(g.Y),g=g.Next};k.Clipper.prototype.InsertScanbeam=function(g){if(null===this.m_Scanbeam)this.m_Scanbeam=new k.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=g;else if(g>this.m_Scanbeam.Y){var a=new k.Scanbeam;a.Y=g;a.Next=this.m_Scanbeam;this.m_Scanbeam=a}else{for(var b=this.m_Scanbeam;null!==
b.Next&&g<=b.Next.Y;)b=b.Next;g!=b.Y&&(a=new k.Scanbeam,a.Y=g,a.Next=b.Next,b.Next=a)}};k.Clipper.prototype.Execute=function(){var g=arguments,a=g.length,b=g[1]instanceof k.PolyTree;if(4!=a||b){if(4==a&&b){b=g[0];a=g[1];c=g[2];g=g[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;this.m_SubjFillType=c;this.m_ClipFillType=g;this.m_ClipType=b;this.m_UsingPolyTree=!0;(g=this.ExecuteInternal())&&this.BuildResult2(a);this.m_ExecuteLocked=!1;return g}if(2==a&&!b||2==a&&b)return b=g[0],a=g[1],
this.Execute(b,a,k.PolyFillType.pftEvenOdd,k.PolyFillType.pftEvenOdd)}else{var b=g[0],a=g[1],c=g[2],g=g[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&k.Error("Error: PolyTree struct is need for open path clipping.");this.m_ExecuteLocked=!0;k.Clear(a);this.m_SubjFillType=c;this.m_ClipFillType=g;this.m_ClipType=b;this.m_UsingPolyTree=!1;(g=this.ExecuteInternal())&&this.BuildResult(a);this.m_ExecuteLocked=!1;return g}};k.Clipper.prototype.FixHoleLinkage=function(g){if(null!==g.FirstLeft&&
(g.IsHole==g.FirstLeft.IsHole||null===g.FirstLeft.Pts)){for(var a=g.FirstLeft;null!==a&&(a.IsHole==g.IsHole||null===a.Pts);)a=a.FirstLeft;g.FirstLeft=a}};k.Clipper.prototype.ExecuteInternal=function(){try{this.Reset();if(null===this.m_CurrentLM)return!1;var g=this.PopScanbeam();do{this.InsertLocalMinimaIntoAEL(g);k.Clear(this.m_GhostJoins);this.ProcessHorizontals(!1);if(null===this.m_Scanbeam)break;var a=this.PopScanbeam();if(!this.ProcessIntersections(g,a))return!1;this.ProcessEdgesAtTopOfScanbeam(a);
g=a}while(null!==this.m_Scanbeam||null!==this.m_CurrentLM);for(var g=0,b=this.m_PolyOuts.length;g<b;g++){var c=this.m_PolyOuts[g];null===c.Pts||c.IsOpen||(c.IsHole^this.ReverseSolution)==0<this.Area(c)&&this.ReversePolyPtLinks(c.Pts)}this.JoinCommonEdges();g=0;for(b=this.m_PolyOuts.length;g<b;g++)c=this.m_PolyOuts[g],null===c.Pts||c.IsOpen||this.FixupOutPolygon(c);this.StrictlySimple&&this.DoSimplePolygons();return!0}finally{k.Clear(this.m_Joins),k.Clear(this.m_GhostJoins)}};k.Clipper.prototype.PopScanbeam=
function(){var g=this.m_Scanbeam.Y;this.m_Scanbeam=this.m_Scanbeam.Next;return g};k.Clipper.prototype.DisposeAllPolyPts=function(){for(var g=0,a=this.m_PolyOuts.length;g<a;++g)this.DisposeOutRec(g);k.Clear(this.m_PolyOuts)};k.Clipper.prototype.DisposeOutRec=function(g){var a=this.m_PolyOuts[g];null!==a.Pts&&this.DisposeOutPts(a.Pts);this.m_PolyOuts[g]=null};k.Clipper.prototype.DisposeOutPts=function(g){if(null!==g)for(g.Prev.Next=null;null!==g;)g=g.Next};k.Clipper.prototype.AddJoin=function(g,a,b){var c=
new k.Join;c.OutPt1=g;c.OutPt2=a;c.OffPt.X=b.X;c.OffPt.Y=b.Y;this.m_Joins.push(c)};k.Clipper.prototype.AddGhostJoin=function(g,a){var b=new k.Join;b.OutPt1=g;b.OffPt.X=a.X;b.OffPt.Y=a.Y;this.m_GhostJoins.push(b)};k.Clipper.prototype.InsertLocalMinimaIntoAEL=function(g){for(;null!==this.m_CurrentLM&&this.m_CurrentLM.Y==g;){var a=this.m_CurrentLM.LeftBound,b=this.m_CurrentLM.RightBound;this.PopLocalMinima();var c=null;null===a?(this.InsertEdgeIntoAEL(b,null),this.SetWindingCount(b),this.IsContributing(b)&&
(c=this.AddOutPt(b,b.Bot))):(null==b?(this.InsertEdgeIntoAEL(a,null),this.SetWindingCount(a),this.IsContributing(a)&&(c=this.AddOutPt(a,a.Bot))):(this.InsertEdgeIntoAEL(a,null),this.InsertEdgeIntoAEL(b,a),this.SetWindingCount(a),b.WindCnt=a.WindCnt,b.WindCnt2=a.WindCnt2,this.IsContributing(a)&&(c=this.AddLocalMinPoly(a,b,a.Bot))),this.InsertScanbeam(a.Top.Y));null!=b&&(k.ClipperBase.IsHorizontal(b)?this.AddEdgeToSEL(b):this.InsertScanbeam(b.Top.Y));if(null!=a&&null!=b){if(null!==c&&k.ClipperBase.IsHorizontal(b)&&
0<this.m_GhostJoins.length&&0!==b.WindDelta)for(var d=0,e=this.m_GhostJoins.length;d<e;d++){var h=this.m_GhostJoins[d];this.HorzSegmentsOverlap(h.OutPt1.Pt,h.OffPt,b.Bot,b.Top)&&this.AddJoin(h.OutPt1,c,h.OffPt)}0<=a.OutIdx&&null!==a.PrevInAEL&&a.PrevInAEL.Curr.X==a.Bot.X&&0<=a.PrevInAEL.OutIdx&&k.ClipperBase.SlopesEqual(a.PrevInAEL,a,this.m_UseFullRange)&&0!==a.WindDelta&&0!==a.PrevInAEL.WindDelta&&(d=this.AddOutPt(a.PrevInAEL,a.Bot),this.AddJoin(c,d,a.Top));if(a.NextInAEL!=b&&(0<=b.OutIdx&&0<=b.PrevInAEL.OutIdx&&
k.ClipperBase.SlopesEqual(b.PrevInAEL,b,this.m_UseFullRange)&&0!==b.WindDelta&&0!==b.PrevInAEL.WindDelta&&(d=this.AddOutPt(b.PrevInAEL,b.Bot),this.AddJoin(c,d,b.Top)),c=a.NextInAEL,null!==c))for(;c!=b;)this.IntersectEdges(b,c,a.Curr,!1),c=c.NextInAEL}}};k.Clipper.prototype.InsertEdgeIntoAEL=function(g,a){if(null===this.m_ActiveEdges)g.PrevInAEL=null,g.NextInAEL=null,this.m_ActiveEdges=g;else if(null===a&&this.E2InsertsBeforeE1(this.m_ActiveEdges,g))g.PrevInAEL=null,g.NextInAEL=this.m_ActiveEdges,
this.m_ActiveEdges=this.m_ActiveEdges.PrevInAEL=g;else{for(null===a&&(a=this.m_ActiveEdges);null!==a.NextInAEL&&!this.E2InsertsBeforeE1(a.NextInAEL,g);)a=a.NextInAEL;g.NextInAEL=a.NextInAEL;null!==a.NextInAEL&&(a.NextInAEL.PrevInAEL=g);g.PrevInAEL=a;a.NextInAEL=g}};k.Clipper.prototype.E2InsertsBeforeE1=function(g,a){return a.Curr.X==g.Curr.X?a.Top.Y>g.Top.Y?a.Top.X<k.Clipper.TopX(g,a.Top.Y):g.Top.X>k.Clipper.TopX(a,g.Top.Y):a.Curr.X<g.Curr.X};k.Clipper.prototype.IsEvenOddFillType=function(g){return g.PolyTyp==
k.PolyType.ptSubject?this.m_SubjFillType==k.PolyFillType.pftEvenOdd:this.m_ClipFillType==k.PolyFillType.pftEvenOdd};k.Clipper.prototype.IsEvenOddAltFillType=function(g){return g.PolyTyp==k.PolyType.ptSubject?this.m_ClipFillType==k.PolyFillType.pftEvenOdd:this.m_SubjFillType==k.PolyFillType.pftEvenOdd};k.Clipper.prototype.IsContributing=function(g){var a,b;g.PolyTyp==k.PolyType.ptSubject?(a=this.m_SubjFillType,b=this.m_ClipFillType):(a=this.m_ClipFillType,b=this.m_SubjFillType);switch(a){case k.PolyFillType.pftEvenOdd:if(0===
g.WindDelta&&1!=g.WindCnt)return!1;break;case k.PolyFillType.pftNonZero:if(1!=Math.abs(g.WindCnt))return!1;break;case k.PolyFillType.pftPositive:if(1!=g.WindCnt)return!1;break;default:if(-1!=g.WindCnt)return!1}switch(this.m_ClipType){case k.ClipType.ctIntersection:switch(b){case k.PolyFillType.pftEvenOdd:case k.PolyFillType.pftNonZero:return 0!==g.WindCnt2;case k.PolyFillType.pftPositive:return 0<g.WindCnt2;default:return 0>g.WindCnt2}case k.ClipType.ctUnion:switch(b){case k.PolyFillType.pftEvenOdd:case k.PolyFillType.pftNonZero:return 0===
g.WindCnt2;case k.PolyFillType.pftPositive:return 0>=g.WindCnt2;default:return 0<=g.WindCnt2}case k.ClipType.ctDifference:if(g.PolyTyp==k.PolyType.ptSubject)switch(b){case k.PolyFillType.pftEvenOdd:case k.PolyFillType.pftNonZero:return 0===g.WindCnt2;case k.PolyFillType.pftPositive:return 0>=g.WindCnt2;default:return 0<=g.WindCnt2}else switch(b){case k.PolyFillType.pftEvenOdd:case k.PolyFillType.pftNonZero:return 0!==g.WindCnt2;case k.PolyFillType.pftPositive:return 0<g.WindCnt2;default:return 0>
g.WindCnt2}case k.ClipType.ctXor:if(0===g.WindDelta)switch(b){case k.PolyFillType.pftEvenOdd:case k.PolyFillType.pftNonZero:return 0===g.WindCnt2;case k.PolyFillType.pftPositive:return 0>=g.WindCnt2;default:return 0<=g.WindCnt2}}return!0};k.Clipper.prototype.SetWindingCount=function(g){for(var a=g.PrevInAEL;null!==a&&(a.PolyTyp!=g.PolyTyp||0===a.WindDelta);)a=a.PrevInAEL;if(null===a)g.WindCnt=0===g.WindDelta?1:g.WindDelta,g.WindCnt2=0,a=this.m_ActiveEdges;else{if(0===g.WindDelta&&this.m_ClipType!=
k.ClipType.ctUnion)g.WindCnt=1;else if(this.IsEvenOddFillType(g))if(0===g.WindDelta){for(var b=!0,c=a.PrevInAEL;null!==c;)c.PolyTyp==a.PolyTyp&&0!==c.WindDelta&&(b=!b),c=c.PrevInAEL;g.WindCnt=b?0:1}else g.WindCnt=g.WindDelta;else 0>a.WindCnt*a.WindDelta?1<Math.abs(a.WindCnt)?g.WindCnt=0>a.WindDelta*g.WindDelta?a.WindCnt:a.WindCnt+g.WindDelta:g.WindCnt=0===g.WindDelta?1:g.WindDelta:g.WindCnt=0===g.WindDelta?0>a.WindCnt?a.WindCnt-1:a.WindCnt+1:0>a.WindDelta*g.WindDelta?a.WindCnt:a.WindCnt+g.WindDelta;
g.WindCnt2=a.WindCnt2;a=a.NextInAEL}if(this.IsEvenOddAltFillType(g))for(;a!=g;)0!==a.WindDelta&&(g.WindCnt2=0===g.WindCnt2?1:0),a=a.NextInAEL;else for(;a!=g;)g.WindCnt2+=a.WindDelta,a=a.NextInAEL};k.Clipper.prototype.AddEdgeToSEL=function(g){null===this.m_SortedEdges?(this.m_SortedEdges=g,g.PrevInSEL=null,g.NextInSEL=null):(g.NextInSEL=this.m_SortedEdges,g.PrevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.PrevInSEL=g)};k.Clipper.prototype.CopyAELToSEL=function(){var g=this.m_ActiveEdges;for(this.m_SortedEdges=
g;null!==g;)g.PrevInSEL=g.PrevInAEL,g=g.NextInSEL=g.NextInAEL};k.Clipper.prototype.SwapPositionsInAEL=function(g,a){if(g.NextInAEL!=g.PrevInAEL&&a.NextInAEL!=a.PrevInAEL){if(g.NextInAEL==a){var b=a.NextInAEL;null!==b&&(b.PrevInAEL=g);var c=g.PrevInAEL;null!==c&&(c.NextInAEL=a);a.PrevInAEL=c;a.NextInAEL=g;g.PrevInAEL=a;g.NextInAEL=b}else a.NextInAEL==g?(b=g.NextInAEL,null!==b&&(b.PrevInAEL=a),c=a.PrevInAEL,null!==c&&(c.NextInAEL=g),g.PrevInAEL=c,g.NextInAEL=a,a.PrevInAEL=g,a.NextInAEL=b):(b=g.NextInAEL,
c=g.PrevInAEL,g.NextInAEL=a.NextInAEL,null!==g.NextInAEL&&(g.NextInAEL.PrevInAEL=g),g.PrevInAEL=a.PrevInAEL,null!==g.PrevInAEL&&(g.PrevInAEL.NextInAEL=g),a.NextInAEL=b,null!==a.NextInAEL&&(a.NextInAEL.PrevInAEL=a),a.PrevInAEL=c,null!==a.PrevInAEL&&(a.PrevInAEL.NextInAEL=a));null===g.PrevInAEL?this.m_ActiveEdges=g:null===a.PrevInAEL&&(this.m_ActiveEdges=a)}};k.Clipper.prototype.SwapPositionsInSEL=function(g,a){if(null!==g.NextInSEL||null!==g.PrevInSEL)if(null!==a.NextInSEL||null!==a.PrevInSEL){if(g.NextInSEL==
a){var b=a.NextInSEL;null!==b&&(b.PrevInSEL=g);var c=g.PrevInSEL;null!==c&&(c.NextInSEL=a);a.PrevInSEL=c;a.NextInSEL=g;g.PrevInSEL=a;g.NextInSEL=b}else a.NextInSEL==g?(b=g.NextInSEL,null!==b&&(b.PrevInSEL=a),c=a.PrevInSEL,null!==c&&(c.NextInSEL=g),g.PrevInSEL=c,g.NextInSEL=a,a.PrevInSEL=g,a.NextInSEL=b):(b=g.NextInSEL,c=g.PrevInSEL,g.NextInSEL=a.NextInSEL,null!==g.NextInSEL&&(g.NextInSEL.PrevInSEL=g),g.PrevInSEL=a.PrevInSEL,null!==g.PrevInSEL&&(g.PrevInSEL.NextInSEL=g),a.NextInSEL=b,null!==a.NextInSEL&&
(a.NextInSEL.PrevInSEL=a),a.PrevInSEL=c,null!==a.PrevInSEL&&(a.PrevInSEL.NextInSEL=a));null===g.PrevInSEL?this.m_SortedEdges=g:null===a.PrevInSEL&&(this.m_SortedEdges=a)}};k.Clipper.prototype.AddLocalMaxPoly=function(g,a,b){this.AddOutPt(g,b);0==a.WindDelta&&this.AddOutPt(a,b);g.OutIdx==a.OutIdx?(g.OutIdx=-1,a.OutIdx=-1):g.OutIdx<a.OutIdx?this.AppendPolygon(g,a):this.AppendPolygon(a,g)};k.Clipper.prototype.AddLocalMinPoly=function(g,a,b){var c,d;k.ClipperBase.IsHorizontal(a)||g.Dx>a.Dx?(c=this.AddOutPt(g,
b),a.OutIdx=g.OutIdx,g.Side=k.EdgeSide.esLeft,a.Side=k.EdgeSide.esRight,d=g,g=d.PrevInAEL==a?a.PrevInAEL:d.PrevInAEL):(c=this.AddOutPt(a,b),g.OutIdx=a.OutIdx,g.Side=k.EdgeSide.esRight,a.Side=k.EdgeSide.esLeft,d=a,g=d.PrevInAEL==g?g.PrevInAEL:d.PrevInAEL);null!==g&&0<=g.OutIdx&&k.Clipper.TopX(g,b.Y)==k.Clipper.TopX(d,b.Y)&&k.ClipperBase.SlopesEqual(d,g,this.m_UseFullRange)&&0!==d.WindDelta&&0!==g.WindDelta&&(b=this.AddOutPt(g,b),this.AddJoin(c,b,d.Top));return c};k.Clipper.prototype.CreateOutRec=function(){var g=
new k.OutRec;g.Idx=-1;g.IsHole=!1;g.IsOpen=!1;g.FirstLeft=null;g.Pts=null;g.BottomPt=null;g.PolyNode=null;this.m_PolyOuts.push(g);g.Idx=this.m_PolyOuts.length-1;return g};k.Clipper.prototype.AddOutPt=function(g,a){var b=g.Side==k.EdgeSide.esLeft;if(0>g.OutIdx){var c=this.CreateOutRec();c.IsOpen=0===g.WindDelta;var d=new k.OutPt;c.Pts=d;d.Idx=c.Idx;d.Pt.X=a.X;d.Pt.Y=a.Y;d.Next=d;d.Prev=d;c.IsOpen||this.SetHoleState(g,c);g.OutIdx=c.Idx}else{var c=this.m_PolyOuts[g.OutIdx],e=c.Pts;if(b&&k.IntPoint.op_Equality(a,
e.Pt))return e;if(!b&&k.IntPoint.op_Equality(a,e.Prev.Pt))return e.Prev;d=new k.OutPt;d.Idx=c.Idx;d.Pt.X=a.X;d.Pt.Y=a.Y;d.Next=e;d.Prev=e.Prev;d.Prev.Next=d;e.Prev=d;b&&(c.Pts=d)}return d};k.Clipper.prototype.SwapPoints=function(g,a){var b=new k.IntPoint(g.Value);g.Value.X=a.Value.X;g.Value.Y=a.Value.Y;a.Value.X=b.X;a.Value.Y=b.Y};k.Clipper.prototype.HorzSegmentsOverlap=function(g,a,b,c){return g.X>b.X==g.X<c.X?!0:a.X>b.X==a.X<c.X?!0:b.X>g.X==b.X<a.X?!0:c.X>g.X==c.X<a.X?!0:g.X==b.X&&a.X==c.X?!0:g.X==
c.X&&a.X==b.X?!0:!1};k.Clipper.prototype.InsertPolyPtBetween=function(g,a,b){var c=new k.OutPt;c.Pt.X=b.X;c.Pt.Y=b.Y;a==g.Next?(g.Next=c,a.Prev=c,c.Next=a,c.Prev=g):(a.Next=c,g.Prev=c,c.Next=g,c.Prev=a);return c};k.Clipper.prototype.SetHoleState=function(g,a){for(var b=!1,c=g.PrevInAEL;null!==c;)0<=c.OutIdx&&0!=c.WindDelta&&(b=!b,null===a.FirstLeft&&(a.FirstLeft=this.m_PolyOuts[c.OutIdx])),c=c.PrevInAEL;b&&(a.IsHole=!0)};k.Clipper.prototype.GetDx=function(g,a){return g.Y==a.Y?k.ClipperBase.horizontal:
(a.X-g.X)/(a.Y-g.Y)};k.Clipper.prototype.FirstIsBottomPt=function(g,a){for(var b=g.Prev;k.IntPoint.op_Equality(b.Pt,g.Pt)&&b!=g;)b=b.Prev;for(var c=Math.abs(this.GetDx(g.Pt,b.Pt)),b=g.Next;k.IntPoint.op_Equality(b.Pt,g.Pt)&&b!=g;)b=b.Next;for(var d=Math.abs(this.GetDx(g.Pt,b.Pt)),b=a.Prev;k.IntPoint.op_Equality(b.Pt,a.Pt)&&b!=a;)b=b.Prev;for(var e=Math.abs(this.GetDx(a.Pt,b.Pt)),b=a.Next;k.IntPoint.op_Equality(b.Pt,a.Pt)&&b!=a;)b=b.Next;b=Math.abs(this.GetDx(a.Pt,b.Pt));return c>=e&&c>=b||d>=e&&d>=
b};k.Clipper.prototype.GetBottomPt=function(g){for(var a=null,b=g.Next;b!=g;)b.Pt.Y>g.Pt.Y?(g=b,a=null):b.Pt.Y==g.Pt.Y&&b.Pt.X<=g.Pt.X&&(b.Pt.X<g.Pt.X?(a=null,g=b):b.Next!=g&&b.Prev!=g&&(a=b)),b=b.Next;if(null!==a)for(;a!=b;)for(this.FirstIsBottomPt(b,a)||(g=a),a=a.Next;k.IntPoint.op_Inequality(a.Pt,g.Pt);)a=a.Next;return g};k.Clipper.prototype.GetLowermostRec=function(g,a){null===g.BottomPt&&(g.BottomPt=this.GetBottomPt(g.Pts));null===a.BottomPt&&(a.BottomPt=this.GetBottomPt(a.Pts));var b=g.BottomPt,
c=a.BottomPt;return b.Pt.Y>c.Pt.Y?g:b.Pt.Y<c.Pt.Y?a:b.Pt.X<c.Pt.X?g:b.Pt.X>c.Pt.X?a:b.Next==b?a:c.Next==c?g:this.FirstIsBottomPt(b,c)?g:a};k.Clipper.prototype.Param1RightOfParam2=function(g,a){do if(g=g.FirstLeft,g==a)return!0;while(null!==g);return!1};k.Clipper.prototype.GetOutRec=function(g){for(g=this.m_PolyOuts[g];g!=this.m_PolyOuts[g.Idx];)g=this.m_PolyOuts[g.Idx];return g};k.Clipper.prototype.AppendPolygon=function(g,a){var b=this.m_PolyOuts[g.OutIdx],c=this.m_PolyOuts[a.OutIdx],d;d=this.Param1RightOfParam2(b,
c)?c:this.Param1RightOfParam2(c,b)?b:this.GetLowermostRec(b,c);var e=b.Pts,h=e.Prev,l=c.Pts,r=l.Prev;g.Side==k.EdgeSide.esLeft?(a.Side==k.EdgeSide.esLeft?(this.ReversePolyPtLinks(l),l.Next=e,e.Prev=l,h.Next=r,r.Prev=h,b.Pts=r):(r.Next=e,e.Prev=r,l.Prev=h,h.Next=l,b.Pts=l),e=k.EdgeSide.esLeft):(a.Side==k.EdgeSide.esRight?(this.ReversePolyPtLinks(l),h.Next=r,r.Prev=h,l.Next=e,e.Prev=l):(h.Next=l,l.Prev=h,e.Prev=r,r.Next=e),e=k.EdgeSide.esRight);b.BottomPt=null;d==c&&(c.FirstLeft!=b&&(b.FirstLeft=c.FirstLeft),
b.IsHole=c.IsHole);c.Pts=null;c.BottomPt=null;c.FirstLeft=b;d=g.OutIdx;h=a.OutIdx;g.OutIdx=-1;a.OutIdx=-1;for(l=this.m_ActiveEdges;null!==l;){if(l.OutIdx==h){l.OutIdx=d;l.Side=e;break}l=l.NextInAEL}c.Idx=b.Idx};k.Clipper.prototype.ReversePolyPtLinks=function(g){if(null!==g){var a,b;a=g;do b=a.Next,a.Next=a.Prev,a=a.Prev=b;while(a!=g)}};k.Clipper.SwapSides=function(g,a){var b=g.Side;g.Side=a.Side;a.Side=b};k.Clipper.SwapPolyIndexes=function(g,a){var b=g.OutIdx;g.OutIdx=a.OutIdx;a.OutIdx=b};k.Clipper.prototype.IntersectEdges=
function(g,a,b,c){var d=!c&&null===g.NextInLML&&g.Top.X==b.X&&g.Top.Y==b.Y;c=!c&&null===a.NextInLML&&a.Top.X==b.X&&a.Top.Y==b.Y;var e=0<=g.OutIdx,h=0<=a.OutIdx;if(0===g.WindDelta||0===a.WindDelta)0===g.WindDelta&&0===a.WindDelta?(d||c)&&e&&h&&this.AddLocalMaxPoly(g,a,b):g.PolyTyp==a.PolyTyp&&g.WindDelta!=a.WindDelta&&this.m_ClipType==k.ClipType.ctUnion?0===g.WindDelta?h&&(this.AddOutPt(g,b),e&&(g.OutIdx=-1)):e&&(this.AddOutPt(a,b),h&&(a.OutIdx=-1)):g.PolyTyp!=a.PolyTyp&&(0!==g.WindDelta||1!=Math.abs(a.WindCnt)||
this.m_ClipType==k.ClipType.ctUnion&&0!==a.WindCnt2?0!==a.WindDelta||1!=Math.abs(g.WindCnt)||this.m_ClipType==k.ClipType.ctUnion&&0!==g.WindCnt2||(this.AddOutPt(a,b),h&&(a.OutIdx=-1)):(this.AddOutPt(g,b),e&&(g.OutIdx=-1))),d&&(0>g.OutIdx?this.DeleteFromAEL(g):k.Error("Error intersecting polylines")),c&&(0>a.OutIdx?this.DeleteFromAEL(a):k.Error("Error intersecting polylines"));else{if(g.PolyTyp==a.PolyTyp)if(this.IsEvenOddFillType(g)){var l=g.WindCnt;g.WindCnt=a.WindCnt;a.WindCnt=l}else g.WindCnt=
0===g.WindCnt+a.WindDelta?-g.WindCnt:g.WindCnt+a.WindDelta,a.WindCnt=0===a.WindCnt-g.WindDelta?-a.WindCnt:a.WindCnt-g.WindDelta;else this.IsEvenOddFillType(a)?g.WindCnt2=0===g.WindCnt2?1:0:g.WindCnt2+=a.WindDelta,this.IsEvenOddFillType(g)?a.WindCnt2=0===a.WindCnt2?1:0:a.WindCnt2-=g.WindDelta;var r,n,u;g.PolyTyp==k.PolyType.ptSubject?(r=this.m_SubjFillType,u=this.m_ClipFillType):(r=this.m_ClipFillType,u=this.m_SubjFillType);a.PolyTyp==k.PolyType.ptSubject?(n=this.m_SubjFillType,l=this.m_ClipFillType):
(n=this.m_ClipFillType,l=this.m_SubjFillType);switch(r){case k.PolyFillType.pftPositive:r=g.WindCnt;break;case k.PolyFillType.pftNegative:r=-g.WindCnt;break;default:r=Math.abs(g.WindCnt)}switch(n){case k.PolyFillType.pftPositive:n=a.WindCnt;break;case k.PolyFillType.pftNegative:n=-a.WindCnt;break;default:n=Math.abs(a.WindCnt)}if(e&&h)d||c||0!==r&&1!=r||0!==n&&1!=n||g.PolyTyp!=a.PolyTyp&&this.m_ClipType!=k.ClipType.ctXor?this.AddLocalMaxPoly(g,a,b):(this.AddOutPt(g,b),this.AddOutPt(a,b),k.Clipper.SwapSides(g,
a),k.Clipper.SwapPolyIndexes(g,a));else if(e){if(0===n||1==n)this.AddOutPt(g,b),k.Clipper.SwapSides(g,a),k.Clipper.SwapPolyIndexes(g,a)}else if(h){if(0===r||1==r)this.AddOutPt(a,b),k.Clipper.SwapSides(g,a),k.Clipper.SwapPolyIndexes(g,a)}else if(!(0!==r&&1!=r||0!==n&&1!=n||d||c)){switch(u){case k.PolyFillType.pftPositive:e=g.WindCnt2;break;case k.PolyFillType.pftNegative:e=-g.WindCnt2;break;default:e=Math.abs(g.WindCnt2)}switch(l){case k.PolyFillType.pftPositive:h=a.WindCnt2;break;case k.PolyFillType.pftNegative:h=
-a.WindCnt2;break;default:h=Math.abs(a.WindCnt2)}if(g.PolyTyp!=a.PolyTyp)this.AddLocalMinPoly(g,a,b);else if(1==r&&1==n)switch(this.m_ClipType){case k.ClipType.ctIntersection:0<e&&0<h&&this.AddLocalMinPoly(g,a,b);break;case k.ClipType.ctUnion:0>=e&&0>=h&&this.AddLocalMinPoly(g,a,b);break;case k.ClipType.ctDifference:(g.PolyTyp==k.PolyType.ptClip&&0<e&&0<h||g.PolyTyp==k.PolyType.ptSubject&&0>=e&&0>=h)&&this.AddLocalMinPoly(g,a,b);break;case k.ClipType.ctXor:this.AddLocalMinPoly(g,a,b)}else k.Clipper.SwapSides(g,
a)}d!=c&&(d&&0<=g.OutIdx||c&&0<=a.OutIdx)&&(k.Clipper.SwapSides(g,a),k.Clipper.SwapPolyIndexes(g,a));d&&this.DeleteFromAEL(g);c&&this.DeleteFromAEL(a)}};k.Clipper.prototype.DeleteFromAEL=function(a){var b=a.PrevInAEL,c=a.NextInAEL;if(null!==b||null!==c||a==this.m_ActiveEdges)null!==b?b.NextInAEL=c:this.m_ActiveEdges=c,null!==c&&(c.PrevInAEL=b),a.NextInAEL=null,a.PrevInAEL=null};k.Clipper.prototype.DeleteFromSEL=function(a){var b=a.PrevInSEL,c=a.NextInSEL;if(null!==b||null!==c||a==this.m_SortedEdges)null!==
b?b.NextInSEL=c:this.m_SortedEdges=c,null!==c&&(c.PrevInSEL=b),a.NextInSEL=null,a.PrevInSEL=null};k.Clipper.prototype.UpdateEdgeIntoAEL=function(a){null===a.Value.NextInLML&&k.Error("UpdateEdgeIntoAEL: invalid call");var b=a.Value.PrevInAEL,c=a.Value.NextInAEL;a.Value.NextInLML.OutIdx=a.Value.OutIdx;null!==b?b.NextInAEL=a.Value.NextInLML:this.m_ActiveEdges=a.Value.NextInLML;null!==c&&(c.PrevInAEL=a.Value.NextInLML);a.Value.NextInLML.Side=a.Value.Side;a.Value.NextInLML.WindDelta=a.Value.WindDelta;
a.Value.NextInLML.WindCnt=a.Value.WindCnt;a.Value.NextInLML.WindCnt2=a.Value.WindCnt2;a.Value=a.Value.NextInLML;a.Value.Curr.X=a.Value.Bot.X;a.Value.Curr.Y=a.Value.Bot.Y;a.Value.PrevInAEL=b;a.Value.NextInAEL=c;k.ClipperBase.IsHorizontal(a.Value)||this.InsertScanbeam(a.Value.Top.Y)};k.Clipper.prototype.ProcessHorizontals=function(a){for(var b=this.m_SortedEdges;null!==b;)this.DeleteFromSEL(b),this.ProcessHorizontal(b,a),b=this.m_SortedEdges};k.Clipper.prototype.GetHorzDirection=function(a,b,c,d){a.Bot.X<
a.Top.X?(c.Value=a.Bot.X,d.Value=a.Top.X,b.Value=k.Direction.dLeftToRight):(c.Value=a.Top.X,d.Value=a.Bot.X,b.Value=k.Direction.dRightToLeft)};k.Clipper.prototype.PrepareHorzJoins=function(a,b){var c=this.m_PolyOuts[a.OutIdx].Pts;a.Side!=k.EdgeSide.esLeft&&(c=c.Prev);for(var d=0,e=this.m_GhostJoins.length;d<e;++d){var h=this.m_GhostJoins[d];this.HorzSegmentsOverlap(h.OutPt1.Pt,h.OffPt,a.Bot,a.Top)&&this.AddJoin(h.OutPt1,c,h.OffPt)}b&&(k.IntPoint.op_Equality(c.Pt,a.Top)?this.AddGhostJoin(c,a.Bot):
this.AddGhostJoin(c,a.Top))};k.Clipper.prototype.ProcessHorizontal=function(a,b){var c,d,e;(function(){c={Value:c};d={Value:d};e={Value:e};var b=this.GetHorzDirection(a,c,d,e);c=c.Value;d=d.Value;e=e.Value;return b}).call(this);for(var h=a,l=null;null!==h.NextInLML&&k.ClipperBase.IsHorizontal(h.NextInLML);)h=h.NextInLML;for(null===h.NextInLML&&(l=this.GetMaximaPair(h));;){for(var r=a==h,n=this.GetNextInAEL(a,c);null!==n&&!(n.Curr.X==a.Top.X&&null!==a.NextInLML&&n.Dx<a.NextInLML.Dx);){var u=this.GetNextInAEL(n,
c);if(c==k.Direction.dLeftToRight&&n.Curr.X<=e||c==k.Direction.dRightToLeft&&n.Curr.X>=d){0<=a.OutIdx&&0!=a.WindDelta&&this.PrepareHorzJoins(a,b);if(n==l&&r){c==k.Direction.dLeftToRight?this.IntersectEdges(a,n,n.Top,!1):this.IntersectEdges(n,a,n.Top,!1);0<=l.OutIdx&&k.Error("ProcessHorizontal error");return}if(c==k.Direction.dLeftToRight){var v=new k.IntPoint(n.Curr.X,a.Curr.Y);this.IntersectEdges(a,n,v,!0)}else v=new k.IntPoint(n.Curr.X,a.Curr.Y),this.IntersectEdges(n,a,v,!0);this.SwapPositionsInAEL(a,
n)}else if(c==k.Direction.dLeftToRight&&n.Curr.X>=e||c==k.Direction.dRightToLeft&&n.Curr.X<=d)break;n=u}0<=a.OutIdx&&0!==a.WindDelta&&this.PrepareHorzJoins(a,b);if(null!==a.NextInLML&&k.ClipperBase.IsHorizontal(a.NextInLML))(function(){a={Value:a};var b=this.UpdateEdgeIntoAEL(a);a=a.Value;return b}).call(this),0<=a.OutIdx&&this.AddOutPt(a,a.Bot),function(){c={Value:c};d={Value:d};e={Value:e};var b=this.GetHorzDirection(a,c,d,e);c=c.Value;d=d.Value;e=e.Value;return b}.call(this);else break}null!==
a.NextInLML?0<=a.OutIdx?(h=this.AddOutPt(a,a.Top),function(){a={Value:a};var b=this.UpdateEdgeIntoAEL(a);a=a.Value;return b}.call(this),0!==a.WindDelta&&(l=a.PrevInAEL,u=a.NextInAEL,null!==l&&l.Curr.X==a.Bot.X&&l.Curr.Y==a.Bot.Y&&0!==l.WindDelta&&0<=l.OutIdx&&l.Curr.Y>l.Top.Y&&k.ClipperBase.SlopesEqual(a,l,this.m_UseFullRange)?(u=this.AddOutPt(l,a.Bot),this.AddJoin(h,u,a.Top)):null!==u&&u.Curr.X==a.Bot.X&&u.Curr.Y==a.Bot.Y&&0!==u.WindDelta&&0<=u.OutIdx&&u.Curr.Y>u.Top.Y&&k.ClipperBase.SlopesEqual(a,
u,this.m_UseFullRange)&&(u=this.AddOutPt(u,a.Bot),this.AddJoin(h,u,a.Top)))):function(){a={Value:a};var b=this.UpdateEdgeIntoAEL(a);a=a.Value;return b}.call(this):null!==l?0<=l.OutIdx?(c==k.Direction.dLeftToRight?this.IntersectEdges(a,l,a.Top,!1):this.IntersectEdges(l,a,a.Top,!1),0<=l.OutIdx&&k.Error("ProcessHorizontal error")):(this.DeleteFromAEL(a),this.DeleteFromAEL(l)):(0<=a.OutIdx&&this.AddOutPt(a,a.Top),this.DeleteFromAEL(a))};k.Clipper.prototype.GetNextInAEL=function(a,b){return b==k.Direction.dLeftToRight?
a.NextInAEL:a.PrevInAEL};k.Clipper.prototype.IsMinima=function(a){return null!==a&&a.Prev.NextInLML!=a&&a.Next.NextInLML!=a};k.Clipper.prototype.IsMaxima=function(a,b){return null!==a&&a.Top.Y==b&&null===a.NextInLML};k.Clipper.prototype.IsIntermediate=function(a,b){return a.Top.Y==b&&null!==a.NextInLML};k.Clipper.prototype.GetMaximaPair=function(a){var b=null;k.IntPoint.op_Equality(a.Next.Top,a.Top)&&null===a.Next.NextInLML?b=a.Next:k.IntPoint.op_Equality(a.Prev.Top,a.Top)&&null===a.Prev.NextInLML&&
(b=a.Prev);return null===b||-2!=b.OutIdx&&(b.NextInAEL!=b.PrevInAEL||k.ClipperBase.IsHorizontal(b))?b:null};k.Clipper.prototype.ProcessIntersections=function(a,b){if(null==this.m_ActiveEdges)return!0;try{this.BuildIntersectList(a,b);if(0==this.m_IntersectList.length)return!0;if(1==this.m_IntersectList.length||this.FixupIntersectionOrder())this.ProcessIntersectList();else return!1}catch(c){this.m_SortedEdges=null,this.m_IntersectList.length=0,k.Error("ProcessIntersections error")}this.m_SortedEdges=
null;return!0};k.Clipper.prototype.BuildIntersectList=function(a,b){if(null!==this.m_ActiveEdges){var c=this.m_ActiveEdges;for(this.m_SortedEdges=c;null!==c;)c.PrevInSEL=c.PrevInAEL,c.NextInSEL=c.NextInAEL,c.Curr.X=k.Clipper.TopX(c,b),c=c.NextInAEL;for(var d=!0;d&&null!==this.m_SortedEdges;){d=!1;for(c=this.m_SortedEdges;null!==c.NextInSEL;){var e=c.NextInSEL,h=new k.IntPoint;c.Curr.X>e.Curr.X?(h={Value:h},d=this.IntersectPoint(c,e,h),h=h.Value,!d&&c.Curr.X>e.Curr.X+1&&k.Error("Intersection error"),
h.Y>a&&(h.Y=a,Math.abs(c.Dx)>Math.abs(e.Dx)?h.X=k.Clipper.TopX(e,a):h.X=k.Clipper.TopX(c,a)),d=new k.IntersectNode,d.Edge1=c,d.Edge2=e,d.Pt.X=h.X,d.Pt.Y=h.Y,this.m_IntersectList.push(d),this.SwapPositionsInSEL(c,e),d=!0):c=e}if(null!==c.PrevInSEL)c.PrevInSEL.NextInSEL=null;else break}this.m_SortedEdges=null}};k.Clipper.prototype.EdgesAdjacent=function(a){return a.Edge1.NextInSEL==a.Edge2||a.Edge1.PrevInSEL==a.Edge2};k.Clipper.IntersectNodeSort=function(a,b){return b.Pt.Y-a.Pt.Y};k.Clipper.prototype.FixupIntersectionOrder=
function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer);this.CopyAELToSEL();for(var a=this.m_IntersectList.length,b=0;b<a;b++){if(!this.EdgesAdjacent(this.m_IntersectList[b])){for(var c=b+1;c<a&&!this.EdgesAdjacent(this.m_IntersectList[c]);)c++;if(c==a)return!1;var d=this.m_IntersectList[b];this.m_IntersectList[b]=this.m_IntersectList[c];this.m_IntersectList[c]=d}this.SwapPositionsInSEL(this.m_IntersectList[b].Edge1,this.m_IntersectList[b].Edge2)}return!0};k.Clipper.prototype.ProcessIntersectList=
function(){for(var a=0,b=this.m_IntersectList.length;a<b;a++){var c=this.m_IntersectList[a];this.IntersectEdges(c.Edge1,c.Edge2,c.Pt,!0);this.SwapPositionsInAEL(c.Edge1,c.Edge2)}this.m_IntersectList.length=0};O=function(a){return 0>a?Math.ceil(a-.5):Math.round(a)};ea=function(a){return 0>a?Math.ceil(a-.5):Math.floor(a+.5)};ha=function(a){return 0>a?-Math.round(Math.abs(a)):Math.round(a)};A=function(a){if(0>a)return a-=.5,-2147483648>a?Math.ceil(a):a|0;a+=.5;return 2147483647<a?Math.floor(a):a|0};
k.Clipper.Round=R?O:M?ha:Y?A:ea;k.Clipper.TopX=function(a,b){return b==a.Top.Y?a.Top.X:a.Bot.X+k.Clipper.Round(a.Dx*(b-a.Bot.Y))};k.Clipper.prototype.IntersectPoint=function(a,b,c){c.Value=new k.IntPoint;var d,e;if(k.ClipperBase.SlopesEqual(a,b,this.m_UseFullRange)||a.Dx==b.Dx)return b.Bot.Y>a.Bot.Y?(c.Value.X=b.Bot.X,c.Value.Y=b.Bot.Y):(c.Value.X=a.Bot.X,c.Value.Y=a.Bot.Y),!1;if(0===a.Delta.X)c.Value.X=a.Bot.X,k.ClipperBase.IsHorizontal(b)?c.Value.Y=b.Bot.Y:(e=b.Bot.Y-b.Bot.X/b.Dx,c.Value.Y=k.Clipper.Round(c.Value.X/
b.Dx+e));else if(0===b.Delta.X)c.Value.X=b.Bot.X,k.ClipperBase.IsHorizontal(a)?c.Value.Y=a.Bot.Y:(d=a.Bot.Y-a.Bot.X/a.Dx,c.Value.Y=k.Clipper.Round(c.Value.X/a.Dx+d));else{d=a.Bot.X-a.Bot.Y*a.Dx;e=b.Bot.X-b.Bot.Y*b.Dx;var h=(e-d)/(a.Dx-b.Dx);c.Value.Y=k.Clipper.Round(h);Math.abs(a.Dx)<Math.abs(b.Dx)?c.Value.X=k.Clipper.Round(a.Dx*h+d):c.Value.X=k.Clipper.Round(b.Dx*h+e)}if(c.Value.Y<a.Top.Y||c.Value.Y<b.Top.Y){if(a.Top.Y>b.Top.Y)return c.Value.Y=a.Top.Y,c.Value.X=k.Clipper.TopX(b,a.Top.Y),c.Value.X<
a.Top.X;c.Value.Y=b.Top.Y;Math.abs(a.Dx)<Math.abs(b.Dx)?c.Value.X=k.Clipper.TopX(a,c.Value.Y):c.Value.X=k.Clipper.TopX(b,c.Value.Y)}return!0};k.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(a){for(var b=this.m_ActiveEdges;null!==b;){var c=this.IsMaxima(b,a);c&&(c=this.GetMaximaPair(b),c=null===c||!k.ClipperBase.IsHorizontal(c));if(c){var d=b.PrevInAEL;this.DoMaxima(b);b=null===d?this.m_ActiveEdges:d.NextInAEL}else this.IsIntermediate(b,a)&&k.ClipperBase.IsHorizontal(b.NextInLML)?(function(){b=
{Value:b};var a=this.UpdateEdgeIntoAEL(b);b=b.Value;return a}.call(this),0<=b.OutIdx&&this.AddOutPt(b,b.Bot),this.AddEdgeToSEL(b)):(b.Curr.X=k.Clipper.TopX(b,a),b.Curr.Y=a),this.StrictlySimple&&(d=b.PrevInAEL,0<=b.OutIdx&&0!==b.WindDelta&&null!==d&&0<=d.OutIdx&&d.Curr.X==b.Curr.X&&0!==d.WindDelta&&(c=this.AddOutPt(d,b.Curr),d=this.AddOutPt(b,b.Curr),this.AddJoin(c,d,b.Curr))),b=b.NextInAEL}this.ProcessHorizontals(!0);for(b=this.m_ActiveEdges;null!==b;){if(this.IsIntermediate(b,a)){c=null;0<=b.OutIdx&&
(c=this.AddOutPt(b,b.Top));(function(){b={Value:b};var a=this.UpdateEdgeIntoAEL(b);b=b.Value;return a}).call(this);var d=b.PrevInAEL,e=b.NextInAEL;null!==d&&d.Curr.X==b.Bot.X&&d.Curr.Y==b.Bot.Y&&null!==c&&0<=d.OutIdx&&d.Curr.Y>d.Top.Y&&k.ClipperBase.SlopesEqual(b,d,this.m_UseFullRange)&&0!==b.WindDelta&&0!==d.WindDelta?(d=this.AddOutPt(d,b.Bot),this.AddJoin(c,d,b.Top)):null!==e&&e.Curr.X==b.Bot.X&&e.Curr.Y==b.Bot.Y&&null!==c&&0<=e.OutIdx&&e.Curr.Y>e.Top.Y&&k.ClipperBase.SlopesEqual(b,e,this.m_UseFullRange)&&
0!==b.WindDelta&&0!==e.WindDelta&&(d=this.AddOutPt(e,b.Bot),this.AddJoin(c,d,b.Top))}b=b.NextInAEL}};k.Clipper.prototype.DoMaxima=function(a){var b=this.GetMaximaPair(a);if(null===b)0<=a.OutIdx&&this.AddOutPt(a,a.Top),this.DeleteFromAEL(a);else{for(var c=a.NextInAEL;null!==c&&c!=b;)this.IntersectEdges(a,c,a.Top,!0),this.SwapPositionsInAEL(a,c),c=a.NextInAEL;-1==a.OutIdx&&-1==b.OutIdx?(this.DeleteFromAEL(a),this.DeleteFromAEL(b)):0<=a.OutIdx&&0<=b.OutIdx?this.IntersectEdges(a,b,a.Top,!1):0===a.WindDelta?
(0<=a.OutIdx&&(this.AddOutPt(a,a.Top),a.OutIdx=-1),this.DeleteFromAEL(a),0<=b.OutIdx&&(this.AddOutPt(b,a.Top),b.OutIdx=-1),this.DeleteFromAEL(b)):k.Error("DoMaxima error")}};k.Clipper.ReversePaths=function(a){for(var b=0,c=a.length;b<c;b++)a[b].reverse()};k.Clipper.Orientation=function(a){return 0<=k.Clipper.Area(a)};k.Clipper.prototype.PointCount=function(a){if(null===a)return 0;var b=0,c=a;do b++,c=c.Next;while(c!=a);return b};k.Clipper.prototype.BuildResult=function(a){k.Clear(a);for(var b=0,c=
this.m_PolyOuts.length;b<c;b++){var d=this.m_PolyOuts[b];if(null!==d.Pts){var d=d.Pts.Prev,e=this.PointCount(d);if(!(2>e)){for(var h=Array(e),l=0;l<e;l++)h[l]=d.Pt,d=d.Prev;a.push(h)}}}};k.Clipper.prototype.BuildResult2=function(a){a.Clear();for(var b=0,c=this.m_PolyOuts.length;b<c;b++){var d=this.m_PolyOuts[b],e=this.PointCount(d.Pts);if(!(d.IsOpen&&2>e||!d.IsOpen&&3>e)){this.FixHoleLinkage(d);var h=new k.PolyNode;a.m_AllPolys.push(h);d.PolyNode=h;h.m_polygon.length=e;for(var d=d.Pts.Prev,l=0;l<
e;l++)h.m_polygon[l]=d.Pt,d=d.Prev}}b=0;for(c=this.m_PolyOuts.length;b<c;b++)d=this.m_PolyOuts[b],null!==d.PolyNode&&(d.IsOpen?(d.PolyNode.IsOpen=!0,a.AddChild(d.PolyNode)):null!==d.FirstLeft&&null!=d.FirstLeft.PolyNode?d.FirstLeft.PolyNode.AddChild(d.PolyNode):a.AddChild(d.PolyNode))};k.Clipper.prototype.FixupOutPolygon=function(a){var b=null;a.BottomPt=null;for(var c=a.Pts;;){if(c.Prev==c||c.Prev==c.Next){this.DisposeOutPts(c);a.Pts=null;return}if(k.IntPoint.op_Equality(c.Pt,c.Next.Pt)||k.IntPoint.op_Equality(c.Pt,
c.Prev.Pt)||k.ClipperBase.SlopesEqual(c.Prev.Pt,c.Pt,c.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(c.Prev.Pt,c.Pt,c.Next.Pt)))b=null,c.Prev.Next=c.Next,c=c.Next.Prev=c.Prev;else if(c==b)break;else null===b&&(b=c),c=c.Next}a.Pts=c};k.Clipper.prototype.DupOutPt=function(a,b){var c=new k.OutPt;c.Pt.X=a.Pt.X;c.Pt.Y=a.Pt.Y;c.Idx=a.Idx;b?(c.Next=a.Next,c.Prev=a,a.Next.Prev=c,a.Next=c):(c.Prev=a.Prev,c.Next=a,a.Prev.Next=c,a.Prev=c);return c};k.Clipper.prototype.GetOverlap=
function(a,b,c,d,e,k){a<b?c<d?(e.Value=Math.max(a,c),k.Value=Math.min(b,d)):(e.Value=Math.max(a,d),k.Value=Math.min(b,c)):c<d?(e.Value=Math.max(b,c),k.Value=Math.min(a,d)):(e.Value=Math.max(b,d),k.Value=Math.min(a,c));return e.Value<k.Value};k.Clipper.prototype.JoinHorz=function(a,b,c,d,e,h){var l=a.Pt.X>b.Pt.X?k.Direction.dRightToLeft:k.Direction.dLeftToRight;d=c.Pt.X>d.Pt.X?k.Direction.dRightToLeft:k.Direction.dLeftToRight;if(l==d)return!1;if(l==k.Direction.dLeftToRight){for(;a.Next.Pt.X<=e.X&&
a.Next.Pt.X>=a.Pt.X&&a.Next.Pt.Y==e.Y;)a=a.Next;h&&a.Pt.X!=e.X&&(a=a.Next);b=this.DupOutPt(a,!h);k.IntPoint.op_Inequality(b.Pt,e)&&(a=b,a.Pt.X=e.X,a.Pt.Y=e.Y,b=this.DupOutPt(a,!h))}else{for(;a.Next.Pt.X>=e.X&&a.Next.Pt.X<=a.Pt.X&&a.Next.Pt.Y==e.Y;)a=a.Next;h||a.Pt.X==e.X||(a=a.Next);b=this.DupOutPt(a,h);k.IntPoint.op_Inequality(b.Pt,e)&&(a=b,a.Pt.X=e.X,a.Pt.Y=e.Y,b=this.DupOutPt(a,h))}if(d==k.Direction.dLeftToRight){for(;c.Next.Pt.X<=e.X&&c.Next.Pt.X>=c.Pt.X&&c.Next.Pt.Y==e.Y;)c=c.Next;h&&c.Pt.X!=
e.X&&(c=c.Next);d=this.DupOutPt(c,!h);k.IntPoint.op_Inequality(d.Pt,e)&&(c=d,c.Pt.X=e.X,c.Pt.Y=e.Y,d=this.DupOutPt(c,!h))}else{for(;c.Next.Pt.X>=e.X&&c.Next.Pt.X<=c.Pt.X&&c.Next.Pt.Y==e.Y;)c=c.Next;h||c.Pt.X==e.X||(c=c.Next);d=this.DupOutPt(c,h);k.IntPoint.op_Inequality(d.Pt,e)&&(c=d,c.Pt.X=e.X,c.Pt.Y=e.Y,d=this.DupOutPt(c,h))}l==k.Direction.dLeftToRight==h?(a.Prev=c,c.Next=a,b.Next=d,d.Prev=b):(a.Next=c,c.Prev=a,b.Prev=d,d.Next=b);return!0};k.Clipper.prototype.JoinPoints=function(a,b,c){var d=a.OutPt1,
e=new k.OutPt,h=a.OutPt2,l=new k.OutPt;if((l=a.OutPt1.Pt.Y==a.OffPt.Y)&&k.IntPoint.op_Equality(a.OffPt,a.OutPt1.Pt)&&k.IntPoint.op_Equality(a.OffPt,a.OutPt2.Pt)){for(e=a.OutPt1.Next;e!=d&&k.IntPoint.op_Equality(e.Pt,a.OffPt);)e=e.Next;e=e.Pt.Y>a.OffPt.Y;for(l=a.OutPt2.Next;l!=h&&k.IntPoint.op_Equality(l.Pt,a.OffPt);)l=l.Next;if(e==l.Pt.Y>a.OffPt.Y)return!1;e?(e=this.DupOutPt(d,!1),l=this.DupOutPt(h,!0),d.Prev=h,h.Next=d,e.Next=l,l.Prev=e):(e=this.DupOutPt(d,!0),l=this.DupOutPt(h,!1),d.Next=h,h.Prev=
d,e.Prev=l,l.Next=e);a.OutPt1=d;a.OutPt2=e;return!0}if(l){for(e=d;d.Prev.Pt.Y==d.Pt.Y&&d.Prev!=e&&d.Prev!=h;)d=d.Prev;for(;e.Next.Pt.Y==e.Pt.Y&&e.Next!=d&&e.Next!=h;)e=e.Next;if(e.Next==d||e.Next==h)return!1;for(l=h;h.Prev.Pt.Y==h.Pt.Y&&h.Prev!=l&&h.Prev!=e;)h=h.Prev;for(;l.Next.Pt.Y==l.Pt.Y&&l.Next!=h&&l.Next!=d;)l=l.Next;if(l.Next==h||l.Next==d)return!1;var n,r;n={Value:n};r={Value:r};b=this.GetOverlap(d.Pt.X,e.Pt.X,h.Pt.X,l.Pt.X,n,r);n=n.Value;r=r.Value;if(!b)return!1;b=new k.IntPoint;d.Pt.X>=
n&&d.Pt.X<=r?(b.X=d.Pt.X,b.Y=d.Pt.Y,c=d.Pt.X>e.Pt.X):h.Pt.X>=n&&h.Pt.X<=r?(b.X=h.Pt.X,b.Y=h.Pt.Y,c=h.Pt.X>l.Pt.X):e.Pt.X>=n&&e.Pt.X<=r?(b.X=e.Pt.X,b.Y=e.Pt.Y,c=e.Pt.X>d.Pt.X):(b.X=l.Pt.X,b.Y=l.Pt.Y,c=l.Pt.X>h.Pt.X);a.OutPt1=d;a.OutPt2=h;return this.JoinHorz(d,e,h,l,b,c)}for(e=d.Next;k.IntPoint.op_Equality(e.Pt,d.Pt)&&e!=d;)e=e.Next;if(n=e.Pt.Y>d.Pt.Y||!k.ClipperBase.SlopesEqual(d.Pt,e.Pt,a.OffPt,this.m_UseFullRange)){for(e=d.Prev;k.IntPoint.op_Equality(e.Pt,d.Pt)&&e!=d;)e=e.Prev;if(e.Pt.Y>d.Pt.Y||
!k.ClipperBase.SlopesEqual(d.Pt,e.Pt,a.OffPt,this.m_UseFullRange))return!1}for(l=h.Next;k.IntPoint.op_Equality(l.Pt,h.Pt)&&l!=h;)l=l.Next;if(r=l.Pt.Y>h.Pt.Y||!k.ClipperBase.SlopesEqual(h.Pt,l.Pt,a.OffPt,this.m_UseFullRange)){for(l=h.Prev;k.IntPoint.op_Equality(l.Pt,h.Pt)&&l!=h;)l=l.Prev;if(l.Pt.Y>h.Pt.Y||!k.ClipperBase.SlopesEqual(h.Pt,l.Pt,a.OffPt,this.m_UseFullRange))return!1}if(e==d||l==h||e==l||b==c&&n==r)return!1;n?(e=this.DupOutPt(d,!1),l=this.DupOutPt(h,!0),d.Prev=h,h.Next=d,e.Next=l,l.Prev=
e):(e=this.DupOutPt(d,!0),l=this.DupOutPt(h,!1),d.Next=h,h.Prev=d,e.Prev=l,l.Next=e);a.OutPt1=d;a.OutPt2=e;return!0};k.Clipper.GetBounds=function(a){for(var b=0,c=a.length;b<c&&0==a[b].length;)b++;if(b==c)return new k.IntRect(0,0,0,0);var d=new k.IntRect;d.left=a[b][0].X;d.right=d.left;d.top=a[b][0].Y;for(d.bottom=d.top;b<c;b++)for(var e=0,h=a[b].length;e<h;e++)a[b][e].X<d.left?d.left=a[b][e].X:a[b][e].X>d.right&&(d.right=a[b][e].X),a[b][e].Y<d.top?d.top=a[b][e].Y:a[b][e].Y>d.bottom&&(d.bottom=a[b][e].Y);
return d};k.Clipper.prototype.GetBounds2=function(a){var b=a,c=new k.IntRect;c.left=a.Pt.X;c.right=a.Pt.X;c.top=a.Pt.Y;c.bottom=a.Pt.Y;for(a=a.Next;a!=b;)a.Pt.X<c.left&&(c.left=a.Pt.X),a.Pt.X>c.right&&(c.right=a.Pt.X),a.Pt.Y<c.top&&(c.top=a.Pt.Y),a.Pt.Y>c.bottom&&(c.bottom=a.Pt.Y),a=a.Next;return c};k.ClipperBase.prototype.PointInPolygon=k.Clipper.prototype.PointInPolygon=function(){var b=arguments,c=b.length;if(2==c){for(var c=b[0],d=b[1],b=0,e=d;;){var k=d.Pt.X,h=d.Pt.Y,l=d.Next.Pt.X,n=d.Next.Pt.Y;
if(n==c.Y&&(l==c.X||h==c.Y&&l>c.X==k<c.X))return-1;if(h<c.Y!=n<c.Y)if(k>=c.X)if(l>c.X)b=1-b;else{k=(k-c.X)*(n-c.Y)-(l-c.X)*(h-c.Y);if(0==k)return-1;0<k==n>h&&(b=1-b)}else if(l>c.X){k=(k-c.X)*(n-c.Y)-(l-c.X)*(h-c.Y);if(0==k)return-1;0<k==n>h&&(b=1-b)}d=d.Next;if(e==d)break}return b}if(3==c){c=b[0];d=b[1];e=b[2];h=d;b=!1;if(e){do h.Pt.Y>c.Y!=h.Prev.Pt.Y>c.Y&&a.op_LessThan(new a(c.X-h.Pt.X),a.op_Division(a.Int128Mul(h.Prev.Pt.X-h.Pt.X,c.Y-h.Pt.Y),new a(h.Prev.Pt.Y-h.Pt.Y)))&&(b=!b),h=h.Next;while(h!=
d)}else{do h.Pt.Y>c.Y!=h.Prev.Pt.Y>c.Y&&c.X-h.Pt.X<(h.Prev.Pt.X-h.Pt.X)*(c.Y-h.Pt.Y)/(h.Prev.Pt.Y-h.Pt.Y)&&(b=!b),h=h.Next;while(h!=d)}return b}};k.Clipper.prototype.Poly2ContainsPoly1=function(a,b){var c=a;do{var d=this.PointInPolygon(c.Pt,b);if(0<=d)return 0!=d;c=c.Next}while(c!=a);return!0};k.Clipper.prototype.FixupFirstLefts1=function(a,b){for(var c=0,d=this.m_PolyOuts.length;c<d;c++){var e=this.m_PolyOuts[c];null!==e.Pts&&e.FirstLeft==a&&this.Poly2ContainsPoly1(e.Pts,b.Pts)&&(e.FirstLeft=b)}};
k.Clipper.prototype.FixupFirstLefts2=function(a,b){for(var c=0,d=this.m_PolyOuts,e=d.length,h=d[c];c<e;c++,h=d[c])h.FirstLeft==a&&(h.FirstLeft=b)};k.Clipper.ParseFirstLeft=function(a){for(;null!=a&&null==a.Pts;)a=a.FirstLeft;return a};k.Clipper.prototype.JoinCommonEdges=function(){for(var a=0,b=this.m_Joins.length;a<b;a++){var c=this.m_Joins[a],d=this.GetOutRec(c.OutPt1.Idx),e=this.GetOutRec(c.OutPt2.Idx);if(null!=d.Pts&&null!=e.Pts){var h;h=d==e?d:this.Param1RightOfParam2(d,e)?e:this.Param1RightOfParam2(e,
d)?d:this.GetLowermostRec(d,e);if(this.JoinPoints(c,d,e))if(d==e){d.Pts=c.OutPt1;d.BottomPt=null;e=this.CreateOutRec();e.Pts=c.OutPt2;this.UpdateOutPtIdxs(e);if(this.m_UsingPolyTree){h=0;for(var l=this.m_PolyOuts.length;h<l-1;h++){var n=this.m_PolyOuts[h];null!=n.Pts&&k.Clipper.ParseFirstLeft(n.FirstLeft)==d&&n.IsHole!=d.IsHole&&this.Poly2ContainsPoly1(n.Pts,c.OutPt2)&&(n.FirstLeft=e)}}this.Poly2ContainsPoly1(e.Pts,d.Pts)?(e.IsHole=!d.IsHole,e.FirstLeft=d,this.m_UsingPolyTree&&this.FixupFirstLefts2(e,
d),(e.IsHole^this.ReverseSolution)==0<this.Area(e)&&this.ReversePolyPtLinks(e.Pts)):this.Poly2ContainsPoly1(d.Pts,e.Pts)?(e.IsHole=d.IsHole,d.IsHole=!e.IsHole,e.FirstLeft=d.FirstLeft,d.FirstLeft=e,this.m_UsingPolyTree&&this.FixupFirstLefts2(d,e),(d.IsHole^this.ReverseSolution)==0<this.Area(d)&&this.ReversePolyPtLinks(d.Pts)):(e.IsHole=d.IsHole,e.FirstLeft=d.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(d,e))}else e.Pts=null,e.BottomPt=null,e.Idx=d.Idx,d.IsHole=h.IsHole,h==e&&(d.FirstLeft=
e.FirstLeft),e.FirstLeft=d,this.m_UsingPolyTree&&this.FixupFirstLefts2(e,d)}}};k.Clipper.prototype.UpdateOutPtIdxs=function(a){var b=a.Pts;do b.Idx=a.Idx,b=b.Prev;while(b!=a.Pts)};k.Clipper.prototype.DoSimplePolygons=function(){for(var a=0;a<this.m_PolyOuts.length;){var b=this.m_PolyOuts[a++],c=b.Pts;if(null!==c){do{for(var d=c.Next;d!=b.Pts;){if(k.IntPoint.op_Equality(c.Pt,d.Pt)&&d.Next!=c&&d.Prev!=c){var e=c.Prev,h=d.Prev;c.Prev=h;h.Next=c;d.Prev=e;e.Next=d;b.Pts=c;e=this.CreateOutRec();e.Pts=d;
this.UpdateOutPtIdxs(e);this.Poly2ContainsPoly1(e.Pts,b.Pts)?(e.IsHole=!b.IsHole,e.FirstLeft=b):this.Poly2ContainsPoly1(b.Pts,e.Pts)?(e.IsHole=b.IsHole,b.IsHole=!e.IsHole,e.FirstLeft=b.FirstLeft,b.FirstLeft=e):(e.IsHole=b.IsHole,e.FirstLeft=b.FirstLeft);d=c}d=d.Next}c=c.Next}while(c!=b.Pts)}}};k.Clipper.Area=function(a){var b=a.length;if(3>b)return 0;for(var c=0,d=0,e=b-1;d<b;++d)c+=(a[e].X+a[d].X)*(a[e].Y-a[d].Y),e=d;return.5*-c};k.Clipper.prototype.Area=function(a){var b=a.Pts;if(null==b)return 0;
var c=0;do c+=(b.Prev.Pt.X+b.Pt.X)*(b.Prev.Pt.Y-b.Pt.Y),b=b.Next;while(b!=a.Pts);return.5*c};k.Clipper.SimplifyPolygon=function(a,b){var c=[],d=new k.Clipper(0);d.StrictlySimple=!0;d.AddPath(a,k.PolyType.ptSubject,!0);d.Execute(k.ClipType.ctUnion,c,b,b);return c};k.Clipper.SimplifyPolygons=function(a,b){"undefined"==typeof b&&(b=k.PolyFillType.pftEvenOdd);var c=[],d=new k.Clipper(0);d.StrictlySimple=!0;d.AddPaths(a,k.PolyType.ptSubject,!0);d.Execute(k.ClipType.ctUnion,c,b,b);return c};k.Clipper.DistanceSqrd=
function(a,b){var c=a.X-b.X,d=a.Y-b.Y;return c*c+d*d};k.Clipper.DistanceFromLineSqrd=function(a,b,c){var d=b.Y-c.Y;c=c.X-b.X;b=d*b.X+c*b.Y;b=d*a.X+c*a.Y-b;return b*b/(d*d+c*c)};k.Clipper.SlopesNearCollinear=function(a,b,c,d){return k.Clipper.DistanceFromLineSqrd(b,a,c)<d};k.Clipper.PointsAreClose=function(a,b,c){var d=a.X-b.X;a=a.Y-b.Y;return d*d+a*a<=c};k.Clipper.ExcludeOp=function(a){var b=a.Prev;b.Next=a.Next;a.Next.Prev=b;b.Idx=0;return b};k.Clipper.CleanPolygon=function(a,b){"undefined"==typeof b&&
(b=1.415);var c=a.length;if(0==c)return[];for(var d=Array(c),e=0;e<c;++e)d[e]=new k.OutPt;for(e=0;e<c;++e)d[e].Pt=a[e],d[e].Next=d[(e+1)%c],d[e].Next.Prev=d[e],d[e].Idx=0;e=b*b;for(d=d[0];0==d.Idx&&d.Next!=d.Prev;)k.Clipper.PointsAreClose(d.Pt,d.Prev.Pt,e)?(d=k.Clipper.ExcludeOp(d),c--):k.Clipper.PointsAreClose(d.Prev.Pt,d.Next.Pt,e)?(k.Clipper.ExcludeOp(d.Next),d=k.Clipper.ExcludeOp(d),c-=2):k.Clipper.SlopesNearCollinear(d.Prev.Pt,d.Pt,d.Next.Pt,e)?(d=k.Clipper.ExcludeOp(d),c--):(d.Idx=1,d=d.Next);
3>c&&(c=0);for(var h=Array(c),e=0;e<c;++e)h[e]=new k.IntPoint(d.Pt),d=d.Next;return h};k.Clipper.CleanPolygons=function(a,b){for(var c=Array(a.length),d=0,e=a.length;d<e;d++)c[d]=k.Clipper.CleanPolygon(a[d],b);return c};k.Clipper.Minkowski=function(a,b,c,d){var e=d?1:0,h=a.length,l=b.length;d=[];if(c)for(c=0;c<l;c++){for(var n=Array(h),r=0,u=a.length,v=a[r];r<u;r++,v=a[r])n[r]=new k.IntPoint(b[c].X+v.X,b[c].Y+v.Y);d.push(n)}else for(c=0;c<l;c++){n=Array(h);r=0;u=a.length;for(v=a[r];r<u;r++,v=a[r])n[r]=
new k.IntPoint(b[c].X-v.X,b[c].Y-v.Y);d.push(n)}a=[];for(c=0;c<=l-2+e;c++)for(r=0;r<=h-1;r++)b=[],b.push(d[c%l][r%h]),b.push(d[(c+1)%l][r%h]),b.push(d[(c+1)%l][(r+1)%h]),b.push(d[c%l][(r+1)%h]),k.Clipper.Orientation(b)||b.reverse(),a.push(b);e=new k.Clipper(0);e.AddPaths(a,k.PolyType.ptSubject,!0);e.Execute(k.ClipType.ctUnion,d,k.PolyFillType.pftNonZero,k.PolyFillType.pftNonZero);return d};k.Clipper.MinkowskiSum=function(a,b,c){return k.Clipper.Minkowski(a,b,!0,c)};k.Clipper.MinkowskiDiff=function(a,
b,c){return k.Clipper.Minkowski(a,b,!1,c)};k.Clipper.PolyTreeToPaths=function(a){var b=[];k.Clipper.AddPolyNodeToPaths(a,k.Clipper.NodeType.ntAny,b);return b};k.Clipper.AddPolyNodeToPaths=function(a,b,c){var d=!0;switch(b){case k.Clipper.NodeType.ntOpen:return;case k.Clipper.NodeType.ntClosed:d=!a.IsOpen}0<a.m_polygon.length&&d&&c.push(a.m_polygon);d=0;a=a.Childs();for(var e=a.length,h=a[d];d<e;d++,h=a[d])k.Clipper.AddPolyNodeToPaths(h,b,c)};k.Clipper.OpenPathsFromPolyTree=function(a){for(var b=new k.Paths,
c=0,d=a.ChildCount();c<d;c++)a.Childs()[c].IsOpen&&b.push(a.Childs()[c].m_polygon);return b};k.Clipper.ClosedPathsFromPolyTree=function(a){var b=new k.Paths;k.Clipper.AddPolyNodeToPaths(a,k.Clipper.NodeType.ntClosed,b);return b};sa(k.Clipper,k.ClipperBase);k.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2};k.ClipperOffset=function(a,b){"undefined"==typeof a&&(a=2);"undefined"==typeof b&&(b=k.ClipperOffset.def_arc_tolerance);this.m_destPolys=new k.Paths;this.m_srcPoly=new k.Path;this.m_destPoly=new k.Path;
this.m_normals=[];this.m_StepsPerRad=this.m_miterLim=this.m_cos=this.m_sin=this.m_sinA=this.m_delta=0;this.m_lowest=new k.IntPoint;this.m_polyNodes=new k.PolyNode;this.MiterLimit=a;this.ArcTolerance=b;this.m_lowest.X=-1};k.ClipperOffset.two_pi=6.28318530717959;k.ClipperOffset.def_arc_tolerance=.25;k.ClipperOffset.prototype.Clear=function(){k.Clear(this.m_polyNodes.Childs());this.m_lowest.X=-1};k.ClipperOffset.Round=k.Clipper.Round;k.ClipperOffset.prototype.AddPath=function(a,b,c){var d=a.length-1;
if(!(0>d)){var e=new k.PolyNode;e.m_jointype=b;e.m_endtype=c;if(c==k.EndType.etClosedLine||c==k.EndType.etClosedPolygon)for(;0<d&&k.IntPoint.op_Equality(a[0],a[d]);)d--;e.m_polygon.push(a[0]);var h=0;b=0;for(var l=1;l<=d;l++)k.IntPoint.op_Inequality(e.m_polygon[h],a[l])&&(h++,e.m_polygon.push(a[l]),a[l].Y>e.m_polygon[b].Y||a[l].Y==e.m_polygon[b].Y&&a[l].X<e.m_polygon[b].X)&&(b=h);if(!(c==k.EndType.etClosedPolygon&&2>h||c!=k.EndType.etClosedPolygon&&0>h)&&(this.m_polyNodes.AddChild(e),c==k.EndType.etClosedPolygon))if(0>
this.m_lowest.X)this.m_lowest=new k.IntPoint(0,b);else if(a=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],e.m_polygon[b].Y>a.Y||e.m_polygon[b].Y==a.Y&&e.m_polygon[b].X<a.X)this.m_lowest=new k.IntPoint(this.m_polyNodes.ChildCount()-1,b)}};k.ClipperOffset.prototype.AddPaths=function(a,b,c){for(var d=0,e=a.length;d<e;d++)this.AddPath(a[d],b,c)};k.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!k.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var a=
0;a<this.m_polyNodes.ChildCount();a++){var b=this.m_polyNodes.Childs()[a];(b.m_endtype==k.EndType.etClosedPolygon||b.m_endtype==k.EndType.etClosedLine&&k.Clipper.Orientation(b.m_polygon))&&b.m_polygon.reverse()}else for(a=0;a<this.m_polyNodes.ChildCount();a++)b=this.m_polyNodes.Childs()[a],b.m_endtype!=k.EndType.etClosedLine||k.Clipper.Orientation(b.m_polygon)||b.m_polygon.reverse()};k.ClipperOffset.GetUnitNormal=function(a,b){var c=b.X-a.X,d=b.Y-a.Y;if(0==c&&0==d)return new k.DoublePoint(0,0);var e=
1/Math.sqrt(c*c+d*d);return new k.DoublePoint(d*e,-(c*e))};k.ClipperOffset.prototype.DoOffset=function(a){this.m_destPolys=[];this.m_delta=a;if(k.ClipperBase.near_zero(a))for(var b=0;b<this.m_polyNodes.ChildCount();b++){var c=this.m_polyNodes.Childs()[b];c.m_endtype==k.EndType.etClosedPolygon&&this.m_destPolys.push(c.m_polygon)}else{this.m_miterLim=2<this.MiterLimit?2/(this.MiterLimit*this.MiterLimit):.5;var b=0>=this.ArcTolerance?k.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(a)*k.ClipperOffset.def_arc_tolerance?
Math.abs(a)*k.ClipperOffset.def_arc_tolerance:this.ArcTolerance,d=3.14159265358979/Math.acos(1-b/Math.abs(a));this.m_sin=Math.sin(k.ClipperOffset.two_pi/d);this.m_cos=Math.cos(k.ClipperOffset.two_pi/d);this.m_StepsPerRad=d/k.ClipperOffset.two_pi;0>a&&(this.m_sin=-this.m_sin);for(b=0;b<this.m_polyNodes.ChildCount();b++){c=this.m_polyNodes.Childs()[b];this.m_srcPoly=c.m_polygon;var e=this.m_srcPoly.length;if(!(0==e||0>=a&&(3>e||c.m_endtype!=k.EndType.etClosedPolygon))){this.m_destPoly=[];if(1==e)if(c.m_jointype==
k.JoinType.jtRound)for(var c=1,e=0,h=1;h<=d;h++){this.m_destPoly.push(new k.IntPoint(k.ClipperOffset.Round(this.m_srcPoly[0].X+c*a),k.ClipperOffset.Round(this.m_srcPoly[0].Y+e*a)));var l=c,c=c*this.m_cos-this.m_sin*e,e=l*this.m_sin+e*this.m_cos}else for(e=c=-1,h=0;4>h;++h)this.m_destPoly.push(new k.IntPoint(k.ClipperOffset.Round(this.m_srcPoly[0].X+c*a),k.ClipperOffset.Round(this.m_srcPoly[0].Y+e*a))),0>c?c=1:0>e?e=1:c=-1;else{for(h=this.m_normals.length=0;h<e-1;h++)this.m_normals.push(k.ClipperOffset.GetUnitNormal(this.m_srcPoly[h],
this.m_srcPoly[h+1]));c.m_endtype==k.EndType.etClosedLine||c.m_endtype==k.EndType.etClosedPolygon?this.m_normals.push(k.ClipperOffset.GetUnitNormal(this.m_srcPoly[e-1],this.m_srcPoly[0])):this.m_normals.push(new k.DoublePoint(this.m_normals[e-2]));if(c.m_endtype==k.EndType.etClosedPolygon)for(l=e-1,h=0;h<e;h++)l=this.OffsetPoint(h,l,c.m_jointype);else if(c.m_endtype==k.EndType.etClosedLine){l=e-1;for(h=0;h<e;h++)l=this.OffsetPoint(h,l,c.m_jointype);this.m_destPolys.push(this.m_destPoly);this.m_destPoly=
[];l=this.m_normals[e-1];for(h=e-1;0<h;h--)this.m_normals[h]=new k.DoublePoint(-this.m_normals[h-1].X,-this.m_normals[h-1].Y);this.m_normals[0]=new k.DoublePoint(-l.X,-l.Y);l=0;for(h=e-1;0<=h;h--)l=this.OffsetPoint(h,l,c.m_jointype)}else{l=0;for(h=1;h<e-1;++h)l=this.OffsetPoint(h,l,c.m_jointype);c.m_endtype==k.EndType.etOpenButt?(h=e-1,l=new k.IntPoint(k.ClipperOffset.Round(this.m_srcPoly[h].X+this.m_normals[h].X*a),k.ClipperOffset.Round(this.m_srcPoly[h].Y+this.m_normals[h].Y*a)),this.m_destPoly.push(l),
l=new k.IntPoint(k.ClipperOffset.Round(this.m_srcPoly[h].X-this.m_normals[h].X*a),k.ClipperOffset.Round(this.m_srcPoly[h].Y-this.m_normals[h].Y*a)),this.m_destPoly.push(l)):(h=e-1,l=e-2,this.m_sinA=0,this.m_normals[h]=new k.DoublePoint(-this.m_normals[h].X,-this.m_normals[h].Y),c.m_endtype==k.EndType.etOpenSquare?this.DoSquare(h,l):this.DoRound(h,l));for(h=e-1;0<h;h--)this.m_normals[h]=new k.DoublePoint(-this.m_normals[h-1].X,-this.m_normals[h-1].Y);this.m_normals[0]=new k.DoublePoint(-this.m_normals[1].X,
-this.m_normals[1].Y);l=e-1;for(h=l-1;0<h;--h)l=this.OffsetPoint(h,l,c.m_jointype);c.m_endtype==k.EndType.etOpenButt?(l=new k.IntPoint(k.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*a),k.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*a)),this.m_destPoly.push(l),l=new k.IntPoint(k.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*a),k.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*a)),this.m_destPoly.push(l)):(this.m_sinA=0,c.m_endtype==k.EndType.etOpenSquare?
this.DoSquare(0,1):this.DoRound(0,1))}}this.m_destPolys.push(this.m_destPoly)}}}};k.ClipperOffset.prototype.Execute=function(){var a=arguments;if(a[0]instanceof k.PolyTree)if(b=a[0],c=a[1],b.Clear(),this.FixOrientations(),this.DoOffset(c),a=new k.Clipper(0),a.AddPaths(this.m_destPolys,k.PolyType.ptSubject,!0),0<c)a.Execute(k.ClipType.ctUnion,b,k.PolyFillType.pftPositive,k.PolyFillType.pftPositive);else if(c=k.Clipper.GetBounds(this.m_destPolys),d=new k.Path,d.push(new k.IntPoint(c.left-10,c.bottom+
10)),d.push(new k.IntPoint(c.right+10,c.bottom+10)),d.push(new k.IntPoint(c.right+10,c.top-10)),d.push(new k.IntPoint(c.left-10,c.top-10)),a.AddPath(d,k.PolyType.ptSubject,!0),a.ReverseSolution=!0,a.Execute(k.ClipType.ctUnion,b,k.PolyFillType.pftNegative,k.PolyFillType.pftNegative),1==b.ChildCount()&&0<b.Childs()[0].ChildCount())for(a=b.Childs()[0],b.Childs()[0]=a.Childs()[0],c=1;c<a.ChildCount();c++)b.AddChild(a.Childs()[c]);else b.Clear();else{var b=a[0],c=a[1];k.Clear(b);this.FixOrientations();
this.DoOffset(c);a=new k.Clipper(0);a.AddPaths(this.m_destPolys,k.PolyType.ptSubject,!0);if(0<c)a.Execute(k.ClipType.ctUnion,b,k.PolyFillType.pftPositive,k.PolyFillType.pftPositive);else{var c=k.Clipper.GetBounds(this.m_destPolys),d=new k.Path;d.push(new k.IntPoint(c.left-10,c.bottom+10));d.push(new k.IntPoint(c.right+10,c.bottom+10));d.push(new k.IntPoint(c.right+10,c.top-10));d.push(new k.IntPoint(c.left-10,c.top-10));a.AddPath(d,k.PolyType.ptSubject,!0);a.ReverseSolution=!0;a.Execute(k.ClipType.ctUnion,
b,k.PolyFillType.pftNegative,k.PolyFillType.pftNegative);0<b.length&&b.splice(0,1)}}};k.ClipperOffset.prototype.OffsetPoint=function(a,b,c){this.m_sinA=this.m_normals[b].X*this.m_normals[a].Y-this.m_normals[a].X*this.m_normals[b].Y;if(5E-5>this.m_sinA&&-5E-5<this.m_sinA)return b;1<this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1);if(0>this.m_sinA*this.m_delta)this.m_destPoly.push(new k.IntPoint(k.ClipperOffset.Round(this.m_srcPoly[a].X+this.m_normals[b].X*this.m_delta),k.ClipperOffset.Round(this.m_srcPoly[a].Y+
this.m_normals[b].Y*this.m_delta))),this.m_destPoly.push(new k.IntPoint(this.m_srcPoly[a])),this.m_destPoly.push(new k.IntPoint(k.ClipperOffset.Round(this.m_srcPoly[a].X+this.m_normals[a].X*this.m_delta),k.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_normals[a].Y*this.m_delta)));else switch(c){case k.JoinType.jtMiter:c=1+(this.m_normals[a].X*this.m_normals[b].X+this.m_normals[a].Y*this.m_normals[b].Y);c>=this.m_miterLim?this.DoMiter(a,b,c):this.DoSquare(a,b);break;case k.JoinType.jtSquare:this.DoSquare(a,
b);break;case k.JoinType.jtRound:this.DoRound(a,b)}return a};k.ClipperOffset.prototype.DoSquare=function(a,b){var c=Math.tan(Math.atan2(this.m_sinA,this.m_normals[b].X*this.m_normals[a].X+this.m_normals[b].Y*this.m_normals[a].Y)/4);this.m_destPoly.push(new k.IntPoint(k.ClipperOffset.Round(this.m_srcPoly[a].X+this.m_delta*(this.m_normals[b].X-this.m_normals[b].Y*c)),k.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_delta*(this.m_normals[b].Y+this.m_normals[b].X*c))));this.m_destPoly.push(new k.IntPoint(k.ClipperOffset.Round(this.m_srcPoly[a].X+
this.m_delta*(this.m_normals[a].X+this.m_normals[a].Y*c)),k.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_delta*(this.m_normals[a].Y-this.m_normals[a].X*c))))};k.ClipperOffset.prototype.DoMiter=function(a,b,c){c=this.m_delta/c;this.m_destPoly.push(new k.IntPoint(k.ClipperOffset.Round(this.m_srcPoly[a].X+(this.m_normals[b].X+this.m_normals[a].X)*c),k.ClipperOffset.Round(this.m_srcPoly[a].Y+(this.m_normals[b].Y+this.m_normals[a].Y)*c)))};k.ClipperOffset.prototype.DoRound=function(a,b){for(var c=Math.atan2(this.m_sinA,
this.m_normals[b].X*this.m_normals[a].X+this.m_normals[b].Y*this.m_normals[a].Y),c=k.Cast_Int32(k.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(c))),d=this.m_normals[b].X,e=this.m_normals[b].Y,h,l=0;l<c;++l)this.m_destPoly.push(new k.IntPoint(k.ClipperOffset.Round(this.m_srcPoly[a].X+d*this.m_delta),k.ClipperOffset.Round(this.m_srcPoly[a].Y+e*this.m_delta))),h=d,d=d*this.m_cos-this.m_sin*e,e=h*this.m_sin+e*this.m_cos;this.m_destPoly.push(new k.IntPoint(k.ClipperOffset.Round(this.m_srcPoly[a].X+
this.m_normals[a].X*this.m_delta),k.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_normals[a].Y*this.m_delta)))};k.Error=function(a){try{throw Error(a);}catch(b){alert(b.message)}};k.JS={};k.JS.AreaOfPolygon=function(a,b){b||(b=1);return k.Clipper.Area(a)/(b*b)};k.JS.AreaOfPolygons=function(a,b){b||(b=1);for(var c=0,d=0;d<a.length;d++)c+=k.Clipper.Area(a[d]);return c/(b*b)};k.JS.BoundsOfPath=function(a,b){return k.JS.BoundsOfPaths([a],b)};k.JS.BoundsOfPaths=function(a,b){b||(b=1);var c=k.Clipper.GetBounds(a);
c.left/=b;c.bottom/=b;c.right/=b;c.top/=b;return c};k.JS.Clean=function(a,b){if(!(a instanceof Array))return[];var c=a[0]instanceof Array;a=k.JS.Clone(a);if("number"!=typeof b||null===b)return k.Error("Delta is not a number in Clean()."),a;if(0===a.length||1==a.length&&0===a[0].length||0>b)return a;c||(a=[a]);for(var d=a.length,e,h,l,n,r,u,v,w=[],y=0;y<d;y++)if(h=a[y],e=h.length,0!==e)if(3>e)l=h,w.push(l);else{l=h;n=b*b;r=h[0];for(v=u=1;v<e;v++)(h[v].X-r.X)*(h[v].X-r.X)+(h[v].Y-r.Y)*(h[v].Y-r.Y)<=
n||(l[u]=h[v],r=h[v],u++);r=h[u-1];(h[0].X-r.X)*(h[0].X-r.X)+(h[0].Y-r.Y)*(h[0].Y-r.Y)<=n&&u--;u<e&&l.splice(u,e-u);l.length&&w.push(l)}!c&&w.length?w=w[0]:c||0!==w.length?c&&0===w.length&&(w=[[]]):w=[];return w};k.JS.Clone=function(a){if(!(a instanceof Array)||0===a.length)return[];if(1==a.length&&0===a[0].length)return[[]];var b=a[0]instanceof Array;b||(a=[a]);var c=a.length,d,e,h,k,l=Array(c);for(e=0;e<c;e++){d=a[e].length;k=Array(d);for(h=0;h<d;h++)k[h]={X:a[e][h].X,Y:a[e][h].Y};l[e]=k}b||(l=
l[0]);return l};k.JS.Lighten=function(a,b){if(!(a instanceof Array))return[];if("number"!=typeof b||null===b)return k.Error("Tolerance is not a number in Lighten()."),k.JS.Clone(a);if(0===a.length||1==a.length&&0===a[0].length||0>b)return k.JS.Clone(a);a[0]instanceof Array||(a=[a]);var c,d,e,h,l,r,n,u,v,w,y,A,C,E,G,H=a.length,K=b*b,M=[];for(c=0;c<H;c++)if(e=a[c],r=e.length,0!=r){for(h=0;1E6>h;h++){l=[];r=e.length;e[r-1].X!=e[0].X||e[r-1].Y!=e[0].Y?(y=1,e.push({X:e[0].X,Y:e[0].Y}),r=e.length):y=0;
w=[];for(d=0;d<r-2;d++){n=e[d];v=e[d+1];u=e[d+2];E=n.X;G=n.Y;n=u.X-E;A=u.Y-G;if(0!==n||0!==A)C=((v.X-E)*n+(v.Y-G)*A)/(n*n+A*A),1<C?(E=u.X,G=u.Y):0<C&&(E+=n*C,G+=A*C);n=v.X-E;A=v.Y-G;u=n*n+A*A;u<=K&&(w[d+1]=1,d++)}l.push({X:e[0].X,Y:e[0].Y});for(d=1;d<r-1;d++)w[d]||l.push({X:e[d].X,Y:e[d].Y});l.push({X:e[r-1].X,Y:e[r-1].Y});y&&e.pop();if(w.length)e=l;else break}r=l.length;l[r-1].X==l[0].X&&l[r-1].Y==l[0].Y&&l.pop();2<l.length&&M.push(l)}a[0]instanceof Array||(M=M[0]);"undefined"==typeof M&&(M=[[]]);
return M};k.JS.PerimeterOfPath=function(a,b,c){if("undefined"==typeof a)return 0;var d=Math.sqrt,e=0,h,k,l=0,r=0,n=a.length;if(2>n)return 0;for(b&&(a[n]=a[0],n++);--n;)h=a[n],l=h.X,h=h.Y,k=a[n-1],r=k.X,k=k.Y,e+=d((l-r)*(l-r)+(h-k)*(h-k));b&&a.pop();return e/c};k.JS.PerimeterOfPaths=function(a,b,c){c||(c=1);for(var d=0,e=0;e<a.length;e++)d+=k.JS.PerimeterOfPath(a[e],b,c);return d};k.JS.ScaleDownPath=function(a,b){var c,d;b||(b=1);for(c=a.length;c--;)d=a[c],d.X/=b,d.Y/=b};k.JS.ScaleDownPaths=function(a,
b){var c,d,e;b||(b=1);for(c=a.length;c--;)for(d=a[c].length;d--;)e=a[c][d],e.X/=b,e.Y/=b};k.JS.ScaleUpPath=function(a,b){var c,d,e=Math.round;b||(b=1);for(c=a.length;c--;)d=a[c],d.X=e(d.X*b),d.Y=e(d.Y*b)};k.JS.ScaleUpPaths=function(a,b){var c,d,e,h=Math.round;b||(b=1);for(c=a.length;c--;)for(d=a[c].length;d--;)e=a[c][d],e.X=h(e.X*b),e.Y=h(e.Y*b)};k.ExPolygons=function(){return[]};k.ExPolygon=function(){this.holes=this.outer=null};k.JS.AddOuterPolyNodeToExPolygons=function(a,b){var c=new k.ExPolygon;
c.outer=a.Contour();var d=a.Childs(),e=d.length;c.holes=Array(e);var h,l,n,r,u;for(l=0;l<e;l++)for(h=d[l],c.holes[l]=h.Contour(),n=0,r=h.Childs(),u=r.length;n<u;n++)h=r[n],k.JS.AddOuterPolyNodeToExPolygons(h,b);b.push(c)};k.JS.ExPolygonsToPaths=function(a){var b,c,d,e,h=new k.Paths;b=0;for(d=a.length;b<d;b++)for(h.push(a[b].outer),c=0,e=a[b].holes.length;c<e;c++)h.push(a[b].holes[c]);return h};k.JS.PolyTreeToExPolygons=function(a){var b=new k.ExPolygons,c,d,e;c=0;d=a.Childs();for(e=d.length;c<e;c++)a=
d[c],k.JS.AddOuterPolyNodeToExPolygons(a,b);return b}})();
var createCindy=function(){function a(a){if(0===d)return console.error("Waiting for "+a+" after we finished waiting."),function(){};0>d&&(d=0);++d;return function(){--d;0>d&&console.error("Wait count mismatch: "+a);if(0===d)for(var b=0,e=c.length;b<e;)c[b++].startup()}}function b(a){var e=b.newInstance(a);0>=d?e.startup():!1!==a.autostart&&c.push(e);return e}var d=-1,c=[];"undefined"===typeof document||"undefined"===typeof window||"undefined"===typeof document.addEventListener||"undefined"!==typeof window.cindyDontWait&&
!0===window.cindyDontWait||document.addEventListener("DOMContentLoaded",a("DOMContentLoaded"));"undefined"!==typeof window&&"undefined"!==typeof window.__gwt_activeModules&&(Object.keys(window.__gwt_activeModules).forEach(function(b){b=window.__gwt_activeModules[b];b.cindyDoneWaiting=a(b.moduleName)}),window.__gwtStatsEvent=function(a){"moduleStartup"===a.evtGroup&&"end"===a.type&&window.__gwt_activeModules[a.moduleName].cindyDoneWaiting()});var l=null,e=null,h={};b.getBaseDir=function(){if(null!==
l)return l;for(var a=document.getElementsByTagName("script"),b=0;b<a.length;++b){var c=a[b],d=c.src;if(d){var h=/Cindy\.js$/.exec(d);if(h)return l=d.substr(0,h.index),console.log("Will load extensions from "+l),e=c,l}}console.error("Could not find <script> tag for Cindy.js");return l=e=!1};b.loadScript=function(a,c,d,l){if(window[a])return d(),!0;l||(l=console.error.bind(console));var w=b.getBaseDir();if(!1===w)return l("Can't load additional components."),!1;var y=h[a];y||(y=document.createElement("script"),
y.src=w+c,c=e.nextSibling,w=e.parentElement,c?w.insertBefore(y,c):w.appendChild(y),h[a]=y);y.addEventListener("load",d);y.addEventListener("error",l);return null};b.waitFor=a;b._pluginRegistry={};b.instances=[];b.registerPlugin=function(a,c,d){if(1!==a)return console.error("Plugin API version "+a+" not supported"),!1;b._pluginRegistry[c]=d};b.newInstance=function(a){var b,c,d,e,h,l;function C(f){if(f){for(var a=0;a<f.length;a++){var p=f[a],b=Object.keys(p)[0];"scale"===b&&(ib=p.scale,D[b](p.scale));
if("translate"===b)D[b](p.translate[0],p.translate[1]);"scaleAndOrigin"===b&&(ib=p[b][0]/25,D[b].apply(null,p[b]));"visibleRect"===b&&(D[b].apply(null,p[b]),ib=D.drawingstate.initialmatrix.a/25)}D.createnewbackup()}}function H(){tb=!0;if(0===jb){void 0!==a.csconsole&&(Da=a.csconsole);Da=null===Da?new ha:!0===Da?new Y:"string"===typeof Da?new ea(Da):"object"===typeof Da&&"function"===typeof Da.appendChild?new ea(Da):new ha;eb=[100,100];var f,ba=null,p=a.transform;a.ports&&0<a.ports.length&&(f=a.ports[0],
(ba=f.element)||(ba=document.getElementById(f.id)),"window"===f.fill?(ba.setAttribute("width",window.innerWidth),ba.setAttribute("height",window.innerHeight)):f.width&&f.height&&(ba.setAttribute("width",f.width),ba.setAttribute("height",f.height)),f.background&&(ba.style.backgroundColor=f.background),void 0!==f.transform&&(p=f.transform));ba||(ba=a.canvas)||"undefined"===typeof document||(ba=document.getElementById(a.canvasname));ba&&(L=ba.getContext("2d"),L.setLineDash||(L.setLineDash=function(){}));
f=fb(qc);f=Ea(f,!1);I(f);var V=a.scripts,ub=null;"string"===typeof V&&V.search(/\*/)&&(ub=V);"object"!==typeof V&&(V=null);"move keydown mousedown mouseup mousedrag init tick draw simulationstep cssimulationstart cssimulationstop".split(" ").forEach(function(f){var p;if(null!==V&&V[f])p=V[f];else{p=f+"script";if(a[p])p=document.getElementById(a[p]);else if(ub){if(p=document.getElementById(ub.replace(/\*/,f)),!p)return}else return;p=p.text}p=fb(p);Ba[f]=Ea(p,!1)});a.grid&&0!==a.grid&&(Ta=a.grid,Rb=
Ea("#drawgrid("+Ta+")",!1));a.snap&&(Sb=a.snap);ba&&(ya=ba.width,ua=ba.height,C(p),D.drawingstate.matrix.ty-=ua,D.drawingstate.initialmatrix.ty-=ua,p=1,"undefined"!==typeof window&&window.devicePixelRatio&&(p=window.devicePixelRatio),f=L.webkitBackingStorePixelRatio||L.mozBackingStorePixelRatio||L.msBackingStorePixelRatio||L.oBackingStorePixelRatio||L.backingStorePixelRatio||1,p!==f&&(p/=f,ba.width=ya*p,ba.height=ua*p,ba.style.width||(ba.style.width=ya+"px"),ba.style.height||(ba.style.height=ua+"px"),
L.scale(p,p)));l=h=e=d=c=b=void 0;p=0;xa={};a.geometry||(a.geometry=[]);rc(a.geometry);a.behavior||(a.behavior=[]);"function"===typeof vb&&vb(a.behavior);for(var g in a.images)p=a.images[g],xa[g]=new Image,xa[g].ready=!1,xa[g].onload=function(){xa[g].ready=!0;S()},xa[g].src=p;Ma.canvas=ba;if(a.oninit)a.oninit(Ma);if(a.exclusive)for(p=Oa.instances.length;0<p;)Oa.instances[--p].shutdown();Oa.instances.push(Ma);a.use&&a.use.forEach(function(f){z.use$1([F.wrap(f)],{})});I(Ba.init);a.autoplay&&k();ba&&
T(ba,a)}}function G(){null!==Xa&&(za.set(Xa.state),Object.keys(Xa.speeds).forEach(function(f){var a=c[f];"undefined"!==typeof a.behavior&&(f=Xa.speeds[f],a.behavior.vx=f[0],a.behavior.vy=f[1],a.behavior.vz=f[2],a.behavior.fx=0,a.behavior.fy=0,a.behavior.fz=0)}),sc())}function k(){if(!Ua){if(kb){var f=Xa?Xa.state:new Float64Array(za.length);f.set(za);for(var a={},p=0;p<d.length;p++){var b=d[p];"undefined"!==typeof b.behavior&&(a[b.name]=[b.behavior.vx,b.behavior.vy,b.behavior.vz])}Xa={state:f,speeds:a};
kb=!1}"function"===typeof vb&&wb&&tc(Fa);Ua=!0;Z()}}function M(){Ua&&(Ua=!1)}function K(){kb||(Ua=!1,kb=!0,G())}function R(){if(!xb){xb=!0;for(var f=Oa.instances.length;0<f;)if(Oa.instances[--f]===Ma){Oa.instances.splice(f,1);break}for(f=cb.length;0<f;)try{cb[--f]()}catch(a){console.error(a)}}}function O(f){this.in=function(f,a){console.log(f);a?this.append(this.createTextNode("span","blue",f)):this.append(this.createTextNode("p","blue",f))};this.out=function(f,a){console.log(f);a?this.append(this.createTextNode("span",
"red",f)):this.append(this.createTextNode("p","red",f))};this.err=function(f,a){console.log(f);a?this.append(this.createTextNode("span","red",f)):this.append(this.createTextNode("p","red",f))};this.createTextNode=function(f,a,b){return"undefined"!==typeof document?(f=document.createElement(f),f.appendChild(document.createTextNode(b)),f.style.color=a,f):b+"\n"}}function Y(){var f=this,a,p=document.createElement("div"),b;p.innerHTML='<div id="console" style="border-top: 1px solid #333333; bottom: 0px; position: absolute; width: 100%;"><div id="log" style="height: 150px; overflow-y: auto;"></div><input id="cmd" type="text" style="box-sizing: border-box; height: 30px; width: 100%;"></div>';
document.body.appendChild(p);a=document.getElementById("cmd");b=document.getElementById("log");a.onkeydown=function(p){13===p.keyCode&&""!==a.value&&(f.in(a.value),p=z.parse$1([F.wrap(a.value)],[]),p=I(p),console.log(ia(p)),"undefined"!==p.ctype&&Da.out(ia(p)),a.value="",b.scrollTop=b.scrollHeight)};this.append=function(f){b.appendChild(f)};this.clear=function(){b.innerHTML=""}}function ea(f){var a=f;"string"===typeof f&&(a=document.getElementById(f));this.append=function(f){a.appendChild(f)};this.clear=
function(){a.innerHTML=""}}function ha(){this.append=function(f){};this.clear=function(){}}function A(f){for(var a=null,p=1E6,b,d=0;d<l.length;d++){var e=l[d];if(!e.pinned&&!1!==e.visible){var g,h,k,n=D.drawingstate.matrix.sdet;if("P"===e.kind){var r=m.normalizeZ(e.homog);if(!m._helper.isAlmostReal(r))continue;g=r.value[0].value.real-f.x;h=r.value[1].value.real-f.y;k=Math.sqrt(g*g+h*h);e.narrow&k>20/n&&(k=1E4)}else"C"===e.kind?(h=c[e.args[0]],k=e.radius,g=q.div(h.homog.value[0],h.homog.value[2]).value.real,
h=q.div(h.homog.value[1],h.homog.value[2]).value.real,g-=f.x,h-=f.y,k=Math.sqrt(g*g+h*h)-k.value.real,h=g=0,0>k&&(k=-k),k+=30/n):"L"===e.kind&&(g=e.homog,k=q,h=k.add(k.mult(g.value[0],k.conjugate(g.value[0])),k.mult(g.value[1],k.conjugate(g.value[1]))),h=m.scaldiv(k.sqrt(h),g),k=h.value[0].value.real*f.x+h.value[1].value.real*f.y+h.value[2].value.real,g=h.value[0].value.real*k,h=h.value[1].value.real*k,0>k&&(k=-k),k+=1);k<p+.2/n&&(p=k,a=e,b={x:g,y:h})}}console.log("Moving "+(a?a.name:"nothing"));
return null===a?null:{mover:a,offset:b,prev:{x:f.x,y:f.y}}}function P(f,a,p,b){void 0===b&&(b=!1);cb.push(function(){f.removeEventListener(a,p,b)});f.addEventListener(a,p,b)}function T(f,a){function p(a){var p=f.getBoundingClientRect();a=D.to(a.clientX-p.left-f.clientLeft,a.clientY-p.top-f.clientTop);pa.prevx=pa.x;pa.prevy=pa.y;pa.x=a[0];pa.y=a[1];eb[0]=pa.x;eb[1]=pa.y}function b(f){pa.down=!1;wa=void 0;Va();S();I(Ba.mouseup);f.preventDefault()}var c=null;"undefined"!==typeof MutationObserver&&(c=
MutationObserver);c||"undefined"===typeof WebKitMutationObserver||(c=WebKitMutationObserver);c?(c=new c(function(a){document.body.contains(f)||R()}),c.observe(document.documentElement,{childList:!0,subtree:!0}),cb.push(function(){c.disconnect()})):(P(f,"DOMNodeRemovedFromDocument",R),P(f,"DOMNodeRemoved",R));!0===a.keylistener?P(document,"keydown",function(f){sa(f);return!1}):Ba.keydown&&(f.setAttribute("tabindex","0"),P(f,"mousedown",function(){f.focus()}),P(f,"keydown",function(f){9!==f.keyCode&&
(sa(f),f.preventDefault())}));P(f,"mousedown",function(f){pa.button=f.which;p(f);I(Ba.mousedown);wa=A(pa);Z();pa.down=!0;f.preventDefault()});P(f,"mouseup",function(f){pa.down=!1;wa=void 0;Va();I(Ba.mouseup);S();f.preventDefault()});P(f,"mousemove",function(f){p(f);pa.down?I(Ba.mousedrag):I(Ba.mousemove);f.preventDefault()});P(f,"touchstart",function(f){p(f.targetTouches[0]);I(Ba.mousedown);pa.down=!0;wa=A(pa);Z();f.preventDefault()},!1);P(f,"touchmove",function(f){p(f.targetTouches[0]);pa.down?I(Ba.mousedrag):
I(Ba.mousemove);f.preventDefault()},!0);P(f,"touchend",b,!1);"undefined"!==typeof document&&document.body&&P(document.body,"touchcancel",b,!1);S()}function W(){if(xb)return!0;Ua&&(wb&&"undefined"!==typeof Ca&&Ca.tick(),Ua&&I(Ba.tick));S();lb=Ua||pa.down;return!lb}function Z(){lb||(lb=!0,zb.timer(W))}function S(){D.reset();L.save();L.clearRect(0,0,ya,ua);0!==Ta&&I(Rb);uc();D.greset();vc();L.restore()}function sa(f){f=window.event?event:f;f=f.charCode?f.charCode:f.keyCode;Tb=String.fromCharCode(f);
Ub=f;I(Ba.keydown);S()}function g(f,a){if(a in f)return a;a=a.charAt(0).toUpperCase()+a.substring(1);for(var p=0,b=Vb.length;p<b;++p){var c=Vb[p]+a;if(c in f)return c}}function t(){var f=U(),f=oa()-f;24<f?(isFinite(f)&&(clearTimeout(mb),mb=setTimeout(t,f)),nb=0):(nb=1,Wb(t))}function U(){var f=Date.now();for(Wa=ob;Wa;)f>=Wa.t&&(Wa.f=Wa.c(f-Wa.t)),Wa=Wa.n;return f}function oa(){for(var f,a=ob,p=Infinity;a;)a.f?a=f?f.n=a.n:ob=a.n:(a.t<p&&(p=a.t),a=(f=a).n);pb=f;return p}function na(){this.ctype="undefined"}
function ja(){this.ctype="void"}function aa(f){this.ctype="error";this.message=f}function ia(f){if("undefined"===typeof f)return"_??_";if("undefined"===f.ctype)return"_?_";if("number"===f.ctype)return q.niceprint(f);if("string"===f.ctype||"boolean"===f.ctype)return f.value;if("list"===f.ctype){for(var a="[",p=0;p<f.value.length;p++)a+=ia(I(f.value[p])),p!==f.value.length-1&&(a+=", ");return a+"]"}return"function"===f.ctype?"FUNCTION":"infix"===f.ctype?"INFIX":"modifier"===f.ctype?f.key+"->"+ia(f.value):
"shape"===f.ctype?f.type:"error"===f.ctype?"Error: "+f.message:"variable"===f.ctype?(console.log("HALLO"),ia(f.stack[length.stack])):"geo"===f.ctype?f.value.name:"__"}function ma(f,a,p){f=ma[f];if(void 0===f)return x;var b=[];for(p=0;p<f.arglist.length;p++)b[p]=I(a[p]);for(p=0;p<f.arglist.length;p++)da.newvar(f.arglist[p].name),da.setvar(f.arglist[p].name,b[p]);da.pushVstack("*");a=I(f.body);da.cleanVstack();for(p=0;p<f.arglist.length;p++)da.removevar(f.arglist[p].name);return a}function ka(f,a){var p=
"undefined"===f[0].ctype,b="undefined"===f[1].ctype,c=I(f[1]);if(p||b)return x;"variable"===f[0].ctype?da.setvar(f[0].name,c):"infix"===f[0].ctype?"_"===f[0].oper?Q.assigntake(f[0],c):console.error("Can't use infix expression as lvalue"):"field"===f[0].ctype?Q.assigndot(f[0],c):"function"===f[0].ctype&&"genList"===f[0].oper?"list"===c.ctype?Q.assignlist(f[0].args,c.value):console.error("Expected list in rhs of assignment"):console.error("Left hand side of assignment is not a recognized lvalue");return c}
function ta(f,a){var p=N(f[0]),b=N(f[1]);return"number"===p.ctype&&"number"===b.ctype?{ctype:"boolean",value:p.value.real===b.value.real&&p.value.imag===b.value.imag}:"string"===p.ctype&&"string"===b.ctype||"boolean"===p.ctype&&"boolean"===b.ctype?{ctype:"boolean",value:p.value===b.value}:"list"===p.ctype&&"list"===b.ctype?m.equals(p,b):{ctype:"boolean",value:!1}}function Na(f,a){var p=N(f[0]),b=N(f[1]);return"number"===p.ctype&&"number"===b.ctype?{ctype:"boolean",value:q._helper.isAlmostEqual(p,
b)}:"string"===p.ctype&&"string"===b.ctype||"boolean"===p.ctype&&"boolean"===b.ctype?{ctype:"boolean",value:p.value===b.value}:"list"===p.ctype&&"list"===b.ctype?m.almostequals(p,b):{ctype:"boolean",value:!1}}function Sa(f,a){var p=N(f[0]),b=N(f[1]);return"boolean"===p.ctype&&"boolean"===b.ctype?{ctype:"boolean",value:p.value&&b.value}:x}function ab(f,a){var p=N(f[0]),b=N(f[1]);return"boolean"===p.ctype&&"boolean"===b.ctype?{ctype:"boolean",value:p.value||b.value}:x}function Ha(f,a){var p=N(f[0]),
b=N(f[1]);return F.add(p,b)}function bb(f,a){var p=N(f[0]),b=N(f[1]);return F.sub(p,b)}function Ob(f,a){var p=N(f[0]),b=N(f[1]);return F.mult(p,b)}function Pb(f,a){var p=N(f[0]),b=N(f[1]);return F.div(p,b)}function Qb(f,a){var p=N(f[0]),b=N(f[1]);return"number"===p.ctype&&"number"===b.ctype?q.pow(p,b):x}function sb(f){var a=f.length;if(0===a)return[];if(1===a)return[0];if(2===a)return f[0][0]+f[1][1]<=f[0][1]+f[1][0]?[0,1]:[1,0];if(4<a)return wc(f);for(var p=xc[a],b=Number.POSITIVE_INFINITY,c=p[0],
d=0;d<p.length;++d){for(var e=p[d],g=0,h=0;h<a;++h)g+=f[h][e[h]];g<b&&(b=g,c=e)}return c}function wc(f){function a(){return{matched:-1,prev:-1,start:-1,cost:0,used:!1,leaf:!1}}function p(f){for(var a=0;a<d;++a)0<k[f][a]||m[a].used||(m[a].used=!0,p(m[a].matched))}function b(f){for(var a=0;a<d;++a)0<k[a][f]||h[a].used||(h[a].used=!0,b(h[a].matched))}var c=Math.abs,d=f.length,e,g,h=Array(d),m=Array(d),k=Array(d);for(e=0;e<d;++e)k[e]=Array(d);for(e=0;e<d;++e)for(h[e]=a(),m[e]=a(),h[e].cost=f[e][0],g=
1;g<d;++g)h[e].cost>f[e][g]&&(h[e].cost=f[e][g]);for(;;){for(e=0;e<d;++e)for(g=0;g<d;++g)k[e][g]=f[e][g]-h[e].cost-m[g].cost,k[e][g]<1E-14*(c(f[e][g])+c(h[e].cost)+c(m[g].cost))&&(k[e][g]=0);for(e=0;e<d;++e)h[e].matched=m[e].matched=-1;for(var l=0;;){for(e=0;e<d;++e)h[e].used=h[e].leaf=m[e].used=m[e].leaf=!1,-1===h[e].matched&&(h[e].start=e,h[e].used=h[e].leaf=!0,h[e].prev=-1);for(var q=!1,n=!1;!n;){for(e=0;e<d;++e)if(h[e].leaf)for(h[e].leaf=!1,g=0;g<d;++g)if(!(m[g].used||0<k[e][g])&&h[e].matched!==
g&&(m[g].prev=e,m[g].start=h[e].start,m[g].used=m[g].leaf=!0,-1===m[g].matched)){h[m[g].start].prev=g;q=!0;break}if(q)break;n=!0;for(g=0;g<d;++g)m[g].leaf&&(m[g].leaf=!1,e=m[g].matched,h[e].used||(h[e].prev=g,h[e].start=m[g].start,h[e].used=h[e].leaf=!0,n=!1))}if(!q)break;for(q=0;q<d;++q)if(-1===h[q].matched&&-1!==h[q].prev){g=h[q].prev;do e=m[g].prev,m[g].matched=e,h[e].matched=g,g=h[e].prev;while(e!==q);++l}}if(l===d)break;for(e=0;e<d;++e)h[e].used=h[e].leaf=m[e].used=m[e].leaf=!1;for(e=0;e<d;++e)-1===
h[e].matched&&p(e);for(g=0;g<d;++g)-1===m[g].matched&&b(g);for(e=0;e<d;++e)-1===h[e].matched||h[e].used||m[h[e].matched].used||(h[e].used=!0);l=Number.POSITIVE_INFINITY;for(e=0;e<d;++e)if(!h[e].used)for(g=0;g<d;++g)m[g].used||l>k[e][g]&&(l=k[e][g]);for(e=0;e<d;++e)h[e].used||(h[e].cost+=l),m[e].used&&(m[e].cost-=l)}f=Array(d);for(e=0;e<d;++e)g=h[e].matched,f[e]=g;return f}function Xb(f,a){var p=I(f[0]),b=N(f[1]);if("number"===b.ctype){var c=Math.floor(b.value.real);if("list"===p.ctype||"string"===
p.ctype)return 0>c&&(c=p.value.length+c+1),0<c&&c<p.value.length+1?"list"===p.ctype?p.value[c-1]:{ctype:"string",value:p.value.charAt(c-1)}:x}if("list"===b.ctype){for(var c=[],d=0;d<b.value.length;d++){var e=N(b.value[d]);c[d]=Xb([p,e],[])}return m.turnIntoCSList(c)}return x}function Yb(f,a){var p=I(f[0]),b=I(f[1]);return"list"===p.ctype&&"list"===b.ctype?m.concat(p,b):"shape"===p.ctype&&"shape"===b.ctype?Q.shapeconcat(p,b):x}function Zb(f,a){var p=I(f[0]),b=I(f[1]);return"list"===p.ctype&&"list"===
b.ctype?m.set(m.common(p,b)):"shape"===p.ctype&&"shape"===b.ctype?Q.shapecommon(p,b):x}function $b(f,a){var p=I(f[0]),b=I(f[1]);return"list"===p.ctype&&"list"===b.ctype?m.remove(p,b):"shape"===p.ctype&&"shape"===b.ctype?Q.shaperemove(p,b):x}function ac(f,a){var p=I(f[0]),b=I(f[1]);return"list"===p.ctype?m.append(p,b):x}function bc(f,a){var p=I(f[0]),b=I(f[1]);return"list"===b.ctype?m.prepend(p,b):x}function Ab(f,a){f|=0;a|=0;if(0===f&&0===a)return 0;for(;0!==a;){var p=f;f=a;a=p%a|0}return f}function yc(f){return 1===
f?0:1}function I(f){if("undefined"===typeof f)return x;if("infix"===f.ctype)return f.impl(f.args,{});if("variable"===f.ctype)return da.getvar(f.name);if("void"===f.ctype||"geo"===f.ctype||"number"===f.ctype||"boolean"===f.ctype||"string"===f.ctype||"list"===f.ctype||"undefined"===f.ctype||"shape"===f.ctype)return f;if("field"===f.ctype){var a=I(f.obj);return"geo"===a.ctype?Ia.getField(a.value,f.key):"list"===a.ctype?m.getField(a,f.key):x}return"function"===f.ctype?Q.evaluate(f.oper,f.args,f.modifs):
x}function N(f){f=I(f);if("geo"===f.ctype){var a=f.value;if("P"===a.kind)return Ia.getField(a,"xy")}return f}function fa(f){f=I(f);if("geo"===f.ctype){var a=f.value;if("P"===a.kind||"L"===a.kind)return Ia.getField(a,"homog")}return m._helper.isNumberVecN(f,3)?f:m._helper.isNumberVecN(f,2)?(a=m.turnIntoCSList([f.value[0],f.value[1],q.real(1)]),f.usage&&(a=F.withUsage(a,f.usage)),a):x}function fb(f){for(var a=!1,p=!1,b="",c=0;c<f.length;c++){var d=f[c];'"'!==d||p||(a=!a);"/"===d&&c!==f.length-1&&"/"===
f[c+1]&&(p=!0);"\n"===d&&(p=!1);if(" "!==d&&"\t"!==d&&"\n"!==d&&"\f"!==d&&"\r"!==d&&!p||a)b+=d}return b}function cc(f,a,p){var b={ctype:"infix"};b.oper=f;b.impl=la[f];b.args=[a,p];return b}function zc(f){var a,p;if("function"!==f.ctype)return console.log("Invalid function name."),!1;for(a=0;a<f.args.length;a++)if("variable"!==f.args[a].ctype)return console.log("Argument is not a variable."),!1;for(a=0;a<f.args.length-1;a++)for(p=a+1;p<f.args.length;p++)if(f.args[a].name===f.args[p].name)return console.log("Variable name used twice."),
!1;return!0}function qb(f){return""!==f&&!isNaN(f)}function Bb(f){return"["===f||"("===f||"{"===f||"|"===f}function Cb(f){return"]"===f||")"===f||"}"===f||"|"===f}function Db(f){var a,p=[],b=[],c=[];a=f+",";var d=a.length,e=0,g=0,h=!1,m=!1;for(f=g;f<d;f++){var k;k=a[f];'"'===k&&(m=!m);!m&&(!Bb(k)||"|"===k&&h?Cb(k)&&("|"!==k||h)&&(e--,"|"===k&&(h=!1)):(e++,"|"===k&&(h=!0)),","===k&&0===e||-1===e)&&(k=a.substring(g,f),p.push(k),b.push(g),g=f+1)}for(f=0;f<p.length;f++)if(b=p[f],""===b)c.push("nil");
else{b=Ea(b,!1);if("error"===b.ctype)return b;c.push(b)}p={ctype:"function",oper:"genList"};p.args=c;p.modifs={};return p}function Ac(f){var a;return"|"===f[0]?(f=Db(f.substring(1,f.length-1)),a=f.args.length,1===a?(f.oper="abs_infix",f):2===a?(f.oper="dist_infix",f):x):"()"===f||"[]"===f?a={ctype:"list",value:[]}:"["===f[0]?Db(f.substring(1,f.length-1)):"("===f[0]&&(a=Db(f.substring(1,f.length-1)),1<a.args.length)?a:a=Ea(f.substring(1,f.length-1),!1)}function Ea(f,a){for(var p=!1,b="",c=-1,d=-1,
e="",g=0,h=0,m=" ",k=" ",l=0,q=!1,n=f.length,r=0;r<n;r++){var t,u=" ",v=" ";0<l&&l--;t=f[r];r+1<n&&(u=f[r+1]);r+2<n&&(v=f[r+2]);'"'===t&&(p=!p);if(!p){if(Bb(t)&&("|"!==t||!q))"|"===t&&(q=!0),b+=t,g++,1===g&&h++," "===m&&(m=t);else if(Cb(t)&&("|"!==t||q)){"|"===t&&(q=!1);if(0===g)return new aa("close without open");k=b[b.length-1]+t;if("[]"===k||"()"===k||"{}"===k||"||"===k)g--,b=b.substring(0,b.length-1),k=t;else return new aa("unmatched brackets")}if(0===b.length){var w=-1,y="";"undefined"!==typeof rb[t+
u+v]&&0===l?(y=t+u+v,l=3):"undefined"!==typeof rb[t+u]&&0===l?(y=""+t+u,l=2):"undefined"!==typeof rb[t]&&0===l&&(y=""+t,l=1);""!==y&&(w=rb[y]);w>=d&&(d=w,c=r,e=y,0<=w&&(r+=y.length-1))}}}if(0!==g)return new aa("open without close");p=f.indexOf(m);b=f.lastIndexOf(k);if(0===g&&-1<d){if("->"===e)return d=e,e=f.substring(0,c),c=Ea(f.substring(c+d.length),!1),e="error"===c.ctype?c:{ctype:"modifier",key:e,value:c},e;if("."===e)return d=f.indexOf("."),g=f.lastIndexOf("."),(d!==g?0:-1===d?qb(f):qb(f.substring(0,
d))||qb(f.substring(d+1)))?(e={},e.value={real:parseFloat(f),imag:0},e.ctype="number"):(d=Ea(f.substring(0,c),!1),e=f.substring(c+e.length),e={ctype:"field",obj:d,key:e}),e;if(":="===e)return d=f.substring(0,c),d=Ea(d,!0),"error"===d.ctype?e=d:"variable"===d.cstring||zc(d)?(c=f.substring(c+e.length),c=Ea(c,!1),e="error"===c.ctype?c:cc(e,d,c)):(console.log(["Function not definable",d]),e=new aa("Function not definable")),e;d=Ea(f.substring(0,c),!1);c=Ea(f.substring(c+e.length),!1);e="error"===d.ctype?
d:"error"===c.ctype?c:cc(e,d,c);return e}if(0===g&&1===h&&b===f.length-1){if(0===p)return Ac(f);a:{g=[];h=[];e=[];c={};d=f.substring(0,p);b=f.length;m=0;k=p+1;q=l=!1;for(p=k;p<b;p++)if(n=f[p],'"'===n&&(l=!l),!l)if(!Bb(n)||"|"===n&&q?Cb(n)&&("|"!==n||q)&&(m--,"|"===n&&(q=!1)):(m++,"|"===n&&(q=!0)),","===n&&0===m||-1===m)n=f.substring(k,p),g.push(n),h.push(k),1!==g.length||-1!==m||g[0].length||(g=[],h=[]),k=p+1;for(p=0;p<g.length;p++){h=Ea(g[p],!1);if("error"===h.ctype){e=h;break a}"modifier"===h.ctype?
c[h.key]=h.value:e.push(h)}g={ctype:"function"};g.oper=d+"$"+e.length;g.args=e;g.modifs=c;e=g}return e}return""===f?new ja:'"'===f.charAt(0)&&'"'===f.charAt(f.length-1)?{ctype:"string",value:f.substring(1,f.length-1)}:qb(f)?{ctype:"number",value:{real:parseInt(f),imag:0}}:da.isVariable(f)?da.vars[f]:da.isVariableName(f)?da.create(f):x}function Bc(f){for(var a in f)null!==f[a]&&(Ja[a]=f[a])}function rc(f){Object.keys(B).forEach(function(f){f=B[f];void 0!==f.updatePosition&&void 0===f.stateSize&&(f.stateSize=
0)});b=f;c={};var a,p,V,g,m=0;d=[];e=[];h=[];l=[];var k=0,q=0,r=0,t=0,yb={};for(a=0;a<f.length;a++)if(V=f[a],p=Cc[V.type])V=p(V).slice(),V.splice(0,0,a,1),f.splice.apply(f,V),--a;else if(c[V.name]=V,g=B[V.type]){if(V.args){for(p=0;p<V.args.length&&!yb.hasOwnProperty(V.args[p]);++p);if(p<V.args.length){console.log("Dropping "+V.name+" due to dropped argument "+V.args[p]);yb[V.name]=!0;f.splice(a,1);a--;continue}}V.kind=g.kind;V.stateIdx=m;m+=g.stateSize;V.incidences=[];V.isshowing=!0;V.movable=!1;
g.isMovable&&(V.movable=!0,l[q++]=V);"P"===V.kind&&(d[k]=V,Dc(V),k+=1);"L"===V.kind&&(e[r]=V,Eb(V),r+=1);"C"===V.kind&&(h[t]=V,Eb(V),t+=1);"S"===V.kind&&(e[r]=V,Ec(V),r+=1)}else console.error(V),console.error("Operation "+V.type+" not implemented yet"),yb[V.name]=!0,f.splice(a,1),a--;Pa=za=La=new Float64Array(m);for(a=0;a<f.length;a++)V=f[a],g=B[V.type],Ya=!0,g.initialize&&(Aa=Ga=V.stateIdx,V.param=g.initialize(V),Za(Ga===V.stateIdx+g.stateSize,"State fully initialized")),Aa=Ga=V.stateIdx,g.updatePosition(V,
!1),Za(Aa===V.stateIdx+g.stateSize,"State fully consumed"),Za(Ga===V.stateIdx+g.stateSize,"State fully updated"),Fb(V,g);Pa=new Float64Array(m);La=new Float64Array(m);Va();Ya=!1;Fc()}function Dc(f){void 0===f.size&&(f.size=Ja.pointSize);f.size=q.real(f.size);"Free"!==f.type?(f.color=m.realVector(f.color||Ja.pointColor),f.color=m.scalmult(q.real(Ja.dimDependent),f.color)):f.color=m.realVector(f.color||Ja.pointColor);void 0===f.alpha&&(f.alpha=Ja.alpha);f.alpha=q.real(f.alpha)}function Eb(f){void 0===
f.size&&(f.size=Ja.lineSize);f.size=q.real(f.size);f.color=m.realVector(f.color||Ja.lineColor);void 0===f.alpha&&(f.alpha=Ja.alpha);f.alpha=q.real(f.alpha);f.clip=F.string(f.clip||Ja.clip);void 0===f.overhang&&(f.overhang=Ja.overhangLine);f.overhang=q.real(f.overhang)}function Ec(f){Eb(f);f.clip=F.string("end");void 0===f.overhang&&(f.overhang=Ja.overhangSeg);f.overhang=q.real(f.overhang)}function dc(f,a){var p=c[a.args[0]].homog,b=c[a.args[1]].homog,d=f.homog,e=q.div(p.value[0],p.value[2]),g=q.div(p.value[1],
p.value[2]),p=q.div(b.value[0],b.value[2]),b=q.div(b.value[1],b.value[2]),h=q.div(d.value[0],d.value[2]),m=q.div(d.value[1],d.value[2]);return q._helper.isAlmostReal(e)&&q._helper.isAlmostReal(g)&&q._helper.isAlmostReal(p)&&q._helper.isAlmostReal(b)&&q._helper.isAlmostReal(h)&&q._helper.isAlmostReal(m)?(e=e.value.real,g=g.value.real,p=p.value.real,b=b.value.real,h=h.value.real,m=m.value.real,d=Math.sqrt((e-p)*(e-p)+(g-b)*(g-b)),e=Math.sqrt((e-h)*(e-h)+(g-m)*(g-m)),p=Math.sqrt((p-h)*(p-h)+(b-m)*(b-
m)),e=d-e-p,1E-15>e*e):!1}function Fb(f,a){f.isshowing=!0;if(f.args)for(var p=0;p<f.args.length;p++)if(!c[f.args[p]].isshowing){f.isshowing=!1;return}a.visiblecheck&&a.visiblecheck(f)}function Fc(){for(var f=0;f<e.length;f++)for(var a=e[f],p=0;p<d.length;p++){var b=d[p],c=m.scaldiv(m.abs(b.homog),b.homog),g=m.scaldiv(m.abs(a.homog),a.homog);1E-13>q.abs(m.scalproduct(c,g)).value.real&&(b.incidences.push(a.name),a.incidences.push(b.name))}}function vc(){function f(f){if(f.isshowing&&!1!==f.visible&&
m._helper.isAlmostReal(f.homog)){var a=f.color;f.behavior&&(a=f.color);z.draw$1([f.homog],{size:f.size,color:a,alpha:f.alpha});if(f.labeled){var a=f.printname||f.name||"P",p=f.labelpos||{x:3,y:3},b=f.textsize||12,c=!0===f.textbold,ba=!0===f.textitalics,V=f.text_fontfamily||"Sans Serif",d=p.x*p.x+p.y*p.y,e=1;0<d&&(e=1+f.size.value.real/Math.sqrt(d));z.drawtext$2([f.homog,F.wrap(a)],{x_offset:F.wrap(e*p.x),y_offset:F.wrap(e*p.y),size:F.wrap(b),bold:F.wrap(c),italics:F.wrap(ba),family:F.wrap(V)})}}}
function a(f){if(f.isshowing&&!1!==f.visible){var p={};p.color=f.color;p.alpha=f.alpha;p.size=f.size;Q.drawconic(f,p)}}function p(f){var a,p;if(f.isshowing&&!1!==f.visible&&m._helper.isAlmostReal(f.homog))if("none"===f.clip.value)z.draw$1([f.homog],{size:f.size,color:f.color,alpha:f.alpha});else if("end"===f.clip.value)z.draw$2([f.startpos,f.endpos],{size:f.size,color:f.color,alpha:f.alpha});else if("inci"===f.clip.value){a=[1E6,0];p=[-1E6,0];for(var b=[1E6,0],ba=[-1E6,0],V=0;V<f.incidences.length;V++){var d=
c[f.incidences[V]].homog,e=d.value[0],g=d.value[1],h=d.value[2];q._helper.isAlmostZero(h)||(e=q.div(e,h),g=q.div(g,h),q._helper.isAlmostReal(e)&&q._helper.isAlmostReal(g)&&(e.value.real<a[0]&&(a=[e.value.real,d]),e.value.real>p[0]&&(p=[e.value.real,d]),g.value.real<b[0]&&(b=[g.value.real,d]),g.value.real>ba[0]&&(ba=[g.value.real,d])))}p[0]-a[0]>ba[0]-b[0]?(a=a[1],p=p[1]):(a=b[1],p=ba[1]);a!==p?z.draw$2([a,p],{size:f.size,color:f.color,alpha:f.alpha,overhang:f.overhang}):z.draw$1([f.homog],{size:f.size,
color:f.color,alpha:f.alpha})}else console.error(["Bad clip: ",f.clip])}var b;for(b=0;b<h.length;b++)a(h[b]);for(b=0;b<e.length;b++)p(e[b]);for(b=0;b<d.length;b++)f(d[b])}function Za(f,a){var p="Assertion failed: "+a;if(!f)throw console.log(p),R(),"undefined"!==typeof alert&&alert(p),Error(p);}function Va(){Pa.set(za);ec(!1);for(var f=Pa.length,a=Math.abs,p=0;p<f;p+=2)a(Pa[p])>1E12*a(Pa[p+1])&&(Pa[p+1]=0)}function Gb(){if(db)Ka=!0;else throw fc;}function gc(f,a,p,b,c){return F.add(b,F.mult(p,F.sub(c,
b)))}function uc(){X&&(X.currentMouseAndScripts=[]);Hb=!0;Ka=!1;za.set(Pa);if(wa){var f=wa.mover,a=m.realVector([pa.x+wa.offset.x,pa.y+wa.offset.y,1]);Ib(f,a,"mouse");wa.prev.x=pa.x;wa.prev.y=pa.y}I(Ba.move);I(Ba.draw);Ka||Va();Hb=!1;X&&(X.fullLog.push(m.turnIntoCSList([m.turnIntoCSList(X.currentMouseAndScripts)])),X.length>X.logLength&&X.splice(0,X.length-X.logLength),X.currentMouseAndScripts=null,X.postMouseHooks.forEach(function(f){f()}))}function Jb(f,a,p){Hb?Ib(f,a,p):(Va(),Ka=!1,Ib(f,a,p),Va())}
function Ib(f,a,p){X&&X.currentMouseAndScripts&&(X.currentMover=[]);La.set(za);var c=1E4,d;d=hc[f.name];if(!d){var e={},g=0;d=[];e[f.name]=f;for(var h=b,k=0;k<h.length;++k){var l=h[k],r=l.args;if(r)for(var t=0;t<r.length;++t)e.hasOwnProperty(r[t])&&(e[l.name]=l,d[g++]=l)}hc[f.name]=d}var e=-1,g=.9,u,v,w,h=B[f.type],k=h.parameterPath||gc;Aa=f.stateIdx;l=h.getParamFromState(f);Aa=Ga=f.stateIdx;r=h.getParamForInput(f,a,p);for(t=e+g;e!==t;){var x=t*t,y=.5/(1+x),y=q.complex(2*t*y+.5,(1-x)*y);db=e+.5*g<=
e||0===c;0===c&&console.log("tracing limit Reached");x=!1;X&&X.currentMouseAndScripts&&(X.currentStep=[]);try{Aa=Ga=f.stateIdx;var z=k(f,t,y,l,r);X&&(X.currentParam=z);y=La;La=za;h.putParamToState(v,z);La=y;Ga=f.stateIdx;X&&(X.currentElement=f);h.updatePosition(f,!0);Za(Aa===f.stateIdx+h.stateSize,"State fully consumed");Za(Ga===f.stateIdx+h.stateSize,"State fully updated");for(u=0;u<d.length;++u)v=d[u],w=B[v.type],Aa=Ga=v.stateIdx,X&&(X.currentElement=v),w.updatePosition(v,!1),Za(Aa===v.stateIdx+
w.stateSize,"State fully consumed"),Za(Ga===v.stateIdx+w.stateSize,"State fully updated");X&&(X.currentElement=null);e=t;g*=1.25;t+=g;1<=t&&(t=1);La=za;za=y}catch(A){if(A!==fc)throw A;g*=.5;t=e+g;--c;x=!0}X&&X.currentMouseAndScripts&&(X.currentMover.push(m.turnIntoCSList([m.turnIntoCSList(X.currentStep),F.wrap(x),F.wrap(e),F.wrap(t),F.wrap(X.currentParam)])),X.currentStep=null,X.currentParam=null)}ec(Ka);for(u=0;u<d.length;++u)v=d[u],w=B[v.type],Fb(v,w);X&&X.currentMouseAndScripts&&(X.currentMouseAndScripts.push(m.turnIntoCSList([m.turnIntoCSList(X.currentMover),
F.wrap(Ka),F.wrap(f.name),a,F.wrap(p),l,r])),X.currentMover=null)}function sc(){Va();db=!0;for(var f=b,a=0;a<f.length;a++){var p=f[a],c=B[p.type];Aa=Ga=p.stateIdx;c.updatePosition(p,!1);Fb(p,c)}f=La;La=za;za=f;Va()}function ec(f){var b=a.tracingStateReport;"string"===typeof b&&(document.getElementById(b).textContent=f?"BAD":"GOOD")}function Gc(){return m.turnIntoCSList(X.fullLog.slice())}function Hc(f){var a=JSON.stringify(X.fullLog);f=new Blob([a],{type:f?"application/octet-stream":"application/json"});
return window.URL.createObjectURL(f)}function gb(){var f=Aa;Aa+=2;return q.complex(za[f],za[f+1])}function va(f){for(var a=Array(f),p=0;p<f;++p)a[p]=gb();return m.turnIntoCSList(a)}function $a(f){La[Ga]=f.value.real;La[Ga+1]=f.value.imag;Ga+=2}function qa(f){for(var a=0,p=f.value.length;a<p;++a)$a(f.value[a])}function Qa(f,a){var p=va(3),b=va(3),p=ic(f,a,p,b);qa(p[0]);qa(p[1]);return m.turnIntoCSList(p)}function ic(f,a,p,b){if(Ya)return[f,a];var c=m.projectiveDistMinScal(p,f),d=m.projectiveDistMinScal(p,
a),e=m.projectiveDistMinScal(b,f),g=m.projectiveDistMinScal(b,a),h=m.projectiveDistMinScal(p,b),k=m.projectiveDistMinScal(f,a),l=c+g,q=d+e,n;l>q?(n=[a,f],l=q):n=[f,a];q=function(){};if(X&&X.currentStep){var r=[X.labelTracing2,F.wrap(X.currentElement.name),m.turnIntoCSList(n),m.turnIntoCSList([p,b]),m.realMatrix([[c,d],[e,g]]),F.wrap(l),F.wrap(h),F.wrap(k),x];X.currentStep.push(m.turnIntoCSList(r));q=function(f){X.hasOwnProperty(f)||(X[f]=F.wrap(f));r[r.length-1]=X[f]}}m._helper.isNaN(f)||m._helper.isNaN(a)?
(q("Tracing failed due to NaNs."),Ka=!0):h>3*l&&k>3*l?q("Normal case, everything all right."):1E-5>k?1E-5>h?q("Staying inside singularity."):(q("Moved into singularity."),Ka=!0):1E-5>h?q("Moved out of singularity."):(db?q("Reached refinement limit, giving up."):q("Need to refine."),Gb());return n}function Kb(f,a,p,b){var c=va(3),d=va(3),e=va(3),g=va(3);f=Ic(f,a,p,b,c,d,e,g);qa(f[0]);qa(f[1]);qa(f[2]);qa(f[3]);return m.turnIntoCSList(f)}function Ic(f,a,p,b,c,d,e,g){var h=function(){};c=[c,d,e,g];f=
[f,a,p,b];if(Ya)return f;d=0;b=Array(4);for(p=0;4>p;p++)for(b[p]=Array(4),g=0;4>g;g++)e=m.projectiveDistMinScal(c[p],f[g]),b[p][g]=e;e=sb(b);a=Array(4);for(p=0;4>p;++p)a[p]=f[e[p]],d+=b[p][e[p]];var k=1*d,l=Infinity,q=Infinity;for(p=0;4>p;p++){if(m._helper.isNaN(f[p]))return h("Tracing failed due to NaNs."),Ka=!0,a;for(g=p+1;4>g;g++)e=m.projectiveDistMinScal(c[p],c[g]),l>e&&(l=e),e=m.projectiveDistMinScal(a[p],a[g]),q>e&&(q=e)}if(X&&X.currentStep){var n=[X.labelTracing4,F.wrap(X.currentElement.name),
m.turnIntoCSList(a),m.turnIntoCSList(c),m.realMatrix(b),F.wrap(d),F.wrap(l),F.wrap(q),x];X.currentStep.push(m.turnIntoCSList(n));h=function(f){X.hasOwnProperty(f)||(X[f]=F.wrap(f));n[n.length-1]=X[f]}}l>k&&q>k||(1E-5>q?1E-5>l?h("Staying inside singularity."):(h("Moved into singularity."),Ka=!0):1E-5>l?h("Moved out of singularity."):(db?h("Reached refinement limit, giving up."):h("Need to refine."),Gb()));return a}function jc(f){var a=f.length,p,b;if(Ya){for(p=0;p<a;++p)Aa+=2*f[p].value.length,qa(f[p]);
return f}var c=Array(a),d=Array(a),e=Array(a),g=99,h=99,k=Array(a);for(p=0;p<a;++p)c[p]=va(f[p].value.length),d[p]=m.normSquared(c[p]).value.real,e[p]=m.normSquared(f[p]).value.real,k[p]=Array(a);var l;for(p=0;p<a;++p){for(b=0;b<a;++b)l=m.sesquilinearproduct(c[p],f[b]).value,l=(l.real*l.real+l.imag*l.imag)/(d[p]*e[b]),k[p][b]=1-l;for(b=p+1;b<a;++b)l=m.sesquilinearproduct(c[p],c[b]).value,l=(l.real*l.real+l.imag*l.imag)/(d[p]*d[b]),g>1-l&&(g=1-l),l=m.sesquilinearproduct(f[p],f[b]).value,l=(l.real*
l.real+l.imag*l.imag)/(e[p]*e[b]),h>1-l&&(h=1-l)}l=sb(k);b=Array(a);d=0;e=!1;for(p=0;p<a;++p){var d=d+k[p][l[p]],q=b[p]=f[l[p]];qa(q);e|=m._helper.isNaN(q)}e|=isNaN(d);f=function(){};if(X&&X.currentStep){var n=[X.labelTracingSesq,F.wrap(X.currentElement.name),m.turnIntoCSList(b),m.turnIntoCSList(c),m.realMatrix(k),F.wrap(d),F.wrap(g),F.wrap(h),x];X.currentStep.push(m.turnIntoCSList(n));f=function(f){X.hasOwnProperty(f)||(X[f]=F.wrap(f));n[n.length-1]=X[f]}}e?(f("Tracing failed due to NaNs."),Ka=!0):
g>3*d&&h>3*d?f("Normal case, everything all right."):1E-5>h?1E-5>g?f("Staying inside singularity."):(f("Moved into singularity."),Ka=!0):1E-5>g?f("Moved out of singularity."):(db?f("Reached refinement limit, giving up."):f("Need to refine."),Gb());return b}function tc(f){Fa.forEach(function(f){ca[f.behavior.type].init(f.behavior,c[f.name])})}function vb(f){wb=0!==f.length;Fa=f;ra=[];Fa.forEach(function(f){if(f.name){var a=f.name;c[a]&&(c[a].behavior=f.behavior,ca[f.behavior.type].init(f.behavior,
c[a]),"Mass"===f.behavior.type&&ra.push(c[a]))}else ca[f.behavior.type].init(f.behavior)})}var Oa=this,Da,Ba={},Ua=!1,kb=!0,lb=!1,ib=1,Ta=0,Rb,Sb=!1,eb,L,ya,ua,xa,Xa=null,qc="           #drawgrid(s):=(              regional(b,xmin,xmax,ymin,ymax,nx,ny);              b=screenbounds();              xmin=b_4_1-s;              xmax=b_2_1+s;              ymin=b_4_2-s;              ymax=b_2_2+s;              nx=round((xmax-xmin)/s);              ny=round((ymax-ymin)/s);              xmin=floor(xmin/s)*s;              ymin=floor(ymin/s)*s;              repeat(nx,x,                 draw((xmin+x*s,ymin),(xmin+x*s,ymax),color->(1,1,1)*.9,size->1);              );              repeat(ny,y,                 draw((xmin,ymin+y*s),(xmax,ymin+y*s),color->(1,1,1)*.9,size->1);              )            );",
cb=[],xb=!1,Ma={config:a,startup:H,shutdown:R,evokeCS:function(f){f=fb(f);f=Ea(f,!1);console.log(f);I(f);S()},play:k,pause:M,stop:K,evalcs:function(f){return I(Ea(fb(f),!1))},niceprint:ia,canvas:null},tb=!1,jb=0;a.use&&a.use.forEach(function(f){var b=null;a.plugins&&(b=a.plugins[f]);b||(b=Oa._pluginRegistry[f]);b||(++jb,console.log("Loading script for plugin "+f),Oa.loadScript(f+"-plugin",f+"-plugin.js",function(){console.log("Successfully loaded plugin "+f);0===--jb&&tb&&H()},function(){console.error("Failed to auto-load plugin "+
f);0===--jb&&tb&&H()}))});Y.prototype=new O;ea.prototype=new O;ha.prototype=new O;var pa={},wa,Tb="",Ub=0,Jc=[].slice,Lb,kc=function(f){return Jc.call(f)};if(!a.isNode){var Kc=document.documentElement;Lb=window;try{kc(Kc.childNodes)[0].nodeType}catch(Lc){kc=function(f){for(var a=f.length,p=Array(a);a--;)p[a]=f[a];return p}}}var Vb="webkit ms moz Moz o O".split(" "),zb={},ob,pb,nb,mb,Wa,Wb=!a.isNode&&Lb[g(Lb,"requestAnimationFrame")]||function(f){setTimeout(f,17)};zb.timer=function(f,a,p){var b=arguments.length;
2>b&&(a=0);3>b&&(p=Date.now());b={c:f,t:p+a,f:!1,n:null};pb?pb.n=b:ob=b;pb=b;nb||(mb=clearTimeout(mb),nb=1,Wb(t))};zb.timer.flush=function(){U();oa()};var x=new na,Mb=new na,da=new function(){this.vars={pi:{ctype:"variable",stack:[{ctype:"number",value:{real:Math.PI,imag:0}}],name:"pi"},i:{ctype:"variable",stack:[{ctype:"number",value:{real:0,imag:1}}],name:"i"},"true":{ctype:"variable",stack:[{ctype:"boolean",value:!0}],name:"true"},"false":{ctype:"variable",stack:[{ctype:"boolean",value:!1}],name:"false"},
"#":{ctype:"variable",stack:[x],name:"#"}};this.isVariable=function(f){return void 0!==this.vars[f]};this.isVariableName=function(f){if("#"===f||"#1"===f||"#2"===f)return!0;var a=/^[a-z,A-Z]+$/.test(f[0]);f=/^[0-9,a-z,A-Z]+$/.test(f);return a&&f};this.create=function(f){var a={ctype:"variable",stack:[Mb],name:f};return this.vars[f]=a};this.newvar=function(f){f=this.vars[f];f.stack.push(x);return f};this.removevar=function(f){var a=this.vars[f].stack;0===a.length&&console.error("Removing non-existing "+
f);a.pop();0===a.length&&console.warn("Removing last "+f)};this.setvar=function(f,a){var p=this.vars[f].stack;0===p.length&&console.error("Setting non-existing variable "+f);void 0===a&&(console.error("Setting variable "+f+" to undefined value"),a=x);if("undefined"===a.ctype)p[p.length-1]=a;else{var b=a;b===Mb&&(b=x);p[p.length-1]=b}};this.undefinedWarning={};this.getvar=function(f){var a=this.vars[f].stack;0===a.length&&console.error("Getting non-existing variable "+f);a=a[a.length-1];if(a===Mb){if(void 0!==
c[f])return{ctype:"geo",value:c[f]};console&&console.log&&void 0===this.undefinedWarning[f]&&(this.undefinedWarning[f]=!0,console.log("Warning: Accessing undefined variable: "+f));return x}return a};this.dump=function(f){var a=this.vars[f].stack;console.log("*** Dump "+f);for(f=0;f<a.length;f++)console.log(f+":> "+ia(a[f]))};this.vstack=[];this.pushVstack=function(f){this.vstack.push(f)};this.popVstack=function(){this.vstack.pop()};this.cleanVstack=function(){for(var f=this.vstack;0<f.length&&"*"!==
f[f.length-1];)this.removevar(f[f.length-1]),f.pop();0<f.length&&f.pop()}},Ia={generalFields:{color:"color",colorhsb:"",size:"size",alpha:"alpha",isshowing:"isshowing",visible:"visible",name:"name",caption:"caption",trace:"trace",tracelength:"",selected:""},getGeoField:function(f,a){return"undefined"!==typeof c[f]?Ia.getField(c[f],a):x},setGeoField:function(f,a,p){return"undefined"!==typeof c[f]?Ia.setField(c[f],a,p):x},getField:function(f,a){var p;if("P"===f.kind){if("xy"===a){p=q.div(f.homog.value[0],
f.homog.value[2]);var b=q.div(f.homog.value[1],f.homog.value[2]);p=m.turnIntoCSList([p,b]);return F.withUsage(p,"Point")}if("homog"===a)return F.withUsage(f.homog,"Point");if("x"===a)return q.div(f.homog.value[0],f.homog.value[2]);if("y"===a)return q.div(f.homog.value[1],f.homog.value[2])}if("L"===f.kind){if("homog"===a)return F.withUsage(f.homog,"Line");if("angle"===a)return p=m.eucangle(m.ey,f.homog),F.withUsage(p,"Angle")}if("Tr"===f.kind&&"matrix"===a)return f.matrix;if("C"===f.kind&&"radius"===
a){var c=f.matrix;p=c.value[0].value[0];var d=c.value[0].value[2],b=c.value[1].value[2],c=c.value[2].value[2];q.mult(p,p);d=q.div(d,p);b=q.div(b,p);p=q.div(c,p);return p=q.sqrt(q.sub(q.add(q.mult(d,d),q.mult(b,b)),p))}if(Ia.generalFields[a])return(p=f[Ia.generalFields[a]])?p:x;if(f.behavior){if("mass"===a&&"Mass"===f.behavior.type)return q.real(f.behavior.mass);if("radius"===a&&"Mass"===f.behavior.type)return q.real(f.behavior.radius);if("charge"===a&&"Mass"===f.behavior.type)return q.real(f.behavior.charge);
if("friction"===a&&"Mass"===f.behavior.type)return q.real(f.behavior.friction);if("vx"===a&&"Mass"===f.behavior.type)return q.real(f.behavior.vx);if("vy"===a&&"Mass"===f.behavior.type)return q.real(f.behavior.vy);if("v"===a&&"Mass"===f.behavior.type)return m.realVector([f.behavior.vx,f.behavior.vy]);if("fx"===a&&"Mass"===f.behavior.type)return q.real(f.behavior.fx);if("fy"===a&&"Mass"===f.behavior.type)return q.real(f.behavior.fy);if("f"===a&&"Mass"===f.behavior.type)return m.realVector([f.behavior.fx,
f.behavior.fy])}return x},setField:function(f,a,p){"color"===a&&(f.color=p);"size"===a&&(f.size=p);"alpha"===a&&(f.alpha=p);"visible"===a&&"boolean"===p.ctype&&(f.visible=p.value);"pinned"===a&&"boolean"===p.ctype&&(f.pinned=p.value);"printlabel"===a&&(f.printname=ia(p));"xy"===a&&"P"===f.kind&&f.movable&&m._helper.isNumberVecN(p,2)&&Jb(f,m.turnIntoCSList([p.value[0],p.value[1],q.real(1)]),"homog");"homog"===a&&"P"===f.kind&&f.movable&&m._helper.isNumberVecN(p,3)&&Jb(f,p,"homog");if("angle"===a&&
"Through"===f.type){var b=q.cos(p),c=q.sin(p),b=m.turnIntoCSList([b,c,q.real(0)]);Jb(f,b,"dir")}f.behavior&&("mass"===a&&"Mass"===f.behavior.type&&"number"===p.ctype&&(f.behavior.mass=p.value.real),"mass"===a&&"Sun"===f.behavior.type&&"number"===p.ctype&&(f.behavior.mass=p.value.real),"friction"===a&&"Mass"===f.behavior.type&&"number"===p.ctype&&(f.behavior.friction=p.value.real),"charge"===a&&"Mass"===f.behavior.type&&"number"===p.ctype&&(f.behavior.charge=p.value.real),"radius"===a&&"Mass"===f.behavior.type&&
"number"===p.ctype&&(f.behavior.radius=p.value.real),"vx"===a&&"Mass"===f.behavior.type&&"number"===p.ctype&&(f.behavior.vx=p.value.real),"vy"===a&&"Mass"===f.behavior.type&&"number"===p.ctype&&(f.behavior.vy=p.value.real),"v"===a&&"Mass"===f.behavior.type&&m._helper.isNumberVecN(p,2)&&(f.behavior.vx=p.value[0].value.real,f.behavior.vy=p.value[1].value.real))}},q={_helper:{}};q._helper.roundingfactor=1E4;q._helper.niceround=function(f){return Math.round(f*q._helper.roundingfactor)/q._helper.roundingfactor};
q.niceprint=function(f){var a=q._helper.niceround(f.value.real);f=q._helper.niceround(f.value.imag);return 0===f?""+a:0<f?""+a+" + i*"+f:""+a+" - i*"+-f};q.complex=function(f,a){return{ctype:"number",value:{real:f,imag:a}}};q.real=function(f){return{ctype:"number",value:{real:f,imag:0}}};q.zero=q.real(0);q.one=q.real(1);q.argmax=function(f,a){return f.value.real*f.value.real+f.value.imag*f.value.imag<a.value.real*a.value.real+a.value.imag*a.value.imag?a:f};q.max=function(f,a){return{ctype:"number",
value:{real:Math.max(f.value.real,a.value.real),imag:Math.max(f.value.imag,a.value.imag)}}};q.min=function(f,a){return{ctype:"number",value:{real:Math.min(f.value.real,a.value.real),imag:Math.min(f.value.imag,a.value.imag)}}};q.add=function(f,a){return{ctype:"number",value:{real:f.value.real+a.value.real,imag:f.value.imag+a.value.imag}}};q.sub=function(f,a){return{ctype:"number",value:{real:f.value.real-a.value.real,imag:f.value.imag-a.value.imag}}};q.neg=function(f){return{ctype:"number",value:{real:-f.value.real,
imag:-f.value.imag}}};q.re=function(f){return{ctype:"number",value:{real:f.value.real,imag:0}}};q.im=function(f){return{ctype:"number",value:{real:f.value.imag,imag:0}}};q.conjugate=function(f){return{ctype:"number",value:{real:f.value.real,imag:-f.value.imag}}};q.round=function(f){return{ctype:"number",value:{real:Math.round(f.value.real),imag:Math.round(f.value.imag)}}};q.ceil=function(f){return{ctype:"number",value:{real:Math.ceil(f.value.real),imag:Math.ceil(f.value.imag)}}};q.floor=function(f){return{ctype:"number",
value:{real:Math.floor(f.value.real),imag:Math.floor(f.value.imag)}}};q.mult=function(f,a){return{ctype:"number",value:{real:f.value.real*a.value.real-f.value.imag*a.value.imag,imag:f.value.real*a.value.imag+f.value.imag*a.value.real}}};q.realmult=function(f,a){return{ctype:"number",value:{real:f*a.value.real,imag:f*a.value.imag}}};q.multiMult=function(f){var a=f[0];if("number"!==a.ctype)return x;for(var p=1;p<f.length;p++){if("number"!==f[p].ctype)return x;a=q.mult(a,f[p])}return a};q.abs2=function(f,
a){return{ctype:"number",value:{real:f.value.real*f.value.real+f.value.imag*f.value.imag,imag:0}}};q.abs=function(f){return q.sqrt(q.abs2(f))};q.inv=function(f){var a=f.value.real*f.value.real+f.value.imag*f.value.imag;0===a&&console.error("DIVISION BY ZERO");return{ctype:"number",value:{real:f.value.real/a,imag:-f.value.imag/a}}};q.div=function(f,a){return q.mult(f,q.inv(a))};q.eps=1E-7;q.snap=function(f){var a=f.value.real;f=f.value.imag;Math.floor(a+q.eps)!==Math.floor(a-q.eps)&&(a=Math.round(a));
Math.floor(f+q.eps)!==Math.floor(f-q.eps)&&(f=Math.round(f));return{ctype:"number",value:{real:a,imag:f}}};q.exp=function(f){var a=Math.exp(f.value.real),p=a*Math.cos(f.value.imag);f=a*Math.sin(f.value.imag);return{ctype:"number",value:{real:p,imag:f}}};q.cos=function(f){var a=f.value.real,p=f.value.imag,b=Math.exp(p);f=b*Math.sin(-a);var c=b*Math.cos(-a),b=Math.exp(-p),p=b*Math.sin(a),a=b*Math.cos(a);return{ctype:"number",value:{real:(c+a)/2,imag:(f+p)/2}}};q.sin=function(f){var a=f.value.real,p=
f.value.imag,b=Math.exp(p);f=b*Math.sin(-a);var c=b*Math.cos(-a),b=Math.exp(-p),p=b*Math.sin(a),a=b*Math.cos(a);return{ctype:"number",value:{real:-(f-p)/2,imag:(c-a)/2}}};q.tan=function(f){var a=q.sin(f);f=q.cos(f);return q.div(a,f)};q.arccos=function(f){var a=q.mult(f,q.neg(f)),a=q.sqrt(q.add(q.real(1),a));f=q.add(q.mult(f,q.complex(0,1)),a);f=q.add(q.mult(q.log(f),q.complex(0,1)),q.real(.5*Math.PI));return F.withUsage(f,"Angle")};q.arcsin=function(f){var a=q.mult(f,q.neg(f)),a=q.sqrt(q.add(q.real(1),
a));f=q.add(q.mult(f,q.complex(0,1)),a);f=q.mult(q.log(f),q.complex(0,-1));return F.withUsage(f,"Angle")};q.arctan=function(f){var a=q.log(q.add(q.mult(f,q.complex(0,-1)),q.real(1)));f=q.log(q.add(q.mult(f,q.complex(0,1)),q.real(1)));a=q.mult(q.sub(a,f),q.complex(0,.5));return F.withUsage(a,"Angle")};q.arctan2=function(f,a){var p=q.real(Math.atan2(a.value.real,f.value.real));return F.withUsage(p,"Angle")};q.sqrt=function(f){var a=f.value.real,p=f.value.imag;f=Math.sqrt(Math.sqrt(a*a+p*p));a=Math.atan2(p,
a);p=f*Math.sin(a/2);return{ctype:"number",value:{real:f*Math.cos(a/2),imag:p}}};q.pow2=function(f,a){var p=f.value.real,b=f.value.imag,c=Math.pow(Math.sqrt(p*p+b*b),a),p=Math.atan2(b,p),b=c*Math.sin(p*a);return{ctype:"number",value:{real:c*Math.cos(p*a),imag:b}}};q.log=function(f){var a=f.value.real,p=f.value.imag,b=Math.sqrt(a*a+p*p);f=Math.atan2(p,a);0>p&&(f+=2*Math.PI);0===p&&0>a&&(f=Math.PI);f>Math.PI&&(f-=2*Math.PI);a=Math.log(b);return q.snap({ctype:"number",value:{real:a,imag:f}})};q.pow=
function(f,a){if(a.value.real===Math.round(a.value.real)&&0===a.value.imag){for(var p={ctype:"number",value:{real:1,imag:0}},b=0;b<Math.abs(a.value.real);b++)p=q.mult(p,f);return 0>a.value.real?q.inv(p):p}return q.exp(q.mult(q.log(f),a))};q.mod=function(f,a){var p=f.value.real,b=a.value.real,c=f.value.imag,d=a.value.imag,p=p-Math.floor(p/b)*b,c=c-Math.floor(c/d)*d;0===b&&(p=0);0===d&&(c=0);return q.snap({ctype:"number",value:{real:p,imag:c}})};q._helper.seed="NO";q.eps=1E-10;q.epsbig=1E-6;q._helper.seedrandom=
function(f){f-=Math.floor(f);q._helper.seed=.8*f+.1};q._helper.rand=function(){if("NO"===q._helper.seed)return Math.random();var f=q._helper.seed,f=1E3*Math.sin(1E3*f),f=f-Math.floor(f);return q._helper.seed=f};q._helper.randnormal=function(){var f=q._helper.rand(),a=q._helper.rand();return Math.sqrt(-2*Math.log(f))*Math.cos(2*Math.PI*a)};q._helper.isEqual=function(f,a){return f.value.real===a.value.real&&f.value.imag===a.value.imag};q._helper.isLessThan=function(f,a){return f.value.real<a.value.real||
f.value.real===a.value.real&&f.value.imag<a.value.imag};q._helper.compare=function(f,a){return q._helper.isLessThan(f,a)?-1:q._helper.isEqual(f,a)?0:1};q._helper.isAlmostEqual=function(f,a,p){var b=q.eps;"undefined"!==typeof p&&(b=p);p=f.value.real-a.value.real;f=f.value.imag-a.value.imag;return p<b&&p>-b&&f<b&&f>-b};q._helper.isZero=function(f){return 0===f.value.real&&0===f.value.imag};q._helper.isAlmostZero=function(f){var a=f.value.real;f=f.value.imag;return a<q.eps&&a>-q.eps&&f<q.eps&&f>-q.eps};
q._helper.isReal=function(f){return 0===f.value.imag};q._helper.isAlmostReal=function(f){f=f.value.imag;return f<q.epsbig&&f>-q.epsbig};q._helper.isNaN=function(f){return isNaN(f.value.real)||isNaN(f.value.imag)};q._helper.isAlmostImag=function(f){f=f.value.real;return f<q.epsbig&&f>-q.epsbig};q._helper.z3a=q.complex(-.5,.5*Math.sqrt(3));q._helper.z3b=q.complex(-.5,-.5*Math.sqrt(3));q._helper.cub1={ctype:"list",value:[q.one,q.one,q.one]};q._helper.cub2={ctype:"list",value:[q._helper.z3a,q.one,q._helper.z3b]};
q._helper.cub3={ctype:"list",value:[q._helper.z3b,q.one,q._helper.z3a]};q.solveCubic=function(f,a,p,b){f=q._helper.solveCubicHelper(f,a,p,b);return[m.scalproduct(q._helper.cub1,f),m.scalproduct(q._helper.cub2,f),m.scalproduct(q._helper.cub3,f)]};q._helper.solveCubicHelper=function(f,a,p,b){var c=f.value.real;f=f.value.imag;var d=a.value.real;a=a.value.imag;var e=p.value.real,g=p.value.imag,h=b.value.real,k=b.value.imag;p=c*e-f*g;b=c*g+f*e;var l=4*p-(d*d-a*a),n=4*b-2*d*a,r=c*d-f*a,t=c*a+f*d,u=l*e-
n*g-18*(r*h-t*k),n=l*g+n*e-18*(r*k+t*h),v=27*(c*c-f*f),w=54*f*c,l=v*h-w*k,x=v*k+w*h,y=d*d-a*a,v=2*d*a,z=y*d-v*a,A=y*a+v*d,w=l+4*z,B=x+4*A,z=-2*z+9*(r*e-t*g),A=-2*A+9*(r*g+t*e),z=z-l,A=A-x,l=27*(u*e-n*g+w*h-B*k),n=27*(u*g+n*e+w*k+B*h),w=Math.sqrt(Math.sqrt(l*l+n*n)),B=Math.atan2(n,l),n=w*Math.sin(B/2),l=w*Math.cos(B/2),z=z+(l*c-n*f),A=A+(l*f+n*c),e=Math.exp(Math.log(Math.sqrt(z*z+A*A))/3),n=Math.atan2(A,z),w=e*Math.sin(n/3),B=e*Math.cos(n/3),e=e*e,n=2*n,l=e*Math.sin(n/3),e=e*Math.cos(n/3);p=2*y-6*
p;b=2*v-6*b;v=-1.5874010519681996*(d*B-a*w);d=-1.5874010519681996*(d*w+a*B);a=1.2599210498948732*e;y=1.2599210498948732*l;l=4.762203155904599*(B*c-w*f);n=4.762203155904599*(B*f+w*c);c=l*l+n*n;w=(p*l+b*n)/c;B=(-p*n+b*l)/c;p=w;b=B;w=(v*l+d*n)/c;B=(-v*n+d*l)/c;v=w;d=B;w=(a*l+y*n)/c;B=(-a*n+y*l)/c;a=w;y=B;return m.turnIntoCSList([q.complex(p,b),q.complex(v,d),q.complex(a,y)])};var m={_helper:{},turnIntoCSList:function(f){return{ctype:"list",value:f}},realVector:function(f){for(var a=[],p=0;p<f.length;p++)a[p]=
{ctype:"number",value:{real:f[p],imag:0}};return{ctype:"list",value:a}}};m._helper.unitvector=function(f,a){var p=m.zerovector(f);p.value[Math.floor(a.value.real-1)]=q.real(1);return p};m.idMatrix=function(f){for(var a=m.zeromatrix(f,f),p=q.real(1),b=0;b<f.value.real;b++)a.value[b].value[b]=p;return a};m._helper.flippedidMatrix=function(f){for(var a=m.zeromatrix(f,f),p=q.real(1),b=0;b<f.value.real;b++)a.value[b].value[f.value.real-b-1]=p;return a};m.println=function(f){for(var a=[],p=0;p<f.value.length;p++)if("number"===
f.value[p].ctype)a[p]=q.niceprint(f.value[p]);else if("list"===f.value[p].ctype)m.println(f.value[p]);else return x;"number"===f.value[0].ctype&&console.log(a)};m.realMatrix=function(f){for(var a=f.length,p=Array(a),b=0;b<a;b++)p[b]=m.realVector(f[b]);return m.turnIntoCSList(p)};m.ex=m.realVector([1,0,0]);m.ey=m.realVector([0,1,0]);m.ez=m.realVector([0,0,1]);m.linfty=m.realVector([0,0,1]);m.ii=m.turnIntoCSList([q.complex(1,0),q.complex(0,1),q.complex(0,0)]);m.jj=m.turnIntoCSList([q.complex(1,0),q.complex(0,
-1),q.complex(0,0)]);m.fundDual=m.realMatrix([[1,0,0],[0,1,0],[0,0,0]]);m.fund=m.realMatrix([[0,0,0],[0,0,0],[0,0,1]]);m.sequence=function(f,a){for(var p=[],b=0,c=Math.round(f.value.real);c<Math.round(a.value.real)+1;c++)p[b]={ctype:"number",value:{real:c,imag:0}},b++;return{ctype:"list",value:p}};m.pairs=function(f){for(var a=[],p=0;p<f.value.length-1;p++)for(var b=p+1;b<f.value.length;b++)a.push({ctype:"list",value:[f.value[p],f.value[b]]});return{ctype:"list",value:a}};m.triples=function(f){for(var a=
[],p=0;p<f.value.length-2;p++)for(var b=p+1;b<f.value.length-1;b++)for(var c=b+1;c<f.value.length;c++)a.push({ctype:"list",value:[f.value[p],f.value[b],f.value[c]]});return{ctype:"list",value:a}};m.triples=function(f){for(var a=[],p=0;p<f.value.length-2;p++)for(var b=p+1;b<f.value.length-1;b++)for(var c=b+1;c<f.value.length;c++)a.push({ctype:"list",value:[f.value[p],f.value[b],f.value[c]]});return{ctype:"list",value:a}};m.cycle=function(f){for(var a=[],p=0;p<f.value.length-1;p++)a[p]={ctype:"list",
value:[f.value[p],f.value[p+1]]};a.push({ctype:"list",value:[f.value[f.value.length-1],f.value[0]]});return{ctype:"list",value:a}};m.consecutive=function(f){for(var a=[],p=0;p<f.value.length-1;p++)a[p]={ctype:"list",value:[f.value[p],f.value[p+1]]};return{ctype:"list",value:a}};m.reverse=function(f){for(var a=[],p=f.value.length-1;0<=p;p--)a.push(f.value[p]);return{ctype:"list",value:a}};m.directproduct=function(f,a){for(var p=[],b=0;b<f.value.length;b++)for(var c=0;c<a.value.length;c++)p.push({ctype:"list",
value:[f.value[b],a.value[c]]});return{ctype:"list",value:p}};m.concat=function(f,a){for(var p=[],b=0;b<f.value.length;b++)p.push(f.value[b]);for(b=0;b<a.value.length;b++)p.push(a.value[b]);return{ctype:"list",value:p}};m.prepend=function(f,a){var p=[];p[0]=f;for(var b=0;b<a.value.length;b++)p[b+1]=a.value[b];return{ctype:"list",value:p}};m.append=function(f,a){for(var p=[],b=0;b<f.value.length;b++)p[b]=f.value[b];p.push(a);return{ctype:"list",value:p}};m.contains=function(f,a){for(var p=0;p<f.value.length;p++)if(Q.equals(f.value[p],
a).value)return{ctype:"boolean",value:!0};return{ctype:"boolean",value:!1}};m.common=function(f,a){for(var p=[],b=0,c=0;c<f.value.length;c++){for(var d=!1,e=f.value[c],g=0;g<a.value.length;g++)d=d||Q.equals(e,a.value[g]).value;d&&(p[b]=f.value[c],b++)}return{ctype:"list",value:p}};m.remove=function(f,a){for(var p=[],b=0,c=0;c<f.value.length;c++){for(var d=!1,e=f.value[c],g=0;g<a.value.length;g++)d=d||Q.equals(e,a.value[g]).value;d||(p[b]=f.value[c],b++)}return{ctype:"list",value:p}};m._helper.compare=
function(f,a){return"number"===f.ctype&&"number"===a.ctype?f.value.real-a.value.real:-1};m.sort1=function(f){f=f.value.slice();f.sort(F.compare);return m.turnIntoCSList(f)};m._helper.isEqual=function(f,a){return m.equals(f,a).value};m._helper.isLessThan=function(f,a){for(var p=f.value.length,b=a.value.length,c=0;!(c>=p||c>=b)&&F.isEqual(f.value[c],a.value[c]);)c++;return c===p&&c<b?!0:c===b&&c<p||c===p&&c===b?!1:F.isLessThan(f.value[c],a.value[c])};m._helper.compare=function(f,a){return m._helper.isLessThan(f,
a)?-1:m._helper.isEqual(f,a)?0:1};m.equals=function(f,a){if(f.value.length!==a.value.length)return{ctype:"boolean",value:!1};for(var p=!0,b=0;b<f.value.length;b++)var c=f.value[b],d=a.value[b],p="list"===c.ctype&&"list"===d.ctype?p&&m.equals(c,d).value:p&&ta([c,d],[]).value;return{ctype:"boolean",value:p}};m.almostequals=function(f,a){if(f.value.length!==a.value.length)return{ctype:"boolean",value:!1};for(var p=!0,b=0;b<f.value.length;b++)var c=f.value[b],d=a.value[b],p="list"===c.ctype&&"list"===
d.ctype?p&&m.comp_almostequals(c,d).value:p&&Na([c,d],[]).value;return{ctype:"boolean",value:p}};m._helper.isAlmostReal=function(f){for(var a=!0,p=0;p<f.value.length;p++)var b=f.value[p],a="list"===b.ctype?a&&m._helper.isAlmostReal(b):a&&q._helper.isAlmostReal(b);return a};m._helper.isAlmostZero=function(f){for(var a=0;a<f.value.length;a++){var p=f.value[a];if("list"===p.ctype){if(!m._helper.isAlmostZero(p))return!1}else if(!q._helper.isAlmostZero(p))return!1}return!0};m._helper.isNaN=function(f){for(var a=
!1,p=0;p<f.value.length;p++)var b=f.value[p],a="list"===b.ctype?a||m._helper.isNaN(b):a||q._helper.isNaN(b);return a};m.set=function(f){var a=[],p=0;f=f.value.slice();f.sort(F.compare);for(var b=0;b<f.length;b++)0!==b&&ta([a[a.length-1],f[b]],[]).value||(a[p]=f[b],p++);return{ctype:"list",value:a}};m.maxval=function(f){for(var a=q.zero,p=0;p<f.value.length;p++){var b=f.value[p];"number"===b.ctype&&(a=q.argmax(a,b));"list"===b.ctype&&(a=q.argmax(a,m.maxval(b)))}return a};m.maxIndex=function(f,a,p){var b=
0;void 0!==p&&(b=p);p=b;for(var c=a(f.value[b]).value.real;b<f.value.length;++b){var d=a(f.value[b]).value.real;d>c&&(p=b,c=d)}return p};m.normalizeMax=function(f){var a=q.inv(m.maxval(f));return m.scalmult(a,f)};m.normalizeZ=function(f){var a=q.inv(f.value[2]);return m.scalmult(a,f)};m.normalizeAbs=function(f){var a=q.inv(m.abs(f));return m.scalmult(a,f)};m.max=function(f,a){if(f.value.length!==a.value.length)return x;for(var p=[],b=0;b<f.value.length;b++)p[b]=F.max(f.value[b],a.value[b]);return{ctype:"list",
value:p}};m.min=function(f,a){if(f.value.length!==a.value.length)return x;for(var p=[],b=0;b<f.value.length;b++)p[b]=F.min(f.value[b],a.value[b]);return{ctype:"list",value:p}};m.scaldiv=function(f,a){if("number"!==f.ctype)return x;for(var p=[],b=0;b<a.value.length;b++){var c=a.value[b];p[b]="number"===c.ctype?F.div(c,f):"list"===c.ctype?m.scaldiv(f,c):x}return{ctype:"list",value:p}};m.scalmult=function(f,a){if("number"!==f.ctype)return x;for(var p=[],b=0;b<a.value.length;b++){var c=a.value[b];p[b]=
"number"===c.ctype?F.mult(c,f):"list"===c.ctype?m.scalmult(f,c):x}return{ctype:"list",value:p}};m.add=function(f,a){if(f.value.length!==a.value.length)return x;for(var p=[],b=0;b<f.value.length;b++){var c=f.value[b],d=a.value[b];p[b]="number"===c.ctype&&"number"===d.ctype?F.add(c,d):"list"===c.ctype&&"list"===d.ctype?m.add(c,d):x}return{ctype:"list",value:p}};m.sub=function(f,a){if(f.value.length!==a.value.length)return x;for(var p=[],b=0;b<f.value.length;b++){var c=f.value[b],d=a.value[b];p[b]="number"===
c.ctype&&"number"===d.ctype?q.sub(c,d):"list"===c.ctype&&"list"===d.ctype?m.sub(c,d):x}return{ctype:"list",value:p}};m.abs2=function(f){for(var a=0,p=0;p<f.value.length;p++){var b=f.value[p];if("number"===b.ctype)a+=q.abs2(b).value.real;else if("list"===b.ctype)a+=m.abs2(b).value.real;else return x}return{ctype:"number",value:{real:a,imag:0}}};m.abs=function(f){return q.sqrt(m.abs2(f))};m.normalizeMaxXX=function(f){for(var a=-1E4,p=q.real(1),b=0;b<f.value.length;b++){var c=q.abs(f.value[b]);c.value.real>
a&&(p=f.value[b],a=c.value.real)}return m.scaldiv(p,f)};m.recursive=function(f,a){for(var p=[],b=0;b<f.value.length;b++){var c=N(f.value[b]);p[b]="number"===c.ctype?q[a](c):"list"===c.ctype?m[a](c):x}return{ctype:"list",value:p}};m.re=function(f){return m.recursive(f,"re")};m.neg=function(f){return m.recursive(f,"neg")};m.im=function(f){return m.recursive(f,"im")};m.conjugate=function(f){return m.recursive(f,"conjugate")};m.transjugate=function(f){return m.transpose(m.conjugate(f))};m.round=function(f){return m.recursive(f,
"round")};m.ceil=function(f){return m.recursive(f,"ceil")};m.floor=function(f){return m.recursive(f,"floor")};m._helper.colNumb=function(f){if("list"!==f.ctype)return-1;for(var a=-1,p=0;p<f.value.length;p++){if("list"!==f.value[p].ctype)return-1;if(0===p)a=f.value[p].value.length;else if(a!==f.value[p].value.length)return-1}return a};m._helper.isNumberVecN=function(f,a){if("list"!==f.ctype||f.value.length!==a)return!1;for(var p=0;p<f.value.length;p++)if("number"!==f.value[p].ctype)return!1;return!0};
m.isNumberVector=function(f){if("list"!==f.ctype)return{ctype:"boolean",value:!1};for(var a=0;a<f.value.length;a++)if("number"!==f.value[a].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};m.isNumberVectorN=function(f,a){if("list"!==f.ctype)return{ctype:"boolean",value:!1};if(f.value)for(var p=0;p<f.value.length;p++)if("number"!==f.value[p].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};m.isNumberMatrix=function(f){if(-1===m._helper.colNumb(f))return{ctype:"boolean",
value:!1};for(var a=0;a<f.value.length;a++)if(!m.isNumberVector(f.value[a]).value)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};m.scalproduct=function(f,a){if(f.value.length!==a.value.length)return x;for(var p={ctype:"number",value:{real:0,imag:0}},b=0;b<a.value.length;b++){var c=f.value[b],d=a.value[b];if("number"===c.ctype&&"number"===d.ctype)p=q.add(q.mult(c,d),p);else return x}return p};m.sesquilinearproduct=function(f,a){if(f.value.length!==a.value.length)return x;for(var p=
0,b=0,c=0;c<a.value.length;c++)var d=f.value[c].value,e=a.value[c].value,p=p+(d.real*e.real+d.imag*e.imag),b=b+(d.real*e.imag-d.imag*e.real);return q.complex(p,b)};m.normSquared=function(f){for(var a=0,p=0;p<f.value.length;p++)var b=f.value[p].value,a=a+(b.real*b.real+b.imag*b.imag);return q.real(a)};m.productMV=function(f,a){if(f.value[0].value.length!==a.value.length)return x;for(var p=[],b=0;b<f.value.length;b++){for(var c={ctype:"number",value:{real:0,imag:0}},d=f.value[b],e=0;e<a.value.length;e++){var g=
d.value[e],h=a.value[e];if("number"===g.ctype&&"number"===h.ctype)c=q.add(q.mult(g,h),c);else return x}p[b]=c}return m.turnIntoCSList(p)};m.productVM=function(f,a){if(f.value.length!==a.value.length)return x;for(var p=[],b=0;b<a.value[0].value.length;b++){for(var c={ctype:"number",value:{real:0,imag:0}},d=0;d<f.value.length;d++){var e=f.value[d],g=a.value[d].value[b];if("number"===e.ctype&&"number"===g.ctype)c=q.add(q.mult(e,g),c);else return x}p[b]=c}return m.turnIntoCSList(p)};m.productMM=function(f,
a){if(f.value[0].value.length!==a.value.length)return x;for(var p=[],b=0;b<f.value.length;b++){var c=m.productVM(f.value[b],a);p[b]=c}return m.turnIntoCSList(p)};m.mult=function(f,a){return f.value.length===a.value.length&&m.isNumberVector(f).value&&m.isNumberVector(a).value?m.scalproduct(f,a):m.isNumberMatrix(f).value&&a.value.length===f.value[0].value.length&&m.isNumberVector(a).value?m.productMV(f,a):m.isNumberMatrix(a).value&&f.value.length===a.value.length&&m.isNumberVector(f).value?m.productVM(f,
a):m.isNumberMatrix(f).value&&m.isNumberMatrix(a)&&a.value.length===f.value[0].value.length?m.productMM(f,a):x};m.projectiveDistMinScal=function(f,a){var p=m.abs(f),b=m.abs(a);if(0===p.value.real||0===b.value.real)return 0;var c=m.conjugate(a),c=m.scalproduct(f,c),c=q._helper.isAlmostZero(c)?q.real(1):q.div(c,q.abs(c)),p=m.scaldiv(p,f),b=m.scaldiv(b,a),b=m.scalmult(c,b),c=m.abs(m.add(p,b)),b=m.abs(m.sub(p,b));return Math.min(c.value.real,b.value.real)};m.crossOperator=function(f){var a=f.value[0],
p=f.value[1];f=f.value[2];return m.turnIntoCSList([m.turnIntoCSList([q.zero,q.neg(f),p]),m.turnIntoCSList([f,q.zero,q.neg(a)]),m.turnIntoCSList([q.neg(p),a,q.zero])])};m.cross=function(f,a){var p=q.sub(q.mult(f.value[1],a.value[2]),q.mult(f.value[2],a.value[1])),b=q.sub(q.mult(f.value[2],a.value[0]),q.mult(f.value[0],a.value[2])),c=q.sub(q.mult(f.value[0],a.value[1]),q.mult(f.value[1],a.value[0]));return m.turnIntoCSList([p,b,c])};m.crossratio3harm=function(f,a,p,b,c){var d=m.det3(f,p,c),e=m.det3(a,
b,c);f=m.det3(f,b,c);a=m.det3(a,p,c);d=q.mult(d,e);e=q.mult(f,a);return m.turnIntoCSList([d,e])};m.crossratio3=function(f,a,p,b,c){f=m.crossratio3harm(f,a,p,b,c);return q.div(f.value[0],f.value[1])};m.veronese=function(f){var a=q.mult(f.value[0],f.value[0]),p=q.mult(f.value[1],f.value[1]),b=q.mult(f.value[2],f.value[2]),c=q.mult(f.value[0],f.value[1]),d=q.mult(f.value[0],f.value[2]);f=q.mult(f.value[1],f.value[2]);return m.turnIntoSCList([a,p,b,c,d,f])};m.matrixFromVeronese=function(f){var a=f.value[0],
p=f.value[1],b=f.value[2],c=q.realmult(.5,f.value[3]),d=q.realmult(.5,f.value[4]);f=q.realmult(.5,f.value[5]);return m.turnIntoCSList([m.turnIntoCSList([a,c,d]),m.turnIntoCSList([c,p,f]),m.turnIntoCSList([d,f,b])])};m.det2=function(f,a){var p=q.mult(f.value[0],a.value[1]);return p=q.sub(p,q.mult(f.value[1],a.value[0]))};m.det3=function(f,a,p){return q.complex(f.value[0].value.real*a.value[1].value.real*p.value[2].value.real-f.value[0].value.imag*a.value[1].value.imag*p.value[2].value.real-f.value[0].value.imag*
a.value[1].value.real*p.value[2].value.imag-f.value[0].value.real*a.value[1].value.imag*p.value[2].value.imag+f.value[2].value.real*a.value[0].value.real*p.value[1].value.real-f.value[2].value.imag*a.value[0].value.imag*p.value[1].value.real-f.value[2].value.imag*a.value[0].value.real*p.value[1].value.imag-f.value[2].value.real*a.value[0].value.imag*p.value[1].value.imag+f.value[1].value.real*a.value[2].value.real*p.value[0].value.real-f.value[1].value.imag*a.value[2].value.imag*p.value[0].value.real-
f.value[1].value.imag*a.value[2].value.real*p.value[0].value.imag-f.value[1].value.real*a.value[2].value.imag*p.value[0].value.imag-f.value[0].value.real*a.value[2].value.real*p.value[1].value.real+f.value[0].value.imag*a.value[2].value.imag*p.value[1].value.real+f.value[0].value.imag*a.value[2].value.real*p.value[1].value.imag+f.value[0].value.real*a.value[2].value.imag*p.value[1].value.imag-f.value[2].value.real*a.value[1].value.real*p.value[0].value.real+f.value[2].value.imag*a.value[1].value.imag*
p.value[0].value.real+f.value[2].value.imag*a.value[1].value.real*p.value[0].value.imag+f.value[2].value.real*a.value[1].value.imag*p.value[0].value.imag-f.value[1].value.real*a.value[0].value.real*p.value[2].value.real+f.value[1].value.imag*a.value[0].value.imag*p.value[2].value.real+f.value[1].value.imag*a.value[0].value.real*p.value[2].value.imag+f.value[1].value.real*a.value[0].value.imag*p.value[2].value.imag,-f.value[0].value.imag*a.value[1].value.imag*p.value[2].value.imag+f.value[0].value.imag*
a.value[1].value.real*p.value[2].value.real+f.value[0].value.real*a.value[1].value.real*p.value[2].value.imag+f.value[0].value.real*a.value[1].value.imag*p.value[2].value.real-f.value[2].value.imag*a.value[0].value.imag*p.value[1].value.imag+f.value[2].value.imag*a.value[0].value.real*p.value[1].value.real+f.value[2].value.real*a.value[0].value.real*p.value[1].value.imag+f.value[2].value.real*a.value[0].value.imag*p.value[1].value.real-f.value[1].value.imag*a.value[2].value.imag*p.value[0].value.imag+
f.value[1].value.imag*a.value[2].value.real*p.value[0].value.real+f.value[1].value.real*a.value[2].value.real*p.value[0].value.imag+f.value[1].value.real*a.value[2].value.imag*p.value[0].value.real+f.value[0].value.imag*a.value[2].value.imag*p.value[1].value.imag-f.value[0].value.imag*a.value[2].value.real*p.value[1].value.real-f.value[0].value.real*a.value[2].value.real*p.value[1].value.imag-f.value[0].value.real*a.value[2].value.imag*p.value[1].value.real+f.value[2].value.imag*a.value[1].value.imag*
p.value[0].value.imag-f.value[2].value.imag*a.value[1].value.real*p.value[0].value.real-f.value[2].value.real*a.value[1].value.real*p.value[0].value.imag-f.value[2].value.real*a.value[1].value.imag*p.value[0].value.real+f.value[1].value.imag*a.value[0].value.imag*p.value[2].value.imag-f.value[1].value.imag*a.value[0].value.real*p.value[2].value.real-f.value[1].value.real*a.value[0].value.real*p.value[2].value.imag-f.value[1].value.real*a.value[0].value.imag*p.value[2].value.real)};m.det4m=function(f){var a=
f.value,p=a[0].value,b=p[0].value,c=+b.real,d=+b.imag,b=p[1].value,e=+b.real,g=+b.imag,b=p[2].value,h=+b.real,m=+b.imag,b=p[3].value,k=+b.real,l=+b.imag,p=a[1].value,b=p[0].value,n=+b.real,r=+b.imag,b=p[1].value,t=+b.real,u=+b.imag,b=p[2].value,v=+b.real,w=+b.imag,b=p[3].value,p=+b.real,b=+b.imag;f=c*t-d*u-e*n+g*r;var x=c*u+d*t-e*r-g*n,y=c*v-d*w-h*n+m*r,z=c*w+d*v-h*r-m*n,A=c*p-d*b-k*n+l*r,B=c*b+d*p-k*r-l*n,D=e*v-g*w-h*t+m*u,C=e*w+g*v-h*u-m*t,E=e*p-g*b-k*t+l*u,F=e*b+g*p-k*u-l*t,G=h*p-m*b-k*v+l*w,J=
h*b+m*p-k*w-l*v,p=a[2].value,b=p[0].value,c=+b.real,d=+b.imag,b=p[1].value,e=+b.real,g=+b.imag,b=p[2].value,h=+b.real,m=+b.imag,b=p[3].value,k=+b.real,l=+b.imag,p=a[3].value,b=p[0].value,n=+b.real,r=+b.imag,b=p[1].value,t=+b.real,u=+b.imag,b=p[2].value,v=+b.real,w=+b.imag,b=p[3].value,p=+b.real,b=+b.imag,a=c*t-d*u-e*n+g*r,H=c*u+d*t-e*r-g*n,I=c*v-d*w-h*n+m*r,L=c*w+d*v-h*r-m*n,K=c*p-d*b-k*n+l*r,c=c*b+d*p-k*r-l*n,d=e*v-g*w-h*t+m*u,n=e*w+g*v-h*u-m*t,r=e*p-g*b-k*t+l*u,e=e*b+g*p-k*u-l*t,g=h*p-m*b-k*v+l*
w,h=h*b+m*p-k*w-l*v;return q.complex(f*g-x*h-y*r+z*e+A*d-B*n+D*K-C*c-E*I+F*L+G*a-J*H,f*h+x*g-y*e-z*r+A*n+B*d+D*c+C*K-E*L-F*I+G*H+J*a)};m.eucangle=function(f,a){var p=m.cross(f,m.linfty),b=m.cross(a,m.linfty),c=m.det3(m.ez,p,m.ii),p=m.det3(m.ez,p,m.jj),d=m.det3(m.ez,b,m.ii),b=m.det3(m.ez,b,m.jj),c=q.div(q.mult(c,b),q.mult(d,p)),c=q.log(c);return c=q.mult(c,q.complex(0,.5))};m.zerovector=function(f){f=Math.floor(f.value.real);for(var a=Array(f),p=0;p<f;p++)a[p]=0;return m.realVector(a)};m.zeromatrix=
function(f,a){for(var p=Math.floor(f.value.real),b=Array(p),c=0;c<p;c++)b[c]=m.zerovector(a);return m.turnIntoCSList(b)};m.vandermonde=function(f){for(var a=f.value.length,p=m.zeromatrix(a,a),b=0;b<a;b++)for(var c=0;c<a;c++)p.value[b].value[c]=q.pow(f.value[b],q.real(c-1));return p};m.transpose=function(f){for(var a=[],p=f.value[0].value.length,b=f.value.length,c=0;c<p;c++){for(var d=[],e=0;e<b;e++)d[e]=f.value[e].value[c];a[c]=m.turnIntoCSList(d)}return m.turnIntoCSList(a)};m.column=function(f,a){for(var p=
[],b=f.value.length,c=Math.floor(a.value.real-1),d=0;d<b;d++)p[d]=f.value[d].value[c];return m.turnIntoCSList(p)};m.row=function(f,a){for(var p=[],b=f.value[0].value.length,c=Math.floor(a.value.real-1),d=0;d<b;d++)p[d]=f.value[c].value[d];return m.turnIntoCSList(p)};m.adjoint2=function(f){var a=f.value[0].value[0],p=f.value[1].value[0],b=Array(2);b[0]=m.turnIntoCSList([f.value[1].value[1],q.neg(f.value[0].value[1])]);b[1]=m.turnIntoCSList([q.neg(p),a]);return b=m.turnIntoCSList(b)};m.adjoint3=function(f){var a,
p,b,c,d,e,g,h,m,k,l,q,n,r,t,u,v;a=f.value[0].value;p=a[0].value;b=p.real;c=p.imag;p=a[1].value;d=p.real;e=p.imag;p=a[2].value;g=p.real;h=p.imag;a=f.value[1].value;p=a[0].value;m=p.real;k=p.imag;p=a[1].value;l=p.real;q=p.imag;p=a[2].value;n=p.real;r=p.imag;a=f.value[2].value;p=a[0].value;f=p.real;t=p.imag;p=a[1].value;u=p.real;v=p.imag;p=a[2].value;a=p.real;p=p.imag;return{ctype:"list",value:[{ctype:"list",value:[{ctype:"number",value:{real:l*a-n*u-q*p+r*v,imag:l*p-n*v-u*r+a*q}},{ctype:"number",value:{real:-d*
a+g*u+e*p-h*v,imag:-d*p+g*v+u*h-a*e}},{ctype:"number",value:{real:d*n-g*l-e*r+h*q,imag:d*r-g*q-l*h+n*e}}]},{ctype:"list",value:[{ctype:"number",value:{real:-m*a+n*f+k*p-r*t,imag:-m*p+n*t+f*r-a*k}},{ctype:"number",value:{real:b*a-g*f-c*p+h*t,imag:b*p-g*t-f*h+a*c}},{ctype:"number",value:{real:-b*n+g*m+c*r-h*k,imag:-b*r+g*k+m*h-n*c}}]},{ctype:"list",value:[{ctype:"number",value:{real:m*u-l*f-k*v+q*t,imag:m*v-l*t-f*q+u*k}},{ctype:"number",value:{real:-b*u+d*f+c*v-e*t,imag:-b*v+d*t+f*e-u*c}},{ctype:"number",
value:{real:b*l-d*m-c*q+e*k,imag:b*q-d*k-m*e+l*c}}]}]}};m.inverse=function(f){var a=f.value.length;if(a!==f.value[0].value.length)return console.log("Inverse works only for square matrices"),x;if(2===a)return m.scaldiv(m.det(f),m.adjoint2(f));if(3===a)return m.scaldiv(m.det(f),m.adjoint3(f));a=m.LUdecomp(f);f=f.value.length;var p=q.real(0),b=q.real(1),c=m.zerovector(q.real(f));c.value[0]=b;for(var d=Array(f),e=0;e<f;e++)d[e]=m._helper.LUsolve(a,c),c.value[e]=p,c.value[e+1]=b;d=m.turnIntoCSList(d);
return d=m.transpose(d)};m.linearsolve=function(f,a){return 2===f.value.length?m.linearsolveCramer2(f,a):3===f.value.length?m.linearsolveCramer3(f,a):m.LUsolve(f,a)};m.getDiag=function(f){if(f.value.length!==f.value[0].value.length)return x;for(var a=Array(f.value.length),p=0;p<f.value.length;p++)a[p]=f.value[p].value[p];return m.turnIntoCSList(a)};m.getSubDiag=function(f){if(f.value.length!==f.value[0].value.length)return x;for(var a=Array(f.value.length-1),p=0;p<f.value.length-1;p++)a[p]=f.value[p+
1].value[p];return m.turnIntoCSList(a)};m.eig2=function(f){var a=q.add(f.value[0].value[0],f.value[1].value[1]);f=m.det2(f.value[0],f.value[1]);var p=q.mult(a,a),b=a=q.mult(a,q.real(.5));f=q.sqrt(q.sub(q.div(p,q.real(4)),f));a=q.add(a,f);b=q.sub(b,f);return m.turnIntoCSList([a,b])};m.eig=function(f,a){var p=a||!0,b=f,c=q.real(b.value.length),d=c.value.real;q.real(0);var b=m._helper.QRIteration(b)[0],b=m.getDiag(b),b=m.sort1(b),c=m.idMatrix(c,c),e=Array(d),e=m.turnIntoCSList(e);if(p){for(var g,h,k,
l=0,n=!1,p=0;p<d;p++)n?h=g.value[l]:(g=b.value[p],g=m.sub(f,m.scalmult(g,c)),g=m.nullSpace(g),h=g.value[0],void 0!==h&&(k=h)),void 0===h&&(h=k),1E-8>m.abs(h).value.real&&0===l&&(h=m._helper.inverseIteration(f,b.value[p])),e.value[p]=m._helper.isAlmostZeroVec(h)?h:m.scaldiv(m.abs(h),h),p<d-1&&((n=1E-6>q.abs(q.sub(b.value[p],b.value[p+1])).value.real)?l++:l=0);e=m.transpose(e)}return m.turnIntoCSList([b,e])};m._helper.isNormalMatrix=function(f){return 1E-10>m.abs(m.sub(f,m.transjugate(f))).value.real};
m._helper.QRIteration=function(f,a){var p,b=f;p=q.real(b.value.length);var c=p.value.real,d=p.value.real;q.real(0);var e=m.idMatrix(p,p),g=m.zeromatrix(p,p),h=m.idMatrix(p,p),k=a?a:2500,l,n,r,t=0,u=Array(d);for(p=0;p<k;p++){e=m._helper.getBlock(b,[d-2,d-1],[d-2,d-1]);l=m.eig2(e);e=l.value[0];l=l.value[1];m.abs(e);m.abs(l);n=b.value[d-1].value[d-1];r=q.abs(q.sub(n,e)).value.real;n=q.abs(q.sub(n,l)).value.real;l=r<n?e:l;e=m.idMatrix(q.real(d),q.real(d));l=m.scalmult(l,e);e=m.QRdecomp(m.sub(b,l));b=
F.mult(e.R,e.Q);b=m.add(b,l);e.Q=m._helper.buildBlockMatrix(e.Q,m.idMatrix(q.real(t),q.real(t)));h=F.mult(h,e.Q);if(1E-48>q.abs2(b.value[b.value.length-1].value[b.value[0].value.length-2]).value.real&&1<d){u[c-t-1]=b.value[d-1].value[d-1];for(p=0;p<d;p++)g.value[d-1].value[p]=b.value[d-1].value[p],g.value[p].value[d-1]=b.value[p].value[d-1];b=m._helper.getBlock(b,[0,d-2],[0,d-2]);t++;d--}if(1===d){g.value[0].value[0]=b.value[0].value[0];break}if(m._helper.isUpperTriangular(b)){for(p=0;p<d;p++)g.value[p].value[p]=
b.value[p].value[p];break}}return[g,h]};m.rank=function(f,a){return m.RRQRdecomp(f,a).rank};m._helper.isAlmostZeroVec=function(f){for(var a=f.value.length,p=0;p<a;p++)if(!q._helper.isAlmostZero(f.value[p]))return!1;return!0};m._helper.isLowerTriangular=function(f){for(var a=f.value.length,p=f.value[0].value.length,b=0;b<a;b++)for(var c=b+1;c<p;c++)if(!q._helper.isAlmostZero(f.value[b].value[c]))return!1;return!0};m._helper.isUpperTriangular=function(f){return m._helper.isLowerTriangular(m.transpose(f))};
m._helper.isAlmostId=function(f){var a=f.value.length,p=q.real(a);if(a!==f.value[0].value.length)return!1;f=m.sub(f,m.idMatrix(p),p);for(p=0;p<a;p++)for(var b=0;b<a;b++)if(1E-16<q.abs(f.value[p].value[b]).value.real)return!1;return!0};m.nullSpace=function(f,a){var p=f.value.length,b=m.RRQRdecomp(m.transjugate(f),a),c=m.transpose(b.Q),b=p-b.rank.value.real,d=Array(b);c.value.reverse();for(var e,g=0;g<b;g++)e=c.value[g],d[g]=m.scaldiv(m.abs(e),e);d=m.turnIntoCSList(d);return 0<d.value.length?d:m.turnIntoCSList([m.zerovector(q.real(p))])};
m._helper.isAlmostDiagonal=function(f){var a=f.value.length;q.real(a);q.real(0);if(a!==f.value[0].value.length)return!1;for(var p=0;p<a;p++)for(var b=0;b<a;b++)if(p!==b&&1E-16<q.abs(f.value[p].value[b]).value.real)return!1;return!0};m._helper.inverseIteration=function(f,a){console.log("warning: code untested");for(var p=f.value.length,b=Array(p),c=0;c<p;c++)b[c]=2*Math.random()-.5;var c=b=m.realVector(b),p=m.idMatrix(q.real(p),q.real(p)),d;d=q.add(a,q.real(.1*Math.random()-.5));for(var e=0;100>e;e++)c=
m.scaldiv(m.abs(b),b),b=m.LUsolve(m.sub(f,m.scalmult(d,p)),JSON.parse(JSON.stringify(c)));return m.scaldiv(m.abs(b),b)};m._helper.toHessenberg=function(f){var a=JSON.parse(JSON.stringify(f)),b=a.value.length,c=q.real(b-1),d=q.real(b);q.real(1);if(m._helper.isUpperTriangular(a))return[m.idMatrix(c,c),f];var e;f=m.idMatrix(d,d);for(var g,d=1;d<b-1;d++)e=m.column(a,q.real(d)),e.value=e.value.splice(d),g=m.abs2(e).value.real,1E-16<g&&(e=m._helper.getHouseHolder(e),f=F.mult(f,e),a=F.mult(F.mult(e,a),e)),
c.value.real--;return[f,a]};m._helper.swapEl=function(f,a,b){var c;"[object Array]"===Object.prototype.toString.call(f)?(c=f[a],f[a]=f[b],f[b]=c):"list"===f.ctype&&(c=f.value[a],f.value[a]=f.value[b],f.value[b]=c)};m.RRQRdecomp=function(f,a){var b=Math.sqrt(q.eps);void 0!==a&&(b=.1*a.value.real);var b=b*b,c,d=f.value.length,e=q.real(d),g=q.real(1),h=m._helper.unitvector(q.real(f.value.length),g),l=m.idMatrix(e,e),k=JSON.parse(JSON.stringify(f)),n=m.transpose(f),r=Array(d);for(c=0;c<d;c++)r[c]=m.abs2(n.value[c]);
r=m.turnIntoCSList(r);n=Array(d);for(c=0;c<d;c++)n[c]=c;c=m.maxIndex(r,q.abs);for(var t=r.value[c],u=0,v=0;1E-16<q.abs2(t).value.real;v++){u++;m._helper.swapColumn(k,v,c);m._helper.swapEl(r,v,c);m._helper.swapEl(n,v,c);c=m._helper.getBlock(k,[v],[v]);c=m.column(c,g);t=m.abs2(c).value.real;1E-8<t&&(c=m._helper.getHouseHolder(c),c=m._helper.buildBlockMatrix(m.idMatrix(q.real(v),q.real(v)),c),l=F.mult(l,m.transjugate(c)),k=F.mult(c,k));for(c=v+1;c<d;c++)r.value[c]=q.sub(r.value[c],q.mult(k.value[v].value[c],
q.conjugate(k.value[v].value[c])));c=m.maxIndex(r,q.abs2,v+1);t=r.value[c];if(v+2===d){q.abs(t).value.real>b&&u++;break}e=q.sub(e,g);h.value=h.value.splice(0,h.value.length-1)}return{Q:l,R:k,P:m.turnIntoCSList(n),rank:q.real(u)}};m._helper.getHouseHolder=function(f){var a=q.real(f.value.length);if(1E-16>m.abs2(f))return m.idMatrix(a,a);var b,c=q.real(1),d=m._helper.unitvector(q.real(f.value.length),c);b=m._helper.QRgetAlpha(f,0);b=m.sub(f,m.scalmult(b,d));b=m.scaldiv(m.abs(b),b);f=q.div(m.sesquilinearproduct(f,
b),m.sesquilinearproduct(b,f));a=m.idMatrix(a,a);return a=m.sub(a,m.scalmult(q.add(c,f),m._helper.transposeMult(b,m.conjugate(b))))};m._helper.reOrderbyPivots=function(f,a){for(var b=f.value.length.length,c=m.transpose(f),b=Array(b),d=0;d<a.length;d++)b[a[d]]=c.value[d];b=m.turnIntoCSList(b);return m.transpose(b)};m.QRdecomp=function(f){var a,b=f.value.length,c=q.real(b);if(m._helper.isUpperTriangular(f))return{Q:m.idMatrix(c,c),R:f};var d=q.real(1),e=m._helper.unitvector(q.real(f.value.length),d),
g,h=m.idMatrix(c,c);f=JSON.parse(JSON.stringify(f));for(var k=0;;k++){a=m._helper.getBlock(f,[k],[k]);a=m.column(a,d);g=m.abs2(a).value.real;1E-8<g&&(a=m._helper.getHouseHolder(a),a=m._helper.buildBlockMatrix(m.idMatrix(q.real(k),q.real(k)),a),h=F.mult(h,m.transjugate(a)),f=F.mult(a,f));if(k+2===b)break;c=q.sub(c,d);e.value=e.value.splice(0,e.value.length-1)}return{Q:h,R:f}};m._helper.swapColumn=function(f,a,b){for(var c,d=0;d<f.value.length;d++)c=f.value[d].value[a],f.value[d].value[a]=f.value[d].value[b],
f.value[d].value[b]=c};m._helper.buildBlockMatrix=function(f,a){if(0===f.value.length)return a;if(0===a.value.length)return f;for(var b=f.value.length,c=f.value[0].value.length,d=c+a.value[0].value.length,d=m.zeromatrix(q.real(b+a.value.length),q.real(d)),e=0;e<f.value.length;e++)for(var g=0;g<f.value[0].value.length;g++)d.value[e].value[g]=f.value[e].value[g];for(e=0;e<a.value.length;e++)for(g=0;g<a.value[0].value.length;g++)d.value[b+e].value[c+g]=a.value[e].value[g];return d};m._helper.getBlock=
function(f,a,b){f=JSON.parse(JSON.stringify(f));var c=a[0],d=b[0];a=void 0===a[1]?f.value.length:a[1];b=void 0===b[1]?f.value[0].value.length:b[1];a++;b++;f.value=f.value.slice(c,a);for(c=0;c<f.value.length;c++)f.value[c].value=f.value[c].value.slice(d,b);return f};m._helper.setBlock=function(f,a,b){f=JSON.parse(JSON.stringify(f));var c=b[0];b=b[1];for(var d=a.value.length,e=a.value[0].value.length,g=0;g<d;g++)for(var h=0;h<e;h++)f.value[c+g].value[b+h]=a.value[g].value[h];return f};m._helper.transposeMult=
function(f,a){if(f.value.length!==a.value.length)return x;for(var b=f.value.length,c=Array(b),d=0;d<b;d++)c[d]=m.scalmult(f.value[d],a);return m.turnIntoCSList(c)};m._helper.QRgetAlpha=function(f,a){return 0>f.value[a].value.real?m.abs(f):q.neg(m.abs(f))};m.LUdecomp=function(f){f=JSON.parse(JSON.stringify(f));var a,b,c,d,e,g=0,h,m=f.value.length,k=m-1,l=Array(m);for(c=0;c<m;++c){e=c;d=f.value[c];h=q.abs(d.value[c]).value.real;for(b=c+1;b<m;++b)a=q.abs(f.value[b].value[c]),h<a.value.real&&(h=a.value.real,
e=b);h<q.eps&&console.log("Warning: singular matrix!");l[c]=e;e!==c&&(f.value[c]=f.value[e],f.value[e]=d,d=f.value[c],g++);b=d.value[c];for(a=c+1;a<m;++a)f.value[a].value[c]=q.div(f.value[a].value[c],b);for(a=c+1;a<m;++a){e=f.value[a];for(b=c+1;b<k;++b)e.value[b]=q.sub(e.value[b],q.mult(e.value[c],d.value[b])),++b,e.value[b]=q.sub(e.value[b],q.mult(e.value[c],d.value[b]));b===k&&(e.value[b]=q.sub(e.value[b],q.mult(e.value[c],d.value[b])))}}return{LU:f,P:l,TransPos:g}};m.LUsolve=function(f,a){var b=
m.LUdecomp(f);return m._helper.LUsolve(b,a)};m._helper.LUsolve=function(f,a){var b=JSON.parse(JSON.stringify(a)),c,d=f.LU,e=d.value.length,g=JSON.parse(JSON.stringify(b)),h=f.P,m;for(c=e-1;-1!==c;--c)g.value[c]=b.value[c];for(c=0;c<e;++c)for(b=h[c],h[c]!==c&&(m=g.value[c],g.value[c]=g.value[b],g.value[b]=m),m=d.value[c],b=0;b<c;++b)g.value[c]=q.sub(g.value[c],q.mult(g.value[b],m.value[b]));for(c=e-1;0<=c;--c){m=d.value[c];for(b=c+1;b<e;++b)g.value[c]=q.sub(g.value[c],q.mult(g.value[b],m.value[b]));
g.value[c]=q.div(g.value[c],m.value[c])}return g};m.linearsolveCramer2=function(f,a){var b=m.column(f,q.real(1)),c=m.column(f,q.real(2)),d=m.det2(b,c);q._helper.isZero(d)&&console.log("A is not regular!");c=m.det2(a,c);c=q.div(c,d);b=m.det2(b,a);b=q.div(b,d);return m.turnIntoCSList([c,b])};m.linearsolveCramer3=function(f,a){var b=m.column(f,q.real(1)),c=m.column(f,q.real(2)),d=m.column(f,q.real(3)),e=m.det3(b,c,d);q._helper.isZero(e)&&console.log("A is not regular!");var g=m.det3(a,c,d),d=m.det3(b,
a,d),b=m.det3(b,c,a),g=m.turnIntoCSList([g,d,b]);return g=m.scaldiv(e,g)};m.linearsolveCGNR=function(f,a){var b=m.transpose(f),c=F.mult(b,f),b=F.mult(b,a);return m.linearsolveCG(c,b)};m.linearsolveCG=function(f,a){var b,c,d,e,g,h;e=a;c=b=m.sub(a,F.mult(f,a));for(var k=Math.ceil(1.2*f.value.length),l=0;l<k;){l++;g=F.mult(f,c);h=d=m.scalproduct(b,b);d=q.div(d,m.scalproduct(c,g));e=m.add(e,F.mult(d,c));b=m.sub(b,F.mult(d,g));if(m.abs(b).value.real<q.eps)break;d=m.scalproduct(b,b);d=q.div(d,h);c=m.add(b,
F.mult(d,c))}l>=k&&console.log("CG did not converge");return e};m.det=function(f){if(1===f.value.length)return f.value[0].value[0];if(2===f.value.length)return m.det2(f.value[0],f.value[1]);if(3===f.value.length)return m.det3(f.value[0],f.value[1],f.value[2]);if(4===f.value.length)return m.det4m(f);var a=f.value.length,b=q.real(1),c,d,e=JSON.parse(JSON.stringify(f)),g,h,k,l;for(f=0;f<a-1;f++){d=f;for(c=f+1;c<a;c++)q.abs(e.value[c].value[f]).value.real>q.abs(e.value[d].value[f]).value.real&&(d=c);
d!==f&&(c=e.value[d],e.value[d]=e.value[f],e.value[f]=c,b=q.neg(b));g=e.value[f];for(c=f+1;c<a;c++){h=e.value[c];k=q.div(h.value[f],g.value[f]);for(d=f+1;d<a-1;d+=2)l=d+1,h.value[d]=q.sub(h.value[d],q.mult(g.value[d],k)),h.value[l]=q.sub(h.value[l],q.mult(g.value[l],k));d!==a&&(h.value[d]=q.sub(h.value[d],q.mult(g.value[d],k)))}if(q._helper.isZero(g.value[f]))return q.real(0);b=q.mult(b,g.value[f])}return q.mult(b,e.value[f].value[f])};m.LUdet=function(f){f=m.LUdecomp(f);for(var a=f.LU,b=a.value.length,
c=a.value[0].value[0],d=1;d<b;d++)c=q.mult(c,a.value[d].value[d]);1===f.TransPos%2&&(c=q.neg(c));return c};m.inversereal=function(f){var a,b,c=[],d=[],e=f.value.length;for(a=0;a<e;a++){var g=[],h=[];for(b=0;b<e;b++)g[b]=f.value[a].value[b].value.real,h[b]=f.value[a].value[b].value.imag;c[a]=g;d[a]=h}a=new numeric.T(c,d);f=a.inv(a);c=[];for(a=0;a<e;a++){d=[];for(b=0;b<e;b++)d[b]=q.complex(f.x[a][b],f.y[a][b]);c[a]=m.turnIntoCSList(d)}return m.turnIntoCSList(c)};m.linearsolvereal=function(f,a){for(var b=
[],c=[],d=f.value.length,e=0;e<d;e++){for(var g=[],h=0;h<d;h++)g[h]=f.value[e].value[h].value.real;b[e]=g;c[e]=a.value[e].value.real}b=numeric.solve(b,c);return m.realVector(b)};m.detreal=function(f){for(var a=[],b=[],c=f.value.length,d=0;d<c;d++){for(var e=[],g=[],h=0;h<c;h++)e[h]=f.value[d].value[h].value.real,g[h]=f.value[d].value[h].value.imag;a[d]=e;b[d]=g}new numeric.T(a,b);f=numeric.det(a);return q.real(f)};m.getField=function(f,a){var b;if("homog"===a){if(m._helper.isNumberVecN(f,3))return f;
if(m._helper.isNumberVecN(f,2))return m.turnIntoCSList([f.value[0],f.value[1],q.real(1)])}if("xy"===a){if(m._helper.isNumberVecN(f,2))return f;if(m._helper.isNumberVecN(f,3))return m.turnIntoCSList([q.div(f.value[0],f.value[2]),q.div(f.value[1],f.value[2])])}if("x"===a&&m.isNumberVector(f)){b=f.value.length;if(0<b&&3!==b)return f.value[0];if(3===b)return"Point"===f.usage?q.div(f.value[0],f.value[2]):f.value[0]}if("y"===a&&m.isNumberVector(f)){b=f.value.length;if(1<b&&3!==b)return f.value[1];if(3===
b)return"Point"===f.usage?q.div(f.value[1],f.value[2]):f.value[1]}return"z"===a&&m.isNumberVector(f)&&(b=f.value.length,2<b)?f.value[2]:x};var rb={":":20,".":25,"\u00b0":25,_:50,"^":50,"*":100,"/":100,"+":200,"-":200,"!":200,"==":300,"~=":300,"~<":300,"~>":300,"=:=":300,">=":300,"<=":300,"~>=":300,"~<=":300,">":300,"<":300,"<>":300,"&":350,"%":350,"!=":350,"~!=":350,"..":350,"++":370,"--":370,"~~":370,":>":370,"<:":370,"=":400,":=":400,":=_":400,"::=":400,"->":400,",":500,";":500},la={};la["+"]=Ha;
la["-"]=bb;la["*"]=Ob;la["/"]=Pb;la["^"]=Qb;la["\u00b0"]=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"void"===c.ctype?q.mult(b,q.real(Math.PI/180)):x};la[";"]=function(f,a){var b="void"===f[0].ctype,c="void"===f[1].ctype;if(b&&c)return x;if(!b&&c)return I(f[0]);b||c||I(f[0]);return c?x:I(f[1])};la["="]=ka;la[".."]=function(f,a){var b=I(f[0]),c=I(f[1]);return"number"===b.ctype&&"number"===c.ctype?m.sequence(b,c):x};la[":="]=function(f,a){var b="undefined"===f[1].ctype;if("undefined"===
f[0].ctype||b)return x;"function"===f[0].ctype&&(b=f[0].oper,ma[b]={oper:b,body:f[1],arglist:f[0].args});return x};la["=="]=ta;la["!="]=function(f,a){return F.not(ta(f,a))};la["~="]=Na;la["~!="]=function(f,a){return F.not(Na(f,a))};la[">"]=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype&&q._helper.isAlmostReal(b)&&q._helper.isAlmostReal(c)?{ctype:"boolean",value:b.value.real>c.value.real}:"string"===b.ctype&&"string"===c.ctype?{ctype:"boolean",value:b.value>c.value}:
x};la["<"]=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype&&q._helper.isAlmostReal(b)&&q._helper.isAlmostReal(c)?{ctype:"boolean",value:b.value.real<c.value.real}:"string"===b.ctype&&"string"===c.ctype?{ctype:"boolean",value:b.value<c.value}:x};la[">="]=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype&&q._helper.isAlmostReal(b)&&q._helper.isAlmostReal(c)?{ctype:"boolean",value:b.value.real>=c.value.real}:"string"===b.ctype&&"string"===
c.ctype?{ctype:"boolean",value:b.value>=c.value}:x};la["<="]=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype&&q._helper.isAlmostReal(b)&&q._helper.isAlmostReal(c)?{ctype:"boolean",value:b.value.real<=c.value.real}:"string"===b.ctype&&"string"===c.ctype?{ctype:"boolean",value:b.value<=c.value}:x};la["~>"]=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype&&q._helper.isAlmostReal(b)&&q._helper.isAlmostReal(c)?{ctype:"boolean",value:b.value.real>
c.value.real+q.eps}:x};la["~<"]=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype&&q._helper.isAlmostReal(b)&&q._helper.isAlmostReal(c)?{ctype:"boolean",value:b.value.real<c.value.real-q.eps}:x};la["~>="]=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype&&q._helper.isAlmostReal(b)&&q._helper.isAlmostReal(c)?{ctype:"boolean",value:b.value.real>c.value.real-q.eps}:x};la["~<="]=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&
"number"===c.ctype&&q._helper.isAlmostReal(b)&&q._helper.isAlmostReal(c)?{ctype:"boolean",value:b.value.real<c.value.real+q.eps}:x};la["&"]=Sa;la["%"]=ab;la["!"]=function(f,a){var b=N(f[0]),c=N(f[1]);return"void"===b.ctype&&"boolean"===c.ctype?{ctype:"boolean",value:!c.value}:x};la._=Xb;la["++"]=Yb;la["~~"]=Zb;la["--"]=$b;la[":>"]=ac;la["<:"]=bc;var z={},Q={evaluate:function(f,a,b){if(ma.hasOwnProperty(f))return ma(f,a,b);var c=z[f];if(c)return c(a,b);var d=f.lastIndexOf("$");if(-1!==d&&(d=f.substr(0,
d),c=z[d]))return c(a,b);Da.err("Called undefined function "+d+" (as "+f+")");return x},equals:function(f,a){return"number"===f.ctype&&"number"===a.ctype?{ctype:"boolean",value:f.value.real===a.value.real&&f.value.imag===a.value.imag}:"string"===f.ctype&&"string"===a.ctype||"boolean"===f.ctype&&"boolean"===a.ctype?{ctype:"boolean",value:f.value===a.value}:"list"===f.ctype&&"list"===a.ctype?m.equals(f,a):{ctype:"boolean",value:!1}}},F={_helper:{},order:{undefined:0,boolean:1,number:2,term:3,atomic:4,
variable:5,geo:6,string:7,list:8},string:function(f){return{ctype:"string",value:f}},bool:function(f){return{ctype:"boolean",value:f}},not:function(f){return F.bool(!f.value)},isLessThan:function(f,a){return-1===F.compare(f,a)},isEqual:function(f,a){return 0===F.compare(f,a)},compareResults:function(f,a){return F.compare(f.result,a.result)},compare:function(f,a){if(f.ctype!==a.ctype)return F.order[f.ctype]-F.order[a.ctype];if("number"===f.ctype)return q._helper.compare(f,a);if("list"===f.ctype)return m._helper.compare(f,
a);if("string"===f.ctype)return f.value===a.value?0:f.value<a.value?-1:1;if("boolean"===f.ctype)return f.value===a.value?0:!1===f.value?-1:1},add:function(f,a){return"void"===f.ctype&&"number"===a.ctype?a:"number"===f.ctype&&"number"===a.ctype?q.add(f,a):"string"===f.ctype||"string"===a.ctype?{ctype:"string",value:ia(f)+ia(a)}:"list"===f.ctype&&"list"===a.ctype?m.add(f,a):x},sub:function(f,a){return"void"===f.ctype&&"number"===a.ctype?q.neg(a):"void"===f.ctype&&"list"===a.ctype?m.neg(a):"number"===
f.ctype&&"number"===a.ctype?q.sub(f,a):"list"===f.ctype&&"list"===a.ctype?m.sub(f,a):x},mult:function(f,a){return"number"===f.ctype&&"number"===a.ctype?q.mult(f,a):"number"===f.ctype&&"list"===a.ctype?m.scalmult(f,a):"list"===f.ctype&&"number"===a.ctype?m.scalmult(a,f):"list"===f.ctype&&"list"===a.ctype?m.mult(f,a):x},div:function(f,a){return"number"===f.ctype&&"number"===a.ctype?q.div(f,a):"list"===f.ctype&&"number"===a.ctype?m.scaldiv(a,f):x},max:function(f,a){return"number"===f.ctype&&"number"===
a.ctype?q.max(f,a):"list"===f.ctype&&"list"===a.ctype?m.max(f,a):x},min:function(f,a){return"number"===f.ctype&&"number"===a.ctype?q.min(f,a):"list"===f.ctype&&"list"===a.ctype?m.min(f,a):x},wrap:function(f){if("number"===typeof f)return q.real(f);if("object"===typeof f&&void 0!==f.length){for(var a=[],b=0;b<f.length;b++)a[b]=F.wrap(f[b]);return m.turnIntoCSList(a)}return"string"===typeof f?{ctype:"string",value:f}:"boolean"===typeof f?{ctype:"boolean",value:f}:x},withUsage:function(f,a){return{ctype:f.ctype,
value:f.value,usage:a}}};z.timestamp$0=function(f,a){return{ctype:"number",value:{real:(new Date).getTime(),imag:0}}};z.seconds$0=function(f,a){return{ctype:"number",value:{real:(new Date).getTime()/1E3,imag:0}}};z.clearconsole$0=function(f,a){Da.clear()};z.err$1=function(f,a){var b="",c;"variable"===f[0].ctype?(b=f[0].name,c=da.getvar(f[0].name)):c=f[0];c=b+" ===> "+ia(I(c));Da.err(c);return x};z.errc$1=function(f,a){var b;"variable"===f[0].ctype?(b=I(da.getvar(f[0].name)),console.log(f[0].name+
" ===> "+ia(b))):(b=I(f[0]),console.log(" ===> "+ia(b)));return x};z.print$1=function(f,a){Da.out(ia(I(f[0])),!0)};z.println$1=function(f,a){Da.out(ia(I(f[0])))};z.dump$1=function(f,a){console.log(JSON.stringify(f[0]));return x};z.repeat$2=function(f,a){return z.repeat$3([f[0],null,f[1]],a)};z.repeat$3=function(f,a){var b=N(f[0]),c="#";null!==f[1]&&"variable"===f[1].ctype&&(c=f[1].name);if("number"!==b.ctype)return x;var b=Math.round(b.value.real),d=1,e=1,g=b+1,h=!1,m=!1,k=!1,l;void 0!==a.start&&
(l=I(a.start),"number"===l.ctype&&(h=!0,e=l.value.real));void 0!==a.step&&(l=I(a.step),"number"===l.ctype&&(k=!0,d=l.value.real));void 0!==a.stop&&(l=I(a.stop),"number"===l.ctype&&(m=!0,g=l.value.real));!h||m||k||(g=d*b+e);h||!m||k||(e=-d*(b-1)+g,g+=d);h||m||!k||(g=d*b+e);h&&m&&!k&&(d=(g-e)/(b-1),g+=d);h&&!m&&k&&(g=d*b+e);!h&&m&&k&&(e=-d*(b-1)+g,g+=d);h&&m&&k&&(g+=d);(e<=g&&0<d||e>=g&&0>d)&&h&&m&&k&&(b=Math.floor((g-e)/d));da.newvar(c);g=x;for(h=0;h<b;h++)da.setvar(c,{ctype:"number",value:{real:h*
d+e,imag:0}}),g=I(f[2]);da.removevar(c);return g};z.while$2=function(f,a){for(var b=f[1],c=f[0],d=I(c),e=x;"list"!==d.ctype&&d.value;)e=I(b),d=I(c);return e};z.apply$2=function(f,a){return z.apply$3([f[0],null,f[1]],a)};z.apply$3=function(f,a){var b=N(f[0]);if("list"!==b.ctype)return x;var c="#";null!==f[1]&&"variable"===f[1].ctype&&(c=f[1].name);var b=b.value,d=[];da.newvar(c);for(var e=0;e<b.length;e++)da.setvar(c,b[e]),d[e]=I(f[2]);da.removevar(c);return{ctype:"list",value:d}};z.forall$2=function(f,
a){return z.forall$3([f[0],null,f[1]],a)};z.forall$3=function(f,a){var b=N(f[0]);if("list"!==b.ctype)return x;var c="#";null!==f[1]&&"variable"===f[1].ctype&&(c=f[1].name);b=b.value;da.newvar(c);for(var d,e=0;e<b.length;e++)da.setvar(c,b[e]),d=I(f[2]);da.removevar(c);return d};z.select$2=function(f,a){return z.select$3([f[0],null,f[1]],a)};z.select$3=function(f,a){var b=N(f[0]);if("list"!==b.ctype)return x;var c="#";null!==f[1]&&"variable"===f[1].ctype&&(c=f[1].name);var b=b.value,d=[];da.newvar(c);
for(var e=0,g=0;g<b.length;g++){da.setvar(c,b[g]);var h=I(f[2]);"boolean"===h.ctype&&!0===h.value&&(d[e]=b[g],e++)}da.removevar(c);return{ctype:"list",value:d}};z.flatten$1=function(f,a){function b(f,a){return-1===a||"list"!==f.ctype?f:[].concat.apply([],f.value.map(function(f){return b(f,a-1)}))}var c=N(f[0]);if("list"!==c.ctype)return c;var d=a.levels;void 0===d?d=1:(d=I(d),d="number"===d.ctype?d.value.real:"string"===d.ctype&&"all"===d.value?-2:1);return{ctype:"list",value:b(c,d)}};z.createvar$1=
function(f,a){"variable"===f[0].ctype&&da.newvar(f[0].name);return x};z.local=function(f,a){for(var b=0;b<f.length;b++)"variable"===f[b].ctype&&da.newvar(f[b].name);return x};z.removevar$1=function(f,a){var b=I(f[0]);"variable"===f[0].ctype&&da.removevar(f[0].name);return b};z.release=function(f,a){if(0===f.length)return x;for(var b=I(f[f.length-1]),c=0;c<f.length;c++)"variable"===f[c].ctype&&da.removevar(f[c].name);return b};z.regional=function(f,a){for(var b=0;b<f.length;b++)if("variable"===f[b].ctype){var c=
f[b].name;da.newvar(c);da.pushVstack(c)}return x};z.genList=function(f,a){for(var b=[],c=0;c<f.length;c++)b[c]=I(f[c]);return{ctype:"list",value:b}};Q.assigntake=function(f,a){var b=f.args[0],c=I(b),d=N(f.args[1]),e=x;if("list"===c.ctype||"string"===c.ctype)d=Math.floor(d.value.real),0>d&&(d=c.value.length+d+1),0<d&&d<=c.value.length&&("list"===c.ctype?(c=c.value.slice(),c[d-1]=I(a),e=m.turnIntoCSList(c)):(c=c.value,c=c.substring(0,d-1)+ia(I(a))+c.substring(d,c.length),e=F.string(c)));ka([b,e])};
Q.assigndot=function(f,a){var b=I(f.obj),c=f.key;"geo"===b.ctype&&c&&Ia.setField(b.value,c,a);return x};Q.assignlist=function(f,a){var b=f.length,c=a.length;c<b&&(b=c);for(c=0;c<b;c++)ka([f[c],a[c]],[])};z.if$2=function(f,a){return z.if$3(f,a)};z.if$3=function(f,a){var b=N(f[0]);if("boolean"===b.ctype){if(!0===b.value)return I(f[1]);if(3===f.length)return I(f[2])}return x};z.and$2=Sa;z.or$2=ab;z.xor$2=function(f,a){var b=N(f[0]),c=N(f[1]);return"boolean"===b.ctype&&"boolean"===c.ctype?{ctype:"boolean",
value:b.value!==c.value}:x};z.not$1=function(f,a){var b=N(f[0]);return"boolean"===b.ctype?{ctype:"boolean",value:!b.value}:x};Q.genericListMathGen=function(f,a,b){z[f+"$1"]=function(f,c){var d=I(f[0]);if("list"!==d.ctype)return x;d=d.value;if(0===d.length)return b;for(var e=d[0],g=1;g<d.length;g++)e=a(e,d[g]);return e};var c=f+"$3";z[f+"$2"]=function(f,a){return z[c]([f[0],null,f[1]])};z[c]=function(f,c){var d=N(f[0]);if("list"!==d.ctype)return x;d=d.value;if(0===d.length)return b;var e="#";null!==
f[1]&&"variable"===f[1].ctype&&(e=f[1].name);da.newvar(e);da.setvar(e,d[0]);for(var g=I(f[2]),h=1;h<d.length;h++){da.setvar(e,d[h]);var m=I(f[2]),g=a(g,m)}da.removevar(e);return g}};Q.genericListMathGen("product",F.mult,q.real(1));Q.genericListMathGen("sum",F.add,q.real(0));Q.genericListMathGen("max",F.max,x);Q.genericListMathGen("min",F.min,x);z.max$2=function(f,a){var b=N(f[0]);if("list"===b.ctype)return z.max$3([b,null,f[1]]);var c=N(f[1]);return z.max$1([m.turnIntoCSList([b,c])])};z.min$2=function(f,
a){var b=N(f[0]);if("list"===b.ctype)return z.min$3([b,null,f[1]]);var c=N(f[1]);return z.min$1([m.turnIntoCSList([b,c])])};z.add$2=Ha;z.sub$2=bb;z.mult$2=Ob;z.div$2=Pb;z.mod$2=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype?q.mod(b,c):x};z.pow$2=Qb;z.exp$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.exp(b):x};z.sin$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.sin(b):x};z.sqrt$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.sqrt(b):
x};Q.laguerre=function(f,a,b){if("list"!==f.ctype)return x;var c=f.value.length-1,d;for(d=0;d<=c;d++)if("number"!==f.value[d].ctype)return x;if("number"!==a.ctype)return x;for(var e=[1,.3141,.5926,.5358,.9793,.2385,.6264,.3383,.2795,.0288],g,h,m,k=1;k<=b;k++){m=q.real(0);h=q.real(0);g=f.value[c];for(d=c-1;0<=d;d--)m=q.add(h,q.mult(m,a)),h=q.add(g,q.mult(h,a)),g=q.add(f.value[d],q.mult(g,a));if(q._helper.isLessThan(q.abs(g),q.real(1E-14)))break;d=q.div(h,g);h=q.mult(d,d);g=q.sub(h,q.div(q.mult(q.real(2),
m),g));m=q.sqrt(q.mult(q.real(c-1),q.sub(q.mult(q.real(c),g),h)));g=q.add(d,m);d=q.sub(d,m);q._helper.isLessThan(q.abs(g),q.abs(d))&&(g=d);d=q._helper.isLessThan(q.real(1E-14),q.abs(g))?q.div(q.real(c),g):q.mult(q.add(q.abs(a),q.real(1)),q.complex(Math.cos(k),Math.sin(k)));if(q._helper.isLessThan(q.abs(d),q.real(1E-14)))break;0===k%20&&(d=q.mult(d,q.real(e[k/20])));a=q.sub(a,d)}return a};z.roots$1=function(f,a){var b=N(f[0]);if("list"===b.ctype){var c;for(c=0;c<b.value.length;c++)if("number"!==b.value[c].ctype)return x;
var d=[],e=b,g=b.value.length-1;for(c=0;c<g;c++){d[c]=Q.laguerre(b,q.zero,200);d[c]=Q.laguerre(e,d[c],1);var h=[];h[g-c]=b.value[g-c];for(var k=g-c;0<k;k--)h[k-1]=q.add(b.value[k-1],q.mult(h[k],d[c]));h.shift();b=m.turnIntoCSList(h)}return m.sort1(m.turnIntoCSList(d))}return x};z.autodiff$3=function(f,a){var b="x",c;if("function"===f[0].ctype)c=ma[f[0].oper].body,b=f[0].args[0].name;else if("function"===typeof f[0].impl)c=f[0];else return console.log("could not parse function"),x;var d=N(f[1]),e=
N(f[2]);if(1>e.value.real)return console.log("grade cant be < 1"),x;e=q.add(e,q.real(1));return ga.autodiff(c,b,d,e)};z.cos$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.cos(b):x};z.tan$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.tan(b):x};z.arccos$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.arccos(b):x};z.arcsin$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.arcsin(b):x};z.arctan$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.arctan(b):x};
z.arctan2$2=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype?q.arctan2(b,c):x};z.arctan2$1=function(f,a){var b=N(f[0]);return"list"===b.ctype&&2===b.value.length&&(b=b.value,"number"===b[0].ctype&&"number"===b[1].ctype)?z.arctan2$2(b,a):x};z.log$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.log(b):x};Q.recursiveGen=function(f){var a=q[f],b=m[f];z[f+"$1"]=function(f,c){var d=N(f[0]);return"number"===d.ctype?a(d):"list"===d.ctype?b(d):x}};Q.recursiveGen("im");
Q.recursiveGen("re");Q.recursiveGen("conjugate");Q.recursiveGen("round");Q.recursiveGen("ceil");Q.recursiveGen("floor");Q.recursiveGen("abs");z.abs_infix=z.abs$1;z.random$0=function(f,a){return q.real(q._helper.rand())};z.random$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?q.complex(b.value.real*q._helper.rand(),b.value.imag*q._helper.rand()):x};z.seedrandom$1=function(f,a){var b=N(f[0]);"number"===b.ctype&&q._helper.seedrandom(b.value.real);return x};z.randomnormal$0=function(f,a){return q.real(q._helper.randnormal())};
z.randominteger$1=function(f,a){var b=N(f[0]);if("number"===b.ctype){var c=b.value.real|0,b=b.value.imag|0,c=c*q._helper.rand()|0,b=b*q._helper.rand()|0;return q.complex(c,b)}return x};z.randomint$1=z.randominteger$1;z.randombool$0=function(f,a){return.5<q._helper.rand()?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isreal$1=function(f,a){var b=I(f[0]);return"number"===b.ctype&&q._helper.isAlmostReal(b)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isinteger$1=function(f,a){var b=
I(f[0]);return"number"===b.ctype&&q._helper.isAlmostReal(b)&&b.value.real===Math.floor(b.value.real)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.iseven$1=function(f,a){var b=I(f[0]);return"number"===b.ctype&&q._helper.isAlmostReal(b)&&b.value.real/2===Math.floor(b.value.real/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isodd$1=function(f,a){var b=I(f[0]);return"number"===b.ctype&&q._helper.isAlmostReal(b)&&(b.value.real-1)/2===Math.floor((b.value.real-1)/2)?{ctype:"boolean",
value:!0}:{ctype:"boolean",value:!1}};z.iscomplex$1=function(f,a){return"number"===I(f[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isstring$1=function(f,a){return"string"===I(f[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.islist$1=function(f,a){return"list"===I(f[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.ismatrix$1=function(f,a){var b=I(f[0]);return-1!==m._helper.colNumb(b)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};
z.iscircle$1=function(f,a){var b=I(f[0]);return"geo"===b.ctype&&"C"===b.value.kind&&"Circle"===b.value.matrix.usage?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isconic$1=function(f,a){var b=I(f[0]);return"geo"===b.ctype&&"C"===b.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isline$1=function(f,a){var b=I(f[0]);return"geo"===b.ctype&&"L"===b.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.ispoint$1=function(f,a){var b=I(f[0]);return"geo"===b.ctype&&
"P"===b.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isgeometric$1=function(f,a){return"geo"===I(f[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isnumbermatrix$1=function(f,a){var b=I(f[0]);return m.isNumberMatrix(b).value?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isnumbervector$1=function(f,a){var b=I(f[0]);return m.isNumberVector(b).value?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.issun$1=function(f,a){var b=I(f[0]);return"geo"===
b.ctype&&void 0!==b.value.behavior&&"Sun"===b.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.ismass$1=function(f,a){var b=I(f[0]);return"geo"===b.ctype&&void 0!==b.value.behavior&&"Mass"===b.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isspring$1=function(f,a){var b=I(f[0]);return"geo"===b.ctype&&void 0!==b.value.behavior&&"Spring"===b.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isbouncer$1=function(f,a){var b=
I(f[0]);return"geo"===b.ctype&&void 0!==b.value.behavior&&"Bouncer"===b.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.isundefined$1=function(f,a){return"undefined"===I(f[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};z.matrixrowcolumn$1=function(f,a){var b=I(f[0]);return-1!==m._helper.colNumb(b)?m.realVector([b.value.length,b.value[0].value.length]):x};z.rowmatrix$1=function(f,a){var b=I(f[0]);return"list"===b.ctype?m.turnIntoCSList([b]):x};z.columnmatrix$1=
function(f,a){var b=I(f[0]);return"list"===b.ctype?m.turnIntoCSList(b.value.map(function(f){return m.turnIntoCSList([f])})):x};z.submatrix$3=function(f,a){var b=I(f[0]),c=I(f[1]),d=I(f[2]);if("list"===b.ctype&&"number"===c.ctype&&"number"===d.ctype){var e=Math.round(c.value.real),c=Math.round(d.value.real),b=b.value.slice();0<c&&c<=b.length&&b.splice(c-1,1);var g=!0,b=b.map(function(f){if("list"!==f.ctype)g=!1;else return f=f.value.slice(),0<e&&e<=f.length&&f.splice(e-1,1),m.turnIntoCSList(f)});return g?
m.turnIntoCSList(b):x}return x};z.complex$1=function(f,a){var b,c,d;d=N(f[0]);if("list"===d.ctype&&m.isNumberVector(d)){if(2===d.value.length)return b=d.value[0],c=d.value[1],q.complex(b.value.real-c.value.imag,c.value.real+b.value.imag);if(3===d.value.length)return b=d.value[0],c=d.value[1],d=d.value[2],b=q.div(b,d),c=q.div(c,d),q.complex(b.value.real-c.value.imag,c.value.real+b.value.imag)}return x};z.gauss$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?m.realVector([b.value.real,b.value.imag]):
x};z.cross$2=function(f,a){var b=fa(f[0]),c=fa(f[1]);if(b!==x&&c!==x){var d=m.cross(b,c);"Point"===b.usage&&"Point"===c.usage&&(d=F.withUsage(d,"Line"));"Line"===b.usage&&"Line"===c.usage&&(d=F.withUsage(d,"Point"));return d}return x};z.crossratio$4=function(f,a){var b=I(f[0]),c=I(f[1]),d=I(f[2]),e=I(f[3]),g=fa(b),h=fa(c),k=fa(d),l=fa(e);return g!==x&&h!==x&&k!==x&&l!==x?m.crossratio3(g,h,k,l,m.ii):"number"===b.ctype&&"number"===c.ctype&&"number"===d.ctype&&"number"===e.ctype?q.div(q.mult(q.sub(b,
d),q.sub(c,e)),q.mult(q.sub(b,e),q.sub(c,d))):x};z.para$2=function(f,a){var b=N(f[0]),c=N(f[1]),d=fa(b),e=fa(c);if(b!==x&&c!==x){var c=c.usage,g=d,h=e;if("Line"===b.usage||"Point"===c)g=e,h=d;b=m.cross(m.cross(m.linfty,h),g);return F.withUsage(b,"Line")}return x};z.perp$2=function(f,a){var b=N(f[0]),c=N(f[1]),d=fa(b),e=fa(c);if(b!==x&&c!==x){var g=c.usage||e.usage,c=d,h=e;if("Line"===(b.usage||d.usage)||"Point"===g)c=e,h=d;b=m.turnIntoCSList([h.value[0],h.value[1],q.zero]);b=m.cross(b,c);return F.withUsage(b,
"Line")}return x};z.perp$1=function(f,a){var b=N(f[0]);return m._helper.isNumberVecN(b,2)?m.turnIntoCSList([q.neg(b.value[1]),b.value[0]]):x};z.parallel$2=z.para$2;z.perpendicular$2=z.perp$2;z.perpendicular$1=z.perp$1;z.meet$2=function(f,a){var b=fa(f[0]),c=fa(f[1]);return b!==x&&c!==x?(b=m.cross(b,c),F.withUsage(b,"Point")):x};z.join$2=function(f,a){var b=fa(f[0]),c=fa(f[1]);return b!==x&&c!==x?(b=m.cross(b,c),F.withUsage(b,"Line")):x};z.dist$2=function(f,a){var b=N(f[0]),c=N(f[1]),b=bb([b,c],[]);
return z.abs$1([b],[])};z.dist_infix=z.dist$2;z.point$1=function(f,a){var b=I(f[0]);return m._helper.isNumberVecN(b,3)||m._helper.isNumberVecN(b,2)?F.withUsage(b,"Point"):b};z.line$1=function(f,a){var b=I(f[0]);return m._helper.isNumberVecN(b,3)?F.withUsage(b,"Line"):b};z.det$3=function(f,a){var b=fa(f[0]),c=fa(f[1]),d=fa(f[2]);if(b!==x&&c!==x&&d!==x)return m.det3(b,c,d)};z.det$1=function(f,a){var b=N(f[0]);if("list"===b.ctype){var c=m._helper.colNumb(b);if(-1!==c&&c===b.value.length)return m.det(b)}return x};
z.eig$1=function(f,a){var b=N(f[0]);if("list"===b.ctype){var c=m._helper.colNumb(b);if(-1!==c&&c===b.value.length)return m.eig(b)}return x};z.eigenvalues$1=function(f,a){var b=N(f[0]);if("list"===b.ctype){var c=m._helper.colNumb(b);if(-1!==c&&c===b.value.length)return m.eig(b,!1).value[0]}return x};z.rank$1=function(f,a){var b=N(f[0]);if("list"===b.ctype){var c=m._helper.colNumb(b);if(-1!==c&&c===b.value.length)return m.rank(b,a.precision)}return x};z.kernel$1=function(f,a){var b=N(f[0]);if("list"===
b.ctype){var c=m._helper.colNumb(b);if(-1!==c&&c===b.value.length)return b=m.nullSpace(b,a.precision),m.transpose(b)}return x};z.eigenvectors$1=function(f,a){var b=N(f[0]);if("list"===b.ctype){var c=m._helper.colNumb(b);if(-1!==c&&c===b.value.length)return m.eig(b).value[1]}return x};z.area$3=function(f,a){var b=fa(f[0]),c=fa(f[1]),d=fa(f[2]);if(b!==x&&c!==x&&d!==x){var e=b.value[2],g=c.value[2],h=d.value[2];if(!q._helper.isAlmostZero(e)&&!q._helper.isAlmostZero(g)&&!q._helper.isAlmostZero(h))return b=
m.scaldiv(e,b),c=m.scaldiv(g,c),d=m.scaldiv(h,d),b=m.det3(b,c,d),q.realmult(.5,b)}return x};z.inverse$1=function(f,a){var b=N(f[0]);if("list"===b.ctype){var c=m._helper.colNumb(b);if(-1!==c&&c===b.value.length)return m.inverse(b)}return x};z.linearsolve$2=function(f,a){var b=N(f[0]),c=N(f[1]);if("list"===b.ctype){var d=m._helper.colNumb(b);if(-1!==d&&d===b.value.length&&m._helper.isNumberVecN(c,d))return m.linearsolve(b,c)}return x};var xc=[[[]],[[0]],[[0,1],[1,0]],[[0,1,2],[0,2,1],[1,0,2],[1,2,0],
[2,0,1],[2,1,0]],[[0,1,2,3],[0,1,3,2],[0,2,1,3],[0,2,3,1],[0,3,1,2],[0,3,2,1],[1,0,2,3],[1,0,3,2],[1,2,0,3],[1,2,3,0],[1,3,0,2],[1,3,2,0],[2,0,1,3],[2,0,3,1],[2,1,0,3],[2,1,3,0],[2,3,0,1],[2,3,1,0],[3,0,1,2],[3,0,2,1],[3,1,0,2],[3,1,2,0],[3,2,0,1],[3,2,1,0]]];z.mincostmatching$1=function(f,a){var b=I(f[0]);if(m.isNumberMatrix(b)){var c=b.value.length,d=m._helper.colNumb(b),e=c<d?d:c,g,h,k=Array(e);for(g=0;g<e;++g)for(k[g]=Array(e),h=0;h<e;++h)k[g][h]=g<c&&h<d?b.value[g].value[h].value.real:0;b=sb(k);
e=Array(c);for(g=0;g<c;++g)h=b[g],e[g]=h<d?q.real(h+1):q.real(0);return m.turnIntoCSList(e)}return x};z.length$1=function(f,a){var b=I(f[0]);return"list"===b.ctype||"string"===b.ctype?q.real(b.value.length):x};z.pairs$1=function(f,a){var b=I(f[0]);return"list"===b.ctype?m.pairs(b):x};z.triples$1=function(f,a){var b=I(f[0]);return"list"===b.ctype?m.triples(b):x};z.cycle$1=function(f,a){var b=I(f[0]);return"list"===b.ctype?m.cycle(b):x};z.consecutive$1=function(f,a){var b=I(f[0]);return"list"===b.ctype?
m.consecutive(b):x};z.reverse$1=function(f,a){var b=I(f[0]);return"list"===b.ctype?m.reverse(b):x};z.directproduct$2=function(f,a){var b=I(f[0]),c=I(f[1]);return"list"===b.ctype&&"list"===c.ctype?m.directproduct(b,c):x};z.concat$2=Yb;z.common$2=Zb;z.remove$2=$b;z.append$2=ac;z.prepend$2=bc;z.contains$2=function(f,a){var b=I(f[0]),c=I(f[1]);return"list"===b.ctype?m.contains(b,c):x};z.sort$2=function(f,a){return z.sort$3([f[0],null,f[1]],a)};z.sort$3=function(f,a){var b=N(f[0]);if("list"!==b.ctype)return x;
var c="#";null!==f[1]&&"variable"===f[1].ctype&&(c=f[1].name);var b=b.value,d=[];da.newvar(c);var e;for(e=0;e<b.length;e++)da.setvar(c,b[e]),d[e]={val:b[e],result:I(f[2])};da.removevar(c);d.sort(F.compareResults);c=[];for(e=0;e<b.length;e++)c[e]=d[e].val;return{ctype:"list",value:c}};z.sort$1=function(f,a){var b=I(f[0]);return"list"===b.ctype?m.sort1(b):x};z.set$1=function(f,a){var b=I(f[0]);return"list"===b.ctype?m.set(b):x};z.combinations$2=function(f,a){function b(f,a){f===g?k.push(m.turnIntoCSList(h.slice())):
a<e&&(h[f]=c.value[a],b(f+1,a+1),b(f,a+1))}var c=I(f[0]),d=I(f[1]),e,g,h,k;if("number"===d.ctype){g=d.value.real|0;if("number"===c.ctype){e=c.value.real|0;e-g<g&&(g=e-g);if(0>g)return q.real(0);if(0===g)return q.real(1);if(1===g)return c;for(var l=d=1,n=1;n<=g;++n)var r=e-g+n|0,t=n|0,u=Ab(r,t)|0,r=r/u|0,t=t/u|0,u=Ab(d,t)|0,d=d/u|0,t=t/u|0,u=Ab(r,l)|0,r=r/u|0,l=l/u|0,d=d*r|0,l=l*t|0;return q.real(d/l)}if("list"===c.ctype){e=c.value.length;if(0>g||g>e)return m.turnIntoCSList([]);if(0===g)return m.turnIntoCSList([m.turnIntoCSList([])]);
if(g===e)return m.turnIntoCSList([c]);k=[];h=Array(g);b(0,0);return m.turnIntoCSList(k)}}return x};z.zeromatrix$2=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===b.ctype&&"number"===c.ctype?m.zeromatrix(b,c):x};z.zerovector$1=function(f,a){var b=N(f[0]);return"number"===b.ctype?m.zerovector(b):x};z.transpose$1=function(f,a){var b=N(f[0]);return"list"===b.ctype&&-1!==m._helper.colNumb(b)?m.transpose(b):x};z.row$2=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===c.ctype&&"list"===b.ctype&&
-1!==m._helper.colNumb(b)?m.row(b,c):x};z.column$2=function(f,a){var b=N(f[0]),c=N(f[1]);return"number"===c.ctype&&"list"===b.ctype&&-1!==m._helper.colNumb(b)?m.column(b,c):x};z.red$1=function(f,a){var b=I(f[0]);return"number"===b.ctype?(b=Math.min(1,Math.max(0,b.value.real)),m.realVector([b,0,0])):x};z.green$1=function(f,a){var b=I(f[0]);return"number"===b.ctype?(b=Math.min(1,Math.max(0,b.value.real)),m.realVector([0,b,0])):x};z.blue$1=function(f,a){var b=I(f[0]);return"number"===b.ctype?(b=Math.min(1,
Math.max(0,b.value.real)),m.realVector([0,0,b])):x};z.gray$1=function(f,a){var b=I(f[0]);return"number"===b.ctype?(b=Math.min(1,Math.max(0,b.value.real)),m.realVector([b,b,b])):x};z.grey$1=z.gray$1;Q.HSVtoRGB=function(f,a,b){var c,d,e,g,h,k;f&&void 0===a&&void 0===b&&(a=f.s,b=f.v,f=f.h);g=Math.floor(6*f);h=6*f-g;f=b*(1-a);k=b*(1-h*a);a=b*(1-(1-h)*a);switch(g%6){case 0:c=b;d=a;e=f;break;case 1:c=k;d=b;e=f;break;case 2:c=f;d=b;e=a;break;case 3:c=f;d=k;e=b;break;case 4:c=a;d=f;e=b;break;case 5:c=b,d=
f,e=k}return m.realVector([c,d,e])};z.hue$1=function(f,a){var b=I(f[0]);return"number"===b.ctype?(b=b.value.real,b-=Math.floor(b),Q.HSVtoRGB(b,1,1)):x};Q.shapeconvert=function(f){var a,b;if("circle"===f.type){a=f.value.value[0];a=F.div(a,a.value[2]);var c=a.value[0].value.real,d=a.value[1].value.real;f=f.value.value[1].value.real;b=[];var e=2*Math.PI/36;for(a=0;36>a;a++)b[a]={X:c+Math.cos(a*e)*f,Y:d+Math.sin(a*e)*f};return[b]}if("polygon"===f.type){c=[];for(a=0;a<f.value.length;a++){d=f.value[a];
b=[];for(e=0;e<d.length;e++)b[e]={X:d[e].X,Y:d[e].Y};c[a]=b}return c}};Q.shapeop=function(a,b,c){a=Q.shapeconvert(a);var d=Q.shapeconvert(b);ClipperLib.JS.ScaleUpPaths(a,1E3);ClipperLib.JS.ScaleUpPaths(d,1E3);b=new ClipperLib.Clipper;b.AddPaths(a,ClipperLib.PolyType.ptSubject,!0);b.AddPaths(d,ClipperLib.PolyType.ptClip,!0);var d=a=ClipperLib.PolyFillType.pftNonZero,e=new ClipperLib.Paths;b.Execute(c,e,a,d);ClipperLib.JS.ScaleDownPaths(e,1E3);return{ctype:"shape",type:"polygon",value:e}};Q.shapecommon=
function(a,b){return Q.shapeop(a,b,ClipperLib.ClipType.ctIntersection)};Q.shaperemove=function(a,b){return Q.shapeop(a,b,ClipperLib.ClipType.ctDifference)};Q.shapeconcat=function(a,b){return Q.shapeop(a,b,ClipperLib.ClipType.ctUnion)};z.key$0=function(a,b){return{ctype:"string",value:Tb}};z.keycode$0=function(a,b){return q.real(Ub)};z.mouse$0=function(a,b){return m.realVector([eb[0],eb[1]])};z.mover$0=function(a,b){if(wa&&wa.mover)return{ctype:"geo",value:wa.mover,type:"P"};console.log("Not moving anything at the moment");
return x};z.translate$1=function(a,b){var c=N(a[0]);"list"===c.ctype&&m.isNumberVector(c)&&2===c.value.length&&D.translate(c.value[0].value.real,c.value[1].value.real);return x};z.rotate$1=function(a,b){var c=N(a[0]);"number"===c.ctype&&D.rotate(c.value.real);return x};z.scale$1=function(a,b){var c=N(a[0]);"number"===c.ctype&&D.scale(c.value.real);return x};z.greset$0=function(a,b){var c=Ra.stack.length;D.greset();for(var d=0;d<c;d++)L.restore();return x};z.gsave$0=function(a,b){D.gsave();L.save();
return x};z.grestore$0=function(a,b){D.grestore();L.restore();return x};z.color$1=function(a,b){var c=N(a[0]);"list"===c.ctype&&m.isNumberVector(c).value&&D.setcolor(c);return x};z.linecolor$1=function(a,b){var c=N(a[0]);"list"===c.ctype&&m.isNumberVector(c).value&&D.setlinecolor(c);return x};z.pointcolor$1=function(a,b){var c=N(a[0]);"list"===c.ctype&&m.isNumberVector(c).value&&D.setpointcolor(c);return x};z.alpha$1=function(a,b){var c=N(a[0]);"number"===c.ctype&&D.setalpha(c);return x};z.pointsize$1=
function(a,b){var c=N(a[0]);"number"===c.ctype&&D.setpointsize(c);return x};z.linesize$1=function(a,b){var c=N(a[0]);"number"===c.ctype&&D.setlinesize(c);return x};z.textsize$1=function(a,b){var c=N(a[0]);"number"===c.ctype&&D.settextsize(c);return x};z.playanimation$0=function(a,b){k();return x};z.pauseanimation$0=function(a,b){M();return x};z.stopanimation$0=function(a,b){K();return x};z.replace$3=function(a,b){var c=I(a[0]),d=I(a[1]),e=I(a[2]);if("string"===c.ctype&&"string"===d.ctype&&"string"===
e.ctype)return c=c.value,c=c.replace(new RegExp(d.value,"g"),e.value),{ctype:"string",value:c}};z.replace$2=function(a,b){function c(a,f,b){var p="";e=d=-1;for(var g=0;g<f.length;g++){var h=f[g][0],m=a.indexOf(h,b);-1!==m&&(-1===d?(p=h,d=m,e=g):m<d&&(p=h,d=m,e=g))}return p}var d,e,g,h=I(a[0]);g=I(a[1]);if("string"===h.ctype&&"list"===g.ctype){for(var h=h.value,m=[],k=0;k<g.value.length;k++){var l=g.value[k];"list"===l.ctype&&2===l.value.length&&"string"===l.value[0].ctype&&"string"===l.value[1].ctype&&
(m[m.length]=[l.value[0].value,l.value[1].value])}d=-1;for(g=c(h,m,0);-1!==d;)h=h.substring(0,d)+m[e][1]+h.substring(d+g.length,h.length),g=d+m[e][1].length,g=c(h,m,g);return{ctype:"string",value:h}}return x};z.substring$3=function(a,b){var c=I(a[0]),d=N(a[1]),e=N(a[2]);return"string"===c.ctype&&"number"===d.ctype&&"number"===e.ctype?{ctype:"string",value:c.value.substring(Math.floor(d.value.real),Math.floor(e.value.real))}:x};z.tokenize$2=function(a,b){var c,d;c=I(a[0]);var e=I(a[1]);if("string"===
c.ctype&&"string"===e.ctype){var g=!0;void 0!==b.autoconvert&&(d=I(b.autoconvert),"boolean"===d.ctype&&(g=d.value));e=c.value.split(e.value);c=[];for(d=0;d<e.length;d++){var h=e[d];if(g){var k=parseFloat(h);isNaN(k)||(h=k)}c[d]={ctype:"string",value:h}}return m.turnIntoCSList(c)}if("string"===c.ctype&&"list"===e.ctype){if(0===e.value.length)return c;c=e.value[0];g=m.turnIntoCSList(g);h=z.tokenize$2([a[0],c],b).value;c=[];for(d=0;d<h.length;d++){g=[];for(k=1;k<e.value.length;k++)g[k-1]=e.value[k];
g=m.turnIntoCSList(g);c[d]=z.tokenize$2([h[d],g],b)}return m.turnIntoCSList(c)}return x};z.indexof$2=function(a,b){var c=I(a[0]),d=I(a[1]);return"string"===c.ctype&&"string"===d.ctype?(c=c.value.indexOf(d.value),q.real(c+1)):x};z.indexof$3=function(a,b){var c=I(a[0]),d=I(a[1]),e=I(a[2]);return"string"===c.ctype&&"string"===d.ctype&&"number"===e.ctype?(c=c.value,d=d.value,e=Math.round(e.value.real),e=c.indexOf(d,e-1),q.real(e+1)):x};z.parse$1=function(a,b){var c=I(a[0]);return"string"===c.ctype?(c=
fb(c.value),c=Ea(c),I(c)):x};z.unicode$1=function(a,b){var c;c=I(a[0]);var d=16;if(b.base){var e=I(b.base);"number"===e.ctype&&(d=e.value.real)}if("string"===c.ctype)c=parseInt(c.value,d);else if("number"===c.ctype)c=c.value.real;else return x;"undefined"!==typeof String.fromCodePoint?c=String.fromCodePoint(c):65535>=c?c=String.fromCharCode(c):(c-=65536,c=String.fromCharCode((c>>10)+55296,(c&1023)+56320));return F.string(c)};z.international$1=function(a,b){return z.international$2([a[0],null],b)};
z.international$2=function(f,b){var c=I(f[0]);if("string"!==c.ctype)return x;var d=(a.translations||{})[a.language||"en"]||{};if(!d.hasOwnProperty(c.value))return c;var e=d[c.value];if("string"===typeof e)return F.string(e);if(null===f[1])return c;var g=I(f[1]),g="number"===g.ctype?g.value.real:0,d=(d._pluralFormFunction||yc)(g);return d<e.length?F.string(e[d]):c};z.currentlanguage$0=function(f,b){return F.string(a.language||"en")};Q.basismap=function(a,b,c,d){var e=m.turnIntoCSList([a,b,c]),e=m.inverse(m.transpose(e));
d=F.mult(e,d);e=m.turnIntoCSList([F.mult(d.value[0],a),F.mult(d.value[1],b),F.mult(d.value[2],c)]);return m.transpose(e)};z.map$8=function(a,b){var c=fa(a[0]),d=fa(a[1]),e=fa(a[2]),g=fa(a[3]),h=fa(a[4]),k=fa(a[5]),l=fa(a[6]),q=fa(a[7]);return h!==x&&k!==x&&l!==x&&q!==x&&c!==x&&d!==x&&e!==x&&g!==x?(h=Q.basismap(h,k,l,q),c=Q.basismap(c,d,e,g),c=F.mult(h,m.inverse(c)),m.normalizeMax(c)):x};z.map$6=function(a,b){var c=fa(a[0]),d=fa(a[1]),e=fa(a[2]),g=m.realVector([0,0,1]),h=m.cross,k=h(h(e,h(g,h(c,d))),
h(d,h(g,h(c,e)))),l=fa(a[3]),q=fa(a[4]),n=fa(a[5]),g=h(h(n,h(g,h(l,q))),h(q,h(g,h(l,n))));return l!==x&&q!==x&&n!==x&&g!==x&&c!==x&&d!==x&&e!==x&&k!==x?(l=Q.basismap(l,q,n,g),c=Q.basismap(c,d,e,k),c=F.mult(l,m.inverse(c)),m.normalizeMax(c)):x};z.map$4=function(a,b){var c=m.ii,d=m.jj,e=fa(a[0]),g=fa(a[1]),h=fa(a[2]),k=fa(a[3]);return h!==x&&k!==x&&e!==x&&g!==x?(h=Q.basismap(h,k,c,d),c=Q.basismap(e,g,c,d),c=F.mult(h,m.inverse(c)),m.normalizeMax(c)):x};z.map$2=function(a,b){var c=m.ii,d=m.jj,e=fa(a[0]),
g=F.add(m.realVector([1,0,0]),e),h=fa(a[1]),k=F.add(m.realVector([1,0,0]),h);return h!==x&&k!==x&&e!==x&&g!==x?(h=Q.basismap(h,k,c,d),c=Q.basismap(e,g,c,d),c=F.mult(h,m.inverse(c)),m.normalizeMax(c)):x};z.pointreflect$1=function(a,b){var c=m.ii,d=m.jj,e=fa(a[0]),g=F.add(m.realVector([1,0,0]),e),h=F.add(m.realVector([-1,0,0]),e);return h!==x&&e!==x&&g!==x?(h=Q.basismap(e,h,c,d),c=Q.basismap(e,g,c,d),c=F.mult(h,m.inverse(c)),m.normalizeMax(c)):x};z.linereflect$1=function(a,b){var c=m.ii,d=m.jj,e=fa(a[0]),
g=m.realVector([Math.random(),Math.random(),Math.random()]),h=m.realVector([Math.random(),Math.random(),Math.random()]),g=m.cross(g,e),h=m.cross(h,e);return e!==x&&g!==x?(e=Q.basismap(g,h,c,d),c=Q.basismap(g,h,d,c),c=F.mult(e,m.inverse(c)),m.normalizeMax(c)):x};Q.extractPointVec=function(a){var b={ok:!1};if("geo"===a.ctype){var c=a.value;if("P"===c.kind)return b.x=Ia.getField(c,"x"),b.y=Ia.getField(c,"y"),b.z=q.real(1),b.ok=!0,b}if("list"!==a.ctype)return b;var d=a.value;if(2===d.length&&(a=d[0],
c=d[1],"number"===a.ctype&&"number"===c.ctype))return b.x=a,b.y=c,b.z=q.real(1),b.ok=!0,b;3===d.length&&(a=d[0],c=d[1],d=d[2],"number"===a.ctype&&"number"===c.ctype&&"number"===d.ctype&&(b.x=q.div(a,d),b.y=q.div(c,d),b.z=q.real(1),b.ok=!0));return b};z.polygon$1=function(a,b){var c=I(a[0]);if("list"===c.ctype){for(var d=[],e=0;e<c.value.length;e++){var g=Q.extractPoint(c.value[e]);if(!g.ok)return x;d[e]={X:g.x,Y:g.y}}return{ctype:"shape",type:"polygon",value:[d]}}return x};z.circle$2=function(a,b){var c=
N(a[0]),d=N(a[1]),c=Q.extractPointVec(c);if(!c.ok||"number"!==d.ctype)return x;c=m.turnIntoCSList([c.x,c.y,c.z]);return{ctype:"shape",type:"circle",value:m.turnIntoCSList([c,d])}};z.screen$0=function(a,b){var c=D.drawingstate.initialmatrix,d=function(a,f){var b=a-c.tx,d=f+c.ty;return{X:(b*c.d-d*c.b)/c.det,Y:-(-b*c.c+d*c.a)/c.det}};return{ctype:"shape",type:"polygon",value:[[d(0,0),d(ya,0),d(ya,ua),d(0,ua)]]}};z.allpoints$0=function(a,b){for(var c=[],e=0;e<d.length;e++)c[e]={ctype:"geo",value:d[e],
type:"P"};return{ctype:"list",value:c}};z.allmasses$0=function(a,b){for(var c=[],d=0;d<ra.length;d++)c[d]={ctype:"geo",value:ra[d],type:"P"};return{ctype:"list",value:c}};z.alllines$0=function(a,b){for(var c=[],d=0;d<e.length;d++)c[d]={ctype:"geo",value:e[d],type:"L"};return{ctype:"list",value:c}};z.halfplane$2=function(a,b){var c=N(a[0]),d=N(a[1]),e=fa(c),g=fa(d);if(c!==x&&d!==x){var h=d.usage,d=g;if("Line"===c.usage||"Point"===h)e=g,d=c;c=m.turnIntoCSList([d.value[0],d.value[1],q.zero]);c=m.cross(c,
e);g=m.cross(d,c);g=F.div(g,g.value[2]);e=F.div(e,e.value[2]);e=m.sub(e,g);c=m.abs(e);e=F.div(e,c);c=g.value[0].value.real;g=g.value[1].value.real;d=1E3*e.value[0].value.real;e=1E3*e.value[1].value.real;return{ctype:"shape",type:"polygon",value:[[{X:c+e/2,Y:g-d/2},{X:c+e/2+d,Y:g-d/2+e},{X:c-e/2+d,Y:g+d/2+e},{X:c-e/2,Y:g+d/2}]]}}return x};z.convexhull3d$1=function(a,b){var c=I(a[0]);if("list"===c.ctype){var d=c.value;if(4>d.length)return console.error("Less than four input points specified"),x;for(var e=
[],g,c=0;c<d.length;c++)if(m._helper.isNumberVecN(d[c],3))for(g=0;3>g;g++)e.push(d[c].value[g].value.real);g=convexhull(e);d=g[0];e=[];for(c=0;c<d.length;c+=3)e.push(m.realVector([d[c],d[c+1],d[c+2]]));for(var d=m.turnIntoCSList(e),e=g[1],h=[],c=0;c<e.length;c++){for(g=0;g<e[c].length;g++)e[c][g]++;h.push(m.realVector(e[c]))}c=m.turnIntoCSList(h);return m.turnIntoCSList([d,c])}return x};z.javascript$1=function(a,b){var c=I(a[0]);"string"===c.ctype&&(new Function(c.value)).call(Ma);return x};z.use$1=
function(f,b){function c(a,f,b){var d=z[a];z[a]=function(c,e){if(c.length===f)return b(c,e);if(d)return d(c,e);throw"No implementation for "+a+"("+f+")";}}var d=I(f[0]);if("string"===d.ctype){var d=d.value,e;a.plugins&&(e=a.plugins[d]);e||(e=Oa._pluginRegistry[d]);if(e)return e({instance:Ma,config:a,nada:x,evaluate:I,evaluateAndVal:N,defineFunction:c,addShutdownHook:cb.push.bind(cb),addAutoCleaningEventListener:P,getVariable:da.getvar.bind(da),getInitialMatrix:function(){return D.drawingstate.initialmatrix},
setTextRenderer:function(a){lc=a}}),{ctype:"boolean",value:!0};console.log("Plugin "+d+" not found");return{ctype:"boolean",value:!1}}return x};z.format$2=function(a,b){function c(a){a=a.toFixed(h);var f;do f=a,a=a.substring(0,a.length-1);while(""!==a&&"-"!==a&&+a===+f);return""+f}function d(a){var f;return"number"===a.ctype?(f=c(a.value.real),a=c(a.value.imag),f="0"===a?f:"-"===a.substring(0,1)?f+" - i*"+a.substring(1):f+" + i*"+a,{ctype:"string",value:f}):"list"===a.ctype?{ctype:"list",value:a.value.map(d)}:
{ctype:"string",value:ia(a).toString()}}var e=N(a[0]),g=N(a[1]),h;return"number"!==e.ctype&&"list"!==e.ctype||"number"!==g.ctype?x:(h=Math.round(g.value.real),d(e))};Date.now||(Date.now=function(){return(new Date).getTime()});var mc=0;z.seconds$0=function(a,b){return{ctype:"number",value:{real:(Date.now()-mc)/1E3,imag:0}}};z.resetclock$0=function(a,b){mc=Date.now();return x};z.time$0=function(a,b){var c=new Date;return m.realVector([c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds()])};
z.date$0=function(a,b){var c=new Date;return m.realVector([c.getFullYear(),c.getMonth(),c.getDay()])};z.setTimeout$2=function(a,b){function c(){I(e);S()}var d=I(a[0]),e=a[1];"number"===d.ctype&&"undefined"!==typeof window&&window.setTimeout(c,1E3*d.value.real);return x};Q.formatForWebGL=function(a){return a.toFixed(10)};z.generateWebGL$2=function(a,b){var c=Q.formatForWebGL,d=a[0],e=I(a[1]);console.log(e);if("list"!==e.ctype)return x;for(var g=[],h=0;h<e.value.length;h++)"string"===e.value[h].ctype&&
g.push(e.value[h].value);console.log("***********");console.log(g);e=Q.plotvars(d);console.log(e);-1===e.indexOf("a")&&-1===e.indexOf("b")&&-1===e.indexOf("c")&&-1===e.indexOf("d")&&-1===e.indexOf("e")&&-1===e.indexOf("f")&&(d=N(d));if("number"===d.ctype)return{ctype:"string",value:"vec2("+c(d.value.real)+","+c(d.value.imag)+")"};if("variable"===d.ctype)return{ctype:"string",value:d.name};if("string"===d.ctype||"void"===d.ctype)return d;if(2===d.args.length&&("infix"===d.ctype||"function"===d.ctype)){c=
z.compileToWebGL$1([d.args[0]],{});e=z.compileToWebGL$1([d.args[1]],{});if("+"===d.oper||"add"===d.oper)return void 0===c.value||"void"===c.ctype?{ctype:"string",value:e.value}:{ctype:"string",value:"addc("+c.value+","+e.value+")"};if("*"===d.oper||"mult"===d.oper)return{ctype:"string",value:"multc("+c.value+","+e.value+")"};if("/"===d.oper||"div"===d.oper)return{ctype:"string",value:"divc("+c.value+","+e.value+")"};if("-"===d.oper||"sub"===d.oper)return void 0===c.value||"void"===c.ctype?{ctype:"string",
value:"negc("+e.value+")"}:{ctype:"string",value:"subc("+c.value+","+e.value+")"};if("^"===d.oper||"pow"===d.oper)return{ctype:"string",value:"powc("+c.value+","+e.value+")"}}if("function"===d.ctype&&1===d.args.length){c=z.compileToWebGL$1([d.args[0]],{});if("sin$1"===d.oper)return{ctype:"string",value:"sinc("+c.value+")"};if("cos$1"===d.oper)return{ctype:"string",value:"cosc("+c.value+")"};if("tan$1"===d.oper)return{ctype:"string",value:"tanc("+c.value+")"};if("exp$1"===d.oper)return{ctype:"string",
value:"expc("+c.value+")"};if("log$1"===d.oper)return{ctype:"string",value:"logc("+c.value+")"};if("arctan$1"===d.oper)return{ctype:"string",value:"arctanc("+c.value+")"};if("arcsin$1"===d.oper)return{ctype:"string",value:"arcsinc("+c.value+")"};if("arccos$1"===d.oper)return{ctype:"string",value:"arccosc("+c.value+")"};if("sqrt$1"===d.oper)return{ctype:"string",value:"sqrtc("+c.value+")"}}return x};z.compileToWebGL$1=function(a,b){var c,d;c=Q.formatForWebGL;var e=a[0];d=Q.plotvars(e);-1===d.indexOf("a")&&
-1===d.indexOf("b")&&-1===d.indexOf("c")&&-1===d.indexOf("d")&&-1===d.indexOf("e")&&-1===d.indexOf("f")&&(e=N(e));if("number"===e.ctype)return{ctype:"string",value:"vec2("+c(e.value.real)+","+c(e.value.imag)+")"};if("variable"===e.ctype)return{ctype:"string",value:e.name};if("string"===e.ctype||"void"===e.ctype)return e;if(2===e.args.length&&("infix"===e.ctype||"function"===e.ctype)){c=z.compileToWebGL$1([e.args[0]],{});d=z.compileToWebGL$1([e.args[1]],{});if("+"===e.oper||"add"===e.oper)return void 0===
c.value||"void"===c.ctype?{ctype:"string",value:d.value}:{ctype:"string",value:"addc("+c.value+","+d.value+")"};if("*"===e.oper||"mult"===e.oper)return{ctype:"string",value:"multc("+c.value+","+d.value+")"};if("/"===e.oper||"div"===e.oper)return{ctype:"string",value:"divc("+c.value+","+d.value+")"};if("-"===e.oper||"sub"===e.oper)return void 0===c.value||"void"===c.ctype?{ctype:"string",value:"negc("+d.value+")"}:{ctype:"string",value:"subc("+c.value+","+d.value+")"};if("^"===e.oper||"pow"===e.oper)return{ctype:"string",
value:"powc("+c.value+","+d.value+")"}}if("function"===e.ctype&&1===e.args.length){c=z.compileToWebGL$1([e.args[0]],{});if("sin$1"===e.oper)return{ctype:"string",value:"sinc("+c.value+")"};if("cos$1"===e.oper)return{ctype:"string",value:"cosc("+c.value+")"};if("tan$1"===e.oper)return{ctype:"string",value:"tanc("+c.value+")"};if("exp$1"===e.oper)return{ctype:"string",value:"expc("+c.value+")"};if("log$1"===e.oper)return{ctype:"string",value:"logc("+c.value+")"};if("arctan$1"===e.oper)return{ctype:"string",
value:"arctanc("+c.value+")"};if("arcsin$1"===e.oper)return{ctype:"string",value:"arcsinc("+c.value+")"};if("arccos$1"===e.oper)return{ctype:"string$1",value:"arccosc("+c.value+")"};if("sqrt$1"===e.oper)return{ctype:"string",value:"sqrtc("+c.value+")"}}return x};z.setsimulationspeed$1=function(a,b){var c=N(a[0]);"number"===c.ctype&&"undefined"!==typeof ca&&"undefined"!==typeof ca.env&&(ca.env.deltat=c.value.real);return x};z.setsimulationaccuracy$1=function(a,b){var c=N(a[0]);"number"===c.ctype&&
"undefined"!==typeof ca&&"undefined"!==typeof ca.env&&(ca.env.accuracy=c.value.real);return x};z.setsimulationquality$1=function(a,b){var c=N(a[0]);"number"===c.ctype&&"undefined"!==typeof ca&&"undefined"!==typeof ca.env&&(c=c.value.real,0===c&&(ca.env.errorbound=.01,ca.env.lowestdeltat=1E-5,ca.env.slowdownfactor=2),1===c&&(ca.env.errorbound=.001,ca.env.lowestdeltat=1E-7,ca.env.slowdownfactor=2),2===c&&(ca.env.errorbound=1E-5,ca.env.lowestdeltat=1E-10,ca.env.slowdownfactor=4),3===c&&(ca.env.errorbound=
1E-6,ca.env.lowestdeltat=1E-12,ca.env.slowdownfactor=4));return x};Q.extractPoint=function(a){var b={ok:!1};if("geo"===a.ctype){var c=a.value;if("P"===c.kind)return b.x=Ia.getField(c,"x").value.real,b.y=Ia.getField(c,"y").value.real,b.ok=!0,b}if("list"!==a.ctype)return b;var d=a.value;if(2===d.length&&(a=d[0],c=d[1],"number"===a.ctype&&"number"===c.ctype))return b.x=a.value.real,b.y=c.value.real,b.ok=!0,b;3===d.length&&(a=d[0],c=d[1],d=d[2],"number"===a.ctype&&"number"===c.ctype&&"number"===d.ctype&&
(a=q.div(a,d),c=q.div(c,d),b.x=a.value.real,b.y=c.value.real,b.ok=!0));return b};z.draw$1=function(a,b){var c=N(a[0]);if("shape"===c.ctype)Q.drawshape(c,b);else if("Line"===c.usage)J.handleModifs(b,J.lineModifs),J.drawline(c);else{var d=Q.extractPoint(c);if(!d.ok){if("undefined"!==typeof c.value&&2===c.value.length)return z.draw$2(c.value,b);return}null!==b&&J.handleModifs(b,J.pointModifs);J.drawpoint(d)}return x};z.draw$2=function(a,b){var c=N(a[0]),d=N(a[1]),c=Q.extractPoint(c),d=Q.extractPoint(d);
if(!c.ok||!d.ok)return x;null!==b&&J.handleModifs(b,J.lineModifs);J.drawsegcore(c,d);return x};z.drawcircle$2=function(a,b){return Q.drawcircle(a,b,"D")};z.fillcircle$2=function(a,b){return Q.drawcircle(a,b,"F")};z.drawarc$3=function(a,b){return Q.drawarc(a,b,"D")};z.fillarc$3=function(a,b){return Q.drawarc(a,b,"F")};Q.drawarc=function(a,b,c){var d=fa(a[0]),e=fa(a[1]);a=fa(a[2]);if(!m._helper.isAlmostReal(m.turnIntoCSList([d,e,a])))return x;var g=m.det3(d,e,a);if(1E-12<Math.abs(g.value.real)){var g=
B._helper.ConicBy5(null,d,e,a,m.ii,m.jj),h=B._helper.CenterOfConic(g),h=m.normalizeMax(h),g=q.real(0),k=m.turnIntoCSList([m.turnIntoCSList([h.value[2],g,q.neg(h.value[0])]),m.turnIntoCSList([g,h.value[2],q.neg(h.value[1])]),m.turnIntoCSList([g,g,h.value[2]])]),g=m.normalizeZ(F.mult(k,d));m.normalizeZ(F.mult(k,e));k=m.normalizeZ(F.mult(k,a));g=-Math.atan2(g.value[1].value.real,g.value[0].value.real);k=-Math.atan2(k.value[1].value.real,k.value[0].value.real);h=m.normalizeZ(h);d=m.normalizeZ(d);e=m.normalizeZ(e);
a=m.normalizeZ(a);var l=m.abs(m.sub(d,h)),n=[h.value[0].value.real,h.value[1].value.real],r=D.drawingstate.matrix,h=n[0]*r.a-n[1]*r.b+r.tx,n=n[0]*r.c-n[1]*r.d-r.ty,d=0<m.det3(d,e,a).value.real;J.handleModifs(b,J.conicModifs);b=1.6;null!==J.size&&(b=J.size);L.save();L.lineWidth=b;L.strokeStyle=J.lineColor;b=l.value.real*r.sdet;L.beginPath();L.translate(h,n);g>k&&(k+=2*Math.PI);d=d?-(2*Math.PI-k+g)/500:(k-g)/500;L.moveTo(b*Math.cos(g),b*Math.sin(g));for(a=0;500>=a;a++)e=g+a*d,L.lineTo(b*Math.cos(e),
b*Math.sin(e));"F"===c&&(L.fillStyle=J.lineColor,L.closePath(),L.fill());"D"===c&&L.stroke();L.restore()}else{if("D"!==c)return x;c=Q.extractPoint(d);k=Q.extractPoint(e);g=Q.extractPoint(a);if(!c.ok||!k.ok||!g.ok)return x;l=(c.x-k.x)*(c.x-k.x)+(c.y-k.y)*(c.y-k.y);r=(c.x-g.x)*(c.x-g.x)+(c.y-g.y)*(c.y-g.y);h=(g.x-k.x)*(g.x-k.x)+(g.y-k.y)*(g.y-k.y);if(1E-12>l||1E-12>r||1E-12>h)return x;d=0>m.crossratio3(d,a,e,m.cross(m.cross(d,e),m.linfty),m.ii).value.real;null!==b&&(null==b.size&&(b.size=q.real(1.6)),
J.handleModifs(b,J.conicModifs));d?J.drawsegcore(c,g):(d=l>h?1:-1,b=d*(c.x-k.x),d*=c.y-k.y,e=Math.sqrt(b*b+d*d),e=25E3/D.drawingstate.matrix.sdet/e,b*=e,d*=e,J.drawsegcore(c,{x:c.x+b,y:c.y+d}),J.drawsegcore(g,{x:g.x-b,y:g.y-d}))}return x};Q.drawcircle=function(a,b,c){var d=N(a[0]);a=N(a[1]);var e=Q.extractPoint(d);if(!e.ok||"number"!==a.ctype)return x;var d=D.drawingstate.matrix,g=e.x*d.a-e.y*d.b+d.tx,e=e.x*d.c-e.y*d.d-d.ty;J.handleModifs(b,J.conicModifs);b=1.6;null!==J.size&&(b=J.size);L.lineWidth=
b;L.beginPath();L.arc(g,e,a.value.real*d.sdet,0,2*Math.PI);"D"===c&&(L.strokeStyle=J.lineColor,L.stroke());"F"===c&&(L.fillStyle=J.lineColor,L.fill());"C"===c&&L.clip();return x};z.drawconic$1=function(a,b){var c={usage:"conic"},d=N(a[0]);if("list"!==d.ctype||3!==d.value.length&&6!==d.value.length)return console.error("could not parse conic"),x;if(6===d.value.length){for(var e=0;6>e;e++)if("number"!==d.value[e].ctype)return console.error("could not parse conic"),x;var g=q.real(.5),e=d.value[0],h=
d.value[2],h=q.mult(h,g),k=d.value[1],l=d.value[3],l=q.mult(l,g),n=d.value[4],n=q.mult(n,g),d=d.value[5],d=m.turnIntoCSList([m.turnIntoCSList([e,h,l]),m.turnIntoCSList([h,k,n]),m.turnIntoCSList([l,n,d])])}else{for(e=0;3>e;e++)for(h=0;3>h;h++)if("number"!==d.value[e].value[h].ctype)return console.error("could not parse conic"),x;m.equals(d,m.transpose(d)).value||(e=F.mult(d,q.real(.5)),d=F.mult(m.transpose(d),q.real(.5)),d=m.add(e,d))}c.matrix=d;return Q.drawconic(c,b)};Q.drawconic=function(a,b){J.handleModifs(b,
J.conicModifs);var c=1.6;null!==J.size&&(c=J.size);if(0!==c){L.lineWidth=c;for(var d=a.matrix,e=a.matrix,g=0;2>g;g++)for(var h=0;2>h;h++)if(1E-14<Math.abs(d.value[g].value[h].value.imag))return;g=m.turnIntoCSList([m.realVector([-1,-1,1]),m.realVector([1,0,0]),m.realVector([0,1,0])]);h=D.from(0,0,1);h[2]=1;var k=D.from(1,0,1);k[2]=1;var l=D.from(0,1,1);l[2]=1;var h=m.turnIntoCSList([m.realVector(h),m.realVector(k),m.realVector(l)]),h=m.transpose(h),g=F.mult(h,g),g=m.inverse(g),d=F.mult(m.transpose(g),
d),d=F.mult(d,g),g=d.value[0].value[0].value.real,h=d.value[1].value[0].value.real,k=d.value[1].value[1].value.real,l=d.value[2].value[0].value.real,q=d.value[2].value[1].value.real,n=d.value[2].value[2].value.real,d=[[g,h,l],[h,k,q],[l,q,n]],r=1E-14>Math.abs(g*k*n-g*q*q-h*h*n+2*h*l*q-k*l*l),t=ya>ua?ya:ua,u=-1.5*t,v=1.5*t,w=-1.5*t,y=1.5*t,A=1;r&&(A=0);if(A)var l=0,l=1E-14<Math.abs(g-h)?Math.atan(h/g-k)/2:Math.PI/4,C=function(a){var f=Math.cos(a);a=Math.sin(a);return[[f,-a,0],[a,f,0],[0,0,1]]}(l),
g=numeric.transpose(C),d=numeric.dot(d,C),d=numeric.dot(g,d),g=d[0][0],h=d[1][0],k=d[1][1],l=d[2][0],q=d[2][1],n=d[2][2];var d=[g,h,k,l,q,n],g=function(){var a=B._helper.splitDegenConic(e);if(a!==x){var f=a[1],a=[a[0]];z.draw$1(a,b);a[0]=f;z.draw$1(a,b)}},E=function(a){"undefined"!==a&&6===a.length||console.error("this does not define a Conic");if(r)return"degenerate";a=a[0]*a[2]-a[1]*a[1];return 1E-14>Math.abs(a)?"parabola":1E-14<a?"ellipsoid":"hyperbola"};E(d);var G=function(a,f){return 0<a&&a<
ya&&0<f&&f<ua},H=[],I=[],K=[],M=[],N=[],O=[],P=function(){H=[];I=[];K=[];M=[];N=[];O=[]},Q=function(a,f){L.strokeStyle=J.lineColor;L.lineWidth=c;L.beginPath();L.moveTo(a[0],f[0]);for(var b=1;b<a.length;b++)L.lineTo(a[b],f[b]);L.stroke()},R=function(a,f,b){var c,d,e=E(a);if(6!==a.length)console.error("Conic needs 6 Parameters");else{var g=a[0],p=a[1],h=a[2],k=a[3],m=a[4];a=a[5];var l;c=b-f;for(var q=.05*c+f,n=b-.05*c,ba=f;ba<=b;ba+=l){l=ba<q||ba>n||100>Math.abs(b-f)?.5:0>ba||ba>ua?10:3;d=-g*h*Math.pow(ba,
2)-2*g*m*ba-g*a+Math.pow(p,2)*Math.pow(ba,2)+2*p*k*ba+Math.pow(k,2);d=Math.sqrt(d);c=1/g*(-p*ba-k+d);d=-1/g*(p*ba+k+d);var r,V;A?(r=[c,ba,1],V=[d,ba,1],r=numeric.dot(C,r),V=numeric.dot(C,V),c=r[0],d=V[0],r=r[1],V=V[1]):V=r=ba;isNaN(c)||"ellipsoid"!==e?!isNaN(c)&&c>=u&&c<=v&&(H.push(c),K.push(r)):(H.push(c),K.push(r));isNaN(d)||"ellipsoid"!==e?!isNaN(d)&&d>=u&&d<=v&&(I.push(d),M.push(V)):(I.push(d),M.push(V))}}},h=function(a){var f,b,c;E(a);if(6!==a.length)console.error("Conic needs 6 Parameters");
else{c=a[0];var d=a[1],e=a[2],g=a[3],p=a[4],h=a[5];f=-c*p+d*g;b=Math.sqrt(c*(-c*e*h+c*Math.pow(p,2)+Math.pow(d,2)*h-2*d*g*p+e*Math.pow(g,2)));e=c*e-Math.pow(d,2);0!==e?(c=(f-b)/e,b=(f+b)/e):b=c=(-c*h+g*g)/(2*c*p-2*d*g);!isNaN(c)&&c>w&&c<y||(c=w);!isNaN(b)&&b>w&&b<y||(b=w);f=c<b?c:b;b=c>b?c:b;R(a,w,f);N=H.concat(I.reverse());O=K.concat(M.reverse());Q(N,O);P();R(a,b,y);Q(H,K);if(G(H[0],K[1])||G(I[0],M[0]))L.beginPath(),L.moveTo(H[0],K[0]),L.lineTo(I[0],M[0]),L.stroke();Q(I,M);P();R(a,f,b);Q(H,K);L.beginPath();
L.moveTo(H[0],K[0]);L.lineTo(I[0],M[0]);L.stroke();L.beginPath();L.moveTo(H[H.length-1],K[K.length-1]);L.lineTo(I[I.length-1],M[M.length-1]);L.stroke();Q(I,M);P()}};r?g():h(d)}};z.drawall$1=function(a,b){var c=I(a[0]);if("list"===c.ctype){J.handleModifs(b,J.pointAndLineModifs);for(var d=0;d<c.value.length;d++)z.draw$1([c.value[d]],null)}return x};z.connect$1=function(a,b){return Q.drawpolygon(a,b,"D",!1)};z.drawpoly$1=function(a,b){return Q.drawpolygon(a,b,"D",!0)};z.fillpoly$1=function(a,b){return Q.drawpolygon(a,
b,"F",!0)};z.drawpolygon$1=function(a,b){return Q.drawpolygon(a,b,"D",!0)};z.fillpolygon$1=function(a,b){return Q.drawpolygon(a,b,"F",!0)};Q.drawpolygon=function(a,b,c,d){function e(){for(var a=k.value,f=0;f<a.length;f++){var b=a[f],c;for(c=0;c<b.length;c++){var d=b[c],g=d.X*h.a-d.Y*h.b+h.tx,d=d.X*h.c-d.Y*h.d-h.ty;0===c?L.moveTo(g,d):L.lineTo(g,d)}L.closePath()}}function g(){var a;for(a=0;a<k.value.length;a++){var f=Q.extractPoint(k.value[a]);if(!f.ok)return;var b=f.x*h.a-f.y*h.b+h.tx,f=f.x*h.c-f.y*
h.d-h.ty;0===a?L.moveTo(b,f):L.lineTo(b,f)}d&&L.closePath()}J.handleModifs(b,J.conicModifs);b=1.6;null!==J.size&&(b=J.size);L.lineWidth=b;L.mozFillRule="evenodd";L.lineJoin="round";var h=D.drawingstate.matrix,k=I(a[0]);L.beginPath();"list"===k.ctype&&g();"shape"===k.ctype&&e();"D"===c&&(L.strokeStyle=J.lineColor,L.stroke());"F"===c&&(L.fillStyle=J.lineColor,L.fill());"C"===c&&L.clip();return x};var lc=function(a,b,c,d,e){var g=a.measureText(b).width;a.fillText(b,c-g*e,d)};z.drawtext$2=function(a,
b){var c=N(a[0]),d=I(a[1]),e=Q.extractPoint(c);if(!e.ok)return x;var g=D.drawingstate.matrix,c=e.x*g.a-e.y*g.b+g.tx,e=e.x*g.c-e.y*g.d-g.ty;J.handleModifs(b,J.textModifs);g=D.drawingstate.textsize;null!==J.size&&(g=J.size);L.fillStyle=J.textColor;L.font=J.bold+J.italics+Math.round(10*g)/10+"px "+J.family;d=ia(d);lc(L,d,c+J.xOffset,e-J.yOffset,J.align);return x};Q.drawshape=function(a,b){return"polygon"===a.type?Q.drawpolygon([a],b,"D",1):"circle"===a.type?Q.drawcircle([a.value.value[0],a.value.value[1]],
b,"D"):x};Q.fillshape=function(a,b){return"polygon"===a.type?Q.drawpolygon([a],b,"F",1):"circle"===a.type?Q.drawcircle([a.value.value[0],a.value.value[1]],b,"F"):x};Q.clipshape=function(a,b){return"polygon"===a.type?Q.drawpolygon([a],b,"C",1):"circle"===a.type?Q.drawcircle([a.value.value[0],a.value.value[1]],b,"C"):x};z.fill$1=function(a,b){var c=I(a[0]);return"shape"===c.ctype?Q.fillshape(c,b):x};z.clip$1=function(a,b){var c=I(a[0]);return"shape"===c.ctype?Q.clipshape(c,b):"list"===c.ctype?(c=z.polygon$1(a,
[]),z.clip$1([c],[])):x};z.plot$1=function(a,b){return z.plot$2([a[0],null],b)};z.plot$2=function(a,b){function c(a){return"number"===a.ctype&&q._helper.isAlmostReal(a)}function d(a,f,b,c,e){k++;f=+f.value.real;e=+c.value.real;c=f*z.a-e*z.b+z.tx;f=f*z.c-e*z.d-z.ty;a=+a.value.real;e=+b.value.real;b=a*z.a-e*z.b+z.tx;a=a*z.c-e*z.d-z.ty;l?(L.lineTo(b,a),L.lineTo(c,f)):(L.beginPath(),L.moveTo(b,a),L.lineTo(c,f),l=!0)}function e(a,f,b,k,m){var n=c(b),ba=c(k);if(.001>m)!g&&l&&(L.stroke(),l=!1);else if(n||
ba){var r=q.real((a.value.real+f.value.real)/2);da.setvar(w,r);var t=I(v),u=c(t);if(n&&ba&&u){var y=b.value.real,ba=t.value.real,u=k.value.real;if(n=1>Math.abs(y+u-2*ba)/h){var x=q.real((a.value.real+r.value.real)/2);da.setvar(w,x);var x=I(v),z=q.real((r.value.real+f.value.real)/2);da.setvar(w,z);z=I(v).value.real;y=Math.abs(y+ba-2*x.value.real)/h;ba=Math.abs(ba+u-2*z)/h;n=n&&1>y&&1>ba}n?(d(a,r,b,t,m/2),d(r,f,t,k,m/2)):(e(a,r,b,t,m/2),e(r,f,t,k,m/2))}else e(a,r,b,t,m/2),e(r,f,t,k,m/2)}}var g=!1,h=
.2/ib,k=0,l=!1,n=-10,r=10,t=1,u=1E3,v=a[0],w;if(null!==a[1]&&"variable"===a[1].ctype)w=a[1].name;else{var y=Q.plotvars(v);w="#";-1!==y.indexOf("t")&&(w="t");-1!==y.indexOf("z")&&(w="z");-1!==y.indexOf("y")&&(w="y");-1!==y.indexOf("x")&&(w="x")}da.newvar(w);var z=D.drawingstate.matrix;J.handleModifs(b,{color:!0,alpha:!0,size:!0,dashpattern:!0,dashtype:!0,dashing:!0,connect:function(a){"boolean"===a.ctype&&(g=a.value)},start:function(a){"number"===a.ctype&&(n=a.value.real)},stop:function(a){"number"===
a.ctype&&(r=a.value.real)},steps:function(a){"number"===a.ctype&&(u=a.value.real)}});L.strokeStyle=J.lineColor;L.lineWidth=J.lsize;L.lineCap="round";L.lineJoin="round";var A,B,C,E,l=!1,y=q.real(14.32);da.setvar(w,y);C=I(v);if("number"!==C.ctype){if(m.isNumberVector(C).value&&2===C.value.length){l=!1;t=(r-n)/u;for(y=n;y<r;y+=t)da.setvar(w,q.real(y)),E=I(v),m.isNumberVector(E).value&&2===E.value.length&&(A=+E.value[0].value.real,B=+E.value[1].value.real,E=A*z.a-B*z.b+z.tx,A=A*z.c-B*z.d-z.ty,l?L.lineTo(E,
A):(L.beginPath(),L.moveTo(E,A),l=!0));L.stroke();da.removevar(w)}return x}for(E=n;E<r+t;E+=t)y=q.real(E),da.setvar(w,y),C=I(v),y.value.real>n&&e(A,y,B,C,t),A=y,B=C;da.removevar(w);l&&L.stroke();return x};z.plotX$1=function(a,b){var c=a[0],d=Q.plotvars(c),e="#";-1!==d.indexOf("t")&&(e="t");-1!==d.indexOf("z")&&(e="z");-1!==d.indexOf("y")&&(e="y");-1!==d.indexOf("x")&&(e="x");da.newvar(e);d=D.drawingstate.matrix;L.fillStyle=D.drawingstate.linecolor;L.lineWidth=1;L.lineCap="round";for(var g=!1,h=-10;10>
h;h+=.01){da.setvar(e,q.real(h));var k=I(c);if("number"===k.ctype){var m=+k.value.real,k=h*d.a-m*d.b+d.tx,m=h*d.c-m*d.d-d.ty;g?L.lineTo(k,m):(L.beginPath(),L.moveTo(k,m),g=!0)}}L.stroke();da.removevar(e);return x};Q.plotvars=function(a){function b(a,f){var c={},d;for(d=a.length-1;0<=d;--d)c[a[d]]=a[d];for(d=f.length-1;0<=d;--d)c[f[d]]=f[d];d=[];for(var e in c)c.hasOwnProperty(e)&&d.push(c[e]);return d}function c(a,f){for(var b=0;b<a.length;b++)a[b]===f&&(a.splice(b,1),b--);return a}var d,e,g,h;if("variable"===
a.ctype)return[a.name];if("infix"===a.ctype)return d=Q.plotvars(a.args[0]),a=Q.plotvars(a.args[1]),b(d,a);if("list"===a.ctype){g=a.value;e=[];for(h=0;h<g.length;h++)d=Q.plotvars(g[h]),e=b(e,d);return e}if("function"===a.ctype){g=a.args;e=[];for(h=0;h<g.length;h++)d=Q.plotvars(g[h]),e=b(e,d);"apply"!==a.oper&&"select"!==a.oper&&"forall"!==a.oper&&"sum"!==a.oper&&"product"!==a.oper&&"repeat"!==a.oper&&"min"!==a.oper&&"max"!==a.oper&&"sort"!==a.oper||"variable"!==a.args[1].ctype||(e=c(e,a.args[1].name));
return e}return[]};z.clrscr$0=function(a,b){"undefined"!==typeof ya&&"undefined"!==typeof ua&&L.clearRect(0,0,ya,ua);return x};z.repaint$0=function(a,b){S();return x};z.screenbounds$0=function(a,b){var c=F.withUsage(m.realVector(D.to(0,0)),"Point"),d=F.withUsage(m.realVector(D.to(ya,0)),"Point"),e=F.withUsage(m.realVector(D.to(ya,ua)),"Point"),g=F.withUsage(m.realVector(D.to(0,ua)),"Point");return m.turnIntoCSList([c,d,e,g])};z.createimage$3=function(a,b){var c=I(a[0]),d=N(a[1]),e=N(a[2]);if("number"!==
d.ctype||"number"!==e.ctype||"string"!==c.ctype)return x;var g=document.createElement("canvas");g.id=c.value;g.width=d.value.real;g.height=e.value.real;g.style.display="none";document.body.appendChild(g);xa[c.value]=g;return x};z.clearimage$1=function(a,b){var c=I(a[0]);if("string"!==c.ctype)return x;c=document.getElementById(c.value);if("undefined"===typeof c||null===c)return x;var d=c.width,e=c.height;c.getContext("2d").clearRect(0,0,d,e);return x};z.canvas$4=function(a,b){var c=N(a[0]),d=N(a[1]),
e=I(a[2]),g=a[3],h=Q.extractPoint(c),k=Q.extractPoint(d);if(!h.ok||!k.ok||"string"!==e.ctype)return x;e=document.getElementById(e.value);if("undefined"===typeof e||null===e)return x;var c=e.width,d=e.height,m=k.x-h.x,l=k.y-h.y,q=h.x-l*d/c,n=h.y+m*d/c,l=k.x-l*d/c,m=k.y+m*d/c,k=D.from(h.x,h.y,1),q=D.from(q,n,1),l=D.from(l,m,1),h=k[0],n=k[1],m=q[0],r=q[1],t=l[0],u=l[1],q=c*(n-r)/((h-m)*(n-u)-(h-t)*(n-r)),c=c*(h-m)/((n-r)*(h-t)-(n-u)*(h-m)),l=-q*h-c*n,k=(d*(n-u)-d*(n-r))/((h-m)*(n-u)-(h-t)*(n-r)),m=(d*
(h-t)-d*(h-m))/((n-r)*(h-t)-(n-u)*(h-m)),d=d-k*h-m*n,e=e.getContext("2d"),h=L;L=e;L.save();L.transform(q,k,c,m,l,d);I(g);L.restore();L=h};z.canvas$5=function(a,b){var c=N(a[0]),d=N(a[1]),e=N(a[2]),g=I(a[3]),h=a[4],c=Q.extractPoint(c),d=Q.extractPoint(d),k=Q.extractPoint(e);if(!c.ok||!d.ok||!k.ok||"string"!==g.ctype)return x;g=document.getElementById(g.value);if("undefined"===typeof g||null===g)return x;var m=g.width,e=g.height,l=D.from(c.x,c.y,1),q=D.from(d.x,d.y,1),d=D.from(k.x,k.y,1),c=l[0],k=l[1],
n=q[0],r=q[1],t=d[0],u=d[1],d=((0-m)*(k-u)-0*(k-r))/((c-n)*(k-u)-(c-t)*(k-r)),m=((0-m)*(c-t)-0*(c-n))/((k-r)*(c-t)-(k-u)*(c-n)),q=0-d*c-m*k,l=((e-e)*(k-u)-(e-0)*(k-r))/((c-n)*(k-u)-(c-t)*(k-r)),n=((e-e)*(c-t)-(e-0)*(c-n))/((k-r)*(c-t)-(k-u)*(c-n)),e=e-l*c-n*k,g=g.getContext("2d"),c=L;L=g;L.save();L.transform(d,l,m,n,q,e);I(h);L.restore();L=c};z.screenresolution$0=function(a,b){return q.real(D.drawingstate.matrix.a)};z.layer$1=function(a,b){};Q.extractReferenceX=function(a,b){};z.imagesize$1=function(a,
b){var c=N(a[0]);return"string"===c.ctype&&xa[c.value]?m.realVector([xa[c.value].width,xa[c.value].height]):x};z.drawimage$2=function(a,b){function c(){var a=1,f=1,d=1,g=1,h=0,p=1,l=Q.extractPoint(e);if(!l.ok||"string"!==k.ctype)return x;L.save();var q;void 0!==b.angle&&(q=I(b.angle),"number"===q.ctype&&(h=q.value.real));void 0!==b.rotation&&(q=I(b.rotation),"number"===q.ctype&&(h=q.value.real));void 0!==b.scale&&(q=N(b.scale),"number"===q.ctype&&(f=a=q.value.real),m.isNumberVector(q).value&&2===
q.value.length&&(a=q.value[0].value.real,f=q.value[1].value.real));void 0!==b.scalex&&(q=I(b.scalex),"number"===q.ctype&&(a=q.value.real));void 0!==b.scaley&&(q=I(b.scaley),"number"===q.ctype&&(f=q.value.real));void 0!==b.flipx&&(q=I(b.flipx),"boolean"===q.ctype&&q.value&&(d=-1));void 0!==b.flipy&&(q=I(b.flipy),"boolean"===q.ctype&&q.value&&(g=-1));void 0!==b.alpha&&(q=I(b.alpha),"number"===q.ctype&&(p=q.value.real));var n=D.drawingstate.matrix,r=D.drawingstate.initialmatrix;q=xa[k.value].width;var t=
xa[k.value].height,V=l.x*n.a-l.y*n.b+n.tx,u=l.x*n.c-l.y*n.d-n.ty,v=(l.x+1)*n.a-l.y*n.b+n.tx-V,n=(l.x+1)*n.c-l.y*n.d-n.ty-u,w=(l.x+1)*r.a-l.y*r.b+r.tx-(l.x*r.a-l.y*r.b+r.tx),r=(l.x+1)*r.c-l.y*r.d-r.ty-(l.x*r.c-l.y*r.d-r.ty),l=Math.sqrt(v*v+n*n)/Math.sqrt(w*w+r*r),v=-Math.atan2(v,n)+Math.atan2(w,r);1!==p&&(L.globalAlpha=p);L.translate(V,u);L.scale(a*d*l,f*g*l);L.rotate(h+v);L.translate(-V,-u);L.translate(-q/2,-t/2);L.drawImage(xa[k.value],V,u);L.globalAlpha=1;L.restore()}function d(){var a=1,f=1,c=
1,p=1,l=Q.extractPoint(e),m=Q.extractPoint(g),q;if(!l.ok||!m.ok||"string"!==k.ctype)return x;if(void 0!==xa&&void 0!==xa[k.value]){var n=xa[k.value].width,r=xa[k.value].height;if(0===h)q={},q.x=l.x-(m.y-l.y),q.y=l.y+(m.x-l.x),p=r/n;else if(q=Q.extractPoint(h),!l.ok)return x;L.save();var t;void 0!==b.alpha&&(t=I(b.alpha),"number"===t.ctype&&(a=t.value.real));void 0!==b.aspect&&(t=I(b.aspect),"number"===t.ctype&&(p=t.value.real));void 0!==b.flipx&&(t=I(b.flipx),"boolean"===t.ctype&&t.value&&(f=-1));
void 0!==b.flipy&&(t=I(b.flipy),"boolean"===t.ctype&&t.value&&(c=-1));t=D.drawingstate.matrix;1!==a&&(L.globalAlpha=a);a=l.x*t.a-l.y*t.b+t.tx;l=l.x*t.c-l.y*t.d-t.ty;L.transform(m.x*t.a-m.y*t.b+t.tx-a,m.x*t.c-m.y*t.d-t.ty-l,q.x*t.a-q.y*t.b+t.tx-a,q.x*t.c-q.y*t.d-t.ty-l,a,l);L.scale(1/n,-1/r*p);L.translate(n/2,-r/2);L.scale(f,c);L.translate(-n/2,r/2);L.translate(0,-r);L.drawImage(xa[k.value],0,0);L.globalAlpha=1;L.restore()}}var e,g,h,k;return 2===a.length?(e=N(a[0]),k=N(a[1]),c()):3===a.length?(e=
N(a[0]),g=N(a[1]),h=0,k=N(a[2]),d()):4===a.length?(e=N(a[0]),g=N(a[1]),h=N(a[2]),k=N(a[3]),d()):x};z.drawimage$3=z.drawimage$2;z.drawimage$4=z.drawimage$2;var Nb;Nb=[0,0,0,0,0,0,0,0,0,0,0,0];z.playsin$1=function(a,b){var c=N(a[0]),d=0;if("number"===c.ctype){var e;void 0!==b.line&&(e=I(b.line),"number"===e.ctype&&(d=Math.floor(e.value.real),0>d&&(d=0),10<d&&(d=10)));c=c.value.real;0!==Nb[d]&&Nb[d].set({freq:c})}return x};var ga={printArr:function(a){for(var b=a.value.length,c=[],d=[],e=!1,g=0;g<b;g++)c[g]=
a.value[g].value.real,d[g]=a.value[g].value.imag,0!==d[g]&&(e=!0);console.log(c);e&&console.log(d)},zero:function(a){for(var b=[],c=q.real(0),d=0;d<a.value.real;d++)b[d]=c;return m.turnIntoCSList(b)},number:function(a,b){var c=ga.zero(b);c.value[0]=a;return c},variable:function(a,b){var c=ga.zero(b);c.value[0]=a;c.value[1]=q.real(1);return c},add:function(a,b){return m.add(a,b)},sub:function(a,b){return m.sub(a,b)},mult:function(a,b){if(a.value.length!==b.value.length)return console.error("dims don't fit return nada"),
x;for(var c=a.value.length,d=ga.zero(q.real(c)),e=q.real(0),g=0;g<c;g++){for(var h=0;h<=g;h++)e=q.add(e,q.mult(a.value[h],b.value[g-h]));d.value[g]=e;e=q.real(0)}return d},pow:function(a,b){if(0>b.value.real||b.value.real!==Math.floor(b.value.real))return ga.root(a,b);for(var c=a,d=1;d<b.value.real;d++)c=ga.mult(c,a);return c},root:function(a,b){var c=q.real(0),d=q.real(1),e=q.add(d,b),g=a.value.length,h=ga.zero(q.real(g));h.value[0]=q.pow(a.value[0],b);for(var k=c,l,m,n=1;n<g;n++){m=q.real(n);for(var r=
1;r<=n;r++)l=q.mult(e,q.real(r)),l=q.div(l,m),l=q.sub(l,d),l=q.mult(l,a.value[r]),l=q.mult(l,h.value[n-r]),k=q.add(k,l);k=q.div(k,a.value[0]);h.value[n]=k;k=c}return h},findFirstNoneZero:function(a,b,c){for(var d=Infinity,e=Infinity,g=c;g<a.value.length;g++)if(1E-12<q.abs2(a.value[g]).value.real){d=g;break}for(a=c;a<b.value.length;a++)if(1E-12<q.abs2(b.value[a]).value.real){e=a;break}return[d,e]},div:function(a,b){if(a.value.length!==b.value.length)return console.log("dims don't fit - return nada"),
x;for(var c=a.value.length,d=q.real(0),e=ga.zero(q.real(c)),g=d,h=d,k=0;k<c;k++){h=ga.findFirstNoneZero(a,b,k);k<h[0]&&h[0]===h[1]&&Infinity!==h[0]&&(a.value.splice(k,h[0]),b.value.splice(k,h[0]),e.value.splice(k,h[0]),c-=h[0]);for(var h=a.value[k],l=0;l<k;l++)g=q.add(g,q.mult(e.value[l],b.value[k-l]));h=q.sub(h,g);h=q.div(h,b.value[0]);e.value[k]=h;g=d}return e},exp:function(a){var b=q.real(0),c=a.value.length,d=ga.zero(q.real(c)),e=b,g;d.value[0]=q.exp(a.value[0]);for(var h=1;h<c;h++){for(var k=
1;k<=h;k++)g=q.mult(q.real(k),a.value[k]),g=q.mult(g,d.value[h-k]),e=q.add(e,g);d.value[h]=q.div(e,q.real(h));e=b}return d},log:function(a){var b=q.real(0),c=a.value.length,d=ga.zero(q.real(c));d.value[0]=q.log(a.value[0]);for(var e=b,g,h,k=1;k<c;k++){g=a.value[k];for(var l=1;l<k;l++)h=q.mult(q.real(l),d.value[l]),h=q.mult(h,a.value[k-l]),e=q.add(e,h);e=q.div(e,q.real(k));g=q.sub(g,e);g=q.div(g,a.value[0]);d.value[k]=g;e=b}return d},sincos:function(a){var b=q.real(0),c=a.value.length,d=ga.zero(q.real(c)),
e=ga.zero(q.real(c));d.value[0]=q.sin(a.value[0]);e.value[0]=q.cos(a.value[0]);for(var g=b,h=b,k,l,m,n=1;n<c;n++){m=q.real(n);for(var r=1;r<=n;r++)l=q.mult(q.real(r),a.value[r]),k=q.mult(l,e.value[n-r]),l=q.mult(l,d.value[n-r]),h=q.add(h,k),g=q.add(g,l);h=q.div(h,m);g=q.div(g,q.neg(m));d.value[n]=h;e.value[n]=g;g=h=b}ga.sinsave=d;ga.cossave=e;return[d,e]},sin:function(a){return ga.sincos(a)[0]},cos:function(a){return ga.sincos(a)[1]},faculty:function(a){var b=[];b[0]=q.real(1);for(var c=1,d=1;d<=
a.value.real;d++)c*=d,b[d]=q.real(c);return b=m.turnIntoCSList(b)},diff:function(a,b,c,d){var e;if("variable"===a.ctype)e=a.name!==b?ga.number(I(a),d):ga.variable(c,d);else if("number"===a.ctype)e=ga.number(a,d);else{if("infix"===a.ctype){if("*"===a.oper)return ga.mult(ga.diff(a.args[0],b,c,d),ga.diff(a.args[1],b,c,d));if("^"===a.oper)return ga.pow(ga.diff(a.args[0],b,c,d),ga.diff(a.args[1],b,c,d).value[0]);if("/"===a.oper)return ga.div(ga.diff(a.args[0],b,c,d),ga.diff(a.args[1],b,c,d));if("+"===
a.oper)return ga.add(ga.diff(a.args[0],b,c,d),ga.diff(a.args[1],b,c,d));if("-"===a.oper)return ga.sub(ga.diff(a.args[0],b,c,d),ga.diff(a.args[1],b,c,d));console.log("infix not found",a.oper);return x}if("function"===a.ctype){if("exp$1"===a.oper)return ga.exp(ga.diff(a.args[0],b,c,d));if("log$1"===a.oper)return ga.log(ga.diff(a.args[0],b,c,d));if("sin$1"===a.oper)return ga.sin(ga.diff(a.args[0],b,c,d));if("cos$1"===a.oper)return ga.cos(ga.diff(a.args[0],b,c,d))}else return console.log("ctype not found",
a.ctype),x}return e},adevaluate:function(a,b,c,d){a=ga.diff(a,b,c,d);d=ga.faculty(d);for(b=2;b<a.value.length;b++)a.value[b]=q.mult(a.value[b],d.value[b]);return a},autodiff:function(a,b,c,d){for(var e=[],g=c.value.length,h,k=0;k<g;k++)h=ga.adevaluate(a,b,c.value[k],d),e[k]=h;return e=m.turnIntoCSList(e)}},J={handleModifs:function(a,b){J.dashing&&J.unSetDash();J.colorraw=null;J.size=null;0>=J.psize&&(J.psize=0);0>=J.lsize&&(J.lsize=0);J.overhang=1;J.dashing=!1;J.isArrow=!1;J.arrowSides="==>";J.arrowposition=
1;J.headlen=10;J.arrowShape="default";J.alpha=D.drawingstate.alpha;J.bold="";J.italics="";J.family="Arial";J.align=0;J.xOffset=0;J.yOffset=0;var c,d;for(c in a)(d=b[c])?(!0===d&&(d=J.modifHandlers[c]),d(I(a[c]))):console.log("Modifier not supported: "+c);null!==J.size?J.psize=J.lsize=J.size:(J.psize=D.drawingstate.pointsize,J.lsize=D.drawingstate.linesize);J.dashing&&J.dashing(J.lsize);null!==J.colorraw?J.pointColor=J.lineColor=J.textColor=J.makeColor(J.colorraw):1===J.alpha?(J.pointColor=D.drawingstate.pointcolor,
J.lineColor=D.drawingstate.linecolor,J.textColor=D.drawingstate.textcolor):(J.pointColor=J.makeColor(D.drawingstate.pointcolorraw),J.lineColor=J.makeColor(D.drawingstate.linecolorraw),J.textColor=J.makeColor(D.drawingstate.textcolorraw));J.black=1===J.alpha?"rgb(0,0,0)":"rgba(0,0,0,"+J.alpha+")"},sin30deg:.5};J.cos30deg=Math.sqrt(.75);J.modifHandlers={size:function(a){"number"===a.ctype&&(J.size=a.value.real,0>J.size&&(J.size=0),1E3<J.size&&(J.size=1E3))},color:function(a){m.isNumberVector(a).value&&
3===a.value.length&&(J.colorraw=[a.value[0].value.real,a.value[1].value.real,a.value[2].value.real])},alpha:function(a){"number"===a.ctype&&(J.alpha=a.value.real)},dashpattern:function(a){if("list"===a.ctype){for(var b=[],c=0,d=0;c<a.value.length;c++)"number"===a.value[c].ctype&&(b[d++]=a.value[c].value.real);J.dashing=J.setDash.bind(null,b)}},dashtype:function(a){"number"===a.ctype&&(J.dashing=J.setDashType.bind(null,Math.floor(a.value.real)))},dashing:function(a){"number"===a.ctype&&(a=Math.floor(a.value.real),
J.dashing=J.setDash.bind(null,[2*a,a]))},overhang:function(a){"number"===a.ctype&&(J.overhang=J.overhang*a.value.real+(1-J.overhang)*(1-a.value.real))},arrow:function(a){"boolean"===a.ctype?J.isArrow=a.value:console.error("arrow needs to be of type boolean")},arrowshape:function(a){"string"===a.ctype?(J.arrowShape=a.value,J.isArrow=!0):console.error("arrowshape needs to be of type string")},arrowsides:function(a){"string"!==a.ctype?console.error("arrowsides is not of type string"):"==>"!==a.value&&
"<==>"!==a.value&&"<=="!==a.value?console.error("arrowsides is unknows"):(J.arrowSides=a.value,J.isArrow=!0)},arrowposition:function(a){"number"!==a.ctype?console.error("arrowposition is not of type number"):0>a.value.real?console.error("arrowposition has to be positive"):1<a.value.real?J.overhang=J.overhang*a.value.real+(1-J.overhang)*(1-a.value.real):(J.arrowposition=a.value.real,J.isArrow=!0)},arrowsize:function(a){"number"!==a.ctype?console.error("arrowsize is not of type number"):0>a.value.real?
console.error("arrowsize has to be positive"):J.headlen*=a.value.real},bold:function(a){"boolean"===a.ctype&&a.value&&(J.bold="bold ")},italics:function(a){"boolean"===a.ctype&&a.value&&(J.italics="italic ")},family:function(a){"string"===a.ctype&&(J.family=a.value)},align:function(a){"string"===a.ctype&&(a=a.value,"left"===a&&(J.align=0),"right"===a&&(J.align=1),"mid"===a&&(J.align=.5))},x_offset:function(a){"number"===a.ctype&&(J.xOffset=a.value.real)},y_offset:function(a){"number"===a.ctype&&(J.yOffset=
a.value.real)},offset:function(a){"list"===a.ctype&&2===a.value.length&&"number"===a.value[0].ctype&&"number"===a.value[1].ctype&&(J.xOffset=a.value[0].value.real,J.yOffset=a.value[1].value.real)}};J.lineModifs={size:!0,color:!0,alpha:!0,dashpattern:!0,dashtype:!0,dashing:!0,overhang:!0,arrow:!0,arrowshape:!0,arrowsides:!0,arrowposition:!0,arrowsize:!0};J.pointModifs={size:!0,color:!0,alpha:!0};J.pointAndLineModifs=J.lineModifs;J.conicModifs=J.pointModifs;J.textModifs={size:!0,color:!0,alpha:!0,bold:!0,
italics:!0,family:!0,align:!0,x_offset:!0,y_offset:!0,offset:!0};J.makeColor=function(a){return"rgba("+Math.floor(255*a[0])+","+Math.floor(255*a[1])+","+Math.floor(255*a[2])+","+J.alpha+")"};J.drawsegcore=function(a,b){function c(a,b,f){var d=a-f*w,e=b-f*x;L.beginPath();"full"===J.arrowShape&&(L.lineWidth=J.lsize/2);var g=a-f*y;f=b-f*z;L.moveTo(d,e);L.lineTo(a,b);L.lineTo(g,f);"full"===J.arrowShape?(L.fillStyle=J.lineColor,L.closePath(),L.fill()):"default"!==J.arrowShape&&console.error("arrowshape is unknown");
L.stroke()}var d=D.drawingstate.matrix,e=a.x*d.a-a.y*d.b+d.tx,g=a.x*d.c-a.y*d.d-d.ty,h=b.x*d.a-b.y*d.b+d.tx,k=b.x*d.c-b.y*d.d-d.ty,l=J.overhang,m=1-l,d=l*e+m*h,q=l*g+m*k,n=l*h+m*e,l=l*k+m*g;L.lineWidth=J.lsize;L.lineCap="round";L.lineJoin="miter";L.strokeStyle=J.lineColor;if(!J.isArrow||e===g&&h===k).01>J.lsize||(L.beginPath(),L.moveTo(d,q),L.lineTo(n,l),L.stroke());else{var e=h-e,g=k-g,h=Math.sqrt(e*e+g*g),m=e/h,r=g/h,k=J.arrowposition,t=1-k,g=k*d+t*n,e=k*q+t*l,h=k*n+t*d,k=k*l+t*q,t=J.headlen,u=
J.sin30deg,v=J.cos30deg,w=t*(m*v+r*u),y=t*(m*v-r*u),x=t*(r*v-m*u),z=t*(r*v+m*u),m=J.arrowSides;L.beginPath();"full"===J.arrowShape?("<==>"===m||"<=="===m?(r=g+w,t=e+x,u=g+y,v=e+z,1>J.arrowposition&&(L.moveTo(d,q),L.lineTo(g,e)),L.moveTo((r+u)/2,(t+v)/2)):L.moveTo(d,q),"==>"===m||"<==>"===m?(L.lineTo((h-w+(h-y))/2,(k-x+(k-z))/2),1>J.arrowposition&&(L.moveTo(h,k),L.lineTo(n,l))):L.lineTo(n,l)):(L.moveTo(d,q),L.lineTo(n,l));L.stroke();"==>"!==m&&"<==>"!==m||c(h,k,1);"<=="!==m&&"<==>"!==m||c(g,e,-1)}};
J.drawpoint=function(a){var b=D.drawingstate.matrix,c=a.x*b.a-a.y*b.b+b.tx;a=a.x*b.c-a.y*b.d-b.ty;L.lineWidth=.3*J.psize;L.beginPath();L.arc(c,a,J.psize,0,2*Math.PI);L.fillStyle=J.pointColor;L.fill();L.beginPath();L.arc(c,a,1.15*J.psize,0,2*Math.PI);L.fillStyle=J.black;L.strokeStyle=J.black;L.stroke()};J.drawline=function(a){var b=q.abs(a.value[0]).value.real,c=q.abs(a.value[1]).value.real,d=q.abs(a.value[2]).value.real,e;b>=c&&b>=d&&(e=a.value[0]);c>=b&&c>=d&&(e=a.value[1]);d>=c&&d>=b&&(e=a.value[2]);
b=q.div(a.value[0],e);c=q.div(a.value[1],e);a=q.div(a.value[2],e);a=[b.value.real,c.value.real,a.value.real];Math.abs(a[0])<Math.abs(a[1])?(b=[1,0,30],e=[-1,0,30]):(b=[0,1,30],e=[0,-1,30]);b=[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]];a=[a[1]*e[2]-a[2]*e[1],a[2]*e[0]-a[0]*e[2],a[0]*e[1]-a[1]*e[0]];J.drawsegcore({x:b[0]/b[2],y:b[1]/b[2]},{x:a[0]/a[2],y:a[1]/a[2]})};J.setDash=function(a,b){for(var c=Math.sqrt(b),d=0;d<a.length;d++)a[d]*=c;L.webkitLineDash=a;L.setLineDash(a);L.mozDash=
a};J.unSetDash=function(){L.webkitLineDash=[];L.setLineDash([]);L.mozDash=[]};J.setDashType=function(a,b){0===a&&J.setDash([]);1===a&&J.setDash([10,10],b);2===a&&J.setDash([10,4],b);3===a&&J.setDash([1,3],b);4===a&&J.setDash([10,5,1,5],b)};var Ra={},D={drawingstate:{}};D.drawingstate.linecolor="rgb(0,0,255)";D.drawingstate.linecolorraw=[0,0,1];D.drawingstate.pointcolor="rgb(255,200,0)";D.drawingstate.pointcolorraw=[1,.78,0];D.drawingstate.textcolor="rgb(0,0,0)";D.drawingstate.textcolorraw=[0,0,0];
D.drawingstate.alpha=1;D.drawingstate.pointsize=4;D.drawingstate.linesize=1;D.drawingstate.textsize=20;D.drawingstate.matrix={};D.drawingstate.matrix.a=25;D.drawingstate.matrix.b=0;D.drawingstate.matrix.c=0;D.drawingstate.matrix.d=25;D.drawingstate.matrix.tx=250;D.drawingstate.matrix.ty=250;D.drawingstate.matrix.det=D.drawingstate.matrix.a*D.drawingstate.matrix.d-D.drawingstate.matrix.b*D.drawingstate.matrix.c;D.drawingstate.matrix.sdet=Math.sqrt(D.drawingstate.matrix.det);D.drawingstate.initialmatrix=
{};D.drawingstate.initialmatrix.a=D.drawingstate.matrix.a;D.drawingstate.initialmatrix.b=D.drawingstate.matrix.b;D.drawingstate.initialmatrix.c=D.drawingstate.matrix.c;D.drawingstate.initialmatrix.d=D.drawingstate.matrix.d;D.drawingstate.initialmatrix.tx=D.drawingstate.matrix.tx;D.drawingstate.initialmatrix.ty=D.drawingstate.matrix.ty;D.drawingstate.initialmatrix.det=D.drawingstate.matrix.det;D.drawingstate.initialmatrix.sdet=D.drawingstate.matrix.sdet;D.clone=function(a){if(null===a||"object"!==
typeof a)return a;var b=a.constructor(),c;for(c in a)b[c]=D.clone(a[c]);return b};Ra.backup=D.clone(D.drawingstate);Ra.stack=[];D.clone(D.drawingstate);D.reset=function(){D.drawingstate.matrix.a=D.drawingstate.initialmatrix.a;D.drawingstate.matrix.b=D.drawingstate.initialmatrix.b;D.drawingstate.matrix.c=D.drawingstate.initialmatrix.c;D.drawingstate.matrix.d=D.drawingstate.initialmatrix.d;D.drawingstate.matrix.tx=D.drawingstate.initialmatrix.tx;D.drawingstate.matrix.ty=D.drawingstate.initialmatrix.ty;
D.drawingstate.matrix.det=D.drawingstate.initialmatrix.det;D.drawingstate.matrix.sdet=D.drawingstate.initialmatrix.sdet};D.from=function(a,b,c){a/=c;b/=c;c=D.drawingstate.matrix;return[a*c.a-b*c.b+c.tx,a*c.c-b*c.d-c.ty]};D.to=function(a,b){var c=D.drawingstate.matrix,d=a-c.tx,e=b+c.ty;return[(d*c.d-e*c.b)/c.det,-(-d*c.c+e*c.a)/c.det,1]};D.dumpTrafo=function(){function a(b){return Math.round(1E3*b)/1E3}var b=D.drawingstate.matrix;console.log("a:"+a(b.a)+" b:"+a(b.b)+" c:"+a(b.c)+" d:"+a(b.d)+" tx:"+
a(b.ty)+" ty:"+a(b.tx))};D.setMat=function(a,b,c,d,e,g){var h=D.drawingstate.matrix;h.a=a;h.b=b;h.c=c;h.d=d;h.tx=e;h.ty=g;h.det=a*d-b*c;h.sdet=Math.sqrt(h.det)};D.scaleAndOrigin=function(a,b,c){D.setMat(a,0,0,a,b,c)};D.visibleRect=function(a,b,c,d){var e=c-a,g=b-d,e=ya*g<ua*e?ya/e:ua/g;D.setMat(e,0,0,e,(ya-e*(a+c))/2,(ua-e*(b+d))/2)};D.applyMat=function(a,b,c,d,e,g){var h=D.drawingstate.matrix;D.setMat(h.a*a+h.c*b,h.b*a+h.d*b,h.a*c+h.c*d,h.b*c+h.d*d,h.a*e+h.c*g+h.tx,h.b*e+h.d*g+h.ty);a=D.to(0,-ua);
b=D.to(ya,0);console.log("{visibleRect: ["+a[0]+","+a[1]+","+b[0]+","+b[1]+"]}")};D.translate=function(a,b){D.applyMat(1,0,0,1,a,b)};D.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);D.applyMat(b,a,-a,b,0,0)};D.scale=function(a){D.applyMat(a,0,0,a,0,0)};D.gsave=function(){Ra.stack.push(D.clone(D.drawingstate))};D.grestore=function(){0!==Ra.stack.length&&(D.drawingstate=Ra.stack.pop())};D.greset=function(){D.drawingstate=D.clone(Ra.backup);D.drawingstate.matrix.ty-=ua;D.drawingstate.initialmatrix.ty-=
ua;Ra.stack=[]};D.createnewbackup=function(){D.drawingstate.initialmatrix.a=D.drawingstate.matrix.a;D.drawingstate.initialmatrix.b=D.drawingstate.matrix.b;D.drawingstate.initialmatrix.c=D.drawingstate.matrix.c;D.drawingstate.initialmatrix.d=D.drawingstate.matrix.d;D.drawingstate.initialmatrix.tx=D.drawingstate.matrix.tx;D.drawingstate.initialmatrix.ty=D.drawingstate.matrix.ty;D.drawingstate.initialmatrix.det=D.drawingstate.matrix.det;D.drawingstate.initialmatrix.sdet=D.drawingstate.matrix.sdet;Ra.backup=
D.clone(D.drawingstate)};D.makecolor=function(a,b,c){a=Math.floor(255*a);b=Math.floor(255*b);c=Math.floor(255*c);return 1===D.drawingstate.alpha?"rgb("+a+","+b+","+c+")":"rgba("+a+","+b+","+c+","+D.drawingstate.alpha+")"};D.setcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;D.drawingstate.linecolor=D.drawingstate.pointcolor=D.makecolor(b,c,a);D.drawingstate.linecolorraw=D.drawingstate.pointcolorraw=[b,c,a]};D.setlinecolor=function(a){var b=a.value[0].value.real,
c=a.value[1].value.real;a=a.value[2].value.real;D.drawingstate.linecolor=D.makecolor(b,c,a);D.drawingstate.linecolorraw=[b,c,a]};D.settextcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;D.drawingstate.textcolor=D.makecolor(b,c,a);D.drawingstate.textcolorraw=[b,c,a]};D.setpointcolor=function(a){var b=a.value[0].value.real,c=a.value[1].value.real;a=a.value[2].value.real;D.drawingstate.pointcolor=D.makecolor(b,c,a);D.drawingstate.pointcolorraw=[b,c,a]};D.setalpha=
function(a){D.drawingstate.alpha=a.value.real;D.drawingstate.linecolor=D.makecolor(D.drawingstate.linecolorraw[0],D.drawingstate.linecolorraw[1],D.drawingstate.linecolorraw[2]);D.drawingstate.pointcolor=D.makecolor(D.drawingstate.pointcolorraw[0],D.drawingstate.pointcolorraw[1],D.drawingstate.pointcolorraw[2]);D.drawingstate.textcolor=D.makecolor(D.drawingstate.textcolorraw[0],D.drawingstate.textcolorraw[1],D.drawingstate.textcolorraw[2])};D.setpointsize=function(a){D.drawingstate.pointsize=a.value.real};
D.setlinesize=function(a){D.drawingstate.linesize=a.value.real};D.settextsize=function(a){D.drawingstate.textsize=a.value.real};var Ja={clip:"none",pointColor:[1,0,0],lineColor:[0,0,1],pointSize:5,lineSize:2,alpha:1,overhangLine:1.1,overhangSeg:1,dimDependent:1};a.defaultAppearance&&Bc(a.defaultAppearance);var hc={},za,La,Pa,Aa,Ga,Ya,Ka,db,Hb=!1,fc={toString:function(){return"RefineException"}},X=null;a.enableTraceLog&&(X={logLength:Infinity,fullLog:[],currentMouseAndScripts:null,currentMover:null,
currentStep:null,currentElement:null,currentParam:null,labelTracing2:F.wrap("tracing2"),labelTracing4:F.wrap("tracing4"),labelTracingSesq:F.wrap("tracingSesq"),postMouseHooks:[]},"number"===typeof a.enableTraceLog&&(X.logLength=a.enableTraceLog),Ma.getTraceLog=Gc,Ma.formatTraceLog=Hc,Ma.addTraceHook=X.postMouseHooks.push.bind(X.postMouseHooks));Qa.stateSize=12;Kb.stateSize=24;var B={_helper:{},RandomLine:{}};B.RandomLine.kind="L";B.RandomLine.updatePosition=function(a){a.homog=m.realVector([100*Math.random(),
100*Math.random(),100*Math.random()]);a.homog=m.normalizeMax(a.homog);a.homog=F.withUsage(a.homog,"Line")};B.FreeLine={};B.FreeLine.kind="L";B.FreeLine.updatePosition=function(a){a.homog=m.realVector([100*Math.random(),100*Math.random(),100*Math.random()]);a.homog=m.normalizeMax(a.homog);a.homog=F.withUsage(a.homog,"Line")};B.RandomPoint={};B.RandomPoint.kind="P";B.RandomPoint.updatePosition=function(a){a.homog=m.realVector([100*Math.random(),100*Math.random(),100*Math.random()]);a.homog=m.normalizeMax(a.homog);
a.homog=F.withUsage(a.homog,"Point")};B.Join={};B.Join.kind="L";B.Join.updatePosition=function(a){a.homog=m.cross(c[a.args[0]].homog,c[a.args[1]].homog);a.homog=m.normalizeMax(a.homog);a.homog=F.withUsage(a.homog,"Line")};B.Segment={};B.Segment.kind="S";B.Segment.updatePosition=function(a){var b=c[a.args[0]],d=c[a.args[1]];a.homog=m.cross(b.homog,d.homog);a.homog=m.normalizeMax(a.homog);a.homog=F.withUsage(a.homog,"Line");a.startpos=b.homog;a.endpos=d.homog;a.farpoint=m.cross(a.homog,m.linfty)};B.Meet=
{};B.Meet.kind="P";B.Meet.updatePosition=function(a){a.homog=m.cross(c[a.args[0]].homog,c[a.args[1]].homog);a.homog=m.normalizeMax(a.homog);a.homog=F.withUsage(a.homog,"Point")};B.Meet.visiblecheck=function(a){var b=!0,d=c[a.args[0]],e=c[a.args[1]];"Segment"===d.type&&(b=dc(a,d));b&&"Segment"===d.type&&(b=dc(a,e));a.isshowing=b};B.Mid={};B.Mid.kind="P";B.Mid.updatePosition=function(a){var b=c[a.args[0]].homog,d=c[a.args[1]].homog,e=m.cross(b,d),g=m.cross(e,m.linfty),h=m.det3(b,g,e),e=m.det3(d,g,e),
b=m.scalmult(e,b),d=m.scalmult(h,d);a.homog=m.add(b,d);a.homog=m.normalizeMax(a.homog);a.homog=F.withUsage(a.homog,"Point")};B.Perp={};B.Perp.kind="L";B.Perp.updatePosition=function(a){var b=c[a.args[0]].homog,d=c[a.args[1]].homog,b=m.turnIntoCSList([b.value[0],b.value[1],q.zero]);a.homog=m.cross(b,d);a.homog=m.normalizeMax(a.homog);a.homog=F.withUsage(a.homog,"Line")};B.Para={};B.Para.kind="L";B.Para.updatePosition=function(a){var b=c[a.args[1]].homog;a.homog=m.cross(m.cross(m.linfty,c[a.args[0]].homog),
b);a.homog=m.normalizeMax(a.homog);a.homog=F.withUsage(a.homog,"Line")};B.Horizontal={};B.Horizontal.kind="L";B.Horizontal.updatePosition=function(a){a.homog=m.cross(m.ex,c[a.args[0]].homog);a.homog=m.normalizeMax(a.homog);a.homog=F.withUsage(a.homog,"Line")};B.Vertical={};B.Vertical.kind="L";B.Vertical.updatePosition=function(a){a.homog=m.cross(m.ey,c[a.args[0]].homog);a.homog=m.normalizeMax(a.homog);a.homog=F.withUsage(a.homog,"Line")};B.Through={};B.Through.kind="L";B.Through.isMovable=!0;B.Through.initialize=
function(a){a=a.dir?F.wrap(a.dir):m.realVector([a.pos[1],-a.pos[0],0]);qa(a)};B.Through.getParamForInput=function(a,b,d){a="mouse"===d?m.cross(c[a.args[0]].homog,b):"homog"===d?b:m.turnIntoCSList([q.zero,q.zero,q.zero]);a=m.cross(m.linfty,a);return m.normalizeMax(a)};B.Through.getParamFromState=function(a){return va(3)};B.Through.putParamToState=function(a,b){qa(b)};B.Through.updatePosition=function(a){var b=va(3);qa(b);b=m.cross(c[a.args[0]].homog,b);b=m.normalizeMax(b);a.homog=F.withUsage(b,"Line")};
B.Through.stateSize=6;B.Free={};B.Free.kind="P";B.Free.isMovable=!0;B.Free.initialize=function(a){a=B._helper.initializePoint(a);qa(a)};B.Free.getParamForInput=function(a,b,c){if("mouse"===c&&Sb&&0!==Ta){b=m.normalizeZ(b);a=b.value[0].value.real;c=b.value[1].value.real;var d=Math.round(a/Ta)*Ta,e=Math.round(c/Ta)*Ta;.2>Math.abs(d-a)&&.2>Math.abs(e-c)&&(b=m.realVector([d,e,1]))}return m.normalizeMax(b)};B.Free.getParamFromState=function(a){return va(3)};B.Free.putParamToState=function(a,b){qa(b)};
B.Free.updatePosition=function(a){var b=va(3);qa(b);a.homog=F.withUsage(b,"Point")};B.Free.stateSize=6;B._helper.projectPointToLine=function(a,b){var c=m.turnIntoCSList([b.value[0],b.value[1],q.zero]),c=m.cross(c,a);return m.normalizeMax(m.cross(c,b))};B.PointOnLine={};B.PointOnLine.kind="P";B.PointOnLine.isMovable=!0;B.PointOnLine.initialize=function(a){var b=B._helper.initializePoint(a);a=c[a.args[0]].homog;var b=B._helper.projectPointToLine(b,a),b=m.normalizeMax(b),d=m.cross(m.linfty,b);m.normalizeMax(d);
qa(b);qa(a);Ya=!1};B.PointOnLine.updatePosition=function(a,b){var d,e=c[a.args[0]].homog;d=va(3);va(3);if(!b){Aa=a.stateIdx;var g=za;za=Pa;var h=va(3),k=va(3);za=g;g=m.cross(k,e);m._helper.isAlmostZero(g)&&(g=m.cross(m.linfty,e));h=B._helper.CircleMP(g,h);h=B._helper.IntersectLC(e,h);g=B._helper.pointReflection(g,d);d=ic(h[0],h[1],d,g)[0]}d=m.normalizeMax(d);qa(d);qa(e);a.homog=F.withUsage(d,"Point")};B.PointOnLine.getParamForInput=function(a,b,d){return b=B._helper.projectPointToLine(b,c[a.args[0]].homog)};
B.PointOnLine.getParamFromState=function(a){return va(3)};B.PointOnLine.putParamToState=function(a,b){return qa(b)};B.PointOnLine.stateSize=12;B.PointOnCircle={};B.PointOnCircle.kind="P";B.PointOnCircle.isMovable=!0;B.PointOnCircle.initialize=function(a){var b=c[a.args[0]];a=m.normalizeZ(B._helper.initializePoint(a));var d=m.normalizeZ(B._helper.CenterOfConic(b.matrix)),e=m.sub(a,d),e=m.turnIntoCSList([e.value[1],q.neg(e.value[0]),q.zero]),d=m.cross(a,d),b=B._helper.IntersectLC(d,b.matrix),d=m.projectiveDistMinScal(a,
b[0]);m.projectiveDistMinScal(a,b[1])<d?(a=b[1],b=b[0]):(a=b[0],b=b[1]);qa(e);qa(a);qa(b);Ya=!1};B.PointOnCircle.putParamToState=function(a,b){qa(b)};B.PointOnCircle.getParamFromState=function(a){return va(3)};B.PointOnCircle.getParamForInput=function(a,b,d){d=m.normalizeZ(B._helper.CenterOfConic(c[a.args[0]].matrix));b=m.sub(b,d);Aa=a.stateIdx;a=va(3);var e=m.normalizeZ(va(3));d=m.sub(e,d);0>q.sub(q.mult(a.value[0],d.value[1]),q.mult(a.value[1],d.value[0])).value.real&&(b=m.neg(b));return m.turnIntoCSList([b.value[1],
q.neg(b.value[0]),q.zero])};B.PointOnCircle.parameterPath=function(a,b,c,d,e){d=m.normalizeAbs(d);e=m.normalizeAbs(e);var g=m.scalproduct(d,e);if(0<=g.value.real)return gc(a,b,c,d,e);a=m.turnIntoCSList([q.sub(d.value[1],e.value[1]),q.sub(e.value[0],d.value[0]),q.zero]);g=m.scalproduct(d,a);0>g.value.real&&(a=m.neg(a));0>b?(b=2*b+1,c=b*b,g=.25/(1+c),c=q.complex(2*b*g+.25,(1-c)*g)):(b=2*b-1,c=b*b,g=.25/(1+c),c=q.complex(2*b*g+.75,(1-c)*g));var h=q.sub(q.real(1),c);b=q.mult(c,c);g=q.mult(h,h);c=q.mult(c,
h);d=m.scalmult(g,d);d=m.add(d,m.scalmult(c,a));return d=m.add(d,m.scalmult(b,e))};B.PointOnCircle.updatePosition=function(a){var b=va(3);qa(b);var d=c[a.args[0]],b=m.productMV(d.matrix,b),d=B._helper.IntersectLC(b,d.matrix),d=Qa(d[0],d[1]),b=m.normalizeMax(d.value[0]);a.homog=F.withUsage(b,"Point");a.antipodalPoint=d.value[1]};B.PointOnCircle.stateSize=6+Qa.stateSize;B.OtherPointOnCircle={};B.OtherPointOnCircle.kind="P";B.OtherPointOnCircle.updatePosition=function(a){var b=c[a.args[0]].antipodalPoint,
b=m.normalizeMax(b);a.homog=F.withUsage(b,"Point")};B.PointOnSegment={};B.PointOnSegment.kind="P";B.PointOnSegment.isMovable=!0;B.PointOnSegment.initialize=function(a){var b=B._helper.initializePoint(a);a=B.PointOnSegment.getParamForInput(a,b);$a(a)};B.PointOnSegment.getParamForInput=function(a,b){var d=c[a.args[0]],e=d.homog,e=m.turnIntoCSList([e.value[0],e.value[1],q.zero]),d=m.crossratio3(d.farpoint,d.startpos,d.endpos,b,e);0>d.value.real&&(d=q.complex(0,d.value.imag));1<d.value.real&&(d=q.complex(1,
d.value.imag));return d};B.PointOnSegment.getParamFromState=function(a){return gb()};B.PointOnSegment.putParamToState=function(a,b){$a(b)};B.PointOnSegment.updatePosition=function(a){var b=gb();$a(b);var d=c[a.args[0]],e=m.scalmult(d.endpos.value[2],d.startpos),d=m.scalmult(d.startpos.value[2],d.endpos),d=m.sub(d,e),b=m.add(e,m.scalmult(b,d)),b=m.normalizeMax(b);a.homog=F.withUsage(b,"Point")};B.PointOnSegment.stateSize=2;B._helper.CenterOfConic=function(a){var b=B._helper.IntersectLC(m.linfty,a),
c=F.mult(a,b[0]);a=F.mult(a,b[1]);return m.cross(c,a)};B.CenterOfConic={};B.CenterOfConic.kind="P";B.CenterOfConic.updatePosition=function(a){var b=B._helper.CenterOfConic(c[a.args[0]].matrix);a.homog=b;a.homog=m.normalizeMax(a.homog);a.homog=F.withUsage(a.homog,"Point")};B._helper.CircleMP=function(a,b){var c=a.value[0],d=a.value[1],e=q.neg(a.value[2]),g=q.zero,c=m.turnIntoCSList([m.turnIntoCSList([e,g,c]),m.turnIntoCSList([g,e,d]),m.turnIntoCSList([c,d,g])]),e=F.mult(F.mult(b,c),b),d=F.mult(F.mult(b,
m.fund),b),e=F.mult(e,m.fund),c=F.mult(d,c);return m.sub(e,c)};B.CircleMP={};B.CircleMP.kind="C";B.CircleMP.updatePosition=function(a){a.matrix=B._helper.CircleMP(c[a.args[0]].homog,c[a.args[1]].homog);a.matrix=m.normalizeMax(a.matrix);a.matrix=F.withUsage(a.matrix,"Circle")};B.CircleMr={};B.CircleMr.kind="C";B.CircleMr.isMovable=!0;B.CircleMr.initialize=function(a){$a(q.real(a.radius))};B.CircleMr.getParamForInput=function(a,b){var d=c[a.args[0]].homog,d=m.normalizeZ(d);b=m.normalizeZ(b);d=m.sub(d,
b);return d=m.abs(d)};B.CircleMr.getParamFromState=function(a){return gb()};B.CircleMr.putParamToState=function(a,b){$a(b)};B.CircleMr.updatePosition=function(a){var b=gb();$a(b);var d=c[a.args[0]].homog,d=m.normalizeZ(d),e=m.turnIntoCSList([b,q.zero,q.zero]),e=m.add(e,d),d=B._helper.CircleMP(d,e),d=m.normalizeMax(d);a.matrix=F.withUsage(d,"Circle");a.radius=b};B.CircleMr.stateSize=2;B.Compass={};B.Compass.kind="C";B.Compass.updatePosition=function(a){var b=c[a.args[2]].homog,d=c[a.args[1]].homog,
e=c[a.args[0]].homog,b=m.normalizeZ(b),d=m.normalizeZ(d),e=m.normalizeZ(e),d=m.sub(d,e),d=m.add(d,b),d=m.normalizeZ(d),b=B._helper.CircleMP(b,d),b=m.normalizeMax(b);a.matrix=F.withUsage(b,"Circle")};B._helper.getConicType=function(a){if(1E-16>q.abs(m.det(a)).value.real)return"degenerate";var b=q.mult(a.value[0].value[0],a.value[1].value[1]),b=q.sub(b,q.pow(a.value[0].value[1],q.real(2))),b=b.value.real;return 1E-16>Math.abs(b)?"parabola":1E-16<b?"ellipsoid":"hyperbola"};B._helper.ConicBy5=function(a,
b,c,d,e,g){a=m.turnIntoCSList([m.cross(c,d)]);var h=m.turnIntoCSList([m.cross(b,e)]);b=m.turnIntoCSList([m.cross(b,c)]);d=m.turnIntoCSList([m.cross(d,e)]);F.mult(m.transpose(h),a);return B._helper.conicFromTwoDegenerates(a,h,b,d,g)};B._helper.conicFromTwoDegenerates=function(a,b,c,d,e){a=F.mult(m.transpose(b),a);c=F.mult(m.transpose(d),c);a=m.add(a,m.transpose(a));c=m.add(c,m.transpose(c));d=F.mult(F.mult(e,a),e);e=F.mult(F.mult(e,c),e);c=F.mult(d,c);e=F.mult(e,a);return m.sub(c,e)};B.ConicBy5={};
B.ConicBy5.kind="C";B.ConicBy5.updatePosition=function(a){var b=B._helper.ConicBy5(a,c[a.args[0]].homog,c[a.args[1]].homog,c[a.args[2]].homog,c[a.args[3]].homog,c[a.args[4]].homog);a.matrix=b;a.matrix=m.normalizeMax(a.matrix);a.matrix=F.withUsage(a.matrix,"Conic")};B._helper.buildConicMatrix=function(a){var b=a[1],c=a[2],d=a[3],e=a[4],g=a[5];return m.turnIntoCSList([m.turnIntoCSList([a[0],b,d]),m.turnIntoCSList([b,c,e]),m.turnIntoCSList([d,e,g])])};B._helper.splitDegenConic=function(a){var b=m.adjoint3(a),
c=0,d,e,g=q.abs2(b.value[0].value[0]).value.real;for(d=1;3>d;d++)e=q.abs2(b.value[d].value[d]).value.real,e>g&&(c=d,g=e);d=q.sqrt(q.mult(q.real(-1),b.value[c].value[c]));c=q.real(c+1);e=m.column(b,c);if(1E-16>q.abs2(d).value.real)return x;e=m.scaldiv(d,e);d=e.value[0];g=e.value[1];e=e.value[2];d=m.turnIntoCSList([m.turnIntoCSList([q.real(0),e,q.mult(q.real(-1),g)]),m.turnIntoCSList([q.mult(q.real(-1),e),q.real(0),d]),m.turnIntoCSList([g,q.mult(q.real(-1),d),q.real(0)])]);a=m.add(a,d);var h=0;for(d=
g=b=0;3>d;d++)for(c=0;3>c;c++)e=q.abs2(a.value[d].value[c]).value.real,e>g&&(h=d,b=c,g=e);d=a.value[h];a=m.transpose(a);a=a.value[b];d=m.normalizeMax(d);a=m.normalizeMax(a);d=F.withUsage(d,"Line");a=F.withUsage(a,"Line");return[d,a]};B.SelectConic={};B.SelectConic.kind="C";B.SelectConic.updatePosition=function(a){a.matrix=c[a.args[0]].results[a.index-1];a.matrix=m.normalizeMax(a.matrix);a.matrix=F.withUsage(a.matrix,"Conic")};B._helper.ConicBy4p1l=function(a,b,c,d,e,g){var h=m.cross(m.cross(b,d),
g),k=m.cross(m.cross(c,e),g),l=m.cross(m.cross(b,c),g),n=m.cross(m.cross(d,e),g),r=m.realVector(D.to(100*Math.random(),100*Math.random()));g=q.mult(m.det3(r,k,l),m.det3(r,k,n));g=q.sqrt(g);l=q.mult(m.det3(r,h,l),m.det3(r,h,n));l=q.sqrt(l);h=m.scalmult(g,h);l=m.scalmult(l,k);k=m.add(h,l);h=m.sub(h,l);k=B._helper.ConicBy5(a,b,c,d,e,k);a=B._helper.ConicBy5(a,b,c,d,e,h);return[k,a]};B.ConicBy4p1l={};B.ConicBy4p1l.kind="Cs";B.ConicBy4p1l.updatePosition=function(a){var b=B._helper.ConicBy4p1l(a,c[a.args[0]].homog,
c[a.args[1]].homog,c[a.args[2]].homog,c[a.args[3]].homog,c[a.args[4]].homog);a.results=b};B._helper.ConicBy3p2l=function(a,b,c,d,e){function g(a,b,c,f){return q.sub(q.mult(a,f),q.mult(b,c))}var h=m.cross(a,b),k=m.cross(d,e);d=m.cross(d,h);e=m.cross(e,h);h=m.turnIntoCSList([d,e,k]);c=m.productVM(c,m.adjoint3(h));k=m.adjoint3(m.turnIntoCSList([m.scalmult(c.value[0],d),m.scalmult(c.value[1],e),m.scalmult(c.value[2],k)]));c=m.transpose(k);d=q.mult;e=m.productMV(c,a);a=e.value[0];e=e.value[1];h=m.productMV(c,
b);b=h.value[0];var h=h.value[1],l=q.sqrt(d(a,e)),n=q.sqrt(d(b,h)),r,t=Array(4);for(r=0;4>r;++r){var u=(r&2)-1,v=d(q.real(((r&1)<<1)-1),l),w=d(q.real(u),n),y=g(e,v,h,w),x=g(b,w,a,v),u=g(a,e,b,h),z=q.add(q.add(g(b,h,a,e),g(h,w,e,v)),g(w,b,v,a)),v=d(y,y),w=d(x,x),A=d(z,z),B=d(y,x),y=d(y,z),x=d(x,z),B=q.sub(B,d(q.real(.5),d(u,u))),u=m.turnIntoCSList([m.turnIntoCSList([v,B,y]),m.turnIntoCSList([B,w,x]),m.turnIntoCSList([y,x,A])]),u=m.productMM(k,m.productMM(u,c)),u=m.turnIntoCSList([u.value[0].value[0],
u.value[0].value[1],u.value[0].value[2],u.value[1].value[1],u.value[1].value[2],u.value[2].value[2]]);t[r]=u}return t};B.ConicBy3p2l={};B.ConicBy3p2l.kind="Cs";B.ConicBy3p2l.updatePosition=function(a){for(var b=B._helper.ConicBy3p2l(c[a.args[0]].homog,c[a.args[1]].homog,c[a.args[2]].homog,c[a.args[3]].homog,c[a.args[4]].homog),b=jc(b),d=Array(4),e=0;4>e;++e){var g=b[e].value;d[e]=m.turnIntoCSList([m.turnIntoCSList([g[0],g[1],g[2]]),m.turnIntoCSList([g[1],g[3],g[4]]),m.turnIntoCSList([g[2],g[4],g[5]])])}a.results=
d};B.ConicBy3p2l.stateSize=48;B.ConicBy2p3l={};B.ConicBy2p3l.kind="Cs";B.ConicBy2p3l.updatePosition=function(a){for(var b=B._helper.ConicBy3p2l(c[a.args[2]].homog,c[a.args[3]].homog,c[a.args[4]].homog,c[a.args[0]].homog,c[a.args[1]].homog),b=jc(b),d=Array(4),e=0;4>e;++e){var g=b[e].value,g=m.turnIntoCSList([m.turnIntoCSList([g[0],g[1],g[2]]),m.turnIntoCSList([g[1],g[3],g[4]]),m.turnIntoCSList([g[2],g[4],g[5]])]);d[e]=m.normalizeMax(m.adjoint3(g))}a.results=d};B.ConicBy2p3l.stateSize=48;B.ConicBy1p4l=
{};B.ConicBy1p4l.kind="Cs";B.ConicBy1p4l.updatePosition=function(a){var b=B._helper.ConicBy4p1l(a,c[a.args[0]].homog,c[a.args[1]].homog,c[a.args[2]].homog,c[a.args[3]].homog,c[a.args[4]].homog),d=b[0],b=b[1],d=m.adjoint3(d),b=m.adjoint3(b),b=[d,b];a.results=b};B.ConicBy2Foci1P={};B.ConicBy2Foci1P.kind="Cs";B.ConicBy2Foci1P.updatePosition=function(a){var b=c[a.args[0]].homog,d=c[a.args[1]].homog,e=c[a.args[2]].homog,g=m.ii,h=m.jj,k=m.normalizeMax(m.cross(b,e)),l=m.normalizeMax(m.cross(d,e)),n=m.normalizeMax(m.cross(e,
g)),e=m.normalizeMax(m.cross(e,h)),l=B._helper.coHarmonic(n,e,k,l),k=m.normalizeMax(l[0]),l=m.normalizeMax(l[1]),g=m.turnIntoCSList([g]),n=m.turnIntoCSList([h]),e=m.turnIntoCSList([b]),r=m.turnIntoCSList([d]),h=B._helper.conicFromTwoDegenerates(g,n,e,r,k),h=m.normalizeMax(h),g=B._helper.conicFromTwoDegenerates(g,n,e,r,l),g=m.normalizeMax(g),h=m.normalizeMax(m.adjoint3(h)),g=m.normalizeMax(m.adjoint3(g));"ellipsoid"!==B._helper.getConicType(h)&&(k=h,h=g,g=k);m.almostequals(b,d).value&&(b=q.real(3),
g=m.zeromatrix(b,b));a.results=[h,g]};B._helper.coHarmonic=function(a,b,c,d){var e=m.realVector([100*Math.random(),100*Math.random(),1]),g=m.det3(e,c,a),h=m.det3(e,c,b);c=m.det3(e,d,a);d=m.det3(e,d,b);d=q.sqrt(q.mult(d,h));g=q.sqrt(q.mult(c,g));a=F.mult(a,d);g=F.mult(b,g);b=m.add(a,g);a=m.sub(a,g);return[b,a]};B.ConicBy5lines={};B.ConicBy5lines.kind="C";B.ConicBy5lines.updatePosition=function(a){var b=B._helper.ConicBy5(a,c[a.args[0]].homog,c[a.args[1]].homog,c[a.args[2]].homog,c[a.args[3]].homog,
c[a.args[4]].homog),b=m.adjoint3(b);a.matrix=b;a.matrix=m.normalizeMax(a.matrix);a.matrix=F.withUsage(a.matrix,"Conic")};B.CircleBy3={};B.CircleBy3.kind="C";B.CircleBy3.updatePosition=function(a){var b=B._helper.ConicBy5(a,c[a.args[0]].homog,c[a.args[1]].homog,m.ii,m.jj,c[a.args[2]].homog);a.matrix=m.normalizeMax(b);a.matrix=F.withUsage(a.matrix,"Circle")};B.Polar={};B.Polar.kind="L";B.Polar.updatePosition=function(a){var b=c[a.args[1]],d=m.inverse(c[a.args[0]].matrix);a.homog=F.mult(d,b.homog);a.homog=
m.normalizeMax(a.homog);a.homog=F.withUsage(a.homog,"Point")};B.PolarPoint={};B.PolarPoint.kind="P";B.PolarPoint.updatePosition=function(a){a.homog=F.mult(c[a.args[1]].matrix,c[a.args[0]].homog);a.homog=m.normalizeMax(a.homog);a.homog=F.withUsage(a.homog,"Line")};B.angleBisector={};B.angleBisector.kind="Ls";B.angleBisector.updatePosition=function(a){var b=c[a.args[0]],d=c[a.args[1]],e=m.normalizeMax(m.cross(b.homog,d.homog)),g=m.normalizeMax(m.cross(m.ii,e)),h=m.normalizeMax(m.cross(m.jj,e)),k=q.sqrt(q.mult(m.det3(e,
d.homog,g),m.det3(e,b.homog,g))),l=q.sqrt(q.mult(m.det3(e,d.homog,h),m.det3(e,b.homog,h))),g=F.mult(g,l),k=F.mult(h,k),h=m.add(g,k),k=m.sub(g,k),g=m.abs(h).value.real<q.eps,l=m.abs(k).value.real<q.eps;g||l?g?k=m.normalizeMax(k):l&&(h=m.normalizeMax(h)):(h=m.normalizeMax(h),k=m.normalizeMax(k));if(m.almostequals(h,m.linfty).value&&l||m.almostequals(k,m.linfty).value&&g)m.abs(h).value.real<m.abs(k).value.real?(g=m.det3(e,d.homog,k),e=m.det3(e,b.homog,k),b=F.mult(b.homog,g),d=F.mult(d.homog,e),h=m.add(b,
d)):(g=m.det3(e,d.homog,h),e=m.det3(e,b.homog,h),b=F.mult(b.homog,g),d=F.mult(d.homog,e),k=m.add(b,d));h=m.normalizeMax(h);k=m.normalizeMax(k);a.results=Qa(h,k)};B.angleBisector.stateSize=Qa.stateSize;B._helper.IntersectLC=function(a,b){var c=q,d=m.crossOperator(a),e=m.transpose(d),e=F.mult(e,F.mult(b,d)),g=m.maxIndex(a,q.abs2),h,k,l,n;0===g?(g=e.value[1].value[1],h=e.value[1].value[2],k=e.value[2].value[1],l=e.value[2].value[2],n=a.value[0]):1===g?(g=e.value[0].value[0],h=e.value[0].value[2],k=e.value[2].value[0],
l=e.value[2].value[2],n=a.value[1]):(g=e.value[0].value[0],h=e.value[0].value[1],k=e.value[1].value[0],l=e.value[1].value[1],n=a.value[2]);c=c.div(c.sqrt(c.sub(c.mult(h,k),c.mult(g,l))),n);c=m.add(e,m.scalmult(c,d));g=m.maxIndex(c,m.abs2);d=c.value[g];d=m.normalizeMax(d);d=F.withUsage(d,"Point");c=m.transpose(c);g=m.maxIndex(c,m.abs2);c=c.value[g];c=m.normalizeMax(c);c=F.withUsage(c,"Point");return[d,c]};B.IntersectLC={};B.IntersectLC.kind="Ps";B.IntersectLC.updatePosition=function(a){var b=B._helper.IntersectLC(c[a.args[0]].homog,
c[a.args[1]].matrix);a.results=Qa(b[0],b[1])};B.IntersectLC.stateSize=Qa.stateSize;B.OtherIntersectionCL={};B.OtherIntersectionCL.kind="P";B.OtherIntersectionCL.updatePosition=function(a){var b=c[a.args[2]].homog,d=B._helper.IntersectLC(c[a.args[1]].homog,c[a.args[0]].matrix),e=d[0],d=d[1],g=m.projectiveDistMinScal(e,b),b=m.projectiveDistMinScal(d,b);a.homog=g<b?d:e;a.homog=m.normalizeMax(a.homog);a.homog=F.withUsage(a.homog,"Point")};B.IntersectCirCir={};B.IntersectCirCir.kind="Ps";B.IntersectCirCir.updatePosition=
function(a){var b=c[a.args[0]].matrix,d=c[a.args[1]].matrix,e=m.scalmult(d.value[0].value[0],b.value[2]),d=m.scalmult(b.value[0].value[0],d.value[2]),e=m.sub(e,d),e=m.turnIntoCSList([e.value[0],e.value[1],q.realmult(.5,e.value[2])]),e=m.normalizeMax(e),b=B._helper.IntersectLC(e,b);a.results=Qa(b[0],b[1])};B.IntersectCirCir.stateSize=Qa.stateSize;B.OtherIntersectionCC={};B.OtherIntersectionCC.kind="P";B.OtherIntersectionCC.updatePosition=function(a){var b=c[a.args[0]].matrix,d=c[a.args[1]].matrix,
e=c[a.args[2]].homog,g=m.scalmult(d.value[0].value[0],b.value[2]),d=m.scalmult(b.value[0].value[0],d.value[2]),g=m.sub(g,d),g=m.turnIntoCSList([g.value[0],g.value[1],q.realmult(.5,g.value[2])]),g=m.normalizeMax(g),g=B._helper.IntersectLC(g,b),b=g[0],g=g[1],d=m.projectiveDistMinScal(b,e),e=m.projectiveDistMinScal(g,e);a.homog=d<e?g:b;a.homog=m.normalizeMax(a.homog);a.homog=F.withUsage(a.homog,"Point")};B._helper.IntersectConicConic=function(a,b){var c=a.value[0],d=a.value[1],e=a.value[2],g=b.value[0],
h=b.value[1],k=b.value[2],l=m.det3(c,d,e),n=q.add(q.add(m.det3(c,d,k),m.det3(c,h,e)),m.det3(g,d,e)),c=q.add(q.add(m.det3(c,h,k),m.det3(g,d,k)),m.det3(g,h,e)),g=m.det3(g,h,k),k=q.abs2(l).value.real,h=q.abs2(g).value.real;k<h&&(k=a,a=b,b=k,k=g,g=l,l=k,k=c,c=n,n=k,k=h);1E-24>k?(l=a,c=b):(n=q.solveCubic(l,n,c,g),c=q.abs2(q.sub(n[0],n[1])).value.real,g=q.abs2(q.sub(n[0],n[2])).value.real,h=q.abs2(q.sub(n[1],n[2])).value.real,c>g?(l=n[1],n=c>h?n[0]:n[2]):(l=n[2],n=g>h?n[0]:n[1]),l=m.add(m.scalmult(l,a),
b),c=m.add(m.scalmult(n,a),b));n=B._helper.splitDegenConic(l);l=n[0];n=n[1];c=B._helper.splitDegenConic(c);h=c[0];g=c[1];c=m.cross(l,h);h=m.cross(n,h);l=m.cross(l,g);n=m.cross(n,g);c=m.normalizeMax(c);h=m.normalizeMax(h);l=m.normalizeMax(l);n=m.normalizeMax(n);c=F.withUsage(c,"Point");h=F.withUsage(h,"Point");l=F.withUsage(l,"Point");n=F.withUsage(n,"Point");return[c,h,l,n]};B.IntersectConicConic={};B.IntersectConicConic.kind="Ps";B.IntersectConicConic.updatePosition=function(a){var b=B._helper.IntersectConicConic(c[a.args[0]].matrix,
c[a.args[1]].matrix),b=Kb(b[0],b[1],b[2],b[3]);a.results=b};B.IntersectConicConic.stateSize=Kb.stateSize;B.SelectP={};B.SelectP.kind="P";B.SelectP.initialize=function(a){if(void 0!==a.index)return a.index-1;var b=c[a.args[0]].results.value;a=B._helper.initializePoint(a);for(var d=m.projectiveDistMinScal(a,b[0]),e=0,g=1;g<b.length;++g){var h=m.projectiveDistMinScal(a,b[g]);h<d&&(d=h,e=g)}return e};B.SelectP.updatePosition=function(a){a.homog=c[a.args[0]].results.value[a.param]};B.SelectL={};B.SelectL.kind=
"L";B.SelectL.updatePosition=function(a){a.homog=c[a.args[0]].results.value[a.index-1];a.homog=F.withUsage(a.homog,"Line")};B.TrProjection={};B.TrProjection.kind="Tr";B.TrProjection.updatePosition=function(a){function b(d){var e=c[a.args[0+d]].homog,g=c[a.args[2+d]].homog,h=c[a.args[4+d]].homog,k=c[a.args[6+d]].homog;d=m.adjoint3(m.turnIntoCSList([e,g,h]));d=m.productVM(k,d).value;return d=m.transpose(m.turnIntoCSList([m.scalmult(d[0],e),m.scalmult(d[1],g),m.scalmult(d[2],h)]))}var d=m.productMM(b(1),
m.adjoint3(b(0))),d=m.normalizeMax(d);a.matrix=d;d=m.transpose(m.adjoint3(d));d=m.normalizeMax(d);a.dualMatrix=d};B.TrInverse={};B.TrInverse.kind="Tr";B.TrInverse.updatePosition=function(a){var b=c[a.args[0]];a.dualMatrix=m.transpose(b.matrix);a.matrix=m.transpose(b.dualMatrix)};B.TransformP={};B.TransformP.kind="P";B.TransformP.updatePosition=function(a){a.homog=m.normalizeMax(m.productMV(c[a.args[0]].matrix,c[a.args[1]].homog));a.homog=F.withUsage(a.homog,"Point")};B.TransformL={};B.TransformL.kind=
"L";B.TransformL.updatePosition=function(a){a.homog=m.normalizeMax(m.productMV(c[a.args[0]].dualMatrix,c[a.args[1]].homog));a.homog=F.withUsage(a.homog,"Line")};B.TransformS={};B.TransformS.kind="S";B.TransformS.updatePosition=function(a){var b=c[a.args[0]],d=c[a.args[1]];a.homog=m.normalizeMax(m.productMV(b.dualMatrix,d.homog));a.homog=F.withUsage(a.homog,"Line");a.startpos=m.normalizeMax(m.productMV(b.matrix,d.startpos));a.endpos=m.normalizeMax(m.productMV(b.matrix,d.endpos));a.farpoint=m.normalizeMax(m.productMV(b.matrix,
d.farpoint))};B._helper.pointReflection=function(a,b){var c=B._helper.CircleMP(a,b);return B._helper.conicOtherIntersection(c,b,a)};B._helper.conicOtherIntersection=function(a,b,c){var d=m.productMV(a,c);a=m.scalproduct(c,d);d=m.scalproduct(b,d);d=q.realmult(-2,d);b=m.scalmult(a,b);c=m.scalmult(d,c);c=m.add(b,c);return c=m.normalizeMax(c)};B._helper.initializePoint=function(a){var b=0,c=0,d=0;a.pos&&(2===a.pos.length&&(b=a.pos[0],c=a.pos[1],d=1),3===a.pos.length&&(b=a.pos[0],c=a.pos[1],d=a.pos[2]));
a=m.realVector([b,c,d]);return a=m.normalizeMax(a)};var Cc={CircleMFixedr:function(a){a.pinned=!0;a.type="CircleMr";return[a]},CircleByRadius:function(a){a.type="CircleMr";return[a]},IntersectionConicLine:function(a){a.args=[a.args[1],a.args[0]];a.type="IntersectLC";return[a]},IntersectionCircleCircle:function(a){a.type="IntersectCirCir";return[a]},PolarLine:function(a){a.args=[a.args[1],a.args[0]];a.type="Polar";return[a]},Parallel:function(a){a.type="Para";return[a]},Calculation:function(a){console.log("Calculation stripped from construction");
return[]},Transform:function(a){var b="Transform"+B[c[a.args[1]].type].kind;if(B.hasOwnProperty(b))return a.type=b,[a];console.log(b+" not implemented yet");return[]}},Ca={},nc,hb,oc,pc;nc=[[],[.2],[.075,.225],[44/45,-56/15,32/9],[19372/6561,-25360/2187,64448/6561,-212/729],[9017/3168,-355/33,46732/5247,49/176,-5103/18656],[35/384,0,500/1113,125/192,-2187/6784,11/84]];hb=[0,.2,.3,.8,8/9,1,1];oc=[35/384,0,500/1113,125/192,-2187/6784,11/84,0];pc=[5179/57600,0,7571/16695,.6140625,-92097/339200,187/2100,
.025];var Fa,ra=[],wb=!1;Ca.tick=function(){for(var a=0;a<ca.env.accuracy;a++)Ca.tick1(ca.env.deltat/ca.env.accuracy),I(Ba.simulationstep)};Ca.tick1=function(a){for(var b=a,c=0;0<a&&c<.999*a||0>a&&c>.999*a;)b=Ca.oneRKStep(b),c+=b,b=Math.min(2*b,a-c),b=Math.max(b,1E-16),Ca.restorePosition(),Ca.doCollisions(),Ca.calculateForces(),Ca.moveToFinalPos();return!0};Ca.restorePosition=function(){Fa.forEach(function(a){a=a.behavior;ca[a.type].restorePos(a,9)})};Ca.doCollisions=function(){Fa.forEach(function(a){a=
a.behavior;ca[a.type].doCollisions(a)})};Ca.calculateForces=function(){Fa.forEach(function(a){a=a.behavior;ca[a.type].calculateForces(a)})};Ca.moveToFinalPos=function(){Fa.forEach(function(a){a=a.behavior;ca[a.type].move(a)})};Ca.oneRKStep=function(a){for(var b=function(a){Fa.forEach(function(b){b=b.behavior;ca[b.type].initRK(b,a);ca[b.type].storePosition(b)})},c=function(a){Fa.forEach(function(b){b=b.behavior;ca[b.type].setToTimestep(b,hb[a])})},d=function(a){Fa.forEach(function(b){b=b.behavior;
ca[b.type].proceedMotion(b,hb[a],a,nc[a])})},e=function(){Fa.forEach(function(a){a=a.behavior;ca[a.type].resetForces(a)})},g=function(a){Fa.forEach(function(b){b=b.behavior;ca[b.type].calculateDelta(b,a)})},h=function(b){var c=0;Fa.forEach(function(a){a=a.behavior;ca[a.type].proceedMotion(a,hb[6],7,oc);ca[a.type].savePos(a,8);ca[a.type].proceedMotion(a,hb[6],7,pc);ca[a.type].savePos(a,9);c+=ca[a.type].sqDist(a,8,9)});return c=Math.sqrt(c)/a},k=function(a){Fa.forEach(function(a){a=a.behavior;ca[a.type].recallPosition(a)})},
l=!1;!l;){b(a);for(var m=0;7>m;m++)c(m),d(m),e(),Ca.calculateForces(),g(m);h(a)>ca.env.errorbound&&a>ca.env.lowestdeltat?(a/=ca.env.slowdownfactor,k()):l=!0}return a};var ca={Mass:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.mass&&(a.mass=1);"undefined"===typeof a.charge&&(a.charge=0);"undefined"===typeof a.friction&&(a.friction=0);a.lnfrict=0;"undefined"===typeof a.limitspeed&&(a.limitspeed=!1);"undefined"===typeof a.fixed&&(a.fixed=!1);"undefined"===typeof a.radius&&
(a.radius=1);a.internalmove=!1;a.fx=0;a.fy=0;a.fz=0;a.vx=a.vx||0;a.vy=a.vy||0;a.vz=a.vz||0;a.mtype=0;a.env=ca.env;a.deltat=0;a.mx=0;a.my=0;a.mz=0;a.mvx=0;a.mvy=0;a.mvz=0;a.dx=[0,0,0,0,0,0,0,0,0,0];a.dy=[0,0,0,0,0,0,0,0,0,0];a.dz=[0,0,0,0,0,0,0,0,0,0];a.dvx=[0,0,0,0,0,0,0,0,0,0];a.dvy=[0,0,0,0,0,0,0,0,0,0];a.dvz=[0,0,0,0,0,0,0,0,0,0];a.midx=0;a.midy=0;a.midz=0;a.lx=0;a.ly=0;a.lz=0},resetForces:function(a){a.fx=0;a.fy=0;a.fz=0},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){var c=
Q.extractPoint(a.el.homog);a.x=c.x;a.y=c.y;a.z=0;a.xo=a.x;a.yo=a.y;a.zo=a.z;a.vxo=a.vx;a.vyo=a.vy;a.vzo=a.vz;a.deltat=b;a.fx=0;a.fy=0;a.fz=0},setVelocity:function(a,b,c,d){d||(d=0);a.vx=b;a.vy=c;a.vz=d},move:function(a){a.pos=[a.x,a.y,1];a.internalmove=!0;wa&&pa.down&&a.el===wa.mover||(a.el.homog=m.realVector(a.pos));a.el.sx=a.x;a.el.sy=a.y;a.internalmove=!1},proceedMotion:function(a,b,c,d){if(!a.fixed)for(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz,b=0;b<c;b++)a.x+=d[b]*a.dx[b]*a.deltat,
a.y+=d[b]*a.dy[b]*a.deltat,a.z+=d[b]*a.dz[b]*a.deltat,a.vx+=d[b]*a.dvx[b]*a.deltat,a.vy+=d[b]*a.dvy[b]*a.deltat,a.vz+=d[b]*a.dvz[b]*a.deltat},calculateForces:function(a){var b=Math.sqrt(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz);a.lnfrict=-Math.log((1-a.friction)*(1-a.env.friction)*(.1<b&&a.limitSpeed?.1/b:1));a.fx+=-a.vx*a.lnfrict*a.mass;a.fy+=-a.vy*a.lnfrict*a.mass;a.fz+=-a.vz*a.lnfrict*a.mass},calculateDelta:function(a,b){a.dx[b]=a.vx;a.dy[b]=a.vy;a.dz[b]=a.vz;a.dvx[b]=a.fx/a.mass;a.dvy[b]=a.fy/a.mass;a.dvz[b]=
a.fz/a.mass},savePos:function(a,b){a.dx[b]=a.x;a.dy[b]=a.y;a.dz[b]=a.z;a.dvx[b]=a.vx;a.dvy[b]=a.vy;a.dvz[b]=a.vz},restorePos:function(a,b){a.fixed||(a.x=a.dx[b],a.y=a.dy[b],a.z=a.dz[b],a.vx=a.dvx[b],a.vy=a.dvy[b],a.vz=a.dvz[b])},sqDist:function(a,b,c){var d=(a.dx[b]-a.dx[c])*(a.dx[b]-a.dx[c]),d=d+(a.dy[b]-a.dy[c])*(a.dy[b]-a.dy[c]),d=d+(a.dz[b]-a.dz[c])*(a.dz[b]-a.dz[c]),d=d+(a.dvx[b]-a.dvx[c])*(a.dvx[b]-a.dvx[c]),d=d+(a.dvy[b]-a.dvy[c])*(a.dvy[b]-a.dvy[c]);return d+=(a.dvz[b]-a.dvz[c])*(a.dvz[b]-
a.dvz[c])},kineticEnergy:function(a){return.5*a.mass*(a.vx*a.vx+a.vy*a.vy+a.vz*a.vz)},storePosition:function(a){a.mx=a.x;a.my=a.y;a.mz=a.z;a.mvx=a.vx;a.mvy=a.vy;a.mvz=a.vz},recallPosition:function(a){a.fixed||(a.x=a.mx,a.y=a.my,a.z=a.mz,a.vx=a.mvx,a.vy=a.mvy,a.vz=a.mvz)},doCollisions:function(a){}},Sun:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.mass&&(a.mass=10);"undefined"===typeof a.friction&&(a.friction=0);a.charge=0;a.x=0;a.y=0;a.z=0},resetForces:function(a){},
getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){var c=Q.extractPoint(a.el.homog);a.x=c.x;a.y=c.y;a.z=0},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateDelta:function(a,b){},calculateForces:function(a){for(var b=a.x,c=a.y,d=a.z,e=0;e<ra.length;e++){var g=ra[e],h=g.behavior.x,k=g.behavior.y,l=g.behavior.z,m=Math.sqrt((b-h)*(b-h)+(c-k)*(c-k)+(d-l)*(d-l)),k=(c-k)*a.mass*g.behavior.mass/(m*m*m),l=(d-l)*a.mass*g.behavior.mass/(m*m*m);g.behavior.fx+=
(b-h)*a.mass*g.behavior.mass/(m*m*m)*g.behavior.mass;g.behavior.fy+=k*g.behavior.mass;g.behavior.fz+=l*g.behavior.mass}},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},Gravity:{init:function(a,b){a.vel=[0,0,0];a.pos=[0,0,0,0];a.el=b;"undefined"===typeof a.strength&&(a.strength=1);a.namea=b.args[0];a.nameb=b.args[1];a.ma=c[a.namea];a.mb=c[a.nameb]},resetForces:function(a){},
getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateDelta:function(a,b){},calculateForces:function(a){var b=Q.extractPoint(a.ma.homog),c=Q.extractPoint(a.mb.homog),d=(c.x-b.x)*a.strength;a=(c.y-b.y)*a.strength;for(b=0;b<ra.length;b++)c=ra[b],c.behavior.fx+=d*c.behavior.mass,c.behavior.fy+=a*c.behavior.mass,c.behavior.fz+=0*c.behavior.mass},savePos:function(a,b){},restorePos:function(a,b){},
sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},Spring:{init:function(a,b){a.el=b;"undefined"===typeof a.strength&&(a.strength=1);"undefined"===typeof a.amplitude&&(a.amplitude=0);"undefined"===typeof a.phase&&(a.phase=0);"undefined"===typeof a.speed&&(a.speed=1);"undefined"===typeof a.l0&&(a.l0=0);"undefined"===typeof a.stype&&(a.stype=1);"undefined"===typeof a.readOnInit&&(a.readOnInit=!1);a.namea=
b.args[0];a.nameb=b.args[1];a.ma=c[a.namea];a.mb=c[a.nameb];var d=Q.extractPoint(a.ma.homog),e=Q.extractPoint(a.mb.homog);a.l0=Math.sqrt((d.x-e.x)*(d.x-e.x)+(d.y-e.y)*(d.y-e.y));a.env=ca.env},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,b,c,d){},calculateForces:function(a){var b,c,d,e;!a.ma.behavior||wa&&pa.down&&a.ma===wa.mover?(c=Q.extractPoint(a.ma.homog),b=c.x,d=c.y):(b=
a.ma.behavior.x,d=a.ma.behavior.y);!a.mb.behavior||wa&&pa.down&&a.mb===wa.mover?(e=Q.extractPoint(a.mb.homog),c=e.x,e=e.y):(c=a.mb.behavior.x,e=a.mb.behavior.y);var g=Math.sqrt((b-c)*(b-c)+(d-e)*(d-e)),h=a.l0,k=a.stype;1===k&&(h=0);var l=0;if(2===k||3===k)l=a.ma.behavior.mass*a.mb.behavior.mass*a.strength;2===k&&(l=-l);var m,n;if(0===g||0!==k&&1!==k)if(a.ma.behavior&&a.mb.behavior&&0!==g){if(g*=g*g,2===k||3===k)m=(b-c)*l/g,n=(d-e)*l/g}else m=n=0;else m=-(b-c)*a.strength*(g-h)/g*a.env.springstrength,
n=-(d-e)*a.strength*(g-h)/g*a.env.springstrength;a.ma.behavior&&(a.ma.behavior.fx+=m,a.ma.behavior.fy+=n);a.mb.behavior&&(a.mb.behavior.fx-=m,a.mb.behavior.fy-=n)},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}},det:function(a,b,c,d,e,g){return c*g-e*d+e*b-a*g+a*d-c*b},Bouncer:{init:function(a,b){a.el=b;"undefined"===typeof a.xdamp&&
(a.xdamp=0);"undefined"===typeof a.ydamp&&(a.ydamp=0);"undefined"===typeof a.motorchanger&&(a.motorchanger=!0);a.namea=b.args[0];a.nameb=b.args[1];a.ma=c[a.namea];a.mb=c[a.nameb];var d=Q.extractPoint(a.ma.homog),e=Q.extractPoint(a.mb.homog);a.x1o=1.01*d.x-.01*e.x;a.y1o=1.01*d.y-.01*e.y;a.x2o=1.01*e.x-.01*d.x;a.y2o=1.01*e.y-.01*d.y;a.env=ca.env},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){a.deltat=b},setVelocity:function(a,b,c,d){},move:function(a){},
proceedMotion:function(a,b,c,d){},calculateForces:function(a){},calculateDelta:function(a,b){},savePos:function(a,b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){for(var b=Q.extractPoint(a.ma.homog),c=Q.extractPoint(a.mb.homog),d=b.x,b=b.y,e=c.x,c=c.y,g=a.x1o,h=a.y1o,k=a.x2o,l=a.y2o,m=Math.sqrt((d-e)*(d-e)+(b-c)*(b-c)),n=(d-e)/m,m=(b-c)/m,r=0;r<ra.length;r++){var t=ra[r],
u=t.behavior.xo,v=t.behavior.yo,w=t.behavior.x,y=t.behavior.y,x=q.mult(q.complex(g,h),q.complex(e,c)),z=q.mult(q.complex(k,l),q.complex(d,b)),x=q.sub(x,z),z=q.mult(q.complex(u,v),q.complex(d,b)),x=q.add(x,z),z=q.mult(q.complex(u,v),q.complex(e,c)),x=q.sub(x,z),z=q.sub(q.complex(g,h),q.complex(k,l)),x=q.div(x,z);0>ca.det(d,b,e,c,w,y)*ca.det(d,b,e,c,x.value.real,x.value.imag)&&0>ca.det(d,b,w,y,x.value.real,x.value.imag)*ca.det(e,c,w,y,x.value.real,x.value.imag)&&(v=t.behavior.mvx+a.deltat*(-x.value.real+
t.behavior.xo),w=t.behavior.mvy+a.deltat*(-x.value.imag+t.behavior.yo),u=n*v+m*w,v=m*v-n*w,t.behavior.x=x.value.real,t.behavior.y=x.value.imag,t.behavior.vx=n*u*(1-a.xdamp),t.behavior.vy=m*u*(1-a.xdamp),t.behavior.vx+=-m*v*(1-a.ydamp),t.behavior.vy+=n*v*(1-a.ydamp))}a.x1o=d;a.y1o=b;a.x2o=e;a.y2o=c}},Environment:{init:function(a){"undefined"===typeof a.gravity&&(a.gravity=0);"undefined"===typeof a.friction&&(a.friction=0);"undefined"===typeof a.springstrength&&(a.springstrength=1);"undefined"===typeof a.accuracy&&
(a.accuracy=10);"undefined"===typeof a.deltat&&(a.deltat=.3);"undefined"===typeof a.charges&&(a.charges=!1);"undefined"===typeof a.balls&&(a.balls=!1);"undefined"===typeof a.newton&&(a.newton=!1);"undefined"===typeof a.ballInteractionBoosting&&(a.ballInteractionBoosting=1);ca.env=a;a.errorbound=.001;a.lowestdeltat=1E-7;a.slowdownfactor=2},resetForces:function(a){},getBlock:!1,setToTimestep:function(a,b,c){},initRK:function(a,b){},setVelocity:function(a,b,c,d){},move:function(a){},proceedMotion:function(a,
b,c,d){},calculateForces:function(a){var b,c,d,e,g,h,k,l,m,n;if(a.newton)for(b=0;b<ra.length-1;b++)for(c=ra[b],d=c.behavior.x,e=c.behavior.y,g=b+1;g<ra.length;g++)h=ra[g],k=h.behavior.x,l=h.behavior.y,n=Math.sqrt((d-k)*(d-k)+(e-l)*(e-l)),k=(d-k)*c.behavior.mass*h.behavior.mass/(n*n*n),l=(e-l)*c.behavior.mass*h.behavior.mass/(n*n*n),c.behavior.fx-=k,c.behavior.fy-=l,h.behavior.fx+=k,h.behavior.fy+=l;if(a.charges)for(b=0;b<ra.length-1;b++)for(c=ra[b],d=c.behavior.x,e=c.behavior.y,g=b+1;g<ra.length;g++)h=
ra[g],k=h.behavior.x,l=h.behavior.y,n=Math.sqrt((d-k)*(d-k)+(e-l)*(e-l)),k=(d-k)*c.behavior.charge*h.behavior.charge/(n*n*n),l=(e-l)*c.behavior.charge*h.behavior.charge/(n*n*n),c.behavior.fx+=k,c.behavior.fy+=l,h.behavior.fx-=k,h.behavior.fy-=l;if(a.balls)for(b=0;b<ra.length-1;b++)if(c=ra[b],0!==c.behavior.radius)for(d=c.behavior.x,e=c.behavior.y,g=b+1;g<ra.length;g++)h=ra[g],0!==h.behavior.radius&&(k=h.behavior.x,l=h.behavior.y,m=c.behavior.radius+h.behavior.radius,n=Math.sqrt((d-k)*(d-k)+(e-l)*
(e-l)),0===a.ballInteractionBoosting?(k=(d-k)/(n*n*n)*(n>m?0:(n-m)*(n-m)),l=(e-l)/(n*n*n)*(n>m?0:(n-m)*(n-m))):1===a.ballInteractionBoosting?(k=(d-k)/(n*n*n*n)*(n>m?0:(n-m)*(n-m)),l=(e-l)/(n*n*n*n)*(n>m?0:(n-m)*(n-m))):(k=(d-k)/(n*n*n*n*n)*(n>m?0:(n-m)*(n-m)),l=(e-l)/(n*n*n*n*n)*(n>m?0:(n-m)*(n-m))),c.behavior.fx+=k,c.behavior.fy+=l,h.behavior.fx-=k,h.behavior.fy-=l);for(b=0;b<ra.length;b++)c=ra[b],c.behavior.fx+=0,c.behavior.fy+=a.gravity,c.behavior.fz+=0},calculateDelta:function(a,b){},savePos:function(a,
b){},restorePos:function(a,b){},sqDist:function(a,b,c){return 0},kineticEnergy:function(a){},storePosition:function(a){},recallPosition:function(a){},doCollisions:function(a){}}};return Ma};return b}();"undefined"!==typeof process&&"undefined"!==typeof module&&"undefined"!==typeof module.exports&&"undefined"===typeof window&&(module.exports=createCindy);
//# sourceMappingURL=Cindy.js.map

